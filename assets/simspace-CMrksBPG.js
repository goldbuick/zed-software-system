var wj=Object.defineProperty;var xj=(yi,Vn,Cn)=>Vn in yi?wj(yi,Vn,{enumerable:!0,configurable:!0,writable:!0,value:Cn}):yi[Vn]=Cn;var Lt=(yi,Vn,Cn)=>xj(yi,typeof Vn!="symbol"?Vn+"":Vn,Cn);(function(){"use strict";const yi=new Set,Vn={emit(t,e,n,r,i){Vn.invoke(vv(t,e,n,r,i))},invoke(t){yi.forEach(e=>e.handle(t))},connect(t){yi.add(t)},disconnect(t){yi.delete(t)}};var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function so(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function zE(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var xp={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Cn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(xp);var KE=xp.exports,Ep=so(KE),vp={};(function(t){var e=Cn&&Cn.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,p;d<h;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,y=l.addAdverb,b=y===void 0?!1:y,k=e(e(e([],e([],Array(m),!0).map(function(T){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),b?[n(t.adverbs)]:[],!0);return h&&(k=k.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),k.join(f)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return t.adjectives.length*f*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*f+f*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(h?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*f+f*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(h?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(vp);var kp=so(vp);const HE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let WE=t=>crypto.getRandomValues(new Uint8Array(t)),GE=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Tp=(t,e=21)=>GE(t,e,WE),YE=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=HE[n[t]&63];return e};var Ap="abcdefghijklmnopqrstuvwxyz",Rp="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Sp="0123456789",VE="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",ZE="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const XE=Sp,qE=Ap,JE=Rp;var QE=XE+qE+JE,mh={lowercase:Ap,uppercase:Rp,numbers:Sp,nolookalikes:VE,nolookalikesSafe:ZE,alphanumeric:QE};function Be(){return`sid_${YE(12).replaceAll("-",".")}`}Tp(mh.numbers,4),Tp(`${mh.numbers}${mh.lowercase}`,16);function Kr(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function tv(){return kp({capitalize:!1,adjectiveCount:1})}function ev(){return kp({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var nv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),rv=Object.prototype.hasOwnProperty;function gh(t,e){return rv.call(t,e)}function _h(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)gh(t,i)&&r.push(i);return r}function Ln(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function yh(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function vs(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Op(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function bh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(bh(t[e]))return!0}else if(typeof t=="object"){for(var r=_h(t),i=r.length,s=0;s<i;s++)if(bh(t[r[s]]))return!0}}return!1}function Ip(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Np=function(t){nv(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,Ip(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Ip(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),Me=Np,iv=Ln,oo={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=Kc(n,this.path);r&&(r=Ln(r));var i=ks(n,{op:"remove",path:this.from}).removed;return ks(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=Kc(n,this.from);return ks(n,{op:"add",path:this.path,value:Ln(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:ya(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},sv={add:function(t,e,n){return yh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:oo.move,copy:oo.copy,test:oo.test,_get:oo._get};function Kc(t,e){if(e=="")return t;var n={op:"_get",path:e};return ks(t,n),n.value}function ks(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):Hc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Kc(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=ya(t,e.value),o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Ln(t));var a=e.path||"",c=a.split("/"),l=t,u=1,f=c.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=Hc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Op(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!yh(h))throw new Me("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);yh(h)&&(h=~~h)}if(u>=f){if(n&&e.op==="add"&&h>l.length)throw new Me("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=sv[e.op].call(e,l,h,t);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=f){var o=oo[e.op].call(e,l,h,t);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Me("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function wh(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Ln(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=ks(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function ov(t,e,n){var r=ks(t,e);if(r.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Hc(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Me("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(oo[t.op]){if(typeof t.path!="string")throw new Me("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Me('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Me("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&bh(t.value))throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Me("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Me("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Cp([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Me("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Cp(t,e,n){try{if(!Array.isArray(t))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)wh(Ln(e),Ln(t),n||!0);else{n=n||Hc;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof Me)return i;throw i}}function ya(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!ya(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ya(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var av=Object.freeze({__proto__:null,JsonPatchError:Me,_areEquals:ya,applyOperation:ks,applyPatch:wh,applyReducer:ov,deepClone:iv,getValueByPointer:Kc,validate:Cp,validator:Hc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var xh=new WeakMap,cv=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),lv=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function uv(t){return xh.get(t)}function hv(t,e){return t.observers.get(e)}function fv(t,e){t.observers.delete(e.callback)}function dv(t,e){e.unobserve()}function pv(t,e){var n=[],r,i=uv(t);if(!i)i=new cv(t),xh.set(t,i);else{var s=hv(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Ln(t),e){r.callback=e,r.next=null;var o=function(){Eh(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){Eh(r),clearTimeout(r.next),fv(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new lv(e,r)),r}function Eh(t,e){e===void 0&&(e=!1);var n=xh.get(t.object);vh(n.value,t.object,t.patches,"",e),t.patches.length&&wh(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function vh(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=_h(e),o=_h(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(gh(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?vh(u,f,n,r+"/"+vs(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+vs(l),value:Ln(u)}),n.push({op:"replace",path:r+"/"+vs(l),value:Ln(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+vs(l),value:Ln(u)}),n.push({op:"remove",path:r+"/"+vs(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!gh(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+vs(l),value:Ln(e[l])})}}}function Lp(t,e,n){n===void 0&&(n=!1);var r=[];return vh(t,e,r,"",n),r}var mv=Object.freeze({__proto__:null,compare:Lp,generate:Eh,observe:pv,unobserve:dv});Object.assign({},av,mv,{JsonPatchError:Np,deepClone:Ln,escapePathComponent:vs,unescapePathComponent:Op});var gv=typeof Element<"u",_v=typeof Map=="function",yv=typeof Set=="function",bv=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Wc(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Wc(t[r],e[r]))return!1;return!0}var s;if(_v&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Wc(r.value[1],e.get(r.value[0])))return!1;return!0}if(yv&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(bv&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(gv&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Wc(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var wv=function(e,n){try{return Wc(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},xv=so(wv);function E(t){return t!=null}const hr=Object.keys;function Zn(t){return Ln(t)}function Ev(t){return typeof t=="boolean"}function At(t){return typeof t=="number"&&isNaN(t)===!1}function wt(t){return typeof t=="string"}function ae(t){return Array.isArray(t)}function kh(t){return t}var Rt=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Rt||{}),$t=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))($t||{}),fr=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(fr||{}),dt=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.PLAYER=18]="PLAYER",t[t.FIND=19]="FIND",t[t.FLEE=20]="FLEE",t[t.TO=21]="TO",t[t.MID=22]="MID",t[t.OVER=23]="OVER",t[t.UNDER=24]="UNDER",t))(dt||{}),vt=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.ZSSEDIT=14]="ZSSEDIT",t[t.CHAREDIT=15]="CHAREDIT",t[t.COLOREDIT=16]="COLOREDIT",t))(vt||{});function It(t){return(t==null?void 0:t.toLowerCase().trim())??""}function vv(t,e,n,r,i){return{session:t,player:e,id:Be(),sender:n,target:r,data:i}}function Xn(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function ao(t,e=[],n=kh,r=""){const i=Be(),s=It(t),o=e.map(It);let a=r;const c={id(){return i},name(){return t},session(l){return E(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,f){Vn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Xn(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&E(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Vn.connect(c),c}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const kv=4,Mp=0,Up=1,Tv=2;function co(t){let e=t.length;for(;--e>=0;)t[e]=0}const Av=0,Fp=1,Rv=2,Sv=3,Ov=258,Th=29,ba=256,wa=ba+1+Th,lo=30,Ah=19,Pp=2*wa+1,Ts=15,Rh=16,Iv=7,Sh=256,Bp=16,Dp=17,$p=18,Oh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Gc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Nv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),jp=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cv=512,bi=new Array((wa+2)*2);co(bi);const xa=new Array(lo*2);co(xa);const Ea=new Array(Cv);co(Ea);const va=new Array(Ov-Sv+1);co(va);const Ih=new Array(Th);co(Ih);const Yc=new Array(lo);co(Yc);function Nh(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let zp,Kp,Hp;function Ch(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const Wp=t=>t<256?Ea[t]:Ea[256+(t>>>7)],ka=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Mn=(t,e,n)=>{t.bi_valid>Rh-n?(t.bi_buf|=e<<t.bi_valid&65535,ka(t,t.bi_buf),t.bi_buf=e>>Rh-t.bi_valid,t.bi_valid+=n-Rh):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Hr=(t,e,n)=>{Mn(t,n[e*2],n[e*2+1])},Gp=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Lv=t=>{t.bi_valid===16?(ka(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Mv=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,f,d,h,p,m=0;for(d=0;d<=Ts;d++)t.bl_count[d]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Pp;l++)u=t.heap[l],d=n[n[u*2+1]*2+1]+1,d>c&&(d=c,m++),n[u*2+1]=d,!(u>r)&&(t.bl_count[d]++,h=0,u>=a&&(h=o[u-a]),p=n[u*2],t.opt_len+=p*(d+h),s&&(t.static_len+=p*(i[u*2+1]+h)));if(m!==0){do{for(d=c-1;t.bl_count[d]===0;)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,m-=2}while(m>0);for(d=c;d!==0;d--)for(u=t.bl_count[d];u!==0;)f=t.heap[--l],!(f>r)&&(n[f*2+1]!==d&&(t.opt_len+=(d-n[f*2+1])*n[f*2],n[f*2+1]=d),u--)}},Yp=(t,e,n)=>{const r=new Array(Ts+1);let i=0,s,o;for(s=1;s<=Ts;s++)i=i+n[s-1]<<1,r[s]=i;for(o=0;o<=e;o++){let a=t[o*2+1];a!==0&&(t[o*2]=Gp(r[a]++,a))}},Uv=()=>{let t,e,n,r,i;const s=new Array(Ts+1);for(n=0,r=0;r<Th-1;r++)for(Ih[r]=n,t=0;t<1<<Oh[r];t++)va[n++]=r;for(va[n-1]=r,i=0,r=0;r<16;r++)for(Yc[r]=i,t=0;t<1<<Gc[r];t++)Ea[i++]=r;for(i>>=7;r<lo;r++)for(Yc[r]=i<<7,t=0;t<1<<Gc[r]-7;t++)Ea[256+i++]=r;for(e=0;e<=Ts;e++)s[e]=0;for(t=0;t<=143;)bi[t*2+1]=8,t++,s[8]++;for(;t<=255;)bi[t*2+1]=9,t++,s[9]++;for(;t<=279;)bi[t*2+1]=7,t++,s[7]++;for(;t<=287;)bi[t*2+1]=8,t++,s[8]++;for(Yp(bi,wa+1,s),t=0;t<lo;t++)xa[t*2+1]=5,xa[t*2]=Gp(t,5);zp=new Nh(bi,Oh,ba+1,wa,Ts),Kp=new Nh(xa,Gc,0,lo,Ts),Hp=new Nh(new Array(0),Nv,0,Ah,Iv)},Vp=t=>{let e;for(e=0;e<wa;e++)t.dyn_ltree[e*2]=0;for(e=0;e<lo;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Ah;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Sh*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Zp=t=>{t.bi_valid>8?ka(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Xp=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},Lh=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Xp(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Xp(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},qp=(t,e,n)=>{let r,i,s=0,o,a;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+s++]&255,r+=(t.pending_buf[t.sym_buf+s++]&255)<<8,i=t.pending_buf[t.sym_buf+s++],r===0?Hr(t,i,e):(o=va[i],Hr(t,o+ba+1,e),a=Oh[o],a!==0&&(i-=Ih[o],Mn(t,i,a)),r--,o=Wp(r),Hr(t,o,n),a=Gc[o],a!==0&&(r-=Yc[o],Mn(t,r,a)));while(s<t.sym_next);Hr(t,Sh,e)},Mh=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c=-1,l;for(t.heap_len=0,t.heap_max=Pp,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)Lh(t,n,o);l=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Lh(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[l*2]=n[o*2]+n[a*2],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=l,t.heap[1]=l++,Lh(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Mv(t,e),Yp(n,c,t.bl_count)},Jp=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)&&(a<l?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[Bp*2]++):a<=10?t.bl_tree[Dp*2]++:t.bl_tree[$p*2]++,a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},Qp=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)){if(a<l)do Hr(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Hr(t,s,t.bl_tree),a--),Hr(t,Bp,t.bl_tree),Mn(t,a-3,2)):a<=10?(Hr(t,Dp,t.bl_tree),Mn(t,a-3,3)):(Hr(t,$p,t.bl_tree),Mn(t,a-11,7));a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},Fv=t=>{let e;for(Jp(t,t.dyn_ltree,t.l_desc.max_code),Jp(t,t.dyn_dtree,t.d_desc.max_code),Mh(t,t.bl_desc),e=Ah-1;e>=3&&t.bl_tree[jp[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Pv=(t,e,n,r)=>{let i;for(Mn(t,e-257,5),Mn(t,n-1,5),Mn(t,r-4,4),i=0;i<r;i++)Mn(t,t.bl_tree[jp[i]*2+1],3);Qp(t,t.dyn_ltree,e-1),Qp(t,t.dyn_dtree,n-1)},Bv=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return Mp;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Up;for(n=32;n<ba;n++)if(t.dyn_ltree[n*2]!==0)return Up;return Mp};let tm=!1;const Dv=t=>{tm||(Uv(),tm=!0),t.l_desc=new Ch(t.dyn_ltree,zp),t.d_desc=new Ch(t.dyn_dtree,Kp),t.bl_desc=new Ch(t.bl_tree,Hp),t.bi_buf=0,t.bi_valid=0,Vp(t)},em=(t,e,n,r)=>{Mn(t,(Av<<1)+(r?1:0),3),Zp(t),ka(t,n),ka(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},$v=t=>{Mn(t,Fp<<1,3),Hr(t,Sh,bi),Lv(t)},jv=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===Tv&&(t.strm.data_type=Bv(t)),Mh(t,t.l_desc),Mh(t,t.d_desc),o=Fv(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?em(t,e,n,r):t.strategy===kv||s===i?(Mn(t,(Fp<<1)+(r?1:0),3),qp(t,bi,xa)):(Mn(t,(Rv<<1)+(r?1:0),3),Pv(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),qp(t,t.dyn_ltree,t.dyn_dtree)),Vp(t),r&&Zp(t)},zv=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(va[n]+ba+1)*2]++,t.dyn_dtree[Wp(e)*2]++),t.sym_next===t.sym_end);var Kv=Dv,Hv=em,Wv=jv,Gv=zv,Yv=$v,Vv={_tr_init:Kv,_tr_stored_block:Hv,_tr_flush_block:Wv,_tr_tally:Gv,_tr_align:Yv},Ta=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const Zv=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},Xv=new Uint32Array(Zv());var rn=(t,e,n,r)=>{const i=Xv,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1},As={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Rs={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:qv,_tr_stored_block:Uh,_tr_flush_block:Jv,_tr_tally:Hi,_tr_align:Qv}=Vv,{Z_NO_FLUSH:Wi,Z_PARTIAL_FLUSH:tk,Z_FULL_FLUSH:ek,Z_FINISH:dr,Z_BLOCK:nm,Z_OK:fn,Z_STREAM_END:rm,Z_STREAM_ERROR:Wr,Z_DATA_ERROR:nk,Z_BUF_ERROR:Fh,Z_DEFAULT_COMPRESSION:rk,Z_FILTERED:ik,Z_HUFFMAN_ONLY:Vc,Z_RLE:sk,Z_FIXED:ok,Z_DEFAULT_STRATEGY:ak,Z_UNKNOWN:ck,Z_DEFLATED:Zc}=Rs,lk=9,uk=15,hk=8,Ph=256+1+29,fk=30,dk=19,pk=2*Ph+1,mk=15,Vt=3,Gi=258,Gr=Gi+Vt+1,gk=32,uo=42,Bh=57,Dh=69,$h=73,jh=91,zh=103,Ss=113,Aa=666,Tn=1,ho=2,Os=3,fo=4,_k=3,Is=(t,e)=>(t.msg=As[e],e),im=t=>t*2-(t>4?9:0),Yi=t=>{let e=t.length;for(;--e>=0;)t[e]=0},yk=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let Vi=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const qn=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Jn=(t,e)=>{Jv(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,qn(t.strm)},ie=(t,e)=>{t.pending_buf[t.pending++]=e},Ra=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},Kh=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=Ta(t.adler,e,i,n):t.state.wrap===2&&(t.adler=rn(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},sm=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-Gr?t.strstart-(t.w_size-Gr):0,l=t.window,u=t.w_mask,f=t.prev,d=t.strstart+Gi;let h=l[r+o-1],p=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(l[i+o]!==p||l[i+o-1]!==h||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<d);if(s=Gi-(d-r),r=d-Gi,s>o){if(t.match_start=e,o=s,s>=a)break;h=l[r+o-1],p=l[r+o]}}while((e=f[e&u])>c&&--n!==0);return o<=t.lookahead?o:t.lookahead},po=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Gr)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),yk(t),r+=e),t.strm.avail_in===0)break;if(n=Kh(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=Vt)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Vi(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Vi(t,t.ins_h,t.window[i+Vt-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<Vt)););}while(t.lookahead<Gr&&t.strm.avail_in!==0)},om=(t,e)=>{let n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,s,o=0,a=t.strm.avail_in;do{if(r=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>s&&(r=s),r<n&&(r===0&&e!==dr||e===Wi||r!==i+t.strm.avail_in)))break;o=e===dr&&r===i+t.strm.avail_in?1:0,Uh(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,qn(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(Kh(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?fo:e!==Wi&&e!==dr&&t.strm.avail_in===0&&t.strstart===t.block_start?ho:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(Kh(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,n=s>t.w_size?t.w_size:s,i=t.strstart-t.block_start,(i>=n||(i||e===dr)&&e!==Wi&&t.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,o=e===dr&&t.strm.avail_in===0&&r===i?1:0,Uh(t,t.block_start,r,o),t.block_start+=r,qn(t.strm)),o?Os:Tn)},Hh=(t,e)=>{let n,r;for(;;){if(t.lookahead<Gr){if(po(t),t.lookahead<Gr&&e===Wi)return Tn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Vt&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Vt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Gr&&(t.match_length=sm(t,n)),t.match_length>=Vt)if(r=Hi(t,t.strstart-t.match_start,t.match_length-Vt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Vt){t.match_length--;do t.strstart++,t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Vt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+1]);else r=Hi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=t.strstart<Vt-1?t.strstart:Vt-1,e===dr?(Jn(t,!0),t.strm.avail_out===0?Os:fo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:ho},mo=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Gr){if(po(t),t.lookahead<Gr&&e===Wi)return Tn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Vt&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Vt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Vt-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Gr&&(t.match_length=sm(t,n),t.match_length<=5&&(t.strategy===ik||t.match_length===Vt&&t.strstart-t.match_start>4096)&&(t.match_length=Vt-1)),t.prev_length>=Vt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Vt,r=Hi(t,t.strstart-1-t.prev_match,t.prev_length-Vt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Vt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Vt-1,t.strstart++,r&&(Jn(t,!1),t.strm.avail_out===0))return Tn}else if(t.match_available){if(r=Hi(t,0,t.window[t.strstart-1]),r&&Jn(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Tn}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Hi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Vt-1?t.strstart:Vt-1,e===dr?(Jn(t,!0),t.strm.avail_out===0?Os:fo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:ho},bk=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=Gi){if(po(t),t.lookahead<=Gi&&e===Wi)return Tn;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Vt&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Gi;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Gi-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Vt?(n=Hi(t,1,t.match_length-Vt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Hi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=0,e===dr?(Jn(t,!0),t.strm.avail_out===0?Os:fo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:ho},wk=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(po(t),t.lookahead===0)){if(e===Wi)return Tn;break}if(t.match_length=0,n=Hi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=0,e===dr?(Jn(t,!0),t.strm.avail_out===0?Os:fo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:ho};function Yr(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const Sa=[new Yr(0,0,0,0,om),new Yr(4,4,8,4,Hh),new Yr(4,5,16,8,Hh),new Yr(4,6,32,32,Hh),new Yr(4,4,16,16,mo),new Yr(8,16,32,32,mo),new Yr(8,16,128,128,mo),new Yr(8,32,128,256,mo),new Yr(32,128,258,1024,mo),new Yr(32,258,258,4096,mo)],xk=t=>{t.window_size=2*t.w_size,Yi(t.head),t.max_lazy_match=Sa[t.level].max_lazy,t.good_match=Sa[t.level].good_length,t.nice_match=Sa[t.level].nice_length,t.max_chain_length=Sa[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Vt-1,t.match_available=0,t.ins_h=0};function Ek(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Zc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(pk*2),this.dyn_dtree=new Uint16Array((2*fk+1)*2),this.bl_tree=new Uint16Array((2*dk+1)*2),Yi(this.dyn_ltree),Yi(this.dyn_dtree),Yi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(mk+1),this.heap=new Uint16Array(2*Ph+1),Yi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ph+1),Yi(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Oa=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==uo&&e.status!==Bh&&e.status!==Dh&&e.status!==$h&&e.status!==jh&&e.status!==zh&&e.status!==Ss&&e.status!==Aa?1:0},am=t=>{if(Oa(t))return Is(t,Wr);t.total_in=t.total_out=0,t.data_type=ck;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Bh:e.wrap?uo:Ss,t.adler=e.wrap===2?0:1,e.last_flush=-2,qv(e),fn},cm=t=>{const e=am(t);return e===fn&&xk(t.state),e},vk=(t,e)=>Oa(t)||t.state.wrap!==2?Wr:(t.state.gzhead=e,fn),lm=(t,e,n,r,i,s)=>{if(!t)return Wr;let o=1;if(e===rk&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>lk||n!==Zc||r<8||r>15||e<0||e>9||s<0||s>ok||r===8&&o!==1)return Is(t,Wr);r===8&&(r=9);const a=new Ek;return t.state=a,a.strm=t,a.status=uo,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Vt-1)/Vt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=n,cm(t)},kk=(t,e)=>lm(t,e,Zc,uk,hk,ak),Tk=(t,e)=>{if(Oa(t)||e>nm||e<0)return t?Is(t,Wr):Wr;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Aa&&e!==dr)return Is(t,t.avail_out===0?Fh:Wr);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(qn(t),t.avail_out===0)return n.last_flush=-1,fn}else if(t.avail_in===0&&im(e)<=im(r)&&e!==dr)return Is(t,Fh);if(n.status===Aa&&t.avail_in!==0)return Is(t,Fh);if(n.status===uo&&n.wrap===0&&(n.status=Ss),n.status===uo){let i=Zc+(n.w_bits-8<<4)<<8,s=-1;if(n.strategy>=Vc||n.level<2?s=0:n.level<6?s=1:n.level===6?s=2:s=3,i|=s<<6,n.strstart!==0&&(i|=gk),i+=31-i%31,Ra(n,i),n.strstart!==0&&(Ra(n,t.adler>>>16),Ra(n,t.adler&65535)),t.adler=1,n.status=Ss,qn(t),n.pending!==0)return n.last_flush=-1,fn}if(n.status===Bh){if(t.adler=0,ie(n,31),ie(n,139),ie(n,8),n.gzhead)ie(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ie(n,n.gzhead.time&255),ie(n,n.gzhead.time>>8&255),ie(n,n.gzhead.time>>16&255),ie(n,n.gzhead.time>>24&255),ie(n,n.level===9?2:n.strategy>=Vc||n.level<2?4:0),ie(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(ie(n,n.gzhead.extra.length&255),ie(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=rn(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Dh;else if(ie(n,0),ie(n,0),ie(n,0),ie(n,0),ie(n,0),ie(n,n.level===9?2:n.strategy>=Vc||n.level<2?4:0),ie(n,_k),n.status=Ss,qn(t),n.pending!==0)return n.last_flush=-1,fn}if(n.status===Dh){if(n.gzhead.extra){let i=n.pending,s=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,qn(t),n.pending!==0)return n.last_flush=-1,fn;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=$h}if(n.status===$h){if(n.gzhead.name){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),qn(t),n.pending!==0)return n.last_flush=-1,fn;i=0}n.gzindex<n.gzhead.name.length?s=n.gzhead.name.charCodeAt(n.gzindex++)&255:s=0,ie(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=jh}if(n.status===jh){if(n.gzhead.comment){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),qn(t),n.pending!==0)return n.last_flush=-1,fn;i=0}n.gzindex<n.gzhead.comment.length?s=n.gzhead.comment.charCodeAt(n.gzindex++)&255:s=0,ie(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i))}n.status=zh}if(n.status===zh){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(qn(t),n.pending!==0))return n.last_flush=-1,fn;ie(n,t.adler&255),ie(n,t.adler>>8&255),t.adler=0}if(n.status=Ss,qn(t),n.pending!==0)return n.last_flush=-1,fn}if(t.avail_in!==0||n.lookahead!==0||e!==Wi&&n.status!==Aa){let i=n.level===0?om(n,e):n.strategy===Vc?wk(n,e):n.strategy===sk?bk(n,e):Sa[n.level].func(n,e);if((i===Os||i===fo)&&(n.status=Aa),i===Tn||i===Os)return t.avail_out===0&&(n.last_flush=-1),fn;if(i===ho&&(e===tk?Qv(n):e!==nm&&(Uh(n,0,0,!1),e===ek&&(Yi(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),qn(t),t.avail_out===0))return n.last_flush=-1,fn}return e!==dr?fn:n.wrap<=0?rm:(n.wrap===2?(ie(n,t.adler&255),ie(n,t.adler>>8&255),ie(n,t.adler>>16&255),ie(n,t.adler>>24&255),ie(n,t.total_in&255),ie(n,t.total_in>>8&255),ie(n,t.total_in>>16&255),ie(n,t.total_in>>24&255)):(Ra(n,t.adler>>>16),Ra(n,t.adler&65535)),qn(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?fn:rm)},Ak=t=>{if(Oa(t))return Wr;const e=t.state.status;return t.state=null,e===Ss?Is(t,nk):fn},Rk=(t,e)=>{let n=e.length;if(Oa(t))return Wr;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==uo||r.lookahead)return Wr;if(i===1&&(t.adler=Ta(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Yi(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,po(r);r.lookahead>=Vt;){let c=r.strstart,l=r.lookahead-(Vt-1);do r.ins_h=Vi(r,r.ins_h,r.window[c+Vt-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=Vt-1,po(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Vt-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,fn};var Sk=kk,Ok=lm,Ik=cm,Nk=am,Ck=vk,Lk=Tk,Mk=Ak,Uk=Rk,Fk="pako deflate (from Nodeca project)",Ia={deflateInit:Sk,deflateInit2:Ok,deflateReset:Ik,deflateResetKeep:Nk,deflateSetHeader:Ck,deflate:Lk,deflateEnd:Mk,deflateSetDictionary:Uk,deflateInfo:Fk};const Pk=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Bk=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Pk(n,r)&&(t[r]=n[r])}}return t},Dk=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n},Xc={assign:Bk,flattenChunks:Dk};let um=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{um=!1}const Na=new Uint8Array(256);for(let t=0;t<256;t++)Na[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Na[254]=Na[254]=1;var $k=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const jk=(t,e)=>{if(e<65534&&t.subarray&&um)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var zk=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=Na[o];if(a>4){s[i++]=65533,r+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|t[r++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return jk(s,i)},Kk=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+Na[t[n]]>e?n:e},Ca={string2buf:$k,buf2string:zk,utf8border:Kk};function Hk(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var hm=Hk;const fm=Object.prototype.toString,{Z_NO_FLUSH:Wk,Z_SYNC_FLUSH:Gk,Z_FULL_FLUSH:Yk,Z_FINISH:Vk,Z_OK:qc,Z_STREAM_END:Zk,Z_DEFAULT_COMPRESSION:Xk,Z_DEFAULT_STRATEGY:qk,Z_DEFLATED:Jk}=Rs;function La(t){this.options=Xc.assign({level:Xk,method:Jk,chunkSize:16384,windowBits:15,memLevel:8,strategy:qk},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hm,this.strm.avail_out=0;let n=Ia.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==qc)throw new Error(As[n]);if(e.header&&Ia.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=Ca.string2buf(e.dictionary):fm.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=Ia.deflateSetDictionary(this.strm,r),n!==qc)throw new Error(As[n]);this._dict_set=!0}}La.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Vk:Wk,typeof t=="string"?n.input=Ca.string2buf(t):fm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Gk||s===Yk)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=Ia.deflate(n,s),i===Zk)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Ia.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===qc;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0},La.prototype.onData=function(t){this.chunks.push(t)},La.prototype.onEnd=function(t){t===qc&&(this.result=Xc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Wh(t,e){const n=new La(e);if(n.push(t,!0),n.err)throw n.msg||As[n.err];return n.result}function Qk(t,e){return e=e||{},e.raw=!0,Wh(t,e)}function tT(t,e){return e=e||{},e.gzip=!0,Wh(t,e)}var eT=La,nT=Wh,rT=Qk,iT=tT,sT=Rs,oT={Deflate:eT,deflate:nT,deflateRaw:rT,gzip:iT,constants:sT};const Jc=16209,aT=16191;var cT=function(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,y,b,k,T,A,C,R,S,U,I,D;const V=e.state;r=e.next_in,I=e.input,i=r+(e.avail_in-5),s=e.next_out,D=e.output,o=s-(n-e.avail_out),a=s+(e.avail_out-257),c=V.dmax,l=V.wsize,u=V.whave,f=V.wnext,d=V.window,h=V.hold,p=V.bits,m=V.lencode,y=V.distcode,b=(1<<V.lenbits)-1,k=(1<<V.distbits)-1;t:do{p<15&&(h+=I[r++]<<p,p+=8,h+=I[r++]<<p,p+=8),T=m[h&b];e:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A===0)D[s++]=T&65535;else if(A&16){C=T&65535,A&=15,A&&(p<A&&(h+=I[r++]<<p,p+=8),C+=h&(1<<A)-1,h>>>=A,p-=A),p<15&&(h+=I[r++]<<p,p+=8,h+=I[r++]<<p,p+=8),T=y[h&k];n:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A&16){if(R=T&65535,A&=15,p<A&&(h+=I[r++]<<p,p+=8,p<A&&(h+=I[r++]<<p,p+=8)),R+=h&(1<<A)-1,R>c){e.msg="invalid distance too far back",V.mode=Jc;break t}if(h>>>=A,p-=A,A=s-o,R>A){if(A=R-A,A>u&&V.sane){e.msg="invalid distance too far back",V.mode=Jc;break t}if(S=0,U=d,f===0){if(S+=l-A,A<C){C-=A;do D[s++]=d[S++];while(--A);S=s-R,U=D}}else if(f<A){if(S+=l+f-A,A-=f,A<C){C-=A;do D[s++]=d[S++];while(--A);if(S=0,f<C){A=f,C-=A;do D[s++]=d[S++];while(--A);S=s-R,U=D}}}else if(S+=f-A,A<C){C-=A;do D[s++]=d[S++];while(--A);S=s-R,U=D}for(;C>2;)D[s++]=U[S++],D[s++]=U[S++],D[s++]=U[S++],C-=3;C&&(D[s++]=U[S++],C>1&&(D[s++]=U[S++]))}else{S=s-R;do D[s++]=D[S++],D[s++]=D[S++],D[s++]=D[S++],C-=3;while(C>2);C&&(D[s++]=D[S++],C>1&&(D[s++]=D[S++]))}}else if(A&64){e.msg="invalid distance code",V.mode=Jc;break t}else{T=y[(T&65535)+(h&(1<<A)-1)];continue n}break}}else if(A&64)if(A&32){V.mode=aT;break t}else{e.msg="invalid literal/length code",V.mode=Jc;break t}else{T=m[(T&65535)+(h&(1<<A)-1)];continue e}break}}while(r<i&&s<a);C=p>>3,r-=C,p-=C<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<a?257+(a-s):257-(s-a),V.hold=h,V.bits=p};const go=15,dm=852,pm=592,mm=0,Gh=1,gm=2,lT=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),uT=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),hT=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),fT=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ma=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l=0,u=0,f=0,d=0,h=0,p=0,m=0,y=0,b=0,k=0,T,A,C,R,S,U=null,I;const D=new Uint16Array(go+1),V=new Uint16Array(go+1);let L=null,N,x,B;for(l=0;l<=go;l++)D[l]=0;for(u=0;u<r;u++)D[e[n+u]]++;for(h=c,d=go;d>=1&&D[d]===0;d--);if(h>d&&(h=d),d===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(f=1;f<d&&D[f]===0;f++);for(h<f&&(h=f),y=1,l=1;l<=go;l++)if(y<<=1,y-=D[l],y<0)return-1;if(y>0&&(t===mm||d!==1))return-1;for(V[1]=0,l=1;l<go;l++)V[l+1]=V[l]+D[l];for(u=0;u<r;u++)e[n+u]!==0&&(o[V[e[n+u]]++]=u);if(t===mm?(U=L=o,I=20):t===Gh?(U=lT,L=uT,I=257):(U=hT,L=fT,I=0),k=0,u=0,l=f,S=s,p=h,m=0,C=-1,b=1<<h,R=b-1,t===Gh&&b>dm||t===gm&&b>pm)return 1;for(;;){N=l-m,o[u]+1<I?(x=0,B=o[u]):o[u]>=I?(x=L[o[u]-I],B=U[o[u]-I]):(x=96,B=0),T=1<<l-m,A=1<<p,f=A;do A-=T,i[S+(k>>m)+A]=N<<24|x<<16|B|0;while(A!==0);for(T=1<<l-1;k&T;)T>>=1;if(T!==0?(k&=T-1,k+=T):k=0,u++,--D[l]===0){if(l===d)break;l=e[n+o[u]]}if(l>h&&(k&R)!==C){for(m===0&&(m=h),S+=f,p=l-m,y=1<<p;p+m<d&&(y-=D[p+m],!(y<=0));)p++,y<<=1;if(b+=1<<p,t===Gh&&b>dm||t===gm&&b>pm)return 1;C=k&R,i[C]=h<<24|p<<16|S-s|0}}return k!==0&&(i[S+k]=l-m<<24|64<<16|0),a.bits=h,0};const dT=0,_m=1,ym=2,{Z_FINISH:bm,Z_BLOCK:pT,Z_TREES:Qc,Z_OK:Ns,Z_STREAM_END:mT,Z_NEED_DICT:gT,Z_STREAM_ERROR:pr,Z_DATA_ERROR:wm,Z_MEM_ERROR:xm,Z_BUF_ERROR:_T,Z_DEFLATED:Em}=Rs,tl=16180,vm=16181,km=16182,Tm=16183,Am=16184,Rm=16185,Sm=16186,Om=16187,Im=16188,Nm=16189,el=16190,wi=16191,Yh=16192,Cm=16193,Vh=16194,Lm=16195,Mm=16196,Um=16197,Fm=16198,nl=16199,rl=16200,Pm=16201,Bm=16202,Dm=16203,$m=16204,jm=16205,Zh=16206,zm=16207,Km=16208,ve=16209,Hm=16210,Wm=16211,yT=852,bT=592,wT=15,Gm=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function xT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Cs=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<tl||e.mode>Wm?1:0},Ym=t=>{if(Cs(t))return pr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=tl,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(yT),e.distcode=e.distdyn=new Int32Array(bT),e.sane=1,e.back=-1,Ns},Vm=t=>{if(Cs(t))return pr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Ym(t)},Zm=(t,e)=>{let n;if(Cs(t))return pr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?pr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Vm(t))},Xm=(t,e)=>{if(!t)return pr;const n=new xT;t.state=n,n.strm=t,n.window=null,n.mode=tl;const r=Zm(t,e);return r!==Ns&&(t.state=null),r},ET=t=>Xm(t,wT);let qm=!0,Xh,qh;const vT=t=>{if(qm){Xh=new Int32Array(512),qh=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Ma(_m,t.lens,0,288,Xh,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Ma(ym,t.lens,0,32,qh,0,t.work,{bits:5}),qm=!1}t.lencode=Xh,t.lenbits=9,t.distcode=qh,t.distbits=5},Jm=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},kT=(t,e)=>{let n,r,i,s,o,a,c,l,u,f,d,h,p,m,y=0,b,k,T,A,C,R,S,U;const I=new Uint8Array(4);let D,V;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Cs(t)||!t.output||!t.input&&t.avail_in!==0)return pr;n=t.state,n.mode===wi&&(n.mode=Yh),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,f=a,d=c,U=Ns;t:for(;;)switch(n.mode){case tl:if(n.wrap===0){n.mode=Yh;break}for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,I[0]=l&255,I[1]=l>>>8&255,n.check=rn(n.check,I,2,0),l=0,u=0,n.mode=vm;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=ve;break}if((l&15)!==Em){t.msg="unknown compression method",n.mode=ve;break}if(l>>>=4,u-=4,S=(l&15)+8,n.wbits===0&&(n.wbits=S),S>15||S>n.wbits){t.msg="invalid window size",n.mode=ve;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=l&512?Nm:wi,l=0,u=0;break;case vm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==Em){t.msg="unknown compression method",n.mode=ve;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=ve;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=rn(n.check,I,2,0)),l=0,u=0,n.mode=km;case km:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,I[2]=l>>>16&255,I[3]=l>>>24&255,n.check=rn(n.check,I,4,0)),l=0,u=0,n.mode=Tm;case Tm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=rn(n.check,I,2,0)),l=0,u=0,n.mode=Am;case Am:if(n.flags&1024){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=rn(n.check,I,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=Rm;case Rm:if(n.flags&1024&&(h=n.length,h>a&&(h=a),h&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+h),S)),n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,n.length-=h),n.length))break t;n.length=0,n.mode=Sm;case Sm:if(n.flags&2048){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=Om;case Om:if(n.flags&4096){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.comment=null);n.mode=Im;case Im:if(n.flags&512){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=ve;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=wi;break;case Nm:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=Gm(l),l=0,u=0,n.mode=el;case el:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,gT;t.adler=n.check=1,n.mode=wi;case wi:if(e===pT||e===Qc)break t;case Yh:if(n.last){l>>>=u&7,u-=u&7,n.mode=Zh;break}for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}switch(n.last=l&1,l>>>=1,u-=1,l&3){case 0:n.mode=Cm;break;case 1:if(vT(n),n.mode=nl,e===Qc){l>>>=2,u-=2;break t}break;case 2:n.mode=Mm;break;case 3:t.msg="invalid block type",n.mode=ve}l>>>=2,u-=2;break;case Cm:for(l>>>=u&7,u-=u&7;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=ve;break}if(n.length=l&65535,l=0,u=0,n.mode=Vh,e===Qc)break t;case Vh:n.mode=Lm;case Lm:if(h=n.length,h){if(h>a&&(h=a),h>c&&(h=c),h===0)break t;i.set(r.subarray(s,s+h),o),a-=h,s+=h,c-=h,o+=h,n.length-=h;break}n.mode=wi;break;case Mm:for(;u<14;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=ve;break}n.have=0,n.mode=Um;case Um:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.lens[L[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,D={bits:n.lenbits},U=Ma(dT,n.lens,0,19,n.lencode,0,n.work,D),n.lenbits=D.bits,U){t.msg="invalid code lengths set",n.mode=ve;break}n.have=0,n.mode=Fm;case Fm:for(;n.have<n.nlen+n.ndist;){for(;y=n.lencode[l&(1<<n.lenbits)-1],b=y>>>24,k=y>>>16&255,T=y&65535,!(b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(T<16)l>>>=b,u-=b,n.lens[n.have++]=T;else{if(T===16){for(V=b+2;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(l>>>=b,u-=b,n.have===0){t.msg="invalid bit length repeat",n.mode=ve;break}S=n.lens[n.have-1],h=3+(l&3),l>>>=2,u-=2}else if(T===17){for(V=b+3;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=b,u-=b,S=0,h=3+(l&7),l>>>=3,u-=3}else{for(V=b+7;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=b,u-=b,S=0,h=11+(l&127),l>>>=7,u-=7}if(n.have+h>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=ve;break}for(;h--;)n.lens[n.have++]=S}}if(n.mode===ve)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=ve;break}if(n.lenbits=9,D={bits:n.lenbits},U=Ma(_m,n.lens,0,n.nlen,n.lencode,0,n.work,D),n.lenbits=D.bits,U){t.msg="invalid literal/lengths set",n.mode=ve;break}if(n.distbits=6,n.distcode=n.distdyn,D={bits:n.distbits},U=Ma(ym,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D),n.distbits=D.bits,U){t.msg="invalid distances set",n.mode=ve;break}if(n.mode=nl,e===Qc)break t;case nl:n.mode=rl;case rl:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,cT(t,d),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===wi&&(n.back=-1);break}for(n.back=0;y=n.lencode[l&(1<<n.lenbits)-1],b=y>>>24,k=y>>>16&255,T=y&65535,!(b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(k&&!(k&240)){for(A=b,C=k,R=T;y=n.lencode[R+((l&(1<<A+C)-1)>>A)],b=y>>>24,k=y>>>16&255,T=y&65535,!(A+b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=b,u-=b,n.back+=b,n.length=T,k===0){n.mode=jm;break}if(k&32){n.back=-1,n.mode=wi;break}if(k&64){t.msg="invalid literal/length code",n.mode=ve;break}n.extra=k&15,n.mode=Pm;case Pm:if(n.extra){for(V=n.extra;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=Bm;case Bm:for(;y=n.distcode[l&(1<<n.distbits)-1],b=y>>>24,k=y>>>16&255,T=y&65535,!(b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(!(k&240)){for(A=b,C=k,R=T;y=n.distcode[R+((l&(1<<A+C)-1)>>A)],b=y>>>24,k=y>>>16&255,T=y&65535,!(A+b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=b,u-=b,n.back+=b,k&64){t.msg="invalid distance code",n.mode=ve;break}n.offset=T,n.extra=k&15,n.mode=Dm;case Dm:if(n.extra){for(V=n.extra;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=ve;break}n.mode=$m;case $m:if(c===0)break t;if(h=d-c,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=ve;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=i,p=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do i[o++]=m[p++];while(--h);n.length===0&&(n.mode=rl);break;case jm:if(c===0)break t;i[o++]=n.length,c--,n.mode=rl;break;case Zh:if(n.wrap){for(;u<32;){if(a===0)break t;a--,l|=r[s++]<<u,u+=8}if(d-=c,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?rn(n.check,i,d,o-d):Ta(n.check,i,d,o-d)),d=c,n.wrap&4&&(n.flags?l:Gm(l))!==n.check){t.msg="incorrect data check",n.mode=ve;break}l=0,u=0}n.mode=zm;case zm:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=ve;break}l=0,u=0}n.mode=Km;case Km:U=mT;break t;case ve:U=wm;break t;case Hm:return xm;case Wm:default:return pr}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<ve&&(n.mode<Zh||e!==bm))&&Jm(t,t.output,t.next_out,d-t.avail_out),f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?rn(n.check,i,d,t.next_out-d):Ta(n.check,i,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===wi?128:0)+(n.mode===nl||n.mode===Vh?256:0),(f===0&&d===0||e===bm)&&U===Ns&&(U=_T),U},TT=t=>{if(Cs(t))return pr;let e=t.state;return e.window&&(e.window=null),t.state=null,Ns},AT=(t,e)=>{if(Cs(t))return pr;const n=t.state;return n.wrap&2?(n.head=e,e.done=!1,Ns):pr},RT=(t,e)=>{const n=e.length;let r,i,s;return Cs(t)||(r=t.state,r.wrap!==0&&r.mode!==el)?pr:r.mode===el&&(i=1,i=Ta(i,e,n,0),i!==r.check)?wm:(s=Jm(t,e,n,n),s?(r.mode=Hm,xm):(r.havedict=1,Ns))};var ST=Vm,OT=Zm,IT=Ym,NT=ET,CT=Xm,LT=kT,MT=TT,UT=AT,FT=RT,PT="pako inflate (from Nodeca project)",xi={inflateReset:ST,inflateReset2:OT,inflateResetKeep:IT,inflateInit:NT,inflateInit2:CT,inflate:LT,inflateEnd:MT,inflateGetHeader:UT,inflateSetDictionary:FT,inflateInfo:PT};function BT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var DT=BT;const Qm=Object.prototype.toString,{Z_NO_FLUSH:$T,Z_FINISH:jT,Z_OK:Ua,Z_STREAM_END:Jh,Z_NEED_DICT:Qh,Z_STREAM_ERROR:zT,Z_DATA_ERROR:tg,Z_MEM_ERROR:KT}=Rs;function Fa(t){this.options=Xc.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hm,this.strm.avail_out=0;let n=xi.inflateInit2(this.strm,e.windowBits);if(n!==Ua)throw new Error(As[n]);if(this.header=new DT,xi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ca.string2buf(e.dictionary):Qm.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=xi.inflateSetDictionary(this.strm,e.dictionary),n!==Ua)))throw new Error(As[n])}Fa.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?jT:$T,Qm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=xi.inflate(n,o),s===Qh&&i&&(s=xi.inflateSetDictionary(n,i),s===Ua?s=xi.inflate(n,o):s===tg&&(s=Qh));n.avail_in>0&&s===Jh&&n.state.wrap>0&&t[n.next_in]!==0;)xi.inflateReset(n),s=xi.inflate(n,o);switch(s){case zT:case tg:case Qh:case KT:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===Jh))if(this.options.to==="string"){let c=Ca.utf8border(n.output,n.next_out),l=n.next_out-c,u=Ca.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===Ua&&a===0)){if(s===Jh)return s=xi.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Fa.prototype.onData=function(t){this.chunks.push(t)},Fa.prototype.onEnd=function(t){t===Ua&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Xc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function tf(t,e){const n=new Fa(e);if(n.push(t),n.err)throw n.msg||As[n.err];return n.result}function HT(t,e){return e=e||{},e.raw=!0,tf(t,e)}var WT=Fa,GT=tf,YT=HT,VT=tf,ZT=Rs,XT={Inflate:WT,inflate:GT,inflateRaw:YT,ungzip:VT,constants:ZT};const{Deflate:qT,deflate:JT,deflateRaw:QT,gzip:tA}=oT,{Inflate:eA,inflate:nA,inflateRaw:rA,ungzip:iA}=XT;var sA=qT,oA=JT,aA=QT,cA=tA,lA=eA,uA=nA,hA=rA,fA=iA,dA=Rs,pA={Deflate:sA,deflate:oA,deflateRaw:aA,gzip:cA,Inflate:lA,inflate:uA,inflateRaw:hA,ungzip:fA,constants:dA};function eg(t){let e=t.r.toString(16),n=t.g.toString(16),r=t.b.toString(16);return e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),e+n+r}const mA=t=>new Promise((e,n)=>{try{const r=pA.inflate(t),i=gA(r);e(i)}catch(r){n(r)}}),gA=t=>{const e=new DataView(t.buffer),n={version:e.getUint32(0,!0),layers:[]},r=e.getUint32(4,!0);let i=8;for(let s=0;s<r;s++){const o={width:0,height:0,raster:[]};o.width=e.getUint32(i,!0),i+=4,o.height=e.getUint32(i,!0),i+=4,o.raster=Array(o.height*o.width);for(let a=0;a<o.width;a++)for(let c=0;c<o.height;c++){const l={asciiCode:e.getUint32(i,!0),transparent:!1,color:{r:0,g:0,b:0,hex:""},bg:{r:0,g:0,b:0,hex:""}};i+=4,l.color.r=e.getUint8(i++),l.color.g=e.getUint8(i++),l.color.b=e.getUint8(i++),l.color.hex=eg(l.color),l.bg.r=e.getUint8(i++),l.bg.g=e.getUint8(i++),l.bg.b=e.getUint8(i++),l.bg.hex=eg(l.bg),l.transparent=l.bg.r===255&&l.bg.g===0&&l.bg.b===255,o.raster[a+o.width*c]=l}n.layers.push(o)}return n};function _A(t){return typeof t=="object"&&wt(t.session)&&wt(t.player)&&wt(t.id)&&wt(t.sender)&&wt(t.target)}function ue(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function yA(t,e,...n){return t.emit(e,"info",n),!0}function he(t,e,...n){return t.emit(e,"log",n),!0}function bA(t,e,n){t.emit(e,"toast",n)}function wA(t,e,n){t.emit(e,"bridge:streamstart",n)}function xA(t,e){t.emit(e,"bridge:streamstop",void 0)}function EA(t,e,n){t.emit(e,"bridge:chatstart",n)}function vA(t,e){t.emit(e,"bridge:chatstop")}function kA(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function TA(t,e){t.emit(e,"bridge:talkstart",e)}function AA(t,e){t.emit(e,"bridge:talkstop",e)}function RA(t,e){t.emit(e,"bridge:mediastart",e)}function SA(t,e){t.emit(e,"bridge:mediastop",e)}function OA(t,e,n){t.emit(e,"bridge:start",n)}function IA(t,e,n){t.emit(e,"bridge:tab",n)}function NA(t,e,n){t.emit(e,"gadgetclient:paint",n)}function CA(t,e,n){t.emit(e,"gadgetclient:patch",n)}function LA(t,e){t.emit(e,"gadgetserver:clearscroll")}function MA(t){t.emit("","ready")}function ng(t,e){t.emit(e,"register:loginfail")}function ef(t,e){t.emit(e,"register:loginready",!0)}function UA(t,e,n,r){t.emit(e,"register:savemem",[n,r])}function FA(t,e,n){t.emit(e,"register:forkmem",[n])}function nf(t,e,n){t.emit(e,"register:copy",n)}function PA(t,e,n,r){t.emit(e,"register:copyjsonfile",[n,r])}function rg(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function BA(t,e){t.emit(e,"register:dev",void 0)}function DA(t,e){t.emit(e,"register:share",void 0)}function $A(t,e){t.emit(e,"register:nuke",void 0)}function jA(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function zA(t,e,n){t.emit(e,"synth:tta",[n])}function KA(t,e,n,r,i){t.emit(e,"synth:play",[n,r,i])}function HA(t,e,n){t.emit(e,"synth:focus",n)}function WA(t,e,n){t.emit(e,"synth:bpm",n)}function GA(t,e,n){t.emit(e,"synth:playvolume",n)}function YA(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function VA(t,e,n){t.emit(e,"synth:ttsvolume",n)}function rf(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function ig(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function ZA(t,e,n,r){t.emit(e,"register:config",[n,r])}function XA(t,e){t.emit(e,"register:configshow")}function qA(t,e){t.emit(e,"register:inspector")}function sg(t,e,n,r,i,s){t.emit(e,"register:editor:open",[n,r,i,s])}function JA(t,e){t.emit(e,"vm:local")}function og(t,e){t.emit(e,"vm:logout")}function il(t,e){const[n,r]=e;return`${t}:${[n,r].filter(E).join(":")}`}function QA(t,e,n){t.emit(e,"vm:cli",n)}function tR(t,e){t.emit(e,"vm:restart")}function ag(t,e){t.emit(e,"vm:flush")}function eR(t,e){t.emit(e,"vm:fork")}function nR(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function rR(t,e){return{filename:t,json:e}}function iR(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function sR(t,e){const n={filename:t,cursor:0,content:void 0};return mA(e).then(r=>{n.content=r}).catch(()=>{}),n}function Pa(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=nR(i,s);break;case"json":o=rR(i,s);break;case"binary":o=iR(i,s);break;case"rexpaint":o=sR(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}function oR(t){const e=new Set;function n(s){_A(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Vn.invoke(s))}const r=ao("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Vn.disconnect(r)}return{forward:n,disconnect:i}}function aR(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=Xn(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const sf=66.666,sl=Math.round(1e3/sf),cR=3;function cg(t){return new Promise(e=>setTimeout(e,t))}const of=ao("clock");let af=0,ol=0,cf=0,lg=performance.now();function ug(){const t=performance.now(),e=t-lg;cf+=e,cf>=sf&&(cf%=sf,of.emit("","tick",ol),of.emit("","tock",ol),++af,++ol,af>=sl&&(af%=sl,of.emit("","second",ol))),lg=t,setTimeout(ug,2)}ug();function lR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hg={exports:{}},De=hg.exports={},Vr,Zr;function lf(){throw new Error("setTimeout has not been defined")}function uf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Vr=setTimeout:Vr=lf}catch{Vr=lf}try{typeof clearTimeout=="function"?Zr=clearTimeout:Zr=uf}catch{Zr=uf}})();function fg(t){if(Vr===setTimeout)return setTimeout(t,0);if((Vr===lf||!Vr)&&setTimeout)return Vr=setTimeout,setTimeout(t,0);try{return Vr(t,0)}catch{try{return Vr.call(null,t,0)}catch{return Vr.call(this,t,0)}}}function uR(t){if(Zr===clearTimeout)return clearTimeout(t);if((Zr===uf||!Zr)&&clearTimeout)return Zr=clearTimeout,clearTimeout(t);try{return Zr(t)}catch{try{return Zr.call(null,t)}catch{return Zr.call(this,t)}}}var Ei=[],_o=!1,Ls,al=-1;function hR(){!_o||!Ls||(_o=!1,Ls.length?Ei=Ls.concat(Ei):al=-1,Ei.length&&dg())}function dg(){if(!_o){var t=fg(hR);_o=!0;for(var e=Ei.length;e;){for(Ls=Ei,Ei=[];++al<e;)Ls&&Ls[al].run();al=-1,e=Ei.length}Ls=null,_o=!1,uR(t)}}De.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ei.push(new pg(t,e)),Ei.length===1&&!_o&&fg(dg)};function pg(t,e){this.fun=t,this.array=e}pg.prototype.run=function(){this.fun.apply(null,this.array)},De.title="browser",De.browser=!0,De.env={},De.argv=[],De.version="",De.versions={};function vi(){}De.on=vi,De.addListener=vi,De.once=vi,De.off=vi,De.removeListener=vi,De.removeAllListeners=vi,De.emit=vi,De.prependListener=vi,De.prependOnceListener=vi,De.listeners=function(t){return[]},De.binding=function(t){throw new Error("process.binding is not supported")},De.cwd=function(){return"/"},De.chdir=function(t){throw new Error("process.chdir is not supported")},De.umask=function(){return 0};var fR=hg.exports;const Ir=lR(fR);var zt={},hf=Symbol.for("react.transitional.element"),dR=Symbol.for("react.portal"),pR=Symbol.for("react.fragment"),mR=Symbol.for("react.strict_mode"),gR=Symbol.for("react.profiler"),_R=Symbol.for("react.consumer"),yR=Symbol.for("react.context"),bR=Symbol.for("react.forward_ref"),wR=Symbol.for("react.suspense"),xR=Symbol.for("react.memo"),mg=Symbol.for("react.lazy"),gg=Symbol.iterator;function ER(t){return t===null||typeof t!="object"?null:(t=gg&&t[gg]||t["@@iterator"],typeof t=="function"?t:null)}var _g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},yg=Object.assign,bg={};function yo(t,e,n){this.props=t,this.context=e,this.refs=bg,this.updater=n||_g}yo.prototype.isReactComponent={},yo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},yo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function wg(){}wg.prototype=yo.prototype;function ff(t,e,n){this.props=t,this.context=e,this.refs=bg,this.updater=n||_g}var df=ff.prototype=new wg;df.constructor=ff,yg(df,yo.prototype),df.isPureReactComponent=!0;var xg=Array.isArray,ke={H:null,A:null,T:null,S:null,V:null},Eg=Object.prototype.hasOwnProperty;function pf(t,e,n,r,i,s){return n=s.ref,{$$typeof:hf,type:t,key:e,ref:n!==void 0?n:null,props:s}}function vR(t,e){return pf(t.type,e,void 0,void 0,void 0,t.props)}function mf(t){return typeof t=="object"&&t!==null&&t.$$typeof===hf}function kR(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var vg=/\/+/g;function gf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?kR(""+t.key):e.toString(36)}function kg(){}function TR(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(kg,kg):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function bo(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case hf:case dR:o=!0;break;case mg:return o=t._init,bo(o(t._payload),e,n,r,i)}}if(o)return i=i(t),o=r===""?"."+gf(t,0):r,xg(i)?(n="",o!=null&&(n=o.replace(vg,"$&/")+"/"),bo(i,e,n,"",function(l){return l})):i!=null&&(mf(i)&&(i=vR(i,n+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(vg,"$&/")+"/")+o)),e.push(i)),1;o=0;var a=r===""?".":r+":";if(xg(t))for(var c=0;c<t.length;c++)r=t[c],s=a+gf(r,c),o+=bo(r,e,n,s,i);else if(c=ER(t),typeof c=="function")for(t=c.call(t),c=0;!(r=t.next()).done;)r=r.value,s=a+gf(r,c++),o+=bo(r,e,n,s,i);else if(s==="object"){if(typeof t.then=="function")return bo(TR(t),e,n,r,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function cl(t,e,n){if(t==null)return t;var r=[],i=0;return bo(t,r,"","",function(s){return e.call(n,s,i++)}),r}function AR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Tg=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof Ir=="object"&&typeof Ir.emit=="function"){Ir.emit("uncaughtException",t);return}console.error(t)};function RR(){}zt.Children={map:cl,forEach:function(t,e,n){cl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return cl(t,function(){e++}),e},toArray:function(t){return cl(t,function(e){return e})||[]},only:function(t){if(!mf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},zt.Component=yo,zt.Fragment=pR,zt.Profiler=gR,zt.PureComponent=ff,zt.StrictMode=mR,zt.Suspense=wR,zt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ke,zt.__COMPILER_RUNTIME={__proto__:null,c:function(t){return ke.H.useMemoCache(t)}},zt.cache=function(t){return function(){return t.apply(null,arguments)}},zt.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=yg({},t.props),i=t.key,s=void 0;if(e!=null)for(o in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(i=""+e.key),e)!Eg.call(e,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&e.ref===void 0||(r[o]=e[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return pf(t.type,i,void 0,void 0,s,r)},zt.createContext=function(t){return t={$$typeof:yR,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:_R,_context:t},t},zt.createElement=function(t,e,n){var r,i={},s=null;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)Eg.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return pf(t,s,void 0,void 0,null,i)},zt.createRef=function(){return{current:null}},zt.forwardRef=function(t){return{$$typeof:bR,render:t}},zt.isValidElement=mf,zt.lazy=function(t){return{$$typeof:mg,_payload:{_status:-1,_result:t},_init:AR}},zt.memo=function(t,e){return{$$typeof:xR,type:t,compare:e===void 0?null:e}},zt.startTransition=function(t){var e=ke.T,n={};ke.T=n;try{var r=t(),i=ke.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(RR,Tg)}catch(s){Tg(s)}finally{ke.T=e}},zt.unstable_useCacheRefresh=function(){return ke.H.useCacheRefresh()},zt.use=function(t){return ke.H.use(t)},zt.useActionState=function(t,e,n){return ke.H.useActionState(t,e,n)},zt.useCallback=function(t,e){return ke.H.useCallback(t,e)},zt.useContext=function(t){return ke.H.useContext(t)},zt.useDebugValue=function(){},zt.useDeferredValue=function(t,e){return ke.H.useDeferredValue(t,e)},zt.useEffect=function(t,e,n){var r=ke.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)},zt.useId=function(){return ke.H.useId()},zt.useImperativeHandle=function(t,e,n){return ke.H.useImperativeHandle(t,e,n)},zt.useInsertionEffect=function(t,e){return ke.H.useInsertionEffect(t,e)},zt.useLayoutEffect=function(t,e){return ke.H.useLayoutEffect(t,e)},zt.useMemo=function(t,e){return ke.H.useMemo(t,e)},zt.useOptimistic=function(t,e){return ke.H.useOptimistic(t,e)},zt.useReducer=function(t,e,n){return ke.H.useReducer(t,e,n)},zt.useRef=function(t){return ke.H.useRef(t)},zt.useState=function(t){return ke.H.useState(t)},zt.useSyncExternalStore=function(t,e,n){return ke.H.useSyncExternalStore(t,e,n)},zt.useTransition=function(){return ke.H.useTransition()},zt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Ag="0123456789abcdef",Rg=[],ll=[];for(let t=0;t<256;t++)Rg[t]=Ag[t>>4&15]+Ag[t&15],t<16&&(t<10?ll[48+t]=t:ll[87+t]=t);const Sg=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=Rg[t[r++]];return n},ul=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=ll[t.charCodeAt(s++)]<<4|ll[t.charCodeAt(s++)];return r};for(var Og="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",SR=typeof Uint8Array>"u"?[]:new Uint8Array(256),hl=0;hl<Og.length;hl++)SR[Og.charCodeAt(hl)]=hl;new TextDecoder,new TextEncoder;const Ig=typeof window<"u"?window:self,Ng=Ig.crypto||Ig.msCrypto||{};Ng.subtle||Ng.webkitSubtle;const wo=globalThis||void 0||self,Nr=()=>new Map,_f=t=>{const e=Nr();return t.forEach((n,r)=>{e.set(r,n)}),e},Zi=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},OR=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},IR=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},xo=()=>new Set,yf=t=>t[t.length-1],NR=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Ms=Array.from,CR=Array.isArray;class LR{constructor(){this._observers=Nr()}on(e,n){return Zi(this._observers,e,xo).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Ms((this._observers.get(e)||Nr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Nr()}}const Xi=Math.floor,fl=Math.abs,Cg=(t,e)=>t<e?t:e,Us=(t,e)=>t>e?t:e,Lg=t=>t!==0?t<0:1/t<0,Mg=1,Ug=2,bf=4,wf=8,Ba=32,ki=64,Qn=128,dl=31,xf=63,Fs=127,MR=2147483647,Fg=Number.MAX_SAFE_INTEGER,UR=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Xi(t)===t),FR=t=>t.toLowerCase(),PR=/^\s*/g,BR=t=>t.replace(PR,""),DR=/([A-Z])/g,Pg=(t,e)=>BR(t.replace(DR,n=>`${e}${FR(n)}`)),$R=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},Da=typeof TextEncoder<"u"?new TextEncoder:null,jR=Da?t=>Da.encode(t):$R;let $a=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});$a&&$a.decode(new Uint8Array).length===1&&($a=null);class ja{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const pl=()=>new ja,zR=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Xr=t=>{const e=new Uint8Array(zR(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},KR=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Us(n,e)*2),t.cpos=0)},sn=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Ef=sn,te=(t,e)=>{for(;e>Fs;)sn(t,Qn|Fs&e),e=Xi(e/128);sn(t,Fs&e)},vf=(t,e)=>{const n=Lg(e);for(n&&(e=-e),sn(t,(e>xf?Qn:0)|(n?ki:0)|xf&e),e=Xi(e/64);e>0;)sn(t,(e>Fs?Qn:0)|Fs&e),e=Xi(e/128)},kf=new Uint8Array(3e4),HR=kf.length/3,WR=(t,e)=>{if(e.length<HR){const n=Da.encodeInto(e,kf).written||0;te(t,n);for(let r=0;r<n;r++)sn(t,kf[r])}else tr(t,jR(e))},GR=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;te(t,r);for(let i=0;i<r;i++)sn(t,n.codePointAt(i))},Eo=Da&&Da.encodeInto?WR:GR,ml=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Cg(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Us(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},tr=(t,e)=>{te(t,e.byteLength),ml(t,e)},Tf=(t,e)=>{KR(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},YR=(t,e)=>Tf(t,4).setFloat32(0,e,!1),VR=(t,e)=>Tf(t,8).setFloat64(0,e,!1),ZR=(t,e)=>Tf(t,8).setBigInt64(0,e,!1),Bg=new DataView(new ArrayBuffer(4)),XR=t=>(Bg.setFloat32(0,t),Bg.getFloat32(0)===t),za=(t,e)=>{switch(typeof e){case"string":sn(t,119),Eo(t,e);break;case"number":UR(e)&&fl(e)<=MR?(sn(t,125),vf(t,e)):XR(e)?(sn(t,124),YR(t,e)):(sn(t,123),VR(t,e));break;case"bigint":sn(t,122),ZR(t,e);break;case"object":if(e===null)sn(t,126);else if(CR(e)){sn(t,117),te(t,e.length);for(let n=0;n<e.length;n++)za(t,e[n])}else if(e instanceof Uint8Array)sn(t,116),tr(t,e);else{sn(t,118);const n=Object.keys(e);te(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Eo(t,i),za(t,e[i])}}break;case"boolean":sn(t,e?120:121);break;default:sn(t,127)}};class Dg extends ja{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&te(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const $g=t=>{t.count>0&&(vf(t.encoder,t.count===1?t.s:-t.s),t.count>1&&te(t.encoder,t.count-2))};class gl{constructor(){this.encoder=new ja,this.s=0,this.count=0}write(e){this.s===e?this.count++:($g(this),this.count=1,this.s=e)}toUint8Array(){return $g(this),Xr(this.encoder)}}const jg=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);vf(t.encoder,e),t.count>1&&te(t.encoder,t.count-2)}};class Af{constructor(){this.encoder=new ja,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(jg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return jg(this),Xr(this.encoder)}}class qR{constructor(){this.sarr=[],this.s="",this.lensE=new gl}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new ja;return this.sarr.push(this.s),this.s="",Eo(e,this.sarr.join("")),ml(e,this.lensE.toUint8Array()),Xr(e)}}const qi=t=>new Error(t),qr=()=>{throw qi("Method unimplemented")},Jr=()=>{throw qi("Unexpected case")},zg=qi("Unexpected end of array"),Kg=qi("Integer out of Range");class _l{constructor(e){this.arr=e,this.pos=0}}const vo=t=>new _l(t),JR=t=>t.pos!==t.arr.length,QR=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},er=t=>QR(t,Kt(t)),ko=t=>t.arr[t.pos++],Kt=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&Fs)*n,n*=128,i<Qn)return e;if(e>Fg)throw Kg}throw zg},Rf=t=>{let e=t.arr[t.pos++],n=e&xf,r=64;const i=(e&ki)>0?-1:1;if(!(e&Qn))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&Fs)*r,r*=128,e<Qn)return i*n;if(n>Fg)throw Kg}throw zg},To=$a?t=>$a.decode(er(t)):t=>{let e=Kt(t);if(e===0)return"";{let n=String.fromCodePoint(ko(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(ko(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Sf=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},tS=[t=>{},t=>null,Rf,t=>Sf(t,4).getFloat32(0,!1),t=>Sf(t,8).getFloat64(0,!1),t=>Sf(t,8).getBigInt64(0,!1),t=>!1,t=>!0,To,t=>{const e=Kt(t),n={};for(let r=0;r<e;r++){const i=To(t);n[i]=Ka(t)}return n},t=>{const e=Kt(t),n=[];for(let r=0;r<e;r++)n.push(Ka(t));return n},er],Ka=t=>tS[127-ko(t)](t);class Hg extends _l{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),JR(this)?this.count=Kt(this)+1:this.count=-1),this.count--,this.s}}class yl extends _l{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Rf(this);const e=Lg(this.s);this.count=1,e&&(this.s=-this.s,this.count=Kt(this)+2)}return this.count--,this.s}}class Of extends _l{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Rf(this),n=e&1;this.diff=Xi(e/2),this.count=1,n&&(this.count=Kt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class eS{constructor(e){this.decoder=new yl(e),this.str=To(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const nS=crypto.getRandomValues.bind(crypto),Wg=()=>nS(new Uint32Array(1))[0],rS="10000000-1000-4000-8000"+-1e11,iS=()=>rS.replace(/[018]/g,t=>(t^Wg()&15>>t/4).toString(16)),Gg=t=>new Promise(t);Promise.all.bind(Promise);var Yg={},bl={};bl.byteLength=aS,bl.toByteArray=lS,bl.fromByteArray=fS;for(var Qr=[],mr=[],sS=typeof Uint8Array<"u"?Uint8Array:Array,If="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ao=0,oS=If.length;Ao<oS;++Ao)Qr[Ao]=If[Ao],mr[If.charCodeAt(Ao)]=Ao;mr[45]=62,mr[95]=63;function Vg(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function aS(t){var e=Vg(t),n=e[0],r=e[1];return(n+r)*3/4-r}function cS(t,e,n){return(e+n)*3/4-n}function lS(t){var e,n=Vg(t),r=n[0],i=n[1],s=new sS(cS(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=mr[t.charCodeAt(c)]<<18|mr[t.charCodeAt(c+1)]<<12|mr[t.charCodeAt(c+2)]<<6|mr[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=mr[t.charCodeAt(c)]<<2|mr[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=mr[t.charCodeAt(c)]<<10|mr[t.charCodeAt(c+1)]<<4|mr[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function uS(t){return Qr[t>>18&63]+Qr[t>>12&63]+Qr[t>>6&63]+Qr[t&63]}function hS(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(uS(r));return i.join("")}function fS(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(hS(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Qr[e>>2]+Qr[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Qr[e>>10]+Qr[e>>4&63]+Qr[e<<2&63]+"=")),i.join("")}var Nf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Nf.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=t[e+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Nf.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=d/c:e+=d*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=a&255,h+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+h]=o&255,h+=p,o/=256,l-=8);t[n+h-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=bl,n=Nf,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=C,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const O=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(O,g),O.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(O){if(O>i)throw new RangeError('The value "'+O+'" is invalid for option "size"');const g=new s(O);return Object.setPrototypeOf(g,u.prototype),g}function u(O,g,_){if(typeof O=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(O)}return f(O,g,_)}u.poolSize=8192;function f(O,g,_){if(typeof O=="string")return m(O,g);if(o.isView(O))return b(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(pt(O,o)||O&&pt(O.buffer,o)||typeof a<"u"&&(pt(O,a)||O&&pt(O.buffer,a)))return k(O,g,_);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=O.valueOf&&O.valueOf();if(M!=null&&M!==O)return u.from(M,g,_);const j=T(O);if(j)return j;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return u.from(O[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}u.from=function(O,g,_){return f(O,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function h(O,g,_){return d(O),O<=0?l(O):g!==void 0?typeof _=="string"?l(O).fill(g,_):l(O).fill(g):l(O)}u.alloc=function(O,g,_){return h(O,g,_)};function p(O){return d(O),l(O<0?0:A(O)|0)}u.allocUnsafe=function(O){return p(O)},u.allocUnsafeSlow=function(O){return p(O)};function m(O,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=R(O,g)|0;let M=l(_);const j=M.write(O,g);return j!==_&&(M=M.slice(0,j)),M}function y(O){const g=O.length<0?0:A(O.length)|0,_=l(g);for(let M=0;M<g;M+=1)_[M]=O[M]&255;return _}function b(O){if(pt(O,s)){const g=new s(O);return k(g.buffer,g.byteOffset,g.byteLength)}return y(O)}function k(O,g,_){if(g<0||O.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&_===void 0?M=new s(O):_===void 0?M=new s(O,g):M=new s(O,g,_),Object.setPrototypeOf(M,u.prototype),M}function T(O){if(u.isBuffer(O)){const g=A(O.length)|0,_=l(g);return _.length===0||O.copy(_,0,0,g),_}if(O.length!==void 0)return typeof O.length!="number"||Tt(O.length)?l(0):y(O);if(O.type==="Buffer"&&Array.isArray(O.data))return y(O.data)}function A(O){if(O>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return O|0}function C(O){return+O!=O&&(O=0),u.alloc(+O)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(pt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),pt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let M=g.length,j=_.length;for(let Q=0,it=Math.min(M,j);Q<it;++Q)if(g[Q]!==_[Q]){M=g[Q],j=_[Q];break}return M<j?-1:j<M?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let M;if(_===void 0)for(_=0,M=0;M<g.length;++M)_+=g[M].length;const j=u.allocUnsafe(_);let Q=0;for(M=0;M<g.length;++M){let it=g[M];if(pt(it,s))Q+it.length>j.length?(u.isBuffer(it)||(it=u.from(it)),it.copy(j,Q)):s.prototype.set.call(j,it,Q);else if(u.isBuffer(it))it.copy(j,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return j};function R(O,g){if(u.isBuffer(O))return O.length;if(o.isView(O)||pt(O,o))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);const _=O.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&_===0)return 0;let j=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ct(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return mt(O).length;default:if(j)return M?-1:ct(O).length;g=(""+g).toLowerCase(),j=!0}}u.byteLength=R;function S(O,g,_){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(O||(O="utf8");;)switch(O){case"hex":return H(this,g,_);case"utf8":case"utf-8":return $(this,g,_);case"ascii":return at(this,g,_);case"latin1":case"binary":return G(this,g,_);case"base64":return Z(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,g,_);default:if(M)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),M=!0}}u.prototype._isBuffer=!0;function U(O,g,_){const M=O[g];O[g]=O[_],O[_]=M}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)U(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)U(this,_,_+3),U(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)U(this,_,_+7),U(this,_+1,_+6),U(this,_+2,_+5),U(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?$(this,0,g):S.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=t.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,M,j,Q){if(pt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),M===void 0&&(M=g?g.length:0),j===void 0&&(j=0),Q===void 0&&(Q=this.length),_<0||M>g.length||j<0||Q>this.length)throw new RangeError("out of range index");if(j>=Q&&_>=M)return 0;if(j>=Q)return-1;if(_>=M)return 1;if(_>>>=0,M>>>=0,j>>>=0,Q>>>=0,this===g)return 0;let it=Q-j,jt=M-_;const Se=Math.min(it,jt),we=this.slice(j,Q),Oe=g.slice(_,M);for(let ce=0;ce<Se;++ce)if(we[ce]!==Oe[ce]){it=we[ce],jt=Oe[ce];break}return it<jt?-1:jt<it?1:0};function I(O,g,_,M,j){if(O.length===0)return-1;if(typeof _=="string"?(M=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,Tt(_)&&(_=j?0:O.length-1),_<0&&(_=O.length+_),_>=O.length){if(j)return-1;_=O.length-1}else if(_<0)if(j)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,M)),u.isBuffer(g))return g.length===0?-1:D(O,g,_,M,j);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?j?s.prototype.indexOf.call(O,g,_):s.prototype.lastIndexOf.call(O,g,_):D(O,[g],_,M,j);throw new TypeError("val must be string, number or Buffer")}function D(O,g,_,M,j){let Q=1,it=O.length,jt=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(O.length<2||g.length<2)return-1;Q=2,it/=2,jt/=2,_/=2}function Se(Oe,ce){return Q===1?Oe[ce]:Oe.readUInt16BE(ce*Q)}let we;if(j){let Oe=-1;for(we=_;we<it;we++)if(Se(O,we)===Se(g,Oe===-1?0:we-Oe)){if(Oe===-1&&(Oe=we),we-Oe+1===jt)return Oe*Q}else Oe!==-1&&(we-=we-Oe),Oe=-1}else for(_+jt>it&&(_=it-jt),we=_;we>=0;we--){let Oe=!0;for(let ce=0;ce<jt;ce++)if(Se(O,we+ce)!==Se(g,ce)){Oe=!1;break}if(Oe)return we}return-1}u.prototype.includes=function(g,_,M){return this.indexOf(g,_,M)!==-1},u.prototype.indexOf=function(g,_,M){return I(this,g,_,M,!0)},u.prototype.lastIndexOf=function(g,_,M){return I(this,g,_,M,!1)};function V(O,g,_,M){_=Number(_)||0;const j=O.length-_;M?(M=Number(M),M>j&&(M=j)):M=j;const Q=g.length;M>Q/2&&(M=Q/2);let it;for(it=0;it<M;++it){const jt=parseInt(g.substr(it*2,2),16);if(Tt(jt))return it;O[_+it]=jt}return it}function L(O,g,_,M){return xt(ct(g,O.length-_),O,_,M)}function N(O,g,_,M){return xt(ft(g),O,_,M)}function x(O,g,_,M){return xt(mt(g),O,_,M)}function B(O,g,_,M){return xt(J(g,O.length-_),O,_,M)}u.prototype.write=function(g,_,M,j){if(_===void 0)j="utf8",M=this.length,_=0;else if(M===void 0&&typeof _=="string")j=_,M=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(M)?(M=M>>>0,j===void 0&&(j="utf8")):(j=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-_;if((M===void 0||M>Q)&&(M=Q),g.length>0&&(M<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");j||(j="utf8");let it=!1;for(;;)switch(j){case"hex":return V(this,g,_,M);case"utf8":case"utf-8":return L(this,g,_,M);case"ascii":case"latin1":case"binary":return N(this,g,_,M);case"base64":return x(this,g,_,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,g,_,M);default:if(it)throw new TypeError("Unknown encoding: "+j);j=(""+j).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(O,g,_){return g===0&&_===O.length?e.fromByteArray(O):e.fromByteArray(O.slice(g,_))}function $(O,g,_){_=Math.min(O.length,_);const M=[];let j=g;for(;j<_;){const Q=O[j];let it=null,jt=Q>239?4:Q>223?3:Q>191?2:1;if(j+jt<=_){let Se,we,Oe,ce;switch(jt){case 1:Q<128&&(it=Q);break;case 2:Se=O[j+1],(Se&192)===128&&(ce=(Q&31)<<6|Se&63,ce>127&&(it=ce));break;case 3:Se=O[j+1],we=O[j+2],(Se&192)===128&&(we&192)===128&&(ce=(Q&15)<<12|(Se&63)<<6|we&63,ce>2047&&(ce<55296||ce>57343)&&(it=ce));break;case 4:Se=O[j+1],we=O[j+2],Oe=O[j+3],(Se&192)===128&&(we&192)===128&&(Oe&192)===128&&(ce=(Q&15)<<18|(Se&63)<<12|(we&63)<<6|Oe&63,ce>65535&&ce<1114112&&(it=ce))}}it===null?(it=65533,jt=1):it>65535&&(it-=65536,M.push(it>>>10&1023|55296),it=56320|it&1023),M.push(it),j+=jt}return nt(M)}const st=4096;function nt(O){const g=O.length;if(g<=st)return String.fromCharCode.apply(String,O);let _="",M=0;for(;M<g;)_+=String.fromCharCode.apply(String,O.slice(M,M+=st));return _}function at(O,g,_){let M="";_=Math.min(O.length,_);for(let j=g;j<_;++j)M+=String.fromCharCode(O[j]&127);return M}function G(O,g,_){let M="";_=Math.min(O.length,_);for(let j=g;j<_;++j)M+=String.fromCharCode(O[j]);return M}function H(O,g,_){const M=O.length;(!g||g<0)&&(g=0),(!_||_<0||_>M)&&(_=M);let j="";for(let Q=g;Q<_;++Q)j+=le[O[Q]];return j}function bt(O,g,_){const M=O.slice(g,_);let j="";for(let Q=0;Q<M.length-1;Q+=2)j+=String.fromCharCode(M[Q]+M[Q+1]*256);return j}u.prototype.slice=function(g,_){const M=this.length;g=~~g,_=_===void 0?M:~~_,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),_<0?(_+=M,_<0&&(_=0)):_>M&&(_=M),_<g&&(_=g);const j=this.subarray(g,_);return Object.setPrototypeOf(j,u.prototype),j};function lt(O,g,_){if(O%1!==0||O<0)throw new RangeError("offset is not uint");if(O+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||lt(g,_,this.length);let j=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)j+=this[g+it]*Q;return j},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||lt(g,_,this.length);let j=this[g+--_],Q=1;for(;_>0&&(Q*=256);)j+=this[g+--_]*Q;return j},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||lt(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||lt(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||lt(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Pt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&P(g,this.length-8);const j=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(j)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=Pt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&P(g,this.length-8);const j=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(j)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||lt(g,_,this.length);let j=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)j+=this[g+it]*Q;return Q*=128,j>=Q&&(j-=Math.pow(2,8*_)),j},u.prototype.readIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||lt(g,_,this.length);let j=_,Q=1,it=this[g+--j];for(;j>0&&(Q*=256);)it+=this[g+--j]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*_)),it},u.prototype.readInt8=function(g,_){return g=g>>>0,_||lt(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||lt(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||lt(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Pt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&P(g,this.length-8);const j=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(j)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Pt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&P(g,this.length-8);const j=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(j)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||lt(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||lt(g,8,this.length),n.read(this,g,!1,52,8)};function ht(O,g,_,M,j,Q){if(!u.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>j||g<Q)throw new RangeError('"value" argument is out of bounds');if(_+M>O.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,M,j){if(g=+g,_=_>>>0,M=M>>>0,!j){const jt=Math.pow(2,8*M)-1;ht(this,g,_,M,jt,0)}let Q=1,it=0;for(this[_]=g&255;++it<M&&(Q*=256);)this[_+it]=g/Q&255;return _+M},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,M,j){if(g=+g,_=_>>>0,M=M>>>0,!j){const jt=Math.pow(2,8*M)-1;ht(this,g,_,M,jt,0)}let Q=M-1,it=1;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)this[_+Q]=g/it&255;return _+M},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function Dt(O,g,_,M,j){ot(g,M,j,O,_,7);let Q=Number(g&BigInt(4294967295));O[_++]=Q,Q=Q>>8,O[_++]=Q,Q=Q>>8,O[_++]=Q,Q=Q>>8,O[_++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[_++]=it,it=it>>8,O[_++]=it,it=it>>8,O[_++]=it,it=it>>8,O[_++]=it,_}function re(O,g,_,M,j){ot(g,M,j,O,_,7);let Q=Number(g&BigInt(4294967295));O[_+7]=Q,Q=Q>>8,O[_+6]=Q,Q=Q>>8,O[_+5]=Q,Q=Q>>8,O[_+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[_+3]=it,it=it>>8,O[_+2]=it,it=it>>8,O[_+1]=it,it=it>>8,O[_]=it,_+8}u.prototype.writeBigUInt64LE=Pt(function(g,_=0){return Dt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Pt(function(g,_=0){return re(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,M,j){if(g=+g,_=_>>>0,!j){const Se=Math.pow(2,8*M-1);ht(this,g,_,M,Se-1,-Se)}let Q=0,it=1,jt=0;for(this[_]=g&255;++Q<M&&(it*=256);)g<0&&jt===0&&this[_+Q-1]!==0&&(jt=1),this[_+Q]=(g/it>>0)-jt&255;return _+M},u.prototype.writeIntBE=function(g,_,M,j){if(g=+g,_=_>>>0,!j){const Se=Math.pow(2,8*M-1);ht(this,g,_,M,Se-1,-Se)}let Q=M-1,it=1,jt=0;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)g<0&&jt===0&&this[_+Q+1]!==0&&(jt=1),this[_+Q]=(g/it>>0)-jt&255;return _+M},u.prototype.writeInt8=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=Pt(function(g,_=0){return Dt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Pt(function(g,_=0){return re(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ft(O,g,_,M,j,Q){if(_+M>O.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function Mt(O,g,_,M,j){return g=+g,_=_>>>0,j||Ft(O,g,_,4),n.write(O,g,_,M,23,4),_+4}u.prototype.writeFloatLE=function(g,_,M){return Mt(this,g,_,!0,M)},u.prototype.writeFloatBE=function(g,_,M){return Mt(this,g,_,!1,M)};function oe(O,g,_,M,j){return g=+g,_=_>>>0,j||Ft(O,g,_,8),n.write(O,g,_,M,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,M){return oe(this,g,_,!0,M)},u.prototype.writeDoubleBE=function(g,_,M){return oe(this,g,_,!1,M)},u.prototype.copy=function(g,_,M,j){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!j&&j!==0&&(j=this.length),_>=g.length&&(_=g.length),_||(_=0),j>0&&j<M&&(j=M),j===M||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(j<0)throw new RangeError("sourceEnd out of bounds");j>this.length&&(j=this.length),g.length-_<j-M&&(j=g.length-_+M);const Q=j-M;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,M,j):s.prototype.set.call(g,this.subarray(M,j),_),Q},u.prototype.fill=function(g,_,M,j){if(typeof g=="string"){if(typeof _=="string"?(j=_,_=0,M=this.length):typeof M=="string"&&(j=M,M=this.length),j!==void 0&&typeof j!="string")throw new TypeError("encoding must be a string");if(typeof j=="string"&&!u.isEncoding(j))throw new TypeError("Unknown encoding: "+j);if(g.length===1){const it=g.charCodeAt(0);(j==="utf8"&&it<128||j==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<M)throw new RangeError("Out of range index");if(M<=_)return this;_=_>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=_;Q<M;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,j),jt=it.length;if(jt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<M-_;++Q)this[Q+_]=it[Q%jt]}return this};const Wt={};function Re(O,g,_){Wt[O]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${O}]`,this.stack,delete this.name}get code(){return O}set code(j){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:j,writable:!0})}toString(){return`${this.name} [${O}]: ${this.message}`}}}Re("ERR_BUFFER_OUT_OF_BOUNDS",function(O){return O?`${O} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Re("ERR_INVALID_ARG_TYPE",function(O,g){return`The "${O}" argument must be of type number. Received type ${typeof g}`},TypeError),Re("ERR_OUT_OF_RANGE",function(O,g,_){let M=`The value of "${O}" is out of range.`,j=_;return Number.isInteger(_)&&Math.abs(_)>2**32?j=Pe(String(_)):typeof _=="bigint"&&(j=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(j=Pe(j)),j+="n"),M+=` It must be ${g}. Received ${j}`,M},RangeError);function Pe(O){let g="",_=O.length;const M=O[0]==="-"?1:0;for(;_>=M+4;_-=3)g=`_${O.slice(_-3,_)}${g}`;return`${O.slice(0,_)}${g}`}function v(O,g,_){et(g,"offset"),(O[g]===void 0||O[g+_]===void 0)&&P(g,O.length-(_+1))}function ot(O,g,_,M,j,Q){if(O>_||O<g){const it=typeof g=="bigint"?"n":"";let jt;throw g===0||g===BigInt(0)?jt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:jt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Wt.ERR_OUT_OF_RANGE("value",jt,O)}v(M,j,Q)}function et(O,g){if(typeof O!="number")throw new Wt.ERR_INVALID_ARG_TYPE(g,"number",O)}function P(O,g,_){throw Math.floor(O)!==O?(et(O,_),new Wt.ERR_OUT_OF_RANGE("offset","an integer",O)):g<0?new Wt.ERR_BUFFER_OUT_OF_BOUNDS:new Wt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,O)}const F=/[^+/0-9A-Za-z-_]/g;function Y(O){if(O=O.split("=")[0],O=O.trim().replace(F,""),O.length<2)return"";for(;O.length%4!==0;)O=O+"=";return O}function ct(O,g){g=g||1/0;let _;const M=O.length;let j=null;const Q=[];for(let it=0;it<M;++it){if(_=O.charCodeAt(it),_>55295&&_<57344){if(!j){if(_>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===M){(g-=3)>-1&&Q.push(239,191,189);continue}j=_;continue}if(_<56320){(g-=3)>-1&&Q.push(239,191,189),j=_;continue}_=(j-55296<<10|_-56320)+65536}else j&&(g-=3)>-1&&Q.push(239,191,189);if(j=null,_<128){if((g-=1)<0)break;Q.push(_)}else if(_<2048){if((g-=2)<0)break;Q.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;Q.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;Q.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return Q}function ft(O){const g=[];for(let _=0;_<O.length;++_)g.push(O.charCodeAt(_)&255);return g}function J(O,g){let _,M,j;const Q=[];for(let it=0;it<O.length&&!((g-=2)<0);++it)_=O.charCodeAt(it),M=_>>8,j=_%256,Q.push(j),Q.push(M);return Q}function mt(O){return e.toByteArray(Y(O))}function xt(O,g,_,M){let j;for(j=0;j<M&&!(j+_>=g.length||j>=O.length);++j)g[j+_]=O[j];return j}function pt(O,g){return O instanceof g||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===g.name}function Tt(O){return O!==O}const le=function(){const O="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const M=_*16;for(let j=0;j<16;++j)g[M+j]=O[_]+O[j]}return g}();function Pt(O){return typeof BigInt>"u"?Yn:O}function Yn(){throw new Error("BigInt not supported")}})(Yg);const dn=Yg.Buffer,Zg=t=>t===void 0?null:t;class dS{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Xg=new dS,pS=!0;try{typeof localStorage<"u"&&localStorage&&(Xg=localStorage,pS=!1)}catch{}const mS=Xg,gS=Object.assign,_S=Object.keys,yS=(t,e)=>{for(const n in t)e(t[n],n)},qg=t=>_S(t).length,bS=t=>{for(const e in t)return!1;return!0},wS=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},xS=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),ES=(t,e)=>t===e||qg(t)===qg(e)&&wS(t,(n,r)=>(n!==void 0||xS(e,r))&&e[r]===n),vS=Object.freeze,Jg=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Jg(t[e])}return vS(t)},Cf=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Cf(t,e,n+1)}},kS=t=>t,TS=(t,e)=>e.includes(t);var Qg={};const Ha=typeof Ir<"u"&&Ir.release&&/node|io\.js/.test(Ir.release.name)&&Object.prototype.toString.call(typeof Ir<"u"?Ir:0)==="[object process]";let ti;const AS=()=>{if(ti===void 0)if(Ha){ti=Nr();const t=Ir.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&ti.set(e,""),e=r):e!==null&&(ti.set(e,r),e=null)}e!==null&&ti.set(e,"")}else typeof location=="object"?(ti=Nr(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");ti.set(`--${Pg(e,"-")}`,n),ti.set(`-${Pg(e,"-")}`,n)}})):ti=Nr();return ti},Lf=t=>AS().has(t),wl=t=>Zg(Ha?Qg[t.toUpperCase().replaceAll("-","_")]:mS.getItem(t)),t_=t=>Lf("--"+t)||wl(t)!==null;t_("production");const RS=Ha&&TS(Qg.FORCE_COLOR,["true","1","2"])||!Lf("--no-colors")&&!t_("no-color")&&(!Ha||Ir.stdout.isTTY)&&(!Ha||Lf("--color")||wl("COLORTERM")!==null||(wl("TERM")||"").includes("color")),SS=t=>new Uint8Array(t),OS=t=>{const e=SS(t.byteLength);return e.set(t),e};class IS{constructor(e,n){this.left=e,this.right=n}}const Ti=(t,e)=>new IS(t,e);typeof DOMParser<"u"&&new DOMParser;const NS=t=>OR(t,(e,n)=>`${n}:${e};`).join(""),Ai=Symbol,e_=Ai(),n_=Ai(),CS=Ai(),LS=Ai(),MS=Ai(),r_=Ai(),US=Ai(),Mf=Ai(),FS=Ai(),PS=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},BS={[e_]:Ti("font-weight","bold"),[n_]:Ti("font-weight","normal"),[CS]:Ti("color","blue"),[MS]:Ti("color","green"),[LS]:Ti("color","grey"),[r_]:Ti("color","red"),[US]:Ti("color","purple"),[Mf]:Ti("color","orange"),[FS]:Ti("color","black")},i_=RS?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Nr();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=BS[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=NS(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:PS,DS=(...t)=>{console.log(...i_(t)),s_.forEach(e=>e.print(t))},$S=(...t)=>{console.warn(...i_(t)),t.unshift(Mf),s_.forEach(e=>e.print(t))},s_=xo(),o_=t=>({[Symbol.iterator](){return this},next:t}),jS=(t,e)=>o_(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Uf=(t,e)=>o_(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Ff{constructor(e,n){this.clock=e,this.len=n}}class Wa{constructor(){this.clients=new Map}}const a_=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];v_(t,s,a.clock,a.len,n)}}),zS=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Xi((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},c_=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&zS(n,e.clock)!==null},Pf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=Us(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},KS=t=>{const e=new Wa;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)NR(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return Pf(e),e},xl=(t,e,n,r)=>{Zi(t.clients,e,()=>[]).push(new Ff(n,r))},HS=()=>new Wa,WS=t=>{const e=HS();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Ff(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Ro=(t,e)=>{te(t.restEncoder,e.clients.size),Ms(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),te(t.restEncoder,n);const i=r.length;te(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},Bf=t=>{const e=new Wa,n=Kt(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Kt(t.restDecoder),s=Kt(t.restDecoder);if(s>0){const o=Zi(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Ff(t.readDsClock(),t.readDsLen()))}}return e},l_=(t,e,n)=>{const r=new Wa,i=Kt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Kt(t.restDecoder),a=Kt(t.restDecoder),c=n.clients.get(o)||[],l=on(n,o);for(let u=0;u<a;u++){const f=t.readDsClock(),d=f+t.readDsLen();if(f<l){l<d&&xl(r,o,l,d-l);let h=ei(c,f),p=c[h];for(!p.deleted&&p.id.clock<f&&(c.splice(h+1,0,Ul(e,p,f-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(h,0,Ul(e,p,d-p.id.clock)),p.delete(e))}else xl(r,o,f,d-f)}}if(r.clients.size>0){const s=new Ps;return te(s.restEncoder,0),Ro(s,r),s.toUint8Array()}return null},u_=Wg;class So extends LR{constructor({guid:e=iS(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=u_(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new w_,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Gg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Gg(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&fe(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ms(this.subdocs).map(e=>e.guid))}transact(e,n=null){return fe(this,e,n)}get(e,n=pn){const r=Zi(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==pn&&i!==n)if(i===pn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Co)}getText(e=""){return this.get(e,Ri)}getMap(e=""){return this.get(e,Lo)}getXmlElement(e=""){return this.get(e,Uo)}getXmlFragment(e=""){return this.get(e,Bs)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Ms(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new So({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,fe(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class h_{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Kt(this.restDecoder)}readDsLen(){return Kt(this.restDecoder)}}class f_ extends h_{readLeftID(){return Zt(Kt(this.restDecoder),Kt(this.restDecoder))}readRightID(){return Zt(Kt(this.restDecoder),Kt(this.restDecoder))}readClient(){return Kt(this.restDecoder)}readInfo(){return ko(this.restDecoder)}readString(){return To(this.restDecoder)}readParentInfo(){return Kt(this.restDecoder)===1}readTypeRef(){return Kt(this.restDecoder)}readLen(){return Kt(this.restDecoder)}readAny(){return Ka(this.restDecoder)}readBuf(){return OS(er(this.restDecoder))}readJSON(){return JSON.parse(To(this.restDecoder))}readKey(){return To(this.restDecoder)}}class GS{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Kt(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Kt(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Oo extends GS{constructor(e){super(e),this.keys=[],Kt(e),this.keyClockDecoder=new Of(er(e)),this.clientDecoder=new yl(er(e)),this.leftClockDecoder=new Of(er(e)),this.rightClockDecoder=new Of(er(e)),this.infoDecoder=new Hg(er(e),ko),this.stringDecoder=new eS(er(e)),this.parentInfoDecoder=new Hg(er(e),ko),this.typeRefDecoder=new yl(er(e)),this.lenDecoder=new yl(er(e))}readLeftID(){return new Io(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Io(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ka(this.restDecoder)}readBuf(){return er(this.restDecoder)}readJSON(){return Ka(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class YS{constructor(){this.restEncoder=pl()}toUint8Array(){return Xr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){te(this.restEncoder,e)}writeDsLen(e){te(this.restEncoder,e)}}class Ga extends YS{writeLeftID(e){te(this.restEncoder,e.client),te(this.restEncoder,e.clock)}writeRightID(e){te(this.restEncoder,e.client),te(this.restEncoder,e.clock)}writeClient(e){te(this.restEncoder,e)}writeInfo(e){Ef(this.restEncoder,e)}writeString(e){Eo(this.restEncoder,e)}writeParentInfo(e){te(this.restEncoder,e?1:0)}writeTypeRef(e){te(this.restEncoder,e)}writeLen(e){te(this.restEncoder,e)}writeAny(e){za(this.restEncoder,e)}writeBuf(e){tr(this.restEncoder,e)}writeJSON(e){Eo(this.restEncoder,JSON.stringify(e))}writeKey(e){Eo(this.restEncoder,e)}}class VS{constructor(){this.restEncoder=pl(),this.dsCurrVal=0}toUint8Array(){return Xr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,te(this.restEncoder,n)}writeDsLen(e){e===0&&Jr(),te(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ps extends VS{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Af,this.clientEncoder=new gl,this.leftClockEncoder=new Af,this.rightClockEncoder=new Af,this.infoEncoder=new Dg(Ef),this.stringEncoder=new qR,this.parentInfoEncoder=new Dg(Ef),this.typeRefEncoder=new gl,this.lenEncoder=new gl}toUint8Array(){const e=pl();return te(e,0),tr(e,this.keyClockEncoder.toUint8Array()),tr(e,this.clientEncoder.toUint8Array()),tr(e,this.leftClockEncoder.toUint8Array()),tr(e,this.rightClockEncoder.toUint8Array()),tr(e,Xr(this.infoEncoder)),tr(e,this.stringEncoder.toUint8Array()),tr(e,Xr(this.parentInfoEncoder)),tr(e,this.typeRefEncoder.toUint8Array()),tr(e,this.lenEncoder.toUint8Array()),ml(e,Xr(this.restEncoder)),Xr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){za(this.restEncoder,e)}writeBuf(e){tr(this.restEncoder,e)}writeJSON(e){za(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const ZS=(t,e,n,r)=>{r=Us(r,e[0].id.clock);const i=ei(e,r);te(t.restEncoder,e.length-i),t.writeClient(n),te(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Df=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{on(e,s)>i&&r.set(s,i)}),jf(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),te(t.restEncoder,r.size),Ms(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{ZS(t,e.clients.get(i),i,s)})},XS=(t,e)=>{const n=Nr(),r=Kt(t.restDecoder);for(let i=0;i<r;i++){const s=Kt(t.restDecoder),o=new Array(s),a=t.readClient();let c=Kt(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(dl&u){case 0:{const f=t.readLen();o[l]=new gr(Zt(a,c),f),c+=f;break}case 10:{const f=Kt(t.restDecoder);o[l]=new _r(Zt(a,c),f),c+=f;break}default:{const f=(u&(ki|Qn))===0,d=new Ze(Zt(a,c),null,(u&Qn)===Qn?t.readLeftID():null,null,(u&ki)===ki?t.readRightID():null,f?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,f&&(u&Ba)===Ba?t.readString():null,V_(t,u));o[l]=d,c+=d.length}}}}return n},qS=(t,e,n)=>{const r=[];let i=Ms(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new w_,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(y=>y!==p)}r.length=0};for(;;){if(u.constructor!==_r){const p=Zi(f,u.id.client,()=>on(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const y=n.get(m)||{refs:[],i:0};if(y.refs.length===y.i)l(m,on(e,m)),d();else{u=y.refs[y.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new Ps;return Df(h,a,new Map),te(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},JS=(t,e)=>Df(t,e.doc.store,e.beforeState),QS=(t,e,n,r=new Oo(t))=>fe(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=XS(r,o),l=qS(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<on(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const p=u.missing.get(d);(p==null||p>h)&&u.missing.set(d,h)}u.update=kl([u.update,l.update])}}else a.pendingStructs=l;const f=l_(r,i,a);if(a.pendingDs){const d=new Oo(vo(a.pendingDs));Kt(d.restDecoder);const h=l_(d,i,a);f&&h?a.pendingDs=kl([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,d_(i.doc,d)}},n,!1),d_=(t,e,n,r=Oo)=>{const i=vo(e);QS(i,t,n,new r(i))},p_=(t,e,n)=>d_(t,e,n,f_),tO=(t,e,n=new Map)=>{Df(t,e.store,n),Ro(t,WS(e.store))},eO=(t,e=new Uint8Array([0]),n=new Ps)=>{const r=m_(e);tO(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(dO(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Ga)return hO(i.map((s,o)=>o===0?s:mO(s)));if(n.constructor===Ps)return kl(i)}return i[0]},nO=(t,e)=>eO(t,e,new Ga),rO=t=>{const e=new Map,n=Kt(t.restDecoder);for(let r=0;r<n;r++){const i=Kt(t.restDecoder),s=Kt(t.restDecoder);e.set(i,s)}return e},m_=t=>rO(new h_(vo(t)));class iO{constructor(){this.l=[]}}const g_=()=>new iO,__=(t,e)=>t.l.push(e),y_=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},b_=(t,e,n)=>Cf(t.l,[e,n]);class Io{constructor(e,n){this.client=e,this.clock=n}}const El=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Zt=(t,e)=>new Io(t,e),sO=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Jr()},No=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!c_(e.ds,t.id),$f=(t,e)=>{const n=Zi(t.meta,$f,xo),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<on(r,s)&&Ji(t,Zt(s,i))}),a_(t,e.ds,i=>{}),n.add(e))};class w_{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const jf=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},on=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},x_=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Jr()}n.push(e)},ei=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Xi(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Xi((n+r)/2)}throw Jr()},zf=(t,e)=>{const n=t.clients.get(e.client);return n[ei(n,e.clock)]},Kf=(t,e,n)=>{const r=ei(e,n),i=e[r];return i.id.clock<n&&i instanceof Ze?(e.splice(r+1,0,Ul(t,i,n-i.id.clock)),r+1):r},Ji=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Kf(t,n,e.clock)]},E_=(t,e,n)=>{const r=e.clients.get(n.client),i=ei(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==gr&&r.splice(i+1,0,Ul(t,s,n.clock-s.id.clock+1)),s},oO=(t,e,n)=>{const r=t.clients.get(e.id.client);r[ei(r,e.id.clock)]=n},v_=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=Kf(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&Kf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class aO{constructor(e,n,r){this.doc=e,this.deleteSet=new Wa,this.beforeState=jf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const k_=(t,e)=>e.deleteSet.clients.size===0&&!IR(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Pf(e.deleteSet),JS(t,e),Ro(t,e.deleteSet),!0),T_=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Zi(t.changed,e,xo).add(n)},vl=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},cO=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ei(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Ze&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},lO=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Cg(i.length-1,1+ei(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+vl(i,c)}})},A_=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Pf(s),n.afterState=jf(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),b_(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Cf(a,[]),n._needFormattingCleanup&&OO(n)}finally{r.gc&&cO(s,i,r.gcFilter),lO(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=Us(ei(h,d),1);for(let m=h.length-1;m>=p;)m-=1+vl(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=ei(h,d);p+1<h.length&&vl(h,p+1)>1||p>0&&vl(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(DS(Mf,e_,"[yjs] ",n_,r_,"Changed the client-id because another client seems to be using it."),r.clientID=u_()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ga;k_(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Ps;k_(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):A_(t,e+1)}}},fe=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new aO(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&A_(i,0)}}return o};function*uO(t){const e=Kt(t.restDecoder);for(let n=0;n<e;n++){const r=Kt(t.restDecoder),i=t.readClient();let s=Kt(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Kt(t.restDecoder);yield new _r(Zt(i,s),c),s+=c}else if(dl&a){const c=(a&(ki|Qn))===0,l=new Ze(Zt(i,s),null,(a&Qn)===Qn?t.readLeftID():null,null,(a&ki)===ki?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Ba)===Ba?t.readString():null,V_(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new gr(Zt(i,s),c),s+=c}}}}class Hf{constructor(e,n){this.gen=uO(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===_r);return this.curr}}class Wf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const hO=t=>kl(t,f_,Ga),fO=(t,e)=>{if(t.constructor===gr){const{client:n,clock:r}=t.id;return new gr(Zt(n,r+e),t.length-e)}else if(t.constructor===_r){const{client:n,clock:r}=t.id;return new _r(Zt(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Ze(Zt(r,i+e),null,Zt(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},kl=(t,e=Oo,n=Ps)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(vo(u)));let i=r.map(u=>new Hf(u,!0)),s=null;const o=new n,a=new Wf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const p=d.curr.id.clock-h.curr.id.clock;return p===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===_r?1:-1:p}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Qi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===_r)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Qi(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new _r(Zt(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===_r?s.struct.length-=p:d=fO(d,p)),s.struct.mergeWith(d)||(Qi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==_r;d=u.next())Qi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Qi(a,s.struct,s.offset),s=null),Gf(a);const c=r.map(u=>Bf(u)),l=KS(c);return Ro(o,l),o.toUint8Array()},dO=(t,e,n=Oo,r=Ps)=>{const i=m_(e),s=new r,o=new Wf(s),a=new n(vo(t)),c=new Hf(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===_r){c.next();continue}if(u.id.clock+u.length>d)for(Qi(o,u,Us(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Qi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}Gf(o);const l=Bf(a);return Ro(s,l),s.toUint8Array()},R_=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Xr(t.encoder.restEncoder)}),t.encoder.restEncoder=pl(),t.written=0)},Qi=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&R_(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),te(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Gf=t=>{R_(t);const e=t.encoder.restEncoder;te(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];te(e,r.written),ml(e,r.restEncoder)}},pO=(t,e,n,r)=>{const i=new n(vo(t)),s=new Hf(i,!1),o=new r,a=new Wf(o);for(let l=s.curr;l!==null;l=s.next())Qi(a,e(l),0);Gf(a);const c=Bf(i);return Ro(o,c),o.toUint8Array()},mO=t=>pO(t,kS,Oo,Ga),S_="You must not compute changes after the event-handler fired.";class Tl{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=gO(this.currentTarget,this.target))}deletes(e){return c_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw qi(S_);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=yf(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=yf(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=yf(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw qi(S_);const n=this.target,r=xo(),i=xo(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const gO=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},yn=()=>{$S("Invalid access: Add Yjs type to a document before reading data.")},O_=80;let Yf=0;class _O{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Yf++}}const yO=t=>{t.timestamp=Yf++},I_=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Yf++},bO=(t,e,n)=>{if(t.length>=O_){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return I_(r,e,n),r}else{const r=new _O(e,n);return t.push(r),r}},Al=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>fl(e-s.index)<fl(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,yO(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&fl(n.index-i)<r.parent.length/O_?(I_(n,r,i),n):bO(t._searchMarker,r,i)},Ya=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=Us(e,i.index+n))}},Rl=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Zi(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;b_(r._eH,n,e)};class pn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=g_(),this._dEH=g_(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw qr()}clone(){throw qr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){__(this._eH,e)}observeDeep(e){__(this._dEH,e)}unobserve(e){y_(this._eH,e)}unobserveDeep(e){y_(this._dEH,e)}toJSON(){}}const N_=(t,e,n)=>{t.doc??yn(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},C_=t=>{t.doc??yn();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Va=(t,e)=>{let n=0,r=t._start;for(t.doc??yn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},L_=(t,e)=>{const n=[];return Va(t,(r,i)=>{n.push(e(r,i,t))}),n},wO=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},M_=(t,e)=>{t.doc??yn();const n=Al(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Sl=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ze(Zt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new $s(l)),i.integrate(t,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Ze(Zt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Za(new Uint8Array(f))),i.integrate(t,0);break;case So:i=new Ze(Zt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new qa(f)),i.integrate(t,0);break;default:if(f instanceof pn)i=new Ze(Zt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Si(f)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},U_=()=>qi("Length exceeded!"),F_=(t,e,n,r)=>{if(n>e._length)throw U_();if(n===0)return e._searchMarker&&Ya(e._searchMarker,n,r.length),Sl(t,e,null,r);const i=n,s=Al(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ji(t,Zt(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Ya(e._searchMarker,i,r.length),Sl(t,e,o,r)},xO=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Sl(t,e,i,n)},P_=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Al(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ji(t,Zt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ji(t,Zt(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw U_();e._searchMarker&&Ya(e._searchMarker,i,-s+r)},Ol=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Vf=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new $s([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new $s([r]);break;case Uint8Array:a=new Za(r);break;case So:a=new qa(r);break;default:if(r instanceof pn)a=new Si(r);else throw new Error("Unexpected content type")}new Ze(Zt(o,on(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Zf=(t,e)=>{t.doc??yn();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},B_=t=>{const e={};return t.doc??yn(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},D_=(t,e)=>{t.doc??yn();const n=t._map.get(e);return n!==void 0&&!n.deleted},EO=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&No(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Il=t=>(t.doc??yn(),jS(t._map.entries(),e=>!e[1].deleted));class vO extends Tl{}class Co extends pn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Co;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Co}clone(){const e=new Co;return e.insert(0,this.toArray().map(n=>n instanceof pn?n.clone():n)),e}get length(){return this.doc??yn(),this._length}_callObserver(e,n){super._callObserver(e,n),Rl(this,e,new vO(this,e))}insert(e,n){this.doc!==null?fe(this.doc,r=>{F_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?fe(this.doc,n=>{xO(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?fe(this.doc,r=>{P_(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return M_(this,e)}toArray(){return C_(this)}slice(e=0,n=this.length){return N_(this,e,n)}toJSON(){return this.map(e=>e instanceof pn?e.toJSON():e)}map(e){return L_(this,e)}forEach(e){Va(this,e)}[Symbol.iterator](){return wO(this)}_write(e){e.writeTypeRef(VO)}}const kO=t=>new Co;class TO extends Tl{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Lo extends pn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Lo}clone(){const e=new Lo;return this.forEach((n,r)=>{e.set(r,n instanceof pn?n.clone():n)}),e}_callObserver(e,n){Rl(this,e,new TO(this,e,n))}toJSON(){this.doc??yn();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof pn?i.toJSON():i}}),e}get size(){return[...Il(this)].length}keys(){return Uf(Il(this),e=>e[0])}values(){return Uf(Il(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Uf(Il(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??yn(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?fe(this.doc,n=>{Ol(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?fe(this.doc,r=>{Vf(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Zf(this,e)}has(e){return D_(this,e)}clear(){this.doc!==null?fe(this.doc,e=>{this.forEach(function(n,r,i){Ol(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(ZO)}}const AO=t=>new Lo,ts=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&ES(t,e);class Xf{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Jr(),this.right.content.constructor){case Ve:this.right.deleted||Mo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const $_=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Ve:e.right.deleted||Mo(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Ji(t,Zt(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Nl=(t,e,n,r)=>{const i=new Map,s=r?Al(e,n):null;if(s){const o=new Xf(s.p.left,s.p,s.index,i);return $_(t,o,n-s.index)}else{const o=new Xf(null,e._start,0,i);return $_(t,o,n)}},j_=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ve&&ts(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ze(Zt(s,on(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Ve(a,o));u.integrate(t,0),n.right=u,n.forward()})},Mo=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},z_=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ve&&ts(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},K_=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!ts(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Ze(Zt(s,on(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Ve(a,c)),n.right.integrate(t,0),n.forward()}}return o},qf=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;z_(n,i);const a=K_(t,e,n,i),c=r.constructor===String?new ni(r):r instanceof pn?new Si(r):new Ds(r);let{left:l,right:u,index:f}=n;e._searchMarker&&Ya(e._searchMarker,n.index,c.getLength()),u=new Ze(Zt(o,on(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=f,n.forward(),j_(t,e,n,a)},H_=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;z_(n,i);const a=K_(t,e,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ve));){if(!n.right.deleted)switch(n.right.content.constructor){case Ve:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(ts(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Ji(t,Zt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ze(Zt(o,on(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new ni(c)),n.right.integrate(t,0),n.forward()}j_(t,e,n,a)},W_=(t,e,n,r,i)=>{let s=e;const o=Nr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ve){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Ve:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(e.delete(t),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&Mo(i,l);break}}}e=e.right}return a},RO=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ve){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},SO=t=>{let e=0;return fe(t.doc,n=>{let r=t._start,i=t._start,s=Nr();const o=_f(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ve:Mo(o,i.content);break;default:e+=W_(n,r,i,s,o),s=_f(o),r=i;break}i=i.right}}),e},OO=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&v_(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ve&&o.constructor!==gr&&e.add(o.parent)})}fe(n,r=>{a_(t,t.deleteSet,i=>{if(i instanceof gr||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Ve?e.add(s):RO(r,i)});for(const i of e)SO(i)})},G_=(t,e,n)=>{const r=n,i=_f(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Si:case Ds:case ni:n<e.right.length&&Ji(t,Zt(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&W_(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Ya(o._searchMarker,e.index,-r+n),e};class IO extends Tl{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];fe(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},bS(c)||(h.attributes=gS({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case Si:case Ds:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ni:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Ve:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;ts(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),ts(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;ts(m,p)||(a==="retain"&&d(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(ts(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&d(),Mo(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ri extends pn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??yn(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ri}clone(){const e=new Ri;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new IO(this,e,n);Rl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??yn();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ni&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?fe(this.doc,r=>{const i=new Xf(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&qf(r,this,i,a,o.attributes||{})}else o.retain!==void 0?H_(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&G_(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??yn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(No(c,e)||n!==void 0&&No(c,n))switch(c.content.constructor){case ni:{const f=s.get("ychange");e!==void 0&&!No(c,e)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!No(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Si:case Ds:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Ve:No(c,e)&&(l(),Mo(s,c.content));break}c=c.right}l()};return e||n?fe(o,f=>{e&&$f(f,e),n&&$f(f,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?fe(i,s=>{const o=Nl(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),qf(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?fe(i,s=>{const o=Nl(s,this,e,!r);qf(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?fe(r,i=>{G_(i,Nl(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?fe(i,s=>{const o=Nl(s,this,e,!1);o.right!==null&&H_(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?fe(this.doc,n=>{Ol(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?fe(this.doc,r=>{Vf(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Zf(this,e)}getAttributes(){return B_(this)}_write(e){e.writeTypeRef(XO)}}const NO=t=>new Ri;class Jf{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??yn()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Uo||n.constructor===Bs)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Bs extends pn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Bs}clone(){const e=new Bs;return e.insert(0,this.toArray().map(n=>n instanceof pn?n.clone():n)),e}get length(){return this.doc??yn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Jf(this,e)}querySelector(e){e=e.toUpperCase();const r=new Jf(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Ms(new Jf(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Rl(this,e,new MO(this,n,e))}toString(){return L_(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Va(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?fe(this.doc,r=>{F_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)fe(this.doc,r=>{const i=e&&e instanceof pn?e._item:e;Sl(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw qi("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?fe(this.doc,r=>{P_(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return C_(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return M_(this,e)}slice(e=0,n=this.length){return N_(this,e,n)}forEach(e){Va(this,e)}_write(e){e.writeTypeRef(JO)}}const CO=t=>new Bs;class Uo extends Bs{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Uo(this.nodeName)}clone(){const e=new Uo(this.nodeName),n=this.getAttributes();return yS(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof pn?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?fe(this.doc,n=>{Ol(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?fe(this.doc,r=>{Vf(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Zf(this,e)}hasAttribute(e){return D_(this,e)}getAttributes(e){return e?EO(this,e):B_(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Va(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(qO),e.writeKey(this.nodeName)}}const LO=t=>new Uo(t.readKey());class MO extends Tl{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Cl extends Lo{constructor(e){super(),this.hookName=e}_copy(){return new Cl(this.hookName)}clone(){const e=new Cl(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(QO),e.writeKey(this.hookName)}}const UO=t=>new Cl(t.readKey());class Ll extends Ri{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Ll}clone(){const e=new Ll;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(tI)}}const FO=t=>new Ll;class Qf{constructor(e,n){this.id=e,this.length=n}get deleted(){throw qr()}mergeWith(e){return!1}write(e,n,r){throw qr()}integrate(e,n){throw qr()}}const PO=0;class gr extends Qf{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),x_(e.doc.store,this)}write(e,n){e.writeInfo(PO),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Za{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Za(this.content)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const BO=t=>new Za(t.readBuf());class Xa{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Xa(this.len)}splice(e){const n=new Xa(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){xl(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const DO=t=>new Xa(t.readLen()),Y_=(t,e)=>new So({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class qa{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new qa(Y_(this.doc.guid,this.opts))}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const $O=t=>new qa(Y_(t.readString(),t.readAny()));class Ds{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ds(this.embed)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const jO=t=>new Ds(t.readJSON());class Ve{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ve(this.key,this.value)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const zO=t=>new Ve(t.readKey(),t.readJSON());class Ml{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ml(this.arr)}splice(e){const n=new Ml(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const KO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Ml(n)},HO=wl("node_env")==="development";class $s{constructor(e){this.arr=e,HO&&Jg(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new $s(this.arr)}splice(e){const n=new $s(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const WO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new $s(n)};class ni{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ni(this.str)}splice(e){const n=new ni(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const GO=t=>new ni(t.readString()),YO=[kO,AO,NO,LO,CO,UO,FO],VO=0,ZO=1,XO=2,qO=3,JO=4,QO=5,tI=6;class Si{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Si(this.type._copy())}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const eI=t=>new Si(YO[t.readTypeRef()](t)),Ul=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Ze(Zt(r,i+n),e,Zt(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Zt(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Ze extends Qf{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Ug:0}set marker(e){(this.info&wf)>0!==e&&(this.info^=wf)}get marker(){return(this.info&wf)>0}get keep(){return(this.info&Mg)>0}set keep(e){this.keep!==e&&(this.info^=Mg)}get countable(){return(this.info&Ug)>0}get deleted(){return(this.info&bf)>0}set deleted(e){this.deleted!==e&&(this.info^=bf)}markDeleted(){this.info|=bf}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=on(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=on(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Io&&this.id.client!==this.parent.client&&this.parent.clock>=on(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=E_(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ji(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===gr||this.right&&this.right.constructor===gr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Io){const r=zf(n,this.parent);r.constructor===gr?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=E_(e,e.doc.store,Zt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),El(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(El(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(zf(e.doc.store,i.origin)))s.has(zf(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),x_(e.doc.store,this),this.content.integrate(e,this),T_(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new gr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Zt(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&El(e.origin,this.lastId)&&this.right===e&&El(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),xl(e.deleteSet,this.id.client,this.id.clock,this.length),T_(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Jr();this.content.gc(e),n?oO(e,this,new gr(this.id,this.length)):this.content=new Xa(this.length)}write(e,n){const r=n>0?Zt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&dl|(r===null?0:Qn)|(i===null?0:ki)|(s===null?0:Ba);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=sO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Io?(e.writeParentInfo(!1),e.writeLeftID(a)):Jr();s!==null&&e.writeString(s)}this.content.write(e,n)}}const V_=(t,e)=>nI[e&dl](t),nI=[()=>{Jr()},DO,KO,BO,GO,jO,zO,eI,WO,$O,()=>{Jr()}],rI=10;class _r extends Qf{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Jr()}write(e,n){e.writeInfo(rI),te(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Z_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof wo<"u"?wo:{},X_="__ $YJS$ __";Z_[X_]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Z_[X_]=!0;let q_=!1;const nr=new So;function J_(t,e,n){const r=nr.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function iI(t,e){J_(t,0,e)}function td(t,e){const n=new Ri(e);J_(t,1,n)}function sI(t,e){nr.getMap().set(t,e)}function oI(t,e){const n=nr.getMap(),r=new Ri(e);n.set(t,r)}function Q_(t,e){const n=nr.getMap();function r(i){const s=n.get(t);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function aI(t,e){return Q_(t,n=>{At(n)&&e(n)})}function ty(t,e){return Q_(t,n=>{n instanceof Ri&&e(n.toJSON())})}const js=ao("modem",["second"],t=>{if(js.session(t))switch(t.target){case"second":!q_&&t.data%2===0&&js.emit(t.player,"modem:join");break;case"join":t.sender!==js.id()&&js.reply(t,"joinack",Sg(nO(nr)));break;case"joinack":t.sender!==js.id()&&(q_=!0,p_(nr,ul(t.data),nr));break;case"sync":{t.sender!==js.id()&&E(t.data)&&p_(nr,ul(t.data),nr);break}}});function ey(t,e){e!==nr&&js.emit("","modem:sync",Sg(t))}nr.on("update",ey),nr.on("destroy",()=>{nr.off("update",ey)});function cI(t,e){return t%e}function lI(t,e){return Math.floor(t/e)}function uI(t,e){return{x:cI(t,e),y:lI(t,e)}}function Fo(t,e){return t.x+t.y*e}function Po(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function ny(t,e,n,r){const i=[],s=Math.min(t,n),o=Math.max(t,n),a=Math.min(e,r),c=Math.max(e,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function ry(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const iy="176",hI="",Cr="srgb",sy="srgb-linear",oy="linear",ed="srgb";function Lr(t,e,n){return Math.max(e,Math.min(n,t))}function fI(t,e){return(t%e+e)%e}function nd(t,e,n){return(1-n)*t+n*e}class Ja{constructor(e=0,n=0){Ja.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Lr(this.x,e.x,n.x),this.y=Lr(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Lr(this.x,e,n),this.y=Lr(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Lr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Lr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Qa{constructor(e,n,r,i,s,o,a,c,l){Qa.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],p=r[8],m=i[0],y=i[3],b=i[6],k=i[1],T=i[4],A=i[7],C=i[2],R=i[5],S=i[8];return s[0]=o*m+a*k+c*C,s[3]=o*y+a*T+c*R,s[6]=o*b+a*A+c*S,s[1]=l*m+u*k+f*C,s[4]=l*y+u*T+f*R,s[7]=l*b+u*A+f*S,s[2]=d*m+h*k+p*C,s[5]=d*y+h*T+p*R,s[8]=d*b+h*A+p*S,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,p=n*f+r*d+i*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=f*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=h*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(rd.makeScale(e,n)),this}rotate(e){return this.premultiply(rd.makeRotation(-e)),this}translate(e,n){return this.premultiply(rd.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const rd=new Qa,ay=new Qa().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),cy=new Qa().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function dI(){const t={enabled:!0,workingColorSpace:sy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===ed&&(i.r=Bo(i.r),i.g=Bo(i.g),i.b=Bo(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===ed&&(i.r=Do(i.r),i.g=Do(i.g),i.b=Do(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===hI?oy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[sy]:{primaries:e,whitePoint:r,transfer:oy,toXYZ:ay,fromXYZ:cy,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Cr},outputColorSpaceConfig:{drawingBufferColorSpace:Cr}},[Cr]:{primaries:e,whitePoint:r,transfer:ed,toXYZ:ay,fromXYZ:cy,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Cr}}}),t}const Mr=dI();function Bo(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Do(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const ly={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},es={h:0,s:0,l:0},Fl={h:0,s:0,l:0};function id(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class sd{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Cr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Mr.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Mr.workingColorSpace){return this.r=e,this.g=n,this.b=r,Mr.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Mr.workingColorSpace){if(e=fI(e,1),n=Lr(n,0,1),r=Lr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=id(o,s,e+1/3),this.g=id(o,s,e),this.b=id(o,s,e-1/3)}return Mr.toWorkingColorSpace(this,i),this}setStyle(e,n=Cr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Cr){const r=ly[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Bo(e.r),this.g=Bo(e.g),this.b=Bo(e.b),this}copyLinearToSRGB(e){return this.r=Do(e.r),this.g=Do(e.g),this.b=Do(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Cr){return Mr.fromWorkingColorSpace(bn.copy(this),e),Math.round(Lr(bn.r*255,0,255))*65536+Math.round(Lr(bn.g*255,0,255))*256+Math.round(Lr(bn.b*255,0,255))}getHexString(e=Cr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Mr.workingColorSpace){Mr.fromWorkingColorSpace(bn.copy(this),n);const r=bn.r,i=bn.g,s=bn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Mr.workingColorSpace){return Mr.fromWorkingColorSpace(bn.copy(this),n),e.r=bn.r,e.g=bn.g,e.b=bn.b,e}getStyle(e=Cr){Mr.fromWorkingColorSpace(bn.copy(this),e);const n=bn.r,r=bn.g,i=bn.b;return e!==Cr?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(es),this.setHSL(es.h+e,es.s+n,es.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(es),e.getHSL(Fl);const r=nd(es.h,Fl.h,n),i=nd(es.s,Fl.s,n),s=nd(es.l,Fl.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const bn=new sd;sd.NAMES=ly,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:iy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=iy),new Ja,new Ja;function Xe(t,e,n){return Math.max(e,Math.min(n,t))}function uy(t){return t/180*Math.PI}function hy(t){return t*180/Math.PI}const pI=Ep("089fad0j9awfem09wavefc09uwaef");function mI(){return pI()}function gI(t){return Ep(t)()}function yr(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(mI()*i)}function fy(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(gI(t)*s)}function dy(t,e,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function _I(t){return t[yr(0,t.length-1)]}function yI(t,e){return e[fy(t,0,e.length-1)]}function Te(...t){return _I(t.flat())}function py(t,...e){return yI(t,e.flat())}function bI(t){return[...new Set(t)].filter(E)}function $o(t){return E(t)&&E(t.x)&&E(t.y)}function Ke(t,e){switch(e){case dt.NORTH:--t.y;break;case dt.SOUTH:++t.y;break;case dt.WEST:--t.x;break;case dt.EAST:++t.x;break}return t}function wI(t,e){return t<0?dt.WEST:t>0?dt.EAST:e<0?dt.NORTH:e>0?dt.SOUTH:dt.IDLE}function ri(t,e){return wI(e.x-t.x,e.y-t.y)}const od={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function ii(t){return ae(t)&&my(t[0])}function my(t){return E(dt[t])&&wt(t)}function xI(t){const e=dt[t];return E(e)?e:dt.IDLE}function ad(t){if(wt(t))return od[It(t)]}function EI(t){if(ii(t))return t;if(my(t))return[t];const e=ad(t);if(E(e))return[e]}function gy(t){const e=w.words[t],n=EI(e);return ii(n)?[n,t+1]:[void 0,t]}function _y(t){var i,s;const e=[];let[n,r]=gy(t);for(;ii(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(w.words,r,[z.NUMBER,z.NUMBER]);e.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(w.words,r,[z.DIR]);e.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=rt(w.words,r,[z.DIR,z.DIR]),f=((i=w.element)==null?void 0:i.x)??0,d=((s=w.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,e.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[e,r]}const[o,a]=gy(r);n=o,r=a}return e.length?[e,r]:[void 0,t]}function vI(t){return E(t)&&t<Rt.ONBLACK?t:void 0}function kI(t){return E(t)&&t>Rt.WHITE&&t<Rt.ONCLEAR?t-Rt.ONBLACK:void 0}const tc={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function si(t){return ae(t)&&by(t[0])}function yy(t){return si(t)&&t[0].startsWith("ON")}function by(t){return E(Rt[t])&&wt(t)}function cd(t){if(wt(t))return tc[It(t)]}function TI(t){return t.map(e=>Rt[e]).find(e=>E(e)&&e<Rt.ONBLACK)}function AI(t){return t.map(e=>Rt[e]).find(e=>E(e)&&e>=Rt.ONBLACK)}function RI(t){if(si(t))return t;if(by(t))return[t];const e=cd(t);if(E(e))return[e]}function wy(t){const e=w.words[t],n=RI(e);return si(n)?[n,t+1]:[void 0,t]}function ld(t){const e=[];let n=t;const[r,i]=wy(t);if(si(r)&&(e.push(...r),n=i),si(e)&&!yy(e)){const[s,o]=wy(i);yy(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function xy(t){const e={};return t.every(n=>{const r=Rt[n];E(r)&&(r<Rt.ONBLACK?e.color=r:e.bg=r-Rt.ONBLACK)}),e}function jo(t){return ae(t)&&typeof t[0]=="string"}function SI(t){const e=w.words[t];return wt(e)?[e,t+1]:[void 0,t]}function Ey(t){const e=w.words[t];if(jo(e))return[e,t+1];const[n,r]=ld(t),[i,s]=SI(r);return wt(i)?[[i,n],s]:[void 0,t]}function ud(t){if(!jo(t))return;const[e]=t;return e}function vy(t){if(!jo(t))return;const[,e]=t,n=E(e)?TI(e):void 0;return E(n)?n:void 0}function ky(t){if(!jo(t))return;const[,e]=t,n=E(e)?AI(e):void 0;return E(n)?n:void 0}var hd;try{hd=new TextDecoder}catch{}var gt,br,K=0,de={},Xt,ns,wr=0,oi=0,an,Oi,Un=[],Gt,Ty={useRecords:!1,mapsAsObjects:!0};class Ay{}const Ry=new Ay;Ry.name="MessagePack 0xC1";var rs=!1,Sy=2,Oy;try{new Function("")}catch{Sy=1/0}class ec{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(gt)return zy(()=>(gd(),this?this.unpack(e,n):ec.prototype.unpack.call(Ty,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof dn<"u"?dn.from(e):new Uint8Array(e)),typeof n=="object"?(br=n.end||e.length,K=n.start||0):(K=0,br=n>-1?n:e.length),oi=0,ns=null,an=null,gt=e;try{Gt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw gt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof ec){if(de=this,this.structures)return Xt=this.structures,Pl(n);(!Xt||Xt.length>0)&&(Xt=[])}else de=Ty,(!Xt||Xt.length>0)&&(Xt=[]);return Pl(n)}unpackMultiple(e,n){let r,i=0;try{rs=!0;let s=e.length,o=this?this.unpack(e,s):Bl.unpack(e,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Pl(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Pl());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{rs=!1,gd()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Pl(t){try{if(!de.trusted&&!rs){let n=Xt.sharedLength||0;n<Xt.length&&(Xt.length=n)}let e;if(de.randomAccessStructure&&gt[K]<64&&gt[K]>=32&&Oy?(e=Oy(gt,K,br,de),gt=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),K=br):e=$e(),an&&(K=an.postBundlePosition,an=null),rs&&(Xt.restoreStructures=null),K==br)Xt&&Xt.restoreStructures&&Iy(),Xt=null,gt=null,Oi&&(Oi=null);else{if(K>br)throw new Error("Unexpected end of MessagePack data");if(!rs){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Xt&&Xt.restoreStructures&&Iy(),gd(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||K>br)&&(e.incomplete=!0),e}}function Iy(){for(let t in Xt.restoreStructures)Xt[t]=Xt.restoreStructures[t];Xt.restoreStructures=null}function $e(){let t=gt[K++];if(t<160)if(t<128){if(t<64)return t;{let e=Xt[t&63]||de.getStructures&&Cy()[t&63];return e?(e.read||(e.read=fd(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,de.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=By();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return de.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(oi>=K)return ns.slice(K-wr,(K+=e)-wr);if(oi==0&&br<140){let n=e<16?pd(e):Uy(e);if(n!=null)return n}return dd(e)}else{let e;switch(t){case 192:return null;case 193:return an?(e=$e(),e>0?an[1].slice(an.position1,an.position1+=e):an[0].slice(an.position0,an.position0-=e)):Ry;case 194:return!1;case 195:return!0;case 196:if(e=gt[K++],e===void 0)throw new Error("Unexpected end of buffer");return md(e);case 197:return e=Gt.getUint16(K),K+=2,md(e);case 198:return e=Gt.getUint32(K),K+=4,md(e);case 199:return zs(gt[K++]);case 200:return e=Gt.getUint16(K),K+=2,zs(e);case 201:return e=Gt.getUint32(K),K+=4,zs(e);case 202:if(e=Gt.getFloat32(K),de.useFloat32>2){let n=_d[(gt[K]&127)<<1|gt[K+1]>>7];return K+=4,(n*e+(e>0?.5:-.5)>>0)/n}return K+=4,e;case 203:return e=Gt.getFloat64(K),K+=8,e;case 204:return gt[K++];case 205:return e=Gt.getUint16(K),K+=2,e;case 206:return e=Gt.getUint32(K),K+=4,e;case 207:return de.int64AsType==="number"?(e=Gt.getUint32(K)*4294967296,e+=Gt.getUint32(K+4)):de.int64AsType==="string"?e=Gt.getBigUint64(K).toString():de.int64AsType==="auto"?(e=Gt.getBigUint64(K),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Gt.getBigUint64(K),K+=8,e;case 208:return Gt.getInt8(K++);case 209:return e=Gt.getInt16(K),K+=2,e;case 210:return e=Gt.getInt32(K),K+=4,e;case 211:return de.int64AsType==="number"?(e=Gt.getInt32(K)*4294967296,e+=Gt.getUint32(K+4)):de.int64AsType==="string"?e=Gt.getBigInt64(K).toString():de.int64AsType==="auto"?(e=Gt.getBigInt64(K),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Gt.getBigInt64(K),K+=8,e;case 212:if(e=gt[K++],e==114)return $y(gt[K++]&63);{let n=Un[e];if(n)return n.read?(K++,n.read($e())):n.noBuffer?(K++,n()):n(gt.subarray(K,++K));throw new Error("Unknown extension "+e)}case 213:return e=gt[K],e==114?(K++,$y(gt[K++]&63,gt[K++])):zs(2);case 214:return zs(4);case 215:return zs(8);case 216:return zs(16);case 217:return e=gt[K++],oi>=K?ns.slice(K-wr,(K+=e)-wr):II(e);case 218:return e=Gt.getUint16(K),K+=2,oi>=K?ns.slice(K-wr,(K+=e)-wr):NI(e);case 219:return e=Gt.getUint32(K),K+=4,oi>=K?ns.slice(K-wr,(K+=e)-wr):CI(e);case 220:return e=Gt.getUint16(K),K+=2,Ly(e);case 221:return e=Gt.getUint32(K),K+=4,Ly(e);case 222:return e=Gt.getUint16(K),K+=2,My(e);case 223:return e=Gt.getUint32(K),K+=4,My(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const OI=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function fd(t,e){function n(){if(n.count++>Sy){let i=t.read=new Function("r","return function(){return "+(de.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":OI.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")($e);return t.highByte===0&&(t.read=Ny(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=$e()}return de.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?Ny(e,n):n}const Ny=(t,e)=>function(){let n=gt[K++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Xt[r]||Cy()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=fd(i,t)),i.read()};function Cy(){let t=zy(()=>(gt=null,de.getStructures()));return Xt=de._mergeStructures(t,Xt)}var dd=nc,II=nc,NI=nc,CI=nc;function nc(t){let e;if(t<16&&(e=pd(t)))return e;if(t>64&&hd)return hd.decode(gt.subarray(K,K+=t));const n=K+t,r=[];for(e="";K<n;){const i=gt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gt[K++]&63,o=gt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=gt[K++]&63,o=gt[K++]&63,a=gt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=cn.apply(String,r),r.length=0)}return r.length>0&&(e+=cn.apply(String,r)),e}function Ly(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return de.freezeData?Object.freeze(e):e}function My(t){if(de.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=By();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}}var cn=String.fromCharCode;function Uy(t){let e=K,n=new Array(t);for(let r=0;r<t;r++){const i=gt[K++];if((i&128)>0){K=e;return}n[r]=i}return cn.apply(String,n)}function pd(t){if(t<4)if(t<2){if(t===0)return"";{let e=gt[K++];if((e&128)>1){K-=1;return}return cn(e)}}else{let e=gt[K++],n=gt[K++];if((e&128)>0||(n&128)>0){K-=2;return}if(t<3)return cn(e,n);let r=gt[K++];if((r&128)>0){K-=3;return}return cn(e,n,r)}else{let e=gt[K++],n=gt[K++],r=gt[K++],i=gt[K++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(t<6){if(t===4)return cn(e,n,r,i);{let s=gt[K++];if((s&128)>0){K-=5;return}return cn(e,n,r,i,s)}}else if(t<8){let s=gt[K++],o=gt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(t<7)return cn(e,n,r,i,s,o);let a=gt[K++];if((a&128)>0){K-=7;return}return cn(e,n,r,i,s,o,a)}else{let s=gt[K++],o=gt[K++],a=gt[K++],c=gt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(t<10){if(t===8)return cn(e,n,r,i,s,o,a,c);{let l=gt[K++];if((l&128)>0){K-=9;return}return cn(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=gt[K++],u=gt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(t<11)return cn(e,n,r,i,s,o,a,c,l,u);let f=gt[K++];if((f&128)>0){K-=11;return}return cn(e,n,r,i,s,o,a,c,l,u,f)}else{let l=gt[K++],u=gt[K++],f=gt[K++],d=gt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(t<14){if(t===12)return cn(e,n,r,i,s,o,a,c,l,u,f,d);{let h=gt[K++];if((h&128)>0){K-=13;return}return cn(e,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=gt[K++],p=gt[K++];if((h&128)>0||(p&128)>0){K-=14;return}if(t<15)return cn(e,n,r,i,s,o,a,c,l,u,f,d,h,p);let m=gt[K++];if((m&128)>0){K-=15;return}return cn(e,n,r,i,s,o,a,c,l,u,f,d,h,p,m)}}}}}function Fy(){let t=gt[K++],e;if(t<192)e=t-160;else switch(t){case 217:e=gt[K++];break;case 218:e=Gt.getUint16(K),K+=2;break;case 219:e=Gt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return nc(e)}function md(t){return de.copyBuffers?Uint8Array.prototype.slice.call(gt,K,K+=t):gt.subarray(K,K+=t)}function zs(t){let e=gt[K++];if(Un[e]){let n;return Un[e](gt.subarray(K,n=K+=t),r=>{K=r;try{return $e()}finally{K=n}})}else throw new Error("Unknown extension type "+e)}var Py=new Array(4096);function By(){let t=gt[K++];if(t>=160&&t<192){if(t=t-160,oi>=K)return ns.slice(K-wr,(K+=t)-wr);if(!(oi==0&&br<180))return dd(t)}else return K--,Dy($e());let e=(t<<5^(t>1?Gt.getUint16(K):t>0?gt[K]:0))&4095,n=Py[e],r=K,i=K+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Gt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],Py[e]=n,n.bytes=t;r<i;)s=Gt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gt[r++],n.push(s);let a=t<16?pd(t):Uy(t);return a!=null?n.string=a:n.string=dd(t)}function Dy(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const $y=(t,e)=>{let n=$e().map(Dy),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Xt[t];return i&&(i.isShared||rs)&&((Xt.restoreStructures||(Xt.restoreStructures=[]))[t]=i),Xt[t]=n,n.read=fd(n,r),n.read()};Un[0]=()=>{},Un[0].noBuffer=!0,Un[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let LI={Error,TypeError,ReferenceError};Un[101]=()=>{let t=$e();return(LI[t[0]]||Error)(t[1],{cause:t[2]})},Un[105]=t=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Gt.getUint32(K-4);Oi||(Oi=new Map);let n=gt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Oi.set(e,i);let s=$e();return i.used?Object.assign(r,s):(i.target=s,s)},Un[112]=t=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Gt.getUint32(K-4),n=Oi.get(e);return n.used=!0,n.target},Un[115]=()=>new Set($e());const jy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let MI=typeof globalThis=="object"?globalThis:window;Un[116]=t=>{let e=t[0],n=jy[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new MI[n](Uint8Array.prototype.slice.call(t,1).buffer)},Un[120]=()=>{let t=$e();return new RegExp(t[0],t[1])};const UI=[];Un[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=K;return K+=e-t.length,an=UI,an=[Fy(),Fy()],an.position0=0,an.position1=0,an.postBundlePosition=K,K=n,$e()},Un[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function zy(t){let e=br,n=K,r=wr,i=oi,s=ns,o=Oi,a=an,c=new Uint8Array(gt.slice(0,br)),l=Xt,u=Xt.slice(0,Xt.length),f=de,d=rs,h=t();return br=e,K=n,wr=r,oi=i,ns=s,Oi=o,an=a,gt=c,rs=d,Xt=l,Xt.splice(0,Xt.length,...u),de=f,Gt=new DataView(gt.buffer,gt.byteOffset,gt.byteLength),h}function gd(){gt=null,Oi=null,Xt=null}const _d=new Array(147);for(let t=0;t<256;t++)_d[t]=+("1e"+Math.floor(45.15-t*.30103));var Bl=new ec({useRecords:!1});const FI=Bl.unpack;Bl.unpackMultiple,Bl.unpack;let PI=new Float32Array(1);new Uint8Array(PI.buffer,0,4);let Dl;try{Dl=new TextEncoder}catch{}let yd,Ky;const $l=typeof dn<"u",jl=$l?function(t){return dn.allocUnsafeSlow(t)}:Uint8Array,Hy=$l?dn:Uint8Array,Wy=$l?4294967296:2144337920;let q,rc,pe,W=0,An,Ie=null,BI;const DI=21760,$I=/[\u0080-\uFFFF]/,zo=Symbol("record-id");class jI extends ec{constructor(e){super(e),this.offset=0;let n,r,i,s,o=Hy.prototype.utf8Write?function(N,x){return q.utf8Write(N,x,q.byteLength-x)}:Dl&&Dl.encodeInto?function(N,x){return Dl.encodeInto(N,q.subarray(x)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let f=e.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,p=u+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],y=0,b=0;this.pack=this.encode=function(N,x){if(q||(q=new jl(8192),pe=q.dataView||(q.dataView=new DataView(q.buffer,0,8192)),W=0),An=q.length-10,An-W<2048?(q=new jl(q.length),pe=q.dataView||(q.dataView=new DataView(q.buffer,0,q.length)),An=q.length-10,W=0):W=W+7&2147483640,n=W,x&VI&&(W+=x&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof N!="string"?(Ie=[],Ie.size=1/0):Ie=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Z=i.sharedLength||0;if(Z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let $=0;$<Z;$++){let st=i[$];if(!st)continue;let nt,at=i.transitions;for(let G=0,H=st.length;G<H;G++){let bt=st[G];nt=at[bt],nt||(nt=at[bt]=Object.create(null)),at=nt}at[zo]=$+64}this.lastNamedStructuresLength=Z}c||(i.nextId=Z+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&N&&N.constructor&&N.constructor===Object?L(N):A(N);let Z=Ie;if(Ie&&Vy(n,A,0),s&&s.idsToInsert){let $=s.idsToInsert.sort((G,H)=>G.offset>H.offset?1:-1),st=$.length,nt=-1;for(;Z&&st>0;){let G=$[--st].offset+n;G<Z.stringsPosition+n&&nt===-1&&(nt=0),G>Z.position+n?nt>=0&&(nt+=6):(nt>=0&&(pe.setUint32(Z.position+n,pe.getUint32(Z.position+n)+nt),nt=-1),Z=Z.previous,st++)}nt>=0&&Z&&pe.setUint32(Z.position+n,pe.getUint32(Z.position+n)+nt),W+=$.length*6,W>An&&I(W),a.offset=W;let at=KI(q.subarray(n,W),$);return s=null,at}return a.offset=W,x&GI?(q.start=n,q.end=W,q):q.subarray(n,W)}catch(Z){throw B=Z,Z}finally{if(i&&(k(),r&&a.saveStructures)){let Z=i.sharedLength||0,$=q.subarray(n,W),st=HI(i,a);if(!B)return a.saveStructures(st,st.isCompatible)===!1?a.pack(N,x):(a.lastNamedStructuresLength=Z,q.length>1073741824&&(q=null),$)}q.length>1073741824&&(q=null),x&YI&&(W=n)}};const k=()=>{b<10&&b++;let N=i.sharedLength||0;if(i.length>N&&!c&&(i.length=N),y>1e4)i.transitions=null,b=0,y=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let x=0,B=m.length;x<B;x++)m[x][zo]=0;m=[]}},T=N=>{var x=N.length;x<16?q[W++]=144|x:x<65536?(q[W++]=220,q[W++]=x>>8,q[W++]=x&255):(q[W++]=221,pe.setUint32(W,x),W+=4);for(let B=0;B<x;B++)A(N[B])},A=N=>{W>An&&(q=I(W));var x=typeof N,B;if(x==="string"){let Z=N.length;if(Ie&&Z>=4&&Z<4096){if((Ie.size+=Z)>DI){let at,G=(Ie[0]?Ie[0].length*3+Ie[1].length:0)+10;W+G>An&&(q=I(W+G));let H;Ie.position?(H=Ie,q[W]=200,W+=3,q[W++]=98,at=W-n,W+=4,Vy(n,A,0),pe.setUint16(at+n-3,W-n-at)):(q[W++]=214,q[W++]=98,at=W-n,W+=4),Ie=["",""],Ie.previous=H,Ie.size=0,Ie.position=at}let nt=$I.test(N);Ie[nt?0:1]+=N,q[W++]=193,A(nt?-Z:Z);return}let $;Z<32?$=1:Z<256?$=2:Z<65536?$=3:$=5;let st=Z*3;if(W+st>An&&(q=I(W+st)),Z<64||!o){let nt,at,G,H=W+$;for(nt=0;nt<Z;nt++)at=N.charCodeAt(nt),at<128?q[H++]=at:at<2048?(q[H++]=at>>6|192,q[H++]=at&63|128):(at&64512)===55296&&((G=N.charCodeAt(nt+1))&64512)===56320?(at=65536+((at&1023)<<10)+(G&1023),nt++,q[H++]=at>>18|240,q[H++]=at>>12&63|128,q[H++]=at>>6&63|128,q[H++]=at&63|128):(q[H++]=at>>12|224,q[H++]=at>>6&63|128,q[H++]=at&63|128);B=H-W-$}else B=o(N,W+$);B<32?q[W++]=160|B:B<256?($<2&&q.copyWithin(W+2,W+1,W+1+B),q[W++]=217,q[W++]=B):B<65536?($<3&&q.copyWithin(W+3,W+2,W+2+B),q[W++]=218,q[W++]=B>>8,q[W++]=B&255):($<5&&q.copyWithin(W+5,W+3,W+3+B),q[W++]=219,pe.setUint32(W,B),W+=4),W+=B}else if(x==="number")if(N>>>0===N)N<32||N<128&&this.useRecords===!1||N<64&&!this.randomAccessStructure?q[W++]=N:N<256?(q[W++]=204,q[W++]=N):N<65536?(q[W++]=205,q[W++]=N>>8,q[W++]=N&255):(q[W++]=206,pe.setUint32(W,N),W+=4);else if(N>>0===N)N>=-32?q[W++]=256+N:N>=-128?(q[W++]=208,q[W++]=N+256):N>=-32768?(q[W++]=209,pe.setInt16(W,N),W+=2):(q[W++]=210,pe.setInt32(W,N),W+=4);else{let Z;if((Z=this.useFloat32)>0&&N<4294967296&&N>=-2147483648){q[W++]=202,pe.setFloat32(W,N);let $;if(Z<4||($=N*_d[(q[W]&127)<<1|q[W+1]>>7])>>0===$){W+=4;return}else W--}q[W++]=203,pe.setFloat64(W,N),W+=8}else if(x==="object"||x==="function")if(!N)q[W++]=192;else{if(s){let $=s.get(N);if($){if(!$.id){let st=s.idsToInsert||(s.idsToInsert=[]);$.id=st.push($)}q[W++]=214,q[W++]=112,pe.setUint32(W,$.id),W+=4;return}else s.set(N,{offset:W-n})}let Z=N.constructor;if(Z===Object)U(N);else if(Z===Array)T(N);else if(Z===Map)if(this.mapAsEmptyObject)q[W++]=128;else{B=N.size,B<16?q[W++]=128|B:B<65536?(q[W++]=222,q[W++]=B>>8,q[W++]=B&255):(q[W++]=223,pe.setUint32(W,B),W+=4);for(let[$,st]of N)A($),A(st)}else{for(let $=0,st=yd.length;$<st;$++){let nt=Ky[$];if(N instanceof nt){let at=yd[$];if(at.write){at.type&&(q[W++]=212,q[W++]=at.type,q[W++]=0);let ht=at.write.call(this,N);ht===N?Array.isArray(N)?T(N):U(N):A(ht);return}let G=q,H=pe,bt=W;q=null;let lt;try{lt=at.pack.call(this,N,ht=>(q=G,G=null,W+=ht,W>An&&I(W),{target:q,targetView:pe,position:W-ht}),A)}finally{G&&(q=G,pe=H,W=bt,An=q.length-10)}lt&&(lt.length+W>An&&I(lt.length+W),W=zI(lt,q,W,at.type));return}}if(Array.isArray(N))T(N);else{if(N.toJSON){const $=N.toJSON();if($!==N)return A($)}if(x==="function")return A(this.writeFunction&&this.writeFunction(N));U(N)}}}else if(x==="boolean")q[W++]=N?195:194;else if(x==="bigint"){if(N<BigInt(1)<<BigInt(63)&&N>=-(BigInt(1)<<BigInt(63)))q[W++]=211,pe.setBigInt64(W,N);else if(N<BigInt(1)<<BigInt(64)&&N>0)q[W++]=207,pe.setBigUint64(W,N);else if(this.largeBigIntToFloat)q[W++]=203,pe.setFloat64(W,Number(N));else{if(this.largeBigIntToString)return A(N.toString());if(this.useBigIntExtension&&N<BigInt(2)**BigInt(1023)&&N>-(BigInt(2)**BigInt(1023))){q[W++]=199,W++,q[W++]=66;let Z=[],$;do{let st=N&BigInt(255);$=(st&BigInt(128))===(N<BigInt(0)?BigInt(128):BigInt(0)),Z.push(st),N>>=BigInt(8)}while(!((N===BigInt(0)||N===BigInt(-1))&&$));q[W-2]=Z.length;for(let st=Z.length;st>0;)q[W++]=Number(Z[--st]);return}else throw new RangeError(N+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}W+=8}else if(x==="undefined")this.encodeUndefinedAsNil?q[W++]=192:(q[W++]=212,q[W++]=0,q[W++]=0);else throw new Error("Unknown type: "+x)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?N=>{let x;if(this.skipValues){x=[];for(let $ in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty($))&&!this.skipValues.includes(N[$])&&x.push($)}else x=Object.keys(N);let B=x.length;B<16?q[W++]=128|B:B<65536?(q[W++]=222,q[W++]=B>>8,q[W++]=B&255):(q[W++]=223,pe.setUint32(W,B),W+=4);let Z;if(this.coercibleKeyAsNumber)for(let $=0;$<B;$++){Z=x[$];let st=Number(Z);A(isNaN(st)?Z:st),A(N[Z])}else for(let $=0;$<B;$++)A(Z=x[$]),A(N[Z])}:N=>{q[W++]=222;let x=W-n;W+=2;let B=0;for(let Z in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(Z))&&(A(Z),A(N[Z]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');q[x+++n]=B>>8,q[x+n]=B&255},R=this.useRecords===!1?C:e.progressiveRecords&&!d?N=>{let x,B=i.transitions||(i.transitions=Object.create(null)),Z=W++-n,$;for(let st in N)if(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st)){if(x=B[st],x)B=x;else{let nt=Object.keys(N),at=B;B=i.transitions;let G=0;for(let H=0,bt=nt.length;H<bt;H++){let lt=nt[H];x=B[lt],x||(x=B[lt]=Object.create(null),G++),B=x}Z+n+1==W?(W--,D(B,nt,G)):V(B,nt,Z,G),$=!0,B=at[st]}A(N[st])}if(!$){let st=B[zo];st?q[Z+n]=st:V(B,Object.keys(N),Z,0)}}:N=>{let x,B=i.transitions||(i.transitions=Object.create(null)),Z=0;for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&(x=B[st],x||(x=B[st]=Object.create(null),Z++),B=x);let $=B[zo];$?$>=96&&d?(q[W++]=(($-=96)&31)+96,q[W++]=$>>5):q[W++]=$:D(B,B.__keys__||Object.keys(N),Z);for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&A(N[st])},S=typeof this.useRecords=="function"&&this.useRecords,U=S?N=>{S(N)?R(N):C(N)}:R,I=N=>{let x;if(N>16777216){if(N-n>Wy)throw new Error("Packed buffer would be larger than maximum buffer size");x=Math.min(Wy,Math.round(Math.max((N-n)*(N>67108864?1.25:2),4194304)/4096)*4096)}else x=(Math.max(N-n<<2,q.length-1)>>12)+1<<12;let B=new jl(x);return pe=B.dataView||(B.dataView=new DataView(B.buffer,0,x)),N=Math.min(N,q.length),q.copy?q.copy(B,0,n,N):B.set(q.slice(n,N)),W-=n,n=0,An=B.length-10,q=B},D=(N,x,B)=>{let Z=i.nextId;Z||(Z=64),Z<h&&this.shouldShareStructure&&!this.shouldShareStructure(x)?(Z=i.nextOwnId,Z<p||(Z=h),i.nextOwnId=Z+1):(Z>=p&&(Z=h),i.nextId=Z+1);let $=x.highByte=Z>=96&&d?Z-96>>5:-1;N[zo]=Z,N.__keys__=x,i[Z-64]=x,Z<h?(x.isShared=!0,i.sharedLength=Z-63,r=!0,$>=0?(q[W++]=(Z&31)+96,q[W++]=$):q[W++]=Z):($>=0?(q[W++]=213,q[W++]=114,q[W++]=(Z&31)+96,q[W++]=$):(q[W++]=212,q[W++]=114,q[W++]=Z),B&&(y+=b*B),m.length>=f&&(m.shift()[zo]=0),m.push(N),A(x))},V=(N,x,B,Z)=>{let $=q,st=W,nt=An,at=n;q=rc,W=0,n=0,q||(rc=q=new jl(8192)),An=q.length-10,D(N,x,Z),rc=q;let G=W;if(q=$,W=st,An=nt,n=at,G>1){let H=W+G-1;H>An&&I(H);let bt=B+n;q.copyWithin(bt+G,bt+1,W),q.set(rc.slice(0,G),bt),W=H}else q[B+n]=rc[0]},L=N=>{let x=BI(N,q,n,W,i,I,(B,Z,$)=>{if($)return r=!0;W=Z;let st=q;return A(B),k(),st!==q?{position:W,targetView:pe,target:q}:W},this);if(x===0)return U(N);W=x}}useBuffer(e){q=e,q.dataView||(q.dataView=new DataView(q.buffer,q.byteOffset,q.byteLength)),W=0}set position(e){W=e}get position(){return W}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Ky=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Ay],yd=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?Gy(t,16,e):Yy($l?dn.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==Hy&&this.moreTypes?Gy(t,jy.indexOf(n.name),e):Yy(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function Gy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Yy(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function zI(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function KI(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function Vy(t,e,n){if(Ie.length>0){pe.setUint32(Ie.position+t,W+n-Ie.position-t),Ie.stringsPosition=W-t;let r=Ie;Ie=null,e(r[0]),e(r[1])}}function HI(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let Zy=new jI({useRecords:!1});const WI=Zy.pack;Zy.pack;const GI=512,YI=1024,VI=2048,tt=ao("SOFTWARE");function Ae(){return null}function Ko(t,e,n={}){if(!E(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];E(c)&&(a=c(a));const l=e[o];E(l)&&(o=l),a!==null&&r.push(o,a)}return r}function ic(t,e,n={}){if(E(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];E(a)&&(s=a);const c=n[s];E(c)&&(o=c(o)),r[s]=o}return r}catch(r){ue(tt,"","binary",r.message)}}function ZI(t){try{const e=Zn(t);return WI(e)}catch(e){ue(tt,"","binary",e.message)}}function XI(t){try{return FI(t)}catch(e){ue(tt,"","binary",e.message)}}function Xy(){return{id:Be()}}var zl=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.destructible=16]="destructible",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t[t.lightdir=31]="lightdir",t))(zl||{});function Kl(t){return E(t==null?void 0:t.id)?Ko(t,zl,{category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae}):Ko(t,zl,{id:Ae,x:Ae,y:Ae,lx:Ae,ly:Ae,code:Ae,category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae})}function Hl(t){return ic(t,zl)}function wn(t){var e;return(((e=t==null?void 0:t.id)==null?void 0:e.length)??0)>0}function sc(t,e){if(!E(t)||!si(e))return;const{color:n,bg:r}=xy(e);E(n)&&(t.color=n),E(r)&&(t.bg=r)}function is(t){var e;return It((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}const St=60,Yt=25,bd=St*Yt;var _t=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(_t||{});function qI(){return new Array(St*Yt).map(()=>{})}function wd(t=kh){const e={terrain:qI(),objects:{},id:""};return t(e)}var xd=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(xd||{});function JI(t){return Ko(t,xd,{terrain:e=>e.map(Kl),objects:e=>Object.values(e).filter(n=>!n.removed).map(Kl),id:Ae,named:Ae,lookup:Ae,codepage:Ae,distmaps:Ae,overboard:Ae,underboard:Ae})}function QI(t){return ic(t,xd,{terrain:e=>e.map(Hl),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=Hl(e[r]);E(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Wl(t){return Po(t.x,t.y,0,St-1,Yt-1,0)}function Ur(t,e){return!E(t)||!E(e==null?void 0:e.x)||!E(e==null?void 0:e.y)||e.x<0||e.x>=St||e.y<0||e.y>=Yt?-1:e.x+e.y*St}function me(t,e){const n=Ur(t,e);if(n<0||!E(t==null?void 0:t.lookup))return;const r=Rn(t,t.lookup[n]??"");return E(r)?r:t.terrain[n]}function tN(t,e){const n=Rn(t,e);if(E(n))return n;const r=parseFloat(e),i=uI(isNaN(r)?-1:r,St);return Ho(t,i.x,i.y)}function Ho(t,e,n){return(e>=0&&e<St)??(n>=0&&n<Yt)?t==null?void 0:t.terrain[e+n*St]:void 0}function ln(t,e){if(!E(t)||!E(e)||!E(e.x)||!E(e.y)||e.x<0||e.x>=St||e.y<0||e.y>=Yt)return;const n=Zn(e),r=e.x+e.y*St;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function Ed(t,e){if(!E(t)||!E(e))return;const n=Zn(e);return n.id=n.id??Be(),t.objects[n.id]=n,t.objects[n.id]}function eN(t,e,n){return ln(t,{...e,kind:n})}function vd(t,e,n,r){return Ed(t,{...e,kind:n,id:r})}function Rn(t,e){if(t)return t.objects[e]}function nN(t,e){const n=Ur(t,e);if(n<0||!E(t==null?void 0:t.lookup))return;const r=Rn(t,t.lookup[n]??"");if(E(r))return r}function qy(t,e){return E(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function rN(t,e,n){if(!E(t)||!E(e))return;const r=t.objects[n];if(E(r))return r;if($o(e))return tb(e,ac(t,"player"))}function Wo(t,e){const n=t??$t.ISWALK,r=e??$t.ISWALK;switch(n){case $t.ISWALK:return r!==$t.ISWALK;case $t.ISSWIM:return r!==$t.ISSWIM;case $t.ISSOLID:return!0;case $t.ISBULLET:return r!==$t.ISWALK&&r!==$t.ISSWIM}}function oc(t,e,n){const r=t==null?void 0:t.objects[n];if(E(r))return r;const i=ac(t,"player");return E(e)?(e.x<0&&(e.x=yr(0,St-1)),e.y<0&&(e.y=yr(0,Yt-1)),tb(e,i)):Te(...i)}function ac(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(E)}function iN(t){const e=[];for(let n=0;n<Yt;++n)for(let r=0;r<St;++r){const i={x:r,y:n},s=me(t,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&e.push(i)}return e}function Jy(t,e){const n=ud(e),r=vy(e),i=ky(e);return ac(t,n??"").filter(s=>{var o,a,c;return!(E(n)&&It((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||E(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Rt.WHITE)!==r||E(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Rt.BLACK)!==i)}).filter(E)}function Qy(t,e){return E(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(E(i))return i;const s=ac(t,It(n));if(s.length)return s}else if($o(n)&&n.x>=0&&n.x<St&&n.y>=0&&n.y<Yt){const i=n.x+n.y*St,s=(r=t.lookup)==null?void 0:r[i];return E(s)?t.objects[s]:t.terrain[i]}}).flat().filter(E):[]}function tb(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function eb(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}const kd=14,cc=3,ss=8,os=14,Gl=16,sN=16,oN=16;var Yl=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(Yl||{});function Vl(t,e){return new Array(t).fill(e)}function aN(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:Vl(s,0),color:Vl(s,0),bg:Vl(s,i)}}function cN(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:Rt.ONCLEAR}}function lN(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function uN(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:Vl(s,i)}}function hN(t,e,n,r){return{id:`media:${t}:${e}`,type:4,mime:n,media:r}}function fN(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function nb(t,e){return`${t}:${e}`}const dN=1,pN=16,mN=256;var Sn=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Sn||{});function Td(t){const e=Math.floor(t.length/cc);if(e*cc!==t.length)return;const n=eb(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function gN(t,e){return t&1<<e?255:0}function rb(t){const e=Math.floor(t.length/kd);if(e*kd!==t.length)return;const n=Math.ceil(e/Gl),r=ss*Gl,i=eb(r,os*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*os+a,u=t[c];for(let f=0;f<ss;++f){const d=s*ss+f;i.bits[d+l*r]=gN(u,7-f)}++a,a===os&&(a=0,++s,s===Gl&&(s=0,++o))}return i}const _N=ul("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),ib=ul("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var sb=typeof wo=="object"&&wo&&wo.Object===Object&&wo,yN=typeof self=="object"&&self&&self.Object===Object&&self,ai=sb||yN||Function("return this")(),xr=ai.Symbol,ob=Object.prototype,bN=ob.hasOwnProperty,wN=ob.toString,lc=xr?xr.toStringTag:void 0;function xN(t){var e=bN.call(t,lc),n=t[lc];try{t[lc]=void 0;var r=!0}catch{}var i=wN.call(t);return r&&(e?t[lc]=n:delete t[lc]),i}var EN=Object.prototype,vN=EN.toString;function kN(t){return vN.call(t)}var TN="[object Null]",AN="[object Undefined]",ab=xr?xr.toStringTag:void 0;function as(t){return t==null?t===void 0?AN:TN:ab&&ab in Object(t)?xN(t):kN(t)}function Fr(t){return t!=null&&typeof t=="object"}var RN="[object Symbol]";function Zl(t){return typeof t=="symbol"||Fr(t)&&as(t)==RN}function Xl(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Qt=Array.isArray,SN=1/0,cb=xr?xr.prototype:void 0,lb=cb?cb.toString:void 0;function ub(t){if(typeof t=="string")return t;if(Qt(t))return Xl(t,ub)+"";if(Zl(t))return lb?lb.call(t):"";var e=t+"";return e=="0"&&1/t==-SN?"-0":e}var ON=/\s/;function IN(t){for(var e=t.length;e--&&ON.test(t.charAt(e)););return e}var NN=/^\s+/;function CN(t){return t&&t.slice(0,IN(t)+1).replace(NN,"")}function Er(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var hb=NaN,LN=/^[-+]0x[0-9a-f]+$/i,MN=/^0b[01]+$/i,UN=/^0o[0-7]+$/i,FN=parseInt;function PN(t){if(typeof t=="number")return t;if(Zl(t))return hb;if(Er(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Er(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=CN(t);var n=MN.test(t);return n||UN.test(t)?FN(t.slice(2),n?2:8):LN.test(t)?hb:+t}var fb=1/0,BN=17976931348623157e292;function DN(t){if(!t)return t===0?t:0;if(t=PN(t),t===fb||t===-fb){var e=t<0?-1:1;return e*BN}return t===t?t:0}function ql(t){var e=DN(t),n=e%1;return e===e?n?e-n:e:0}function Go(t){return t}var $N="[object AsyncFunction]",jN="[object Function]",zN="[object GeneratorFunction]",KN="[object Proxy]";function Ii(t){if(!Er(t))return!1;var e=as(t);return e==jN||e==zN||e==$N||e==KN}var Ad=ai["__core-js_shared__"],db=function(){var t=/[^.]+$/.exec(Ad&&Ad.keys&&Ad.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function HN(t){return!!db&&db in t}var WN=Function.prototype,GN=WN.toString;function Ks(t){if(t!=null){try{return GN.call(t)}catch{}try{return t+""}catch{}}return""}var YN=/[\\^$.*+?()[\]{}|]/g,VN=/^\[object .+?Constructor\]$/,ZN=Function.prototype,XN=Object.prototype,qN=ZN.toString,JN=XN.hasOwnProperty,QN=RegExp("^"+qN.call(JN).replace(YN,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function tC(t){if(!Er(t)||HN(t))return!1;var e=Ii(t)?QN:VN;return e.test(Ks(t))}function eC(t,e){return t==null?void 0:t[e]}function Hs(t,e){var n=eC(t,e);return tC(n)?n:void 0}var Rd=Hs(ai,"WeakMap"),pb=Object.create,nC=function(){function t(){}return function(e){if(!Er(e))return{};if(pb)return pb(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function rC(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function qe(){}function iC(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var sC=800,oC=16,aC=Date.now;function cC(t){var e=0,n=0;return function(){var r=aC(),i=oC-(r-n);if(n=r,i>0){if(++e>=sC)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function lC(t){return function(){return t}}var Jl=function(){try{var t=Hs(Object,"defineProperty");return t({},"",{}),t}catch{}}(),uC=Jl?function(t,e){return Jl(t,"toString",{configurable:!0,enumerable:!1,value:lC(e),writable:!0})}:Go,hC=cC(uC);function mb(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function gb(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function fC(t){return t!==t}function dC(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Sd(t,e,n){return e===e?dC(t,e,n):gb(t,fC,n)}function _b(t,e){var n=t==null?0:t.length;return!!n&&Sd(t,e,0)>-1}var pC=9007199254740991,mC=/^(?:0|[1-9]\d*)$/;function Ql(t,e){var n=typeof t;return e=e??pC,!!e&&(n=="number"||n!="symbol"&&mC.test(t))&&t>-1&&t%1==0&&t<e}function Od(t,e,n){e=="__proto__"&&Jl?Jl(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function uc(t,e){return t===e||t!==t&&e!==e}var gC=Object.prototype,_C=gC.hasOwnProperty;function tu(t,e,n){var r=t[e];(!(_C.call(t,e)&&uc(r,n))||n===void 0&&!(e in t))&&Od(t,e,n)}function Id(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Od(n,a,c):tu(n,a,c)}return n}var yb=Math.max;function yC(t,e,n){return e=yb(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=yb(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),rC(t,this,a)}}function Nd(t,e){return hC(yC(t,e,Go),t+"")}var bC=9007199254740991;function Cd(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=bC}function ci(t){return t!=null&&Cd(t.length)&&!Ii(t)}function bb(t,e,n){if(!Er(n))return!1;var r=typeof e;return(r=="number"?ci(n)&&Ql(e,n.length):r=="string"&&e in n)?uc(n[e],t):!1}function wC(t){return Nd(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&bb(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var xC=Object.prototype;function hc(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||xC;return t===n}function EC(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var vC="[object Arguments]";function wb(t){return Fr(t)&&as(t)==vC}var xb=Object.prototype,kC=xb.hasOwnProperty,TC=xb.propertyIsEnumerable,eu=wb(function(){return arguments}())?wb:function(t){return Fr(t)&&kC.call(t,"callee")&&!TC.call(t,"callee")};function AC(){return!1}var Eb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,vb=Eb&&typeof module=="object"&&module&&!module.nodeType&&module,RC=vb&&vb.exports===Eb,kb=RC?ai.Buffer:void 0,SC=kb?kb.isBuffer:void 0,fc=SC||AC,OC="[object Arguments]",IC="[object Array]",NC="[object Boolean]",CC="[object Date]",LC="[object Error]",MC="[object Function]",UC="[object Map]",FC="[object Number]",PC="[object Object]",BC="[object RegExp]",DC="[object Set]",$C="[object String]",jC="[object WeakMap]",zC="[object ArrayBuffer]",KC="[object DataView]",HC="[object Float32Array]",WC="[object Float64Array]",GC="[object Int8Array]",YC="[object Int16Array]",VC="[object Int32Array]",ZC="[object Uint8Array]",XC="[object Uint8ClampedArray]",qC="[object Uint16Array]",JC="[object Uint32Array]",xe={};xe[HC]=xe[WC]=xe[GC]=xe[YC]=xe[VC]=xe[ZC]=xe[XC]=xe[qC]=xe[JC]=!0,xe[OC]=xe[IC]=xe[zC]=xe[NC]=xe[KC]=xe[CC]=xe[LC]=xe[MC]=xe[UC]=xe[FC]=xe[PC]=xe[BC]=xe[DC]=xe[$C]=xe[jC]=!1;function QC(t){return Fr(t)&&Cd(t.length)&&!!xe[as(t)]}function nu(t){return function(e){return t(e)}}var Tb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,dc=Tb&&typeof module=="object"&&module&&!module.nodeType&&module,t6=dc&&dc.exports===Tb,Ld=t6&&sb.process,cs=function(){try{var t=dc&&dc.require&&dc.require("util").types;return t||Ld&&Ld.binding&&Ld.binding("util")}catch{}}(),Ab=cs&&cs.isTypedArray,Md=Ab?nu(Ab):QC,e6=Object.prototype,n6=e6.hasOwnProperty;function Rb(t,e){var n=Qt(t),r=!n&&eu(t),i=!n&&!r&&fc(t),s=!n&&!r&&!i&&Md(t),o=n||r||i||s,a=o?EC(t.length,String):[],c=a.length;for(var l in t)(e||n6.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Ql(l,c)))&&a.push(l);return a}function Sb(t,e){return function(n){return t(e(n))}}var r6=Sb(Object.keys,Object),i6=Object.prototype,s6=i6.hasOwnProperty;function Ob(t){if(!hc(t))return r6(t);var e=[];for(var n in Object(t))s6.call(t,n)&&n!="constructor"&&e.push(n);return e}function vr(t){return ci(t)?Rb(t):Ob(t)}var o6=Object.prototype,a6=o6.hasOwnProperty,Fn=wC(function(t,e){if(hc(e)||ci(e)){Id(e,vr(e),t);return}for(var n in e)a6.call(e,n)&&tu(t,n,e[n])});function c6(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var l6=Object.prototype,u6=l6.hasOwnProperty;function h6(t){if(!Er(t))return c6(t);var e=hc(t),n=[];for(var r in t)r=="constructor"&&(e||!u6.call(t,r))||n.push(r);return n}function Ib(t){return ci(t)?Rb(t,!0):h6(t)}var f6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,d6=/^\w*$/;function Ud(t,e){if(Qt(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Zl(t)?!0:d6.test(t)||!f6.test(t)||e!=null&&t in Object(e)}var pc=Hs(Object,"create");function p6(){this.__data__=pc?pc(null):{},this.size=0}function m6(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var g6="__lodash_hash_undefined__",_6=Object.prototype,y6=_6.hasOwnProperty;function b6(t){var e=this.__data__;if(pc){var n=e[t];return n===g6?void 0:n}return y6.call(e,t)?e[t]:void 0}var w6=Object.prototype,x6=w6.hasOwnProperty;function E6(t){var e=this.__data__;return pc?e[t]!==void 0:x6.call(e,t)}var v6="__lodash_hash_undefined__";function k6(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=pc&&e===void 0?v6:e,this}function Ws(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ws.prototype.clear=p6,Ws.prototype.delete=m6,Ws.prototype.get=b6,Ws.prototype.has=E6,Ws.prototype.set=k6;function T6(){this.__data__=[],this.size=0}function ru(t,e){for(var n=t.length;n--;)if(uc(t[n][0],e))return n;return-1}var A6=Array.prototype,R6=A6.splice;function S6(t){var e=this.__data__,n=ru(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():R6.call(e,n,1),--this.size,!0}function O6(t){var e=this.__data__,n=ru(e,t);return n<0?void 0:e[n][1]}function I6(t){return ru(this.__data__,t)>-1}function N6(t,e){var n=this.__data__,r=ru(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Ni(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ni.prototype.clear=T6,Ni.prototype.delete=S6,Ni.prototype.get=O6,Ni.prototype.has=I6,Ni.prototype.set=N6;var mc=Hs(ai,"Map");function C6(){this.size=0,this.__data__={hash:new Ws,map:new(mc||Ni),string:new Ws}}function L6(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function iu(t,e){var n=t.__data__;return L6(e)?n[typeof e=="string"?"string":"hash"]:n.map}function M6(t){var e=iu(this,t).delete(t);return this.size-=e?1:0,e}function U6(t){return iu(this,t).get(t)}function F6(t){return iu(this,t).has(t)}function P6(t,e){var n=iu(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Ci(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ci.prototype.clear=C6,Ci.prototype.delete=M6,Ci.prototype.get=U6,Ci.prototype.has=F6,Ci.prototype.set=P6;var B6="Expected a function";function Fd(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(B6);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Fd.Cache||Ci),n}Fd.Cache=Ci;var D6=500;function $6(t){var e=Fd(t,function(r){return n.size===D6&&n.clear(),r}),n=e.cache;return e}var j6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,z6=/\\(\\)?/g,K6=$6(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(j6,function(n,r,i,s){e.push(i?s.replace(z6,"$1"):r||n)}),e});function Nb(t){return t==null?"":ub(t)}function su(t,e){return Qt(t)?t:Ud(t,e)?[t]:K6(Nb(t))}var H6=1/0;function gc(t){if(typeof t=="string"||Zl(t))return t;var e=t+"";return e=="0"&&1/t==-H6?"-0":e}function Pd(t,e){e=su(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[gc(e[n++])];return n&&n==r?t:void 0}function W6(t,e,n){var r=t==null?void 0:Pd(t,e);return r===void 0?n:r}function Bd(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Cb=xr?xr.isConcatSpreadable:void 0;function G6(t){return Qt(t)||eu(t)||!!(Cb&&t&&t[Cb])}function Dd(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=G6),i||(i=[]);++s<o;){var a=t[s];n(a)?Bd(i,a):r||(i[i.length]=a)}return i}function rr(t){var e=t==null?0:t.length;return e?Dd(t):[]}var Lb=Sb(Object.getPrototypeOf,Object);function $d(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function Y6(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:$d(t,e,n)}var V6="\\ud800-\\udfff",Z6="\\u0300-\\u036f",X6="\\ufe20-\\ufe2f",q6="\\u20d0-\\u20ff",J6=Z6+X6+q6,Q6="\\ufe0e\\ufe0f",tL="\\u200d",eL=RegExp("["+tL+V6+J6+Q6+"]");function Mb(t){return eL.test(t)}function nL(t){return t.split("")}var Ub="\\ud800-\\udfff",rL="\\u0300-\\u036f",iL="\\ufe20-\\ufe2f",sL="\\u20d0-\\u20ff",oL=rL+iL+sL,aL="\\ufe0e\\ufe0f",cL="["+Ub+"]",jd="["+oL+"]",zd="\\ud83c[\\udffb-\\udfff]",lL="(?:"+jd+"|"+zd+")",Fb="[^"+Ub+"]",Pb="(?:\\ud83c[\\udde6-\\uddff]){2}",Bb="[\\ud800-\\udbff][\\udc00-\\udfff]",uL="\\u200d",Db=lL+"?",$b="["+aL+"]?",hL="(?:"+uL+"(?:"+[Fb,Pb,Bb].join("|")+")"+$b+Db+")*",fL=$b+Db+hL,dL="(?:"+[Fb+jd+"?",jd,Pb,Bb,cL].join("|")+")",pL=RegExp(zd+"(?="+zd+")|"+dL+fL,"g");function mL(t){return t.match(pL)||[]}function gL(t){return Mb(t)?mL(t):nL(t)}function _L(t){return function(e){e=Nb(e);var n=Mb(e)?gL(e):void 0,r=n?n[0]:e.charAt(0),i=n?Y6(n,1).join(""):e.slice(1);return r[t]()+i}}var jb=_L("toUpperCase");function yL(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function bL(){this.__data__=new Ni,this.size=0}function wL(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function xL(t){return this.__data__.get(t)}function EL(t){return this.__data__.has(t)}var vL=200;function kL(t,e){var n=this.__data__;if(n instanceof Ni){var r=n.__data__;if(!mc||r.length<vL-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ci(r)}return n.set(t,e),this.size=n.size,this}function li(t){var e=this.__data__=new Ni(t);this.size=e.size}li.prototype.clear=bL,li.prototype.delete=wL,li.prototype.get=xL,li.prototype.has=EL,li.prototype.set=kL;function TL(t,e){return t&&Id(e,vr(e),t)}var zb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Kb=zb&&typeof module=="object"&&module&&!module.nodeType&&module,AL=Kb&&Kb.exports===zb,Hb=AL?ai.Buffer:void 0,Wb=Hb?Hb.allocUnsafe:void 0;function RL(t,e){var n=t.length,r=Wb?Wb(n):new t.constructor(n);return t.copy(r),r}function Kd(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Gb(){return[]}var SL=Object.prototype,OL=SL.propertyIsEnumerable,Yb=Object.getOwnPropertySymbols,Hd=Yb?function(t){return t==null?[]:(t=Object(t),Kd(Yb(t),function(e){return OL.call(t,e)}))}:Gb;function IL(t,e){return Id(t,Hd(t),e)}var NL=Object.getOwnPropertySymbols,CL=NL?function(t){for(var e=[];t;)Bd(e,Hd(t)),t=Lb(t);return e}:Gb;function Vb(t,e,n){var r=e(t);return Qt(t)?r:Bd(r,n(t))}function Wd(t){return Vb(t,vr,Hd)}function LL(t){return Vb(t,Ib,CL)}var Gd=Hs(ai,"DataView"),Yd=Hs(ai,"Promise"),Yo=Hs(ai,"Set"),Zb="[object Map]",ML="[object Object]",Xb="[object Promise]",qb="[object Set]",Jb="[object WeakMap]",Qb="[object DataView]",UL=Ks(Gd),FL=Ks(mc),PL=Ks(Yd),BL=Ks(Yo),DL=Ks(Rd),kr=as;(Gd&&kr(new Gd(new ArrayBuffer(1)))!=Qb||mc&&kr(new mc)!=Zb||Yd&&kr(Yd.resolve())!=Xb||Yo&&kr(new Yo)!=qb||Rd&&kr(new Rd)!=Jb)&&(kr=function(t){var e=as(t),n=e==ML?t.constructor:void 0,r=n?Ks(n):"";if(r)switch(r){case UL:return Qb;case FL:return Zb;case PL:return Xb;case BL:return qb;case DL:return Jb}return e});var $L=Object.prototype,jL=$L.hasOwnProperty;function zL(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&jL.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var ou=ai.Uint8Array;function KL(t){var e=new t.constructor(t.byteLength);return new ou(e).set(new ou(t)),e}function HL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var WL=/\w*$/;function GL(t){var e=new t.constructor(t.source,WL.exec(t));return e.lastIndex=t.lastIndex,e}var t1=xr?xr.prototype:void 0,e1=t1?t1.valueOf:void 0;function YL(t){return e1?Object(e1.call(t)):{}}function VL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var ZL="[object Boolean]",XL="[object Date]",qL="[object Map]",JL="[object Number]",QL="[object RegExp]",t2="[object Set]",e2="[object String]",n2="[object Symbol]",r2="[object ArrayBuffer]",i2="[object DataView]",s2="[object Float32Array]",o2="[object Float64Array]",a2="[object Int8Array]",c2="[object Int16Array]",l2="[object Int32Array]",u2="[object Uint8Array]",h2="[object Uint8ClampedArray]",f2="[object Uint16Array]",d2="[object Uint32Array]";function p2(t,e,n){var r=t.constructor;switch(e){case r2:return KL(t);case ZL:case XL:return new r(+t);case i2:return HL(t);case s2:case o2:case a2:case c2:case l2:case u2:case h2:case f2:case d2:return VL(t);case qL:return new r;case JL:case e2:return new r(t);case QL:return GL(t);case t2:return new r;case n2:return YL(t)}}function m2(t){return typeof t.constructor=="function"&&!hc(t)?nC(Lb(t)):{}}var g2="[object Map]";function _2(t){return Fr(t)&&kr(t)==g2}var n1=cs&&cs.isMap,y2=n1?nu(n1):_2,b2="[object Set]";function w2(t){return Fr(t)&&kr(t)==b2}var r1=cs&&cs.isSet,x2=r1?nu(r1):w2,i1="[object Arguments]",E2="[object Array]",v2="[object Boolean]",k2="[object Date]",T2="[object Error]",s1="[object Function]",A2="[object GeneratorFunction]",R2="[object Map]",S2="[object Number]",o1="[object Object]",O2="[object RegExp]",I2="[object Set]",N2="[object String]",C2="[object Symbol]",L2="[object WeakMap]",M2="[object ArrayBuffer]",U2="[object DataView]",F2="[object Float32Array]",P2="[object Float64Array]",B2="[object Int8Array]",D2="[object Int16Array]",$2="[object Int32Array]",j2="[object Uint8Array]",z2="[object Uint8ClampedArray]",K2="[object Uint16Array]",H2="[object Uint32Array]",ge={};ge[i1]=ge[E2]=ge[M2]=ge[U2]=ge[v2]=ge[k2]=ge[F2]=ge[P2]=ge[B2]=ge[D2]=ge[$2]=ge[R2]=ge[S2]=ge[o1]=ge[O2]=ge[I2]=ge[N2]=ge[C2]=ge[j2]=ge[z2]=ge[K2]=ge[H2]=!0,ge[T2]=ge[s1]=ge[L2]=!1;function au(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!Er(t))return t;var a=Qt(t);if(a)return o=zL(t),iC(t,o);var c=kr(t),l=c==s1||c==A2;if(fc(t))return RL(t);if(c==o1||c==i1||l&&!i)return o=l?{}:m2(t),IL(t,TL(o,t));if(!ge[c])return i?t:{};o=p2(t,c),s||(s=new li);var u=s.get(t);if(u)return u;s.set(t,o),x2(t)?t.forEach(function(h){o.add(au(h,e,n,h,t,s))}):y2(t)&&t.forEach(function(h,p){o.set(p,au(h,e,n,p,t,s))});var f=Wd,d=a?void 0:f(t);return mb(d||t,function(h,p){d&&(p=h,h=t[p]),tu(o,p,au(h,e,n,p,t,s))}),o}var W2=4;function mn(t){return au(t,W2)}function _c(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var G2="__lodash_hash_undefined__";function Y2(t){return this.__data__.set(t,G2),this}function V2(t){return this.__data__.has(t)}function Vo(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ci;++e<n;)this.add(t[e])}Vo.prototype.add=Vo.prototype.push=Y2,Vo.prototype.has=V2;function a1(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Vd(t,e){return t.has(e)}var Z2=1,X2=2;function c1(t,e,n,r,i,s){var o=n&Z2,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var f=-1,d=!0,h=n&X2?new Vo:void 0;for(s.set(t,e),s.set(e,t);++f<a;){var p=t[f],m=e[f];if(r)var y=o?r(m,p,f,e,t,s):r(p,m,f,t,e,s);if(y!==void 0){if(y)continue;d=!1;break}if(h){if(!a1(e,function(b,k){if(!Vd(h,k)&&(p===b||i(p,b,n,r,s)))return h.push(k)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function q2(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Zd(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var J2=1,Q2=2,tM="[object Boolean]",eM="[object Date]",nM="[object Error]",rM="[object Map]",iM="[object Number]",sM="[object RegExp]",oM="[object Set]",aM="[object String]",cM="[object Symbol]",lM="[object ArrayBuffer]",uM="[object DataView]",l1=xr?xr.prototype:void 0,Xd=l1?l1.valueOf:void 0;function hM(t,e,n,r,i,s,o){switch(n){case uM:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case lM:return!(t.byteLength!=e.byteLength||!s(new ou(t),new ou(e)));case tM:case eM:case iM:return uc(+t,+e);case nM:return t.name==e.name&&t.message==e.message;case sM:case aM:return t==e+"";case rM:var a=q2;case oM:var c=r&J2;if(a||(a=Zd),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=Q2,o.set(t,e);var u=c1(a(t),a(e),r,i,s,o);return o.delete(t),u;case cM:if(Xd)return Xd.call(t)==Xd.call(e)}return!1}var fM=1,dM=Object.prototype,pM=dM.hasOwnProperty;function mM(t,e,n,r,i,s){var o=n&fM,a=Wd(t),c=a.length,l=Wd(e),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in e:pM.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var y=o;++f<c;){d=a[f];var b=t[d],k=e[d];if(r)var T=o?r(k,b,d,e,t,s):r(b,k,d,t,e,s);if(!(T===void 0?b===k||i(b,k,n,r,s):T)){m=!1;break}y||(y=d=="constructor")}if(m&&!y){var A=t.constructor,C=e.constructor;A!=C&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var gM=1,u1="[object Arguments]",h1="[object Array]",cu="[object Object]",_M=Object.prototype,f1=_M.hasOwnProperty;function yM(t,e,n,r,i,s){var o=Qt(t),a=Qt(e),c=o?h1:kr(t),l=a?h1:kr(e);c=c==u1?cu:c,l=l==u1?cu:l;var u=c==cu,f=l==cu,d=c==l;if(d&&fc(t)){if(!fc(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new li),o||Md(t)?c1(t,e,n,r,i,s):hM(t,e,c,n,r,i,s);if(!(n&gM)){var h=u&&f1.call(t,"__wrapped__"),p=f&&f1.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,y=p?e.value():e;return s||(s=new li),i(m,y,n,r,s)}}return d?(s||(s=new li),mM(t,e,n,r,i,s)):!1}function qd(t,e,n,r,i){return t===e?!0:t==null||e==null||!Fr(t)&&!Fr(e)?t!==t&&e!==e:yM(t,e,n,r,qd,i)}var bM=1,wM=2;function xM(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new li,f;if(!(f===void 0?qd(l,c,bM|wM,r,u):f))return!1}}return!0}function d1(t){return t===t&&!Er(t)}function EM(t){for(var e=vr(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,d1(i)]}return e}function p1(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function vM(t){var e=EM(t);return e.length==1&&e[0][2]?p1(e[0][0],e[0][1]):function(n){return n===t||xM(n,t,e)}}function kM(t,e){return t!=null&&e in Object(t)}function m1(t,e,n){e=su(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=gc(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Cd(i)&&Ql(o,i)&&(Qt(t)||eu(t)))}function TM(t,e){return t!=null&&m1(t,e,kM)}var AM=1,RM=2;function SM(t,e){return Ud(t)&&d1(e)?p1(gc(t),e):function(n){var r=W6(n,t);return r===void 0&&r===e?TM(n,t):qd(e,r,AM|RM)}}function OM(t){return function(e){return e==null?void 0:e[t]}}function IM(t){return function(e){return Pd(e,t)}}function NM(t){return Ud(t)?OM(gc(t)):IM(t)}function ui(t){return typeof t=="function"?t:t==null?Go:typeof t=="object"?Qt(t)?SM(t[0],t[1]):vM(t):NM(t)}function CM(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function LM(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var MM=LM();function UM(t,e){return t&&MM(t,e,vr)}function FM(t,e){return function(n,r){if(n==null)return n;if(!ci(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var Gs=FM(UM);function PM(t,e,n,r){return Gs(t,function(i,s,o){e(r,i,n(i),o)}),r}function BM(t,e){return function(n,r){var i=Qt(n)?CM:PM,s=e?e():{};return i(n,t,ui(r),s)}}var g1=Object.prototype,DM=g1.hasOwnProperty,Jd=Nd(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&bb(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Ib(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||uc(u,g1[l])&&!DM.call(t,l))&&(t[l]=s[l])}return t});function _1(t){return Fr(t)&&ci(t)}var $M=200;function jM(t,e,n,r){var i=-1,s=_b,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=$M&&(s=Vd,o=!1,e=new Vo(e));t:for(;++i<a;){var u=t[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(e[d]===f)continue t;c.push(u)}else s(e,f,r)||c.push(u)}return c}var lu=Nd(function(t,e){return _1(t)?jM(t,Dd(e,1,_1,!0)):[]});function Zo(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function gn(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ql(e),$d(t,e<0?0:e,r)):[]}function yc(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ql(e),e=r-e,$d(t,0,e<0?0:e)):[]}function zM(t){return typeof t=="function"?t:Go}function Nt(t,e){var n=Qt(t)?mb:Gs;return n(t,zM(e))}function KM(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function HM(t,e){var n=!0;return Gs(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function Pr(t,e,n){var r=Qt(t)?KM:HM;return r(t,ui(e))}function y1(t,e){var n=[];return Gs(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Tr(t,e){var n=Qt(t)?Kd:y1;return n(t,ui(e))}function WM(t){return function(e,n,r){var i=Object(e);if(!ci(e)){var s=ui(n);e=vr(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var GM=Math.max;function YM(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:ql(n);return i<0&&(i=GM(r+i,0)),gb(t,ui(e),i)}var Xo=WM(YM);function Br(t){return t&&t.length?t[0]:void 0}function VM(t,e){var n=-1,r=ci(t)?Array(t.length):[];return Gs(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function Et(t,e){var n=Qt(t)?Xl:VM;return n(t,ui(e))}function Ar(t,e){return Dd(Et(t,e))}var ZM=Object.prototype,XM=ZM.hasOwnProperty,b1=BM(function(t,e,n){XM.call(t,n)?t[n].push(e):Od(t,n,[e])}),qM=Object.prototype,JM=qM.hasOwnProperty;function QM(t,e){return t!=null&&JM.call(t,e)}function Ot(t,e){return t!=null&&m1(t,e,QM)}var t8="[object String]";function Pn(t){return typeof t=="string"||!Qt(t)&&Fr(t)&&as(t)==t8}function e8(t,e){return Xl(e,function(n){return t[n]})}function He(t){return t==null?[]:e8(t,vr(t))}var n8=Math.max;function On(t,e,n,r){t=ci(t)?t:He(t),n=n&&!r?ql(n):0;var i=t.length;return n<0&&(n=n8(i+n,0)),Pn(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Sd(t,e,n)>-1}function w1(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return Sd(t,e,i)}var r8="[object Map]",i8="[object Set]",s8=Object.prototype,o8=s8.hasOwnProperty;function _e(t){if(t==null)return!0;if(ci(t)&&(Qt(t)||typeof t=="string"||typeof t.splice=="function"||fc(t)||Md(t)||eu(t)))return!t.length;var e=kr(t);if(e==r8||e==i8)return!t.size;if(hc(t))return!Ob(t).length;for(var n in t)if(o8.call(t,n))return!1;return!0}var a8="[object RegExp]";function c8(t){return Fr(t)&&as(t)==a8}var x1=cs&&cs.isRegExp,Li=x1?nu(x1):c8;function Mi(t){return t===void 0}var l8="Expected a function";function u8(t){if(typeof t!="function")throw new TypeError(l8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function h8(t,e,n,r){if(!Er(t))return t;e=su(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=gc(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=Er(u)?u:Ql(e[i+1])?[]:{})}tu(a,c,l),a=a[c]}return t}function f8(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Pd(t,o);n(a,o)&&h8(s,su(o,t),a)}return s}function Dr(t,e){if(t==null)return{};var n=Xl(LL(t),function(r){return[r]});return e=ui(e),f8(t,n,function(r,i){return e(r,i[0])})}function d8(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Bn(t,e,n){var r=Qt(t)?yL:d8,i=arguments.length<3;return r(t,ui(e),n,i,Gs)}function uu(t,e){var n=Qt(t)?Kd:y1;return n(t,u8(ui(e)))}function p8(t,e){var n;return Gs(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function Qd(t,e,n){var r=Qt(t)?a1:p8;return r(t,ui(e))}var m8=1/0,g8=Yo&&1/Zd(new Yo([,-0]))[1]==m8?function(t){return new Yo(t)}:qe,_8=200;function y8(t,e,n){var r=-1,i=_b,s=t.length,o=!0,a=[],c=a;if(s>=_8){var l=g8(t);if(l)return Zd(l);o=!1,i=Vd,c=new Vo}else c=a;t:for(;++r<s;){var u=t[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function hu(t){return t&&t.length?y8(t):[]}function t0(t){console&&console.error&&console.error(`Error: ${t}`)}function E1(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function v1(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function k1(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function b8(t){return w8(t)?t.LABEL:t.name}function w8(t){return Pn(t.LABEL)&&t.LABEL!==""}class hi{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Nt(this.definition,n=>{n.accept(e)})}}class Dn extends hi{constructor(e){super([]),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class qo extends hi{constructor(e){super(e.definition),this.orgText="",Fn(this,Dr(e,n=>n!==void 0))}}class $n extends hi{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Fn(this,Dr(e,n=>n!==void 0))}}class jn extends hi{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class fi extends hi{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class di extends hi{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class Je extends hi{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class $r extends hi{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class jr extends hi{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Fn(this,Dr(e,n=>n!==void 0))}}class Ne{constructor(e){this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}accept(e){e.visit(this)}}function x8(t){return Et(t,fu)}function fu(t){function e(n){return Et(n,fu)}if(t instanceof Dn){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Pn(t.label)&&(n.label=t.label),n}else{if(t instanceof $n)return{type:"Alternative",definition:e(t.definition)};if(t instanceof jn)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof fi)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof di)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:fu(new Ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof $r)return{type:"RepetitionWithSeparator",idx:t.idx,separator:fu(new Ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Je)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof jr)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Ne){const n={type:"Terminal",name:t.terminalType.name,label:b8(t.terminalType),idx:t.idx};Pn(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Li(r)?r.source:r),n}else{if(t instanceof qo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Ys{visit(e){const n=e;switch(n.constructor){case Dn:return this.visitNonTerminal(n);case $n:return this.visitAlternative(n);case jn:return this.visitOption(n);case fi:return this.visitRepetitionMandatory(n);case di:return this.visitRepetitionMandatoryWithSeparator(n);case $r:return this.visitRepetitionWithSeparator(n);case Je:return this.visitRepetition(n);case jr:return this.visitAlternation(n);case Ne:return this.visitTerminal(n);case qo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function E8(t){return t instanceof $n||t instanceof jn||t instanceof Je||t instanceof fi||t instanceof di||t instanceof $r||t instanceof Ne||t instanceof qo}function du(t,e=[]){return t instanceof jn||t instanceof Je||t instanceof $r?!0:t instanceof jr?Qd(t.definition,r=>du(r,e)):t instanceof Dn&&On(e,t)?!1:t instanceof hi?(t instanceof Dn&&e.push(t),Pr(t.definition,r=>du(r,e))):!1}function v8(t){return t instanceof jr}function pi(t){if(t instanceof Dn)return"SUBRULE";if(t instanceof jn)return"OPTION";if(t instanceof jr)return"OR";if(t instanceof fi)return"AT_LEAST_ONE";if(t instanceof di)return"AT_LEAST_ONE_SEP";if(t instanceof $r)return"MANY_SEP";if(t instanceof Je)return"MANY";if(t instanceof Ne)return"CONSUME";throw Error("non exhaustive match")}class pu{walk(e,n=[]){Nt(e.definition,(r,i)=>{const s=gn(e.definition,i+1);if(r instanceof Dn)this.walkProdRef(r,s,n);else if(r instanceof Ne)this.walkTerminal(r,s,n);else if(r instanceof $n)this.walkFlat(r,s,n);else if(r instanceof jn)this.walkOption(r,s,n);else if(r instanceof fi)this.walkAtLeastOne(r,s,n);else if(r instanceof di)this.walkAtLeastOneSep(r,s,n);else if(r instanceof $r)this.walkManySep(r,s,n);else if(r instanceof Je)this.walkMany(r,s,n);else if(r instanceof jr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new jn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=T1(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new jn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=T1(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Nt(e.definition,s=>{const o=new $n({definition:[s]});this.walk(o,i)})}}function T1(t,e,n){return[new jn({definition:[new Ne({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function bc(t){if(t instanceof Dn)return bc(t.referencedRule);if(t instanceof Ne)return A8(t);if(E8(t))return k8(t);if(v8(t))return T8(t);throw Error("non exhaustive match")}function k8(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=du(s),e=e.concat(bc(s)),r=r+1,i=n.length>r;return hu(e)}function T8(t){const e=Et(t.definition,n=>bc(n));return hu(rr(e))}function A8(t){return[t.terminalType]}const A1="_~IN~_";class R8 extends pu{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=O8(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new $n({definition:s}),a=bc(o);this.follows[i]=a}}function S8(t){const e={};return Nt(t,n=>{const r=new R8(n).startWalking();Fn(e,r)}),e}function O8(t,e){return t.name+e+A1}function Ct(t){return t.charCodeAt(0)}function e0(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function wc(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Jo(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function I8(){throw Error("Internal Error - Should never get here!")}function R1(t){return t.type==="Character"}const mu=[];for(let t=Ct("0");t<=Ct("9");t++)mu.push(t);const gu=[Ct("_")].concat(mu);for(let t=Ct("a");t<=Ct("z");t++)gu.push(t);for(let t=Ct("A");t<=Ct("Z");t++)gu.push(t);const S1=[Ct(" "),Ct("\f"),Ct(`
`),Ct("\r"),Ct("	"),Ct("\v"),Ct("	"),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct("\u2028"),Ct("\u2029"),Ct(" "),Ct(" "),Ct("　"),Ct("\uFEFF")],N8=/[0-9a-fA-F]/,_u=/[0-9]/,C8=/[1-9]/;class L8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":wc(r,"global");break;case"i":wc(r,"ignoreCase");break;case"m":wc(r,"multiLine");break;case"u":wc(r,"unicode");break;case"y":wc(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Jo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return I8()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Jo(n);break}if(!(e===!0&&n===void 0)&&Jo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Jo(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ct(`
`),Ct("\r"),Ct("\u2028"),Ct("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=mu;break;case"D":e=mu,n=!0;break;case"s":e=S1;break;case"S":e=S1,n=!0;break;case"w":e=gu;break;case"W":e=gu,n=!0;break}if(Jo(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Ct("\f");break;case"n":e=Ct(`
`);break;case"r":e=Ct("\r");break;case"t":e=Ct("	");break;case"v":e=Ct("\v");break}if(Jo(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ct("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Ct(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Ct(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,R1(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,R1(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else e0(r.value,e),e.push(Ct("-")),e0(i.value,e)}else e0(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ct("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(C8.test(e)===!1)throw Error("Expecting a positive integer");for(;_u.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(_u.test(e)===!1)throw Error("Expecting an integer");for(;_u.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ct(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return _u.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(N8.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class n0{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let yu={};const M8=new L8;function bu(t){const e=t.toString();if(yu.hasOwnProperty(e))return yu[e];{const n=M8.pattern(e);return yu[e]=n,n}}function U8(){yu={}}const O1="Complement Sets are not supported for first char optimization",wu=`Unable to use "first char" lexer optimizations:
`;function F8(t,e=!1){try{const n=bu(t);return r0(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===O1)e&&E1(`${wu}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),t0(`${wu}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function r0(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)r0(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":xu(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(O1);Nt(o.value,c=>{if(typeof c=="number")xu(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)xu(u,e,n);else{for(let u=l.from;u<=l.to&&u<Ec;u++)xu(u,e,n);if(l.to>=Ec){const u=l.from>=Ec?l.from:Ec,f=l.to,d=ls(u),h=ls(f);for(let p=d;p<=h;p++)e[p]=p}}}});break;case"Group":r0(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&i0(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return He(e)}function xu(t,e,n){const r=ls(t);e[r]=r,n===!0&&P8(t,e)}function P8(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=ls(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=ls(i.charCodeAt(0));e[s]=s}}}function I1(t,e){return Xo(t.value,n=>{if(typeof n=="number")return On(e,n);{const r=n;return Xo(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function i0(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Qt(t.value)?Pr(t.value,i0):i0(t.value):!1}class B8 extends n0{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){On(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?I1(e,this.targetCharCodes)===void 0&&(this.found=!0):I1(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function s0(t,e){if(e instanceof RegExp){const n=bu(e),r=new B8(t);return r.visit(n),r.found}else return Xo(e,n=>On(t,n.charCodeAt(0)))!==void 0}const Vs="PATTERN",xc="defaultMode",Eu="modes";let N1=typeof new RegExp("(?:)").sticky=="boolean";function D8(t,e){e=Jd(e,{useSticky:N1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(k,T)=>T()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{c3()});let r;n("Reject Lexer.NA",()=>{r=uu(t,k=>k[Vs]===Qe.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Et(r,k=>{const T=k[Vs];if(Li(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!On(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?L1(T):C1(T)}else{if(Ii(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(A);return e.useSticky?L1(C):C1(C)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Et(r,k=>k.tokenTypeIdx),a=Et(r,k=>{const T=k.GROUP;if(T!==Qe.SKIPPED){if(Pn(T))return T;if(Mi(T))return!1;throw Error("non exhaustive match")}}),c=Et(r,k=>{const T=k.LONGER_ALT;if(T)return Qt(T)?Et(T,C=>w1(r,C)):[w1(r,T)]}),l=Et(r,k=>k.PUSH_MODE),u=Et(r,k=>Ot(k,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const k=F1(e.lineTerminatorCharacters);f=Et(r,T=>!1),e.positionTracking!=="onlyOffset"&&(f=Et(r,T=>Ot(T,"LINE_BREAKS")?!!T.LINE_BREAKS:U1(T,k)===!1&&s0(k,T.PATTERN)))});let d,h,p,m;n("Misc Mapping #2",()=>{d=Et(r,M1),h=Et(s,s3),p=Bn(r,(k,T)=>{const A=T.GROUP;return Pn(A)&&A!==Qe.SKIPPED&&(k[A]=[]),k},{}),m=Et(s,(k,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let y=!0,b=[];return e.safeMode||n("First Char Optimization",()=>{b=Bn(r,(k,T,A)=>{if(typeof T.PATTERN=="string"){const C=T.PATTERN.charCodeAt(0),R=ls(C);o0(k,R,m[A])}else if(Qt(T.START_CHARS_HINT)){let C;Nt(T.START_CHARS_HINT,R=>{const S=typeof R=="string"?R.charCodeAt(0):R,U=ls(S);C!==U&&(C=U,o0(k,U,m[A]))})}else if(Li(T.PATTERN))if(T.PATTERN.unicode)y=!1,e.ensureOptimizations&&t0(`${wu}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=F8(T.PATTERN,e.ensureOptimizations);_e(C)&&(y=!1),Nt(C,R=>{o0(k,R,m[A])})}else e.ensureOptimizations&&t0(`${wu}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),y=!1;return k},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:b,hasCustom:i,canBeOptimized:y}}function $8(t,e){let n=[];const r=z8(t);n=n.concat(r.errors);const i=K8(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(j8(s)),n=n.concat(q8(s)),n=n.concat(J8(s,e)),n=n.concat(Q8(s)),n}function j8(t){let e=[];const n=Tr(t,r=>Li(r[Vs]));return e=e.concat(W8(n)),e=e.concat(V8(n)),e=e.concat(Z8(n)),e=e.concat(X8(n)),e=e.concat(G8(n)),e}function z8(t){const e=Tr(t,i=>!Ot(i,Vs)),n=Et(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ue.MISSING_PATTERN,tokenTypes:[i]})),r=lu(t,e);return{errors:n,valid:r}}function K8(t){const e=Tr(t,i=>{const s=i[Vs];return!Li(s)&&!Ii(s)&&!Ot(s,"exec")&&!Pn(s)}),n=Et(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ue.INVALID_PATTERN,tokenTypes:[i]})),r=lu(t,e);return{errors:n,valid:r}}const H8=/[^\\][$]/;function W8(t){class e extends n0{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Tr(t,i=>{const s=i.PATTERN;try{const o=bu(s),a=new e;return a.visit(o),a.found}catch{return H8.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ue.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function G8(t){const e=Tr(t,r=>r.PATTERN.test(""));return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ue.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const Y8=/[^\\[][\^]|^\^/;function V8(t){class e extends n0{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Tr(t,i=>{const s=i.PATTERN;try{const o=bu(s),a=new e;return a.visit(o),a.found}catch{return Y8.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ue.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Z8(t){const e=Tr(t,r=>{const i=r[Vs];return i instanceof RegExp&&(i.multiline||i.global)});return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ue.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function X8(t){const e=[];let n=Et(t,s=>Bn(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!On(e,a)&&a.PATTERN!==Qe.NA&&(e.push(a),o.push(a)),o),[]));n=_c(n);const r=Tr(n,s=>s.length>1);return Et(r,s=>{const o=Et(s,c=>c.name);return{message:`The same RegExp pattern ->${Br(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ue.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function q8(t){const e=Tr(t,r=>{if(!Ot(r,"GROUP"))return!1;const i=r.GROUP;return i!==Qe.SKIPPED&&i!==Qe.NA&&!Pn(i)});return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ue.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function J8(t,e){const n=Tr(t,i=>i.PUSH_MODE!==void 0&&!On(e,i.PUSH_MODE));return Et(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ue.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function Q8(t){const e=[],n=Bn(t,(r,i,s)=>{const o=i.PATTERN;return o===Qe.NA||(Pn(o)?r.push({str:o,idx:s,tokenType:i}):Li(o)&&e3(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Nt(t,(r,i)=>{Nt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&t3(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Ue.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function t3(t,e){if(Li(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Ii(e))return e(t,0,[],{});if(Ot(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function e3(t){return Xo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function C1(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function L1(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function n3(t,e,n){const r=[];return Ot(t,xc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+xc+`> property in its definition
`,type:Ue.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ot(t,Eu)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Eu+`> property in its definition
`,type:Ue.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ot(t,Eu)&&Ot(t,xc)&&!Ot(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${xc}: <${t.defaultMode}>which does not exist
`,type:Ue.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ot(t,Eu)&&Nt(t.modes,(i,s)=>{Nt(i,(o,a)=>{if(Mi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ue.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ot(o,"LONGER_ALT")){const c=Qt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Nt(c,l=>{!Mi(l)&&!On(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ue.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function r3(t,e,n){const r=[];let i=!1;const s=_c(rr(He(t.modes))),o=uu(s,c=>c[Vs]===Qe.NA),a=F1(n);return e&&Nt(o,c=>{const l=U1(c,a);if(l!==!1){const f={message:a3(c,l),type:l.issue,tokenType:c};r.push(f)}else Ot(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):s0(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ue.NO_LINE_BREAKS_FLAGS}),r}function i3(t){const e={},n=vr(t);return Nt(n,r=>{const i=t[r];if(Qt(i))e[r]=[];else throw Error("non exhaustive match")}),e}function M1(t){const e=t.PATTERN;if(Li(e))return!1;if(Ii(e))return!0;if(Ot(e,"exec"))return!0;if(Pn(e))return!1;throw Error("non exhaustive match")}function s3(t){return Pn(t)&&t.length===1?t.charCodeAt(0):!1}const o3={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function U1(t,e){if(Ot(t,"LINE_BREAKS"))return!1;if(Li(t.PATTERN)){try{s0(e,t.PATTERN)}catch(n){return{issue:Ue.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Pn(t.PATTERN))return!1;if(M1(t))return{issue:Ue.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function a3(t,e){if(e.issue===Ue.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Ue.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function F1(t){return Et(t,n=>Pn(n)?n.charCodeAt(0):n)}function o0(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Ec=256;let vu=[];function ls(t){return t<Ec?t:vu[t]}function c3(){if(_e(vu)){vu=new Array(65536);for(let t=0;t<65536;t++)vu[t]=t>255?255+~~(t/255):t}}function vc(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function ku(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let P1=1;const B1={};function kc(t){const e=l3(t);u3(e),f3(e),h3(e),Nt(e,n=>{n.isParent=n.categoryMatches.length>0})}function l3(t){let e=mn(t),n=t,r=!0;for(;r;){n=_c(rr(Et(n,s=>s.CATEGORIES)));const i=lu(n,e);e=e.concat(i),_e(i)?r=!1:n=i}return e}function u3(t){Nt(t,e=>{$1(e)||(B1[P1]=e,e.tokenTypeIdx=P1++),j1(e)&&!Qt(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),j1(e)||(e.CATEGORIES=[]),d3(e)||(e.categoryMatches=[]),p3(e)||(e.categoryMatchesMap={})})}function h3(t){Nt(t,e=>{e.categoryMatches=[],Nt(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(B1[r].tokenTypeIdx)})})}function f3(t){Nt(t,e=>{D1([],e)})}function D1(t,e){Nt(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Nt(e.CATEGORIES,n=>{const r=t.concat(e);On(r,n)||D1(r,n)})}function $1(t){return Ot(t,"tokenTypeIdx")}function j1(t){return Ot(t,"CATEGORIES")}function d3(t){return Ot(t,"categoryMatches")}function p3(t){return Ot(t,"categoryMatchesMap")}function m3(t){return Ot(t,"tokenTypeIdx")}const g3={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var Ue;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ue||(Ue={}));const Tc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:g3,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Tc);let Qe=class{constructor(e,n=Tc){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=v1(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Fn({},Tc,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Tc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=o3;else if(this.config.lineTerminatorCharacters===Tc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Qt(e)?i={modes:{defaultMode:mn(e)},defaultMode:xc}:(s=!1,i=mn(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(n3(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(r3(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Nt(i.modes,(a,c)=>{i.modes[c]=uu(a,l=>Mi(l))});const o=vr(i.modes);if(Nt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat($8(a,o))}),_e(this.lexerDefinitionErrors)){kc(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=D8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Fn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!_e(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Et(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Nt(this.lexerDefinitionWarning,a=>{E1(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(N1?(this.chopInput=Go,this.match=this.matchWithTest):(this.updateLastIndex=qe,this.match=this.matchWithExec),s&&(this.handleModes=qe),this.trackStartLines===!1&&(this.computeNewColumn=Go),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=qe),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Bn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!_e(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{U8()}),this.TRACE_INIT("toFastProperties",()=>{k1(this)})})}tokenize(e,n=this.defaultMode){if(!_e(this.lexerDefinitionErrors)){const i=Et(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,y,b;const k=e,T=k.length;let A=0,C=0;const R=this.hasCustom?0:Math.floor(e.length/10),S=new Array(R),U=[];let I=this.trackStartLines?1:void 0,D=this.trackStartLines?1:void 0;const V=i3(this.emptyGroups),L=this.trackStartLines,N=this.config.lineTerminatorsPattern;let x=0,B=[],Z=[];const $=[],st=[];Object.freeze(st);let nt;function at(){return B}function G(Dt){const re=ls(Dt),Ft=Z[re];return Ft===void 0?st:Ft}const H=Dt=>{if($.length===1&&Dt.tokenType.PUSH_MODE===void 0){const re=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Dt);U.push({offset:Dt.startOffset,line:Dt.startLine,column:Dt.startColumn,length:Dt.image.length,message:re})}else{$.pop();const re=Zo($);B=this.patternIdxToConfig[re],Z=this.charCodeToPatternIdxToConfig[re],x=B.length;const Ft=this.canModeBeOptimized[re]&&this.config.safeMode===!1;Z&&Ft?nt=G:nt=at}};function bt(Dt){$.push(Dt),Z=this.charCodeToPatternIdxToConfig[Dt],B=this.patternIdxToConfig[Dt],x=B.length,x=B.length;const re=this.canModeBeOptimized[Dt]&&this.config.safeMode===!1;Z&&re?nt=G:nt=at}bt.call(this,n);let lt;const ht=this.config.recoveryEnabled;for(;A<T;){c=null;const Dt=k.charCodeAt(A),re=nt(Dt),Ft=re.length;for(r=0;r<Ft;r++){lt=re[r];const Mt=lt.pattern;l=null;const oe=lt.short;if(oe!==!1?Dt===oe&&(c=Mt):lt.isCustom===!0?(b=Mt.exec(k,A,S,V),b!==null?(c=b[0],b.payload!==void 0&&(l=b.payload)):c=null):(this.updateLastIndex(Mt,A),c=this.match(Mt,e,A)),c!==null){if(a=lt.longerAlt,a!==void 0){const Wt=a.length;for(s=0;s<Wt;s++){const Re=B[a[s]],Pe=Re.pattern;if(u=null,Re.isCustom===!0?(b=Pe.exec(k,A,S,V),b!==null?(o=b[0],b.payload!==void 0&&(u=b.payload)):o=null):(this.updateLastIndex(Pe,A),o=this.match(Pe,e,A)),o&&o.length>c.length){c=o,l=u,lt=Re;break}}}break}}if(c!==null){if(f=c.length,d=lt.group,d!==void 0&&(h=lt.tokenTypeIdx,p=this.createTokenInstance(c,A,h,lt.tokenType,I,D,f),this.handlePayload(p,l),d===!1?C=this.addToken(S,C,p):V[d].push(p)),e=this.chopInput(e,f),A=A+f,D=this.computeNewColumn(D,f),L===!0&&lt.canLineTerminator===!0){let Mt=0,oe,Wt;N.lastIndex=0;do oe=N.test(c),oe===!0&&(Wt=N.lastIndex-1,Mt++);while(oe===!0);Mt!==0&&(I=I+Mt,D=f-Wt,this.updateTokenEndLineColumnLocation(p,d,Wt,Mt,I,D,f))}this.handleModes(lt,H,bt,p)}else{const Mt=A,oe=I,Wt=D;let Re=ht===!1;for(;Re===!1&&A<T;)for(e=this.chopInput(e,1),A++,i=0;i<x;i++){const Pe=B[i],v=Pe.pattern,ot=Pe.short;if(ot!==!1?k.charCodeAt(A)===ot&&(Re=!0):Pe.isCustom===!0?Re=v.exec(k,A,S,V)!==null:(this.updateLastIndex(v,A),Re=v.exec(e)!==null),Re===!0)break}if(m=A-Mt,D=this.computeNewColumn(D,m),y=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(k,Mt,m,oe,Wt),U.push({offset:Mt,line:oe,column:Wt,length:m,message:y}),ht===!1)break}}return this.hasCustom||(S.length=C),{tokens:S,groups:V,errors:U}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};Qe.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Qe.NA=/NOT_APPLICABLE/;function Ac(t){return z1(t)?t.LABEL:t.name}function z1(t){return Pn(t.LABEL)&&t.LABEL!==""}const _3="parent",K1="categories",H1="label",W1="group",G1="push_mode",Y1="pop_mode",V1="longer_alt",Z1="line_breaks",X1="start_chars_hint";function ir(t){return y3(t)}function y3(t){const e=t.pattern,n={};if(n.name=t.name,Mi(e)||(n.PATTERN=e),Ot(t,_3))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ot(t,K1)&&(n.CATEGORIES=t[K1]),kc([n]),Ot(t,H1)&&(n.LABEL=t[H1]),Ot(t,W1)&&(n.GROUP=t[W1]),Ot(t,Y1)&&(n.POP_MODE=t[Y1]),Ot(t,G1)&&(n.PUSH_MODE=t[G1]),Ot(t,V1)&&(n.LONGER_ALT=t[V1]),Ot(t,Z1)&&(n.LINE_BREAKS=t[Z1]),Ot(t,X1)&&(n.START_CHARS_HINT=t[X1]),n}const Zs=ir({name:"EOF",pattern:Qe.NA});kc([Zs]);function Tu(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function b3(t,e){return vc(t,e)}const q1={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${z1(t)?`--> ${Ac(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Br(e).image+"'";if(r)return s+r+a;{const c=Bn(t,(d,h)=>d.concat(h),[]),l=Et(c,d=>`[${Et(d,h=>Ac(h)).join(", ")}]`),f=`one of these possible Token sequences:
${Et(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Br(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Et(t,l=>`[${Et(l,u=>Ac(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(q1);const w3={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Xs={buildDuplicateFoundError(t,e){function n(u){return u instanceof Ne?u.terminalType.name:u instanceof Dn?u.nonTerminalName:""}const r=t.name,i=Br(e),s=i.idx,o=pi(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=Et(t.prefixPath,i=>Ac(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=Et(t.prefixPath,i=>Ac(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=pi(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=Et(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof qo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function x3(t,e){const n=new E3(t,e);return n.resolveRefs(),n.errors}class E3 extends Ys{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Nt(He(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:In.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class v3 extends pu{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=mn(this.path.ruleStack).reverse(),this.occurrenceStack=mn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){_e(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class k3 extends v3{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new $n({definition:i});this.possibleTokTypes=bc(s),this.found=!0}}}class Au extends pu{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class T3 extends Au{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Br(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class J1 extends Au{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Br(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class A3 extends Au{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Br(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class Q1 extends Au{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Br(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function a0(t,e,n=[]){n=mn(n);let r=[],i=0;function s(a){return a.concat(gn(t,i+1))}function o(a){const c=a0(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof $n)return o(a.definition);if(a instanceof Dn)return o(a.definition);if(a instanceof jn)r=o(a.definition);else if(a instanceof fi){const c=a.definition.concat([new Je({definition:a.definition})]);return o(c)}else if(a instanceof di){const c=[new $n({definition:a.definition}),new Je({definition:[new Ne({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof $r){const c=a.definition.concat([new Je({definition:[new Ne({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Je){const c=a.definition.concat([new Je({definition:a.definition})]);r=o(c)}else{if(a instanceof jr)return Nt(a.definition,c=>{_e(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ne)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:gn(t,i)}),r}function tw(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!_e(f);){const d=f.pop();if(d===o){a&&Zo(f).idx<=l&&f.pop();continue}const h=d.def,p=d.idx,m=d.ruleStack,y=d.occurrenceStack;if(_e(h))continue;const b=h[0];if(b===i){const k={idx:p,def:gn(h),ruleStack:yc(m),occurrenceStack:yc(y)};f.push(k)}else if(b instanceof Ne)if(p<c-1){const k=p+1,T=e[k];if(n(T,b.terminalType)){const A={idx:k,def:gn(h),ruleStack:m,occurrenceStack:y};f.push(A)}}else if(p===c-1)u.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:m,occurrenceStack:y}),a=!0;else throw Error("non exhaustive match");else if(b instanceof Dn){const k=mn(m);k.push(b.nonTerminalName);const T=mn(y);T.push(b.idx);const A={idx:p,def:b.definition.concat(s,gn(h)),ruleStack:k,occurrenceStack:T};f.push(A)}else if(b instanceof jn){const k={idx:p,def:gn(h),ruleStack:m,occurrenceStack:y};f.push(k),f.push(o);const T={idx:p,def:b.definition.concat(gn(h)),ruleStack:m,occurrenceStack:y};f.push(T)}else if(b instanceof fi){const k=new Je({definition:b.definition,idx:b.idx}),T=b.definition.concat([k],gn(h)),A={idx:p,def:T,ruleStack:m,occurrenceStack:y};f.push(A)}else if(b instanceof di){const k=new Ne({terminalType:b.separator}),T=new Je({definition:[k].concat(b.definition),idx:b.idx}),A=b.definition.concat([T],gn(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:y};f.push(C)}else if(b instanceof $r){const k={idx:p,def:gn(h),ruleStack:m,occurrenceStack:y};f.push(k),f.push(o);const T=new Ne({terminalType:b.separator}),A=new Je({definition:[T].concat(b.definition),idx:b.idx}),C=b.definition.concat([A],gn(h)),R={idx:p,def:C,ruleStack:m,occurrenceStack:y};f.push(R)}else if(b instanceof Je){const k={idx:p,def:gn(h),ruleStack:m,occurrenceStack:y};f.push(k),f.push(o);const T=new Je({definition:b.definition,idx:b.idx}),A=b.definition.concat([T],gn(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:y};f.push(C)}else if(b instanceof jr)for(let k=b.definition.length-1;k>=0;k--){const T=b.definition[k],A={idx:p,def:T.definition.concat(gn(h)),ruleStack:m,occurrenceStack:y};f.push(A),f.push(o)}else if(b instanceof $n)f.push({idx:p,def:b.definition.concat(gn(h)),ruleStack:m,occurrenceStack:y});else if(b instanceof qo)f.push(R3(b,p,m,y));else throw Error("non exhaustive match")}return u}function R3(t,e,n,r){const i=mn(n);i.push(t.name);const s=mn(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Fe;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Fe||(Fe={}));function ew(t){if(t instanceof jn||t==="Option")return Fe.OPTION;if(t instanceof Je||t==="Repetition")return Fe.REPETITION;if(t instanceof fi||t==="RepetitionMandatory")return Fe.REPETITION_MANDATORY;if(t instanceof di||t==="RepetitionMandatoryWithSeparator")return Fe.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof $r||t==="RepetitionWithSeparator")return Fe.REPETITION_WITH_SEPARATOR;if(t instanceof jr||t==="Alternation")return Fe.ALTERNATION;throw Error("non exhaustive match")}function S3(t,e,n,r,i,s){const o=l0(t,e,n),a=sw(o)?ku:vc;return s(o,r,a,i)}function O3(t,e,n,r,i,s){const o=u0(t,e,i,n),a=sw(o)?ku:vc;return s(o[0],a,r)}function I3(t,e,n,r){const i=t.length,s=Pr(t,o=>Pr(o,a=>a.length===1));if(e)return function(o){const a=Et(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],p=h.length;for(let m=0;m<p;m++){const y=this.LA(m+1);if(n(y,h[m])===!1)continue t}return c}}};if(s&&!r){const o=Et(t,c=>rr(c)),a=Bn(o,(c,l,u)=>(Nt(l,f=>{Ot(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Nt(f.categoryMatches,d=>{Ot(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function N3(t,e,n){const r=Pr(t,s=>s.length===1),i=t.length;if(r&&!n){const s=rr(t);if(s.length===1&&_e(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Bn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Nt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue t}return!0}return!1}}class C3 extends pu{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,Fe.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,Fe.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,Fe.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,Fe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class nw extends Ys{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Fe.OPTION)}visitRepetition(e){this.checkIsTarget(e,Fe.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Fe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Fe.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Fe.ALTERNATION)}}function rw(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function c0(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function L3(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function iw(t,e){const n=Et(t,o=>a0([o],1)),r=rw(n.length),i=Et(n,o=>{const a={};return Nt(o,c=>{const l=c0(c.partialPath);Nt(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=rw(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=c0(f);if(L3(i,h,c)||_e(d)||f.length===e){const m=r[c];if(h0(m,f)===!1){m.push(f);for(let y=0;y<h.length;y++){const b=h[y];i[c][b]=!0}}}else{const m=a0(d,o+1,f);s[c]=s[c].concat(m),Nt(m,y=>{const b=c0(y.partialPath);Nt(b,k=>{i[c][k]=!0})})}}}}return r}function l0(t,e,n,r){const i=new nw(t,Fe.ALTERNATION,r);return e.accept(i),iw(i.result,n)}function u0(t,e,n,r){const i=new nw(t,n);e.accept(i);const s=i.result,a=new C3(e,t,n).startWalking(),c=new $n({definition:s}),l=new $n({definition:a});return iw([c,l],r)}function h0(t,e){t:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function M3(t,e){return t.length<e.length&&Pr(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function sw(t){return Pr(t,e=>Pr(e,n=>Pr(n,r=>_e(r.categoryMatches))))}function U3(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return Et(e,n=>Object.assign({type:In.CUSTOM_LOOKAHEAD_VALIDATION},n))}function F3(t,e,n,r){const i=Ar(t,c=>P3(c,n)),s=Z3(t,e,n),o=Ar(t,c=>W3(c,n)),a=Ar(t,c=>$3(c,t,r,n));return i.concat(s,o,a)}function P3(t,e){const n=new D3;t.accept(n);const r=n.allProductions,i=b1(r,B3),s=Dr(i,a=>a.length>1);return Et(He(s),a=>{const c=Br(a),l=e.buildDuplicateFoundError(t,a),u=pi(c),f={message:l,type:In.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=ow(c);return d&&(f.parameter=d),f})}function B3(t){return`${pi(t)}_#_${t.idx}_#_${ow(t)}`}function ow(t){return t instanceof Ne?t.terminalType.name:t instanceof Dn?t.nonTerminalName:""}class D3 extends Ys{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function $3(t,e,n,r){const i=[];if(Bn(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:In.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function j3(t,e,n){const r=[];let i;return On(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:In.INVALID_RULE_OVERRIDE,ruleName:t})),r}function aw(t,e,n,r=[]){const i=[],s=Ru(e.definition);if(_e(s))return[];{const o=t.name;On(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:In.LEFT_RECURSION,ruleName:o});const c=lu(s,r.concat([t])),l=Ar(c,u=>{const f=mn(r);return f.push(u),aw(t,u,n,f)});return i.concat(l)}}function Ru(t){let e=[];if(_e(t))return e;const n=Br(t);if(n instanceof Dn)e.push(n.referencedRule);else if(n instanceof $n||n instanceof jn||n instanceof fi||n instanceof di||n instanceof $r||n instanceof Je)e=e.concat(Ru(n.definition));else if(n instanceof jr)e=rr(Et(n.definition,s=>Ru(s.definition)));else if(!(n instanceof Ne))throw Error("non exhaustive match");const r=du(n),i=t.length>1;if(r&&i){const s=gn(t);return e.concat(Ru(s))}else return e}class f0 extends Ys{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function z3(t,e){const n=new f0;t.accept(n);const r=n.alternations;return Ar(r,s=>{const o=yc(s.definition);return Ar(o,(a,c)=>{const l=tw([a],[],vc,1);return _e(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:In.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function K3(t,e,n){const r=new f0;t.accept(r);let i=r.alternations;return i=uu(i,o=>o.ignoreAmbiguities===!0),Ar(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=l0(a,t,c,o),u=Y3(l,o,t,n),f=V3(l,o,t,n);return u.concat(f)})}class H3 extends Ys{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function W3(t,e){const n=new f0;t.accept(n);const r=n.alternations;return Ar(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:In.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function G3(t,e,n){const r=[];return Nt(t,i=>{const s=new H3;i.accept(s);const o=s.allProductions;Nt(o,a=>{const c=ew(a),l=a.maxLookahead||e,u=a.idx,d=u0(u,i,c,l)[0];if(_e(rr(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:In.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function Y3(t,e,n,r){const i=[],s=Bn(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Nt(c,u=>{const f=[l];Nt(t,(d,h)=>{l!==h&&h0(d,u)&&e.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!h0(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return Et(s,a=>{const c=Et(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:In.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function V3(t,e,n,r){const i=Bn(t,(o,a,c)=>{const l=Et(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return _c(Ar(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Tr(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&M3(d.path,l));return Et(u,d=>{const h=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:d.path}),type:In.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function Z3(t,e,n){const r=[],i=Et(e,s=>s.name);return Nt(t,s=>{const o=s.name;if(On(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:In.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function X3(t){const e=Jd(t,{errMsgProvider:w3}),n={};return Nt(t.rules,r=>{n[r.name]=r}),x3(n,e.errMsgProvider)}function q3(t){return t=Jd(t,{errMsgProvider:Xs}),F3(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const cw="MismatchedTokenException",lw="NoViableAltException",uw="EarlyExitException",hw="NotAllInputParsedException",fw=[cw,lw,uw,hw];Object.freeze(fw);function Su(t){return On(fw,t.name)}class Ou extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class dw extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=cw}}class J3 extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=lw}}class Q3 extends Ou{constructor(e,n){super(e,n),this.name=hw}}class tU extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=uw}}const d0={},pw="InRuleRecoveryException";class eU extends Error{constructor(e){super(e),this.name=pw}}class nU{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ot(e,"recoveryEnabled")?e.recoveryEnabled:Ui.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=rU)}getTokenToInsert(e){const n=Tu(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new dw(h,l,this.LA(0));p.resyncedTokens=yc(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new eU("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||_e(n))return!1;const r=this.LA(1);return Xo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return On(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Xo(e,s=>b3(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return d0;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Et(e,(r,i)=>i===0?d0:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Et(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return rr(e)}getFollowSetFromFollowKey(e){if(e===d0)return[Zs];const n=e.ruleName+e.idxInCallingRule+A1+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Zs)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return yc(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=mn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Et(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function rU(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=Zs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const iU=4,us=8,mw=1<<us,gw=2<<us,p0=3<<us,m0=4<<us,g0=5<<us,Iu=6<<us;function _0(t,e,n){return n|e|t}class sU{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Ui.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(_e(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Ar(e,n=>aw(n,n,Xs))}validateEmptyOrAlternatives(e){return Ar(e,n=>z3(n,Xs))}validateAmbiguousAlternationAlternatives(e,n){return Ar(e,r=>K3(r,n,Xs))}validateSomeNonEmptyLookaheadPath(e,n){return G3(e,n,Xs)}buildLookaheadForAlternation(e){return S3(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,I3)}buildLookaheadForOptional(e){return O3(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,ew(e.prodType),N3)}}class oU{initLooksAhead(e){this.dynamicTokensEnabled=Ot(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Ui.dynamicTokensEnabled,this.maxLookahead=Ot(e,"maxLookahead")?e.maxLookahead:Ui.maxLookahead,this.lookaheadStrategy=Ot(e,"lookaheadStrategy")?e.lookaheadStrategy:new sU({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Nt(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=cU(n);Nt(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${pi(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=_0(this.fullRuleNameToShort[n.name],mw,l.idx);this.setLaFuncCache(d,f)})}),Nt(i,l=>{this.computeLookaheadFunc(n,l.idx,p0,"Repetition",l.maxLookahead,pi(l))}),Nt(s,l=>{this.computeLookaheadFunc(n,l.idx,gw,"Option",l.maxLookahead,pi(l))}),Nt(o,l=>{this.computeLookaheadFunc(n,l.idx,m0,"RepetitionMandatory",l.maxLookahead,pi(l))}),Nt(a,l=>{this.computeLookaheadFunc(n,l.idx,Iu,"RepetitionMandatoryWithSeparator",l.maxLookahead,pi(l))}),Nt(c,l=>{this.computeLookaheadFunc(n,l.idx,g0,"RepetitionWithSeparator",l.maxLookahead,pi(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=_0(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return _0(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class aU extends Ys{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Nu=new aU;function cU(t){Nu.reset(),t.accept(Nu);const e=Nu.dslMethods;return Nu.reset(),e}function _w(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function yw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function lU(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function uU(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const hU="name";function bw(t,e){Object.defineProperty(t,hU,{enumerable:!1,configurable:!0,writable:!1,value:e})}function fU(t,e){const n=vr(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function dU(t,e){const n=function(){};bw(n,t+"BaseSemantics");const r={visit:function(i,s){if(Qt(i)&&(i=i[0]),!Mi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=mU(this,e);if(!_e(i)){const s=Et(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function pU(t,e,n){const r=function(){};bw(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Nt(e,s=>{i[s]=fU}),r.prototype=i,r.prototype.constructor=r,r}var y0;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(y0||(y0={}));function mU(t,e){return gU(t,e)}function gU(t,e){const n=Tr(e,i=>Ii(t[i])===!1),r=Et(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:y0.MISSING_METHOD,methodName:i}));return _c(r)}class _U{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Ot(e,"nodeLocationTracking")?e.nodeLocationTracking:Ui.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=qe,this.cstFinallyStateUpdate=qe,this.cstPostTerminal=qe,this.cstPostNonTerminal=qe,this.cstPostRule=qe;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=yw,this.setNodeLocationFromNode=yw,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=_w,this.setNodeLocationFromNode=_w,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=qe,this.setInitialNodeLocation=qe;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];lU(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];uU(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Mi(this.baseCstVisitorConstructor)){const e=dU(this.className,vr(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Mi(this.baseCstVisitorWithDefaultsConstructor)){const e=pU(this.className,vr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class yU{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Mu}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Mu:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class bU{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Uu){if(On(this.definedRulesNames,e)){const o={message:Xs.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:In.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Uu){const i=j3(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Su(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return x8(He(this.gastProductionsCache))}}class wU{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ku,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ot(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Qt(e)){if(_e(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Qt(e))this.tokensMap=Bn(e,(s,o)=>(s[o.name]=o,s),{});else if(Ot(e,"modes")&&Pr(rr(He(e.modes)),m3)){const s=rr(He(e.modes)),o=hu(s);this.tokensMap=Bn(o,(a,c)=>(a[c.name]=c,a),{})}else if(Er(e))this.tokensMap=mn(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Zs;const r=Ot(e,"modes")?rr(He(e.modes)):He(e),i=Pr(r,s=>_e(s.categoryMatches));this.tokenMatcher=i?ku:vc,kc(He(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ot(r,"resyncEnabled")?r.resyncEnabled:Uu.resyncEnabled,s=Ot(r,"recoveryValueFunc")?r.recoveryValueFunc:Uu.recoveryValueFunc,o=this.ruleShortNameIdx<<iU+us;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Su(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(gw,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(m0,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Fe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,m0,e,A3)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Iu,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Q1],a,Iu,e,Q1)}else throw this.raiseEarlyExitException(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(p0,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,p0,e,T3,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(g0,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,J1],a,g0,e,J1)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Iu,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(mw,n),i=Qt(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Q3(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Su(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new dw(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===pw?r:s}}else throw r}saveRecogState(){const e=this.errors,n=mn(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Zs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class xU{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Ot(e,"errorMessageProvider")?e.errorMessageProvider:Ui.errorMessageProvider}SAVE_ERROR(e){if(Su(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:mn(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return mn(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=u0(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new tU(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=l0(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new J3(c,this.LA(1),a))}}class EU{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Mi(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return tw([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Br(e.ruleStack),i=this.getGAstProductions()[n];return new k3(i,e).startWalking()}}const Cu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Cu);const ww=!0,xw=Math.pow(2,us)-1,Ew=ir({name:"RECORDING_PHASE_TOKEN",pattern:Qe.NA});kc([Ew]);const vw=Tu(Ew,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(vw);const vU={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class kU{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Mu}topLevelRuleRecord(e,n){try{const r=new qo({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Rc.call(this,jn,e,n)}atLeastOneInternalRecord(e,n){Rc.call(this,fi,n,e)}atLeastOneSepFirstInternalRecord(e,n){Rc.call(this,di,n,e,ww)}manyInternalRecord(e,n){Rc.call(this,Je,n,e)}manySepFirstInternalRecord(e,n){Rc.call(this,$r,n,e,ww)}orInternalRecord(e,n){return TU.call(this,e,n)}subruleInternalRecord(e,n,r){if(Lu(n),!e||Ot(e,"ruleName")===!1){const a=new Error(`<SUBRULE${kw(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Zo(this.recordingProdStack),s=e.ruleName,o=new Dn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?vU:Cu}consumeInternalRecord(e,n,r){if(Lu(n),!$1(e)){const o=new Error(`<CONSUME${kw(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Zo(this.recordingProdStack),s=new Ne({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),vw}}function Rc(t,e,n,r=!1){Lu(n);const i=Zo(this.recordingProdStack),s=Ii(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),Ot(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Cu}function TU(t,e){Lu(e);const n=Zo(this.recordingProdStack),r=Qt(t)===!1,i=r===!1?t:t.DEF,s=new jr({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});Ot(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=Qd(i,a=>Ii(a.GATE));return s.hasPredicates=o,n.definition.push(s),Nt(i,a=>{const c=new $n({definition:[]});s.definition.push(c),Ot(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ot(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Cu}function kw(t){return t===0?"":`${t}`}function Lu(t){if(t<0||t>xw){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${xw+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class AU{initPerformanceTracer(e){if(Ot(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ui.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=v1(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function RU(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Mu=Tu(Zs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Mu);const Ui=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:q1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Uu=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var In;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(In||(In={}));let b0=class DE{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{k1(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Nt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=X3({rules:He(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(_e(r)&&this.skipValidations===!1){const i=q3({rules:He(this.gastProductionsCache),tokenTypes:He(this.tokensMap),errMsgProvider:Xs,grammarName:n}),s=U3({lookaheadStrategy:this.lookaheadStrategy,rules:He(this.gastProductionsCache),tokenTypes:He(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),_e(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=S8(He(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:He(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(He(this.gastProductionsCache))})),!DE.DEFER_DEFINITION_ERRORS_HANDLING&&!_e(this.definitionErrors))throw e=Et(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Ot(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ot(n,"skipValidations")?n.skipValidations:Ui.skipValidations}};b0.DEFER_DEFINITION_ERRORS_HANDLING=!1,RU(b0,[nU,oU,_U,yU,wU,bU,xU,EU,kU,AU]);class SU extends b0{constructor(e,n=Ui){const r=mn(n);r.outputCst=!0,super(e,r)}}function OU(t){const e=new IU,n=He(t);return Et(n,r=>e.visitRule(r))}class IU extends Ys{visitRule(e){const n=this.visitEach(e.definition),r=b1(n,s=>s.propertyName),i=Et(r,(s,o)=>{const a=!Qd(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Et(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Fu(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Fu(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Fu(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Fu(e)}]}visitEachAndOverrideWith(e,n){return Et(this.visitEach(e),r=>Fn({},r,n))}visitEach(e){return rr(Et(e,n=>this.visit(n)))}}function Fu(t){return t instanceof Dn?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function NU(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(rr(Et(t,r=>CU(r)))),e.includeVisitorInterface&&(n=n.concat(FU(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function CU(t){const e=LU(t),n=MU(t);return[e,n]}function LU(t){const e=Aw(t.name),n=w0(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function MU(t){return`export type ${w0(t.name)} = {
  ${Et(t.properties,n=>UU(n)).join(`
  `)}
};`}function UU(t){const e=BU(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function FU(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Et(e,n=>PU(n)).join(`
  `)}
}`}function PU(t){const e=w0(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function BU(t){if(Qt(t)){const e=hu(Et(t,r=>Tw(r)));return"("+Bn(e,(r,i)=>r+" | "+i)+")"}else return Tw(t)}function Tw(t){return t.kind==="token"?"IToken":Aw(t.name)}function Aw(t){return jb(t)+"CstNode"}function w0(t){return jb(t)+"CstChildren"}const DU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function $U(t,e){const n=Object.assign(Object.assign({},DU),e),r=OU(t);return NU(r,n)}const mi=!!JSON.parse("false"),jU=!!JSON.parse("false");JSON.parse("false");const zU=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Fi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return ss*Fi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return os*Fi.DRAW_CHAR_SCALE}},Pu=dy(32,126).map(t=>String.fromCharCode(t));function Ht(t){return ir({...t,name:`token_${t.name}`})}function hs(t,e=!1){return Ht(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:_n,group:Qe.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:_n})}const Sc=Ht({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),KU=Ht({name:"whitespace",pattern:/ +/,group:Qe.SKIPPED}),HU=Ht({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Qe.SKIPPED}),x0=Ht({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Qo=Ht({name:"command",pattern:/#/,start_chars_hint:["#"]});let Rw=!1;function WU(t,e,n){if(!Rw)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Sc)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const Sw=Ht({name:"text",pattern:WU,line_breaks:!1,start_chars_hint:Pu.filter(t=>"@#/?':!".includes(t)===!1)}),Ow=Ht({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Iw=Ht({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Nw=Ht({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Cw=Ht({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),_n=Ht({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:Pu}),Lw=Ht({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Mw=Ht({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Uw=Ht({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:_n}),Fw=Ht({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:_n}),Pw=Ht({name:"islessthan",pattern:/<|below/,longer_alt:_n}),Bw=Ht({name:"isgreaterthan",pattern:/>|above/,longer_alt:_n}),Dw=Ht({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:_n}),$w=Ht({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:_n}),E0=Ht({name:"or",pattern:/or/i,longer_alt:_n}),v0=Ht({name:"not",pattern:/not/i,longer_alt:_n}),k0=Ht({name:"and",pattern:/and/i,longer_alt:_n}),T0=Ht({name:"plus",pattern:/\+/}),A0=Ht({name:"minus",pattern:/-/}),jw=Ht({name:"power",pattern:/\*\*/}),zw=Ht({name:"multiply",pattern:/\*/}),R0=Ht({name:"divide",pattern:/\//}),Kw=Ht({name:"moddivide",pattern:/%/}),Hw=Ht({name:"floordivide",pattern:/%%/}),Ww=Ht({name:"query",pattern:/\?/}),Gw=Ht({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Yw=Ht({name:"rparen",pattern:/\)/,pop_mode:!0}),Vw=Ht({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Pu,longer_alt:_n}),Zw=Ht({name:"command_toast",pattern:/toast .*/,start_chars_hint:Pu,longer_alt:_n}),S0=Ht({name:"if",pattern:/if|try|take|give/,longer_alt:_n}),Bu=hs("do"),O0=hs("done"),I0=hs("else"),Xw=hs("while"),qw=hs("repeat"),Jw=hs("waitfor"),Qw=Ht({name:"foreach",pattern:/foreach|for/,longer_alt:_n}),tx=hs("break"),ex=hs("continue");function nx(t){return[...t,Mw,Uw,Fw,Dw,Pw,$w,Bw,E0,v0,k0,T0,A0,jw,zw,R0,Hw,Kw,Ww,Gw,Yw,Lw,_n]}const rx=nx([Sw,x0,Vw,Zw,Qo,Ow,Iw,Nw,Cw,Sc,KU,tx,ex,O0,Bu,I0,Qw,S0,qw,Jw,Xw]),GU=new Qe({defaultMode:"use_newlines",modes:{use_newlines:rx,ignore_newlines:nx([HU])}},{skipValidations:!mi,ensureOptimizations:mi,positionTracking:"full"});function ix(t){Rw=!0;const e=GU.tokenize(t||` 
`),[n]=(ae(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Tu(Sc,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function YU(t,e,n=!0){if(n){const[r,...i]=e;switch(It(r??"")){default:return{type:vt.OBJECT,values:e};case"loader":return{type:vt.LOADER,values:i};case"board":return{type:vt.BOARD,values:i};case"object":return{type:vt.OBJECT,values:i};case"terrain":return{type:vt.TERRAIN,values:i};case"charset":return{type:vt.CHARSET,values:i};case"palette":return{type:vt.PALETTE,values:i}}}else{const[r,i,...s]=e,o=It(i??""),a=[r,t,...s];switch(o){default:return{type:vt.CONST,values:e};case"rn":case"range":return{type:vt.RANGE,values:a};case"sl":case"select":return{type:vt.SELECT,values:a};case"nm":case"number":return{type:vt.NUMBER,values:a};case"tx":case"text":return{type:vt.TEXT,values:a};case"hk":case"hotkey":return{type:vt.HOTKEY,values:a};case"copyit":return{type:vt.COPYIT,values:a};case"openit":return{type:vt.OPENIT,values:a};case"zssedit":return{type:vt.ZSSEDIT,values:a};case"charedit":return{type:vt.CHAREDIT,values:a};case"coloredit":return{type:vt.COLOREDIT,values:a}}}}function sr(t){switch(t){case vt.LOADER:return"loader";case vt.BOARD:return"board";case vt.OBJECT:return"object";case vt.TERRAIN:return"terrain";case vt.CHARSET:return"charset";case vt.PALETTE:return"palette";case vt.CONST:return"const";case vt.RANGE:return"range";case vt.SELECT:return"select";case vt.NUMBER:return"number";case vt.TEXT:return"text";case vt.HOTKEY:return"hotkey";case vt.COPYIT:return"copyit";case vt.OPENIT:return"openit";case vt.ZSSEDIT:return"zssedit";case vt.CHAREDIT:return"charedit";case vt.COLOREDIT:return"coloredit"}}var N0=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(N0||{});function sx(t){return Ko(t,N0,{bits:e=>Array.from(e)})}function ox(t){return ic(t,N0,{bits:e=>new Uint8Array(e)})}function VU(t,e){return{id:Be(),code:t,...e}}var C0=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(C0||{});function ZU(t){return Ko(t,C0,{board:JI,object:Kl,terrain:Kl,charset:sx,palette:sx,stats:Ae})}function XU(t){return ic(t,C0,{board:QI,object:Hl,terrain:Hl,charset:ox,palette:ox})}function Oc(t){const e={...qs(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function qU(t){return E(t)?(t.stats=void 0,qs(t)):{}}function ax(t){const e=ix(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===x0){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=YU(wt(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case vt.LOADER:n.type=_t.LOADER,n.name=f;break;case vt.BOARD:n.type=_t.BOARD,n.name=f;break;case vt.OBJECT:n.type=_t.OBJECT,n.name=f||"object";break;case vt.TERRAIN:n.type=_t.TERRAIN,n.name=f;break;case vt.CHARSET:n.type=_t.CHARSET,n.name=f;break;case vt.PALETTE:n.type=_t.PALETTE,n.name=f;break;case vt.CONST:{const[d,h]=u.values;if(wt(d)){const p=It(d);if(wt(h)){const m=parseFloat(h);n[p]=At(m)?m:h}else At(h)?n[p]=h:n[p]=1}break}case vt.RANGE:case vt.SELECT:case vt.NUMBER:case vt.TEXT:case vt.HOTKEY:case vt.ZSSEDIT:case vt.CHAREDIT:case vt.COLOREDIT:{const[d,...h]=u.values;if(wt(d)){const p=It(d);n[p]=[sr(u.type),...h]}break}}}}return n}function qs(t){var e;return E(t)?(E((e=t.stats)==null?void 0:e.type)||(t.stats=ax(t.code),E(t.stats.type)||(t.stats.type=_t.OBJECT)),t.stats):{}}function cx(t){switch(t){default:case _t.ERROR:return"error";case _t.LOADER:return sr(vt.LOADER);case _t.BOARD:return sr(vt.BOARD);case _t.OBJECT:return sr(vt.OBJECT);case _t.TERRAIN:return sr(vt.TERRAIN);case _t.CHARSET:return sr(vt.CHARSET);case _t.PALETTE:return sr(vt.PALETTE)}}function Pi(t){return qs(t).type??_t.ERROR}function fs(t){return cx(Pi(t))}function We(t){return qs(t).name??""}function L0(t,e){return qs(t)[e]}const Du=new sd;function M0(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!ae(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"lightdir":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"ispushable":e.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=$t.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=$t.ISSWIM;break;case"issolid":e.collision=$t.ISSOLID;break;case"isbullet":e.collision=$t.ISBULLET;break;case"isdestructible":e.destructible=1;break}}}function Ce(t){var e;if(E(t))switch(Pi(t)){default:return;case _t.ERROR:return t.code??"";case _t.LOADER:return t.code??"";case _t.BOARD:{E(t.board)||(t.board=wd()),t.board.id=t.id;const n=Oc(t);return t.board.isdark=n.isdark??t.board.isdark?1:0,t.board.startx=n.startx??t.board.startx,t.board.starty=n.starty??t.board.starty,t.board.over=n.over??t.board.over,t.board.under=n.under??t.board.under,t.board.camera=n.camera??t.board.camera,t.board.graphics=n.graphics??t.board.graphics,t.board.facing=n.facing??t.board.facing,t.board.exitnorth=n.exitnorth??t.board.exitnorth,t.board.exitsouth=n.exitsouth??t.board.exitsouth,t.board.exitwest=n.exitwest??t.board.exitwest,t.board.exiteast=n.exiteast??t.board.exiteast,t.board.timelimit=n.timelimit??t.board.timelimit,t.board.restartonzap=n.restartonzap??t.board.restartonzap,t.board.maxplayershots=n.maxplayershots??t.board.maxplayershots,t.board}case _t.OBJECT:return E(t.object)||(t.object=Xy()),t.object.id=t.id,t.object.name=We(t),t.object.category=fr.ISOBJECT,M0(Oc(t),t.object),t.object;case _t.TERRAIN:return E(t.terrain)||(t.terrain=Xy()),t.terrain.id=t.id,t.terrain.name=We(t),t.terrain.category=fr.ISTERRAIN,M0(Oc(t),t.terrain),t.terrain;case _t.PALETTE:{if(E(t.palette)||(t.palette=Td(ib)),E((e=t.palette)==null?void 0:e.bits)){const n=Oc(t),r=hr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&wt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Du.set(o);const c=a*cc,l=Du.r*63,u=Du.g*63,f=Du.b*63;t.palette.bits[c+0]=Xe(l,0,63),t.palette.bits[c+1]=Xe(u,0,63),t.palette.bits[c+2]=Xe(f,0,63)}}}}return t.palette}case _t.CHARSET:return E(t.charset)||(t.charset=rb(_N)),t.charset}}function lx(t){return{id:Be(),name:tv(),timestamp:0,activelist:[],pages:t,flags:{}}}var U0=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))(U0||{});function JU(t){return Ko(t,U0,{pages:e=>e.map(ZU),flags:e=>{const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function QU(t){return ic(t,U0,{pages:e=>e.map(XU)})}function ux(t){E(t)&&(t.token=`${ev()}${yr(1111,9999)}`)}function Bi(t,e){if(!E(t))return;const n=It(e);return t.pages.find(i=>i.id===e||n===We(i))}function tn(t,e,n){if(!E(t))return;const r=It(n);return t.pages.find(s=>Pi(s)===e&&(s.id===n||r===We(s)))}function F0(t,e,n){let r=tn(t,e,n);if(!E(r)){const i=cx(e);r=VU(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),fx(t,r)}return r}function Js(t,e){return E(t)?t.pages.filter(n=>Pi(n)===e):[]}function zn(t,e,n){if(!E(t))return[];const r=It(n);return t.pages.filter(s=>Pi(s)===e).filter(s=>{const o=qs(s),a=It(We(s));return s.id===n||r===a||E(o[n])})}function P0(t){return E(t)?Zn(t.pages).sort((n,r)=>{const i=Pi(n),s=Pi(r);return i===s?We(n).localeCompare(We(r)):s-i}):[]}function hx(t,e){if(E(e)){const n=tn(t,_t.TERRAIN,e.kind??"");if(E(n))return n;const r=tn(t,_t.OBJECT,e.kind??"");if(E(r))return r}}function fx(t,e){if(!E(t)||!E(e))return!1;const n=Bi(t,e.id);return E(n)?!1:(t.pages.push(e),ux(t),!0)}function dx(t,e){const n=Bi(t,e);if(E(t)&&E(n)){const r=It(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==We(i)),ux(t),n}}function Di(t,e){if(E(e)&&E(e.kind))return E(e.kinddata)||(e.kinddata=E(e.id)?Qs(t,e.kind):Ic(t,e.kind)),e.kinddata}function je(t,e,n){const r=Di(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])??L0(Bi(t,(r==null?void 0:r.id)??""),n)}let tF=0;function ds(t,e){const n=je(t,e,"group");if(wt(n))return n;const r=je(t,e==null?void 0:e.kinddata,"group");return wt(r)?r:`group${tF++}`}function $u(t,e,n,r,i){const s=Di(t,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??n,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function Qs(t,e){const n=e??"",r=tn(t,_t.OBJECT,n);if(E(r)){const i=Ce(r);return{...Zn(i),name:n,code:r.code}}}function Ic(t,e){const n=e??"",r=tn(t,_t.TERRAIN,n);if(E(r)){const i=Ce(r);return{...Zn(i),name:n,code:r.code}}}function ps(t,e){const n=Bi(t,e);return Ce(n)}function eF(t,e){return!!(t!=null&&t.flags[e])}function $i(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function px(t,e){t&&delete t.flags[e]}function mx(t,e,n){const r=$i(t,e);return r==null?void 0:r[n]}function nF(t,e,n,r){const i=$i(t,e);return i&&(i[n]=r),r}function to(t,e){const n=mx(t,e,"board");return ps(t,wt(n)?n:"")}function rF(t,e){return(t==null?void 0:t.activelist.includes(e))??!1}function ju(t,e,n){if(!E(t))return;nF(t,e,"board",n);const r=ps(t,n);E(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function ta(t,e,n,r){if(!E(t))return;const i=to(t,e);if(!E(i))return;const s=Rn(i,e);if(!wn(s)||!(s!=null&&s.id))return;const o=ps(t,n);if(!E(o)||(Ge(t,o),$0(t,o,$t.ISWALK,r)))return;delete i.objects[s.id];const a=Ur(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Ur(o,s);o.lookup&&(o.lookup[c]=s.id),ju(t,e,o.id)}function iF(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=mx(t,r,"board");return wt(i)?i:""});return bI(n)}function B0(t){const e=iF(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=ps(t,e[i]);if(E(s)&&!n.has(s.id)){if(wt(s.over))if(wt(s.overboard)){const o=ps(t,s.overboard);E(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=zn(t,_t.BOARD,s.over);if(o.length){const a=Te(o),c=Ce(a);E(c)&&(s.overboard=c.id)}}else wt(s.overboard)&&delete s.overboard;if(r.push(s),wt(s.under))if(wt(s.underboard)){const o=ps(t,s.underboard);E(o)||delete s.underboard}else{const o=zn(t,_t.BOARD,s.under);if(o.length){const a=Te(o),c=Ce(a);E(c)&&(s.underboard=c.id)}}else wt(s.underboard)&&delete s.underboard}}return r}function sF(t,e,n,r,i){if(!E(e))return;E(e.distmaps)||(e.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=e.distmaps[s];if(!E(o)){o=new Array(bd).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(E(l)&&Wl(l)){const u=Fo(l,St);if(o[u]===-2){const f=Ho(e,l.x,l.y);Wo(n,je(t,f,"collision")??$t.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}e.distmaps[s]=o}return o}function gx(t,e){return Wl(t)?e[Fo(t,St)]:-1}function _x(t,e,n,r,i,s){if(!E(t)||!E(e))return;const o=sF(t,e,n,r,i);if(!E(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const f=gx(a[u],o);f>=0&&f>l&&(l=f,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const f=gx(a[u],o);f>=0&&f<l&&(l=f,c=a[u])}}return c}function Ge(t,e){var a;if(!E(t)||!E(e)||E(e.lookup)&&E(e.named))return;const n=new Array(St*Yt).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(E(l.x)&&E(l.y)&&E(l.id)&&!E(l.removed)){l.category=fr.ISOBJECT,n[l.x+l.y*St]=l.id;const u=It(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(E(l)){l.x=s,l.y=o,l.category=fr.ISTERRAIN;const u=is(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=St&&(s=0,++o)}e.lookup=n,e.named=r}function zu(t,e){E(e)&&(delete e.named,delete e.lookup,Ge(t,e))}function yx(t,e,n,r){var s;if(!E(t)||!E(e)||!E(e.named)||!E(n))return;const i=It(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function oF(t,e,n){if(!(!E(t)||!E(e)||!E(e.lookup)||!E(n==null?void 0:n.id))&&!E(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*St]=n.id}}function aF(t,e,n){var r;if(E(t)&&E(e)&&E(n==null?void 0:n.x)&&E(n.y)){const i=is(n),s=Ur(e,n);E((r=e.named)==null?void 0:r[i])&&e.named[i].delete(s)}}function D0(t,e,n){var r;if(E(t)&&E(e)&&E(n==null?void 0:n.id)){if(E(e.lookup)&&E(n.x)&&E(n.y)){const s=n.x+n.y*St;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=is(n);E((r=e.named)==null?void 0:r[i])&&E(n.id)&&e.named[i].delete(n.id)}}function Ku(t,e,n,r,i,s){const o=dt.MID;if(!E(t)||!E(e)||!E(n))return{dir:i,startpt:s,destpt:s,layer:o};const a={x:n.x??0,y:n.y??0},c={x:n.lx??a.x,y:n.ly??a.y},l=ri(c,a),u=St-1,f=Yt-1;for(let d=0;d<i.length;++d){const h=xI(i[d]);switch(h){case dt.IDLE:break;case dt.NORTH:case dt.SOUTH:case dt.WEST:case dt.EAST:Ke(a,h);break;case dt.BY:{const[p,m]=i.slice(d+1);At(p)&&At(m)&&(a.x=Xe(a.x+p,0,u),a.y=Xe(a.y+m,0,f)),d+=2;break}case dt.TO:case dt.AT:{const[p,m]=i.slice(d+1);At(p)&&At(m)&&(a.x=Xe(p,0,u),a.y=Xe(m,0,f)),d+=2;break}case dt.FLOW:Ke(a,l);break;case dt.SEEK:{const p=rN(e,n,r);$o(p)&&Ke(a,ri(s,p));break}case dt.RNDNS:Ke(a,Te(dt.NORTH,dt.SOUTH));break;case dt.RNDNE:Ke(a,Te(dt.NORTH,dt.EAST));break;case dt.RND:Ke(a,Te(dt.NORTH,dt.SOUTH,dt.WEST,dt.EAST));break;case dt.CW:case dt.CCW:case dt.OPP:case dt.RNDP:{const p=Ku(t,e,n,r,i.slice(d+1),s);switch(a.x=s.x,a.y=s.y,h){case dt.CW:switch(ri(s,p.destpt)){case dt.NORTH:Ke(a,dt.EAST);break;case dt.SOUTH:Ke(a,dt.WEST);break;case dt.EAST:Ke(a,dt.SOUTH);break;case dt.WEST:Ke(a,dt.NORTH);break}break;case dt.CCW:switch(ri(s,p.destpt)){case dt.NORTH:Ke(a,dt.WEST);break;case dt.SOUTH:Ke(a,dt.EAST);break;case dt.EAST:Ke(a,dt.NORTH);break;case dt.WEST:Ke(a,dt.SOUTH);break}break;case dt.OPP:switch(ri(s,p.destpt)){case dt.NORTH:Ke(a,dt.SOUTH);break;case dt.SOUTH:Ke(a,dt.NORTH);break;case dt.EAST:Ke(a,dt.WEST);break;case dt.WEST:Ke(a,dt.EAST);break}break;case dt.RNDP:switch(ri(s,p.destpt)){case dt.NORTH:case dt.SOUTH:a.x+=Te(-1,1);break;case dt.WEST:case dt.EAST:a.y+=Te(-1,1);break}break}break}case dt.FLEE:case dt.AWAY:{const[p,m]=i.slice(d+1);if(At(p)&&At(m)){const y={x:Xe(p,0,u),y:Xe(m,0,f)},b=je(t,n,"collision"),k=_x(t,e,b,a,y,!0);E(k)&&(a.x=k.x,a.y=k.y)}d+=2;break}case dt.FIND:case dt.TOWARD:{const[p,m]=i.slice(d+1);if(At(p)&&At(m)){const y={x:Xe(p,0,u),y:Xe(m,0,f)};if(yr(1,100)<5)Ke(a,Te(dt.NORTH,dt.SOUTH,dt.WEST,dt.EAST));else{const b=je(t,n,"collision"),k=_x(t,e,b,a,y,!1);if(E(k))if(k.x!==p&&k.y!==m&&nN(e,k))switch(ri(s,k)){case dt.EAST:case dt.WEST:a.y+=Te(-1,1);break;case dt.NORTH:case dt.SOUTH:a.x+=Te(-1,1);break}else a.x=k.x,a.y=k.y}}d+=2;break}case dt.PLAYER:{const p=oc(e,s,r);$o(p)&&(a.x=p.x,a.y=p.y);break}case dt.OVER:case dt.UNDER:{const p=Ku(t,e,n,r,i.slice(d+1),s);return p.layer=h,p}}}return{dir:i,startpt:s,destpt:a,layer:o}}function cF(t,e,n,r){if(E(t)&&E(e)&&E(n)){const[i,s]=n,o=Qs(t,i);if(E(o)&&E(o.name)){const a=vd(e,r,i);return sc(a,s),a}}}function ms(t,e,n,r,i){if(E(t)&&E(e)&&E(n)){const[s,o]=n,a=Ic(t,s);if(E(a)){const l=eN(e,r,s);if(E(l)){sc(l,o);const u=Fo(r,St);return Di(t,l),yx(t,e,l,u),l}}const c=Qs(t,s);if(E(c)&&E(c.name)){const l=vd(e,r,s,i);if(E(l))return sc(l,o),oF(t,e,l),Di(t,l),yx(t,e,l),l}}}function or(t,e,n,r){return!E(n)||is(n)==="player"?!1:(n.id?(n.removed=r,D0(t,e,n)):(ln(e,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),aF(t,e,n)),!0)}function $0(t,e,n,r){if(!E(t)||!E(e)||!E(e.lookup)||r.x<0||r.x>=St||r.y<0||r.y>=Yt)return!0;const i=r.x+r.y*St,s=Rn(e,e.lookup[i]??"404");if(E(s))return!0;const o=e.terrain[i];return E(o)?Wo(n,je(t,o,"collision")??$t.ISWALK):!1}function lF(t,e,n,r){const i=Rn(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=je(t,i,"collision");return $0(t,e,a,r)}function j0(t,e,n,r){var d;const i=Rn(e,(n==null?void 0:n.id)??"");if(!E(t)||!E(e)||!E(i)||!E(i.x)||!E(i.y)||!E(e.lookup)||!E(n)||r.x<0||r.x>=St||r.y<0||r.y>=Yt)return{name:"edge",kind:"edge",collision:$t.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Ur(e,i),o=Ur(e,r),a=je(t,i,"collision")??$t.ISWALK,c=Kr(i==null?void 0:i.id),l=Rn(e,e.lookup[o]??""),u=Kr((l==null?void 0:l.id)??"");if(E(l)&&(!c||!u)&&ds(t,n)!==ds(t,l)){if(!!je(t,l,"pushable")){const p={x:r.x-(n.x??0),y:r.y-(n.y??0)};j0(t,e,l,p)}return{...l}}const f=e.terrain[o];if(E(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??$t.ISWALK;if(Wo(a,h))return{...f,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,E(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function uF(t,e,n){const r=[];if(!E(t)||!E(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];E(o.id)&&E(o.removed)&&n-o.removed>sl*5&&(r.push(o.id),qy(e,o.id))}return r}function hF(t,e,n){const r=[];if(!E(t)||!E(e))return r;e.lookup=void 0,Ge(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!E(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Di(t,a),l=`${(c==null?void 0:c.code)??""}
${a.code??""}`;l&&r.push({id:a.id,type:_t.OBJECT,code:l,object:a,terrain:void 0})}const s=uF(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:_t.ERROR,code:"",object:void 0,terrain:void 0});return r}function fF(t,e,n){const r=[],i=[];if(!E(t)||!E(e))return{objectelements:r,terrainelements:i};function s(a){const c=je(t,a,n);return E(c)||ds(t,a)===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c)&&r.push(c)}for(let a=0;a<bd;++a){const c=e.terrain[a];E(c)&&s(c)&&i.push(c)}return{objectelements:r,terrainelements:i}}var bx={exports:{}},z0={exports:{}},wx;function dF(){return wx||(wx=1,function(t,e){(function(n,r){t.exports=r()})(Cn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(m){if(m)for(var y=0;y<u.length;y++)m[u[y]]!==void 0&&this["set"+r(u[y])](m[u[y]])}f.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof f)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new f(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",y=this.getLineNumber()||"",b=this.getColumnNumber()||"",k=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+y+":"+b+")":"[eval]:"+y+":"+b:k?k+" ("+m+":"+y+":"+b+")":m+":"+y+":"+b}},f.fromString=function(y){var b=y.indexOf("("),k=y.lastIndexOf(")"),T=y.substring(0,b),A=y.substring(b+1,k).split(","),C=y.substring(k+1);if(C.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),S=R[1],U=R[2],I=R[3];return new f({functionName:T,args:A||void 0,fileName:S,lineNumber:U||void 0,columnNumber:I||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(m){return function(y){this[m]=!!y}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(m){return function(y){if(!n(y))throw new TypeError(m+" must be a Number");this[m]=Number(y)}}(o[h]);for(var p=0;p<a.length;p++)f.prototype["get"+r(a[p])]=i(a[p]),f.prototype["set"+r(a[p])]=function(m){return function(y){this[m]=String(y)}}(a[p]);return f})}(z0)),z0.exports}(function(t,e){(function(n,r){t.exports=r(dF())})(Cn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),p=d&&f||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var y=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:y,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(bx);var pF=bx.exports,mF=so(pF);function ji(t){const e={},n={tick(){},everytick(){},listcommands(){return hr(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function ye(t){return`${t??""}`}function Nc(t,e){const n=parseFloat(ye(t));return isNaN(n)?e:n}function xx(t,e,n){var i;const[r]=rt(e,0,[z.MAYBE_NAME]);KA(tt,t,((i=w.board)==null?void 0:i.id)??"",r??"",n)}function Kn(t,e,n,r){const[i,s]=rt(r,0,[z.NUMBER_OR_STRING,z.MAYBE_NUMBER_OR_STRING]);ig(tt,t,e,n,i,s)}const gF=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Ex(t,e,n){const[r,i]=rt(n,0,[z.NUMBER_OR_STRING]);if(At(r))rf(tt,t,e,"volume",r);else if(gF.includes(It(r))){const[s,o]=rt(n,i,[z.NUMBER_OR_STRING,z.MAYBE_NUMBER_OR_STRING]);ig(tt,t,e,r,s,o)}else{const[s]=rt(n,i,[z.MAYBE_NUMBER_OR_STRING]);if(At(s)){const o=n.length-i,a=new Array(o).fill(z.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;rf(tt,t,e,r,l)}else{const[o]=rt(n,i,[z.MAYBE_NUMBER_OR_STRING]);rf(tt,t,e,r,o)}}}const K0=ji().command("talk",(t,e)=>{const[n]=rt(e,0,[z.ANY]);switch(It(n)){default:TA(tt,w.elementfocus);break;case"stop":AA(tt,w.elementfocus);break}return 0}).command("media",(t,e)=>{const[n]=rt(e,0,[z.ANY]);switch(It(n)){default:RA(tt,w.elementfocus);break;case"stop":SA(tt,w.elementfocus);break}return 0}).command("tts",(t,e)=>{const[n,r]=rt(e,0,[z.STRING]),i=e.slice(r).map(ye).join("");return jA(tt,w.elementfocus,n,i),0}).command("tta",(t,e)=>{const n=e.map(ye).join("");return zA(tt,w.elementfocus,n),0}).command("bpm",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return WA(tt,w.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return GA(tt,w.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return YA(tt,w.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return VA(tt,w.elementfocus,n),0}).command("play",(t,e)=>(xx(w.elementfocus,e,!1),0)).command("bgplay",(t,e)=>(xx(w.elementfocus,e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)Ex(w.elementfocus,n,e);return 0}).command("echo",(t,e)=>{for(let n=0;n<3;++n)Kn(w.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<3;++n)Kn(w.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<3;++n)Kn(w.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<3;++n)Kn(w.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<3;++n)Kn(w.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<3;++n)Kn(w.elementfocus,n,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let n=0;n<3;++n)Kn(w.elementfocus,n,"autowah",e);return 0});for(let t=0;t<8;++t)K0.command(`synth${t+1}`,(e,n)=>(Ex(w.elementfocus,t,n),0));for(let t=0;t<3;++t){const e=t+1;K0.command(`echo${e}`,(n,r)=>(Kn(w.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(Kn(w.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(Kn(w.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(Kn(w.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(Kn(w.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(Kn(w.elementfocus,t,"vibrato",r),0)).command(`autowah${e}`,(n,r)=>(Kn(w.elementfocus,t,"autowah",r),0))}const _F=dy(32,126).map(t=>String.fromCharCode(t)),yF=ir({name:"Whitespace",pattern:/ +/}),bF=ir({name:"WhitespaceSkipped",pattern:/ +/,group:Qe.SKIPPED}),H0=ir({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),vx=ir({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:_F}),W0=ir({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),G0=ir({name:"EscapedDollar",pattern:"$$"}),Y0=ir({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),V0=ir({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),kx=ir({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function wF(t,e=""){return ir({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const Tx=Object.keys(tc).map(t=>wF(`\\$(${t})`,t)),xF=[yF,H0,...Tx,W0,vx,V0,G0,kx,Y0],EF=new Qe(xF,{skipValidations:!mi,ensureOptimizations:mi}),vF=new Qe([bF,H0,...Tx,W0,vx,V0,G0,kx,Y0],{skipValidations:!mi,ensureOptimizations:mi});function Z0(t,e=!1){return e?vF.tokenize(t):EF.tokenize(t)}function X0(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function Ax(t){t.active={...t.reset}}function Rx(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case G0:s("$");break;case V0:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case W0:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case H0:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=tc[l],f=vI(Rt[u]),d=kI(Rt[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):E(f)?e.active.color=f:E(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(E(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){Ax(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;TF(u,u+l.length,e.active.color,e.active.bg,e),kF(u,l,e)}}}function Sx(t,e,n){const r=Z0(t);r.tokens&&(Rx(r.tokens,e),n&&Ax(e),e.changed())}function Ox(t,e,n){const r=Z0(t);if(!r.tokens)return;const i=X0(e,n,Rt.WHITE,Rt.BLACK);return i.measureonly=!0,Rx(r.tokens,i),i.x>0&&++i.y,i}function kF(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function TF(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Ix(t,e,n){if(!$o(w.element))return 0;const[r,i]=rt(e,0,[z.DIR,z.MAYBE_KIND]),s=i??["bullet"],o=cF(w.book,w.board,s,{x:w.element.x,y:w.element.y});if(E(o)){E(n)&&(o.arg=n),o.party=w.elementid,o.collision=$t.ISBULLET,o.destructible=1,o.stepx=r.destpt.x-w.element.x,o.stepy=r.destpt.y-w.element.y,o.bg=Rt.ONCLEAR;const a=Di(w.book,o),c=o.code??(a==null?void 0:a.code)??"";kE(w.book,w.board,o,c,1)}return t.yield(),0}function Hu(t,e,n,r){var u,f;if(!$o(w.element)||!E(w.book)||!E(w.board)||!E(w.element))return 0;Ge(w.book,w.board);const[i,s]=rt(e,0,[z.DIR,z.KIND]),o=me(w.board,i.destpt);if((o==null?void 0:o.category)===fr.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((u=w.element)==null?void 0:u.x)??0,y:((f=w.element)==null?void 0:f.y)??0},h=Ke(i.destpt,ri(d,i.destpt));j0(w.book,w.board,o,h)}const[a]=s,c=Ic(w.book,a);E(c)&&ms(w.book,w.board,s,i.destpt,n);const l=Qs(w.book,a);if(E(l)){const d=Qs(w.book,a)??Ic(w.book,a),h=je(w.book,d,"collision")??$t.ISWALK;if(!$0(w.book,w.board,h,i.destpt)){const m=ms(w.book,w.board,s,i.destpt,n);E(m)&&E(r)&&(m.arg=r)}}return 0}const AF=ji().command("board",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;const[n,r]=rt(e,0,[z.NAME]),[i,s]=rt(e,r,[z.MAYBE_NUMBER,z.MAYBE_NUMBER]),o=zn(w.book,_t.BOARD,n);if(o.length){const a=Te(...o);E(a)&&ta(w.book,w.elementfocus,a.id,{x:i??Math.round(St*.5),y:s??Math.round(Yt*.5)})}return 0}).command("edge",(t,e)=>{var s,o;if(!E(w.book)||!E(w.board)||!E(w.element))return 0;const[n,r]=rt(e,0,[z.DIR,z.NAME]),i=zn(w.book,_t.BOARD,r);if(i.length){const a={x:((s=w.element)==null?void 0:s.x)??0,y:((o=w.element)==null?void 0:o.y)??0},c=ri(a,n.destpt),l=Te(...i);switch(c){case dt.NORTH:w.board.exitnorth=l.id;break;case dt.SOUTH:w.board.exitsouth=l.id;break;case dt.WEST:w.board.exitwest=l.id;break;case dt.EAST:w.board.exiteast=l.id;break}}return 0}).command("shove",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;Ge(w.book,w.board);const[n,r]=rt(e,0,[z.DIR,z.DIR]),i=me(w.board,n.destpt);return wn(i)&&ha(w.book,w.board,i,r.destpt),0}).command("duplicate",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;Ge(w.book,w.board);const[n,r]=rt(e,0,[z.DIR,z.DIR]),i=me(w.board,n.destpt);return wn(i),0}).command("write",(t,e)=>{var l;if(!E(w.book)||!E(w.board))return 0;Ge(w.book,w.board);const[n,r,i]=rt(e,0,[z.DIR,z.COLOR,z.STRING]),{color:s,bg:o}=xy(r),a=((l=Ox(i,256,1))==null?void 0:l.measuredwidth)??1,c=X0(256,1,s??Rt.WHITE,o??Rt.BLACK);Sx(i,c,!1);for(let u=0;u<a;++u)ln(w.board,{x:n.destpt.x+u,y:n.destpt.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;Ge(w.book,w.board);const[n,r]=rt(e,0,[z.KIND,z.KIND]);(ud(n)??"")==="empty"&&iN(w.board).forEach(c=>{ms(w.book,w.board,r,c)});const s=ud(r),o=vy(r),a=ky(r);return Jy(w.board,n).forEach(c=>{if(is(c)===s)E(o)&&(c.color=o),E(a)&&(c.bg=a);else if(or(w.book,w.board,c,w.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};ms(w.book,w.board,r,l)}}),0}).command("put",(t,e)=>Hu(t,e)).command("putwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return Hu(t,e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return E(w.board)&&Rn(w.board,n)?0:Hu(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=rt(e,0,[z.ANY,z.ANY]);return E(w.board)&&Rn(w.board,r)?0:Hu(t,e.slice(i),r,n)}).command("shoot",Ix).command("shootwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return Ix(t,e.slice(r),n)}),gs="$dkpurple",RF="$196",SF="$205",un="$yellow$205$205$205$196";function Le(t,e,n){yA(t,e,n)}function OF(t,e,n){const r=RF.repeat(n);Le(t,e,`${gs}${r}`)}function q0(t,e,n){const r=SF.repeat(n);Le(t,e,`${gs}${r}`)}function J0(t,e,n){Le(t,e,`${gs} ${" ".repeat(n.length)} `),OF(t,e,n.length+2),Le(t,e,`${gs} $white${n} `),q0(t,e,n.length+2)}function eo(t,e,n){Le(t,e,`${gs} ${" ".repeat(n.length)} `),Le(t,e,`${gs} $gray${n} `),q0(t,e,n.length+2)}function Cc(t,e,n,r){Le(t,e,`${gs} $white${n} $blue${r}`)}function Hn(t,e,n){Le(t,e,`${gs}$blue${n}`)}function IF(t,e,n,r){Le(t,e,`!${n};${r}`)}function Nx(t){const[e,n]=t.split(":"),r=E(n);return[r?e:"self",r?n:t]}var NF=`desc;$DKGRAYname and type of codepage
`,CF=Object.freeze({__proto__:null,default:NF}),LF="desc;changes object into specified element",MF=Object.freeze({__proto__:null,default:LF}),UF="desc;like #play but for sound effects",FF=Object.freeze({__proto__:null,default:UF}),PF="",BF=Object.freeze({__proto__:null,default:PF}),DF="",$F=Object.freeze({__proto__:null,default:DF}),jF="",zF=Object.freeze({__proto__:null,default:jF}),KF="",HF=Object.freeze({__proto__:null,default:KF}),WF="",GF=Object.freeze({__proto__:null,default:WF}),YF="",VF=Object.freeze({__proto__:null,default:YF}),ZF="",XF=Object.freeze({__proto__:null,default:ZF}),qF="",JF=Object.freeze({__proto__:null,default:qF}),QF="",tP=Object.freeze({__proto__:null,default:QF}),eP="",nP=Object.freeze({__proto__:null,default:eP}),rP="",iP=Object.freeze({__proto__:null,default:rP}),sP="",oP=Object.freeze({__proto__:null,default:sP}),aP="",cP=Object.freeze({__proto__:null,default:aP}),lP="",uP=Object.freeze({__proto__:null,default:lP}),hP="",fP=Object.freeze({__proto__:null,default:hP}),dP=`desc;$DKGRAYstarts a section of an if-do-done block
`,pP=Object.freeze({__proto__:null,default:dP}),mP=`desc;$DKGRAYcompletes an if-do-done block
`,gP=Object.freeze({__proto__:null,default:mP}),_P="",yP=Object.freeze({__proto__:null,default:_P}),bP="",wP=Object.freeze({__proto__:null,default:bP}),xP="",EP=Object.freeze({__proto__:null,default:xP}),vP=`desc;$DKGRAYelse logic in an if-do-done block
`,kP=Object.freeze({__proto__:null,default:vP}),TP=`desc;$DKGRAYconditional else logic in an if-do-done block
`,AP=Object.freeze({__proto__:null,default:TP}),RP="",SP=Object.freeze({__proto__:null,default:RP}),OP="",IP=Object.freeze({__proto__:null,default:OP}),NP="",CP=Object.freeze({__proto__:null,default:NP}),LP="",MP=Object.freeze({__proto__:null,default:LP}),UP="",FP=Object.freeze({__proto__:null,default:UP}),PP="",BP=Object.freeze({__proto__:null,default:PP}),DP="",$P=Object.freeze({__proto__:null,default:DP}),jP="",zP=Object.freeze({__proto__:null,default:jP}),KP=`desc;$DKGRAYhalt until the next cycle
`,HP=Object.freeze({__proto__:null,default:KP}),WP=`desc;$DKGRAYevals condition for true or false
`,GP=Object.freeze({__proto__:null,default:WP}),YP="",VP=Object.freeze({__proto__:null,default:YP}),ZP="",XP=Object.freeze({__proto__:null,default:ZP}),qP="",JP=Object.freeze({__proto__:null,default:qP}),QP="",tB=Object.freeze({__proto__:null,default:QP}),eB="",nB=Object.freeze({__proto__:null,default:eB}),rB="",iB=Object.freeze({__proto__:null,default:rB}),sB="",oB=Object.freeze({__proto__:null,default:sB}),aB="",cB=Object.freeze({__proto__:null,default:aB}),lB="",uB=Object.freeze({__proto__:null,default:lB}),hB="",fB=Object.freeze({__proto__:null,default:hB}),dB="",pB=Object.freeze({__proto__:null,default:dB}),mB="",gB=Object.freeze({__proto__:null,default:mB}),_B="",yB=Object.freeze({__proto__:null,default:_B}),bB="",wB=Object.freeze({__proto__:null,default:bB}),xB="",EB=Object.freeze({__proto__:null,default:xB}),vB="",kB=Object.freeze({__proto__:null,default:vB}),TB="",AB=Object.freeze({__proto__:null,default:TB}),RB="",SB=Object.freeze({__proto__:null,default:RB}),OB="",IB=Object.freeze({__proto__:null,default:OB}),NB="",CB=Object.freeze({__proto__:null,default:NB}),LB="",MB=Object.freeze({__proto__:null,default:LB}),UB=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,FB=Object.freeze({__proto__:null,default:UB}),PB="",BB=Object.freeze({__proto__:null,default:PB}),DB="",$B=Object.freeze({__proto__:null,default:DB}),jB="",zB=Object.freeze({__proto__:null,default:jB}),KB="",HB=Object.freeze({__proto__:null,default:KB}),WB="",GB=Object.freeze({__proto__:null,default:WB}),YB="",VB=Object.freeze({__proto__:null,default:YB}),ZB="",XB=Object.freeze({__proto__:null,default:ZB}),qB="",JB=Object.freeze({__proto__:null,default:qB}),QB="",tD=Object.freeze({__proto__:null,default:QB}),eD="",nD=Object.freeze({__proto__:null,default:eD}),rD="",iD=Object.freeze({__proto__:null,default:rD}),sD="",oD=Object.freeze({__proto__:null,default:sD}),aD="",cD=Object.freeze({__proto__:null,default:aD}),lD="",uD=Object.freeze({__proto__:null,default:lD}),hD="",fD=Object.freeze({__proto__:null,default:hD}),dD="",pD=Object.freeze({__proto__:null,default:dD}),mD="",gD=Object.freeze({__proto__:null,default:mD}),_D="",yD=Object.freeze({__proto__:null,default:_D}),bD="",wD=Object.freeze({__proto__:null,default:bD}),xD=`desc;$DKGRAYdesignates an inactive label or comment
`,ED=Object.freeze({__proto__:null,default:xD}),vD=`desc;$DKGRAYadds hyperlink text

`,kD=Object.freeze({__proto__:null,default:vD}),TD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,AD=Object.freeze({__proto__:null,default:TD}),RD=`desc;$DKGRAYread number input into given stat/flag
`,SD=Object.freeze({__proto__:null,default:RD}),OD=`desc;$DKGRAYa slider input from 1 to 9 

`,ID=Object.freeze({__proto__:null,default:OD}),ND=`desc;$DKGRAYlist with label value pairs to pick from
`,CD=Object.freeze({__proto__:null,default:ND}),LD=`desc;$DKGRAYread text input into given stat/flag
`,MD=Object.freeze({__proto__:null,default:LD}),UD=`desc;$DKGRAYdesignates a starting point for running code
`,FD=Object.freeze({__proto__:null,default:UD}),PD=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,BD=Object.freeze({__proto__:null,default:PD}),DD=`desc;$DKGRAYwill move the object in the given direction
`,$D=Object.freeze({__proto__:null,default:DD}),jD=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,zD=Object.freeze({__proto__:null,default:jD}),KD=`desc;$DKGRAYcustom 8x14 charset
`,HD=Object.freeze({__proto__:null,default:KD}),WD=`desc;$DKGRAYsets stat to given value

`,GD=Object.freeze({__proto__:null,default:WD}),YD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,VD=Object.freeze({__proto__:null,default:YD}),ZD=`desc;$DKGRAYread external content and/or handle events
`,XD=Object.freeze({__proto__:null,default:ZD}),qD=`desc;$DKGRAYread number input into given stat/flag
`,JD=Object.freeze({__proto__:null,default:qD}),QD=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,t$=Object.freeze({__proto__:null,default:QD}),e$=`desc;$DKGRAYcustom palette colors
`,n$=Object.freeze({__proto__:null,default:e$}),r$=`desc;$DKGRAYa slider input from 1 to 9 

`,i$=Object.freeze({__proto__:null,default:r$}),s$=`desc;$DKGRAYlist with label value pairs to pick from
`,o$=Object.freeze({__proto__:null,default:s$}),a$=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,c$=Object.freeze({__proto__:null,default:a$}),l$=`desc;$DKGRAYread text input into given stat/flag
`,u$=Object.freeze({__proto__:null,default:l$}),h$=`desc;$DKGRAYadds text
`,f$=Object.freeze({__proto__:null,default:h$}),d$=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,p$=Object.freeze({__proto__:null,default:d$}),m$=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,g$=Object.freeze({__proto__:null,default:m$}),_$=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,y$=Object.freeze({__proto__:null,default:_$}),b$=`header;player settings
#set user "name goes here"
`,w$=Object.freeze({__proto__:null,default:b$}),x$=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,E$=Object.freeze({__proto__:null,default:x$});const Cx=Object.assign({"./editor/codepagename.txt":CF,"./editor/command/become.txt":MF,"./editor/command/bgplay.txt":FF,"./editor/command/bgvol.txt":BF,"./editor/command/bind.txt":$F,"./editor/command/board.txt":zF,"./editor/command/bpm.txt":HF,"./editor/command/break.txt":GF,"./editor/command/change.txt":VF,"./editor/command/char.txt":XF,"./editor/command/charset.txt":JF,"./editor/command/clear.txt":tP,"./editor/command/color.txt":nP,"./editor/command/continue.txt":iP,"./editor/command/copy.txt":oP,"./editor/command/cycle.txt":cP,"./editor/command/die.txt":uP,"./editor/command/distort.txt":fP,"./editor/command/do.txt":pP,"./editor/command/done.txt":gP,"./editor/command/duplicate.txt":yP,"./editor/command/echo.txt":wP,"./editor/command/edge.txt":EP,"./editor/command/else.txt":kP,"./editor/command/elseif.txt":AP,"./editor/command/end.txt":SP,"./editor/command/endgame.txt":IP,"./editor/command/endwith.txt":CP,"./editor/command/fcrush.txt":MP,"./editor/command/fetch.txt":FP,"./editor/command/fetchwith.txt":BP,"./editor/command/foreach.txt":$P,"./editor/command/go.txt":zP,"./editor/command/idle.txt":HP,"./editor/command/if.txt":GP,"./editor/command/lock.txt":VP,"./editor/command/oneof.txt":XP,"./editor/command/oneofwith.txt":JP,"./editor/command/palette.txt":tB,"./editor/command/phaser.txt":nB,"./editor/command/pivot.txt":iB,"./editor/command/play.txt":oB,"./editor/command/put.txt":cB,"./editor/command/putwith.txt":uB,"./editor/command/readbin.txt":fB,"./editor/command/readjson.txt":pB,"./editor/command/readline.txt":gB,"./editor/command/readrexpaint.txt":yB,"./editor/command/remix.txt":wB,"./editor/command/repeat.txt":EB,"./editor/command/restore.txt":kB,"./editor/command/reverb.txt":AB,"./editor/command/revert.txt":SB,"./editor/command/run.txt":IB,"./editor/command/runwith.txt":CB,"./editor/command/set.txt":MB,"./editor/command/shoot.txt":FB,"./editor/command/shootwith.txt":BB,"./editor/command/shove.txt":$B,"./editor/command/snapshot.txt":zB,"./editor/command/synth.txt":HB,"./editor/command/toast.txt":GB,"./editor/command/tts.txt":VB,"./editor/command/ttsvol.txt":XB,"./editor/command/twitchbroadcast.txt":JB,"./editor/command/twitchchat.txt":tD,"./editor/command/unlock.txt":nD,"./editor/command/vibrato.txt":iD,"./editor/command/vol.txt":oD,"./editor/command/waitfor.txt":cD,"./editor/command/walk.txt":uD,"./editor/command/weave.txt":fD,"./editor/command/while.txt":pD,"./editor/command/with.txt":gD,"./editor/command/write.txt":yD,"./editor/command/zap.txt":wD,"./editor/comment.txt":ED,"./editor/hyperlink.txt":kD,"./editor/hyperlink/hotkey.txt":AD,"./editor/hyperlink/number.txt":SD,"./editor/hyperlink/range.txt":ID,"./editor/hyperlink/select.txt":CD,"./editor/hyperlink/text.txt":MD,"./editor/label.txt":FD,"./editor/shortgo.txt":BD,"./editor/shorttry.txt":$D,"./editor/stat/board.txt":zD,"./editor/stat/charset.txt":HD,"./editor/stat/const.txt":GD,"./editor/stat/hotkey.txt":VD,"./editor/stat/loader.txt":XD,"./editor/stat/number.txt":JD,"./editor/stat/object.txt":t$,"./editor/stat/palette.txt":n$,"./editor/stat/range.txt":i$,"./editor/stat/select.txt":o$,"./editor/stat/terrain.txt":c$,"./editor/stat/text.txt":u$,"./editor/text.txt":f$,"./help/controls.txt":p$,"./help/developer.txt":g$,"./help/menu.txt":y$,"./help/player.txt":w$,"./help/text.txt":E$}),Lx={};hr(Cx).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");Lx[e]=Cx[t].default});function v$(t){const e=It(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Lx[e];if(E(n))return n;const{target:r,path:i}=Xn(e);switch(r){case"editor":{const s=Xn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function k$(t,e){const n=(t??"").split(`
`);for(let r=0;r<n.length;++r)e(n[r].split(";"))}function T$(t,e){const[n,...r]=e,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":J0(tt,t,i);break;case"section":eo(tt,t,i);break;case"option":Cc(tt,t,i,s);break;default:n.trimStart().startsWith("!")?IF(tt,t,n.trimStart().slice(1),i):Le(tt,t,n);break}}function ea(){ag(tt,cr())}function Lc(t){k$(v$(`help:${t}`),e=>T$(w.elementfocus,e))}const A$=ji().command("send",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);switch(It(n)){case"helpmenu":Lc("menu");break;case"helpcontrols":Lc("controls");break;case"helptext":Lc("text");break;case"helpdeveloper":Lc("developer");break;case"helpplayer":Lc("player");break;default:{const[i,s]=Nx(n);mp(i==="self"&&w.elementisplayer?`${w.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(ye),s=i.join(" ");switch(It(r)){case sr(vt.LOADER):n=xs(Bt.CONTENT,s,_t.LOADER);break;default:n=xs(Bt.CONTENT,[r,...i].join(" "),_t.OBJECT);break;case sr(vt.BOARD):n=xs(Bt.CONTENT,s,_t.BOARD);break;case sr(vt.OBJECT):n=xs(Bt.CONTENT,s,_t.OBJECT);break;case sr(vt.TERRAIN):n=xs(Bt.CONTENT,s,_t.TERRAIN);break;case sr(vt.CHARSET):n=xs(Bt.CONTENT,s,_t.CHARSET);break;case sr(vt.PALETTE):n=xs(Bt.CONTENT,s,_t.PALETTE);break}return E(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(ye).join(" ");if(E(w.element)&&w.elementisplayer){const{user:r}=Sr(w.elementid),i=wt(r)?r:"player";w.element.tickertext=`${i}: ${n}`,w.element.tickertime=w.timestamp;const s=$u(w.book,w.element,1,Rt.WHITE,Rt.BLACK);he(tt,w.elementid,`$${Rt[s.color]}$ON${Rt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),Pa(tt,w.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ye(n),s=r.map(ye).join(" "),{user:o}=Sr(w.elementid),a=wt(o)?o:"player",c=$u(w.book,w.element,1,Rt.WHITE,Rt.BLACK);return he(tt,w.elementid,`!${s};$${Rt[c.color]}$ON${Rt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`),0}).command("config",(t,e)=>{const[n,r]=rt(e,0,[z.MAYBE_NAME,z.MAYBE_STRING]);return wt(n)&&wt(r)?ZA(tt,w.elementfocus,n,r):XA(tt,w.elementfocus),0}).command("bookcreate",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]),r=bE(n);return E(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return E(r)?(he(tt,w.elementfocus,`opened [book] ${r.name}`),ah(Bt.MAIN,r.id),t.command("pages")):ue(tt,w.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=be(Bt.MAIN),i=zr(n);return E(i)&&(r===i&&ah(Bt.MAIN,""),k4(n),he(tt,w.elementfocus,`trashed [book] ${i.name}`),ea(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zn(w.book,_t.BOARD,n);if(r.length){const i=Te(...r);E(i)&&ta(w.book,w.elementfocus,i.id,{x:yr(0,St-1),y:yr(0,Yt-1)})}return 0}).command("pageopen",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.MAYBE_NAME]),i=vn(Bt.MAIN);if(!E(i))return 0;const s=Bi(i,n);if(E(s)){const o=We(s),a=fs(s);he(tt,w.elementfocus,`opened [${a}] ${o}`);const c=[s.id,r];td(il(i.id,c),s.code);const l=fs(s);sg(tt,w.elementfocus,i.id,c,l,`${o} - ${i.name}`)}else ue(tt,"pageopen",`page ${n} not found`,w.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=vn(Bt.MAIN),i=dx(r,n);if(E(n)){const s=We(i),o=fs(i);he(tt,w.elementfocus,`trashed [${o}] ${s}`),ea(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(ye).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{eo(tt,w.elementfocus,"books");const t=be(Bt.MAIN);Cc(tt,w.elementfocus,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=be(Bt.CONTENT);Cc(tt,w.elementfocus,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),q0(tt,w.elementfocus,7);const n=la();return n.length?n.forEach(r=>{Le(tt,w.elementfocus,`!bookopen ${r.id};${r.name}`)}):Hn(tt,w.elementfocus,"no books found"),Le(tt,w.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=vn(Bt.MAIN);return E(t)&&(eo(tt,w.elementfocus,"pages"),Cc(tt,w.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?P0(t).forEach(n=>{const r=We(n),i=fs(n);Le(tt,w.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Le(tt,w.elementfocus,""),Hn(tt,w.elementfocus,"$white no pages found"),Hn(tt,w.elementfocus,"$white use @ to create a page"),Hn(tt,w.elementfocus,"$white @board name of board"),Hn(tt,w.elementfocus,"$white @object name of object"),Hn(tt,w.elementfocus,"$white @terrain name of terrain"),Hn(tt,w.elementfocus,"$white You can omit the type and it will default to object"),Hn(tt,w.elementfocus,"$white @object name of object"),Hn(tt,w.elementfocus,"$white @name of object"))),0}).command("boards",()=>{eo(tt,w.elementfocus,"boards");const t=vn(Bt.MAIN);if(E(t)){Cc(tt,w.elementfocus,"main",`${t.name} $GREEN${t.id}`);const e=P0(t);e.filter(n=>Pi(n)===_t.BOARD).forEach(n=>{const r=We(n),i=fs(n);Le(tt,w.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),e.length===0&&(Le(tt,w.elementfocus,""),Hn(tt,w.elementfocus,"$white no boards found"),Hn(tt,w.elementfocus,"$white use @ to create a board"),Hn(tt,w.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{eo(tt,w.elementfocus,"$REDTRASH"),Hn(tt,w.elementfocus,"books");const t=la();t.length&&(t.forEach(n=>{Le(tt,w.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Le(tt,w.elementfocus,""));const e=be(Bt.MAIN);return E(e)&&(Hn(tt,w.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=We(n);Le(tt,w.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Le(tt,w.elementfocus,"")),0}).command("dev",()=>(ea(),BA(tt,w.elementfocus),0)).command("share",()=>(ea(),DA(tt,w.elementfocus),0)).command("save",()=>(ea(),0)).command("fork",()=>(eR(tt,w.elementfocus),0)).command("nuke",()=>($A(tt,w.elementfocus),0)).command("restart",()=>(tR(tt,w.elementfocus),ea(),0)).command("export",()=>{J0(tt,w.elementfocus,"E X P O R T"),eo(tt,w.elementfocus,"books");const t=la();return t.length&&t.forEach(e=>Le(tt,w.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return E(r)&&(J0(tt,w.elementfocus,"E X P O R T"),eo(tt,w.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=P0(r);Le(tt,w.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=We(s),a=fs(s);Le(tt,w.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return E(r)&&rg(tt,w.elementfocus,Zn(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),{target:r,path:i}=Xn(n),s=zr(r),o=Bi(s,i);return E(o)&&rg(tt,w.elementfocus,Zn(o),`${We(o)}.${fs(o)}.json`),0}).command("gadget",()=>(qA(tt,w.elementfocus),0)).command("joincode",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return OA(tt,w.elementfocus,!!n),0}).command("jointab",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return IA(tt,w.elementfocus,!!n),0}),R$=ji().command("toast",(t,e)=>{const n=e.map(ye).join("");return bA(tt,w.elementfocus,n),0}).command("palette",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=xE(),i=tn(w.book,_t.PALETTE,n);return E(i)?(r.palette=i.id,he(tt,w.elementfocus,`loaded palette ${n}`)):ue(tt,w.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=xE(),i=tn(w.book,_t.CHARSET,n);return E(i)?(r.charset=i.id,he(tt,w.elementfocus,`loaded charset ${n}`)):ue(tt,w.elementfocus,"not-found",`unabled to find charset ${n}`),0}),Q0={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Mc(t){return ae(t)&&Mx(t[0])}function Mx(t){return E(fr[t])&&wt(t)}function Ux(t){if(wt(t))return Q0[It(t)]}function Fx(t){if(Mc(t))return t;if(Mx(t))return[t];const e=Ux(t);if(E(e))return[e]}function S$(t){const e=w.words[t],n=Fx(e);if(Mc(n))return[n,t+1];const[r,i]=Gn(t),s=Fx(r);return Mc(s)?[s,i]:[void 0,t]}const tp={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};$t.ISSOLID,$t.ISWALK,$t.ISSWIM,$t.ISBULLET,$t.ISWALK,$t.ISSWIM;function Wu(t){return ae(t)&&ep(t[0])}function ep(t){return E($t[t])&&wt(t)}function O$(t){if(wt(t))return tp[It(t)]}function I$(t){const e=w.words[t];if(Wu(e))return[e,t+1];if(ep(e))return[[e],t+1];const[n,r]=Gn(t);return Wu(n)?[n,r]:ep(n)?[[n],r]:[void 0,t]}const N$=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Px=new Set(["char","color","bg","group","party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","lightdir","sender","arg"]),C$=["NORTH","SOUTH","WEST","EAST"];function L$(t){const e=Sr(t);if(At(e.inputcurrent)||(e.inputcurrent=0),ae(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Sn.NONE,i=0]=n??[Sn.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&dN?1:0,e.inputctrl=i&pN?1:0,e.inputshift=i&mN?1:0,r){case Sn.MOVE_UP:case Sn.MOVE_DOWN:case Sn.MOVE_LEFT:case Sn.MOVE_RIGHT:e.inputmove=[C$[r-Sn.MOVE_UP]];break;case Sn.OK_BUTTON:e.inputok=1;break;case Sn.CANCEL_BUTTON:e.inputcancel=1;break;case Sn.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Sn.NONE&&o!==r}),e}function M$(t){const e=Q0[t];if(E(e))return e;const n=tp[t];if(E(n))return n;const r=tc[t];if(E(r))return r;const i=od[t];if(E(i))return i}const U$=ji({get(t,e){var o,a,c,l,u,f,d,h,p,m,y,b,k,T,A,C,R,S,U,I,D;const n=M$(e);if(E(n))return[!0,n];if(w.elementisplayer&&N$.has(e)){const V=L$(w.elementid)[e];return[E(V),V]}const r=oc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus??cr();switch(e){case"isdark":return[!0,(c=w.board)!=null&&c.isdark?1:0];case"startx":return[!0,((l=w.board)==null?void 0:l.startx)??0];case"starty":return[!0,((u=w.board)==null?void 0:u.starty)??0];case"over":return[!0,((f=w.board)==null?void 0:f.over)??""];case"under":return[!0,((d=w.board)==null?void 0:d.under)??""];case"camera":return[!0,((h=w.board)==null?void 0:h.camera)??""];case"graphics":return[!0,((p=w.board)==null?void 0:p.graphics)??""];case"facing":break;case"exitnorth":return[!0,((m=w.board)==null?void 0:m.exitnorth)??""];case"exitsouth":return[!0,((y=w.board)==null?void 0:y.exitsouth)??""];case"exitwest":return[!0,((b=w.board)==null?void 0:b.exitwest)??""];case"exiteast":return[!0,((k=w.board)==null?void 0:k.exiteast)??""];case"timelimit":return[!0,((T=w.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=w.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((C=w.board)==null?void 0:C.maxplayershots)??0];case"boardid":return[!0,((R=w.board)==null?void 0:R.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((S=w.element)==null?void 0:S.id)??""];case"thisx":return[!0,((U=w.element)==null?void 0:U.x)??-1];case"thisy":return[!0,((I=w.element)==null?void 0:I.y)??-1];default:{const V=(D=w.element)==null?void 0:D[e];if(Px.has(e))return[!0,V];break}}const s=Sr(i)[e];return[E(s),s]},set(t,e,n){var o,a;const r=oc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus;switch(e){case"isdark":if(E(w.board))return w.board.isdark=n?1:0,[!0,w.board.isdark];break;case"startx":if(E(w.board))return w.board.startx=Nc(n,0),[!0,w.board.startx];break;case"starty":if(E(w.board))return w.board.starty=Nc(n,0),[!0,w.board.starty];break;case"over":if(E(w.board))return w.board.over=At(n)?n:ye(n),[!0,w.board.over];break;case"under":if(E(w.board))return w.board.under=At(n)?n:ye(n),[!0,w.board.under];break;case"camera":if(E(w.board))return[!0,w.board.camera=ye(n)];break;case"graphics":if(E(w.board))return[!0,w.board.graphics=ye(n)];break;case"facing":break;case"exitnorth":if(E(w.board))return w.board.exitnorth=ye(n),[!0,w.board.exitnorth];break;case"exitsouth":if(E(w.board))return w.board.exitsouth=ye(n),[!0,w.board.exitsouth];break;case"exitwest":if(E(w.board))return w.board.exitwest=ye(n),[!0,w.board.exitwest];break;case"exiteast":if(E(w.board))return w.board.exiteast=ye(n),[!0,w.board.exiteast];break;case"timelimit":if(E(w.board))return w.board.timelimit=Nc(n,0),[!0,w.board.timelimit];break;case"restartonzap":if(E(w.board))return w.board.restartonzap=n?1:0,[!0,w.board.restartonzap];break;case"maxplayershots":if(E(w.board))return w.board.maxplayershots=Nc(n,0),[!0,w.board.maxplayershots];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(Px.has(e))return E(w.element)&&(w.element[e]=n),[!0,n];break}}const s=Sr(i);return E(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n,r,i;if(!((t=w.element)!=null&&t.removed)&&(E((e=w.element)==null?void 0:e.stepx)||E((n=w.element)==null?void 0:n.stepy))){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};ha(w.book,w.board,w.element,{x:s.x+(w.element.stepx??0),y:s.y+(w.element.stepy??0)})===!1&&(w.element.stepx=0,w.element.stepy=0,je(w.book,w.element,"destructible")&&or(w.book,w.board,w.element,w.timestamp))}}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(ye(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{var r,i;const[n]=rt(e,0,[z.KIND]);if(Ge(w.book,w.board),D0(w.book,w.board,w.element),or(w.book,w.board,w.element,w.timestamp)){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};ms(w.book,w.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=rt(e,0,[z.ANY]);if(ii(n)){const[r,i]=rt(e,0,[z.DIR,z.NUMBER]),s=me(w.board,r.destpt);E(s)&&(s.char=i)}else E(w.element)&&At(n)&&(w.element.char=n);return 0}).command("color",(t,e)=>{const[n]=rt(e,0,[z.ANY]);if(ii(n)){const[r,i]=rt(e,0,[z.DIR,z.COLOR]),s=me(w.board,r.destpt);E(s)&&sc(w.element,i)}else{const[r]=rt(e,0,[z.COLOR]);E(w.element)&&E(r)&&sc(w.element,r)}return 0}).command("go",(t,e)=>{if(E(w.element)){const[n]=rt(e,0,[z.DIR]);if(ha(w.book,w.board,w.element,n.destpt),t.yield(),w.element.x===n.destpt.x&&w.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!E(w.element))return 0;const[n]=rt(e,0,[z.DIR]),r=w.element.x??0,i=w.element.y??0;return w.element.stepx=n.destpt.x-r,w.element.stepy=n.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=rt(e,0,[z.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(ye(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(ye(e[0])),0)).command("cycle",(t,e)=>{if(E(w.element)){const[n]=rt(e,0,[z.NUMBER]);w.element.cycle=Xe(Math.round(n),1,255)}return 0}).command("die",t=>(or(w.book,w.board,w.element,w.timestamp),t.endofprogram(),0)).command("endgame",()=>(og(tt,w.elementfocus),0)).command("run",(t,e)=>{const[n]=rt(e,0,[z.NAME]);return ch(n),0}).command("runwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY,z.NAME]);return t.set("arg",n),ch(r),0}),Gu={};function F$(t){var e;return(e=Gu[t])==null?void 0:e.arg}function P$(t){var e;return(e=Gu[t])==null?void 0:e.format}function _s(t){var e;return(e=Gu[t])==null?void 0:e.content}function B$(t,e,n,r,i){const s=be(Bt.MAIN);if(!E(s))return;const o=Js(s,_t.LOADER).filter(a=>{const c=qs(a),l=c.format,u=wt(l)?new RegExp(l).test(e):!1,f=c.event,d=wt(f)?new RegExp(f).test(n):!1;return wt(l)&&wt(f)?u&&d:wt(l)?u:wt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${Be()}_loader`;Gu[c]={arg:t,format:e,content:r,player:i},O4(c,o[a].code)}}function Bx(t,e){if(!E(t))return;const n=It(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const D$=(t,e)=>{const n=_s(t.id());if(!E(n))return 0;const[r,i]=rt(e,0,[z.NAME]),s=It(r);switch(s){case"seek":{const[o]=rt(e,i,[z.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(e,i,[z.NAME]);t.set(o,Bx(n,s));break}case"text":{const[o,a]=rt(e,i,[z.NAME,z.NAME]),c=Bx(n,o);if(At(c)&&wt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);t.set(a,f),n.cursor+=c}break}case"palette":{const[o]=rt(e,i,[z.NAME]),a=F0(w.book,_t.PALETTE,o),c=Ce(a);if(E(c)){const l=oN*cc,u=Td(new Uint8Array(n.bytes.buffer,n.cursor,l));E(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(e,i,[z.NAME]),a=F0(w.book,_t.CHARSET,o),c=Ce(a);if(E(c)){const l=Gl*sN*kd,u=rb(new Uint8Array(n.bytes.buffer,n.cursor,l));E(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},na=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",Yu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!Yu(t[n],e[n]))return!1;return!0}if(na(t)&&na(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Yu(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},Vu=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(na(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},$$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",Dx=t=>t>="0"&&t<="9"||t==="-",j$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var X;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(X||(X={}));const $x={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},z$={"!":!0,"<":!0,"=":!0,">":!0},K$={"	":!0,"\n":!0,"\r":!0," ":!0};class H${constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if($$(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if($x[e[this._current]]!==void 0)n.push({start:this._current,type:$x[e[this._current]],value:e[this._current]}),this._current+=1;else if(Dx(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(z$[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(K$[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&j$(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;Dx(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const W$=new H$,xn={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class G${constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...W$.tokenize(e),{type:X.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<xn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case X.TOK_LITERAL:return{type:"Literal",value:e.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(xn.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(xn.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(e.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(xn.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(xn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(xn.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case X.TOK_DOT:const i=xn.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(xn.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(xn.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(xn.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(xn.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(xn.Flatten);return{type:"Projection",children:[u,f]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,e);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(xn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(xn.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(xn[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(e);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(xn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const Y$=new G$;var ut;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class V${constructor(e){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>na(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var y;return(y=!m.optional)!==null&&y!==void 0?y:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,h=this.getTypeName(n[m]);let y;for(y=0;y<d.length;y+=1)if(h!==void 0&&this.typeMatches(h,d[y],n[m])){p=!0;break}if(!p&&h!==void 0){const b=d.map(k=>this.TYPE_NAME_TABLE[k]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${b}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(e,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return e===ut.TYPE_ARRAY;if(e===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return e.jmespathType===X.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class Z${constructor(){this._rootValue=null,this.runtime=new V$(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,f,d,h;switch(e.type){case"Field":return n===null?null:na(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...e.children],y=this.computeSliceParams(n.length,m),[b,k,T]=y;if(s=[],T>0)for(d=b;d<k;d+=T)s.push(n[d]);else for(d=b;d>k;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(e.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(e.children[0],n),!na(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(e.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;const C=[],R=[];for(d=0;d<h.length;d+=1)r=this.visit(e.children[2],h[d]),Vu(r)||C.push(h[d]);for(let L=0;L<C.length;L+=1)i=this.visit(e.children[1],C[L]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case X.TOK_EQ:s=Yu(o,a);break;case X.TOK_NE:s=!Yu(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case X.TOK_FLATTEN:const S=this.visit(e.children[0],n);if(!Array.isArray(S))return null;let U=[];for(d=0;d<S.length;d+=1)i=S[d],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<e.children.length;d+=1)f.push(this.visit(e.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let I;for(d=0;d<e.children.length;d+=1)I=e.children[d],f[I.name]=this.visit(I.value,n);return f;case"OrExpression":return r=this.visit(e.children[0],n),Vu(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),Vu(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),Vu(o);case"Literal":return e.value;case X.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const D=[];for(let L=0;L<e.children.length;L+=1)D.push(this.visit(e.children[L],n));return this.runtime.callFunction(e.name,D);case"ExpressionReference":const V=e.children[0];return V.jmespathType=X.TOK_EXPREF,V;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const X$=new Z$;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function q$(t,e){const n=Y$.parse(e);return X$.search(n,t)}const J$=(t,e)=>{const n=_s(t.id());if(!E(n))return 0;const[r,i]=rt(e,0,[z.NAME,z.NAME]),s=q$(n.json,r);return t.set(i,s),0};function Q$(t,e){return Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2))}const Zu=Td(ib);function jx(t){let e;if(!E(Zu))return e;let n=1e9;for(let r=0;r<=Rt.BLACK;++r){const i=r*cc,s=Zu.bits[i],o=Zu.bits[i+1],a=Zu.bits[i+2],c=Q$(t,{r:s,g:o,b:a,hex:""});c<n&&(e=r,n=c)}return e}const t5=(t,e)=>{var a,c,l,u;const n=_s(t.id());if(!E(n))return 0;const[r,i]=rt(e,0,[z.NAME]),s=It(r),o=((a=n.content)==null?void 0:a.layers)??[];switch(s){case"seek":{const[f]=rt(e,i,[z.NUMBER]);n.cursor=Xe(f,0,o.length-1);break}case"layer":{const f=n.cursor+1;n.cursor=Xe(f,0,o.length-1);break}case"char":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(c=n.content)==null?void 0:c.layers[n.cursor];E(p)&&Po(f,d,0,p.width-1,p.height-1,0)&&t.set(h,p.raster[f+d*p.width].asciiCode);break}case"color":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(l=n.content)==null?void 0:l.layers[n.cursor];E(p)&&Po(f,d,0,p.width-1,p.height-1,0)&&t.set(h,jx(p.raster[f+d*p.width].color));break}case"bg":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(u=n.content)==null?void 0:u.layers[n.cursor];E(p)&&Po(f,d,0,p.width-1,p.height-1,0)&&t.set(h,jx(p.raster[f+d*p.width].bg));break}}return 0},e5=(t,e)=>{const n=_s(t.id());if(!E(n))return 0;const[r,i]=rt(e,0,[z.NAME]);switch(It(r)){case"seek":{const[o]=rt(e,i,[z.NUMBER]);n.cursor=Xe(o,0,n.lines.length-1);break}case"line":n.cursor=Xe(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[f,d]=rt(e,u,[z.NAME]);t.set(f,c[l]??0),++l,u=d}break}}return 0},n5=ji({get(t,e){var r,i,s;const n=P$(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const o=_s(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"lines":return[!0,o.lines.length]}break}case"json":{const o=_s(t.id());switch(e){case"filename":return[!0,o.filename]}break}case"binary":{const o=_s(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"bytes":return[!0,o.bytes.length]}break}case"rexpaint":{const o=_s(t.id());switch(e){case"filename":return[!0,o.filename];case"layers":return[!0,((r=o.content)==null?void 0:r.layers.length)??0];case"width":return[!0,((i=o.content)==null?void 0:i.layers[o.cursor].width)??0];case"height":return[!0,((s=o.content)==null?void 0:s.layers[o.cursor].height)??0];case"cursor":return[!0,o.cursor]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);return mp(n,r),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(ye).join(" ");return he(tt,w.elementfocus,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ye(n),s=r.map(ye).join(" ");return he(tt,w.elementfocus,"$175",`!${s};${i}`),0}).command("readline",e5).command("readjson",J$).command("readbin",D$).command("readrexpaint",t5).command("with",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zn(w.book,_t.BOARD,n);if(r.length){const i=Te(...r);E(i)&&(w.board=Ce(i),w.element={x:-1,y:-1})}return 0});function zx(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[z.ANY]);ae(c)&&!ii(c)&&!Mc(c)&&!Wu(c)&&!si(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":kA(tt,w.elementfocus,t,e,n,r,o);break}return 0}const r5=ji().command("fetch",(t,e)=>{const[n,r,i="get",s]=rt(e,0,[z.NAME,z.NAME,z.MAYBE_STRING]);return zx(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=rt(e,0,[z.ANY,z.NAME,z.NAME,z.MAYBE_STRING]);return zx(n,r,i,s,e,o),0}).command("chat",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return n?EA(tt,w.elementfocus,n):vA(tt,w.elementfocus),0}).command("broadcast",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return n?wA(tt,w.elementfocus,n):xA(tt,w.elementfocus),0}),i5=ji({set(t,e,n){return $4(t,e,n),[!1,void 0]},everytick(){const t=ur(w.elementid),[e]=t;if(t.length===1&&wt(e)){if(E(w.element))if(e.trim().length===0){const n=hn(w.elementid);n.sidebar=[]}else w.element.tickertext=e,w.element.tickertime=w.timestamp}else if(t.length>1)if(w.elementisplayer){const n=hn(w.elementid);n.sidebar=t}else{const n=hn(w.elementfocus);n.scroll=t}}}).command("send",(t,e)=>{var a,c;const[n,r]=rt(e,0,[z.NAME,z.ANY]),[i,s]=Nx(n);switch(It(i)){case"all":for(const l of Object.keys(((a=w.board)==null?void 0:a.objects)??{}))t.send(w.elementfocus,l,s,r);break;case"self":t.message({session:tt.session(),player:w.elementfocus,id:Be(),sender:t.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((c=w.board)==null?void 0:c.objects)??{}))l!==t.id()&&t.send(w.elementfocus,l,s,r);break;default:{const l=Qy(w.board,[i]);for(let u=0;u<l.length;++u){const f=l[u];E(f.id)&&t.send(w.elementfocus,f.id,s,r)}break}}return 0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(ye).join("");return ee(w.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ye(n);return Ut(w.elementid,t.id(),i,r,t.get,t.set),0});function Kx(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=me(e,{x:s,y:i});wn(o)&&or(t,e,o,t.timestamp),ln(e,{x:s,y:i})}}function s5(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)ln(t,{x:i,y:r})}function Hx(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=me(e,{x:s,y:i});wn(o)&&or(t,e,o,t.timestamp),ln(e,{x:s,y:i})}}function Xu(t,e){E(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.code=e.code,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.stepx=e.stepx,t.stepy=e.stepy,t.pushable=e.pushable,t.collision=e.collision,t.destructible=e.destructible,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function np(t,e,n,r,i){if(!E(w.book))return;const s=w.book,o=tn(s,_t.BOARD,t),a=Ce(o);if(!E(a))return;const c=tn(s,_t.BOARD,e),l=Ce(c);if(!E(l))return;Ge(s,a),Ge(s,l);let u=!1;if(E(a)&&E(l)){switch(i){case"all":Kx(s,l,n,r);break;case"object":Hx(s,l,n,r);break;case"terrain":s5(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,p=!1;switch(i){case"all":h=!0,p=!0;break;case"object":h=!0;break;case"terrain":p=!0;break}const m={x:d,y:f};let y,b=me(a,m);if(wn(b)?(y=Ho(a,d,f),Kr(b==null?void 0:b.id)&&(b=void 0)):(y=b,b=void 0),E(y)&&(p||u&&ds(s,y)===i)){u&&Kx(s,l,m,m);const k=ms(s,l,[y.kind??""],m);Xu(k,y)}if(E(b)&&(h||u&&ds(s,b)===i)){u&&Hx(s,l,m,m);const k=ms(s,l,[b.kind??""],m);Xu(k,b)}}zu(s,l)}}function o5(t,e,n,r,i){if(!E(w.book))return;const s=w.book,o=tn(s,_t.BOARD,t),a=Ce(o);if(!E(a))return;const c=wd(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Ge(s,a),Ge(s,c);const f=-Math.tan(e*.5),d=Math.sin(e),h=Math.round(12.5*f),p=Math.round(12.5*d),m=new Array(Yt).fill(0);ry(h,0,-h,Yt-1).forEach(A=>{A.x<0?m[A.y]=Math.min(m[A.y],A.x):m[A.y]=Math.max(m[A.y],A.x)});const b=new Array(St).fill(0);ry(0,p,St-1,-p).forEach(A=>{A.y<0?b[A.x]=Math.min(b[A.x],A.y):b[A.x]=Math.max(b[A.x],A.y)});const T=[m,b,m];for(let A=0;A<T.length;++A){const C=T[A];if(A!==1){for(let R=0;R<Yt;++R){const S=C[R],U=R*St;for(let I=0;I<St;I++){const D=(I+S+St)%St;u&&(c.terrain[D+U]=a.terrain[I+U])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:I,y:D}=a.objects[U];if(E(I)&&E(D)){const V=C[D];a.objects[U].x=(I+V+St)%St,a.objects[U].lx=a.objects[U].x}}}}if(A===1){for(let R=0;R<St;++R){const S=C[R];for(let U=0;U<Yt;++U){const I=(U+S+Yt)%Yt;u&&(c.terrain[R+I*St]=a.terrain[R+U*St])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:I,y:D}=a.objects[U];if(E(I)&&E(D)){const V=C[I];a.objects[U].y=(D+V+Yt)%Yt,a.objects[U].ly=a.objects[U].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Ge(s,c),Ge(s,a)}}function a5(t,e){let n=0,r=0,i=0;for(;i<t.length;i++)n+=t[i];for(i=0,e*=n;e&&i<t.length;){if(r+=t[i],e<=r)return i;i++}return 0}var c5=a5;const l5=c5,qt=function(){};qt.prototype.FMX=0,qt.prototype.FMY=0,qt.prototype.FMXxFMY=0,qt.prototype.T=0,qt.prototype.N=0,qt.prototype.initiliazedField=!1,qt.prototype.generationComplete=!1,qt.prototype.wave=null,qt.prototype.compatible=null,qt.prototype.weightLogWeights=null,qt.prototype.sumOfWeights=0,qt.prototype.sumOfWeightLogWeights=0,qt.prototype.startingEntropy=0,qt.prototype.sumsOfOnes=null,qt.prototype.sumsOfWeights=null,qt.prototype.sumsOfWeightLogWeights=null,qt.prototype.entropies=null,qt.prototype.propagator=null,qt.prototype.observed=null,qt.prototype.distribution=null,qt.prototype.stack=null,qt.prototype.stackSize=0,qt.prototype.DX=[-1,0,1,0],qt.prototype.DY=[0,1,0,-1],qt.prototype.opposite=[2,3,0,1],qt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let e=0;e<this.T;e++)this.compatible[t][e]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},qt.prototype.observe=function(t){let e=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=e){const c=1e-6*t();a+c<e&&(e=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=l5(this.distribution,t()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},qt.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const e=t[0],n=e%this.FMX,r=e/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][t[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],p=f[h];p[i]--,p[i]==0&&this.ban(l,h)}}}},qt.prototype.singleIteration=function(t){const e=this.observe(t);return e!==null?(this.generationComplete=e,!!e):(this.propagate(),null)},qt.prototype.iterate=function(t,e){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,e=e||Math.random;for(let n=0;n<t||t===0;n++){const r=this.singleIteration(e);if(r!==null)return!!r}return!0},qt.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const e=this.singleIteration(t);if(e!==null)return!!e}},qt.prototype.isGenerationComplete=function(){return this.generationComplete},qt.prototype.ban=function(t,e){const n=this.compatible[t][e];for(let i=0;i<4;i++)n[i]=0;this.wave[t][e]=!1,this.stack[this.stackSize]=[t,e],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[e],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[e];const r=this.sumsOfWeights[t];this.entropies[t]=Math.log(r)-this.sumsOfWeightLogWeights[t]/r},qt.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let e=0;e<this.T;e++){this.wave[t][e]=!0;for(let n=0;n<4;n++)this.compatible[t][e][n]=this.propagator[this.opposite[n]][e].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Wx=qt;const Gx=Wx,zi=function(e,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let I=0;I<f;I++)d[I]=new Array(r);this.colors=[];const h={};for(let I=0;I<r;I++)for(let D=0;D<n;D++){const V=(I*n+D)*4,L=[e[V],e[V+1],e[V+2],e[V+3]],N=L.join("-");h.hasOwnProperty(N)||(h[N]=this.colors.length,this.colors.push(L)),d[D][I]=h[N]}const p=this.colors.length,m=Math.pow(p,i*i),y=function(D){let V=new Array(i*i);for(let L=0;L<i;L++)for(let N=0;N<i;N++)V[N+L*i]=D(N,L);return V},b=function(D,V){return y(function(L,N){return d[(D+L)%n][(V+N)%r]})},k=function(D){return y(function(V,L){return D[i-1-L+V*i]})},T=function(D){return y(function(V,L){return D[i-1-V+L*i]})},A=function(D){let V=0,L=1;for(let N=0;N<D.length;N++)V+=D[D.length-1-N]*L,L*=p;return V},C=function(D){let V=D,L=m;const N=new Array(i*i);for(let x=0;x<N.length;x++){L/=p;let B=0;for(;V>=L;)V-=L,B++;N[x]=B}return N},R={},S=[];for(let I=0;I<(a?r:r-i+1);I++)for(let D=0;D<(a?n:n-i+1);D++){const V=new Array(8);V[0]=b(D,I),V[1]=T(V[0]),V[2]=k(V[0]),V[3]=T(V[2]),V[4]=k(V[2]),V[5]=T(V[4]),V[6]=k(V[4]),V[7]=T(V[6]);for(let L=0;L<l;L++){const N=A(V[L]);R[N]?R[N]++:(S.push(N),R[N]=1)}}this.T=S.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let I=0;I<this.T;I++){const D=parseInt(S[I],10);this.patterns[I]=C(D),this.weights[I]=R[D]}const U=function(D,V,L,N){const x=L<0?0:L,B=L<0?L+i:i,Z=N<0?0:N,$=N<0?N+i:i;for(let st=Z;st<$;st++)for(let nt=x;nt<B;nt++)if(D[nt+i*st]!=V[nt-L+i*(st-N)])return!1;return!0};this.propagator=new Array(4);for(let I=0;I<4;I++){this.propagator[I]=new Array(this.T);for(let D=0;D<this.T;D++){const V=[];for(let L=0;L<this.T;L++)U(this.patterns[D],this.patterns[L],this.DX[I],this.DY[I])&&V.push(L);this.propagator[I][D]=V}}};zi.prototype=Object.create(Gx.prototype),zi.prototype.constructor=zi,zi.prototype.onBoundary=function(t,e){return!this.periodic&&(t+this.N>this.FMX||e+this.N>this.FMY||t<0||e<0)},zi.prototype.clear=function(){if(Gx.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let e=0;e<this.T;e++)e!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,e);for(let e=0;e<this.FMY-1;e++)this.ban(t+e*this.FMX,this.ground)}this.propagate()}},zi.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},zi.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMY;e++){const n=e<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(e*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(e-n)*this.FMX]][i+n*this.N]];t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3]}}},zi.prototype.graphicsIncomplete=function(t){for(let e=0;e<this.FMXxFMY;e++){const n=e%this.FMX,r=e/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const p=d+h*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const y=this.colors[this.patterns[m][f+u*this.N]];s+=y[0],o+=y[1],a+=y[2],c+=y[3]}}const l=e*4;t[l]=s/i,t[l+1]=o/i,t[l+2]=a/i,t[l+3]=c/i}};var u5=zi;const h5=Wx,ys=function(e,n,r,i,s){const o=e.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!e.unique;let c=null;n&&e.subsets&&e.subsets[n]&&(c=e.subsets[n]);const l=function(A){const C=new Array(o*o);for(let R=0;R<o;R++)for(let S=0;S<o;S++)C[S+R*o]=A(S,R);return C},u=function(A){return l(function(C,R){return A[o-1-R+C*o]})},f=function(A){return l(function(C,R){return A[o-1-C+R*o]})};this.tiles=[];const d=[],h=[],p={};let m,y,b;for(let T=0;T<e.tiles.length;T++){const A=e.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":b=4,m=function(R){return(R+1)%4},y=function(R){return R%2===0?R+1:R-1};break;case"T":b=4,m=function(R){return(R+1)%4},y=function(R){return R%2===0?R:4-R};break;case"I":b=2,m=function(R){return 1-R},y=function(R){return R};break;case"\\":b=2,m=function(R){return 1-R},y=function(R){return 1-R};break;case"F":b=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},y=function(R){return R<4?R+4:R-4};break;default:b=1,m=function(R){return R},y=function(R){return R};break}this.T=h.length,p[A.name]=this.T;for(let R=0;R<b;R++)h.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+y(R),this.T+y(m(R)),this.T+y(m(m(R))),this.T+y(m(m(m(R))))]);let C;if(a)for(let R=0;R<b;R++)C=A.bitmap[R],this.tiles.push(l(function(S,U){return[C[(o*U+S)*4],C[(o*U+S)*4+1],C[(o*U+S)*4+2],C[(o*U+S)*4+3]]}));else{C=A.bitmap,this.tiles.push(l(function(R,S){return[C[(o*S+R)*4],C[(o*S+R)*4+1],C[(o*S+R)*4+2],C[(o*S+R)*4+3]]}));for(let R=1;R<b;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):f(this.tiles[this.T+R-4]))}for(let R=0;R<b;R++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const k=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),k[T]=new Array(this.T);for(let A=0;A<this.T;A++){k[T][A]=new Array(this.T);for(let C=0;C<this.T;C++)k[T][A][C]=!1}}for(let T=0;T<e.neighbors.length;T++){const A=e.neighbors[T],C=A.left.split(" ").filter(function(V){return V.length}),R=A.right.split(" ").filter(function(V){return V.length});if(c!==null&&(c.indexOf(C[0])===-1||c.indexOf(R[0])===-1))continue;const S=h[p[C[0]]][C.length==1?0:parseInt(C[1],10)],U=h[S][1],I=h[p[R[0]]][R.length==1?0:parseInt(R[1],10)],D=h[I][1];k[0][I][S]=!0,k[0][h[I][6]][h[S][6]]=!0,k[0][h[S][4]][h[I][4]]=!0,k[0][h[S][2]][h[I][2]]=!0,k[1][D][U]=!0,k[1][h[U][6]][h[D][6]]=!0,k[1][h[D][4]][h[U][4]]=!0,k[1][h[U][2]][h[D][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)k[2][T][A]=k[0][A][T],k[3][T][A]=k[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const C=[],R=k[T][A];for(let S=0;S<this.T;S++)R[S]&&C.push(S);this.propagator[T][A]=C}};ys.prototype=Object.create(h5.prototype),ys.prototype.constructor=ys,ys.prototype.onBoundary=function(t,e){return!this.periodic&&(t<0||e<0||t>=this.FMX||e>=this.FMY)},ys.prototype.graphics=function(t,e){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,e),t},ys.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMX;e++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[e+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(e*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];t[o]=a[0],t[o+1]=a[1],t[o+2]=a[2],t[o+3]=a[3]}}},ys.prototype.graphicsIncomplete=function(t,e){(!e||e.length!==4)&&(e=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(e&&s===this.T)t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];else{let f=0,d=0,h=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const y=this.tiles[m][l+c*this.tilesize],b=this.weights[m]*a;f+=y[0]*b,d+=y[1]*b,h+=y[2]*b,p+=y[3]*b}t[u]=f,t[u+1]=d,t[u+2]=h,t[u+3]=p}}}};var f5=ys,d5={OverlappingModel:u5,SimpleTiledModel:f5},p5=so(d5);const Yx=5;function Vx(t,e,n,r,i,s,o){if(!E(w.book))return!1;const a=w.book,c=tn(a,_t.BOARD,t),l=tn(a,_t.BOARD,e),u=Ce(c),f=Ce(l);if(!E(u)||!E(f))return!1;Ge(a,u),Ge(a,f);let d=0;const h=new Map,p=new Map;let m=0;const y=32,b=new Uint8Array(bd*4);for(let S=0;S<Yt;++S)for(let U=0;U<St;++U){const I=me(f,{x:U,y:S}),D=(I==null?void 0:I.char)??0,V=(I==null?void 0:I.color)??y,L=(I==null?void 0:I.bg)??y;b[m++]=D,b[m++]=V,b[m++]=L;const N=Di(a,I),x=It((N==null?void 0:N.name)??"empty"),B=h.get(x);At(B)?b[m++]=B:(h.set(x,d),p.set(d,x),b[m++]=d++)}const k=s.x-i.x+1,T=s.y-i.y+1,A=new p5.OverlappingModel(b,St,Yt,n,k,T,!1,!1,r,0);let C=0;for(;C<Yx&&!A.generate();++C);if(C===Yx)return!1;m=0;const R=A.graphics();for(let S=i.y;S<=s.y;++S)for(let U=i.x;U<=s.x;++U){const I={x:U,y:S},D=R[m++],V=R[m++],L=R[m++];switch(d=R[m++],o){case"all":{const st=me(u,{x:U,y:S});wn(st)&&or(a,u,st,a.timestamp),ln(u,{x:U,y:S});break}case"object":{const st=me(u,{x:U,y:S});wn(st)&&or(a,u,st,a.timestamp);break}case"terrain":ln(u,{x:U,y:S});break}let N=p.get(d)??"";const x=Qs(a,N),B=Ic(a,N),Z=x??B;switch(o){case"all":break;case"object":E(B)&&(N="");break;case"terrain":E(x)&&(N="");break;default:if(ds(a,Z)!==o&&(N=""),N){const st=me(u,{x:U,y:S});wn(st)&&or(a,u,st,a.timestamp),ln(u,{x:U,y:S})}break}const $=N?ms(a,u,[N],I):void 0;if(!(!E($)||!E(Z))&&(Xu($,Z),D>0&&($.char=D),V<y&&($.color=V),L<y&&($.bg=L),wn($))){const st=Te(ac(f,N));E(st)&&(ln(u,{...Ho(f,st.x??0,st.y??0),x:U,y:S}),Xu($,st))}}return!0}function Zx(t){return`zss_snapshot_${t}`}function m5(t,e,n,r){const i=tn(w.book,_t.BOARD,t),s=Ce(i);if(!E(s))return;const o=Zx(s.id);dx(w.book,o);const a=xs(Bt.CONTENT,o,_t.BOARD),c=Ce(a);if(E(c))return np(t,c.id,e,n,r),c}function g5(t,e,n,r){const i=tn(w.book,_t.BOARD,t),s=Ce(i);if(!E(s))return;const o=Zx(s.id),a=tn(w.book,_t.BOARD,o),c=Ce(a);if(E(c))return np(c.id,t,e,n,r),c}function _5(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return y5(t,e,i)}if(!E(w.book))return;const s=w.book,o=tn(s,_t.BOARD,t),a=Ce(o);if(!E(a))return;const c=wd();Ge(s,a);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let f=!1,d=!1;switch(i){case"all":f=!0,d=!0;break;case"object":f=!0;break;case"terrain":d=!0;break}const h=(u+e.x+St)%St,p=(l+e.y+Yt)%Yt;if(f){const m=me(a,{x:u,y:l});wn(m)&&E(m==null?void 0:m.x)&&E(m==null?void 0:m.y)&&(m.x=h,m.lx=h,m.y=p,m.ly=p)}d&&(c.terrain[h+p*St]=a.terrain[u+l*St])}(i==="all"||i==="terrain")&&(a.terrain=[...c.terrain]),zu(s,a)}function y5(t,e,n){if(!E(w.book))return;const r=w.book,i=tn(r,_t.BOARD,t),s=Ce(i);if(!E(s))return;Ge(r,s);const{objectelements:o,terrainelements:a}=fF(r,s,n);let c=!1;const l={};for(let f=0;f<a.length;++f){const d=a[f],h=je(r,d,"collision"),p={x:d.x??-1,y:d.y??-1},m=me(s,p);wn(m)&&E(m)&&(l[m.id??""]=!0);const y={x:p.x+e.x,y:p.y+e.y};if(Wl(y)){const b=me(s,y),k=ds(r,b),T=je(r,b,"collision");wn(b)&&n!==k?Wo(h,T)?c=!0:je(r,b,"pushable")?c=ha(r,s,b,y)!==!0:c=!1:T===$t.ISSOLID&&n!==k&&(c=!0)}else c=!0}if(c)return;for(let f=0;f<o.length;++f){const d=o[f],h=je(r,d,"collision"),p={x:d.x??0,y:d.y??0},m={x:p.x+e.x,y:p.y+e.y};if(Wl(m)){const y=me(s,m),b=ds(r,y),k=je(r,y,"collision");wn(y)&&E(y)&&n!==b&&!l[y.id??""]?je(r,y,"pushable")?c=ha(r,s,y,m)!==!0:c=!0:Wo(h,k)&&n!==b&&(c=!0)}else c=!0}if(c)return;(e.x>0||e.y>0)&&a.reverse();for(let f=0;f<a.length;++f){const d=a[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y},m=Ho(s,p.x,p.y);if(E(d)&&E(m)){ln(s,{...d,x:p.x,y:p.y}),ln(s,{...m,x:h.x,y:h.y});const y=me(s,h);wn(y)&&E(y)&&(y.x=(y.x??0)+e.x,y.y=(y.y??0)+e.y,y.lx=(y.lx??0)+e.x,y.ly=(y.ly??0)+e.y)}}zu(r,s);for(let f=0;f<o.length;++f){const d=o[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y};if(!ha(r,s,d,p))break}zu(r,s)}function ra(t,e){let n="all";const r={x:0,y:0},i={x:St-1,y:Yt-1};for(let s=e;s<t.length;){const[o,a]=rt(t,s,[z.MAYBE_NUMBER_OR_STRING]);if(wt(o))n=It(o),s=a;else if(At(o)){const[c,l,u,f]=rt(t,a,[z.NUMBER,z.NUMBER,z.NUMBER]);r.x=Math.min(o,l),r.y=Math.min(c,u),i.x=Math.max(o,l),i.y=Math.max(c,u),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const b5=ji().command("snapshot",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;const n=ra(e,0);return m5(w.board.id,n.pt1,n.pt2,n.targetset),0}).command("revert",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;const n=ra(e,0);return g5(w.board.id,n.pt1,n.pt2,n.targetset),0}).command("copy",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;const[n,r]=rt(e,0,[z.NAME]),i=zn(w.book,_t.BOARD,n),s=Te(...i);if(E(s)){const o=ra(e,r);np(s.id,w.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;const[n,r,i,s]=rt(e,0,[z.NAME,z.NUMBER,z.NUMBER]),o=zn(w.book,_t.BOARD,n),a=Te(...o);if(E(a)){const c=ra(e,s);Vx(w.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{var o,a;if(!E(w.book)||!E(w.board))return 0;const[n,r]=rt(e,0,[z.DIR]),i={x:n.destpt.x-(((o=w.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=w.element)==null?void 0:a.y)??0)},s=ra(e,r);return _5(w.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(t,e)=>{if(!E(w.book)||!E(w.board))return 0;const[n,r]=rt(e,0,[z.NUMBER]),i=ra(e,r);return o5(w.board.id,uy(n),i.pt1,i.pt2,i.targetset),0});var bs=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(bs||{});const w5={audio:K0,board:AF,cli:A$,display:R$,element:U$,runtime:i5,loader:n5,network:r5,transform:b5},rp=["audio","board","display","network","transform","element"],x5={0:[],1:["cli",...rp],2:["loader",...rp],3:["runtime",...rp]},E5={0:new Map,1:new Map,2:new Map,3:new Map};function ia(t){return(x5[t]??[]).map(n=>w5[n]).filter(E)}function ip(t){const e=[],n=ia(t);for(let r=0;r<n.length;++r)e.push(...n[r].listcommands());return e}function v5(t,e){const n=E5[t];if(!n.has(e)){let r;const i=ia(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!E(r));++s);n.set(e,r)}return n.get(e)}function k5(t,e,n){const r=ia(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function T5(t,e,n,r){const i=ia(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function A5(t,e){const n=ia(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function Xx(t,e){const n=ia(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var qx={},Jx={},Qx={};const tE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Qx.encode=function(t){if(0<=t&&t<tE.length)return tE[t];throw new TypeError("Must be between 0 and 63: "+t)};const R5=Qx,eE=5,nE=1<<eE,S5=nE-1,O5=nE;function I5(t){return t<0?(-t<<1)+1:(t<<1)+0}Jx.encode=function(e){let n="",r,i=I5(e);do r=i&S5,i>>>=eE,i>0&&(r|=O5),n+=R5.encode(r);while(i>0);return n};var Uc={};(function(t){function e(R,S,U){if(S in R)return R[S];if(arguments.length===3)return U;throw new Error('"'+S+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const S=R.match(n);return S?{scheme:S[1],auth:S[2],host:S[3],port:S[4],path:S[5]}:null}t.urlParse=i;function s(R){let S="";return R.scheme&&(S+=R.scheme+":"),S+="//",R.auth&&(S+=R.auth+"@"),R.host&&(S+=R.host),R.port&&(S+=":"+R.port),R.path&&(S+=R.path),S}t.urlGenerate=s;const o=32;function a(R){const S=[];return function(U){for(let D=0;D<S.length;D++)if(S[D].input===U){const V=S[0];return S[0]=S[D],S[D]=V,S[0].result}const I=R(U);return S.unshift({input:U,result:I}),S.length>o&&S.pop(),I}}const c=a(function(S){let U=S;const I=i(S);if(I){if(!I.path)return S;U=I.path}const D=t.isAbsolute(U),V=[];let L=0,N=0;for(;;)if(L=N,N=U.indexOf("/",L),N===-1){V.push(U.slice(L));break}else for(V.push(U.slice(L,N));N<U.length&&U[N]==="/";)N++;let x=0;for(N=V.length-1;N>=0;N--){const B=V[N];B==="."?V.splice(N,1):B===".."?x++:x>0&&(B===""?(V.splice(N+1,x),x=0):(V.splice(N,2),x--))}return U=V.join("/"),U===""&&(U=D?"/":"."),I?(I.path=U,s(I)):U});t.normalize=c;function l(R,S){R===""&&(R="."),S===""&&(S=".");const U=i(S),I=i(R);if(I&&(R=I.path||"/"),U&&!U.scheme)return I&&(U.scheme=I.scheme),s(U);if(U||S.match(r))return S;if(I&&!I.host&&!I.path)return I.host=S,s(I);const D=S.charAt(0)==="/"?S:c(R.replace(/\/+$/,"")+"/"+S);return I?(I.path=D,s(I)):D}t.join=l,t.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,S){R===""&&(R="."),R=R.replace(/\/$/,"");let U=0;for(;S.indexOf(R+"/")!==0;){const I=R.lastIndexOf("/");if(I<0||(R=R.slice(0,I),R.match(/^([^\/]+:\/)?\/*$/)))return S;++U}return Array(U+1).join("../")+S.substr(R.length+1)}t.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(R){return R}function h(R){return m(R)?"$"+R:R}t.toSetString=f?d:h;function p(R){return m(R)?R.slice(1):R}t.fromSetString=f?d:p;function m(R){if(!R)return!1;const S=R.length;if(S<9||R.charCodeAt(S-1)!==95||R.charCodeAt(S-2)!==95||R.charCodeAt(S-3)!==111||R.charCodeAt(S-4)!==116||R.charCodeAt(S-5)!==111||R.charCodeAt(S-6)!==114||R.charCodeAt(S-7)!==112||R.charCodeAt(S-8)!==95||R.charCodeAt(S-9)!==95)return!1;for(let U=S-10;U>=0;U--)if(R.charCodeAt(U)!==36)return!1;return!0}function y(R,S,U){let I=k(R.source,S.source);return I!==0||(I=R.originalLine-S.originalLine,I!==0)||(I=R.originalColumn-S.originalColumn,I!==0||U)||(I=R.generatedColumn-S.generatedColumn,I!==0)||(I=R.generatedLine-S.generatedLine,I!==0)?I:k(R.name,S.name)}t.compareByOriginalPositions=y;function b(R,S,U){let I=R.generatedLine-S.generatedLine;return I!==0||(I=R.generatedColumn-S.generatedColumn,I!==0||U)||(I=k(R.source,S.source),I!==0)||(I=R.originalLine-S.originalLine,I!==0)||(I=R.originalColumn-S.originalColumn,I!==0)?I:k(R.name,S.name)}t.compareByGeneratedPositionsDeflated=b;function k(R,S){return R===S?0:R===null?1:S===null?-1:R>S?1:-1}function T(R,S){let U=R.generatedLine-S.generatedLine;return U!==0||(U=R.generatedColumn-S.generatedColumn,U!==0)||(U=k(R.source,S.source),U!==0)||(U=R.originalLine-S.originalLine,U!==0)||(U=R.originalColumn-S.originalColumn,U!==0)?U:k(R.name,S.name)}t.compareByGeneratedPositionsInflated=T;function A(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function C(R,S,U){if(S=S||"",R&&(R[R.length-1]!=="/"&&S[0]!=="/"&&(R+="/"),S=R+S),U){const I=i(U);if(!I)throw new Error("sourceMapURL could not be parsed");if(I.path){const D=I.path.lastIndexOf("/");D>=0&&(I.path=I.path.substring(0,D+1))}S=l(s(I),S)}return c(S)}t.computeSourceURL=C})(Uc);var sp={};let N5=class $E{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new $E;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};sp.ArraySet=N5;var rE={};const iE=Uc;function C5(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||iE.compareByGeneratedPositionsInflated(t,e)<=0}let L5=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){C5(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(iE.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};rE.MappingList=L5;const Fc=Jx,Ye=Uc,qu=sp.ArraySet,M5=rE.MappingList;let sE=class jE{constructor(e){e||(e={}),this._file=Ye.getArg(e,"file",null),this._sourceRoot=Ye.getArg(e,"sourceRoot",null),this._skipValidation=Ye.getArg(e,"skipValidation",!1),this._sources=new qu,this._names=new qu,this._mappings=new M5,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new jE({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ye.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=Ye.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=Ye.getArg(e,"generated"),r=Ye.getArg(e,"original",null);let i=Ye.getArg(e,"source",null),s=Ye.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=Ye.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ye.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ye.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=Ye.relative(s,i));const o=this._mappings.toArray().length>0?new qu:this._sources,a=new qu;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=Ye.join(r,c.source)),s!=null&&(c.source=Ye.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=Ye.join(r,c)),s!=null&&(c=Ye.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,p=d.length;h<p;h++){if(l=d[h],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Ye.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Fc.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Fc.encode(f-o),o=f,c+=Fc.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Fc.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Fc.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ye.relative(n,r));const i=Ye.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};sE.prototype._version=3,qx.SourceMapGenerator=sE;var oE={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(oE);var Pc={exports:{}},U5={},F5=Object.freeze({__proto__:null,default:U5}),aE=zE(F5);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;Pc.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Pc.exports.initialize=e=>t=e}else{const t=aE,e=aE;Pc.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Pc.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var cE=Pc.exports;const P5=cE;function B5(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Bc=null;var D5=function(){if(Bc)return Bc;const e=[];return Bc=P5().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new B5;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),e[e.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw Bc=null,n}),Bc};const kt=Uc,op=oE,Ju=sp.ArraySet,$5=cE,j5=D5,ap=Symbol("smcInternal");class ze{constructor(e,n){return e==ap?Promise.resolve(this):K5(e,n)}static initialize(e){$5.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return H5(e,n)}static async with(e,n,r){const i=await new ze(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ze.prototype._version=3,ze.GENERATED_ORDER=1,ze.ORIGINAL_ORDER=2,ze.GREATEST_LOWER_BOUND=1,ze.LEAST_UPPER_BOUND=2;class Dc extends ze{constructor(e,n){return super(ap).then(r=>{let i=e;typeof e=="string"&&(i=kt.parseSourceMapInput(e));const s=kt.getArg(i,"version");let o=kt.getArg(i,"sources");const a=kt.getArg(i,"names",[]);let c=kt.getArg(i,"sourceRoot",null);const l=kt.getArg(i,"sourcesContent",null),u=kt.getArg(i,"mappings"),f=kt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=kt.normalize(c)),o=o.map(String).map(kt.normalize).map(function(d){return c&&kt.isAbsolute(c)&&kt.isAbsolute(d)?kt.relative(c,d):d}),r._names=Ju.fromArray(a.map(String),!0),r._sources=Ju.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return kt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,j5().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=kt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Dc(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||ze.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=kt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case ze.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ze.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=kt.getArg(e,"source");const r=kt.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:kt.getArg(e,"line"),generatedColumn:kt.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=kt.getArg(e,"bias",ze.GREATEST_LOWER_BOUND);r==null&&(r=ze.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=kt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=kt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=kt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:kt.getArg(i,"originalLine",null),column:kt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=kt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=kt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=kt.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:kt.getArg(e,"line"),originalColumn:kt.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=kt.getArg(e,"bias",ze.GREATEST_LOWER_BOUND);i==null&&(i=ze.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:kt.getArg(s,"generatedLine",null),column:kt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Dc.prototype.consumer=ze;class z5 extends ze{constructor(e,n){return super(ap).then(r=>{let i=e;typeof e=="string"&&(i=kt.parseSourceMapInput(e));const s=kt.getArg(i,"version"),o=kt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Ju,r._names=new Ju,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=kt.getArg(c,"offset"),u=kt.getArg(l,"line"),f=kt.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ze(kt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(kt.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(kt.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:kt.getArg(e,"line"),generatedColumn:kt.getArg(e,"column")},r=op.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(kt.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=kt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||ze.GENERATED_ORDER;let o;switch(s){case ze.GENERATED_ORDER:o=this._generatedMappings;break;case ze.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=kt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return op.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=kt.getArg(e,"line"),r={source:kt.getArg(e,"source"),originalLine:n,originalColumn:kt.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",kt.compareByOriginalPositions,op.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kt.getArg(o,"generatedLine",null),column:kt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kt.getArg(o,"generatedLine",null),column:kt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function K5(t,e){let n=t;typeof t=="string"&&(n=kt.parseSourceMapInput(t));const r=n.sections!=null?new z5(n,e):new Dc(n,e);return Promise.resolve(r)}function H5(t,e){return Dc.fromSourceMap(t,e)}var lE={};const W5=qx.SourceMapGenerator,Qu=Uc,G5=/(\r?\n)/,Y5=10,sa="$$$isSourceNode$$$";let V5=class wp{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[sa]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new wp,s=e.split(G5);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const p=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=Qu.join(r,h)),i.setSourceContent(h,p))}),i;function d(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?Qu.join(r,h.source):h.source;i.add(new wp(h.originalLine,h.originalColumn,m,p,h.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[sa]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[sa]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[sa]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[sa]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[Qu.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][sa]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(Qu.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new W5(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===Y5?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};lE.SourceNode=V5;var Z5=lE.SourceNode;let uE=0;const hE=mi,X5=["Command","lines"];class q5 extends SU{constructor(){super(rx,{traceInitPerf:mi,skipValidations:!mi,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Lt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Lt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Sc)}])}));Lt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Lt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Lt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Lt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Iw)}));Lt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(x0)}));Lt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Sw)}])}));Lt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Ow)}));Lt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Nw),this.SUBRULE(this.words),this.CONSUME(Cw)}));Lt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Qo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Lt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Lt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Lt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Lt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(R0),this.SUBRULE(this.words)}));Lt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Ww),this.SUBRULE(this.words)}));Lt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(S0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Lt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Sc)),this.CONSUME4(Qo),this.CONSUME4(O0)}}])}));Lt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Qo),this.CONSUME(O0)}}])}));Lt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Lt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Qo),this.CONSUME(I0),this.CONSUME(S0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Lt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Qo),this.CONSUME(I0),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Lt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(Xw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(qw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Jw),this.SUBRULE(this.words)}));Lt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(Qw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(tx)}));Lt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(ex)}));Lt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Vw)}));Lt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Zw)}));Lt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(E0),this.SUBRULE2(this.and_test)})}));Lt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(k0),this.SUBRULE2(this.not_test)})}));Lt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(v0),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Lt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Lt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME($w)}])}));Lt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(E0),this.SUBRULE2(this.and_test_value)})}));Lt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(k0),this.SUBRULE2(this.not_test_value)})}));Lt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(v0),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Lt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Lt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(T0)},{ALT:()=>this.CONSUME(A0)}]),this.SUBRULE(this.term)}));Lt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Lt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(R0)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(Hw)}]),this.SUBRULE(this.factor)}));Lt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(T0)},{ALT:()=>this.CONSUME(A0)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Lt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(jw),this.SUBRULE(this.factor)})}));Lt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Lt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(_n)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>{this.CONSUME(Gw),this.SUBRULE(this.words),this.CONSUME(Yw)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=X5.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(uE++).toString().padStart(3),c=s?"font-weight: bold;":"";if(hE&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),hE&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),uE--},i)}}const oa=new q5;if(jU){const t=oa.getGAstProductions(),e=$U(t);console.info(e)}const J5=oa.getBaseCstVisitorConstructor();var yt=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(yt||{}),no=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(no||{}),gi=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(gi||{}),th=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(th||{});function Rr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class Q5 extends J5{constructor(){super();Lt(this,"unique",0);mi&&this.validateVisitor()}visit(n){if(ae(n)&&(n=n[0]),!!E(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():E(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Rr(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Rr(n.token_stat,"@").slice(1)}))}stmt_text(n,r){return this.createlinenode(r,this.createcodenode(r,{type:6,value:Rr(n.token_text,"")}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Rr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:Rr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n,r){return n.words?this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,Rr(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=Be(),s=Be();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=Be(),s=Be();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,Rr(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){return this.createcodenode(r,{type:17,lines:this.go(n.command_fork)})}command_while(n,r){const i=Be(),s=Be();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=Be(),s=Be(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=Be(),s=Be(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=Be();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=Rr(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}))}command_toast(n,r){const s=Rr(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"toast"),this.createstringnode(r,s)].flat()}))}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}token(n,r){if(n.token_stringliteraldouble){const i=Rr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Rr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Rr(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return n.token_lparen?this.createcodenode(r,{type:31,words:this.go(n.words)}):[]}}const t4=new Q5,Wn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},eh="zss.js";function Jt(t,e){return new Z5(t.startLine??1,t.startColumn??1,eh,e)}function cp(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function lp(t){return`'${cp(t)}'`}function nh(t){if(t.startsWith('"'))return nh(t.replaceAll(/(^"|"$)/g,""));const e=Z0(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===Y0?`', api.get('${cp(r.image.substring(1))}'), '`:cp(r.image)).join("")}'].join('')`}function aa(t){return t.filter(e=>e!==void 0).map(ne)}function fE(t){return Jt(t,"")}function e4(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function en(t,e,n){return Jt(t,[`api.${e}(`,...e4(n,", "),")"])}function n4(t){if(t.type===yt.COMPARE&&t.compare.type===yt.COMPARE_ITEM)switch(t.compare.method){case no.IS_EQ:return en(t,"isEq",[ne(t.lhs),ne(t.rhs)]);case no.IS_NOT_EQ:return en(t,"isNotEq",[ne(t.lhs),ne(t.rhs)]);case no.IS_LESS_THAN:return en(t,"isLessThan",[ne(t.lhs),ne(t.rhs)]);case no.IS_GREATER_THAN:return en(t,"isGreaterThan",[ne(t.lhs),ne(t.rhs)]);case no.IS_LESS_THAN_OR_EQ:return en(t,"isLessThanOrEq",[ne(t.lhs),ne(t.rhs)]);case no.IS_GREATER_THAN_OR_EQ:return en(t,"isGreaterThanOrEq",[ne(t.lhs),ne(t.rhs)])}return Jt(t,"")}function ro(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",ne(n),")"])}function dE(t,e,n){return t.prepend(`api.${e}(`),t.add([ne(n),")"])}function r4(t,e){if(t.type===yt.OPERATOR_ITEM)switch(t.operator){case gi.PLUS:return ro(e,"opPlus",t.rhs);case gi.MINUS:return ro(e,"opMinus",t.rhs);case gi.POWER:return ro(e,"opPower",t.rhs);case gi.MULTIPLY:return ro(e,"opMultiply",t.rhs);case gi.DIVIDE:return ro(e,"opDivide",t.rhs);case gi.MOD_DIVIDE:return ro(e,"opModDivide",t.rhs);case gi.FLOOR_DIVIDE:return ro(e,"opFloorDivide",t.rhs);case gi.UNI_PLUS:return dE(e,"opUniPlus",t.rhs);case gi.UNI_MINUS:return dE(e,"opUniMinus",t.rhs)}return Jt(t,"")}function i4(t){if(t.type===yt.OPERATOR){const e=t.lhs?ne(t.lhs):Jt(t,"");return t.items.forEach(n=>r4(n,e)),e}return Jt(t,"")}function rh(t,e){return Jt(t,[en(t,"jump",[`${e}`]),"; continue;"])}function Ki(t){return Wn.linelookup[t??""]??-1}function up(t,e){Wn.linelookup[t]=e}function ca(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&(i.done=n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&(i.skip=n);break;case yt.LINE:ca(i.stmts,e,n);break}}}function pE(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&up(i.done,n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&up(i.skip,n);break;case yt.LINE:pE(i.stmts,e,n);break}}}function ne(t){var e;switch(t.type){case yt.PROGRAM:return Jt(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(ne).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${eh}`]);case yt.API:return Jt(t,["  ",en(t,t.method,aa(t.words)),`;
`]);case yt.LINE:return Jt(t,[`case ${t.lineindex}:
`,...t.stmts.map(ne).flat(),`  break;
`]);case yt.MARK:return Jt(t,`  // ${t.comment}
`);case yt.GOTO:{const n=Ki(t.id);return Jt(t,["  ",rh(t,n),`
`])}case yt.COUNT:return Jt(t,`${t.index}`);case yt.LITERAL:switch(t.literal){case th.NUMBER:return Jt(t,`${t.value}`);case th.STRING:return Jt(t,lp(t.value));case th.TEMPLATE:return Jt(t,nh(t.value))}return fE(t);case yt.TEXT:return Jt(t,["  ",en(t,"text",[nh(t.value)]),`;
`]);case yt.STAT:if(Wn.isfirststat){Wn.isfirststat=!1;const n=t.value.trim().split(" ").map(lp);return Jt(t,["  ",en(t,"stat",n),`;
`])}return Jt(t,`  // skipped ${t.value}
`);case yt.LABEL:{const n=It(t.name),r=t.active?"label":"comment";Wn.labels[n]||(Wn.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Wn.labels[n].push(i),Jt(t,`  // ${i} '${n}' ${r}
`)}case yt.HYPERLINK:return Jt(t,["  ",en(t,"hyperlink",[nh(t.text),...aa(t.link)]),`;
`]);case yt.MOVE:{const n=en(t,"command",[lp("go"),aa(t.words)].flat());return t.wait?Jt(t,["  if (",n,`) { continue; };
`]):Jt(t,["  ",n,`;
`])}case yt.COMMAND:return Jt(t,["  if (",en(t,"command",aa(t.words)),`) { continue; };
`]);case yt.IF:{const n=((e=t.block)==null?void 0:e.type)===yt.IF_BLOCK?t.block:void 0;if(E(n)){ca([t.check],yt.IF_CHECK,n.skip);const r=Jt(t,ne(t.check));return n.lines.forEach(i=>r.add(ne(i))),pE(n.altlines,yt.ELSE_IF,Ki(n.done)),n.altlines.forEach(i=>r.add(ne(i))),r}return Jt(t,ne(t.check))}case yt.IF_CHECK:{const n=Ki(t.skip);return n===-1?Jt(t,["  ",en(t,t.method,aa(t.words)),`;
`]):Jt(t,["  if (!",en(t,t.method,aa(t.words)),") { ",rh(t,n),` }
`])}case yt.ELSE_IF:case yt.ELSE:{const n=Jt(t,"");return t.lines.forEach(r=>n.add(ne(r))),n}case yt.WHILE:{const n=Ki(t.loop),r=Ki(t.done),i=Jt(t,"");return ca(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case yt.REPEAT:{const n=Ki(t.loop),r=Ki(t.done),i=Jt(t,"");return ca(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case yt.WAITFOR:{const n=Jt(t,"");return ca(t.lines,yt.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(ne(r))}),n}case yt.FOREACH:{const n=Ki(t.loop),r=Ki(t.done),i=Jt(t,"");return ca(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case yt.BREAK:return Jt(t,["  ",rh(t,t.goto),`
`]);case yt.CONTINUE:return Jt(t,["  ",rh(t,t.goto),`
`]);case yt.OR:return en(t,"or",t.items.map(ne));case yt.AND:return en(t,"and",t.items.map(ne));case yt.NOT:return en(t,"not",t.items.map(ne));case yt.COMPARE:return n4(t);case yt.OPERATOR:return i4(t);case yt.EXPR:return en(t,"expr",t.words.map(ne));default:return console.error("<unsupported node>",t.type,t),fE(t)}}function _i(t){if(E(t))switch(t.type===yt.LINE&&++Wn.lineindex,t.lineindex=Wn.lineindex,t.type){case yt.PROGRAM:t.lines.forEach(_i);break;case yt.LINE:t.stmts.forEach(_i);break;case yt.MARK:up(t.id,t.lineindex);break;case yt.IF:_i(t.check),_i(t.block);break;case yt.IF_BLOCK:t.lines.forEach(_i),t.altlines.forEach(_i);break;case yt.ELSE_IF:t.lines.forEach(_i);break;case yt.ELSE:case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.WAITFOR:t.lines.forEach(_i);break;case yt.MOVE:case yt.COMMAND:case yt.IF_CHECK:t.words.forEach(_i);break}}function s4(t){Wn.labels={},Wn.internal=1,Wn.lineindex=0,Wn.isfirststat=!0,_i(t)}function o4(t){return s4(t),{...ne(t).toStringWithSourceMap({file:`${eh}.map`}),...Wn}}function mE(t){return ae(t)?t.length>0?1:0:t??0}function a4(t){return`${t}_chip`}function gE(t=""){return`vm:${t??""}`}function c4(t,e,n){var l,u;const r=a4(t),i=Sr(r);let s;const o=Zn(Object.entries(n.labels??{}));(!ae(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){w.words=d;const h=v5(e,f);return E(h)?h(c,d):f!=="send"?a("send",[f,...d]):0}const c={halt(){E4(r)},id(){return t},set(f,d){const[h,p]=T5(e,c,f,d);if(h)return p},get(f){const[d,h]=k5(e,c,f);if(d)return h},tick(f){const d=At(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return Xx(e,c),!1;i.lc=0,i.ys=0,w.get=c.get,A5(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ue(tt,w.elementfocus,"crash",p.message),i.es=1}return Xx(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return At(i.lc)?++i.lc>Fi.HALT_AT_COUNT:!0},hm(){if(ae(i.mg)&&ae(i.lb)){const[f]=i.mg;if(E(f))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)return p.find(m=>At(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,p){tt.emit(f,`${gE(d)}:${h}`,p)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f){const m=p.findIndex(y=>y>0);m>=0&&(p[m]*=-1)}}},restore(f){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)for(let m=0;m<p.length;m++)p[d]=Math.abs(p[d])}},getcase(){i.ec=At(i.ec)?i.ec:1;const f=c.hm();if(f&&ae(i.mg)){const[,d,h,p]=i.mg;c.set("sender",h),E(d)&&c.set("arg",d),p&&(c.set("player",p),w.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=At(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=mF.parse(f),[h]=d.filter(p=>p.fileName===eh);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(ye(d)),h)},if(...f){const[d,h]=rt(f,0,[z.ANY]),p=mE(d);return p&&h<f.length&&c.command(...f.slice(h)),p?1:0},try(...f){const[,d]=rt(f,0,[z.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,p]=rt(f,0,[z.NAME,z.ANY]),m=At(h),y=m?p:1,b=c.get(d),k=m?h:1;if(!At(b))return y<f.length&&c.command(...f.slice(y)),1;const T=b-k;return T<0?(y<f.length&&c.command(...f.slice(y)),1):(c.set(d,T),0)},give(...f){const[d,h,p]=rt(f,0,[z.NAME,z.ANY]),m=At(h),y=m?p:1,b=c.get(d),k=m?h:1,T=b===void 0?1:0;return T&&y<f.length&&c.command(...f.slice(y)),c.set(d,Nc(b,0)+k),T},repeatstart(f,...d){const[h,p]=rt(d,0,[z.NUMBER]),m=`repeatcount${f}`,y=`repeatwords${f}`;i[m]=h,i[y]=p<d.length?d.slice(p):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!At(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,y=i[h];return m&&ae(y)&&c.command(...y),m?1:0},foreachstart(f,...d){const[h,p,m,y]=rt(d,0,[z.NAME,z.NUMBER,z.NUMBER,z.MAYBE_NUMBER]);let b=Math.min(p,m),k=Math.max(p,m);const T=(y??0)||1;if(T<0){const A=b;b=k,k=A}return c.set(h,b-T),0},foreach(f,...d){const[h,p,m,y,b]=rt(d,0,[z.NAME,z.NUMBER,z.NUMBER,z.MAYBE_NUMBER]);let k=Math.min(p,m),T=Math.max(p,m);const A=(y??0)||1;if(A<0){const S=k;k=T,T=S}let C=c.get(h);!At(C)||C<k||C>T?C=k:C+=A;const R=C<=T?1:0;return R&&(c.set(h,C),b<d.length&&c.command(...d.slice(b))),R},waitfor(...f){const[d]=rt(f,0,[z.ANY]),h=mE(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[z.ANY]);if(d=p,d)break;h=m}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[z.ANY]);if(d=p,!d)break;h=m}return d},not(...f){const[d]=rt(f,0,[z.ANY]);return d?0:1},expr(...f){const[d]=rt(f,0,[z.ANY]);return d},isEq(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return typeof h=="object"||typeof p=="object"?xv(h,p)?1:0:h===p?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h<p?1:0},isGreaterThan(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h>p?1:0},isLessThanOrEq(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h<=p?1:0},isGreaterThanOrEq(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h>=p?1:0},opPlus(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return h+p},opMinus(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return h-p},opPower(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return Math.pow(h,p)},opMultiply(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h*p},opDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h/p},opModDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h%p},opFloorDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return Math.floor(h/p)},opUniPlus(f){const[d]=rt([f],0,[z.NUMBER]);return+d},opUniMinus(f){const[d]=rt([f],0,[z.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function hp(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];ae(r)?r.forEach(i=>{e.push(hp(i))}):e.push(hp(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function l4(t){const e=ix(`${t}
`);if(e.errors.length>0)return e;oa.input=e.tokens;const n=oa.program();if(oa.errors.length>0)return{tokens:e.tokens,errors:oa.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=t4.go(n);return r?(hp(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const fp=Object.getPrototypeOf(function*(){}).constructor;function u4(t,e){const n=`compile-${t}`;console.time(n);const r=l4(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=o4(r.ast);if(i.code){zU&&console.info(i.code);try{return{...r,...i,source:i.code,code:new fp("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new fp("api"," ")}}}return{...r,...i,source:"",code:new fp("api"," ")}}function h4(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=u4(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return E(s)?s.isended():!0},halt(i){const s=e[i];return E(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];E(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!E(e[i])){const f=n(a,c);if(l=e[i]=c4(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((b,k)=>[b,k]);p.slice(h-5,h).forEach(([b,k])=>{ue(tt,cr(),"build",`$grey${k+1} $grey${b}`)});const[m,y]=p[h]??[];if(wt(m)&&E(y)){const b=(d.column??1)-1,k=b+d.length,T=b<m.length?m:`${m}*`,A=T.substring(0,b),C=T.substring(b,k),R=T.substring(k);ue(tt,cr(),"build",`$red${y+1} $grey${A}$red${C}$grey${R}`)}return d.message.split(`
`).forEach(b=>{ue(tt,cr(),"build",b)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Xn(i.target),a=e[s];if(E(a)){const c={...i,target:o};a.message(c)}}};return r}const En=new Ja,Nn={},ih={};function _E(t,e,n,r,i=0){const s=`tiles:${t}:${e}`;return E(Nn[s])||(Nn[s]=aN(t,e,n,r,i)),Nn[s]}function f4(t,e,n,r){const i=`sprites:${t}:${e}:${n}`,s=`sprite:${t}:${e}:${r}`;return E(ih[s])||(ih[s]=cN(t,e,n)),ih[s].id=i,ih[s]}function d4(t,e){const n=`sprites:${t}:${e}`;return E(Nn[n])||(Nn[n]=lN(t,e)),Nn[n]}function p4(t,e,n,r,i=0){const s=`dither:${t}:${e}`;return E(Nn[s])||(Nn[s]=uN(t,e,n,r,i)),Nn[s]}function sh(t,e,n,r){const i=`media:${t}:${e}`;E(Nn[i])||(Nn[i]=hN(t,e,n,r));const s=Nn[i];return s.mime=n,s.media=r,s}function m4(t,e){const n=`control:${t}:${e}`;return E(Nn[n])||(Nn[n]=fN(t,e)),Nn[n]}const ws=3;function yE(t,e){const n=[],r=(t.x+.5)*ss,i=(t.y+.5)*os,s=e.x*ss,o=e.y*os,a=s-r,c=o-i;En.x=a-ws,En.y=c-ws,n.push(En.angle()),En.x=a+ss+ws,En.y=c-ws,n.push(En.angle()),En.x=a-ws,En.y=c+os+ws,n.push(En.angle()),En.x=a+ss+ws,En.y=c+os+ws,n.push(En.angle());const l=n.map(h=>Math.round(hy(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(b=>b<180),p=l.filter(b=>b>180),m=Math.max(...h);return[Math.min(...p),m]}return[u,f]}function oh(t,e,n,r,i,s,o,a,c,l){var A;const u={x:c,y:l},f=Ur(e,u);if(f===-1)return;En.x=c-s.x,En.y=l-s.y;const d=En.length();if(d>o)return;const h=Math.round(hy(En.angle()));let p=0;for(let C=0;C<r.length;++C){const[R,S,U]=r[C];R>S?(h>=R||h<=S)&&(p=Math.max(p,U)):h>=R&&h<=S&&(p=Math.max(p,U))}const m=o*.5;n[f]=Math.min(n[f],p+(d<m?0:(d-m)*a)),n[f]=Xe(n[f],0,1);const y=Rn(e,((A=e.lookup)==null?void 0:A[f])??"");if(E(y)){const C=[...yE(s,u),.25];i.push(C)}const b=e.terrain[f],k=Di(t,b),T=(b==null?void 0:b.collision)??(k==null?void 0:k.collision);if(Wo($t.ISBULLET,T)){const C=[...yE(s,u),1];i.push(C)}}function dp(t,e,n,r,i,s,o){if(!E(r)||!E(r.terrain)||!E(r.objects))return[];const a=[];let c=e;const l=St,u=Yt,f=o?Rt.BLACK:Rt.ONCLEAR,d=_E(t,c++,l,u,f);a.push(d);const h=c++,p=d4(t,h);p.sprites=[],a.push(p);const m=r.isdark?1:0,y=p4(t,c++,l,u,m);a.push(y),y.alphas.fill(m);const b=_E(t,c++,l,u,Rt.ONCLEAR);a.push(b),b.char.fill(0);const k={...X0(St,Yt,i,Rt.ONCLEAR),...b},T=m4(t,c++);if(s){if(a.push(T),wt(r.camera))switch(It(r.camera)){default:case"mid":T.viewscale=Yl.MID;break;case"near":T.viewscale=Yl.NEAR;break;case"far":T.viewscale=Yl.FAR;break}if(wt(r.graphics)){const I=It(r.graphics);switch(I){case"mode7":case"firstperson":T.graphics=I;break;default:case"flat":T.graphics="flat";break}}const{facing:U}=Sr(t);At(U)&&(T.facing=uy(U%360))}for(let U=0;U<r.terrain.length;++U){const I=r.terrain[U],D=$u(n,I,0,Rt.WHITE,o?Rt.BLACK:Rt.ONCLEAR);d.char[U]=D.char,d.color[U]=D.color,d.bg[U]=D.bg}const A=Object.values(r.objects??{});for(let U=0;U<A.length;++U){const I=A[U];if(E(I.removed))continue;const D=I.id??"",V=$u(n,I,1,Rt.WHITE,Rt.BLACK),L=f4(t,h,D,U);if(L.x=I.x??0,L.y=I.y??0,L.char=V.char,L.color=V.color,L.bg=V.bg,p.sprites.push(L),m){if(V.light>0){const N=Ur(r,L),x=Xe(Math.round(V.light),1,Yt),B=1/(x*.5);if(y.alphas[N]=0,x>1){const Z=[];for(let $=1;$<=x;++$){if($===2){const at=je(n,I,"lightdir");if(ii(at)){const G=Ku(n,r,I,"",at,L);switch(ri(L,G.destpt)){case dt.EAST:Z.push([45,315,1]);break;case dt.WEST:Z.push([225,135,1]);break;case dt.NORTH:Z.push([315,225,1]);break;case dt.SOUTH:Z.push([135,45,1]);break}}}const st=[];for(let at=L.y-$;at<=L.y+$;++at)oh(n,r,y.alphas,Z,st,L,x,B,L.x-$,at),oh(n,r,y.alphas,Z,st,L,x,B,L.x+$,at);const nt=$-1;for(let at=L.x-nt;at<=L.x+nt;++at)oh(n,r,y.alphas,Z,st,L,x,B,at,L.y-$),oh(n,r,y.alphas,Z,st,L,x,B,at,L.y+$);for(let at=0;at<st.length;++at){const G=st[at];let H=0;for(H=0;H<Z.length;++H){const bt=Z[H];if(bt[1]>bt[0]&&G[1]>=bt[0]&&G[0]<=bt[1]&&G[2]>=1&&bt[2]>=1){Z[H]=[Math.min(G[0],bt[0]),Math.max(G[1],bt[1]),1];break}}H===Z.length&&Z.push(G)}}}}else if(Kr(D)){const N=Ur(r,L);y.alphas[N]=0}}if(wt(I.tickertext)&&At(I.tickertime)&&I.tickertext.length){const N=St,x=Ox(I.tickertext,N,Yt-1),B=(x==null?void 0:x.measuredwidth)??1,Z=I.x??0,$=I.y??0,st=$<Yt*.5;k.x=Z-Math.floor(B*.5),k.y=$+(st?1:-1),k.x+B>St&&(k.x=St-B),k.x<0&&(k.x=0),Sx(I.tickertext,k,!0)}D===t&&(T.focusx=L.x,T.focusy=L.y,T.focusid=D)}a.push(sh(t,c++,"text/mood",m?"dark":"bright"));const C=be(Bt.MAIN),R=$i(C,Bt.MAIN);if(wt(R.palette)){const U=tn(C,_t.PALETTE,R.palette),I=Ce(U);E(I==null?void 0:I.bits)&&a.push(sh(t,c++,"image/palette",Array.from(I.bits)))}if(wt(R.charset)){const U=tn(C,_t.CHARSET,R.charset),I=Ce(U);E(I==null?void 0:I.bits)&&a.push(sh(t,c++,"image/charset",Array.from(I.bits)))}const S=Object.keys(r.objects).filter(Kr);return a.push(sh(t,c++,"text/players",S.join(","))),a}const ar=h4();var Bt=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Bt||{});const Ee={halt:!1,session:Be(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function g4(){return Ee.session}function cr(){return Ee.operator}function _4(t){Ee.operator=t}function y4(t){Ee.halt=t}function b4(){return Ee.halt}function la(){return[...Ee.books.values()]}function w4(){const[t]=Ee.books.values();return t}function zr(t){const e=It(t);return Ee.books.get(t)??la().find(n=>n.name===e)}function ah(t,e){E(zr(e))&&(Ee.software[t]=e)}function be(t){return zr(Ee.software[t])}function bE(t){const e=lx([]);return wt(t)&&(e.name=t),pp(e),he(tt,Ee.operator,`created [book] ${e.name}`),e}function x4(t){let e=zr(t);return E(e)||(e=lx([]),e.name=t),pp(e),he(tt,Ee.operator,`created [book] ${e.name}`),e}function vn(t,e){let n=E(e)?x4(e):be(t);return E(n)||(E(n)||(n=w4()),E(n)||(n=bE(e)),E(n)&&he(tt,Ee.operator,`opened [book] ${n.name} for ${t}`)),ah(t,n.id),n}function xs(t,e,n){return F0(vn(t),n,e)}function Sr(t){const e=vn("main");return $i(e,t)}function wE(t){const e=vn("main");return eF(e,t)}function xE(){const t=vn("main");return $i(t,"main")}function E4(t){const e=vn("main");return px(e,t)}function v4(t,e){Ee.books.clear(),t.forEach(r=>{Ee.books.set(r.id,r),r.name==="main"&&(Ee.software.main=r.id)});const n=zr(e);if(E(n)&&ah("main",n.id),!Ee.software.main){const r=Ee.books.values().next();r.value&&(Ee.software.main=r.value.id)}}function pp(t){return Ee.books.set(t.id,t),t.id}function k4(t){const e=zr(t);e&&Ee.books.delete(e.id)}function EE(t){if(!wt(t)||!t)return ue(tt,t,"login",`failed for playerid ==>${t}<==`);const e=be("main");if(!E(e))return ue(tt,t,"login:main","login failed to find book 'main'");const n=to(e,t);if(E(n))return!0;const r=zn(e,_t.BOARD,"title");if(r.length===0)return ue(tt,t,"login:title","login failed to find board with 'title' stat");const i=Qs(e,"player");if(!E(i))return ue(tt,t,"login:player","login failed to find object type 'player'");const s=py(t,r),o=Ce(s);if(E(o)){const a=L0(s,"startx"),c=L0(s,"starty"),l=At(a)?a:Math.round(St*.5),u=At(c)?c:Math.round(Yt*.5),f=i.name??"player",d=vd(o,{x:l,y:u},f,t);if(E(d==null?void 0:d.id))return d.player=t,ju(e,t,o.id),!0}return!1}function T4(t){const e=be("main"),n=to(e,t);if(!E(e))return;const r=[t];for(let i=0;i<e.activelist.length;++i){const s=e.activelist[i];s.startsWith(t)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];ju(e,s,""),D0(e,n,Rn(n,s)),qy(n,s),ar.halt(s),px(e,s)}}function lr(t){const e=be("main");return to(e,t)}function A4(t){const e=be("main"),n=rF(e,t),r=to(e,t),i=Rn(r,t);return n&&E(i)}function R4(t){const e=be("main"),n=B0(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Kr(c)&&E(t[c])===!1&&(t[c]=0,ju(e,c,i.id))}}}function vE(t){ar.message(t)}function ua(t,e,n,r){const i=is(e);wt(n.id)&&tt.emit(t,"vm:touched",[n.id,i,r])}function S4(t,e,n,r){const i=n.id??"";if(r.x<0){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitwest)??"");if(s.length){const o=Te(s);ta(t,i,o.id,{x:St-1,y:r.y})}}else if(r.x>=St){const s=zn(t,_t.BOARD,(e==null?void 0:e.exiteast)??"");if(s.length){const o=Te(s);ta(t,i,o.id,{x:0,y:r.y})}}else if(r.y<0){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitnorth)??"");if(s.length){const o=Te(s);ta(t,i,o.id,{x:r.x,y:Yt-1})}}else if(r.y>=Yt){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitsouth)??"");if(s.length){const o=Te(s);ta(t,i,o.id,{x:r.x,y:0})}}}function ha(t,e,n,r){if(!E(n==null?void 0:n.id))return!1;const i=j0(t,e,n,r);if(E(i)){const s=Kr(i.id);return n.kind==="player"&&i.kind==="edge"?S4(t,e,n,r):ua("",i,n,"thud"),n.kind==="player"?ua(n.id,n,i,s?"bump":"touch"):n.collision===$t.ISBULLET?je(t,i,"collision")===$t.ISBULLET?ua("",n,i,"thud"):Kr(n.party)?ua(n.id,n,i,s?"partyshot":"shot"):ua("",n,i,s?"shot":"partyshot"):ua("",n,i,"bump"),je(t,i,"destructible")?(E(i==null?void 0:i.id)?or(w.book,w.board,i,w.timestamp):ln(e,{x:r.x,y:r.y}),!0):!1}return!0}function kE(t,e,n,r,i=cR){var f;if(!E(t)||!E(e)||!E(n))return;const s={...w};w.book=t,w.board=e,w.element=n,w.elementid=n.id??"",w.elementisplayer=Kr(w.elementid);const o=w.element.player??Ee.operator;w.elementfocus=w.elementisplayer?w.elementid:o;const a=Di(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=It(n.name??((f=n.kinddata)==null?void 0:f.name)??"");if(ar.tick(l,bs.RUNTIME,At(c)?c:i,u,r),At(n==null?void 0:n.tickertime)&&w.timestamp-n.tickertime>sl*5&&(n.tickertime=0,n.tickertext=""),w.elementisplayer){const d=Sr(w.elementid);At(d.inputcurrent)&&(d.inputcurrent=0)}hr(s).forEach(d=>{w[d]=s[d]})}function O4(t,e){Ee.loaders.set(t,e)}function I4(t){ar.halt(t)}function N4(){const t=ar.ids();for(let n=0;n<t.length;++n)ar.halt(t[n]);const e=be("main");E(e)&&(e.flags={})}function C4(){const t=be("main");if(!E(t))return;const e=t.timestamp+1,n=Fi.HALT_AT_COUNT;Fi.HALT_AT_COUNT=n*2,Ee.loaders.forEach((i,s)=>{const o={...w};w.timestamp=t.timestamp,w.book=t,w.board=void 0,w.element=void 0,w.elementid=s,w.elementisplayer=!1,w.elementfocus=cr();const a=F$(s);E(a)&&ar.arg(s,a),ar.tick(s,bs.LOADER,1,"loader",i),ar.isended(s)&&(ar.halt(s),Ee.loaders.delete(s)),hr(o).forEach(c=>{w[c]=o[c]})}),Fi.HALT_AT_COUNT=n,t.timestamp=e,w.timestamp=e;const r=B0(t);for(let i=0;i<r.length;++i){const s=r[i],o=hF(t,s,e);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:f}=o[a];l===_t.ERROR?ar.halt(c):kE(t,s,f,u)}}}function mp(t,e){const n=be("main");if(!E(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(E(u.id)){const f=`${gE(u.id)}:${c}`;tt.emit("",f,e)}}}const{target:i,path:s}=Xn(t),o=B0(n);for(let a=0;a<o.length;++a){const c=o[a];switch(It(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(Qy(c,[i]),s);break}}}}function L4(t){const e=Sr(t).playbuffer;wt(e)&&e&&TE(t,e)}function TE(t,e=""){var s;const n=vn("main");if(!E(n))return;const r=`${t}_cli`;w.timestamp=n.timestamp,w.book=n,w.board=to(n,t),w.element=Rn(w.board,t),w.elementid=((s=w.element)==null?void 0:s.id)??"",w.elementisplayer=!0,w.elementfocus=w.elementid||t;const i=Fi.HALT_AT_COUNT;Fi.HALT_AT_COUNT=i*8,ar.once(r,bs.CLI,"cli",e),Sr(t).playbuffer=e,Fi.HALT_AT_COUNT=i}function ch(t){var a;const e=vn("main"),n=Bi(e,t);if(!E(e)||!E(n)||!E(w.element))return;const r={...w},i=`${t}_run`,s=It(w.element.name??((a=w.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";ar.once(i,bs.RUNTIME,s,o),hr(r).forEach(c=>{w[c]=r[c]})}function M4(t,e){const n=be("main"),r=to(n,t),i=[],s=[],o=[];if(!E(n)||!E(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=ps(n,r.overboard??""),l=ps(n,r.underboard??"");return s.push(...dp(t,0,n,l,e,!1,!0)),o.push(...dp(t,s.length,n,r,e,!0,a!=="flat")),i.push(...dp(t,s.length+o.length,n,c,e,!1,!1)),{over:i,under:s,layers:o}}function fa(t,e=0){const n=[];let r=t;for(;r<w.words.length;){const[i,s]=Gn(r);if(ae(i)&&!ii(i)&&!Mc(i)&&!Wu(i)&&!si(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function Gn(t){var r,i,s,o,a,c,l,u,f;const e=w.words[t],n=t+1;if(Ux(e)){const[d,h]=S$(t);if(E(d))return[d,h]}if(O$(e)){const[d,h]=I$(t);if(E(d))return[d,h]}if(cd(e)){const[d,h]=ld(t);if(E(d))return[d,h]}if(wt(e)&&It(e)==="rnd"){const[d,h]=Gn(n),[p,m]=Gn(h);return At(d)&&At(p)?[yr(d,p),m]:At(d)?[yr(0,d),h]:[yr(0,1),n]}if(ad(e)){const[d,h]=_y(t);if(E(d))return[d,h]}if(!E(e))return[void 0,t];if(At(e)||ae(e))return[e,n];if(wt(e)){const d=It(e),h=(r=w.get)==null?void 0:r.call(w,e);if(E(h))return[h,n];switch(d){case"aligned":case"alligned":{const p=oc(w.board,{x:((i=w.element)==null?void 0:i.x)??-1,y:((s=w.element)==null?void 0:s.y)??-1},w.elementfocus);return!E(w.element)||!E(p)?[0,n]:[w.element.x===p.x||w.element.y===p.y?1:0,n]}case"contact":{const p=oc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus);if(!E(w.element)||!E(p))return[0,n];const m=(p.x??0)-(((c=w.element)==null?void 0:c.x)??0),y=(p.y??0)-(((l=w.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(y)<2||y===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=rt(w.words,n,[z.DIR]);return[lF(w.book,w.board,w.element,p.destpt)?1:0,m]}case"any":{const[p,m]=rt(w.words,n,[z.KIND]);return[Jy(w.board,p).length?1:0,m]}case"rnd":return[yr(0,1),n];case"abs":{const[p,m]=rt(w.words,n,[z.NUMBER]);return[Math.abs(p),m]}case"intceil":{const[p,m]=rt(w.words,n,[z.NUMBER]);return[Math.ceil(p),m]}case"intfloor":{const[p,m]=rt(w.words,n,[z.NUMBER]);return[Math.floor(p),m]}case"intround":{const[p,m]=rt(w.words,n,[z.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,y,b]=rt(w.words,n,[z.NUMBER,z.NUMBER,z.NUMBER]);return[Xe(p,m,y),b]}case"min":{const[p,m]=fa(n);return[Math.min(...p),m]}case"max":{const[p,m]=fa(n);return[Math.max(...p),m]}case"pick":{const[p,m]=fa(n);return[Te(p),m]}case"pickwith":{const[p,m]=rt(w.words,n,[z.NUMBER_OR_STRING]),[y,b]=fa(m);return[py(`${p}`,y),b]}case"random":{const[p,m]=fa(n,2),[y,b]=p;return[yr(y,b??0),m]}case"randomwith":{const[p,m]=rt(w.words,n,[z.NUMBER_OR_STRING]),[y,b]=fa(m,2),[k,T]=y;return[fy(`${p}`,k,T??0),b]}case"run":{const[p,m]=rt(w.words,n,[z.NAME]);return ch(p),[(u=w.get)==null?void 0:u.call(w,"arg"),m]}case"runwith":{const[p,m,y]=rt(w.words,n,[z.ANY,z.NAME]);return E(w.element)&&(w.element.arg=p),ch(m),[(f=w.get)==null?void 0:f.call(w,"arg"),y]}}}return[e,n]}const w={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var z=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.MAYBE_KIND=7]="MAYBE_KIND",t[t.MAYBE_NAME=8]="MAYBE_NAME",t[t.MAYBE_NUMBER=9]="MAYBE_NUMBER",t[t.MAYBE_STRING=10]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",t[t.ANY=12]="ANY",t))(z||{});function kn(t,e,n){throw console.info(n,w.element,w.elementid,w.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function AE(t){var n,r;const e={x:((n=w.element)==null?void 0:n.x)??0,y:((r=w.element)==null?void 0:r.y)??0};return Ku(w.book,w.board,w.element,w.elementfocus,t,e)}function rt(t,e,n){const r=w.words;w.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=Ey(s);jo(a)?(s=c,i.push(a)):kn("kind",a,t);break}case 0:{if(cd(t[0])===void 0){const[a,c]=Gn(s);si(a)?(s=c,i.push(a)):kn("color",a,t)}else{const[a,c]=ld(s);si(a)?(s=c,i.push(a)):kn("color",a,t)}break}case 2:{if(ad(t[0])===void 0){const[a,c]=Gn(s);ii(a)?(s=c,i.push(AE(a))):kn("direction",a,t)}else{const[a,c]=_y(s);ii(a)?(s=c,i.push(AE(a))):kn("direction",a,t)}break}case 3:{const a=w.words[s];wt(a)||kn("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Gn(s);if(wt(a)){const l=parseFloat(a);At(l)?i.push(l):kn("number",a,t)}else At(a)?i.push(a):kn("number",a,t);s=c;break}case 5:{const[a,c]=Gn(s);wt(a)||kn("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Gn(s);let l=a;if(wt(l)){const u=parseFloat(l);At(u)&&(l=u)}else At(l)||kn("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=Ey(s);a!==void 0&&!jo(a)&&kn("optional kind",a,t),s=c,i.push(a);break}case 8:{const a=w.words[s];a!==void 0&&!wt(a)&&kn("optional string",a,t),++s,i.push(a);break}case 9:{const[a,c]=Gn(s);if(wt(a)){const l=parseFloat(a);At(l)?i.push(l):kn("optional number",a,t)}else At(a)||a===void 0?i.push(a):kn("optional number",a,t);s=c;break}case 10:{const[a,c]=Gn(s);a!==void 0&&!wt(a)&&kn("optional string",a,t),s=c,i.push(a);break}case 11:{const[a,c]=Gn(s);let l=a;if(wt(l)){const u=parseFloat(l);At(u)&&(l=u)}else l!==void 0&&!At(l)&&kn("number or string",l,t);s=c,i.push(l);break}case 12:{const[a,c]=Gn(s);s=c,i.push(a);break}}return w.words=r,[...i,s]}const lh={},da={};function gp(){return{id:Be(),layers:[],scroll:[],sidebar:[]}}const U4=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),F4=new Set(["tx","text"]),P4={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},RE={};let SE=t=>{let e=RE[t];return E(e)||(RE[t]=e=gp()),e};function B4(t){SE=t}function hn(t){return SE(t)}function _p(t){return E(lh[t])||(lh[t]=[]),lh[t]}function D4(t){const e=hn(t);e.scroll=[]}function $4(t,e,n){Object.values(da).forEach(r=>{if(r[e]!==void 0){const i=nb(t.id(),e);At(n)&&sI(i,n),wt(n)&&oI(i,n)}})}function ur(t){const e=_p(t);return lh[t]=[],e}function ee(t,e){_p(t).push(e)}function Ut(t,e,n,r,i=()=>0,s=kh){const o=[e,n,...r],a=It(`${o[3]}`),c={...w};function l(u,f){E(f)&&f!==i(u)&&(w.board=c.board,w.element=c.element,w.elementfocus=c.elementfocus,s(u,f))}if(U4.has(a)){const u=`${o[2]}`;da[e]=da[e]??{};const f=i(u)??P4[a];if(da[e][u]===void 0){const d=nb(e,u);At(f)&&iI(d,f),wt(f)&&td(d,f),F4.has(a)?da[e][u]=ty(d,h=>{l(u,h)}):da[e][u]=aI(d,h=>{l(u,h)})}}_p(t).push(o)}B4(t=>{if(Kr(t)){const e=be(Bt.MAIN),n=$i(e,Bt.GADGETSTORE);let r=n[t];return E(r)||(n[t]=r=gp()),r}return gp()});let OE=0;function j4(){switch(OE++){case 0:return Rt.BLUE;case 1:return Rt.BLACK;case 2:return Rt.GREEN;case 3:return Rt.BLACK;case 4:return Rt.CYAN;case 5:return Rt.BLACK;case 6:return Rt.RED;case 7:return Rt.BLACK;case 8:return Rt.PURPLE;case 9:return Rt.BLACK;case 10:return Rt.YELLOW;case 11:return Rt.BLACK;case 12:return Rt.WHITE;default:return OE=0,Rt.BLACK}}const uh=ao("gadgetserver",["tock","second"],t=>{if(!uh.session(t))return;const e=be(Bt.MAIN),n=(e==null?void 0:e.activelist)??[],r=$i(e,Bt.GADGETSYNC);switch(t.target){case"tock":{const i=j4();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=M4(o,i),u=hn(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=Lp(f,u);d.length&&(r[o]=Zn(u),CA(uh,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=lr(s);E(o)&&HA(uh,s,o.id)}break;case"desync":NA(uh,t.player,hn(t.player));break;case"clearscroll":D4(t.player);break;case"clearplayer":{const i=be(Bt.MAIN),s=$i(i,Bt.GADGETSTORE);delete s[t.player];const o=$i(i,Bt.GADGETSYNC);delete o[t.player];break}}});function hh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var IE={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof hh=="function"&&hh;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof hh=="function"&&hh,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,p,m,y=[],b=0,k=c.length,T=k,A=s.getTypeOf(c)!=="string";b<c.length;)T=k-b,f=A?(l=c[b++],u=b<k?c[b++]:0,b<k?c[b++]:0):(l=c.charCodeAt(b++),u=b<k?c.charCodeAt(b++):0,b<k?c.charCodeAt(b++):0),d=l>>2,h=(3&l)<<4|u>>4,p=1<T?(15&u)<<2|f>>6:64,m=2<T?63&f:64,y.push(a.charAt(d)+a.charAt(h)+a.charAt(p)+a.charAt(m));return y.join("")},i.decode=function(c){var l,u,f,d,h,p,m=0,y=0,b="data:";if(c.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var k,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=o.uint8array?new Uint8Array(0|T):new Array(0|T);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(m++)))>>2,f=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),k[y++]=l,h!==64&&(k[y++]=u),p!==64&&(k[y++]=f);return k}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,p){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,y="";for(m=0;m<p;m++)y+=String.fromCharCode(255&h),h>>>=8;return y}function o(h,p,m,y,b,k){var T,A,C=h.file,R=h.compression,S=k!==l.utf8encode,U=a.transformTo("string",k(C.name)),I=a.transformTo("string",l.utf8encode(C.name)),D=C.comment,V=a.transformTo("string",k(D)),L=a.transformTo("string",l.utf8encode(D)),N=I.length!==C.name.length,x=L.length!==D.length,B="",Z="",$="",st=C.dir,nt=C.date,at={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(at.crc32=h.crc32,at.compressedSize=h.compressedSize,at.uncompressedSize=h.uncompressedSize);var G=0;p&&(G|=8),S||!N&&!x||(G|=2048);var H=0,bt=0;st&&(H|=16),b==="UNIX"?(bt=798,H|=function(ht,Dt){var re=ht;return ht||(re=Dt?16893:33204),(65535&re)<<16}(C.unixPermissions,st)):(bt=20,H|=function(ht){return 63&(ht||0)}(C.dosPermissions)),T=nt.getUTCHours(),T<<=6,T|=nt.getUTCMinutes(),T<<=5,T|=nt.getUTCSeconds()/2,A=nt.getUTCFullYear()-1980,A<<=4,A|=nt.getUTCMonth()+1,A<<=5,A|=nt.getUTCDate(),N&&(Z=s(1,1)+s(u(U),4)+I,B+="up"+s(Z.length,2)+Z),x&&($=s(1,1)+s(u(V),4)+L,B+="uc"+s($.length,2)+$);var lt="";return lt+=`
\0`,lt+=s(G,2),lt+=R.magic,lt+=s(T,2),lt+=s(A,2),lt+=s(at.crc32,4),lt+=s(at.compressedSize,4),lt+=s(at.uncompressedSize,4),lt+=s(U.length,2),lt+=s(B.length,2),{fileRecord:f.LOCAL_FILE_HEADER+lt+U+B,dirRecord:f.CENTRAL_FILE_HEADER+s(bt,2)+lt+s(V.length,2)+"\0\0\0\0"+s(H,4)+s(y,4)+U+B+V}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,p,m,y){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=y,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-y-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(y){return f.DATA_DESCRIPTOR+s(y.crc32,4)+s(y.compressedSize,4)+s(y.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,y=function(b,k,T,A,C){var R=a.transformTo("string",C(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(b,2)+s(b,2)+s(k,4)+s(T,4)+s(R.length,2)+R}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var p=function(k,T){var A=k||T,C=s[A];if(!C)throw new Error(A+" is not a valid compression method !");return C}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},y=h.dir,b=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:y,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(y){p(y)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var y=new c(h);return y.load(m),y}).then(function(m){var y=[o.Promise.resolve(m)],b=m.files;if(h.checkCRC32)for(var k=0;k<b.length;k++)y.push(f(b[k]));return o.Promise.all(y)}).then(function(m){for(var y=m.shift(),b=y.files,k=0;k<b.length;k++){var T=b[k],A=T.fileNameStr,C=s.resolve(T.fileNameStr);p.file(C,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(p.file(C).unsafeOriginalName=A)}return y.zipComment.length&&(p.comment=y.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof dn<"u",newBufferFrom:function(s,o){if(dn.from&&dn.from!==Uint8Array.from)return dn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new dn(s,o)},allocBuffer:function(s){if(dn.alloc)return dn.alloc(s);var o=new dn(s);return o.fill(0),o},isBuffer:function(s){return dn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,R,S){var U,I=a.getTypeOf(R),D=a.extend(S||{},u);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(C=b(C)),D.createFolders&&(U=y(C))&&k.call(this,U,!0);var V=I==="string"&&D.binary===!1&&D.base64===!1;S&&S.binary!==void 0||(D.binary=!V),(R instanceof f&&R.uncompressedSize===0||D.dir||!R||R.length===0)&&(D.base64=!1,D.binary=!0,R="",D.compression="STORE",I="string");var L=null;L=R instanceof f||R instanceof c?R:p.isNode&&p.isStream(R)?new m(C,R):a.prepareContent(C,R,D.binary,D.optimizedBinaryString,D.base64);var N=new d(C,L,D);this.files[C]=N}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),y=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var R=C.lastIndexOf("/");return 0<R?C.substring(0,R):""},b=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},k=function(C,R){return R=R!==void 0?R:u.createFolders,C=b(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:R}),this.files[C]};function T(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var R,S,U;for(R in this.files)U=this.files[R],(S=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&C(S,U)},filter:function(C){var R=[];return this.forEach(function(S,U){C(S,U)&&R.push(U)}),R},file:function(C,R,S){if(arguments.length!==1)return C=this.root+C,s.call(this,C,R,S),this;if(T(C)){var U=C;return this.filter(function(D,V){return!V.dir&&U.test(D)})}var I=this.files[this.root+C];return I&&!I.dir?I:null},folder:function(C){if(!C)return this;if(T(C))return this.filter(function(I,D){return D.dir&&C.test(I)});var R=this.root+C,S=k.call(this,R),U=this.clone();return U.root=S.name,U},remove:function(C){C=this.root+C;var R=this.files[C];if(R||(C.slice(-1)!=="/"&&(C+="/"),R=this.files[C]),R&&!R.dir)delete this.files[C];else for(var S=this.filter(function(I,D){return D.name.slice(0,C.length)===C}),U=0;U<S.length;U++)delete this.files[S[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var R,S={};try{if((S=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");a.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var U=S.comment||this.comment||"";R=h.generateWorker(this,S,U)}catch(I){(R=new c("error")).error(I)}return new l(R,S.type||"string",S.mimeType)},generateAsync:function(C,R){return this.generateInternalStream(C).accumulate(R)},generateNodeStream:function(C,R){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(R)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(y,b){var k=[],T=p._internalType,A=p._outputType,C=p._mimeType;p.on("data",function(R,S){k.push(R),m&&m(S)}).on("error",function(R){k=[],b(R)}).on("end",function(){try{var R=function(S,U,I){switch(S){case"blob":return s.newBlob(s.transformTo("arraybuffer",U),I);case"base64":return c.encode(U);default:return s.transformTo(S,U)}}(A,function(S,U){var I,D=0,V=null,L=0;for(I=0;I<U.length;I++)L+=U[I].length;switch(S){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(V=new Uint8Array(L),I=0;I<U.length;I++)V.set(U[I],D),D+=U[I].length;return V;case"nodebuffer":return dn.concat(U);default:throw new Error("concat : unsupported type '"+S+"'")}}(T,k),C);y(R)}catch(S){b(S)}k=[]}).resume()})}function h(p,m,y){var b=m;switch(m){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=m,this._mimeType=y,s.checkSupport(b),this._worker=p.pipe(new o(b)),p.lock()}catch(k){this._worker=new a("error"),this._worker.error(k)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var y=this;return p==="data"?this._worker.on(p,function(b){m.call(y,b.data,b.meta)}):this._worker.on(p,function(){s.delay(m,arguments,y)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof dn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,y,b,k,T,A=p.length,C=0;for(k=0;k<A;k++)(64512&(y=p.charCodeAt(k)))==55296&&k+1<A&&(64512&(b=p.charCodeAt(k+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),k++),C+=y<128?1:y<2048?2:y<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),k=T=0;T<C;k++)(64512&(y=p.charCodeAt(k)))==55296&&k+1<A&&(64512&(b=p.charCodeAt(k+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),k++),y<128?m[T++]=y:(y<2048?m[T++]=192|y>>>6:(y<65536?m[T++]=224|y>>>12:(m[T++]=240|y>>>18,m[T++]=128|y>>>12&63),m[T++]=128|y>>>6&63),m[T++]=128|63&y);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,y,b,k,T=p.length,A=new Array(2*T);for(m=y=0;m<T;)if((b=p[m++])<128)A[y++]=b;else if(4<(k=l[b]))A[y++]=65533,m+=k-1;else{for(b&=k===2?31:k===3?15:7;1<k&&m<T;)b=b<<6|63&p[m++],k--;1<k?A[y++]=65533:b<65536?A[y++]=b:(b-=65536,A[y++]=55296|b>>10&1023,A[y++]=56320|1023&b)}return A.length!==y&&(A.subarray?A=A.subarray(0,y):A.length=y),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var y=function(k,T){var A;for((T=T||k.length)>k.length&&(T=k.length),A=T-1;0<=A&&(192&k[A])==128;)A--;return A<0||A===0?T:A+l[k[A]]>T?A:T}(p),b=p;y!==p.length&&(o.uint8array?(b=p.subarray(0,y),this.leftOver=p.subarray(y,p.length)):(b=p.slice(0,y),this.leftOver=p.slice(y,p.length))),this.push({data:i.utf8decode(b),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,y){for(var b=0;b<m.length;++b)y[b]=255&m.charCodeAt(b);return y}n("setimmediate"),i.newBlob=function(m,y){i.checkSupport("blob");try{return new Blob([m],{type:y})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(m),b.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,y,b){var k=[],T=0,A=m.length;if(A<=b)return String.fromCharCode.apply(null,m);for(;T<A;)y==="array"||y==="nodebuffer"?k.push(String.fromCharCode.apply(null,m.slice(T,Math.min(T+b,A)))):k.push(String.fromCharCode.apply(null,m.subarray(T,Math.min(T+b,A)))),T+=b;return k.join("")},stringifyByChar:function(m){for(var y="",b=0;b<m.length;b++)y+=String.fromCharCode(m[b]);return y},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var y=65536,b=i.getTypeOf(m),k=!0;if(b==="uint8array"?k=f.applyCanBeUsed.uint8array:b==="nodebuffer"&&(k=f.applyCanBeUsed.nodebuffer),k)for(;1<y;)try{return f.stringifyByChunk(m,b,y)}catch{y=Math.floor(y/2)}return f.stringifyByChar(m)}function h(m,y){for(var b=0;b<m.length;b++)y[b]=m[b];return y}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,y){if(y=y||"",!m)return y;i.checkSupport(m);var b=i.getTypeOf(y);return p[b][m](y)},i.resolve=function(m){for(var y=m.split("/"),b=[],k=0;k<y.length;k++){var T=y[k];T==="."||T===""&&k!==0&&k!==y.length-1||(T===".."?b.pop():b.push(T))}return b.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var y,b,k="";for(b=0;b<(m||"").length;b++)k+="\\x"+((y=m.charCodeAt(b))<16?"0":"")+y.toString(16).toUpperCase();return k},i.delay=function(m,y,b){setImmediate(function(){m.apply(b||null,y||[])})},i.inherits=function(m,y){function b(){}b.prototype=y.prototype,m.prototype=new b},i.extend=function(){var m,y,b={};for(m=0;m<arguments.length;m++)for(y in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],y)&&b[y]===void 0&&(b[y]=arguments[m][y]);return b},i.prepareContent=function(m,y,b,k,T){return c.Promise.resolve(y).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,R){var S=new FileReader;S.onload=function(U){C(U.target.result)},S.onerror=function(U){R(U.target.error)},S.readAsArrayBuffer(A)}):A}).then(function(A){var C=i.getTypeOf(A);return C?(C==="arraybuffer"?A=i.transformTo("uint8array",A):C==="string"&&(T?A=o.decode(A):b&&k!==!0&&(A=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(y){for(var b in u)if(Object.prototype.hasOwnProperty.call(u,b)&&u[b].magic===y)return u[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,y,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)p=h.readInt(2),m=h.readInt(2),y=h.readData(m),this.extraFields[p]={id:p,length:m,value:y};h.setIndex(b)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var b=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,y){this.name=p,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=m,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,y="string";try{if(!p)throw new Error("No output type specified.");var b=(y=p.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),m=this._decompressWorker();var k=!this._dataBinary;k&&!b&&(m=m.pipe(new c.Utf8EncodeWorker)),!k&&b&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(T){(m=new u("error")).error(T)}return new o(m,y,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(y,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,y;a=!0;for(var b=h.length;b;){for(y=h,h=[],m=-1;++m<b;)y[m]();b=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Cn<"u"?Cn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,b!==o&&m(this,b)}function d(b,k,T){this.promise=b,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(b,k,T){s(function(){var A;try{A=k(T)}catch(C){return a.reject(b,C)}A===b?a.reject(b,new TypeError("Cannot resolve promise with itself")):a.resolve(b,A)})}function p(b){var k=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof k=="function")return function(){k.apply(b,arguments)}}function m(b,k){var T=!1;function A(S){T||(T=!0,a.reject(b,S))}function C(S){T||(T=!0,a.resolve(b,S))}var R=y(function(){k(C,A)});R.status==="error"&&A(R.value)}function y(b,k){var T={};try{T.value=b(k),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(b){if(typeof b!="function")return this;var k=this.constructor;return this.then(function(T){return k.resolve(b()).then(function(){return T})},function(T){return k.resolve(b()).then(function(){throw T})})},f.prototype.catch=function(b){return this.then(null,b)},f.prototype.then=function(b,k){if(typeof b!="function"&&this.state===l||typeof k!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?b:k,this.outcome):this.queue.push(new d(T,b,k)),T},d.prototype.callFulfilled=function(b){a.resolve(this.promise,b)},d.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},d.prototype.callRejected=function(b){a.reject(this.promise,b)},d.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},a.resolve=function(b,k){var T=y(p,k);if(T.status==="error")return a.reject(b,T.value);var A=T.value;if(A)m(b,A);else{b.state=l,b.outcome=k;for(var C=-1,R=b.queue.length;++C<R;)b.queue[C].callFulfilled(k)}return b},a.reject=function(b,k){b.state=c,b.outcome=k;for(var T=-1,A=b.queue.length;++T<A;)b.queue[T].callRejected(k);return b},f.resolve=function(b){return b instanceof this?b:a.resolve(new this(o),b)},f.reject=function(b){var k=new this(o);return a.reject(k,b)},f.all=function(b){var k=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=b.length,A=!1;if(!T)return this.resolve([]);for(var C=new Array(T),R=0,S=-1,U=new this(o);++S<T;)I(b[S],S);return U;function I(D,V){k.resolve(D).then(function(L){C[V]=L,++R!==T||A||(A=!0,a.resolve(U,C))},function(L){A||(A=!0,a.reject(U,L))})}},f.race=function(b){var k=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=b.length,A=!1;if(!T)return this.resolve([]);for(var C=-1,R=new this(o);++C<T;)S=b[C],k.resolve(S).then(function(U){A||(A=!0,a.resolve(R,U))},function(U){A||(A=!0,a.reject(R,U))});var S;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(b){if(!(this instanceof m))return new m(b);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(T!==f)throw new Error(c[T]);if(k.header&&s.deflateSetHeader(this.strm,k.header),k.dictionary){var A;if(A=typeof k.dictionary=="string"?a.string2buf(k.dictionary):u.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function y(b,k){var T=new m(k);if(T.push(b,!0),T.err)throw T.msg||c[T.err];return T.result}m.prototype.push=function(b,k){var T,A,C=this.strm,R=this.options.chunkSize;if(this.ended)return!1;A=k===~~k?k:k===!0?4:0,typeof b=="string"?C.input=a.string2buf(b):u.call(b)==="[object ArrayBuffer]"?C.input=new Uint8Array(b):C.input=b,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(R),C.next_out=0,C.avail_out=R),(T=s.deflate(C,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(C.avail_out=0))},m.prototype.onData=function(b){this.chunks.push(b)},m.prototype.onEnd=function(b){b===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=m,i.deflate=y,i.deflateRaw=function(b,k){return(k=k||{}).raw=!0,y(b,k)},i.gzip=function(b,k){return(k=k||{}).gzip=!0,y(b,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||m&&m.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var b=s.inflateInit2(this.strm,y.windowBits);if(b!==c.Z_OK)throw new Error(l[b]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function p(m,y){var b=new h(y);if(b.push(m,!0),b.err)throw b.msg||l[b.err];return b.result}h.prototype.push=function(m,y){var b,k,T,A,C,R,S=this.strm,U=this.options.chunkSize,I=this.options.dictionary,D=!1;if(this.ended)return!1;k=y===~~y?y:y===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?S.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(U),S.next_out=0,S.avail_out=U),(b=s.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&I&&(R=typeof I=="string"?a.string2buf(I):d.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,b=s.inflateSetDictionary(this.strm,R)),b===c.Z_BUF_ERROR&&D===!0&&(b=c.Z_OK,D=!1),b!==c.Z_STREAM_END&&b!==c.Z_OK)return this.onEnd(b),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&b!==c.Z_STREAM_END&&(S.avail_in!==0||k!==c.Z_FINISH&&k!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(S.output,S.next_out),A=S.next_out-T,C=a.buf2string(S.output,T),S.next_out=A,S.avail_out=U-A,A&&o.arraySet(S.output,S.output,T,A,0),this.onData(C)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(D=!0)}while((0<S.avail_in||S.avail_out===0)&&b!==c.Z_STREAM_END);return b===c.Z_STREAM_END&&(k=c.Z_FINISH),k===c.Z_FINISH?(b=s.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===c.Z_OK):k!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,y){return(y=y||{}).raw=!0,p(m,y)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,p;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(p=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],p.set(h,d),d+=h.length;return p}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,p,m,y,b=f.length,k=0;for(m=0;m<b;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),k+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(k),m=y=0;y<k;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[y++]=h:(h<2048?d[y++]=192|h>>>6:(h<65536?d[y++]=224|h>>>12:(d[y++]=240|h>>>18,d[y++]=128|h>>>12&63),d[y++]=128|h>>>6&63),d[y++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,p,m,y,b=d||f.length,k=new Array(2*b);for(h=p=0;h<b;)if((m=f[h++])<128)k[p++]=m;else if(4<(y=c[m]))k[p++]=65533,h+=y-1;else{for(m&=y===2?31:y===3?15:7;1<y&&h<b;)m=m<<6|63&f[h++],y--;1<y?k[p++]=65533:m<65536?k[p++]=m:(m-=65536,k[p++]=55296|m>>10&1023,k[p++]=56320|1023&m)}return u(k,p)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,p=-2,m=-1,y=4,b=2,k=8,T=9,A=286,C=30,R=19,S=2*A+1,U=15,I=3,D=258,V=D+I+1,L=42,N=113,x=1,B=2,Z=3,$=4;function st(v,ot){return v.msg=u[ot],ot}function nt(v){return(v<<1)-(4<v?9:0)}function at(v){for(var ot=v.length;0<=--ot;)v[ot]=0}function G(v){var ot=v.state,et=ot.pending;et>v.avail_out&&(et=v.avail_out),et!==0&&(o.arraySet(v.output,ot.pending_buf,ot.pending_out,et,v.next_out),v.next_out+=et,ot.pending_out+=et,v.total_out+=et,v.avail_out-=et,ot.pending-=et,ot.pending===0&&(ot.pending_out=0))}function H(v,ot){a._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,ot),v.block_start=v.strstart,G(v.strm)}function bt(v,ot){v.pending_buf[v.pending++]=ot}function lt(v,ot){v.pending_buf[v.pending++]=ot>>>8&255,v.pending_buf[v.pending++]=255&ot}function ht(v,ot){var et,P,F=v.max_chain_length,Y=v.strstart,ct=v.prev_length,ft=v.nice_match,J=v.strstart>v.w_size-V?v.strstart-(v.w_size-V):0,mt=v.window,xt=v.w_mask,pt=v.prev,Tt=v.strstart+D,le=mt[Y+ct-1],Pt=mt[Y+ct];v.prev_length>=v.good_match&&(F>>=2),ft>v.lookahead&&(ft=v.lookahead);do if(mt[(et=ot)+ct]===Pt&&mt[et+ct-1]===le&&mt[et]===mt[Y]&&mt[++et]===mt[Y+1]){Y+=2,et++;do;while(mt[++Y]===mt[++et]&&mt[++Y]===mt[++et]&&mt[++Y]===mt[++et]&&mt[++Y]===mt[++et]&&mt[++Y]===mt[++et]&&mt[++Y]===mt[++et]&&mt[++Y]===mt[++et]&&mt[++Y]===mt[++et]&&Y<Tt);if(P=D-(Tt-Y),Y=Tt-D,ct<P){if(v.match_start=ot,ft<=(ct=P))break;le=mt[Y+ct-1],Pt=mt[Y+ct]}}while((ot=pt[ot&xt])>J&&--F!=0);return ct<=v.lookahead?ct:v.lookahead}function Dt(v){var ot,et,P,F,Y,ct,ft,J,mt,xt,pt=v.w_size;do{if(F=v.window_size-v.lookahead-v.strstart,v.strstart>=pt+(pt-V)){for(o.arraySet(v.window,v.window,pt,pt,0),v.match_start-=pt,v.strstart-=pt,v.block_start-=pt,ot=et=v.hash_size;P=v.head[--ot],v.head[ot]=pt<=P?P-pt:0,--et;);for(ot=et=pt;P=v.prev[--ot],v.prev[ot]=pt<=P?P-pt:0,--et;);F+=pt}if(v.strm.avail_in===0)break;if(ct=v.strm,ft=v.window,J=v.strstart+v.lookahead,mt=F,xt=void 0,xt=ct.avail_in,mt<xt&&(xt=mt),et=xt===0?0:(ct.avail_in-=xt,o.arraySet(ft,ct.input,ct.next_in,xt,J),ct.state.wrap===1?ct.adler=c(ct.adler,ft,xt,J):ct.state.wrap===2&&(ct.adler=l(ct.adler,ft,xt,J)),ct.next_in+=xt,ct.total_in+=xt,xt),v.lookahead+=et,v.lookahead+v.insert>=I)for(Y=v.strstart-v.insert,v.ins_h=v.window[Y],v.ins_h=(v.ins_h<<v.hash_shift^v.window[Y+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[Y+I-1])&v.hash_mask,v.prev[Y&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=Y,Y++,v.insert--,!(v.lookahead+v.insert<I)););}while(v.lookahead<V&&v.strm.avail_in!==0)}function re(v,ot){for(var et,P;;){if(v.lookahead<V){if(Dt(v),v.lookahead<V&&ot===f)return x;if(v.lookahead===0)break}if(et=0,v.lookahead>=I&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),et!==0&&v.strstart-et<=v.w_size-V&&(v.match_length=ht(v,et)),v.match_length>=I)if(P=a._tr_tally(v,v.strstart-v.match_start,v.match_length-I),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=I){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else P=a._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(P&&(H(v,!1),v.strm.avail_out===0))return x}return v.insert=v.strstart<I-1?v.strstart:I-1,ot===d?(H(v,!0),v.strm.avail_out===0?Z:$):v.last_lit&&(H(v,!1),v.strm.avail_out===0)?x:B}function Ft(v,ot){for(var et,P,F;;){if(v.lookahead<V){if(Dt(v),v.lookahead<V&&ot===f)return x;if(v.lookahead===0)break}if(et=0,v.lookahead>=I&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=I-1,et!==0&&v.prev_length<v.max_lazy_match&&v.strstart-et<=v.w_size-V&&(v.match_length=ht(v,et),v.match_length<=5&&(v.strategy===1||v.match_length===I&&4096<v.strstart-v.match_start)&&(v.match_length=I-1)),v.prev_length>=I&&v.match_length<=v.prev_length){for(F=v.strstart+v.lookahead-I,P=a._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-I),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=F&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=I-1,v.strstart++,P&&(H(v,!1),v.strm.avail_out===0))return x}else if(v.match_available){if((P=a._tr_tally(v,0,v.window[v.strstart-1]))&&H(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return x}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(P=a._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<I-1?v.strstart:I-1,ot===d?(H(v,!0),v.strm.avail_out===0?Z:$):v.last_lit&&(H(v,!1),v.strm.avail_out===0)?x:B}function Mt(v,ot,et,P,F){this.good_length=v,this.max_lazy=ot,this.nice_length=et,this.max_chain=P,this.func=F}function oe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),at(this.dyn_ltree),at(this.dyn_dtree),at(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(U+1),this.heap=new o.Buf16(2*A+1),at(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),at(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Wt(v){var ot;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=b,(ot=v.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?L:N,v.adler=ot.wrap===2?0:1,ot.last_flush=f,a._tr_init(ot),h):st(v,p)}function Re(v){var ot=Wt(v);return ot===h&&function(et){et.window_size=2*et.w_size,at(et.head),et.max_lazy_match=s[et.level].max_lazy,et.good_match=s[et.level].good_length,et.nice_match=s[et.level].nice_length,et.max_chain_length=s[et.level].max_chain,et.strstart=0,et.block_start=0,et.lookahead=0,et.insert=0,et.match_length=et.prev_length=I-1,et.match_available=0,et.ins_h=0}(v.state),ot}function Pe(v,ot,et,P,F,Y){if(!v)return p;var ct=1;if(ot===m&&(ot=6),P<0?(ct=0,P=-P):15<P&&(ct=2,P-=16),F<1||T<F||et!==k||P<8||15<P||ot<0||9<ot||Y<0||y<Y)return st(v,p);P===8&&(P=9);var ft=new oe;return(v.state=ft).strm=v,ft.wrap=ct,ft.gzhead=null,ft.w_bits=P,ft.w_size=1<<ft.w_bits,ft.w_mask=ft.w_size-1,ft.hash_bits=F+7,ft.hash_size=1<<ft.hash_bits,ft.hash_mask=ft.hash_size-1,ft.hash_shift=~~((ft.hash_bits+I-1)/I),ft.window=new o.Buf8(2*ft.w_size),ft.head=new o.Buf16(ft.hash_size),ft.prev=new o.Buf16(ft.w_size),ft.lit_bufsize=1<<F+6,ft.pending_buf_size=4*ft.lit_bufsize,ft.pending_buf=new o.Buf8(ft.pending_buf_size),ft.d_buf=1*ft.lit_bufsize,ft.l_buf=3*ft.lit_bufsize,ft.level=ot,ft.strategy=Y,ft.method=et,Re(v)}s=[new Mt(0,0,0,0,function(v,ot){var et=65535;for(et>v.pending_buf_size-5&&(et=v.pending_buf_size-5);;){if(v.lookahead<=1){if(Dt(v),v.lookahead===0&&ot===f)return x;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var P=v.block_start+et;if((v.strstart===0||v.strstart>=P)&&(v.lookahead=v.strstart-P,v.strstart=P,H(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-V&&(H(v,!1),v.strm.avail_out===0))return x}return v.insert=0,ot===d?(H(v,!0),v.strm.avail_out===0?Z:$):(v.strstart>v.block_start&&(H(v,!1),v.strm.avail_out),x)}),new Mt(4,4,8,4,re),new Mt(4,5,16,8,re),new Mt(4,6,32,32,re),new Mt(4,4,16,16,Ft),new Mt(8,16,32,32,Ft),new Mt(8,16,128,128,Ft),new Mt(8,32,128,256,Ft),new Mt(32,128,258,1024,Ft),new Mt(32,258,258,4096,Ft)],i.deflateInit=function(v,ot){return Pe(v,ot,k,15,8,0)},i.deflateInit2=Pe,i.deflateReset=Re,i.deflateResetKeep=Wt,i.deflateSetHeader=function(v,ot){return v&&v.state?v.state.wrap!==2?p:(v.state.gzhead=ot,h):p},i.deflate=function(v,ot){var et,P,F,Y;if(!v||!v.state||5<ot||ot<0)return v?st(v,p):p;if(P=v.state,!v.output||!v.input&&v.avail_in!==0||P.status===666&&ot!==d)return st(v,v.avail_out===0?-5:p);if(P.strm=v,et=P.last_flush,P.last_flush=ot,P.status===L)if(P.wrap===2)v.adler=0,bt(P,31),bt(P,139),bt(P,8),P.gzhead?(bt(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),bt(P,255&P.gzhead.time),bt(P,P.gzhead.time>>8&255),bt(P,P.gzhead.time>>16&255),bt(P,P.gzhead.time>>24&255),bt(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),bt(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(bt(P,255&P.gzhead.extra.length),bt(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(v.adler=l(v.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(bt(P,0),bt(P,0),bt(P,0),bt(P,0),bt(P,0),bt(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),bt(P,3),P.status=N);else{var ct=k+(P.w_bits-8<<4)<<8;ct|=(2<=P.strategy||P.level<2?0:P.level<6?1:P.level===6?2:3)<<6,P.strstart!==0&&(ct|=32),ct+=31-ct%31,P.status=N,lt(P,ct),P.strstart!==0&&(lt(P,v.adler>>>16),lt(P,65535&v.adler)),v.adler=1}if(P.status===69)if(P.gzhead.extra){for(F=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),G(v),F=P.pending,P.pending!==P.pending_buf_size));)bt(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(P.status===73)if(P.gzhead.name){F=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),G(v),F=P.pending,P.pending===P.pending_buf_size)){Y=1;break}Y=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,bt(P,Y)}while(Y!==0);P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),Y===0&&(P.gzindex=0,P.status=91)}else P.status=91;if(P.status===91)if(P.gzhead.comment){F=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),G(v),F=P.pending,P.pending===P.pending_buf_size)){Y=1;break}Y=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,bt(P,Y)}while(Y!==0);P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),Y===0&&(P.status=103)}else P.status=103;if(P.status===103&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&G(v),P.pending+2<=P.pending_buf_size&&(bt(P,255&v.adler),bt(P,v.adler>>8&255),v.adler=0,P.status=N)):P.status=N),P.pending!==0){if(G(v),v.avail_out===0)return P.last_flush=-1,h}else if(v.avail_in===0&&nt(ot)<=nt(et)&&ot!==d)return st(v,-5);if(P.status===666&&v.avail_in!==0)return st(v,-5);if(v.avail_in!==0||P.lookahead!==0||ot!==f&&P.status!==666){var ft=P.strategy===2?function(J,mt){for(var xt;;){if(J.lookahead===0&&(Dt(J),J.lookahead===0)){if(mt===f)return x;break}if(J.match_length=0,xt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,xt&&(H(J,!1),J.strm.avail_out===0))return x}return J.insert=0,mt===d?(H(J,!0),J.strm.avail_out===0?Z:$):J.last_lit&&(H(J,!1),J.strm.avail_out===0)?x:B}(P,ot):P.strategy===3?function(J,mt){for(var xt,pt,Tt,le,Pt=J.window;;){if(J.lookahead<=D){if(Dt(J),J.lookahead<=D&&mt===f)return x;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=I&&0<J.strstart&&(pt=Pt[Tt=J.strstart-1])===Pt[++Tt]&&pt===Pt[++Tt]&&pt===Pt[++Tt]){le=J.strstart+D;do;while(pt===Pt[++Tt]&&pt===Pt[++Tt]&&pt===Pt[++Tt]&&pt===Pt[++Tt]&&pt===Pt[++Tt]&&pt===Pt[++Tt]&&pt===Pt[++Tt]&&pt===Pt[++Tt]&&Tt<le);J.match_length=D-(le-Tt),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=I?(xt=a._tr_tally(J,1,J.match_length-I),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(xt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),xt&&(H(J,!1),J.strm.avail_out===0))return x}return J.insert=0,mt===d?(H(J,!0),J.strm.avail_out===0?Z:$):J.last_lit&&(H(J,!1),J.strm.avail_out===0)?x:B}(P,ot):s[P.level].func(P,ot);if(ft!==Z&&ft!==$||(P.status=666),ft===x||ft===Z)return v.avail_out===0&&(P.last_flush=-1),h;if(ft===B&&(ot===1?a._tr_align(P):ot!==5&&(a._tr_stored_block(P,0,0,!1),ot===3&&(at(P.head),P.lookahead===0&&(P.strstart=0,P.block_start=0,P.insert=0))),G(v),v.avail_out===0))return P.last_flush=-1,h}return ot!==d?h:P.wrap<=0?1:(P.wrap===2?(bt(P,255&v.adler),bt(P,v.adler>>8&255),bt(P,v.adler>>16&255),bt(P,v.adler>>24&255),bt(P,255&v.total_in),bt(P,v.total_in>>8&255),bt(P,v.total_in>>16&255),bt(P,v.total_in>>24&255)):(lt(P,v.adler>>>16),lt(P,65535&v.adler)),G(v),0<P.wrap&&(P.wrap=-P.wrap),P.pending!==0?h:1)},i.deflateEnd=function(v){var ot;return v&&v.state?(ot=v.state.status)!==L&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==N&&ot!==666?st(v,p):(v.state=null,ot===N?st(v,-3):h):p},i.deflateSetDictionary=function(v,ot){var et,P,F,Y,ct,ft,J,mt,xt=ot.length;if(!v||!v.state||(Y=(et=v.state).wrap)===2||Y===1&&et.status!==L||et.lookahead)return p;for(Y===1&&(v.adler=c(v.adler,ot,xt,0)),et.wrap=0,xt>=et.w_size&&(Y===0&&(at(et.head),et.strstart=0,et.block_start=0,et.insert=0),mt=new o.Buf8(et.w_size),o.arraySet(mt,ot,xt-et.w_size,et.w_size,0),ot=mt,xt=et.w_size),ct=v.avail_in,ft=v.next_in,J=v.input,v.avail_in=xt,v.next_in=0,v.input=ot,Dt(et);et.lookahead>=I;){for(P=et.strstart,F=et.lookahead-(I-1);et.ins_h=(et.ins_h<<et.hash_shift^et.window[P+I-1])&et.hash_mask,et.prev[P&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=P,P++,--F;);et.strstart=P,et.lookahead=I-1,Dt(et)}return et.strstart+=et.lookahead,et.block_start=et.strstart,et.insert=et.lookahead,et.lookahead=0,et.match_length=et.prev_length=I-1,et.match_available=0,v.next_in=ft,v.input=J,v.avail_in=ct,et.wrap=Y,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,p,m,y,b,k,T,A,C,R,S,U,I,D,V,L,N,x,B;a=s.state,c=s.next_in,x=s.input,l=c+(s.avail_in-5),u=s.next_out,B=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,y=a.wnext,b=a.window,k=a.hold,T=a.bits,A=a.lencode,C=a.distcode,R=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;t:do{T<15&&(k+=x[c++]<<T,T+=8,k+=x[c++]<<T,T+=8),U=A[k&R];e:for(;;){if(k>>>=I=U>>>24,T-=I,(I=U>>>16&255)===0)B[u++]=65535&U;else{if(!(16&I)){if(!(64&I)){U=A[(65535&U)+(k&(1<<I)-1)];continue e}if(32&I){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}D=65535&U,(I&=15)&&(T<I&&(k+=x[c++]<<T,T+=8),D+=k&(1<<I)-1,k>>>=I,T-=I),T<15&&(k+=x[c++]<<T,T+=8,k+=x[c++]<<T,T+=8),U=C[k&S];n:for(;;){if(k>>>=I=U>>>24,T-=I,!(16&(I=U>>>16&255))){if(!(64&I)){U=C[(65535&U)+(k&(1<<I)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(V=65535&U,T<(I&=15)&&(k+=x[c++]<<T,(T+=8)<I&&(k+=x[c++]<<T,T+=8)),h<(V+=k&(1<<I)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(k>>>=I,T-=I,(I=u-f)<V){if(m<(I=V-I)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(N=b,(L=0)===y){if(L+=p-I,I<D){for(D-=I;B[u++]=b[L++],--I;);L=u-V,N=B}}else if(y<I){if(L+=p+y-I,(I-=y)<D){for(D-=I;B[u++]=b[L++],--I;);if(L=0,y<D){for(D-=I=y;B[u++]=b[L++],--I;);L=u-V,N=B}}}else if(L+=y-I,I<D){for(D-=I;B[u++]=b[L++],--I;);L=u-V,N=B}for(;2<D;)B[u++]=N[L++],B[u++]=N[L++],B[u++]=N[L++],D-=3;D&&(B[u++]=N[L++],1<D&&(B[u++]=N[L++]))}else{for(L=u-V;B[u++]=B[L++],B[u++]=B[L++],B[u++]=B[L++],2<(D-=3););D&&(B[u++]=B[L++],1<D&&(B[u++]=B[L++]))}break}}break}}while(c<l&&u<d);c-=D=T>>3,k&=(1<<(T-=D<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=k,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,p=1,m=852,y=592;function b(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(L){var N;return L&&L.state?(N=L.state,L.total_in=L.total_out=N.total=0,L.msg="",N.wrap&&(L.adler=1&N.wrap),N.mode=p,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new s.Buf32(m),N.distcode=N.distdyn=new s.Buf32(y),N.sane=1,N.back=-1,d):h}function A(L){var N;return L&&L.state?((N=L.state).wsize=0,N.whave=0,N.wnext=0,T(L)):h}function C(L,N){var x,B;return L&&L.state?(B=L.state,N<0?(x=0,N=-N):(x=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?h:(B.window!==null&&B.wbits!==N&&(B.window=null),B.wrap=x,B.wbits=N,A(L))):h}function R(L,N){var x,B;return L?(B=new k,(L.state=B).window=null,(x=C(L,N))!==d&&(L.state=null),x):h}var S,U,I=!0;function D(L){if(I){var N;for(S=new s.Buf32(512),U=new s.Buf32(32),N=0;N<144;)L.lens[N++]=8;for(;N<256;)L.lens[N++]=9;for(;N<280;)L.lens[N++]=7;for(;N<288;)L.lens[N++]=8;for(l(u,L.lens,0,288,S,0,L.work,{bits:9}),N=0;N<32;)L.lens[N++]=5;l(f,L.lens,0,32,U,0,L.work,{bits:5}),I=!1}L.lencode=S,L.lenbits=9,L.distcode=U,L.distbits=5}function V(L,N,x,B){var Z,$=L.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),B>=$.wsize?(s.arraySet($.window,N,x-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(B<(Z=$.wsize-$.wnext)&&(Z=B),s.arraySet($.window,N,x-B,Z,$.wnext),(B-=Z)?(s.arraySet($.window,N,x-B,B,0),$.wnext=B,$.whave=$.wsize):($.wnext+=Z,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=Z))),0}i.inflateReset=A,i.inflateReset2=C,i.inflateResetKeep=T,i.inflateInit=function(L){return R(L,15)},i.inflateInit2=R,i.inflate=function(L,N){var x,B,Z,$,st,nt,at,G,H,bt,lt,ht,Dt,re,Ft,Mt,oe,Wt,Re,Pe,v,ot,et,P,F=0,Y=new s.Buf8(4),ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(x=L.state).mode===12&&(x.mode=13),st=L.next_out,Z=L.output,at=L.avail_out,$=L.next_in,B=L.input,nt=L.avail_in,G=x.hold,H=x.bits,bt=nt,lt=at,ot=d;t:for(;;)switch(x.mode){case p:if(x.wrap===0){x.mode=13;break}for(;H<16;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(2&x.wrap&&G===35615){Y[x.check=0]=255&G,Y[1]=G>>>8&255,x.check=a(x.check,Y,2,0),H=G=0,x.mode=2;break}if(x.flags=0,x.head&&(x.head.done=!1),!(1&x.wrap)||(((255&G)<<8)+(G>>8))%31){L.msg="incorrect header check",x.mode=30;break}if((15&G)!=8){L.msg="unknown compression method",x.mode=30;break}if(H-=4,v=8+(15&(G>>>=4)),x.wbits===0)x.wbits=v;else if(v>x.wbits){L.msg="invalid window size",x.mode=30;break}x.dmax=1<<v,L.adler=x.check=1,x.mode=512&G?10:12,H=G=0;break;case 2:for(;H<16;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(x.flags=G,(255&x.flags)!=8){L.msg="unknown compression method",x.mode=30;break}if(57344&x.flags){L.msg="unknown header flags set",x.mode=30;break}x.head&&(x.head.text=G>>8&1),512&x.flags&&(Y[0]=255&G,Y[1]=G>>>8&255,x.check=a(x.check,Y,2,0)),H=G=0,x.mode=3;case 3:for(;H<32;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}x.head&&(x.head.time=G),512&x.flags&&(Y[0]=255&G,Y[1]=G>>>8&255,Y[2]=G>>>16&255,Y[3]=G>>>24&255,x.check=a(x.check,Y,4,0)),H=G=0,x.mode=4;case 4:for(;H<16;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}x.head&&(x.head.xflags=255&G,x.head.os=G>>8),512&x.flags&&(Y[0]=255&G,Y[1]=G>>>8&255,x.check=a(x.check,Y,2,0)),H=G=0,x.mode=5;case 5:if(1024&x.flags){for(;H<16;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}x.length=G,x.head&&(x.head.extra_len=G),512&x.flags&&(Y[0]=255&G,Y[1]=G>>>8&255,x.check=a(x.check,Y,2,0)),H=G=0}else x.head&&(x.head.extra=null);x.mode=6;case 6:if(1024&x.flags&&(nt<(ht=x.length)&&(ht=nt),ht&&(x.head&&(v=x.head.extra_len-x.length,x.head.extra||(x.head.extra=new Array(x.head.extra_len)),s.arraySet(x.head.extra,B,$,ht,v)),512&x.flags&&(x.check=a(x.check,B,ht,$)),nt-=ht,$+=ht,x.length-=ht),x.length))break t;x.length=0,x.mode=7;case 7:if(2048&x.flags){if(nt===0)break t;for(ht=0;v=B[$+ht++],x.head&&v&&x.length<65536&&(x.head.name+=String.fromCharCode(v)),v&&ht<nt;);if(512&x.flags&&(x.check=a(x.check,B,ht,$)),nt-=ht,$+=ht,v)break t}else x.head&&(x.head.name=null);x.length=0,x.mode=8;case 8:if(4096&x.flags){if(nt===0)break t;for(ht=0;v=B[$+ht++],x.head&&v&&x.length<65536&&(x.head.comment+=String.fromCharCode(v)),v&&ht<nt;);if(512&x.flags&&(x.check=a(x.check,B,ht,$)),nt-=ht,$+=ht,v)break t}else x.head&&(x.head.comment=null);x.mode=9;case 9:if(512&x.flags){for(;H<16;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(G!==(65535&x.check)){L.msg="header crc mismatch",x.mode=30;break}H=G=0}x.head&&(x.head.hcrc=x.flags>>9&1,x.head.done=!0),L.adler=x.check=0,x.mode=12;break;case 10:for(;H<32;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}L.adler=x.check=b(G),H=G=0,x.mode=11;case 11:if(x.havedict===0)return L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=nt,x.hold=G,x.bits=H,2;L.adler=x.check=1,x.mode=12;case 12:if(N===5||N===6)break t;case 13:if(x.last){G>>>=7&H,H-=7&H,x.mode=27;break}for(;H<3;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}switch(x.last=1&G,H-=1,3&(G>>>=1)){case 0:x.mode=14;break;case 1:if(D(x),x.mode=20,N!==6)break;G>>>=2,H-=2;break t;case 2:x.mode=17;break;case 3:L.msg="invalid block type",x.mode=30}G>>>=2,H-=2;break;case 14:for(G>>>=7&H,H-=7&H;H<32;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if((65535&G)!=(G>>>16^65535)){L.msg="invalid stored block lengths",x.mode=30;break}if(x.length=65535&G,H=G=0,x.mode=15,N===6)break t;case 15:x.mode=16;case 16:if(ht=x.length){if(nt<ht&&(ht=nt),at<ht&&(ht=at),ht===0)break t;s.arraySet(Z,B,$,ht,st),nt-=ht,$+=ht,at-=ht,st+=ht,x.length-=ht;break}x.mode=12;break;case 17:for(;H<14;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(x.nlen=257+(31&G),G>>>=5,H-=5,x.ndist=1+(31&G),G>>>=5,H-=5,x.ncode=4+(15&G),G>>>=4,H-=4,286<x.nlen||30<x.ndist){L.msg="too many length or distance symbols",x.mode=30;break}x.have=0,x.mode=18;case 18:for(;x.have<x.ncode;){for(;H<3;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}x.lens[ct[x.have++]]=7&G,G>>>=3,H-=3}for(;x.have<19;)x.lens[ct[x.have++]]=0;if(x.lencode=x.lendyn,x.lenbits=7,et={bits:x.lenbits},ot=l(0,x.lens,0,19,x.lencode,0,x.work,et),x.lenbits=et.bits,ot){L.msg="invalid code lengths set",x.mode=30;break}x.have=0,x.mode=19;case 19:for(;x.have<x.nlen+x.ndist;){for(;Mt=(F=x.lencode[G&(1<<x.lenbits)-1])>>>16&255,oe=65535&F,!((Ft=F>>>24)<=H);){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(oe<16)G>>>=Ft,H-=Ft,x.lens[x.have++]=oe;else{if(oe===16){for(P=Ft+2;H<P;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(G>>>=Ft,H-=Ft,x.have===0){L.msg="invalid bit length repeat",x.mode=30;break}v=x.lens[x.have-1],ht=3+(3&G),G>>>=2,H-=2}else if(oe===17){for(P=Ft+3;H<P;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}H-=Ft,v=0,ht=3+(7&(G>>>=Ft)),G>>>=3,H-=3}else{for(P=Ft+7;H<P;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}H-=Ft,v=0,ht=11+(127&(G>>>=Ft)),G>>>=7,H-=7}if(x.have+ht>x.nlen+x.ndist){L.msg="invalid bit length repeat",x.mode=30;break}for(;ht--;)x.lens[x.have++]=v}}if(x.mode===30)break;if(x.lens[256]===0){L.msg="invalid code -- missing end-of-block",x.mode=30;break}if(x.lenbits=9,et={bits:x.lenbits},ot=l(u,x.lens,0,x.nlen,x.lencode,0,x.work,et),x.lenbits=et.bits,ot){L.msg="invalid literal/lengths set",x.mode=30;break}if(x.distbits=6,x.distcode=x.distdyn,et={bits:x.distbits},ot=l(f,x.lens,x.nlen,x.ndist,x.distcode,0,x.work,et),x.distbits=et.bits,ot){L.msg="invalid distances set",x.mode=30;break}if(x.mode=20,N===6)break t;case 20:x.mode=21;case 21:if(6<=nt&&258<=at){L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=nt,x.hold=G,x.bits=H,c(L,lt),st=L.next_out,Z=L.output,at=L.avail_out,$=L.next_in,B=L.input,nt=L.avail_in,G=x.hold,H=x.bits,x.mode===12&&(x.back=-1);break}for(x.back=0;Mt=(F=x.lencode[G&(1<<x.lenbits)-1])>>>16&255,oe=65535&F,!((Ft=F>>>24)<=H);){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(Mt&&!(240&Mt)){for(Wt=Ft,Re=Mt,Pe=oe;Mt=(F=x.lencode[Pe+((G&(1<<Wt+Re)-1)>>Wt)])>>>16&255,oe=65535&F,!(Wt+(Ft=F>>>24)<=H);){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}G>>>=Wt,H-=Wt,x.back+=Wt}if(G>>>=Ft,H-=Ft,x.back+=Ft,x.length=oe,Mt===0){x.mode=26;break}if(32&Mt){x.back=-1,x.mode=12;break}if(64&Mt){L.msg="invalid literal/length code",x.mode=30;break}x.extra=15&Mt,x.mode=22;case 22:if(x.extra){for(P=x.extra;H<P;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}x.length+=G&(1<<x.extra)-1,G>>>=x.extra,H-=x.extra,x.back+=x.extra}x.was=x.length,x.mode=23;case 23:for(;Mt=(F=x.distcode[G&(1<<x.distbits)-1])>>>16&255,oe=65535&F,!((Ft=F>>>24)<=H);){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(!(240&Mt)){for(Wt=Ft,Re=Mt,Pe=oe;Mt=(F=x.distcode[Pe+((G&(1<<Wt+Re)-1)>>Wt)])>>>16&255,oe=65535&F,!(Wt+(Ft=F>>>24)<=H);){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}G>>>=Wt,H-=Wt,x.back+=Wt}if(G>>>=Ft,H-=Ft,x.back+=Ft,64&Mt){L.msg="invalid distance code",x.mode=30;break}x.offset=oe,x.extra=15&Mt,x.mode=24;case 24:if(x.extra){for(P=x.extra;H<P;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}x.offset+=G&(1<<x.extra)-1,G>>>=x.extra,H-=x.extra,x.back+=x.extra}if(x.offset>x.dmax){L.msg="invalid distance too far back",x.mode=30;break}x.mode=25;case 25:if(at===0)break t;if(ht=lt-at,x.offset>ht){if((ht=x.offset-ht)>x.whave&&x.sane){L.msg="invalid distance too far back",x.mode=30;break}Dt=ht>x.wnext?(ht-=x.wnext,x.wsize-ht):x.wnext-ht,ht>x.length&&(ht=x.length),re=x.window}else re=Z,Dt=st-x.offset,ht=x.length;for(at<ht&&(ht=at),at-=ht,x.length-=ht;Z[st++]=re[Dt++],--ht;);x.length===0&&(x.mode=21);break;case 26:if(at===0)break t;Z[st++]=x.length,at--,x.mode=21;break;case 27:if(x.wrap){for(;H<32;){if(nt===0)break t;nt--,G|=B[$++]<<H,H+=8}if(lt-=at,L.total_out+=lt,x.total+=lt,lt&&(L.adler=x.check=x.flags?a(x.check,Z,lt,st-lt):o(x.check,Z,lt,st-lt)),lt=at,(x.flags?G:b(G))!==x.check){L.msg="incorrect data check",x.mode=30;break}H=G=0}x.mode=28;case 28:if(x.wrap&&x.flags){for(;H<32;){if(nt===0)break t;nt--,G+=B[$++]<<H,H+=8}if(G!==(4294967295&x.total)){L.msg="incorrect length check",x.mode=30;break}H=G=0}x.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=st,L.avail_out=at,L.next_in=$,L.avail_in=nt,x.hold=G,x.bits=H,(x.wsize||lt!==L.avail_out&&x.mode<30&&(x.mode<27||N!==4))&&V(L,L.output,L.next_out,lt-L.avail_out)?(x.mode=31,-4):(bt-=L.avail_in,lt-=L.avail_out,L.total_in+=bt,L.total_out+=lt,x.total+=lt,x.wrap&&lt&&(L.adler=x.check=x.flags?a(x.check,Z,lt,L.next_out-lt):o(x.check,Z,lt,L.next_out-lt)),L.data_type=x.bits+(x.last?64:0)+(x.mode===12?128:0)+(x.mode===20||x.mode===15?256:0),(bt==0&&lt===0||N===4)&&ot===d&&(ot=-5),ot)},i.inflateEnd=function(L){if(!L||!L.state)return h;var N=L.state;return N.window&&(N.window=null),L.state=null,d},i.inflateGetHeader=function(L,N){var x;return L&&L.state&&2&(x=L.state).wrap?((x.head=N).done=!1,d):h},i.inflateSetDictionary=function(L,N){var x,B=N.length;return L&&L.state?(x=L.state).wrap!==0&&x.mode!==11?h:x.mode===11&&o(1,N,B,0)!==x.check?-3:V(L,N,B,B)?(x.mode=31,-4):(x.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,p,m,y,b){var k,T,A,C,R,S,U,I,D,V=b.bits,L=0,N=0,x=0,B=0,Z=0,$=0,st=0,nt=0,at=0,G=0,H=null,bt=0,lt=new s.Buf16(16),ht=new s.Buf16(16),Dt=null,re=0;for(L=0;L<=15;L++)lt[L]=0;for(N=0;N<h;N++)lt[f[d+N]]++;for(Z=V,B=15;1<=B&&lt[B]===0;B--);if(B<Z&&(Z=B),B===0)return p[m++]=20971520,p[m++]=20971520,b.bits=1,0;for(x=1;x<B&&lt[x]===0;x++);for(Z<x&&(Z=x),L=nt=1;L<=15;L++)if(nt<<=1,(nt-=lt[L])<0)return-1;if(0<nt&&(u===0||B!==1))return-1;for(ht[1]=0,L=1;L<15;L++)ht[L+1]=ht[L]+lt[L];for(N=0;N<h;N++)f[d+N]!==0&&(y[ht[f[d+N]]++]=N);if(S=u===0?(H=Dt=y,19):u===1?(H=o,bt-=257,Dt=a,re-=257,256):(H=c,Dt=l,-1),L=x,R=m,st=N=G=0,A=-1,C=(at=1<<($=Z))-1,u===1&&852<at||u===2&&592<at)return 1;for(;;){for(U=L-st,D=y[N]<S?(I=0,y[N]):y[N]>S?(I=Dt[re+y[N]],H[bt+y[N]]):(I=96,0),k=1<<L-st,x=T=1<<$;p[R+(G>>st)+(T-=k)]=U<<24|I<<16|D|0,T!==0;);for(k=1<<L-1;G&k;)k>>=1;if(k!==0?(G&=k-1,G+=k):G=0,N++,--lt[L]==0){if(L===B)break;L=f[d+y[N]]}if(Z<L&&(G&C)!==A){for(st===0&&(st=Z),R+=x,nt=1<<($=L-st);$+st<B&&!((nt-=lt[$+st])<=0);)$++,nt<<=1;if(at+=1<<$,u===1&&852<at||u===2&&592<at)return 1;p[A=G&C]=Z<<24|$<<16|R-m|0}}return G!==0&&(p[R+G]=L-st<<24|64<<16|0),b.bits=Z,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var Y=F.length;0<=--Y;)F[Y]=0}var l=0,u=29,f=256,d=f+1+u,h=30,p=19,m=2*d+1,y=15,b=16,k=7,T=256,A=16,C=17,R=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(d+2));c(V);var L=new Array(2*h);c(L);var N=new Array(512);c(N);var x=new Array(256);c(x);var B=new Array(u);c(B);var Z,$,st,nt=new Array(h);function at(F,Y,ct,ft,J){this.static_tree=F,this.extra_bits=Y,this.extra_base=ct,this.elems=ft,this.max_length=J,this.has_stree=F&&F.length}function G(F,Y){this.dyn_tree=F,this.max_code=0,this.stat_desc=Y}function H(F){return F<256?N[F]:N[256+(F>>>7)]}function bt(F,Y){F.pending_buf[F.pending++]=255&Y,F.pending_buf[F.pending++]=Y>>>8&255}function lt(F,Y,ct){F.bi_valid>b-ct?(F.bi_buf|=Y<<F.bi_valid&65535,bt(F,F.bi_buf),F.bi_buf=Y>>b-F.bi_valid,F.bi_valid+=ct-b):(F.bi_buf|=Y<<F.bi_valid&65535,F.bi_valid+=ct)}function ht(F,Y,ct){lt(F,ct[2*Y],ct[2*Y+1])}function Dt(F,Y){for(var ct=0;ct|=1&F,F>>>=1,ct<<=1,0<--Y;);return ct>>>1}function re(F,Y,ct){var ft,J,mt=new Array(y+1),xt=0;for(ft=1;ft<=y;ft++)mt[ft]=xt=xt+ct[ft-1]<<1;for(J=0;J<=Y;J++){var pt=F[2*J+1];pt!==0&&(F[2*J]=Dt(mt[pt]++,pt))}}function Ft(F){var Y;for(Y=0;Y<d;Y++)F.dyn_ltree[2*Y]=0;for(Y=0;Y<h;Y++)F.dyn_dtree[2*Y]=0;for(Y=0;Y<p;Y++)F.bl_tree[2*Y]=0;F.dyn_ltree[2*T]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Mt(F){8<F.bi_valid?bt(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function oe(F,Y,ct,ft){var J=2*Y,mt=2*ct;return F[J]<F[mt]||F[J]===F[mt]&&ft[Y]<=ft[ct]}function Wt(F,Y,ct){for(var ft=F.heap[ct],J=ct<<1;J<=F.heap_len&&(J<F.heap_len&&oe(Y,F.heap[J+1],F.heap[J],F.depth)&&J++,!oe(Y,ft,F.heap[J],F.depth));)F.heap[ct]=F.heap[J],ct=J,J<<=1;F.heap[ct]=ft}function Re(F,Y,ct){var ft,J,mt,xt,pt=0;if(F.last_lit!==0)for(;ft=F.pending_buf[F.d_buf+2*pt]<<8|F.pending_buf[F.d_buf+2*pt+1],J=F.pending_buf[F.l_buf+pt],pt++,ft===0?ht(F,J,Y):(ht(F,(mt=x[J])+f+1,Y),(xt=S[mt])!==0&&lt(F,J-=B[mt],xt),ht(F,mt=H(--ft),ct),(xt=U[mt])!==0&&lt(F,ft-=nt[mt],xt)),pt<F.last_lit;);ht(F,T,Y)}function Pe(F,Y){var ct,ft,J,mt=Y.dyn_tree,xt=Y.stat_desc.static_tree,pt=Y.stat_desc.has_stree,Tt=Y.stat_desc.elems,le=-1;for(F.heap_len=0,F.heap_max=m,ct=0;ct<Tt;ct++)mt[2*ct]!==0?(F.heap[++F.heap_len]=le=ct,F.depth[ct]=0):mt[2*ct+1]=0;for(;F.heap_len<2;)mt[2*(J=F.heap[++F.heap_len]=le<2?++le:0)]=1,F.depth[J]=0,F.opt_len--,pt&&(F.static_len-=xt[2*J+1]);for(Y.max_code=le,ct=F.heap_len>>1;1<=ct;ct--)Wt(F,mt,ct);for(J=Tt;ct=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Wt(F,mt,1),ft=F.heap[1],F.heap[--F.heap_max]=ct,F.heap[--F.heap_max]=ft,mt[2*J]=mt[2*ct]+mt[2*ft],F.depth[J]=(F.depth[ct]>=F.depth[ft]?F.depth[ct]:F.depth[ft])+1,mt[2*ct+1]=mt[2*ft+1]=J,F.heap[1]=J++,Wt(F,mt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(Pt,Yn){var O,g,_,M,j,Q,it=Yn.dyn_tree,jt=Yn.max_code,Se=Yn.stat_desc.static_tree,we=Yn.stat_desc.has_stree,Oe=Yn.stat_desc.extra_bits,ce=Yn.stat_desc.extra_base,zc=Yn.stat_desc.max_length,ph=0;for(M=0;M<=y;M++)Pt.bl_count[M]=0;for(it[2*Pt.heap[Pt.heap_max]+1]=0,O=Pt.heap_max+1;O<m;O++)zc<(M=it[2*it[2*(g=Pt.heap[O])+1]+1]+1)&&(M=zc,ph++),it[2*g+1]=M,jt<g||(Pt.bl_count[M]++,j=0,ce<=g&&(j=Oe[g-ce]),Q=it[2*g],Pt.opt_len+=Q*(M+j),we&&(Pt.static_len+=Q*(Se[2*g+1]+j)));if(ph!==0){do{for(M=zc-1;Pt.bl_count[M]===0;)M--;Pt.bl_count[M]--,Pt.bl_count[M+1]+=2,Pt.bl_count[zc]--,ph-=2}while(0<ph);for(M=zc;M!==0;M--)for(g=Pt.bl_count[M];g!==0;)jt<(_=Pt.heap[--O])||(it[2*_+1]!==M&&(Pt.opt_len+=(M-it[2*_+1])*it[2*_],it[2*_+1]=M),g--)}}(F,Y),re(mt,le,F.bl_count)}function v(F,Y,ct){var ft,J,mt=-1,xt=Y[1],pt=0,Tt=7,le=4;for(xt===0&&(Tt=138,le=3),Y[2*(ct+1)+1]=65535,ft=0;ft<=ct;ft++)J=xt,xt=Y[2*(ft+1)+1],++pt<Tt&&J===xt||(pt<le?F.bl_tree[2*J]+=pt:J!==0?(J!==mt&&F.bl_tree[2*J]++,F.bl_tree[2*A]++):pt<=10?F.bl_tree[2*C]++:F.bl_tree[2*R]++,mt=J,le=(pt=0)===xt?(Tt=138,3):J===xt?(Tt=6,3):(Tt=7,4))}function ot(F,Y,ct){var ft,J,mt=-1,xt=Y[1],pt=0,Tt=7,le=4;for(xt===0&&(Tt=138,le=3),ft=0;ft<=ct;ft++)if(J=xt,xt=Y[2*(ft+1)+1],!(++pt<Tt&&J===xt)){if(pt<le)for(;ht(F,J,F.bl_tree),--pt!=0;);else J!==0?(J!==mt&&(ht(F,J,F.bl_tree),pt--),ht(F,A,F.bl_tree),lt(F,pt-3,2)):pt<=10?(ht(F,C,F.bl_tree),lt(F,pt-3,3)):(ht(F,R,F.bl_tree),lt(F,pt-11,7));mt=J,le=(pt=0)===xt?(Tt=138,3):J===xt?(Tt=6,3):(Tt=7,4)}}c(nt);var et=!1;function P(F,Y,ct,ft){lt(F,(l<<1)+(ft?1:0),3),function(J,mt,xt,pt){Mt(J),bt(J,xt),bt(J,~xt),s.arraySet(J.pending_buf,J.window,mt,xt,J.pending),J.pending+=xt}(F,Y,ct)}i._tr_init=function(F){et||(function(){var Y,ct,ft,J,mt,xt=new Array(y+1);for(J=ft=0;J<u-1;J++)for(B[J]=ft,Y=0;Y<1<<S[J];Y++)x[ft++]=J;for(x[ft-1]=J,J=mt=0;J<16;J++)for(nt[J]=mt,Y=0;Y<1<<U[J];Y++)N[mt++]=J;for(mt>>=7;J<h;J++)for(nt[J]=mt<<7,Y=0;Y<1<<U[J]-7;Y++)N[256+mt++]=J;for(ct=0;ct<=y;ct++)xt[ct]=0;for(Y=0;Y<=143;)V[2*Y+1]=8,Y++,xt[8]++;for(;Y<=255;)V[2*Y+1]=9,Y++,xt[9]++;for(;Y<=279;)V[2*Y+1]=7,Y++,xt[7]++;for(;Y<=287;)V[2*Y+1]=8,Y++,xt[8]++;for(re(V,d+1,xt),Y=0;Y<h;Y++)L[2*Y+1]=5,L[2*Y]=Dt(Y,5);Z=new at(V,S,f+1,d,y),$=new at(L,U,0,h,y),st=new at(new Array(0),I,0,p,k)}(),et=!0),F.l_desc=new G(F.dyn_ltree,Z),F.d_desc=new G(F.dyn_dtree,$),F.bl_desc=new G(F.bl_tree,st),F.bi_buf=0,F.bi_valid=0,Ft(F)},i._tr_stored_block=P,i._tr_flush_block=function(F,Y,ct,ft){var J,mt,xt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(pt){var Tt,le=4093624447;for(Tt=0;Tt<=31;Tt++,le>>>=1)if(1&le&&pt.dyn_ltree[2*Tt]!==0)return o;if(pt.dyn_ltree[18]!==0||pt.dyn_ltree[20]!==0||pt.dyn_ltree[26]!==0)return a;for(Tt=32;Tt<f;Tt++)if(pt.dyn_ltree[2*Tt]!==0)return a;return o}(F)),Pe(F,F.l_desc),Pe(F,F.d_desc),xt=function(pt){var Tt;for(v(pt,pt.dyn_ltree,pt.l_desc.max_code),v(pt,pt.dyn_dtree,pt.d_desc.max_code),Pe(pt,pt.bl_desc),Tt=p-1;3<=Tt&&pt.bl_tree[2*D[Tt]+1]===0;Tt--);return pt.opt_len+=3*(Tt+1)+5+5+4,Tt}(F),J=F.opt_len+3+7>>>3,(mt=F.static_len+3+7>>>3)<=J&&(J=mt)):J=mt=ct+5,ct+4<=J&&Y!==-1?P(F,Y,ct,ft):F.strategy===4||mt===J?(lt(F,2+(ft?1:0),3),Re(F,V,L)):(lt(F,4+(ft?1:0),3),function(pt,Tt,le,Pt){var Yn;for(lt(pt,Tt-257,5),lt(pt,le-1,5),lt(pt,Pt-4,4),Yn=0;Yn<Pt;Yn++)lt(pt,pt.bl_tree[2*D[Yn]+1],3);ot(pt,pt.dyn_ltree,Tt-1),ot(pt,pt.dyn_dtree,le-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,xt+1),Re(F,F.dyn_ltree,F.dyn_dtree)),Ft(F),ft&&Mt(F)},i._tr_tally=function(F,Y,ct){return F.pending_buf[F.d_buf+2*F.last_lit]=Y>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&Y,F.pending_buf[F.l_buf+F.last_lit]=255&ct,F.last_lit++,Y===0?F.dyn_ltree[2*ct]++:(F.matches++,Y--,F.dyn_ltree[2*(x[ct]+f+1)]++,F.dyn_dtree[2*H(Y)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){lt(F,2,3),ht(F,T,V),function(Y){Y.bi_valid===16?(bt(Y,Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0):8<=Y.bi_valid&&(Y.pending_buf[Y.pending++]=255&Y.bi_buf,Y.bi_buf>>=8,Y.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},p=!1,m=o.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(o);y=y&&y.setTimeout?y:o,c={}.toString.call(o.process)==="[object process]"?function(A){Ir.nextTick(function(){k(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,C=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=C,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){k(A.data)},function(A){u.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(A){var C=m.createElement("script");C.onreadystatechange=function(){k(A),C.onreadystatechange=null,l.removeChild(C),C=null},l.appendChild(C)}):function(A){setTimeout(k,0,A)},y.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var C=new Array(arguments.length-1),R=0;R<C.length;R++)C[R]=arguments[R+1];var S={callback:A,args:C};return h[d]=S,c(d),d++},y.clearImmediate=b}function b(A){delete h[A]}function k(A){if(p)setTimeout(k,0,A);else{var C=h[A];if(C){p=!0;try{(function(R){var S=R.callback,U=R.args;switch(U.length){case 0:S();break;case 1:S(U[0]);break;case 2:S(U[0],U[1]);break;case 3:S(U[0],U[1],U[2]);break;default:S.apply(a,U)}})(C)}finally{b(A),p=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&k(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Cn<"u"?Cn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(IE);var z4=IE.exports,yp=so(z4);const NE={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(NE);var Or=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},pa,$c,io;class K4{constructor(...e){pa.set(this,new Map),$c.set(this,new Map),io.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Or(this,io,"f").has(r)||Or(this,io,"f").set(r,new Set);const s=Or(this,io,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Or(this,$c,"f").set(r,a),o=!1,c)continue;const l=Or(this,pa,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Or(this,pa,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Or(this,pa,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&Or(this,$c,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Or(this,io,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Or(this,io,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Or(this,pa,"f"),extensions:Or(this,$c,"f")}}}pa=new WeakMap,$c=new WeakMap,io=new WeakMap;var H4=new K4(NE)._freeze();function CE(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:if(t.endsWith(".xp"))return"application/rexpaint";break}return H4.getType(t)??"application/octet-stream"}async function W4(t,e,n){try{he(tt,t,"parsezipfile",e.name);const r=await e.arrayBuffer();(await new yp().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=CE(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{ue(tt,t,"crash",c.message)})})}catch(r){ue(tt,t,"crash",r.message)}}async function LE(t,e,n){try{he(tt,e,"parsebinaryfile",t.name);const r=await t.arrayBuffer();n(new Uint8Array(r))}catch(r){ue(tt,e,"crash",r.message)}}function ME(t,e){function n(r){if(E(e))switch(r){case"text/plain":e.text().then(i=>Pa(tt,t,void 0,"text",`file:${e.name}`,i)).catch(i=>ue(tt,t,"crash",i.message));break;case"application/json":e.text().then(i=>Pa(tt,t,void 0,"json",`file:${e.name}`,i)).catch(i=>ue(tt,t,"crash",i.message));break;case"application/zip":W4(t,e,i=>ME(t,i)).catch(i=>ue(tt,t,"crash",i.message));break;case"application/rexpaint":LE(e,t,i=>Pa(tt,t,void 0,"rexpaint",`file:${e.name}`,i)).catch(i=>ue(tt,t,"crash",i.message));break;case"application/octet-stream":LE(e,t,i=>Pa(tt,t,void 0,"binary",`file:${e.name}`,i)).catch(i=>ue(tt,t,"crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=CE(e.name,new Uint8Array(i));if(s)n(s);else return ue(tt,t,"parsewebfile",`unsupported file ${e.name}`)}).catch(i=>ue(tt,t,"crash",i.message));return}}n((e==null?void 0:e.type)??"")}function ma(t,e,n){function r(i){ue(t,e,"crash",i.message)}n().catch(r)}function G4(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function Y4(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const V4=new Date("1980/09/02");async function UE(t){return console.info("saved",t),new Promise((e,n)=>{const r=new yp;for(let i=0;i<t.length;++i){const s=t[i],o=JU(s);if(o){const a=ZI(o);E(a)&&r.file(s.id,a,{date:V4})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(Y4(i))}).catch(n)})}async function Z4(t){return new Promise((e,n)=>{const r=new yp;r.loadAsync(G4(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=QU(XI(c));E(l)&&i.push(l)}e(i)}).catch(n)})}function FE(t,e){return`${t.x},${t.y},${e.x},${e.y}`}let nn;function X4(){return!!nn}function q4(t,e,n){const r=Math.min(e.x,n.x),i=Math.min(e.y,n.y),s=Math.max(e.x,n.x),o=Math.max(e.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},p=me(t,{x:d,y:f});(p==null?void 0:p.category)===fr.ISOBJECT?(l.push(Zn(Ho(t,d,f))),is(p)!=="player"&&u.push({...Zn(p),...h,id:"blank"})):l.push({...Zn(p),...h})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}function J4(t,e,n,r){const i=lr(t);if(E(i))switch(nn=q4(i,e,n),r){case"copyobjects":nn.terrain=[];break;case"copyterrain":nn.objects=[];break}}function Q4(t,e,n){const r=FE(e,n);ee(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Ut(t,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Ut(t,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=hn(t);i.scroll=ur(t)}function tj(t,e,n,r){const i=lr(t);if(!E(i)||!E(nn))return;const s=Math.min(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.x,n.x),c=Math.max(e.y,n.y),l=a-s+1,u=c-o+1,f=Math.min(nn.width,l),d=Math.min(nn.height,u);switch(r){case"pasteall":{for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Fo({x:p,y:h},nn.width);ln(i,{...nn.terrain[m],x:s+p,y:o+h})}for(let h=0;h<nn.objects.length;++h){const p=nn.objects[h];E(p.x)&&E(p.y)&&Po(p.x,p.y,0,l-1,u-1,0)&&Ed(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let h=0;h<nn.objects.length;++h){const p=nn.objects[h];E(p.x)&&E(p.y)&&Po(p.x,p.y,0,l-1,u-1,0)&&Ed(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Fo({x:p,y:h},nn.width);ln(i,{...nn.terrain[m],x:s+p,y:o+h})}break;case"pasteterraintiled":for(let h=o;h<=c;++h)for(let p=s;p<=a;++p){const m=(p-s)%nn.width,y=(h-o)%nn.height,b=Fo({x:m,y},nn.width);ln(i,{...nn.terrain[b],x:p,y:h})}break}}function ej(t,e,n){const r=FE(e,n);ee(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Ut(t,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Ut(t,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Ut(t,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=hn(t);i.scroll=ur(t)}function fh(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function nj(t,e,n,r){const i=lr(t);if(!E(i))return;let s=0;function o(){return s}function a(l,u){At(u)&&(s=u,ny(e.x,e.y,n.x,n.y).forEach(f=>{const d=me(i,f);E(d)&&(d[l]=u)}))}ee(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,`batch:${fh(e,n)}`,"char",[r,"charedit"],o,a);const c=hn(t);c.scroll=ur(t)}function rj(t,e,n,r){const i=lr(t);if(!E(i))return;let s=0;function o(){return s}function a(l,u){if(At(u)){s=u;for(let f=e.y;f<=n.y;++f)for(let d=e.x;d<=n.x;++d){const h=me(i,{x:d,y:f});E(h)&&(h[l]=u)}}}ee(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,`batch:${fh(e,n)}`,"color",[r,"coloredit"],o,a);const c=hn(t);c.scroll=ur(t)}function ij(t,e,n,r){const i=lr(t);if(!E(i))return;let s=0;function o(){return s}function a(l,u){At(u)&&(s=u,ny(e.x,e.y,n.x,n.y).forEach(f=>{const d=me(i,f);E(d)&&(d[l]=u)}))}ee(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,`batch:${fh(e,n)}`,"color",[r,"coloredit"],o,a);const c=hn(t);c.scroll=ur(t)}const jc={stat:"",patternsize:2,mirror:1};function sj(t,e,n){const r=vn(Bt.MAIN);if(!E(r))return;const i=lr(t);if(!E(i))return;const s=fh(e,n);ee(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),X4()&&Ut(t,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),Ut(t,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(h){const{target:p}=Xn(h);return jc[p]}function a(h,p){if(At(p)||wt(p)){const{target:m}=Xn(h);jc[m]=p}}Ut(t,"batch","remix",[`stat:${s}`,"text"],o,a),Ut(t,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),Ut(t,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),Ut(t,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),ee(t,un),Ut(t,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),Ut(t,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),Ut(t,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),ee(t,un),Ut(t,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),ee(t,un),ee(t,"codepages:");const c=Math.min(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.x,n.x),f=Math.max(e.y,n.y),d=new Set;for(let h=l;h<=f;++h)for(let p=c;p<=u;++p){const m=me(i,{x:p,y:h}),y=hx(r,m);E(y)&&!d.has(y.id)&&(d.add(y.id),Ut(t,"batch",`edit @${We(y)}`,[`pageopen:${y.id}`]))}}function bp(t,e){return`inspect:${e!=null&&e.id?e.id:Ur(t,e)}`}function oj(t,e,n){const r=vn(Bt.MAIN);if(!E(r))return;const i=lr(t);if(!E(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){E(e)&&(e[d]=h)}const a=e.category===fr.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=bp(i,e);ee(t,`${a}: ${c} ${l}`),ee(t,un),Ut(t,u,"color",[n,"coloredit"],s,o);const f=hn(t);f.scroll=ur(t)}function aj(t,e,n){const r=vn(Bt.MAIN);if(!E(r))return;const i=lr(t);if(!E(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){E(e)&&(e[d]=h)}const a=e.category===fr.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=bp(i,e);ee(t,`${a}: ${c} ${l}`),ee(t,un),Ut(t,u,"char",[n,"charedit"],s,o);const f=hn(t);f.scroll=ur(t)}function cj(t,e,n,r,i,s){var f,d,h;function o(p){var y;const m=(r==null?void 0:r[p])??((y=r==null?void 0:r.kinddata)==null?void 0:y[p]);if(!E(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return $t.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){E(r)&&(r[p]=m)}s?ee(t,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ee(t,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ee(t,un);const c=bp(e,r);s?(Ut(t,c,"cycle",["cycle","number","1","255"],o,a),Ut(t,c,"collision",["collision","select","iswalking",`${$t.ISWALK}`,"isswimming",`${$t.ISSWIM}`],o,a)):Ut(t,c,"collision",["collision","select","iswalkable",`${$t.ISWALK}`,"isswimable",`${$t.ISSWIM}`,"issolid",`${$t.ISSOLID}`],o,a),s&&Ut(t,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Ut(t,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const l=Oc(n),u=hr(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ae(l[m])){const[y,b,...k]=l[m];wt(b)&&Ut(t,c,b||m,[m,y,...k],o,a)}break}}Ut(t,c,"copy coords",["copycoords","hk","5"," 5 "]),ee(t,un),Ut(t,c,`char: ${r.char??((f=r.kinddata)==null?void 0:f.char)??1}`,["char","hk","a"," A ","next"],o,a),Ut(t,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),Ut(t,c,`bg: ${r.bg??((h=r.kinddata)==null?void 0:h.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ee(t,un),Ut(t,c,"make empty",["empty","hk","0"],o,a),ee(t,un),Ut(t,"batch",`edit @${We(n)}`,[`pageopen:${n.id}`])}function lj(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function uj(t,e,n,r){const i=vn(Bt.MAIN);if(!E(i))return;const s=lr(t);if(E(s))switch(r){case"emptyall":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=me(s,{x:a,y:o});(c==null?void 0:c.category)===fr.ISOBJECT&&or(i,s,c,i.timestamp),ln(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=me(s,{x:a,y:o});(c==null?void 0:c.category)===fr.ISOBJECT&&or(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a)ln(s,{x:a,y:o});break}}}function hj(t,e,n){const r=lj(e,n);ee(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Ut(t,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Ut(t,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=hn(t);i.scroll=ur(t)}function fj(t,e,n){const r=vn(Bt.MAIN);if(!E(r))return;const i=lr(t);if(!E(i))return;if(Ge(r,i),e.x===n.x&&e.y===n.y){const o=me(i,e),a=hx(r,o);E(o)&&E(a)&&cj(t,i,a,o,e,wn(o)),o!=null&&o.kind||(ee(t,`empty: ${e.x}, ${e.y}`),ee(t,un),Ut(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]))}else sj(t,e,n);const s=hn(t);s.scroll=ur(t)}function dj(t,e){const n=be(Bt.MAIN);if(!E(n))return;const r=lr(e);if(!E(r))return;const i=Xn(t),s=tN(r,i.target);if(E(s))switch(i.path){case"copycoords":nf(tt,cr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":oj(e,s,i.path);break;case"char":aj(e,s,i.path);break;case"empty":or(n,r,s,n.timestamp);break;case"code":ma(tt,e,async()=>{const o=is(s),a="object";he(tt,e,`opened [${a}] ${o}`);const c=[r.id,s.id];td(il(n.id,c),s.code??""),LA(tt,e),await cg(800),sg(tt,e,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}function pj(t,e){const n=lr(e);if(!E(n))return;const r=Xn(t),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":Q4(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":J4(e,c,l,r.target);break;case"paste":ej(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":tj(e,c,l,r.target);break;case"empty":hj(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":uj(e,c,l,r.target);break;case"chars":nj(e,c,l,"char");break;case"colors":rj(e,c,l,"color");break;case"bgs":ij(e,c,l,"bg");break;case"copycoords":nf(tt,e,[i,s,o,a].join(" "));break;case"remixrun":{const u=zn(w.book,_t.BOARD,jc.stat),f=Te(...u);E(f)&&Vx(n.id,f.id,jc.patternsize,jc.mirror,c,l,"all");break}case"pageopen":ma(tt,e,async()=>{await cg(800),QA(tt,e,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const mj=16,Es={},dh={},gj=60;let PE=0;const ga={},_a={};async function BE(t){const e=la(),n=be(Bt.MAIN);if(e.length&&E(n)){const r=await UE(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;UA(se,cr(),i,r)}}async function _j(){const t=la(),e=be(Bt.MAIN);if(t.length&&E(e)){const n=await UE(t);FA(se,cr(),n)}}const se=ao("vm",["tick","second"],t=>{var n;if(!se.session(t))return;const e=cr();switch(t.target){case"operator":_4(t.player),he(se,t.player,`operator set to ${t.player}`),se.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=be(Bt.MAIN);se.replynext(t,"ackzsswords",{cli:ip(bs.CLI),loader:ip(bs.LOADER),runtime:ip(bs.RUNTIME),flags:[...hr(Sr(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...Js(r,_t.OBJECT).map(i=>We(i)),...hr(Q0)],altkinds:[...Js(r,_t.TERRAIN),...Js(r,_t.BOARD),...Js(r,_t.PALETTE),...Js(r,_t.CHARSET),...Js(r,_t.LOADER)].map(i=>We(i)),colors:[...hr(tc)],dirs:[...hr(od).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...hr(tp)]});break}case"books":t.player===e&&ma(se,t.player,async()=>{if(ae(t.data)){const[r,i]=t.data,s=await Z4(r),o=s.map(a=>a.name);v4(s,i),he(se,t.player,`loading ${o.join(", ")}`),ef(se,t.player)}});break;case"search":A4(t.player)||ef(se,t.player);break;case"logout":T4(t.player),delete Es[t.player],he(se,e,`player ${t.player} logout`),ef(se,t.player);break;case"login":EE(t.player)?(Es[t.player]=0,he(se,cr(),`login from ${t.player}`),se.replynext(t,"acklogin",!0)):ng(se,t.player);break;case"local":EE(t.player)?(Es[t.player]=0,he(se,cr(),`login from ${t.player}`)):ng(se,t.player);break;case"doot":Es[t.player]=0,dh[t.player]=dh[t.player]??0,dh[t.player]%32===0&&he(se,t.player,`$whiteactive $blue${t.player}`),++dh[t.player];break;case"input":{if(t.player.includes("local")&&!wE(t.player)&&JA(se,t.player),!t.player.includes("local")||wE(t.player)){const r=Sr(t.player),[i=Sn.NONE,s=0]=t.data??[Sn.NONE,0];ae(r.inputqueue)||(r.inputqueue=[]),i!==Sn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ae(t.data)){const[r,i]=t.data,s=il(r,i);E(_a[s])||(_a[s]=ty(s,o=>{const[a,c]=i,l=zr(r),u=Bi(l,a);if(E(u))if(Pi(u)===_t.BOARD&&E(c)){const f=Ce(u),d=Rn(f,c);E(d)&&(d.code=o,M0(ax(o),d))}else u.code=o,qU(u)})),ga[s]=ga[s]??new Set,ga[s].add(t.player)}break;case"coderelease":if(ae(t.data)){const[r,i]=t.data,[,s]=i,o=il(r,i);E(ga[o])&&(ga[o].delete(t.player),ga[o].size===0&&((n=_a[o])==null||n.call(_a),_a[o]=void 0,wt(s)&&I4(s)))}break;case"halt":t.player===e&&Ev(t.data)&&y4(t.data);break;case"tick":b4()||C4();break;case"synthsend":wt(t.data)&&mp(t.data,void 0);break;case"second":{R4(Es);const r=Object.keys(Es);for(let i=0;i<r.length;++i)++Es[r[i]];for(let i=0;i<r.length;++i){const s=r[i];Es[s]>=mj&&og(se,s)}++PE>=gj&&(PE=0,ma(se,t.player,async()=>{await BE(!0)}));break}case"copyjsonfile":if(t.player===e){const r=be(Bt.MAIN);if(E(r)&&ae(t.data)){const[i]=t.data,s=Bi(r,i);E(s)&&PA(se,e,s,`${We(s)}.${fs(s)}.json`)}}break;case"refscroll":{ee(t.player,"stat refs"),ee(t.player,un),Ut(t.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Ut(t.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]);const r=hn(t.player);r.scroll=ur(t.player);break}case"fork":t.player===e&&ma(se,t.player,async()=>{await _j()});break;case"flush":t.player===e&&ma(se,t.player,async()=>{await BE()});break;case"cli":TE(t.player,t.data);break;case"clirepeatlast":L4(t.player);break;case"restart":t.player===e&&(N4(),ag(se,t.player));break;case"inspect":if(ae(t.data)){const[r,i]=t.data;fj(t.player,r,i)}break;case"loader":if(ae(t.data)){const[r,i,s,o]=t.data;if(i==="file")ME(t.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){he(se,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=be(Bt.MAIN);E(c)&&E(a.data)&&wt(a.exported)&&(pp(a.data),he(se,t.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){he(se,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=be(Bt.MAIN);E(c)&&E(a.data)&&wt(a.exported)&&(fx(c,a.data),he(se,t.player,`loaded ${a.exported}`))}else B$(r,i,s,o,t.player)}break;default:{const{target:r,path:i}=Xn(t.target);switch(It(r)){case"refscroll":switch(i){case"charscroll":{Ut(t.player,"refscroll","char",["char","charedit"]);const s=hn(t.player);s.scroll=ur(t.player);break}case"colorscroll":{Ut(t.player,"refscroll","color",["color","coloredit"]);const s=hn(t.player);s.scroll=ur(t.player);break}}break;case"batch":pj(i,t.player);break;case"empty":{const s=Xn(i);switch(s.target){case"copycoords":nf(se,cr(),s.path.split(",").join(" "));break}break}case"inspect":dj(i,t.player);break;case"touched":if(ae(t.data)){const[s,o,a]=t.data;vE({...t,target:`${s}:${a}`,data:void 0,sender:o})}break;default:vE(t);break}break}}},g4());function yj(){MA(se)}const{forward:bj}=oR(t=>{aR(t)&&postMessage(t)});onmessage=function(e){bj(e.data)},setTimeout(yj,100)})();

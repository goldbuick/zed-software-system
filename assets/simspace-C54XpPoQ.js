var yM=Object.defineProperty;var _M=(or,Te,Pt)=>Te in or?yM(or,Te,{enumerable:!0,configurable:!0,writable:!0,value:Pt}):or[Te]=Pt;var ye=(or,Te,Pt)=>_M(or,typeof Te!="symbol"?Te+"":Te,Pt);(function(){"use strict";const or=new Set,Te={emit(t,e,n,r){Te.invoke(K_(t,e,n,r))},invoke(t){or.forEach(e=>e.handle(t))},connect(t){or.add(t)},disconnect(t){or.delete(t)}};var Pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ii(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function N_(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Hf={};(function(t){var e=Pt&&Pt.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,p;d<h;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,b=l.addAdverb,_=b===void 0?!1:b,w=e(e(e([],e([],Array(m),!0).map(function(v){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),_?[n(t.adverbs)]:[],!0);return h&&(w=w.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),w.join(f)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return t.adjectives.length*f*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*f+f*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(h?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*f+f*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(h?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(Hf);var C_=Ii(Hf);const L_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let M_=t=>crypto.getRandomValues(new Uint8Array(t)),U_=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Vf=(t,e=21)=>U_(t,e,M_),P_=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=L_[n[t]&63];return e};var Kf="abcdefghijklmnopqrstuvwxyz",qf="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Jf="0123456789",D_="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",B_="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const F_=Jf,$_=Kf,j_=qf;var z_=F_+$_+j_,Nc={lowercase:Kf,uppercase:qf,numbers:Jf,nolookalikes:D_,nolookalikesSafe:B_,alphanumeric:z_};function ht(){return`sid_${P_(12).replaceAll("-",".")}`}const W_=Vf(Nc.numbers,4),G_=Vf(`${Nc.numbers}${Nc.lowercase}`,16);function H_(){return`pid_${W_()}_${G_()}`}function Xf(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function V_(){return C_({capitalize:!1,adjectiveCount:1})}var be=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t[t.ONSHADOW=33]="ONSHADOW",t[t.ONBORROW=34]="ONBORROW",t))(be||{}),Ye=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Ye||{}),To=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(To||{}),ae=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t))(ae||{}),fe=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.LINK=11]="LINK",t[t.HOTKEY=12]="HOTKEY",t[t.SCROLL=13]="SCROLL",t[t.COPYIT=14]="COPYIT",t))(fe||{});function Pe(t){return t.toLowerCase().trim()}function K_(t,e,n,r){return{id:ht(),target:t,sender:e,data:n,player:r}}function Zf(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function us(t,e,n){const r=ht(),i=Pe(t),s=e.map(Pe),o={id(){return r},name(){return t},topics(){return e},emit(a,c,l){Te.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=Zf(a.target),u=Pe(c);s.findIndex(f=>f==="all"||f===u)!==-1&&n(a),(r===c||u==="all"||i===u)&&n({...a,target:l})}};return Te.connect(o),o}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var q_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),J_=Object.prototype.hasOwnProperty;function Cc(t,e){return J_.call(t,e)}function Lc(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)Cc(t,i)&&r.push(i);return r}function Vt(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Mc(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Zr(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Yf(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Uc(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(Uc(t[e]))return!0}else if(typeof t=="object"){for(var r=Lc(t),i=r.length,s=0;s<i;s++)if(Uc(t[r[s]]))return!0}}return!1}function Qf(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var eh=function(t){q_(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,Qf(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Qf(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),st=eh,X_=Vt,Oi={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=xo(n,this.path);r&&(r=Vt(r));var i=Yr(n,{op:"remove",path:this.from}).removed;return Yr(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=xo(n,this.from);return Yr(n,{op:"add",path:this.path,value:Vt(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:fs(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},Z_={add:function(t,e,n){return Mc(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Oi.move,copy:Oi.copy,test:Oi.test,_get:Oi._get};function xo(t,e){if(e=="")return t;var n={op:"_get",path:e};return Yr(t,n),n.value}function Yr(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):Ro(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=xo(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=fs(t,e.value),o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new st("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Vt(t));var a=e.path||"",c=a.split("/"),l=t,u=1,f=c.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=Ro;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Yf(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!Mc(h))throw new st("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);Mc(h)&&(h=~~h)}if(u>=f){if(n&&e.op==="add"&&h>l.length)throw new st("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=Z_[e.op].call(e,l,h,t);if(o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=f){var o=Oi[e.op].call(e,l,h,t);if(o.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new st("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function Pc(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new st("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Vt(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Yr(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function Y_(t,e,n){var r=Yr(t,e);if(r.test===!1)throw new st("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Ro(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new st("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Oi[t.op]){if(typeof t.path!="string")throw new st("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new st('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new st("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new st("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Uc(t.value))throw new st("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new st("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new st("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=th([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new st("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new st("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function th(t,e,n){try{if(!Array.isArray(t))throw new st("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Pc(Vt(e),Vt(t),n||!0);else{n=n||Ro;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof st)return i;throw i}}function fs(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!fs(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!fs(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var Q_=Object.freeze({__proto__:null,JsonPatchError:st,_areEquals:fs,applyOperation:Yr,applyPatch:Pc,applyReducer:Y_,deepClone:X_,getValueByPointer:xo,validate:th,validator:Ro});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Dc=new WeakMap,eb=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),tb=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function nb(t){return Dc.get(t)}function rb(t,e){return t.observers.get(e)}function ib(t,e){t.observers.delete(e.callback)}function sb(t,e){e.unobserve()}function ob(t,e){var n=[],r,i=nb(t);if(!i)i=new eb(t),Dc.set(t,i);else{var s=rb(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Vt(t),e){r.callback=e,r.next=null;var o=function(){Bc(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){Bc(r),clearTimeout(r.next),ib(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new tb(e,r)),r}function Bc(t,e){e===void 0&&(e=!1);var n=Dc.get(t.object);Fc(n.value,t.object,t.patches,"",e),t.patches.length&&Pc(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function Fc(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Lc(e),o=Lc(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(Cc(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?Fc(u,f,n,r+"/"+Zr(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+Zr(l),value:Vt(u)}),n.push({op:"replace",path:r+"/"+Zr(l),value:Vt(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+Zr(l),value:Vt(u)}),n.push({op:"remove",path:r+"/"+Zr(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Cc(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+Zr(l),value:Vt(e[l])})}}}function nh(t,e,n){n===void 0&&(n=!1);var r=[];return Fc(t,e,r,"",n),r}var ab=Object.freeze({__proto__:null,compare:nh,generate:Bc,observe:ob,unobserve:sb});Object.assign({},Q_,ab,{JsonPatchError:eh,deepClone:Vt,escapePathComponent:Zr,unescapePathComponent:Yf});var cb=typeof Element<"u",lb=typeof Map=="function",ub=typeof Set=="function",fb=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Io(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Io(t[r],e[r]))return!1;return!0}var s;if(lb&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Io(r.value[1],e.get(r.value[0])))return!1;return!0}if(ub&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(fb&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(cb&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Io(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var hb=function(e,n){try{return Io(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},db=Ii(hb);function k(t){return t!=null}const pb=Object.keys;function hs(t){return Vt(t)}function ke(t){return typeof t=="number"&&isNaN(t)===!1}function Se(t){return typeof t=="string"}function He(t){return Array.isArray(t)}function mb(t){return t}function gb(t){return k(t)&&typeof t=="object"&&Se(t.id)&&Se(t.target)&&Se(t.sender)}function yb(t){const e=new Set;function n(s){gb(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Te.invoke(s))}const r=us("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Te.disconnect(r)}return{forward:n,disconnect:i}}const $c=66.666,Oo=Math.round(1e3/$c),_b=3;function bb(){return location.href.includes("/join/")}function wb(){return location.href.includes("/locked/")}const jc=us("clock",[],()=>{});let zc=0,No=0,Wc=0,rh=performance.now();function ih(){const t=performance.now(),e=t-rh,n=wb()?"locked":"";Wc+=e,Wc>=$c&&(Wc%=$c,jc.emit("tick",No,n),jc.emit("tock",No,n),++zc,++No,zc>=Oo&&(zc%=Oo,jc.emit("second",No,n))),rh=t,setTimeout(ih,1)}ih();var sh={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(t){(function(){var e=function(h,p){return p=p||"",h.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=e("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+e("DF-F6,F8-FF","00"),i="A-Z"+e("C0-D6,D8-DE","00"),s="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(h,p,m,b){return h=h||n,p=p||r,m=m||i,b=b||s,{capitalize:new RegExp("(^|["+h+"])(["+p+"])","g"),pascal:new RegExp("(^|["+h+"])+(["+p+m+"])","g"),fill:new RegExp("["+h+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+b+")\\b","g"),relax:new RegExp("([^"+m+"])(["+m+"]*)(["+m+"])(?=[^"+m+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+h+"]")}},a=o(),c={re:a,unicodes:e,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(h){return c.up.call(h.charAt(0))+h.slice(1)},decap:function(h){return c.low.call(h.charAt(0))+h.slice(1)},deapostrophe:function(h){return h.replace(a.apostrophe,"")},fill:function(h,p,m){return p!=null&&(h=h.replace(a.fill,function(b,_){return _?p+_:""})),m&&(h=c.deapostrophe(h)),h},prep:function(h,p,m,b){if(h=h==null?"":h+"",!b&&a.upper.test(h)&&(h=c.low.call(h)),!p&&!a.hole.test(h)){var _=c.fill(h," ");a.hole.test(_)&&(h=_)}return!m&&!a.room.test(h)&&(h=h.replace(a.relax,c.relax)),h},relax:function(h,p,m,b){return p+" "+(m?m+" ":"")+b}},l={_:c,of:function(h){for(var p=0,m=c.types.length;p<m;p++)if(l[c.types[p]].apply(l,arguments)===h)return c.types[p]},flip:function(h){return h.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(h){return h.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(h,p){l[h]=p,c.types.push(h)}},u={lower:function(h,p,m){return c.fill(c.low.call(c.prep(h,p)),p,m)},snake:function(h){return l.lower(h,"_",!0)},constant:function(h){return l.upper(h,"_",!0)},camel:function(h){return c.decap(l.pascal(h))},kebab:function(h){return l.lower(h,"-",!0)},upper:function(h,p,m){return c.fill(c.up.call(c.prep(h,p,!1,!0)),p,m)},capital:function(h,p,m){return c.fill(c.prep(h).replace(a.capitalize,function(b,_,w){return _+c.up.call(w)}),p,m)},header:function(h){return l.capital(h,"-",!0)},pascal:function(h){return c.fill(c.prep(h,!1,!0).replace(a.pascal,function(p,m,b){return c.up.call(b)}),"",!0)},title:function(h){return l.capital(h).replace(a.improper,function(p,m,b,_){return b>0&&b<_.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(h,p,m){return h=l.lower(h).replace(a.sentence,function(b,_,w){return _+c.up.call(w)}),p&&p.forEach(function(b){h=h.replace(new RegExp("\\b"+l.lower(b)+"\\b","g"),c.cap)}),m&&m.forEach(function(b){h=h.replace(new RegExp("(\\b"+l.lower(b)+"\\. +)(\\w)"),function(_,w,v){return w+c.low.call(v)})}),h}};u.squish=u.pascal,l.default=l;for(var f in u)l.type(f,u[f]);var d=typeof d=="function"?d:function(){};d(t.exports?t.exports=l:this.Case=l)}).call(Pt)})(sh);var vb=sh.exports,Eb=Ii(vb);function ds(){return ds=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ds.apply(this,arguments)}function kb(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Gc(t,e)}function Gc(t,e){return Gc=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Gc(t,e)}function Sb(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var oh=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[yt].connections.iterate.delete(r),i.byKey.forEach(function(o){s[yt].connections.byKey.get(o).delete(r)})}),this.observing.clear()},t}(),Qr=[],Co=function(t){kb(e,t);function e(r,i,s){var o;if(o=t.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){Qr.push(Sb(o));try{o.func()}finally{Qr.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=e.prototype;return n._trigger=function(){if(Qr.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(oh);function ah(){return!!Qr.length}function ch(){return Qr.length?Qr[Qr.length-1]:void 0}function Ab(t,e,n){var r=ds({name:"unnamed",fireImmediately:!0},n),i=new Co(t,r,e);return i}var Lo=0;function lh(){return Lo>0}function Hc(t){Lo++;try{return t()}finally{Lo--,Lo===0&&xb()}}var Vc=!1;function uh(){return Vc}function fh(t){Vc=!0;try{t()}finally{Vc=!1}}function Tb(t){return function(){return fh(t)}}var Kc=[];function xb(){var t=[].concat(Kc);Kc=[],hh(t)}function hh(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[yt].connections.iterate.forEach(function(i){e.add(i)}),(r=n.observable[yt].connections.byKey.get(n.key))==null||r.forEach(function(i){e.add(i)})}),e.forEach(function(n){n.trigger()})}function Mo(t){if(lh()){Kc.push(t);return}hh([t])}function dh(t,e){if(t.type==="iterate")t.observable[yt].connections.iterate.add(e);else{var n=t.observable[yt].connections.byKey.get(t.key);n||(n=new Set,t.observable[yt].connections.byKey.set(t.key,n)),n.add(e)}}function Uo(t,e){if(!uh()){var n=ch();n&&(dh(t,n),n.registerConnection(t)),e&&(dh(t,e),e.registerConnection(t))}}var qc=Symbol("$skipreactive"),yt=Symbol("$reactive"),cn=Symbol("$reactiveproxy");function ps(t,e){return!!(t&&t[cn]&&t[cn].implicitObserver===e)}function Jc(t){return t[qc]=!0,t}function ph(t){return!!(t&&!ps(t)&&t[yt])}function Xc(t,e,n){if(n===void 0&&(n=!1),t[qc]||ps(t,e))return t;var r=Rb(t,n);if(!e)return r;var i=r[yt].proxiesWithImplicitObserver.get(e);if(!i){var s={implicitObserver:e};Object.setPrototypeOf(s,mh),i=new Proxy(r[yt].raw,s),r[yt].proxiesWithImplicitObserver.set(e,i)}return i}var ms=Xc;function Rb(t,e){if(e===void 0&&(e=!1),ps(t))return t;if(ph(t))return t[yt].proxy;if(t[yt]||t[cn])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,yt,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,mh);return n.proxy=r,r}var mh={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||Uo({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===cn)return{implicitObserver:this.implicitObserver};var i=Reflect.get(e,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(e)?Uo({observable:e,type:"iterate"},this.implicitObserver):Uo({observable:e,key:n,type:"get"},this.implicitObserver),ph(i))return Xc(i,this.implicitObserver);if(e[yt].shallow)return i;if(typeof i=="object"&&i!==null&&!ps(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(e,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(ah()||this.implicitObserver))return Xc(i,this.implicitObserver)}return i},ownKeys:function(e){return Uo({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,i){return Hc(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,i);var s=Object.hasOwnProperty.call(e,n),o=Reflect.get(e,n,i),a=Reflect.set(e,n,r,i);if(!s)Mo({observable:e,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)Mo({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else Mo({observable:e,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,n){return Hc(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),i=Reflect.get(e,n),s=Reflect.deleteProperty(e,n);return r&&Mo({observable:e,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function Ib(t,e){var n=ds({name:"unnamed",fireImmediately:!0},e),r=new Co(t,n);return r}function Ob(t,e,n){var r=ds({name:"unnamed",fireImmediately:!0},n),i=new Co(function(){t(e)},r);return e=ms(e,i),r.fireImmediately&&i.trigger(),i}var gh=function(){function t(){this._observable=ms({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return ms(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function Nb(t,e,n){return new gh}var Cb=Object.freeze({__proto__:null,$reactive:yt,$reactiveproxy:cn,$skipreactive:qc,Atom:gh,Observer:oh,Reaction:Co,autorun:Ib,autorunAsync:Ob,createAtom:Nb,hasRunningReaction:ah,isActionRunning:lh,isReactive:ps,isTrackingDisabled:uh,markRaw:Jc,reaction:Ab,reactive:ms,runInAction:Hc,runningReaction:ch,untracked:fh,untrackedCB:Tb});const An=()=>new Map,Zc=t=>{const e=An();return t.forEach((n,r)=>{e.set(r,n)}),e},Nr=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Lb=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},Mb=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Ni=()=>new Set,Yc=t=>t[t.length-1],Ub=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Cr=Array.from,Pb=Array.isArray;class Db{constructor(){this._observers=An()}on(e,n){return Nr(this._observers,e,Ni).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Cr((this._observers.get(e)||An()).values()).forEach(r=>r(...n))}destroy(){this._observers=An()}}const Lr=Math.floor,Po=Math.abs,yh=(t,e)=>t<e?t:e,ei=(t,e)=>t>e?t:e,_h=t=>t!==0?t<0:1/t<0,bh=1,wh=2,Qc=4,el=8,gs=32,ar=64,tn=128,Do=31,tl=63,ti=127,Bb=2147483647,vh=Number.MAX_SAFE_INTEGER,Fb=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Lr(t)===t),$b=t=>t.toLowerCase(),jb=/^\s*/g,zb=t=>t.replace(jb,""),Wb=/([A-Z])/g,Eh=(t,e)=>zb(t.replace(Wb,n=>`${e}${$b(n)}`)),Gb=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},ys=typeof TextEncoder<"u"?new TextEncoder:null,Hb=ys?t=>ys.encode(t):Gb;let _s=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});_s&&_s.decode(new Uint8Array).length===1&&(_s=null);class bs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Mr=()=>new bs,Vb=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Tn=t=>{const e=new Uint8Array(Vb(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},Kb=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(ei(n,e)*2),t.cpos=0)},St=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},nl=St,ve=(t,e)=>{for(;e>ti;)St(t,tn|ti&e),e=Lr(e/128);St(t,ti&e)},rl=(t,e)=>{const n=_h(e);for(n&&(e=-e),St(t,(e>tl?tn:0)|(n?ar:0)|tl&e),e=Lr(e/64);e>0;)St(t,(e>ti?tn:0)|ti&e),e=Lr(e/128)},il=new Uint8Array(3e4),qb=il.length/3,Jb=(t,e)=>{if(e.length<qb){const n=ys.encodeInto(e,il).written||0;ve(t,n);for(let r=0;r<n;r++)St(t,il[r])}else Mt(t,Hb(e))},Xb=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ve(t,r);for(let i=0;i<r;i++)St(t,n.codePointAt(i))},Ci=ys&&ys.encodeInto?Jb:Xb,Bo=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=yh(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ei(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Mt=(t,e)=>{ve(t,e.byteLength),Bo(t,e)},sl=(t,e)=>{Kb(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Zb=(t,e)=>sl(t,4).setFloat32(0,e,!1),Yb=(t,e)=>sl(t,8).setFloat64(0,e,!1),Qb=(t,e)=>sl(t,8).setBigInt64(0,e,!1),kh=new DataView(new ArrayBuffer(4)),ew=t=>(kh.setFloat32(0,t),kh.getFloat32(0)===t),ws=(t,e)=>{switch(typeof e){case"string":St(t,119),Ci(t,e);break;case"number":Fb(e)&&Po(e)<=Bb?(St(t,125),rl(t,e)):ew(e)?(St(t,124),Zb(t,e)):(St(t,123),Yb(t,e));break;case"bigint":St(t,122),Qb(t,e);break;case"object":if(e===null)St(t,126);else if(Pb(e)){St(t,117),ve(t,e.length);for(let n=0;n<e.length;n++)ws(t,e[n])}else if(e instanceof Uint8Array)St(t,116),Mt(t,e);else{St(t,118);const n=Object.keys(e);ve(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ci(t,i),ws(t,e[i])}}break;case"boolean":St(t,e?120:121);break;default:St(t,127)}};class Sh extends bs{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ve(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Ah=t=>{t.count>0&&(rl(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ve(t.encoder,t.count-2))};class Fo{constructor(){this.encoder=new bs,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Ah(this),this.count=1,this.s=e)}toUint8Array(){return Ah(this),Tn(this.encoder)}}const Th=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);rl(t.encoder,e),t.count>1&&ve(t.encoder,t.count-2)}};class ol{constructor(){this.encoder=new bs,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Th(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Th(this),Tn(this.encoder)}}class tw{constructor(){this.sarr=[],this.s="",this.lensE=new Fo}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new bs;return this.sarr.push(this.s),this.s="",Ci(e,this.sarr.join("")),Bo(e,this.lensE.toUint8Array()),Tn(e)}}const Ur=t=>new Error(t),Dn=()=>{throw Ur("Method unimplemented")},Bn=()=>{throw Ur("Unexpected case")},xh=Ur("Unexpected end of array"),Rh=Ur("Integer out of Range");class $o{constructor(e){this.arr=e,this.pos=0}}const ni=t=>new $o(t),nw=t=>t.pos!==t.arr.length,rw=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Dt=t=>rw(t,Ee(t)),Li=t=>t.arr[t.pos++],Ee=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&ti)*n,n*=128,i<tn)return e;if(e>vh)throw Rh}throw xh},al=t=>{let e=t.arr[t.pos++],n=e&tl,r=64;const i=(e&ar)>0?-1:1;if(!(e&tn))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&ti)*r,r*=128,e<tn)return i*n;if(n>vh)throw Rh}throw xh},Mi=_s?t=>_s.decode(Dt(t)):t=>{let e=Ee(t);if(e===0)return"";{let n=String.fromCodePoint(Li(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Li(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},cl=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},iw=[t=>{},t=>null,al,t=>cl(t,4).getFloat32(0,!1),t=>cl(t,8).getFloat64(0,!1),t=>cl(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Mi,t=>{const e=Ee(t),n={};for(let r=0;r<e;r++){const i=Mi(t);n[i]=vs(t)}return n},t=>{const e=Ee(t),n=[];for(let r=0;r<e;r++)n.push(vs(t));return n},Dt],vs=t=>iw[127-Li(t)](t);class Ih extends $o{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),nw(this)?this.count=Ee(this)+1:this.count=-1),this.count--,this.s}}class jo extends $o{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=al(this);const e=_h(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ee(this)+2)}return this.count--,this.s}}class ll extends $o{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=al(this),n=e&1;this.diff=Lr(e/2),this.count=1,n&&(this.count=Ee(this)+2)}return this.s+=this.diff,this.count--,this.s}}class sw{constructor(e){this.decoder=new jo(e),this.str=Mi(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const ow=crypto.getRandomValues.bind(crypto),Oh=()=>ow(new Uint32Array(1))[0],aw="10000000-1000-4000-8000"+-1e11,cw=()=>aw.replace(/[018]/g,t=>(t^Oh()&15>>t/4).toString(16)),Nh=t=>new Promise(t);Promise.all.bind(Promise);const Ch=t=>t===void 0?null:t;class lw{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Lh=new lw,uw=!0;try{typeof localStorage<"u"&&localStorage&&(Lh=localStorage,uw=!1)}catch{}const fw=Lh,hw=Object.assign,dw=Object.keys,pw=(t,e)=>{for(const n in t)e(t[n],n)},Mh=t=>dw(t).length,mw=t=>{for(const e in t)return!1;return!0},gw=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},yw=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),_w=(t,e)=>t===e||Mh(t)===Mh(e)&&gw(t,(n,r)=>(n!==void 0||yw(e,r))&&e[r]===n),bw=Object.freeze,Uh=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Uh(t[e])}return bw(t)},ul=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&ul(t,e,n+1)}},ww=t=>t,vw=(t,e)=>e.includes(t);var Ph={};const Es=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Fn;const Ew=()=>{if(Fn===void 0)if(Es){Fn=An();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Fn.set(e,""),e=r):e!==null&&(Fn.set(e,r),e=null)}e!==null&&Fn.set(e,"")}else typeof location=="object"?(Fn=An(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Fn.set(`--${Eh(e,"-")}`,n),Fn.set(`-${Eh(e,"-")}`,n)}})):Fn=An();return Fn},fl=t=>Ew().has(t),zo=t=>Ch(Es?Ph[t.toUpperCase().replaceAll("-","_")]:fw.getItem(t)),Dh=t=>fl("--"+t)||zo(t)!==null;Dh("production");const kw=Es&&vw(Ph.FORCE_COLOR,["true","1","2"])||!fl("--no-colors")&&!Dh("no-color")&&(!Es||process.stdout.isTTY)&&(!Es||fl("--color")||zo("COLORTERM")!==null||(zo("TERM")||"").includes("color")),Sw=t=>new Uint8Array(t),Aw=t=>{const e=Sw(t.byteLength);return e.set(t),e};class Tw{constructor(e,n){this.left=e,this.right=n}}const cr=(t,e)=>new Tw(t,e);typeof DOMParser<"u"&&new DOMParser;const xw=t=>Lb(t,(e,n)=>`${n}:${e};`).join(""),lr=Symbol,Bh=lr(),Fh=lr(),Rw=lr(),Iw=lr(),Ow=lr(),$h=lr(),Nw=lr(),hl=lr(),Cw=lr(),Lw=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},Mw={[Bh]:cr("font-weight","bold"),[Fh]:cr("font-weight","normal"),[Rw]:cr("color","blue"),[Ow]:cr("color","green"),[Iw]:cr("color","grey"),[$h]:cr("color","red"),[Nw]:cr("color","purple"),[hl]:cr("color","orange"),[Cw]:cr("color","black")},jh=kw?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=An();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=Mw[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=xw(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:Lw,Uw=(...t)=>{console.log(...jh(t)),zh.forEach(e=>e.print(t))},Pw=(...t)=>{console.warn(...jh(t)),t.unshift(hl),zh.forEach(e=>e.print(t))},zh=Ni(),Wh=t=>({[Symbol.iterator](){return this},next:t}),Dw=(t,e)=>Wh(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),dl=(t,e)=>Wh(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class pl{constructor(e,n){this.clock=e,this.len=n}}class ks{constructor(){this.clients=new Map}}const Gh=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];cd(t,s,a.clock,a.len,n)}}),Bw=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Lr((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},Hh=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&Bw(n,e.clock)!==null},ml=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=ei(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},Fw=t=>{const e=new ks;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)Ub(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return ml(e),e},Wo=(t,e,n,r)=>{Nr(t.clients,e,()=>[]).push(new pl(n,r))},$w=()=>new ks,jw=t=>{const e=$w();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new pl(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Ui=(t,e)=>{ve(t.restEncoder,e.clients.size),Cr(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ve(t.restEncoder,n);const i=r.length;ve(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},gl=t=>{const e=new ks,n=Ee(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Ee(t.restDecoder),s=Ee(t.restDecoder);if(s>0){const o=Nr(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new pl(t.readDsClock(),t.readDsLen()))}}return e},Vh=(t,e,n)=>{const r=new ks,i=Ee(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Ee(t.restDecoder),a=Ee(t.restDecoder),c=n.clients.get(o)||[],l=At(n,o);for(let u=0;u<a;u++){const f=t.readDsClock(),d=f+t.readDsLen();if(f<l){l<d&&Wo(r,o,l,d-l);let h=xn(c,f),p=c[h];for(!p.deleted&&p.id.clock<f&&(c.splice(h+1,0,na(e,p,f-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(h,0,na(e,p,d-p.id.clock)),p.delete(e))}else Wo(r,o,f,d-f)}}if(r.clients.size>0){const s=new ri;return ve(s.restEncoder,0),Ui(s,r),s.toUint8Array()}return null},Kh=Oh;class ur extends Db{constructor({guid:e=cw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Kh(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new sd,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Nh(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Nh(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ve(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Cr(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Ve(this,e,n)}get(e,n=ot){const r=Nr(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==ot&&i!==n)if(i===ot){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,$n)}getText(e=""){return this.get(e,Rn)}getMap(e=""){return this.get(e,jn)}getXmlElement(e=""){return this.get(e,fr)}getXmlFragment(e=""){return this.get(e,zn)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Cr(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new ur({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Ve(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class qh{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ee(this.restDecoder)}readDsLen(){return Ee(this.restDecoder)}}class Jh extends qh{readLeftID(){return Ne(Ee(this.restDecoder),Ee(this.restDecoder))}readRightID(){return Ne(Ee(this.restDecoder),Ee(this.restDecoder))}readClient(){return Ee(this.restDecoder)}readInfo(){return Li(this.restDecoder)}readString(){return Mi(this.restDecoder)}readParentInfo(){return Ee(this.restDecoder)===1}readTypeRef(){return Ee(this.restDecoder)}readLen(){return Ee(this.restDecoder)}readAny(){return vs(this.restDecoder)}readBuf(){return Aw(Dt(this.restDecoder))}readJSON(){return JSON.parse(Mi(this.restDecoder))}readKey(){return Mi(this.restDecoder)}}class zw{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ee(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ee(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Pi extends zw{constructor(e){super(e),this.keys=[],Ee(e),this.keyClockDecoder=new ll(Dt(e)),this.clientDecoder=new jo(Dt(e)),this.leftClockDecoder=new ll(Dt(e)),this.rightClockDecoder=new ll(Dt(e)),this.infoDecoder=new Ih(Dt(e),Li),this.stringDecoder=new sw(Dt(e)),this.parentInfoDecoder=new Ih(Dt(e),Li),this.typeRefDecoder=new jo(Dt(e)),this.lenDecoder=new jo(Dt(e))}readLeftID(){return new Di(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Di(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return vs(this.restDecoder)}readBuf(){return Dt(this.restDecoder)}readJSON(){return vs(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Xh{constructor(){this.restEncoder=Mr()}toUint8Array(){return Tn(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ve(this.restEncoder,e)}writeDsLen(e){ve(this.restEncoder,e)}}class Ss extends Xh{writeLeftID(e){ve(this.restEncoder,e.client),ve(this.restEncoder,e.clock)}writeRightID(e){ve(this.restEncoder,e.client),ve(this.restEncoder,e.clock)}writeClient(e){ve(this.restEncoder,e)}writeInfo(e){nl(this.restEncoder,e)}writeString(e){Ci(this.restEncoder,e)}writeParentInfo(e){ve(this.restEncoder,e?1:0)}writeTypeRef(e){ve(this.restEncoder,e)}writeLen(e){ve(this.restEncoder,e)}writeAny(e){ws(this.restEncoder,e)}writeBuf(e){Mt(this.restEncoder,e)}writeJSON(e){Ci(this.restEncoder,JSON.stringify(e))}writeKey(e){Ci(this.restEncoder,e)}}class Zh{constructor(){this.restEncoder=Mr(),this.dsCurrVal=0}toUint8Array(){return Tn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ve(this.restEncoder,n)}writeDsLen(e){e===0&&Bn(),ve(this.restEncoder,e-1),this.dsCurrVal+=e}}class ri extends Zh{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ol,this.clientEncoder=new Fo,this.leftClockEncoder=new ol,this.rightClockEncoder=new ol,this.infoEncoder=new Sh(nl),this.stringEncoder=new tw,this.parentInfoEncoder=new Sh(nl),this.typeRefEncoder=new Fo,this.lenEncoder=new Fo}toUint8Array(){const e=Mr();return ve(e,0),Mt(e,this.keyClockEncoder.toUint8Array()),Mt(e,this.clientEncoder.toUint8Array()),Mt(e,this.leftClockEncoder.toUint8Array()),Mt(e,this.rightClockEncoder.toUint8Array()),Mt(e,Tn(this.infoEncoder)),Mt(e,this.stringEncoder.toUint8Array()),Mt(e,Tn(this.parentInfoEncoder)),Mt(e,this.typeRefEncoder.toUint8Array()),Mt(e,this.lenEncoder.toUint8Array()),Bo(e,Tn(this.restEncoder)),Tn(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ws(this.restEncoder,e)}writeBuf(e){Mt(this.restEncoder,e)}writeJSON(e){ws(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Ww=(t,e,n,r)=>{r=ei(r,e[0].id.clock);const i=xn(e,r);ve(t.restEncoder,e.length-i),t.writeClient(n),ve(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},yl=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{At(e,s)>i&&r.set(s,i)}),Ho(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ve(t.restEncoder,r.size),Cr(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Ww(t,e.clients.get(i),i,s)})},Gw=(t,e)=>{const n=An(),r=Ee(t.restDecoder);for(let i=0;i<r;i++){const s=Ee(t.restDecoder),o=new Array(s),a=t.readClient();let c=Ee(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(Do&u){case 0:{const f=t.readLen();o[l]=new nn(Ne(a,c),f),c+=f;break}case 10:{const f=Ee(t.restDecoder);o[l]=new ln(Ne(a,c),f),c+=f;break}default:{const f=(u&(ar|tn))===0,d=new bt(Ne(a,c),null,(u&tn)===tn?t.readLeftID():null,null,(u&ar)===ar?t.readRightID():null,f?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,f&&(u&gs)===gs?t.readString():null,Ld(t,u));o[l]=d,c+=d.length}}}}return n},Hw=(t,e,n)=>{const r=[];let i=Cr(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new sd,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==ln){const p=Nr(f,u.id.client,()=>At(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,At(e,m)),d();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new ri;return yl(h,a,new Map),ve(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},Vw=(t,e)=>yl(t,e.doc.store,e.beforeState),Kw=(t,e,n,r=new Pi(t))=>Ve(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=Gw(r,o),l=Hw(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<At(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const p=u.missing.get(d);(p==null||p>h)&&u.missing.set(d,h)}u.update=Ko([u.update,l.update])}}else a.pendingStructs=l;const f=Vh(r,i,a);if(a.pendingDs){const d=new Pi(ni(a.pendingDs));Ee(d.restDecoder);const h=Vh(d,i,a);f&&h?a.pendingDs=Ko([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,Yh(i.doc,d)}},n,!1),Yh=(t,e,n,r=Pi)=>{const i=ni(e);Kw(i,t,n,new r(i))},qw=(t,e,n)=>Yh(t,e,n,Jh),Jw=(t,e,n=new Map)=>{yl(t,e.store,n),Ui(t,jw(e.store))},Xw=(t,e=new Uint8Array([0]),n=new ri)=>{const r=Qh(e);Jw(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(fv(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Ss)return lv(i.map((s,o)=>o===0?s:dv(s)));if(n.constructor===ri)return Ko(i)}return i[0]},Zw=(t,e)=>Xw(t,e,new Ss),Yw=t=>{const e=new Map,n=Ee(t.restDecoder);for(let r=0;r<n;r++){const i=Ee(t.restDecoder),s=Ee(t.restDecoder);e.set(i,s)}return e},Qh=t=>Yw(new qh(ni(t))),ed=(t,e)=>(ve(t.restEncoder,e.size),Cr(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{ve(t.restEncoder,n),ve(t.restEncoder,r)}),t),Qw=(t,e)=>ed(t,Ho(e.store)),ev=(t,e=new Zh)=>(t instanceof Map?ed(e,t):Qw(e,t),e.toUint8Array()),tv=t=>ev(t,new Xh);class nv{constructor(){this.l=[]}}const td=()=>new nv,nd=(t,e)=>t.l.push(e),rd=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},id=(t,e,n)=>ul(t.l,[e,n]);class Di{constructor(e,n){this.client=e,this.clock=n}}const Go=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ne=(t,e)=>new Di(t,e),rv=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Bn()},Bi=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Hh(e.ds,t.id),_l=(t,e)=>{const n=Nr(t.meta,_l,Ni),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<At(r,s)&&Pr(t,Ne(s,i))}),Gh(t,e.ds,i=>{}),n.add(e))};class sd{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ho=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},At=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},od=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Bn()}n.push(e)},xn=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Lr(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Lr((n+r)/2)}throw Bn()},bl=(t,e)=>{const n=t.clients.get(e.client);return n[xn(n,e.clock)]},wl=(t,e,n)=>{const r=xn(e,n),i=e[r];return i.id.clock<n&&i instanceof bt?(e.splice(r+1,0,na(t,i,n-i.id.clock)),r+1):r},Pr=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[wl(t,n,e.clock)]},ad=(t,e,n)=>{const r=e.clients.get(n.client),i=xn(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==nn&&r.splice(i+1,0,na(t,s,n.clock-s.id.clock+1)),s},iv=(t,e,n)=>{const r=t.clients.get(e.id.client);r[xn(r,e.id.clock)]=n},cd=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=wl(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&wl(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class sv{constructor(e,n,r){this.doc=e,this.deleteSet=new ks,this.beforeState=Ho(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ld=(t,e)=>e.deleteSet.clients.size===0&&!Mb(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(ml(e.deleteSet),Vw(t,e),Ui(t,e.deleteSet),!0),ud=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Nr(t.changed,e,Ni).add(n)},Vo=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof bt&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},ov=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=xn(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof bt&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},av=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=yh(i.length-1,1+xn(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Vo(i,c)}})},fd=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{ml(s),n.afterState=Ho(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),id(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),ul(a,[]),n._needFormattingCleanup&&xv(n)}finally{r.gc&&ov(s,i,r.gcFilter),av(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=ei(xn(h,d),1);for(let m=h.length-1;m>=p;)m-=1+Vo(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=xn(h,d);p+1<h.length&&Vo(h,p+1)>1||p>0&&Vo(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Uw(hl,Bh,"[yjs] ",Fh,$h,"Changed the client-id because another client seems to be using it."),r.clientID=Kh()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ss;ld(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new ri;ld(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):fd(t,e+1)}}},Ve=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new sv(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&fd(i,0)}}return o};function*cv(t){const e=Ee(t.restDecoder);for(let n=0;n<e;n++){const r=Ee(t.restDecoder),i=t.readClient();let s=Ee(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Ee(t.restDecoder);yield new ln(Ne(i,s),c),s+=c}else if(Do&a){const c=(a&(ar|tn))===0,l=new bt(Ne(i,s),null,(a&tn)===tn?t.readLeftID():null,null,(a&ar)===ar?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&gs)===gs?t.readString():null,Ld(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new nn(Ne(i,s),c),s+=c}}}}class vl{constructor(e,n){this.gen=cv(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ln);return this.curr}}class El{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const lv=t=>Ko(t,Jh,Ss),uv=(t,e)=>{if(t.constructor===nn){const{client:n,clock:r}=t.id;return new nn(Ne(n,r+e),t.length-e)}else if(t.constructor===ln){const{client:n,clock:r}=t.id;return new ln(Ne(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new bt(Ne(r,i+e),null,Ne(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Ko=(t,e=Pi,n=ri)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(ni(u)));let i=r.map(u=>new vl(u,!0)),s=null;const o=new n,a=new El(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const p=d.curr.id.clock-h.curr.id.clock;return p===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===ln?1:-1:p}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Dr(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===ln)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Dr(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ln(Ne(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===ln?s.struct.length-=p:d=uv(d,p)),s.struct.mergeWith(d)||(Dr(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==ln;d=u.next())Dr(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Dr(a,s.struct,s.offset),s=null),kl(a);const c=r.map(u=>gl(u)),l=Fw(c);return Ui(o,l),o.toUint8Array()},fv=(t,e,n=Pi,r=ri)=>{const i=Qh(e),s=new r,o=new El(s),a=new n(ni(t)),c=new vl(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===ln){c.next();continue}if(u.id.clock+u.length>d)for(Dr(o,u,ei(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Dr(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}kl(o);const l=gl(a);return Ui(s,l),s.toUint8Array()},hd=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Tn(t.encoder.restEncoder)}),t.encoder.restEncoder=Mr(),t.written=0)},Dr=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&hd(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ve(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},kl=t=>{hd(t);const e=t.encoder.restEncoder;ve(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ve(e,r.written),Bo(e,r.restEncoder)}},hv=(t,e,n,r)=>{const i=new n(ni(t)),s=new vl(i,!1),o=new r,a=new El(o);for(let l=s.curr;l!==null;l=s.next())Dr(a,e(l),0);kl(a);const c=gl(i);return Ui(o,c),o.toUint8Array()},dv=t=>hv(t,ww,Pi,Ss),dd="You must not compute changes after the event-handler fired.";class qo{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=pv(this.currentTarget,this.target))}deletes(e){return Hh(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ur(dd);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Yc(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Yc(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Yc(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ur(dd);const n=this.target,r=Ni(),i=Ni(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const pv=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},Ut=()=>{Pw("Invalid access: Add Yjs type to a document before reading data.")},pd=80;let Sl=0;class mv{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Sl++}}const gv=t=>{t.timestamp=Sl++},md=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Sl++},yv=(t,e,n)=>{if(t.length>=pd){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return md(r,e,n),r}else{const r=new mv(e,n);return t.push(r),r}},Jo=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>Po(e-s.index)<Po(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,gv(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Po(n.index-i)<r.parent.length/pd?(md(n,r,i),n):yv(t._searchMarker,r,i)},As=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=ei(e,i.index+n))}},Xo=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Nr(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;id(r._eH,n,e)};class ot{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=td(),this._dEH=td(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Dn()}clone(){throw Dn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){nd(this._eH,e)}observeDeep(e){nd(this._dEH,e)}unobserve(e){rd(this._eH,e)}unobserveDeep(e){rd(this._dEH,e)}toJSON(){}}const gd=(t,e,n)=>{t.doc??Ut(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},yd=t=>{t.doc??Ut();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Ts=(t,e)=>{let n=0,r=t._start;for(t.doc??Ut();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},_d=(t,e)=>{const n=[];return Ts(t,(r,i)=>{n.push(e(r,i,t))}),n},_v=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},bd=(t,e)=>{t.doc??Ut();const n=Jo(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Zo=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new bt(Ne(o,At(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new oi(l)),i.integrate(t,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new bt(Ne(o,At(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new xs(new Uint8Array(f))),i.integrate(t,0);break;case ur:i=new bt(Ne(o,At(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Is(f)),i.integrate(t,0);break;default:if(f instanceof ot)i=new bt(Ne(o,At(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new hr(f)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},wd=()=>Ur("Length exceeded!"),vd=(t,e,n,r)=>{if(n>e._length)throw wd();if(n===0)return e._searchMarker&&As(e._searchMarker,n,r.length),Zo(t,e,null,r);const i=n,s=Jo(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Pr(t,Ne(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&As(e._searchMarker,i,r.length),Zo(t,e,o,r)},bv=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Zo(t,e,i,n)},Ed=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Jo(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Pr(t,Ne(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Pr(t,Ne(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw wd();e._searchMarker&&As(e._searchMarker,i,-s+r)},Yo=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Al=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new oi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new oi([r]);break;case Uint8Array:a=new xs(r);break;case ur:a=new Is(r);break;default:if(r instanceof ot)a=new hr(r);else throw new Error("Unexpected content type")}new bt(Ne(o,At(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Tl=(t,e)=>{t.doc??Ut();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},kd=t=>{const e={};return t.doc??Ut(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Sd=(t,e)=>{t.doc??Ut();const n=t._map.get(e);return n!==void 0&&!n.deleted},wv=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Bi(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Qo=t=>(t.doc??Ut(),Dw(t._map.entries(),e=>!e[1].deleted));class vv extends qo{}class $n extends ot{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new $n;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $n}clone(){const e=new $n;return e.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),e}get length(){return this.doc??Ut(),this._length}_callObserver(e,n){super._callObserver(e,n),Xo(this,e,new vv(this,e))}insert(e,n){this.doc!==null?Ve(this.doc,r=>{vd(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Ve(this.doc,n=>{bv(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Ve(this.doc,r=>{Ed(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return bd(this,e)}toArray(){return yd(this)}slice(e=0,n=this.length){return gd(this,e,n)}toJSON(){return this.map(e=>e instanceof ot?e.toJSON():e)}map(e){return _d(this,e)}forEach(e){Ts(this,e)}[Symbol.iterator](){return _v(this)}_write(e){e.writeTypeRef(Vv)}}const Ev=t=>new $n;class kv extends qo{constructor(e,n,r){super(e,n),this.keysChanged=r}}class jn extends ot{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new jn}clone(){const e=new jn;return this.forEach((n,r)=>{e.set(r,n instanceof ot?n.clone():n)}),e}_callObserver(e,n){Xo(this,e,new kv(this,e,n))}toJSON(){this.doc??Ut();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof ot?i.toJSON():i}}),e}get size(){return[...Qo(this)].length}keys(){return dl(Qo(this),e=>e[0])}values(){return dl(Qo(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return dl(Qo(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Ut(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ve(this.doc,n=>{Yo(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Ve(this.doc,r=>{Al(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Tl(this,e)}has(e){return Sd(this,e)}clear(){this.doc!==null?Ve(this.doc,e=>{this.forEach(function(n,r,i){Yo(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Kv)}}const Sv=t=>new jn,Br=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&_w(t,e);class xl{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Bn(),this.right.content.constructor){case _t:this.right.deleted||Fi(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Ad=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case _t:e.right.deleted||Fi(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Pr(t,Ne(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ea=(t,e,n,r)=>{const i=new Map,s=r?Jo(e,n):null;if(s){const o=new xl(s.p.left,s.p,s.index,i);return Ad(t,o,n-s.index)}else{const o=new xl(null,e._start,0,i);return Ad(t,o,n)}},Td=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===_t&&Br(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new bt(Ne(s,At(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new _t(a,o));u.integrate(t,0),n.right=u,n.forward()})},Fi=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},xd=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===_t&&Br(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Rd=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Br(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new bt(Ne(s,At(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new _t(a,c)),n.right.integrate(t,0),n.forward()}}return o},Rl=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;xd(n,i);const a=Rd(t,e,n,i),c=r.constructor===String?new Wn(r):r instanceof ot?new hr(r):new si(r);let{left:l,right:u,index:f}=n;e._searchMarker&&As(e._searchMarker,n.index,c.getLength()),u=new bt(Ne(o,At(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=f,n.forward(),Td(t,e,n,a)},Id=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;xd(n,i);const a=Rd(t,e,n,i);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===_t));){if(!n.right.deleted)switch(n.right.content.constructor){case _t:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Br(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Pr(t,Ne(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new bt(Ne(o,At(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Wn(c)),n.right.integrate(t,0),n.forward()}Td(t,e,n,a)},Od=(t,e,n,r,i)=>{let s=e;const o=An();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===_t){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case _t:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(e.delete(t),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&Fi(i,l);break}}}e=e.right}return a},Av=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===_t){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Tv=t=>{let e=0;return Ve(t.doc,n=>{let r=t._start,i=t._start,s=An();const o=Zc(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case _t:Fi(o,i.content);break;default:e+=Od(n,r,i,s,o),s=Zc(o),r=i;break}i=i.right}}),e},xv=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&cd(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===_t&&o.constructor!==nn&&e.add(o.parent)})}Ve(n,r=>{Gh(t,t.deleteSet,i=>{if(i instanceof nn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===_t?e.add(s):Av(r,i)});for(const i of e)Tv(i)})},Nd=(t,e,n)=>{const r=n,i=Zc(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case hr:case si:case Wn:n<e.right.length&&Pr(t,Ne(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Od(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&As(o._searchMarker,e.index,-r+n),e};class Rv extends qo{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Ve(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},mw(c)||(h.attributes=hw({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case hr:case si:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Wn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case _t:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;Br(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Br(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;Br(m,p)||(a==="retain"&&d(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(Br(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&d(),Fi(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Rn extends ot{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Ut(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Rn}clone(){const e=new Rn;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new Rv(this,e,n);Xo(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Ut();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Wn&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Ve(this.doc,r=>{const i=new xl(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Rl(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Id(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Nd(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Ut();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Bi(c,e)||n!==void 0&&Bi(c,n))switch(c.content.constructor){case Wn:{const f=s.get("ychange");e!==void 0&&!Bi(c,e)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Bi(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case hr:case si:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case _t:Bi(c,e)&&(l(),Fi(s,c.content));break}c=c.right}l()};return e||n?Ve(o,f=>{e&&_l(f,e),n&&_l(f,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Ve(i,s=>{const o=ea(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Rl(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?Ve(i,s=>{const o=ea(s,this,e,!r);Rl(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Ve(r,i=>{Nd(i,ea(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Ve(i,s=>{const o=ea(s,this,e,!1);o.right!==null&&Id(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Ve(this.doc,n=>{Yo(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Ve(this.doc,r=>{Al(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Tl(this,e)}getAttributes(){return kd(this)}_write(e){e.writeTypeRef(qv)}}const Iv=t=>new Rn;class Il{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Ut()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===fr||n.constructor===zn)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class zn extends ot{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new zn}clone(){const e=new zn;return e.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),e}get length(){return this.doc??Ut(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Il(this,e)}querySelector(e){e=e.toUpperCase();const r=new Il(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Cr(new Il(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Xo(this,e,new Cv(this,n,e))}toString(){return _d(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ts(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Ve(this.doc,r=>{vd(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Ve(this.doc,r=>{const i=e&&e instanceof ot?e._item:e;Zo(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Ur("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Ve(this.doc,r=>{Ed(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return yd(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return bd(this,e)}slice(e=0,n=this.length){return gd(this,e,n)}forEach(e){Ts(this,e)}_write(e){e.writeTypeRef(Xv)}}const Ov=t=>new zn;class fr extends zn{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new fr(this.nodeName)}clone(){const e=new fr(this.nodeName),n=this.getAttributes();return pw(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof ot?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ve(this.doc,n=>{Yo(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Ve(this.doc,r=>{Al(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Tl(this,e)}hasAttribute(e){return Sd(this,e)}getAttributes(e){return e?wv(this,e):kd(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ts(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(Jv),e.writeKey(this.nodeName)}}const Nv=t=>new fr(t.readKey());class Cv extends qo{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class $i extends jn{constructor(e){super(),this.hookName=e}_copy(){return new $i(this.hookName)}clone(){const e=new $i(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(Zv),e.writeKey(this.hookName)}}const Lv=t=>new $i(t.readKey());class ii extends Rn{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ii}clone(){const e=new ii;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Yv)}}const Mv=t=>new ii;class Ol{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Dn()}mergeWith(e){return!1}write(e,n,r){throw Dn()}integrate(e,n){throw Dn()}}const Uv=0;class nn extends Ol{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),od(e.doc.store,this)}write(e,n){e.writeInfo(Uv),e.writeLen(this.length-n)}getMissing(e,n){return null}}class xs{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new xs(this.content)}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const Pv=t=>new xs(t.readBuf());class Rs{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Rs(this.len)}splice(e){const n=new Rs(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Wo(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Dv=t=>new Rs(t.readLen()),Cd=(t,e)=>new ur({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Is{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Is(Cd(this.doc.guid,this.opts))}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Bv=t=>new Is(Cd(t.readString(),t.readAny()));class si{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new si(this.embed)}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const Fv=t=>new si(t.readJSON());class _t{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new _t(this.key,this.value)}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const $v=t=>new _t(t.readKey(),t.readJSON());class ta{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ta(this.arr)}splice(e){const n=new ta(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const jv=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new ta(n)},zv=zo("node_env")==="development";class oi{constructor(e){this.arr=e,zv&&Uh(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new oi(this.arr)}splice(e){const n=new oi(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const Wv=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new oi(n)};class Wn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Wn(this.str)}splice(e){const n=new Wn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Gv=t=>new Wn(t.readString()),Hv=[Ev,Sv,Iv,Nv,Ov,Lv,Mv],Vv=0,Kv=1,qv=2,Jv=3,Xv=4,Zv=5,Yv=6;class hr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new hr(this.type._copy())}splice(e){throw Dn()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const Qv=t=>new hr(Hv[t.readTypeRef()](t)),na=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new bt(Ne(r,i+n),e,Ne(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ne(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class bt extends Ol{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?wh:0}set marker(e){(this.info&el)>0!==e&&(this.info^=el)}get marker(){return(this.info&el)>0}get keep(){return(this.info&bh)>0}set keep(e){this.keep!==e&&(this.info^=bh)}get countable(){return(this.info&wh)>0}get deleted(){return(this.info&Qc)>0}set deleted(e){this.deleted!==e&&(this.info^=Qc)}markDeleted(){this.info|=Qc}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=At(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=At(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Di&&this.id.client!==this.parent.client&&this.parent.clock>=At(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ad(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Pr(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===nn||this.right&&this.right.constructor===nn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===bt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===bt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Di){const r=bl(n,this.parent);r.constructor===nn?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=ad(e,e.doc.store,Ne(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Go(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Go(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(bl(e.doc.store,i.origin)))s.has(bl(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),od(e.doc.store,this),this.content.integrate(e,this),ud(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new nn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ne(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Go(e.origin,this.lastId)&&this.right===e&&Go(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Wo(e.deleteSet,this.id.client,this.id.clock,this.length),ud(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Bn();this.content.gc(e),n?iv(e,this,new nn(this.id,this.length)):this.content=new Rs(this.length)}write(e,n){const r=n>0?Ne(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Do|(r===null?0:tn)|(i===null?0:ar)|(s===null?0:gs);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=rv(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Di?(e.writeParentInfo(!1),e.writeLeftID(a)):Bn();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Ld=(t,e)=>eE[e&Do](t),eE=[()=>{Bn()},Dv,jv,Pv,Gv,Fv,$v,Qv,Wv,Bv,()=>{Bn()}],tE=10;class ln extends Ol{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Bn()}write(e,n){e.writeInfo(tE),ve(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Md=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Ud="__ $YJS$ __";Md[Ud]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Md[Ud]=!0;let Nl,Cl,nE=t=>t();function rE(t,e){if(Cl)return Cl(t,e);nE(t)}function ai(t,e,n){if(Nl)return Nl.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function iE(t){Nl=function(e,n,r){const i=t.createAtom(e);return n&&n(),i},Cl=(e,n)=>t.reaction(e,n,{fireImmediately:!1})}const Pd=new WeakSet;function sE(t){if(Pd.has(t))return t;Pd.add(t);let e;const n=new Map;function r(){if(!e){const f=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&e.reportChanged()};e=ai("map",()=>{t.observe(f)},()=>{t.unobserve(f)})}e.reportObserved(t._implicitObserver)}function i(f){let d=n.get(f);if(!d){const h=p=>{d.reportChanged()};d=ai(f+"",()=>{t.observe(h)},()=>{t.unobserve(h)}),n.set(f,d)}d.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(f){if(typeof f!="number")throw new Error("unexpected");return i(f),Reflect.apply(s,this,arguments)};function o(f){const d=t[f];t[f]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(f){let d=t,h=Object.getOwnPropertyDescriptor(d,f);if(h||(d=Object.getPrototypeOf(d),h=Object.getOwnPropertyDescriptor(d,f)),h||(d=Object.getPrototypeOf(d),h=Object.getOwnPropertyDescriptor(d,f)),!h)throw new Error("property not found");const p=h.get;h.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(t,f,h)}function c(f,d){let h=t,p=Object.getOwnPropertyDescriptor(h,f);if(p||(h=Object.getPrototypeOf(h),p=Object.getOwnPropertyDescriptor(h,f)),p||(h=Object.getPrototypeOf(h),p=Object.getOwnPropertyDescriptor(h,f)),!p)throw new Error("property not found");Object.defineProperty(t,d,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=t.push;t.push=function(f){this._disableTracking=!0;const d=l.call(this,f);return this._disableTracking=!1,d};const u=t.slice;return t.slice=function(f,d){this._disableTracking=!0;const h=u.call(this,f,d);return this._disableTracking=!1,h},t}const Dd=new WeakSet;function oE(t){if(Dd.has(t))return t;Dd.add(t);let e;function n(){if(!e){let s=Array.from(t.share.keys());const o=a=>{const c=Array.from(t.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,e.reportChanged())};e=ai("map",()=>{t.on("beforeObserverCalls",o)},()=>{t.off("beforeObserverCalls",o)})}e.reportObserved(t._implicitObserver)}const r=t.get;t.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return ra(o),o};function i(s){const o=t[s];let a;t[s]=function(){let c,l=arguments;return n(),a&&a.removeObservers(),a=rE(()=>(c=Reflect.apply(o,t,l),c),()=>e.reportChanged()),c}}return i("toJSON"),Object.defineProperty(t,"keys",{get:()=>(n(),Object.keys(t.share))}),t}const Bd=new WeakSet;function aE(t){if(Bd.has(t))return t;Bd.add(t);let e;const n=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=ai("map",()=>{t.observe(a)},()=>{t.unobserve(a)})}e.reportObserved(t._implicitObserver)}function i(a){let c=n.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=ai(a,()=>{t.observe(l)},()=>{t.unobserve(l)}),n.set(a,c)}c.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=t[a];t[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),t}const Fd=new WeakSet;function $d(t){if(Fd.has(t))return t;Fd.add(t);let e;const n=i=>{e.reportChanged()};e=ai("text",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(i){const s=t[i];t[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),t}const jd=new WeakSet;function zd(t){if(jd.has(t))return t;jd.add(t);let e;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&e.reportChanged()};e=ai("xml",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(s){const o=t[s];t[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=t,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(t,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),t}function ra(t){return t instanceof ii||t instanceof Rn?$d(t):t instanceof $n?sE(t):t instanceof jn?aE(t):t instanceof ur||Object.prototype.hasOwnProperty.call(t,"autoLoad")?oE(t):t instanceof zn||t instanceof fr?zd(t):t}function Wd(t){t.share.forEach(e=>{e.constructor!==ot&&ra(e)})}function Gd(t,e){for(let r=t.length-1;r>=e;r--){let i=t[r];if(!i.deleted){var n;if(i instanceof nn)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof ot&&ra(s)})}}}const Hd=new WeakSet;function cE(t){Hd.has(t)||(Hd.add(t),ra(t),t.store.clients.forEach(e=>{e&&Gd(e,0)}),Wd(t),t.on("beforeObserverCalls",e=>{Wd(t),e.afterState.forEach((n,r)=>{const i=e.beforeState.get(r)||0;if(i!==n){const s=e.doc.store.clients.get(r);if(!s)return;const o=xn(s,i);Gd(s,o)}})}))}class Os{constructor(e){this.value=void 0,this.value=e}}function lE(t){return ArrayBuffer.isView(t)?new Os(t):new Os(Object.freeze(t))}function uE(t){const e=function(){var a;let c=(a=this[cn])==null?void 0:a.implicitObserver;return t._implicitObserver=c,t.slice.bind(t).apply(t,arguments).map(u=>{const f=ia(u,c);return c&&typeof f=="object"?ms(f,c):f})},n=function(a){return a.map(c=>{const l=Ll(c);let u=ci(l)||l;if(u instanceof Os&&(u=u.value),u instanceof ot&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},i={slice:e,unshift:(...o)=>(t.unshift(n(o)),t.lengthUntracked),push:(...o)=>(t.push(n(o)),t.lengthUntracked),insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>mE(a,o))},splice:function(){let o=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return t.doc?t.doc.transact(()=>{t.delete(o,a),t.insert(o,n(c))}):(t.delete(o,a),t.insert(o,n(c))),l}},s=[];for(let o in i)s[o]=i[o];return s}function Ns(t){if(typeof t=="string"&&t.trim().length){const e=Number(t);if(Number.isInteger(e))return e}return t}function Vd(t,e=new $n){if(e[yt])throw new Error("unexpected");const n=uE(e),r=new Proxy(n,{set:(i,s,o)=>{throw typeof Ns(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=Ns(s);if(a===sa)return e;if(typeof a=="number"){let u;if(o&&o[cn]){var c;u=(c=o[cn])==null?void 0:c.implicitObserver,e._implicitObserver=u}let f=e.get(a);return f=ia(f,u),f}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=e.slice();return Reflect.get(u,a)}return a==="length"?e.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=Ns(s);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(i,s)=>{const o=Ns(s);return typeof o!="number"?Reflect.has(i,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=Ns(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<e.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,t),r}function Kd(t,e=new jn){if(e[yt])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=Ll(s);let a=ci(o)||o;if(a instanceof Os&&(a=a.value),a instanceof ot&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(i,a),!0},get:(r,i,s)=>{if(i===sa)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[cn]){var a;o=(a=s[cn])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(i);return c=ia(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return e.has(i)?(e.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&e.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});Cs.set(e,n);for(let r in t)n[r]=t[r];return n}function fE(t){return t instanceof ot}const Cs=new WeakMap;function ia(t,e){if(fE(t)){if(t._implicitObserver=e,t instanceof $n||t instanceof jn){if(!Cs.has(t)){const n=Ll(t);Cs.set(t,n)}t=Cs.get(t)}else if(t instanceof fr||t instanceof zn||t instanceof ii||t instanceof $i||t instanceof Rn)Jc(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return lE(t)}return t}function Ll(t){if(t==null)return t;if(t=ci(t)||t,t instanceof $n)return Vd([],t);if(t instanceof jn)return Kd({},t);if(typeof t=="string")return t;if(Array.isArray(t))return Vd(t);if(t instanceof fr||t instanceof zn||t instanceof ii||t instanceof $i)return t;if(t instanceof Rn)return t;if(typeof t=="object")return t instanceof Os?t:Kd(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function hE(t){for(let[e,n]of Object.entries(t))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function qd(t,e,n){let r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function dE(t,e){if(t[yt])throw new Error("unexpected");hE(e);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===sa)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[cn]){var a;o=(a=s[cn])==null?void 0:a.implicitObserver,t._implicitObserver=o}if(i==="toJSON"){for(let u of Object.keys(e))qd(t,e,u);return Reflect.get(t,i)}let c=qd(t,e,i);return c=ia(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&t.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.share.keys())});return Cs.set(t,n),n}iE(Cb);const sa=Symbol("INTERNAL_SYMBOL");function Jd(t,e){const n=ci(t)||t;if(!n)throw new Error("not a valid synced object");return n instanceof ur?(n.on("update",e),()=>{n.off("update",e)}):(n.observeDeep(e),()=>{n.unobserveDeep(e)})}function pE(t){const e=ci(t);if(!(e instanceof ur))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function ci(t){if(typeof t!="object"||t===null)return;const e=t[sa];return e&&(Jc(e),e.__v_skip=!0),e}function mE(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){const n=ci(t),r=ci(e);return!n||!r?!1:n===r}return!1}function gE(t,e=new ur){return cE(e),dE(e,t)}var xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ls=Symbol.for("react.element"),yE=Symbol.for("react.portal"),_E=Symbol.for("react.fragment"),bE=Symbol.for("react.strict_mode"),wE=Symbol.for("react.profiler"),vE=Symbol.for("react.provider"),EE=Symbol.for("react.context"),kE=Symbol.for("react.forward_ref"),SE=Symbol.for("react.suspense"),AE=Symbol.for("react.memo"),TE=Symbol.for("react.lazy"),Xd=Symbol.iterator;function xE(t){return t===null||typeof t!="object"?null:(t=Xd&&t[Xd]||t["@@iterator"],typeof t=="function"?t:null)}var Zd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Yd=Object.assign,Qd={};function ji(t,e,n){this.props=t,this.context=e,this.refs=Qd,this.updater=n||Zd}ji.prototype.isReactComponent={},ji.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},ji.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function ep(){}ep.prototype=ji.prototype;function Ml(t,e,n){this.props=t,this.context=e,this.refs=Qd,this.updater=n||Zd}var Ul=Ml.prototype=new ep;Ul.constructor=Ml,Yd(Ul,ji.prototype),Ul.isPureReactComponent=!0;var tp=Array.isArray,np=Object.prototype.hasOwnProperty,Pl={current:null},rp={key:!0,ref:!0,__self:!0,__source:!0};function ip(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)np.call(e,r)&&!rp.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ls,type:t,key:s,ref:o,props:i,_owner:Pl.current}}function RE(t,e){return{$$typeof:Ls,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Dl(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ls}function IE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var sp=/\/+/g;function Bl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?IE(""+t.key):e.toString(36)}function oa(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ls:case yE:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Bl(o,0):r,tp(i)?(n="",t!=null&&(n=t.replace(sp,"$&/")+"/"),oa(i,e,n,"",function(l){return l})):i!=null&&(Dl(i)&&(i=RE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(sp,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",tp(t))for(var a=0;a<t.length;a++){s=t[a];var c=r+Bl(s,a);o+=oa(s,e,n,c,i)}else if(c=xE(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=r+Bl(s,a++),o+=oa(s,e,n,c,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function aa(t,e,n){if(t==null)return t;var r=[],i=0;return oa(t,r,"","",function(s){return e.call(n,s,i++)}),r}function OE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Bt={current:null},ca={transition:null},NE={ReactCurrentDispatcher:Bt,ReactCurrentBatchConfig:ca,ReactCurrentOwner:Pl};function op(){throw Error("act(...) is not supported in production builds of React.")}xe.Children={map:aa,forEach:function(t,e,n){aa(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return aa(t,function(){e++}),e},toArray:function(t){return aa(t,function(e){return e})||[]},only:function(t){if(!Dl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},xe.Component=ji,xe.Fragment=_E,xe.Profiler=wE,xe.PureComponent=Ml,xe.StrictMode=bE,xe.Suspense=SE,xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NE,xe.act=op,xe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Yd({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Pl.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)np.call(e,c)&&!rp.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Ls,type:t.type,key:i,ref:s,props:r,_owner:o}},xe.createContext=function(t){return t={$$typeof:EE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:vE,_context:t},t.Consumer=t},xe.createElement=ip,xe.createFactory=function(t){var e=ip.bind(null,t);return e.type=t,e},xe.createRef=function(){return{current:null}},xe.forwardRef=function(t){return{$$typeof:kE,render:t}},xe.isValidElement=Dl,xe.lazy=function(t){return{$$typeof:TE,_payload:{_status:-1,_result:t},_init:OE}},xe.memo=function(t,e){return{$$typeof:AE,type:t,compare:e===void 0?null:e}},xe.startTransition=function(t){var e=ca.transition;ca.transition={};try{t()}finally{ca.transition=e}},xe.unstable_act=op,xe.useCallback=function(t,e){return Bt.current.useCallback(t,e)},xe.useContext=function(t){return Bt.current.useContext(t)},xe.useDebugValue=function(){},xe.useDeferredValue=function(t){return Bt.current.useDeferredValue(t)},xe.useEffect=function(t,e){return Bt.current.useEffect(t,e)},xe.useId=function(){return Bt.current.useId()},xe.useImperativeHandle=function(t,e,n){return Bt.current.useImperativeHandle(t,e,n)},xe.useInsertionEffect=function(t,e){return Bt.current.useInsertionEffect(t,e)},xe.useLayoutEffect=function(t,e){return Bt.current.useLayoutEffect(t,e)},xe.useMemo=function(t,e){return Bt.current.useMemo(t,e)},xe.useReducer=function(t,e,n){return Bt.current.useReducer(t,e,n)},xe.useRef=function(t){return Bt.current.useRef(t)},xe.useState=function(t){return Bt.current.useState(t)},xe.useSyncExternalStore=function(t,e,n){return Bt.current.useSyncExternalStore(t,e,n)},xe.useTransition=function(){return Bt.current.useTransition()},xe.version="18.3.1";const Fl=0,ap=1,cp=2,CE=(t,e)=>{ve(t,Fl);const n=tv(e);Mt(t,n)},lp=(t,e,n)=>{ve(t,ap),Mt(t,Zw(e,n))},LE=(t,e,n)=>lp(e,n,Dt(t)),up=(t,e,n)=>{try{qw(e,Dt(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},ME=(t,e)=>{ve(t,cp),Mt(t,e)},UE=up,PE=(t,e,n,r)=>{const i=Ee(t);switch(i){case Fl:LE(t,e,n);break;case ap:up(t,n,r);break;case cp:UE(t,n,r);break;default:throw new Error("Unknown message type")}return i};function tt(t,e,n,r){const i=r??"";return Te.emit(`error:${e}`,t,n,i),XE(t,n,i)}function DE(t,e,n){Te.emit("gadgetclient:reset",t,e,n)}function BE(t,e,n){Te.emit("gadgetclient:patch",t,e,n)}function FE(t,e){Te.emit("gadgetserver:clearplayer",t,void 0,e)}function $E(t,e){Te.emit("peer:joincode",t,void 0,e)}function jE(t,e){Te.emit("started",t,void 0,e)}function zE(t,e,n,r){Te.emit("register:flush",t,[e,n],r)}function WE(t,e){Te.emit("register:dev",t,void 0,e)}function GE(t,e){Te.emit("register:share",t,void 0,e)}function HE(t,e){Te.emit("register:refresh",t,void 0,e)}function VE(t,e){Te.emit("register:nuke",t,void 0,e)}function KE(t,e,n){Te.emit("synth:tts",t,[e,n])}function qE(t,e,n){Te.emit("synth:play",t,[e,n])}function $l(t,e,n,r){Te.emit("synth:voice",t,[e,n,r])}function JE(t,e,n,r,i){Te.emit("synth:voicefx",t,[e,n,r,i])}function Nt(t,...e){return Te.emit("tape:info",t,e),!0}function fp(t,...e){return Te.emit("tape:debug",t,e),!0}function XE(t,...e){return Te.emit("tape:error",t,e),!1}function ZE(t,e,n,r,i,s){Te.emit("tape:editor:open",t,[e,n,r,i],s)}function YE(t,e){Te.emit("vm:endgame",t,void 0,e)}function hp(t,e){return`${t}${e}`}function jl(t,e,n){Te.emit("vm:flush",t,e,n)}const dr=gE({shared:[]});function la(t,e,n){return t.find(r=>r.key===e&&r.type===n)}function RM(t){}function dp(t,e,n){const r=la(dr.shared,t,e);k(r)||dr.shared.push({key:t,type:e,value:n})}function QE(t,e){dp(t,0,e)}function pp(t,e){const n=new Rn(e);dp(t,1,n)}function ek(t,e){const n=la(dr.shared,t,0);if(k(n)){n.value=e;return}dr.shared.push({key:t,type:0,value:e})}function tk(t,e){const n=new Rn(e),r=la(dr.shared,t,1);if(k(r)){r.value=n;return}dr.shared.push({key:t,type:1,value:n})}function mp(t,e,n){let r;function i(){const o=la(dr.shared,t,e);k(o)&&(s(),r=Jd(o,()=>n(o.value)))}const s=Jd(dr.shared,i);return i(),()=>r==null?void 0:r()}function nk(t,e){return mp(t,0,e)}function gp(t,e){return mp(t,1,n=>e(n.toJSON()))}function ua(t){return Tn(t)}const Fr=pE(dr),Gn=us("modem",["second"],t=>{switch(t.target){case"second":break;case"join":if(t.sender!==Gn.id()){Gn.reply(t,"joinack");const e=Mr();CE(e,Fr),Gn.reply(t,"sync",ua(e));const n=Mr();lp(n,Fr),Gn.reply(t,"sync",ua(n))}break;case"joinack":t.sender,Gn.id();break;case"sync":{if(t.sender!==Gn.id()&&k(t.data))try{const e=ni(t.data),n=Mr();PE(e,n,Fr,Gn)===Fl&&Gn.emit("modem:sync",ua(n))}catch(e){tt(Gn.name(),"sync",e.message)}break}}});function yp(t){const e=Mr();ME(e,t),Gn.emit("modem:sync",ua(e))}Fr.on("update",yp),Fr.on("destroy",()=>{Fr==null||Fr.off("update",yp)});const rk=8,ik=14;function fa(t,e){return new Array(t).fill(e)}function _p(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:fa(s,0),color:fa(s,0),bg:fa(s,i)}}function sk(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:be.ONCLEAR}}function ok(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function ak(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:fa(s,i)}}function ck(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:2}}var un=(t=>(t[t.START=0]="START",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.SCROLL=5]="SCROLL",t))(un||{});const lk={start:0,left:1,right:2,top:3,bottom:4,scroll:5},uk={0:1,1:20,2:20,3:1,4:1,5:40};function bp(t,e){return`${t}:${e}`}const fk=1,hk=16,dk=256;var Ft=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Ft||{});const $r={};function zl(){return{layers:[],panels:[],reset:!0,focus:"scroll"}}function wp(t){t.text=[],Object.values($r[t.id]??{}).forEach(e=>e==null?void 0:e()),$r[t.id]={}}function vp(t){const e=t.panels.find(n=>n.name===t.focus);if(!e){const n={id:ht(),name:t.focus,edge:un.RIGHT,size:20,text:[]};return t.panels.push(n),t.reset=!1,n}return e}const pk=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),mk=new Set(["rn","range","sl","select","nm","number","tx","text"]),gk=new Set(["tx","text"]),yk={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""},Wl={};let Ep=t=>{let e=Wl[t];return k(e)||(Wl[t]=e=zl()),e};function _k(t){Ep=t}function li(t){return Ep(t)}function bk(t){const e=li(t);e.panels=e.panels.filter(n=>n.edge!==un.SCROLL)}function wk(t,e,n){Object.values($r).forEach(r=>{if(r[e]!==void 0){const i=bp(t.id(),e);ke(n)&&ek(i,n),Se(n)&&tk(i,n)}})}function vk(t){let e="";const n=li(t);return n.panels=n.panels.filter(r=>{if(r.edge===un.SCROLL){const[i]=r.text;return Se(i)&&r.text.length===1&&(e=i),r.text.length>1}return!0}),e}function Gl(t,e,n,r,i){const s=li(t),o=r,a=i??Eb.capital(e),c=s.panels.find(l=>l.name===a);if(c)s.reset=!0,s.focus=a,ke(o)&&(c.size=o);else switch(n){case un.START:{Wl[t]=zl();break}case un.LEFT:case un.RIGHT:case un.TOP:case un.BOTTOM:case un.SCROLL:{const l={id:ht(),name:a,edge:n,size:o??uk[n],text:[]};s.panels.push(l),s.focus=a;break}}}function Ek(t,e){const n=li(t),r=vp(n);n.reset&&(n.reset=!1,wp(r)),r.text.push(e)}function kk(t,e,n,r,i){const s=li(t),o=vp(s);s.reset&&(s.reset=!1,wp(o));const a=Pe(r),c=[e.id(),n,...pk.has(a)?[a]:["hyperlink",r],...i],l=c[2];if(mk.has(l)){const u=`${c[3]??""}`;$r[o.id]=$r[o.id]??{};const f=e.get(u)??yk[l];if($r[o.id][u]===void 0){const d=bp(e.id(),u);ke(f)&&QE(d,f),Se(f)&&pp(d,f),gk.has(l)?$r[o.id][u]=gp(d,h=>{k(h)&&h!==e.get(u)&&e.set(u,h)}):$r[o.id][u]=nk(d,h=>{k(h)&&h!==e.get(u)&&e.set(u,h)})}}o.text.push(c)}var kp={exports:{}},Hl={exports:{}},Sp;function Sk(){return Sp||(Sp=1,function(t,e){(function(n,r){t.exports=r()})(Pt,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(m){if(m)for(var b=0;b<u.length;b++)m[u[b]]!==void 0&&this["set"+r(u[b])](m[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof f)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new f(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",_=this.getColumnNumber()||"",w=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+_+")":"[eval]:"+b+":"+_:w?w+" ("+m+":"+b+":"+_+")":m+":"+b+":"+_}},f.fromString=function(b){var _=b.indexOf("("),w=b.lastIndexOf(")"),v=b.substring(0,_),S=b.substring(_+1,w).split(","),L=b.substring(w+1);if(L.indexOf("@")===0)var I=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(L,""),T=I[1],M=I[2],x=I[3];return new f({functionName:v,args:S||void 0,fileName:T,lineNumber:M||void 0,columnNumber:x||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[h]);for(var p=0;p<a.length;p++)f.prototype["get"+r(a[p])]=i(a[p]),f.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return f})}(Hl)),Hl.exports}(function(t,e){(function(n,r){t.exports=r(Sk())})(Pt,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),p=d&&f||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(kp);var Ak=kp.exports,Tk=Ii(Ak);const Hn=!!JSON.parse("false"),xk=!!JSON.parse("false");JSON.parse("false");const Rk=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const zi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return rk*zi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return ik*zi.DRAW_CHAR_SCALE}};function pr(t){const e={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}var Ap={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Pt,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Ap);var Ik=Ap.exports,Ok=Ii(Ik);function ui(t,e,n){return Math.max(e,Math.min(n,t))}const Nk=Ok("089fad0j9awfem09wavefc09uwaef");function Ck(){return Nk()}function Ms(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(Ck()*i)}function Vl(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function Lk(t){return t[Ms(0,t.length-1)]}function mr(...t){return Lk(t.flat())}function Mk(t){return[...new Set(t)].filter(k)}function Uk(...t){const e=t.flat().filter(k);return e.reduce((n,r)=>n+r,0)/e.length}function gr(t){return k(t)&&k(t.x)&&k(t.y)}function Tt(t,e){switch(e){case ae.NORTH:--t.y;break;case ae.SOUTH:++t.y;break;case ae.WEST:--t.x;break;case ae.EAST:++t.x;break}return t}function Wi(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return ae.WEST;if(n>0)return ae.EAST;if(r<0)return ae.NORTH;if(r>0)return ae.SOUTH}const Tp={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function yr(t){return He(t)&&xp(t[0])}function xp(t){return k(ae[t])&&Se(t)}function Pk(t){const e=ae[t];return k(e)?e:ae.IDLE}function Rp(t){if(Se(t))return Tp[Pe(t)]}function Ip(t){if(yr(t))return t;if(xp(t))return[t];const e=Rp(t);if(k(e))return[e]}function Op(t){const e=N.words[t],n=Ip(e);if(yr(n))return[n,t+1];const[r,i]=Gt(t),s=Ip(r);return yr(s)?[s,i]:[void 0,t]}function Kl(t){const e=[];let[n,r]=Op(t);for(;yr(n);){if(e.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=ne(N.words,r,[q.NUMBER,q.NUMBER]);e.push(o,a),r=c}const[i,s]=Op(r);n=i,r=s}return e.length?[e,r]:[void 0,t]}function Gi(t){return He(t)&&typeof t[0]=="string"}function Np(t){const e=N.words[t];if(Gi(e))return[e,t+1];const[n,r]=mc(t),[i,s]=Gt(r,!1);return Se(i)?[[i,n],s]:[void 0,t]}function ha(t){if(!Gi(t))return;const[e]=t;return e}function Cp(t){if(!Gi(t))return;const[,e]=t,n=k(e)?eC(e):void 0;return k(n)?n:void 0}function Lp(t){if(!Gi(t))return;const[,e]=t,n=k(e)?tC(e):void 0;return k(n)?n:void 0}const ze=60,rn=25;var Re=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Re||{});function Mp(t,e){const n=t??Ye.ISWALK,r=e??Ye.ISWALK;switch(n){case Ye.ISWALK:return r!==Ye.ISWALK;case Ye.ISSWIM:return r!==Ye.ISSWIM;case Ye.ISSOLID:return!0;case Ye.ISBULLET:return r!==Ye.ISWALK&&r!==Ye.ISSWIM}}function Up(t,e,n){const r=t==null?void 0:t.objects[n];if(k(r))return r;if(k(e)){const i=Us(t,"player"),s={x:e.x??0,y:e.y??0};Dp(s,i)}}function Us(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(k)}function Pp(t,e){const n=ha(e),r=Cp(e),i=Lp(e);return t.filter(s=>!(k(n)&&vf(s)!==n||k(r)&&aC(s)!==r||k(i)&&cC(s)!==i)).filter(k)}function ql(t,e){return k(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(k(i))return i;const s=Us(t,Pe(n));if(s.length)return s}else if(gr(n)&&n.x>=0&&n.x<ze&&n.y>=0&&n.y<rn){const i=n.x+n.y*ze,s=(r=t.lookup)==null?void 0:r[i];return k(s)?t.objects[s]:t.terrain[i]}}).flat().filter(k):[]}function Dp(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var Bp=typeof global=="object"&&global&&global.Object===Object&&global,Dk=typeof self=="object"&&self&&self.Object===Object&&self,Vn=Bp||Dk||Function("return this")(),fn=Vn.Symbol,Fp=Object.prototype,Bk=Fp.hasOwnProperty,Fk=Fp.toString,Ps=fn?fn.toStringTag:void 0;function $k(t){var e=Bk.call(t,Ps),n=t[Ps];try{t[Ps]=void 0;var r=!0}catch{}var i=Fk.call(t);return r&&(e?t[Ps]=n:delete t[Ps]),i}var jk=Object.prototype,zk=jk.toString;function Wk(t){return zk.call(t)}var Gk="[object Null]",Hk="[object Undefined]",$p=fn?fn.toStringTag:void 0;function jr(t){return t==null?t===void 0?Hk:Gk:$p&&$p in Object(t)?$k(t):Wk(t)}function In(t){return t!=null&&typeof t=="object"}var Vk="[object Symbol]";function da(t){return typeof t=="symbol"||In(t)&&jr(t)==Vk}function pa(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Me=Array.isArray,Kk=1/0,jp=fn?fn.prototype:void 0,zp=jp?jp.toString:void 0;function Wp(t){if(typeof t=="string")return t;if(Me(t))return pa(t,Wp)+"";if(da(t))return zp?zp.call(t):"";var e=t+"";return e=="0"&&1/t==-Kk?"-0":e}var qk=/\s/;function Jk(t){for(var e=t.length;e--&&qk.test(t.charAt(e)););return e}var Xk=/^\s+/;function Zk(t){return t&&t.slice(0,Jk(t)+1).replace(Xk,"")}function hn(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Gp=NaN,Yk=/^[-+]0x[0-9a-f]+$/i,Qk=/^0b[01]+$/i,e1=/^0o[0-7]+$/i,t1=parseInt;function n1(t){if(typeof t=="number")return t;if(da(t))return Gp;if(hn(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=hn(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Zk(t);var n=Qk.test(t);return n||e1.test(t)?t1(t.slice(2),n?2:8):Yk.test(t)?Gp:+t}var Hp=1/0,r1=17976931348623157e292;function i1(t){if(!t)return t===0?t:0;if(t=n1(t),t===Hp||t===-Hp){var e=t<0?-1:1;return e*r1}return t===t?t:0}function ma(t){var e=i1(t),n=e%1;return e===e?n?e-n:e:0}function Hi(t){return t}var s1="[object AsyncFunction]",o1="[object Function]",a1="[object GeneratorFunction]",c1="[object Proxy]";function _r(t){if(!hn(t))return!1;var e=jr(t);return e==o1||e==a1||e==s1||e==c1}var Jl=Vn["__core-js_shared__"],Vp=function(){var t=/[^.]+$/.exec(Jl&&Jl.keys&&Jl.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function l1(t){return!!Vp&&Vp in t}var u1=Function.prototype,f1=u1.toString;function fi(t){if(t!=null){try{return f1.call(t)}catch{}try{return t+""}catch{}}return""}var h1=/[\\^$.*+?()[\]{}|]/g,d1=/^\[object .+?Constructor\]$/,p1=Function.prototype,m1=Object.prototype,g1=p1.toString,y1=m1.hasOwnProperty,_1=RegExp("^"+g1.call(y1).replace(h1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function b1(t){if(!hn(t)||l1(t))return!1;var e=_r(t)?_1:d1;return e.test(fi(t))}function w1(t,e){return t==null?void 0:t[e]}function hi(t,e){var n=w1(t,e);return b1(n)?n:void 0}var Xl=hi(Vn,"WeakMap"),Kp=Object.create,v1=function(){function t(){}return function(e){if(!hn(e))return{};if(Kp)return Kp(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function E1(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function wt(){}function k1(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var S1=800,A1=16,T1=Date.now;function x1(t){var e=0,n=0;return function(){var r=T1(),i=A1-(r-n);if(n=r,i>0){if(++e>=S1)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function R1(t){return function(){return t}}var ga=function(){try{var t=hi(Object,"defineProperty");return t({},"",{}),t}catch{}}(),I1=ga?function(t,e){return ga(t,"toString",{configurable:!0,enumerable:!1,value:R1(e),writable:!0})}:Hi,O1=x1(I1);function qp(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function Jp(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function N1(t){return t!==t}function C1(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Zl(t,e,n){return e===e?C1(t,e,n):Jp(t,N1,n)}function Xp(t,e){var n=t==null?0:t.length;return!!n&&Zl(t,e,0)>-1}var L1=9007199254740991,M1=/^(?:0|[1-9]\d*)$/;function ya(t,e){var n=typeof t;return e=e??L1,!!e&&(n=="number"||n!="symbol"&&M1.test(t))&&t>-1&&t%1==0&&t<e}function Yl(t,e,n){e=="__proto__"&&ga?ga(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Ds(t,e){return t===e||t!==t&&e!==e}var U1=Object.prototype,P1=U1.hasOwnProperty;function _a(t,e,n){var r=t[e];(!(P1.call(t,e)&&Ds(r,n))||n===void 0&&!(e in t))&&Yl(t,e,n)}function Ql(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Yl(n,a,c):_a(n,a,c)}return n}var Zp=Math.max;function D1(t,e,n){return e=Zp(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=Zp(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),E1(t,this,a)}}function eu(t,e){return O1(D1(t,e,Hi),t+"")}var B1=9007199254740991;function tu(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=B1}function Kn(t){return t!=null&&tu(t.length)&&!_r(t)}function Yp(t,e,n){if(!hn(n))return!1;var r=typeof e;return(r=="number"?Kn(n)&&ya(e,n.length):r=="string"&&e in n)?Ds(n[e],t):!1}function F1(t){return eu(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&Yp(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var $1=Object.prototype;function Bs(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||$1;return t===n}function j1(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var z1="[object Arguments]";function Qp(t){return In(t)&&jr(t)==z1}var em=Object.prototype,W1=em.hasOwnProperty,G1=em.propertyIsEnumerable,ba=Qp(function(){return arguments}())?Qp:function(t){return In(t)&&W1.call(t,"callee")&&!G1.call(t,"callee")};function H1(){return!1}var tm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,nm=tm&&typeof module=="object"&&module&&!module.nodeType&&module,V1=nm&&nm.exports===tm,rm=V1?Vn.Buffer:void 0,K1=rm?rm.isBuffer:void 0,Fs=K1||H1,q1="[object Arguments]",J1="[object Array]",X1="[object Boolean]",Z1="[object Date]",Y1="[object Error]",Q1="[object Function]",eS="[object Map]",tS="[object Number]",nS="[object Object]",rS="[object RegExp]",iS="[object Set]",sS="[object String]",oS="[object WeakMap]",aS="[object ArrayBuffer]",cS="[object DataView]",lS="[object Float32Array]",uS="[object Float64Array]",fS="[object Int8Array]",hS="[object Int16Array]",dS="[object Int32Array]",pS="[object Uint8Array]",mS="[object Uint8ClampedArray]",gS="[object Uint16Array]",yS="[object Uint32Array]",Qe={};Qe[lS]=Qe[uS]=Qe[fS]=Qe[hS]=Qe[dS]=Qe[pS]=Qe[mS]=Qe[gS]=Qe[yS]=!0,Qe[q1]=Qe[J1]=Qe[aS]=Qe[X1]=Qe[cS]=Qe[Z1]=Qe[Y1]=Qe[Q1]=Qe[eS]=Qe[tS]=Qe[nS]=Qe[rS]=Qe[iS]=Qe[sS]=Qe[oS]=!1;function _S(t){return In(t)&&tu(t.length)&&!!Qe[jr(t)]}function wa(t){return function(e){return t(e)}}var im=typeof exports=="object"&&exports&&!exports.nodeType&&exports,$s=im&&typeof module=="object"&&module&&!module.nodeType&&module,bS=$s&&$s.exports===im,nu=bS&&Bp.process,zr=function(){try{var t=$s&&$s.require&&$s.require("util").types;return t||nu&&nu.binding&&nu.binding("util")}catch{}}(),sm=zr&&zr.isTypedArray,ru=sm?wa(sm):_S,wS=Object.prototype,vS=wS.hasOwnProperty;function om(t,e){var n=Me(t),r=!n&&ba(t),i=!n&&!r&&Fs(t),s=!n&&!r&&!i&&ru(t),o=n||r||i||s,a=o?j1(t.length,String):[],c=a.length;for(var l in t)(e||vS.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ya(l,c)))&&a.push(l);return a}function am(t,e){return function(n){return t(e(n))}}var ES=am(Object.keys,Object),kS=Object.prototype,SS=kS.hasOwnProperty;function cm(t){if(!Bs(t))return ES(t);var e=[];for(var n in Object(t))SS.call(t,n)&&n!="constructor"&&e.push(n);return e}function dn(t){return Kn(t)?om(t):cm(t)}var AS=Object.prototype,TS=AS.hasOwnProperty,Kt=F1(function(t,e){if(Bs(e)||Kn(e)){Ql(e,dn(e),t);return}for(var n in e)TS.call(e,n)&&_a(t,n,e[n])});function xS(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var RS=Object.prototype,IS=RS.hasOwnProperty;function OS(t){if(!hn(t))return xS(t);var e=Bs(t),n=[];for(var r in t)r=="constructor"&&(e||!IS.call(t,r))||n.push(r);return n}function lm(t){return Kn(t)?om(t,!0):OS(t)}var NS=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,CS=/^\w*$/;function iu(t,e){if(Me(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||da(t)?!0:CS.test(t)||!NS.test(t)||e!=null&&t in Object(e)}var js=hi(Object,"create");function LS(){this.__data__=js?js(null):{},this.size=0}function MS(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var US="__lodash_hash_undefined__",PS=Object.prototype,DS=PS.hasOwnProperty;function BS(t){var e=this.__data__;if(js){var n=e[t];return n===US?void 0:n}return DS.call(e,t)?e[t]:void 0}var FS=Object.prototype,$S=FS.hasOwnProperty;function jS(t){var e=this.__data__;return js?e[t]!==void 0:$S.call(e,t)}var zS="__lodash_hash_undefined__";function WS(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=js&&e===void 0?zS:e,this}function di(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}di.prototype.clear=LS,di.prototype.delete=MS,di.prototype.get=BS,di.prototype.has=jS,di.prototype.set=WS;function GS(){this.__data__=[],this.size=0}function va(t,e){for(var n=t.length;n--;)if(Ds(t[n][0],e))return n;return-1}var HS=Array.prototype,VS=HS.splice;function KS(t){var e=this.__data__,n=va(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():VS.call(e,n,1),--this.size,!0}function qS(t){var e=this.__data__,n=va(e,t);return n<0?void 0:e[n][1]}function JS(t){return va(this.__data__,t)>-1}function XS(t,e){var n=this.__data__,r=va(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function br(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}br.prototype.clear=GS,br.prototype.delete=KS,br.prototype.get=qS,br.prototype.has=JS,br.prototype.set=XS;var zs=hi(Vn,"Map");function ZS(){this.size=0,this.__data__={hash:new di,map:new(zs||br),string:new di}}function YS(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Ea(t,e){var n=t.__data__;return YS(e)?n[typeof e=="string"?"string":"hash"]:n.map}function QS(t){var e=Ea(this,t).delete(t);return this.size-=e?1:0,e}function eA(t){return Ea(this,t).get(t)}function tA(t){return Ea(this,t).has(t)}function nA(t,e){var n=Ea(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function wr(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}wr.prototype.clear=ZS,wr.prototype.delete=QS,wr.prototype.get=eA,wr.prototype.has=tA,wr.prototype.set=nA;var rA="Expected a function";function su(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(rA);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(su.Cache||wr),n}su.Cache=wr;var iA=500;function sA(t){var e=su(t,function(r){return n.size===iA&&n.clear(),r}),n=e.cache;return e}var oA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,aA=/\\(\\)?/g,cA=sA(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(oA,function(n,r,i,s){e.push(i?s.replace(aA,"$1"):r||n)}),e});function um(t){return t==null?"":Wp(t)}function ka(t,e){return Me(t)?t:iu(t,e)?[t]:cA(um(t))}var lA=1/0;function Ws(t){if(typeof t=="string"||da(t))return t;var e=t+"";return e=="0"&&1/t==-lA?"-0":e}function ou(t,e){e=ka(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[Ws(e[n++])];return n&&n==r?t:void 0}function uA(t,e,n){var r=t==null?void 0:ou(t,e);return r===void 0?n:r}function au(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var fm=fn?fn.isConcatSpreadable:void 0;function fA(t){return Me(t)||ba(t)||!!(fm&&t&&t[fm])}function cu(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=fA),i||(i=[]);++s<o;){var a=t[s];n(a)?au(i,a):r||(i[i.length]=a)}return i}function sn(t){var e=t==null?0:t.length;return e?cu(t):[]}var hm=am(Object.getPrototypeOf,Object);function lu(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function hA(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:lu(t,e,n)}var dA="\\ud800-\\udfff",pA="\\u0300-\\u036f",mA="\\ufe20-\\ufe2f",gA="\\u20d0-\\u20ff",yA=pA+mA+gA,_A="\\ufe0e\\ufe0f",bA="\\u200d",wA=RegExp("["+bA+dA+yA+_A+"]");function dm(t){return wA.test(t)}function vA(t){return t.split("")}var pm="\\ud800-\\udfff",EA="\\u0300-\\u036f",kA="\\ufe20-\\ufe2f",SA="\\u20d0-\\u20ff",AA=EA+kA+SA,TA="\\ufe0e\\ufe0f",xA="["+pm+"]",uu="["+AA+"]",fu="\\ud83c[\\udffb-\\udfff]",RA="(?:"+uu+"|"+fu+")",mm="[^"+pm+"]",gm="(?:\\ud83c[\\udde6-\\uddff]){2}",ym="[\\ud800-\\udbff][\\udc00-\\udfff]",IA="\\u200d",_m=RA+"?",bm="["+TA+"]?",OA="(?:"+IA+"(?:"+[mm,gm,ym].join("|")+")"+bm+_m+")*",NA=bm+_m+OA,CA="(?:"+[mm+uu+"?",uu,gm,ym,xA].join("|")+")",LA=RegExp(fu+"(?="+fu+")|"+CA+NA,"g");function MA(t){return t.match(LA)||[]}function UA(t){return dm(t)?MA(t):vA(t)}function PA(t){return function(e){e=um(e);var n=dm(e)?UA(e):void 0,r=n?n[0]:e.charAt(0),i=n?hA(n,1).join(""):e.slice(1);return r[t]()+i}}var wm=PA("toUpperCase");function DA(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function BA(){this.__data__=new br,this.size=0}function FA(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function $A(t){return this.__data__.get(t)}function jA(t){return this.__data__.has(t)}var zA=200;function WA(t,e){var n=this.__data__;if(n instanceof br){var r=n.__data__;if(!zs||r.length<zA-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new wr(r)}return n.set(t,e),this.size=n.size,this}function qn(t){var e=this.__data__=new br(t);this.size=e.size}qn.prototype.clear=BA,qn.prototype.delete=FA,qn.prototype.get=$A,qn.prototype.has=jA,qn.prototype.set=WA;function GA(t,e){return t&&Ql(e,dn(e),t)}var vm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Em=vm&&typeof module=="object"&&module&&!module.nodeType&&module,HA=Em&&Em.exports===vm,km=HA?Vn.Buffer:void 0,Sm=km?km.allocUnsafe:void 0;function VA(t,e){var n=t.length,r=Sm?Sm(n):new t.constructor(n);return t.copy(r),r}function hu(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Am(){return[]}var KA=Object.prototype,qA=KA.propertyIsEnumerable,Tm=Object.getOwnPropertySymbols,du=Tm?function(t){return t==null?[]:(t=Object(t),hu(Tm(t),function(e){return qA.call(t,e)}))}:Am;function JA(t,e){return Ql(t,du(t),e)}var XA=Object.getOwnPropertySymbols,ZA=XA?function(t){for(var e=[];t;)au(e,du(t)),t=hm(t);return e}:Am;function xm(t,e,n){var r=e(t);return Me(t)?r:au(r,n(t))}function pu(t){return xm(t,dn,du)}function YA(t){return xm(t,lm,ZA)}var mu=hi(Vn,"DataView"),gu=hi(Vn,"Promise"),Vi=hi(Vn,"Set"),Rm="[object Map]",QA="[object Object]",Im="[object Promise]",Om="[object Set]",Nm="[object WeakMap]",Cm="[object DataView]",eT=fi(mu),tT=fi(zs),nT=fi(gu),rT=fi(Vi),iT=fi(Xl),pn=jr;(mu&&pn(new mu(new ArrayBuffer(1)))!=Cm||zs&&pn(new zs)!=Rm||gu&&pn(gu.resolve())!=Im||Vi&&pn(new Vi)!=Om||Xl&&pn(new Xl)!=Nm)&&(pn=function(t){var e=jr(t),n=e==QA?t.constructor:void 0,r=n?fi(n):"";if(r)switch(r){case eT:return Cm;case tT:return Rm;case nT:return Im;case rT:return Om;case iT:return Nm}return e});var sT=Object.prototype,oT=sT.hasOwnProperty;function aT(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&oT.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Sa=Vn.Uint8Array;function cT(t){var e=new t.constructor(t.byteLength);return new Sa(e).set(new Sa(t)),e}function lT(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var uT=/\w*$/;function fT(t){var e=new t.constructor(t.source,uT.exec(t));return e.lastIndex=t.lastIndex,e}var Lm=fn?fn.prototype:void 0,Mm=Lm?Lm.valueOf:void 0;function hT(t){return Mm?Object(Mm.call(t)):{}}function dT(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var pT="[object Boolean]",mT="[object Date]",gT="[object Map]",yT="[object Number]",_T="[object RegExp]",bT="[object Set]",wT="[object String]",vT="[object Symbol]",ET="[object ArrayBuffer]",kT="[object DataView]",ST="[object Float32Array]",AT="[object Float64Array]",TT="[object Int8Array]",xT="[object Int16Array]",RT="[object Int32Array]",IT="[object Uint8Array]",OT="[object Uint8ClampedArray]",NT="[object Uint16Array]",CT="[object Uint32Array]";function LT(t,e,n){var r=t.constructor;switch(e){case ET:return cT(t);case pT:case mT:return new r(+t);case kT:return lT(t);case ST:case AT:case TT:case xT:case RT:case IT:case OT:case NT:case CT:return dT(t);case gT:return new r;case yT:case wT:return new r(t);case _T:return fT(t);case bT:return new r;case vT:return hT(t)}}function MT(t){return typeof t.constructor=="function"&&!Bs(t)?v1(hm(t)):{}}var UT="[object Map]";function PT(t){return In(t)&&pn(t)==UT}var Um=zr&&zr.isMap,DT=Um?wa(Um):PT,BT="[object Set]";function FT(t){return In(t)&&pn(t)==BT}var Pm=zr&&zr.isSet,$T=Pm?wa(Pm):FT,Dm="[object Arguments]",jT="[object Array]",zT="[object Boolean]",WT="[object Date]",GT="[object Error]",Bm="[object Function]",HT="[object GeneratorFunction]",VT="[object Map]",KT="[object Number]",Fm="[object Object]",qT="[object RegExp]",JT="[object Set]",XT="[object String]",ZT="[object Symbol]",YT="[object WeakMap]",QT="[object ArrayBuffer]",ex="[object DataView]",tx="[object Float32Array]",nx="[object Float64Array]",rx="[object Int8Array]",ix="[object Int16Array]",sx="[object Int32Array]",ox="[object Uint8Array]",ax="[object Uint8ClampedArray]",cx="[object Uint16Array]",lx="[object Uint32Array]",Ke={};Ke[Dm]=Ke[jT]=Ke[QT]=Ke[ex]=Ke[zT]=Ke[WT]=Ke[tx]=Ke[nx]=Ke[rx]=Ke[ix]=Ke[sx]=Ke[VT]=Ke[KT]=Ke[Fm]=Ke[qT]=Ke[JT]=Ke[XT]=Ke[ZT]=Ke[ox]=Ke[ax]=Ke[cx]=Ke[lx]=!0,Ke[GT]=Ke[Bm]=Ke[YT]=!1;function Aa(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!hn(t))return t;var a=Me(t);if(a)return o=aT(t),k1(t,o);var c=pn(t),l=c==Bm||c==HT;if(Fs(t))return VA(t);if(c==Fm||c==Dm||l&&!i)return o=l?{}:MT(t),JA(t,GA(o,t));if(!Ke[c])return i?t:{};o=LT(t,c),s||(s=new qn);var u=s.get(t);if(u)return u;s.set(t,o),$T(t)?t.forEach(function(h){o.add(Aa(h,e,n,h,t,s))}):DT(t)&&t.forEach(function(h,p){o.set(p,Aa(h,e,n,p,t,s))});var f=pu,d=a?void 0:f(t);return qp(d||t,function(h,p){d&&(p=h,h=t[p]),_a(o,p,Aa(h,e,n,p,t,s))}),o}var ux=4;function Ct(t){return Aa(t,ux)}function Gs(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var fx="__lodash_hash_undefined__";function hx(t){return this.__data__.set(t,fx),this}function dx(t){return this.__data__.has(t)}function Ki(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new wr;++e<n;)this.add(t[e])}Ki.prototype.add=Ki.prototype.push=hx,Ki.prototype.has=dx;function $m(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function yu(t,e){return t.has(e)}var px=1,mx=2;function jm(t,e,n,r,i,s){var o=n&px,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var f=-1,d=!0,h=n&mx?new Ki:void 0;for(s.set(t,e),s.set(e,t);++f<a;){var p=t[f],m=e[f];if(r)var b=o?r(m,p,f,e,t,s):r(p,m,f,t,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!$m(e,function(_,w){if(!yu(h,w)&&(p===_||i(p,_,n,r,s)))return h.push(w)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function gx(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function _u(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var yx=1,_x=2,bx="[object Boolean]",wx="[object Date]",vx="[object Error]",Ex="[object Map]",kx="[object Number]",Sx="[object RegExp]",Ax="[object Set]",Tx="[object String]",xx="[object Symbol]",Rx="[object ArrayBuffer]",Ix="[object DataView]",zm=fn?fn.prototype:void 0,bu=zm?zm.valueOf:void 0;function Ox(t,e,n,r,i,s,o){switch(n){case Ix:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Rx:return!(t.byteLength!=e.byteLength||!s(new Sa(t),new Sa(e)));case bx:case wx:case kx:return Ds(+t,+e);case vx:return t.name==e.name&&t.message==e.message;case Sx:case Tx:return t==e+"";case Ex:var a=gx;case Ax:var c=r&yx;if(a||(a=_u),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=_x,o.set(t,e);var u=jm(a(t),a(e),r,i,s,o);return o.delete(t),u;case xx:if(bu)return bu.call(t)==bu.call(e)}return!1}var Nx=1,Cx=Object.prototype,Lx=Cx.hasOwnProperty;function Mx(t,e,n,r,i,s){var o=n&Nx,a=pu(t),c=a.length,l=pu(e),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in e:Lx.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var b=o;++f<c;){d=a[f];var _=t[d],w=e[d];if(r)var v=o?r(w,_,d,e,t,s):r(_,w,d,t,e,s);if(!(v===void 0?_===w||i(_,w,n,r,s):v)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var S=t.constructor,L=e.constructor;S!=L&&"constructor"in t&&"constructor"in e&&!(typeof S=="function"&&S instanceof S&&typeof L=="function"&&L instanceof L)&&(m=!1)}return s.delete(t),s.delete(e),m}var Ux=1,Wm="[object Arguments]",Gm="[object Array]",Ta="[object Object]",Px=Object.prototype,Hm=Px.hasOwnProperty;function Dx(t,e,n,r,i,s){var o=Me(t),a=Me(e),c=o?Gm:pn(t),l=a?Gm:pn(e);c=c==Wm?Ta:c,l=l==Wm?Ta:l;var u=c==Ta,f=l==Ta,d=c==l;if(d&&Fs(t)){if(!Fs(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new qn),o||ru(t)?jm(t,e,n,r,i,s):Ox(t,e,c,n,r,i,s);if(!(n&Ux)){var h=u&&Hm.call(t,"__wrapped__"),p=f&&Hm.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,b=p?e.value():e;return s||(s=new qn),i(m,b,n,r,s)}}return d?(s||(s=new qn),Mx(t,e,n,r,i,s)):!1}function wu(t,e,n,r,i){return t===e?!0:t==null||e==null||!In(t)&&!In(e)?t!==t&&e!==e:Dx(t,e,n,r,wu,i)}var Bx=1,Fx=2;function $x(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new qn,f;if(!(f===void 0?wu(l,c,Bx|Fx,r,u):f))return!1}}return!0}function Vm(t){return t===t&&!hn(t)}function jx(t){for(var e=dn(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Vm(i)]}return e}function Km(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function zx(t){var e=jx(t);return e.length==1&&e[0][2]?Km(e[0][0],e[0][1]):function(n){return n===t||$x(n,t,e)}}function Wx(t,e){return t!=null&&e in Object(t)}function qm(t,e,n){e=ka(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=Ws(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&tu(i)&&ya(o,i)&&(Me(t)||ba(t)))}function Gx(t,e){return t!=null&&qm(t,e,Wx)}var Hx=1,Vx=2;function Kx(t,e){return iu(t)&&Vm(e)?Km(Ws(t),e):function(n){var r=uA(n,t);return r===void 0&&r===e?Gx(n,t):wu(e,r,Hx|Vx)}}function qx(t){return function(e){return e==null?void 0:e[t]}}function Jx(t){return function(e){return ou(e,t)}}function Xx(t){return iu(t)?qx(Ws(t)):Jx(t)}function Jn(t){return typeof t=="function"?t:t==null?Hi:typeof t=="object"?Me(t)?Kx(t[0],t[1]):zx(t):Xx(t)}function Zx(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Yx(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var Qx=Yx();function eR(t,e){return t&&Qx(t,e,dn)}function tR(t,e){return function(n,r){if(n==null)return n;if(!Kn(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var pi=tR(eR);function nR(t,e,n,r){return pi(t,function(i,s,o){e(r,i,n(i),o)}),r}function rR(t,e){return function(n,r){var i=Me(n)?Zx:nR,s=e?e():{};return i(n,t,Jn(r),s)}}var Jm=Object.prototype,iR=Jm.hasOwnProperty,vu=eu(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&Yp(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=lm(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||Ds(u,Jm[l])&&!iR.call(t,l))&&(t[l]=s[l])}return t});function Xm(t){return In(t)&&Kn(t)}var sR=200;function oR(t,e,n,r){var i=-1,s=Xp,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=sR&&(s=yu,o=!1,e=new Ki(e));e:for(;++i<a;){var u=t[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(e[d]===f)continue e;c.push(u)}else s(e,f,r)||c.push(u)}return c}var xa=eu(function(t,e){return Xm(t)?oR(t,cu(e,1,Xm,!0)):[]});function qi(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Lt(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ma(e),lu(t,e<0?0:e,r)):[]}function Hs(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ma(e),e=r-e,lu(t,0,e<0?0:e)):[]}function aR(t){return typeof t=="function"?t:Hi}function me(t,e){var n=Me(t)?qp:pi;return n(t,aR(e))}function cR(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function lR(t,e){var n=!0;return pi(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function On(t,e,n){var r=Me(t)?cR:lR;return r(t,Jn(e))}function Zm(t,e){var n=[];return pi(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function mn(t,e){var n=Me(t)?hu:Zm;return n(t,Jn(e))}function uR(t){return function(e,n,r){var i=Object(e);if(!Kn(e)){var s=Jn(n);e=dn(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var fR=Math.max;function hR(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:ma(n);return i<0&&(i=fR(r+i,0)),Jp(t,Jn(e),i)}var Ji=uR(hR);function Nn(t){return t&&t.length?t[0]:void 0}function dR(t,e){var n=-1,r=Kn(t)?Array(t.length):[];return pi(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function ce(t,e){var n=Me(t)?pa:dR;return n(t,Jn(e))}function gn(t,e){return cu(ce(t,e))}var pR=Object.prototype,mR=pR.hasOwnProperty,Ym=rR(function(t,e,n){mR.call(t,n)?t[n].push(e):Yl(t,n,[e])}),gR=Object.prototype,yR=gR.hasOwnProperty;function _R(t,e){return t!=null&&yR.call(t,e)}function pe(t,e){return t!=null&&qm(t,e,_R)}var bR="[object String]";function qt(t){return typeof t=="string"||!Me(t)&&In(t)&&jr(t)==bR}function wR(t,e){return pa(e,function(n){return t[n]})}function dt(t){return t==null?[]:wR(t,dn(t))}var vR=Math.max;function $t(t,e,n,r){t=Kn(t)?t:dt(t),n=n&&!r?ma(n):0;var i=t.length;return n<0&&(n=vR(i+n,0)),qt(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Zl(t,e,n)>-1}function Qm(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return Zl(t,e,i)}var ER="[object Map]",kR="[object Set]",SR=Object.prototype,AR=SR.hasOwnProperty;function qe(t){if(t==null)return!0;if(Kn(t)&&(Me(t)||typeof t=="string"||typeof t.splice=="function"||Fs(t)||ru(t)||ba(t)))return!t.length;var e=pn(t);if(e==ER||e==kR)return!t.size;if(Bs(t))return!cm(t).length;for(var n in t)if(AR.call(t,n))return!1;return!0}var TR="[object RegExp]";function xR(t){return In(t)&&jr(t)==TR}var eg=zr&&zr.isRegExp,vr=eg?wa(eg):xR;function Er(t){return t===void 0}var RR="Expected a function";function IR(t){if(typeof t!="function")throw new TypeError(RR);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function OR(t,e,n,r){if(!hn(t))return t;e=ka(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=Ws(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=hn(u)?u:ya(e[i+1])?[]:{})}_a(a,c,l),a=a[c]}return t}function NR(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=ou(t,o);n(a,o)&&OR(s,ka(o,t),a)}return s}function Cn(t,e){if(t==null)return{};var n=pa(YA(t),function(r){return[r]});return e=Jn(e),NR(t,n,function(r,i){return e(r,i[0])})}function CR(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Jt(t,e,n){var r=Me(t)?DA:CR,i=arguments.length<3;return r(t,Jn(e),n,i,pi)}function Ra(t,e){var n=Me(t)?hu:Zm;return n(t,IR(Jn(e)))}function LR(t,e){var n;return pi(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function Eu(t,e,n){var r=Me(t)?$m:LR;return r(t,Jn(e))}var MR=1/0,UR=Vi&&1/_u(new Vi([,-0]))[1]==MR?function(t){return new Vi(t)}:wt,PR=200;function DR(t,e,n){var r=-1,i=Xp,s=t.length,o=!0,a=[],c=a;if(s>=PR){var l=UR(t);if(l)return _u(l);o=!1,i=yu,c=new Ki}else c=a;e:for(;++r<s;){var u=t[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue e;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function Ia(t){return t&&t.length?DR(t):[]}function ku(t){console&&console.error&&console.error(`Error: ${t}`)}function tg(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function ng(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function rg(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function BR(t){return FR(t)?t.LABEL:t.name}function FR(t){return qt(t.LABEL)&&t.LABEL!==""}class Xn{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),me(this.definition,n=>{n.accept(e)})}}class Xt extends Xn{constructor(e){super([]),this.idx=1,Kt(this,Cn(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Xi extends Xn{constructor(e){super(e.definition),this.orgText="",Kt(this,Cn(e,n=>n!==void 0))}}class Zt extends Xn{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Kt(this,Cn(e,n=>n!==void 0))}}class Yt extends Xn{constructor(e){super(e.definition),this.idx=1,Kt(this,Cn(e,n=>n!==void 0))}}class Zn extends Xn{constructor(e){super(e.definition),this.idx=1,Kt(this,Cn(e,n=>n!==void 0))}}class Yn extends Xn{constructor(e){super(e.definition),this.idx=1,Kt(this,Cn(e,n=>n!==void 0))}}class vt extends Xn{constructor(e){super(e.definition),this.idx=1,Kt(this,Cn(e,n=>n!==void 0))}}class Ln extends Xn{constructor(e){super(e.definition),this.idx=1,Kt(this,Cn(e,n=>n!==void 0))}}class Mn extends Xn{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Kt(this,Cn(e,n=>n!==void 0))}}class nt{constructor(e){this.idx=1,Kt(this,Cn(e,n=>n!==void 0))}accept(e){e.visit(this)}}function $R(t){return ce(t,Oa)}function Oa(t){function e(n){return ce(n,Oa)}if(t instanceof Xt){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return qt(t.label)&&(n.label=t.label),n}else{if(t instanceof Zt)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Yt)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Zn)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Yn)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Oa(new nt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Ln)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Oa(new nt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof vt)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Mn)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof nt){const n={type:"Terminal",name:t.terminalType.name,label:BR(t.terminalType),idx:t.idx};qt(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=vr(r)?r.source:r),n}else{if(t instanceof Xi)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class mi{visit(e){const n=e;switch(n.constructor){case Xt:return this.visitNonTerminal(n);case Zt:return this.visitAlternative(n);case Yt:return this.visitOption(n);case Zn:return this.visitRepetitionMandatory(n);case Yn:return this.visitRepetitionMandatoryWithSeparator(n);case Ln:return this.visitRepetitionWithSeparator(n);case vt:return this.visitRepetition(n);case Mn:return this.visitAlternation(n);case nt:return this.visitTerminal(n);case Xi:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function jR(t){return t instanceof Zt||t instanceof Yt||t instanceof vt||t instanceof Zn||t instanceof Yn||t instanceof Ln||t instanceof nt||t instanceof Xi}function Na(t,e=[]){return t instanceof Yt||t instanceof vt||t instanceof Ln?!0:t instanceof Mn?Eu(t.definition,r=>Na(r,e)):t instanceof Xt&&$t(e,t)?!1:t instanceof Xn?(t instanceof Xt&&e.push(t),On(t.definition,r=>Na(r,e))):!1}function zR(t){return t instanceof Mn}function Qn(t){if(t instanceof Xt)return"SUBRULE";if(t instanceof Yt)return"OPTION";if(t instanceof Mn)return"OR";if(t instanceof Zn)return"AT_LEAST_ONE";if(t instanceof Yn)return"AT_LEAST_ONE_SEP";if(t instanceof Ln)return"MANY_SEP";if(t instanceof vt)return"MANY";if(t instanceof nt)return"CONSUME";throw Error("non exhaustive match")}class Ca{walk(e,n=[]){me(e.definition,(r,i)=>{const s=Lt(e.definition,i+1);if(r instanceof Xt)this.walkProdRef(r,s,n);else if(r instanceof nt)this.walkTerminal(r,s,n);else if(r instanceof Zt)this.walkFlat(r,s,n);else if(r instanceof Yt)this.walkOption(r,s,n);else if(r instanceof Zn)this.walkAtLeastOne(r,s,n);else if(r instanceof Yn)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Ln)this.walkManySep(r,s,n);else if(r instanceof vt)this.walkMany(r,s,n);else if(r instanceof Mn)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Yt({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=ig(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Yt({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=ig(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);me(e.definition,s=>{const o=new Zt({definition:[s]});this.walk(o,i)})}}function ig(t,e,n){return[new Yt({definition:[new nt({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function Vs(t){if(t instanceof Xt)return Vs(t.referencedRule);if(t instanceof nt)return HR(t);if(jR(t))return WR(t);if(zR(t))return GR(t);throw Error("non exhaustive match")}function WR(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Na(s),e=e.concat(Vs(s)),r=r+1,i=n.length>r;return Ia(e)}function GR(t){const e=ce(t.definition,n=>Vs(n));return Ia(sn(e))}function HR(t){return[t.terminalType]}const sg="_~IN~_";class VR extends Ca{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=qR(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new Zt({definition:s}),a=Vs(o);this.follows[i]=a}}function KR(t){const e={};return me(t,n=>{const r=new VR(n).startWalking();Kt(e,r)}),e}function qR(t,e){return t.name+e+sg}function ge(t){return t.charCodeAt(0)}function Su(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function Ks(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Zi(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function JR(){throw Error("Internal Error - Should never get here!")}function og(t){return t.type==="Character"}const La=[];for(let t=ge("0");t<=ge("9");t++)La.push(t);const Ma=[ge("_")].concat(La);for(let t=ge("a");t<=ge("z");t++)Ma.push(t);for(let t=ge("A");t<=ge("Z");t++)Ma.push(t);const ag=[ge(" "),ge("\f"),ge(`
`),ge("\r"),ge("	"),ge("\v"),ge("	"),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge("\u2028"),ge("\u2029"),ge(" "),ge(" "),ge("　"),ge("\uFEFF")],XR=/[0-9a-fA-F]/,Ua=/[0-9]/,ZR=/[1-9]/;class YR{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Ks(r,"global");break;case"i":Ks(r,"ignoreCase");break;case"m":Ks(r,"multiLine");break;case"u":Ks(r,"unicode");break;case"y":Ks(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Zi(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return JR()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Zi(n);break}if(!(e===!0&&n===void 0)&&Zi(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Zi(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[ge(`
`),ge("\r"),ge("\u2028"),ge("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=La;break;case"D":e=La,n=!0;break;case"s":e=ag;break;case"S":e=ag,n=!0;break;case"w":e=Ma;break;case"W":e=Ma,n=!0;break}if(Zi(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=ge("\f");break;case"n":e=ge(`
`);break;case"r":e=ge("\r");break;case"t":e=ge("	");break;case"v":e=ge("\v");break}if(Zi(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:ge("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:ge(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:ge(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,og(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,og(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else Su(r.value,e),e.push(ge("-")),Su(i.value,e)}else Su(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:ge("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(ZR.test(e)===!1)throw Error("Expecting a positive integer");for(;Ua.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Ua.test(e)===!1)throw Error("Expecting an integer");for(;Ua.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:ge(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Ua.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(XR.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class Au{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let Pa={};const QR=new YR;function Da(t){const e=t.toString();if(Pa.hasOwnProperty(e))return Pa[e];{const n=QR.pattern(e);return Pa[e]=n,n}}function eI(){Pa={}}const cg="Complement Sets are not supported for first char optimization",Ba=`Unable to use "first char" lexer optimizations:
`;function tI(t,e=!1){try{const n=Da(t);return Tu(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===cg)e&&tg(`${Ba}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),ku(`${Ba}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Tu(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)Tu(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Fa(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(cg);me(o.value,c=>{if(typeof c=="number")Fa(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Fa(u,e,n);else{for(let u=l.from;u<=l.to&&u<Js;u++)Fa(u,e,n);if(l.to>=Js){const u=l.from>=Js?l.from:Js,f=l.to,d=Wr(u),h=Wr(f);for(let p=d;p<=h;p++)e[p]=p}}}});break;case"Group":Tu(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&xu(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return dt(e)}function Fa(t,e,n){const r=Wr(t);e[r]=r,n===!0&&nI(t,e)}function nI(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=Wr(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Wr(i.charCodeAt(0));e[s]=s}}}function lg(t,e){return Ji(t.value,n=>{if(typeof n=="number")return $t(e,n);{const r=n;return Ji(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function xu(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Me(t.value)?On(t.value,xu):xu(t.value):!1}class rI extends Au{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){$t(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?lg(e,this.targetCharCodes)===void 0&&(this.found=!0):lg(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Ru(t,e){if(e instanceof RegExp){const n=Da(e),r=new rI(t);return r.visit(n),r.found}else return Ji(e,n=>$t(t,n.charCodeAt(0)))!==void 0}const gi="PATTERN",qs="defaultMode",$a="modes";let ug=typeof new RegExp("(?:)").sticky=="boolean";function iI(t,e){e=vu(e,{useSticky:ug,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(w,v)=>v()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{xI()});let r;n("Reject Lexer.NA",()=>{r=Ra(t,w=>w[gi]===Et.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=ce(r,w=>{const v=w[gi];if(vr(v)){const S=v.source;return S.length===1&&S!=="^"&&S!=="$"&&S!=="."&&!v.ignoreCase?S:S.length===2&&S[0]==="\\"&&!$t(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],S[1])?S[1]:e.useSticky?hg(v):fg(v)}else{if(_r(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const S=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),L=new RegExp(S);return e.useSticky?hg(L):fg(L)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=ce(r,w=>w.tokenTypeIdx),a=ce(r,w=>{const v=w.GROUP;if(v!==Et.SKIPPED){if(qt(v))return v;if(Er(v))return!1;throw Error("non exhaustive match")}}),c=ce(r,w=>{const v=w.LONGER_ALT;if(v)return Me(v)?ce(v,L=>Qm(r,L)):[Qm(r,v)]}),l=ce(r,w=>w.PUSH_MODE),u=ce(r,w=>pe(w,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const w=mg(e.lineTerminatorCharacters);f=ce(r,v=>!1),e.positionTracking!=="onlyOffset"&&(f=ce(r,v=>pe(v,"LINE_BREAKS")?!!v.LINE_BREAKS:pg(v,w)===!1&&Ru(w,v.PATTERN)))});let d,h,p,m;n("Misc Mapping #2",()=>{d=ce(r,dg),h=ce(s,SI),p=Jt(r,(w,v)=>{const S=v.GROUP;return qt(S)&&S!==Et.SKIPPED&&(w[S]=[]),w},{}),m=ce(s,(w,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:f[v],isCustom:d[v],short:h[v],group:a[v],push:l[v],pop:u[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let b=!0,_=[];return e.safeMode||n("First Char Optimization",()=>{_=Jt(r,(w,v,S)=>{if(typeof v.PATTERN=="string"){const L=v.PATTERN.charCodeAt(0),I=Wr(L);Iu(w,I,m[S])}else if(Me(v.START_CHARS_HINT)){let L;me(v.START_CHARS_HINT,I=>{const T=typeof I=="string"?I.charCodeAt(0):I,M=Wr(T);L!==M&&(L=M,Iu(w,M,m[S]))})}else if(vr(v.PATTERN))if(v.PATTERN.unicode)b=!1,e.ensureOptimizations&&ku(`${Ba}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const L=tI(v.PATTERN,e.ensureOptimizations);qe(L)&&(b=!1),me(L,I=>{Iu(w,I,m[S])})}else e.ensureOptimizations&&ku(`${Ba}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return w},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:_,hasCustom:i,canBeOptimized:b}}function sI(t,e){let n=[];const r=aI(t);n=n.concat(r.errors);const i=cI(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(oI(s)),n=n.concat(gI(s)),n=n.concat(yI(s,e)),n=n.concat(_I(s)),n}function oI(t){let e=[];const n=mn(t,r=>vr(r[gi]));return e=e.concat(uI(n)),e=e.concat(dI(n)),e=e.concat(pI(n)),e=e.concat(mI(n)),e=e.concat(fI(n)),e}function aI(t){const e=mn(t,i=>!pe(i,gi)),n=ce(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:at.MISSING_PATTERN,tokenTypes:[i]})),r=xa(t,e);return{errors:n,valid:r}}function cI(t){const e=mn(t,i=>{const s=i[gi];return!vr(s)&&!_r(s)&&!pe(s,"exec")&&!qt(s)}),n=ce(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:at.INVALID_PATTERN,tokenTypes:[i]})),r=xa(t,e);return{errors:n,valid:r}}const lI=/[^\\][$]/;function uI(t){class e extends Au{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=mn(t,i=>{const s=i.PATTERN;try{const o=Da(s),a=new e;return a.visit(o),a.found}catch{return lI.test(s.source)}});return ce(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:at.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function fI(t){const e=mn(t,r=>r.PATTERN.test(""));return ce(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:at.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const hI=/[^\\[][\^]|^\^/;function dI(t){class e extends Au{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=mn(t,i=>{const s=i.PATTERN;try{const o=Da(s),a=new e;return a.visit(o),a.found}catch{return hI.test(s.source)}});return ce(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:at.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function pI(t){const e=mn(t,r=>{const i=r[gi];return i instanceof RegExp&&(i.multiline||i.global)});return ce(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:at.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function mI(t){const e=[];let n=ce(t,s=>Jt(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!$t(e,a)&&a.PATTERN!==Et.NA&&(e.push(a),o.push(a)),o),[]));n=Gs(n);const r=mn(n,s=>s.length>1);return ce(r,s=>{const o=ce(s,c=>c.name);return{message:`The same RegExp pattern ->${Nn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:at.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function gI(t){const e=mn(t,r=>{if(!pe(r,"GROUP"))return!1;const i=r.GROUP;return i!==Et.SKIPPED&&i!==Et.NA&&!qt(i)});return ce(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:at.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function yI(t,e){const n=mn(t,i=>i.PUSH_MODE!==void 0&&!$t(e,i.PUSH_MODE));return ce(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:at.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function _I(t){const e=[],n=Jt(t,(r,i,s)=>{const o=i.PATTERN;return o===Et.NA||(qt(o)?r.push({str:o,idx:s,tokenType:i}):vr(o)&&wI(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return me(t,(r,i)=>{me(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&bI(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:at.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function bI(t,e){if(vr(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(_r(e))return e(t,0,[],{});if(pe(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function wI(t){return Ji([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function fg(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function hg(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function vI(t,e,n){const r=[];return pe(t,qs)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+qs+`> property in its definition
`,type:at.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),pe(t,$a)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+$a+`> property in its definition
`,type:at.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),pe(t,$a)&&pe(t,qs)&&!pe(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${qs}: <${t.defaultMode}>which does not exist
`,type:at.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),pe(t,$a)&&me(t.modes,(i,s)=>{me(i,(o,a)=>{if(Er(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:at.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(pe(o,"LONGER_ALT")){const c=Me(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];me(c,l=>{!Er(l)&&!$t(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:at.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function EI(t,e,n){const r=[];let i=!1;const s=Gs(sn(dt(t.modes))),o=Ra(s,c=>c[gi]===Et.NA),a=mg(n);return e&&me(o,c=>{const l=pg(c,a);if(l!==!1){const f={message:TI(c,l),type:l.issue,tokenType:c};r.push(f)}else pe(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Ru(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:at.NO_LINE_BREAKS_FLAGS}),r}function kI(t){const e={},n=dn(t);return me(n,r=>{const i=t[r];if(Me(i))e[r]=[];else throw Error("non exhaustive match")}),e}function dg(t){const e=t.PATTERN;if(vr(e))return!1;if(_r(e))return!0;if(pe(e,"exec"))return!0;if(qt(e))return!1;throw Error("non exhaustive match")}function SI(t){return qt(t)&&t.length===1?t.charCodeAt(0):!1}const AI={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function pg(t,e){if(pe(t,"LINE_BREAKS"))return!1;if(vr(t.PATTERN)){try{Ru(e,t.PATTERN)}catch(n){return{issue:at.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(qt(t.PATTERN))return!1;if(dg(t))return{issue:at.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function TI(t,e){if(e.issue===at.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===at.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function mg(t){return ce(t,n=>qt(n)?n.charCodeAt(0):n)}function Iu(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Js=256;let ja=[];function Wr(t){return t<Js?t:ja[t]}function xI(){if(qe(ja)){ja=new Array(65536);for(let t=0;t<65536;t++)ja[t]=t>255?255+~~(t/255):t}}function Xs(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function za(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let gg=1;const yg={};function Zs(t){const e=RI(t);II(e),NI(e),OI(e),me(e,n=>{n.isParent=n.categoryMatches.length>0})}function RI(t){let e=Ct(t),n=t,r=!0;for(;r;){n=Gs(sn(ce(n,s=>s.CATEGORIES)));const i=xa(n,e);e=e.concat(i),qe(i)?r=!1:n=i}return e}function II(t){me(t,e=>{bg(e)||(yg[gg]=e,e.tokenTypeIdx=gg++),wg(e)&&!Me(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),wg(e)||(e.CATEGORIES=[]),CI(e)||(e.categoryMatches=[]),LI(e)||(e.categoryMatchesMap={})})}function OI(t){me(t,e=>{e.categoryMatches=[],me(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(yg[r].tokenTypeIdx)})})}function NI(t){me(t,e=>{_g([],e)})}function _g(t,e){me(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),me(e.CATEGORIES,n=>{const r=t.concat(e);$t(r,n)||_g(r,n)})}function bg(t){return pe(t,"tokenTypeIdx")}function wg(t){return pe(t,"CATEGORIES")}function CI(t){return pe(t,"categoryMatches")}function LI(t){return pe(t,"categoryMatchesMap")}function MI(t){return pe(t,"tokenTypeIdx")}const UI={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var at;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(at||(at={}));const Ys={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:UI,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Ys);class Et{constructor(e,n=Ys){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=ng(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Kt({},Ys,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Ys.lineTerminatorsPattern)this.config.lineTerminatorsPattern=AI;else if(this.config.lineTerminatorCharacters===Ys.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Me(e)?i={modes:{defaultMode:Ct(e)},defaultMode:qs}:(s=!1,i=Ct(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(vI(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(EI(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},me(i.modes,(a,c)=>{i.modes[c]=Ra(a,l=>Er(l))});const o=dn(i.modes);if(me(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(sI(a,o))}),qe(this.lexerDefinitionErrors)){Zs(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=iI(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Kt({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!qe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=ce(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}me(this.lexerDefinitionWarning,a=>{tg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(ug?(this.chopInput=Hi,this.match=this.matchWithTest):(this.updateLastIndex=wt,this.match=this.matchWithExec),s&&(this.handleModes=wt),this.trackStartLines===!1&&(this.computeNewColumn=Hi),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=wt),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Jt(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!qe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{eI()}),this.TRACE_INIT("toFastProperties",()=>{rg(this)})})}tokenize(e,n=this.defaultMode){if(!qe(this.lexerDefinitionErrors)){const i=ce(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,b,_;const w=e,v=w.length;let S=0,L=0;const I=this.hasCustom?0:Math.floor(e.length/10),T=new Array(I),M=[];let x=this.trackStartLines?1:void 0,V=this.trackStartLines?1:void 0;const oe=kI(this.emptyGroups),O=this.trackStartLines,E=this.config.lineTerminatorsPattern;let g=0,C=[],W=[];const B=[],Z=[];Object.freeze(Z);let H;function Y(){return C}function $(Ae){const je=Wr(Ae),we=W[je];return we===void 0?Z:we}const F=Ae=>{if(B.length===1&&Ae.tokenType.PUSH_MODE===void 0){const je=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ae);M.push({offset:Ae.startOffset,line:Ae.startLine,column:Ae.startColumn,length:Ae.image.length,message:je})}else{B.pop();const je=qi(B);C=this.patternIdxToConfig[je],W=this.charCodeToPatternIdxToConfig[je],g=C.length;const we=this.canModeBeOptimized[je]&&this.config.safeMode===!1;W&&we?H=$:H=Y}};function ue(Ae){B.push(Ae),W=this.charCodeToPatternIdxToConfig[Ae],C=this.patternIdxToConfig[Ae],g=C.length,g=C.length;const je=this.canModeBeOptimized[Ae]&&this.config.safeMode===!1;W&&je?H=$:H=Y}ue.call(this,n);let Q;const ee=this.config.recoveryEnabled;for(;S<v;){c=null;const Ae=w.charCodeAt(S),je=H(Ae),we=je.length;for(r=0;r<we;r++){Q=je[r];const _e=Q.pattern;l=null;const Ge=Q.short;if(Ge!==!1?Ae===Ge&&(c=_e):Q.isCustom===!0?(_=_e.exec(w,S,T,oe),_!==null?(c=_[0],_.payload!==void 0&&(l=_.payload)):c=null):(this.updateLastIndex(_e,S),c=this.match(_e,e,S)),c!==null){if(a=Q.longerAlt,a!==void 0){const $e=a.length;for(s=0;s<$e;s++){const gt=C[a[s]],kt=gt.pattern;if(u=null,gt.isCustom===!0?(_=kt.exec(w,S,T,oe),_!==null?(o=_[0],_.payload!==void 0&&(u=_.payload)):o=null):(this.updateLastIndex(kt,S),o=this.match(kt,e,S)),o&&o.length>c.length){c=o,l=u,Q=gt;break}}}break}}if(c!==null){if(f=c.length,d=Q.group,d!==void 0&&(h=Q.tokenTypeIdx,p=this.createTokenInstance(c,S,h,Q.tokenType,x,V,f),this.handlePayload(p,l),d===!1?L=this.addToken(T,L,p):oe[d].push(p)),e=this.chopInput(e,f),S=S+f,V=this.computeNewColumn(V,f),O===!0&&Q.canLineTerminator===!0){let _e=0,Ge,$e;E.lastIndex=0;do Ge=E.test(c),Ge===!0&&($e=E.lastIndex-1,_e++);while(Ge===!0);_e!==0&&(x=x+_e,V=f-$e,this.updateTokenEndLineColumnLocation(p,d,$e,_e,x,V,f))}this.handleModes(Q,F,ue,p)}else{const _e=S,Ge=x,$e=V;let gt=ee===!1;for(;gt===!1&&S<v;)for(e=this.chopInput(e,1),S++,i=0;i<g;i++){const kt=C[i],y=kt.pattern,K=kt.short;if(K!==!1?w.charCodeAt(S)===K&&(gt=!0):kt.isCustom===!0?gt=y.exec(w,S,T,oe)!==null:(this.updateLastIndex(y,S),gt=y.exec(e)!==null),gt===!0)break}if(m=S-_e,V=this.computeNewColumn(V,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(w,_e,m,Ge,$e),M.push({offset:_e,line:Ge,column:$e,length:m,message:b}),ee===!1)break}}return this.hasCustom||(T.length=L),{tokens:T,groups:oe,errors:M}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}Et.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Et.NA=/NOT_APPLICABLE/;function Qs(t){return vg(t)?t.LABEL:t.name}function vg(t){return qt(t.LABEL)&&t.LABEL!==""}const PI="parent",Eg="categories",kg="label",Sg="group",Ag="push_mode",Tg="pop_mode",xg="longer_alt",Rg="line_breaks",Ig="start_chars_hint";function on(t){return DI(t)}function DI(t){const e=t.pattern,n={};if(n.name=t.name,Er(e)||(n.PATTERN=e),pe(t,PI))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return pe(t,Eg)&&(n.CATEGORIES=t[Eg]),Zs([n]),pe(t,kg)&&(n.LABEL=t[kg]),pe(t,Sg)&&(n.GROUP=t[Sg]),pe(t,Tg)&&(n.POP_MODE=t[Tg]),pe(t,Ag)&&(n.PUSH_MODE=t[Ag]),pe(t,xg)&&(n.LONGER_ALT=t[xg]),pe(t,Rg)&&(n.LINE_BREAKS=t[Rg]),pe(t,Ig)&&(n.START_CHARS_HINT=t[Ig]),n}const yi=on({name:"EOF",pattern:Et.NA});Zs([yi]);function Wa(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function BI(t,e){return Xs(t,e)}const Og={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${vg(t)?`--> ${Qs(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Nn(e).image+"'";if(r)return s+r+a;{const c=Jt(t,(d,h)=>d.concat(h),[]),l=ce(c,d=>`[${ce(d,h=>Qs(h)).join(", ")}]`),f=`one of these possible Token sequences:
${ce(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Nn(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${ce(t,l=>`[${ce(l,u=>Qs(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Og);const FI={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},_i={buildDuplicateFoundError(t,e){function n(u){return u instanceof nt?u.terminalType.name:u instanceof Xt?u.nonTerminalName:""}const r=t.name,i=Nn(e),s=i.idx,o=Qn(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=ce(t.prefixPath,i=>Qs(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=ce(t.prefixPath,i=>Qs(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Qn(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=ce(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Xi?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function $I(t,e){const n=new jI(t,e);return n.resolveRefs(),n.errors}class jI extends mi{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){me(dt(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:jt.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class zI extends Ca{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ct(this.path.ruleStack).reverse(),this.occurrenceStack=Ct(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){qe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class WI extends zI{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Zt({definition:i});this.possibleTokTypes=Vs(s),this.found=!0}}}class Ga extends Ca{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class GI extends Ga{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Nn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof nt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class Ng extends Ga{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Nn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof nt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class HI extends Ga{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Nn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof nt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class Cg extends Ga{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Nn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof nt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function Ou(t,e,n=[]){n=Ct(n);let r=[],i=0;function s(a){return a.concat(Lt(t,i+1))}function o(a){const c=Ou(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof Zt)return o(a.definition);if(a instanceof Xt)return o(a.definition);if(a instanceof Yt)r=o(a.definition);else if(a instanceof Zn){const c=a.definition.concat([new vt({definition:a.definition})]);return o(c)}else if(a instanceof Yn){const c=[new Zt({definition:a.definition}),new vt({definition:[new nt({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Ln){const c=a.definition.concat([new vt({definition:[new nt({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof vt){const c=a.definition.concat([new vt({definition:a.definition})]);r=o(c)}else{if(a instanceof Mn)return me(a.definition,c=>{qe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof nt)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Lt(t,i)}),r}function Lg(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!qe(f);){const d=f.pop();if(d===o){a&&qi(f).idx<=l&&f.pop();continue}const h=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(qe(h))continue;const _=h[0];if(_===i){const w={idx:p,def:Lt(h),ruleStack:Hs(m),occurrenceStack:Hs(b)};f.push(w)}else if(_ instanceof nt)if(p<c-1){const w=p+1,v=e[w];if(n(v,_.terminalType)){const S={idx:w,def:Lt(h),ruleStack:m,occurrenceStack:b};f.push(S)}}else if(p===c-1)u.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(_ instanceof Xt){const w=Ct(m);w.push(_.nonTerminalName);const v=Ct(b);v.push(_.idx);const S={idx:p,def:_.definition.concat(s,Lt(h)),ruleStack:w,occurrenceStack:v};f.push(S)}else if(_ instanceof Yt){const w={idx:p,def:Lt(h),ruleStack:m,occurrenceStack:b};f.push(w),f.push(o);const v={idx:p,def:_.definition.concat(Lt(h)),ruleStack:m,occurrenceStack:b};f.push(v)}else if(_ instanceof Zn){const w=new vt({definition:_.definition,idx:_.idx}),v=_.definition.concat([w],Lt(h)),S={idx:p,def:v,ruleStack:m,occurrenceStack:b};f.push(S)}else if(_ instanceof Yn){const w=new nt({terminalType:_.separator}),v=new vt({definition:[w].concat(_.definition),idx:_.idx}),S=_.definition.concat([v],Lt(h)),L={idx:p,def:S,ruleStack:m,occurrenceStack:b};f.push(L)}else if(_ instanceof Ln){const w={idx:p,def:Lt(h),ruleStack:m,occurrenceStack:b};f.push(w),f.push(o);const v=new nt({terminalType:_.separator}),S=new vt({definition:[v].concat(_.definition),idx:_.idx}),L=_.definition.concat([S],Lt(h)),I={idx:p,def:L,ruleStack:m,occurrenceStack:b};f.push(I)}else if(_ instanceof vt){const w={idx:p,def:Lt(h),ruleStack:m,occurrenceStack:b};f.push(w),f.push(o);const v=new vt({definition:_.definition,idx:_.idx}),S=_.definition.concat([v],Lt(h)),L={idx:p,def:S,ruleStack:m,occurrenceStack:b};f.push(L)}else if(_ instanceof Mn)for(let w=_.definition.length-1;w>=0;w--){const v=_.definition[w],S={idx:p,def:v.definition.concat(Lt(h)),ruleStack:m,occurrenceStack:b};f.push(S),f.push(o)}else if(_ instanceof Zt)f.push({idx:p,def:_.definition.concat(Lt(h)),ruleStack:m,occurrenceStack:b});else if(_ instanceof Xi)f.push(VI(_,p,m,b));else throw Error("non exhaustive match")}return u}function VI(t,e,n,r){const i=Ct(n);i.push(t.name);const s=Ct(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var ct;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ct||(ct={}));function Mg(t){if(t instanceof Yt||t==="Option")return ct.OPTION;if(t instanceof vt||t==="Repetition")return ct.REPETITION;if(t instanceof Zn||t==="RepetitionMandatory")return ct.REPETITION_MANDATORY;if(t instanceof Yn||t==="RepetitionMandatoryWithSeparator")return ct.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Ln||t==="RepetitionWithSeparator")return ct.REPETITION_WITH_SEPARATOR;if(t instanceof Mn||t==="Alternation")return ct.ALTERNATION;throw Error("non exhaustive match")}function KI(t,e,n,r,i,s){const o=Cu(t,e,n),a=Bg(o)?za:Xs;return s(o,r,a,i)}function qI(t,e,n,r,i,s){const o=Lu(t,e,i,n),a=Bg(o)?za:Xs;return s(o[0],a,r)}function JI(t,e,n,r){const i=t.length,s=On(t,o=>On(o,a=>a.length===1));if(e)return function(o){const a=ce(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))e:for(let d=0;d<u;d++){const h=l[d],p=h.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,h[m])===!1)continue e}return c}}};if(s&&!r){const o=ce(t,c=>sn(c)),a=Jt(o,(c,l,u)=>(me(l,f=>{pe(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),me(f.categoryMatches,d=>{pe(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue e}return o}}}}function XI(t,e,n){const r=On(t,s=>s.length===1),i=t.length;if(r&&!n){const s=sn(t);if(s.length===1&&qe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Jt(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,me(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class ZI extends Ca{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,ct.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,ct.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,ct.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,ct.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,ct.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class Ug extends mi{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ct.OPTION)}visitRepetition(e){this.checkIsTarget(e,ct.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ct.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ct.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ct.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ct.ALTERNATION)}}function Pg(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Nu(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function YI(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function Dg(t,e){const n=ce(t,o=>Ou([o],1)),r=Pg(n.length),i=ce(n,o=>{const a={};return me(o,c=>{const l=Nu(c.partialPath);me(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=Pg(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=Nu(f);if(YI(i,h,c)||qe(d)||f.length===e){const m=r[c];if(Mu(m,f)===!1){m.push(f);for(let b=0;b<h.length;b++){const _=h[b];i[c][_]=!0}}}else{const m=Ou(d,o+1,f);s[c]=s[c].concat(m),me(m,b=>{const _=Nu(b.partialPath);me(_,w=>{i[c][w]=!0})})}}}}return r}function Cu(t,e,n,r){const i=new Ug(t,ct.ALTERNATION,r);return e.accept(i),Dg(i.result,n)}function Lu(t,e,n,r){const i=new Ug(t,n);e.accept(i);const s=i.result,a=new ZI(e,t,n).startWalking(),c=new Zt({definition:s}),l=new Zt({definition:a});return Dg([c,l],r)}function Mu(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function QI(t,e){return t.length<e.length&&On(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Bg(t){return On(t,e=>On(e,n=>On(n,r=>qe(r.categoryMatches))))}function eO(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return ce(e,n=>Object.assign({type:jt.CUSTOM_LOOKAHEAD_VALIDATION},n))}function tO(t,e,n,r){const i=gn(t,c=>nO(c,n)),s=pO(t,e,n),o=gn(t,c=>uO(c,n)),a=gn(t,c=>sO(c,t,r,n));return i.concat(s,o,a)}function nO(t,e){const n=new iO;t.accept(n);const r=n.allProductions,i=Ym(r,rO),s=Cn(i,a=>a.length>1);return ce(dt(s),a=>{const c=Nn(a),l=e.buildDuplicateFoundError(t,a),u=Qn(c),f={message:l,type:jt.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=Fg(c);return d&&(f.parameter=d),f})}function rO(t){return`${Qn(t)}_#_${t.idx}_#_${Fg(t)}`}function Fg(t){return t instanceof nt?t.terminalType.name:t instanceof Xt?t.nonTerminalName:""}class iO extends mi{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function sO(t,e,n,r){const i=[];if(Jt(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:jt.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function oO(t,e,n){const r=[];let i;return $t(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:jt.INVALID_RULE_OVERRIDE,ruleName:t})),r}function $g(t,e,n,r=[]){const i=[],s=Ha(e.definition);if(qe(s))return[];{const o=t.name;$t(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:jt.LEFT_RECURSION,ruleName:o});const c=xa(s,r.concat([t])),l=gn(c,u=>{const f=Ct(r);return f.push(u),$g(t,u,n,f)});return i.concat(l)}}function Ha(t){let e=[];if(qe(t))return e;const n=Nn(t);if(n instanceof Xt)e.push(n.referencedRule);else if(n instanceof Zt||n instanceof Yt||n instanceof Zn||n instanceof Yn||n instanceof Ln||n instanceof vt)e=e.concat(Ha(n.definition));else if(n instanceof Mn)e=sn(ce(n.definition,s=>Ha(s.definition)));else if(!(n instanceof nt))throw Error("non exhaustive match");const r=Na(n),i=t.length>1;if(r&&i){const s=Lt(t);return e.concat(Ha(s))}else return e}class Uu extends mi{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function aO(t,e){const n=new Uu;t.accept(n);const r=n.alternations;return gn(r,s=>{const o=Hs(s.definition);return gn(o,(a,c)=>{const l=Lg([a],[],Xs,1);return qe(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:jt.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function cO(t,e,n){const r=new Uu;t.accept(r);let i=r.alternations;return i=Ra(i,o=>o.ignoreAmbiguities===!0),gn(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=Cu(a,t,c,o),u=hO(l,o,t,n),f=dO(l,o,t,n);return u.concat(f)})}class lO extends mi{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function uO(t,e){const n=new Uu;t.accept(n);const r=n.alternations;return gn(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:jt.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function fO(t,e,n){const r=[];return me(t,i=>{const s=new lO;i.accept(s);const o=s.allProductions;me(o,a=>{const c=Mg(a),l=a.maxLookahead||e,u=a.idx,d=Lu(u,i,c,l)[0];if(qe(sn(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:jt.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function hO(t,e,n,r){const i=[],s=Jt(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||me(c,u=>{const f=[l];me(t,(d,h)=>{l!==h&&Mu(d,u)&&e.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!Mu(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return ce(s,a=>{const c=ce(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:jt.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function dO(t,e,n,r){const i=Jt(t,(o,a,c)=>{const l=ce(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Gs(gn(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=mn(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&QI(d.path,l));return ce(u,d=>{const h=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:d.path}),type:jt.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function pO(t,e,n){const r=[],i=ce(e,s=>s.name);return me(t,s=>{const o=s.name;if($t(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:jt.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function mO(t){const e=vu(t,{errMsgProvider:FI}),n={};return me(t.rules,r=>{n[r.name]=r}),$I(n,e.errMsgProvider)}function gO(t){return t=vu(t,{errMsgProvider:_i}),tO(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const jg="MismatchedTokenException",zg="NoViableAltException",Wg="EarlyExitException",Gg="NotAllInputParsedException",Hg=[jg,zg,Wg,Gg];Object.freeze(Hg);function Va(t){return $t(Hg,t.name)}class Ka extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Vg extends Ka{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=jg}}class yO extends Ka{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=zg}}class _O extends Ka{constructor(e,n){super(e,n),this.name=Gg}}class bO extends Ka{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Wg}}const Pu={},Kg="InRuleRecoveryException";class wO extends Error{constructor(e){super(e),this.name=Kg}}class vO{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=pe(e,"recoveryEnabled")?e.recoveryEnabled:kr.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=EO)}getTokenToInsert(e){const n=Wa(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new Vg(h,l,this.LA(0));p.resyncedTokens=Hs(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new wO("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||qe(n))return!1;const r=this.LA(1);return Ji(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return $t(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Ji(e,s=>BI(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Pu;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return ce(e,(r,i)=>i===0?Pu:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=ce(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return sn(e)}getFollowSetFromFollowKey(e){if(e===Pu)return[yi];const n=e.ruleName+e.idxInCallingRule+sg+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,yi)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Hs(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Ct(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return ce(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function EO(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=yi,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const kO=4,Gr=8,qg=1<<Gr,Jg=2<<Gr,Du=3<<Gr,Bu=4<<Gr,Fu=5<<Gr,qa=6<<Gr;function $u(t,e,n){return n|e|t}class SO{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:kr.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(qe(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return gn(e,n=>$g(n,n,_i))}validateEmptyOrAlternatives(e){return gn(e,n=>aO(n,_i))}validateAmbiguousAlternationAlternatives(e,n){return gn(e,r=>cO(r,n,_i))}validateSomeNonEmptyLookaheadPath(e,n){return fO(e,n,_i)}buildLookaheadForAlternation(e){return KI(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,JI)}buildLookaheadForOptional(e){return qI(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Mg(e.prodType),XI)}}class AO{initLooksAhead(e){this.dynamicTokensEnabled=pe(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:kr.dynamicTokensEnabled,this.maxLookahead=pe(e,"maxLookahead")?e.maxLookahead:kr.maxLookahead,this.lookaheadStrategy=pe(e,"lookaheadStrategy")?e.lookaheadStrategy:new SO({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){me(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=xO(n);me(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Qn(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=$u(this.fullRuleNameToShort[n.name],qg,l.idx);this.setLaFuncCache(d,f)})}),me(i,l=>{this.computeLookaheadFunc(n,l.idx,Du,"Repetition",l.maxLookahead,Qn(l))}),me(s,l=>{this.computeLookaheadFunc(n,l.idx,Jg,"Option",l.maxLookahead,Qn(l))}),me(o,l=>{this.computeLookaheadFunc(n,l.idx,Bu,"RepetitionMandatory",l.maxLookahead,Qn(l))}),me(a,l=>{this.computeLookaheadFunc(n,l.idx,qa,"RepetitionMandatoryWithSeparator",l.maxLookahead,Qn(l))}),me(c,l=>{this.computeLookaheadFunc(n,l.idx,Fu,"RepetitionWithSeparator",l.maxLookahead,Qn(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=$u(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return $u(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class TO extends mi{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Ja=new TO;function xO(t){Ja.reset(),t.accept(Ja);const e=Ja.dslMethods;return Ja.reset(),e}function Xg(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function Zg(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function RO(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function IO(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const OO="name";function Yg(t,e){Object.defineProperty(t,OO,{enumerable:!1,configurable:!0,writable:!1,value:e})}function NO(t,e){const n=dn(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function CO(t,e){const n=function(){};Yg(n,t+"BaseSemantics");const r={visit:function(i,s){if(Me(i)&&(i=i[0]),!Er(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=MO(this,e);if(!qe(i)){const s=ce(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function LO(t,e,n){const r=function(){};Yg(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return me(e,s=>{i[s]=NO}),r.prototype=i,r.prototype.constructor=r,r}var ju;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(ju||(ju={}));function MO(t,e){return UO(t,e)}function UO(t,e){const n=mn(e,i=>_r(t[i])===!1),r=ce(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:ju.MISSING_METHOD,methodName:i}));return Gs(r)}class PO{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=pe(e,"nodeLocationTracking")?e.nodeLocationTracking:kr.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=wt,this.cstFinallyStateUpdate=wt,this.cstPostTerminal=wt,this.cstPostNonTerminal=wt,this.cstPostRule=wt;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Zg,this.setNodeLocationFromNode=Zg,this.cstPostRule=wt,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=wt,this.setNodeLocationFromNode=wt,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Xg,this.setNodeLocationFromNode=Xg,this.cstPostRule=wt,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=wt,this.setNodeLocationFromNode=wt,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=wt,this.setNodeLocationFromNode=wt,this.cstPostRule=wt,this.setInitialNodeLocation=wt;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];RO(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];IO(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Er(this.baseCstVisitorConstructor)){const e=CO(this.className,dn(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Er(this.baseCstVisitorWithDefaultsConstructor)){const e=LO(this.className,dn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class DO{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Ya}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Ya:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class BO{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Qa){if($t(this.definedRulesNames,e)){const o={message:_i.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:jt.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Qa){const i=oO(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Va(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return $R(dt(this.gastProductionsCache))}}class FO{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=za,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},pe(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Me(e)){if(qe(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Me(e))this.tokensMap=Jt(e,(s,o)=>(s[o.name]=o,s),{});else if(pe(e,"modes")&&On(sn(dt(e.modes)),MI)){const s=sn(dt(e.modes)),o=Ia(s);this.tokensMap=Jt(o,(a,c)=>(a[c.name]=c,a),{})}else if(hn(e))this.tokensMap=Ct(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=yi;const r=pe(e,"modes")?sn(dt(e.modes)):dt(e),i=On(r,s=>qe(s.categoryMatches));this.tokenMatcher=i?za:Xs,Zs(dt(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=pe(r,"resyncEnabled")?r.resyncEnabled:Qa.resyncEnabled,s=pe(r,"recoveryValueFunc")?r.recoveryValueFunc:Qa.recoveryValueFunc,o=this.ruleShortNameIdx<<kO+Gr;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Va(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(Jg,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(Bu,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ct.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,Bu,e,HI)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(qa,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Cg],a,qa,e,Cg)}else throw this.raiseEarlyExitException(e,ct.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(Du,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,Du,e,GI,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Fu,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Ng],a,Fu,e,Ng)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,qa,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(qg,n),i=Me(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new _O(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Va(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Vg(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===Kg?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Ct(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),yi)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class $O{initErrorHandler(e){this._errors=[],this.errorMessageProvider=pe(e,"errorMessageProvider")?e.errorMessageProvider:kr.errorMessageProvider}SAVE_ERROR(e){if(Va(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ct(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ct(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Lu(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new bO(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Cu(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new yO(c,this.LA(1),a))}}class jO{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Er(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Lg([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Nn(e.ruleStack),i=this.getGAstProductions()[n];return new WI(i,e).startWalking()}}const Xa={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Xa);const Qg=!0,e0=Math.pow(2,Gr)-1,t0=on({name:"RECORDING_PHASE_TOKEN",pattern:Et.NA});Zs([t0]);const n0=Wa(t0,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(n0);const zO={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class WO{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Ya}topLevelRuleRecord(e,n){try{const r=new Xi({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return eo.call(this,Yt,e,n)}atLeastOneInternalRecord(e,n){eo.call(this,Zn,n,e)}atLeastOneSepFirstInternalRecord(e,n){eo.call(this,Yn,n,e,Qg)}manyInternalRecord(e,n){eo.call(this,vt,n,e)}manySepFirstInternalRecord(e,n){eo.call(this,Ln,n,e,Qg)}orInternalRecord(e,n){return GO.call(this,e,n)}subruleInternalRecord(e,n,r){if(Za(n),!e||pe(e,"ruleName")===!1){const a=new Error(`<SUBRULE${r0(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=qi(this.recordingProdStack),s=e.ruleName,o=new Xt({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?zO:Xa}consumeInternalRecord(e,n,r){if(Za(n),!bg(e)){const o=new Error(`<CONSUME${r0(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=qi(this.recordingProdStack),s=new nt({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),n0}}function eo(t,e,n,r=!1){Za(n);const i=qi(this.recordingProdStack),s=_r(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),pe(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Xa}function GO(t,e){Za(e);const n=qi(this.recordingProdStack),r=Me(t)===!1,i=r===!1?t:t.DEF,s=new Mn({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});pe(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=Eu(i,a=>_r(a.GATE));return s.hasPredicates=o,n.definition.push(s),me(i,a=>{const c=new Zt({definition:[]});s.definition.push(c),pe(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:pe(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Xa}function r0(t){return t===0?"":`${t}`}function Za(t){if(t<0||t>e0){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${e0+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class HO{initPerformanceTracer(e){if(pe(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=kr.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=ng(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function VO(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Ya=Wa(yi,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Ya);const kr=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Og,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Qa=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var jt;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(jt||(jt={}));class to{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{rg(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),me(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=mO({rules:dt(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(qe(r)&&this.skipValidations===!1){const i=gO({rules:dt(this.gastProductionsCache),tokenTypes:dt(this.tokensMap),errMsgProvider:_i,grammarName:n}),s=eO({lookaheadStrategy:this.lookaheadStrategy,rules:dt(this.gastProductionsCache),tokenTypes:dt(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),qe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=KR(dt(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:dt(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(dt(this.gastProductionsCache))})),!to.DEFER_DEFINITION_ERRORS_HANDLING&&!qe(this.definitionErrors))throw e=ce(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),pe(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=pe(n,"skipValidations")?n.skipValidations:kr.skipValidations}}to.DEFER_DEFINITION_ERRORS_HANDLING=!1,VO(to,[vO,AO,PO,DO,FO,BO,$O,jO,WO,HO]);class KO extends to{constructor(e,n=kr){const r=Ct(n);r.outputCst=!0,super(e,r)}}function qO(t){const e=new JO,n=dt(t);return ce(n,r=>e.visitRule(r))}class JO extends mi{visitRule(e){const n=this.visitEach(e.definition),r=Ym(n,s=>s.propertyName),i=ce(r,(s,o)=>{const a=!Eu(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=ce(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:ec(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:ec(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:ec(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:ec(e)}]}visitEachAndOverrideWith(e,n){return ce(this.visitEach(e),r=>Kt({},r,n))}visitEach(e){return sn(ce(e,n=>this.visit(n)))}}function ec(t){return t instanceof Xt?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function XO(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(sn(ce(t,r=>ZO(r)))),e.includeVisitorInterface&&(n=n.concat(tN(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function ZO(t){const e=YO(t),n=QO(t);return[e,n]}function YO(t){const e=s0(t.name),n=zu(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function QO(t){return`export type ${zu(t.name)} = {
  ${ce(t.properties,n=>eN(n)).join(`
  `)}
};`}function eN(t){const e=rN(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function tN(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${ce(e,n=>nN(n)).join(`
  `)}
}`}function nN(t){const e=zu(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function rN(t){if(Me(t)){const e=Ia(ce(t,r=>i0(r)));return"("+Jt(e,(r,i)=>r+" | "+i)+")"}else return i0(t)}function i0(t){return t.kind==="token"?"IToken":s0(t.name)}function s0(t){return wm(t)+"CstNode"}function zu(t){return wm(t)+"CstChildren"}const iN={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function sN(t,e){const n=Object.assign(Object.assign({},iN),e),r=qO(t);return XO(r,n)}const Wu=Vl(32,126).map(t=>String.fromCharCode(t));function Ie(t){return on({...t,name:`token_${t.name}`})}function yn(t,e=!1){return Ie(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt,group:Et.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt})}const no=Ie({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),oN=Ie({name:"whitespace",pattern:/ +/,group:Et.SKIPPED}),aN=Ie({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Et.SKIPPED}),Gu=Ie({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Yi=Ie({name:"command",pattern:/#/,start_chars_hint:["#"]});let o0=!1;function cN(t,e,n){if(!o0)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==no)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const a0=Ie({name:"text",pattern:cN,line_breaks:!1,start_chars_hint:Wu.filter(t=>"@#/?':!".includes(t)===!1)}),c0=Ie({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),l0=Ie({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),u0=Ie({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),f0=Ie({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),zt=Ie({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Wu}),h0=Ie({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),d0=Ie({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),p0=Ie({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:zt}),m0=Ie({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:zt}),g0=Ie({name:"islessthan",pattern:/<|below/,longer_alt:zt}),y0=Ie({name:"isgreaterthan",pattern:/>|above/,longer_alt:zt}),_0=Ie({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:zt}),b0=Ie({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:zt}),Hu=Ie({name:"or",pattern:/or/i,longer_alt:zt}),Vu=Ie({name:"not",pattern:/not/i,longer_alt:zt}),Ku=Ie({name:"and",pattern:/and/i,longer_alt:zt}),qu=Ie({name:"plus",pattern:/\+/}),Ju=Ie({name:"minus",pattern:/-/}),w0=Ie({name:"power",pattern:/\*\*/}),v0=Ie({name:"multiply",pattern:/\*/}),Xu=Ie({name:"divide",pattern:/\//}),E0=Ie({name:"moddivide",pattern:/%/}),k0=Ie({name:"floordivide",pattern:/%%/}),S0=Ie({name:"query",pattern:/\?/}),A0=Ie({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),T0=Ie({name:"rparen",pattern:/\)/,pop_mode:!0}),x0=Ie({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Wu,longer_alt:zt}),R0=yn("debugger"),Zu=yn("if"),tc=yn("do"),lN=yn("to",!0),Yu=yn("done"),uN=yn("then",!0),Qu=yn("else"),I0=yn("while"),O0=yn("repeat"),N0=yn("waitfor"),C0=Ie({name:"foreach",pattern:/foreach|for/,longer_alt:zt}),L0=yn("break"),M0=yn("continue");function U0(t){return[...t,d0,p0,m0,_0,g0,b0,y0,Hu,Vu,Ku,qu,Ju,w0,v0,Xu,k0,E0,S0,A0,T0,h0,zt]}const P0=U0([a0,Gu,x0,Yi,c0,l0,u0,f0,no,oN,L0,M0,R0,Yu,tc,Qu,C0,Zu,O0,uN,lN,N0,I0]),fN=new Et({defaultMode:"use_newlines",modes:{use_newlines:P0,ignore_newlines:U0([aN])}},{skipValidations:!Hn,ensureOptimizations:Hn});function D0(t){o0=!0;const e=fN.tokenize(t||` 
`),[n]=(He(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Wa(no,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function B0(t,e=!0){const[n,...r]=t;switch(Pe(n)){default:return e?{type:fe.OBJECT,values:t}:{type:fe.CONST,values:t};case"loader":return{type:fe.LOADER,values:r};case"board":return{type:fe.BOARD,values:r};case"object":return{type:fe.OBJECT,values:r};case"terrain":return{type:fe.TERRAIN,values:r};case"charset":return{type:fe.CHARSET,values:r};case"palette":return{type:fe.PALETTE,values:r};case"rn":case"range":return{type:fe.RANGE,values:r};case"sl":case"select":return{type:fe.SELECT,values:r};case"nm":case"number":return{type:fe.NUMBER,values:r};case"tx":case"text":return{type:fe.TEXT,values:r};case"ln":case"link":return{type:fe.LINK,values:r};case"hk":case"hotkey":return{type:fe.HOTKEY,values:r};case"scroll":return{type:fe.SCROLL,values:r};case"copyit":return{type:fe.COPYIT,values:r}}}function _n(t){switch(t){case fe.LOADER:return"loader";case fe.BOARD:return"board";case fe.OBJECT:return"object";case fe.TERRAIN:return"terrain";case fe.CHARSET:return"charset";case fe.PALETTE:return"palette";case fe.CONST:return"const";case fe.RANGE:return"range";case fe.SELECT:return"select";case fe.NUMBER:return"number";case fe.TEXT:return"text";case fe.LINK:return"link";case fe.HOTKEY:return"hotkey";case fe.SCROLL:return"scroll";case fe.COPYIT:return"copyit"}}var ef;try{ef=new TextDecoder}catch{}var ie,bn,U=0,Je={},Ce,Hr,wn=0,er=0,xt,Sr,Qt=[],Oe,F0={useRecords:!1,mapsAsObjects:!0};class $0{}const j0=new $0;j0.name="MessagePack 0xC1";var Vr=!1,z0=2,W0;try{new Function("")}catch{z0=1/0}class ro{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(ie)return ny(()=>(of(),this?this.unpack(e,n):ro.prototype.unpack.call(F0,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof n=="object"?(bn=n.end||e.length,U=n.start||0):(U=0,bn=n>-1?n:e.length),er=0,Hr=null,xt=null,ie=e;try{Oe=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw ie=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof ro){if(Je=this,this.structures)return Ce=this.structures,nc(n);(!Ce||Ce.length>0)&&(Ce=[])}else Je=F0,(!Ce||Ce.length>0)&&(Ce=[]);return nc(n)}unpackMultiple(e,n){let r,i=0;try{Vr=!0;let s=e.length,o=this?this.unpack(e,s):rc.unpack(e,s);if(n){if(n(o,i,U)===!1)return;for(;U<s;)if(i=U,n(nc(),i,U)===!1)return}else{for(r=[o];U<s;)i=U,r.push(nc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Vr=!1,of()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function nc(t){try{if(!Je.trusted&&!Vr){let n=Ce.sharedLength||0;n<Ce.length&&(Ce.length=n)}let e;if(Je.randomAccessStructure&&ie[U]<64&&ie[U]>=32&&W0?(e=W0(ie,U,bn,Je),ie=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),U=bn):e=lt(),xt&&(U=xt.postBundlePosition,xt=null),Vr&&(Ce.restoreStructures=null),U==bn)Ce&&Ce.restoreStructures&&G0(),Ce=null,ie=null,Sr&&(Sr=null);else{if(U>bn)throw new Error("Unexpected end of MessagePack data");if(!Vr){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Ce&&Ce.restoreStructures&&G0(),of(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||U>bn)&&(e.incomplete=!0),e}}function G0(){for(let t in Ce.restoreStructures)Ce[t]=Ce.restoreStructures[t];Ce.restoreStructures=null}function lt(){let t=ie[U++];if(t<160)if(t<128){if(t<64)return t;{let e=Ce[t&63]||Je.getStructures&&V0()[t&63];return e?(e.read||(e.read=tf(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Je.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Y0();r==="__proto__"&&(r="__proto_"),e[r]=lt()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(lt(),lt());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=lt();return Je.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(er>=U)return Hr.slice(U-wn,(U+=e)-wn);if(er==0&&bn<140){let n=e<16?rf(e):J0(e);if(n!=null)return n}return nf(e)}else{let e;switch(t){case 192:return null;case 193:return xt?(e=lt(),e>0?xt[1].slice(xt.position1,xt.position1+=e):xt[0].slice(xt.position0,xt.position0-=e)):j0;case 194:return!1;case 195:return!0;case 196:if(e=ie[U++],e===void 0)throw new Error("Unexpected end of buffer");return sf(e);case 197:return e=Oe.getUint16(U),U+=2,sf(e);case 198:return e=Oe.getUint32(U),U+=4,sf(e);case 199:return bi(ie[U++]);case 200:return e=Oe.getUint16(U),U+=2,bi(e);case 201:return e=Oe.getUint32(U),U+=4,bi(e);case 202:if(e=Oe.getFloat32(U),Je.useFloat32>2){let n=af[(ie[U]&127)<<1|ie[U+1]>>7];return U+=4,(n*e+(e>0?.5:-.5)>>0)/n}return U+=4,e;case 203:return e=Oe.getFloat64(U),U+=8,e;case 204:return ie[U++];case 205:return e=Oe.getUint16(U),U+=2,e;case 206:return e=Oe.getUint32(U),U+=4,e;case 207:return Je.int64AsType==="number"?(e=Oe.getUint32(U)*4294967296,e+=Oe.getUint32(U+4)):Je.int64AsType==="string"?e=Oe.getBigUint64(U).toString():Je.int64AsType==="auto"?(e=Oe.getBigUint64(U),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Oe.getBigUint64(U),U+=8,e;case 208:return Oe.getInt8(U++);case 209:return e=Oe.getInt16(U),U+=2,e;case 210:return e=Oe.getInt32(U),U+=4,e;case 211:return Je.int64AsType==="number"?(e=Oe.getInt32(U)*4294967296,e+=Oe.getUint32(U+4)):Je.int64AsType==="string"?e=Oe.getBigInt64(U).toString():Je.int64AsType==="auto"?(e=Oe.getBigInt64(U),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Oe.getBigInt64(U),U+=8,e;case 212:if(e=ie[U++],e==114)return ey(ie[U++]&63);{let n=Qt[e];if(n)return n.read?(U++,n.read(lt())):n.noBuffer?(U++,n()):n(ie.subarray(U,++U));throw new Error("Unknown extension "+e)}case 213:return e=ie[U],e==114?(U++,ey(ie[U++]&63,ie[U++])):bi(2);case 214:return bi(4);case 215:return bi(8);case 216:return bi(16);case 217:return e=ie[U++],er>=U?Hr.slice(U-wn,(U+=e)-wn):dN(e);case 218:return e=Oe.getUint16(U),U+=2,er>=U?Hr.slice(U-wn,(U+=e)-wn):pN(e);case 219:return e=Oe.getUint32(U),U+=4,er>=U?Hr.slice(U-wn,(U+=e)-wn):mN(e);case 220:return e=Oe.getUint16(U),U+=2,K0(e);case 221:return e=Oe.getUint32(U),U+=4,K0(e);case 222:return e=Oe.getUint16(U),U+=2,q0(e);case 223:return e=Oe.getUint32(U),U+=4,q0(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const hN=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function tf(t,e){function n(){if(n.count++>z0){let i=t.read=new Function("r","return function(){return "+(Je.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":hN.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(lt);return t.highByte===0&&(t.read=H0(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=lt()}return Je.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?H0(e,n):n}const H0=(t,e)=>function(){let n=ie[U++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Ce[r]||V0()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=tf(i,t)),i.read()};function V0(){let t=ny(()=>(ie=null,Je.getStructures()));return Ce=Je._mergeStructures(t,Ce)}var nf=io,dN=io,pN=io,mN=io;function io(t){let e;if(t<16&&(e=rf(t)))return e;if(t>64&&ef)return ef.decode(ie.subarray(U,U+=t));const n=U+t,r=[];for(e="";U<n;){const i=ie[U++];if(!(i&128))r.push(i);else if((i&224)===192){const s=ie[U++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=ie[U++]&63,o=ie[U++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=ie[U++]&63,o=ie[U++]&63,a=ie[U++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Rt.apply(String,r),r.length=0)}return r.length>0&&(e+=Rt.apply(String,r)),e}function K0(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=lt();return Je.freezeData?Object.freeze(e):e}function q0(t){if(Je.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Y0();r==="__proto__"&&(r="__proto_"),e[r]=lt()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(lt(),lt());return e}}var Rt=String.fromCharCode;function J0(t){let e=U,n=new Array(t);for(let r=0;r<t;r++){const i=ie[U++];if((i&128)>0){U=e;return}n[r]=i}return Rt.apply(String,n)}function rf(t){if(t<4)if(t<2){if(t===0)return"";{let e=ie[U++];if((e&128)>1){U-=1;return}return Rt(e)}}else{let e=ie[U++],n=ie[U++];if((e&128)>0||(n&128)>0){U-=2;return}if(t<3)return Rt(e,n);let r=ie[U++];if((r&128)>0){U-=3;return}return Rt(e,n,r)}else{let e=ie[U++],n=ie[U++],r=ie[U++],i=ie[U++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){U-=4;return}if(t<6){if(t===4)return Rt(e,n,r,i);{let s=ie[U++];if((s&128)>0){U-=5;return}return Rt(e,n,r,i,s)}}else if(t<8){let s=ie[U++],o=ie[U++];if((s&128)>0||(o&128)>0){U-=6;return}if(t<7)return Rt(e,n,r,i,s,o);let a=ie[U++];if((a&128)>0){U-=7;return}return Rt(e,n,r,i,s,o,a)}else{let s=ie[U++],o=ie[U++],a=ie[U++],c=ie[U++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){U-=8;return}if(t<10){if(t===8)return Rt(e,n,r,i,s,o,a,c);{let l=ie[U++];if((l&128)>0){U-=9;return}return Rt(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=ie[U++],u=ie[U++];if((l&128)>0||(u&128)>0){U-=10;return}if(t<11)return Rt(e,n,r,i,s,o,a,c,l,u);let f=ie[U++];if((f&128)>0){U-=11;return}return Rt(e,n,r,i,s,o,a,c,l,u,f)}else{let l=ie[U++],u=ie[U++],f=ie[U++],d=ie[U++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){U-=12;return}if(t<14){if(t===12)return Rt(e,n,r,i,s,o,a,c,l,u,f,d);{let h=ie[U++];if((h&128)>0){U-=13;return}return Rt(e,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=ie[U++],p=ie[U++];if((h&128)>0||(p&128)>0){U-=14;return}if(t<15)return Rt(e,n,r,i,s,o,a,c,l,u,f,d,h,p);let m=ie[U++];if((m&128)>0){U-=15;return}return Rt(e,n,r,i,s,o,a,c,l,u,f,d,h,p,m)}}}}}function X0(){let t=ie[U++],e;if(t<192)e=t-160;else switch(t){case 217:e=ie[U++];break;case 218:e=Oe.getUint16(U),U+=2;break;case 219:e=Oe.getUint32(U),U+=4;break;default:throw new Error("Expected string")}return io(e)}function sf(t){return Je.copyBuffers?Uint8Array.prototype.slice.call(ie,U,U+=t):ie.subarray(U,U+=t)}function bi(t){let e=ie[U++];if(Qt[e]){let n;return Qt[e](ie.subarray(U,n=U+=t),r=>{U=r;try{return lt()}finally{U=n}})}else throw new Error("Unknown extension type "+e)}var Z0=new Array(4096);function Y0(){let t=ie[U++];if(t>=160&&t<192){if(t=t-160,er>=U)return Hr.slice(U-wn,(U+=t)-wn);if(!(er==0&&bn<180))return nf(t)}else return U--,Q0(lt());let e=(t<<5^(t>1?Oe.getUint16(U):t>0?ie[U]:0))&4095,n=Z0[e],r=U,i=U+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Oe.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=ie[r++],s!=n[o++]){r=1879048192;break}if(r===i)return U=r,n.string;i-=3,r=U}for(n=[],Z0[e]=n,n.bytes=t;r<i;)s=Oe.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=ie[r++],n.push(s);let a=t<16?rf(t):J0(t);return a!=null?n.string=a:n.string=nf(t)}function Q0(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const ey=(t,e)=>{let n=lt().map(Q0),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Ce[t];return i&&(i.isShared||Vr)&&((Ce.restoreStructures||(Ce.restoreStructures=[]))[t]=i),Ce[t]=n,n.read=tf(n,r),n.read()};Qt[0]=()=>{},Qt[0].noBuffer=!0,Qt[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let gN={Error,TypeError,ReferenceError};Qt[101]=()=>{let t=lt();return(gN[t[0]]||Error)(t[1],{cause:t[2]})},Qt[105]=t=>{if(Je.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Oe.getUint32(U-4);Sr||(Sr=new Map);let n=ie[U],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Sr.set(e,i);let s=lt();return i.used?Object.assign(r,s):(i.target=s,s)},Qt[112]=t=>{if(Je.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Oe.getUint32(U-4),n=Sr.get(e);return n.used=!0,n.target},Qt[115]=()=>new Set(lt());const ty=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let yN=typeof globalThis=="object"?globalThis:window;Qt[116]=t=>{let e=t[0],n=ty[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new yN[n](Uint8Array.prototype.slice.call(t,1).buffer)},Qt[120]=()=>{let t=lt();return new RegExp(t[0],t[1])};const _N=[];Qt[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=U;return U+=e-t.length,xt=_N,xt=[X0(),X0()],xt.position0=0,xt.position1=0,xt.postBundlePosition=U,U=n,lt()},Qt[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function ny(t){let e=bn,n=U,r=wn,i=er,s=Hr,o=Sr,a=xt,c=new Uint8Array(ie.slice(0,bn)),l=Ce,u=Ce.slice(0,Ce.length),f=Je,d=Vr,h=t();return bn=e,U=n,wn=r,er=i,Hr=s,Sr=o,xt=a,ie=c,Vr=d,Ce=l,Ce.splice(0,Ce.length,...u),Je=f,Oe=new DataView(ie.buffer,ie.byteOffset,ie.byteLength),h}function of(){ie=null,Sr=null,Ce=null}const af=new Array(147);for(let t=0;t<256;t++)af[t]=+("1e"+Math.floor(45.15-t*.30103));var rc=new ro({useRecords:!1});const bN=rc.unpack;rc.unpackMultiple,rc.unpack;let wN=new Float32Array(1);new Uint8Array(wN.buffer,0,4);let ic;try{ic=new TextEncoder}catch{}let cf,ry;const sc=typeof Buffer<"u",oc=sc?function(t){return Buffer.allocUnsafeSlow(t)}:Uint8Array,iy=sc?Buffer:Uint8Array,sy=sc?4294967296:2144337920;let j,so,Xe,P=0,Wt,rt=null,vN;const EN=21760,kN=/[\u0080-\uFFFF]/,Qi=Symbol("record-id");class SN extends ro{constructor(e){super(e),this.offset=0;let n,r,i,s,o=iy.prototype.utf8Write?function(E,g){return j.utf8Write(E,g,j.byteLength-g)}:ic&&ic.encodeInto?function(E,g){return ic.encodeInto(E,j.subarray(g)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let f=e.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,p=u+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,_=0;this.pack=this.encode=function(E,g){if(j||(j=new oc(8192),Xe=j.dataView||(j.dataView=new DataView(j.buffer,0,8192)),P=0),Wt=j.length-10,Wt-P<2048?(j=new oc(j.length),Xe=j.dataView||(j.dataView=new DataView(j.buffer,0,j.length)),Wt=j.length-10,P=0):P=P+7&2147483640,n=P,g&NN&&(P+=g&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof E!="string"?(rt=[],rt.size=1/0):rt=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let W=i.sharedLength||0;if(W>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let B=0;B<W;B++){let Z=i[B];if(!Z)continue;let H,Y=i.transitions;for(let $=0,F=Z.length;$<F;$++){let ue=Z[$];H=Y[ue],H||(H=Y[ue]=Object.create(null)),Y=H}Y[Qi]=B+64}this.lastNamedStructuresLength=W}c||(i.nextId=W+64)}r&&(r=!1);let C;try{a.randomAccessStructure&&E&&E.constructor&&E.constructor===Object?O(E):S(E);let W=rt;if(rt&&cy(n,S,0),s&&s.idsToInsert){let B=s.idsToInsert.sort(($,F)=>$.offset>F.offset?1:-1),Z=B.length,H=-1;for(;W&&Z>0;){let $=B[--Z].offset+n;$<W.stringsPosition+n&&H===-1&&(H=0),$>W.position+n?H>=0&&(H+=6):(H>=0&&(Xe.setUint32(W.position+n,Xe.getUint32(W.position+n)+H),H=-1),W=W.previous,Z++)}H>=0&&W&&Xe.setUint32(W.position+n,Xe.getUint32(W.position+n)+H),P+=B.length*6,P>Wt&&x(P),a.offset=P;let Y=TN(j.subarray(n,P),B);return s=null,Y}return a.offset=P,g&IN?(j.start=n,j.end=P,j):j.subarray(n,P)}catch(W){throw C=W,W}finally{if(i&&(w(),r&&a.saveStructures)){let W=i.sharedLength||0,B=j.subarray(n,P),Z=xN(i,a);if(!C)return a.saveStructures(Z,Z.isCompatible)===!1?a.pack(E,g):(a.lastNamedStructuresLength=W,j.length>1073741824&&(j=null),B)}j.length>1073741824&&(j=null),g&ON&&(P=n)}};const w=()=>{_<10&&_++;let E=i.sharedLength||0;if(i.length>E&&!c&&(i.length=E),b>1e4)i.transitions=null,_=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let g=0,C=m.length;g<C;g++)m[g][Qi]=0;m=[]}},v=E=>{var g=E.length;g<16?j[P++]=144|g:g<65536?(j[P++]=220,j[P++]=g>>8,j[P++]=g&255):(j[P++]=221,Xe.setUint32(P,g),P+=4);for(let C=0;C<g;C++)S(E[C])},S=E=>{P>Wt&&(j=x(P));var g=typeof E,C;if(g==="string"){let W=E.length;if(rt&&W>=4&&W<4096){if((rt.size+=W)>EN){let Y,$=(rt[0]?rt[0].length*3+rt[1].length:0)+10;P+$>Wt&&(j=x(P+$));let F;rt.position?(F=rt,j[P]=200,P+=3,j[P++]=98,Y=P-n,P+=4,cy(n,S,0),Xe.setUint16(Y+n-3,P-n-Y)):(j[P++]=214,j[P++]=98,Y=P-n,P+=4),rt=["",""],rt.previous=F,rt.size=0,rt.position=Y}let H=kN.test(E);rt[H?0:1]+=E,j[P++]=193,S(H?-W:W);return}let B;W<32?B=1:W<256?B=2:W<65536?B=3:B=5;let Z=W*3;if(P+Z>Wt&&(j=x(P+Z)),W<64||!o){let H,Y,$,F=P+B;for(H=0;H<W;H++)Y=E.charCodeAt(H),Y<128?j[F++]=Y:Y<2048?(j[F++]=Y>>6|192,j[F++]=Y&63|128):(Y&64512)===55296&&(($=E.charCodeAt(H+1))&64512)===56320?(Y=65536+((Y&1023)<<10)+($&1023),H++,j[F++]=Y>>18|240,j[F++]=Y>>12&63|128,j[F++]=Y>>6&63|128,j[F++]=Y&63|128):(j[F++]=Y>>12|224,j[F++]=Y>>6&63|128,j[F++]=Y&63|128);C=F-P-B}else C=o(E,P+B);C<32?j[P++]=160|C:C<256?(B<2&&j.copyWithin(P+2,P+1,P+1+C),j[P++]=217,j[P++]=C):C<65536?(B<3&&j.copyWithin(P+3,P+2,P+2+C),j[P++]=218,j[P++]=C>>8,j[P++]=C&255):(B<5&&j.copyWithin(P+5,P+3,P+3+C),j[P++]=219,Xe.setUint32(P,C),P+=4),P+=C}else if(g==="number")if(E>>>0===E)E<32||E<128&&this.useRecords===!1||E<64&&!this.randomAccessStructure?j[P++]=E:E<256?(j[P++]=204,j[P++]=E):E<65536?(j[P++]=205,j[P++]=E>>8,j[P++]=E&255):(j[P++]=206,Xe.setUint32(P,E),P+=4);else if(E>>0===E)E>=-32?j[P++]=256+E:E>=-128?(j[P++]=208,j[P++]=E+256):E>=-32768?(j[P++]=209,Xe.setInt16(P,E),P+=2):(j[P++]=210,Xe.setInt32(P,E),P+=4);else{let W;if((W=this.useFloat32)>0&&E<4294967296&&E>=-2147483648){j[P++]=202,Xe.setFloat32(P,E);let B;if(W<4||(B=E*af[(j[P]&127)<<1|j[P+1]>>7])>>0===B){P+=4;return}else P--}j[P++]=203,Xe.setFloat64(P,E),P+=8}else if(g==="object"||g==="function")if(!E)j[P++]=192;else{if(s){let B=s.get(E);if(B){if(!B.id){let Z=s.idsToInsert||(s.idsToInsert=[]);B.id=Z.push(B)}j[P++]=214,j[P++]=112,Xe.setUint32(P,B.id),P+=4;return}else s.set(E,{offset:P-n})}let W=E.constructor;if(W===Object)M(E);else if(W===Array)v(E);else if(W===Map)if(this.mapAsEmptyObject)j[P++]=128;else{C=E.size,C<16?j[P++]=128|C:C<65536?(j[P++]=222,j[P++]=C>>8,j[P++]=C&255):(j[P++]=223,Xe.setUint32(P,C),P+=4);for(let[B,Z]of E)S(B),S(Z)}else{for(let B=0,Z=cf.length;B<Z;B++){let H=ry[B];if(E instanceof H){let Y=cf[B];if(Y.write){Y.type&&(j[P++]=212,j[P++]=Y.type,j[P++]=0);let ee=Y.write.call(this,E);ee===E?Array.isArray(E)?v(E):M(E):S(ee);return}let $=j,F=Xe,ue=P;j=null;let Q;try{Q=Y.pack.call(this,E,ee=>(j=$,$=null,P+=ee,P>Wt&&x(P),{target:j,targetView:Xe,position:P-ee}),S)}finally{$&&(j=$,Xe=F,P=ue,Wt=j.length-10)}Q&&(Q.length+P>Wt&&x(Q.length+P),P=AN(Q,j,P,Y.type));return}}if(Array.isArray(E))v(E);else{if(E.toJSON){const B=E.toJSON();if(B!==E)return S(B)}if(g==="function")return S(this.writeFunction&&this.writeFunction(E));M(E)}}}else if(g==="boolean")j[P++]=E?195:194;else if(g==="bigint"){if(E<BigInt(1)<<BigInt(63)&&E>=-(BigInt(1)<<BigInt(63)))j[P++]=211,Xe.setBigInt64(P,E);else if(E<BigInt(1)<<BigInt(64)&&E>0)j[P++]=207,Xe.setBigUint64(P,E);else if(this.largeBigIntToFloat)j[P++]=203,Xe.setFloat64(P,Number(E));else{if(this.largeBigIntToString)return S(E.toString());if(this.useBigIntExtension&&E<BigInt(2)**BigInt(1023)&&E>-(BigInt(2)**BigInt(1023))){j[P++]=199,P++,j[P++]=66;let W=[],B;do{let Z=E&BigInt(255);B=(Z&BigInt(128))===(E<BigInt(0)?BigInt(128):BigInt(0)),W.push(Z),E>>=BigInt(8)}while(!((E===BigInt(0)||E===BigInt(-1))&&B));j[P-2]=W.length;for(let Z=W.length;Z>0;)j[P++]=Number(W[--Z]);return}else throw new RangeError(E+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}P+=8}else if(g==="undefined")this.encodeUndefinedAsNil?j[P++]=192:(j[P++]=212,j[P++]=0,j[P++]=0);else throw new Error("Unknown type: "+g)},L=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?E=>{let g;if(this.skipValues){g=[];for(let B in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(B))&&!this.skipValues.includes(E[B])&&g.push(B)}else g=Object.keys(E);let C=g.length;C<16?j[P++]=128|C:C<65536?(j[P++]=222,j[P++]=C>>8,j[P++]=C&255):(j[P++]=223,Xe.setUint32(P,C),P+=4);let W;if(this.coercibleKeyAsNumber)for(let B=0;B<C;B++){W=g[B];let Z=Number(W);S(isNaN(Z)?W:Z),S(E[W])}else for(let B=0;B<C;B++)S(W=g[B]),S(E[W])}:E=>{j[P++]=222;let g=P-n;P+=2;let C=0;for(let W in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(W))&&(S(W),S(E[W]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');j[g+++n]=C>>8,j[g+n]=C&255},I=this.useRecords===!1?L:e.progressiveRecords&&!d?E=>{let g,C=i.transitions||(i.transitions=Object.create(null)),W=P++-n,B;for(let Z in E)if(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(Z)){if(g=C[Z],g)C=g;else{let H=Object.keys(E),Y=C;C=i.transitions;let $=0;for(let F=0,ue=H.length;F<ue;F++){let Q=H[F];g=C[Q],g||(g=C[Q]=Object.create(null),$++),C=g}W+n+1==P?(P--,V(C,H,$)):oe(C,H,W,$),B=!0,C=Y[Z]}S(E[Z])}if(!B){let Z=C[Qi];Z?j[W+n]=Z:oe(C,Object.keys(E),W,0)}}:E=>{let g,C=i.transitions||(i.transitions=Object.create(null)),W=0;for(let Z in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(Z))&&(g=C[Z],g||(g=C[Z]=Object.create(null),W++),C=g);let B=C[Qi];B?B>=96&&d?(j[P++]=((B-=96)&31)+96,j[P++]=B>>5):j[P++]=B:V(C,C.__keys__||Object.keys(E),W);for(let Z in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(Z))&&S(E[Z])},T=typeof this.useRecords=="function"&&this.useRecords,M=T?E=>{T(E)?I(E):L(E)}:I,x=E=>{let g;if(E>16777216){if(E-n>sy)throw new Error("Packed buffer would be larger than maximum buffer size");g=Math.min(sy,Math.round(Math.max((E-n)*(E>67108864?1.25:2),4194304)/4096)*4096)}else g=(Math.max(E-n<<2,j.length-1)>>12)+1<<12;let C=new oc(g);return Xe=C.dataView||(C.dataView=new DataView(C.buffer,0,g)),E=Math.min(E,j.length),j.copy?j.copy(C,0,n,E):C.set(j.slice(n,E)),P-=n,n=0,Wt=C.length-10,j=C},V=(E,g,C)=>{let W=i.nextId;W||(W=64),W<h&&this.shouldShareStructure&&!this.shouldShareStructure(g)?(W=i.nextOwnId,W<p||(W=h),i.nextOwnId=W+1):(W>=p&&(W=h),i.nextId=W+1);let B=g.highByte=W>=96&&d?W-96>>5:-1;E[Qi]=W,E.__keys__=g,i[W-64]=g,W<h?(g.isShared=!0,i.sharedLength=W-63,r=!0,B>=0?(j[P++]=(W&31)+96,j[P++]=B):j[P++]=W):(B>=0?(j[P++]=213,j[P++]=114,j[P++]=(W&31)+96,j[P++]=B):(j[P++]=212,j[P++]=114,j[P++]=W),C&&(b+=_*C),m.length>=f&&(m.shift()[Qi]=0),m.push(E),S(g))},oe=(E,g,C,W)=>{let B=j,Z=P,H=Wt,Y=n;j=so,P=0,n=0,j||(so=j=new oc(8192)),Wt=j.length-10,V(E,g,W),so=j;let $=P;if(j=B,P=Z,Wt=H,n=Y,$>1){let F=P+$-1;F>Wt&&x(F);let ue=C+n;j.copyWithin(ue+$,ue+1,P),j.set(so.slice(0,$),ue),P=F}else j[C+n]=so[0]},O=E=>{let g=vN(E,j,n,P,i,x,(C,W,B)=>{if(B)return r=!0;P=W;let Z=j;return S(C),w(),Z!==j?{position:P,targetView:Xe,target:j}:P},this);if(g===0)return M(E);P=g}}useBuffer(e){j=e,j.dataView||(j.dataView=new DataView(j.buffer,j.byteOffset,j.byteLength)),P=0}set position(e){P=e}get position(){return P}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ry=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,$0],cf=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?oy(t,16,e):ay(sc?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==iy&&this.moreTypes?oy(t,ty.indexOf(n.name),e):ay(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function oy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function ay(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function AN(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function TN(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function cy(t,e,n){if(rt.length>0){Xe.setUint32(rt.position+t,P+n-rt.position-t),rt.stringsPosition=P-t;let r=rt;rt=null,e(r[0]),e(r[1])}}function xN(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let ly=new SN({useRecords:!1});const RN=ly.pack;ly.pack;const IN=512,ON=1024,NN=2048;function wi(){return null}function oo(t,e,n={}){if(!k(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];k(c)&&(a=c(a));const l=e[o];k(l)&&(o=l),a!==null&&r.push(o,a)}return r}function ao(t,e,n={}){if(k(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){tt("format","binary",r.message)}}function CN(t){try{const e=hs(t);return RN(e)}catch(e){tt("format","binary",e.message)}}function LN(t){try{return bN(t)}catch(e){tt("format","binary",e.message)}}function uy(){return{id:ht()}}var lf=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.player=11]="player",t[t.bucket=12]="bucket",t[t.pushable=13]="pushable",t[t.collision=14]="collision",t[t.destructible=15]="destructible",t[t.tickertext=16]="tickertext",t[t.tickertime=17]="tickertime",t[t.p1=18]="p1",t[t.p2=19]="p2",t[t.p3=20]="p3",t[t.cycle=21]="cycle",t[t.stepx=22]="stepx",t[t.stepy=23]="stepy",t[t.sender=24]="sender",t[t.arg=25]="arg",t[t.headless=26]="headless",t[t.removed=27]="removed",t))(lf||{});function ac(t){return oo(t,lf,{category:wi,kinddata:wi})}function cc(t){return ao(t,lf)}var uf=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(uf||{});function fy(t){return oo(t,uf)}function hy(t){return ao(t,uf)}function dy(t,e){return{id:ht(),code:t,...e}}var ff=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(ff||{});function MN(t){return oo(t,ff,{board:sC,object:ac,terrain:ac,charset:fy,palette:fy,stats:wi})}function UN(t){return ao(t,ff,{board:oC,object:cc,terrain:cc,charset:hy,palette:hy})}function PN(t){const e={...co(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function DN(t){return k(t)?(t.stats=void 0,co(t)):{}}function co(t){var r;if(!k(t))return{};if(k((r=t.stats)==null?void 0:r.type))return t.stats;t.stats={};const e=D0(t.code);let n=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===Gu){const a=s.image.slice(1).split(" "),c=B0(a,n),l=Pe(c.values.join(" "));switch(n=!1,c.type){case fe.LOADER:t.stats.type=Re.LOADER,t.stats.name=l;break;case fe.BOARD:t.stats.type=Re.BOARD,t.stats.name=l;break;case fe.OBJECT:t.stats.type=Re.OBJECT,t.stats.name=l;break;case fe.TERRAIN:t.stats.type=Re.TERRAIN,t.stats.name=l;break;case fe.CHARSET:t.stats.type=Re.CHARSET,t.stats.name=l;break;case fe.PALETTE:t.stats.type=Re.PALETTE,t.stats.name=l;break;case fe.CONST:{const[u,f]=c.values;if(Se(u)){const d=Pe(u);if(Se(f)){const h=parseFloat(f);t.stats[d]=ke(h)?h:f}else ke(f)?t.stats[d]=f:t.stats[d]=1}break}case fe.RANGE:case fe.SELECT:case fe.NUMBER:case fe.TEXT:case fe.LINK:case fe.HOTKEY:case fe.SCROLL:{const[u,...f]=c.values;if(Se(u)){const d=Pe(u);t.stats[d]=f}break}}}}return k(t.stats.type)||(t.stats.type=Re.OBJECT),t.stats}function py(t){switch(t){default:case Re.ERROR:return"error";case Re.LOADER:return _n(fe.LOADER);case Re.BOARD:return _n(fe.BOARD);case Re.OBJECT:return _n(fe.OBJECT);case Re.TERRAIN:return _n(fe.TERRAIN);case Re.CHARSET:return _n(fe.CHARSET);case Re.PALETTE:return _n(fe.PALETTE)}}function lo(t){return co(t).type??Re.ERROR}function uo(t){return py(lo(t))}function tr(t){return co(t).name??""}function my(t,e){const n=PN(t),r=Object.keys(n);for(let i=0;i<r.length;++i){const s=r[i];switch(s){case"char":case"color":case"bg":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[s]=n[s];break;case"canpush":case"ispushable":e.pushable=1;break;case"iswalk":case"iswalkable":e.collision=Ye.ISWALK;break;case"isswim":case"isswimable":e.collision=Ye.ISSWIM;break;case"issolid":e.collision=Ye.ISSOLID;break;case"isbullet":e.collision=Ye.ISBULLET;break;case"canshoot":case"isdestructible":e.destructible=1;break}}}function hf(t){if(k(t))switch(lo(t)){default:return;case Re.ERROR:return t.code??"";case Re.LOADER:return t.code??"";case Re.BOARD:return k(t.board)||(t.board=iC()),t.board.id=t.id,t.board;case Re.OBJECT:return k(t.object)||(t.object=uy()),t.object.name=tr(t),my(t,t.object),t.object;case Re.TERRAIN:return k(t.terrain)||(t.terrain=uy()),t.terrain.name=tr(t),my(t,t.terrain),t.terrain;case Re.CHARSET:return k(t.charset),t.charset;case Re.PALETTE:return k(t.palette),t.palette}}function gy(t){return{id:ht(),name:V_(),timestamp:0,activelist:[],pages:t,flags:{}}}var df=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t))(df||{});function BN(t){return oo(t,df,{pages:e=>e.map(MN)})}function FN(t){return ao(t,df,{pages:e=>e.map(UN)})}function vi(t,e){if(!k(t))return;const n=Pe(e);return t.pages.find(i=>i.id===e||n===tr(i))}function pf(t,e,n){if(!k(t))return;const r=Pe(n);return t.pages.find(s=>lo(s)===e&&(s.id===n||r===tr(s)))}function $N(t,e){return k(t)?t.pages.filter(n=>lo(n)===e):[]}function yy(t,e){if(!k(t)||!k(e))return!1;const n=vi(t,e.id);return k(n)?!1:(t.pages.push(e),!0)}function jN(t,e){const n=vi(t,e);if(k(t)&&k(n)){const r=Pe(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==tr(i)),n}}function vn(t,e){if(k(e)&&k(e.kind))return k(e.kinddata)||(e.kinddata=k(e.id)?lc(t,e.kind):by(t,e.kind)),e.kinddata}function zN(t,e,n){const r=vn(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function _y(t,e){const n=vn(t,e);return{char:(e==null?void 0:e.char)??(n==null?void 0:n.char)??1,color:(e==null?void 0:e.color)??(n==null?void 0:n.color)??be.WHITE,bg:(e==null?void 0:e.bg)??(n==null?void 0:n.bg)??be.ONBORROW}}function lc(t,e){const n=e??"",r=pf(t,Re.OBJECT,n);if(k(r)){const i=hf(r);return{...hs(i),name:n,code:r.code}}}function by(t,e){const n=e??"",r=pf(t,Re.TERRAIN,n);if(k(r)){const i=hf(r);return{...hs(i),name:n,code:r.code}}}function es(t,e){const n=vi(t,e);return hf(n)}function ts(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function mf(t,e){t&&delete t.flags[e]}function wy(t,e,n){const r=ts(t,e);return r==null?void 0:r[n]}function WN(t,e,n,r){const i=ts(t,e);return i&&(i[n]=r),r}function uc(t,e){const n=wy(t,e,"board");return es(t,Se(n)?n:"")}function gf(t,e,n){if(!k(t))return;WN(t,e,"board",n);const r=es(t,n);k(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function GN(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=wy(t,r,"board");return Se(i)?i:""});return Mk(n)}function vy(t){return GN(t).map(n=>es(t,n)).filter(k)}function HN(t,e,n,r){const i=rs(e,(n==null?void 0:n.id)??"");if(!k(t)||!k(e)||!k(i)||!k(i.x)||!k(i.y)||!k(e.lookup)||r.x<0||r.x>=ze||r.y<0||r.y>=rn||i.x-r.x===0&&i.y-r.y===0)return!0;const s=r.x+r.y*ze,o=vn(t,i),a=i.collision??(o==null?void 0:o.collision),c=rs(e,e.lookup[s]??"");if(k(c))return!0;const l=e.terrain[s];if(k(l)){const u=vn(t,l),f=l.collision??(u==null?void 0:u.collision);if(Mp(a,f))return!0}return!1}function VN(t,e,n,r){const i=rs(e,(n==null?void 0:n.id)??"");if(!k(t)||!k(e)||!k(i)||!k(i.x)||!k(i.y)||!k(e.lookup)||r.x<0||r.x>=ze||r.y<0||r.y>=rn)return{kind:"edge",collision:Ye.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=i.x+i.y*ze,o=r.x+r.y*ze,a=vn(t,i),c=i.collision??(a==null?void 0:a.collision),l=rs(e,e.lookup[o]??"");if(k(l))return{...l};const u=e.terrain[o];if(k(u)){const f=vn(t,u),d=u.collision??(f==null?void 0:f.collision);if(Mp(c,d))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,k(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function ns(t,e){const n=vn(t,e);return k(e==null?void 0:e.id)&&k(e.x)&&k(e.y)?Pe(e.name??(n==null?void 0:n.name)??"object"):Pe((e==null?void 0:e.name)??(n==null?void 0:n.name)??"terrain")}function yf(t,e,n,r){if(!k(t)||!k(e)||!k(e.named)||!k(n))return;const i=ns(t,n);e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function KN(t,e,n){if(!(!k(t)||!k(e)||!k(e.lookup)||!k(n==null?void 0:n.id))&&!k(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*ze]=n.id}}function fc(t,e){if(!k(t)||!k(e)||k(e.lookup)&&k(e.named))return;const n=new Array(ze*rn).fill(void 0),r={},i=Object.values(e.objects);for(let a=0;a<i.length;++a){const c=i[a];if(k(c.x)&&k(c.y)&&k(c.id)&&!k(c.removed)){c.category=To.ISOBJECT,n[c.x+c.y*ze]=c.id;const l=ns(t,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let s=0,o=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(k(c)){c.x=s,c.y=o,c.category=To.ISTERRAIN;const l=ns(t,c);r[l]||(r[l]=new Set),r[l].add(a)}++s,s>=ze&&(s=0,++o)}e.lookup=n,e.named=r}function hc(t,e,n){return ns(t,e)!=="player"&&k(e)?(e.removed=n,!0):!1}function fo(t,e,n){var r;if(k(t)&&k(e)&&k(n==null?void 0:n.id)){if(k(e.lookup)&&k(n.x)&&k(n.y)){const s=n.x+n.y*ze;e.lookup[s]===n.id&&e.lookup.splice(s,1)}const i=ns(t,n);k((r=e.named)==null?void 0:r[i])&&k(n.id)&&e.named[i].delete(n.id)}}function qN(t,e,n){const r=[];if(!k(t)||!k(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&k(o.removed)&&n-o.removed>Oo*5&&(r.push(o.id),My(e,o.id))}return r}function JN(t,e,n){const r=[];if(!k(t)||!k(e))return r;e.lookup=void 0,fc(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!k(a.id))continue;a.lx=a.x,a.ly=a.y;const c=vn(t,a),l=a.code??(c==null?void 0:c.code)??"";l&&r.push({id:a.id,type:Re.OBJECT,code:l,object:a,terrain:void 0})}const s=qN(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Re.ERROR,code:"",object:void 0,terrain:void 0});return r}function XN(t,e,n,r){if(k(t)&&k(e)&&k(n)){const[i,s]=n,o=lc(t,i);if(k(o)&&k(o.name)){const a=Ef(e,r,i);return gc(a,s),yf(t,e,a),a}}}function _f(t,e,n,r){if(k(t)&&k(e)&&k(n)){const[i,s]=n,o=by(t,i);if(k(o)){const c=Ly(e,r,i);gc(c,s);const l=r.x+r.y*ze;return yf(t,e,c,l),c}const a=lc(t,i);if(k(a)&&k(a.name)){const c=Ef(e,r,i);return gc(c,s),KN(t,e,c),yf(t,e,c),c}}}const Ey={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Kr(t){return He(t)&&ky(t[0])}function ky(t){return k(To[t])&&Se(t)}function Sy(t){if(Se(t))return Ey[Pe(t)]}function Ay(t){if(Kr(t))return t;if(ky(t))return[t];const e=Sy(t);if(k(e))return[e]}function dc(t){const e=N.words[t],n=Ay(e);if(Kr(n))return[n,t+1];const[r,i]=Gt(t),s=Ay(r);return Kr(s)?[s,i]:[void 0,t]}const Ty={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};Ye.ISSOLID,Ye.ISWALK,Ye.ISSWIM,Ye.ISBULLET,Ye.ISWALK,Ye.ISSWIM;function Ei(t){return He(t)&&bf(t[0])}function bf(t){return k(Ye[t])&&Se(t)}function ZN(t){if(Se(t))return Ty[Pe(t)]}function xy(t){const e=N.words[t];if(Ei(e))return[e,t+1];if(bf(e))return[[e],t+1];const[n,r]=Gt(t);return Ei(n)?[n,r]:bf(n)?[[n],r]:[void 0,t]}function Gt(t,e=!0){var r,i,s,o,a;const n=N.words[t];if(Sy(n)){const[c,l]=dc(t);if(k(c))return[c,l]}if(ZN(n)){const[c,l]=xy(t);if(k(c))return[c,l]}if(Oy(n)){const[c,l]=mc(t);if(k(c))return[c,l]}if(Se(n)&&Pe(n)==="rnd"){const[c,l]=Gt(t+1),[u,f]=Gt(l);return ke(c)&&ke(u)?[Ms(c,u),f]:ke(c)?[Ms(0,c),l]:[Ms(0,1),t+1]}if(Rp(n)){const[c,l]=Kl(t);if(k(c))return[c,l]}if(!k(n))return[void 0,t];if(gr(n)||ke(n)||He(n))return[n,t+1];if(Se(n)){const c=Pe(n);if(e){const l=(r=N.get)==null?void 0:r.call(N,n);if(k(l))return[l,t+1]}switch(c){case"aligned":case"alligned":{const l=Up(N.board,N.element,N.player);return!k(N.element)||!k(l)?[0,t+1]:[N.element.x===l.x||N.element.y===l.y?1:0,t+1]}case"contact":{const l=Up(N.board,N.element,N.player);if(!k(N.element)||!k(l))return[0,t+1];const u=(l.x??0)-(((i=N.element)==null?void 0:i.x)??0),f=(l.y??0)-(((s=N.element)==null?void 0:s.y)??0);return[u===0&&Math.abs(f)<2||f===0&&Math.abs(u)<2?1:0,t+1]}case"blocked":{const[l,u]=ne(N.words,t+1,[q.DIR]);return[HN(N.book,N.board,N.element,l)?1:0,u]}case"any":{const[l,u]=ne(N.words,t+1,[q.KIND]),f=ha(l)??"",d=Us(N.board,f);return[Pp(d,l).length?1:0,u]}case"rnd":return[Ms(0,1),t+1];case"abs":{const[l,u]=ne(N.words,t+1,[q.NUMBER]);return[Math.abs(l),u]}case"ceil":{const[l,u]=ne(N.words,t+1,[q.NUMBER]);return[Math.ceil(l),u]}case"floor":{const[l,u]=ne(N.words,t+1,[q.NUMBER]);return[Math.floor(l),u]}case"round":{const[l,u]=ne(N.words,t+1,[q.NUMBER]);return[Math.round(l),u]}case"min":{const l=[];for(let u=t+1;u<N.words.length;){const[f,d]=Gt(u);if(He(f)&&!gr(f)&&!yr(f)&&!Kr(f)&&!Ei(f)&&!En(f))return[mr(f),d];u=d,l.push(f)}return[Math.min(...l),N.words.length]}case"max":{const l=[];for(let u=t+1;u<N.words.length;){const[f,d]=Gt(u);if(He(f)&&!gr(f)&&!yr(f)&&!Kr(f)&&!Ei(f)&&!En(f))return[mr(f),d];u=d,l.push(f)}return[Math.max(...l),N.words.length]}case"clamp":{const[l,u,f,d]=ne(N.words,t+1,[q.NUMBER,q.NUMBER,q.NUMBER]);return[ui(l,u,f),d]}case"pick":{const l=[];for(let u=t+1;u<N.words.length;){const[f,d]=Gt(u);if(He(f)&&!gr(f)&&!yr(f)&&!Kr(f)&&!Ei(f)&&!En(f))return[mr(f),d];u=d,l.push(f)}return[mr(l),N.words.length]}case"range":{const[l,u,f,d]=ne(N.words,t+1,[q.NUMBER,q.MAYBE_NUMBER,q.MAYBE_NUMBER]);return[Vl(l,u,f),d]}case"run":{const[l,u]=ne(N.words,t+1,[q.STRING]);return Rc(l),[(o=N.get)==null?void 0:o.call(N,"arg"),u]}case"runwith":{const[l,u,f]=ne(N.words,t+1,[q.ANY,q.STRING]);return k(N.element)&&(N.element.arg=l),Rc(u),[(a=N.get)==null?void 0:a.call(N,"arg"),f]}}}return[n,t+1]}function YN(t){return k(t)&&t<be.ONBLACK?t:void 0}function QN(t){return k(t)&&t>be.WHITE&&t<be.ONCLEAR?t-be.ONBLACK:void 0}const pc={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR",onshadow:"ONSHADOW",onborrow:"ONBORROW"};function En(t){return He(t)&&Iy(t[0])}function Ry(t){return En(t)&&t[0].startsWith("ON")}function Iy(t){return k(be[t])&&Se(t)}function Oy(t){if(Se(t))return pc[Pe(t)]}function eC(t){return t.map(e=>be[e]).find(e=>k(e)&&e<be.ONBLACK)}function tC(t){return t.map(e=>be[e]).find(e=>k(e)&&e>=be.ONBLACK)}function Ny(t){if(En(t))return t;if(Iy(t))return[t];const e=Oy(t);if(k(e))return[e]}function Cy(t){const e=N.words[t],n=Ny(e);if(En(n))return[n,t+1];const[r,i]=Gt(t),s=Ny(r);return En(s)?[s,i]:[void 0,t]}function mc(t){const e=[];let n=t;const[r,i]=Cy(t);if(En(r)&&(e.push(...r),n=i),En(e)&&!Ry(e)){const[s,o]=Cy(i);Ry(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function nC(t){const e={};return t.every(n=>{const r=be[n];k(r)&&(r<be.ONBLACK?e.color=r:e.bg=r-be.ONBLACK)}),e}function rC(){return new Array(ze*rn).map(()=>{})}function iC(t=mb){const e={terrain:rC(),objects:{},id:""};return t(e)}var wf=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t))(wf||{});function sC(t){return oo(t,wf,{terrain:e=>e.map(ac),objects:e=>Object.values(e).map(ac),id:wi,named:wi,lookup:wi,codepage:wi})}function oC(t){return ao(t,wf,{terrain:e=>e.map(cc),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=cc(e[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function vf(t){var e;return Pe((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"object")}function aC(t){var e;return(t==null?void 0:t.color)??((e=t==null?void 0:t.kinddata)==null?void 0:e.color)??be.BLACK}function cC(t){var e;return(t==null?void 0:t.bg)??((e=t==null?void 0:t.kinddata)==null?void 0:e.bg)??be.BLACK}function gc(t,e){if(!k(t)||!En(e))return;const{color:n,bg:r}=nC(e);k(n)&&(t.color=n),k(r)&&(t.bg=r)}function lC(t,e){if(!k(t)||!k(e)||!k(e.x)||!k(e.y)||e.x<0||e.x>=ze||e.y<0||e.y>=rn)return;const n={...e},r=e.x+e.y*ze;return t.terrain[r]=n,e}function uC(t,e){if(!k(t)||!k(e))return;const n={...e,id:e.id??ht()};return t.objects[n.id]=n,n}function Ly(t,e,n){return lC(t,{...e,kind:n})}function Ef(t,e,n,r){return uC(t,{...e,id:r??void 0,kind:n})}function rs(t,e){if(t)return t.objects[e]}function kf(t,e,n,r,i){if(!k(t)||!k(e))return{x:0,y:0};const s={x:e.x??0,y:e.y??0},o={x:e.lx??s.x,y:e.ly??s.y},a=Wi(o,s),c=ze-1,l=rn-1;for(let u=0;u<r.length;++u){const f=Pk(r[u]);switch(f){case ae.IDLE:break;case ae.NORTH:case ae.SOUTH:case ae.WEST:case ae.EAST:Tt(s,f);break;case ae.BY:{const[d,h]=r.slice(u+1);ke(d)&&ke(h)&&(s.x=ui(s.x+d,0,c),s.y=ui(s.y+h,0,l)),u+=2;break}case ae.AT:{const[d,h]=r.slice(u+1);ke(d)&&ke(h)&&(s.x=ui(d,0,c),s.y=ui(h,0,l)),u+=2;break}case ae.FLOW:Tt(s,a);break;case ae.SEEK:{const d=fC(t,e,n);gr(d)&&Tt(s,Wi(i,d));break}case ae.RNDNS:Tt(s,mr(ae.NORTH,ae.SOUTH));break;case ae.RNDNE:Tt(s,mr(ae.NORTH,ae.EAST));break;case ae.RND:Tt(s,mr(ae.NORTH,ae.SOUTH,ae.WEST,ae.EAST));break;case ae.CW:case ae.CCW:case ae.OPP:case ae.RNDP:{const d=kf(t,e,n,r.slice(u+1),i);switch(s.x=i.x,s.y=i.y,f){case ae.CW:switch(Wi(i,d)){case ae.NORTH:Tt(s,ae.EAST);break;case ae.SOUTH:Tt(s,ae.WEST);break;case ae.EAST:Tt(s,ae.SOUTH);break;case ae.WEST:Tt(s,ae.NORTH);break}break;case ae.CCW:switch(Wi(i,d)){case ae.NORTH:Tt(s,ae.WEST);break;case ae.SOUTH:Tt(s,ae.EAST);break;case ae.EAST:Tt(s,ae.NORTH);break;case ae.WEST:Tt(s,ae.SOUTH);break}break;case ae.OPP:switch(Wi(i,d)){case ae.NORTH:Tt(s,ae.SOUTH);break;case ae.SOUTH:Tt(s,ae.NORTH);break;case ae.EAST:Tt(s,ae.WEST);break;case ae.WEST:Tt(s,ae.EAST);break}break;case ae.RNDP:switch(Wi(i,d)){case ae.NORTH:case ae.SOUTH:s.x+=mr(-1,1);break;case ae.WEST:case ae.EAST:s.y+=mr(-1,1);break}break}break}}}return s}function My(t,e){return k(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function fC(t,e,n){if(!k(t)||!k(e))return;const r=t.objects[n];if(k(r))return r;if(gr(e))return Dp(e,Us(t,"player"))}const N={timestamp:0,book:void 0,board:void 0,element:void 0,player:"",isplayer:!1,words:[],get:void 0};var q=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NUMBER=5]="NUMBER",t[t.STRING=6]="STRING",t[t.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=9]="MAYBE_COLLISION",t[t.MAYBE_COLOR=10]="MAYBE_COLOR",t[t.MAYBE_KIND=11]="MAYBE_KIND",t[t.MAYBE_DIR=12]="MAYBE_DIR",t[t.MAYBE_NUMBER=13]="MAYBE_NUMBER",t[t.MAYBE_STRING=14]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",t[t.ANY=16]="ANY",t))(q||{});function It(t,e){throw new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function ne(t,e,n){var o,a,c,l;const r=N.words;N.words=t;const i=[];let s=e;for(let u=0;u<n.length;++u)switch(n[u]){case 0:{const[f,d]=dc(s);Kr(f)||It("terrain or object",f),s=d,i.push(f);break}case 1:{const[f,d]=xy(s);Ei(f)||It("solid, walk, swim, bullet, walkable or swimmable",f),s=d,i.push(f);break}case 2:{const[f,d]=mc(s);En(f)||It("color",f),s=d,i.push(f);break}case 3:{const[f,d]=Np(s);Gi(f)?(s=d,i.push(f)):It("kind",f);break}case 4:{const[f,d]=Kl(s);if(yr(f)){const h=((o=N.element)==null?void 0:o.x)??0,p=((a=N.element)==null?void 0:a.y)??0,m={x:h,y:p},b=k(N.board)&&k(N.element)?kf(N.board,N.element,N.player,f,m):m;s=d,i.push(b)}else It("direction",f);break}case 5:{const[f,d]=Gt(s);if(Se(f)){const h=parseFloat(f);ke(h)?i.push(h):It("number",f)}else ke(f)?i.push(f):It("number",f);s=d;break}case 6:{const f=N.words[s];Se(f)||It("string",f),++s,i.push(f);break}case 7:{const[f,d]=Gt(s,!1);let h=f;if(Se(h)){const p=parseFloat(h);ke(p)&&(h=p)}else ke(h)||It("number or string",h);s=d,i.push(h);break}case 8:{const[f,d]=dc(s);f!==void 0&&!Kr(f)&&It("optional terrain or object",f),s=d,i.push(f);break}case 9:{const[f,d]=dc(s);f!==void 0&&!Ei(f)&&It("optional solid, walk, swim, bullet, walkable or swimmable",f),s=d,i.push(f);break}case 10:{const[f,d]=mc(s);f!==void 0&&!En(f)&&It("optional color",f),s=d,i.push(f);break}case 11:{const[f,d]=Np(s);f!==void 0&&!Gi(f)&&It("optional kind",f),s=d,i.push(f);break}case 12:{const[f,d]=Kl(s);if(yr(f)){const h=((c=N.element)==null?void 0:c.x)??0,p=((l=N.element)==null?void 0:l.y)??0,m={x:h,y:p},b=N.board?kf(N.board,N.element,N.player,f,m):m;s=d,i.push(b)}else f===void 0?(s=d,i.push(void 0)):It("optional direction",f);break}case 13:{const[f,d]=Gt(s);if(Se(f)){const h=parseFloat(f);ke(h)?i.push(h):It("optional number",f)}else ke(f)||f===void 0?i.push(f):It("optional number",f);s=d;break}case 14:{const f=N.words[s];f!==void 0&&!Se(f)&&It("optional string",f),++s,i.push(f);break}case 15:{const[f,d]=Gt(s,!1);let h=f;if(Se(h)){const p=parseFloat(h);ke(p)&&(h=p)}else h!==void 0&&!ke(h)&&It("number or string",h);s=d,i.push(h);break}case 16:{const[f,d]=Gt(s);s=d,i.push(f);break}}return N.words=r,[...i,s]}const hC=["echo","reverb","chorus","phaser","distortion","vibrato"];function Uy(t,e,n){const[r]=ne(n,0,[q.MAYBE_STRING]),i=r??"",s=e.get(i);qE("audio",t,Se(s)?s:i)}function nr(t,e){const[n]=ne(e,0,[q.NUMBER_OR_STRING]);if(ke(n))$l("audio",t,"volume",n);else if(hC.includes(Pe(n))){const[r,i]=ne(e,1,[q.NUMBER_OR_STRING,q.MAYBE_NUMBER_OR_STRING]);JE("audio",t,n,r,i)}else{const[r]=ne(e,1,[q.MAYBE_NUMBER_OR_STRING]);if(ke(r)){const i=e.length-1,s=new Array(i).fill(q.NUMBER),o=ne(e,1,s).slice(0,i),a=o.length===1?o[0]:o;$l("audio",t,n,a)}else{const[i]=ne(e,1,[q.MAYBE_NUMBER_OR_STRING]);$l("audio",t,n,i)}}}const dC=pr().command("play",(t,e)=>(Uy(1,t,e),0)).command("synth",(t,e)=>{for(let n=1;n<=8;++n)nr(n,e);return 0}).command("synth1",(t,e)=>(nr(1,e),0)).command("synth2",(t,e)=>(nr(2,e),0)).command("synth3",(t,e)=>(nr(3,e),0)).command("synth4",(t,e)=>(nr(4,e),0)).command("synth5",(t,e)=>(nr(5,e),0)).command("synth6",(t,e)=>(nr(6,e),0)).command("synth7",(t,e)=>(nr(7,e),0)).command("synth8",(t,e)=>(nr(8,e),0)).command("bgplay",(t,e)=>(Uy(0,t,e),0)).command("bgsynth",(t,e)=>(nr(0,e),0)).command("tts",(t,e)=>{const[n,r]=ne(e,0,[q.STRING,q.MAYBE_STRING]);return KE("audio",r??"",n),0});function yc(t,e,n,r){const i=Se(e)?e:e.id,s=Se(e)?void 0:{x:e.x??0,y:e.y??0},o=Se(n)?n:n.id,a=i??s;k(o)&&k(a)&&t.send(o,r,a)}function pC(t,e,n,r){k(n==null?void 0:n.id)?(n.headless=!0,fo(t,e,n)):Ly(e,r,"empty")}function Py(t,e,n,r,i){const s=VN(e,n,r,i);if(k(s)){yc(t,s,t.id(),"thud"),r.kind===We.PLAYER?yc(t,t.id(),s,"touch"):r.collision===Ye.ISBULLET?yc(t,t.id(),s,"shot"):yc(t,t.id(),s,"bump");const o=vn(e,s);return(s.destructible??(o==null?void 0:o.destructible))&&pC(e,n,s,i),!1}return!0}function Dy(t,e,n){if(!gr(N.element))return 0;const[r,i]=ne(e,0,[q.DIR,q.MAYBE_KIND]),s=i??["bullet"],o=XN(N.book,N.board,s,{x:N.element.x,y:N.element.y});if(k(o)){o.arg=n,o.collision=Ye.ISBULLET,o.destructible=1,o.stepx=r.x-N.element.x,o.stepy=r.y-N.element.y;const a=vn(N.book,o),c=o.code??(a==null?void 0:a.code)??"";w_(N.book,N.board,o,c,1),o.x===N.element.x&&o.y===N.element.y?o.headless=!0:t.bucket(o.id)}return t.yield(),0}const mC=pr().command("change",(t,e)=>{if(!k(N.book)||!k(N.board))return 0;const[n,r]=ne(e,0,[q.KIND,q.KIND]);fc(N.book,N.board);const i=ha(n)??"",s=Us(N.board,i),o=Pp(s,n),a=ha(r),c=Cp(r),l=Lp(r);return o.forEach(u=>{if(ns(N.book,u)===a)k(c)&&(u.color=c),k(l)&&(u.bg=l);else{if(k(u.id)&&(fo(N.book,N.board,u),!hc(N.book,u,N.timestamp)))return;gr(u)&&_f(N.book,N.board,r,u)}}),0}).command("put",(t,e)=>{if(!k(N.book)||!k(N.board))return 0;const[n,r]=ne(e,0,[q.DIR,q.KIND]);return fc(N.book,N.board),_f(N.book,N.board,r,n),0}).command("shootwith",(t,e)=>{const[n,r]=ne(e,0,[q.ANY]);return Dy(t,e.slice(r),n)}).command("shoot",Dy).command("throwstar",()=>0),gC=navigator.userAgent.includes("Mac")?"cmd":"ctrl",qr="$dkpurple",yC="$196",_C="$205";function an(t,e){return`$${t}${e}$blue`}function By(t,e){return`$${t}${e}$ondkblue`}function et(t,e){Nt(t,e)}function bC(t,e){const n=yC.repeat(e);et(t,`${qr}${n}`)}function Sf(t,e){const n=_C.repeat(e);et(t,`${qr}${n}`)}function ho(t,e){et(t,`${qr} ${" ".repeat(e.length)} `),bC(t,e.length+2),et(t,`${qr} $white${e} `),Sf(t,e.length+2)}function Ar(t,e){et(t,`${qr} ${" ".repeat(e.length)} `),et(t,`${qr} $gray${e} `),Sf(t,e.length+2)}function De(t,e,n){et(t,`${qr} $white${e} $blue${n}`)}function Fe(t,e){et(t,`${qr}$blue${e}`)}function is(t=""){jl("cli",t,N.player)}const wC=pr().command("send",(t,e)=>{const[n,r]=ne(e,0,[q.STRING,q.ANY]);switch(n){case"helpmenu":ho("cli","H E L P"),De("cli","#help controls","zss controls and inputs"),et("cli","!helpcontrols;read help controls"),et("cli",""),De("cli","#help text","text formatting"),et("cli","!helptext;read help text"),et("cli",""),De("cli","#help developer","developer commands"),et("cli","!helpdeveloper;read help developer"),et("cli",""),De("cli","#help player","player settings"),et("cli","!helpplayer;read help player"),Ar("cli","keyboard input"),De("cli","?","open console"),De("cli","esc","close console"),De("cli","tab","move console"),De("cli","up / down arrow keys","navigate console items"),De("cli","left / right arrow keys","change console items"),De("cli","enter","interact with console items"),De("cli","alt + arrow keys","skip words and console lines"),De("cli",`${gC} + up / down arrow keys`,"input history");break;case"helpcontrols":ho("cli","zss controls and inputs"),Ar("cli","keyboard input"),De("cli","arrow keys","move"),De("cli","shift + arrow keys","shoot"),De("cli","enter","ok / accept"),De("cli","escape","cancel / close"),De("cli","tab","menu / action"),Ar("cli","mouse input"),Fe("cli","todo ???"),Ar("cli","controller input"),De("cli","left stick","move"),De("cli","right stick","aim"),De("cli","a","ok / accept"),De("cli","b","cancel / close"),De("cli","y","menu / action"),De("cli","x","shoot"),De("cli","triggers","shoot");break;case"helptext":ho("cli","text formatting"),Ar("cli","typography"),Fe("cli","plain text"),Fe("cli","$centering text"),Fe("cli",'"\\"@quoted strings for special chars\\""'),Fe("cli","$$0-255 for ascii chars $159$176$240"),Fe("cli",`use color names like ${an("red","$$red")} to change foreground color`),Fe("cli",`use color names like ${By("ongreen","$$ongreen")} to change background color`),Fe("cli",`use clear ${By("onclear","to change background to")} transparent`),Ar("cli","hyperlinks"),Fe("cli",`${an("white",'"!hotkey"')} message shortcut;${an("gray","Label")}`),Fe("cli",`${an("white",'"!range"')} flag [labelmin] [labelmax];${an("gray","Input Label")}`),Fe("cli",`${an("white",'"!select"')} flag ...list of values;${an("gray","Input Label")}`),Fe("cli",`${an("white",'"!number"')} flag [minvalue] [maxvalue];${an("gray","Input Label")}`),Fe("cli",`${an("white",'"!text"')} flag;${an("gray","Input Label")}`),Fe("cli",`${an("white",'"!copyit"')} flag;${an("gray","Input Label")}`);break;case"helpdeveloper":ho("cli","developer commands"),De("cli","#books","list books in memory"),De("cli","#pages","list pages in opened book"),De("cli","@[pagetype:]page name","create & edit a new codepage in the currently opened book"),De("cli","#trash","list books and pages from open book you can delete"),De("cli","#save","flush state to register");break;case"helpplayer":ho("cli","player settings"),Fe("cli","todo");break;default:Nt("$2",`${n} ${r??""}`);break}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(Ot),s=i.join(" ");switch(Pe(r)){case _n(fe.LOADER):n=xi(We.CONTENT,s,Re.LOADER);break;default:n=xi(We.CONTENT,[r,...i].join(" "),Re.OBJECT);break;case _n(fe.BOARD):n=xi(We.CONTENT,s,Re.BOARD);break;case _n(fe.OBJECT):n=xi(We.CONTENT,s,Re.OBJECT);break;case _n(fe.TERRAIN):n=xi(We.CONTENT,s,Re.TERRAIN);break;case _n(fe.CHARSET):n=xi(We.CONTENT,s,Re.CHARSET);break;case _n(fe.PALETTE):n=xi(We.CONTENT,s,Re.PALETTE);break}return k(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(Ot).join(" ");return Nt("$2",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ot(n),s=r.map(Ot).join(" ");return Nt("$2",`!${s};${i}`),0}).command("dev",()=>(is(),WE("cli",N.player),0)).command("share",()=>(is(),GE("cli",N.player),0)).command("bookcreate",(t,e)=>{const[n]=ne(e,0,[q.MAYBE_STRING]),r=g_(n);return k(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=ne(e,0,[q.STRING]),r=Xr(n);return k(r)?(Fe("cli",`opened [book] ${r.name}`),xc(We.MAIN,r.id),t.command("pages")):tt("cli","bookopen",`book ${n} not found`,N.player),0}).command("booktrash",(t,e)=>{const[n]=ne(e,0,[q.STRING]),r=Ht(We.MAIN),i=Xr(n);return k(i)&&(r===i&&xc(We.MAIN,""),KL(n),Fe("cli",`trashed [book] ${i.name}`),is(),t.command("pages")),0}).command("pageopen",(t,e)=>{const[n]=ne(e,0,[q.STRING]),r=Un(We.MAIN);if(!k(r))return 0;const i=vi(r,n);if(k(i)){const s=tr(i),o=uo(i);Fe("cli",`opened [${o}] ${s}`),pp(hp(r.id,i.id),i.code);const a=uo(i);ZE("cli",r.id,i.id,a,`${s} - ${r.name}`,N.player)}else tt("cli","pageopen",`page ${n} not found`,N.player);return 0}).command("pagetrash",(t,e)=>{const[n]=ne(e,0,[q.STRING]),r=Un(We.MAIN),i=jN(r,n);if(k(n)){const s=tr(i),o=uo(i);Fe("cli",`trashed [${o}] ${s}`),is(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(Ot).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{Ar("cli","books");const t=Ht(We.MAIN);De("cli","main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=Ht(We.CONTENT);De("cli","content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),Sf("cli",7);const n=Tc();return n.length?n.forEach(r=>{et("cli",`!bookopen ${r.id};${r.name}`)}):Fe("cli","no books found"),et("cli","!bookcreate;create a new book"),0}).command("pages",()=>{Ar("cli","pages");const t=Un(We.MAIN);return k(t)&&(De("cli","main",`${t.name} $GREEN${t.id}`),t.pages.length?t.pages.forEach(e=>{const n=tr(e),r=uo(e);et("cli",`!pageopen ${e.id};[${r}] ${n}`)}):(et("cli",""),Fe("cli","no pages found"),Fe("cli","use @ to create a page"),Fe("cli","@board name of board"),Fe("cli","@object name of object"),Fe("cli","@terrain name of terrain"),Fe("cli","You can omit the type and it will default to object"),Fe("cli","@object name of object"),Fe("cli","@name of object"))),0}).command("trash",()=>{Ar("cli","$REDTRASH"),Fe("cli","books");const t=Tc();t.length&&(t.forEach(n=>{et("cli",`!booktrash ${n.id};$REDTRASH ${n.name}`)}),et("cli",""));const e=Ht(We.MAIN);return k(e)&&(Fe("cli",`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=tr(n);et("cli",`!pagetrash ${n.id};$REDTRASH ${r}`)}),et("cli","")),0}).command("save",()=>(is(),0)).command("savewith",(t,e)=>{const[n]=ne(e,0,[q.STRING]);return is(n),0}).command("nuke",()=>(VE("cli",N.player),0)).command("joincode",()=>($E("cli",N.player),0));function vC(t){const e=Ey[t];if(k(e))return e;const n=Ty[t];if(k(n))return n;const r=pc[t];if(k(r))return r;const i=Tp[t];if(k(i))return i}const EC=pr({get(t,e){const n=vC(e);return k(n)?[!0,n]:[!1,void 0]}}),kC=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Fy=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","sender","arg"]),SC=["NORTH","SOUTH","WEST","EAST"];function AC(t){const e=cs(t);if(ke(e.inputcurrent)||(e.inputcurrent=0),He(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Ft.NONE,i=0]=n??[Ft.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&fk?1:0,e.inputctrl=i&hk?1:0,e.inputshift=i&dk?1:0,r){case Ft.MOVE_UP:case Ft.MOVE_DOWN:case Ft.MOVE_LEFT:case Ft.MOVE_RIGHT:e.inputmove=[SC[r-Ft.MOVE_UP]];break;case Ft.OK_BUTTON:e.inputok=1;break;case Ft.CANCEL_BUTTON:e.inputcancel=1;break;case Ft.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Ft.NONE&&o!==r}),e}const TC=pr({get(t,e){var s,o;if(N.isplayer&&kC.has(e)){const a=AC(((s=N.element)==null?void 0:s.id)??"")[e];return[k(a),a]}const n=(o=N.element)==null?void 0:o[e];if(k(n)||Fy.has(e))return[!0,n];const i=cs(N.player)[e];return[k(i),i]},set(t,e,n){var s;const r=(s=N.element)==null?void 0:s[e];if(k(r)||Fy.has(e))return k(N.element)&&(N.element[e]=n),[!0,n];const i=cs(N.player);return i[e]=n,[!0,n]},everytick(t){var e,n;(e=N.element)!=null&&e.headless&&t.command("die"),k((n=N.element)==null?void 0:n.x)&&k(N.element.y)&&k(N.element.stepx)&&k(N.element.stepy)&&Py(t,N.book,N.board,N.element,{x:N.element.x+N.element.stepx,y:N.element.y+N.element.stepy})===!1&&(N.element.stepx=0,N.element.stepy=0,zN(N.book,N.element,"destructible")&&(N.element.headless=!0,hc(N.book,N.element,N.timestamp)))}}).command("become",(t,e)=>{var i,s;const n={x:((i=N.element)==null?void 0:i.x)??0,y:((s=N.element)==null?void 0:s.y)??0},[r]=ne(e,0,[q.KIND]);return fc(N.book,N.board),fo(N.book,N.board,N.element),hc(N.book,N.element,N.timestamp)&&_f(N.book,N.board,r,n),t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=ne(e,0,[q.NUMBER]);return k(N.element)&&(N.element.char=n),0}).command("color",(t,e)=>{const[n]=ne(e,0,[q.COLOR]);return k(N.element)&&k(n)&&gc(N.element,n),0}).command("go",(t,e)=>{if(k(N.element)){const[n]=ne(e,0,[q.DIR]);if(Py(t,N.book,N.board,N.element,n),t.yield(),N.element.x===n.x&&N.element.y===n.y)return 0}return 1}).command("try",(t,e)=>{const[,n]=ne(e,0,[q.DIR]);return t.command("go",...e)&&n<e.length&&t.command(...e.slice(n)),0}).command("walk",(t,e)=>{if(!k(N.element))return 0;const[n]=ne(e,0,[q.DIR]),r=N.element.x??0,i=N.element.y??0;return N.element.stepx=n.x-r,N.element.stepy=n.y-i,0}),xC=pr().command("clear",(t,e)=>(e.forEach(n=>t.set(Ot(n),0)),0)).command("set",(t,e)=>{const[n,r]=ne(e,0,[q.STRING,q.ANY]);return t.set(n,r),0}).command("take",(t,e)=>{const[n,r,i]=ne(e,0,[q.STRING,q.MAYBE_NUMBER]),s=t.get(n),o=r??1;if(!ke(s))return 1;const a=s-o;return a<0?(i<e.length&&t.command(...e.slice(i)),1):(t.set(n,a),0)}).command("give",(t,e)=>{const[n,r,i]=ne(e,0,[q.STRING,q.MAYBE_NUMBER]),s=t.get(n),o=ke(s)?s:0,a=r??1;if(!ke(a))return 0;const c=s===void 0?1:0;return c&&i<e.length&&t.command(...e.slice(i)),t.set(n,o+a),c}),RC=pr({get(){return[!1,void 0]},set(t,e,n){return wk(t,e,n),[!1,void 0]},tick(){var e;const t=((e=N.element)==null?void 0:e.name)??"scroll";Gl(N.player,"scroll",un.SCROLL,void 0,t)},everytick(){const t=vk(N.player);if(t&&k(N.element)){N.element.tickertext=t,N.element.tickertime=N.timestamp;const e=_y(N.book,N.element);Nt(`$${be[e.color]}$${e.char}`,t)}}}).command("send",(t,e)=>{var u,f;const[n,r]=ne(e,0,[q.STRING,q.ANY]),[i,s]=n.split(":"),o=k(s)?i:"self",a=s??i;function c(d){d.forEach(h=>{k(h.id)&&t.send(h.id,a,r)})}const l=Pe(o);switch(l){case"all":for(const d of Object.keys(((u=N.board)==null?void 0:u.objects)??{}))t.send(d,a,r);break;case"self":t.message({id:ht(),sender:t.id(),target:a,data:r});break;case"others":for(const d of Object.keys(((f=N.board)==null?void 0:f.objects)??{}))d!==t.id()&&t.send(d,a,r);break;default:{c(ql(N.board,[o]));const d=t.get(l);He(d)?c(ql(N.board,d)):c(ql(N.board,[d]));break}}return 0}).command("stat",(t,e)=>{const n=B0(e.map(Ot));switch(n.type){case fe.OBJECT:k(N.element)&&(N.element.name=n.values.join(" "));break}return 0}).command("text",(t,e)=>{const n=e.map(Ot).join("");return Ek(N.player,n),0}).command("hyperlink",(t,e)=>{const[n,r,...i]=e,s=Ot(n),o=Ot(r);return kk(N.player,t,s,o,i),0}).command("gadget",(t,e)=>{const[n]=ne(e,0,[q.STRING]),r=lk[Pe(n)];if(r===un.SCROLL){const[i,s]=ne(e,1,[q.MAYBE_STRING,q.MAYBE_NUMBER]);Gl(N.player,n,r,s,i)}else if(k(r)){const[i,s]=ne(e,1,[q.MAYBE_NUMBER,q.MAYBE_STRING]);Gl(N.player,n,r,i,s)}return 0}),IC=pr().command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=ne(e,0,[q.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Ot(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Ot(e[0])),0)).command("cycle",(t,e)=>{if(k(N.element)){const[n]=ne(e,0,[q.NUMBER]);N.element.cycle=ui(Math.round(n),1,255)}return 0}).command("die",t=>{var e;return(e=N.element)!=null&&e.headless&&fo(N.book,N.board,N.element),hc(N.book,N.element,N.timestamp),t.endofprogram(),0}).command("endgame",()=>(YE("element",N.player),0)).command("run",(t,e)=>{const[n]=ne(e,0,[q.STRING]);return Rc(n),0}).command("runwith",(t,e)=>{const[n,r]=ne(e,0,[q.ANY,q.STRING]);return t.set("arg",n),Rc(r),0});function $y(t,e){if(!k(t))return;const n=Pe(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const OC=(t,e)=>{const n=v_(t.id());if(!k(n))return 0;const[r]=ne(e,0,[q.STRING]),i=Pe(r);switch(i){case"seek":{const[s]=ne(e,1,[q.NUMBER]);n.cursor=s;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[s]=ne(e,1,[q.STRING]);t.set(s,$y(n,i));break}case"text":{const[s,o]=ne(e,1,[q.STRING,q.STRING]),a=$y(n,s);if(ke(a)&&Se(o)){const c=new Uint8Array(n.bytes.buffer,n.cursor,a),u=new TextDecoder("utf-8").decode(c);t.set(o,u),n.cursor+=a}break}}return 0},NC=pr({get(t,e){const n=v_(t.id());if(k(n))switch(Pe(e)){case"filename":return[k(n.filename),n.filename];case"cursor":return[k(n.cursor),n.cursor]}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=ne(e,0,[q.STRING,q.ANY]);return t.message({id:ht(),sender:t.id(),target:n,data:r}),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(Ot).join(" ");return Nt("$2",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Ot(n),s=r.map(Ot).join(" ");return Nt("$2",`!${s};${i}`),0}).command("load",(t,e)=>{const n=e.map(Ot).join(" "),r=t.get(n)??n;return Un(We.CONTENT,r),0}).command("reload",(t,e)=>{const n=e.map(Ot).join(" "),r=t.get(n)??n,i=Un(We.CONTENT,r);return i.pages=[],0}).command("bin",OC);var po=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.CODE_PAGE=3]="CODE_PAGE",t))(po||{});const CC={audio:dC,board:mC,cli:wC,const:EC,element:TC,flags:xC,gadget:RC,lifecycle:IC,loader:NC},Af=["const","flags","audio","board","lifecycle","element"],LC={0:[],1:["cli",...Af],2:["loader",...Af],3:["gadget",...Af]},MC={0:new Map,1:new Map,2:new Map,3:new Map};function mo(t){return(LC[t]??[]).map(n=>CC[n]).filter(k)}function UC(t,e){const n=MC[t];if(!n.has(e)){let r;const i=mo(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!k(r));++s);n.set(e,r)}return n.get(e)}function PC(t,e,n){const r=mo(t);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(e,n);if(s)return[s,o]}return[!1,void 0]}function DC(t,e,n,r){const i=mo(t);for(let s=0;s<i.length;++s){const[o]=i[s].set(e,n,r);if(o)return[o,r]}return[!1,void 0]}function BC(t,e){const n=mo(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function jy(t,e){const n=mo(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var zy={},Wy={},Gy={};const Hy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Gy.encode=function(t){if(0<=t&&t<Hy.length)return Hy[t];throw new TypeError("Must be between 0 and 63: "+t)};const FC=Gy,Vy=5,Ky=1<<Vy,$C=Ky-1,jC=Ky;function zC(t){return t<0?(-t<<1)+1:(t<<1)+0}Wy.encode=function(e){let n="",r,i=zC(e);do r=i&$C,i>>>=Vy,i>0&&(r|=jC),n+=FC.encode(r);while(i>0);return n};var go={};(function(t){function e(I,T,M){if(T in I)return I[T];if(arguments.length===3)return M;throw new Error('"'+T+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(I){const T=I.match(n);return T?{scheme:T[1],auth:T[2],host:T[3],port:T[4],path:T[5]}:null}t.urlParse=i;function s(I){let T="";return I.scheme&&(T+=I.scheme+":"),T+="//",I.auth&&(T+=I.auth+"@"),I.host&&(T+=I.host),I.port&&(T+=":"+I.port),I.path&&(T+=I.path),T}t.urlGenerate=s;const o=32;function a(I){const T=[];return function(M){for(let V=0;V<T.length;V++)if(T[V].input===M){const oe=T[0];return T[0]=T[V],T[V]=oe,T[0].result}const x=I(M);return T.unshift({input:M,result:x}),T.length>o&&T.pop(),x}}const c=a(function(T){let M=T;const x=i(T);if(x){if(!x.path)return T;M=x.path}const V=t.isAbsolute(M),oe=[];let O=0,E=0;for(;;)if(O=E,E=M.indexOf("/",O),E===-1){oe.push(M.slice(O));break}else for(oe.push(M.slice(O,E));E<M.length&&M[E]==="/";)E++;let g=0;for(E=oe.length-1;E>=0;E--){const C=oe[E];C==="."?oe.splice(E,1):C===".."?g++:g>0&&(C===""?(oe.splice(E+1,g),g=0):(oe.splice(E,2),g--))}return M=oe.join("/"),M===""&&(M=V?"/":"."),x?(x.path=M,s(x)):M});t.normalize=c;function l(I,T){I===""&&(I="."),T===""&&(T=".");const M=i(T),x=i(I);if(x&&(I=x.path||"/"),M&&!M.scheme)return x&&(M.scheme=x.scheme),s(M);if(M||T.match(r))return T;if(x&&!x.host&&!x.path)return x.host=T,s(x);const V=T.charAt(0)==="/"?T:c(I.replace(/\/+$/,"")+"/"+T);return x?(x.path=V,s(x)):V}t.join=l,t.isAbsolute=function(I){return I.charAt(0)==="/"||n.test(I)};function u(I,T){I===""&&(I="."),I=I.replace(/\/$/,"");let M=0;for(;T.indexOf(I+"/")!==0;){const x=I.lastIndexOf("/");if(x<0||(I=I.slice(0,x),I.match(/^([^\/]+:\/)?\/*$/)))return T;++M}return Array(M+1).join("../")+T.substr(I.length+1)}t.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(I){return I}function h(I){return m(I)?"$"+I:I}t.toSetString=f?d:h;function p(I){return m(I)?I.slice(1):I}t.fromSetString=f?d:p;function m(I){if(!I)return!1;const T=I.length;if(T<9||I.charCodeAt(T-1)!==95||I.charCodeAt(T-2)!==95||I.charCodeAt(T-3)!==111||I.charCodeAt(T-4)!==116||I.charCodeAt(T-5)!==111||I.charCodeAt(T-6)!==114||I.charCodeAt(T-7)!==112||I.charCodeAt(T-8)!==95||I.charCodeAt(T-9)!==95)return!1;for(let M=T-10;M>=0;M--)if(I.charCodeAt(M)!==36)return!1;return!0}function b(I,T,M){let x=w(I.source,T.source);return x!==0||(x=I.originalLine-T.originalLine,x!==0)||(x=I.originalColumn-T.originalColumn,x!==0||M)||(x=I.generatedColumn-T.generatedColumn,x!==0)||(x=I.generatedLine-T.generatedLine,x!==0)?x:w(I.name,T.name)}t.compareByOriginalPositions=b;function _(I,T,M){let x=I.generatedLine-T.generatedLine;return x!==0||(x=I.generatedColumn-T.generatedColumn,x!==0||M)||(x=w(I.source,T.source),x!==0)||(x=I.originalLine-T.originalLine,x!==0)||(x=I.originalColumn-T.originalColumn,x!==0)?x:w(I.name,T.name)}t.compareByGeneratedPositionsDeflated=_;function w(I,T){return I===T?0:I===null?1:T===null?-1:I>T?1:-1}function v(I,T){let M=I.generatedLine-T.generatedLine;return M!==0||(M=I.generatedColumn-T.generatedColumn,M!==0)||(M=w(I.source,T.source),M!==0)||(M=I.originalLine-T.originalLine,M!==0)||(M=I.originalColumn-T.originalColumn,M!==0)?M:w(I.name,T.name)}t.compareByGeneratedPositionsInflated=v;function S(I){return JSON.parse(I.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=S;function L(I,T,M){if(T=T||"",I&&(I[I.length-1]!=="/"&&T[0]!=="/"&&(I+="/"),T=I+T),M){const x=i(M);if(!x)throw new Error("sourceMapURL could not be parsed");if(x.path){const V=x.path.lastIndexOf("/");V>=0&&(x.path=x.path.substring(0,V+1))}T=l(s(x),T)}return c(T)}t.computeSourceURL=L})(go);var Tf={};let WC=class I_{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new I_;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};Tf.ArraySet=WC;var qy={};const Jy=go;function GC(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||Jy.compareByGeneratedPositionsInflated(t,e)<=0}let HC=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){GC(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(Jy.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};qy.MappingList=HC;const yo=Wy,pt=go,_c=Tf.ArraySet,VC=qy.MappingList;let Xy=class O_{constructor(e){e||(e={}),this._file=pt.getArg(e,"file",null),this._sourceRoot=pt.getArg(e,"sourceRoot",null),this._skipValidation=pt.getArg(e,"skipValidation",!1),this._sources=new _c,this._names=new _c,this._mappings=new VC,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new O_({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=pt.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=pt.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=pt.getArg(e,"generated"),r=pt.getArg(e,"original",null);let i=pt.getArg(e,"source",null),s=pt.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=pt.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[pt.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[pt.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=pt.relative(s,i));const o=this._mappings.toArray().length>0?new _c:this._sources,a=new _c;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=pt.join(r,c.source)),s!=null&&(c.source=pt.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=pt.join(r,c)),s!=null&&(c=pt.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,p=d.length;h<p;h++){if(l=d[h],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!pt.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=yo.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=yo.encode(f-o),o=f,c+=yo.encode(l.originalLine-1-i),i=l.originalLine-1,c+=yo.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=yo.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=pt.relative(n,r));const i=pt.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};Xy.prototype._version=3,zy.SourceMapGenerator=Xy;var Zy={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(Zy);var _o={exports:{}},KC={},qC=Object.freeze({__proto__:null,default:KC}),Yy=N_(qC);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;_o.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},_o.exports.initialize=e=>t=e}else{const t=Yy,e=Yy;_o.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},_o.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Qy=_o.exports;const JC=Qy;function XC(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let bo=null;var ZC=function(){if(bo)return bo;const e=[];return bo=JC().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new XC;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),e[e.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw bo=null,n}),bo};const he=go,xf=Zy,bc=Tf.ArraySet,YC=Qy,QC=ZC,Rf=Symbol("smcInternal");class ut{constructor(e,n){return e==Rf?Promise.resolve(this):tL(e,n)}static initialize(e){YC.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return nL(e,n)}static async with(e,n,r){const i=await new ut(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ut.prototype._version=3,ut.GENERATED_ORDER=1,ut.ORIGINAL_ORDER=2,ut.GREATEST_LOWER_BOUND=1,ut.LEAST_UPPER_BOUND=2;class wo extends ut{constructor(e,n){return super(Rf).then(r=>{let i=e;typeof e=="string"&&(i=he.parseSourceMapInput(e));const s=he.getArg(i,"version");let o=he.getArg(i,"sources");const a=he.getArg(i,"names",[]);let c=he.getArg(i,"sourceRoot",null);const l=he.getArg(i,"sourcesContent",null),u=he.getArg(i,"mappings"),f=he.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=he.normalize(c)),o=o.map(String).map(he.normalize).map(function(d){return c&&he.isAbsolute(c)&&he.isAbsolute(d)?he.relative(c,d):d}),r._names=bc.fromArray(a.map(String),!0),r._sources=bc.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return he.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,QC().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=he.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new wo(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||ut.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=he.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case ut.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ut.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=he.getArg(e,"source");const r=he.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:he.getArg(e,"line"),generatedColumn:he.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=he.getArg(e,"bias",ut.GREATEST_LOWER_BOUND);r==null&&(r=ut.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=he.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=he.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=he.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:he.getArg(i,"originalLine",null),column:he.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=he.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=he.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=he.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:he.getArg(e,"line"),originalColumn:he.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=he.getArg(e,"bias",ut.GREATEST_LOWER_BOUND);i==null&&(i=ut.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:he.getArg(s,"generatedLine",null),column:he.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}wo.prototype.consumer=ut;class eL extends ut{constructor(e,n){return super(Rf).then(r=>{let i=e;typeof e=="string"&&(i=he.parseSourceMapInput(e));const s=he.getArg(i,"version"),o=he.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new bc,r._names=new bc,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=he.getArg(c,"offset"),u=he.getArg(l,"line"),f=he.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ut(he.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(he.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(he.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:he.getArg(e,"line"),generatedColumn:he.getArg(e,"column")},r=xf.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(he.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=he.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||ut.GENERATED_ORDER;let o;switch(s){case ut.GENERATED_ORDER:o=this._generatedMappings;break;case ut.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=he.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return xf.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=he.getArg(e,"line"),r={source:he.getArg(e,"source"),originalLine:n,originalColumn:he.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",he.compareByOriginalPositions,xf.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:he.getArg(o,"generatedLine",null),column:he.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:he.getArg(o,"generatedLine",null),column:he.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function tL(t,e){let n=t;typeof t=="string"&&(n=he.parseSourceMapInput(t));const r=n.sections!=null?new eL(n,e):new wo(n,e);return Promise.resolve(r)}function nL(t,e){return wo.fromSourceMap(t,e)}var e_={};const rL=zy.SourceMapGenerator,wc=go,iL=/(\r?\n)/,sL=10,ss="$$$isSourceNode$$$";let oL=class Gf{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[ss]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new Gf,s=e.split(iL);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const p=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=wc.join(r,h)),i.setSourceContent(h,p))}),i;function d(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?wc.join(r,h.source):h.source;i.add(new Gf(h.originalLine,h.originalColumn,m,p,h.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[ss]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[ss]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[ss]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[ss]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[wc.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][ss]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(wc.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new rL(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===sL?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};e_.SourceNode=oL;var aL=e_.SourceNode;const cL=Vl(32,126).map(t=>String.fromCharCode(t)),lL=on({name:"Whitespace",pattern:/ +/}),uL=on({name:"WhitespaceSkipped",pattern:/ +/,group:Et.SKIPPED}),If=on({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),t_=on({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:cL}),Of=on({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Nf=on({name:"EscapedDollar",pattern:"$$"}),Cf=on({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Lf=on({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),n_=on({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function fL(t,e=""){return on({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const r_=Object.keys(pc).map(t=>fL(`\\$(${t})`,t)),hL=[lL,If,...r_,Of,t_,Lf,Nf,n_,Cf],dL=new Et(hL,{skipValidations:!Hn,ensureOptimizations:Hn}),pL=new Et([uL,If,...r_,Of,t_,Lf,Nf,n_,Cf],{skipValidations:!Hn,ensureOptimizations:Hn});function Mf(t,e=!1){return e?pL.tokenize(t):dL.tokenize(t)}function i_(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function s_(t){t.active={...t.reset}}function o_(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Nf:s("$");break;case Lf:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case Of:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case If:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=pc[l],f=YN(be[u]),d=QN(be[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):k(f)?e.active.color=f:k(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(k(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){s_(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;_L(u,u+l.length,e.active.color,e.active.bg,e),yL(u,l,e)}}}function mL(t,e,n){const r=Mf(t);r.tokens&&(o_(r.tokens,e),s_(e))}function gL(t,e,n){const r=Mf(t);if(!r.tokens)return;const i=i_(e,n,be.WHITE,be.BLACK);return i.measureonly=!0,o_(r.tokens,i),i.x>0&&++i.y,i}function yL(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++)}function _L(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r}let a_=0;const c_=Hn,bL=["Command","lines"];class wL extends KO{constructor(){super(P0,{traceInitPerf:Hn,skipValidations:!Hn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});ye(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));ye(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(no)}])}));ye(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));ye(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));ye(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));ye(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(l0)}));ye(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Gu)}));ye(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(a0)}])}));ye(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(c0)}));ye(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(u0),this.SUBRULE(this.words),this.CONSUME(f0)}));ye(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Yi),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));ye(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));ye(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));ye(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_debugger)},{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));ye(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Xu),this.SUBRULE(this.words)}));ye(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(S0),this.SUBRULE(this.words)}));ye(this,"command_debugger",this.RULED("command_debugger",()=>{this.CONSUME(R0)}));ye(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Zu),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));ye(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(tc),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(no)),this.CONSUME4(Yi),this.CONSUME4(Yu)}}])}));ye(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(tc),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Yi),this.CONSUME(Yu)}}])}));ye(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(tc),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));ye(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Yi),this.CONSUME(Qu),this.CONSUME(Zu),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));ye(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Yi),this.CONSUME(Qu),this.OPTION(()=>this.SUBRULE(this.command_fork))}));ye(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(I0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(O0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(N0),this.SUBRULE(this.words)}));ye(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(C0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(L0)}));ye(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(M0)}));ye(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(x0)}));ye(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Hu),this.SUBRULE2(this.and_test)})}));ye(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Ku),this.SUBRULE2(this.not_test)})}));ye(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Vu),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));ye(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));ye(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(p0)},{ALT:()=>this.CONSUME(m0)},{ALT:()=>this.CONSUME(g0)},{ALT:()=>this.CONSUME(y0)},{ALT:()=>this.CONSUME(_0)},{ALT:()=>this.CONSUME(b0)}])}));ye(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Hu),this.SUBRULE2(this.and_test_value)})}));ye(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Ku),this.SUBRULE2(this.not_test_value)})}));ye(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Vu),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));ye(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));ye(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(qu)},{ALT:()=>this.CONSUME(Ju)}]),this.SUBRULE(this.term)}));ye(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));ye(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(v0)},{ALT:()=>this.CONSUME(Xu)},{ALT:()=>this.CONSUME(E0)},{ALT:()=>this.CONSUME(k0)}]),this.SUBRULE(this.factor)}));ye(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(qu)},{ALT:()=>this.CONSUME(Ju)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));ye(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(w0),this.SUBRULE(this.factor)})}));ye(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));ye(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(h0)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(d0)},{ALT:()=>{this.CONSUME(A0),this.SUBRULE(this.expr),this.CONSUME(T0)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=bL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(a_++).toString().padStart(3),c=s?"font-weight: bold;":"";if(c_&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),c_&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),a_--},i)}}const os=new wL;if(xk){const t=os.getGAstProductions(),e=sN(t);console.info(e)}const vL=os.getBaseCstVisitorConstructor();var se=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(se||{}),ki=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(ki||{}),rr=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(rr||{}),vc=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(vc||{});function EL(t){return!!(t!=null&&t.tokenType)}function Tr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class kL extends vL{constructor(){super();ye(this,"unique",0);Hn&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&EL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Tr(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Tr(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:Tr(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Tr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:Tr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,"if","",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=ht(),i=ht();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=ht(),i=ht();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,"if",r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=ht(),i=ht();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=ht(),i=ht(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=ht(),i=ht(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){return this.createcodenode(n,{type:22,words:this.go(n.words)})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=Tr(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=Tr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=Tr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(Tr(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const SL=new kL,en={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Ec="zss.js";function Le(t,e){return new aL(t.startLine??1,t.startColumn??1,Ec,e)}function Uf(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Pf(t){return`'${Uf(t)}'`}function kc(t){if(t.startsWith('"'))return kc(t.replaceAll(/(^"|"$)/g,""));const e=Mf(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===Cf?`', api.get('${Uf(r.image.substring(1))}'), '`:Uf(r.image)).join("")}'].join('')`}function Si(t){return t.filter(e=>e!==void 0).map(Be)}function l_(t){return Le(t,"")}function AL(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function mt(t,e,n){return Le(t,[`api.${e}(`,...AL(n,", "),")"])}function TL(t){if(t.type===se.COMPARE&&t.compare.type===se.COMPARE_ITEM)switch(t.compare.method){case ki.IS_EQ:return mt(t,"isEq",[Be(t.lhs),Be(t.rhs)]);case ki.IS_NOT_EQ:return mt(t,"isNotEq",[Be(t.lhs),Be(t.rhs)]);case ki.IS_LESS_THAN:return mt(t,"isLessThan",[Be(t.lhs),Be(t.rhs)]);case ki.IS_GREATER_THAN:return mt(t,"isGreaterThan",[Be(t.lhs),Be(t.rhs)]);case ki.IS_LESS_THAN_OR_EQ:return mt(t,"isLessThanOrEq",[Be(t.lhs),Be(t.rhs)]);case ki.IS_GREATER_THAN_OR_EQ:return mt(t,"isGreaterThanOrEq",[Be(t.lhs),Be(t.rhs)])}return Le(t,"")}function Ai(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",Be(n),")"])}function u_(t,e,n){return t.prepend(`api.${e}(`),t.add([Be(n),")"])}function xL(t,e){if(t.type===se.OPERATOR_ITEM)switch(t.operator){case rr.PLUS:return Ai(e,"opPlus",t.rhs);case rr.MINUS:return Ai(e,"opMinus",t.rhs);case rr.POWER:return Ai(e,"opPower",t.rhs);case rr.MULTIPLY:return Ai(e,"opMultiply",t.rhs);case rr.DIVIDE:return Ai(e,"opDivide",t.rhs);case rr.MOD_DIVIDE:return Ai(e,"opModDivide",t.rhs);case rr.FLOOR_DIVIDE:return Ai(e,"opFloorDivide",t.rhs);case rr.UNI_PLUS:return u_(e,"opUniPlus",t.rhs);case rr.UNI_MINUS:return u_(e,"opUniMinus",t.rhs)}return Le(t,"")}function RL(t){if(t.type===se.OPERATOR){const e=t.lhs?Be(t.lhs):Le(t,"");return t.items.forEach(n=>xL(n,e)),e}return Le(t,"")}function Sc(t,e){return Le(t,[mt(t,"jump",[`${e}`]),"; continue;"])}function xr(t){return en.linelookup[t??""]??-1}function Df(t,e){en.linelookup[t]=e}function vo(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case se.WHILE:case se.REPEAT:case se.FOREACH:case se.ELSE_IF:i.type===e&&(i.done=n);break;case se.IF_BLOCK:case se.IF_CHECK:i.type===e&&(i.skip=n);break;case se.LINE:vo(i.stmts,e,n);break}}}function f_(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case se.WHILE:case se.REPEAT:case se.FOREACH:case se.ELSE_IF:i.type===e&&Df(i.done,n);break;case se.IF_BLOCK:case se.IF_CHECK:i.type===e&&Df(i.skip,n);break;case se.LINE:f_(i.stmts,e,n);break}}}function Be(t){var e;switch(t.type){case se.PROGRAM:return Le(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(Be).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Ec}`]);case se.API:return Le(t,["  ",mt(t,t.method,Si(t.words)),`;
`]);case se.LINE:return Le(t,[`case ${t.lineindex}:
`,...t.stmts.map(Be).flat(),`  break;
`]);case se.MARK:return Le(t,`  // ${t.comment}
`);case se.GOTO:{const n=xr(t.id);return Le(t,["  ",Sc(t,n),`
`])}case se.COUNT:return Le(t,`${t.index}`);case se.LITERAL:switch(t.literal){case vc.NUMBER:return Le(t,`${t.value}`);case vc.STRING:return Le(t,Pf(t.value));case vc.TEMPLATE:return Le(t,kc(t.value))}return l_(t);case se.TEXT:return Le(t,["  ",mt(t,"text",[kc(t.value)]),`;
`]);case se.STAT:if(en.isfirststat){en.isfirststat=!1;const n=t.value.trim().split(" ").map(Pf);return Le(t,["  ",mt(t,"stat",n),`;
`])}return Le(t,`  // skipped ${t.value}
`);case se.LABEL:{const n=Pe(t.name),r=t.active?"label":"comment";en.labels[n]||(en.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return en.labels[n].push(i),Le(t,`  // ${i} '${n}' ${r}
`)}case se.HYPERLINK:return Le(t,["  ",mt(t,"hyperlink",[kc(t.text),...Si(t.link)]),`;
`]);case se.MOVE:{const n=mt(t,"command",[Pf("go"),Si(t.words)].flat());return t.wait?Le(t,["  if (",n,`) { continue; };
`]):Le(t,["  ",n,`;
`])}case se.COMMAND:return Le(t,["  ",mt(t,"command",Si(t.words)),`;
`]);case se.IF:{const n=((e=t.block)==null?void 0:e.type)===se.IF_BLOCK?t.block:void 0;if(k(n)){vo([t.check],se.IF_CHECK,n.skip);const r=Le(t,Be(t.check));return n.lines.forEach(i=>r.add(Be(i))),f_(n.altlines,se.ELSE_IF,xr(n.done)),n.altlines.forEach(i=>r.add(Be(i))),r}return Le(t,Be(t.check))}case se.IF_CHECK:{const n=xr(t.skip);return n===-1?Le(t,["  ",mt(t,t.method,Si(t.words)),`;
`]):Le(t,["  if (!",mt(t,t.method,Si(t.words)),") { ",Sc(t,n),` }
`])}case se.ELSE_IF:case se.ELSE:{const n=Le(t,"");return t.lines.forEach(r=>n.add(Be(r))),n}case se.WHILE:{const n=xr(t.loop),r=xr(t.done),i=Le(t,"");return vo(t.lines,se.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case se.BREAK:s.goto=r;break;case se.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case se.REPEAT:{const n=xr(t.loop),r=xr(t.done),i=Le(t,"");return vo(t.lines,se.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case se.BREAK:s.goto=r;break;case se.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case se.WAITFOR:{const n=Le(t,"");return n.add(["  if (!",mt(t,"if",Si(t.words)),`) { api.i(${t.lineindex-1}); }
`]),n}case se.FOREACH:{const n=xr(t.loop),r=xr(t.done),i=Le(t,"");return vo(t.lines,se.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case se.BREAK:s.goto=r;break;case se.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case se.BREAK:return Le(t,["  ",Sc(t,t.goto),`
`]);case se.CONTINUE:return Le(t,["  ",Sc(t,t.goto),`
`]);case se.OR:return mt(t,"or",t.items.map(Be));case se.AND:return mt(t,"and",t.items.map(Be));case se.NOT:return mt(t,"not",t.items.map(Be));case se.COMPARE:return TL(t);case se.OPERATOR:return RL(t);case se.EXPR:return mt(t,"expr",t.words.map(Be));default:return console.error("<unsupported node>",t.type,t),l_(t)}}function ir(t){if(k(t))switch(t.type===se.LINE&&++en.lineindex,t.lineindex=en.lineindex,t.type){case se.PROGRAM:t.lines.forEach(ir);break;case se.LINE:t.stmts.forEach(ir);break;case se.MARK:Df(t.id,t.lineindex);break;case se.IF:ir(t.check),ir(t.block);break;case se.IF_BLOCK:t.lines.forEach(ir),t.altlines.forEach(ir);break;case se.ELSE_IF:t.lines.forEach(ir);break;case se.ELSE:case se.WHILE:case se.REPEAT:case se.FOREACH:t.lines.forEach(ir);break;case se.MOVE:case se.COMMAND:case se.WAITFOR:case se.IF_CHECK:t.words.forEach(ir);break}}function IL(t){return en.labels={},en.internal=1,en.lineindex=0,en.isfirststat=!0,ir(t),{...Be(t).toStringWithSourceMap({file:`${Ec}.map`}),...en}}function OL(t){return He(t)?t.length>0?1:0:t??0}function Ot(t){return`${t??""}`}function h_(t){return`${t}_chip`}function NL(t,e,n){var c,l;const r=h_(t),i=cs(r);let s;He(i.lb)||(i.lb=hs(Object.entries(n.labels??{})),i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((c=n.errors)==null?void 0:c.length)??0)!==0?1:0);function o(u,f){N.words=f;const d=UC(e,u);return k(d)?d(a,f):u!=="send"?o("send",[u,...f]):0}const a={halt(){HL(r)},id(){return t},senderid(u=t){return`vm:${u??t}`},set(u,f){const[d,h]=DC(e,a,u,f);if(d)return h},get(u){const[f,d]=PC(e,a,u);if(f)return d},bucket(u){const f=a.get("bucket");He(f)?f.push(u):a.set("bucket",[u])},tick(u){const f=ke(i.ps)?i.ps:0,d=f%u===0;if(i.ps=f+1,d===!1)return!1;if(a.shouldtick()===!1)return jy(e,a),!1;i.lc=0,i.ys=0,N.get=a.get,BC(e,a);try{const h=s==null?void 0:s.next();h!=null&&h.done&&(tt("chip","crash","generator logic unexpectedly exited"),i.es=1)}catch(h){tt("chip","crash",h.message),i.es=1}return jy(e,a),!0},isended(){return i.es===1},shouldtick(){return i.es===0||a.hm()!==0},shouldhalt(){return ke(i.lc)?++i.lc>zi.HALT_AT_COUNT:!0},hm(){if(He(i.mg)&&He(i.lb)){const[,u]=i.mg;if(k(u))for(let f=0;f<i.lb.length;++f){const[d,h]=i.lb[f];if(d===u)return h.find(p=>ke(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(u){i.ec=u},sy(){return!!i.ys||a.shouldhalt()},emit(u,f,d){Te.emit(u,a.senderid(),f,d)},send(u,f,d,h){Te.emit(`${a.senderid(u)}:${f}`,t,d,h)},lock(u){i.lk=u},unlock(){i.lk=""},message(u){i.lk&&u.sender!==i.lk||(i.mg=[u.id,u.target,u.data,u.sender,u.player])},zap(u){if(He(i.lb))for(let f=0;f<i.lb.length;++f){const[d,h]=i.lb[f];if(d===u){const p=h.findIndex(m=>m>0);p>=0&&(h[p]*=-1)}}},restore(u){if(He(i.lb))for(let f=0;f<i.lb.length;++f){const[d,h]=i.lb[f];if(d===u)for(let p=0;p<h.length;p++)h[f]=Math.abs(h[f])}},getcase(){i.ec=ke(i.ec)?i.ec:1;const u=a.hm();if(u&&He(i.mg)){const[,,f,d,h]=i.mg;a.set("sender",d),k(f)&&a.set("arg",f),h&&a.set("player",h),i.mg=void 0,i.ys=0,i.es=0,i.ec=u}return i.ec},nextcase(){const u=ke(i.ec)?i.ec:1;return i.ec=u+1,i.ec},endofprogram(){a.yield(),i.es=1},stacktrace(u){const f=Tk.parse(u),[d]=f.filter(h=>h.fileName===Ec);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(u){return o("text",[u])},stat(...u){return o("stat",u)},hyperlink(...u){return o("hyperlink",u)},command(...u){if(u.length===0)return 0;const[f,...d]=u;return o(Ot(f),d)},if(...u){const[f,d]=ne(u,0,[q.ANY]),h=OL(f);return h&&d<u.length&&a.command(...u.slice(d)),h?1:0},repeatstart(u,...f){const[d,h]=ne(f,0,[q.NUMBER]),p=`repeatcount${u}`,m=`repeatwords${u}`;i[p]=d,i[m]=h<f.length?f.slice(h):void 0},repeat(u){const f=`repeatcount${u}`,d=`repeatwords${u}`;if(!ke(i[f]))return 0;const h=i[f];i[f]=h-1;const p=h>0,m=i[d];return p&&He(m)&&a.command(...m),p?1:0},foreachstart(u,...f){const[d,h,p,m]=ne(f,0,[q.STRING,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let b=Math.min(h,p),_=Math.max(h,p);const w=(m??0)||1;if(w<0){const v=b;b=_,_=v}return a.set(d,b-w),0},foreach(u,...f){const[d,h,p,m,b]=ne(f,0,[q.STRING,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let _=Math.min(h,p),w=Math.max(h,p);const v=(m??0)||1;if(v<0){const I=_;_=w,w=I}let S=a.get(d);!ke(S)||S<_||S>w?S=_:S+=v;const L=S<=w?1:0;return L&&(a.set(d,S),b<f.length&&a.command(...f.slice(b))),L},or(...u){let f=0;for(let d=0;d<u.length;){const[h,p]=ne(u,d,[q.ANY]);if(f=h,f)break;d=p}return f},and(...u){let f=0;for(let d=0;d<u.length;){const[h,p]=ne(u,d,[q.ANY]);if(f=h,!f)break;d=p}return f},not(...u){const[f]=ne(u,0,[q.ANY]);return f?0:1},expr(...u){const[f]=ne(u,0,[q.ANY]);return f},isEq(u,f){const[d]=ne([u],0,[q.ANY]),[h]=ne([f],0,[q.ANY]);return typeof d=="object"||typeof h=="object"?db(d,h)?1:0:d===h?1:0},isNotEq(u,f){return this.isEq(u,f)?0:1},isLessThan(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return d<h?1:0},isGreaterThan(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return d>h?1:0},isLessThanOrEq(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return d<=h?1:0},isGreaterThanOrEq(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return d>=h?1:0},opPlus(u,f){const[d]=ne([u],0,[q.ANY]),[h]=ne([f],0,[q.ANY]);return d+h},opMinus(u,f){const[d]=ne([u],0,[q.ANY]),[h]=ne([f],0,[q.ANY]);return d-h},opPower(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return Math.pow(d,h)},opMultiply(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return d*h},opDivide(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return d/h},opModDivide(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return d%h},opFloorDivide(u,f){const[d]=ne([u],0,[q.NUMBER]),[h]=ne([f],0,[q.NUMBER]);return Math.floor(d/h)},opUniPlus(u){const[f]=ne([u],0,[q.NUMBER]);return+f},opUniMinus(u){const[f]=ne([u],0,[q.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,a),a}function Ac(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var d_={exports:{}};/*!

  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>

  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  */(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof Ac=="function"&&Ac;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Ac=="function"&&Ac,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,p,m,b=[],_=0,w=c.length,v=w,S=s.getTypeOf(c)!=="string";_<c.length;)v=w-_,f=S?(l=c[_++],u=_<w?c[_++]:0,_<w?c[_++]:0):(l=c.charCodeAt(_++),u=_<w?c.charCodeAt(_++):0,_<w?c.charCodeAt(_++):0),d=l>>2,h=(3&l)<<4|u>>4,p=1<v?(15&u)<<2|f>>6:64,m=2<v?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var l,u,f,d,h,p,m=0,b=0,_="data:";if(c.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var w,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(m++)))>>2,f=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),w[b++]=l,h!==64&&(w[b++]=u),p!==64&&(w[b++]=f);return w}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,p){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,p,m,b,_,w){var v,S,L=h.file,I=h.compression,T=w!==l.utf8encode,M=a.transformTo("string",w(L.name)),x=a.transformTo("string",l.utf8encode(L.name)),V=L.comment,oe=a.transformTo("string",w(V)),O=a.transformTo("string",l.utf8encode(V)),E=x.length!==L.name.length,g=O.length!==V.length,C="",W="",B="",Z=L.dir,H=L.date,Y={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(Y.crc32=h.crc32,Y.compressedSize=h.compressedSize,Y.uncompressedSize=h.uncompressedSize);var $=0;p&&($|=8),T||!E&&!g||($|=2048);var F=0,ue=0;Z&&(F|=16),_==="UNIX"?(ue=798,F|=function(ee,Ae){var je=ee;return ee||(je=Ae?16893:33204),(65535&je)<<16}(L.unixPermissions,Z)):(ue=20,F|=function(ee){return 63&(ee||0)}(L.dosPermissions)),v=H.getUTCHours(),v<<=6,v|=H.getUTCMinutes(),v<<=5,v|=H.getUTCSeconds()/2,S=H.getUTCFullYear()-1980,S<<=4,S|=H.getUTCMonth()+1,S<<=5,S|=H.getUTCDate(),E&&(W=s(1,1)+s(u(M),4)+x,C+="up"+s(W.length,2)+W),g&&(B=s(1,1)+s(u(oe),4)+O,C+="uc"+s(B.length,2)+B);var Q="";return Q+=`
\0`,Q+=s($,2),Q+=I.magic,Q+=s(v,2),Q+=s(S,2),Q+=s(Y.crc32,4),Q+=s(Y.compressedSize,4),Q+=s(Y.uncompressedSize,4),Q+=s(M.length,2),Q+=s(C.length,2),{fileRecord:f.LOCAL_FILE_HEADER+Q+M+C,dirRecord:f.CENTRAL_FILE_HEADER+s(ue,2)+Q+s(oe.length,2)+"\0\0\0\0"+s(F,4)+s(b,4)+M+C+oe}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,b=function(_,w,v,S,L){var I=a.transformTo("string",L(S));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(_,2)+s(_,2)+s(w,4)+s(v,4)+s(I.length,2)+I}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var p=function(w,v){var S=w||v,L=s[S];if(!L)throw new Error(S+" is not a valid compression method !");return L}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,_=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:_,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var b=new c(h);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],_=m.files;if(h.checkCRC32)for(var w=0;w<_.length;w++)b.push(f(_[w]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),_=b.files,w=0;w<_.length;w++){var v=_[w],S=v.fileNameStr,L=s.resolve(v.fileNameStr);p.file(L,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:h.createFolders}),v.dir||(p.file(L).unsafeOriginalName=S)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(L,I,T){var M,x=a.getTypeOf(I),V=a.extend(T||{},u);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(L=_(L)),V.createFolders&&(M=b(L))&&w.call(this,M,!0);var oe=x==="string"&&V.binary===!1&&V.base64===!1;T&&T.binary!==void 0||(V.binary=!oe),(I instanceof f&&I.uncompressedSize===0||V.dir||!I||I.length===0)&&(V.base64=!1,V.binary=!0,I="",V.compression="STORE",x="string");var O=null;O=I instanceof f||I instanceof c?I:p.isNode&&p.isStream(I)?new m(L,I):a.prepareContent(L,I,V.binary,V.optimizedBinaryString,V.base64);var E=new d(L,O,V);this.files[L]=E}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var I=L.lastIndexOf("/");return 0<I?L.substring(0,I):""},_=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},w=function(L,I){return I=I!==void 0?I:u.createFolders,L=_(L),this.files[L]||s.call(this,L,null,{dir:!0,createFolders:I}),this.files[L]};function v(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var I,T,M;for(I in this.files)M=this.files[I],(T=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&L(T,M)},filter:function(L){var I=[];return this.forEach(function(T,M){L(T,M)&&I.push(M)}),I},file:function(L,I,T){if(arguments.length!==1)return L=this.root+L,s.call(this,L,I,T),this;if(v(L)){var M=L;return this.filter(function(V,oe){return!oe.dir&&M.test(V)})}var x=this.files[this.root+L];return x&&!x.dir?x:null},folder:function(L){if(!L)return this;if(v(L))return this.filter(function(x,V){return V.dir&&L.test(x)});var I=this.root+L,T=w.call(this,I),M=this.clone();return M.root=T.name,M},remove:function(L){L=this.root+L;var I=this.files[L];if(I||(L.slice(-1)!=="/"&&(L+="/"),I=this.files[L]),I&&!I.dir)delete this.files[L];else for(var T=this.filter(function(x,V){return V.name.slice(0,L.length)===L}),M=0;M<T.length;M++)delete this.files[T[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var I,T={};try{if((T=a.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");a.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var M=T.comment||this.comment||"";I=h.generateWorker(this,T,M)}catch(x){(I=new c("error")).error(x)}return new l(I,T.type||"string",T.mimeType)},generateAsync:function(L,I){return this.generateInternalStream(L).accumulate(I)},generateNodeStream:function(L,I){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(I)}};r.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(b,_){var w=[],v=p._internalType,S=p._outputType,L=p._mimeType;p.on("data",function(I,T){w.push(I),m&&m(T)}).on("error",function(I){w=[],_(I)}).on("end",function(){try{var I=function(T,M,x){switch(T){case"blob":return s.newBlob(s.transformTo("arraybuffer",M),x);case"base64":return c.encode(M);default:return s.transformTo(T,M)}}(S,function(T,M){var x,V=0,oe=null,O=0;for(x=0;x<M.length;x++)O+=M[x].length;switch(T){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(oe=new Uint8Array(O),x=0;x<M.length;x++)oe.set(M[x],V),V+=M[x].length;return oe;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+T+"'")}}(v,w),L);b(I)}catch(T){_(T)}w=[]}).resume()})}function h(p,m,b){var _=m;switch(m){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=m,this._mimeType=b,s.checkSupport(_),this._worker=p.pipe(new o(_)),p.lock()}catch(w){this._worker=new a("error"),this._worker.error(w)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(_){m.call(b,_.data,_.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,b,_,w,v,S=p.length,L=0;for(w=0;w<S;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<S&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),L+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(L):new Array(L),w=v=0;v<L;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<S&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),b<128?m[v++]=b:(b<2048?m[v++]=192|b>>>6:(b<65536?m[v++]=224|b>>>12:(m[v++]=240|b>>>18,m[v++]=128|b>>>12&63),m[v++]=128|b>>>6&63),m[v++]=128|63&b);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,b,_,w,v=p.length,S=new Array(2*v);for(m=b=0;m<v;)if((_=p[m++])<128)S[b++]=_;else if(4<(w=l[_]))S[b++]=65533,m+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&m<v;)_=_<<6|63&p[m++],w--;1<w?S[b++]=65533:_<65536?S[b++]=_:(_-=65536,S[b++]=55296|_>>10&1023,S[b++]=56320|1023&_)}return S.length!==b&&(S.subarray?S=S.subarray(0,b):S.length=b),s.applyFromCharCode(S)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(w,v){var S;for((v=v||w.length)>w.length&&(v=w.length),S=v-1;0<=S&&(192&w[S])==128;)S--;return S<0||S===0?v:S+l[w[S]]>v?S:v}(p),_=p;b!==p.length&&(o.uint8array?(_=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(_=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(_),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,b){for(var _=0;_<m.length;++_)b[_]=255&m.charCodeAt(_);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(m),_.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,b,_){var w=[],v=0,S=m.length;if(S<=_)return String.fromCharCode.apply(null,m);for(;v<S;)b==="array"||b==="nodebuffer"?w.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+_,S)))):w.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+_,S)))),v+=_;return w.join("")},stringifyByChar:function(m){for(var b="",_=0;_<m.length;_++)b+=String.fromCharCode(m[_]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,_=i.getTypeOf(m),w=!0;if(_==="uint8array"?w=f.applyCanBeUsed.uint8array:_==="nodebuffer"&&(w=f.applyCanBeUsed.nodebuffer),w)for(;1<b;)try{return f.stringifyByChunk(m,_,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(m)}function h(m,b){for(var _=0;_<m.length;_++)b[_]=m[_];return b}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var _=i.getTypeOf(b);return p[_][m](b)},i.resolve=function(m){for(var b=m.split("/"),_=[],w=0;w<b.length;w++){var v=b[w];v==="."||v===""&&w!==0&&w!==b.length-1||(v===".."?_.pop():_.push(v))}return _.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,_,w="";for(_=0;_<(m||"").length;_++)w+="\\x"+((b=m.charCodeAt(_))<16?"0":"")+b.toString(16).toUpperCase();return w},i.delay=function(m,b,_){setImmediate(function(){m.apply(_||null,b||[])})},i.inherits=function(m,b){function _(){}_.prototype=b.prototype,m.prototype=new _},i.extend=function(){var m,b,_={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&_[b]===void 0&&(_[b]=arguments[m][b]);return _},i.prepareContent=function(m,b,_,w,v){return c.Promise.resolve(b).then(function(S){return s.blob&&(S instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(S))!==-1)&&typeof FileReader<"u"?new c.Promise(function(L,I){var T=new FileReader;T.onload=function(M){L(M.target.result)},T.onerror=function(M){I(M.target.error)},T.readAsArrayBuffer(S)}):S}).then(function(S){var L=i.getTypeOf(S);return L?(L==="arraybuffer"?S=i.transformTo("uint8array",S):L==="string"&&(v?S=o.decode(S):_&&w!==!0&&(S=function(I){return u(I,s.uint8array?new Uint8Array(I.length):new Array(I.length))}(S))),S):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var _ in u)if(Object.prototype.hasOwnProperty.call(u,_)&&u[_].magic===b)return u[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,b,_=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<_;)p=h.readInt(2),m=h.readInt(2),b=h.readData(m),this.extraFields[p]={id:p,length:m,value:b};h.setIndex(_)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var _=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var _=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var w=!this._dataBinary;w&&!_&&(m=m.pipe(new c.Utf8EncodeWorker)),!w&&_&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(v){(m=new u("error")).error(v)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,b;a=!0;for(var _=h.length;_;){for(b=h,h=[],m=-1;++m<_;)b[m]();_=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Pt<"u"?Pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,_!==o&&m(this,_)}function d(_,w,v){this.promise=_,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function h(_,w,v){s(function(){var S;try{S=w(v)}catch(L){return a.reject(_,L)}S===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,S)})}function p(_){var w=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof w=="function")return function(){w.apply(_,arguments)}}function m(_,w){var v=!1;function S(T){v||(v=!0,a.reject(_,T))}function L(T){v||(v=!0,a.resolve(_,T))}var I=b(function(){w(L,S)});I.status==="error"&&S(I.value)}function b(_,w){var v={};try{v.value=_(w),v.status="success"}catch(S){v.status="error",v.value=S}return v}(r.exports=f).prototype.finally=function(_){if(typeof _!="function")return this;var w=this.constructor;return this.then(function(v){return w.resolve(_()).then(function(){return v})},function(v){return w.resolve(_()).then(function(){throw v})})},f.prototype.catch=function(_){return this.then(null,_)},f.prototype.then=function(_,w){if(typeof _!="function"&&this.state===l||typeof w!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==u?h(v,this.state===l?_:w,this.outcome):this.queue.push(new d(v,_,w)),v},d.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},d.prototype.otherCallFulfilled=function(_){h(this.promise,this.onFulfilled,_)},d.prototype.callRejected=function(_){a.reject(this.promise,_)},d.prototype.otherCallRejected=function(_){h(this.promise,this.onRejected,_)},a.resolve=function(_,w){var v=b(p,w);if(v.status==="error")return a.reject(_,v.value);var S=v.value;if(S)m(_,S);else{_.state=l,_.outcome=w;for(var L=-1,I=_.queue.length;++L<I;)_.queue[L].callFulfilled(w)}return _},a.reject=function(_,w){_.state=c,_.outcome=w;for(var v=-1,S=_.queue.length;++v<S;)_.queue[v].callRejected(w);return _},f.resolve=function(_){return _ instanceof this?_:a.resolve(new this(o),_)},f.reject=function(_){var w=new this(o);return a.reject(w,_)},f.all=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=_.length,S=!1;if(!v)return this.resolve([]);for(var L=new Array(v),I=0,T=-1,M=new this(o);++T<v;)x(_[T],T);return M;function x(V,oe){w.resolve(V).then(function(O){L[oe]=O,++I!==v||S||(S=!0,a.resolve(M,L))},function(O){S||(S=!0,a.reject(M,O))})}},f.race=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=_.length,S=!1;if(!v)return this.resolve([]);for(var L=-1,I=new this(o);++L<v;)T=_[L],w.resolve(T).then(function(M){S||(S=!0,a.resolve(I,M))},function(M){S||(S=!0,a.reject(I,M))});var T;return I}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(_){if(!(this instanceof m))return new m(_);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},_||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(v!==f)throw new Error(c[v]);if(w.header&&s.deflateSetHeader(this.strm,w.header),w.dictionary){var S;if(S=typeof w.dictionary=="string"?a.string2buf(w.dictionary):u.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(v=s.deflateSetDictionary(this.strm,S))!==f)throw new Error(c[v]);this._dict_set=!0}}function b(_,w){var v=new m(w);if(v.push(_,!0),v.err)throw v.msg||c[v.err];return v.result}m.prototype.push=function(_,w){var v,S,L=this.strm,I=this.options.chunkSize;if(this.ended)return!1;S=w===~~w?w:w===!0?4:0,typeof _=="string"?L.input=a.string2buf(_):u.call(_)==="[object ArrayBuffer]"?L.input=new Uint8Array(_):L.input=_,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new o.Buf8(I),L.next_out=0,L.avail_out=I),(v=s.deflate(L,S))!==1&&v!==f)return this.onEnd(v),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(L.output,L.next_out))):this.onData(o.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&v!==1);return S===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===f):S!==2||(this.onEnd(f),!(L.avail_out=0))},m.prototype.onData=function(_){this.chunks.push(_)},m.prototype.onEnd=function(_){_===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(_,w){return(w=w||{}).raw=!0,b(_,w)},i.gzip=function(_,w){return(w=w||{}).gzip=!0,b(_,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var _=s.inflateInit2(this.strm,b.windowBits);if(_!==c.Z_OK)throw new Error(l[_]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var _=new h(b);if(_.push(m,!0),_.err)throw _.msg||l[_.err];return _.result}h.prototype.push=function(m,b){var _,w,v,S,L,I,T=this.strm,M=this.options.chunkSize,x=this.options.dictionary,V=!1;if(this.ended)return!1;w=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?T.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?T.input=new Uint8Array(m):T.input=m,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new o.Buf8(M),T.next_out=0,T.avail_out=M),(_=s.inflate(T,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&x&&(I=typeof x=="string"?a.string2buf(x):d.call(x)==="[object ArrayBuffer]"?new Uint8Array(x):x,_=s.inflateSetDictionary(this.strm,I)),_===c.Z_BUF_ERROR&&V===!0&&(_=c.Z_OK,V=!1),_!==c.Z_STREAM_END&&_!==c.Z_OK)return this.onEnd(_),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&_!==c.Z_STREAM_END&&(T.avail_in!==0||w!==c.Z_FINISH&&w!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(T.output,T.next_out),S=T.next_out-v,L=a.buf2string(T.output,v),T.next_out=S,T.avail_out=M-S,S&&o.arraySet(T.output,T.output,v,S,0),this.onData(L)):this.onData(o.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(V=!0)}while((0<T.avail_in||T.avail_out===0)&&_!==c.Z_STREAM_END);return _===c.Z_STREAM_END&&(w=c.Z_FINISH),w===c.Z_FINISH?(_=s.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===c.Z_OK):w!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(T.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,p;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(p=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],p.set(h,d),d+=h.length;return p}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,p,m,b,_=f.length,w=0;for(m=0;m<_;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),w+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(w),m=b=0;b<w;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,p,m,b,_=d||f.length,w=new Array(2*_);for(h=p=0;h<_;)if((m=f[h++])<128)w[p++]=m;else if(4<(b=c[m]))w[p++]=65533,h+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&h<_;)m=m<<6|63&f[h++],b--;1<b?w[p++]=65533:m<65536?w[p++]=m:(m-=65536,w[p++]=55296|m>>10&1023,w[p++]=56320|1023&m)}return u(w,p)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,p=-2,m=-1,b=4,_=2,w=8,v=9,S=286,L=30,I=19,T=2*S+1,M=15,x=3,V=258,oe=V+x+1,O=42,E=113,g=1,C=2,W=3,B=4;function Z(y,K){return y.msg=u[K],K}function H(y){return(y<<1)-(4<y?9:0)}function Y(y){for(var K=y.length;0<=--K;)y[K]=0}function $(y){var K=y.state,G=K.pending;G>y.avail_out&&(G=y.avail_out),G!==0&&(o.arraySet(y.output,K.pending_buf,K.pending_out,G,y.next_out),y.next_out+=G,K.pending_out+=G,y.total_out+=G,y.avail_out-=G,K.pending-=G,K.pending===0&&(K.pending_out=0))}function F(y,K){a._tr_flush_block(y,0<=y.block_start?y.block_start:-1,y.strstart-y.block_start,K),y.block_start=y.strstart,$(y.strm)}function ue(y,K){y.pending_buf[y.pending++]=K}function Q(y,K){y.pending_buf[y.pending++]=K>>>8&255,y.pending_buf[y.pending++]=255&K}function ee(y,K){var G,R,A=y.max_chain_length,D=y.strstart,J=y.prev_length,X=y.nice_match,z=y.strstart>y.w_size-oe?y.strstart-(y.w_size-oe):0,te=y.window,le=y.w_mask,re=y.prev,de=y.strstart+V,Ze=te[D+J-1],Ue=te[D+J];y.prev_length>=y.good_match&&(A>>=2),X>y.lookahead&&(X=y.lookahead);do if(te[(G=K)+J]===Ue&&te[G+J-1]===Ze&&te[G]===te[D]&&te[++G]===te[D+1]){D+=2,G++;do;while(te[++D]===te[++G]&&te[++D]===te[++G]&&te[++D]===te[++G]&&te[++D]===te[++G]&&te[++D]===te[++G]&&te[++D]===te[++G]&&te[++D]===te[++G]&&te[++D]===te[++G]&&D<de);if(R=V-(de-D),D=de-V,J<R){if(y.match_start=K,X<=(J=R))break;Ze=te[D+J-1],Ue=te[D+J]}}while((K=re[K&le])>z&&--A!=0);return J<=y.lookahead?J:y.lookahead}function Ae(y){var K,G,R,A,D,J,X,z,te,le,re=y.w_size;do{if(A=y.window_size-y.lookahead-y.strstart,y.strstart>=re+(re-oe)){for(o.arraySet(y.window,y.window,re,re,0),y.match_start-=re,y.strstart-=re,y.block_start-=re,K=G=y.hash_size;R=y.head[--K],y.head[K]=re<=R?R-re:0,--G;);for(K=G=re;R=y.prev[--K],y.prev[K]=re<=R?R-re:0,--G;);A+=re}if(y.strm.avail_in===0)break;if(J=y.strm,X=y.window,z=y.strstart+y.lookahead,te=A,le=void 0,le=J.avail_in,te<le&&(le=te),G=le===0?0:(J.avail_in-=le,o.arraySet(X,J.input,J.next_in,le,z),J.state.wrap===1?J.adler=c(J.adler,X,le,z):J.state.wrap===2&&(J.adler=l(J.adler,X,le,z)),J.next_in+=le,J.total_in+=le,le),y.lookahead+=G,y.lookahead+y.insert>=x)for(D=y.strstart-y.insert,y.ins_h=y.window[D],y.ins_h=(y.ins_h<<y.hash_shift^y.window[D+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[D+x-1])&y.hash_mask,y.prev[D&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=D,D++,y.insert--,!(y.lookahead+y.insert<x)););}while(y.lookahead<oe&&y.strm.avail_in!==0)}function je(y,K){for(var G,R;;){if(y.lookahead<oe){if(Ae(y),y.lookahead<oe&&K===f)return g;if(y.lookahead===0)break}if(G=0,y.lookahead>=x&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+x-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),G!==0&&y.strstart-G<=y.w_size-oe&&(y.match_length=ee(y,G)),y.match_length>=x)if(R=a._tr_tally(y,y.strstart-y.match_start,y.match_length-x),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=x){for(y.match_length--;y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+x-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart,--y.match_length!=0;);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else R=a._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(R&&(F(y,!1),y.strm.avail_out===0))return g}return y.insert=y.strstart<x-1?y.strstart:x-1,K===d?(F(y,!0),y.strm.avail_out===0?W:B):y.last_lit&&(F(y,!1),y.strm.avail_out===0)?g:C}function we(y,K){for(var G,R,A;;){if(y.lookahead<oe){if(Ae(y),y.lookahead<oe&&K===f)return g;if(y.lookahead===0)break}if(G=0,y.lookahead>=x&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+x-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=x-1,G!==0&&y.prev_length<y.max_lazy_match&&y.strstart-G<=y.w_size-oe&&(y.match_length=ee(y,G),y.match_length<=5&&(y.strategy===1||y.match_length===x&&4096<y.strstart-y.match_start)&&(y.match_length=x-1)),y.prev_length>=x&&y.match_length<=y.prev_length){for(A=y.strstart+y.lookahead-x,R=a._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-x),y.lookahead-=y.prev_length-1,y.prev_length-=2;++y.strstart<=A&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+x-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),--y.prev_length!=0;);if(y.match_available=0,y.match_length=x-1,y.strstart++,R&&(F(y,!1),y.strm.avail_out===0))return g}else if(y.match_available){if((R=a._tr_tally(y,0,y.window[y.strstart-1]))&&F(y,!1),y.strstart++,y.lookahead--,y.strm.avail_out===0)return g}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(R=a._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<x-1?y.strstart:x-1,K===d?(F(y,!0),y.strm.avail_out===0?W:B):y.last_lit&&(F(y,!1),y.strm.avail_out===0)?g:C}function _e(y,K,G,R,A){this.good_length=y,this.max_lazy=K,this.nice_length=G,this.max_chain=R,this.func=A}function Ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*T),this.dyn_dtree=new o.Buf16(2*(2*L+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(M+1),this.heap=new o.Buf16(2*S+1),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*S+1),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function $e(y){var K;return y&&y.state?(y.total_in=y.total_out=0,y.data_type=_,(K=y.state).pending=0,K.pending_out=0,K.wrap<0&&(K.wrap=-K.wrap),K.status=K.wrap?O:E,y.adler=K.wrap===2?0:1,K.last_flush=f,a._tr_init(K),h):Z(y,p)}function gt(y){var K=$e(y);return K===h&&function(G){G.window_size=2*G.w_size,Y(G.head),G.max_lazy_match=s[G.level].max_lazy,G.good_match=s[G.level].good_length,G.nice_match=s[G.level].nice_length,G.max_chain_length=s[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=x-1,G.match_available=0,G.ins_h=0}(y.state),K}function kt(y,K,G,R,A,D){if(!y)return p;var J=1;if(K===m&&(K=6),R<0?(J=0,R=-R):15<R&&(J=2,R-=16),A<1||v<A||G!==w||R<8||15<R||K<0||9<K||D<0||b<D)return Z(y,p);R===8&&(R=9);var X=new Ge;return(y.state=X).strm=y,X.wrap=J,X.gzhead=null,X.w_bits=R,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=A+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+x-1)/x),X.window=new o.Buf8(2*X.w_size),X.head=new o.Buf16(X.hash_size),X.prev=new o.Buf16(X.w_size),X.lit_bufsize=1<<A+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new o.Buf8(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=K,X.strategy=D,X.method=G,gt(y)}s=[new _e(0,0,0,0,function(y,K){var G=65535;for(G>y.pending_buf_size-5&&(G=y.pending_buf_size-5);;){if(y.lookahead<=1){if(Ae(y),y.lookahead===0&&K===f)return g;if(y.lookahead===0)break}y.strstart+=y.lookahead,y.lookahead=0;var R=y.block_start+G;if((y.strstart===0||y.strstart>=R)&&(y.lookahead=y.strstart-R,y.strstart=R,F(y,!1),y.strm.avail_out===0)||y.strstart-y.block_start>=y.w_size-oe&&(F(y,!1),y.strm.avail_out===0))return g}return y.insert=0,K===d?(F(y,!0),y.strm.avail_out===0?W:B):(y.strstart>y.block_start&&(F(y,!1),y.strm.avail_out),g)}),new _e(4,4,8,4,je),new _e(4,5,16,8,je),new _e(4,6,32,32,je),new _e(4,4,16,16,we),new _e(8,16,32,32,we),new _e(8,16,128,128,we),new _e(8,32,128,256,we),new _e(32,128,258,1024,we),new _e(32,258,258,4096,we)],i.deflateInit=function(y,K){return kt(y,K,w,15,8,0)},i.deflateInit2=kt,i.deflateReset=gt,i.deflateResetKeep=$e,i.deflateSetHeader=function(y,K){return y&&y.state?y.state.wrap!==2?p:(y.state.gzhead=K,h):p},i.deflate=function(y,K){var G,R,A,D;if(!y||!y.state||5<K||K<0)return y?Z(y,p):p;if(R=y.state,!y.output||!y.input&&y.avail_in!==0||R.status===666&&K!==d)return Z(y,y.avail_out===0?-5:p);if(R.strm=y,G=R.last_flush,R.last_flush=K,R.status===O)if(R.wrap===2)y.adler=0,ue(R,31),ue(R,139),ue(R,8),R.gzhead?(ue(R,(R.gzhead.text?1:0)+(R.gzhead.hcrc?2:0)+(R.gzhead.extra?4:0)+(R.gzhead.name?8:0)+(R.gzhead.comment?16:0)),ue(R,255&R.gzhead.time),ue(R,R.gzhead.time>>8&255),ue(R,R.gzhead.time>>16&255),ue(R,R.gzhead.time>>24&255),ue(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),ue(R,255&R.gzhead.os),R.gzhead.extra&&R.gzhead.extra.length&&(ue(R,255&R.gzhead.extra.length),ue(R,R.gzhead.extra.length>>8&255)),R.gzhead.hcrc&&(y.adler=l(y.adler,R.pending_buf,R.pending,0)),R.gzindex=0,R.status=69):(ue(R,0),ue(R,0),ue(R,0),ue(R,0),ue(R,0),ue(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),ue(R,3),R.status=E);else{var J=w+(R.w_bits-8<<4)<<8;J|=(2<=R.strategy||R.level<2?0:R.level<6?1:R.level===6?2:3)<<6,R.strstart!==0&&(J|=32),J+=31-J%31,R.status=E,Q(R,J),R.strstart!==0&&(Q(R,y.adler>>>16),Q(R,65535&y.adler)),y.adler=1}if(R.status===69)if(R.gzhead.extra){for(A=R.pending;R.gzindex<(65535&R.gzhead.extra.length)&&(R.pending!==R.pending_buf_size||(R.gzhead.hcrc&&R.pending>A&&(y.adler=l(y.adler,R.pending_buf,R.pending-A,A)),$(y),A=R.pending,R.pending!==R.pending_buf_size));)ue(R,255&R.gzhead.extra[R.gzindex]),R.gzindex++;R.gzhead.hcrc&&R.pending>A&&(y.adler=l(y.adler,R.pending_buf,R.pending-A,A)),R.gzindex===R.gzhead.extra.length&&(R.gzindex=0,R.status=73)}else R.status=73;if(R.status===73)if(R.gzhead.name){A=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>A&&(y.adler=l(y.adler,R.pending_buf,R.pending-A,A)),$(y),A=R.pending,R.pending===R.pending_buf_size)){D=1;break}D=R.gzindex<R.gzhead.name.length?255&R.gzhead.name.charCodeAt(R.gzindex++):0,ue(R,D)}while(D!==0);R.gzhead.hcrc&&R.pending>A&&(y.adler=l(y.adler,R.pending_buf,R.pending-A,A)),D===0&&(R.gzindex=0,R.status=91)}else R.status=91;if(R.status===91)if(R.gzhead.comment){A=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>A&&(y.adler=l(y.adler,R.pending_buf,R.pending-A,A)),$(y),A=R.pending,R.pending===R.pending_buf_size)){D=1;break}D=R.gzindex<R.gzhead.comment.length?255&R.gzhead.comment.charCodeAt(R.gzindex++):0,ue(R,D)}while(D!==0);R.gzhead.hcrc&&R.pending>A&&(y.adler=l(y.adler,R.pending_buf,R.pending-A,A)),D===0&&(R.status=103)}else R.status=103;if(R.status===103&&(R.gzhead.hcrc?(R.pending+2>R.pending_buf_size&&$(y),R.pending+2<=R.pending_buf_size&&(ue(R,255&y.adler),ue(R,y.adler>>8&255),y.adler=0,R.status=E)):R.status=E),R.pending!==0){if($(y),y.avail_out===0)return R.last_flush=-1,h}else if(y.avail_in===0&&H(K)<=H(G)&&K!==d)return Z(y,-5);if(R.status===666&&y.avail_in!==0)return Z(y,-5);if(y.avail_in!==0||R.lookahead!==0||K!==f&&R.status!==666){var X=R.strategy===2?function(z,te){for(var le;;){if(z.lookahead===0&&(Ae(z),z.lookahead===0)){if(te===f)return g;break}if(z.match_length=0,le=a._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,le&&(F(z,!1),z.strm.avail_out===0))return g}return z.insert=0,te===d?(F(z,!0),z.strm.avail_out===0?W:B):z.last_lit&&(F(z,!1),z.strm.avail_out===0)?g:C}(R,K):R.strategy===3?function(z,te){for(var le,re,de,Ze,Ue=z.window;;){if(z.lookahead<=V){if(Ae(z),z.lookahead<=V&&te===f)return g;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=x&&0<z.strstart&&(re=Ue[de=z.strstart-1])===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]){Ze=z.strstart+V;do;while(re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&de<Ze);z.match_length=V-(Ze-de),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=x?(le=a._tr_tally(z,1,z.match_length-x),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(le=a._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),le&&(F(z,!1),z.strm.avail_out===0))return g}return z.insert=0,te===d?(F(z,!0),z.strm.avail_out===0?W:B):z.last_lit&&(F(z,!1),z.strm.avail_out===0)?g:C}(R,K):s[R.level].func(R,K);if(X!==W&&X!==B||(R.status=666),X===g||X===W)return y.avail_out===0&&(R.last_flush=-1),h;if(X===C&&(K===1?a._tr_align(R):K!==5&&(a._tr_stored_block(R,0,0,!1),K===3&&(Y(R.head),R.lookahead===0&&(R.strstart=0,R.block_start=0,R.insert=0))),$(y),y.avail_out===0))return R.last_flush=-1,h}return K!==d?h:R.wrap<=0?1:(R.wrap===2?(ue(R,255&y.adler),ue(R,y.adler>>8&255),ue(R,y.adler>>16&255),ue(R,y.adler>>24&255),ue(R,255&y.total_in),ue(R,y.total_in>>8&255),ue(R,y.total_in>>16&255),ue(R,y.total_in>>24&255)):(Q(R,y.adler>>>16),Q(R,65535&y.adler)),$(y),0<R.wrap&&(R.wrap=-R.wrap),R.pending!==0?h:1)},i.deflateEnd=function(y){var K;return y&&y.state?(K=y.state.status)!==O&&K!==69&&K!==73&&K!==91&&K!==103&&K!==E&&K!==666?Z(y,p):(y.state=null,K===E?Z(y,-3):h):p},i.deflateSetDictionary=function(y,K){var G,R,A,D,J,X,z,te,le=K.length;if(!y||!y.state||(D=(G=y.state).wrap)===2||D===1&&G.status!==O||G.lookahead)return p;for(D===1&&(y.adler=c(y.adler,K,le,0)),G.wrap=0,le>=G.w_size&&(D===0&&(Y(G.head),G.strstart=0,G.block_start=0,G.insert=0),te=new o.Buf8(G.w_size),o.arraySet(te,K,le-G.w_size,G.w_size,0),K=te,le=G.w_size),J=y.avail_in,X=y.next_in,z=y.input,y.avail_in=le,y.next_in=0,y.input=K,Ae(G);G.lookahead>=x;){for(R=G.strstart,A=G.lookahead-(x-1);G.ins_h=(G.ins_h<<G.hash_shift^G.window[R+x-1])&G.hash_mask,G.prev[R&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=R,R++,--A;);G.strstart=R,G.lookahead=x-1,Ae(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=x-1,G.match_available=0,y.next_in=X,y.input=z,y.avail_in=J,G.wrap=D,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,p,m,b,_,w,v,S,L,I,T,M,x,V,oe,O,E,g,C;a=s.state,c=s.next_in,g=s.input,l=c+(s.avail_in-5),u=s.next_out,C=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,_=a.window,w=a.hold,v=a.bits,S=a.lencode,L=a.distcode,I=(1<<a.lenbits)-1,T=(1<<a.distbits)-1;e:do{v<15&&(w+=g[c++]<<v,v+=8,w+=g[c++]<<v,v+=8),M=S[w&I];t:for(;;){if(w>>>=x=M>>>24,v-=x,(x=M>>>16&255)===0)C[u++]=65535&M;else{if(!(16&x)){if(!(64&x)){M=S[(65535&M)+(w&(1<<x)-1)];continue t}if(32&x){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}V=65535&M,(x&=15)&&(v<x&&(w+=g[c++]<<v,v+=8),V+=w&(1<<x)-1,w>>>=x,v-=x),v<15&&(w+=g[c++]<<v,v+=8,w+=g[c++]<<v,v+=8),M=L[w&T];n:for(;;){if(w>>>=x=M>>>24,v-=x,!(16&(x=M>>>16&255))){if(!(64&x)){M=L[(65535&M)+(w&(1<<x)-1)];continue n}s.msg="invalid distance code",a.mode=30;break e}if(oe=65535&M,v<(x&=15)&&(w+=g[c++]<<v,(v+=8)<x&&(w+=g[c++]<<v,v+=8)),h<(oe+=w&(1<<x)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(w>>>=x,v-=x,(x=u-f)<oe){if(m<(x=oe-x)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(E=_,(O=0)===b){if(O+=p-x,x<V){for(V-=x;C[u++]=_[O++],--x;);O=u-oe,E=C}}else if(b<x){if(O+=p+b-x,(x-=b)<V){for(V-=x;C[u++]=_[O++],--x;);if(O=0,b<V){for(V-=x=b;C[u++]=_[O++],--x;);O=u-oe,E=C}}}else if(O+=b-x,x<V){for(V-=x;C[u++]=_[O++],--x;);O=u-oe,E=C}for(;2<V;)C[u++]=E[O++],C[u++]=E[O++],C[u++]=E[O++],V-=3;V&&(C[u++]=E[O++],1<V&&(C[u++]=E[O++]))}else{for(O=u-oe;C[u++]=C[O++],C[u++]=C[O++],C[u++]=C[O++],2<(V-=3););V&&(C[u++]=C[O++],1<V&&(C[u++]=C[O++]))}break}}break}}while(c<l&&u<d);c-=V=v>>3,w&=(1<<(v-=V<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=w,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,p=1,m=852,b=592;function _(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(O){var E;return O&&O.state?(E=O.state,O.total_in=O.total_out=E.total=0,O.msg="",E.wrap&&(O.adler=1&E.wrap),E.mode=p,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new s.Buf32(m),E.distcode=E.distdyn=new s.Buf32(b),E.sane=1,E.back=-1,d):h}function S(O){var E;return O&&O.state?((E=O.state).wsize=0,E.whave=0,E.wnext=0,v(O)):h}function L(O,E){var g,C;return O&&O.state?(C=O.state,E<0?(g=0,E=-E):(g=1+(E>>4),E<48&&(E&=15)),E&&(E<8||15<E)?h:(C.window!==null&&C.wbits!==E&&(C.window=null),C.wrap=g,C.wbits=E,S(O))):h}function I(O,E){var g,C;return O?(C=new w,(O.state=C).window=null,(g=L(O,E))!==d&&(O.state=null),g):h}var T,M,x=!0;function V(O){if(x){var E;for(T=new s.Buf32(512),M=new s.Buf32(32),E=0;E<144;)O.lens[E++]=8;for(;E<256;)O.lens[E++]=9;for(;E<280;)O.lens[E++]=7;for(;E<288;)O.lens[E++]=8;for(l(u,O.lens,0,288,T,0,O.work,{bits:9}),E=0;E<32;)O.lens[E++]=5;l(f,O.lens,0,32,M,0,O.work,{bits:5}),x=!1}O.lencode=T,O.lenbits=9,O.distcode=M,O.distbits=5}function oe(O,E,g,C){var W,B=O.state;return B.window===null&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new s.Buf8(B.wsize)),C>=B.wsize?(s.arraySet(B.window,E,g-B.wsize,B.wsize,0),B.wnext=0,B.whave=B.wsize):(C<(W=B.wsize-B.wnext)&&(W=C),s.arraySet(B.window,E,g-C,W,B.wnext),(C-=W)?(s.arraySet(B.window,E,g-C,C,0),B.wnext=C,B.whave=B.wsize):(B.wnext+=W,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=W))),0}i.inflateReset=S,i.inflateReset2=L,i.inflateResetKeep=v,i.inflateInit=function(O){return I(O,15)},i.inflateInit2=I,i.inflate=function(O,E){var g,C,W,B,Z,H,Y,$,F,ue,Q,ee,Ae,je,we,_e,Ge,$e,gt,kt,y,K,G,R,A=0,D=new s.Buf8(4),J=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return h;(g=O.state).mode===12&&(g.mode=13),Z=O.next_out,W=O.output,Y=O.avail_out,B=O.next_in,C=O.input,H=O.avail_in,$=g.hold,F=g.bits,ue=H,Q=Y,K=d;e:for(;;)switch(g.mode){case p:if(g.wrap===0){g.mode=13;break}for(;F<16;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if(2&g.wrap&&$===35615){D[g.check=0]=255&$,D[1]=$>>>8&255,g.check=a(g.check,D,2,0),F=$=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&$)<<8)+($>>8))%31){O.msg="incorrect header check",g.mode=30;break}if((15&$)!=8){O.msg="unknown compression method",g.mode=30;break}if(F-=4,y=8+(15&($>>>=4)),g.wbits===0)g.wbits=y;else if(y>g.wbits){O.msg="invalid window size",g.mode=30;break}g.dmax=1<<y,O.adler=g.check=1,g.mode=512&$?10:12,F=$=0;break;case 2:for(;F<16;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if(g.flags=$,(255&g.flags)!=8){O.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){O.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=$>>8&1),512&g.flags&&(D[0]=255&$,D[1]=$>>>8&255,g.check=a(g.check,D,2,0)),F=$=0,g.mode=3;case 3:for(;F<32;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}g.head&&(g.head.time=$),512&g.flags&&(D[0]=255&$,D[1]=$>>>8&255,D[2]=$>>>16&255,D[3]=$>>>24&255,g.check=a(g.check,D,4,0)),F=$=0,g.mode=4;case 4:for(;F<16;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}g.head&&(g.head.xflags=255&$,g.head.os=$>>8),512&g.flags&&(D[0]=255&$,D[1]=$>>>8&255,g.check=a(g.check,D,2,0)),F=$=0,g.mode=5;case 5:if(1024&g.flags){for(;F<16;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}g.length=$,g.head&&(g.head.extra_len=$),512&g.flags&&(D[0]=255&$,D[1]=$>>>8&255,g.check=a(g.check,D,2,0)),F=$=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(H<(ee=g.length)&&(ee=H),ee&&(g.head&&(y=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),s.arraySet(g.head.extra,C,B,ee,y)),512&g.flags&&(g.check=a(g.check,C,ee,B)),H-=ee,B+=ee,g.length-=ee),g.length))break e;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(H===0)break e;for(ee=0;y=C[B+ee++],g.head&&y&&g.length<65536&&(g.head.name+=String.fromCharCode(y)),y&&ee<H;);if(512&g.flags&&(g.check=a(g.check,C,ee,B)),H-=ee,B+=ee,y)break e}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(H===0)break e;for(ee=0;y=C[B+ee++],g.head&&y&&g.length<65536&&(g.head.comment+=String.fromCharCode(y)),y&&ee<H;);if(512&g.flags&&(g.check=a(g.check,C,ee,B)),H-=ee,B+=ee,y)break e}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;F<16;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if($!==(65535&g.check)){O.msg="header crc mismatch",g.mode=30;break}F=$=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),O.adler=g.check=0,g.mode=12;break;case 10:for(;F<32;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}O.adler=g.check=_($),F=$=0,g.mode=11;case 11:if(g.havedict===0)return O.next_out=Z,O.avail_out=Y,O.next_in=B,O.avail_in=H,g.hold=$,g.bits=F,2;O.adler=g.check=1,g.mode=12;case 12:if(E===5||E===6)break e;case 13:if(g.last){$>>>=7&F,F-=7&F,g.mode=27;break}for(;F<3;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}switch(g.last=1&$,F-=1,3&($>>>=1)){case 0:g.mode=14;break;case 1:if(V(g),g.mode=20,E!==6)break;$>>>=2,F-=2;break e;case 2:g.mode=17;break;case 3:O.msg="invalid block type",g.mode=30}$>>>=2,F-=2;break;case 14:for($>>>=7&F,F-=7&F;F<32;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if((65535&$)!=($>>>16^65535)){O.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&$,F=$=0,g.mode=15,E===6)break e;case 15:g.mode=16;case 16:if(ee=g.length){if(H<ee&&(ee=H),Y<ee&&(ee=Y),ee===0)break e;s.arraySet(W,C,B,ee,Z),H-=ee,B+=ee,Y-=ee,Z+=ee,g.length-=ee;break}g.mode=12;break;case 17:for(;F<14;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if(g.nlen=257+(31&$),$>>>=5,F-=5,g.ndist=1+(31&$),$>>>=5,F-=5,g.ncode=4+(15&$),$>>>=4,F-=4,286<g.nlen||30<g.ndist){O.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;F<3;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}g.lens[J[g.have++]]=7&$,$>>>=3,F-=3}for(;g.have<19;)g.lens[J[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,G={bits:g.lenbits},K=l(0,g.lens,0,19,g.lencode,0,g.work,G),g.lenbits=G.bits,K){O.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;_e=(A=g.lencode[$&(1<<g.lenbits)-1])>>>16&255,Ge=65535&A,!((we=A>>>24)<=F);){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if(Ge<16)$>>>=we,F-=we,g.lens[g.have++]=Ge;else{if(Ge===16){for(R=we+2;F<R;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if($>>>=we,F-=we,g.have===0){O.msg="invalid bit length repeat",g.mode=30;break}y=g.lens[g.have-1],ee=3+(3&$),$>>>=2,F-=2}else if(Ge===17){for(R=we+3;F<R;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}F-=we,y=0,ee=3+(7&($>>>=we)),$>>>=3,F-=3}else{for(R=we+7;F<R;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}F-=we,y=0,ee=11+(127&($>>>=we)),$>>>=7,F-=7}if(g.have+ee>g.nlen+g.ndist){O.msg="invalid bit length repeat",g.mode=30;break}for(;ee--;)g.lens[g.have++]=y}}if(g.mode===30)break;if(g.lens[256]===0){O.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,G={bits:g.lenbits},K=l(u,g.lens,0,g.nlen,g.lencode,0,g.work,G),g.lenbits=G.bits,K){O.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,G={bits:g.distbits},K=l(f,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,G),g.distbits=G.bits,K){O.msg="invalid distances set",g.mode=30;break}if(g.mode=20,E===6)break e;case 20:g.mode=21;case 21:if(6<=H&&258<=Y){O.next_out=Z,O.avail_out=Y,O.next_in=B,O.avail_in=H,g.hold=$,g.bits=F,c(O,Q),Z=O.next_out,W=O.output,Y=O.avail_out,B=O.next_in,C=O.input,H=O.avail_in,$=g.hold,F=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;_e=(A=g.lencode[$&(1<<g.lenbits)-1])>>>16&255,Ge=65535&A,!((we=A>>>24)<=F);){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if(_e&&!(240&_e)){for($e=we,gt=_e,kt=Ge;_e=(A=g.lencode[kt+(($&(1<<$e+gt)-1)>>$e)])>>>16&255,Ge=65535&A,!($e+(we=A>>>24)<=F);){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}$>>>=$e,F-=$e,g.back+=$e}if($>>>=we,F-=we,g.back+=we,g.length=Ge,_e===0){g.mode=26;break}if(32&_e){g.back=-1,g.mode=12;break}if(64&_e){O.msg="invalid literal/length code",g.mode=30;break}g.extra=15&_e,g.mode=22;case 22:if(g.extra){for(R=g.extra;F<R;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}g.length+=$&(1<<g.extra)-1,$>>>=g.extra,F-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;_e=(A=g.distcode[$&(1<<g.distbits)-1])>>>16&255,Ge=65535&A,!((we=A>>>24)<=F);){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if(!(240&_e)){for($e=we,gt=_e,kt=Ge;_e=(A=g.distcode[kt+(($&(1<<$e+gt)-1)>>$e)])>>>16&255,Ge=65535&A,!($e+(we=A>>>24)<=F);){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}$>>>=$e,F-=$e,g.back+=$e}if($>>>=we,F-=we,g.back+=we,64&_e){O.msg="invalid distance code",g.mode=30;break}g.offset=Ge,g.extra=15&_e,g.mode=24;case 24:if(g.extra){for(R=g.extra;F<R;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}g.offset+=$&(1<<g.extra)-1,$>>>=g.extra,F-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){O.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(Y===0)break e;if(ee=Q-Y,g.offset>ee){if((ee=g.offset-ee)>g.whave&&g.sane){O.msg="invalid distance too far back",g.mode=30;break}Ae=ee>g.wnext?(ee-=g.wnext,g.wsize-ee):g.wnext-ee,ee>g.length&&(ee=g.length),je=g.window}else je=W,Ae=Z-g.offset,ee=g.length;for(Y<ee&&(ee=Y),Y-=ee,g.length-=ee;W[Z++]=je[Ae++],--ee;);g.length===0&&(g.mode=21);break;case 26:if(Y===0)break e;W[Z++]=g.length,Y--,g.mode=21;break;case 27:if(g.wrap){for(;F<32;){if(H===0)break e;H--,$|=C[B++]<<F,F+=8}if(Q-=Y,O.total_out+=Q,g.total+=Q,Q&&(O.adler=g.check=g.flags?a(g.check,W,Q,Z-Q):o(g.check,W,Q,Z-Q)),Q=Y,(g.flags?$:_($))!==g.check){O.msg="incorrect data check",g.mode=30;break}F=$=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;F<32;){if(H===0)break e;H--,$+=C[B++]<<F,F+=8}if($!==(4294967295&g.total)){O.msg="incorrect length check",g.mode=30;break}F=$=0}g.mode=29;case 29:K=1;break e;case 30:K=-3;break e;case 31:return-4;case 32:default:return h}return O.next_out=Z,O.avail_out=Y,O.next_in=B,O.avail_in=H,g.hold=$,g.bits=F,(g.wsize||Q!==O.avail_out&&g.mode<30&&(g.mode<27||E!==4))&&oe(O,O.output,O.next_out,Q-O.avail_out)?(g.mode=31,-4):(ue-=O.avail_in,Q-=O.avail_out,O.total_in+=ue,O.total_out+=Q,g.total+=Q,g.wrap&&Q&&(O.adler=g.check=g.flags?a(g.check,W,Q,O.next_out-Q):o(g.check,W,Q,O.next_out-Q)),O.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(ue==0&&Q===0||E===4)&&K===d&&(K=-5),K)},i.inflateEnd=function(O){if(!O||!O.state)return h;var E=O.state;return E.window&&(E.window=null),O.state=null,d},i.inflateGetHeader=function(O,E){var g;return O&&O.state&&2&(g=O.state).wrap?((g.head=E).done=!1,d):h},i.inflateSetDictionary=function(O,E){var g,C=E.length;return O&&O.state?(g=O.state).wrap!==0&&g.mode!==11?h:g.mode===11&&o(1,E,C,0)!==g.check?-3:oe(O,E,C,C)?(g.mode=31,-4):(g.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,p,m,b,_){var w,v,S,L,I,T,M,x,V,oe=_.bits,O=0,E=0,g=0,C=0,W=0,B=0,Z=0,H=0,Y=0,$=0,F=null,ue=0,Q=new s.Buf16(16),ee=new s.Buf16(16),Ae=null,je=0;for(O=0;O<=15;O++)Q[O]=0;for(E=0;E<h;E++)Q[f[d+E]]++;for(W=oe,C=15;1<=C&&Q[C]===0;C--);if(C<W&&(W=C),C===0)return p[m++]=20971520,p[m++]=20971520,_.bits=1,0;for(g=1;g<C&&Q[g]===0;g++);for(W<g&&(W=g),O=H=1;O<=15;O++)if(H<<=1,(H-=Q[O])<0)return-1;if(0<H&&(u===0||C!==1))return-1;for(ee[1]=0,O=1;O<15;O++)ee[O+1]=ee[O]+Q[O];for(E=0;E<h;E++)f[d+E]!==0&&(b[ee[f[d+E]]++]=E);if(T=u===0?(F=Ae=b,19):u===1?(F=o,ue-=257,Ae=a,je-=257,256):(F=c,Ae=l,-1),O=g,I=m,Z=E=$=0,S=-1,L=(Y=1<<(B=W))-1,u===1&&852<Y||u===2&&592<Y)return 1;for(;;){for(M=O-Z,V=b[E]<T?(x=0,b[E]):b[E]>T?(x=Ae[je+b[E]],F[ue+b[E]]):(x=96,0),w=1<<O-Z,g=v=1<<B;p[I+($>>Z)+(v-=w)]=M<<24|x<<16|V|0,v!==0;);for(w=1<<O-1;$&w;)w>>=1;if(w!==0?($&=w-1,$+=w):$=0,E++,--Q[O]==0){if(O===C)break;O=f[d+b[E]]}if(W<O&&($&L)!==S){for(Z===0&&(Z=W),I+=g,H=1<<(B=O-Z);B+Z<C&&!((H-=Q[B+Z])<=0);)B++,H<<=1;if(Y+=1<<B,u===1&&852<Y||u===2&&592<Y)return 1;p[S=$&L]=W<<24|B<<16|I-m|0}}return $!==0&&(p[I+$]=O-Z<<24|64<<16|0),_.bits=W,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(A){for(var D=A.length;0<=--D;)A[D]=0}var l=0,u=29,f=256,d=f+1+u,h=30,p=19,m=2*d+1,b=15,_=16,w=7,v=256,S=16,L=17,I=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],oe=new Array(2*(d+2));c(oe);var O=new Array(2*h);c(O);var E=new Array(512);c(E);var g=new Array(256);c(g);var C=new Array(u);c(C);var W,B,Z,H=new Array(h);function Y(A,D,J,X,z){this.static_tree=A,this.extra_bits=D,this.extra_base=J,this.elems=X,this.max_length=z,this.has_stree=A&&A.length}function $(A,D){this.dyn_tree=A,this.max_code=0,this.stat_desc=D}function F(A){return A<256?E[A]:E[256+(A>>>7)]}function ue(A,D){A.pending_buf[A.pending++]=255&D,A.pending_buf[A.pending++]=D>>>8&255}function Q(A,D,J){A.bi_valid>_-J?(A.bi_buf|=D<<A.bi_valid&65535,ue(A,A.bi_buf),A.bi_buf=D>>_-A.bi_valid,A.bi_valid+=J-_):(A.bi_buf|=D<<A.bi_valid&65535,A.bi_valid+=J)}function ee(A,D,J){Q(A,J[2*D],J[2*D+1])}function Ae(A,D){for(var J=0;J|=1&A,A>>>=1,J<<=1,0<--D;);return J>>>1}function je(A,D,J){var X,z,te=new Array(b+1),le=0;for(X=1;X<=b;X++)te[X]=le=le+J[X-1]<<1;for(z=0;z<=D;z++){var re=A[2*z+1];re!==0&&(A[2*z]=Ae(te[re]++,re))}}function we(A){var D;for(D=0;D<d;D++)A.dyn_ltree[2*D]=0;for(D=0;D<h;D++)A.dyn_dtree[2*D]=0;for(D=0;D<p;D++)A.bl_tree[2*D]=0;A.dyn_ltree[2*v]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0}function _e(A){8<A.bi_valid?ue(A,A.bi_buf):0<A.bi_valid&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0}function Ge(A,D,J,X){var z=2*D,te=2*J;return A[z]<A[te]||A[z]===A[te]&&X[D]<=X[J]}function $e(A,D,J){for(var X=A.heap[J],z=J<<1;z<=A.heap_len&&(z<A.heap_len&&Ge(D,A.heap[z+1],A.heap[z],A.depth)&&z++,!Ge(D,X,A.heap[z],A.depth));)A.heap[J]=A.heap[z],J=z,z<<=1;A.heap[J]=X}function gt(A,D,J){var X,z,te,le,re=0;if(A.last_lit!==0)for(;X=A.pending_buf[A.d_buf+2*re]<<8|A.pending_buf[A.d_buf+2*re+1],z=A.pending_buf[A.l_buf+re],re++,X===0?ee(A,z,D):(ee(A,(te=g[z])+f+1,D),(le=T[te])!==0&&Q(A,z-=C[te],le),ee(A,te=F(--X),J),(le=M[te])!==0&&Q(A,X-=H[te],le)),re<A.last_lit;);ee(A,v,D)}function kt(A,D){var J,X,z,te=D.dyn_tree,le=D.stat_desc.static_tree,re=D.stat_desc.has_stree,de=D.stat_desc.elems,Ze=-1;for(A.heap_len=0,A.heap_max=m,J=0;J<de;J++)te[2*J]!==0?(A.heap[++A.heap_len]=Ze=J,A.depth[J]=0):te[2*J+1]=0;for(;A.heap_len<2;)te[2*(z=A.heap[++A.heap_len]=Ze<2?++Ze:0)]=1,A.depth[z]=0,A.opt_len--,re&&(A.static_len-=le[2*z+1]);for(D.max_code=Ze,J=A.heap_len>>1;1<=J;J--)$e(A,te,J);for(z=de;J=A.heap[1],A.heap[1]=A.heap[A.heap_len--],$e(A,te,1),X=A.heap[1],A.heap[--A.heap_max]=J,A.heap[--A.heap_max]=X,te[2*z]=te[2*J]+te[2*X],A.depth[z]=(A.depth[J]>=A.depth[X]?A.depth[J]:A.depth[X])+1,te[2*J+1]=te[2*X+1]=z,A.heap[1]=z++,$e(A,te,1),2<=A.heap_len;);A.heap[--A.heap_max]=A.heap[1],function(Ue,Sn){var ko,sr,So,ft,Ic,Wf,Or=Sn.dyn_tree,x_=Sn.max_code,pM=Sn.stat_desc.static_tree,mM=Sn.stat_desc.has_stree,gM=Sn.stat_desc.extra_bits,R_=Sn.stat_desc.extra_base,Ao=Sn.stat_desc.max_length,Oc=0;for(ft=0;ft<=b;ft++)Ue.bl_count[ft]=0;for(Or[2*Ue.heap[Ue.heap_max]+1]=0,ko=Ue.heap_max+1;ko<m;ko++)Ao<(ft=Or[2*Or[2*(sr=Ue.heap[ko])+1]+1]+1)&&(ft=Ao,Oc++),Or[2*sr+1]=ft,x_<sr||(Ue.bl_count[ft]++,Ic=0,R_<=sr&&(Ic=gM[sr-R_]),Wf=Or[2*sr],Ue.opt_len+=Wf*(ft+Ic),mM&&(Ue.static_len+=Wf*(pM[2*sr+1]+Ic)));if(Oc!==0){do{for(ft=Ao-1;Ue.bl_count[ft]===0;)ft--;Ue.bl_count[ft]--,Ue.bl_count[ft+1]+=2,Ue.bl_count[Ao]--,Oc-=2}while(0<Oc);for(ft=Ao;ft!==0;ft--)for(sr=Ue.bl_count[ft];sr!==0;)x_<(So=Ue.heap[--ko])||(Or[2*So+1]!==ft&&(Ue.opt_len+=(ft-Or[2*So+1])*Or[2*So],Or[2*So+1]=ft),sr--)}}(A,D),je(te,Ze,A.bl_count)}function y(A,D,J){var X,z,te=-1,le=D[1],re=0,de=7,Ze=4;for(le===0&&(de=138,Ze=3),D[2*(J+1)+1]=65535,X=0;X<=J;X++)z=le,le=D[2*(X+1)+1],++re<de&&z===le||(re<Ze?A.bl_tree[2*z]+=re:z!==0?(z!==te&&A.bl_tree[2*z]++,A.bl_tree[2*S]++):re<=10?A.bl_tree[2*L]++:A.bl_tree[2*I]++,te=z,Ze=(re=0)===le?(de=138,3):z===le?(de=6,3):(de=7,4))}function K(A,D,J){var X,z,te=-1,le=D[1],re=0,de=7,Ze=4;for(le===0&&(de=138,Ze=3),X=0;X<=J;X++)if(z=le,le=D[2*(X+1)+1],!(++re<de&&z===le)){if(re<Ze)for(;ee(A,z,A.bl_tree),--re!=0;);else z!==0?(z!==te&&(ee(A,z,A.bl_tree),re--),ee(A,S,A.bl_tree),Q(A,re-3,2)):re<=10?(ee(A,L,A.bl_tree),Q(A,re-3,3)):(ee(A,I,A.bl_tree),Q(A,re-11,7));te=z,Ze=(re=0)===le?(de=138,3):z===le?(de=6,3):(de=7,4)}}c(H);var G=!1;function R(A,D,J,X){Q(A,(l<<1)+(X?1:0),3),function(z,te,le,re){_e(z),ue(z,le),ue(z,~le),s.arraySet(z.pending_buf,z.window,te,le,z.pending),z.pending+=le}(A,D,J)}i._tr_init=function(A){G||(function(){var D,J,X,z,te,le=new Array(b+1);for(z=X=0;z<u-1;z++)for(C[z]=X,D=0;D<1<<T[z];D++)g[X++]=z;for(g[X-1]=z,z=te=0;z<16;z++)for(H[z]=te,D=0;D<1<<M[z];D++)E[te++]=z;for(te>>=7;z<h;z++)for(H[z]=te<<7,D=0;D<1<<M[z]-7;D++)E[256+te++]=z;for(J=0;J<=b;J++)le[J]=0;for(D=0;D<=143;)oe[2*D+1]=8,D++,le[8]++;for(;D<=255;)oe[2*D+1]=9,D++,le[9]++;for(;D<=279;)oe[2*D+1]=7,D++,le[7]++;for(;D<=287;)oe[2*D+1]=8,D++,le[8]++;for(je(oe,d+1,le),D=0;D<h;D++)O[2*D+1]=5,O[2*D]=Ae(D,5);W=new Y(oe,T,f+1,d,b),B=new Y(O,M,0,h,b),Z=new Y(new Array(0),x,0,p,w)}(),G=!0),A.l_desc=new $(A.dyn_ltree,W),A.d_desc=new $(A.dyn_dtree,B),A.bl_desc=new $(A.bl_tree,Z),A.bi_buf=0,A.bi_valid=0,we(A)},i._tr_stored_block=R,i._tr_flush_block=function(A,D,J,X){var z,te,le=0;0<A.level?(A.strm.data_type===2&&(A.strm.data_type=function(re){var de,Ze=4093624447;for(de=0;de<=31;de++,Ze>>>=1)if(1&Ze&&re.dyn_ltree[2*de]!==0)return o;if(re.dyn_ltree[18]!==0||re.dyn_ltree[20]!==0||re.dyn_ltree[26]!==0)return a;for(de=32;de<f;de++)if(re.dyn_ltree[2*de]!==0)return a;return o}(A)),kt(A,A.l_desc),kt(A,A.d_desc),le=function(re){var de;for(y(re,re.dyn_ltree,re.l_desc.max_code),y(re,re.dyn_dtree,re.d_desc.max_code),kt(re,re.bl_desc),de=p-1;3<=de&&re.bl_tree[2*V[de]+1]===0;de--);return re.opt_len+=3*(de+1)+5+5+4,de}(A),z=A.opt_len+3+7>>>3,(te=A.static_len+3+7>>>3)<=z&&(z=te)):z=te=J+5,J+4<=z&&D!==-1?R(A,D,J,X):A.strategy===4||te===z?(Q(A,2+(X?1:0),3),gt(A,oe,O)):(Q(A,4+(X?1:0),3),function(re,de,Ze,Ue){var Sn;for(Q(re,de-257,5),Q(re,Ze-1,5),Q(re,Ue-4,4),Sn=0;Sn<Ue;Sn++)Q(re,re.bl_tree[2*V[Sn]+1],3);K(re,re.dyn_ltree,de-1),K(re,re.dyn_dtree,Ze-1)}(A,A.l_desc.max_code+1,A.d_desc.max_code+1,le+1),gt(A,A.dyn_ltree,A.dyn_dtree)),we(A),X&&_e(A)},i._tr_tally=function(A,D,J){return A.pending_buf[A.d_buf+2*A.last_lit]=D>>>8&255,A.pending_buf[A.d_buf+2*A.last_lit+1]=255&D,A.pending_buf[A.l_buf+A.last_lit]=255&J,A.last_lit++,D===0?A.dyn_ltree[2*J]++:(A.matches++,D--,A.dyn_ltree[2*(g[J]+f+1)]++,A.dyn_dtree[2*F(D)]++),A.last_lit===A.lit_bufsize-1},i._tr_align=function(A){Q(A,2,3),ee(A,v,oe),function(D){D.bi_valid===16?(ue(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):8<=D.bi_valid&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)}(A)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(S){process.nextTick(function(){w(S)})}:function(){if(o.postMessage&&!o.importScripts){var S=!0,L=o.onmessage;return o.onmessage=function(){S=!1},o.postMessage("","*"),o.onmessage=L,S}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(S){o.postMessage(f+S,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(S){w(S.data)},function(S){u.port2.postMessage(S)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(S){var L=m.createElement("script");L.onreadystatechange=function(){w(S),L.onreadystatechange=null,l.removeChild(L),L=null},l.appendChild(L)}):function(S){setTimeout(w,0,S)},b.setImmediate=function(S){typeof S!="function"&&(S=new Function(""+S));for(var L=new Array(arguments.length-1),I=0;I<L.length;I++)L[I]=arguments[I+1];var T={callback:S,args:L};return h[d]=T,c(d),d++},b.clearImmediate=_}function _(S){delete h[S]}function w(S){if(p)setTimeout(w,0,S);else{var L=h[S];if(L){p=!0;try{(function(I){var T=I.callback,M=I.args;switch(M.length){case 0:T();break;case 1:T(M[0]);break;case 2:T(M[0],M[1]);break;case 3:T(M[0],M[1],M[2]);break;default:T.apply(a,M)}})(L)}finally{_(S),p=!1}}}}function v(S){S.source===o&&typeof S.data=="string"&&S.data.indexOf(f)===0&&w(+S.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Pt<"u"?Pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(d_);var CL=d_.exports,Bf=Ii(CL);const p_={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(p_);var kn=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},as,Eo,Ti;class LL{constructor(...e){as.set(this,new Map),Eo.set(this,new Map),Ti.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),kn(this,Ti,"f").has(r)||kn(this,Ti,"f").set(r,new Set);const s=kn(this,Ti,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&kn(this,Eo,"f").set(r,a),o=!1,c)continue;const l=kn(this,as,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);kn(this,as,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:kn(this,as,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&kn(this,Eo,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:kn(this,Ti,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of kn(this,Ti,"f").values())Object.freeze(e);return this}_getTestState(){return{types:kn(this,as,"f"),extensions:kn(this,Eo,"f")}}}as=new WeakMap,Eo=new WeakMap,Ti=new WeakMap;var ML=new LL(p_)._freeze();function m_(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return ML.getType(t)??"application/octet-stream"}function UL(t){const e=dy(t,{}),n=tr(e),r=uo(e),i=Un(We.MAIN);if(!k(i))return;const s=lo(e),o=pf(i,s,n);k(o)?Nt("memory",`${i.name} already has a [${r}] named ${n}`):(yy(i,e),__(e.id,i.id),Nt("memory",`created [${r}] ${n} in ${i.name}`))}async function PL(t){const e=await t.text();UL(e)}async function DL(t,e){try{Nt("parsezipfile",t.name);const n=await t.arrayBuffer();(await new Bf().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=m_(s,a),l=new File([a],o.name,{type:c});e(l)}).catch(a=>{tt("memory","crash",a.message)})})}catch(n){tt("memory","crash",n.message)}}async function BL(t,e){try{Nt("parsebinaryfile",t.name);const n=await t.arrayBuffer(),r=t.name.split(".").slice(-1)[0]??"";e(Pe(r),new Uint8Array(n))}catch(n){tt("memory","crash",n.message)}}function Ff(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];He(r)?r.forEach(i=>{e.push(Ff(i))}):e.push(Ff(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function FL(t){const e=D0(`${t}
`);if(e.errors.length>0)return e;os.input=e.tokens;const n=os.program();if(os.errors.length>0)return{tokens:e.tokens,errors:os.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=SL.go(n);return r?(Ff(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const $f=Object.getPrototypeOf(function*(){}).constructor;function $L(t,e){const n=`compile-${t}`;console.time(n);const r=FL(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=IL(r.ast);if(i.code){Rk&&console.info(i.code);try{return{...r,...i,source:i.code,code:new $f("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new $f("api"," ")}}}return{...r,...i,source:"",code:new $f("api"," ")}}function jL(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=$L(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},has(i){return k(e[i])},isended(i){const s=e[i];return k(s)?s.isended():!0},halt(i){const s=e[i];return k(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},tick(i,s,o,a,c){var u;let l=e[i];if(!k(e[i])){const f=n(a,c);if(l=e[i]=NL(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((_,w)=>[_,w]);p.slice(h-5,h).forEach(([_,w])=>{tt("os","build",`$grey${w+1} $grey${_}`)});const[m,b]=p[h]??[];if(Se(m)&&k(b)){const _=(d.column??1)-1,w=_+d.length,v=_<m.length?m:`${m}*`,S=v.substring(0,_),L=v.substring(_,w),I=v.substring(w);tt("os","build",`$red${b+1} $grey${S}$red${L}$grey${I}`)}return d.message.split(`
`).forEach(_=>{tt("os","build",_)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Zf(i.target),a=e[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}const Rr=jL();var We=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(We||{});const it={defaultplayer:H_(),software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map,chipindex:new Map,codepageindex:new Map,binaryfiles:new Map};function zL(t){console.info("memorysetdefaultplayer",t),it.defaultplayer=t}function Jr(){return it.defaultplayer}function Tc(){return[...it.books.values()]}function WL(){const[t]=it.books.values();return t}function Xr(t){const e=Pe(t);return it.books.get(t)??Tc().find(n=>n.name===e)}function xc(t,e){k(Xr(e))&&(it.software[t]=e)}function Ht(t){return Xr(it.software[t])}function g_(t){const e=gy([]);return Se(t)&&(e.name=t),y_(e),Nt("memory",`created [book] ${e.name}`),e}function GL(t){let e=Xr(t);return k(e)||(e=gy([]),e.name=t),y_(e),Nt("memory",`created [book] ${e.name}`),e}function Un(t,e){let n=k(e)?GL(e):Ht(t);return k(n)||(k(n)||(n=WL()),k(n)||(n=g_(e)),k(n)&&Nt("memory",`opened [book] ${n.name} for ${t}`)),xc(t,n.id),n}function xi(t,e,n){const r=Un(t);let i=vi(r,e);if(k(i))return i;const s=py(n);return i=dy(s==="object"?`@${e}
`:`@${s} ${e}
`,{}),yy(r,i),__(i.id,r.id),jl("memory","",it.defaultplayer),i}function cs(t){const e=Un("main");return ts(e,t)}function HL(t){const e=Un("main");return mf(e,t)}function VL(t,e){it.books.clear(),t.forEach(r=>{it.books.set(r.id,r),r.name==="main"&&(it.software.main=r.id)});const n=Xr(e);if(k(n)&&xc("main",n.id),!it.software.main){const r=it.books.values().next();r.value&&(it.software.main=r.value.id)}}function y_(t){return it.books.set(t.id,t),t.id}function KL(t){const e=Xr(t);e&&it.books.delete(e.id)}function __(t,e){it.codepageindex.set(t,e)}function qL(t){if(!Se(t)||!t)return tt("memory","login",`failed for playerid ==>${t}<==`,t);const e=Ht("main");if(!k(e))return tt("memory","login:main","login failed to find book 'main'",t);const n=uc(e,t);if(k(n))return!0;const r=es(e,"title");if(!k(r))return tt("memory","login:title","login failed to find board 'title'",t);const i=lc(e,"player");if(!k(i))return tt("memory","login:player","login failed to find object type 'player'",t);const s=i.name??"player",o=Ef(r,{x:0,y:0},s,t);return k(o==null?void 0:o.id)?(o.player=t,gf(e,t,r.id),!0):!1}function b_(t){const e=Ht("main"),n=uc(e,t);gf(e,t,""),fo(e,n,rs(n,t)),My(n,t),mf(e,t),mf(e,h_(t))}function JL(t){const e=Ht("main"),n=vy(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Xf(c)&&k(t[c])===!1&&(t[c]=0,gf(e,c,i.id))}}}function XL(t){Rr.message(t)}function w_(t,e,n,r,i=_b){if(!k(t)||!k(e)||!k(n))return;const s={...N},o=n.id??"";N.book=t,N.board=e,N.element=n,N.isplayer=Xf(o),N.player=n.player??it.defaultplayer;const a=vn(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=vf(n);if(Rr.tick(l,po.CODE_PAGE,ke(c)?c:i,u,r),ke(n==null?void 0:n.tickertime)&&N.timestamp-n.tickertime>Oo*5&&(n.tickertime=0,n.tickertext=""),N.isplayer){const f=cs(N.element.id??"");f.inputcurrent=0}pb(s).forEach(f=>{N[f]=s[f]})}function ZL(){const t=Ht("main");if(!k(t))return;const e=t.timestamp+1,n=zi.HALT_AT_COUNT;zi.HALT_AT_COUNT=n*2,it.loaders.forEach((i,s)=>{Rr.tick(s,po.LOADER,1,"loader",i),Rr.isended(s)&&(Rr.halt(s),it.loaders.delete(s))}),zi.HALT_AT_COUNT=n,t.timestamp=e,N.timestamp=e,vy(t).forEach(i=>{const s=JN(t,i,e);for(let o=0;o<s.length;++o){const{id:a,type:c,code:l,object:u}=s[o];c===Re.ERROR?Rr.halt(a):w_(t,i,u,l)}})}function YL(){Rr.gc()}function QL(t,e=""){const n=Un("main");if(!k(n))return;const r=`${t}_cli`;N.timestamp=n.timestamp,N.book=n,N.board=uc(n,t),N.element=rs(N.board,t),N.player=t,N.isplayer=!0,fp("memory","running",n.timestamp,r,e),Rr.once(r,po.CLI,"cli",e)}function Rc(t){const e=Un("main"),n=vi(e,t);if(!k(e)||!k(n)||!k(N.element))return;const r=`${t}_run`,i=vf(N.element),s=(n==null?void 0:n.code)??"";Rr.once(r,po.CODE_PAGE,i,s)}function eM(t,e,n,r){const i=Ht("main");if(!k(i))return;const s=["binaryfile",n];Nt("memory","looking for stats",...s);const o=$N(i,Re.LOADER).filter(a=>{const c=co(a);return Object.keys(c).filter(u=>s.includes(Pe(u))).length===s.length});for(let a=0;a<o.length;++a){const c=o[a],l=`${t}_load_${c.id}`;it.binaryfiles.set(l,{filename:e.name,cursor:0,bytes:r,dataview:new DataView(r.buffer)}),Nt("memory","starting loader",i.timestamp,l),it.loaders.set(l,c.code)}}function v_(t){return it.binaryfiles.get(t)}function E_(t,e){function n(r){if(k(e))switch(r){case"text/plain":PL(e).catch(i=>tt("memory","crash",i.message));break;case"application/zip":DL(e,i=>E_(t,i)).catch(i=>tt("memory","crash",i.message));break;case"application/octet-stream":BL(e,(i,s)=>{eM(t,e,i,s)}).catch(i=>tt("memory","crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=m_(e.name,new Uint8Array(i));if(s)n(s);else return tt("memory","loadfile",`unsupported file ${e.name}`)}).catch(i=>tt("memory","crash",i.message));return}}n((e==null?void 0:e.type)??"")}let k_=0;function tM(){switch(k_++){case 0:return be.BLUE;case 1:return be.GREEN;case 2:return be.CYAN;case 3:return be.RED;case 4:return be.PURPLE;case 5:return be.YELLOW;default:return k_=0,be.WHITE}}function nM(t,e,n,r,i,s){const o=[];let a=e;const c=a===0,l=ze,u=rn,f=c?be.BLACK:be.ONCLEAR,d=_p(t,a++,l,u,f);o.push(d);const h=ak(t,a++,l,u);o.push(h);const p=a++,m=ok(t,p);o.push(m);const b=_p(t,a++,l,u,be.ONCLEAR);o.push(b);const _={...i_(ze,rn,tM(),be.ONCLEAR),...b},w=ck(t,a++);i&&o.push(w),r.terrain.forEach((T,M)=>{if(T){const x=vn(n,T);d.char[M]=T.char??(x==null?void 0:x.char)??0,d.color[M]=T.color??(x==null?void 0:x.color)??f,d.bg[M]=T.bg??(x==null?void 0:x.bg)??f,d.color[M]!==be.ONCLEAR&&(s[M]=d.color[M])}});const v=r.objects??{};Object.values(v).forEach(T=>{if(k(T.removed)||k(T.headless))return;const M=T.id??"",x=_y(n,T),V=sk(t,p,M),oe=T.lx??T.x??0,O=T.ly??T.y??0,E=oe+O*ze;if(V.x=T.x??0,V.y=T.y??0,V.char=T.char??(x==null?void 0:x.char)??1,V.color=T.color??(x==null?void 0:x.color)??be.WHITE,V.bg=T.bg??(x==null?void 0:x.bg)??be.ONBORROW,m.sprites.push(V),V.bg===be.ONSHADOW&&(V.bg=be.ONCLEAR,h.alphas[oe+O*l]=.5),V.bg===be.ONBORROW&&(V.bg=s[E]??be.BLACK),V.color!==be.ONCLEAR&&(s[E]=V.color),Se(T.tickertext)&&ke(T.tickertime)&&T.tickertext.length){const g=ze,C=gL(T.tickertext,g,rn-1),W=(C==null?void 0:C.measuredwidth)??1,B=T.x??0,Z=T.y??0,H=Z<rn*.5;_.x=B-Math.floor(W*.5),_.y=Z+(H?1:-1),_.x+W>ze&&(_.x=ze-W),_.x<0&&(_.x=0),mL(T.tickertext,_)}M===t&&(w.focusx=V.x,w.focusy=V.y,w.focusid=M)});function S(T,M){if(!(T<0||T>=ze||M<0||M>=rn))return h.alphas[T+M*ze]}const L=[[1,1,1,1,1],[1,3,5,3,1],[1,5,12,5,1],[1,3,5,3,1],[1,1,1,1,1]].flat(),I=new Array(h.alphas.length);for(let T=0;T<h.alphas.length;++T){const M=T%ze,x=Math.floor(T/ze),V=[[S(M-2,x-2),S(M-1,x-2),S(M,x-2),S(M+1,x-2),S(M+2,x-2)],[S(M-2,x-1),S(M-1,x-1),S(M,x-1),S(M+1,x-1),S(M+2,x-1)],[S(M-2,x),S(M-1,x),S(M,x),S(M+1,x),S(M+2,x)],[S(M-2,x+1),S(M-1,x+1),S(M,x+1),S(M+1,x+1),S(M+2,x+1)],[S(M-2,x+2),S(M-1,x+2),S(M,x+2),S(M+1,x+2),S(M+2,x+2)]].flat().map((oe,O)=>k(oe)?oe*L[O]:void 0).filter(k);I[T]=ui(Uk(V),0,1)}return h.alphas=I,o}function rM(t){const e=Ht("main"),n=uc(e,t),r=[];if(!k(e)||!k(n))return r;const i=new Array(ze*rn).fill(0),s=es(e,n.over??""),o=es(e,n.under??""),a=[s,n,o].filter(k);let c=0;for(let l=0;l<a.length;++l){const u=a[l],f=nM(t,c,e,u,u===n,i);c+=f.length,r.push(...f)}return r}function iM(t){const e=Ht(We.MAIN),n=ts(e,We.GADGETSTORE);delete n[t]}_k(t=>{const e=Ht(We.MAIN),n=ts(e,We.GADGETSTORE);let r=n[t];return k(r)||(n[t]=r=zl()),r});const S_=us("gadgetserver",["tock"],t=>{const e=Ht(We.MAIN),n=(e==null?void 0:e.activelist)??[],r=ts(e,We.GADGETSYNC);switch(t.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=li(s);o.layers=rM(s);const a=r[s]??{},c=nh(a,o);c.length&&(r[s]=hs(o),BE(S_.name(),c,s))}break;case"desync":t.player&&DE(S_.name(),li(t.player),t.player);break;case"clearscroll":t.player&&bk(t.player);break;case"clearplayer":t.player&&iM(t.player);break}});function jf(t,e){function n(r){console.error(r),tt(t,"crash",r.message)}e().catch(n)}function sM(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function oM(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const aM=new Date("1980/09/02");async function cM(t){return new Promise((e,n)=>{const r=new Bf;for(let i=0;i<t.length;++i){const s=t[i],o=BN(s);if(o){const a=CN(o);k(a)&&r.file(s.id,a,{date:aM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(oM(i))}).catch(n)})}async function lM(t){return new Promise((e,n)=>{const r=new Bf;r.loadAsync(sM(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=FN(LN(c));k(l)&&i.push(l)}e(i)}).catch(n)})}const uM=16,Ri={},fM=64;let A_=0;const Ir={},ls={};async function zf(t=""){YL();const e=Tc(),n=Ht(We.MAIN);if(e.length&&k(n)){const r=await cM(e),i=`${t}${new Date().toISOString()}${n.name} ${r.length} chars`;zE(Pn.name(),i,r,Jr())}}let T_=!1;const Pn=us("vm",["init","tick","second"],t=>{var e;switch(t.target){case"init":k(t.player)&&!T_&&(T_=!0,t.player,zL(t.player),Pn.reply(t,"ackinit",!0,t.player));break;case"books":t.player===Jr()&&jf("vm:books",async()=>{if(He(t.data)){const[n,r]=t.data,i=await lM(n),s=i.map(o=>o.name);VL(i,r),et(Pn.name(),`loading ${s.join(", ")}`),Pn.reply(t,"ackbooks",!0,t.player)}});break;case"login":t.player&&qL(t.player)&&(Ri[t.player]=0,et(Pn.name(),`login from ${t.player}`),Pn.reply(t,"acklogin",!0,t.player));break;case"endgame":t.player===Jr()&&jf("vm:endgame",async()=>{t.player&&(b_(t.player),FE("vm",t.player),await zf(),HE("vm",t.player))});break;case"doot":t.player&&(Ri[t.player]=0,fp(Pn.name(),"active",t.player));break;case"input":if(t.player){const n=cs(t.player),[r=Ft.NONE,i=0]=t.data??[Ft.NONE,0];He(n.inputqueue)||(n.inputqueue=[]),r!==Ft.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(t.player&&He(t.data)){const[n,r]=t.data;if(!k(ls[r])){const i=hp(n,r);ls[r]=gp(i,s=>{const o=Xr(n),a=vi(o,r);k(a)&&(a.code=s,DN(a))})}Ir[n]=Ir[n]??{},Ir[n][r]=Ir[n][r]??new Set,Ir[n][r].add(t.player)}break;case"coderelease":if(t.player&&He(t.data)){const[n,r]=t.data;k(Ir[n])&&k(Ir[n][r])&&(Ir[n][r].delete(t.player),Ir[n][r].size===0&&((e=ls[r])==null||e.call(ls),ls[r]=void 0))}break;case"tick":t.player!=="locked"&&ZL();break;case"second":{JL(Ri);const n=Object.keys(Ri);for(let r=0;r<n.length;++r)++Ri[n[r]];for(let r=0;r<n.length;++r){const i=n[r];Ri[i]>=uM&&(delete Ri[i],b_(i),Nt(Pn.name(),"player logout",i),Pn.emit("logout",void 0,i))}bb()===!1&&++A_>=fM&&(A_=0,jl(Pn.name(),"",Jr()));break}case"flush":t.player===Jr()&&jf("vm:flush",async()=>{Se(t.data)?await zf(`${t.data} `):await zf()});break;case"cli":t.player===Jr()&&QL(t.player,t.data);break;case"loadfile":t.player===Jr()&&E_(t.player,t.data);break;default:XL(t);break}});function hM(){jE(Pn.name(),Jr())}const{forward:dM}=yb(t=>postMessage(t));onmessage=function(e){dM(e.data)},setTimeout(hM,100)})();

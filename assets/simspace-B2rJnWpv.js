var _D=Object.defineProperty;var yD=(_i,Gn,Cn)=>Gn in _i?_D(_i,Gn,{enumerable:!0,configurable:!0,writable:!0,value:Cn}):_i[Gn]=Cn;var Lt=(_i,Gn,Cn)=>yD(_i,typeof Gn!="symbol"?Gn+"":Gn,Cn);(function(){"use strict";const _i=new Set,Gn={emit(t,e,n,r,i){Gn.invoke(bk(t,e,n,r,i))},invoke(t){_i.forEach(e=>e.handle(t))},connect(t){_i.add(t)},disconnect(t){_i.delete(t)}};var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function io(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Bx(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var wp={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Cn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(wp);var Dx=wp.exports,Ep=io(Dx),xp={};(function(t){var e=Cn&&Cn.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,p;d<h;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,w=l.addAdverb,b=w===void 0?!1:w,T=e(e(e([],e([],Array(m),!0).map(function(A){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),b?[n(t.adverbs)]:[],!0);return h&&(T=T.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),T.join(f)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return t.adjectives.length*f*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*f+f*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(h?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*f+f*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(h?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(xp);var kp=io(xp);const $x="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let jx=t=>crypto.getRandomValues(new Uint8Array(t)),zx=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Tp=(t,e=21)=>zx(t,e,jx),Wx=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=$x[n[t]&63];return e};var vp="abcdefghijklmnopqrstuvwxyz",Ap="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Sp="0123456789",Hx="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Kx="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const Gx=Sp,Yx=vp,Vx=Ap;var Zx=Gx+Yx+Vx,dh={lowercase:vp,uppercase:Ap,numbers:Sp,nolookalikes:Hx,nolookalikesSafe:Kx,alphanumeric:Zx};function Me(){return`sid_${Wx(12).replaceAll("-",".")}`}Tp(dh.numbers,4),Tp(`${dh.numbers}${dh.lowercase}`,16);function vr(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function Xx(){return kp({capitalize:!1,adjectiveCount:1})}function qx(){return kp({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Jx=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qx=Object.prototype.hasOwnProperty;function ph(t,e){return Qx.call(t,e)}function mh(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)ph(t,i)&&r.push(i);return r}function Ln(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function gh(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function ws(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Rp(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function _h(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(_h(t[e]))return!0}else if(typeof t=="object"){for(var r=mh(t),i=r.length,s=0;s<i;s++)if(_h(t[r[s]]))return!0}}return!1}function Ip(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Np=function(t){Jx(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,Ip(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Ip(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),Ue=Np,tk=Ln,so={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=$c(n,this.path);r&&(r=Ln(r));var i=Es(n,{op:"remove",path:this.from}).removed;return Es(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=$c(n,this.from);return Es(n,{op:"add",path:this.path,value:Ln(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:ya(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},ek={add:function(t,e,n){return gh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:so.move,copy:so.copy,test:so.test,_get:so._get};function $c(t,e){if(e=="")return t;var n={op:"_get",path:e};return Es(t,n),n.value}function Es(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):jc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=$c(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=ya(t,e.value),o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new Ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Ln(t));var a=e.path||"",c=a.split("/"),l=t,u=1,f=c.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=jc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Rp(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!gh(h))throw new Ue("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);gh(h)&&(h=~~h)}if(u>=f){if(n&&e.op==="add"&&h>l.length)throw new Ue("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=ek[e.op].call(e,l,h,t);if(o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=f){var o=so[e.op].call(e,l,h,t);if(o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Ue("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function yh(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new Ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Ln(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Es(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function nk(t,e,n){var r=Es(t,e);if(r.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function jc(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Ue("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(so[t.op]){if(typeof t.path!="string")throw new Ue("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Ue('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Ue("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&_h(t.value))throw new Ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Ue("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Ue("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Op([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ue("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new Ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Op(t,e,n){try{if(!Array.isArray(t))throw new Ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)yh(Ln(e),Ln(t),n||!0);else{n=n||jc;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof Ue)return i;throw i}}function ya(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!ya(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ya(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var rk=Object.freeze({__proto__:null,JsonPatchError:Ue,_areEquals:ya,applyOperation:Es,applyPatch:yh,applyReducer:nk,deepClone:tk,getValueByPointer:$c,validate:Op,validator:jc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var bh=new WeakMap,ik=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),sk=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function ok(t){return bh.get(t)}function ak(t,e){return t.observers.get(e)}function ck(t,e){t.observers.delete(e.callback)}function lk(t,e){e.unobserve()}function uk(t,e){var n=[],r,i=ok(t);if(!i)i=new ik(t),bh.set(t,i);else{var s=ak(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Ln(t),e){r.callback=e,r.next=null;var o=function(){wh(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){wh(r),clearTimeout(r.next),ck(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new sk(e,r)),r}function wh(t,e){e===void 0&&(e=!1);var n=bh.get(t.object);Eh(n.value,t.object,t.patches,"",e),t.patches.length&&yh(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function Eh(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=mh(e),o=mh(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(ph(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?Eh(u,f,n,r+"/"+ws(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+ws(l),value:Ln(u)}),n.push({op:"replace",path:r+"/"+ws(l),value:Ln(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+ws(l),value:Ln(u)}),n.push({op:"remove",path:r+"/"+ws(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!ph(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+ws(l),value:Ln(e[l])})}}}function Cp(t,e,n){n===void 0&&(n=!1);var r=[];return Eh(t,e,r,"",n),r}var hk=Object.freeze({__proto__:null,compare:Cp,generate:wh,observe:uk,unobserve:lk});Object.assign({},rk,hk,{JsonPatchError:Np,deepClone:Ln,escapePathComponent:ws,unescapePathComponent:Rp});var fk=typeof Element<"u",dk=typeof Map=="function",pk=typeof Set=="function",mk=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function zc(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!zc(t[r],e[r]))return!1;return!0}var s;if(dk&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!zc(r.value[1],e.get(r.value[0])))return!1;return!0}if(pk&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(mk&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(fk&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!zc(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var gk=function(e,n){try{return zc(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},_k=io(gk);function x(t){return t!=null}const jr=Object.keys;function Yn(t){return Ln(t)}function yk(t){return typeof t=="boolean"}function St(t){return typeof t=="number"&&isNaN(t)===!1}function Et(t){return typeof t=="string"}function le(t){return Array.isArray(t)}function xh(t){return t}var jt=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(jt||{}),Kt=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Kt||{}),or=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(or||{}),pt=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.PLAYER=18]="PLAYER",t[t.FIND=19]="FIND",t[t.FLEE=20]="FLEE",t[t.TO=21]="TO",t[t.MID=22]="MID",t[t.OVER=23]="OVER",t[t.UNDER=24]="UNDER",t))(pt||{}),xt=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.LINK=11]="LINK",t[t.HOTKEY=12]="HOTKEY",t[t.COPYIT=13]="COPYIT",t[t.OPENIT=14]="OPENIT",t[t.ZSSEDIT=15]="ZSSEDIT",t[t.CHAREDIT=16]="CHAREDIT",t[t.COLOREDIT=17]="COLOREDIT",t))(xt||{});function Nt(t){return(t==null?void 0:t.toLowerCase().trim())??""}function bk(t,e,n,r,i){return{session:t,player:e,id:Me(),sender:n,target:r,data:i}}function Ar(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function oo(t,e=[],n=xh,r=""){const i=Me(),s=Nt(t),o=e.map(Nt);let a=r;const c={id(){return i},name(){return t},session(l){return x(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,f){Gn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Ar(l.target),d=Nt(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&x(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Gn.connect(c),c}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const wk=4,Lp=0,Mp=1,Ek=2;function ao(t){let e=t.length;for(;--e>=0;)t[e]=0}const xk=0,Up=1,kk=2,Tk=3,vk=258,kh=29,ba=256,wa=ba+1+kh,co=30,Th=19,Fp=2*wa+1,xs=15,vh=16,Ak=7,Ah=256,Pp=16,Bp=17,Dp=18,Sh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Wc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Sk=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),$p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rk=512,yi=new Array((wa+2)*2);ao(yi);const Ea=new Array(co*2);ao(Ea);const xa=new Array(Rk);ao(xa);const ka=new Array(vk-Tk+1);ao(ka);const Rh=new Array(kh);ao(Rh);const Hc=new Array(co);ao(Hc);function Ih(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let jp,zp,Wp;function Nh(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const Hp=t=>t<256?xa[t]:xa[256+(t>>>7)],Ta=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Mn=(t,e,n)=>{t.bi_valid>vh-n?(t.bi_buf|=e<<t.bi_valid&65535,Ta(t,t.bi_buf),t.bi_buf=e>>vh-t.bi_valid,t.bi_valid+=n-vh):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},zr=(t,e,n)=>{Mn(t,n[e*2],n[e*2+1])},Kp=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Ik=t=>{t.bi_valid===16?(Ta(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Nk=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,f,d,h,p,m=0;for(d=0;d<=xs;d++)t.bl_count[d]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Fp;l++)u=t.heap[l],d=n[n[u*2+1]*2+1]+1,d>c&&(d=c,m++),n[u*2+1]=d,!(u>r)&&(t.bl_count[d]++,h=0,u>=a&&(h=o[u-a]),p=n[u*2],t.opt_len+=p*(d+h),s&&(t.static_len+=p*(i[u*2+1]+h)));if(m!==0){do{for(d=c-1;t.bl_count[d]===0;)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,m-=2}while(m>0);for(d=c;d!==0;d--)for(u=t.bl_count[d];u!==0;)f=t.heap[--l],!(f>r)&&(n[f*2+1]!==d&&(t.opt_len+=(d-n[f*2+1])*n[f*2],n[f*2+1]=d),u--)}},Gp=(t,e,n)=>{const r=new Array(xs+1);let i=0,s,o;for(s=1;s<=xs;s++)i=i+n[s-1]<<1,r[s]=i;for(o=0;o<=e;o++){let a=t[o*2+1];a!==0&&(t[o*2]=Kp(r[a]++,a))}},Ok=()=>{let t,e,n,r,i;const s=new Array(xs+1);for(n=0,r=0;r<kh-1;r++)for(Rh[r]=n,t=0;t<1<<Sh[r];t++)ka[n++]=r;for(ka[n-1]=r,i=0,r=0;r<16;r++)for(Hc[r]=i,t=0;t<1<<Wc[r];t++)xa[i++]=r;for(i>>=7;r<co;r++)for(Hc[r]=i<<7,t=0;t<1<<Wc[r]-7;t++)xa[256+i++]=r;for(e=0;e<=xs;e++)s[e]=0;for(t=0;t<=143;)yi[t*2+1]=8,t++,s[8]++;for(;t<=255;)yi[t*2+1]=9,t++,s[9]++;for(;t<=279;)yi[t*2+1]=7,t++,s[7]++;for(;t<=287;)yi[t*2+1]=8,t++,s[8]++;for(Gp(yi,wa+1,s),t=0;t<co;t++)Ea[t*2+1]=5,Ea[t*2]=Kp(t,5);jp=new Ih(yi,Sh,ba+1,wa,xs),zp=new Ih(Ea,Wc,0,co,xs),Wp=new Ih(new Array(0),Sk,0,Th,Ak)},Yp=t=>{let e;for(e=0;e<wa;e++)t.dyn_ltree[e*2]=0;for(e=0;e<co;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Th;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Ah*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Vp=t=>{t.bi_valid>8?Ta(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Zp=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},Oh=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Zp(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Zp(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},Xp=(t,e,n)=>{let r,i,s=0,o,a;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+s++]&255,r+=(t.pending_buf[t.sym_buf+s++]&255)<<8,i=t.pending_buf[t.sym_buf+s++],r===0?zr(t,i,e):(o=ka[i],zr(t,o+ba+1,e),a=Sh[o],a!==0&&(i-=Rh[o],Mn(t,i,a)),r--,o=Hp(r),zr(t,o,n),a=Wc[o],a!==0&&(r-=Hc[o],Mn(t,r,a)));while(s<t.sym_next);zr(t,Ah,e)},Ch=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c=-1,l;for(t.heap_len=0,t.heap_max=Fp,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)Oh(t,n,o);l=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Oh(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[l*2]=n[o*2]+n[a*2],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=l,t.heap[1]=l++,Oh(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Nk(t,e),Gp(n,c,t.bl_count)},qp=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)&&(a<l?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[Pp*2]++):a<=10?t.bl_tree[Bp*2]++:t.bl_tree[Dp*2]++,a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},Jp=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)){if(a<l)do zr(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(zr(t,s,t.bl_tree),a--),zr(t,Pp,t.bl_tree),Mn(t,a-3,2)):a<=10?(zr(t,Bp,t.bl_tree),Mn(t,a-3,3)):(zr(t,Dp,t.bl_tree),Mn(t,a-11,7));a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},Ck=t=>{let e;for(qp(t,t.dyn_ltree,t.l_desc.max_code),qp(t,t.dyn_dtree,t.d_desc.max_code),Ch(t,t.bl_desc),e=Th-1;e>=3&&t.bl_tree[$p[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Lk=(t,e,n,r)=>{let i;for(Mn(t,e-257,5),Mn(t,n-1,5),Mn(t,r-4,4),i=0;i<r;i++)Mn(t,t.bl_tree[$p[i]*2+1],3);Jp(t,t.dyn_ltree,e-1),Jp(t,t.dyn_dtree,n-1)},Mk=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return Lp;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Mp;for(n=32;n<ba;n++)if(t.dyn_ltree[n*2]!==0)return Mp;return Lp};let Qp=!1;const Uk=t=>{Qp||(Ok(),Qp=!0),t.l_desc=new Nh(t.dyn_ltree,jp),t.d_desc=new Nh(t.dyn_dtree,zp),t.bl_desc=new Nh(t.bl_tree,Wp),t.bi_buf=0,t.bi_valid=0,Yp(t)},tm=(t,e,n,r)=>{Mn(t,(xk<<1)+(r?1:0),3),Vp(t),Ta(t,n),Ta(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},Fk=t=>{Mn(t,Up<<1,3),zr(t,Ah,yi),Ik(t)},Pk=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===Ek&&(t.strm.data_type=Mk(t)),Ch(t,t.l_desc),Ch(t,t.d_desc),o=Ck(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?tm(t,e,n,r):t.strategy===wk||s===i?(Mn(t,(Up<<1)+(r?1:0),3),Xp(t,yi,Ea)):(Mn(t,(kk<<1)+(r?1:0),3),Lk(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Xp(t,t.dyn_ltree,t.dyn_dtree)),Yp(t),r&&Vp(t)},Bk=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(ka[n]+ba+1)*2]++,t.dyn_dtree[Hp(e)*2]++),t.sym_next===t.sym_end);var Dk=Uk,$k=tm,jk=Pk,zk=Bk,Wk=Fk,Hk={_tr_init:Dk,_tr_stored_block:$k,_tr_flush_block:jk,_tr_tally:zk,_tr_align:Wk},va=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const Kk=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},Gk=new Uint32Array(Kk());var sn=(t,e,n,r)=>{const i=Gk,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1},ks={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ts={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Yk,_tr_stored_block:Lh,_tr_flush_block:Vk,_tr_tally:Gi,_tr_align:Zk}=Hk,{Z_NO_FLUSH:Yi,Z_PARTIAL_FLUSH:Xk,Z_FULL_FLUSH:qk,Z_FINISH:ar,Z_BLOCK:em,Z_OK:hn,Z_STREAM_END:nm,Z_STREAM_ERROR:Wr,Z_DATA_ERROR:Jk,Z_BUF_ERROR:Mh,Z_DEFAULT_COMPRESSION:Qk,Z_FILTERED:tT,Z_HUFFMAN_ONLY:Kc,Z_RLE:eT,Z_FIXED:nT,Z_DEFAULT_STRATEGY:rT,Z_UNKNOWN:iT,Z_DEFLATED:Gc}=Ts,sT=9,oT=15,aT=8,Uh=256+1+29,cT=30,lT=19,uT=2*Uh+1,hT=15,Xt=3,Vi=258,Hr=Vi+Xt+1,fT=32,lo=42,Fh=57,Ph=69,Bh=73,Dh=91,$h=103,vs=113,Aa=666,kn=1,uo=2,As=3,ho=4,dT=3,Ss=(t,e)=>(t.msg=ks[e],e),rm=t=>t*2-(t>4?9:0),Zi=t=>{let e=t.length;for(;--e>=0;)t[e]=0},pT=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let Xi=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Vn=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Zn=(t,e)=>{Vk(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Vn(t.strm)},oe=(t,e)=>{t.pending_buf[t.pending++]=e},Sa=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},jh=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=va(t.adler,e,i,n):t.state.wrap===2&&(t.adler=sn(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},im=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-Hr?t.strstart-(t.w_size-Hr):0,l=t.window,u=t.w_mask,f=t.prev,d=t.strstart+Vi;let h=l[r+o-1],p=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(l[i+o]!==p||l[i+o-1]!==h||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<d);if(s=Vi-(d-r),r=d-Vi,s>o){if(t.match_start=e,o=s,s>=a)break;h=l[r+o-1],p=l[r+o]}}while((e=f[e&u])>c&&--n!==0);return o<=t.lookahead?o:t.lookahead},fo=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Hr)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),pT(t),r+=e),t.strm.avail_in===0)break;if(n=jh(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=Xt)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Xi(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Xi(t,t.ins_h,t.window[i+Xt-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<Xt)););}while(t.lookahead<Hr&&t.strm.avail_in!==0)},sm=(t,e)=>{let n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,s,o=0,a=t.strm.avail_in;do{if(r=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>s&&(r=s),r<n&&(r===0&&e!==ar||e===Yi||r!==i+t.strm.avail_in)))break;o=e===ar&&r===i+t.strm.avail_in?1:0,Lh(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,Vn(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(jh(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?ho:e!==Yi&&e!==ar&&t.strm.avail_in===0&&t.strstart===t.block_start?uo:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(jh(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,n=s>t.w_size?t.w_size:s,i=t.strstart-t.block_start,(i>=n||(i||e===ar)&&e!==Yi&&t.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,o=e===ar&&t.strm.avail_in===0&&r===i?1:0,Lh(t,t.block_start,r,o),t.block_start+=r,Vn(t.strm)),o?As:kn)},zh=(t,e)=>{let n,r;for(;;){if(t.lookahead<Hr){if(fo(t),t.lookahead<Hr&&e===Yi)return kn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Xt&&(t.ins_h=Xi(t,t.ins_h,t.window[t.strstart+Xt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Hr&&(t.match_length=im(t,n)),t.match_length>=Xt)if(r=Gi(t,t.strstart-t.match_start,t.match_length-Xt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Xt){t.match_length--;do t.strstart++,t.ins_h=Xi(t,t.ins_h,t.window[t.strstart+Xt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Xi(t,t.ins_h,t.window[t.strstart+1]);else r=Gi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Zn(t,!1),t.strm.avail_out===0))return kn}return t.insert=t.strstart<Xt-1?t.strstart:Xt-1,e===ar?(Zn(t,!0),t.strm.avail_out===0?As:ho):t.sym_next&&(Zn(t,!1),t.strm.avail_out===0)?kn:uo},po=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Hr){if(fo(t),t.lookahead<Hr&&e===Yi)return kn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Xt&&(t.ins_h=Xi(t,t.ins_h,t.window[t.strstart+Xt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Xt-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Hr&&(t.match_length=im(t,n),t.match_length<=5&&(t.strategy===tT||t.match_length===Xt&&t.strstart-t.match_start>4096)&&(t.match_length=Xt-1)),t.prev_length>=Xt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Xt,r=Gi(t,t.strstart-1-t.prev_match,t.prev_length-Xt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Xi(t,t.ins_h,t.window[t.strstart+Xt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Xt-1,t.strstart++,r&&(Zn(t,!1),t.strm.avail_out===0))return kn}else if(t.match_available){if(r=Gi(t,0,t.window[t.strstart-1]),r&&Zn(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return kn}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Gi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Xt-1?t.strstart:Xt-1,e===ar?(Zn(t,!0),t.strm.avail_out===0?As:ho):t.sym_next&&(Zn(t,!1),t.strm.avail_out===0)?kn:uo},mT=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=Vi){if(fo(t),t.lookahead<=Vi&&e===Yi)return kn;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Xt&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Vi;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Vi-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Xt?(n=Gi(t,1,t.match_length-Xt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Gi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Zn(t,!1),t.strm.avail_out===0))return kn}return t.insert=0,e===ar?(Zn(t,!0),t.strm.avail_out===0?As:ho):t.sym_next&&(Zn(t,!1),t.strm.avail_out===0)?kn:uo},gT=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(fo(t),t.lookahead===0)){if(e===Yi)return kn;break}if(t.match_length=0,n=Gi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Zn(t,!1),t.strm.avail_out===0))return kn}return t.insert=0,e===ar?(Zn(t,!0),t.strm.avail_out===0?As:ho):t.sym_next&&(Zn(t,!1),t.strm.avail_out===0)?kn:uo};function Kr(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const Ra=[new Kr(0,0,0,0,sm),new Kr(4,4,8,4,zh),new Kr(4,5,16,8,zh),new Kr(4,6,32,32,zh),new Kr(4,4,16,16,po),new Kr(8,16,32,32,po),new Kr(8,16,128,128,po),new Kr(8,32,128,256,po),new Kr(32,128,258,1024,po),new Kr(32,258,258,4096,po)],_T=t=>{t.window_size=2*t.w_size,Zi(t.head),t.max_lazy_match=Ra[t.level].max_lazy,t.good_match=Ra[t.level].good_length,t.nice_match=Ra[t.level].nice_length,t.max_chain_length=Ra[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Xt-1,t.match_available=0,t.ins_h=0};function yT(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(uT*2),this.dyn_dtree=new Uint16Array((2*cT+1)*2),this.bl_tree=new Uint16Array((2*lT+1)*2),Zi(this.dyn_ltree),Zi(this.dyn_dtree),Zi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(hT+1),this.heap=new Uint16Array(2*Uh+1),Zi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Uh+1),Zi(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ia=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==lo&&e.status!==Fh&&e.status!==Ph&&e.status!==Bh&&e.status!==Dh&&e.status!==$h&&e.status!==vs&&e.status!==Aa?1:0},om=t=>{if(Ia(t))return Ss(t,Wr);t.total_in=t.total_out=0,t.data_type=iT;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Fh:e.wrap?lo:vs,t.adler=e.wrap===2?0:1,e.last_flush=-2,Yk(e),hn},am=t=>{const e=om(t);return e===hn&&_T(t.state),e},bT=(t,e)=>Ia(t)||t.state.wrap!==2?Wr:(t.state.gzhead=e,hn),cm=(t,e,n,r,i,s)=>{if(!t)return Wr;let o=1;if(e===Qk&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>sT||n!==Gc||r<8||r>15||e<0||e>9||s<0||s>nT||r===8&&o!==1)return Ss(t,Wr);r===8&&(r=9);const a=new yT;return t.state=a,a.strm=t,a.status=lo,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Xt-1)/Xt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=n,am(t)},wT=(t,e)=>cm(t,e,Gc,oT,aT,rT),ET=(t,e)=>{if(Ia(t)||e>em||e<0)return t?Ss(t,Wr):Wr;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Aa&&e!==ar)return Ss(t,t.avail_out===0?Mh:Wr);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(Vn(t),t.avail_out===0)return n.last_flush=-1,hn}else if(t.avail_in===0&&rm(e)<=rm(r)&&e!==ar)return Ss(t,Mh);if(n.status===Aa&&t.avail_in!==0)return Ss(t,Mh);if(n.status===lo&&n.wrap===0&&(n.status=vs),n.status===lo){let i=Gc+(n.w_bits-8<<4)<<8,s=-1;if(n.strategy>=Kc||n.level<2?s=0:n.level<6?s=1:n.level===6?s=2:s=3,i|=s<<6,n.strstart!==0&&(i|=fT),i+=31-i%31,Sa(n,i),n.strstart!==0&&(Sa(n,t.adler>>>16),Sa(n,t.adler&65535)),t.adler=1,n.status=vs,Vn(t),n.pending!==0)return n.last_flush=-1,hn}if(n.status===Fh){if(t.adler=0,oe(n,31),oe(n,139),oe(n,8),n.gzhead)oe(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),oe(n,n.gzhead.time&255),oe(n,n.gzhead.time>>8&255),oe(n,n.gzhead.time>>16&255),oe(n,n.gzhead.time>>24&255),oe(n,n.level===9?2:n.strategy>=Kc||n.level<2?4:0),oe(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(oe(n,n.gzhead.extra.length&255),oe(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=sn(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Ph;else if(oe(n,0),oe(n,0),oe(n,0),oe(n,0),oe(n,0),oe(n,n.level===9?2:n.strategy>=Kc||n.level<2?4:0),oe(n,dT),n.status=vs,Vn(t),n.pending!==0)return n.last_flush=-1,hn}if(n.status===Ph){if(n.gzhead.extra){let i=n.pending,s=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,Vn(t),n.pending!==0)return n.last_flush=-1,hn;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=Bh}if(n.status===Bh){if(n.gzhead.name){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),Vn(t),n.pending!==0)return n.last_flush=-1,hn;i=0}n.gzindex<n.gzhead.name.length?s=n.gzhead.name.charCodeAt(n.gzindex++)&255:s=0,oe(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=Dh}if(n.status===Dh){if(n.gzhead.comment){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i)),Vn(t),n.pending!==0)return n.last_flush=-1,hn;i=0}n.gzindex<n.gzhead.comment.length?s=n.gzhead.comment.charCodeAt(n.gzindex++)&255:s=0,oe(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=sn(t.adler,n.pending_buf,n.pending-i,i))}n.status=$h}if(n.status===$h){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Vn(t),n.pending!==0))return n.last_flush=-1,hn;oe(n,t.adler&255),oe(n,t.adler>>8&255),t.adler=0}if(n.status=vs,Vn(t),n.pending!==0)return n.last_flush=-1,hn}if(t.avail_in!==0||n.lookahead!==0||e!==Yi&&n.status!==Aa){let i=n.level===0?sm(n,e):n.strategy===Kc?gT(n,e):n.strategy===eT?mT(n,e):Ra[n.level].func(n,e);if((i===As||i===ho)&&(n.status=Aa),i===kn||i===As)return t.avail_out===0&&(n.last_flush=-1),hn;if(i===uo&&(e===Xk?Zk(n):e!==em&&(Lh(n,0,0,!1),e===qk&&(Zi(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Vn(t),t.avail_out===0))return n.last_flush=-1,hn}return e!==ar?hn:n.wrap<=0?nm:(n.wrap===2?(oe(n,t.adler&255),oe(n,t.adler>>8&255),oe(n,t.adler>>16&255),oe(n,t.adler>>24&255),oe(n,t.total_in&255),oe(n,t.total_in>>8&255),oe(n,t.total_in>>16&255),oe(n,t.total_in>>24&255)):(Sa(n,t.adler>>>16),Sa(n,t.adler&65535)),Vn(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?hn:nm)},xT=t=>{if(Ia(t))return Wr;const e=t.state.status;return t.state=null,e===vs?Ss(t,Jk):hn},kT=(t,e)=>{let n=e.length;if(Ia(t))return Wr;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==lo||r.lookahead)return Wr;if(i===1&&(t.adler=va(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Zi(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,fo(r);r.lookahead>=Xt;){let c=r.strstart,l=r.lookahead-(Xt-1);do r.ins_h=Xi(r,r.ins_h,r.window[c+Xt-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=Xt-1,fo(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Xt-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,hn};var TT=wT,vT=cm,AT=am,ST=om,RT=bT,IT=ET,NT=xT,OT=kT,CT="pako deflate (from Nodeca project)",Na={deflateInit:TT,deflateInit2:vT,deflateReset:AT,deflateResetKeep:ST,deflateSetHeader:RT,deflate:IT,deflateEnd:NT,deflateSetDictionary:OT,deflateInfo:CT};const LT=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var MT=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)LT(n,r)&&(t[r]=n[r])}}return t},UT=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n},Yc={assign:MT,flattenChunks:UT};let lm=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{lm=!1}const Oa=new Uint8Array(256);for(let t=0;t<256;t++)Oa[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Oa[254]=Oa[254]=1;var FT=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const PT=(t,e)=>{if(e<65534&&t.subarray&&lm)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var BT=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=Oa[o];if(a>4){s[i++]=65533,r+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|t[r++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return PT(s,i)},DT=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+Oa[t[n]]>e?n:e},Ca={string2buf:FT,buf2string:BT,utf8border:DT};function $T(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var um=$T;const hm=Object.prototype.toString,{Z_NO_FLUSH:jT,Z_SYNC_FLUSH:zT,Z_FULL_FLUSH:WT,Z_FINISH:HT,Z_OK:Vc,Z_STREAM_END:KT,Z_DEFAULT_COMPRESSION:GT,Z_DEFAULT_STRATEGY:YT,Z_DEFLATED:VT}=Ts;function La(t){this.options=Yc.assign({level:GT,method:VT,chunkSize:16384,windowBits:15,memLevel:8,strategy:YT},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new um,this.strm.avail_out=0;let n=Na.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Vc)throw new Error(ks[n]);if(e.header&&Na.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=Ca.string2buf(e.dictionary):hm.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=Na.deflateSetDictionary(this.strm,r),n!==Vc)throw new Error(ks[n]);this._dict_set=!0}}La.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?HT:jT,typeof t=="string"?n.input=Ca.string2buf(t):hm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===zT||s===WT)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=Na.deflate(n,s),i===KT)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Na.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Vc;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0},La.prototype.onData=function(t){this.chunks.push(t)},La.prototype.onEnd=function(t){t===Vc&&(this.result=Yc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Wh(t,e){const n=new La(e);if(n.push(t,!0),n.err)throw n.msg||ks[n.err];return n.result}function ZT(t,e){return e=e||{},e.raw=!0,Wh(t,e)}function XT(t,e){return e=e||{},e.gzip=!0,Wh(t,e)}var qT=La,JT=Wh,QT=ZT,tv=XT,ev=Ts,nv={Deflate:qT,deflate:JT,deflateRaw:QT,gzip:tv,constants:ev};const Zc=16209,rv=16191;var iv=function(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,w,b,T,A,v,C,S,R,U,O,D;const V=e.state;r=e.next_in,O=e.input,i=r+(e.avail_in-5),s=e.next_out,D=e.output,o=s-(n-e.avail_out),a=s+(e.avail_out-257),c=V.dmax,l=V.wsize,u=V.whave,f=V.wnext,d=V.window,h=V.hold,p=V.bits,m=V.lencode,w=V.distcode,b=(1<<V.lenbits)-1,T=(1<<V.distbits)-1;t:do{p<15&&(h+=O[r++]<<p,p+=8,h+=O[r++]<<p,p+=8),A=m[h&b];e:for(;;){if(v=A>>>24,h>>>=v,p-=v,v=A>>>16&255,v===0)D[s++]=A&65535;else if(v&16){C=A&65535,v&=15,v&&(p<v&&(h+=O[r++]<<p,p+=8),C+=h&(1<<v)-1,h>>>=v,p-=v),p<15&&(h+=O[r++]<<p,p+=8,h+=O[r++]<<p,p+=8),A=w[h&T];n:for(;;){if(v=A>>>24,h>>>=v,p-=v,v=A>>>16&255,v&16){if(S=A&65535,v&=15,p<v&&(h+=O[r++]<<p,p+=8,p<v&&(h+=O[r++]<<p,p+=8)),S+=h&(1<<v)-1,S>c){e.msg="invalid distance too far back",V.mode=Zc;break t}if(h>>>=v,p-=v,v=s-o,S>v){if(v=S-v,v>u&&V.sane){e.msg="invalid distance too far back",V.mode=Zc;break t}if(R=0,U=d,f===0){if(R+=l-v,v<C){C-=v;do D[s++]=d[R++];while(--v);R=s-S,U=D}}else if(f<v){if(R+=l+f-v,v-=f,v<C){C-=v;do D[s++]=d[R++];while(--v);if(R=0,f<C){v=f,C-=v;do D[s++]=d[R++];while(--v);R=s-S,U=D}}}else if(R+=f-v,v<C){C-=v;do D[s++]=d[R++];while(--v);R=s-S,U=D}for(;C>2;)D[s++]=U[R++],D[s++]=U[R++],D[s++]=U[R++],C-=3;C&&(D[s++]=U[R++],C>1&&(D[s++]=U[R++]))}else{R=s-S;do D[s++]=D[R++],D[s++]=D[R++],D[s++]=D[R++],C-=3;while(C>2);C&&(D[s++]=D[R++],C>1&&(D[s++]=D[R++]))}}else if(v&64){e.msg="invalid distance code",V.mode=Zc;break t}else{A=w[(A&65535)+(h&(1<<v)-1)];continue n}break}}else if(v&64)if(v&32){V.mode=rv;break t}else{e.msg="invalid literal/length code",V.mode=Zc;break t}else{A=m[(A&65535)+(h&(1<<v)-1)];continue e}break}}while(r<i&&s<a);C=p>>3,r-=C,p-=C<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<a?257+(a-s):257-(s-a),V.hold=h,V.bits=p};const mo=15,fm=852,dm=592,pm=0,Hh=1,mm=2,sv=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ov=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),av=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),cv=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ma=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l=0,u=0,f=0,d=0,h=0,p=0,m=0,w=0,b=0,T=0,A,v,C,S,R,U=null,O;const D=new Uint16Array(mo+1),V=new Uint16Array(mo+1);let L=null,N,E,B;for(l=0;l<=mo;l++)D[l]=0;for(u=0;u<r;u++)D[e[n+u]]++;for(h=c,d=mo;d>=1&&D[d]===0;d--);if(h>d&&(h=d),d===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(f=1;f<d&&D[f]===0;f++);for(h<f&&(h=f),w=1,l=1;l<=mo;l++)if(w<<=1,w-=D[l],w<0)return-1;if(w>0&&(t===pm||d!==1))return-1;for(V[1]=0,l=1;l<mo;l++)V[l+1]=V[l]+D[l];for(u=0;u<r;u++)e[n+u]!==0&&(o[V[e[n+u]]++]=u);if(t===pm?(U=L=o,O=20):t===Hh?(U=sv,L=ov,O=257):(U=av,L=cv,O=0),T=0,u=0,l=f,R=s,p=h,m=0,C=-1,b=1<<h,S=b-1,t===Hh&&b>fm||t===mm&&b>dm)return 1;for(;;){N=l-m,o[u]+1<O?(E=0,B=o[u]):o[u]>=O?(E=L[o[u]-O],B=U[o[u]-O]):(E=96,B=0),A=1<<l-m,v=1<<p,f=v;do v-=A,i[R+(T>>m)+v]=N<<24|E<<16|B|0;while(v!==0);for(A=1<<l-1;T&A;)A>>=1;if(A!==0?(T&=A-1,T+=A):T=0,u++,--D[l]===0){if(l===d)break;l=e[n+o[u]]}if(l>h&&(T&S)!==C){for(m===0&&(m=h),R+=f,p=l-m,w=1<<p;p+m<d&&(w-=D[p+m],!(w<=0));)p++,w<<=1;if(b+=1<<p,t===Hh&&b>fm||t===mm&&b>dm)return 1;C=T&S,i[C]=h<<24|p<<16|R-s|0}}return T!==0&&(i[R+T]=l-m<<24|64<<16|0),a.bits=h,0};const lv=0,gm=1,_m=2,{Z_FINISH:ym,Z_BLOCK:uv,Z_TREES:Xc,Z_OK:Rs,Z_STREAM_END:hv,Z_NEED_DICT:fv,Z_STREAM_ERROR:cr,Z_DATA_ERROR:bm,Z_MEM_ERROR:wm,Z_BUF_ERROR:dv,Z_DEFLATED:Em}=Ts,qc=16180,xm=16181,km=16182,Tm=16183,vm=16184,Am=16185,Sm=16186,Rm=16187,Im=16188,Nm=16189,Jc=16190,bi=16191,Kh=16192,Om=16193,Gh=16194,Cm=16195,Lm=16196,Mm=16197,Um=16198,Qc=16199,tl=16200,Fm=16201,Pm=16202,Bm=16203,Dm=16204,$m=16205,Yh=16206,jm=16207,zm=16208,Te=16209,Wm=16210,Hm=16211,pv=852,mv=592,gv=15,Km=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function _v(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Is=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<qc||e.mode>Hm?1:0},Gm=t=>{if(Is(t))return cr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=qc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(pv),e.distcode=e.distdyn=new Int32Array(mv),e.sane=1,e.back=-1,Rs},Ym=t=>{if(Is(t))return cr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Gm(t)},Vm=(t,e)=>{let n;if(Is(t))return cr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?cr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Ym(t))},Zm=(t,e)=>{if(!t)return cr;const n=new _v;t.state=n,n.strm=t,n.window=null,n.mode=qc;const r=Vm(t,e);return r!==Rs&&(t.state=null),r},yv=t=>Zm(t,gv);let Xm=!0,Vh,Zh;const bv=t=>{if(Xm){Vh=new Int32Array(512),Zh=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Ma(gm,t.lens,0,288,Vh,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Ma(_m,t.lens,0,32,Zh,0,t.work,{bits:5}),Xm=!1}t.lencode=Vh,t.lenbits=9,t.distcode=Zh,t.distbits=5},qm=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},wv=(t,e)=>{let n,r,i,s,o,a,c,l,u,f,d,h,p,m,w=0,b,T,A,v,C,S,R,U;const O=new Uint8Array(4);let D,V;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Is(t)||!t.output||!t.input&&t.avail_in!==0)return cr;n=t.state,n.mode===bi&&(n.mode=Kh),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,f=a,d=c,U=Rs;t:for(;;)switch(n.mode){case qc:if(n.wrap===0){n.mode=Kh;break}for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,O[0]=l&255,O[1]=l>>>8&255,n.check=sn(n.check,O,2,0),l=0,u=0,n.mode=xm;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=Te;break}if((l&15)!==Em){t.msg="unknown compression method",n.mode=Te;break}if(l>>>=4,u-=4,R=(l&15)+8,n.wbits===0&&(n.wbits=R),R>15||R>n.wbits){t.msg="invalid window size",n.mode=Te;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=l&512?Nm:bi,l=0,u=0;break;case xm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==Em){t.msg="unknown compression method",n.mode=Te;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=Te;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(O[0]=l&255,O[1]=l>>>8&255,n.check=sn(n.check,O,2,0)),l=0,u=0,n.mode=km;case km:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(O[0]=l&255,O[1]=l>>>8&255,O[2]=l>>>16&255,O[3]=l>>>24&255,n.check=sn(n.check,O,4,0)),l=0,u=0,n.mode=Tm;case Tm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(O[0]=l&255,O[1]=l>>>8&255,n.check=sn(n.check,O,2,0)),l=0,u=0,n.mode=vm;case vm:if(n.flags&1024){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(O[0]=l&255,O[1]=l>>>8&255,n.check=sn(n.check,O,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=Am;case Am:if(n.flags&1024&&(h=n.length,h>a&&(h=a),h&&(n.head&&(R=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+h),R)),n.flags&512&&n.wrap&4&&(n.check=sn(n.check,r,h,s)),a-=h,s+=h,n.length-=h),n.length))break t;n.length=0,n.mode=Sm;case Sm:if(n.flags&2048){if(a===0)break t;h=0;do R=r[s+h++],n.head&&R&&n.length<65536&&(n.head.name+=String.fromCharCode(R));while(R&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=sn(n.check,r,h,s)),a-=h,s+=h,R)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=Rm;case Rm:if(n.flags&4096){if(a===0)break t;h=0;do R=r[s+h++],n.head&&R&&n.length<65536&&(n.head.comment+=String.fromCharCode(R));while(R&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=sn(n.check,r,h,s)),a-=h,s+=h,R)break t}else n.head&&(n.head.comment=null);n.mode=Im;case Im:if(n.flags&512){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=Te;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=bi;break;case Nm:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=Km(l),l=0,u=0,n.mode=Jc;case Jc:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,fv;t.adler=n.check=1,n.mode=bi;case bi:if(e===uv||e===Xc)break t;case Kh:if(n.last){l>>>=u&7,u-=u&7,n.mode=Yh;break}for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}switch(n.last=l&1,l>>>=1,u-=1,l&3){case 0:n.mode=Om;break;case 1:if(bv(n),n.mode=Qc,e===Xc){l>>>=2,u-=2;break t}break;case 2:n.mode=Lm;break;case 3:t.msg="invalid block type",n.mode=Te}l>>>=2,u-=2;break;case Om:for(l>>>=u&7,u-=u&7;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Te;break}if(n.length=l&65535,l=0,u=0,n.mode=Gh,e===Xc)break t;case Gh:n.mode=Cm;case Cm:if(h=n.length,h){if(h>a&&(h=a),h>c&&(h=c),h===0)break t;i.set(r.subarray(s,s+h),o),a-=h,s+=h,c-=h,o+=h,n.length-=h;break}n.mode=bi;break;case Lm:for(;u<14;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Te;break}n.have=0,n.mode=Mm;case Mm:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.lens[L[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,D={bits:n.lenbits},U=Ma(lv,n.lens,0,19,n.lencode,0,n.work,D),n.lenbits=D.bits,U){t.msg="invalid code lengths set",n.mode=Te;break}n.have=0,n.mode=Um;case Um:for(;n.have<n.nlen+n.ndist;){for(;w=n.lencode[l&(1<<n.lenbits)-1],b=w>>>24,T=w>>>16&255,A=w&65535,!(b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(A<16)l>>>=b,u-=b,n.lens[n.have++]=A;else{if(A===16){for(V=b+2;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(l>>>=b,u-=b,n.have===0){t.msg="invalid bit length repeat",n.mode=Te;break}R=n.lens[n.have-1],h=3+(l&3),l>>>=2,u-=2}else if(A===17){for(V=b+3;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=b,u-=b,R=0,h=3+(l&7),l>>>=3,u-=3}else{for(V=b+7;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=b,u-=b,R=0,h=11+(l&127),l>>>=7,u-=7}if(n.have+h>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Te;break}for(;h--;)n.lens[n.have++]=R}}if(n.mode===Te)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Te;break}if(n.lenbits=9,D={bits:n.lenbits},U=Ma(gm,n.lens,0,n.nlen,n.lencode,0,n.work,D),n.lenbits=D.bits,U){t.msg="invalid literal/lengths set",n.mode=Te;break}if(n.distbits=6,n.distcode=n.distdyn,D={bits:n.distbits},U=Ma(_m,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D),n.distbits=D.bits,U){t.msg="invalid distances set",n.mode=Te;break}if(n.mode=Qc,e===Xc)break t;case Qc:n.mode=tl;case tl:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,iv(t,d),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===bi&&(n.back=-1);break}for(n.back=0;w=n.lencode[l&(1<<n.lenbits)-1],b=w>>>24,T=w>>>16&255,A=w&65535,!(b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(T&&!(T&240)){for(v=b,C=T,S=A;w=n.lencode[S+((l&(1<<v+C)-1)>>v)],b=w>>>24,T=w>>>16&255,A=w&65535,!(v+b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=v,u-=v,n.back+=v}if(l>>>=b,u-=b,n.back+=b,n.length=A,T===0){n.mode=$m;break}if(T&32){n.back=-1,n.mode=bi;break}if(T&64){t.msg="invalid literal/length code",n.mode=Te;break}n.extra=T&15,n.mode=Fm;case Fm:if(n.extra){for(V=n.extra;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=Pm;case Pm:for(;w=n.distcode[l&(1<<n.distbits)-1],b=w>>>24,T=w>>>16&255,A=w&65535,!(b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(!(T&240)){for(v=b,C=T,S=A;w=n.distcode[S+((l&(1<<v+C)-1)>>v)],b=w>>>24,T=w>>>16&255,A=w&65535,!(v+b<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=v,u-=v,n.back+=v}if(l>>>=b,u-=b,n.back+=b,T&64){t.msg="invalid distance code",n.mode=Te;break}n.offset=A,n.extra=T&15,n.mode=Bm;case Bm:if(n.extra){for(V=n.extra;u<V;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Te;break}n.mode=Dm;case Dm:if(c===0)break t;if(h=d-c,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Te;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=i,p=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do i[o++]=m[p++];while(--h);n.length===0&&(n.mode=tl);break;case $m:if(c===0)break t;i[o++]=n.length,c--,n.mode=tl;break;case Yh:if(n.wrap){for(;u<32;){if(a===0)break t;a--,l|=r[s++]<<u,u+=8}if(d-=c,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?sn(n.check,i,d,o-d):va(n.check,i,d,o-d)),d=c,n.wrap&4&&(n.flags?l:Km(l))!==n.check){t.msg="incorrect data check",n.mode=Te;break}l=0,u=0}n.mode=jm;case jm:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=Te;break}l=0,u=0}n.mode=zm;case zm:U=hv;break t;case Te:U=bm;break t;case Wm:return wm;case Hm:default:return cr}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<Te&&(n.mode<Yh||e!==ym))&&qm(t,t.output,t.next_out,d-t.avail_out),f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?sn(n.check,i,d,t.next_out-d):va(n.check,i,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===bi?128:0)+(n.mode===Qc||n.mode===Gh?256:0),(f===0&&d===0||e===ym)&&U===Rs&&(U=dv),U},Ev=t=>{if(Is(t))return cr;let e=t.state;return e.window&&(e.window=null),t.state=null,Rs},xv=(t,e)=>{if(Is(t))return cr;const n=t.state;return n.wrap&2?(n.head=e,e.done=!1,Rs):cr},kv=(t,e)=>{const n=e.length;let r,i,s;return Is(t)||(r=t.state,r.wrap!==0&&r.mode!==Jc)?cr:r.mode===Jc&&(i=1,i=va(i,e,n,0),i!==r.check)?bm:(s=qm(t,e,n,n),s?(r.mode=Wm,wm):(r.havedict=1,Rs))};var Tv=Ym,vv=Vm,Av=Gm,Sv=yv,Rv=Zm,Iv=wv,Nv=Ev,Ov=xv,Cv=kv,Lv="pako inflate (from Nodeca project)",wi={inflateReset:Tv,inflateReset2:vv,inflateResetKeep:Av,inflateInit:Sv,inflateInit2:Rv,inflate:Iv,inflateEnd:Nv,inflateGetHeader:Ov,inflateSetDictionary:Cv,inflateInfo:Lv};function Mv(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Uv=Mv;const Jm=Object.prototype.toString,{Z_NO_FLUSH:Fv,Z_FINISH:Pv,Z_OK:Ua,Z_STREAM_END:Xh,Z_NEED_DICT:qh,Z_STREAM_ERROR:Bv,Z_DATA_ERROR:Qm,Z_MEM_ERROR:Dv}=Ts;function Fa(t){this.options=Yc.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new um,this.strm.avail_out=0;let n=wi.inflateInit2(this.strm,e.windowBits);if(n!==Ua)throw new Error(ks[n]);if(this.header=new Uv,wi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ca.string2buf(e.dictionary):Jm.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=wi.inflateSetDictionary(this.strm,e.dictionary),n!==Ua)))throw new Error(ks[n])}Fa.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?Pv:Fv,Jm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=wi.inflate(n,o),s===qh&&i&&(s=wi.inflateSetDictionary(n,i),s===Ua?s=wi.inflate(n,o):s===Qm&&(s=qh));n.avail_in>0&&s===Xh&&n.state.wrap>0&&t[n.next_in]!==0;)wi.inflateReset(n),s=wi.inflate(n,o);switch(s){case Bv:case Qm:case qh:case Dv:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===Xh))if(this.options.to==="string"){let c=Ca.utf8border(n.output,n.next_out),l=n.next_out-c,u=Ca.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===Ua&&a===0)){if(s===Xh)return s=wi.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Fa.prototype.onData=function(t){this.chunks.push(t)},Fa.prototype.onEnd=function(t){t===Ua&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Yc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Jh(t,e){const n=new Fa(e);if(n.push(t),n.err)throw n.msg||ks[n.err];return n.result}function $v(t,e){return e=e||{},e.raw=!0,Jh(t,e)}var jv=Fa,zv=Jh,Wv=$v,Hv=Jh,Kv=Ts,Gv={Inflate:jv,inflate:zv,inflateRaw:Wv,ungzip:Hv,constants:Kv};const{Deflate:Yv,deflate:Vv,deflateRaw:Zv,gzip:Xv}=nv,{Inflate:qv,inflate:Jv,inflateRaw:Qv,ungzip:tA}=Gv;var eA=Yv,nA=Vv,rA=Zv,iA=Xv,sA=qv,oA=Jv,aA=Qv,cA=tA,lA=Ts,uA={Deflate:eA,deflate:nA,deflateRaw:rA,gzip:iA,Inflate:sA,inflate:oA,inflateRaw:aA,ungzip:cA,constants:lA};function tg(t){let e=t.r.toString(16),n=t.g.toString(16),r=t.b.toString(16);return e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),e+n+r}const hA=t=>new Promise((e,n)=>{try{const r=uA.inflate(t),i=fA(r);e(i)}catch(r){n(r)}}),fA=t=>{const e=new DataView(t.buffer),n={version:e.getUint32(0,!0),layers:[]},r=e.getUint32(4,!0);let i=8;for(let s=0;s<r;s++){const o={width:0,height:0,raster:[]};o.width=e.getUint32(i,!0),i+=4,o.height=e.getUint32(i,!0),i+=4,o.raster=Array(o.height*o.width);for(let a=0;a<o.width;a++)for(let c=0;c<o.height;c++){const l={asciiCode:e.getUint32(i,!0),transparent:!1,color:{r:0,g:0,b:0,hex:""},bg:{r:0,g:0,b:0,hex:""}};i+=4,l.color.r=e.getUint8(i++),l.color.g=e.getUint8(i++),l.color.b=e.getUint8(i++),l.color.hex=tg(l.color),l.bg.r=e.getUint8(i++),l.bg.g=e.getUint8(i++),l.bg.b=e.getUint8(i++),l.bg.hex=tg(l.bg),l.transparent=l.bg.r===255&&l.bg.g===0&&l.bg.b===255,o.raster[a+o.width*c]=l}n.layers.push(o)}return n};function dA(t){return typeof t=="object"&&Et(t.session)&&Et(t.player)&&Et(t.id)&&Et(t.sender)&&Et(t.target)}function de(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function Ei(t,e,...n){return t.emit(e,"info",n),!0}function eg(t,e,...n){return t.emit(e,"debug",n),!0}function pA(t,e,n){t.emit(e,"toast",n)}function mA(t,e,n){t.emit(e,"bridge:streamstart",n)}function gA(t,e){t.emit(e,"bridge:streamstop",void 0)}function _A(t,e,n){t.emit(e,"bridge:chatstart",n)}function yA(t,e){t.emit(e,"bridge:chatstop")}function bA(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function wA(t,e){t.emit(e,"bridge:talkstart",e)}function EA(t,e){t.emit(e,"bridge:talkstop",e)}function xA(t,e){t.emit(e,"bridge:mediastart",e)}function kA(t,e){t.emit(e,"bridge:mediastop",e)}function TA(t,e,n){t.emit(e,"bridge:start",n)}function vA(t,e,n){t.emit(e,"bridge:tab",n)}function AA(t,e,n){t.emit(e,"gadgetclient:paint",n)}function SA(t,e,n){t.emit(e,"gadgetclient:patch",n)}function RA(t,e){t.emit(e,"gadgetserver:clearscroll")}function IA(t){t.emit("","ready")}function NA(t,e){t.emit(e,"register:loginfail")}function Qh(t,e){t.emit(e,"register:loginready",!0)}function OA(t,e,n,r){t.emit(e,"register:savemem",[n,r])}function CA(t,e,n){t.emit(e,"register:forkmem",[n])}function tf(t,e,n){t.emit(e,"register:copy",n)}function LA(t,e,n,r){t.emit(e,"register:copyjsonfile",[n,r])}function ng(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function MA(t,e){t.emit(e,"register:dev",void 0)}function UA(t,e){t.emit(e,"register:share",void 0)}function FA(t,e){t.emit(e,"register:nuke",void 0)}function PA(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function BA(t,e,n){t.emit(e,"synth:tta",[n])}function DA(t,e,n,r,i){t.emit(e,"synth:play",[n,r,i])}function $A(t,e,n){t.emit(e,"synth:focus",n)}function jA(t,e,n){t.emit(e,"synth:bpm",n)}function zA(t,e,n){t.emit(e,"synth:playvolume",n)}function WA(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function HA(t,e,n){t.emit(e,"synth:ttsvolume",n)}function ef(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function rg(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function KA(t,e){t.emit(e,"register:inspector")}function ig(t,e,n,r,i,s,o){t.emit(e,"register:editor:open",[n,r,i,s,o])}function GA(t,e){t.emit(e,"register:editor:close")}function sg(t,e){t.emit(e,"vm:logout")}function el(t,e){const[n,r]=e;return`${t}:${[n,r].filter(x).join(":")}`}function YA(t,e,n){t.emit(e,"vm:cli",n)}function VA(t,e){t.emit(e,"vm:restart")}function og(t,e){t.emit(e,"vm:flush")}function ZA(t,e){t.emit(e,"vm:fork")}function XA(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function qA(t,e){return{filename:t,json:e}}function JA(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function QA(t,e){const n={filename:t,cursor:0,content:void 0};return hA(e).then(r=>{n.content=r}).catch(()=>{}),n}function nl(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=XA(i,s);break;case"json":o=qA(i,s);break;case"binary":o=JA(i,s);break;case"rexpaint":o=QA(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}function tS(t){const e=new Set;function n(s){dA(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Gn.invoke(s))}const r=oo("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Gn.disconnect(r)}return{forward:n,disconnect:i}}function eS(t){switch(t.target){case"info":case"debug":case"error":case"tick":case"tock":case"ready":case"second":return!0;default:{const e=Ar(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const nf=66.666,rl=Math.round(1e3/nf),nS=3;function ag(t){return new Promise(e=>setTimeout(e,t))}const rf=oo("clock");let sf=0,il=0,of=0,cg=performance.now();function lg(){const t=performance.now(),e=t-cg;of+=e,of>=nf&&(of%=nf,rf.emit("","tick",il),rf.emit("","tock",il),++sf,++il,sf>=rl&&(sf%=rl,rf.emit("","second",il))),cg=t,setTimeout(lg,2)}lg();function rS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ug={exports:{}},De=ug.exports={},Gr,Yr;function af(){throw new Error("setTimeout has not been defined")}function cf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Gr=setTimeout:Gr=af}catch{Gr=af}try{typeof clearTimeout=="function"?Yr=clearTimeout:Yr=cf}catch{Yr=cf}})();function hg(t){if(Gr===setTimeout)return setTimeout(t,0);if((Gr===af||!Gr)&&setTimeout)return Gr=setTimeout,setTimeout(t,0);try{return Gr(t,0)}catch{try{return Gr.call(null,t,0)}catch{return Gr.call(this,t,0)}}}function iS(t){if(Yr===clearTimeout)return clearTimeout(t);if((Yr===cf||!Yr)&&clearTimeout)return Yr=clearTimeout,clearTimeout(t);try{return Yr(t)}catch{try{return Yr.call(null,t)}catch{return Yr.call(this,t)}}}var xi=[],go=!1,Ns,sl=-1;function sS(){!go||!Ns||(go=!1,Ns.length?xi=Ns.concat(xi):sl=-1,xi.length&&fg())}function fg(){if(!go){var t=hg(sS);go=!0;for(var e=xi.length;e;){for(Ns=xi,xi=[];++sl<e;)Ns&&Ns[sl].run();sl=-1,e=xi.length}Ns=null,go=!1,iS(t)}}De.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];xi.push(new dg(t,e)),xi.length===1&&!go&&hg(fg)};function dg(t,e){this.fun=t,this.array=e}dg.prototype.run=function(){this.fun.apply(null,this.array)},De.title="browser",De.browser=!0,De.env={},De.argv=[],De.version="",De.versions={};function ki(){}De.on=ki,De.addListener=ki,De.once=ki,De.off=ki,De.removeListener=ki,De.removeAllListeners=ki,De.emit=ki,De.prependListener=ki,De.prependOnceListener=ki,De.listeners=function(t){return[]},De.binding=function(t){throw new Error("process.binding is not supported")},De.cwd=function(){return"/"},De.chdir=function(t){throw new Error("process.chdir is not supported")},De.umask=function(){return 0};var oS=ug.exports;const Sr=rS(oS);var Ht={},lf=Symbol.for("react.transitional.element"),aS=Symbol.for("react.portal"),cS=Symbol.for("react.fragment"),lS=Symbol.for("react.strict_mode"),uS=Symbol.for("react.profiler"),hS=Symbol.for("react.consumer"),fS=Symbol.for("react.context"),dS=Symbol.for("react.forward_ref"),pS=Symbol.for("react.suspense"),mS=Symbol.for("react.memo"),pg=Symbol.for("react.lazy"),mg=Symbol.iterator;function gS(t){return t===null||typeof t!="object"?null:(t=mg&&t[mg]||t["@@iterator"],typeof t=="function"?t:null)}var gg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_g=Object.assign,yg={};function _o(t,e,n){this.props=t,this.context=e,this.refs=yg,this.updater=n||gg}_o.prototype.isReactComponent={},_o.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},_o.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function bg(){}bg.prototype=_o.prototype;function uf(t,e,n){this.props=t,this.context=e,this.refs=yg,this.updater=n||gg}var hf=uf.prototype=new bg;hf.constructor=uf,_g(hf,_o.prototype),hf.isPureReactComponent=!0;var wg=Array.isArray,ve={H:null,A:null,T:null,S:null,V:null},Eg=Object.prototype.hasOwnProperty;function ff(t,e,n,r,i,s){return n=s.ref,{$$typeof:lf,type:t,key:e,ref:n!==void 0?n:null,props:s}}function _S(t,e){return ff(t.type,e,void 0,void 0,void 0,t.props)}function df(t){return typeof t=="object"&&t!==null&&t.$$typeof===lf}function yS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var xg=/\/+/g;function pf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?yS(""+t.key):e.toString(36)}function kg(){}function bS(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(kg,kg):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function yo(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case lf:case aS:o=!0;break;case pg:return o=t._init,yo(o(t._payload),e,n,r,i)}}if(o)return i=i(t),o=r===""?"."+pf(t,0):r,wg(i)?(n="",o!=null&&(n=o.replace(xg,"$&/")+"/"),yo(i,e,n,"",function(l){return l})):i!=null&&(df(i)&&(i=_S(i,n+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(xg,"$&/")+"/")+o)),e.push(i)),1;o=0;var a=r===""?".":r+":";if(wg(t))for(var c=0;c<t.length;c++)r=t[c],s=a+pf(r,c),o+=yo(r,e,n,s,i);else if(c=gS(t),typeof c=="function")for(t=c.call(t),c=0;!(r=t.next()).done;)r=r.value,s=a+pf(r,c++),o+=yo(r,e,n,s,i);else if(s==="object"){if(typeof t.then=="function")return yo(bS(t),e,n,r,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function ol(t,e,n){if(t==null)return t;var r=[],i=0;return yo(t,r,"","",function(s){return e.call(n,s,i++)}),r}function wS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Tg=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof Sr=="object"&&typeof Sr.emit=="function"){Sr.emit("uncaughtException",t);return}console.error(t)};function ES(){}Ht.Children={map:ol,forEach:function(t,e,n){ol(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ol(t,function(){e++}),e},toArray:function(t){return ol(t,function(e){return e})||[]},only:function(t){if(!df(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},Ht.Component=_o,Ht.Fragment=cS,Ht.Profiler=uS,Ht.PureComponent=uf,Ht.StrictMode=lS,Ht.Suspense=pS,Ht.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ve,Ht.__COMPILER_RUNTIME={__proto__:null,c:function(t){return ve.H.useMemoCache(t)}},Ht.cache=function(t){return function(){return t.apply(null,arguments)}},Ht.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=_g({},t.props),i=t.key,s=void 0;if(e!=null)for(o in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(i=""+e.key),e)!Eg.call(e,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&e.ref===void 0||(r[o]=e[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return ff(t.type,i,void 0,void 0,s,r)},Ht.createContext=function(t){return t={$$typeof:fS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:hS,_context:t},t},Ht.createElement=function(t,e,n){var r,i={},s=null;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)Eg.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return ff(t,s,void 0,void 0,null,i)},Ht.createRef=function(){return{current:null}},Ht.forwardRef=function(t){return{$$typeof:dS,render:t}},Ht.isValidElement=df,Ht.lazy=function(t){return{$$typeof:pg,_payload:{_status:-1,_result:t},_init:wS}},Ht.memo=function(t,e){return{$$typeof:mS,type:t,compare:e===void 0?null:e}},Ht.startTransition=function(t){var e=ve.T,n={};ve.T=n;try{var r=t(),i=ve.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(ES,Tg)}catch(s){Tg(s)}finally{ve.T=e}},Ht.unstable_useCacheRefresh=function(){return ve.H.useCacheRefresh()},Ht.use=function(t){return ve.H.use(t)},Ht.useActionState=function(t,e,n){return ve.H.useActionState(t,e,n)},Ht.useCallback=function(t,e){return ve.H.useCallback(t,e)},Ht.useContext=function(t){return ve.H.useContext(t)},Ht.useDebugValue=function(){},Ht.useDeferredValue=function(t,e){return ve.H.useDeferredValue(t,e)},Ht.useEffect=function(t,e,n){var r=ve.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)},Ht.useId=function(){return ve.H.useId()},Ht.useImperativeHandle=function(t,e,n){return ve.H.useImperativeHandle(t,e,n)},Ht.useInsertionEffect=function(t,e){return ve.H.useInsertionEffect(t,e)},Ht.useLayoutEffect=function(t,e){return ve.H.useLayoutEffect(t,e)},Ht.useMemo=function(t,e){return ve.H.useMemo(t,e)},Ht.useOptimistic=function(t,e){return ve.H.useOptimistic(t,e)},Ht.useReducer=function(t,e,n){return ve.H.useReducer(t,e,n)},Ht.useRef=function(t){return ve.H.useRef(t)},Ht.useState=function(t){return ve.H.useState(t)},Ht.useSyncExternalStore=function(t,e,n){return ve.H.useSyncExternalStore(t,e,n)},Ht.useTransition=function(){return ve.H.useTransition()},Ht.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const vg="0123456789abcdef",Ag=[],al=[];for(let t=0;t<256;t++)Ag[t]=vg[t>>4&15]+vg[t&15],t<16&&(t<10?al[48+t]=t:al[87+t]=t);const Sg=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=Ag[t[r++]];return n},cl=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=al[t.charCodeAt(s++)]<<4|al[t.charCodeAt(s++)];return r};for(var Rg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",xS=typeof Uint8Array>"u"?[]:new Uint8Array(256),ll=0;ll<Rg.length;ll++)xS[Rg.charCodeAt(ll)]=ll;new TextDecoder,new TextEncoder;const Ig=typeof window<"u"?window:self,Ng=Ig.crypto||Ig.msCrypto||{};Ng.subtle||Ng.webkitSubtle;const bo=globalThis||void 0||self,Rr=()=>new Map,mf=t=>{const e=Rr();return t.forEach((n,r)=>{e.set(r,n)}),e},qi=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},kS=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},TS=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},wo=()=>new Set,gf=t=>t[t.length-1],vS=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Os=Array.from,AS=Array.isArray;class SS{constructor(){this._observers=Rr()}on(e,n){return qi(this._observers,e,wo).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Os((this._observers.get(e)||Rr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Rr()}}const Ji=Math.floor,ul=Math.abs,Og=(t,e)=>t<e?t:e,Cs=(t,e)=>t>e?t:e,Cg=t=>t!==0?t<0:1/t<0,Lg=1,Mg=2,_f=4,yf=8,Pa=32,Ti=64,Xn=128,hl=31,bf=63,Ls=127,RS=2147483647,Ug=Number.MAX_SAFE_INTEGER,IS=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Ji(t)===t),NS=t=>t.toLowerCase(),OS=/^\s*/g,CS=t=>t.replace(OS,""),LS=/([A-Z])/g,Fg=(t,e)=>CS(t.replace(LS,n=>`${e}${NS(n)}`)),MS=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},Ba=typeof TextEncoder<"u"?new TextEncoder:null,US=Ba?t=>Ba.encode(t):MS;let Da=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Da&&Da.decode(new Uint8Array).length===1&&(Da=null);class $a{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const fl=()=>new $a,FS=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Vr=t=>{const e=new Uint8Array(FS(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},PS=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Cs(n,e)*2),t.cpos=0)},on=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},wf=on,ie=(t,e)=>{for(;e>Ls;)on(t,Xn|Ls&e),e=Ji(e/128);on(t,Ls&e)},Ef=(t,e)=>{const n=Cg(e);for(n&&(e=-e),on(t,(e>bf?Xn:0)|(n?Ti:0)|bf&e),e=Ji(e/64);e>0;)on(t,(e>Ls?Xn:0)|Ls&e),e=Ji(e/128)},xf=new Uint8Array(3e4),BS=xf.length/3,DS=(t,e)=>{if(e.length<BS){const n=Ba.encodeInto(e,xf).written||0;ie(t,n);for(let r=0;r<n;r++)on(t,xf[r])}else qn(t,US(e))},$S=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ie(t,r);for(let i=0;i<r;i++)on(t,n.codePointAt(i))},Eo=Ba&&Ba.encodeInto?DS:$S,dl=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Og(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Cs(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},qn=(t,e)=>{ie(t,e.byteLength),dl(t,e)},kf=(t,e)=>{PS(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},jS=(t,e)=>kf(t,4).setFloat32(0,e,!1),zS=(t,e)=>kf(t,8).setFloat64(0,e,!1),WS=(t,e)=>kf(t,8).setBigInt64(0,e,!1),Pg=new DataView(new ArrayBuffer(4)),HS=t=>(Pg.setFloat32(0,t),Pg.getFloat32(0)===t),ja=(t,e)=>{switch(typeof e){case"string":on(t,119),Eo(t,e);break;case"number":IS(e)&&ul(e)<=RS?(on(t,125),Ef(t,e)):HS(e)?(on(t,124),jS(t,e)):(on(t,123),zS(t,e));break;case"bigint":on(t,122),WS(t,e);break;case"object":if(e===null)on(t,126);else if(AS(e)){on(t,117),ie(t,e.length);for(let n=0;n<e.length;n++)ja(t,e[n])}else if(e instanceof Uint8Array)on(t,116),qn(t,e);else{on(t,118);const n=Object.keys(e);ie(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Eo(t,i),ja(t,e[i])}}break;case"boolean":on(t,e?120:121);break;default:on(t,127)}};class Bg extends $a{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ie(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Dg=t=>{t.count>0&&(Ef(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ie(t.encoder,t.count-2))};class pl{constructor(){this.encoder=new $a,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Dg(this),this.count=1,this.s=e)}toUint8Array(){return Dg(this),Vr(this.encoder)}}const $g=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Ef(t.encoder,e),t.count>1&&ie(t.encoder,t.count-2)}};class Tf{constructor(){this.encoder=new $a,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):($g(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return $g(this),Vr(this.encoder)}}class KS{constructor(){this.sarr=[],this.s="",this.lensE=new pl}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new $a;return this.sarr.push(this.s),this.s="",Eo(e,this.sarr.join("")),dl(e,this.lensE.toUint8Array()),Vr(e)}}const Qi=t=>new Error(t),Zr=()=>{throw Qi("Method unimplemented")},Xr=()=>{throw Qi("Unexpected case")},jg=Qi("Unexpected end of array"),zg=Qi("Integer out of Range");class ml{constructor(e){this.arr=e,this.pos=0}}const xo=t=>new ml(t),GS=t=>t.pos!==t.arr.length,YS=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Jn=t=>YS(t,Gt(t)),ko=t=>t.arr[t.pos++],Gt=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&Ls)*n,n*=128,i<Xn)return e;if(e>Ug)throw zg}throw jg},vf=t=>{let e=t.arr[t.pos++],n=e&bf,r=64;const i=(e&Ti)>0?-1:1;if(!(e&Xn))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&Ls)*r,r*=128,e<Xn)return i*n;if(n>Ug)throw zg}throw jg},To=Da?t=>Da.decode(Jn(t)):t=>{let e=Gt(t);if(e===0)return"";{let n=String.fromCodePoint(ko(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(ko(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Af=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},VS=[t=>{},t=>null,vf,t=>Af(t,4).getFloat32(0,!1),t=>Af(t,8).getFloat64(0,!1),t=>Af(t,8).getBigInt64(0,!1),t=>!1,t=>!0,To,t=>{const e=Gt(t),n={};for(let r=0;r<e;r++){const i=To(t);n[i]=za(t)}return n},t=>{const e=Gt(t),n=[];for(let r=0;r<e;r++)n.push(za(t));return n},Jn],za=t=>VS[127-ko(t)](t);class Wg extends ml{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),GS(this)?this.count=Gt(this)+1:this.count=-1),this.count--,this.s}}class gl extends ml{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=vf(this);const e=Cg(this.s);this.count=1,e&&(this.s=-this.s,this.count=Gt(this)+2)}return this.count--,this.s}}class Sf extends ml{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=vf(this),n=e&1;this.diff=Ji(e/2),this.count=1,n&&(this.count=Gt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class ZS{constructor(e){this.decoder=new gl(e),this.str=To(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const XS=crypto.getRandomValues.bind(crypto),Hg=()=>XS(new Uint32Array(1))[0],qS="10000000-1000-4000-8000"+-1e11,JS=()=>qS.replace(/[018]/g,t=>(t^Hg()&15>>t/4).toString(16)),Kg=t=>new Promise(t);Promise.all.bind(Promise);var Gg={},_l={};_l.byteLength=eR,_l.toByteArray=rR,_l.fromByteArray=oR;for(var qr=[],lr=[],QS=typeof Uint8Array<"u"?Uint8Array:Array,Rf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vo=0,tR=Rf.length;vo<tR;++vo)qr[vo]=Rf[vo],lr[Rf.charCodeAt(vo)]=vo;lr[45]=62,lr[95]=63;function Yg(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function eR(t){var e=Yg(t),n=e[0],r=e[1];return(n+r)*3/4-r}function nR(t,e,n){return(e+n)*3/4-n}function rR(t){var e,n=Yg(t),r=n[0],i=n[1],s=new QS(nR(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=lr[t.charCodeAt(c)]<<18|lr[t.charCodeAt(c+1)]<<12|lr[t.charCodeAt(c+2)]<<6|lr[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=lr[t.charCodeAt(c)]<<2|lr[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=lr[t.charCodeAt(c)]<<10|lr[t.charCodeAt(c+1)]<<4|lr[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function iR(t){return qr[t>>18&63]+qr[t>>12&63]+qr[t>>6&63]+qr[t&63]}function sR(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(iR(r));return i.join("")}function oR(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(sR(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(qr[e>>2]+qr[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(qr[e>>10]+qr[e>>4&63]+qr[e<<2&63]+"=")),i.join("")}var If={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */If.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=t[e+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},If.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=d/c:e+=d*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=a&255,h+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+h]=o&255,h+=p,o/=256,l-=8);t[n+h-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=_l,n=If,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=C,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const I=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(I,g),I.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(I){if(I>i)throw new RangeError('The value "'+I+'" is invalid for option "size"');const g=new s(I);return Object.setPrototypeOf(g,u.prototype),g}function u(I,g,y){if(typeof I=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(I)}return f(I,g,y)}u.poolSize=8192;function f(I,g,y){if(typeof I=="string")return m(I,g);if(o.isView(I))return b(I);if(I==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof I);if(dt(I,o)||I&&dt(I.buffer,o)||typeof a<"u"&&(dt(I,a)||I&&dt(I.buffer,a)))return T(I,g,y);if(typeof I=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=I.valueOf&&I.valueOf();if(M!=null&&M!==I)return u.from(M,g,y);const z=A(I);if(z)return z;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof I[Symbol.toPrimitive]=="function")return u.from(I[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof I)}u.from=function(I,g,y){return f(I,g,y)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(I){if(typeof I!="number")throw new TypeError('"size" argument must be of type number');if(I<0)throw new RangeError('The value "'+I+'" is invalid for option "size"')}function h(I,g,y){return d(I),I<=0?l(I):g!==void 0?typeof y=="string"?l(I).fill(g,y):l(I).fill(g):l(I)}u.alloc=function(I,g,y){return h(I,g,y)};function p(I){return d(I),l(I<0?0:v(I)|0)}u.allocUnsafe=function(I){return p(I)},u.allocUnsafeSlow=function(I){return p(I)};function m(I,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=S(I,g)|0;let M=l(y);const z=M.write(I,g);return z!==y&&(M=M.slice(0,z)),M}function w(I){const g=I.length<0?0:v(I.length)|0,y=l(g);for(let M=0;M<g;M+=1)y[M]=I[M]&255;return y}function b(I){if(dt(I,s)){const g=new s(I);return T(g.buffer,g.byteOffset,g.byteLength)}return w(I)}function T(I,g,y){if(g<0||I.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(I.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&y===void 0?M=new s(I):y===void 0?M=new s(I,g):M=new s(I,g,y),Object.setPrototypeOf(M,u.prototype),M}function A(I){if(u.isBuffer(I)){const g=v(I.length)|0,y=l(g);return y.length===0||I.copy(y,0,0,g),y}if(I.length!==void 0)return typeof I.length!="number"||At(I.length)?l(0):w(I);if(I.type==="Buffer"&&Array.isArray(I.data))return w(I.data)}function v(I){if(I>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return I|0}function C(I){return+I!=I&&(I=0),u.alloc(+I)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,y){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),dt(y,s)&&(y=u.from(y,y.offset,y.byteLength)),!u.isBuffer(g)||!u.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let M=g.length,z=y.length;for(let tt=0,it=Math.min(M,z);tt<it;++tt)if(g[tt]!==y[tt]){M=g[tt],z=y[tt];break}return M<z?-1:z<M?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let M;if(y===void 0)for(y=0,M=0;M<g.length;++M)y+=g[M].length;const z=u.allocUnsafe(y);let tt=0;for(M=0;M<g.length;++M){let it=g[M];if(dt(it,s))tt+it.length>z.length?(u.isBuffer(it)||(it=u.from(it)),it.copy(z,tt)):s.prototype.set.call(z,it,tt);else if(u.isBuffer(it))it.copy(z,tt);else throw new TypeError('"list" argument must be an Array of Buffers');tt+=it.length}return z};function S(I,g){if(u.isBuffer(I))return I.length;if(o.isView(I)||dt(I,o))return I.byteLength;if(typeof I!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof I);const y=I.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&y===0)return 0;let z=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ct(I).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return mt(I).length;default:if(z)return M?-1:ct(I).length;g=(""+g).toLowerCase(),z=!0}}u.byteLength=S;function R(I,g,y){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(I||(I="utf8");;)switch(I){case"hex":return H(this,g,y);case"utf8":case"utf-8":return j(this,g,y);case"ascii":return ft(this,g,y);case"latin1":case"binary":return Z(this,g,y);case"base64":return Q(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wt(this,g,y);default:if(M)throw new TypeError("Unknown encoding: "+I);I=(I+"").toLowerCase(),M=!0}}u.prototype._isBuffer=!0;function U(I,g,y){const M=I[g];I[g]=I[y],I[y]=M}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)U(this,y,y+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)U(this,y,y+3),U(this,y+1,y+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)U(this,y,y+7),U(this,y+1,y+6),U(this,y+2,y+5),U(this,y+3,y+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?j(this,0,g):R.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const y=t.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,y,M,z,tt){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),M===void 0&&(M=g?g.length:0),z===void 0&&(z=0),tt===void 0&&(tt=this.length),y<0||M>g.length||z<0||tt>this.length)throw new RangeError("out of range index");if(z>=tt&&y>=M)return 0;if(z>=tt)return-1;if(y>=M)return 1;if(y>>>=0,M>>>=0,z>>>=0,tt>>>=0,this===g)return 0;let it=tt-z,Wt=M-y;const Ie=Math.min(it,Wt),Ee=this.slice(z,tt),Ne=g.slice(y,M);for(let ue=0;ue<Ie;++ue)if(Ee[ue]!==Ne[ue]){it=Ee[ue],Wt=Ne[ue];break}return it<Wt?-1:Wt<it?1:0};function O(I,g,y,M,z){if(I.length===0)return-1;if(typeof y=="string"?(M=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,At(y)&&(y=z?0:I.length-1),y<0&&(y=I.length+y),y>=I.length){if(z)return-1;y=I.length-1}else if(y<0)if(z)y=0;else return-1;if(typeof g=="string"&&(g=u.from(g,M)),u.isBuffer(g))return g.length===0?-1:D(I,g,y,M,z);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?z?s.prototype.indexOf.call(I,g,y):s.prototype.lastIndexOf.call(I,g,y):D(I,[g],y,M,z);throw new TypeError("val must be string, number or Buffer")}function D(I,g,y,M,z){let tt=1,it=I.length,Wt=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(I.length<2||g.length<2)return-1;tt=2,it/=2,Wt/=2,y/=2}function Ie(Ne,ue){return tt===1?Ne[ue]:Ne.readUInt16BE(ue*tt)}let Ee;if(z){let Ne=-1;for(Ee=y;Ee<it;Ee++)if(Ie(I,Ee)===Ie(g,Ne===-1?0:Ee-Ne)){if(Ne===-1&&(Ne=Ee),Ee-Ne+1===Wt)return Ne*tt}else Ne!==-1&&(Ee-=Ee-Ne),Ne=-1}else for(y+Wt>it&&(y=it-Wt),Ee=y;Ee>=0;Ee--){let Ne=!0;for(let ue=0;ue<Wt;ue++)if(Ie(I,Ee+ue)!==Ie(g,ue)){Ne=!1;break}if(Ne)return Ee}return-1}u.prototype.includes=function(g,y,M){return this.indexOf(g,y,M)!==-1},u.prototype.indexOf=function(g,y,M){return O(this,g,y,M,!0)},u.prototype.lastIndexOf=function(g,y,M){return O(this,g,y,M,!1)};function V(I,g,y,M){y=Number(y)||0;const z=I.length-y;M?(M=Number(M),M>z&&(M=z)):M=z;const tt=g.length;M>tt/2&&(M=tt/2);let it;for(it=0;it<M;++it){const Wt=parseInt(g.substr(it*2,2),16);if(At(Wt))return it;I[y+it]=Wt}return it}function L(I,g,y,M){return bt(ct(g,I.length-y),I,y,M)}function N(I,g,y,M){return bt(ht(g),I,y,M)}function E(I,g,y,M){return bt(mt(g),I,y,M)}function B(I,g,y,M){return bt(J(g,I.length-y),I,y,M)}u.prototype.write=function(g,y,M,z){if(y===void 0)z="utf8",M=this.length,y=0;else if(M===void 0&&typeof y=="string")z=y,M=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(M)?(M=M>>>0,z===void 0&&(z="utf8")):(z=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const tt=this.length-y;if((M===void 0||M>tt)&&(M=tt),g.length>0&&(M<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");z||(z="utf8");let it=!1;for(;;)switch(z){case"hex":return V(this,g,y,M);case"utf8":case"utf-8":return L(this,g,y,M);case"ascii":case"latin1":case"binary":return N(this,g,y,M);case"base64":return E(this,g,y,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,g,y,M);default:if(it)throw new TypeError("Unknown encoding: "+z);z=(""+z).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Q(I,g,y){return g===0&&y===I.length?e.fromByteArray(I):e.fromByteArray(I.slice(g,y))}function j(I,g,y){y=Math.min(I.length,y);const M=[];let z=g;for(;z<y;){const tt=I[z];let it=null,Wt=tt>239?4:tt>223?3:tt>191?2:1;if(z+Wt<=y){let Ie,Ee,Ne,ue;switch(Wt){case 1:tt<128&&(it=tt);break;case 2:Ie=I[z+1],(Ie&192)===128&&(ue=(tt&31)<<6|Ie&63,ue>127&&(it=ue));break;case 3:Ie=I[z+1],Ee=I[z+2],(Ie&192)===128&&(Ee&192)===128&&(ue=(tt&15)<<12|(Ie&63)<<6|Ee&63,ue>2047&&(ue<55296||ue>57343)&&(it=ue));break;case 4:Ie=I[z+1],Ee=I[z+2],Ne=I[z+3],(Ie&192)===128&&(Ee&192)===128&&(Ne&192)===128&&(ue=(tt&15)<<18|(Ie&63)<<12|(Ee&63)<<6|Ne&63,ue>65535&&ue<1114112&&(it=ue))}}it===null?(it=65533,Wt=1):it>65535&&(it-=65536,M.push(it>>>10&1023|55296),it=56320|it&1023),M.push(it),z+=Wt}return et(M)}const st=4096;function et(I){const g=I.length;if(g<=st)return String.fromCharCode.apply(String,I);let y="",M=0;for(;M<g;)y+=String.fromCharCode.apply(String,I.slice(M,M+=st));return y}function ft(I,g,y){let M="";y=Math.min(I.length,y);for(let z=g;z<y;++z)M+=String.fromCharCode(I[z]&127);return M}function Z(I,g,y){let M="";y=Math.min(I.length,y);for(let z=g;z<y;++z)M+=String.fromCharCode(I[z]);return M}function H(I,g,y){const M=I.length;(!g||g<0)&&(g=0),(!y||y<0||y>M)&&(y=M);let z="";for(let tt=g;tt<y;++tt)z+=he[I[tt]];return z}function wt(I,g,y){const M=I.slice(g,y);let z="";for(let tt=0;tt<M.length-1;tt+=2)z+=String.fromCharCode(M[tt]+M[tt+1]*256);return z}u.prototype.slice=function(g,y){const M=this.length;g=~~g,y=y===void 0?M:~~y,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),y<0?(y+=M,y<0&&(y=0)):y>M&&(y=M),y<g&&(y=g);const z=this.subarray(g,y);return Object.setPrototypeOf(z,u.prototype),z};function at(I,g,y){if(I%1!==0||I<0)throw new RangeError("offset is not uint");if(I+g>y)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,y,M){g=g>>>0,y=y>>>0,M||at(g,y,this.length);let z=this[g],tt=1,it=0;for(;++it<y&&(tt*=256);)z+=this[g+it]*tt;return z},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,y,M){g=g>>>0,y=y>>>0,M||at(g,y,this.length);let z=this[g+--y],tt=1;for(;y>0&&(tt*=256);)z+=this[g+--y]*tt;return z},u.prototype.readUint8=u.prototype.readUInt8=function(g,y){return g=g>>>0,y||at(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||at(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||at(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||at(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||at(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Pt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&P(g,this.length-8);const z=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,tt=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(z)+(BigInt(tt)<<BigInt(32))}),u.prototype.readBigUInt64BE=Pt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&P(g,this.length-8);const z=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],tt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(z)<<BigInt(32))+BigInt(tt)}),u.prototype.readIntLE=function(g,y,M){g=g>>>0,y=y>>>0,M||at(g,y,this.length);let z=this[g],tt=1,it=0;for(;++it<y&&(tt*=256);)z+=this[g+it]*tt;return tt*=128,z>=tt&&(z-=Math.pow(2,8*y)),z},u.prototype.readIntBE=function(g,y,M){g=g>>>0,y=y>>>0,M||at(g,y,this.length);let z=y,tt=1,it=this[g+--z];for(;z>0&&(tt*=256);)it+=this[g+--z]*tt;return tt*=128,it>=tt&&(it-=Math.pow(2,8*y)),it},u.prototype.readInt8=function(g,y){return g=g>>>0,y||at(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,y){g=g>>>0,y||at(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},u.prototype.readInt16BE=function(g,y){g=g>>>0,y||at(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},u.prototype.readInt32LE=function(g,y){return g=g>>>0,y||at(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,y){return g=g>>>0,y||at(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Pt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&P(g,this.length-8);const z=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(z)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Pt(function(g){g=g>>>0,nt(g,"offset");const y=this[g],M=this[g+7];(y===void 0||M===void 0)&&P(g,this.length-8);const z=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(z)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),u.prototype.readFloatLE=function(g,y){return g=g>>>0,y||at(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,y){return g=g>>>0,y||at(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||at(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||at(g,8,this.length),n.read(this,g,!1,52,8)};function lt(I,g,y,M,z,tt){if(!u.isBuffer(I))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>z||g<tt)throw new RangeError('"value" argument is out of bounds');if(y+M>I.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,y,M,z){if(g=+g,y=y>>>0,M=M>>>0,!z){const Wt=Math.pow(2,8*M)-1;lt(this,g,y,M,Wt,0)}let tt=1,it=0;for(this[y]=g&255;++it<M&&(tt*=256);)this[y+it]=g/tt&255;return y+M},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,y,M,z){if(g=+g,y=y>>>0,M=M>>>0,!z){const Wt=Math.pow(2,8*M)-1;lt(this,g,y,M,Wt,0)}let tt=M-1,it=1;for(this[y+tt]=g&255;--tt>=0&&(it*=256);)this[y+tt]=g/it&255;return y+M},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,1,255,0),this[y]=g&255,y+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function Mt(I,g,y,M,z){ot(g,M,z,I,y,7);let tt=Number(g&BigInt(4294967295));I[y++]=tt,tt=tt>>8,I[y++]=tt,tt=tt>>8,I[y++]=tt,tt=tt>>8,I[y++]=tt;let it=Number(g>>BigInt(32)&BigInt(4294967295));return I[y++]=it,it=it>>8,I[y++]=it,it=it>>8,I[y++]=it,it=it>>8,I[y++]=it,y}function Zt(I,g,y,M,z){ot(g,M,z,I,y,7);let tt=Number(g&BigInt(4294967295));I[y+7]=tt,tt=tt>>8,I[y+6]=tt,tt=tt>>8,I[y+5]=tt,tt=tt>>8,I[y+4]=tt;let it=Number(g>>BigInt(32)&BigInt(4294967295));return I[y+3]=it,it=it>>8,I[y+2]=it,it=it>>8,I[y+1]=it,it=it>>8,I[y]=it,y+8}u.prototype.writeBigUInt64LE=Pt(function(g,y=0){return Mt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Pt(function(g,y=0){return Zt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,y,M,z){if(g=+g,y=y>>>0,!z){const Ie=Math.pow(2,8*M-1);lt(this,g,y,M,Ie-1,-Ie)}let tt=0,it=1,Wt=0;for(this[y]=g&255;++tt<M&&(it*=256);)g<0&&Wt===0&&this[y+tt-1]!==0&&(Wt=1),this[y+tt]=(g/it>>0)-Wt&255;return y+M},u.prototype.writeIntBE=function(g,y,M,z){if(g=+g,y=y>>>0,!z){const Ie=Math.pow(2,8*M-1);lt(this,g,y,M,Ie-1,-Ie)}let tt=M-1,it=1,Wt=0;for(this[y+tt]=g&255;--tt>=0&&(it*=256);)g<0&&Wt===0&&this[y+tt+1]!==0&&(Wt=1),this[y+tt]=(g/it>>0)-Wt&255;return y+M},u.prototype.writeInt8=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},u.prototype.writeInt16LE=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeInt16BE=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeInt32LE=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},u.prototype.writeInt32BE=function(g,y,M){return g=+g,y=y>>>0,M||lt(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},u.prototype.writeBigInt64LE=Pt(function(g,y=0){return Mt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Pt(function(g,y=0){return Zt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ut(I,g,y,M,z,tt){if(y+M>I.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function Tt(I,g,y,M,z){return g=+g,y=y>>>0,z||Ut(I,g,y,4),n.write(I,g,y,M,23,4),y+4}u.prototype.writeFloatLE=function(g,y,M){return Tt(this,g,y,!0,M)},u.prototype.writeFloatBE=function(g,y,M){return Tt(this,g,y,!1,M)};function Dt(I,g,y,M,z){return g=+g,y=y>>>0,z||Ut(I,g,y,8),n.write(I,g,y,M,52,8),y+8}u.prototype.writeDoubleLE=function(g,y,M){return Dt(this,g,y,!0,M)},u.prototype.writeDoubleBE=function(g,y,M){return Dt(this,g,y,!1,M)},u.prototype.copy=function(g,y,M,z){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!z&&z!==0&&(z=this.length),y>=g.length&&(y=g.length),y||(y=0),z>0&&z<M&&(z=M),z===M||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(z<0)throw new RangeError("sourceEnd out of bounds");z>this.length&&(z=this.length),g.length-y<z-M&&(z=g.length-y+M);const tt=z-M;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,M,z):s.prototype.set.call(g,this.subarray(M,z),y),tt},u.prototype.fill=function(g,y,M,z){if(typeof g=="string"){if(typeof y=="string"?(z=y,y=0,M=this.length):typeof M=="string"&&(z=M,M=this.length),z!==void 0&&typeof z!="string")throw new TypeError("encoding must be a string");if(typeof z=="string"&&!u.isEncoding(z))throw new TypeError("Unknown encoding: "+z);if(g.length===1){const it=g.charCodeAt(0);(z==="utf8"&&it<128||z==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<M)throw new RangeError("Out of range index");if(M<=y)return this;y=y>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let tt;if(typeof g=="number")for(tt=y;tt<M;++tt)this[tt]=g;else{const it=u.isBuffer(g)?g:u.from(g,z),Wt=it.length;if(Wt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(tt=0;tt<M-y;++tt)this[tt+y]=it[tt%Wt]}return this};const Ft={};function Re(I,g,y){Ft[I]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${I}]`,this.stack,delete this.name}get code(){return I}set code(z){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:z,writable:!0})}toString(){return`${this.name} [${I}]: ${this.message}`}}}Re("ERR_BUFFER_OUT_OF_BOUNDS",function(I){return I?`${I} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Re("ERR_INVALID_ARG_TYPE",function(I,g){return`The "${I}" argument must be of type number. Received type ${typeof g}`},TypeError),Re("ERR_OUT_OF_RANGE",function(I,g,y){let M=`The value of "${I}" is out of range.`,z=y;return Number.isInteger(y)&&Math.abs(y)>2**32?z=Be(String(y)):typeof y=="bigint"&&(z=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(z=Be(z)),z+="n"),M+=` It must be ${g}. Received ${z}`,M},RangeError);function Be(I){let g="",y=I.length;const M=I[0]==="-"?1:0;for(;y>=M+4;y-=3)g=`_${I.slice(y-3,y)}${g}`;return`${I.slice(0,y)}${g}`}function k(I,g,y){nt(g,"offset"),(I[g]===void 0||I[g+y]===void 0)&&P(g,I.length-(y+1))}function ot(I,g,y,M,z,tt){if(I>y||I<g){const it=typeof g=="bigint"?"n":"";let Wt;throw g===0||g===BigInt(0)?Wt=`>= 0${it} and < 2${it} ** ${(tt+1)*8}${it}`:Wt=`>= -(2${it} ** ${(tt+1)*8-1}${it}) and < 2 ** ${(tt+1)*8-1}${it}`,new Ft.ERR_OUT_OF_RANGE("value",Wt,I)}k(M,z,tt)}function nt(I,g){if(typeof I!="number")throw new Ft.ERR_INVALID_ARG_TYPE(g,"number",I)}function P(I,g,y){throw Math.floor(I)!==I?(nt(I,y),new Ft.ERR_OUT_OF_RANGE("offset","an integer",I)):g<0?new Ft.ERR_BUFFER_OUT_OF_BOUNDS:new Ft.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,I)}const F=/[^+/0-9A-Za-z-_]/g;function Y(I){if(I=I.split("=")[0],I=I.trim().replace(F,""),I.length<2)return"";for(;I.length%4!==0;)I=I+"=";return I}function ct(I,g){g=g||1/0;let y;const M=I.length;let z=null;const tt=[];for(let it=0;it<M;++it){if(y=I.charCodeAt(it),y>55295&&y<57344){if(!z){if(y>56319){(g-=3)>-1&&tt.push(239,191,189);continue}else if(it+1===M){(g-=3)>-1&&tt.push(239,191,189);continue}z=y;continue}if(y<56320){(g-=3)>-1&&tt.push(239,191,189),z=y;continue}y=(z-55296<<10|y-56320)+65536}else z&&(g-=3)>-1&&tt.push(239,191,189);if(z=null,y<128){if((g-=1)<0)break;tt.push(y)}else if(y<2048){if((g-=2)<0)break;tt.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;tt.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;tt.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return tt}function ht(I){const g=[];for(let y=0;y<I.length;++y)g.push(I.charCodeAt(y)&255);return g}function J(I,g){let y,M,z;const tt=[];for(let it=0;it<I.length&&!((g-=2)<0);++it)y=I.charCodeAt(it),M=y>>8,z=y%256,tt.push(z),tt.push(M);return tt}function mt(I){return e.toByteArray(Y(I))}function bt(I,g,y,M){let z;for(z=0;z<M&&!(z+y>=g.length||z>=I.length);++z)g[z+y]=I[z];return z}function dt(I,g){return I instanceof g||I!=null&&I.constructor!=null&&I.constructor.name!=null&&I.constructor.name===g.name}function At(I){return I!==I}const he=function(){const I="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const M=y*16;for(let z=0;z<16;++z)g[M+z]=I[y]+I[z]}return g}();function Pt(I){return typeof BigInt>"u"?Kn:I}function Kn(){throw new Error("BigInt not supported")}})(Gg);const fn=Gg.Buffer,Vg=t=>t===void 0?null:t;class aR{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Zg=new aR,cR=!0;try{typeof localStorage<"u"&&localStorage&&(Zg=localStorage,cR=!1)}catch{}const lR=Zg,uR=Object.assign,hR=Object.keys,fR=(t,e)=>{for(const n in t)e(t[n],n)},Xg=t=>hR(t).length,dR=t=>{for(const e in t)return!1;return!0},pR=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},mR=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),gR=(t,e)=>t===e||Xg(t)===Xg(e)&&pR(t,(n,r)=>(n!==void 0||mR(e,r))&&e[r]===n),_R=Object.freeze,qg=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&qg(t[e])}return _R(t)},Nf=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Nf(t,e,n+1)}},yR=t=>t,bR=(t,e)=>e.includes(t);var Jg={};const Wa=typeof Sr<"u"&&Sr.release&&/node|io\.js/.test(Sr.release.name)&&Object.prototype.toString.call(typeof Sr<"u"?Sr:0)==="[object process]";let Jr;const wR=()=>{if(Jr===void 0)if(Wa){Jr=Rr();const t=Sr.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Jr.set(e,""),e=r):e!==null&&(Jr.set(e,r),e=null)}e!==null&&Jr.set(e,"")}else typeof location=="object"?(Jr=Rr(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Jr.set(`--${Fg(e,"-")}`,n),Jr.set(`-${Fg(e,"-")}`,n)}})):Jr=Rr();return Jr},Of=t=>wR().has(t),yl=t=>Vg(Wa?Jg[t.toUpperCase().replaceAll("-","_")]:lR.getItem(t)),Qg=t=>Of("--"+t)||yl(t)!==null;Qg("production");const ER=Wa&&bR(Jg.FORCE_COLOR,["true","1","2"])||!Of("--no-colors")&&!Qg("no-color")&&(!Wa||Sr.stdout.isTTY)&&(!Wa||Of("--color")||yl("COLORTERM")!==null||(yl("TERM")||"").includes("color")),xR=t=>new Uint8Array(t),kR=t=>{const e=xR(t.byteLength);return e.set(t),e};class TR{constructor(e,n){this.left=e,this.right=n}}const vi=(t,e)=>new TR(t,e);typeof DOMParser<"u"&&new DOMParser;const vR=t=>kS(t,(e,n)=>`${n}:${e};`).join(""),Ai=Symbol,t_=Ai(),e_=Ai(),AR=Ai(),SR=Ai(),RR=Ai(),n_=Ai(),IR=Ai(),Cf=Ai(),NR=Ai(),OR=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},CR={[t_]:vi("font-weight","bold"),[e_]:vi("font-weight","normal"),[AR]:vi("color","blue"),[RR]:vi("color","green"),[SR]:vi("color","grey"),[n_]:vi("color","red"),[IR]:vi("color","purple"),[Cf]:vi("color","orange"),[NR]:vi("color","black")},r_=ER?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Rr();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=CR[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=vR(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:OR,LR=(...t)=>{console.log(...r_(t)),i_.forEach(e=>e.print(t))},MR=(...t)=>{console.warn(...r_(t)),t.unshift(Cf),i_.forEach(e=>e.print(t))},i_=wo(),s_=t=>({[Symbol.iterator](){return this},next:t}),UR=(t,e)=>s_(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Lf=(t,e)=>s_(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Mf{constructor(e,n){this.clock=e,this.len=n}}class Ha{constructor(){this.clients=new Map}}const o_=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];x_(t,s,a.clock,a.len,n)}}),FR=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Ji((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},a_=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&FR(n,e.clock)!==null},Uf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=Cs(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},PR=t=>{const e=new Ha;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)vS(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return Uf(e),e},bl=(t,e,n,r)=>{qi(t.clients,e,()=>[]).push(new Mf(n,r))},BR=()=>new Ha,DR=t=>{const e=BR();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Mf(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Ao=(t,e)=>{ie(t.restEncoder,e.clients.size),Os(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ie(t.restEncoder,n);const i=r.length;ie(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},Ff=t=>{const e=new Ha,n=Gt(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Gt(t.restDecoder),s=Gt(t.restDecoder);if(s>0){const o=qi(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Mf(t.readDsClock(),t.readDsLen()))}}return e},c_=(t,e,n)=>{const r=new Ha,i=Gt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Gt(t.restDecoder),a=Gt(t.restDecoder),c=n.clients.get(o)||[],l=an(n,o);for(let u=0;u<a;u++){const f=t.readDsClock(),d=f+t.readDsLen();if(f<l){l<d&&bl(r,o,l,d-l);let h=Qr(c,f),p=c[h];for(!p.deleted&&p.id.clock<f&&(c.splice(h+1,0,Ll(e,p,f-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(h,0,Ll(e,p,d-p.id.clock)),p.delete(e))}else bl(r,o,f,d-f)}}if(r.clients.size>0){const s=new Ms;return ie(s.restEncoder,0),Ao(s,r),s.toUint8Array()}return null},l_=Hg;class So extends SS{constructor({guid:e=JS(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=l_(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new b_,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Kg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Kg(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&pe(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Os(this.subdocs).map(e=>e.guid))}transact(e,n=null){return pe(this,e,n)}get(e,n=dn){const r=qi(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==dn&&i!==n)if(i===dn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Oo)}getText(e=""){return this.get(e,Si)}getMap(e=""){return this.get(e,Co)}getXmlElement(e=""){return this.get(e,Mo)}getXmlFragment(e=""){return this.get(e,Us)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Os(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new So({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,pe(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class u_{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Gt(this.restDecoder)}readDsLen(){return Gt(this.restDecoder)}}class h_ extends u_{readLeftID(){return qt(Gt(this.restDecoder),Gt(this.restDecoder))}readRightID(){return qt(Gt(this.restDecoder),Gt(this.restDecoder))}readClient(){return Gt(this.restDecoder)}readInfo(){return ko(this.restDecoder)}readString(){return To(this.restDecoder)}readParentInfo(){return Gt(this.restDecoder)===1}readTypeRef(){return Gt(this.restDecoder)}readLen(){return Gt(this.restDecoder)}readAny(){return za(this.restDecoder)}readBuf(){return kR(Jn(this.restDecoder))}readJSON(){return JSON.parse(To(this.restDecoder))}readKey(){return To(this.restDecoder)}}class $R{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Gt(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Gt(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Ro extends $R{constructor(e){super(e),this.keys=[],Gt(e),this.keyClockDecoder=new Sf(Jn(e)),this.clientDecoder=new gl(Jn(e)),this.leftClockDecoder=new Sf(Jn(e)),this.rightClockDecoder=new Sf(Jn(e)),this.infoDecoder=new Wg(Jn(e),ko),this.stringDecoder=new ZS(Jn(e)),this.parentInfoDecoder=new Wg(Jn(e),ko),this.typeRefDecoder=new gl(Jn(e)),this.lenDecoder=new gl(Jn(e))}readLeftID(){return new Io(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Io(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return za(this.restDecoder)}readBuf(){return Jn(this.restDecoder)}readJSON(){return za(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class jR{constructor(){this.restEncoder=fl()}toUint8Array(){return Vr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ie(this.restEncoder,e)}writeDsLen(e){ie(this.restEncoder,e)}}class Ka extends jR{writeLeftID(e){ie(this.restEncoder,e.client),ie(this.restEncoder,e.clock)}writeRightID(e){ie(this.restEncoder,e.client),ie(this.restEncoder,e.clock)}writeClient(e){ie(this.restEncoder,e)}writeInfo(e){wf(this.restEncoder,e)}writeString(e){Eo(this.restEncoder,e)}writeParentInfo(e){ie(this.restEncoder,e?1:0)}writeTypeRef(e){ie(this.restEncoder,e)}writeLen(e){ie(this.restEncoder,e)}writeAny(e){ja(this.restEncoder,e)}writeBuf(e){qn(this.restEncoder,e)}writeJSON(e){Eo(this.restEncoder,JSON.stringify(e))}writeKey(e){Eo(this.restEncoder,e)}}class zR{constructor(){this.restEncoder=fl(),this.dsCurrVal=0}toUint8Array(){return Vr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ie(this.restEncoder,n)}writeDsLen(e){e===0&&Xr(),ie(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ms extends zR{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Tf,this.clientEncoder=new pl,this.leftClockEncoder=new Tf,this.rightClockEncoder=new Tf,this.infoEncoder=new Bg(wf),this.stringEncoder=new KS,this.parentInfoEncoder=new Bg(wf),this.typeRefEncoder=new pl,this.lenEncoder=new pl}toUint8Array(){const e=fl();return ie(e,0),qn(e,this.keyClockEncoder.toUint8Array()),qn(e,this.clientEncoder.toUint8Array()),qn(e,this.leftClockEncoder.toUint8Array()),qn(e,this.rightClockEncoder.toUint8Array()),qn(e,Vr(this.infoEncoder)),qn(e,this.stringEncoder.toUint8Array()),qn(e,Vr(this.parentInfoEncoder)),qn(e,this.typeRefEncoder.toUint8Array()),qn(e,this.lenEncoder.toUint8Array()),dl(e,Vr(this.restEncoder)),Vr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ja(this.restEncoder,e)}writeBuf(e){qn(this.restEncoder,e)}writeJSON(e){ja(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const WR=(t,e,n,r)=>{r=Cs(r,e[0].id.clock);const i=Qr(e,r);ie(t.restEncoder,e.length-i),t.writeClient(n),ie(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Pf=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{an(e,s)>i&&r.set(s,i)}),Df(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ie(t.restEncoder,r.size),Os(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{WR(t,e.clients.get(i),i,s)})},HR=(t,e)=>{const n=Rr(),r=Gt(t.restDecoder);for(let i=0;i<r;i++){const s=Gt(t.restDecoder),o=new Array(s),a=t.readClient();let c=Gt(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(hl&u){case 0:{const f=t.readLen();o[l]=new ur(qt(a,c),f),c+=f;break}case 10:{const f=Gt(t.restDecoder);o[l]=new hr(qt(a,c),f),c+=f;break}default:{const f=(u&(Ti|Xn))===0,d=new Xe(qt(a,c),null,(u&Xn)===Xn?t.readLeftID():null,null,(u&Ti)===Ti?t.readRightID():null,f?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,f&&(u&Pa)===Pa?t.readString():null,Y_(t,u));o[l]=d,c+=d.length}}}}return n},KR=(t,e,n)=>{const r=[];let i=Os(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new b_,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(w=>w!==p)}r.length=0};for(;;){if(u.constructor!==hr){const p=qi(f,u.id.client,()=>an(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const w=n.get(m)||{refs:[],i:0};if(w.refs.length===w.i)l(m,an(e,m)),d();else{u=w.refs[w.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new Ms;return Pf(h,a,new Map),ie(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},GR=(t,e)=>Pf(t,e.doc.store,e.beforeState),YR=(t,e,n,r=new Ro(t))=>pe(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=HR(r,o),l=KR(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<an(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const p=u.missing.get(d);(p==null||p>h)&&u.missing.set(d,h)}u.update=xl([u.update,l.update])}}else a.pendingStructs=l;const f=c_(r,i,a);if(a.pendingDs){const d=new Ro(xo(a.pendingDs));Gt(d.restDecoder);const h=c_(d,i,a);f&&h?a.pendingDs=xl([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,f_(i.doc,d)}},n,!1),f_=(t,e,n,r=Ro)=>{const i=xo(e);YR(i,t,n,new r(i))},d_=(t,e,n)=>f_(t,e,n,h_),VR=(t,e,n=new Map)=>{Pf(t,e.store,n),Ao(t,DR(e.store))},ZR=(t,e=new Uint8Array([0]),n=new Ms)=>{const r=p_(e);VR(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(aI(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Ka)return sI(i.map((s,o)=>o===0?s:lI(s)));if(n.constructor===Ms)return xl(i)}return i[0]},XR=(t,e)=>ZR(t,e,new Ka),qR=t=>{const e=new Map,n=Gt(t.restDecoder);for(let r=0;r<n;r++){const i=Gt(t.restDecoder),s=Gt(t.restDecoder);e.set(i,s)}return e},p_=t=>qR(new u_(xo(t)));class JR{constructor(){this.l=[]}}const m_=()=>new JR,g_=(t,e)=>t.l.push(e),__=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},y_=(t,e,n)=>Nf(t.l,[e,n]);class Io{constructor(e,n){this.client=e,this.clock=n}}const wl=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,qt=(t,e)=>new Io(t,e),QR=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Xr()},No=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!a_(e.ds,t.id),Bf=(t,e)=>{const n=qi(t.meta,Bf,wo),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<an(r,s)&&ts(t,qt(s,i))}),o_(t,e.ds,i=>{}),n.add(e))};class b_{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Df=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},an=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},w_=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Xr()}n.push(e)},Qr=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Ji(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Ji((n+r)/2)}throw Xr()},$f=(t,e)=>{const n=t.clients.get(e.client);return n[Qr(n,e.clock)]},jf=(t,e,n)=>{const r=Qr(e,n),i=e[r];return i.id.clock<n&&i instanceof Xe?(e.splice(r+1,0,Ll(t,i,n-i.id.clock)),r+1):r},ts=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[jf(t,n,e.clock)]},E_=(t,e,n)=>{const r=e.clients.get(n.client),i=Qr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==ur&&r.splice(i+1,0,Ll(t,s,n.clock-s.id.clock+1)),s},tI=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Qr(r,e.id.clock)]=n},x_=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=jf(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&jf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class eI{constructor(e,n,r){this.doc=e,this.deleteSet=new Ha,this.beforeState=Df(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const k_=(t,e)=>e.deleteSet.clients.size===0&&!TS(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Uf(e.deleteSet),GR(t,e),Ao(t,e.deleteSet),!0),T_=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&qi(t.changed,e,wo).add(n)},El=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Xe&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},nI=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Qr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Xe&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},rI=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Og(i.length-1,1+Qr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+El(i,c)}})},v_=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Uf(s),n.afterState=Df(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),y_(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Nf(a,[]),n._needFormattingCleanup&&kI(n)}finally{r.gc&&nI(s,i,r.gcFilter),rI(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=Cs(Qr(h,d),1);for(let m=h.length-1;m>=p;)m-=1+El(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=Qr(h,d);p+1<h.length&&El(h,p+1)>1||p>0&&El(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(LR(Cf,t_,"[yjs] ",e_,n_,"Changed the client-id because another client seems to be using it."),r.clientID=l_()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ka;k_(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Ms;k_(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):v_(t,e+1)}}},pe=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new eI(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&v_(i,0)}}return o};function*iI(t){const e=Gt(t.restDecoder);for(let n=0;n<e;n++){const r=Gt(t.restDecoder),i=t.readClient();let s=Gt(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Gt(t.restDecoder);yield new hr(qt(i,s),c),s+=c}else if(hl&a){const c=(a&(Ti|Xn))===0,l=new Xe(qt(i,s),null,(a&Xn)===Xn?t.readLeftID():null,null,(a&Ti)===Ti?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Pa)===Pa?t.readString():null,Y_(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new ur(qt(i,s),c),s+=c}}}}class zf{constructor(e,n){this.gen=iI(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===hr);return this.curr}}class Wf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const sI=t=>xl(t,h_,Ka),oI=(t,e)=>{if(t.constructor===ur){const{client:n,clock:r}=t.id;return new ur(qt(n,r+e),t.length-e)}else if(t.constructor===hr){const{client:n,clock:r}=t.id;return new hr(qt(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Xe(qt(r,i+e),null,qt(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},xl=(t,e=Ro,n=Ms)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(xo(u)));let i=r.map(u=>new zf(u,!0)),s=null;const o=new n,a=new Wf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const p=d.curr.id.clock-h.curr.id.clock;return p===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===hr?1:-1:p}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)es(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===hr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{es(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new hr(qt(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===hr?s.struct.length-=p:d=oI(d,p)),s.struct.mergeWith(d)||(es(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==hr;d=u.next())es(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(es(a,s.struct,s.offset),s=null),Hf(a);const c=r.map(u=>Ff(u)),l=PR(c);return Ao(o,l),o.toUint8Array()},aI=(t,e,n=Ro,r=Ms)=>{const i=p_(e),s=new r,o=new Wf(s),a=new n(xo(t)),c=new zf(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===hr){c.next();continue}if(u.id.clock+u.length>d)for(es(o,u,Cs(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)es(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}Hf(o);const l=Ff(a);return Ao(s,l),s.toUint8Array()},A_=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Vr(t.encoder.restEncoder)}),t.encoder.restEncoder=fl(),t.written=0)},es=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&A_(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ie(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Hf=t=>{A_(t);const e=t.encoder.restEncoder;ie(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ie(e,r.written),dl(e,r.restEncoder)}},cI=(t,e,n,r)=>{const i=new n(xo(t)),s=new zf(i,!1),o=new r,a=new Wf(o);for(let l=s.curr;l!==null;l=s.next())es(a,e(l),0);Hf(a);const c=Ff(i);return Ao(o,c),o.toUint8Array()},lI=t=>cI(t,yR,Ro,Ka),S_="You must not compute changes after the event-handler fired.";class kl{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=uI(this.currentTarget,this.target))}deletes(e){return a_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Qi(S_);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=gf(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=gf(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=gf(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Qi(S_);const n=this.target,r=wo(),i=wo(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const uI=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},_n=()=>{MR("Invalid access: Add Yjs type to a document before reading data.")},R_=80;let Kf=0;class hI{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Kf++}}const fI=t=>{t.timestamp=Kf++},I_=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Kf++},dI=(t,e,n)=>{if(t.length>=R_){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return I_(r,e,n),r}else{const r=new hI(e,n);return t.push(r),r}},Tl=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>ul(e-s.index)<ul(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,fI(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ul(n.index-i)<r.parent.length/R_?(I_(n,r,i),n):dI(t._searchMarker,r,i)},Ga=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=Cs(e,i.index+n))}},vl=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;qi(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;y_(r._eH,n,e)};class dn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=m_(),this._dEH=m_(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Zr()}clone(){throw Zr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){g_(this._eH,e)}observeDeep(e){g_(this._dEH,e)}unobserve(e){__(this._eH,e)}unobserveDeep(e){__(this._dEH,e)}toJSON(){}}const N_=(t,e,n)=>{t.doc??_n(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},O_=t=>{t.doc??_n();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Ya=(t,e)=>{let n=0,r=t._start;for(t.doc??_n();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},C_=(t,e)=>{const n=[];return Ya(t,(r,i)=>{n.push(e(r,i,t))}),n},pI=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},L_=(t,e)=>{t.doc??_n();const n=Tl(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Al=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Xe(qt(o,an(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ps(l)),i.integrate(t,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Xe(qt(o,an(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Va(new Uint8Array(f))),i.integrate(t,0);break;case So:i=new Xe(qt(o,an(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Xa(f)),i.integrate(t,0);break;default:if(f instanceof dn)i=new Xe(qt(o,an(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ri(f)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},M_=()=>Qi("Length exceeded!"),U_=(t,e,n,r)=>{if(n>e._length)throw M_();if(n===0)return e._searchMarker&&Ga(e._searchMarker,n,r.length),Al(t,e,null,r);const i=n,s=Tl(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&ts(t,qt(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Ga(e._searchMarker,i,r.length),Al(t,e,o,r)},mI=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Al(t,e,i,n)},F_=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Tl(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&ts(t,qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&ts(t,qt(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw M_();e._searchMarker&&Ga(e._searchMarker,i,-s+r)},Sl=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Gf=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new Ps([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ps([r]);break;case Uint8Array:a=new Va(r);break;case So:a=new Xa(r);break;default:if(r instanceof dn)a=new Ri(r);else throw new Error("Unexpected content type")}new Xe(qt(o,an(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Yf=(t,e)=>{t.doc??_n();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},P_=t=>{const e={};return t.doc??_n(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},B_=(t,e)=>{t.doc??_n();const n=t._map.get(e);return n!==void 0&&!n.deleted},gI=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&No(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Rl=t=>(t.doc??_n(),UR(t._map.entries(),e=>!e[1].deleted));class _I extends kl{}class Oo extends dn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Oo;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Oo}clone(){const e=new Oo;return e.insert(0,this.toArray().map(n=>n instanceof dn?n.clone():n)),e}get length(){return this.doc??_n(),this._length}_callObserver(e,n){super._callObserver(e,n),vl(this,e,new _I(this,e))}insert(e,n){this.doc!==null?pe(this.doc,r=>{U_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?pe(this.doc,n=>{mI(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?pe(this.doc,r=>{F_(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return L_(this,e)}toArray(){return O_(this)}slice(e=0,n=this.length){return N_(this,e,n)}toJSON(){return this.map(e=>e instanceof dn?e.toJSON():e)}map(e){return C_(this,e)}forEach(e){Ya(this,e)}[Symbol.iterator](){return pI(this)}_write(e){e.writeTypeRef(zI)}}const yI=t=>new Oo;class bI extends kl{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Co extends dn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Co}clone(){const e=new Co;return this.forEach((n,r)=>{e.set(r,n instanceof dn?n.clone():n)}),e}_callObserver(e,n){vl(this,e,new bI(this,e,n))}toJSON(){this.doc??_n();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof dn?i.toJSON():i}}),e}get size(){return[...Rl(this)].length}keys(){return Lf(Rl(this),e=>e[0])}values(){return Lf(Rl(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Lf(Rl(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??_n(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?pe(this.doc,n=>{Sl(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?pe(this.doc,r=>{Gf(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Yf(this,e)}has(e){return B_(this,e)}clear(){this.doc!==null?pe(this.doc,e=>{this.forEach(function(n,r,i){Sl(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(WI)}}const wI=t=>new Co,ns=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&gR(t,e);class Vf{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Xr(),this.right.content.constructor){case Ze:this.right.deleted||Lo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const D_=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Ze:e.right.deleted||Lo(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&ts(t,qt(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Il=(t,e,n,r)=>{const i=new Map,s=r?Tl(e,n):null;if(s){const o=new Vf(s.p.left,s.p,s.index,i);return D_(t,o,n-s.index)}else{const o=new Vf(null,e._start,0,i);return D_(t,o,n)}},$_=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ze&&ns(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Xe(qt(s,an(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Ze(a,o));u.integrate(t,0),n.right=u,n.forward()})},Lo=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},j_=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ze&&ns(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},z_=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!ns(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Xe(qt(s,an(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Ze(a,c)),n.right.integrate(t,0),n.forward()}}return o},Zf=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;j_(n,i);const a=z_(t,e,n,i),c=r.constructor===String?new ti(r):r instanceof dn?new Ri(r):new Fs(r);let{left:l,right:u,index:f}=n;e._searchMarker&&Ga(e._searchMarker,n.index,c.getLength()),u=new Xe(qt(o,an(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=f,n.forward(),$_(t,e,n,a)},W_=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;j_(n,i);const a=z_(t,e,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ze));){if(!n.right.deleted)switch(n.right.content.constructor){case Ze:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(ns(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&ts(t,qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Xe(qt(o,an(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new ti(c)),n.right.integrate(t,0),n.forward()}$_(t,e,n,a)},H_=(t,e,n,r,i)=>{let s=e;const o=Rr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ze){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Ze:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(e.delete(t),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&Lo(i,l);break}}}e=e.right}return a},EI=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ze){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},xI=t=>{let e=0;return pe(t.doc,n=>{let r=t._start,i=t._start,s=Rr();const o=mf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ze:Lo(o,i.content);break;default:e+=H_(n,r,i,s,o),s=mf(o),r=i;break}i=i.right}}),e},kI=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&x_(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ze&&o.constructor!==ur&&e.add(o.parent)})}pe(n,r=>{o_(t,t.deleteSet,i=>{if(i instanceof ur||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Ze?e.add(s):EI(r,i)});for(const i of e)xI(i)})},K_=(t,e,n)=>{const r=n,i=mf(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ri:case Fs:case ti:n<e.right.length&&ts(t,qt(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&H_(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Ga(o._searchMarker,e.index,-r+n),e};class TI extends kl{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];pe(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},dR(c)||(h.attributes=uR({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case Ri:case Fs:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ti:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Ze:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;ns(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),ns(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;ns(m,p)||(a==="retain"&&d(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(ns(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&d(),Lo(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Si extends dn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??_n(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Si}clone(){const e=new Si;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new TI(this,e,n);vl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??_n();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ti&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?pe(this.doc,r=>{const i=new Vf(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Zf(r,this,i,a,o.attributes||{})}else o.retain!==void 0?W_(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&K_(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??_n();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(No(c,e)||n!==void 0&&No(c,n))switch(c.content.constructor){case ti:{const f=s.get("ychange");e!==void 0&&!No(c,e)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!No(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Ri:case Fs:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Ze:No(c,e)&&(l(),Lo(s,c.content));break}c=c.right}l()};return e||n?pe(o,f=>{e&&Bf(f,e),n&&Bf(f,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?pe(i,s=>{const o=Il(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Zf(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?pe(i,s=>{const o=Il(s,this,e,!r);Zf(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?pe(r,i=>{K_(i,Il(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?pe(i,s=>{const o=Il(s,this,e,!1);o.right!==null&&W_(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?pe(this.doc,n=>{Sl(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?pe(this.doc,r=>{Gf(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Yf(this,e)}getAttributes(){return P_(this)}_write(e){e.writeTypeRef(HI)}}const vI=t=>new Si;class Xf{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??_n()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Mo||n.constructor===Us)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Us extends dn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Us}clone(){const e=new Us;return e.insert(0,this.toArray().map(n=>n instanceof dn?n.clone():n)),e}get length(){return this.doc??_n(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Xf(this,e)}querySelector(e){e=e.toUpperCase();const r=new Xf(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Os(new Xf(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){vl(this,e,new RI(this,n,e))}toString(){return C_(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ya(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?pe(this.doc,r=>{U_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)pe(this.doc,r=>{const i=e&&e instanceof dn?e._item:e;Al(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Qi("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?pe(this.doc,r=>{F_(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return O_(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return L_(this,e)}slice(e=0,n=this.length){return N_(this,e,n)}forEach(e){Ya(this,e)}_write(e){e.writeTypeRef(GI)}}const AI=t=>new Us;class Mo extends Us{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Mo(this.nodeName)}clone(){const e=new Mo(this.nodeName),n=this.getAttributes();return fR(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof dn?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?pe(this.doc,n=>{Sl(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?pe(this.doc,r=>{Gf(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Yf(this,e)}hasAttribute(e){return B_(this,e)}getAttributes(e){return e?gI(this,e):P_(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ya(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(KI),e.writeKey(this.nodeName)}}const SI=t=>new Mo(t.readKey());class RI extends kl{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Nl extends Co{constructor(e){super(),this.hookName=e}_copy(){return new Nl(this.hookName)}clone(){const e=new Nl(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(YI),e.writeKey(this.hookName)}}const II=t=>new Nl(t.readKey());class Ol extends Si{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Ol}clone(){const e=new Ol;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(VI)}}const NI=t=>new Ol;class qf{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Zr()}mergeWith(e){return!1}write(e,n,r){throw Zr()}integrate(e,n){throw Zr()}}const OI=0;class ur extends qf{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),w_(e.doc.store,this)}write(e,n){e.writeInfo(OI),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Va{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Va(this.content)}splice(e){throw Zr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const CI=t=>new Va(t.readBuf());class Za{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Za(this.len)}splice(e){const n=new Za(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){bl(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const LI=t=>new Za(t.readLen()),G_=(t,e)=>new So({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Xa{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Xa(G_(this.doc.guid,this.opts))}splice(e){throw Zr()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const MI=t=>new Xa(G_(t.readString(),t.readAny()));class Fs{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Fs(this.embed)}splice(e){throw Zr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const UI=t=>new Fs(t.readJSON());class Ze{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ze(this.key,this.value)}splice(e){throw Zr()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const FI=t=>new Ze(t.readKey(),t.readJSON());class Cl{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Cl(this.arr)}splice(e){const n=new Cl(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const PI=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Cl(n)},BI=yl("node_env")==="development";class Ps{constructor(e){this.arr=e,BI&&qg(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ps(this.arr)}splice(e){const n=new Ps(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const DI=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Ps(n)};class ti{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ti(this.str)}splice(e){const n=new ti(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const $I=t=>new ti(t.readString()),jI=[yI,wI,vI,SI,AI,II,NI],zI=0,WI=1,HI=2,KI=3,GI=4,YI=5,VI=6;class Ri{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ri(this.type._copy())}splice(e){throw Zr()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const ZI=t=>new Ri(jI[t.readTypeRef()](t)),Ll=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Xe(qt(r,i+n),e,qt(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=qt(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Xe extends qf{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Mg:0}set marker(e){(this.info&yf)>0!==e&&(this.info^=yf)}get marker(){return(this.info&yf)>0}get keep(){return(this.info&Lg)>0}set keep(e){this.keep!==e&&(this.info^=Lg)}get countable(){return(this.info&Mg)>0}get deleted(){return(this.info&_f)>0}set deleted(e){this.deleted!==e&&(this.info^=_f)}markDeleted(){this.info|=_f}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=an(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=an(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Io&&this.id.client!==this.parent.client&&this.parent.clock>=an(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=E_(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ts(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ur||this.right&&this.right.constructor===ur)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Xe?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Xe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Io){const r=$f(n,this.parent);r.constructor===ur?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=E_(e,e.doc.store,qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),wl(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(wl(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has($f(e.doc.store,i.origin)))s.has($f(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),w_(e.doc.store,this),this.content.integrate(e,this),T_(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new ur(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:qt(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&wl(e.origin,this.lastId)&&this.right===e&&wl(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),bl(e.deleteSet,this.id.client,this.id.clock,this.length),T_(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Xr();this.content.gc(e),n?tI(e,this,new ur(this.id,this.length)):this.content=new Za(this.length)}write(e,n){const r=n>0?qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&hl|(r===null?0:Xn)|(i===null?0:Ti)|(s===null?0:Pa);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=QR(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Io?(e.writeParentInfo(!1),e.writeLeftID(a)):Xr();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Y_=(t,e)=>XI[e&hl](t),XI=[()=>{Xr()},LI,PI,CI,$I,UI,FI,ZI,DI,MI,()=>{Xr()}],qI=10;class hr extends qf{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Xr()}write(e,n){e.writeInfo(qI),ie(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const V_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof bo<"u"?bo:{},Z_="__ $YJS$ __";V_[Z_]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),V_[Z_]=!0;let X_=!1;const Qn=new So;function q_(t,e,n){const r=Qn.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function JI(t,e){q_(t,0,e)}function Jf(t,e){const n=new Si(e);q_(t,1,n)}function QI(t,e){Qn.getMap().set(t,e)}function tN(t,e){const n=Qn.getMap(),r=new Si(e);n.set(t,r)}function J_(t,e){const n=Qn.getMap();function r(i){const s=n.get(t);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function eN(t,e){return J_(t,n=>{St(n)&&e(n)})}function Q_(t,e){return J_(t,n=>{n instanceof Si&&e(n.toJSON())})}const Bs=oo("modem",["second"],t=>{if(Bs.session(t))switch(t.target){case"second":!X_&&t.data%2===0&&Bs.emit(t.player,"modem:join");break;case"join":t.sender!==Bs.id()&&Bs.reply(t,"joinack",Sg(XR(Qn)));break;case"joinack":t.sender!==Bs.id()&&(X_=!0,d_(Qn,cl(t.data),Qn));break;case"sync":{t.sender!==Bs.id()&&x(t.data)&&d_(Qn,cl(t.data),Qn);break}}});function ty(t,e){e!==Qn&&Bs.emit("","modem:sync",Sg(t))}Qn.on("update",ty),Qn.on("destroy",()=>{Qn.off("update",ty)});function nN(t,e){return t%e}function rN(t,e){return Math.floor(t/e)}function iN(t,e){return{x:nN(t,e),y:rN(t,e)}}function Uo(t,e){return t.x+t.y*e}function Fo(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function ey(t,e,n,r){const i=[],s=Math.min(t,n),o=Math.max(t,n),a=Math.min(e,r),c=Math.max(e,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function ny(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ry="176",sN="",Ir="srgb",iy="srgb-linear",sy="linear",Qf="srgb";function Nr(t,e,n){return Math.max(e,Math.min(n,t))}function oN(t,e){return(t%e+e)%e}function td(t,e,n){return(1-n)*t+n*e}class qa{constructor(e=0,n=0){qa.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Nr(this.x,e.x,n.x),this.y=Nr(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Nr(this.x,e,n),this.y=Nr(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Nr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Nr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ja{constructor(e,n,r,i,s,o,a,c,l){Ja.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],p=r[8],m=i[0],w=i[3],b=i[6],T=i[1],A=i[4],v=i[7],C=i[2],S=i[5],R=i[8];return s[0]=o*m+a*T+c*C,s[3]=o*w+a*A+c*S,s[6]=o*b+a*v+c*R,s[1]=l*m+u*T+f*C,s[4]=l*w+u*A+f*S,s[7]=l*b+u*v+f*R,s[2]=d*m+h*T+p*C,s[5]=d*w+h*A+p*S,s[8]=d*b+h*v+p*R,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,p=n*f+r*d+i*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=f*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=h*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(ed.makeScale(e,n)),this}rotate(e){return this.premultiply(ed.makeRotation(-e)),this}translate(e,n){return this.premultiply(ed.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ed=new Ja,oy=new Ja().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),ay=new Ja().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function aN(){const t={enabled:!0,workingColorSpace:iy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Qf&&(i.r=Po(i.r),i.g=Po(i.g),i.b=Po(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Qf&&(i.r=Bo(i.r),i.g=Bo(i.g),i.b=Bo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===sN?sy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[iy]:{primaries:e,whitePoint:r,transfer:sy,toXYZ:oy,fromXYZ:ay,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Ir},outputColorSpaceConfig:{drawingBufferColorSpace:Ir}},[Ir]:{primaries:e,whitePoint:r,transfer:Qf,toXYZ:oy,fromXYZ:ay,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Ir}}}),t}const Or=aN();function Po(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Bo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const cy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},rs={h:0,s:0,l:0},Ml={h:0,s:0,l:0};function nd(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class rd{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Ir){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Or.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Or.workingColorSpace){return this.r=e,this.g=n,this.b=r,Or.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Or.workingColorSpace){if(e=oN(e,1),n=Nr(n,0,1),r=Nr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=nd(o,s,e+1/3),this.g=nd(o,s,e),this.b=nd(o,s,e-1/3)}return Or.toWorkingColorSpace(this,i),this}setStyle(e,n=Ir){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Ir){const r=cy[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Po(e.r),this.g=Po(e.g),this.b=Po(e.b),this}copyLinearToSRGB(e){return this.r=Bo(e.r),this.g=Bo(e.g),this.b=Bo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ir){return Or.fromWorkingColorSpace(yn.copy(this),e),Math.round(Nr(yn.r*255,0,255))*65536+Math.round(Nr(yn.g*255,0,255))*256+Math.round(Nr(yn.b*255,0,255))}getHexString(e=Ir){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Or.workingColorSpace){Or.fromWorkingColorSpace(yn.copy(this),n);const r=yn.r,i=yn.g,s=yn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Or.workingColorSpace){return Or.fromWorkingColorSpace(yn.copy(this),n),e.r=yn.r,e.g=yn.g,e.b=yn.b,e}getStyle(e=Ir){Or.fromWorkingColorSpace(yn.copy(this),e);const n=yn.r,r=yn.g,i=yn.b;return e!==Ir?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(rs),this.setHSL(rs.h+e,rs.s+n,rs.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(rs),e.getHSL(Ml);const r=td(rs.h,Ml.h,n),i=td(rs.s,Ml.s,n),s=td(rs.l,Ml.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const yn=new rd;rd.NAMES=cy,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ry}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ry),new qa,new qa;function qe(t,e,n){return Math.max(e,Math.min(n,t))}function ly(t){return t/180*Math.PI}function id(t){return t*180/Math.PI}const cN=Ep("089fad0j9awfem09wavefc09uwaef");function lN(){return cN()}function uN(t){return Ep(t)()}function fr(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(lN()*i)}function uy(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(uN(t)*s)}function hy(t,e,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function hN(t){return t[fr(0,t.length-1)]}function fN(t,e){return e[uy(t,0,e.length-1)]}function Ae(...t){return hN(t.flat())}function fy(t,...e){return fN(t,e.flat())}function dN(t){return[...new Set(t)].filter(x)}function Do(t){return x(t)&&x(t.x)&&x(t.y)}function We(t,e){switch(e){case pt.NORTH:--t.y;break;case pt.SOUTH:++t.y;break;case pt.WEST:--t.x;break;case pt.EAST:++t.x;break}return t}function Ii(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return pt.WEST;if(n>0)return pt.EAST;if(r<0)return pt.NORTH;if(r>0)return pt.SOUTH}const sd={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Ni(t){return le(t)&&dy(t[0])}function dy(t){return x(pt[t])&&Et(t)}function pN(t){const e=pt[t];return x(e)?e:pt.IDLE}function od(t){if(Et(t))return sd[Nt(t)]}function mN(t){if(Ni(t))return t;if(dy(t))return[t];const e=od(t);if(x(e))return[e]}function py(t){const e=_.words[t],n=mN(e);return Ni(n)?[n,t+1]:[void 0,t]}function my(t){var i,s;const e=[];let[n,r]=py(t);for(;Ni(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(_.words,r,[$.NUMBER,$.NUMBER]);e.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(_.words,r,[$.DIR]);e.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=rt(_.words,r,[$.DIR,$.DIR]),f=((i=_.element)==null?void 0:i.x)??0,d=((s=_.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,e.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[e,r]}const[o,a]=py(r);n=o,r=a}return e.length?[e,r]:[void 0,t]}function gN(t){return x(t)&&t<jt.ONBLACK?t:void 0}function _N(t){return x(t)&&t>jt.WHITE&&t<jt.ONCLEAR?t-jt.ONBLACK:void 0}const Qa={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function ei(t){return le(t)&&_y(t[0])}function gy(t){return ei(t)&&t[0].startsWith("ON")}function _y(t){return x(jt[t])&&Et(t)}function ad(t){if(Et(t))return Qa[Nt(t)]}function yN(t){return t.map(e=>jt[e]).find(e=>x(e)&&e<jt.ONBLACK)}function bN(t){return t.map(e=>jt[e]).find(e=>x(e)&&e>=jt.ONBLACK)}function wN(t){if(ei(t))return t;if(_y(t))return[t];const e=ad(t);if(x(e))return[e]}function yy(t){const e=_.words[t],n=wN(e);return ei(n)?[n,t+1]:[void 0,t]}function cd(t){const e=[];let n=t;const[r,i]=yy(t);if(ei(r)&&(e.push(...r),n=i),ei(e)&&!gy(e)){const[s,o]=yy(i);gy(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function by(t){const e={};return t.every(n=>{const r=jt[n];x(r)&&(r<jt.ONBLACK?e.color=r:e.bg=r-jt.ONBLACK)}),e}function $o(t){return le(t)&&typeof t[0]=="string"}function EN(t){const e=_.words[t];return Et(e)?[e,t+1]:[void 0,t]}function wy(t){const e=_.words[t];if($o(e))return[e,t+1];const[n,r]=cd(t),[i,s]=EN(r);return Et(i)?[[i,n],s]:[void 0,t]}function ld(t){if(!$o(t))return;const[e]=t;return e}function Ey(t){if(!$o(t))return;const[,e]=t,n=x(e)?yN(e):void 0;return x(n)?n:void 0}function xy(t){if(!$o(t))return;const[,e]=t,n=x(e)?bN(e):void 0;return x(n)?n:void 0}var ud;try{ud=new TextDecoder}catch{}var gt,dr,W=0,me={},Jt,is,pr=0,ni=0,cn,Oi,Un=[],Vt,ky={useRecords:!1,mapsAsObjects:!0};class Ty{}const vy=new Ty;vy.name="MessagePack 0xC1";var ss=!1,Ay=2,Sy;try{new Function("")}catch{Ay=1/0}class tc{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(gt)return $y(()=>(md(),this?this.unpack(e,n):tc.prototype.unpack.call(ky,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof fn<"u"?fn.from(e):new Uint8Array(e)),typeof n=="object"?(dr=n.end||e.length,W=n.start||0):(W=0,dr=n>-1?n:e.length),ni=0,is=null,cn=null,gt=e;try{Vt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw gt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof tc){if(me=this,this.structures)return Jt=this.structures,Ul(n);(!Jt||Jt.length>0)&&(Jt=[])}else me=ky,(!Jt||Jt.length>0)&&(Jt=[]);return Ul(n)}unpackMultiple(e,n){let r,i=0;try{ss=!0;let s=e.length,o=this?this.unpack(e,s):Fl.unpack(e,s);if(n){if(n(o,i,W)===!1)return;for(;W<s;)if(i=W,n(Ul(),i,W)===!1)return}else{for(r=[o];W<s;)i=W,r.push(Ul());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{ss=!1,md()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Ul(t){try{if(!me.trusted&&!ss){let n=Jt.sharedLength||0;n<Jt.length&&(Jt.length=n)}let e;if(me.randomAccessStructure&&gt[W]<64&&gt[W]>=32&&Sy?(e=Sy(gt,W,dr,me),gt=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),W=dr):e=$e(),cn&&(W=cn.postBundlePosition,cn=null),ss&&(Jt.restoreStructures=null),W==dr)Jt&&Jt.restoreStructures&&Ry(),Jt=null,gt=null,Oi&&(Oi=null);else{if(W>dr)throw new Error("Unexpected end of MessagePack data");if(!ss){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Jt&&Jt.restoreStructures&&Ry(),md(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||W>dr)&&(e.incomplete=!0),e}}function Ry(){for(let t in Jt.restoreStructures)Jt[t]=Jt.restoreStructures[t];Jt.restoreStructures=null}function $e(){let t=gt[W++];if(t<160)if(t<128){if(t<64)return t;{let e=Jt[t&63]||me.getStructures&&Ny()[t&63];return e?(e.read||(e.read=hd(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,me.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Fy();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return me.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(ni>=W)return is.slice(W-pr,(W+=e)-pr);if(ni==0&&dr<140){let n=e<16?dd(e):Ly(e);if(n!=null)return n}return fd(e)}else{let e;switch(t){case 192:return null;case 193:return cn?(e=$e(),e>0?cn[1].slice(cn.position1,cn.position1+=e):cn[0].slice(cn.position0,cn.position0-=e)):vy;case 194:return!1;case 195:return!0;case 196:if(e=gt[W++],e===void 0)throw new Error("Unexpected end of buffer");return pd(e);case 197:return e=Vt.getUint16(W),W+=2,pd(e);case 198:return e=Vt.getUint32(W),W+=4,pd(e);case 199:return Ds(gt[W++]);case 200:return e=Vt.getUint16(W),W+=2,Ds(e);case 201:return e=Vt.getUint32(W),W+=4,Ds(e);case 202:if(e=Vt.getFloat32(W),me.useFloat32>2){let n=gd[(gt[W]&127)<<1|gt[W+1]>>7];return W+=4,(n*e+(e>0?.5:-.5)>>0)/n}return W+=4,e;case 203:return e=Vt.getFloat64(W),W+=8,e;case 204:return gt[W++];case 205:return e=Vt.getUint16(W),W+=2,e;case 206:return e=Vt.getUint32(W),W+=4,e;case 207:return me.int64AsType==="number"?(e=Vt.getUint32(W)*4294967296,e+=Vt.getUint32(W+4)):me.int64AsType==="string"?e=Vt.getBigUint64(W).toString():me.int64AsType==="auto"?(e=Vt.getBigUint64(W),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Vt.getBigUint64(W),W+=8,e;case 208:return Vt.getInt8(W++);case 209:return e=Vt.getInt16(W),W+=2,e;case 210:return e=Vt.getInt32(W),W+=4,e;case 211:return me.int64AsType==="number"?(e=Vt.getInt32(W)*4294967296,e+=Vt.getUint32(W+4)):me.int64AsType==="string"?e=Vt.getBigInt64(W).toString():me.int64AsType==="auto"?(e=Vt.getBigInt64(W),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Vt.getBigInt64(W),W+=8,e;case 212:if(e=gt[W++],e==114)return By(gt[W++]&63);{let n=Un[e];if(n)return n.read?(W++,n.read($e())):n.noBuffer?(W++,n()):n(gt.subarray(W,++W));throw new Error("Unknown extension "+e)}case 213:return e=gt[W],e==114?(W++,By(gt[W++]&63,gt[W++])):Ds(2);case 214:return Ds(4);case 215:return Ds(8);case 216:return Ds(16);case 217:return e=gt[W++],ni>=W?is.slice(W-pr,(W+=e)-pr):kN(e);case 218:return e=Vt.getUint16(W),W+=2,ni>=W?is.slice(W-pr,(W+=e)-pr):TN(e);case 219:return e=Vt.getUint32(W),W+=4,ni>=W?is.slice(W-pr,(W+=e)-pr):vN(e);case 220:return e=Vt.getUint16(W),W+=2,Oy(e);case 221:return e=Vt.getUint32(W),W+=4,Oy(e);case 222:return e=Vt.getUint16(W),W+=2,Cy(e);case 223:return e=Vt.getUint32(W),W+=4,Cy(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const xN=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function hd(t,e){function n(){if(n.count++>Ay){let i=t.read=new Function("r","return function(){return "+(me.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":xN.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")($e);return t.highByte===0&&(t.read=Iy(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=$e()}return me.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?Iy(e,n):n}const Iy=(t,e)=>function(){let n=gt[W++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Jt[r]||Ny()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=hd(i,t)),i.read()};function Ny(){let t=$y(()=>(gt=null,me.getStructures()));return Jt=me._mergeStructures(t,Jt)}var fd=ec,kN=ec,TN=ec,vN=ec;function ec(t){let e;if(t<16&&(e=dd(t)))return e;if(t>64&&ud)return ud.decode(gt.subarray(W,W+=t));const n=W+t,r=[];for(e="";W<n;){const i=gt[W++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gt[W++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gt[W++]&63,o=gt[W++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=gt[W++]&63,o=gt[W++]&63,a=gt[W++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=ln.apply(String,r),r.length=0)}return r.length>0&&(e+=ln.apply(String,r)),e}function Oy(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return me.freezeData?Object.freeze(e):e}function Cy(t){if(me.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Fy();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}}var ln=String.fromCharCode;function Ly(t){let e=W,n=new Array(t);for(let r=0;r<t;r++){const i=gt[W++];if((i&128)>0){W=e;return}n[r]=i}return ln.apply(String,n)}function dd(t){if(t<4)if(t<2){if(t===0)return"";{let e=gt[W++];if((e&128)>1){W-=1;return}return ln(e)}}else{let e=gt[W++],n=gt[W++];if((e&128)>0||(n&128)>0){W-=2;return}if(t<3)return ln(e,n);let r=gt[W++];if((r&128)>0){W-=3;return}return ln(e,n,r)}else{let e=gt[W++],n=gt[W++],r=gt[W++],i=gt[W++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){W-=4;return}if(t<6){if(t===4)return ln(e,n,r,i);{let s=gt[W++];if((s&128)>0){W-=5;return}return ln(e,n,r,i,s)}}else if(t<8){let s=gt[W++],o=gt[W++];if((s&128)>0||(o&128)>0){W-=6;return}if(t<7)return ln(e,n,r,i,s,o);let a=gt[W++];if((a&128)>0){W-=7;return}return ln(e,n,r,i,s,o,a)}else{let s=gt[W++],o=gt[W++],a=gt[W++],c=gt[W++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){W-=8;return}if(t<10){if(t===8)return ln(e,n,r,i,s,o,a,c);{let l=gt[W++];if((l&128)>0){W-=9;return}return ln(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=gt[W++],u=gt[W++];if((l&128)>0||(u&128)>0){W-=10;return}if(t<11)return ln(e,n,r,i,s,o,a,c,l,u);let f=gt[W++];if((f&128)>0){W-=11;return}return ln(e,n,r,i,s,o,a,c,l,u,f)}else{let l=gt[W++],u=gt[W++],f=gt[W++],d=gt[W++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){W-=12;return}if(t<14){if(t===12)return ln(e,n,r,i,s,o,a,c,l,u,f,d);{let h=gt[W++];if((h&128)>0){W-=13;return}return ln(e,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=gt[W++],p=gt[W++];if((h&128)>0||(p&128)>0){W-=14;return}if(t<15)return ln(e,n,r,i,s,o,a,c,l,u,f,d,h,p);let m=gt[W++];if((m&128)>0){W-=15;return}return ln(e,n,r,i,s,o,a,c,l,u,f,d,h,p,m)}}}}}function My(){let t=gt[W++],e;if(t<192)e=t-160;else switch(t){case 217:e=gt[W++];break;case 218:e=Vt.getUint16(W),W+=2;break;case 219:e=Vt.getUint32(W),W+=4;break;default:throw new Error("Expected string")}return ec(e)}function pd(t){return me.copyBuffers?Uint8Array.prototype.slice.call(gt,W,W+=t):gt.subarray(W,W+=t)}function Ds(t){let e=gt[W++];if(Un[e]){let n;return Un[e](gt.subarray(W,n=W+=t),r=>{W=r;try{return $e()}finally{W=n}})}else throw new Error("Unknown extension type "+e)}var Uy=new Array(4096);function Fy(){let t=gt[W++];if(t>=160&&t<192){if(t=t-160,ni>=W)return is.slice(W-pr,(W+=t)-pr);if(!(ni==0&&dr<180))return fd(t)}else return W--,Py($e());let e=(t<<5^(t>1?Vt.getUint16(W):t>0?gt[W]:0))&4095,n=Uy[e],r=W,i=W+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return W=r,n.string;i-=3,r=W}for(n=[],Uy[e]=n,n.bytes=t;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gt[r++],n.push(s);let a=t<16?dd(t):Ly(t);return a!=null?n.string=a:n.string=fd(t)}function Py(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const By=(t,e)=>{let n=$e().map(Py),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Jt[t];return i&&(i.isShared||ss)&&((Jt.restoreStructures||(Jt.restoreStructures=[]))[t]=i),Jt[t]=n,n.read=hd(n,r),n.read()};Un[0]=()=>{},Un[0].noBuffer=!0,Un[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let AN={Error,TypeError,ReferenceError};Un[101]=()=>{let t=$e();return(AN[t[0]]||Error)(t[1],{cause:t[2]})},Un[105]=t=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Vt.getUint32(W-4);Oi||(Oi=new Map);let n=gt[W],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Oi.set(e,i);let s=$e();return i.used?Object.assign(r,s):(i.target=s,s)},Un[112]=t=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Vt.getUint32(W-4),n=Oi.get(e);return n.used=!0,n.target},Un[115]=()=>new Set($e());const Dy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let SN=typeof globalThis=="object"?globalThis:window;Un[116]=t=>{let e=t[0],n=Dy[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new SN[n](Uint8Array.prototype.slice.call(t,1).buffer)},Un[120]=()=>{let t=$e();return new RegExp(t[0],t[1])};const RN=[];Un[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=W;return W+=e-t.length,cn=RN,cn=[My(),My()],cn.position0=0,cn.position1=0,cn.postBundlePosition=W,W=n,$e()},Un[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function $y(t){let e=dr,n=W,r=pr,i=ni,s=is,o=Oi,a=cn,c=new Uint8Array(gt.slice(0,dr)),l=Jt,u=Jt.slice(0,Jt.length),f=me,d=ss,h=t();return dr=e,W=n,pr=r,ni=i,is=s,Oi=o,cn=a,gt=c,ss=d,Jt=l,Jt.splice(0,Jt.length,...u),me=f,Vt=new DataView(gt.buffer,gt.byteOffset,gt.byteLength),h}function md(){gt=null,Oi=null,Jt=null}const gd=new Array(147);for(let t=0;t<256;t++)gd[t]=+("1e"+Math.floor(45.15-t*.30103));var Fl=new tc({useRecords:!1});const IN=Fl.unpack;Fl.unpackMultiple,Fl.unpack;let NN=new Float32Array(1);new Uint8Array(NN.buffer,0,4);let Pl;try{Pl=new TextEncoder}catch{}let _d,jy;const Bl=typeof fn<"u",Dl=Bl?function(t){return fn.allocUnsafeSlow(t)}:Uint8Array,zy=Bl?fn:Uint8Array,Wy=Bl?4294967296:2144337920;let q,nc,ge,K=0,Tn,Oe=null,ON;const CN=21760,LN=/[\u0080-\uFFFF]/,jo=Symbol("record-id");class MN extends tc{constructor(e){super(e),this.offset=0;let n,r,i,s,o=zy.prototype.utf8Write?function(N,E){return q.utf8Write(N,E,q.byteLength-E)}:Pl&&Pl.encodeInto?function(N,E){return Pl.encodeInto(N,q.subarray(E)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let f=e.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,p=u+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],w=0,b=0;this.pack=this.encode=function(N,E){if(q||(q=new Dl(8192),ge=q.dataView||(q.dataView=new DataView(q.buffer,0,8192)),K=0),Tn=q.length-10,Tn-K<2048?(q=new Dl(q.length),ge=q.dataView||(q.dataView=new DataView(q.buffer,0,q.length)),Tn=q.length-10,K=0):K=K+7&2147483640,n=K,E&jN&&(K+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof N!="string"?(Oe=[],Oe.size=1/0):Oe=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Q=i.sharedLength||0;if(Q>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let j=0;j<Q;j++){let st=i[j];if(!st)continue;let et,ft=i.transitions;for(let Z=0,H=st.length;Z<H;Z++){let wt=st[Z];et=ft[wt],et||(et=ft[wt]=Object.create(null)),ft=et}ft[jo]=j+64}this.lastNamedStructuresLength=Q}c||(i.nextId=Q+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&N&&N.constructor&&N.constructor===Object?L(N):v(N);let Q=Oe;if(Oe&&Gy(n,v,0),s&&s.idsToInsert){let j=s.idsToInsert.sort((Z,H)=>Z.offset>H.offset?1:-1),st=j.length,et=-1;for(;Q&&st>0;){let Z=j[--st].offset+n;Z<Q.stringsPosition+n&&et===-1&&(et=0),Z>Q.position+n?et>=0&&(et+=6):(et>=0&&(ge.setUint32(Q.position+n,ge.getUint32(Q.position+n)+et),et=-1),Q=Q.previous,st++)}et>=0&&Q&&ge.setUint32(Q.position+n,ge.getUint32(Q.position+n)+et),K+=j.length*6,K>Tn&&O(K),a.offset=K;let ft=FN(q.subarray(n,K),j);return s=null,ft}return a.offset=K,E&DN?(q.start=n,q.end=K,q):q.subarray(n,K)}catch(Q){throw B=Q,Q}finally{if(i&&(T(),r&&a.saveStructures)){let Q=i.sharedLength||0,j=q.subarray(n,K),st=PN(i,a);if(!B)return a.saveStructures(st,st.isCompatible)===!1?a.pack(N,E):(a.lastNamedStructuresLength=Q,q.length>1073741824&&(q=null),j)}q.length>1073741824&&(q=null),E&$N&&(K=n)}};const T=()=>{b<10&&b++;let N=i.sharedLength||0;if(i.length>N&&!c&&(i.length=N),w>1e4)i.transitions=null,b=0,w=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,B=m.length;E<B;E++)m[E][jo]=0;m=[]}},A=N=>{var E=N.length;E<16?q[K++]=144|E:E<65536?(q[K++]=220,q[K++]=E>>8,q[K++]=E&255):(q[K++]=221,ge.setUint32(K,E),K+=4);for(let B=0;B<E;B++)v(N[B])},v=N=>{K>Tn&&(q=O(K));var E=typeof N,B;if(E==="string"){let Q=N.length;if(Oe&&Q>=4&&Q<4096){if((Oe.size+=Q)>CN){let ft,Z=(Oe[0]?Oe[0].length*3+Oe[1].length:0)+10;K+Z>Tn&&(q=O(K+Z));let H;Oe.position?(H=Oe,q[K]=200,K+=3,q[K++]=98,ft=K-n,K+=4,Gy(n,v,0),ge.setUint16(ft+n-3,K-n-ft)):(q[K++]=214,q[K++]=98,ft=K-n,K+=4),Oe=["",""],Oe.previous=H,Oe.size=0,Oe.position=ft}let et=LN.test(N);Oe[et?0:1]+=N,q[K++]=193,v(et?-Q:Q);return}let j;Q<32?j=1:Q<256?j=2:Q<65536?j=3:j=5;let st=Q*3;if(K+st>Tn&&(q=O(K+st)),Q<64||!o){let et,ft,Z,H=K+j;for(et=0;et<Q;et++)ft=N.charCodeAt(et),ft<128?q[H++]=ft:ft<2048?(q[H++]=ft>>6|192,q[H++]=ft&63|128):(ft&64512)===55296&&((Z=N.charCodeAt(et+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(Z&1023),et++,q[H++]=ft>>18|240,q[H++]=ft>>12&63|128,q[H++]=ft>>6&63|128,q[H++]=ft&63|128):(q[H++]=ft>>12|224,q[H++]=ft>>6&63|128,q[H++]=ft&63|128);B=H-K-j}else B=o(N,K+j);B<32?q[K++]=160|B:B<256?(j<2&&q.copyWithin(K+2,K+1,K+1+B),q[K++]=217,q[K++]=B):B<65536?(j<3&&q.copyWithin(K+3,K+2,K+2+B),q[K++]=218,q[K++]=B>>8,q[K++]=B&255):(j<5&&q.copyWithin(K+5,K+3,K+3+B),q[K++]=219,ge.setUint32(K,B),K+=4),K+=B}else if(E==="number")if(N>>>0===N)N<32||N<128&&this.useRecords===!1||N<64&&!this.randomAccessStructure?q[K++]=N:N<256?(q[K++]=204,q[K++]=N):N<65536?(q[K++]=205,q[K++]=N>>8,q[K++]=N&255):(q[K++]=206,ge.setUint32(K,N),K+=4);else if(N>>0===N)N>=-32?q[K++]=256+N:N>=-128?(q[K++]=208,q[K++]=N+256):N>=-32768?(q[K++]=209,ge.setInt16(K,N),K+=2):(q[K++]=210,ge.setInt32(K,N),K+=4);else{let Q;if((Q=this.useFloat32)>0&&N<4294967296&&N>=-2147483648){q[K++]=202,ge.setFloat32(K,N);let j;if(Q<4||(j=N*gd[(q[K]&127)<<1|q[K+1]>>7])>>0===j){K+=4;return}else K--}q[K++]=203,ge.setFloat64(K,N),K+=8}else if(E==="object"||E==="function")if(!N)q[K++]=192;else{if(s){let j=s.get(N);if(j){if(!j.id){let st=s.idsToInsert||(s.idsToInsert=[]);j.id=st.push(j)}q[K++]=214,q[K++]=112,ge.setUint32(K,j.id),K+=4;return}else s.set(N,{offset:K-n})}let Q=N.constructor;if(Q===Object)U(N);else if(Q===Array)A(N);else if(Q===Map)if(this.mapAsEmptyObject)q[K++]=128;else{B=N.size,B<16?q[K++]=128|B:B<65536?(q[K++]=222,q[K++]=B>>8,q[K++]=B&255):(q[K++]=223,ge.setUint32(K,B),K+=4);for(let[j,st]of N)v(j),v(st)}else{for(let j=0,st=_d.length;j<st;j++){let et=jy[j];if(N instanceof et){let ft=_d[j];if(ft.write){ft.type&&(q[K++]=212,q[K++]=ft.type,q[K++]=0);let lt=ft.write.call(this,N);lt===N?Array.isArray(N)?A(N):U(N):v(lt);return}let Z=q,H=ge,wt=K;q=null;let at;try{at=ft.pack.call(this,N,lt=>(q=Z,Z=null,K+=lt,K>Tn&&O(K),{target:q,targetView:ge,position:K-lt}),v)}finally{Z&&(q=Z,ge=H,K=wt,Tn=q.length-10)}at&&(at.length+K>Tn&&O(at.length+K),K=UN(at,q,K,ft.type));return}}if(Array.isArray(N))A(N);else{if(N.toJSON){const j=N.toJSON();if(j!==N)return v(j)}if(E==="function")return v(this.writeFunction&&this.writeFunction(N));U(N)}}}else if(E==="boolean")q[K++]=N?195:194;else if(E==="bigint"){if(N<BigInt(1)<<BigInt(63)&&N>=-(BigInt(1)<<BigInt(63)))q[K++]=211,ge.setBigInt64(K,N);else if(N<BigInt(1)<<BigInt(64)&&N>0)q[K++]=207,ge.setBigUint64(K,N);else if(this.largeBigIntToFloat)q[K++]=203,ge.setFloat64(K,Number(N));else{if(this.largeBigIntToString)return v(N.toString());if(this.useBigIntExtension&&N<BigInt(2)**BigInt(1023)&&N>-(BigInt(2)**BigInt(1023))){q[K++]=199,K++,q[K++]=66;let Q=[],j;do{let st=N&BigInt(255);j=(st&BigInt(128))===(N<BigInt(0)?BigInt(128):BigInt(0)),Q.push(st),N>>=BigInt(8)}while(!((N===BigInt(0)||N===BigInt(-1))&&j));q[K-2]=Q.length;for(let st=Q.length;st>0;)q[K++]=Number(Q[--st]);return}else throw new RangeError(N+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}K+=8}else if(E==="undefined")this.encodeUndefinedAsNil?q[K++]=192:(q[K++]=212,q[K++]=0,q[K++]=0);else throw new Error("Unknown type: "+E)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?N=>{let E;if(this.skipValues){E=[];for(let j in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(j))&&!this.skipValues.includes(N[j])&&E.push(j)}else E=Object.keys(N);let B=E.length;B<16?q[K++]=128|B:B<65536?(q[K++]=222,q[K++]=B>>8,q[K++]=B&255):(q[K++]=223,ge.setUint32(K,B),K+=4);let Q;if(this.coercibleKeyAsNumber)for(let j=0;j<B;j++){Q=E[j];let st=Number(Q);v(isNaN(st)?Q:st),v(N[Q])}else for(let j=0;j<B;j++)v(Q=E[j]),v(N[Q])}:N=>{q[K++]=222;let E=K-n;K+=2;let B=0;for(let Q in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(Q))&&(v(Q),v(N[Q]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');q[E+++n]=B>>8,q[E+n]=B&255},S=this.useRecords===!1?C:e.progressiveRecords&&!d?N=>{let E,B=i.transitions||(i.transitions=Object.create(null)),Q=K++-n,j;for(let st in N)if(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st)){if(E=B[st],E)B=E;else{let et=Object.keys(N),ft=B;B=i.transitions;let Z=0;for(let H=0,wt=et.length;H<wt;H++){let at=et[H];E=B[at],E||(E=B[at]=Object.create(null),Z++),B=E}Q+n+1==K?(K--,D(B,et,Z)):V(B,et,Q,Z),j=!0,B=ft[st]}v(N[st])}if(!j){let st=B[jo];st?q[Q+n]=st:V(B,Object.keys(N),Q,0)}}:N=>{let E,B=i.transitions||(i.transitions=Object.create(null)),Q=0;for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&(E=B[st],E||(E=B[st]=Object.create(null),Q++),B=E);let j=B[jo];j?j>=96&&d?(q[K++]=((j-=96)&31)+96,q[K++]=j>>5):q[K++]=j:D(B,B.__keys__||Object.keys(N),Q);for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&v(N[st])},R=typeof this.useRecords=="function"&&this.useRecords,U=R?N=>{R(N)?S(N):C(N)}:S,O=N=>{let E;if(N>16777216){if(N-n>Wy)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(Wy,Math.round(Math.max((N-n)*(N>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(N-n<<2,q.length-1)>>12)+1<<12;let B=new Dl(E);return ge=B.dataView||(B.dataView=new DataView(B.buffer,0,E)),N=Math.min(N,q.length),q.copy?q.copy(B,0,n,N):B.set(q.slice(n,N)),K-=n,n=0,Tn=B.length-10,q=B},D=(N,E,B)=>{let Q=i.nextId;Q||(Q=64),Q<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(Q=i.nextOwnId,Q<p||(Q=h),i.nextOwnId=Q+1):(Q>=p&&(Q=h),i.nextId=Q+1);let j=E.highByte=Q>=96&&d?Q-96>>5:-1;N[jo]=Q,N.__keys__=E,i[Q-64]=E,Q<h?(E.isShared=!0,i.sharedLength=Q-63,r=!0,j>=0?(q[K++]=(Q&31)+96,q[K++]=j):q[K++]=Q):(j>=0?(q[K++]=213,q[K++]=114,q[K++]=(Q&31)+96,q[K++]=j):(q[K++]=212,q[K++]=114,q[K++]=Q),B&&(w+=b*B),m.length>=f&&(m.shift()[jo]=0),m.push(N),v(E))},V=(N,E,B,Q)=>{let j=q,st=K,et=Tn,ft=n;q=nc,K=0,n=0,q||(nc=q=new Dl(8192)),Tn=q.length-10,D(N,E,Q),nc=q;let Z=K;if(q=j,K=st,Tn=et,n=ft,Z>1){let H=K+Z-1;H>Tn&&O(H);let wt=B+n;q.copyWithin(wt+Z,wt+1,K),q.set(nc.slice(0,Z),wt),K=H}else q[B+n]=nc[0]},L=N=>{let E=ON(N,q,n,K,i,O,(B,Q,j)=>{if(j)return r=!0;K=Q;let st=q;return v(B),T(),st!==q?{position:K,targetView:ge,target:q}:K},this);if(E===0)return U(N);K=E}}useBuffer(e){q=e,q.dataView||(q.dataView=new DataView(q.buffer,q.byteOffset,q.byteLength)),K=0}set position(e){K=e}get position(){return K}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}jy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Ty],_d=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?Hy(t,16,e):Ky(Bl?fn.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==zy&&this.moreTypes?Hy(t,Dy.indexOf(n.name),e):Ky(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function Hy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Ky(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function UN(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function FN(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function Gy(t,e,n){if(Oe.length>0){ge.setUint32(Oe.position+t,K+n-Oe.position-t),Oe.stringsPosition=K-t;let r=Oe;Oe=null,e(r[0]),e(r[1])}}function PN(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let Yy=new MN({useRecords:!1});const BN=Yy.pack;Yy.pack;const DN=512,$N=1024,jN=2048,G=oo("SOFTWARE");function Se(){return null}function zo(t,e,n={}){if(!x(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];x(c)&&(a=c(a));const l=e[o];x(l)&&(o=l),a!==null&&r.push(o,a)}return r}function rc(t,e,n={}){if(x(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){de(G,"","binary",r.message)}}function zN(t){try{const e=Yn(t);return BN(e)}catch(e){de(G,"","binary",e.message)}}function WN(t){try{return IN(t)}catch(e){de(G,"","binary",e.message)}}function Vy(){return{id:Me()}}var $l=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.destructible=16]="destructible",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t))($l||{});function jl(t){return x(t==null?void 0:t.id)?zo(t,$l,{category:Se,kinddata:Se,stopped:Se,removed:Se,bucket:Se}):zo(t,$l,{id:Se,x:Se,y:Se,lx:Se,ly:Se,code:Se,category:Se,kinddata:Se,stopped:Se,removed:Se,bucket:Se})}function zl(t){return rc(t,$l)}function bn(t){var e;return(((e=t==null?void 0:t.id)==null?void 0:e.length)??0)>0}function ic(t,e){if(!x(t)||!ei(e))return;const{color:n,bg:r}=by(e);x(n)&&(t.color=n),x(r)&&(t.bg=r)}function os(t){var e;return Nt((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}const Rt=60,Qt=25,yd=Rt*Qt;var _t=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(_t||{});function HN(){return new Array(Rt*Qt).map(()=>{})}function bd(t=xh){const e={terrain:HN(),objects:{},id:""};return t(e)}var wd=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(wd||{});function KN(t){return zo(t,wd,{terrain:e=>e.map(jl),objects:e=>Object.values(e).filter(n=>!n.removed).map(jl),id:Se,named:Se,lookup:Se,codepage:Se,distmaps:Se,overboard:Se,underboard:Se})}function GN(t){return rc(t,wd,{terrain:e=>e.map(zl),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=zl(e[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Wl(t){return Fo(t.x,t.y,0,Rt-1,Qt-1,0)}function Cr(t,e){return!x(t)||!x(e==null?void 0:e.x)||!x(e==null?void 0:e.y)||e.x<0||e.x>=Rt||e.y<0||e.y>=Qt?-1:e.x+e.y*Rt}function _e(t,e){const n=Cr(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=vn(t,t.lookup[n]??"");return x(r)?r:t.terrain[n]}function YN(t,e){const n=vn(t,e);if(x(n))return n;const r=parseFloat(e),i=iN(isNaN(r)?-1:r,Rt);return Wo(t,i.x,i.y)}function Wo(t,e,n){return(e>=0&&e<Rt)??(n>=0&&n<Qt)?t==null?void 0:t.terrain[e+n*Rt]:void 0}function un(t,e){if(!x(t)||!x(e)||!x(e.x)||!x(e.y)||e.x<0||e.x>=Rt||e.y<0||e.y>=Qt)return;const n=Yn(e),r=e.x+e.y*Rt;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function Ed(t,e){if(!x(t)||!x(e))return;const n=Yn(e);return n.id=n.id??Me(),t.objects[n.id]=n,t.objects[n.id]}function VN(t,e,n){return un(t,{...e,kind:n})}function xd(t,e,n,r){return Ed(t,{...e,kind:n,id:r})}function vn(t,e){if(t)return t.objects[e]}function ZN(t,e){const n=Cr(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=vn(t,t.lookup[n]??"");if(x(r))return r}function Zy(t,e){return x(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function XN(t,e,n){if(!x(t)||!x(e))return;const r=t.objects[n];if(x(r))return r;if(Do(e))return Jy(e,oc(t,"player"))}function Ho(t,e){const n=t??Kt.ISWALK,r=e??Kt.ISWALK;switch(n){case Kt.ISWALK:return r!==Kt.ISWALK;case Kt.ISSWIM:return r!==Kt.ISSWIM;case Kt.ISSOLID:return!0;case Kt.ISBULLET:return r!==Kt.ISWALK&&r!==Kt.ISSWIM}}function sc(t,e,n){const r=t==null?void 0:t.objects[n];if(x(r))return r;const i=oc(t,"player");return x(e)?(e.x<0&&(e.x=fr(0,Rt-1)),e.y<0&&(e.y=fr(0,Qt-1)),Jy(e,i)):Ae(...i)}function oc(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(x)}function qN(t){const e=[];for(let n=0;n<Qt;++n)for(let r=0;r<Rt;++r){const i={x:r,y:n},s=_e(t,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&e.push(i)}return e}function Xy(t,e){const n=ld(e),r=Ey(e),i=xy(e);return oc(t,n??"").filter(s=>{var o,a,c;return!(x(n)&&Nt((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??jt.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??jt.BLACK)!==i)}).filter(x)}function qy(t,e){return x(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(x(i))return i;const s=oc(t,Nt(n));if(s.length)return s}else if(Do(n)&&n.x>=0&&n.x<Rt&&n.y>=0&&n.y<Qt){const i=n.x+n.y*Rt,s=(r=t.lookup)==null?void 0:r[i];return x(s)?t.objects[s]:t.terrain[i]}}).flat().filter(x):[]}function Jy(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function Qy(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}const kd=14,ac=3,Hl=8,Kl=14,Gl=16,JN=16,QN=16;var Yl=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(Yl||{});function Vl(t,e){return new Array(t).fill(e)}function tO(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:Vl(s,0),color:Vl(s,0),bg:Vl(s,i)}}function eO(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:jt.ONCLEAR}}function nO(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function rO(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:Vl(s,i)}}function iO(t,e,n,r){return{id:`media:${t}:${e}`,type:4,mime:n,media:r}}function sO(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function t1(t,e){return`${t}:${e}`}const oO=1,aO=16,cO=256;var An=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(An||{});function Td(t){const e=Math.floor(t.length/ac);if(e*ac!==t.length)return;const n=Qy(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function lO(t,e){return t&1<<e?255:0}function e1(t){const e=Math.floor(t.length/kd);if(e*kd!==t.length)return;const n=Math.ceil(e/Gl),r=Hl*Gl,i=Qy(r,Kl*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*Kl+a,u=t[c];for(let f=0;f<Hl;++f){const d=s*Hl+f;i.bits[d+l*r]=lO(u,7-f)}++a,a===Kl&&(a=0,++s,s===Gl&&(s=0,++o))}return i}const uO=cl("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),n1=cl("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var r1=typeof bo=="object"&&bo&&bo.Object===Object&&bo,hO=typeof self=="object"&&self&&self.Object===Object&&self,ri=r1||hO||Function("return this")(),mr=ri.Symbol,i1=Object.prototype,fO=i1.hasOwnProperty,dO=i1.toString,cc=mr?mr.toStringTag:void 0;function pO(t){var e=fO.call(t,cc),n=t[cc];try{t[cc]=void 0;var r=!0}catch{}var i=dO.call(t);return r&&(e?t[cc]=n:delete t[cc]),i}var mO=Object.prototype,gO=mO.toString;function _O(t){return gO.call(t)}var yO="[object Null]",bO="[object Undefined]",s1=mr?mr.toStringTag:void 0;function as(t){return t==null?t===void 0?bO:yO:s1&&s1 in Object(t)?pO(t):_O(t)}function Lr(t){return t!=null&&typeof t=="object"}var wO="[object Symbol]";function Zl(t){return typeof t=="symbol"||Lr(t)&&as(t)==wO}function Xl(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var ne=Array.isArray,EO=1/0,o1=mr?mr.prototype:void 0,a1=o1?o1.toString:void 0;function c1(t){if(typeof t=="string")return t;if(ne(t))return Xl(t,c1)+"";if(Zl(t))return a1?a1.call(t):"";var e=t+"";return e=="0"&&1/t==-EO?"-0":e}var xO=/\s/;function kO(t){for(var e=t.length;e--&&xO.test(t.charAt(e)););return e}var TO=/^\s+/;function vO(t){return t&&t.slice(0,kO(t)+1).replace(TO,"")}function gr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var l1=NaN,AO=/^[-+]0x[0-9a-f]+$/i,SO=/^0b[01]+$/i,RO=/^0o[0-7]+$/i,IO=parseInt;function NO(t){if(typeof t=="number")return t;if(Zl(t))return l1;if(gr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=gr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=vO(t);var n=SO.test(t);return n||RO.test(t)?IO(t.slice(2),n?2:8):AO.test(t)?l1:+t}var u1=1/0,OO=17976931348623157e292;function CO(t){if(!t)return t===0?t:0;if(t=NO(t),t===u1||t===-u1){var e=t<0?-1:1;return e*OO}return t===t?t:0}function ql(t){var e=CO(t),n=e%1;return e===e?n?e-n:e:0}function Ko(t){return t}var LO="[object AsyncFunction]",MO="[object Function]",UO="[object GeneratorFunction]",FO="[object Proxy]";function Ci(t){if(!gr(t))return!1;var e=as(t);return e==MO||e==UO||e==LO||e==FO}var vd=ri["__core-js_shared__"],h1=function(){var t=/[^.]+$/.exec(vd&&vd.keys&&vd.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function PO(t){return!!h1&&h1 in t}var BO=Function.prototype,DO=BO.toString;function $s(t){if(t!=null){try{return DO.call(t)}catch{}try{return t+""}catch{}}return""}var $O=/[\\^$.*+?()[\]{}|]/g,jO=/^\[object .+?Constructor\]$/,zO=Function.prototype,WO=Object.prototype,HO=zO.toString,KO=WO.hasOwnProperty,GO=RegExp("^"+HO.call(KO).replace($O,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function YO(t){if(!gr(t)||PO(t))return!1;var e=Ci(t)?GO:jO;return e.test($s(t))}function VO(t,e){return t==null?void 0:t[e]}function js(t,e){var n=VO(t,e);return YO(n)?n:void 0}var Ad=js(ri,"WeakMap"),f1=Object.create,ZO=function(){function t(){}return function(e){if(!gr(e))return{};if(f1)return f1(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function XO(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Je(){}function qO(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var JO=800,QO=16,tC=Date.now;function eC(t){var e=0,n=0;return function(){var r=tC(),i=QO-(r-n);if(n=r,i>0){if(++e>=JO)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function nC(t){return function(){return t}}var Jl=function(){try{var t=js(Object,"defineProperty");return t({},"",{}),t}catch{}}(),rC=Jl?function(t,e){return Jl(t,"toString",{configurable:!0,enumerable:!1,value:nC(e),writable:!0})}:Ko,iC=eC(rC);function d1(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function p1(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function sC(t){return t!==t}function oC(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Sd(t,e,n){return e===e?oC(t,e,n):p1(t,sC,n)}function m1(t,e){var n=t==null?0:t.length;return!!n&&Sd(t,e,0)>-1}var aC=9007199254740991,cC=/^(?:0|[1-9]\d*)$/;function Ql(t,e){var n=typeof t;return e=e??aC,!!e&&(n=="number"||n!="symbol"&&cC.test(t))&&t>-1&&t%1==0&&t<e}function Rd(t,e,n){e=="__proto__"&&Jl?Jl(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function lc(t,e){return t===e||t!==t&&e!==e}var lC=Object.prototype,uC=lC.hasOwnProperty;function tu(t,e,n){var r=t[e];(!(uC.call(t,e)&&lc(r,n))||n===void 0&&!(e in t))&&Rd(t,e,n)}function Id(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Rd(n,a,c):tu(n,a,c)}return n}var g1=Math.max;function hC(t,e,n){return e=g1(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=g1(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),XO(t,this,a)}}function Nd(t,e){return iC(hC(t,e,Ko),t+"")}var fC=9007199254740991;function Od(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=fC}function ii(t){return t!=null&&Od(t.length)&&!Ci(t)}function _1(t,e,n){if(!gr(n))return!1;var r=typeof e;return(r=="number"?ii(n)&&Ql(e,n.length):r=="string"&&e in n)?lc(n[e],t):!1}function dC(t){return Nd(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&_1(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var pC=Object.prototype;function uc(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||pC;return t===n}function mC(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var gC="[object Arguments]";function y1(t){return Lr(t)&&as(t)==gC}var b1=Object.prototype,_C=b1.hasOwnProperty,yC=b1.propertyIsEnumerable,eu=y1(function(){return arguments}())?y1:function(t){return Lr(t)&&_C.call(t,"callee")&&!yC.call(t,"callee")};function bC(){return!1}var w1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,E1=w1&&typeof module=="object"&&module&&!module.nodeType&&module,wC=E1&&E1.exports===w1,x1=wC?ri.Buffer:void 0,EC=x1?x1.isBuffer:void 0,hc=EC||bC,xC="[object Arguments]",kC="[object Array]",TC="[object Boolean]",vC="[object Date]",AC="[object Error]",SC="[object Function]",RC="[object Map]",IC="[object Number]",NC="[object Object]",OC="[object RegExp]",CC="[object Set]",LC="[object String]",MC="[object WeakMap]",UC="[object ArrayBuffer]",FC="[object DataView]",PC="[object Float32Array]",BC="[object Float64Array]",DC="[object Int8Array]",$C="[object Int16Array]",jC="[object Int32Array]",zC="[object Uint8Array]",WC="[object Uint8ClampedArray]",HC="[object Uint16Array]",KC="[object Uint32Array]",xe={};xe[PC]=xe[BC]=xe[DC]=xe[$C]=xe[jC]=xe[zC]=xe[WC]=xe[HC]=xe[KC]=!0,xe[xC]=xe[kC]=xe[UC]=xe[TC]=xe[FC]=xe[vC]=xe[AC]=xe[SC]=xe[RC]=xe[IC]=xe[NC]=xe[OC]=xe[CC]=xe[LC]=xe[MC]=!1;function GC(t){return Lr(t)&&Od(t.length)&&!!xe[as(t)]}function nu(t){return function(e){return t(e)}}var k1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fc=k1&&typeof module=="object"&&module&&!module.nodeType&&module,YC=fc&&fc.exports===k1,Cd=YC&&r1.process,cs=function(){try{var t=fc&&fc.require&&fc.require("util").types;return t||Cd&&Cd.binding&&Cd.binding("util")}catch{}}(),T1=cs&&cs.isTypedArray,Ld=T1?nu(T1):GC,VC=Object.prototype,ZC=VC.hasOwnProperty;function v1(t,e){var n=ne(t),r=!n&&eu(t),i=!n&&!r&&hc(t),s=!n&&!r&&!i&&Ld(t),o=n||r||i||s,a=o?mC(t.length,String):[],c=a.length;for(var l in t)(e||ZC.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Ql(l,c)))&&a.push(l);return a}function A1(t,e){return function(n){return t(e(n))}}var XC=A1(Object.keys,Object),qC=Object.prototype,JC=qC.hasOwnProperty;function S1(t){if(!uc(t))return XC(t);var e=[];for(var n in Object(t))JC.call(t,n)&&n!="constructor"&&e.push(n);return e}function _r(t){return ii(t)?v1(t):S1(t)}var QC=Object.prototype,t6=QC.hasOwnProperty,Fn=dC(function(t,e){if(uc(e)||ii(e)){Id(e,_r(e),t);return}for(var n in e)t6.call(e,n)&&tu(t,n,e[n])});function e6(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var n6=Object.prototype,r6=n6.hasOwnProperty;function i6(t){if(!gr(t))return e6(t);var e=uc(t),n=[];for(var r in t)r=="constructor"&&(e||!r6.call(t,r))||n.push(r);return n}function R1(t){return ii(t)?v1(t,!0):i6(t)}var s6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o6=/^\w*$/;function Md(t,e){if(ne(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Zl(t)?!0:o6.test(t)||!s6.test(t)||e!=null&&t in Object(e)}var dc=js(Object,"create");function a6(){this.__data__=dc?dc(null):{},this.size=0}function c6(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var l6="__lodash_hash_undefined__",u6=Object.prototype,h6=u6.hasOwnProperty;function f6(t){var e=this.__data__;if(dc){var n=e[t];return n===l6?void 0:n}return h6.call(e,t)?e[t]:void 0}var d6=Object.prototype,p6=d6.hasOwnProperty;function m6(t){var e=this.__data__;return dc?e[t]!==void 0:p6.call(e,t)}var g6="__lodash_hash_undefined__";function _6(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=dc&&e===void 0?g6:e,this}function zs(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}zs.prototype.clear=a6,zs.prototype.delete=c6,zs.prototype.get=f6,zs.prototype.has=m6,zs.prototype.set=_6;function y6(){this.__data__=[],this.size=0}function ru(t,e){for(var n=t.length;n--;)if(lc(t[n][0],e))return n;return-1}var b6=Array.prototype,w6=b6.splice;function E6(t){var e=this.__data__,n=ru(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():w6.call(e,n,1),--this.size,!0}function x6(t){var e=this.__data__,n=ru(e,t);return n<0?void 0:e[n][1]}function k6(t){return ru(this.__data__,t)>-1}function T6(t,e){var n=this.__data__,r=ru(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Li(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Li.prototype.clear=y6,Li.prototype.delete=E6,Li.prototype.get=x6,Li.prototype.has=k6,Li.prototype.set=T6;var pc=js(ri,"Map");function v6(){this.size=0,this.__data__={hash:new zs,map:new(pc||Li),string:new zs}}function A6(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function iu(t,e){var n=t.__data__;return A6(e)?n[typeof e=="string"?"string":"hash"]:n.map}function S6(t){var e=iu(this,t).delete(t);return this.size-=e?1:0,e}function R6(t){return iu(this,t).get(t)}function I6(t){return iu(this,t).has(t)}function N6(t,e){var n=iu(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Mi(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Mi.prototype.clear=v6,Mi.prototype.delete=S6,Mi.prototype.get=R6,Mi.prototype.has=I6,Mi.prototype.set=N6;var O6="Expected a function";function Ud(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(O6);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Ud.Cache||Mi),n}Ud.Cache=Mi;var C6=500;function L6(t){var e=Ud(t,function(r){return n.size===C6&&n.clear(),r}),n=e.cache;return e}var M6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,U6=/\\(\\)?/g,F6=L6(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(M6,function(n,r,i,s){e.push(i?s.replace(U6,"$1"):r||n)}),e});function I1(t){return t==null?"":c1(t)}function su(t,e){return ne(t)?t:Md(t,e)?[t]:F6(I1(t))}var P6=1/0;function mc(t){if(typeof t=="string"||Zl(t))return t;var e=t+"";return e=="0"&&1/t==-P6?"-0":e}function Fd(t,e){e=su(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[mc(e[n++])];return n&&n==r?t:void 0}function B6(t,e,n){var r=t==null?void 0:Fd(t,e);return r===void 0?n:r}function Pd(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var N1=mr?mr.isConcatSpreadable:void 0;function D6(t){return ne(t)||eu(t)||!!(N1&&t&&t[N1])}function Bd(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=D6),i||(i=[]);++s<o;){var a=t[s];n(a)?Pd(i,a):r||(i[i.length]=a)}return i}function tr(t){var e=t==null?0:t.length;return e?Bd(t):[]}var O1=A1(Object.getPrototypeOf,Object);function Dd(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function $6(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:Dd(t,e,n)}var j6="\\ud800-\\udfff",z6="\\u0300-\\u036f",W6="\\ufe20-\\ufe2f",H6="\\u20d0-\\u20ff",K6=z6+W6+H6,G6="\\ufe0e\\ufe0f",Y6="\\u200d",V6=RegExp("["+Y6+j6+K6+G6+"]");function C1(t){return V6.test(t)}function Z6(t){return t.split("")}var L1="\\ud800-\\udfff",X6="\\u0300-\\u036f",q6="\\ufe20-\\ufe2f",J6="\\u20d0-\\u20ff",Q6=X6+q6+J6,tL="\\ufe0e\\ufe0f",eL="["+L1+"]",$d="["+Q6+"]",jd="\\ud83c[\\udffb-\\udfff]",nL="(?:"+$d+"|"+jd+")",M1="[^"+L1+"]",U1="(?:\\ud83c[\\udde6-\\uddff]){2}",F1="[\\ud800-\\udbff][\\udc00-\\udfff]",rL="\\u200d",P1=nL+"?",B1="["+tL+"]?",iL="(?:"+rL+"(?:"+[M1,U1,F1].join("|")+")"+B1+P1+")*",sL=B1+P1+iL,oL="(?:"+[M1+$d+"?",$d,U1,F1,eL].join("|")+")",aL=RegExp(jd+"(?="+jd+")|"+oL+sL,"g");function cL(t){return t.match(aL)||[]}function lL(t){return C1(t)?cL(t):Z6(t)}function uL(t){return function(e){e=I1(e);var n=C1(e)?lL(e):void 0,r=n?n[0]:e.charAt(0),i=n?$6(n,1).join(""):e.slice(1);return r[t]()+i}}var D1=uL("toUpperCase");function hL(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function fL(){this.__data__=new Li,this.size=0}function dL(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function pL(t){return this.__data__.get(t)}function mL(t){return this.__data__.has(t)}var gL=200;function _L(t,e){var n=this.__data__;if(n instanceof Li){var r=n.__data__;if(!pc||r.length<gL-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Mi(r)}return n.set(t,e),this.size=n.size,this}function si(t){var e=this.__data__=new Li(t);this.size=e.size}si.prototype.clear=fL,si.prototype.delete=dL,si.prototype.get=pL,si.prototype.has=mL,si.prototype.set=_L;function yL(t,e){return t&&Id(e,_r(e),t)}var $1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,j1=$1&&typeof module=="object"&&module&&!module.nodeType&&module,bL=j1&&j1.exports===$1,z1=bL?ri.Buffer:void 0,W1=z1?z1.allocUnsafe:void 0;function wL(t,e){var n=t.length,r=W1?W1(n):new t.constructor(n);return t.copy(r),r}function zd(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function H1(){return[]}var EL=Object.prototype,xL=EL.propertyIsEnumerable,K1=Object.getOwnPropertySymbols,Wd=K1?function(t){return t==null?[]:(t=Object(t),zd(K1(t),function(e){return xL.call(t,e)}))}:H1;function kL(t,e){return Id(t,Wd(t),e)}var TL=Object.getOwnPropertySymbols,vL=TL?function(t){for(var e=[];t;)Pd(e,Wd(t)),t=O1(t);return e}:H1;function G1(t,e,n){var r=e(t);return ne(t)?r:Pd(r,n(t))}function Hd(t){return G1(t,_r,Wd)}function AL(t){return G1(t,R1,vL)}var Kd=js(ri,"DataView"),Gd=js(ri,"Promise"),Go=js(ri,"Set"),Y1="[object Map]",SL="[object Object]",V1="[object Promise]",Z1="[object Set]",X1="[object WeakMap]",q1="[object DataView]",RL=$s(Kd),IL=$s(pc),NL=$s(Gd),OL=$s(Go),CL=$s(Ad),yr=as;(Kd&&yr(new Kd(new ArrayBuffer(1)))!=q1||pc&&yr(new pc)!=Y1||Gd&&yr(Gd.resolve())!=V1||Go&&yr(new Go)!=Z1||Ad&&yr(new Ad)!=X1)&&(yr=function(t){var e=as(t),n=e==SL?t.constructor:void 0,r=n?$s(n):"";if(r)switch(r){case RL:return q1;case IL:return Y1;case NL:return V1;case OL:return Z1;case CL:return X1}return e});var LL=Object.prototype,ML=LL.hasOwnProperty;function UL(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&ML.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var ou=ri.Uint8Array;function FL(t){var e=new t.constructor(t.byteLength);return new ou(e).set(new ou(t)),e}function PL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var BL=/\w*$/;function DL(t){var e=new t.constructor(t.source,BL.exec(t));return e.lastIndex=t.lastIndex,e}var J1=mr?mr.prototype:void 0,Q1=J1?J1.valueOf:void 0;function $L(t){return Q1?Object(Q1.call(t)):{}}function jL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var zL="[object Boolean]",WL="[object Date]",HL="[object Map]",KL="[object Number]",GL="[object RegExp]",YL="[object Set]",VL="[object String]",ZL="[object Symbol]",XL="[object ArrayBuffer]",qL="[object DataView]",JL="[object Float32Array]",QL="[object Float64Array]",tM="[object Int8Array]",eM="[object Int16Array]",nM="[object Int32Array]",rM="[object Uint8Array]",iM="[object Uint8ClampedArray]",sM="[object Uint16Array]",oM="[object Uint32Array]";function aM(t,e,n){var r=t.constructor;switch(e){case XL:return FL(t);case zL:case WL:return new r(+t);case qL:return PL(t);case JL:case QL:case tM:case eM:case nM:case rM:case iM:case sM:case oM:return jL(t);case HL:return new r;case KL:case VL:return new r(t);case GL:return DL(t);case YL:return new r;case ZL:return $L(t)}}function cM(t){return typeof t.constructor=="function"&&!uc(t)?ZO(O1(t)):{}}var lM="[object Map]";function uM(t){return Lr(t)&&yr(t)==lM}var tb=cs&&cs.isMap,hM=tb?nu(tb):uM,fM="[object Set]";function dM(t){return Lr(t)&&yr(t)==fM}var eb=cs&&cs.isSet,pM=eb?nu(eb):dM,nb="[object Arguments]",mM="[object Array]",gM="[object Boolean]",_M="[object Date]",yM="[object Error]",rb="[object Function]",bM="[object GeneratorFunction]",wM="[object Map]",EM="[object Number]",ib="[object Object]",xM="[object RegExp]",kM="[object Set]",TM="[object String]",vM="[object Symbol]",AM="[object WeakMap]",SM="[object ArrayBuffer]",RM="[object DataView]",IM="[object Float32Array]",NM="[object Float64Array]",OM="[object Int8Array]",CM="[object Int16Array]",LM="[object Int32Array]",MM="[object Uint8Array]",UM="[object Uint8ClampedArray]",FM="[object Uint16Array]",PM="[object Uint32Array]",ye={};ye[nb]=ye[mM]=ye[SM]=ye[RM]=ye[gM]=ye[_M]=ye[IM]=ye[NM]=ye[OM]=ye[CM]=ye[LM]=ye[wM]=ye[EM]=ye[ib]=ye[xM]=ye[kM]=ye[TM]=ye[vM]=ye[MM]=ye[UM]=ye[FM]=ye[PM]=!0,ye[yM]=ye[rb]=ye[AM]=!1;function au(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!gr(t))return t;var a=ne(t);if(a)return o=UL(t),qO(t,o);var c=yr(t),l=c==rb||c==bM;if(hc(t))return wL(t);if(c==ib||c==nb||l&&!i)return o=l?{}:cM(t),kL(t,yL(o,t));if(!ye[c])return i?t:{};o=aM(t,c),s||(s=new si);var u=s.get(t);if(u)return u;s.set(t,o),pM(t)?t.forEach(function(h){o.add(au(h,e,n,h,t,s))}):hM(t)&&t.forEach(function(h,p){o.set(p,au(h,e,n,p,t,s))});var f=Hd,d=a?void 0:f(t);return d1(d||t,function(h,p){d&&(p=h,h=t[p]),tu(o,p,au(h,e,n,p,t,s))}),o}var BM=4;function pn(t){return au(t,BM)}function gc(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var DM="__lodash_hash_undefined__";function $M(t){return this.__data__.set(t,DM),this}function jM(t){return this.__data__.has(t)}function Yo(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Mi;++e<n;)this.add(t[e])}Yo.prototype.add=Yo.prototype.push=$M,Yo.prototype.has=jM;function sb(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Yd(t,e){return t.has(e)}var zM=1,WM=2;function ob(t,e,n,r,i,s){var o=n&zM,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var f=-1,d=!0,h=n&WM?new Yo:void 0;for(s.set(t,e),s.set(e,t);++f<a;){var p=t[f],m=e[f];if(r)var w=o?r(m,p,f,e,t,s):r(p,m,f,t,e,s);if(w!==void 0){if(w)continue;d=!1;break}if(h){if(!sb(e,function(b,T){if(!Yd(h,T)&&(p===b||i(p,b,n,r,s)))return h.push(T)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function HM(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Vd(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var KM=1,GM=2,YM="[object Boolean]",VM="[object Date]",ZM="[object Error]",XM="[object Map]",qM="[object Number]",JM="[object RegExp]",QM="[object Set]",t2="[object String]",e2="[object Symbol]",n2="[object ArrayBuffer]",r2="[object DataView]",ab=mr?mr.prototype:void 0,Zd=ab?ab.valueOf:void 0;function i2(t,e,n,r,i,s,o){switch(n){case r2:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case n2:return!(t.byteLength!=e.byteLength||!s(new ou(t),new ou(e)));case YM:case VM:case qM:return lc(+t,+e);case ZM:return t.name==e.name&&t.message==e.message;case JM:case t2:return t==e+"";case XM:var a=HM;case QM:var c=r&KM;if(a||(a=Vd),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=GM,o.set(t,e);var u=ob(a(t),a(e),r,i,s,o);return o.delete(t),u;case e2:if(Zd)return Zd.call(t)==Zd.call(e)}return!1}var s2=1,o2=Object.prototype,a2=o2.hasOwnProperty;function c2(t,e,n,r,i,s){var o=n&s2,a=Hd(t),c=a.length,l=Hd(e),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in e:a2.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var w=o;++f<c;){d=a[f];var b=t[d],T=e[d];if(r)var A=o?r(T,b,d,e,t,s):r(b,T,d,t,e,s);if(!(A===void 0?b===T||i(b,T,n,r,s):A)){m=!1;break}w||(w=d=="constructor")}if(m&&!w){var v=t.constructor,C=e.constructor;v!=C&&"constructor"in t&&"constructor"in e&&!(typeof v=="function"&&v instanceof v&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var l2=1,cb="[object Arguments]",lb="[object Array]",cu="[object Object]",u2=Object.prototype,ub=u2.hasOwnProperty;function h2(t,e,n,r,i,s){var o=ne(t),a=ne(e),c=o?lb:yr(t),l=a?lb:yr(e);c=c==cb?cu:c,l=l==cb?cu:l;var u=c==cu,f=l==cu,d=c==l;if(d&&hc(t)){if(!hc(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new si),o||Ld(t)?ob(t,e,n,r,i,s):i2(t,e,c,n,r,i,s);if(!(n&l2)){var h=u&&ub.call(t,"__wrapped__"),p=f&&ub.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,w=p?e.value():e;return s||(s=new si),i(m,w,n,r,s)}}return d?(s||(s=new si),c2(t,e,n,r,i,s)):!1}function Xd(t,e,n,r,i){return t===e?!0:t==null||e==null||!Lr(t)&&!Lr(e)?t!==t&&e!==e:h2(t,e,n,r,Xd,i)}var f2=1,d2=2;function p2(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new si,f;if(!(f===void 0?Xd(l,c,f2|d2,r,u):f))return!1}}return!0}function hb(t){return t===t&&!gr(t)}function m2(t){for(var e=_r(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,hb(i)]}return e}function fb(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function g2(t){var e=m2(t);return e.length==1&&e[0][2]?fb(e[0][0],e[0][1]):function(n){return n===t||p2(n,t,e)}}function _2(t,e){return t!=null&&e in Object(t)}function db(t,e,n){e=su(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=mc(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Od(i)&&Ql(o,i)&&(ne(t)||eu(t)))}function y2(t,e){return t!=null&&db(t,e,_2)}var b2=1,w2=2;function E2(t,e){return Md(t)&&hb(e)?fb(mc(t),e):function(n){var r=B6(n,t);return r===void 0&&r===e?y2(n,t):Xd(e,r,b2|w2)}}function x2(t){return function(e){return e==null?void 0:e[t]}}function k2(t){return function(e){return Fd(e,t)}}function T2(t){return Md(t)?x2(mc(t)):k2(t)}function oi(t){return typeof t=="function"?t:t==null?Ko:typeof t=="object"?ne(t)?E2(t[0],t[1]):g2(t):T2(t)}function v2(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function A2(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var S2=A2();function R2(t,e){return t&&S2(t,e,_r)}function I2(t,e){return function(n,r){if(n==null)return n;if(!ii(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var Ws=I2(R2);function N2(t,e,n,r){return Ws(t,function(i,s,o){e(r,i,n(i),o)}),r}function O2(t,e){return function(n,r){var i=ne(n)?v2:N2,s=e?e():{};return i(n,t,oi(r),s)}}var pb=Object.prototype,C2=pb.hasOwnProperty,qd=Nd(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&_1(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=R1(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||lc(u,pb[l])&&!C2.call(t,l))&&(t[l]=s[l])}return t});function mb(t){return Lr(t)&&ii(t)}var L2=200;function M2(t,e,n,r){var i=-1,s=m1,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=L2&&(s=Yd,o=!1,e=new Yo(e));t:for(;++i<a;){var u=t[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(e[d]===f)continue t;c.push(u)}else s(e,f,r)||c.push(u)}return c}var lu=Nd(function(t,e){return mb(t)?M2(t,Bd(e,1,mb,!0)):[]});function Vo(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function mn(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ql(e),Dd(t,e<0?0:e,r)):[]}function _c(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ql(e),e=r-e,Dd(t,0,e<0?0:e)):[]}function U2(t){return typeof t=="function"?t:Ko}function Ot(t,e){var n=ne(t)?d1:Ws;return n(t,U2(e))}function F2(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function P2(t,e){var n=!0;return Ws(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function Mr(t,e,n){var r=ne(t)?F2:P2;return r(t,oi(e))}function gb(t,e){var n=[];return Ws(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function br(t,e){var n=ne(t)?zd:gb;return n(t,oi(e))}function B2(t){return function(e,n,r){var i=Object(e);if(!ii(e)){var s=oi(n);e=_r(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var D2=Math.max;function $2(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:ql(n);return i<0&&(i=D2(r+i,0)),p1(t,oi(e),i)}var Zo=B2($2);function Ur(t){return t&&t.length?t[0]:void 0}function j2(t,e){var n=-1,r=ii(t)?Array(t.length):[];return Ws(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function kt(t,e){var n=ne(t)?Xl:j2;return n(t,oi(e))}function wr(t,e){return Bd(kt(t,e))}var z2=Object.prototype,W2=z2.hasOwnProperty,_b=O2(function(t,e,n){W2.call(t,n)?t[n].push(e):Rd(t,n,[e])}),H2=Object.prototype,K2=H2.hasOwnProperty;function G2(t,e){return t!=null&&K2.call(t,e)}function It(t,e){return t!=null&&db(t,e,G2)}var Y2="[object String]";function Pn(t){return typeof t=="string"||!ne(t)&&Lr(t)&&as(t)==Y2}function V2(t,e){return Xl(e,function(n){return t[n]})}function He(t){return t==null?[]:V2(t,_r(t))}var Z2=Math.max;function Sn(t,e,n,r){t=ii(t)?t:He(t),n=n&&!r?ql(n):0;var i=t.length;return n<0&&(n=Z2(i+n,0)),Pn(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Sd(t,e,n)>-1}function yb(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return Sd(t,e,i)}var X2="[object Map]",q2="[object Set]",J2=Object.prototype,Q2=J2.hasOwnProperty;function be(t){if(t==null)return!0;if(ii(t)&&(ne(t)||typeof t=="string"||typeof t.splice=="function"||hc(t)||Ld(t)||eu(t)))return!t.length;var e=yr(t);if(e==X2||e==q2)return!t.size;if(uc(t))return!S1(t).length;for(var n in t)if(Q2.call(t,n))return!1;return!0}var t8="[object RegExp]";function e8(t){return Lr(t)&&as(t)==t8}var bb=cs&&cs.isRegExp,Ui=bb?nu(bb):e8;function Fi(t){return t===void 0}var n8="Expected a function";function r8(t){if(typeof t!="function")throw new TypeError(n8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function i8(t,e,n,r){if(!gr(t))return t;e=su(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=mc(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=gr(u)?u:Ql(e[i+1])?[]:{})}tu(a,c,l),a=a[c]}return t}function s8(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Fd(t,o);n(a,o)&&i8(s,su(o,t),a)}return s}function Fr(t,e){if(t==null)return{};var n=Xl(AL(t),function(r){return[r]});return e=oi(e),s8(t,n,function(r,i){return e(r,i[0])})}function o8(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Bn(t,e,n){var r=ne(t)?hL:o8,i=arguments.length<3;return r(t,oi(e),n,i,Ws)}function uu(t,e){var n=ne(t)?zd:gb;return n(t,r8(oi(e)))}function a8(t,e){var n;return Ws(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function Jd(t,e,n){var r=ne(t)?sb:a8;return r(t,oi(e))}var c8=1/0,l8=Go&&1/Vd(new Go([,-0]))[1]==c8?function(t){return new Go(t)}:Je,u8=200;function h8(t,e,n){var r=-1,i=m1,s=t.length,o=!0,a=[],c=a;if(s>=u8){var l=l8(t);if(l)return Vd(l);o=!1,i=Yd,c=new Yo}else c=a;t:for(;++r<s;){var u=t[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function hu(t){return t&&t.length?h8(t):[]}function Qd(t){console&&console.error&&console.error(`Error: ${t}`)}function wb(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function Eb(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function xb(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function f8(t){return d8(t)?t.LABEL:t.name}function d8(t){return Pn(t.LABEL)&&t.LABEL!==""}class ai{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Ot(this.definition,n=>{n.accept(e)})}}class Dn extends ai{constructor(e){super([]),this.idx=1,Fn(this,Fr(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Xo extends ai{constructor(e){super(e.definition),this.orgText="",Fn(this,Fr(e,n=>n!==void 0))}}class $n extends ai{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Fn(this,Fr(e,n=>n!==void 0))}}class jn extends ai{constructor(e){super(e.definition),this.idx=1,Fn(this,Fr(e,n=>n!==void 0))}}class ci extends ai{constructor(e){super(e.definition),this.idx=1,Fn(this,Fr(e,n=>n!==void 0))}}class li extends ai{constructor(e){super(e.definition),this.idx=1,Fn(this,Fr(e,n=>n!==void 0))}}class Qe extends ai{constructor(e){super(e.definition),this.idx=1,Fn(this,Fr(e,n=>n!==void 0))}}class Pr extends ai{constructor(e){super(e.definition),this.idx=1,Fn(this,Fr(e,n=>n!==void 0))}}class Br extends ai{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Fn(this,Fr(e,n=>n!==void 0))}}class Ce{constructor(e){this.idx=1,Fn(this,Fr(e,n=>n!==void 0))}accept(e){e.visit(this)}}function p8(t){return kt(t,fu)}function fu(t){function e(n){return kt(n,fu)}if(t instanceof Dn){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Pn(t.label)&&(n.label=t.label),n}else{if(t instanceof $n)return{type:"Alternative",definition:e(t.definition)};if(t instanceof jn)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof ci)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof li)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:fu(new Ce({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Pr)return{type:"RepetitionWithSeparator",idx:t.idx,separator:fu(new Ce({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Qe)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Br)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Ce){const n={type:"Terminal",name:t.terminalType.name,label:f8(t.terminalType),idx:t.idx};Pn(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Ui(r)?r.source:r),n}else{if(t instanceof Xo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Hs{visit(e){const n=e;switch(n.constructor){case Dn:return this.visitNonTerminal(n);case $n:return this.visitAlternative(n);case jn:return this.visitOption(n);case ci:return this.visitRepetitionMandatory(n);case li:return this.visitRepetitionMandatoryWithSeparator(n);case Pr:return this.visitRepetitionWithSeparator(n);case Qe:return this.visitRepetition(n);case Br:return this.visitAlternation(n);case Ce:return this.visitTerminal(n);case Xo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function m8(t){return t instanceof $n||t instanceof jn||t instanceof Qe||t instanceof ci||t instanceof li||t instanceof Pr||t instanceof Ce||t instanceof Xo}function du(t,e=[]){return t instanceof jn||t instanceof Qe||t instanceof Pr?!0:t instanceof Br?Jd(t.definition,r=>du(r,e)):t instanceof Dn&&Sn(e,t)?!1:t instanceof ai?(t instanceof Dn&&e.push(t),Mr(t.definition,r=>du(r,e))):!1}function g8(t){return t instanceof Br}function ui(t){if(t instanceof Dn)return"SUBRULE";if(t instanceof jn)return"OPTION";if(t instanceof Br)return"OR";if(t instanceof ci)return"AT_LEAST_ONE";if(t instanceof li)return"AT_LEAST_ONE_SEP";if(t instanceof Pr)return"MANY_SEP";if(t instanceof Qe)return"MANY";if(t instanceof Ce)return"CONSUME";throw Error("non exhaustive match")}class pu{walk(e,n=[]){Ot(e.definition,(r,i)=>{const s=mn(e.definition,i+1);if(r instanceof Dn)this.walkProdRef(r,s,n);else if(r instanceof Ce)this.walkTerminal(r,s,n);else if(r instanceof $n)this.walkFlat(r,s,n);else if(r instanceof jn)this.walkOption(r,s,n);else if(r instanceof ci)this.walkAtLeastOne(r,s,n);else if(r instanceof li)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Pr)this.walkManySep(r,s,n);else if(r instanceof Qe)this.walkMany(r,s,n);else if(r instanceof Br)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new jn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=kb(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new jn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=kb(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Ot(e.definition,s=>{const o=new $n({definition:[s]});this.walk(o,i)})}}function kb(t,e,n){return[new jn({definition:[new Ce({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function yc(t){if(t instanceof Dn)return yc(t.referencedRule);if(t instanceof Ce)return b8(t);if(m8(t))return _8(t);if(g8(t))return y8(t);throw Error("non exhaustive match")}function _8(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=du(s),e=e.concat(yc(s)),r=r+1,i=n.length>r;return hu(e)}function y8(t){const e=kt(t.definition,n=>yc(n));return hu(tr(e))}function b8(t){return[t.terminalType]}const Tb="_~IN~_";class w8 extends pu{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=x8(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new $n({definition:s}),a=yc(o);this.follows[i]=a}}function E8(t){const e={};return Ot(t,n=>{const r=new w8(n).startWalking();Fn(e,r)}),e}function x8(t,e){return t.name+e+Tb}function Ct(t){return t.charCodeAt(0)}function t0(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function bc(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function qo(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function k8(){throw Error("Internal Error - Should never get here!")}function vb(t){return t.type==="Character"}const mu=[];for(let t=Ct("0");t<=Ct("9");t++)mu.push(t);const gu=[Ct("_")].concat(mu);for(let t=Ct("a");t<=Ct("z");t++)gu.push(t);for(let t=Ct("A");t<=Ct("Z");t++)gu.push(t);const Ab=[Ct(" "),Ct("\f"),Ct(`
`),Ct("\r"),Ct("	"),Ct("\v"),Ct("	"),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct(" "),Ct("\u2028"),Ct("\u2029"),Ct(" "),Ct(" "),Ct("　"),Ct("\uFEFF")],T8=/[0-9a-fA-F]/,_u=/[0-9]/,v8=/[1-9]/;class A8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":bc(r,"global");break;case"i":bc(r,"ignoreCase");break;case"m":bc(r,"multiLine");break;case"u":bc(r,"unicode");break;case"y":bc(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}qo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return k8()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;qo(n);break}if(!(e===!0&&n===void 0)&&qo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),qo(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ct(`
`),Ct("\r"),Ct("\u2028"),Ct("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=mu;break;case"D":e=mu,n=!0;break;case"s":e=Ab;break;case"S":e=Ab,n=!0;break;case"w":e=gu;break;case"W":e=gu,n=!0;break}if(qo(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Ct("\f");break;case"n":e=Ct(`
`);break;case"r":e=Ct("\r");break;case"t":e=Ct("	");break;case"v":e=Ct("\v");break}if(qo(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ct("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Ct(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Ct(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,vb(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,vb(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else t0(r.value,e),e.push(Ct("-")),t0(i.value,e)}else t0(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ct("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(v8.test(e)===!1)throw Error("Expecting a positive integer");for(;_u.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(_u.test(e)===!1)throw Error("Expecting an integer");for(;_u.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ct(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return _u.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(T8.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class e0{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let yu={};const S8=new A8;function bu(t){const e=t.toString();if(yu.hasOwnProperty(e))return yu[e];{const n=S8.pattern(e);return yu[e]=n,n}}function R8(){yu={}}const Sb="Complement Sets are not supported for first char optimization",wu=`Unable to use "first char" lexer optimizations:
`;function I8(t,e=!1){try{const n=bu(t);return n0(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Sb)e&&wb(`${wu}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Qd(`${wu}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function n0(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)n0(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Eu(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(Sb);Ot(o.value,c=>{if(typeof c=="number")Eu(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Eu(u,e,n);else{for(let u=l.from;u<=l.to&&u<Ec;u++)Eu(u,e,n);if(l.to>=Ec){const u=l.from>=Ec?l.from:Ec,f=l.to,d=ls(u),h=ls(f);for(let p=d;p<=h;p++)e[p]=p}}}});break;case"Group":n0(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&r0(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return He(e)}function Eu(t,e,n){const r=ls(t);e[r]=r,n===!0&&N8(t,e)}function N8(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=ls(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=ls(i.charCodeAt(0));e[s]=s}}}function Rb(t,e){return Zo(t.value,n=>{if(typeof n=="number")return Sn(e,n);{const r=n;return Zo(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function r0(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?ne(t.value)?Mr(t.value,r0):r0(t.value):!1}class O8 extends e0{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Sn(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Rb(e,this.targetCharCodes)===void 0&&(this.found=!0):Rb(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function i0(t,e){if(e instanceof RegExp){const n=bu(e),r=new O8(t);return r.visit(n),r.found}else return Zo(e,n=>Sn(t,n.charCodeAt(0)))!==void 0}const Ks="PATTERN",wc="defaultMode",xu="modes";let Ib=typeof new RegExp("(?:)").sticky=="boolean";function C8(t,e){e=qd(e,{useSticky:Ib,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,A)=>A()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{e3()});let r;n("Reject Lexer.NA",()=>{r=uu(t,T=>T[Ks]===tn.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=kt(r,T=>{const A=T[Ks];if(Ui(A)){const v=A.source;return v.length===1&&v!=="^"&&v!=="$"&&v!=="."&&!A.ignoreCase?v:v.length===2&&v[0]==="\\"&&!Sn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],v[1])?v[1]:e.useSticky?Ob(A):Nb(A)}else{if(Ci(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const v=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(v);return e.useSticky?Ob(C):Nb(C)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=kt(r,T=>T.tokenTypeIdx),a=kt(r,T=>{const A=T.GROUP;if(A!==tn.SKIPPED){if(Pn(A))return A;if(Fi(A))return!1;throw Error("non exhaustive match")}}),c=kt(r,T=>{const A=T.LONGER_ALT;if(A)return ne(A)?kt(A,C=>yb(r,C)):[yb(r,A)]}),l=kt(r,T=>T.PUSH_MODE),u=kt(r,T=>It(T,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const T=Mb(e.lineTerminatorCharacters);f=kt(r,A=>!1),e.positionTracking!=="onlyOffset"&&(f=kt(r,A=>It(A,"LINE_BREAKS")?!!A.LINE_BREAKS:Lb(A,T)===!1&&i0(T,A.PATTERN)))});let d,h,p,m;n("Misc Mapping #2",()=>{d=kt(r,Cb),h=kt(s,J8),p=Bn(r,(T,A)=>{const v=A.GROUP;return Pn(v)&&v!==tn.SKIPPED&&(T[v]=[]),T},{}),m=kt(s,(T,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:f[A],isCustom:d[A],short:h[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let w=!0,b=[];return e.safeMode||n("First Char Optimization",()=>{b=Bn(r,(T,A,v)=>{if(typeof A.PATTERN=="string"){const C=A.PATTERN.charCodeAt(0),S=ls(C);s0(T,S,m[v])}else if(ne(A.START_CHARS_HINT)){let C;Ot(A.START_CHARS_HINT,S=>{const R=typeof S=="string"?S.charCodeAt(0):S,U=ls(R);C!==U&&(C=U,s0(T,U,m[v]))})}else if(Ui(A.PATTERN))if(A.PATTERN.unicode)w=!1,e.ensureOptimizations&&Qd(`${wu}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=I8(A.PATTERN,e.ensureOptimizations);be(C)&&(w=!1),Ot(C,S=>{s0(T,S,m[v])})}else e.ensureOptimizations&&Qd(`${wu}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:b,hasCustom:i,canBeOptimized:w}}function L8(t,e){let n=[];const r=U8(t);n=n.concat(r.errors);const i=F8(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(M8(s)),n=n.concat(H8(s)),n=n.concat(K8(s,e)),n=n.concat(G8(s)),n}function M8(t){let e=[];const n=br(t,r=>Ui(r[Ks]));return e=e.concat(B8(n)),e=e.concat(j8(n)),e=e.concat(z8(n)),e=e.concat(W8(n)),e=e.concat(D8(n)),e}function U8(t){const e=br(t,i=>!It(i,Ks)),n=kt(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Fe.MISSING_PATTERN,tokenTypes:[i]})),r=lu(t,e);return{errors:n,valid:r}}function F8(t){const e=br(t,i=>{const s=i[Ks];return!Ui(s)&&!Ci(s)&&!It(s,"exec")&&!Pn(s)}),n=kt(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Fe.INVALID_PATTERN,tokenTypes:[i]})),r=lu(t,e);return{errors:n,valid:r}}const P8=/[^\\][$]/;function B8(t){class e extends e0{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=br(t,i=>{const s=i.PATTERN;try{const o=bu(s),a=new e;return a.visit(o),a.found}catch{return P8.test(s.source)}});return kt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Fe.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function D8(t){const e=br(t,r=>r.PATTERN.test(""));return kt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Fe.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const $8=/[^\\[][\^]|^\^/;function j8(t){class e extends e0{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=br(t,i=>{const s=i.PATTERN;try{const o=bu(s),a=new e;return a.visit(o),a.found}catch{return $8.test(s.source)}});return kt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Fe.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function z8(t){const e=br(t,r=>{const i=r[Ks];return i instanceof RegExp&&(i.multiline||i.global)});return kt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Fe.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function W8(t){const e=[];let n=kt(t,s=>Bn(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Sn(e,a)&&a.PATTERN!==tn.NA&&(e.push(a),o.push(a)),o),[]));n=gc(n);const r=br(n,s=>s.length>1);return kt(r,s=>{const o=kt(s,c=>c.name);return{message:`The same RegExp pattern ->${Ur(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Fe.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function H8(t){const e=br(t,r=>{if(!It(r,"GROUP"))return!1;const i=r.GROUP;return i!==tn.SKIPPED&&i!==tn.NA&&!Pn(i)});return kt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Fe.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function K8(t,e){const n=br(t,i=>i.PUSH_MODE!==void 0&&!Sn(e,i.PUSH_MODE));return kt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Fe.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function G8(t){const e=[],n=Bn(t,(r,i,s)=>{const o=i.PATTERN;return o===tn.NA||(Pn(o)?r.push({str:o,idx:s,tokenType:i}):Ui(o)&&V8(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ot(t,(r,i)=>{Ot(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&Y8(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Fe.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function Y8(t,e){if(Ui(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Ci(e))return e(t,0,[],{});if(It(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function V8(t){return Zo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function Nb(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function Ob(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function Z8(t,e,n){const r=[];return It(t,wc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+wc+`> property in its definition
`,type:Fe.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),It(t,xu)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+xu+`> property in its definition
`,type:Fe.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),It(t,xu)&&It(t,wc)&&!It(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${wc}: <${t.defaultMode}>which does not exist
`,type:Fe.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),It(t,xu)&&Ot(t.modes,(i,s)=>{Ot(i,(o,a)=>{if(Fi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Fe.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(It(o,"LONGER_ALT")){const c=ne(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ot(c,l=>{!Fi(l)&&!Sn(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Fe.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function X8(t,e,n){const r=[];let i=!1;const s=gc(tr(He(t.modes))),o=uu(s,c=>c[Ks]===tn.NA),a=Mb(n);return e&&Ot(o,c=>{const l=Lb(c,a);if(l!==!1){const f={message:t3(c,l),type:l.issue,tokenType:c};r.push(f)}else It(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):i0(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Fe.NO_LINE_BREAKS_FLAGS}),r}function q8(t){const e={},n=_r(t);return Ot(n,r=>{const i=t[r];if(ne(i))e[r]=[];else throw Error("non exhaustive match")}),e}function Cb(t){const e=t.PATTERN;if(Ui(e))return!1;if(Ci(e))return!0;if(It(e,"exec"))return!0;if(Pn(e))return!1;throw Error("non exhaustive match")}function J8(t){return Pn(t)&&t.length===1?t.charCodeAt(0):!1}const Q8={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Lb(t,e){if(It(t,"LINE_BREAKS"))return!1;if(Ui(t.PATTERN)){try{i0(e,t.PATTERN)}catch(n){return{issue:Fe.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Pn(t.PATTERN))return!1;if(Cb(t))return{issue:Fe.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function t3(t,e){if(e.issue===Fe.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Fe.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Mb(t){return kt(t,n=>Pn(n)?n.charCodeAt(0):n)}function s0(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Ec=256;let ku=[];function ls(t){return t<Ec?t:ku[t]}function e3(){if(be(ku)){ku=new Array(65536);for(let t=0;t<65536;t++)ku[t]=t>255?255+~~(t/255):t}}function xc(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Tu(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let Ub=1;const Fb={};function kc(t){const e=n3(t);r3(e),s3(e),i3(e),Ot(e,n=>{n.isParent=n.categoryMatches.length>0})}function n3(t){let e=pn(t),n=t,r=!0;for(;r;){n=gc(tr(kt(n,s=>s.CATEGORIES)));const i=lu(n,e);e=e.concat(i),be(i)?r=!1:n=i}return e}function r3(t){Ot(t,e=>{Bb(e)||(Fb[Ub]=e,e.tokenTypeIdx=Ub++),Db(e)&&!ne(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Db(e)||(e.CATEGORIES=[]),o3(e)||(e.categoryMatches=[]),a3(e)||(e.categoryMatchesMap={})})}function i3(t){Ot(t,e=>{e.categoryMatches=[],Ot(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(Fb[r].tokenTypeIdx)})})}function s3(t){Ot(t,e=>{Pb([],e)})}function Pb(t,e){Ot(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ot(e.CATEGORIES,n=>{const r=t.concat(e);Sn(r,n)||Pb(r,n)})}function Bb(t){return It(t,"tokenTypeIdx")}function Db(t){return It(t,"CATEGORIES")}function o3(t){return It(t,"categoryMatches")}function a3(t){return It(t,"categoryMatchesMap")}function c3(t){return It(t,"tokenTypeIdx")}const l3={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var Fe;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Fe||(Fe={}));const Tc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:l3,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Tc);let tn=class{constructor(e,n=Tc){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Eb(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Fn({},Tc,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Tc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=Q8;else if(this.config.lineTerminatorCharacters===Tc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),ne(e)?i={modes:{defaultMode:pn(e)},defaultMode:wc}:(s=!1,i=pn(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Z8(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(X8(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ot(i.modes,(a,c)=>{i.modes[c]=uu(a,l=>Fi(l))});const o=_r(i.modes);if(Ot(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(L8(a,o))}),be(this.lexerDefinitionErrors)){kc(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=C8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Fn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!be(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=kt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ot(this.lexerDefinitionWarning,a=>{wb(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Ib?(this.chopInput=Ko,this.match=this.matchWithTest):(this.updateLastIndex=Je,this.match=this.matchWithExec),s&&(this.handleModes=Je),this.trackStartLines===!1&&(this.computeNewColumn=Ko),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Je),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Bn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!be(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{R8()}),this.TRACE_INIT("toFastProperties",()=>{xb(this)})})}tokenize(e,n=this.defaultMode){if(!be(this.lexerDefinitionErrors)){const i=kt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,w,b;const T=e,A=T.length;let v=0,C=0;const S=this.hasCustom?0:Math.floor(e.length/10),R=new Array(S),U=[];let O=this.trackStartLines?1:void 0,D=this.trackStartLines?1:void 0;const V=q8(this.emptyGroups),L=this.trackStartLines,N=this.config.lineTerminatorsPattern;let E=0,B=[],Q=[];const j=[],st=[];Object.freeze(st);let et;function ft(){return B}function Z(Mt){const Zt=ls(Mt),Ut=Q[Zt];return Ut===void 0?st:Ut}const H=Mt=>{if(j.length===1&&Mt.tokenType.PUSH_MODE===void 0){const Zt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Mt);U.push({offset:Mt.startOffset,line:Mt.startLine,column:Mt.startColumn,length:Mt.image.length,message:Zt})}else{j.pop();const Zt=Vo(j);B=this.patternIdxToConfig[Zt],Q=this.charCodeToPatternIdxToConfig[Zt],E=B.length;const Ut=this.canModeBeOptimized[Zt]&&this.config.safeMode===!1;Q&&Ut?et=Z:et=ft}};function wt(Mt){j.push(Mt),Q=this.charCodeToPatternIdxToConfig[Mt],B=this.patternIdxToConfig[Mt],E=B.length,E=B.length;const Zt=this.canModeBeOptimized[Mt]&&this.config.safeMode===!1;Q&&Zt?et=Z:et=ft}wt.call(this,n);let at;const lt=this.config.recoveryEnabled;for(;v<A;){c=null;const Mt=T.charCodeAt(v),Zt=et(Mt),Ut=Zt.length;for(r=0;r<Ut;r++){at=Zt[r];const Tt=at.pattern;l=null;const Dt=at.short;if(Dt!==!1?Mt===Dt&&(c=Tt):at.isCustom===!0?(b=Tt.exec(T,v,R,V),b!==null?(c=b[0],b.payload!==void 0&&(l=b.payload)):c=null):(this.updateLastIndex(Tt,v),c=this.match(Tt,e,v)),c!==null){if(a=at.longerAlt,a!==void 0){const Ft=a.length;for(s=0;s<Ft;s++){const Re=B[a[s]],Be=Re.pattern;if(u=null,Re.isCustom===!0?(b=Be.exec(T,v,R,V),b!==null?(o=b[0],b.payload!==void 0&&(u=b.payload)):o=null):(this.updateLastIndex(Be,v),o=this.match(Be,e,v)),o&&o.length>c.length){c=o,l=u,at=Re;break}}}break}}if(c!==null){if(f=c.length,d=at.group,d!==void 0&&(h=at.tokenTypeIdx,p=this.createTokenInstance(c,v,h,at.tokenType,O,D,f),this.handlePayload(p,l),d===!1?C=this.addToken(R,C,p):V[d].push(p)),e=this.chopInput(e,f),v=v+f,D=this.computeNewColumn(D,f),L===!0&&at.canLineTerminator===!0){let Tt=0,Dt,Ft;N.lastIndex=0;do Dt=N.test(c),Dt===!0&&(Ft=N.lastIndex-1,Tt++);while(Dt===!0);Tt!==0&&(O=O+Tt,D=f-Ft,this.updateTokenEndLineColumnLocation(p,d,Ft,Tt,O,D,f))}this.handleModes(at,H,wt,p)}else{const Tt=v,Dt=O,Ft=D;let Re=lt===!1;for(;Re===!1&&v<A;)for(e=this.chopInput(e,1),v++,i=0;i<E;i++){const Be=B[i],k=Be.pattern,ot=Be.short;if(ot!==!1?T.charCodeAt(v)===ot&&(Re=!0):Be.isCustom===!0?Re=k.exec(T,v,R,V)!==null:(this.updateLastIndex(k,v),Re=k.exec(e)!==null),Re===!0)break}if(m=v-Tt,D=this.computeNewColumn(D,m),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,Tt,m,Dt,Ft),U.push({offset:Tt,line:Dt,column:Ft,length:m,message:w}),lt===!1)break}}return this.hasCustom||(R.length=C),{tokens:R,groups:V,errors:U}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};tn.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",tn.NA=/NOT_APPLICABLE/;function vc(t){return $b(t)?t.LABEL:t.name}function $b(t){return Pn(t.LABEL)&&t.LABEL!==""}const u3="parent",jb="categories",zb="label",Wb="group",Hb="push_mode",Kb="pop_mode",Gb="longer_alt",Yb="line_breaks",Vb="start_chars_hint";function er(t){return h3(t)}function h3(t){const e=t.pattern,n={};if(n.name=t.name,Fi(e)||(n.PATTERN=e),It(t,u3))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return It(t,jb)&&(n.CATEGORIES=t[jb]),kc([n]),It(t,zb)&&(n.LABEL=t[zb]),It(t,Wb)&&(n.GROUP=t[Wb]),It(t,Kb)&&(n.POP_MODE=t[Kb]),It(t,Hb)&&(n.PUSH_MODE=t[Hb]),It(t,Gb)&&(n.LONGER_ALT=t[Gb]),It(t,Yb)&&(n.LINE_BREAKS=t[Yb]),It(t,Vb)&&(n.START_CHARS_HINT=t[Vb]),n}const Gs=er({name:"EOF",pattern:tn.NA});kc([Gs]);function vu(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function f3(t,e){return xc(t,e)}const Zb={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${$b(t)?`--> ${vc(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Ur(e).image+"'";if(r)return s+r+a;{const c=Bn(t,(d,h)=>d.concat(h),[]),l=kt(c,d=>`[${kt(d,h=>vc(h)).join(", ")}]`),f=`one of these possible Token sequences:
${kt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Ur(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${kt(t,l=>`[${kt(l,u=>vc(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Zb);const d3={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Ys={buildDuplicateFoundError(t,e){function n(u){return u instanceof Ce?u.terminalType.name:u instanceof Dn?u.nonTerminalName:""}const r=t.name,i=Ur(e),s=i.idx,o=ui(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=kt(t.prefixPath,i=>vc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=kt(t.prefixPath,i=>vc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=ui(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=kt(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Xo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function p3(t,e){const n=new m3(t,e);return n.resolveRefs(),n.errors}class m3 extends Hs{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ot(He(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Rn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class g3 extends pu{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=pn(this.path.ruleStack).reverse(),this.occurrenceStack=pn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){be(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class _3 extends g3{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new $n({definition:i});this.possibleTokTypes=yc(s),this.found=!0}}}class Au extends pu{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class y3 extends Au{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Ur(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class Xb extends Au{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Ur(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class b3 extends Au{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Ur(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class qb extends Au{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Ur(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function o0(t,e,n=[]){n=pn(n);let r=[],i=0;function s(a){return a.concat(mn(t,i+1))}function o(a){const c=o0(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof $n)return o(a.definition);if(a instanceof Dn)return o(a.definition);if(a instanceof jn)r=o(a.definition);else if(a instanceof ci){const c=a.definition.concat([new Qe({definition:a.definition})]);return o(c)}else if(a instanceof li){const c=[new $n({definition:a.definition}),new Qe({definition:[new Ce({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Pr){const c=a.definition.concat([new Qe({definition:[new Ce({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Qe){const c=a.definition.concat([new Qe({definition:a.definition})]);r=o(c)}else{if(a instanceof Br)return Ot(a.definition,c=>{be(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ce)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:mn(t,i)}),r}function Jb(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!be(f);){const d=f.pop();if(d===o){a&&Vo(f).idx<=l&&f.pop();continue}const h=d.def,p=d.idx,m=d.ruleStack,w=d.occurrenceStack;if(be(h))continue;const b=h[0];if(b===i){const T={idx:p,def:mn(h),ruleStack:_c(m),occurrenceStack:_c(w)};f.push(T)}else if(b instanceof Ce)if(p<c-1){const T=p+1,A=e[T];if(n(A,b.terminalType)){const v={idx:T,def:mn(h),ruleStack:m,occurrenceStack:w};f.push(v)}}else if(p===c-1)u.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:m,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(b instanceof Dn){const T=pn(m);T.push(b.nonTerminalName);const A=pn(w);A.push(b.idx);const v={idx:p,def:b.definition.concat(s,mn(h)),ruleStack:T,occurrenceStack:A};f.push(v)}else if(b instanceof jn){const T={idx:p,def:mn(h),ruleStack:m,occurrenceStack:w};f.push(T),f.push(o);const A={idx:p,def:b.definition.concat(mn(h)),ruleStack:m,occurrenceStack:w};f.push(A)}else if(b instanceof ci){const T=new Qe({definition:b.definition,idx:b.idx}),A=b.definition.concat([T],mn(h)),v={idx:p,def:A,ruleStack:m,occurrenceStack:w};f.push(v)}else if(b instanceof li){const T=new Ce({terminalType:b.separator}),A=new Qe({definition:[T].concat(b.definition),idx:b.idx}),v=b.definition.concat([A],mn(h)),C={idx:p,def:v,ruleStack:m,occurrenceStack:w};f.push(C)}else if(b instanceof Pr){const T={idx:p,def:mn(h),ruleStack:m,occurrenceStack:w};f.push(T),f.push(o);const A=new Ce({terminalType:b.separator}),v=new Qe({definition:[A].concat(b.definition),idx:b.idx}),C=b.definition.concat([v],mn(h)),S={idx:p,def:C,ruleStack:m,occurrenceStack:w};f.push(S)}else if(b instanceof Qe){const T={idx:p,def:mn(h),ruleStack:m,occurrenceStack:w};f.push(T),f.push(o);const A=new Qe({definition:b.definition,idx:b.idx}),v=b.definition.concat([A],mn(h)),C={idx:p,def:v,ruleStack:m,occurrenceStack:w};f.push(C)}else if(b instanceof Br)for(let T=b.definition.length-1;T>=0;T--){const A=b.definition[T],v={idx:p,def:A.definition.concat(mn(h)),ruleStack:m,occurrenceStack:w};f.push(v),f.push(o)}else if(b instanceof $n)f.push({idx:p,def:b.definition.concat(mn(h)),ruleStack:m,occurrenceStack:w});else if(b instanceof Xo)f.push(w3(b,p,m,w));else throw Error("non exhaustive match")}return u}function w3(t,e,n,r){const i=pn(n);i.push(t.name);const s=pn(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Pe;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Pe||(Pe={}));function Qb(t){if(t instanceof jn||t==="Option")return Pe.OPTION;if(t instanceof Qe||t==="Repetition")return Pe.REPETITION;if(t instanceof ci||t==="RepetitionMandatory")return Pe.REPETITION_MANDATORY;if(t instanceof li||t==="RepetitionMandatoryWithSeparator")return Pe.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Pr||t==="RepetitionWithSeparator")return Pe.REPETITION_WITH_SEPARATOR;if(t instanceof Br||t==="Alternation")return Pe.ALTERNATION;throw Error("non exhaustive match")}function E3(t,e,n,r,i,s){const o=c0(t,e,n),a=rw(o)?Tu:xc;return s(o,r,a,i)}function x3(t,e,n,r,i,s){const o=l0(t,e,i,n),a=rw(o)?Tu:xc;return s(o[0],a,r)}function k3(t,e,n,r){const i=t.length,s=Mr(t,o=>Mr(o,a=>a.length===1));if(e)return function(o){const a=kt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],p=h.length;for(let m=0;m<p;m++){const w=this.LA(m+1);if(n(w,h[m])===!1)continue t}return c}}};if(s&&!r){const o=kt(t,c=>tr(c)),a=Bn(o,(c,l,u)=>(Ot(l,f=>{It(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Ot(f.categoryMatches,d=>{It(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function T3(t,e,n){const r=Mr(t,s=>s.length===1),i=t.length;if(r&&!n){const s=tr(t);if(s.length===1&&be(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Bn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ot(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue t}return!0}return!1}}class v3 extends pu{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,Pe.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,Pe.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,Pe.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,Pe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class tw extends Hs{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Pe.OPTION)}visitRepetition(e){this.checkIsTarget(e,Pe.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Pe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Pe.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Pe.ALTERNATION)}}function ew(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function a0(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function A3(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function nw(t,e){const n=kt(t,o=>o0([o],1)),r=ew(n.length),i=kt(n,o=>{const a={};return Ot(o,c=>{const l=a0(c.partialPath);Ot(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=ew(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=a0(f);if(A3(i,h,c)||be(d)||f.length===e){const m=r[c];if(u0(m,f)===!1){m.push(f);for(let w=0;w<h.length;w++){const b=h[w];i[c][b]=!0}}}else{const m=o0(d,o+1,f);s[c]=s[c].concat(m),Ot(m,w=>{const b=a0(w.partialPath);Ot(b,T=>{i[c][T]=!0})})}}}}return r}function c0(t,e,n,r){const i=new tw(t,Pe.ALTERNATION,r);return e.accept(i),nw(i.result,n)}function l0(t,e,n,r){const i=new tw(t,n);e.accept(i);const s=i.result,a=new v3(e,t,n).startWalking(),c=new $n({definition:s}),l=new $n({definition:a});return nw([c,l],r)}function u0(t,e){t:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function S3(t,e){return t.length<e.length&&Mr(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function rw(t){return Mr(t,e=>Mr(e,n=>Mr(n,r=>be(r.categoryMatches))))}function R3(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return kt(e,n=>Object.assign({type:Rn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function I3(t,e,n,r){const i=wr(t,c=>N3(c,n)),s=z3(t,e,n),o=wr(t,c=>B3(c,n)),a=wr(t,c=>L3(c,t,r,n));return i.concat(s,o,a)}function N3(t,e){const n=new C3;t.accept(n);const r=n.allProductions,i=_b(r,O3),s=Fr(i,a=>a.length>1);return kt(He(s),a=>{const c=Ur(a),l=e.buildDuplicateFoundError(t,a),u=ui(c),f={message:l,type:Rn.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=iw(c);return d&&(f.parameter=d),f})}function O3(t){return`${ui(t)}_#_${t.idx}_#_${iw(t)}`}function iw(t){return t instanceof Ce?t.terminalType.name:t instanceof Dn?t.nonTerminalName:""}class C3 extends Hs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function L3(t,e,n,r){const i=[];if(Bn(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:Rn.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function M3(t,e,n){const r=[];let i;return Sn(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Rn.INVALID_RULE_OVERRIDE,ruleName:t})),r}function sw(t,e,n,r=[]){const i=[],s=Su(e.definition);if(be(s))return[];{const o=t.name;Sn(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Rn.LEFT_RECURSION,ruleName:o});const c=lu(s,r.concat([t])),l=wr(c,u=>{const f=pn(r);return f.push(u),sw(t,u,n,f)});return i.concat(l)}}function Su(t){let e=[];if(be(t))return e;const n=Ur(t);if(n instanceof Dn)e.push(n.referencedRule);else if(n instanceof $n||n instanceof jn||n instanceof ci||n instanceof li||n instanceof Pr||n instanceof Qe)e=e.concat(Su(n.definition));else if(n instanceof Br)e=tr(kt(n.definition,s=>Su(s.definition)));else if(!(n instanceof Ce))throw Error("non exhaustive match");const r=du(n),i=t.length>1;if(r&&i){const s=mn(t);return e.concat(Su(s))}else return e}class h0 extends Hs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function U3(t,e){const n=new h0;t.accept(n);const r=n.alternations;return wr(r,s=>{const o=_c(s.definition);return wr(o,(a,c)=>{const l=Jb([a],[],xc,1);return be(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Rn.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function F3(t,e,n){const r=new h0;t.accept(r);let i=r.alternations;return i=uu(i,o=>o.ignoreAmbiguities===!0),wr(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=c0(a,t,c,o),u=$3(l,o,t,n),f=j3(l,o,t,n);return u.concat(f)})}class P3 extends Hs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function B3(t,e){const n=new h0;t.accept(n);const r=n.alternations;return wr(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Rn.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function D3(t,e,n){const r=[];return Ot(t,i=>{const s=new P3;i.accept(s);const o=s.allProductions;Ot(o,a=>{const c=Qb(a),l=a.maxLookahead||e,u=a.idx,d=l0(u,i,c,l)[0];if(be(tr(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:Rn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function $3(t,e,n,r){const i=[],s=Bn(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Ot(c,u=>{const f=[l];Ot(t,(d,h)=>{l!==h&&u0(d,u)&&e.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!u0(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return kt(s,a=>{const c=kt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Rn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function j3(t,e,n,r){const i=Bn(t,(o,a,c)=>{const l=kt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return gc(wr(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=br(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&S3(d.path,l));return kt(u,d=>{const h=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:d.path}),type:Rn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function z3(t,e,n){const r=[],i=kt(e,s=>s.name);return Ot(t,s=>{const o=s.name;if(Sn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Rn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function W3(t){const e=qd(t,{errMsgProvider:d3}),n={};return Ot(t.rules,r=>{n[r.name]=r}),p3(n,e.errMsgProvider)}function H3(t){return t=qd(t,{errMsgProvider:Ys}),I3(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const ow="MismatchedTokenException",aw="NoViableAltException",cw="EarlyExitException",lw="NotAllInputParsedException",uw=[ow,aw,cw,lw];Object.freeze(uw);function Ru(t){return Sn(uw,t.name)}class Iu extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class hw extends Iu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=ow}}class K3 extends Iu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=aw}}class G3 extends Iu{constructor(e,n){super(e,n),this.name=lw}}class Y3 extends Iu{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=cw}}const f0={},fw="InRuleRecoveryException";class V3 extends Error{constructor(e){super(e),this.name=fw}}class Z3{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=It(e,"recoveryEnabled")?e.recoveryEnabled:Pi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=X3)}getTokenToInsert(e){const n=vu(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new hw(h,l,this.LA(0));p.resyncedTokens=_c(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new V3("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||be(n))return!1;const r=this.LA(1);return Zo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Sn(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Zo(e,s=>f3(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return f0;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return kt(e,(r,i)=>i===0?f0:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=kt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return tr(e)}getFollowSetFromFollowKey(e){if(e===f0)return[Gs];const n=e.ruleName+e.idxInCallingRule+Tb+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Gs)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return _c(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=pn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return kt(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function X3(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=Gs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const q3=4,us=8,dw=1<<us,pw=2<<us,d0=3<<us,p0=4<<us,m0=5<<us,Nu=6<<us;function g0(t,e,n){return n|e|t}class J3{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Pi.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(be(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return wr(e,n=>sw(n,n,Ys))}validateEmptyOrAlternatives(e){return wr(e,n=>U3(n,Ys))}validateAmbiguousAlternationAlternatives(e,n){return wr(e,r=>F3(r,n,Ys))}validateSomeNonEmptyLookaheadPath(e,n){return D3(e,n,Ys)}buildLookaheadForAlternation(e){return E3(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,k3)}buildLookaheadForOptional(e){return x3(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Qb(e.prodType),T3)}}class Q3{initLooksAhead(e){this.dynamicTokensEnabled=It(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Pi.dynamicTokensEnabled,this.maxLookahead=It(e,"maxLookahead")?e.maxLookahead:Pi.maxLookahead,this.lookaheadStrategy=It(e,"lookaheadStrategy")?e.lookaheadStrategy:new J3({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Ot(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=eU(n);Ot(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${ui(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=g0(this.fullRuleNameToShort[n.name],dw,l.idx);this.setLaFuncCache(d,f)})}),Ot(i,l=>{this.computeLookaheadFunc(n,l.idx,d0,"Repetition",l.maxLookahead,ui(l))}),Ot(s,l=>{this.computeLookaheadFunc(n,l.idx,pw,"Option",l.maxLookahead,ui(l))}),Ot(o,l=>{this.computeLookaheadFunc(n,l.idx,p0,"RepetitionMandatory",l.maxLookahead,ui(l))}),Ot(a,l=>{this.computeLookaheadFunc(n,l.idx,Nu,"RepetitionMandatoryWithSeparator",l.maxLookahead,ui(l))}),Ot(c,l=>{this.computeLookaheadFunc(n,l.idx,m0,"RepetitionWithSeparator",l.maxLookahead,ui(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=g0(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return g0(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class tU extends Hs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Ou=new tU;function eU(t){Ou.reset(),t.accept(Ou);const e=Ou.dslMethods;return Ou.reset(),e}function mw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function gw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function nU(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function rU(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const iU="name";function _w(t,e){Object.defineProperty(t,iU,{enumerable:!1,configurable:!0,writable:!1,value:e})}function sU(t,e){const n=_r(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function oU(t,e){const n=function(){};_w(n,t+"BaseSemantics");const r={visit:function(i,s){if(ne(i)&&(i=i[0]),!Fi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=cU(this,e);if(!be(i)){const s=kt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function aU(t,e,n){const r=function(){};_w(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ot(e,s=>{i[s]=sU}),r.prototype=i,r.prototype.constructor=r,r}var _0;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(_0||(_0={}));function cU(t,e){return lU(t,e)}function lU(t,e){const n=br(e,i=>Ci(t[i])===!1),r=kt(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:_0.MISSING_METHOD,methodName:i}));return gc(r)}class uU{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=It(e,"nodeLocationTracking")?e.nodeLocationTracking:Pi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Je,this.cstFinallyStateUpdate=Je,this.cstPostTerminal=Je,this.cstPostNonTerminal=Je,this.cstPostRule=Je;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=gw,this.setNodeLocationFromNode=gw,this.cstPostRule=Je,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=mw,this.setNodeLocationFromNode=mw,this.cstPostRule=Je,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=Je,this.setInitialNodeLocation=Je;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];nU(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];rU(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Fi(this.baseCstVisitorConstructor)){const e=oU(this.className,_r(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Fi(this.baseCstVisitorWithDefaultsConstructor)){const e=aU(this.className,_r(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class hU{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Mu}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Mu:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class fU{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Uu){if(Sn(this.definedRulesNames,e)){const o={message:Ys.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Rn.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Uu){const i=M3(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Ru(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return p8(He(this.gastProductionsCache))}}class dU{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Tu,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},It(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(ne(e)){if(be(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(ne(e))this.tokensMap=Bn(e,(s,o)=>(s[o.name]=o,s),{});else if(It(e,"modes")&&Mr(tr(He(e.modes)),c3)){const s=tr(He(e.modes)),o=hu(s);this.tokensMap=Bn(o,(a,c)=>(a[c.name]=c,a),{})}else if(gr(e))this.tokensMap=pn(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Gs;const r=It(e,"modes")?tr(He(e.modes)):He(e),i=Mr(r,s=>be(s.categoryMatches));this.tokenMatcher=i?Tu:xc,kc(He(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=It(r,"resyncEnabled")?r.resyncEnabled:Uu.resyncEnabled,s=It(r,"recoveryValueFunc")?r.recoveryValueFunc:Uu.recoveryValueFunc,o=this.ruleShortNameIdx<<q3+us;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Ru(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(pw,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(p0,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Pe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,p0,e,b3)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Nu,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,qb],a,Nu,e,qb)}else throw this.raiseEarlyExitException(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(d0,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,d0,e,y3,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(m0,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Xb],a,m0,e,Xb)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Nu,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(dw,n),i=ne(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new G3(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Ru(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new hw(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===fw?r:s}}else throw r}saveRecogState(){const e=this.errors,n=pn(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Gs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class pU{initErrorHandler(e){this._errors=[],this.errorMessageProvider=It(e,"errorMessageProvider")?e.errorMessageProvider:Pi.errorMessageProvider}SAVE_ERROR(e){if(Ru(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:pn(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return pn(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=l0(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new Y3(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=c0(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new K3(c,this.LA(1),a))}}class mU{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Fi(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Jb([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Ur(e.ruleStack),i=this.getGAstProductions()[n];return new _3(i,e).startWalking()}}const Cu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Cu);const yw=!0,bw=Math.pow(2,us)-1,ww=er({name:"RECORDING_PHASE_TOKEN",pattern:tn.NA});kc([ww]);const Ew=vu(ww,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Ew);const gU={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class _U{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Mu}topLevelRuleRecord(e,n){try{const r=new Xo({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Ac.call(this,jn,e,n)}atLeastOneInternalRecord(e,n){Ac.call(this,ci,n,e)}atLeastOneSepFirstInternalRecord(e,n){Ac.call(this,li,n,e,yw)}manyInternalRecord(e,n){Ac.call(this,Qe,n,e)}manySepFirstInternalRecord(e,n){Ac.call(this,Pr,n,e,yw)}orInternalRecord(e,n){return yU.call(this,e,n)}subruleInternalRecord(e,n,r){if(Lu(n),!e||It(e,"ruleName")===!1){const a=new Error(`<SUBRULE${xw(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Vo(this.recordingProdStack),s=e.ruleName,o=new Dn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?gU:Cu}consumeInternalRecord(e,n,r){if(Lu(n),!Bb(e)){const o=new Error(`<CONSUME${xw(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Vo(this.recordingProdStack),s=new Ce({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),Ew}}function Ac(t,e,n,r=!1){Lu(n);const i=Vo(this.recordingProdStack),s=Ci(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),It(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Cu}function yU(t,e){Lu(e);const n=Vo(this.recordingProdStack),r=ne(t)===!1,i=r===!1?t:t.DEF,s=new Br({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});It(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=Jd(i,a=>Ci(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ot(i,a=>{const c=new $n({definition:[]});s.definition.push(c),It(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:It(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Cu}function xw(t){return t===0?"":`${t}`}function Lu(t){if(t<0||t>bw){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${bw+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class bU{initPerformanceTracer(e){if(It(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Pi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=Eb(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function wU(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Mu=vu(Gs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Mu);const Pi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Zb,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Uu=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Rn;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Rn||(Rn={}));let y0=class Ux{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{xb(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ot(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=W3({rules:He(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(be(r)&&this.skipValidations===!1){const i=H3({rules:He(this.gastProductionsCache),tokenTypes:He(this.tokensMap),errMsgProvider:Ys,grammarName:n}),s=R3({lookaheadStrategy:this.lookaheadStrategy,rules:He(this.gastProductionsCache),tokenTypes:He(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),be(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=E8(He(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:He(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(He(this.gastProductionsCache))})),!Ux.DEFER_DEFINITION_ERRORS_HANDLING&&!be(this.definitionErrors))throw e=kt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),It(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=It(n,"skipValidations")?n.skipValidations:Pi.skipValidations}};y0.DEFER_DEFINITION_ERRORS_HANDLING=!1,wU(y0,[Z3,Q3,uU,hU,dU,fU,pU,mU,_U,bU]);class EU extends y0{constructor(e,n=Pi){const r=pn(n);r.outputCst=!0,super(e,r)}}function xU(t){const e=new kU,n=He(t);return kt(n,r=>e.visitRule(r))}class kU extends Hs{visitRule(e){const n=this.visitEach(e.definition),r=_b(n,s=>s.propertyName),i=kt(r,(s,o)=>{const a=!Jd(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=kt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Fu(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Fu(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Fu(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Fu(e)}]}visitEachAndOverrideWith(e,n){return kt(this.visitEach(e),r=>Fn({},r,n))}visitEach(e){return tr(kt(e,n=>this.visit(n)))}}function Fu(t){return t instanceof Dn?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function TU(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(tr(kt(t,r=>vU(r)))),e.includeVisitorInterface&&(n=n.concat(IU(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function vU(t){const e=AU(t),n=SU(t);return[e,n]}function AU(t){const e=Tw(t.name),n=b0(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function SU(t){return`export type ${b0(t.name)} = {
  ${kt(t.properties,n=>RU(n)).join(`
  `)}
};`}function RU(t){const e=OU(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function IU(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${kt(e,n=>NU(n)).join(`
  `)}
}`}function NU(t){const e=b0(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function OU(t){if(ne(t)){const e=hu(kt(t,r=>kw(r)));return"("+Bn(e,(r,i)=>r+" | "+i)+")"}else return kw(t)}function kw(t){return t.kind==="token"?"IToken":Tw(t.name)}function Tw(t){return D1(t)+"CstNode"}function b0(t){return D1(t)+"CstChildren"}const CU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function LU(t,e){const n=Object.assign(Object.assign({},CU),e),r=xU(t);return TU(r,n)}const hi=!!JSON.parse("false"),MU=!!JSON.parse("false");JSON.parse("false");const UU=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Bi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Hl*Bi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Kl*Bi.DRAW_CHAR_SCALE}},Pu=hy(32,126).map(t=>String.fromCharCode(t));function Yt(t){return er({...t,name:`token_${t.name}`})}function hs(t,e=!1){return Yt(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:gn,group:tn.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:gn})}const Sc=Yt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),FU=Yt({name:"whitespace",pattern:/ +/,group:tn.SKIPPED}),PU=Yt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:tn.SKIPPED}),w0=Yt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Jo=Yt({name:"command",pattern:/#/,start_chars_hint:["#"]});let vw=!1;function BU(t,e,n){if(!vw)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Sc)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const E0=Yt({name:"text",pattern:BU,line_breaks:!1,start_chars_hint:Pu.filter(t=>"@#/?':!".includes(t)===!1)}),Aw=Yt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Sw=Yt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Rw=Yt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Iw=Yt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),gn=Yt({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:Pu}),Nw=Yt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ow=Yt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Cw=Yt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:gn}),Lw=Yt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:gn}),Mw=Yt({name:"islessthan",pattern:/<|below/,longer_alt:gn}),Uw=Yt({name:"isgreaterthan",pattern:/>|above/,longer_alt:gn}),Fw=Yt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:gn}),Pw=Yt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:gn}),x0=Yt({name:"or",pattern:/or/i,longer_alt:gn}),k0=Yt({name:"not",pattern:/not/i,longer_alt:gn}),T0=Yt({name:"and",pattern:/and/i,longer_alt:gn}),v0=Yt({name:"plus",pattern:/\+/}),A0=Yt({name:"minus",pattern:/-/}),Bw=Yt({name:"power",pattern:/\*\*/}),Dw=Yt({name:"multiply",pattern:/\*/}),S0=Yt({name:"divide",pattern:/\//}),$w=Yt({name:"moddivide",pattern:/%/}),jw=Yt({name:"floordivide",pattern:/%%/}),zw=Yt({name:"query",pattern:/\?/}),Ww=Yt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Hw=Yt({name:"rparen",pattern:/\)/,pop_mode:!0}),Kw=Yt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Pu,longer_alt:gn}),Gw=Yt({name:"command_toast",pattern:/toast .*/,start_chars_hint:Pu,longer_alt:gn}),R0=Yt({name:"if",pattern:/if|try|take|give/,longer_alt:gn}),Bu=hs("do"),I0=hs("done"),N0=hs("else"),Yw=hs("while"),Vw=hs("repeat"),Zw=hs("waitfor"),Xw=Yt({name:"foreach",pattern:/foreach|for/,longer_alt:gn}),qw=hs("break"),Jw=hs("continue");function Qw(t){return[...t,Ow,Cw,Lw,Fw,Mw,Pw,Uw,x0,k0,T0,v0,A0,Bw,Dw,S0,jw,$w,zw,Ww,Hw,Nw,gn]}const tE=Qw([E0,w0,Kw,Gw,Jo,Aw,Sw,Rw,Iw,Sc,FU,qw,Jw,I0,Bu,N0,Xw,R0,Vw,Zw,Yw]),DU=new tn({defaultMode:"use_newlines",modes:{use_newlines:tE,ignore_newlines:Qw([PU])}},{skipValidations:!hi,ensureOptimizations:hi});function O0(t){vw=!0;const e=DU.tokenize(t||` 
`),[n]=(le(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(vu(Sc,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function $U(t,e,n=!0){if(n){const[r,...i]=e;switch(Nt(r??"")){default:return{type:xt.OBJECT,values:e};case"loader":return{type:xt.LOADER,values:i};case"board":return{type:xt.BOARD,values:i};case"object":return{type:xt.OBJECT,values:i};case"terrain":return{type:xt.TERRAIN,values:i};case"charset":return{type:xt.CHARSET,values:i};case"palette":return{type:xt.PALETTE,values:i}}}else{const[r,i,...s]=e,o=Nt(i??""),a=[r,t,...s];switch(o){default:return{type:xt.CONST,values:e};case"rn":case"range":return{type:xt.RANGE,values:a};case"sl":case"select":return{type:xt.SELECT,values:a};case"nm":case"number":return{type:xt.NUMBER,values:a};case"tx":case"text":return{type:xt.TEXT,values:a};case"ln":case"link":return{type:xt.LINK,values:a};case"hk":case"hotkey":return{type:xt.HOTKEY,values:a};case"copyit":return{type:xt.COPYIT,values:a};case"openit":return{type:xt.OPENIT,values:a};case"zssedit":return{type:xt.ZSSEDIT,values:a};case"charedit":return{type:xt.CHAREDIT,values:a};case"coloredit":return{type:xt.COLOREDIT,values:a}}}}function nr(t){switch(t){case xt.LOADER:return"loader";case xt.BOARD:return"board";case xt.OBJECT:return"object";case xt.TERRAIN:return"terrain";case xt.CHARSET:return"charset";case xt.PALETTE:return"palette";case xt.CONST:return"const";case xt.RANGE:return"range";case xt.SELECT:return"select";case xt.NUMBER:return"number";case xt.TEXT:return"text";case xt.LINK:return"link";case xt.HOTKEY:return"hotkey";case xt.COPYIT:return"copyit";case xt.OPENIT:return"openit";case xt.ZSSEDIT:return"zssedit";case xt.CHAREDIT:return"charedit";case xt.COLOREDIT:return"coloredit"}}var C0=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(C0||{});function eE(t){return zo(t,C0,{bits:e=>Array.from(e)})}function nE(t){return rc(t,C0,{bits:e=>new Uint8Array(e)})}function jU(t,e){return{id:Me(),code:t,...e}}var L0=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(L0||{});function zU(t){return zo(t,L0,{board:KN,object:jl,terrain:jl,charset:eE,palette:eE,stats:Se})}function WU(t){return rc(t,L0,{board:GN,object:zl,terrain:zl,charset:nE,palette:nE})}function Rc(t){const e={...Vs(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function HU(t){return x(t)?(t.stats=void 0,Vs(t)):{}}function rE(t){const e=O0(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===w0){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=$U(Et(c)?c:"",l,r),f=Nt(u.values.join(" "));switch(r=!1,u.type){case xt.LOADER:n.type=_t.LOADER,n.name=f;break;case xt.BOARD:n.type=_t.BOARD,n.name=f;break;case xt.OBJECT:n.type=_t.OBJECT,n.name=f||"object";break;case xt.TERRAIN:n.type=_t.TERRAIN,n.name=f;break;case xt.CHARSET:n.type=_t.CHARSET,n.name=f;break;case xt.PALETTE:n.type=_t.PALETTE,n.name=f;break;case xt.CONST:{const[d,h]=u.values;if(Et(d)){const p=Nt(d);if(Et(h)){const m=parseFloat(h);n[p]=St(m)?m:h}else St(h)?n[p]=h:n[p]=1}break}case xt.RANGE:case xt.SELECT:case xt.NUMBER:case xt.TEXT:case xt.LINK:case xt.HOTKEY:case xt.ZSSEDIT:case xt.CHAREDIT:case xt.COLOREDIT:{const[d,...h]=u.values;if(Et(d)){const p=Nt(d);n[p]=[nr(u.type),...h]}break}}}}return n}function Vs(t){var e;return x(t)?(x((e=t.stats)==null?void 0:e.type)||(t.stats=rE(t.code),x(t.stats.type)||(t.stats.type=_t.OBJECT)),t.stats):{}}function iE(t){switch(t){default:case _t.ERROR:return"error";case _t.LOADER:return nr(xt.LOADER);case _t.BOARD:return nr(xt.BOARD);case _t.OBJECT:return nr(xt.OBJECT);case _t.TERRAIN:return nr(xt.TERRAIN);case _t.CHARSET:return nr(xt.CHARSET);case _t.PALETTE:return nr(xt.PALETTE)}}function Di(t){return Vs(t).type??_t.ERROR}function $i(t){return iE(Di(t))}function je(t){return Vs(t).name??""}function sE(t,e){return Vs(t)[e]}const Du=new rd;function M0(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!le(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"ispushable":e.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=Kt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=Kt.ISSWIM;break;case"issolid":e.collision=Kt.ISSOLID;break;case"isbullet":e.collision=Kt.ISBULLET;break;case"isdestructible":e.destructible=1;break}}}function Le(t){var e;if(x(t))switch(Di(t)){default:return;case _t.ERROR:return t.code??"";case _t.LOADER:return t.code??"";case _t.BOARD:{x(t.board)||(t.board=bd()),t.board.id=t.id;const n=Rc(t);return t.board.isdark=n.isdark??t.board.isdark?1:0,t.board.startx=n.startx??t.board.startx,t.board.starty=n.starty??t.board.starty,t.board.over=n.over??t.board.over,t.board.under=n.under??t.board.under,t.board.camera=n.camera??t.board.camera,t.board.graphics=n.graphics??t.board.graphics,t.board.facing=n.facing??t.board.facing,t.board.exitnorth=n.exitnorth??t.board.exitnorth,t.board.exitsouth=n.exitsouth??t.board.exitsouth,t.board.exitwest=n.exitwest??t.board.exitwest,t.board.exiteast=n.exiteast??t.board.exiteast,t.board.timelimit=n.timelimit??t.board.timelimit,t.board.restartonzap=n.restartonzap??t.board.restartonzap,t.board.maxplayershots=n.maxplayershots??t.board.maxplayershots,t.board}case _t.OBJECT:return x(t.object)||(t.object=Vy()),t.object.name=je(t),t.object.category=or.ISOBJECT,M0(Rc(t),t.object),t.object;case _t.TERRAIN:return x(t.terrain)||(t.terrain=Vy()),t.terrain.name=je(t),t.terrain.category=or.ISTERRAIN,M0(Rc(t),t.terrain),t.terrain;case _t.PALETTE:{if(x(t.palette)||(t.palette=Td(n1)),x((e=t.palette)==null?void 0:e.bits)){const n=Rc(t),r=jr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&Et(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Du.set(o);const c=a*ac,l=Du.r*63,u=Du.g*63,f=Du.b*63;t.palette.bits[c+0]=qe(l,0,63),t.palette.bits[c+1]=qe(u,0,63),t.palette.bits[c+2]=qe(f,0,63)}}}}return t.palette}case _t.CHARSET:return x(t.charset)||(t.charset=e1(uO)),t.charset}}function oE(t){return{id:Me(),name:Xx(),timestamp:0,activelist:[],pages:t,flags:{}}}var U0=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))(U0||{});function KU(t){return zo(t,U0,{pages:e=>e.map(zU),flags:e=>{const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function GU(t){return rc(t,U0,{pages:e=>e.map(WU)})}function aE(t){x(t)&&(t.token=`${qx()}${fr(1111,9999)}`)}function ji(t,e){if(!x(t))return;const n=Nt(e);return t.pages.find(i=>i.id===e||n===je(i))}function en(t,e,n){if(!x(t))return;const r=Nt(n);return t.pages.find(s=>Di(s)===e&&(s.id===n||r===je(s)))}function F0(t,e,n){let r=en(t,e,n);if(!x(r)){const i=iE(e);r=jU(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),lE(t,r)}return r}function Zs(t,e){return x(t)?t.pages.filter(n=>Di(n)===e):[]}function zn(t,e,n){if(!x(t))return[];const r=Nt(n);return t.pages.filter(s=>Di(s)===e).filter(s=>{const o=Vs(s),a=Nt(je(s));return s.id===n||r===a||x(o[n])})}function $u(t){return x(t)?Yn(t.pages).sort((n,r)=>{const i=Di(n),s=Di(r);return i===s?je(n).localeCompare(je(r)):s-i}):[]}function cE(t,e){if(x(e)){const n=en(t,_t.TERRAIN,e.kind??"");if(x(n))return n;const r=en(t,_t.OBJECT,e.kind??"");if(x(r))return r}}function lE(t,e){if(!x(t)||!x(e))return!1;const n=ji(t,e.id);return x(n)?!1:(t.pages.push(e),aE(t),!0)}function uE(t,e){const n=ji(t,e);if(x(t)&&x(n)){const r=Nt(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==je(i)),aE(t),n}}function Dr(t,e){if(x(e)&&x(e.kind))return x(e.kinddata)||(e.kinddata=x(e.id)?Qo(t,e.kind):ju(t,e.kind)),e.kinddata}function wn(t,e,n){const r=Dr(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function fs(t,e){let n=Me();const r=wn(t,e,"group");Et(r)&&(n=r);const i=wn(t,e==null?void 0:e.kinddata,"group");return Et(i)&&(n=i),n}function hE(t,e,n,r,i){const s=Dr(t,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??n,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function Qo(t,e){const n=e??"",r=en(t,_t.OBJECT,n);if(x(r)){const i=Le(r);return{...Yn(i),name:n,code:r.code}}}function ju(t,e){const n=e??"",r=en(t,_t.TERRAIN,n);if(x(r)){const i=Le(r);return{...Yn(i),name:n,code:r.code}}}function ds(t,e){const n=ji(t,e);return Le(n)}function zi(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function fE(t,e){t&&delete t.flags[e]}function dE(t,e,n){const r=zi(t,e);return r==null?void 0:r[n]}function YU(t,e,n,r){const i=zi(t,e);return i&&(i[n]=r),r}function Xs(t,e){const n=dE(t,e,"board");return ds(t,Et(n)?n:"")}function VU(t,e){return(t==null?void 0:t.activelist.includes(e))??!1}function zu(t,e,n){if(!x(t))return;YU(t,e,"board",n);const r=ds(t,n);x(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function ta(t,e,n,r){if(!x(t))return;const i=Xs(t,e);if(!x(i))return;const s=vn(i,e);if(!bn(s)||!(s!=null&&s.id))return;const o=ds(t,n);if(!x(o)||(Ke(t,o),$0(t,o,Kt.ISWALK,r)))return;delete i.objects[s.id];const a=Cr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Cr(o,s);o.lookup&&(o.lookup[c]=s.id),zu(t,e,o.id)}function ZU(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=dE(t,r,"board");return Et(i)?i:""});return dN(n)}function P0(t){const e=ZU(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=ds(t,e[i]);if(x(s)&&!n.has(s.id)){if(Et(s.over))if(Et(s.overboard)){const o=ds(t,s.overboard);x(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=zn(t,_t.BOARD,s.over);if(o.length){const a=Ae(o),c=Le(a);x(c)&&(s.overboard=c.id)}}else Et(s.overboard)&&delete s.overboard;if(r.push(s),Et(s.under))if(Et(s.underboard)){const o=ds(t,s.underboard);x(o)||delete s.underboard}else{const o=zn(t,_t.BOARD,s.under);if(o.length){const a=Ae(o),c=Le(a);x(c)&&(s.underboard=c.id)}}else Et(s.underboard)&&delete s.underboard}}return r}function XU(t,e,n,r,i){if(!x(e))return;x(e.distmaps)||(e.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=e.distmaps[s];if(!x(o)){o=new Array(yd).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(x(l)&&Wl(l)){const u=Uo(l,Rt);if(o[u]===-2){const f=Wo(e,l.x,l.y);Ho(n,wn(t,f,"collision")??Kt.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}e.distmaps[s]=o}return o}function pE(t,e){return Wl(t)?e[Uo(t,Rt)]:-1}function mE(t,e,n,r,i,s){if(!x(t)||!x(e))return;const o=XU(t,e,n,r,i);if(!x(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const f=pE(a[u],o);f>=0&&f>l&&(l=f,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const f=pE(a[u],o);f>=0&&f<l&&(l=f,c=a[u])}}return c}function Ke(t,e){var a;if(!x(t)||!x(e)||x(e.lookup)&&x(e.named))return;const n=new Array(Rt*Qt).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(x(l.x)&&x(l.y)&&x(l.id)&&!x(l.removed)){l.category=or.ISOBJECT,n[l.x+l.y*Rt]=l.id;const u=Nt(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(x(l)){l.x=s,l.y=o,l.category=or.ISTERRAIN;const u=os(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=Rt&&(s=0,++o)}e.lookup=n,e.named=r}function Wu(t,e){x(e)&&(delete e.named,delete e.lookup,Ke(t,e))}function gE(t,e,n,r){var s;if(!x(t)||!x(e)||!x(e.named)||!x(n))return;const i=Nt(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function qU(t,e,n){if(!(!x(t)||!x(e)||!x(e.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*Rt]=n.id}}function JU(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.x)&&x(n.y)){const i=os(n),s=Cr(e,n);x((r=e.named)==null?void 0:r[i])&&e.named[i].delete(s)}}function B0(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.id)){if(x(e.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*Rt;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=os(n);x((r=e.named)==null?void 0:r[i])&&x(n.id)&&e.named[i].delete(n.id)}}function D0(t,e,n,r,i,s){const o=pt.MID;if(!x(t)||!x(e)||!x(n))return{dir:i,startpt:s,destpt:s,layer:o};const a={x:n.x??0,y:n.y??0},c={x:n.lx??a.x,y:n.ly??a.y},l=Ii(c,a),u=Rt-1,f=Qt-1;for(let d=0;d<i.length;++d){const h=pN(i[d]);switch(h){case pt.IDLE:break;case pt.NORTH:case pt.SOUTH:case pt.WEST:case pt.EAST:We(a,h);break;case pt.BY:{const[p,m]=i.slice(d+1);St(p)&&St(m)&&(a.x=qe(a.x+p,0,u),a.y=qe(a.y+m,0,f)),d+=2;break}case pt.TO:case pt.AT:{const[p,m]=i.slice(d+1);St(p)&&St(m)&&(a.x=qe(p,0,u),a.y=qe(m,0,f)),d+=2;break}case pt.FLOW:We(a,l);break;case pt.SEEK:{const p=XN(e,n,r);Do(p)&&We(a,Ii(s,p));break}case pt.RNDNS:We(a,Ae(pt.NORTH,pt.SOUTH));break;case pt.RNDNE:We(a,Ae(pt.NORTH,pt.EAST));break;case pt.RND:We(a,Ae(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));break;case pt.CW:case pt.CCW:case pt.OPP:case pt.RNDP:{const p=D0(t,e,n,r,i.slice(d+1),s);switch(a.x=s.x,a.y=s.y,h){case pt.CW:switch(Ii(s,p.destpt)){case pt.NORTH:We(a,pt.EAST);break;case pt.SOUTH:We(a,pt.WEST);break;case pt.EAST:We(a,pt.SOUTH);break;case pt.WEST:We(a,pt.NORTH);break}break;case pt.CCW:switch(Ii(s,p.destpt)){case pt.NORTH:We(a,pt.WEST);break;case pt.SOUTH:We(a,pt.EAST);break;case pt.EAST:We(a,pt.NORTH);break;case pt.WEST:We(a,pt.SOUTH);break}break;case pt.OPP:switch(Ii(s,p.destpt)){case pt.NORTH:We(a,pt.SOUTH);break;case pt.SOUTH:We(a,pt.NORTH);break;case pt.EAST:We(a,pt.WEST);break;case pt.WEST:We(a,pt.EAST);break}break;case pt.RNDP:switch(Ii(s,p.destpt)){case pt.NORTH:case pt.SOUTH:a.x+=Ae(-1,1);break;case pt.WEST:case pt.EAST:a.y+=Ae(-1,1);break}break}break}case pt.FLEE:case pt.AWAY:{const[p,m]=i.slice(d+1);if(St(p)&&St(m)){const w={x:qe(p,0,u),y:qe(m,0,f)},b=wn(t,n,"collision"),T=mE(t,e,b,a,w,!0);x(T)&&(a.x=T.x,a.y=T.y)}d+=2;break}case pt.FIND:case pt.TOWARD:{const[p,m]=i.slice(d+1);if(St(p)&&St(m)){const w={x:qe(p,0,u),y:qe(m,0,f)};if(fr(1,100)<5)We(a,Ae(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));else{const b=wn(t,n,"collision"),T=mE(t,e,b,a,w,!1);if(x(T))if(T.x!==p&&T.y!==m&&ZN(e,T))switch(Ii(s,T)){case pt.EAST:case pt.WEST:a.y+=Ae(-1,1);break;case pt.NORTH:case pt.SOUTH:a.x+=Ae(-1,1);break}else a.x=T.x,a.y=T.y}}d+=2;break}case pt.PLAYER:{const p=sc(e,s,r);Do(p)&&(a.x=p.x,a.y=p.y);break}case pt.OVER:case pt.UNDER:{const p=D0(t,e,n,r,i.slice(d+1),s);return p.layer=h,p}}}return{dir:i,startpt:s,destpt:a,layer:o}}function QU(t,e,n,r){if(x(t)&&x(e)&&x(n)){const[i,s]=n,o=Qo(t,i);if(x(o)&&x(o.name)){const a=xd(e,r,i);return ic(a,s),a}}}function qs(t,e,n,r,i){if(x(t)&&x(e)&&x(n)){const[s,o]=n,a=ju(t,s);if(x(a)){const l=VN(e,r,s);if(x(l)){ic(l,o);const u=Uo(r,Rt);return Dr(t,l),gE(t,e,l,u),l}}const c=Qo(t,s);if(x(c)&&x(c.name)){const l=xd(e,r,s,i);if(x(l))return ic(l,o),qU(t,e,l),Dr(t,l),gE(t,e,l),l}}}function rr(t,e,n,r){return!x(n)||os(n)==="player"?!1:(n.id?(n.removed=r,B0(t,e,n)):(un(e,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),JU(t,e,n)),!0)}function $0(t,e,n,r){if(!x(t)||!x(e)||!x(e.lookup)||r.x<0||r.x>=Rt||r.y<0||r.y>=Qt)return!0;const i=r.x+r.y*Rt,s=vn(e,e.lookup[i]??"404");if(x(s))return!0;const o=e.terrain[i];if(x(o)){const a=Dr(t,o),c=o.collision??(a==null?void 0:a.collision);return Ho(n,c)}return!1}function tF(t,e,n,r){const i=vn(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=wn(t,i,"collision");return $0(t,e,a,r)}function j0(t,e,n,r){var d;const i=vn(e,(n==null?void 0:n.id)??"");if(!x(t)||!x(e)||!x(i)||!x(i.x)||!x(i.y)||!x(e.lookup)||!x(n)||r.x<0||r.x>=Rt||r.y<0||r.y>=Qt)return{name:"edge",kind:"edge",collision:Kt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Cr(e,i),o=Cr(e,r),a=wn(t,i,"collision")??Kt.ISWALK,c=vr(i==null?void 0:i.id),l=vn(e,e.lookup[o]??""),u=vr((l==null?void 0:l.id)??"");if(x(l)&&(!c||!u)&&fs(t,n)!==fs(t,l)){if(!!wn(t,l,"pushable")){const p={x:r.x-(n.x??0),y:r.y-(n.y??0)};j0(t,e,l,p)}return{...l}}const f=e.terrain[o];if(x(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??Kt.ISWALK;if(Ho(a,h))return{...f,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function eF(t,e,n){const r=[];if(!x(t)||!x(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>rl*5&&(r.push(o.id),Zy(e,o.id))}return r}function nF(t,e,n){const r=[];if(!x(t)||!x(e))return r;e.lookup=void 0,Ke(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!x(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Dr(t,a),l=`${(c==null?void 0:c.code)??""}
${a.code??""}`;l&&r.push({id:a.id,type:_t.OBJECT,code:l,object:a,terrain:void 0})}const s=eF(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:_t.ERROR,code:"",object:void 0,terrain:void 0});return r}function rF(t,e,n){const r=[],i=[];if(!x(t)||!x(e))return{objectelements:r,terrainelements:i};function s(a){const c=wn(t,a,n),l=fs(t,a);return x(c)||l===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c)&&r.push(c)}for(let a=0;a<yd;++a){const c=e.terrain[a];x(c)&&s(c)&&i.push(c)}return{objectelements:r,terrainelements:i}}var _E={exports:{}},z0={exports:{}},yE;function iF(){return yE||(yE=1,function(t,e){(function(n,r){t.exports=r()})(Cn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(m){if(m)for(var w=0;w<u.length;w++)m[u[w]]!==void 0&&this["set"+r(u[w])](m[u[w]])}f.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof f)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new f(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",w=this.getLineNumber()||"",b=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+w+":"+b+")":"[eval]:"+w+":"+b:T?T+" ("+m+":"+w+":"+b+")":m+":"+w+":"+b}},f.fromString=function(w){var b=w.indexOf("("),T=w.lastIndexOf(")"),A=w.substring(0,b),v=w.substring(b+1,T).split(","),C=w.substring(T+1);if(C.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),R=S[1],U=S[2],O=S[3];return new f({functionName:A,args:v||void 0,fileName:R,lineNumber:U||void 0,columnNumber:O||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(m){return function(w){this[m]=!!w}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(m){return function(w){if(!n(w))throw new TypeError(m+" must be a Number");this[m]=Number(w)}}(o[h]);for(var p=0;p<a.length;p++)f.prototype["get"+r(a[p])]=i(a[p]),f.prototype["set"+r(a[p])]=function(m){return function(w){this[m]=String(w)}}(a[p]);return f})}(z0)),z0.exports}(function(t,e){(function(n,r){t.exports=r(iF())})(Cn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),p=d&&f||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:w,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(_E);var sF=_E.exports,oF=io(sF);function fi(t){const e={},n={tick(){},everytick(){},listcommands(){return jr(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function we(t){return`${t??""}`}function Ic(t,e){const n=parseFloat(we(t));return isNaN(n)?e:n}function bE(t,e,n){var i;const[r]=rt(e,0,[$.MAYBE_NAME]);DA(G,t,((i=_.board)==null?void 0:i.id)??"",r??"",n)}function Er(t,e,n,r){const[i,s]=rt(r,0,[$.NUMBER_OR_STRING,$.MAYBE_NUMBER_OR_STRING]);rg(G,t,e,n,i,s)}const aF=["echo","reverb","phaser","distortion","vibrato","fc"];function wE(t,e,n){const[r,i]=rt(n,0,[$.NUMBER_OR_STRING]);if(St(r))ef(G,t,e,"volume",r);else if(aF.includes(Nt(r))){const[s,o]=rt(n,i,[$.NUMBER_OR_STRING,$.MAYBE_NUMBER_OR_STRING]);rg(G,t,e,r,s,o)}else{const[s]=rt(n,i,[$.MAYBE_NUMBER_OR_STRING]);if(St(s)){const o=n.length-i,a=new Array(o).fill($.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;ef(G,t,e,r,l)}else{const[o]=rt(n,i,[$.MAYBE_NUMBER_OR_STRING]);ef(G,t,e,r,o)}}}const W0=fi().command("talk",(t,e)=>{const[n]=rt(e,0,[$.ANY]);switch(Nt(n)){default:wA(G,_.elementfocus);break;case"stop":EA(G,_.elementfocus);break}return 0}).command("media",(t,e)=>{const[n]=rt(e,0,[$.ANY]);switch(Nt(n)){default:xA(G,_.elementfocus);break;case"stop":kA(G,_.elementfocus);break}return 0}).command("tts",(t,e)=>{const[n,r]=rt(e,0,[$.STRING]),i=e.slice(r).map(we).join("");return PA(G,_.elementfocus,n,i),0}).command("tta",(t,e)=>{const n=e.map(we).join("");return BA(G,_.elementfocus,n),0}).command("bpm",(t,e)=>{const[n]=rt(e,0,[$.NUMBER]);return jA(G,_.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=rt(e,0,[$.NUMBER]);return zA(G,_.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=rt(e,0,[$.NUMBER]);return WA(G,_.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=rt(e,0,[$.NUMBER]);return HA(G,_.elementfocus,n),0}).command("play",(t,e)=>(bE(_.elementfocus,e,!1),0)).command("bgplay",(t,e)=>(bE(_.elementfocus,e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)wE(_.elementfocus,n,e);return 0}).command("echo",(t,e)=>{for(let n=0;n<3;++n)Er(_.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<3;++n)Er(_.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<3;++n)Er(_.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<3;++n)Er(_.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<3;++n)Er(_.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<3;++n)Er(_.elementfocus,n,"vibrato",e);return 0});for(let t=0;t<8;++t)W0.command(`synth${t+1}`,(e,n)=>(wE(_.elementfocus,t,n),0));for(let t=0;t<3;++t){const e=t+1;W0.command(`echo${e}`,(n,r)=>(Er(_.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(Er(_.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(Er(_.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(Er(_.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(Er(_.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(Er(_.elementfocus,t,"vibrato",r),0))}const cF=hy(32,126).map(t=>String.fromCharCode(t)),lF=er({name:"Whitespace",pattern:/ +/}),uF=er({name:"WhitespaceSkipped",pattern:/ +/,group:tn.SKIPPED}),H0=er({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),EE=er({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:cF}),K0=er({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),G0=er({name:"EscapedDollar",pattern:"$$"}),Y0=er({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),V0=er({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),xE=er({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function hF(t,e=""){return er({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const kE=Object.keys(Qa).map(t=>hF(`\\$(${t})`,t)),fF=[lF,H0,...kE,K0,EE,V0,G0,xE,Y0],dF=new tn(fF,{skipValidations:!hi,ensureOptimizations:hi}),pF=new tn([uF,H0,...kE,K0,EE,V0,G0,xE,Y0],{skipValidations:!hi,ensureOptimizations:hi});function Z0(t,e=!1){return e?pF.tokenize(t):dF.tokenize(t)}function X0(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function TE(t){t.active={...t.reset}}function vE(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case G0:s("$");break;case V0:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case K0:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case H0:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=Qa[l],f=gN(jt[u]),d=_N(jt[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):x(f)?e.active.color=f:x(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(x(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){TE(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;gF(u,u+l.length,e.active.color,e.active.bg,e),mF(u,l,e)}}}function AE(t,e,n){const r=Z0(t);r.tokens&&(vE(r.tokens,e),n&&TE(e),e.changed())}function SE(t,e,n){const r=Z0(t);if(!r.tokens)return;const i=X0(e,n,jt.WHITE,jt.BLACK);return i.measureonly=!0,vE(r.tokens,i),i.x>0&&++i.y,i}function mF(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function gF(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function RE(t,e,n){if(!Do(_.element))return 0;const[r,i]=rt(e,0,[$.DIR,$.MAYBE_KIND]),s=i??["bullet"],o=QU(_.book,_.board,s,{x:_.element.x,y:_.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=_.elementid,o.collision=Kt.ISBULLET,o.destructible=1,o.stepx=r.destpt.x-_.element.x,o.stepy=r.destpt.y-_.element.y,o.bg=jt.ONCLEAR;const a=Dr(_.book,o),c=o.code??(a==null?void 0:a.code)??"";bx(_.book,_.board,o,c,1)}return t.yield(),0}function Hu(t,e,n,r){var f,d;if(!Do(_.element)||!x(_.book)||!x(_.board)||!x(_.element))return 0;Ke(_.book,_.board);const[i,s]=rt(e,0,[$.DIR,$.KIND]),o=_e(_.board,i.destpt);if((o==null?void 0:o.category)===or.ISOBJECT&&(o!=null&&o.pushable)){const h={x:((f=_.element)==null?void 0:f.x)??0,y:((d=_.element)==null?void 0:d.y)??0},p=We(i.destpt,Ii(h,i.destpt));j0(_.book,_.board,o,p)}const[a]=s,c=Qo(_.book,a)??ju(_.book,a),l=(c==null?void 0:c.collision)??Kt.ISWALK;if(!$0(_.book,_.board,l,i.destpt)){const h=qs(_.book,_.board,s,i.destpt,n);x(h)&&x(r)&&(h.arg=r)}return 0}const _F=fi().command("board",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;const[n,r]=rt(e,0,[$.NAME]),[i,s]=rt(e,r,[$.MAYBE_NUMBER,$.MAYBE_NUMBER]),o=zn(_.book,_t.BOARD,n);if(o.length){const a=Ae(...o);x(a)&&ta(_.book,_.elementfocus,a.id,{x:i??Math.round(Rt*.5),y:s??Math.round(Qt*.5)})}return 0}).command("edge",(t,e)=>{var s,o;if(!x(_.book)||!x(_.board)||!x(_.element))return 0;const[n,r]=rt(e,0,[$.DIR,$.NAME]),i=zn(_.book,_t.BOARD,r);if(i.length){const a={x:((s=_.element)==null?void 0:s.x)??0,y:((o=_.element)==null?void 0:o.y)??0},c=Ii(a,n.destpt),l=Ae(...i);switch(c){case pt.NORTH:_.board.exitnorth=l.id;break;case pt.SOUTH:_.board.exitsouth=l.id;break;case pt.WEST:_.board.exitwest=l.id;break;case pt.EAST:_.board.exiteast=l.id;break}}return 0}).command("shove",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;Ke(_.book,_.board);const[n,r]=rt(e,0,[$.DIR,$.DIR]),i=_e(_.board,n.destpt);return bn(i)&&ua(_.book,_.board,i,r.destpt),0}).command("duplicate",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;Ke(_.book,_.board);const[n,r]=rt(e,0,[$.DIR,$.DIR]),i=_e(_.board,n.destpt);return bn(i),0}).command("write",(t,e)=>{var l;if(!x(_.book)||!x(_.board))return 0;Ke(_.book,_.board);const[n,r,i]=rt(e,0,[$.DIR,$.COLOR,$.STRING]),{color:s,bg:o}=by(r),a=((l=SE(i,256,1))==null?void 0:l.measuredwidth)??1,c=X0(256,1,s??jt.WHITE,o??jt.BLACK);AE(i,c,!1);for(let u=0;u<a;++u)un(_.board,{x:n.destpt.x+u,y:n.destpt.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;Ke(_.book,_.board);const[n,r]=rt(e,0,[$.KIND,$.KIND]);(ld(n)??"")==="empty"&&qN(_.board).forEach(c=>{qs(_.book,_.board,r,c)});const s=ld(r),o=Ey(r),a=xy(r);return Xy(_.board,n).forEach(c=>{if(os(c)===s)x(o)&&(c.color=o),x(a)&&(c.bg=a);else if(rr(_.book,_.board,c,_.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};qs(_.book,_.board,r,l)}}),0}).command("put",(t,e)=>Hu(t,e)).command("putwith",(t,e)=>{const[n,r]=rt(e,0,[$.ANY]);return Hu(t,e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=rt(e,0,[$.ANY]);return x(_.board)&&vn(_.board,n)?0:Hu(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=rt(e,0,[$.ANY,$.ANY]);return x(_.board)&&vn(_.board,r)?0:Hu(t,e.slice(i),r,n)}).command("shoot",RE).command("shootwith",(t,e)=>{const[n,r]=rt(e,0,[$.ANY]);return RE(t,e.slice(r),n)}),ps="$dkpurple",yF="$196",bF="$205";function zt(t,e,n){Ei(t,e,n)}function wF(t,e,n){const r=yF.repeat(n);zt(t,e,`${ps}${r}`)}function q0(t,e,n){const r=bF.repeat(n);zt(t,e,`${ps}${r}`)}function Js(t,e,n){zt(t,e,`${ps} ${" ".repeat(n.length)} `),wF(t,e,n.length+2),zt(t,e,`${ps} $white${n} `),q0(t,e,n.length+2)}function Wi(t,e,n){zt(t,e,`${ps} ${" ".repeat(n.length)} `),zt(t,e,`${ps} $gray${n} `),q0(t,e,n.length+2)}function re(t,e,n,r){zt(t,e,`${ps} $white${n} $blue${r}`)}function Ge(t,e,n){zt(t,e,`${ps}$blue${n}`)}function IE(t){const[e,n]=t.split(":"),r=x(n);return[r?e:"self",r?n:t]}const EF=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function ea(){og(G,kr())}const xF=fi().command("send",(t,e)=>{const[n,r]=rt(e,0,[$.NAME,$.ANY]);switch(Nt(n)){case"helpmenu":Js(G,_.elementfocus,"H E L P"),zt(G,_.elementfocus,""),re(G,_.elementfocus,"#help controls","zss controls and inputs"),zt(G,_.elementfocus,"!helpcontrols;read help controls"),zt(G,_.elementfocus,""),re(G,_.elementfocus,"#help text","text formatting"),zt(G,_.elementfocus,"!helptext;read help text"),zt(G,_.elementfocus,""),re(G,_.elementfocus,"#help developer","developer commands"),zt(G,_.elementfocus,"!helpdeveloper;read help developer"),zt(G,_.elementfocus,""),re(G,_.elementfocus,"#help player","player settings"),zt(G,_.elementfocus,"!helpplayer;read help player"),Wi(G,_.elementfocus,"keyboard input"),re(G,_.elementfocus,"?","open console"),re(G,_.elementfocus,"esc","close console"),re(G,_.elementfocus,"tab","move console"),re(G,_.elementfocus,"up / down arrow keys","navigate console items"),re(G,_.elementfocus,"left / right arrow keys","change console items"),re(G,_.elementfocus,"enter","interact with console items"),re(G,_.elementfocus,"alt + arrow keys","skip words and console lines"),re(G,_.elementfocus,`${EF} + up / down arrow keys`,"input history");break;case"helpcontrols":Js(G,_.elementfocus,"zss controls and inputs"),Wi(G,_.elementfocus,"keyboard input"),re(G,_.elementfocus,"arrow keys","move"),re(G,_.elementfocus,"shift + arrow keys","shoot"),re(G,_.elementfocus,"enter","ok / accept"),re(G,_.elementfocus,"escape","cancel / close"),re(G,_.elementfocus,"tab","menu / action"),Wi(G,_.elementfocus,"controller input"),re(G,_.elementfocus,"left stick","move"),re(G,_.elementfocus,"right stick","aim"),re(G,_.elementfocus,"a","ok / accept"),re(G,_.elementfocus,"b","cancel / close"),re(G,_.elementfocus,"y","menu / action"),re(G,_.elementfocus,"x","shoot"),re(G,_.elementfocus,"triggers","shoot");break;case"helptext":break;case"helpdeveloper":Js(G,_.elementfocus,"developer commands"),re(G,_.elementfocus,"#books","list books in memory"),re(G,_.elementfocus,"#pages","list pages in opened book"),re(G,_.elementfocus,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),re(G,_.elementfocus,"#trash","list books and pages from open book you can delete"),re(G,_.elementfocus,"#save","flush state to register"),re(G,_.elementfocus,"#share","creates a click to copy share url and QR code");break;case"helpplayer":Js(G,_.elementfocus,"player settings"),Ge(G,_.elementfocus,"todo");break;default:{const[i,s]=IE(n);pp(i==="self"&&_.elementisplayer?`${_.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(we),s=i.join(" ");switch(Nt(r)){case nr(xt.LOADER):n=bs(Bt.CONTENT,s,_t.LOADER);break;default:n=bs(Bt.CONTENT,[r,...i].join(" "),_t.OBJECT);break;case nr(xt.BOARD):n=bs(Bt.CONTENT,s,_t.BOARD);break;case nr(xt.OBJECT):n=bs(Bt.CONTENT,s,_t.OBJECT);break;case nr(xt.TERRAIN):n=bs(Bt.CONTENT,s,_t.TERRAIN);break;case nr(xt.CHARSET):n=bs(Bt.CONTENT,s,_t.CHARSET);break;case nr(xt.PALETTE):n=bs(Bt.CONTENT,s,_t.PALETTE);break}return x(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(we).join(" ");return x(_.element)&&(_.element.tickertext=n,_.element.tickertime=_.timestamp),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=we(n),s=r.map(we).join(" ");return Ei(G,_.elementfocus,`!${s};${i}`),0}).command("bookcreate",(t,e)=>{const[n]=rt(e,0,[$.MAYBE_NAME]),r=gx(n);return x(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=$r(n);return x(r)?(Ge(G,_.elementfocus,`opened [book] ${r.name}`),oh(Bt.MAIN,r.id),t.command("pages")):de(G,_.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=fe(Bt.MAIN),i=$r(n);return x(i)&&(r===i&&oh(Bt.MAIN,""),xB(n),Ge(G,_.elementfocus,`trashed [book] ${i.name}`),ea(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=zn(_.book,_t.BOARD,n);if(r.length){const i=Ae(...r);x(i)&&ta(_.book,_.elementfocus,i.id,{x:fr(0,Rt-1),y:fr(0,Qt-1)})}return 0}).command("pageopenwith",(t,e)=>{const[n,r,i]=rt(e,0,[$.NAME,$.MAYBE_NAME,$.MAYBE_NAME]);return t.command("pageopen",r,i,n)}).command("pageopen",(t,e)=>{const[n,r,i]=rt(e,0,[$.NAME,$.MAYBE_NAME,$.MAYBE_NAME]),s=Nn(Bt.MAIN);if(!x(s))return 0;const o=ji(s,n);if(x(o)){const a=je(o),c=$i(o);Ge(G,_.elementfocus,`opened [${c}] ${a}`);const l=[],u=ji(s,i??""),f=x(u)?O0(u.code):void 0;if(x(f))for(let p=0;p<f.tokens.length;++p){const m=f.tokens[p];m.tokenType===E0&&l.push(m.image.startsWith('"')?m.image.slice(1):m.image)}const d=[o.id,r];Jf(el(s.id,d),o.code);const h=$i(o);ig(G,_.elementfocus,s.id,d,h,`${a} - ${s.name}`,l)}else de(G,"pageopen",`page ${n} not found`,_.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=Nn(Bt.MAIN),i=uE(r,n);if(x(n)){const s=je(i),o=$i(i);Ge(G,_.elementfocus,`trashed [${o}] ${s}`),ea(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(we).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{Wi(G,_.elementfocus,"books");const t=fe(Bt.MAIN);re(G,_.elementfocus,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=fe(Bt.CONTENT);re(G,_.elementfocus,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),q0(G,_.elementfocus,7);const n=la();return n.length?n.forEach(r=>{zt(G,_.elementfocus,`!bookopen ${r.id};${r.name}`)}):Ge(G,_.elementfocus,"no books found"),zt(G,_.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=Nn(Bt.MAIN);return x(t)&&(Wi(G,_.elementfocus,"pages"),re(G,_.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?$u(t).forEach(n=>{const r=je(n),i=$i(n);zt(G,_.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(zt(G,_.elementfocus,""),Ge(G,_.elementfocus,"$white no pages found"),Ge(G,_.elementfocus,"$white use @ to create a page"),Ge(G,_.elementfocus,"$white @board name of board"),Ge(G,_.elementfocus,"$white @object name of object"),Ge(G,_.elementfocus,"$white @terrain name of terrain"),Ge(G,_.elementfocus,"$white You can omit the type and it will default to object"),Ge(G,_.elementfocus,"$white @object name of object"),Ge(G,_.elementfocus,"$white @name of object"))),0}).command("boards",()=>{Wi(G,_.elementfocus,"boards");const t=Nn(Bt.MAIN);if(x(t)){re(G,_.elementfocus,"main",`${t.name} $GREEN${t.id}`);const e=$u(t);e.filter(n=>Di(n)===_t.BOARD).forEach(n=>{const r=je(n),i=$i(n);zt(G,_.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),e.length===0&&(zt(G,_.elementfocus,""),Ge(G,_.elementfocus,"$white no boards found"),Ge(G,_.elementfocus,"$white use @ to create a board"),Ge(G,_.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{Wi(G,_.elementfocus,"$REDTRASH"),Ge(G,_.elementfocus,"books");const t=la();t.length&&(t.forEach(n=>{zt(G,_.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),zt(G,_.elementfocus,""));const e=fe(Bt.MAIN);return x(e)&&(Ge(G,_.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=je(n);zt(G,_.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),zt(G,_.elementfocus,"")),0}).command("dev",()=>(ea(),MA(G,_.elementfocus),0)).command("share",()=>(ea(),UA(G,_.elementfocus),0)).command("save",()=>(ea(),0)).command("fork",()=>(ZA(G,_.elementfocus),0)).command("nuke",()=>(FA(G,_.elementfocus),0)).command("restart",()=>(VA(G,_.elementfocus),ea(),0)).command("export",()=>{Js(G,_.elementfocus,"E X P O R T"),Wi(G,_.elementfocus,"books");const t=la();return t.length&&t.forEach(e=>zt(G,_.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=$r(n);return x(r)&&(Js(G,_.elementfocus,"E X P O R T"),Wi(G,_.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=$u(r);zt(G,_.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=je(s),a=$i(s);zt(G,_.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=$r(n);return x(r)&&ng(G,_.elementfocus,Yn(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=rt(e,0,[$.NAME]),{target:r,path:i}=Ar(n),s=$r(r),o=ji(s,i);return x(o)&&ng(G,_.elementfocus,Yn(o),`${je(o)}.${$i(o)}.json`),0}).command("gadget",()=>(KA(G,_.elementfocus),0)).command("joincode",(t,e)=>{const[n]=rt(e,0,[$.MAYBE_NAME]);return TA(G,_.elementfocus,!!n),0}).command("jointab",(t,e)=>{const[n]=rt(e,0,[$.MAYBE_NAME]);return vA(G,_.elementfocus,!!n),0}),kF=fi().command("toast",(t,e)=>{const n=e.map(we).join("");return pA(G,_.elementfocus,n),0}).command("palette",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=_x(),i=en(_.book,_t.PALETTE,n);return x(i)?(r.palette=i.id,zt(G,_.elementfocus,`loaded palette ${n}`)):de(G,_.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=_x(),i=en(_.book,_t.CHARSET,n);return x(i)?(r.charset=i.id,zt(G,_.elementfocus,`loaded charset ${n}`)):de(G,_.elementfocus,"not-found",`unabled to find charset ${n}`),0}),J0={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Nc(t){return le(t)&&NE(t[0])}function NE(t){return x(or[t])&&Et(t)}function OE(t){if(Et(t))return J0[Nt(t)]}function CE(t){if(Nc(t))return t;if(NE(t))return[t];const e=OE(t);if(x(e))return[e]}function TF(t){const e=_.words[t],n=CE(e);if(Nc(n))return[n,t+1];const[r,i]=Hn(t),s=CE(r);return Nc(s)?[s,i]:[void 0,t]}const Q0={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Kt.ISSOLID,Kt.ISWALK,Kt.ISSWIM,Kt.ISBULLET,Kt.ISWALK,Kt.ISSWIM;function Ku(t){return le(t)&&tp(t[0])}function tp(t){return x(Kt[t])&&Et(t)}function vF(t){if(Et(t))return Q0[Nt(t)]}function AF(t){const e=_.words[t];if(Ku(e))return[e,t+1];if(tp(e))return[[e],t+1];const[n,r]=Hn(t);return Ku(n)?[n,r]:tp(n)?[[n],r]:[void 0,t]}const SF=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),LE=new Set(["char","color","bg","group","party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),RF=["NORTH","SOUTH","WEST","EAST"];function IF(t){const e=mi(t);if(St(e.inputcurrent)||(e.inputcurrent=0),le(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=An.NONE,i=0]=n??[An.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&oO?1:0,e.inputctrl=i&aO?1:0,e.inputshift=i&cO?1:0,r){case An.MOVE_UP:case An.MOVE_DOWN:case An.MOVE_LEFT:case An.MOVE_RIGHT:e.inputmove=[RF[r-An.MOVE_UP]];break;case An.OK_BUTTON:e.inputok=1;break;case An.CANCEL_BUTTON:e.inputcancel=1;break;case An.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==An.NONE&&o!==r}),e}function NF(t){const e=J0[t];if(x(e))return e;const n=Q0[t];if(x(n))return n;const r=Qa[t];if(x(r))return r;const i=sd[t];if(x(i))return i}const OF=fi({get(t,e){var o,a,c,l,u,f,d,h,p,m,w,b,T,A,v,C,S,R,U,O,D;const n=NF(e);if(x(n))return[!0,n];if(_.elementisplayer&&SF.has(e)){const V=IF(_.elementid)[e];return[x(V),V]}const r=sc(_.board,{x:((o=_.element)==null?void 0:o.x)??-1,y:((a=_.element)==null?void 0:a.y)??-1},_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus??kr();switch(e){case"isdark":return[!0,(c=_.board)!=null&&c.isdark?1:0];case"startx":return[!0,((l=_.board)==null?void 0:l.startx)??0];case"starty":return[!0,((u=_.board)==null?void 0:u.starty)??0];case"over":return[!0,((f=_.board)==null?void 0:f.over)??""];case"under":return[!0,((d=_.board)==null?void 0:d.under)??""];case"camera":return[!0,((h=_.board)==null?void 0:h.camera)??""];case"graphics":return[!0,((p=_.board)==null?void 0:p.graphics)??""];case"facing":break;case"exitnorth":return[!0,((m=_.board)==null?void 0:m.exitnorth)??""];case"exitsouth":return[!0,((w=_.board)==null?void 0:w.exitsouth)??""];case"exitwest":return[!0,((b=_.board)==null?void 0:b.exitwest)??""];case"exiteast":return[!0,((T=_.board)==null?void 0:T.exiteast)??""];case"timelimit":return[!0,((A=_.board)==null?void 0:A.timelimit)??0];case"restartonzap":return[!0,((v=_.board)==null?void 0:v.restartonzap)??0];case"maxplayershots":return[!0,((C=_.board)==null?void 0:C.maxplayershots)??0];case"boardid":return[!0,((S=_.board)==null?void 0:S.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((R=_.element)==null?void 0:R.id)??""];case"thisx":return[!0,((U=_.element)==null?void 0:U.x)??-1];case"thisy":return[!0,((O=_.element)==null?void 0:O.y)??-1];default:{const V=(D=_.element)==null?void 0:D[e];if(LE.has(e))return[!0,V];break}}const s=mi(i)[e];return[x(s),s]},set(t,e,n){var o,a;const r=sc(_.board,{x:((o=_.element)==null?void 0:o.x)??-1,y:((a=_.element)==null?void 0:a.y)??-1},_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus;switch(e){case"isdark":if(x(_.board))return _.board.isdark=n?1:0,[!0,_.board.isdark];break;case"startx":if(x(_.board))return _.board.startx=Ic(n,0),[!0,_.board.startx];break;case"starty":if(x(_.board))return _.board.starty=Ic(n,0),[!0,_.board.starty];break;case"over":if(x(_.board))return _.board.over=St(n)?n:we(n),[!0,_.board.over];break;case"under":if(x(_.board))return _.board.under=St(n)?n:we(n),[!0,_.board.under];break;case"camera":if(x(_.board))return[!0,_.board.camera=we(n)];break;case"graphics":if(x(_.board))return[!0,_.board.graphics=we(n)];break;case"facing":break;case"exitnorth":if(x(_.board))return _.board.exitnorth=we(n),[!0,_.board.exitnorth];break;case"exitsouth":if(x(_.board))return _.board.exitsouth=we(n),[!0,_.board.exitsouth];break;case"exitwest":if(x(_.board))return _.board.exitwest=we(n),[!0,_.board.exitwest];break;case"exiteast":if(x(_.board))return _.board.exiteast=we(n),[!0,_.board.exiteast];break;case"timelimit":if(x(_.board))return _.board.timelimit=Ic(n,0),[!0,_.board.timelimit];break;case"restartonzap":if(x(_.board))return _.board.restartonzap=n?1:0,[!0,_.board.restartonzap];break;case"maxplayershots":if(x(_.board))return _.board.maxplayershots=Ic(n,0),[!0,_.board.maxplayershots];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(LE.has(e))return x(_.element)&&(_.element[e]=n),[!0,n];break}}const s=mi(i);return x(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n,r,i;if(!((t=_.element)!=null&&t.removed)&&(x((e=_.element)==null?void 0:e.stepx)||x((n=_.element)==null?void 0:n.stepy))){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};ua(_.book,_.board,_.element,{x:s.x+(_.element.stepx??0),y:s.y+(_.element.stepy??0)})===!1&&(_.element.stepx=0,_.element.stepy=0,wn(_.book,_.element,"destructible")&&rr(_.book,_.board,_.element,_.timestamp))}}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(we(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=rt(e,0,[$.NAME,$.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{var r,i;const[n]=rt(e,0,[$.KIND]);if(Ke(_.book,_.board),B0(_.book,_.board,_.element),rr(_.book,_.board,_.element,_.timestamp)){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};qs(_.book,_.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=rt(e,0,[$.ANY]);if(Ni(n)){const[r,i]=rt(e,0,[$.DIR,$.NUMBER]),s=_e(_.board,r.destpt);x(s)&&(s.char=i)}else x(_.element)&&St(n)&&(_.element.char=n);return 0}).command("color",(t,e)=>{const[n]=rt(e,0,[$.ANY]);if(Ni(n)){const[r,i]=rt(e,0,[$.DIR,$.COLOR]),s=_e(_.board,r.destpt);x(s)&&ic(_.element,i)}else{const[r]=rt(e,0,[$.COLOR]);x(_.element)&&x(r)&&ic(_.element,r)}return 0}).command("go",(t,e)=>{if(x(_.element)){const[n]=rt(e,0,[$.DIR]);if(ua(_.book,_.board,_.element,n.destpt),t.yield(),_.element.x===n.destpt.x&&_.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!x(_.element))return 0;const[n]=rt(e,0,[$.DIR]),r=_.element.x??0,i=_.element.y??0;return _.element.stepx=n.destpt.x-r,_.element.stepy=n.destpt.y-i,0}),CF=fi().command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=rt(e,0,[$.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(we(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(we(e[0])),0)).command("cycle",(t,e)=>{if(x(_.element)){const[n]=rt(e,0,[$.NUMBER]);_.element.cycle=qe(Math.round(n),1,255)}return 0}).command("die",t=>(rr(_.book,_.board,_.element,_.timestamp),t.endofprogram(),0)).command("endgame",()=>(sg(G,_.elementfocus),0)).command("run",(t,e)=>{const[n]=rt(e,0,[$.NAME]);return ah(n),0}).command("runwith",(t,e)=>{const[n,r]=rt(e,0,[$.ANY,$.NAME]);return t.set("arg",n),ah(r),0}),Gu={};function LF(t){var e;return(e=Gu[t])==null?void 0:e.arg}function MF(t){var e;return(e=Gu[t])==null?void 0:e.format}function ms(t){var e;return(e=Gu[t])==null?void 0:e.content}function UF(t,e,n,r,i){const s=fe(Bt.MAIN);if(!x(s))return;const o=Zs(s,_t.LOADER).filter(a=>{const c=Vs(a),l=c.format,u=Et(l)?new RegExp(l).test(e):!1,f=c.event,d=Et(f)?new RegExp(f).test(n):!1;return Et(l)&&Et(f)?u&&d:Et(l)?u:Et(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${Me()}_loader`;Gu[c]={arg:t,format:e,content:r,player:i},SB(c,o[a].code)}}function ME(t,e){if(!x(t))return;const n=Nt(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const FF=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[$.NAME]),s=Nt(r);switch(s){case"seek":{const[o]=rt(e,i,[$.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(e,i,[$.NAME]);t.set(o,ME(n,s));break}case"text":{const[o,a]=rt(e,i,[$.NAME,$.NAME]),c=ME(n,o);if(St(c)&&Et(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);t.set(a,f),n.cursor+=c}break}case"palette":{const[o]=rt(e,i,[$.NAME]),a=F0(_.book,_t.PALETTE,o),c=Le(a);if(x(c)){const l=QN*ac,u=Td(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(e,i,[$.NAME]),a=F0(_.book,_t.CHARSET,o),c=Le(a);if(x(c)){const l=Gl*JN*kd,u=e1(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},na=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",Yu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!Yu(t[n],e[n]))return!1;return!0}if(na(t)&&na(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Yu(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},Vu=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(na(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},PF=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",UE=t=>t>="0"&&t<="9"||t==="-",BF=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var X;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(X||(X={}));const FE={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},DF={"!":!0,"<":!0,"=":!0,">":!0},$F={"	":!0,"\n":!0,"\r":!0," ":!0};class jF{constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(PF(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(FE[e[this._current]]!==void 0)n.push({start:this._current,type:FE[e[this._current]],value:e[this._current]}),this._current+=1;else if(UE(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(DF[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if($F[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&BF(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;UE(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const zF=new jF,En={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class WF{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...zF.tokenize(e),{type:X.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<En[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case X.TOK_LITERAL:return{type:"Literal",value:e.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(En.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(En.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(e.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(En.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(En.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(En.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case X.TOK_DOT:const i=En.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(En.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(En.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(En.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(En.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(En.Flatten);return{type:"Projection",children:[u,f]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,e);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(En.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(En.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(En[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(e);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(En[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const HF=new WF;var ut;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class KF{constructor(e){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>na(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var w;return(w=!m.optional)!==null&&w!==void 0?w:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,h=this.getTypeName(n[m]);let w;for(w=0;w<d.length;w+=1)if(h!==void 0&&this.typeMatches(h,d[w],n[m])){p=!0;break}if(!p&&h!==void 0){const b=d.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${b}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(e,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return e===ut.TYPE_ARRAY;if(e===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return e.jmespathType===X.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class GF{constructor(){this._rootValue=null,this.runtime=new KF(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,f,d,h;switch(e.type){case"Field":return n===null?null:na(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...e.children],w=this.computeSliceParams(n.length,m),[b,T,A]=w;if(s=[],A>0)for(d=b;d<T;d+=A)s.push(n[d]);else for(d=b;d>T;d+=A)s.push(n[d]);return s;case"Projection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(e.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(e.children[0],n),!na(h))return null;f=[];const v=Object.values(h);for(d=0;d<v.length;d+=1)i=this.visit(e.children[1],v[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;const C=[],S=[];for(d=0;d<h.length;d+=1)r=this.visit(e.children[2],h[d]),Vu(r)||C.push(h[d]);for(let L=0;L<C.length;L+=1)i=this.visit(e.children[1],C[L]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case X.TOK_EQ:s=Yu(o,a);break;case X.TOK_NE:s=!Yu(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case X.TOK_FLATTEN:const R=this.visit(e.children[0],n);if(!Array.isArray(R))return null;let U=[];for(d=0;d<R.length;d+=1)i=R[d],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<e.children.length;d+=1)f.push(this.visit(e.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let O;for(d=0;d<e.children.length;d+=1)O=e.children[d],f[O.name]=this.visit(O.value,n);return f;case"OrExpression":return r=this.visit(e.children[0],n),Vu(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),Vu(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),Vu(o);case"Literal":return e.value;case X.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const D=[];for(let L=0;L<e.children.length;L+=1)D.push(this.visit(e.children[L],n));return this.runtime.callFunction(e.name,D);case"ExpressionReference":const V=e.children[0];return V.jmespathType=X.TOK_EXPREF,V;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const YF=new GF;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function VF(t,e){const n=HF.parse(e);return YF.search(n,t)}const ZF=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[$.NAME,$.NAME]),s=VF(n.json,r);return t.set(i,s),0};function XF(t,e){return Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2))}const Zu=Td(n1);function PE(t){let e;if(!x(Zu))return e;let n=1e9;for(let r=0;r<=jt.BLACK;++r){const i=r*ac,s=Zu.bits[i],o=Zu.bits[i+1],a=Zu.bits[i+2],c=XF(t,{r:s,g:o,b:a,hex:""});c<n&&(e=r,n=c)}return e}const qF=(t,e)=>{var a,c,l,u;const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[$.NAME]),s=Nt(r),o=((a=n.content)==null?void 0:a.layers)??[];switch(s){case"seek":{const[f]=rt(e,i,[$.NUMBER]);n.cursor=qe(f,0,o.length-1);break}case"layer":{const f=n.cursor+1;n.cursor=qe(f,0,o.length-1);break}case"char":{const[f,d,h]=rt(e,i,[$.NUMBER,$.NUMBER,$.NAME]),p=(c=n.content)==null?void 0:c.layers[n.cursor];x(p)&&Fo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,p.raster[f+d*p.width].asciiCode);break}case"color":{const[f,d,h]=rt(e,i,[$.NUMBER,$.NUMBER,$.NAME]),p=(l=n.content)==null?void 0:l.layers[n.cursor];x(p)&&Fo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,PE(p.raster[f+d*p.width].color));break}case"bg":{const[f,d,h]=rt(e,i,[$.NUMBER,$.NUMBER,$.NAME]),p=(u=n.content)==null?void 0:u.layers[n.cursor];x(p)&&Fo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,PE(p.raster[f+d*p.width].bg));break}}return 0},JF=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[$.NAME]);switch(Nt(r)){case"seek":{const[o]=rt(e,i,[$.NUMBER]);n.cursor=qe(o,0,n.lines.length-1);break}case"line":n.cursor=qe(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[f,d]=rt(e,u,[$.NAME]);t.set(f,c[l]??0),++l,u=d}break}}return 0},QF=fi({get(t,e){var r,i,s;const n=MF(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"lines":return[!0,o.lines.length]}break}case"json":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename]}break}case"binary":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"bytes":return[!0,o.bytes.length]}break}case"rexpaint":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"layers":return[!0,((r=o.content)==null?void 0:r.layers.length)??0];case"width":return[!0,((i=o.content)==null?void 0:i.layers[o.cursor].width)??0];case"height":return[!0,((s=o.content)==null?void 0:s.layers[o.cursor].height)??0];case"cursor":return[!0,o.cursor]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=rt(e,0,[$.NAME,$.ANY]);return pp(n,r),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(we).join(" ");return Ei(G,_.elementfocus,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=we(n),s=r.map(we).join(" ");return Ei(G,_.elementfocus,"$175",`!${s};${i}`),0}).command("readline",JF).command("readjson",ZF).command("readbin",FF).command("readrexpaint",qF).command("with",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=zn(_.book,_t.BOARD,n);if(r.length){const i=Ae(...r);x(i)&&(_.board=Le(i),_.element={x:-1,y:-1})}return 0});function BE(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[$.ANY]);le(c)&&!Ni(c)&&!Nc(c)&&!Ku(c)&&!ei(c)?o.push(...c):o.push(c),a=l}switch(Nt(r)){case"get":case"post:json":bA(G,_.elementfocus,t,e,n,r,o);break}return 0}const tP=fi().command("fetch",(t,e)=>{const[n,r,i="get",s]=rt(e,0,[$.NAME,$.NAME,$.MAYBE_STRING]);return BE(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=rt(e,0,[$.ANY,$.NAME,$.NAME,$.MAYBE_STRING]);return BE(n,r,i,s,e,o),0}).command("twitchchat",(t,e)=>{const[n]=rt(e,0,[$.ANY]);switch(Nt(n)){default:_A(G,_.elementfocus,n);break;case"stop":yA(G,_.elementfocus);break}return 0}).command("twitchbroadcast",(t,e)=>{const[n]=rt(e,0,[$.NAME]);switch(Nt(n)){default:mA(G,_.elementfocus,n);break;case"stop":gA(G,_.elementfocus);break}return 0}),eP=fi({set(t,e,n){return BB(t,e,n),[!1,void 0]},everytick(){const t=gi(_.elementid),[e]=t;if(t.length===1&&Et(e)){if(x(_.element))if(e.trim().length===0){const n=On(_.elementid);n.sidebar=[]}else _.element.tickertext=e,_.element.tickertime=_.timestamp}else if(t.length>1)if(_.elementisplayer){const n=On(_.elementid);n.sidebar=t}else{const n=On(_.elementfocus);n.scroll=t}}}).command("send",(t,e)=>{var a,c;const[n,r]=rt(e,0,[$.NAME,$.ANY]),[i,s]=IE(n);switch(Nt(i)){case"all":for(const l of Object.keys(((a=_.board)==null?void 0:a.objects)??{}))t.send(_.elementfocus,l,s,r);break;case"self":t.message({session:G.session(),player:_.elementfocus,id:Me(),sender:t.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((c=_.board)==null?void 0:c.objects)??{}))l!==t.id()&&t.send(_.elementfocus,l,s,r);break;default:{const l=qy(_.board,[i]);for(let u=0;u<l.length;++u){const f=l[u];x(f.id)&&t.send(_.elementfocus,f.id,s,r)}break}}return 0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(we).join("");return ae(_.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=we(n);return $t(_.elementid,t.id(),i,r,t.get,t.set),0});function DE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=_e(e,{x:s,y:i});bn(o)&&rr(t,e,o,t.timestamp),un(e,{x:s,y:i})}}function nP(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)un(t,{x:i,y:r})}function $E(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=_e(e,{x:s,y:i});bn(o)&&rr(t,e,o,t.timestamp),un(e,{x:s,y:i})}}function Xu(t,e){x(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.code=e.code,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.stepx=e.stepx,t.stepy=e.stepy,t.pushable=e.pushable,t.collision=e.collision,t.destructible=e.destructible,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function ep(t,e,n,r,i){if(!x(_.book))return;const s=_.book,o=en(s,_t.BOARD,t),a=Le(o);if(!x(a))return;const c=en(s,_t.BOARD,e),l=Le(c);if(!x(l))return;Ke(s,a),Ke(s,l);let u=!1;if(x(a)&&x(l)){switch(i){case"all":DE(s,l,n,r);break;case"object":$E(s,l,n,r);break;case"terrain":nP(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,p=!1;switch(i){case"all":h=!0,p=!0;break;case"object":h=!0;break;case"terrain":p=!0;break}const m={x:d,y:f};let w,b=_e(a,m);if(bn(b)?(w=Wo(a,d,f),vr(b==null?void 0:b.id)&&(b=void 0)):(w=b,b=void 0),x(w)&&(p||u&&fs(s,w)===i)){u&&DE(s,l,m,m);const T=qs(s,l,[w.kind??""],m);Xu(T,w)}if(x(b)&&(h||u&&fs(s,b)===i)){u&&$E(s,l,m,m);const T=qs(s,l,[b.kind??""],m);Xu(T,b)}}Wu(s,l)}}function rP(t,e,n,r,i){if(!x(_.book))return;const s=_.book,o=en(s,_t.BOARD,t),a=Le(o);if(!x(a))return;const c=bd(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Ke(s,a),Ke(s,c);const f=-Math.tan(e*.5),d=Math.sin(e),h=Math.round(12.5*f),p=Math.round(12.5*d),m=new Array(Qt).fill(0);ny(h,0,-h,Qt-1).forEach(v=>{v.x<0?m[v.y]=Math.min(m[v.y],v.x):m[v.y]=Math.max(m[v.y],v.x)});const b=new Array(Rt).fill(0);ny(0,p,Rt-1,-p).forEach(v=>{v.y<0?b[v.x]=Math.min(b[v.x],v.y):b[v.x]=Math.max(b[v.x],v.y)});const A=[m,b,m];for(let v=0;v<A.length;++v){const C=A[v];if(v!==1){for(let S=0;S<Qt;++S){const R=C[S],U=S*Rt;for(let O=0;O<Rt;O++){const D=(O+R+Rt)%Rt;u&&(c.terrain[D+U]=a.terrain[O+U])}}if(l){const S=Object.keys(a.objects);for(let R=0;R<S.length;++R){const U=S[R],{x:O,y:D}=a.objects[U];if(x(O)&&x(D)){const V=C[D];a.objects[U].x=(O+V+Rt)%Rt,a.objects[U].lx=a.objects[U].x}}}}if(v===1){for(let S=0;S<Rt;++S){const R=C[S];for(let U=0;U<Qt;++U){const O=(U+R+Qt)%Qt;u&&(c.terrain[S+O*Rt]=a.terrain[S+U*Rt])}}if(l){const S=Object.keys(a.objects);for(let R=0;R<S.length;++R){const U=S[R],{x:O,y:D}=a.objects[U];if(x(O)&&x(D)){const V=C[O];a.objects[U].y=(D+V+Qt)%Qt,a.objects[U].ly=a.objects[U].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Ke(s,c),Ke(s,a)}}function iP(t,e){let n=0,r=0,i=0;for(;i<t.length;i++)n+=t[i];for(i=0,e*=n;e&&i<t.length;){if(r+=t[i],e<=r)return i;i++}return 0}var sP=iP;const oP=sP,te=function(){};te.prototype.FMX=0,te.prototype.FMY=0,te.prototype.FMXxFMY=0,te.prototype.T=0,te.prototype.N=0,te.prototype.initiliazedField=!1,te.prototype.generationComplete=!1,te.prototype.wave=null,te.prototype.compatible=null,te.prototype.weightLogWeights=null,te.prototype.sumOfWeights=0,te.prototype.sumOfWeightLogWeights=0,te.prototype.startingEntropy=0,te.prototype.sumsOfOnes=null,te.prototype.sumsOfWeights=null,te.prototype.sumsOfWeightLogWeights=null,te.prototype.entropies=null,te.prototype.propagator=null,te.prototype.observed=null,te.prototype.distribution=null,te.prototype.stack=null,te.prototype.stackSize=0,te.prototype.DX=[-1,0,1,0],te.prototype.DY=[0,1,0,-1],te.prototype.opposite=[2,3,0,1],te.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let e=0;e<this.T;e++)this.compatible[t][e]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},te.prototype.observe=function(t){let e=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=e){const c=1e-6*t();a+c<e&&(e=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=oP(this.distribution,t()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},te.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const e=t[0],n=e%this.FMX,r=e/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][t[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],p=f[h];p[i]--,p[i]==0&&this.ban(l,h)}}}},te.prototype.singleIteration=function(t){const e=this.observe(t);return e!==null?(this.generationComplete=e,!!e):(this.propagate(),null)},te.prototype.iterate=function(t,e){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,e=e||Math.random;for(let n=0;n<t||t===0;n++){const r=this.singleIteration(e);if(r!==null)return!!r}return!0},te.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const e=this.singleIteration(t);if(e!==null)return!!e}},te.prototype.isGenerationComplete=function(){return this.generationComplete},te.prototype.ban=function(t,e){const n=this.compatible[t][e];for(let i=0;i<4;i++)n[i]=0;this.wave[t][e]=!1,this.stack[this.stackSize]=[t,e],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[e],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[e];const r=this.sumsOfWeights[t];this.entropies[t]=Math.log(r)-this.sumsOfWeightLogWeights[t]/r},te.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let e=0;e<this.T;e++){this.wave[t][e]=!0;for(let n=0;n<4;n++)this.compatible[t][e][n]=this.propagator[this.opposite[n]][e].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var jE=te;const zE=jE,Hi=function(e,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let O=0;O<f;O++)d[O]=new Array(r);this.colors=[];const h={};for(let O=0;O<r;O++)for(let D=0;D<n;D++){const V=(O*n+D)*4,L=[e[V],e[V+1],e[V+2],e[V+3]],N=L.join("-");h.hasOwnProperty(N)||(h[N]=this.colors.length,this.colors.push(L)),d[D][O]=h[N]}const p=this.colors.length,m=Math.pow(p,i*i),w=function(D){let V=new Array(i*i);for(let L=0;L<i;L++)for(let N=0;N<i;N++)V[N+L*i]=D(N,L);return V},b=function(D,V){return w(function(L,N){return d[(D+L)%n][(V+N)%r]})},T=function(D){return w(function(V,L){return D[i-1-L+V*i]})},A=function(D){return w(function(V,L){return D[i-1-V+L*i]})},v=function(D){let V=0,L=1;for(let N=0;N<D.length;N++)V+=D[D.length-1-N]*L,L*=p;return V},C=function(D){let V=D,L=m;const N=new Array(i*i);for(let E=0;E<N.length;E++){L/=p;let B=0;for(;V>=L;)V-=L,B++;N[E]=B}return N},S={},R=[];for(let O=0;O<(a?r:r-i+1);O++)for(let D=0;D<(a?n:n-i+1);D++){const V=new Array(8);V[0]=b(D,O),V[1]=A(V[0]),V[2]=T(V[0]),V[3]=A(V[2]),V[4]=T(V[2]),V[5]=A(V[4]),V[6]=T(V[4]),V[7]=A(V[6]);for(let L=0;L<l;L++){const N=v(V[L]);S[N]?S[N]++:(R.push(N),S[N]=1)}}this.T=R.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let O=0;O<this.T;O++){const D=parseInt(R[O],10);this.patterns[O]=C(D),this.weights[O]=S[D]}const U=function(D,V,L,N){const E=L<0?0:L,B=L<0?L+i:i,Q=N<0?0:N,j=N<0?N+i:i;for(let st=Q;st<j;st++)for(let et=E;et<B;et++)if(D[et+i*st]!=V[et-L+i*(st-N)])return!1;return!0};this.propagator=new Array(4);for(let O=0;O<4;O++){this.propagator[O]=new Array(this.T);for(let D=0;D<this.T;D++){const V=[];for(let L=0;L<this.T;L++)U(this.patterns[D],this.patterns[L],this.DX[O],this.DY[O])&&V.push(L);this.propagator[O][D]=V}}};Hi.prototype=Object.create(zE.prototype),Hi.prototype.constructor=Hi,Hi.prototype.onBoundary=function(t,e){return!this.periodic&&(t+this.N>this.FMX||e+this.N>this.FMY||t<0||e<0)},Hi.prototype.clear=function(){if(zE.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let e=0;e<this.T;e++)e!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,e);for(let e=0;e<this.FMY-1;e++)this.ban(t+e*this.FMX,this.ground)}this.propagate()}},Hi.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},Hi.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMY;e++){const n=e<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(e*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(e-n)*this.FMX]][i+n*this.N]];t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3]}}},Hi.prototype.graphicsIncomplete=function(t){for(let e=0;e<this.FMXxFMY;e++){const n=e%this.FMX,r=e/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const p=d+h*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const w=this.colors[this.patterns[m][f+u*this.N]];s+=w[0],o+=w[1],a+=w[2],c+=w[3]}}const l=e*4;t[l]=s/i,t[l+1]=o/i,t[l+2]=a/i,t[l+3]=c/i}};var aP=Hi;const cP=jE,gs=function(e,n,r,i,s){const o=e.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!e.unique;let c=null;n&&e.subsets&&e.subsets[n]&&(c=e.subsets[n]);const l=function(v){const C=new Array(o*o);for(let S=0;S<o;S++)for(let R=0;R<o;R++)C[R+S*o]=v(R,S);return C},u=function(v){return l(function(C,S){return v[o-1-S+C*o]})},f=function(v){return l(function(C,S){return v[o-1-C+S*o]})};this.tiles=[];const d=[],h=[],p={};let m,w,b;for(let A=0;A<e.tiles.length;A++){const v=e.tiles[A];if(c!==null&&c.indexOf(v.name)===-1)continue;switch(v.symmetry){case"L":b=4,m=function(S){return(S+1)%4},w=function(S){return S%2===0?S+1:S-1};break;case"T":b=4,m=function(S){return(S+1)%4},w=function(S){return S%2===0?S:4-S};break;case"I":b=2,m=function(S){return 1-S},w=function(S){return S};break;case"\\":b=2,m=function(S){return 1-S},w=function(S){return 1-S};break;case"F":b=8,m=function(S){return S<4?(S+1)%4:4+(S-1)%4},w=function(S){return S<4?S+4:S-4};break;default:b=1,m=function(S){return S},w=function(S){return S};break}this.T=h.length,p[v.name]=this.T;for(let S=0;S<b;S++)h.push([this.T+S,this.T+m(S),this.T+m(m(S)),this.T+m(m(m(S))),this.T+w(S),this.T+w(m(S)),this.T+w(m(m(S))),this.T+w(m(m(m(S))))]);let C;if(a)for(let S=0;S<b;S++)C=v.bitmap[S],this.tiles.push(l(function(R,U){return[C[(o*U+R)*4],C[(o*U+R)*4+1],C[(o*U+R)*4+2],C[(o*U+R)*4+3]]}));else{C=v.bitmap,this.tiles.push(l(function(S,R){return[C[(o*R+S)*4],C[(o*R+S)*4+1],C[(o*R+S)*4+2],C[(o*R+S)*4+3]]}));for(let S=1;S<b;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):f(this.tiles[this.T+S-4]))}for(let S=0;S<b;S++)d.push(v.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const T=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),T[A]=new Array(this.T);for(let v=0;v<this.T;v++){T[A][v]=new Array(this.T);for(let C=0;C<this.T;C++)T[A][v][C]=!1}}for(let A=0;A<e.neighbors.length;A++){const v=e.neighbors[A],C=v.left.split(" ").filter(function(V){return V.length}),S=v.right.split(" ").filter(function(V){return V.length});if(c!==null&&(c.indexOf(C[0])===-1||c.indexOf(S[0])===-1))continue;const R=h[p[C[0]]][C.length==1?0:parseInt(C[1],10)],U=h[R][1],O=h[p[S[0]]][S.length==1?0:parseInt(S[1],10)],D=h[O][1];T[0][O][R]=!0,T[0][h[O][6]][h[R][6]]=!0,T[0][h[R][4]][h[O][4]]=!0,T[0][h[R][2]][h[O][2]]=!0,T[1][D][U]=!0,T[1][h[U][6]][h[D][6]]=!0,T[1][h[D][4]][h[U][4]]=!0,T[1][h[U][2]][h[D][2]]=!0}for(let A=0;A<this.T;A++)for(let v=0;v<this.T;v++)T[2][A][v]=T[0][v][A],T[3][A][v]=T[1][v][A];for(let A=0;A<4;A++)for(let v=0;v<this.T;v++){const C=[],S=T[A][v];for(let R=0;R<this.T;R++)S[R]&&C.push(R);this.propagator[A][v]=C}};gs.prototype=Object.create(cP.prototype),gs.prototype.constructor=gs,gs.prototype.onBoundary=function(t,e){return!this.periodic&&(t<0||e<0||t>=this.FMX||e>=this.FMY)},gs.prototype.graphics=function(t,e){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,e),t},gs.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMX;e++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[e+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(e*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];t[o]=a[0],t[o+1]=a[1],t[o+2]=a[2],t[o+3]=a[3]}}},gs.prototype.graphicsIncomplete=function(t,e){(!e||e.length!==4)&&(e=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(e&&s===this.T)t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];else{let f=0,d=0,h=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const w=this.tiles[m][l+c*this.tilesize],b=this.weights[m]*a;f+=w[0]*b,d+=w[1]*b,h+=w[2]*b,p+=w[3]*b}t[u]=f,t[u+1]=d,t[u+2]=h,t[u+3]=p}}}};var lP=gs,uP={OverlappingModel:aP,SimpleTiledModel:lP},hP=io(uP);const WE=5;function HE(t,e,n,r,i,s,o){if(!x(_.book))return!1;const a=_.book,c=en(a,_t.BOARD,t),l=en(a,_t.BOARD,e),u=Le(c),f=Le(l);if(!x(u)||!x(f))return!1;Ke(a,u),Ke(a,f);let d=0;const h=new Map,p=new Map;let m=0;const w=32,b=new Uint8Array(yd*4);for(let R=0;R<Qt;++R)for(let U=0;U<Rt;++U){const O=_e(f,{x:U,y:R}),D=(O==null?void 0:O.char)??0,V=(O==null?void 0:O.color)??w,L=(O==null?void 0:O.bg)??w;b[m++]=D,b[m++]=V,b[m++]=L;const N=Dr(a,O),E=Nt((N==null?void 0:N.name)??"empty"),B=h.get(E);St(B)?b[m++]=B:(h.set(E,d),p.set(d,E),b[m++]=d++)}const T=s.x-i.x+1,A=s.y-i.y+1,v=new hP.OverlappingModel(b,Rt,Qt,n,T,A,!1,!1,r,0);let C=0;for(;C<WE&&!v.generate();++C);if(C===WE)return!1;m=0;const S=v.graphics();for(let R=i.y;R<=s.y;++R)for(let U=i.x;U<=s.x;++U){const O={x:U,y:R},D=S[m++],V=S[m++],L=S[m++];switch(d=S[m++],o){case"all":{const st=_e(u,{x:U,y:R});bn(st)&&rr(a,u,st,a.timestamp),un(u,{x:U,y:R});break}case"object":{const st=_e(u,{x:U,y:R});bn(st)&&rr(a,u,st,a.timestamp);break}case"terrain":un(u,{x:U,y:R});break}let N=p.get(d)??"";const E=Qo(a,N),B=ju(a,N),Q=E??B;switch(o){case"all":break;case"object":x(B)&&(N="");break;case"terrain":x(E)&&(N="");break;default:if(fs(a,Q)!==o&&(N=""),N){const st=_e(u,{x:U,y:R});bn(st)&&rr(a,u,st,a.timestamp),un(u,{x:U,y:R})}break}const j=N?qs(a,u,[N],O):void 0;if(!(!x(j)||!x(Q))&&(Xu(j,Q),D>0&&(j.char=D),V<w&&(j.color=V),L<w&&(j.bg=L),bn(j))){const st=Ae(oc(f,N));x(st)&&(un(u,{...Wo(f,st.x??0,st.y??0),x:U,y:R}),Xu(j,st))}}return!0}function KE(t){return`zss_snapshot_${t}`}function fP(t,e,n,r){const i=en(_.book,_t.BOARD,t),s=Le(i);if(!x(s))return;const o=KE(s.id);uE(_.book,o);const a=bs(Bt.CONTENT,o,_t.BOARD),c=Le(a);if(x(c))return ep(t,c.id,e,n,r),c}function dP(t,e,n,r){const i=en(_.book,_t.BOARD,t),s=Le(i);if(!x(s))return;const o=KE(s.id),a=en(_.book,_t.BOARD,o),c=Le(a);if(x(c))return ep(c.id,t,e,n,r),c}function pP(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return mP(t,e,i)}if(!x(_.book))return;const s=_.book,o=en(s,_t.BOARD,t),a=Le(o);if(!x(a))return;const c=bd();Ke(s,a);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let f=!1,d=!1;switch(i){case"all":f=!0,d=!0;break;case"object":f=!0;break;case"terrain":d=!0;break}const h=(u+e.x+Rt)%Rt,p=(l+e.y+Qt)%Qt;if(f){const m=_e(a,{x:u,y:l});bn(m)&&x(m==null?void 0:m.x)&&x(m==null?void 0:m.y)&&(m.x=h,m.lx=h,m.y=p,m.ly=p)}d&&(c.terrain[h+p*Rt]=a.terrain[u+l*Rt])}(i==="all"||i==="terrain")&&(a.terrain=[...c.terrain]),Wu(s,a)}function mP(t,e,n){if(!x(_.book))return;const r=_.book,i=en(r,_t.BOARD,t),s=Le(i);if(!x(s))return;Ke(r,s);const{objectelements:o,terrainelements:a}=rF(r,s,n);let c=!1;const l={};for(let f=0;f<a.length;++f){const d=a[f],h=wn(r,d,"collision"),p={x:d.x??-1,y:d.y??-1},m=_e(s,p);bn(m)&&x(m)&&(l[m.id??""]=!0);const w={x:p.x+e.x,y:p.y+e.y};if(Wl(w)){const b=_e(s,w),T=fs(r,b),A=wn(r,b,"collision");bn(b)&&n!==T?Ho(h,A)?c=!0:wn(r,b,"pushable")?c=ua(r,s,b,w)!==!0:c=!1:A===Kt.ISSOLID&&n!==T&&(c=!0)}else c=!0}if(c)return;for(let f=0;f<o.length;++f){const d=o[f],h=wn(r,d,"collision"),p={x:d.x??0,y:d.y??0},m={x:p.x+e.x,y:p.y+e.y};if(Wl(m)){const w=_e(s,m),b=fs(r,w),T=wn(r,w,"collision");bn(w)&&x(w)&&n!==b&&!l[w.id??""]?wn(r,w,"pushable")?c=ua(r,s,w,m)!==!0:c=!0:Ho(h,T)&&n!==b&&(c=!0)}else c=!0}if(c)return;(e.x>0||e.y>0)&&a.reverse();for(let f=0;f<a.length;++f){const d=a[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y},m=Wo(s,p.x,p.y);if(x(d)&&x(m)){un(s,{...d,x:p.x,y:p.y}),un(s,{...m,x:h.x,y:h.y});const w=_e(s,h);bn(w)&&x(w)&&(w.x=(w.x??0)+e.x,w.y=(w.y??0)+e.y,w.lx=(w.lx??0)+e.x,w.ly=(w.ly??0)+e.y)}}Wu(r,s);for(let f=0;f<o.length;++f){const d=o[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y};if(!ua(r,s,d,p))break}Wu(r,s)}function ra(t,e){let n="all";const r={x:0,y:0},i={x:Rt-1,y:Qt-1};for(let s=e;s<t.length;){const[o,a]=rt(t,s,[$.MAYBE_NUMBER_OR_STRING]);if(Et(o))n=Nt(o),s=a;else if(St(o)){const[c,l,u,f]=rt(t,a,[$.NUMBER,$.NUMBER,$.NUMBER]);r.x=Math.min(o,l),r.y=Math.min(c,u),i.x=Math.max(o,l),i.y=Math.max(c,u),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const gP=fi().command("snapshot",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;const n=ra(e,0);return fP(_.board.id,n.pt1,n.pt2,n.targetset),0}).command("revert",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;const n=ra(e,0);return dP(_.board.id,n.pt1,n.pt2,n.targetset),0}).command("copy",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;const[n,r]=rt(e,0,[$.NAME]),i=zn(_.book,_t.BOARD,n),s=Ae(...i);if(x(s)){const o=ra(e,r);ep(s.id,_.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;const[n,r,i,s]=rt(e,0,[$.NAME,$.NUMBER,$.NUMBER]),o=zn(_.book,_t.BOARD,n),a=Ae(...o);if(x(a)){const c=ra(e,s);HE(_.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{var o,a;if(!x(_.book)||!x(_.board))return 0;const[n,r]=rt(e,0,[$.DIR]),i={x:n.destpt.x-(((o=_.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=_.element)==null?void 0:a.y)??0)},s=ra(e,r);return pP(_.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(t,e)=>{if(!x(_.book)||!x(_.board))return 0;const[n,r]=rt(e,0,[$.NUMBER]),i=ra(e,r);return rP(_.board.id,ly(n),i.pt1,i.pt2,i.targetset),0});var _s=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(_s||{});const _P={audio:W0,board:_F,cli:xF,display:kF,element:OF,runtime:eP,lifecycle:CF,loader:QF,network:tP,transform:gP},np=["audio","board","display","network","transform","lifecycle","element"],yP={0:[],1:["cli",...np],2:["loader",...np],3:["runtime",...np]},bP={0:new Map,1:new Map,2:new Map,3:new Map};function ia(t){return(yP[t]??[]).map(n=>_P[n]).filter(x)}function rp(t){const e=[],n=ia(t);for(let r=0;r<n.length;++r)e.push(...n[r].listcommands());return e}function wP(t,e){const n=bP[t];if(!n.has(e)){let r;const i=ia(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!x(r));++s);n.set(e,r)}return n.get(e)}function EP(t,e,n){const r=ia(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function xP(t,e,n,r){const i=ia(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function kP(t,e){const n=ia(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function GE(t,e){const n=ia(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var YE={},VE={},ZE={};const XE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");ZE.encode=function(t){if(0<=t&&t<XE.length)return XE[t];throw new TypeError("Must be between 0 and 63: "+t)};const TP=ZE,qE=5,JE=1<<qE,vP=JE-1,AP=JE;function SP(t){return t<0?(-t<<1)+1:(t<<1)+0}VE.encode=function(e){let n="",r,i=SP(e);do r=i&vP,i>>>=qE,i>0&&(r|=AP),n+=TP.encode(r);while(i>0);return n};var Oc={};(function(t){function e(S,R,U){if(R in S)return S[R];if(arguments.length===3)return U;throw new Error('"'+R+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const R=S.match(n);return R?{scheme:R[1],auth:R[2],host:R[3],port:R[4],path:R[5]}:null}t.urlParse=i;function s(S){let R="";return S.scheme&&(R+=S.scheme+":"),R+="//",S.auth&&(R+=S.auth+"@"),S.host&&(R+=S.host),S.port&&(R+=":"+S.port),S.path&&(R+=S.path),R}t.urlGenerate=s;const o=32;function a(S){const R=[];return function(U){for(let D=0;D<R.length;D++)if(R[D].input===U){const V=R[0];return R[0]=R[D],R[D]=V,R[0].result}const O=S(U);return R.unshift({input:U,result:O}),R.length>o&&R.pop(),O}}const c=a(function(R){let U=R;const O=i(R);if(O){if(!O.path)return R;U=O.path}const D=t.isAbsolute(U),V=[];let L=0,N=0;for(;;)if(L=N,N=U.indexOf("/",L),N===-1){V.push(U.slice(L));break}else for(V.push(U.slice(L,N));N<U.length&&U[N]==="/";)N++;let E=0;for(N=V.length-1;N>=0;N--){const B=V[N];B==="."?V.splice(N,1):B===".."?E++:E>0&&(B===""?(V.splice(N+1,E),E=0):(V.splice(N,2),E--))}return U=V.join("/"),U===""&&(U=D?"/":"."),O?(O.path=U,s(O)):U});t.normalize=c;function l(S,R){S===""&&(S="."),R===""&&(R=".");const U=i(R),O=i(S);if(O&&(S=O.path||"/"),U&&!U.scheme)return O&&(U.scheme=O.scheme),s(U);if(U||R.match(r))return R;if(O&&!O.host&&!O.path)return O.host=R,s(O);const D=R.charAt(0)==="/"?R:c(S.replace(/\/+$/,"")+"/"+R);return O?(O.path=D,s(O)):D}t.join=l,t.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function u(S,R){S===""&&(S="."),S=S.replace(/\/$/,"");let U=0;for(;R.indexOf(S+"/")!==0;){const O=S.lastIndexOf("/");if(O<0||(S=S.slice(0,O),S.match(/^([^\/]+:\/)?\/*$/)))return R;++U}return Array(U+1).join("../")+R.substr(S.length+1)}t.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function h(S){return m(S)?"$"+S:S}t.toSetString=f?d:h;function p(S){return m(S)?S.slice(1):S}t.fromSetString=f?d:p;function m(S){if(!S)return!1;const R=S.length;if(R<9||S.charCodeAt(R-1)!==95||S.charCodeAt(R-2)!==95||S.charCodeAt(R-3)!==111||S.charCodeAt(R-4)!==116||S.charCodeAt(R-5)!==111||S.charCodeAt(R-6)!==114||S.charCodeAt(R-7)!==112||S.charCodeAt(R-8)!==95||S.charCodeAt(R-9)!==95)return!1;for(let U=R-10;U>=0;U--)if(S.charCodeAt(U)!==36)return!1;return!0}function w(S,R,U){let O=T(S.source,R.source);return O!==0||(O=S.originalLine-R.originalLine,O!==0)||(O=S.originalColumn-R.originalColumn,O!==0||U)||(O=S.generatedColumn-R.generatedColumn,O!==0)||(O=S.generatedLine-R.generatedLine,O!==0)?O:T(S.name,R.name)}t.compareByOriginalPositions=w;function b(S,R,U){let O=S.generatedLine-R.generatedLine;return O!==0||(O=S.generatedColumn-R.generatedColumn,O!==0||U)||(O=T(S.source,R.source),O!==0)||(O=S.originalLine-R.originalLine,O!==0)||(O=S.originalColumn-R.originalColumn,O!==0)?O:T(S.name,R.name)}t.compareByGeneratedPositionsDeflated=b;function T(S,R){return S===R?0:S===null?1:R===null?-1:S>R?1:-1}function A(S,R){let U=S.generatedLine-R.generatedLine;return U!==0||(U=S.generatedColumn-R.generatedColumn,U!==0)||(U=T(S.source,R.source),U!==0)||(U=S.originalLine-R.originalLine,U!==0)||(U=S.originalColumn-R.originalColumn,U!==0)?U:T(S.name,R.name)}t.compareByGeneratedPositionsInflated=A;function v(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=v;function C(S,R,U){if(R=R||"",S&&(S[S.length-1]!=="/"&&R[0]!=="/"&&(S+="/"),R=S+R),U){const O=i(U);if(!O)throw new Error("sourceMapURL could not be parsed");if(O.path){const D=O.path.lastIndexOf("/");D>=0&&(O.path=O.path.substring(0,D+1))}R=l(s(O),R)}return c(R)}t.computeSourceURL=C})(Oc);var ip={};let RP=class Fx{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new Fx;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};ip.ArraySet=RP;var QE={};const tx=Oc;function IP(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||tx.compareByGeneratedPositionsInflated(t,e)<=0}let NP=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){IP(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(tx.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};QE.MappingList=NP;const Cc=VE,Ye=Oc,qu=ip.ArraySet,OP=QE.MappingList;let ex=class Px{constructor(e){e||(e={}),this._file=Ye.getArg(e,"file",null),this._sourceRoot=Ye.getArg(e,"sourceRoot",null),this._skipValidation=Ye.getArg(e,"skipValidation",!1),this._sources=new qu,this._names=new qu,this._mappings=new OP,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new Px({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ye.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=Ye.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=Ye.getArg(e,"generated"),r=Ye.getArg(e,"original",null);let i=Ye.getArg(e,"source",null),s=Ye.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=Ye.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ye.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ye.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=Ye.relative(s,i));const o=this._mappings.toArray().length>0?new qu:this._sources,a=new qu;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=Ye.join(r,c.source)),s!=null&&(c.source=Ye.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=Ye.join(r,c)),s!=null&&(c=Ye.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,p=d.length;h<p;h++){if(l=d[h],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Ye.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Cc.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Cc.encode(f-o),o=f,c+=Cc.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Cc.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Cc.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ye.relative(n,r));const i=Ye.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};ex.prototype._version=3,YE.SourceMapGenerator=ex;var nx={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(nx);var Lc={exports:{}},CP={},LP=Object.freeze({__proto__:null,default:CP}),rx=Bx(LP);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;Lc.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Lc.exports.initialize=e=>t=e}else{const t=rx,e=rx;Lc.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Lc.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var ix=Lc.exports;const MP=ix;function UP(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Mc=null;var FP=function(){if(Mc)return Mc;const e=[];return Mc=MP().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new UP;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),e[e.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw Mc=null,n}),Mc};const vt=Oc,sp=nx,Ju=ip.ArraySet,PP=ix,BP=FP,op=Symbol("smcInternal");class ze{constructor(e,n){return e==op?Promise.resolve(this):$P(e,n)}static initialize(e){PP.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return jP(e,n)}static async with(e,n,r){const i=await new ze(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ze.prototype._version=3,ze.GENERATED_ORDER=1,ze.ORIGINAL_ORDER=2,ze.GREATEST_LOWER_BOUND=1,ze.LEAST_UPPER_BOUND=2;class Uc extends ze{constructor(e,n){return super(op).then(r=>{let i=e;typeof e=="string"&&(i=vt.parseSourceMapInput(e));const s=vt.getArg(i,"version");let o=vt.getArg(i,"sources");const a=vt.getArg(i,"names",[]);let c=vt.getArg(i,"sourceRoot",null);const l=vt.getArg(i,"sourcesContent",null),u=vt.getArg(i,"mappings"),f=vt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=vt.normalize(c)),o=o.map(String).map(vt.normalize).map(function(d){return c&&vt.isAbsolute(c)&&vt.isAbsolute(d)?vt.relative(c,d):d}),r._names=Ju.fromArray(a.map(String),!0),r._sources=Ju.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return vt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,BP().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=vt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Uc(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||ze.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=vt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case ze.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ze.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=vt.getArg(e,"source");const r=vt.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:vt.getArg(e,"line"),generatedColumn:vt.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=vt.getArg(e,"bias",ze.GREATEST_LOWER_BOUND);r==null&&(r=ze.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=vt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=vt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=vt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:vt.getArg(i,"originalLine",null),column:vt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=vt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=vt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=vt.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:vt.getArg(e,"line"),originalColumn:vt.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=vt.getArg(e,"bias",ze.GREATEST_LOWER_BOUND);i==null&&(i=ze.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:vt.getArg(s,"generatedLine",null),column:vt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Uc.prototype.consumer=ze;class DP extends ze{constructor(e,n){return super(op).then(r=>{let i=e;typeof e=="string"&&(i=vt.parseSourceMapInput(e));const s=vt.getArg(i,"version"),o=vt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Ju,r._names=new Ju,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=vt.getArg(c,"offset"),u=vt.getArg(l,"line"),f=vt.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ze(vt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(vt.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(vt.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:vt.getArg(e,"line"),generatedColumn:vt.getArg(e,"column")},r=sp.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(vt.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=vt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||ze.GENERATED_ORDER;let o;switch(s){case ze.GENERATED_ORDER:o=this._generatedMappings;break;case ze.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=vt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return sp.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=vt.getArg(e,"line"),r={source:vt.getArg(e,"source"),originalLine:n,originalColumn:vt.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",vt.compareByOriginalPositions,sp.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:vt.getArg(o,"generatedLine",null),column:vt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:vt.getArg(o,"generatedLine",null),column:vt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function $P(t,e){let n=t;typeof t=="string"&&(n=vt.parseSourceMapInput(t));const r=n.sections!=null?new DP(n,e):new Uc(n,e);return Promise.resolve(r)}function jP(t,e){return Uc.fromSourceMap(t,e)}var sx={};const zP=YE.SourceMapGenerator,Qu=Oc,WP=/(\r?\n)/,HP=10,sa="$$$isSourceNode$$$";let KP=class bp{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[sa]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new bp,s=e.split(WP);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const p=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=Qu.join(r,h)),i.setSourceContent(h,p))}),i;function d(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?Qu.join(r,h.source):h.source;i.add(new bp(h.originalLine,h.originalColumn,m,p,h.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[sa]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[sa]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[sa]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[sa]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[Qu.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][sa]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(Qu.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new zP(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===HP?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};sx.SourceNode=KP;var GP=sx.SourceNode;let ox=0;const ax=hi,YP=["Command","lines"];class VP extends EU{constructor(){super(tE,{traceInitPerf:hi,skipValidations:!hi,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Lt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Lt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Sc)}])}));Lt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Lt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Lt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Lt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Sw)}));Lt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(w0)}));Lt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(E0)}])}));Lt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Aw)}));Lt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Rw),this.SUBRULE(this.words),this.CONSUME(Iw)}));Lt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Jo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Lt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Lt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Lt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Lt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(S0),this.SUBRULE(this.words)}));Lt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(zw),this.SUBRULE(this.words)}));Lt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(R0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Lt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Sc)),this.CONSUME4(Jo),this.CONSUME4(I0)}}])}));Lt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Jo),this.CONSUME(I0)}}])}));Lt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Lt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Jo),this.CONSUME(N0),this.CONSUME(R0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Lt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Jo),this.CONSUME(N0),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Lt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(Yw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(Vw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Zw),this.SUBRULE(this.words)}));Lt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(Xw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(qw)}));Lt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(Jw)}));Lt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Kw)}));Lt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Gw)}));Lt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(x0),this.SUBRULE2(this.and_test)})}));Lt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(T0),this.SUBRULE2(this.not_test)})}));Lt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(k0),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Lt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Lt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Cw)},{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME(Pw)}])}));Lt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(x0),this.SUBRULE2(this.and_test_value)})}));Lt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(T0),this.SUBRULE2(this.not_test_value)})}));Lt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(k0),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Lt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Lt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(v0)},{ALT:()=>this.CONSUME(A0)}]),this.SUBRULE(this.term)}));Lt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Lt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME(S0)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(jw)}]),this.SUBRULE(this.factor)}));Lt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(v0)},{ALT:()=>this.CONSUME(A0)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Lt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Bw),this.SUBRULE(this.factor)})}));Lt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Lt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Nw)},{ALT:()=>this.CONSUME(gn)},{ALT:()=>this.CONSUME(Ow)},{ALT:()=>{this.CONSUME(Ww),this.SUBRULE(this.words),this.CONSUME(Hw)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=YP.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(ox++).toString().padStart(3),c=s?"font-weight: bold;":"";if(ax&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),ax&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),ox--},i)}}const oa=new VP;if(MU){const t=oa.getGAstProductions(),e=LU(t);console.info(e)}const ZP=oa.getBaseCstVisitorConstructor();var yt=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(yt||{}),Qs=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Qs||{}),di=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(di||{}),th=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(th||{});function XP(t){return!!(t!=null&&t.tokenType)}function xr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class qP extends ZP{constructor(){super();Lt(this,"unique",0);hi&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&XP(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:xr(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:xr(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:xr(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:xr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:xr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,xr(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Me(),i=Me();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Me(),i=Me();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,xr(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Me(),i=Me();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Me(),i=Me(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Me(),i=Me(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Me();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=xr(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}command_toast(n){const i=xr(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,"toast"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=xr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=xr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(xr(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.words)}):[]}}const JP=new qP,Wn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},eh="zss.js";function ee(t,e){return new GP(t.startLine??1,t.startColumn??1,eh,e)}function ap(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function cp(t){return`'${ap(t)}'`}function nh(t){if(t.startsWith('"'))return nh(t.replaceAll(/(^"|"$)/g,""));const e=Z0(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===Y0?`', api.get('${ap(r.image.substring(1))}'), '`:ap(r.image)).join("")}'].join('')`}function aa(t){return t.filter(e=>e!==void 0).map(se)}function cx(t){return ee(t,"")}function QP(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function nn(t,e,n){return ee(t,[`api.${e}(`,...QP(n,", "),")"])}function tB(t){if(t.type===yt.COMPARE&&t.compare.type===yt.COMPARE_ITEM)switch(t.compare.method){case Qs.IS_EQ:return nn(t,"isEq",[se(t.lhs),se(t.rhs)]);case Qs.IS_NOT_EQ:return nn(t,"isNotEq",[se(t.lhs),se(t.rhs)]);case Qs.IS_LESS_THAN:return nn(t,"isLessThan",[se(t.lhs),se(t.rhs)]);case Qs.IS_GREATER_THAN:return nn(t,"isGreaterThan",[se(t.lhs),se(t.rhs)]);case Qs.IS_LESS_THAN_OR_EQ:return nn(t,"isLessThanOrEq",[se(t.lhs),se(t.rhs)]);case Qs.IS_GREATER_THAN_OR_EQ:return nn(t,"isGreaterThanOrEq",[se(t.lhs),se(t.rhs)])}return ee(t,"")}function to(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",se(n),")"])}function lx(t,e,n){return t.prepend(`api.${e}(`),t.add([se(n),")"])}function eB(t,e){if(t.type===yt.OPERATOR_ITEM)switch(t.operator){case di.PLUS:return to(e,"opPlus",t.rhs);case di.MINUS:return to(e,"opMinus",t.rhs);case di.POWER:return to(e,"opPower",t.rhs);case di.MULTIPLY:return to(e,"opMultiply",t.rhs);case di.DIVIDE:return to(e,"opDivide",t.rhs);case di.MOD_DIVIDE:return to(e,"opModDivide",t.rhs);case di.FLOOR_DIVIDE:return to(e,"opFloorDivide",t.rhs);case di.UNI_PLUS:return lx(e,"opUniPlus",t.rhs);case di.UNI_MINUS:return lx(e,"opUniMinus",t.rhs)}return ee(t,"")}function nB(t){if(t.type===yt.OPERATOR){const e=t.lhs?se(t.lhs):ee(t,"");return t.items.forEach(n=>eB(n,e)),e}return ee(t,"")}function rh(t,e){return ee(t,[nn(t,"jump",[`${e}`]),"; continue;"])}function Ki(t){return Wn.linelookup[t??""]??-1}function lp(t,e){Wn.linelookup[t]=e}function ca(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&(i.done=n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&(i.skip=n);break;case yt.LINE:ca(i.stmts,e,n);break}}}function ux(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&lp(i.done,n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&lp(i.skip,n);break;case yt.LINE:ux(i.stmts,e,n);break}}}function se(t){var e;switch(t.type){case yt.PROGRAM:return ee(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(se).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${eh}`]);case yt.API:return ee(t,["  ",nn(t,t.method,aa(t.words)),`;
`]);case yt.LINE:return ee(t,[`case ${t.lineindex}:
`,...t.stmts.map(se).flat(),`  break;
`]);case yt.MARK:return ee(t,`  // ${t.comment}
`);case yt.GOTO:{const n=Ki(t.id);return ee(t,["  ",rh(t,n),`
`])}case yt.COUNT:return ee(t,`${t.index}`);case yt.LITERAL:switch(t.literal){case th.NUMBER:return ee(t,`${t.value}`);case th.STRING:return ee(t,cp(t.value));case th.TEMPLATE:return ee(t,nh(t.value))}return cx(t);case yt.TEXT:return ee(t,["  ",nn(t,"text",[nh(t.value)]),`;
`]);case yt.STAT:if(Wn.isfirststat){Wn.isfirststat=!1;const n=t.value.trim().split(" ").map(cp);return ee(t,["  ",nn(t,"stat",n),`;
`])}return ee(t,`  // skipped ${t.value}
`);case yt.LABEL:{const n=Nt(t.name),r=t.active?"label":"comment";Wn.labels[n]||(Wn.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Wn.labels[n].push(i),ee(t,`  // ${i} '${n}' ${r}
`)}case yt.HYPERLINK:return ee(t,["  ",nn(t,"hyperlink",[nh(t.text),...aa(t.link)]),`;
`]);case yt.MOVE:{const n=nn(t,"command",[cp("go"),aa(t.words)].flat());return t.wait?ee(t,["  if (",n,`) { continue; };
`]):ee(t,["  ",n,`;
`])}case yt.COMMAND:return ee(t,["  if (",nn(t,"command",aa(t.words)),`) { continue; };
`]);case yt.IF:{const n=((e=t.block)==null?void 0:e.type)===yt.IF_BLOCK?t.block:void 0;if(x(n)){ca([t.check],yt.IF_CHECK,n.skip);const r=ee(t,se(t.check));return n.lines.forEach(i=>r.add(se(i))),ux(n.altlines,yt.ELSE_IF,Ki(n.done)),n.altlines.forEach(i=>r.add(se(i))),r}return ee(t,se(t.check))}case yt.IF_CHECK:{const n=Ki(t.skip);return n===-1?ee(t,["  ",nn(t,t.method,aa(t.words)),`;
`]):ee(t,["  if (!",nn(t,t.method,aa(t.words)),") { ",rh(t,n),` }
`])}case yt.ELSE_IF:case yt.ELSE:{const n=ee(t,"");return t.lines.forEach(r=>n.add(se(r))),n}case yt.WHILE:{const n=Ki(t.loop),r=Ki(t.done),i=ee(t,"");return ca(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case yt.REPEAT:{const n=Ki(t.loop),r=Ki(t.done),i=ee(t,"");return ca(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case yt.WAITFOR:{const n=ee(t,"");return ca(t.lines,yt.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(se(r))}),n}case yt.FOREACH:{const n=Ki(t.loop),r=Ki(t.done),i=ee(t,"");return ca(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case yt.BREAK:return ee(t,["  ",rh(t,t.goto),`
`]);case yt.CONTINUE:return ee(t,["  ",rh(t,t.goto),`
`]);case yt.OR:return nn(t,"or",t.items.map(se));case yt.AND:return nn(t,"and",t.items.map(se));case yt.NOT:return nn(t,"not",t.items.map(se));case yt.COMPARE:return tB(t);case yt.OPERATOR:return nB(t);case yt.EXPR:return nn(t,"expr",t.words.map(se));default:return console.error("<unsupported node>",t.type,t),cx(t)}}function pi(t){if(x(t))switch(t.type===yt.LINE&&++Wn.lineindex,t.lineindex=Wn.lineindex,t.type){case yt.PROGRAM:t.lines.forEach(pi);break;case yt.LINE:t.stmts.forEach(pi);break;case yt.MARK:lp(t.id,t.lineindex);break;case yt.IF:pi(t.check),pi(t.block);break;case yt.IF_BLOCK:t.lines.forEach(pi),t.altlines.forEach(pi);break;case yt.ELSE_IF:t.lines.forEach(pi);break;case yt.ELSE:case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.WAITFOR:t.lines.forEach(pi);break;case yt.MOVE:case yt.COMMAND:case yt.IF_CHECK:t.words.forEach(pi);break}}function rB(t){return Wn.labels={},Wn.internal=1,Wn.lineindex=0,Wn.isfirststat=!0,pi(t),{...se(t).toStringWithSourceMap({file:`${eh}.map`}),...Wn}}function hx(t){return le(t)?t.length>0?1:0:t??0}function iB(t){return`${t}_chip`}function fx(t=""){return`vm:${t??""}`}function sB(t,e,n){var l,u;const r=iB(t),i=mi(r);let s;const o=Yn(Object.entries(n.labels??{}));(!le(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){_.words=d;const h=wP(e,f);return x(h)?h(c,d):f!=="send"?a("send",[f,...d]):0}const c={halt(){wB(r)},id(){return t},set(f,d){const[h,p]=xP(e,c,f,d);if(h)return p},get(f){const[d,h]=EP(e,c,f);if(d)return h},tick(f){const d=St(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return GE(e,c),!1;i.lc=0,i.ys=0,_.get=c.get,kP(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){de(G,_.elementfocus,"crash",p.message),i.es=1}return GE(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return St(i.lc)?++i.lc>Bi.HALT_AT_COUNT:!0},hm(){if(le(i.mg)&&le(i.lb)){const[f]=i.mg;if(x(f))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)return p.find(m=>St(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,p){G.emit(f,`${fx(d)}:${h}`,p)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(le(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f){const m=p.findIndex(w=>w>0);m>=0&&(p[m]*=-1)}}},restore(f){if(le(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)for(let m=0;m<p.length;m++)p[d]=Math.abs(p[d])}},getcase(){i.ec=St(i.ec)?i.ec:1;const f=c.hm();if(f&&le(i.mg)){const[,d,h,p]=i.mg;c.set("sender",h),x(d)&&c.set("arg",d),p&&(c.set("player",p),_.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=St(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=oF.parse(f),[h]=d.filter(p=>p.fileName===eh);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(Nt(we(d)),h)},if(...f){const[d,h]=rt(f,0,[$.ANY]),p=hx(d);return p&&h<f.length&&c.command(...f.slice(h)),p?1:0},try(...f){const[,d]=rt(f,0,[$.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,p]=rt(f,0,[$.NAME,$.ANY]),m=St(h),w=m?p:1,b=c.get(d),T=m?h:1;if(!St(b))return w<f.length&&c.command(...f.slice(w)),1;const A=b-T;return A<0?(w<f.length&&c.command(...f.slice(w)),1):(c.set(d,A),0)},give(...f){const[d,h,p]=rt(f,0,[$.NAME,$.ANY]),m=St(h),w=m?p:1,b=c.get(d),T=m?h:1,A=b===void 0?1:0;return A&&w<f.length&&c.command(...f.slice(w)),c.set(d,Ic(b,0)+T),A},repeatstart(f,...d){const[h,p]=rt(d,0,[$.NUMBER]),m=`repeatcount${f}`,w=`repeatwords${f}`;i[m]=h,i[w]=p<d.length?d.slice(p):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!St(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,w=i[h];return m&&le(w)&&c.command(...w),m?1:0},foreachstart(f,...d){const[h,p,m,w]=rt(d,0,[$.NAME,$.NUMBER,$.NUMBER,$.MAYBE_NUMBER]);let b=Math.min(p,m),T=Math.max(p,m);const A=(w??0)||1;if(A<0){const v=b;b=T,T=v}return c.set(h,b-A),0},foreach(f,...d){const[h,p,m,w,b]=rt(d,0,[$.NAME,$.NUMBER,$.NUMBER,$.MAYBE_NUMBER]);let T=Math.min(p,m),A=Math.max(p,m);const v=(w??0)||1;if(v<0){const R=T;T=A,A=R}let C=c.get(h);!St(C)||C<T||C>A?C=T:C+=v;const S=C<=A?1:0;return S&&(c.set(h,C),b<d.length&&c.command(...d.slice(b))),S},waitfor(...f){const[d]=rt(f,0,[$.ANY]),h=hx(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[$.ANY]);if(d=p,d)break;h=m}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[$.ANY]);if(d=p,!d)break;h=m}return d},not(...f){const[d]=rt(f,0,[$.ANY]);return d?0:1},expr(...f){const[d]=rt(f,0,[$.ANY]);return d},isEq(f,d){const[h]=rt([f],0,[$.ANY]),[p]=rt([d],0,[$.ANY]);return typeof h=="object"||typeof p=="object"?_k(h,p)?1:0:h===p?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h<p?1:0},isGreaterThan(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h>p?1:0},isLessThanOrEq(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h<=p?1:0},isGreaterThanOrEq(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h>=p?1:0},opPlus(f,d){const[h]=rt([f],0,[$.ANY]),[p]=rt([d],0,[$.ANY]);return h+p},opMinus(f,d){const[h]=rt([f],0,[$.ANY]),[p]=rt([d],0,[$.ANY]);return h-p},opPower(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return Math.pow(h,p)},opMultiply(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h*p},opDivide(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h/p},opModDivide(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h%p},opFloorDivide(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return Math.floor(h/p)},opUniPlus(f){const[d]=rt([f],0,[$.NUMBER]);return+d},opUniMinus(f){const[d]=rt([f],0,[$.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function up(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];le(r)?r.forEach(i=>{e.push(up(i))}):e.push(up(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function oB(t){const e=O0(`${t}
`);if(e.errors.length>0)return e;oa.input=e.tokens;const n=oa.program();if(oa.errors.length>0)return{tokens:e.tokens,errors:oa.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=JP.go(n);return r?(up(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const hp=Object.getPrototypeOf(function*(){}).constructor;function aB(t,e){const n=`compile-${t}`;console.time(n);const r=oB(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=rB(r.ast);if(i.code){UU&&console.info(i.code);try{return{...r,...i,source:i.code,code:new hp("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new hp("api"," ")}}}return{...r,...i,source:"",code:new hp("api"," ")}}function cB(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=aB(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return x(s)?s.isended():!0},halt(i){const s=e[i];return x(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!x(e[i])){const f=n(a,c);if(l=e[i]=sB(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((b,T)=>[b,T]);p.slice(h-5,h).forEach(([b,T])=>{de(G,kr(),"build",`$grey${T+1} $grey${b}`)});const[m,w]=p[h]??[];if(Et(m)&&x(w)){const b=(d.column??1)-1,T=b+d.length,A=b<m.length?m:`${m}*`,v=A.substring(0,b),C=A.substring(b,T),S=A.substring(T);de(G,kr(),"build",`$red${w+1} $grey${v}$red${C}$grey${S}`)}return d.message.split(`
`).forEach(b=>{de(G,kr(),"build",b)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Ar(i.target),a=e[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}let dx=0;function lB(){switch(dx++){case 0:return jt.BLUE;case 1:return jt.GREEN;case 2:return jt.CYAN;case 3:return jt.RED;case 4:return jt.PURPLE;case 5:return jt.YELLOW;default:return dx=0,jt.WHITE}}const Ve=new qa,In={},ih={};function px(t,e,n,r,i=0){const s=`tiles:${t}:${e}`;return x(In[s])||(In[s]=tO(t,e,n,r,i)),In[s]}function uB(t,e,n,r){const i=`sprites:${t}:${e}:${n}`,s=`sprite:${t}:${e}:${r}`;return x(ih[s])||(ih[s]=eO(t,e,n)),ih[s].id=i,ih[s]}function hB(t,e){const n=`sprites:${t}:${e}`;return x(In[n])||(In[n]=nO(t,e)),In[n]}function fB(t,e,n,r,i=0){const s=`dither:${t}:${e}`;return x(In[s])||(In[s]=rO(t,e,n,r,i)),In[s]}function sh(t,e,n,r){const i=`media:${t}:${e}`;x(In[i])||(In[i]=iO(t,e,n,r));const s=In[i];return s.mime=n,s.media=r,s}function dB(t,e){const n=`control:${t}:${e}`;return x(In[n])||(In[n]=sO(t,e)),In[n]}const ys=.4;function mx(t,e){const n=[];Ve.x=t-ys,Ve.y=e-ys,n.push(Ve.angle()),Ve.x=t+ys,Ve.y=e-ys,n.push(Ve.angle()),Ve.x=t-ys,Ve.y=e+ys,n.push(Ve.angle()),Ve.x=t+ys,Ve.y=e+ys,n.push(Ve.angle());const r=Math.round(id(Math.min(...n))),i=Math.round(id(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function fp(t,e,n,r,i,s){var R;if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const o=[];let a=e;const c=Rt,l=Qt,u=s?jt.BLACK:jt.ONCLEAR,f=px(t,a++,c,l,u);o.push(f);const d=a++,h=hB(t,d);h.sprites=[],o.push(h);const p=r.isdark?1:0,m=fB(t,a++,c,l,p);o.push(m),m.alphas.fill(p);const w=px(t,a++,c,l,jt.ONCLEAR);o.push(w),w.char.fill(0);const b={...X0(Rt,Qt,lB(),jt.ONCLEAR),...w},T=dB(t,a++);if(i){if(o.push(T),Et(r.camera))switch(Nt(r.camera)){default:case"mid":T.viewscale=Yl.MID;break;case"near":T.viewscale=Yl.NEAR;break;case"far":T.viewscale=Yl.FAR;break}if(Et(r.graphics)){const O=Nt(r.graphics);switch(O){case"mode7":case"firstperson":T.graphics=O;break;default:case"flat":T.graphics="flat";break}}const{facing:U}=mi(t);St(U)&&(T.facing=ly(U%360))}for(let U=0;U<r.terrain.length;++U){const O=r.terrain[U],D=hE(n,O,0,jt.WHITE,s?jt.BLACK:jt.ONCLEAR);f.char[U]=D.char,f.color[U]=D.color,f.bg[U]=D.bg}const A=Object.values(r.objects??{});for(let U=0;U<A.length;++U){const O=A[U];if(x(O.removed))continue;const D=O.id??"",V=hE(n,O,1,jt.WHITE,jt.BLACK),L=uB(t,d,D,U);if(L.x=O.x??0,L.y=O.y??0,L.char=V.char,L.color=V.color,L.bg=V.bg,h.sprites.push(L),p){if(V.light>0){const N=[],E=qe(Math.round(V.light),1,Rt),B=E*.5,Q=Cr(r,L),j=1/B;if(m.alphas[Q]=0,E>1)for(let st=1;st<=E;++st)for(let et=L.y-st;et<=L.y+st;++et)for(let ft=L.x-st;ft<=L.x+st;++ft){if(ft===L.x&&et===L.y)continue;Ve.x=ft-L.x,Ve.y=et-L.y;const Z=Ve.length();if(Z>E)continue;const H=Cr(r,{x:ft,y:et});if(H===-1)continue;const wt=Math.round(id(Ve.angle()));let at=0;for(let Tt=0;Tt<N.length;++Tt){const Dt=N[Tt];wt>=Dt[0]&&wt<=Dt[1]&&(at=Math.max(at,Dt[2]))}m.alphas[H]=Math.min(m.alphas[H],at+(Z<B?0:(Z-B)*j)),m.alphas[H]=qe(m.alphas[H],0,1);const lt=vn(r,((R=r.lookup)==null?void 0:R[H])??"");if(x(lt)){const Tt=[...mx(Ve.x,Ve.y),.25];N.push(Tt)}const Mt=r.terrain[H],Zt=Dr(n,Mt),Ut=(Mt==null?void 0:Mt.collision)??(Zt==null?void 0:Zt.collision);if(Ho(Kt.ISBULLET,Ut)){const Tt=[...mx(Ve.x,Ve.y),1];let Dt=0;for(Dt=0;Dt<N.length;++Dt){const Ft=N[Dt];if(Ft[1]>Ft[0]&&Tt[1]>=Ft[0]&&Tt[0]<=Ft[1]&&Tt[2]>=1&&Ft[2]>=1){N[Dt]=[Math.min(Tt[0],Ft[0]),Math.max(Tt[1],Ft[1]),1];break}}Dt===N.length&&N.push(Tt)}}}else if(vr(D)){const N=Cr(r,L);m.alphas[N]=0}}if(Et(O.tickertext)&&St(O.tickertime)&&O.tickertext.length){const N=Rt,E=SE(O.tickertext,N,Qt-1),B=(E==null?void 0:E.measuredwidth)??1,Q=O.x??0,j=O.y??0,st=j<Qt*.5;b.x=Q-Math.floor(B*.5),b.y=j+(st?1:-1),b.x+B>Rt&&(b.x=Rt-B),b.x<0&&(b.x=0),AE(O.tickertext,b,!0)}D===t&&(T.focusx=L.x,T.focusy=L.y,T.focusid=D)}o.push(sh(t,a++,"text/mood",p?"dark":"bright"));const v=fe(Bt.MAIN),C=zi(v,Bt.MAIN);if(Et(C.palette)){const U=en(v,_t.PALETTE,C.palette),O=Le(U);x(O==null?void 0:O.bits)&&o.push(sh(t,a++,"image/palette",Array.from(O.bits)))}if(Et(C.charset)){const U=en(v,_t.CHARSET,C.charset),O=Le(U);x(O==null?void 0:O.bits)&&o.push(sh(t,a++,"image/charset",Array.from(O.bits)))}const S=Object.keys(r.objects).filter(vr);return o.push(sh(t,a++,"text/players",S.join(","))),o}const ir=cB();var Bt=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Bt||{});const ke={halt:!1,session:Me(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function pB(){return ke.session}function kr(){return ke.operator}function mB(t){ke.operator=t}function gB(t){ke.halt=t}function _B(){return ke.halt}function la(){return[...ke.books.values()]}function yB(){const[t]=ke.books.values();return t}function $r(t){const e=Nt(t);return ke.books.get(t)??la().find(n=>n.name===e)}function oh(t,e){x($r(e))&&(ke.software[t]=e)}function fe(t){return $r(ke.software[t])}function gx(t){const e=oE([]);return Et(t)&&(e.name=t),dp(e),Ei(G,ke.operator,`created [book] ${e.name}`),e}function bB(t){let e=$r(t);return x(e)||(e=oE([]),e.name=t),dp(e),Ei(G,ke.operator,`created [book] ${e.name}`),e}function Nn(t,e){let n=x(e)?bB(e):fe(t);return x(n)||(x(n)||(n=yB()),x(n)||(n=gx(e)),x(n)&&Ei(G,ke.operator,`opened [book] ${n.name} for ${t}`)),oh(t,n.id),n}function bs(t,e,n){return F0(Nn(t),n,e)}function mi(t){const e=Nn("main");return zi(e,t)}function _x(){const t=Nn("main");return zi(t,"main")}function wB(t){const e=Nn("main");return fE(e,t)}function EB(t,e){ke.books.clear(),t.forEach(r=>{ke.books.set(r.id,r),r.name==="main"&&(ke.software.main=r.id)});const n=$r(e);if(x(n)&&oh("main",n.id),!ke.software.main){const r=ke.books.values().next();r.value&&(ke.software.main=r.value.id)}}function dp(t){return ke.books.set(t.id,t),t.id}function xB(t){const e=$r(t);e&&ke.books.delete(e.id)}function kB(t){if(!Et(t)||!t)return de(G,t,"login",`failed for playerid ==>${t}<==`);const e=fe("main");if(!x(e))return de(G,t,"login:main","login failed to find book 'main'");const n=Xs(e,t);if(x(n))return!0;const r=zn(e,_t.BOARD,"title");if(r.length===0)return de(G,t,"login:title","login failed to find board with 'title' stat");const i=Qo(e,"player");if(!x(i))return de(G,t,"login:player","login failed to find object type 'player'");const s=fy(t,r),o=Le(s);if(x(o)){const a=sE(s,"startx"),c=sE(s,"starty"),l=St(a)?a:Math.round(Rt*.5),u=St(c)?c:Math.round(Qt*.5),f=i.name??"player",d=xd(o,{x:l,y:u},f,t);if(x(d==null?void 0:d.id))return d.player=t,zu(e,t,o.id),!0}return!1}function TB(t){const e=fe("main"),n=Xs(e,t);zu(e,t,""),B0(e,n,vn(n,t)),Zy(n,t),ir.halt(t),fE(e,t)}function sr(t){const e=fe("main");return Xs(e,t)}function vB(t){const e=fe("main"),n=VU(e,t),r=Xs(e,t),i=vn(r,t);return n&&x(i)}function AB(t){const e=fe("main"),n=P0(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;vr(c)&&x(t[c])===!1&&(t[c]=0,zu(e,c,i.id))}}}function yx(t){ir.message(t)}function Fc(t,e,n,r){const i=os(e);Et(n.id)&&G.emit(t,"vm:touched",[n.id,i,r])}function ua(t,e,n,r){if(!x(n==null?void 0:n.id))return!1;const i=j0(t,e,n,r);if(x(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=zn(t,_t.BOARD,(e==null?void 0:e.exitwest)??"");if(o.length){const a=Ae(o);ta(t,n.id,a.id,{x:Rt-1,y:r.y})}}else if(r.x>=Rt){const o=zn(t,_t.BOARD,(e==null?void 0:e.exiteast)??"");if(o.length){const a=Ae(o);ta(t,n.id,a.id,{x:0,y:r.y})}}else if(r.y<0){const o=zn(t,_t.BOARD,(e==null?void 0:e.exitnorth)??"");if(o.length){const a=Ae(o);ta(t,n.id,a.id,{x:r.x,y:Qt-1})}}else if(r.y>=Qt){const o=zn(t,_t.BOARD,(e==null?void 0:e.exitsouth)??"");if(o.length){const a=Ae(o);ta(t,n.id,a.id,{x:r.x,y:0})}}}else Fc("",i,n,"thud");if(n.kind==="player"){const o=vr(i.id);Fc(n.id,n,i,o?"bump":"touch")}else if(n.collision===Kt.ISBULLET){const o=vr(n.party),a=vr(i.id);o!==a?Fc(n.party??"",n,i,"shot"):Fc("",n,i,"thud")}else Fc("",n,i,"bump");const s=Dr(t,i);return i.destructible??(s==null?void 0:s.destructible)?(x(i==null?void 0:i.id)?rr(_.book,_.board,i,_.timestamp):un(e,{x:r.x,y:r.y}),!0):!1}return!0}function bx(t,e,n,r,i=nS){var f;if(!x(t)||!x(e)||!x(n))return;const s={..._};_.book=t,_.board=e,_.element=n,_.elementid=n.id??"",_.elementisplayer=vr(_.elementid);const o=_.element.player??ke.operator;_.elementfocus=_.elementisplayer?_.elementid:o;const a=Dr(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=Nt(n.name??((f=n.kinddata)==null?void 0:f.name)??"");if(ir.tick(l,_s.RUNTIME,St(c)?c:i,u,r),St(n==null?void 0:n.tickertime)&&_.timestamp-n.tickertime>rl*5&&(n.tickertime=0,n.tickertext=""),_.elementisplayer){const d=mi(_.elementid);St(d.inputcurrent)&&(d.inputcurrent=0)}jr(s).forEach(d=>{_[d]=s[d]})}function SB(t,e){ke.loaders.set(t,e)}function RB(t){ir.halt(t)}function IB(){const t=ir.ids();for(let n=0;n<t.length;++n)ir.halt(t[n]);const e=fe("main");x(e)&&(e.flags={})}function NB(){const t=fe("main");if(!x(t))return;const e=t.timestamp+1,n=Bi.HALT_AT_COUNT;Bi.HALT_AT_COUNT=n*2,ke.loaders.forEach((i,s)=>{const o={..._};_.timestamp=t.timestamp,_.book=t,_.board=void 0,_.element=void 0,_.elementid=s,_.elementisplayer=!1,_.elementfocus=kr();const a=LF(s);x(a)&&ir.arg(s,a),ir.tick(s,_s.LOADER,1,"loader",i),ir.isended(s)&&(ir.halt(s),ke.loaders.delete(s)),jr(o).forEach(c=>{_[c]=o[c]})}),Bi.HALT_AT_COUNT=n,t.timestamp=e,_.timestamp=e;const r=P0(t);for(let i=0;i<r.length;++i){const s=r[i],o=nF(t,s,e);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:f}=o[a];l===_t.ERROR?ir.halt(c):bx(t,s,f,u)}}}function pp(t,e){const n=fe("main");if(!x(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(x(u.id)){const f=`${fx(u.id)}:${c}`;G.emit("",f,e)}}}const{target:i,path:s}=Ar(t),o=P0(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Nt(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(qy(c,[i]),s);break}}}}function OB(t){const e=mi(t).playbuffer;Et(e)&&e&&wx(t,e)}function wx(t,e=""){var s;const n=Nn("main");if(!x(n))return;const r=`${t}_cli`;_.timestamp=n.timestamp,_.book=n,_.board=Xs(n,t),_.element=vn(_.board,t),_.elementid=((s=_.element)==null?void 0:s.id)??"",_.elementisplayer=!0,_.elementfocus=_.elementid||t;const i=Bi.HALT_AT_COUNT;Bi.HALT_AT_COUNT=i*8,eg(G,t,"running",n.timestamp,r,e),ir.once(r,_s.CLI,"cli",e),mi(t).playbuffer=e,Bi.HALT_AT_COUNT=i}function ah(t){var o;const e=Nn("main"),n=ji(e,t);if(!x(e)||!x(n)||!x(_.element))return;const r=`${t}_run`,i=Nt(_.element.name??((o=_.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";ir.once(r,_s.RUNTIME,i,s)}function CB(t){const e=fe("main"),n=Xs(e,t),r=[],i=[],s=[];if(!x(e)||!x(n))return{over:r,under:i,layers:s};const o=n.graphics??"flat",a=ds(e,n.overboard??""),c=ds(e,n.underboard??"");return i.push(...fp(t,0,e,c,!1,!0)),s.push(...fp(t,i.length,e,n,!0,o!=="flat")),r.push(...fp(t,i.length+s.length,e,a,!1,!1)),{over:r,under:i,layers:s}}function ha(t,e=0){const n=[];let r=t;for(;r<_.words.length;){const[i,s]=Hn(r);if(le(i)&&!Ni(i)&&!Nc(i)&&!Ku(i)&&!ei(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function Hn(t){var r,i,s,o,a,c,l,u,f;const e=_.words[t],n=t+1;if(OE(e)){const[d,h]=TF(t);if(x(d))return[d,h]}if(vF(e)){const[d,h]=AF(t);if(x(d))return[d,h]}if(ad(e)){const[d,h]=cd(t);if(x(d))return[d,h]}if(Et(e)&&Nt(e)==="rnd"){const[d,h]=Hn(n),[p,m]=Hn(h);return St(d)&&St(p)?[fr(d,p),m]:St(d)?[fr(0,d),h]:[fr(0,1),n]}if(od(e)){const[d,h]=my(t);if(x(d))return[d,h]}if(!x(e))return[void 0,t];if(St(e)||le(e))return[e,n];if(Et(e)){const d=Nt(e),h=(r=_.get)==null?void 0:r.call(_,e);if(x(h))return[h,n];switch(d){case"aligned":case"alligned":{const p=sc(_.board,{x:((i=_.element)==null?void 0:i.x)??-1,y:((s=_.element)==null?void 0:s.y)??-1},_.elementfocus);return!x(_.element)||!x(p)?[0,n]:[_.element.x===p.x||_.element.y===p.y?1:0,n]}case"contact":{const p=sc(_.board,{x:((o=_.element)==null?void 0:o.x)??-1,y:((a=_.element)==null?void 0:a.y)??-1},_.elementfocus);if(!x(_.element)||!x(p))return[0,n];const m=(p.x??0)-(((c=_.element)==null?void 0:c.x)??0),w=(p.y??0)-(((l=_.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(w)<2||w===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=rt(_.words,n,[$.DIR]);return[tF(_.book,_.board,_.element,p.destpt)?1:0,m]}case"any":{const[p,m]=rt(_.words,n,[$.KIND]);return[Xy(_.board,p).length?1:0,m]}case"rnd":return[fr(0,1),n];case"abs":{const[p,m]=rt(_.words,n,[$.NUMBER]);return[Math.abs(p),m]}case"intceil":{const[p,m]=rt(_.words,n,[$.NUMBER]);return[Math.ceil(p),m]}case"intfloor":{const[p,m]=rt(_.words,n,[$.NUMBER]);return[Math.floor(p),m]}case"intround":{const[p,m]=rt(_.words,n,[$.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,w,b]=rt(_.words,n,[$.NUMBER,$.NUMBER,$.NUMBER]);return[qe(p,m,w),b]}case"min":{const[p,m]=ha(n);return[Math.min(...p),m]}case"max":{const[p,m]=ha(n);return[Math.max(...p),m]}case"pick":{const[p,m]=ha(n);return[Ae(p),m]}case"pickwith":{const[p,m]=rt(_.words,n,[$.NUMBER_OR_STRING]),[w,b]=ha(m);return[fy(`${p}`,w),b]}case"random":{const[p,m]=ha(n,2),[w,b]=p;return[fr(w,b??0),m]}case"randomwith":{const[p,m]=rt(_.words,n,[$.NUMBER_OR_STRING]),[w,b]=ha(m,2),[T,A]=w;return[uy(`${p}`,T,A??0),b]}case"run":{const[p,m]=rt(_.words,n,[$.NAME]);return ah(p),[(u=_.get)==null?void 0:u.call(_,"arg"),m]}case"runwith":{const[p,m,w]=rt(_.words,n,[$.ANY,$.NAME]);return x(_.element)&&(_.element.arg=p),ah(m),[(f=_.get)==null?void 0:f.call(_,"arg"),w]}}}return[e,n]}const _={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var $=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.MAYBE_KIND=7]="MAYBE_KIND",t[t.MAYBE_NAME=8]="MAYBE_NAME",t[t.MAYBE_NUMBER=9]="MAYBE_NUMBER",t[t.MAYBE_STRING=10]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",t[t.ANY=12]="ANY",t))($||{});function xn(t,e,n){throw console.info(n,_.element,_.elementid,_.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function Ex(t){var n,r;const e={x:((n=_.element)==null?void 0:n.x)??0,y:((r=_.element)==null?void 0:r.y)??0};return D0(_.book,_.board,_.element,_.elementfocus,t,e)}function rt(t,e,n){const r=_.words;_.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=wy(s);$o(a)?(s=c,i.push(a)):xn("kind",a,t);break}case 0:{if(ad(t[0])===void 0){const[a,c]=Hn(s);ei(a)?(s=c,i.push(a)):xn("color",a,t)}else{const[a,c]=cd(s);ei(a)?(s=c,i.push(a)):xn("color",a,t)}break}case 2:{if(od(t[0])===void 0){const[a,c]=Hn(s);Ni(a)?(s=c,i.push(Ex(a))):xn("direction",a,t)}else{const[a,c]=my(s);Ni(a)?(s=c,i.push(Ex(a))):xn("direction",a,t)}break}case 3:{const a=_.words[s];Et(a)||xn("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Hn(s);if(Et(a)){const l=parseFloat(a);St(l)?i.push(l):xn("number",a,t)}else St(a)?i.push(a):xn("number",a,t);s=c;break}case 5:{const[a,c]=Hn(s);Et(a)||xn("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Hn(s);let l=a;if(Et(l)){const u=parseFloat(l);St(u)&&(l=u)}else St(l)||xn("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=wy(s);a!==void 0&&!$o(a)&&xn("optional kind",a,t),s=c,i.push(a);break}case 8:{const a=_.words[s];a!==void 0&&!Et(a)&&xn("optional string",a,t),++s,i.push(a);break}case 9:{const[a,c]=Hn(s);if(Et(a)){const l=parseFloat(a);St(l)?i.push(l):xn("optional number",a,t)}else St(a)||a===void 0?i.push(a):xn("optional number",a,t);s=c;break}case 10:{const[a,c]=Hn(s);a!==void 0&&!Et(a)&&xn("optional string",a,t),s=c,i.push(a);break}case 11:{const[a,c]=Hn(s);let l=a;if(Et(l)){const u=parseFloat(l);St(u)&&(l=u)}else l!==void 0&&!St(l)&&xn("number or string",l,t);s=c,i.push(l);break}case 12:{const[a,c]=Hn(s);s=c,i.push(a);break}}return _.words=r,[...i,s]}const ch={},fa={};function mp(){return{id:Me(),layers:[],scroll:[],sidebar:[]}}const LB=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),MB=new Set(["tx","text"]),UB={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},xx={};let kx=t=>{let e=xx[t];return x(e)||(xx[t]=e=mp()),e};function FB(t){kx=t}function On(t){return kx(t)}function gp(t){return x(ch[t])||(ch[t]=[]),ch[t]}function PB(t){const e=On(t);e.scroll=[]}function BB(t,e,n){Object.values(fa).forEach(r=>{if(r[e]!==void 0){const i=t1(t.id(),e);St(n)&&QI(i,n),Et(n)&&tN(i,n)}})}function gi(t){const e=gp(t);return ch[t]=[],e}function ae(t,e){gp(t).push(e)}function $t(t,e,n,r,i=()=>0,s=xh){const o=[e,n,...r],a=Nt(`${o[3]}`),c={..._};function l(u,f){x(f)&&f!==i(u)&&(_.board=c.board,_.element=c.element,_.elementfocus=c.elementfocus,s(u,f))}if(LB.has(a)){const u=`${o[2]}`;fa[e]=fa[e]??{};const f=i(u)??UB[a];if(fa[e][u]===void 0){const d=t1(e,u);St(f)&&JI(d,f),Et(f)&&Jf(d,f),MB.has(a)?fa[e][u]=Q_(d,h=>{l(u,h)}):fa[e][u]=eN(d,h=>{l(u,h)})}}gp(t).push(o)}FB(t=>{if(vr(t)){const e=fe(Bt.MAIN),n=zi(e,Bt.GADGETSTORE);let r=n[t];return x(r)||(n[t]=r=mp()),r}return mp()});const lh=oo("gadgetserver",["tock","second"],t=>{if(!lh.session(t))return;const e=fe(Bt.MAIN),n=(e==null?void 0:e.activelist)??[],r=zi(e,Bt.GADGETSYNC);switch(t.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=On(s),{over:a,under:c,layers:l}=CB(s);o.over=a,o.under=c,o.layers=l;const u=r[s]??{},f=Cp(u,o);f.length&&(r[s]=Yn(o),SA(lh,s,f))}break;case"second":{for(let i=0;i<n.length;++i){const s=n[i],o=sr(s);x(o)&&$A(lh,s,o.id)}break}case"desync":AA(lh,t.player,On(t.player));break;case"clearscroll":PB(t.player);break;case"clearplayer":{const i=fe(Bt.MAIN),s=zi(i,Bt.GADGETSTORE);delete s[t.player];const o=zi(i,Bt.GADGETSYNC);delete o[t.player];break}}});function uh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Tx={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof uh=="function"&&uh;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof uh=="function"&&uh,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,p,m,w=[],b=0,T=c.length,A=T,v=s.getTypeOf(c)!=="string";b<c.length;)A=T-b,f=v?(l=c[b++],u=b<T?c[b++]:0,b<T?c[b++]:0):(l=c.charCodeAt(b++),u=b<T?c.charCodeAt(b++):0,b<T?c.charCodeAt(b++):0),d=l>>2,h=(3&l)<<4|u>>4,p=1<A?(15&u)<<2|f>>6:64,m=2<A?63&f:64,w.push(a.charAt(d)+a.charAt(h)+a.charAt(p)+a.charAt(m));return w.join("")},i.decode=function(c){var l,u,f,d,h,p,m=0,w=0,b="data:";if(c.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|A):new Array(0|A);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(m++)))>>2,f=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),T[w++]=l,h!==64&&(T[w++]=u),p!==64&&(T[w++]=f);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,p){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,w="";for(m=0;m<p;m++)w+=String.fromCharCode(255&h),h>>>=8;return w}function o(h,p,m,w,b,T){var A,v,C=h.file,S=h.compression,R=T!==l.utf8encode,U=a.transformTo("string",T(C.name)),O=a.transformTo("string",l.utf8encode(C.name)),D=C.comment,V=a.transformTo("string",T(D)),L=a.transformTo("string",l.utf8encode(D)),N=O.length!==C.name.length,E=L.length!==D.length,B="",Q="",j="",st=C.dir,et=C.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=h.crc32,ft.compressedSize=h.compressedSize,ft.uncompressedSize=h.uncompressedSize);var Z=0;p&&(Z|=8),R||!N&&!E||(Z|=2048);var H=0,wt=0;st&&(H|=16),b==="UNIX"?(wt=798,H|=function(lt,Mt){var Zt=lt;return lt||(Zt=Mt?16893:33204),(65535&Zt)<<16}(C.unixPermissions,st)):(wt=20,H|=function(lt){return 63&(lt||0)}(C.dosPermissions)),A=et.getUTCHours(),A<<=6,A|=et.getUTCMinutes(),A<<=5,A|=et.getUTCSeconds()/2,v=et.getUTCFullYear()-1980,v<<=4,v|=et.getUTCMonth()+1,v<<=5,v|=et.getUTCDate(),N&&(Q=s(1,1)+s(u(U),4)+O,B+="up"+s(Q.length,2)+Q),E&&(j=s(1,1)+s(u(V),4)+L,B+="uc"+s(j.length,2)+j);var at="";return at+=`
\0`,at+=s(Z,2),at+=S.magic,at+=s(A,2),at+=s(v,2),at+=s(ft.crc32,4),at+=s(ft.compressedSize,4),at+=s(ft.uncompressedSize,4),at+=s(U.length,2),at+=s(B.length,2),{fileRecord:f.LOCAL_FILE_HEADER+at+U+B,dirRecord:f.CENTRAL_FILE_HEADER+s(wt,2)+at+s(V.length,2)+"\0\0\0\0"+s(H,4)+s(w,4)+U+B+V}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,p,m,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=w,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-w-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(w){return f.DATA_DESCRIPTOR+s(w.crc32,4)+s(w.compressedSize,4)+s(w.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,w=function(b,T,A,v,C){var S=a.transformTo("string",C(v));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(b,2)+s(b,2)+s(T,4)+s(A,4)+s(S.length,2)+S}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var p=function(T,A){var v=T||A,C=s[v];if(!C)throw new Error(v+" is not a valid compression method !");return C}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},w=h.dir,b=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:w,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(w){p(w)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var w=new c(h);return w.load(m),w}).then(function(m){var w=[o.Promise.resolve(m)],b=m.files;if(h.checkCRC32)for(var T=0;T<b.length;T++)w.push(f(b[T]));return o.Promise.all(w)}).then(function(m){for(var w=m.shift(),b=w.files,T=0;T<b.length;T++){var A=b[T],v=A.fileNameStr,C=s.resolve(A.fileNameStr);p.file(C,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:h.createFolders}),A.dir||(p.file(C).unsafeOriginalName=v)}return w.zipComment.length&&(p.comment=w.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof fn<"u",newBufferFrom:function(s,o){if(fn.from&&fn.from!==Uint8Array.from)return fn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new fn(s,o)},allocBuffer:function(s){if(fn.alloc)return fn.alloc(s);var o=new fn(s);return o.fill(0),o},isBuffer:function(s){return fn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,S,R){var U,O=a.getTypeOf(S),D=a.extend(R||{},u);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(C=b(C)),D.createFolders&&(U=w(C))&&T.call(this,U,!0);var V=O==="string"&&D.binary===!1&&D.base64===!1;R&&R.binary!==void 0||(D.binary=!V),(S instanceof f&&S.uncompressedSize===0||D.dir||!S||S.length===0)&&(D.base64=!1,D.binary=!0,S="",D.compression="STORE",O="string");var L=null;L=S instanceof f||S instanceof c?S:p.isNode&&p.isStream(S)?new m(C,S):a.prepareContent(C,S,D.binary,D.optimizedBinaryString,D.base64);var N=new d(C,L,D);this.files[C]=N}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),w=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var S=C.lastIndexOf("/");return 0<S?C.substring(0,S):""},b=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},T=function(C,S){return S=S!==void 0?S:u.createFolders,C=b(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:S}),this.files[C]};function A(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var S,R,U;for(S in this.files)U=this.files[S],(R=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&C(R,U)},filter:function(C){var S=[];return this.forEach(function(R,U){C(R,U)&&S.push(U)}),S},file:function(C,S,R){if(arguments.length!==1)return C=this.root+C,s.call(this,C,S,R),this;if(A(C)){var U=C;return this.filter(function(D,V){return!V.dir&&U.test(D)})}var O=this.files[this.root+C];return O&&!O.dir?O:null},folder:function(C){if(!C)return this;if(A(C))return this.filter(function(O,D){return D.dir&&C.test(O)});var S=this.root+C,R=T.call(this,S),U=this.clone();return U.root=R.name,U},remove:function(C){C=this.root+C;var S=this.files[C];if(S||(C.slice(-1)!=="/"&&(C+="/"),S=this.files[C]),S&&!S.dir)delete this.files[C];else for(var R=this.filter(function(O,D){return D.name.slice(0,C.length)===C}),U=0;U<R.length;U++)delete this.files[R[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var S,R={};try{if((R=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var U=R.comment||this.comment||"";S=h.generateWorker(this,R,U)}catch(O){(S=new c("error")).error(O)}return new l(S,R.type||"string",R.mimeType)},generateAsync:function(C,S){return this.generateInternalStream(C).accumulate(S)},generateNodeStream:function(C,S){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(S)}};r.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(w,b){var T=[],A=p._internalType,v=p._outputType,C=p._mimeType;p.on("data",function(S,R){T.push(S),m&&m(R)}).on("error",function(S){T=[],b(S)}).on("end",function(){try{var S=function(R,U,O){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",U),O);case"base64":return c.encode(U);default:return s.transformTo(R,U)}}(v,function(R,U){var O,D=0,V=null,L=0;for(O=0;O<U.length;O++)L+=U[O].length;switch(R){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(V=new Uint8Array(L),O=0;O<U.length;O++)V.set(U[O],D),D+=U[O].length;return V;case"nodebuffer":return fn.concat(U);default:throw new Error("concat : unsupported type '"+R+"'")}}(A,T),C);w(S)}catch(R){b(R)}T=[]}).resume()})}function h(p,m,w){var b=m;switch(m){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=m,this._mimeType=w,s.checkSupport(b),this._worker=p.pipe(new o(b)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var w=this;return p==="data"?this._worker.on(p,function(b){m.call(w,b.data,b.meta)}):this._worker.on(p,function(){s.delay(m,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof fn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,w,b,T,A,v=p.length,C=0;for(T=0;T<v;T++)(64512&(w=p.charCodeAt(T)))==55296&&T+1<v&&(64512&(b=p.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(b-56320),T++),C+=w<128?1:w<2048?2:w<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),T=A=0;A<C;T++)(64512&(w=p.charCodeAt(T)))==55296&&T+1<v&&(64512&(b=p.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(b-56320),T++),w<128?m[A++]=w:(w<2048?m[A++]=192|w>>>6:(w<65536?m[A++]=224|w>>>12:(m[A++]=240|w>>>18,m[A++]=128|w>>>12&63),m[A++]=128|w>>>6&63),m[A++]=128|63&w);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,w,b,T,A=p.length,v=new Array(2*A);for(m=w=0;m<A;)if((b=p[m++])<128)v[w++]=b;else if(4<(T=l[b]))v[w++]=65533,m+=T-1;else{for(b&=T===2?31:T===3?15:7;1<T&&m<A;)b=b<<6|63&p[m++],T--;1<T?v[w++]=65533:b<65536?v[w++]=b:(b-=65536,v[w++]=55296|b>>10&1023,v[w++]=56320|1023&b)}return v.length!==w&&(v.subarray?v=v.subarray(0,w):v.length=w),s.applyFromCharCode(v)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var w=function(T,A){var v;for((A=A||T.length)>T.length&&(A=T.length),v=A-1;0<=v&&(192&T[v])==128;)v--;return v<0||v===0?A:v+l[T[v]]>A?v:A}(p),b=p;w!==p.length&&(o.uint8array?(b=p.subarray(0,w),this.leftOver=p.subarray(w,p.length)):(b=p.slice(0,w),this.leftOver=p.slice(w,p.length))),this.push({data:i.utf8decode(b),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,w){for(var b=0;b<m.length;++b)w[b]=255&m.charCodeAt(b);return w}n("setimmediate"),i.newBlob=function(m,w){i.checkSupport("blob");try{return new Blob([m],{type:w})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(m),b.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,w,b){var T=[],A=0,v=m.length;if(v<=b)return String.fromCharCode.apply(null,m);for(;A<v;)w==="array"||w==="nodebuffer"?T.push(String.fromCharCode.apply(null,m.slice(A,Math.min(A+b,v)))):T.push(String.fromCharCode.apply(null,m.subarray(A,Math.min(A+b,v)))),A+=b;return T.join("")},stringifyByChar:function(m){for(var w="",b=0;b<m.length;b++)w+=String.fromCharCode(m[b]);return w},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var w=65536,b=i.getTypeOf(m),T=!0;if(b==="uint8array"?T=f.applyCanBeUsed.uint8array:b==="nodebuffer"&&(T=f.applyCanBeUsed.nodebuffer),T)for(;1<w;)try{return f.stringifyByChunk(m,b,w)}catch{w=Math.floor(w/2)}return f.stringifyByChar(m)}function h(m,w){for(var b=0;b<m.length;b++)w[b]=m[b];return w}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,w){if(w=w||"",!m)return w;i.checkSupport(m);var b=i.getTypeOf(w);return p[b][m](w)},i.resolve=function(m){for(var w=m.split("/"),b=[],T=0;T<w.length;T++){var A=w[T];A==="."||A===""&&T!==0&&T!==w.length-1||(A===".."?b.pop():b.push(A))}return b.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var w,b,T="";for(b=0;b<(m||"").length;b++)T+="\\x"+((w=m.charCodeAt(b))<16?"0":"")+w.toString(16).toUpperCase();return T},i.delay=function(m,w,b){setImmediate(function(){m.apply(b||null,w||[])})},i.inherits=function(m,w){function b(){}b.prototype=w.prototype,m.prototype=new b},i.extend=function(){var m,w,b={};for(m=0;m<arguments.length;m++)for(w in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],w)&&b[w]===void 0&&(b[w]=arguments[m][w]);return b},i.prepareContent=function(m,w,b,T,A){return c.Promise.resolve(w).then(function(v){return s.blob&&(v instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(v))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,S){var R=new FileReader;R.onload=function(U){C(U.target.result)},R.onerror=function(U){S(U.target.error)},R.readAsArrayBuffer(v)}):v}).then(function(v){var C=i.getTypeOf(v);return C?(C==="arraybuffer"?v=i.transformTo("uint8array",v):C==="string"&&(A?v=o.decode(v):b&&T!==!0&&(v=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(v))),v):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(w){for(var b in u)if(Object.prototype.hasOwnProperty.call(u,b)&&u[b].magic===w)return u[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,w,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)p=h.readInt(2),m=h.readInt(2),w=h.readData(m),this.extraFields[p]={id:p,length:m,value:w};h.setIndex(b)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var b=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,w){this.name=p,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=m,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,w="string";try{if(!p)throw new Error("No output type specified.");var b=(w=p.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),m=this._decompressWorker();var T=!this._dataBinary;T&&!b&&(m=m.pipe(new c.Utf8EncodeWorker)),!T&&b&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(A){(m=new u("error")).error(A)}return new o(m,w,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(w,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,w;a=!0;for(var b=h.length;b;){for(w=h,h=[],m=-1;++m<b;)w[m]();b=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Cn<"u"?Cn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,b!==o&&m(this,b)}function d(b,T,A){this.promise=b,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function h(b,T,A){s(function(){var v;try{v=T(A)}catch(C){return a.reject(b,C)}v===b?a.reject(b,new TypeError("Cannot resolve promise with itself")):a.resolve(b,v)})}function p(b){var T=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof T=="function")return function(){T.apply(b,arguments)}}function m(b,T){var A=!1;function v(R){A||(A=!0,a.reject(b,R))}function C(R){A||(A=!0,a.resolve(b,R))}var S=w(function(){T(C,v)});S.status==="error"&&v(S.value)}function w(b,T){var A={};try{A.value=b(T),A.status="success"}catch(v){A.status="error",A.value=v}return A}(r.exports=f).prototype.finally=function(b){if(typeof b!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(b()).then(function(){return A})},function(A){return T.resolve(b()).then(function(){throw A})})},f.prototype.catch=function(b){return this.then(null,b)},f.prototype.then=function(b,T){if(typeof b!="function"&&this.state===l||typeof T!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?h(A,this.state===l?b:T,this.outcome):this.queue.push(new d(A,b,T)),A},d.prototype.callFulfilled=function(b){a.resolve(this.promise,b)},d.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},d.prototype.callRejected=function(b){a.reject(this.promise,b)},d.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},a.resolve=function(b,T){var A=w(p,T);if(A.status==="error")return a.reject(b,A.value);var v=A.value;if(v)m(b,v);else{b.state=l,b.outcome=T;for(var C=-1,S=b.queue.length;++C<S;)b.queue[C].callFulfilled(T)}return b},a.reject=function(b,T){b.state=c,b.outcome=T;for(var A=-1,v=b.queue.length;++A<v;)b.queue[A].callRejected(T);return b},f.resolve=function(b){return b instanceof this?b:a.resolve(new this(o),b)},f.reject=function(b){var T=new this(o);return a.reject(T,b)},f.all=function(b){var T=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=b.length,v=!1;if(!A)return this.resolve([]);for(var C=new Array(A),S=0,R=-1,U=new this(o);++R<A;)O(b[R],R);return U;function O(D,V){T.resolve(D).then(function(L){C[V]=L,++S!==A||v||(v=!0,a.resolve(U,C))},function(L){v||(v=!0,a.reject(U,L))})}},f.race=function(b){var T=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=b.length,v=!1;if(!A)return this.resolve([]);for(var C=-1,S=new this(o);++C<A;)R=b[C],T.resolve(R).then(function(U){v||(v=!0,a.resolve(S,U))},function(U){v||(v=!0,a.reject(S,U))});var R;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(b){if(!(this instanceof m))return new m(b);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==f)throw new Error(c[A]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var v;if(v=typeof T.dictionary=="string"?a.string2buf(T.dictionary):u.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=s.deflateSetDictionary(this.strm,v))!==f)throw new Error(c[A]);this._dict_set=!0}}function w(b,T){var A=new m(T);if(A.push(b,!0),A.err)throw A.msg||c[A.err];return A.result}m.prototype.push=function(b,T){var A,v,C=this.strm,S=this.options.chunkSize;if(this.ended)return!1;v=T===~~T?T:T===!0?4:0,typeof b=="string"?C.input=a.string2buf(b):u.call(b)==="[object ArrayBuffer]"?C.input=new Uint8Array(b):C.input=b,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(S),C.next_out=0,C.avail_out=S),(A=s.deflate(C,v))!==1&&A!==f)return this.onEnd(A),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||v!==4&&v!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&A!==1);return v===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===f):v!==2||(this.onEnd(f),!(C.avail_out=0))},m.prototype.onData=function(b){this.chunks.push(b)},m.prototype.onEnd=function(b){b===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=m,i.deflate=w,i.deflateRaw=function(b,T){return(T=T||{}).raw=!0,w(b,T)},i.gzip=function(b,T){return(T=T||{}).gzip=!0,w(b,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||m&&m.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var b=s.inflateInit2(this.strm,w.windowBits);if(b!==c.Z_OK)throw new Error(l[b]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function p(m,w){var b=new h(w);if(b.push(m,!0),b.err)throw b.msg||l[b.err];return b.result}h.prototype.push=function(m,w){var b,T,A,v,C,S,R=this.strm,U=this.options.chunkSize,O=this.options.dictionary,D=!1;if(this.ended)return!1;T=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?R.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?R.input=new Uint8Array(m):R.input=m,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8(U),R.next_out=0,R.avail_out=U),(b=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&O&&(S=typeof O=="string"?a.string2buf(O):d.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,b=s.inflateSetDictionary(this.strm,S)),b===c.Z_BUF_ERROR&&D===!0&&(b=c.Z_OK,D=!1),b!==c.Z_STREAM_END&&b!==c.Z_OK)return this.onEnd(b),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&b!==c.Z_STREAM_END&&(R.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(R.output,R.next_out),v=R.next_out-A,C=a.buf2string(R.output,A),R.next_out=v,R.avail_out=U-v,v&&o.arraySet(R.output,R.output,A,v,0),this.onData(C)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(D=!0)}while((0<R.avail_in||R.avail_out===0)&&b!==c.Z_STREAM_END);return b===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(b=s.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,w){return(w=w||{}).raw=!0,p(m,w)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,p;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(p=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],p.set(h,d),d+=h.length;return p}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,p,m,w,b=f.length,T=0;for(m=0;m<b;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),T+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(T),m=w=0;w<T;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[w++]=h:(h<2048?d[w++]=192|h>>>6:(h<65536?d[w++]=224|h>>>12:(d[w++]=240|h>>>18,d[w++]=128|h>>>12&63),d[w++]=128|h>>>6&63),d[w++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,p,m,w,b=d||f.length,T=new Array(2*b);for(h=p=0;h<b;)if((m=f[h++])<128)T[p++]=m;else if(4<(w=c[m]))T[p++]=65533,h+=w-1;else{for(m&=w===2?31:w===3?15:7;1<w&&h<b;)m=m<<6|63&f[h++],w--;1<w?T[p++]=65533:m<65536?T[p++]=m:(m-=65536,T[p++]=55296|m>>10&1023,T[p++]=56320|1023&m)}return u(T,p)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,p=-2,m=-1,w=4,b=2,T=8,A=9,v=286,C=30,S=19,R=2*v+1,U=15,O=3,D=258,V=D+O+1,L=42,N=113,E=1,B=2,Q=3,j=4;function st(k,ot){return k.msg=u[ot],ot}function et(k){return(k<<1)-(4<k?9:0)}function ft(k){for(var ot=k.length;0<=--ot;)k[ot]=0}function Z(k){var ot=k.state,nt=ot.pending;nt>k.avail_out&&(nt=k.avail_out),nt!==0&&(o.arraySet(k.output,ot.pending_buf,ot.pending_out,nt,k.next_out),k.next_out+=nt,ot.pending_out+=nt,k.total_out+=nt,k.avail_out-=nt,ot.pending-=nt,ot.pending===0&&(ot.pending_out=0))}function H(k,ot){a._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,ot),k.block_start=k.strstart,Z(k.strm)}function wt(k,ot){k.pending_buf[k.pending++]=ot}function at(k,ot){k.pending_buf[k.pending++]=ot>>>8&255,k.pending_buf[k.pending++]=255&ot}function lt(k,ot){var nt,P,F=k.max_chain_length,Y=k.strstart,ct=k.prev_length,ht=k.nice_match,J=k.strstart>k.w_size-V?k.strstart-(k.w_size-V):0,mt=k.window,bt=k.w_mask,dt=k.prev,At=k.strstart+D,he=mt[Y+ct-1],Pt=mt[Y+ct];k.prev_length>=k.good_match&&(F>>=2),ht>k.lookahead&&(ht=k.lookahead);do if(mt[(nt=ot)+ct]===Pt&&mt[nt+ct-1]===he&&mt[nt]===mt[Y]&&mt[++nt]===mt[Y+1]){Y+=2,nt++;do;while(mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&mt[++Y]===mt[++nt]&&Y<At);if(P=D-(At-Y),Y=At-D,ct<P){if(k.match_start=ot,ht<=(ct=P))break;he=mt[Y+ct-1],Pt=mt[Y+ct]}}while((ot=dt[ot&bt])>J&&--F!=0);return ct<=k.lookahead?ct:k.lookahead}function Mt(k){var ot,nt,P,F,Y,ct,ht,J,mt,bt,dt=k.w_size;do{if(F=k.window_size-k.lookahead-k.strstart,k.strstart>=dt+(dt-V)){for(o.arraySet(k.window,k.window,dt,dt,0),k.match_start-=dt,k.strstart-=dt,k.block_start-=dt,ot=nt=k.hash_size;P=k.head[--ot],k.head[ot]=dt<=P?P-dt:0,--nt;);for(ot=nt=dt;P=k.prev[--ot],k.prev[ot]=dt<=P?P-dt:0,--nt;);F+=dt}if(k.strm.avail_in===0)break;if(ct=k.strm,ht=k.window,J=k.strstart+k.lookahead,mt=F,bt=void 0,bt=ct.avail_in,mt<bt&&(bt=mt),nt=bt===0?0:(ct.avail_in-=bt,o.arraySet(ht,ct.input,ct.next_in,bt,J),ct.state.wrap===1?ct.adler=c(ct.adler,ht,bt,J):ct.state.wrap===2&&(ct.adler=l(ct.adler,ht,bt,J)),ct.next_in+=bt,ct.total_in+=bt,bt),k.lookahead+=nt,k.lookahead+k.insert>=O)for(Y=k.strstart-k.insert,k.ins_h=k.window[Y],k.ins_h=(k.ins_h<<k.hash_shift^k.window[Y+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[Y+O-1])&k.hash_mask,k.prev[Y&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=Y,Y++,k.insert--,!(k.lookahead+k.insert<O)););}while(k.lookahead<V&&k.strm.avail_in!==0)}function Zt(k,ot){for(var nt,P;;){if(k.lookahead<V){if(Mt(k),k.lookahead<V&&ot===f)return E;if(k.lookahead===0)break}if(nt=0,k.lookahead>=O&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+O-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),nt!==0&&k.strstart-nt<=k.w_size-V&&(k.match_length=lt(k,nt)),k.match_length>=O)if(P=a._tr_tally(k,k.strstart-k.match_start,k.match_length-O),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=O){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+O-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else P=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(P&&(H(k,!1),k.strm.avail_out===0))return E}return k.insert=k.strstart<O-1?k.strstart:O-1,ot===d?(H(k,!0),k.strm.avail_out===0?Q:j):k.last_lit&&(H(k,!1),k.strm.avail_out===0)?E:B}function Ut(k,ot){for(var nt,P,F;;){if(k.lookahead<V){if(Mt(k),k.lookahead<V&&ot===f)return E;if(k.lookahead===0)break}if(nt=0,k.lookahead>=O&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+O-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=O-1,nt!==0&&k.prev_length<k.max_lazy_match&&k.strstart-nt<=k.w_size-V&&(k.match_length=lt(k,nt),k.match_length<=5&&(k.strategy===1||k.match_length===O&&4096<k.strstart-k.match_start)&&(k.match_length=O-1)),k.prev_length>=O&&k.match_length<=k.prev_length){for(F=k.strstart+k.lookahead-O,P=a._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-O),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=F&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+O-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=O-1,k.strstart++,P&&(H(k,!1),k.strm.avail_out===0))return E}else if(k.match_available){if((P=a._tr_tally(k,0,k.window[k.strstart-1]))&&H(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return E}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(P=a._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<O-1?k.strstart:O-1,ot===d?(H(k,!0),k.strm.avail_out===0?Q:j):k.last_lit&&(H(k,!1),k.strm.avail_out===0)?E:B}function Tt(k,ot,nt,P,F){this.good_length=k,this.max_lazy=ot,this.nice_length=nt,this.max_chain=P,this.func=F}function Dt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(U+1),this.heap=new o.Buf16(2*v+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*v+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ft(k){var ot;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=b,(ot=k.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?L:N,k.adler=ot.wrap===2?0:1,ot.last_flush=f,a._tr_init(ot),h):st(k,p)}function Re(k){var ot=Ft(k);return ot===h&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,nt.ins_h=0}(k.state),ot}function Be(k,ot,nt,P,F,Y){if(!k)return p;var ct=1;if(ot===m&&(ot=6),P<0?(ct=0,P=-P):15<P&&(ct=2,P-=16),F<1||A<F||nt!==T||P<8||15<P||ot<0||9<ot||Y<0||w<Y)return st(k,p);P===8&&(P=9);var ht=new Dt;return(k.state=ht).strm=k,ht.wrap=ct,ht.gzhead=null,ht.w_bits=P,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=F+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+O-1)/O),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<F+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=ot,ht.strategy=Y,ht.method=nt,Re(k)}s=[new Tt(0,0,0,0,function(k,ot){var nt=65535;for(nt>k.pending_buf_size-5&&(nt=k.pending_buf_size-5);;){if(k.lookahead<=1){if(Mt(k),k.lookahead===0&&ot===f)return E;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var P=k.block_start+nt;if((k.strstart===0||k.strstart>=P)&&(k.lookahead=k.strstart-P,k.strstart=P,H(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-V&&(H(k,!1),k.strm.avail_out===0))return E}return k.insert=0,ot===d?(H(k,!0),k.strm.avail_out===0?Q:j):(k.strstart>k.block_start&&(H(k,!1),k.strm.avail_out),E)}),new Tt(4,4,8,4,Zt),new Tt(4,5,16,8,Zt),new Tt(4,6,32,32,Zt),new Tt(4,4,16,16,Ut),new Tt(8,16,32,32,Ut),new Tt(8,16,128,128,Ut),new Tt(8,32,128,256,Ut),new Tt(32,128,258,1024,Ut),new Tt(32,258,258,4096,Ut)],i.deflateInit=function(k,ot){return Be(k,ot,T,15,8,0)},i.deflateInit2=Be,i.deflateReset=Re,i.deflateResetKeep=Ft,i.deflateSetHeader=function(k,ot){return k&&k.state?k.state.wrap!==2?p:(k.state.gzhead=ot,h):p},i.deflate=function(k,ot){var nt,P,F,Y;if(!k||!k.state||5<ot||ot<0)return k?st(k,p):p;if(P=k.state,!k.output||!k.input&&k.avail_in!==0||P.status===666&&ot!==d)return st(k,k.avail_out===0?-5:p);if(P.strm=k,nt=P.last_flush,P.last_flush=ot,P.status===L)if(P.wrap===2)k.adler=0,wt(P,31),wt(P,139),wt(P,8),P.gzhead?(wt(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),wt(P,255&P.gzhead.time),wt(P,P.gzhead.time>>8&255),wt(P,P.gzhead.time>>16&255),wt(P,P.gzhead.time>>24&255),wt(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),wt(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(wt(P,255&P.gzhead.extra.length),wt(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(k.adler=l(k.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(wt(P,0),wt(P,0),wt(P,0),wt(P,0),wt(P,0),wt(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),wt(P,3),P.status=N);else{var ct=T+(P.w_bits-8<<4)<<8;ct|=(2<=P.strategy||P.level<2?0:P.level<6?1:P.level===6?2:3)<<6,P.strstart!==0&&(ct|=32),ct+=31-ct%31,P.status=N,at(P,ct),P.strstart!==0&&(at(P,k.adler>>>16),at(P,65535&k.adler)),k.adler=1}if(P.status===69)if(P.gzhead.extra){for(F=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>F&&(k.adler=l(k.adler,P.pending_buf,P.pending-F,F)),Z(k),F=P.pending,P.pending!==P.pending_buf_size));)wt(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>F&&(k.adler=l(k.adler,P.pending_buf,P.pending-F,F)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(P.status===73)if(P.gzhead.name){F=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>F&&(k.adler=l(k.adler,P.pending_buf,P.pending-F,F)),Z(k),F=P.pending,P.pending===P.pending_buf_size)){Y=1;break}Y=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,wt(P,Y)}while(Y!==0);P.gzhead.hcrc&&P.pending>F&&(k.adler=l(k.adler,P.pending_buf,P.pending-F,F)),Y===0&&(P.gzindex=0,P.status=91)}else P.status=91;if(P.status===91)if(P.gzhead.comment){F=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>F&&(k.adler=l(k.adler,P.pending_buf,P.pending-F,F)),Z(k),F=P.pending,P.pending===P.pending_buf_size)){Y=1;break}Y=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,wt(P,Y)}while(Y!==0);P.gzhead.hcrc&&P.pending>F&&(k.adler=l(k.adler,P.pending_buf,P.pending-F,F)),Y===0&&(P.status=103)}else P.status=103;if(P.status===103&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&Z(k),P.pending+2<=P.pending_buf_size&&(wt(P,255&k.adler),wt(P,k.adler>>8&255),k.adler=0,P.status=N)):P.status=N),P.pending!==0){if(Z(k),k.avail_out===0)return P.last_flush=-1,h}else if(k.avail_in===0&&et(ot)<=et(nt)&&ot!==d)return st(k,-5);if(P.status===666&&k.avail_in!==0)return st(k,-5);if(k.avail_in!==0||P.lookahead!==0||ot!==f&&P.status!==666){var ht=P.strategy===2?function(J,mt){for(var bt;;){if(J.lookahead===0&&(Mt(J),J.lookahead===0)){if(mt===f)return E;break}if(J.match_length=0,bt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,bt&&(H(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===d?(H(J,!0),J.strm.avail_out===0?Q:j):J.last_lit&&(H(J,!1),J.strm.avail_out===0)?E:B}(P,ot):P.strategy===3?function(J,mt){for(var bt,dt,At,he,Pt=J.window;;){if(J.lookahead<=D){if(Mt(J),J.lookahead<=D&&mt===f)return E;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=O&&0<J.strstart&&(dt=Pt[At=J.strstart-1])===Pt[++At]&&dt===Pt[++At]&&dt===Pt[++At]){he=J.strstart+D;do;while(dt===Pt[++At]&&dt===Pt[++At]&&dt===Pt[++At]&&dt===Pt[++At]&&dt===Pt[++At]&&dt===Pt[++At]&&dt===Pt[++At]&&dt===Pt[++At]&&At<he);J.match_length=D-(he-At),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=O?(bt=a._tr_tally(J,1,J.match_length-O),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(bt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),bt&&(H(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===d?(H(J,!0),J.strm.avail_out===0?Q:j):J.last_lit&&(H(J,!1),J.strm.avail_out===0)?E:B}(P,ot):s[P.level].func(P,ot);if(ht!==Q&&ht!==j||(P.status=666),ht===E||ht===Q)return k.avail_out===0&&(P.last_flush=-1),h;if(ht===B&&(ot===1?a._tr_align(P):ot!==5&&(a._tr_stored_block(P,0,0,!1),ot===3&&(ft(P.head),P.lookahead===0&&(P.strstart=0,P.block_start=0,P.insert=0))),Z(k),k.avail_out===0))return P.last_flush=-1,h}return ot!==d?h:P.wrap<=0?1:(P.wrap===2?(wt(P,255&k.adler),wt(P,k.adler>>8&255),wt(P,k.adler>>16&255),wt(P,k.adler>>24&255),wt(P,255&k.total_in),wt(P,k.total_in>>8&255),wt(P,k.total_in>>16&255),wt(P,k.total_in>>24&255)):(at(P,k.adler>>>16),at(P,65535&k.adler)),Z(k),0<P.wrap&&(P.wrap=-P.wrap),P.pending!==0?h:1)},i.deflateEnd=function(k){var ot;return k&&k.state?(ot=k.state.status)!==L&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==N&&ot!==666?st(k,p):(k.state=null,ot===N?st(k,-3):h):p},i.deflateSetDictionary=function(k,ot){var nt,P,F,Y,ct,ht,J,mt,bt=ot.length;if(!k||!k.state||(Y=(nt=k.state).wrap)===2||Y===1&&nt.status!==L||nt.lookahead)return p;for(Y===1&&(k.adler=c(k.adler,ot,bt,0)),nt.wrap=0,bt>=nt.w_size&&(Y===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),mt=new o.Buf8(nt.w_size),o.arraySet(mt,ot,bt-nt.w_size,nt.w_size,0),ot=mt,bt=nt.w_size),ct=k.avail_in,ht=k.next_in,J=k.input,k.avail_in=bt,k.next_in=0,k.input=ot,Mt(nt);nt.lookahead>=O;){for(P=nt.strstart,F=nt.lookahead-(O-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[P+O-1])&nt.hash_mask,nt.prev[P&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=P,P++,--F;);nt.strstart=P,nt.lookahead=O-1,Mt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,k.next_in=ht,k.input=J,k.avail_in=ct,nt.wrap=Y,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,p,m,w,b,T,A,v,C,S,R,U,O,D,V,L,N,E,B;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,B=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,w=a.wnext,b=a.window,T=a.hold,A=a.bits,v=a.lencode,C=a.distcode,S=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;t:do{A<15&&(T+=E[c++]<<A,A+=8,T+=E[c++]<<A,A+=8),U=v[T&S];e:for(;;){if(T>>>=O=U>>>24,A-=O,(O=U>>>16&255)===0)B[u++]=65535&U;else{if(!(16&O)){if(!(64&O)){U=v[(65535&U)+(T&(1<<O)-1)];continue e}if(32&O){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}D=65535&U,(O&=15)&&(A<O&&(T+=E[c++]<<A,A+=8),D+=T&(1<<O)-1,T>>>=O,A-=O),A<15&&(T+=E[c++]<<A,A+=8,T+=E[c++]<<A,A+=8),U=C[T&R];n:for(;;){if(T>>>=O=U>>>24,A-=O,!(16&(O=U>>>16&255))){if(!(64&O)){U=C[(65535&U)+(T&(1<<O)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(V=65535&U,A<(O&=15)&&(T+=E[c++]<<A,(A+=8)<O&&(T+=E[c++]<<A,A+=8)),h<(V+=T&(1<<O)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=O,A-=O,(O=u-f)<V){if(m<(O=V-O)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(N=b,(L=0)===w){if(L+=p-O,O<D){for(D-=O;B[u++]=b[L++],--O;);L=u-V,N=B}}else if(w<O){if(L+=p+w-O,(O-=w)<D){for(D-=O;B[u++]=b[L++],--O;);if(L=0,w<D){for(D-=O=w;B[u++]=b[L++],--O;);L=u-V,N=B}}}else if(L+=w-O,O<D){for(D-=O;B[u++]=b[L++],--O;);L=u-V,N=B}for(;2<D;)B[u++]=N[L++],B[u++]=N[L++],B[u++]=N[L++],D-=3;D&&(B[u++]=N[L++],1<D&&(B[u++]=N[L++]))}else{for(L=u-V;B[u++]=B[L++],B[u++]=B[L++],B[u++]=B[L++],2<(D-=3););D&&(B[u++]=B[L++],1<D&&(B[u++]=B[L++]))}break}}break}}while(c<l&&u<d);c-=D=A>>3,T&=(1<<(A-=D<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=T,a.bits=A}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,p=1,m=852,w=592;function b(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(L){var N;return L&&L.state?(N=L.state,L.total_in=L.total_out=N.total=0,L.msg="",N.wrap&&(L.adler=1&N.wrap),N.mode=p,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new s.Buf32(m),N.distcode=N.distdyn=new s.Buf32(w),N.sane=1,N.back=-1,d):h}function v(L){var N;return L&&L.state?((N=L.state).wsize=0,N.whave=0,N.wnext=0,A(L)):h}function C(L,N){var E,B;return L&&L.state?(B=L.state,N<0?(E=0,N=-N):(E=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?h:(B.window!==null&&B.wbits!==N&&(B.window=null),B.wrap=E,B.wbits=N,v(L))):h}function S(L,N){var E,B;return L?(B=new T,(L.state=B).window=null,(E=C(L,N))!==d&&(L.state=null),E):h}var R,U,O=!0;function D(L){if(O){var N;for(R=new s.Buf32(512),U=new s.Buf32(32),N=0;N<144;)L.lens[N++]=8;for(;N<256;)L.lens[N++]=9;for(;N<280;)L.lens[N++]=7;for(;N<288;)L.lens[N++]=8;for(l(u,L.lens,0,288,R,0,L.work,{bits:9}),N=0;N<32;)L.lens[N++]=5;l(f,L.lens,0,32,U,0,L.work,{bits:5}),O=!1}L.lencode=R,L.lenbits=9,L.distcode=U,L.distbits=5}function V(L,N,E,B){var Q,j=L.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),B>=j.wsize?(s.arraySet(j.window,N,E-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(B<(Q=j.wsize-j.wnext)&&(Q=B),s.arraySet(j.window,N,E-B,Q,j.wnext),(B-=Q)?(s.arraySet(j.window,N,E-B,B,0),j.wnext=B,j.whave=j.wsize):(j.wnext+=Q,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=Q))),0}i.inflateReset=v,i.inflateReset2=C,i.inflateResetKeep=A,i.inflateInit=function(L){return S(L,15)},i.inflateInit2=S,i.inflate=function(L,N){var E,B,Q,j,st,et,ft,Z,H,wt,at,lt,Mt,Zt,Ut,Tt,Dt,Ft,Re,Be,k,ot,nt,P,F=0,Y=new s.Buf8(4),ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(E=L.state).mode===12&&(E.mode=13),st=L.next_out,Q=L.output,ft=L.avail_out,j=L.next_in,B=L.input,et=L.avail_in,Z=E.hold,H=E.bits,wt=et,at=ft,ot=d;t:for(;;)switch(E.mode){case p:if(E.wrap===0){E.mode=13;break}for(;H<16;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(2&E.wrap&&Z===35615){Y[E.check=0]=255&Z,Y[1]=Z>>>8&255,E.check=a(E.check,Y,2,0),H=Z=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&Z)<<8)+(Z>>8))%31){L.msg="incorrect header check",E.mode=30;break}if((15&Z)!=8){L.msg="unknown compression method",E.mode=30;break}if(H-=4,k=8+(15&(Z>>>=4)),E.wbits===0)E.wbits=k;else if(k>E.wbits){L.msg="invalid window size",E.mode=30;break}E.dmax=1<<k,L.adler=E.check=1,E.mode=512&Z?10:12,H=Z=0;break;case 2:for(;H<16;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(E.flags=Z,(255&E.flags)!=8){L.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){L.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=Z>>8&1),512&E.flags&&(Y[0]=255&Z,Y[1]=Z>>>8&255,E.check=a(E.check,Y,2,0)),H=Z=0,E.mode=3;case 3:for(;H<32;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}E.head&&(E.head.time=Z),512&E.flags&&(Y[0]=255&Z,Y[1]=Z>>>8&255,Y[2]=Z>>>16&255,Y[3]=Z>>>24&255,E.check=a(E.check,Y,4,0)),H=Z=0,E.mode=4;case 4:for(;H<16;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}E.head&&(E.head.xflags=255&Z,E.head.os=Z>>8),512&E.flags&&(Y[0]=255&Z,Y[1]=Z>>>8&255,E.check=a(E.check,Y,2,0)),H=Z=0,E.mode=5;case 5:if(1024&E.flags){for(;H<16;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}E.length=Z,E.head&&(E.head.extra_len=Z),512&E.flags&&(Y[0]=255&Z,Y[1]=Z>>>8&255,E.check=a(E.check,Y,2,0)),H=Z=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(et<(lt=E.length)&&(lt=et),lt&&(E.head&&(k=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,B,j,lt,k)),512&E.flags&&(E.check=a(E.check,B,lt,j)),et-=lt,j+=lt,E.length-=lt),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(et===0)break t;for(lt=0;k=B[j+lt++],E.head&&k&&E.length<65536&&(E.head.name+=String.fromCharCode(k)),k&&lt<et;);if(512&E.flags&&(E.check=a(E.check,B,lt,j)),et-=lt,j+=lt,k)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(et===0)break t;for(lt=0;k=B[j+lt++],E.head&&k&&E.length<65536&&(E.head.comment+=String.fromCharCode(k)),k&&lt<et;);if(512&E.flags&&(E.check=a(E.check,B,lt,j)),et-=lt,j+=lt,k)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;H<16;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(Z!==(65535&E.check)){L.msg="header crc mismatch",E.mode=30;break}H=Z=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),L.adler=E.check=0,E.mode=12;break;case 10:for(;H<32;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}L.adler=E.check=b(Z),H=Z=0,E.mode=11;case 11:if(E.havedict===0)return L.next_out=st,L.avail_out=ft,L.next_in=j,L.avail_in=et,E.hold=Z,E.bits=H,2;L.adler=E.check=1,E.mode=12;case 12:if(N===5||N===6)break t;case 13:if(E.last){Z>>>=7&H,H-=7&H,E.mode=27;break}for(;H<3;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}switch(E.last=1&Z,H-=1,3&(Z>>>=1)){case 0:E.mode=14;break;case 1:if(D(E),E.mode=20,N!==6)break;Z>>>=2,H-=2;break t;case 2:E.mode=17;break;case 3:L.msg="invalid block type",E.mode=30}Z>>>=2,H-=2;break;case 14:for(Z>>>=7&H,H-=7&H;H<32;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if((65535&Z)!=(Z>>>16^65535)){L.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&Z,H=Z=0,E.mode=15,N===6)break t;case 15:E.mode=16;case 16:if(lt=E.length){if(et<lt&&(lt=et),ft<lt&&(lt=ft),lt===0)break t;s.arraySet(Q,B,j,lt,st),et-=lt,j+=lt,ft-=lt,st+=lt,E.length-=lt;break}E.mode=12;break;case 17:for(;H<14;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(E.nlen=257+(31&Z),Z>>>=5,H-=5,E.ndist=1+(31&Z),Z>>>=5,H-=5,E.ncode=4+(15&Z),Z>>>=4,H-=4,286<E.nlen||30<E.ndist){L.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;H<3;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}E.lens[ct[E.have++]]=7&Z,Z>>>=3,H-=3}for(;E.have<19;)E.lens[ct[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,nt={bits:E.lenbits},ot=l(0,E.lens,0,19,E.lencode,0,E.work,nt),E.lenbits=nt.bits,ot){L.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Tt=(F=E.lencode[Z&(1<<E.lenbits)-1])>>>16&255,Dt=65535&F,!((Ut=F>>>24)<=H);){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(Dt<16)Z>>>=Ut,H-=Ut,E.lens[E.have++]=Dt;else{if(Dt===16){for(P=Ut+2;H<P;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(Z>>>=Ut,H-=Ut,E.have===0){L.msg="invalid bit length repeat",E.mode=30;break}k=E.lens[E.have-1],lt=3+(3&Z),Z>>>=2,H-=2}else if(Dt===17){for(P=Ut+3;H<P;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}H-=Ut,k=0,lt=3+(7&(Z>>>=Ut)),Z>>>=3,H-=3}else{for(P=Ut+7;H<P;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}H-=Ut,k=0,lt=11+(127&(Z>>>=Ut)),Z>>>=7,H-=7}if(E.have+lt>E.nlen+E.ndist){L.msg="invalid bit length repeat",E.mode=30;break}for(;lt--;)E.lens[E.have++]=k}}if(E.mode===30)break;if(E.lens[256]===0){L.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,nt={bits:E.lenbits},ot=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,nt),E.lenbits=nt.bits,ot){L.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,nt={bits:E.distbits},ot=l(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,nt),E.distbits=nt.bits,ot){L.msg="invalid distances set",E.mode=30;break}if(E.mode=20,N===6)break t;case 20:E.mode=21;case 21:if(6<=et&&258<=ft){L.next_out=st,L.avail_out=ft,L.next_in=j,L.avail_in=et,E.hold=Z,E.bits=H,c(L,at),st=L.next_out,Q=L.output,ft=L.avail_out,j=L.next_in,B=L.input,et=L.avail_in,Z=E.hold,H=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Tt=(F=E.lencode[Z&(1<<E.lenbits)-1])>>>16&255,Dt=65535&F,!((Ut=F>>>24)<=H);){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(Tt&&!(240&Tt)){for(Ft=Ut,Re=Tt,Be=Dt;Tt=(F=E.lencode[Be+((Z&(1<<Ft+Re)-1)>>Ft)])>>>16&255,Dt=65535&F,!(Ft+(Ut=F>>>24)<=H);){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}Z>>>=Ft,H-=Ft,E.back+=Ft}if(Z>>>=Ut,H-=Ut,E.back+=Ut,E.length=Dt,Tt===0){E.mode=26;break}if(32&Tt){E.back=-1,E.mode=12;break}if(64&Tt){L.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Tt,E.mode=22;case 22:if(E.extra){for(P=E.extra;H<P;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}E.length+=Z&(1<<E.extra)-1,Z>>>=E.extra,H-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Tt=(F=E.distcode[Z&(1<<E.distbits)-1])>>>16&255,Dt=65535&F,!((Ut=F>>>24)<=H);){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(!(240&Tt)){for(Ft=Ut,Re=Tt,Be=Dt;Tt=(F=E.distcode[Be+((Z&(1<<Ft+Re)-1)>>Ft)])>>>16&255,Dt=65535&F,!(Ft+(Ut=F>>>24)<=H);){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}Z>>>=Ft,H-=Ft,E.back+=Ft}if(Z>>>=Ut,H-=Ut,E.back+=Ut,64&Tt){L.msg="invalid distance code",E.mode=30;break}E.offset=Dt,E.extra=15&Tt,E.mode=24;case 24:if(E.extra){for(P=E.extra;H<P;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}E.offset+=Z&(1<<E.extra)-1,Z>>>=E.extra,H-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){L.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(ft===0)break t;if(lt=at-ft,E.offset>lt){if((lt=E.offset-lt)>E.whave&&E.sane){L.msg="invalid distance too far back",E.mode=30;break}Mt=lt>E.wnext?(lt-=E.wnext,E.wsize-lt):E.wnext-lt,lt>E.length&&(lt=E.length),Zt=E.window}else Zt=Q,Mt=st-E.offset,lt=E.length;for(ft<lt&&(lt=ft),ft-=lt,E.length-=lt;Q[st++]=Zt[Mt++],--lt;);E.length===0&&(E.mode=21);break;case 26:if(ft===0)break t;Q[st++]=E.length,ft--,E.mode=21;break;case 27:if(E.wrap){for(;H<32;){if(et===0)break t;et--,Z|=B[j++]<<H,H+=8}if(at-=ft,L.total_out+=at,E.total+=at,at&&(L.adler=E.check=E.flags?a(E.check,Q,at,st-at):o(E.check,Q,at,st-at)),at=ft,(E.flags?Z:b(Z))!==E.check){L.msg="incorrect data check",E.mode=30;break}H=Z=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;H<32;){if(et===0)break t;et--,Z+=B[j++]<<H,H+=8}if(Z!==(4294967295&E.total)){L.msg="incorrect length check",E.mode=30;break}H=Z=0}E.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=st,L.avail_out=ft,L.next_in=j,L.avail_in=et,E.hold=Z,E.bits=H,(E.wsize||at!==L.avail_out&&E.mode<30&&(E.mode<27||N!==4))&&V(L,L.output,L.next_out,at-L.avail_out)?(E.mode=31,-4):(wt-=L.avail_in,at-=L.avail_out,L.total_in+=wt,L.total_out+=at,E.total+=at,E.wrap&&at&&(L.adler=E.check=E.flags?a(E.check,Q,at,L.next_out-at):o(E.check,Q,at,L.next_out-at)),L.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(wt==0&&at===0||N===4)&&ot===d&&(ot=-5),ot)},i.inflateEnd=function(L){if(!L||!L.state)return h;var N=L.state;return N.window&&(N.window=null),L.state=null,d},i.inflateGetHeader=function(L,N){var E;return L&&L.state&&2&(E=L.state).wrap?((E.head=N).done=!1,d):h},i.inflateSetDictionary=function(L,N){var E,B=N.length;return L&&L.state?(E=L.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,N,B,0)!==E.check?-3:V(L,N,B,B)?(E.mode=31,-4):(E.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,p,m,w,b){var T,A,v,C,S,R,U,O,D,V=b.bits,L=0,N=0,E=0,B=0,Q=0,j=0,st=0,et=0,ft=0,Z=0,H=null,wt=0,at=new s.Buf16(16),lt=new s.Buf16(16),Mt=null,Zt=0;for(L=0;L<=15;L++)at[L]=0;for(N=0;N<h;N++)at[f[d+N]]++;for(Q=V,B=15;1<=B&&at[B]===0;B--);if(B<Q&&(Q=B),B===0)return p[m++]=20971520,p[m++]=20971520,b.bits=1,0;for(E=1;E<B&&at[E]===0;E++);for(Q<E&&(Q=E),L=et=1;L<=15;L++)if(et<<=1,(et-=at[L])<0)return-1;if(0<et&&(u===0||B!==1))return-1;for(lt[1]=0,L=1;L<15;L++)lt[L+1]=lt[L]+at[L];for(N=0;N<h;N++)f[d+N]!==0&&(w[lt[f[d+N]]++]=N);if(R=u===0?(H=Mt=w,19):u===1?(H=o,wt-=257,Mt=a,Zt-=257,256):(H=c,Mt=l,-1),L=E,S=m,st=N=Z=0,v=-1,C=(ft=1<<(j=Q))-1,u===1&&852<ft||u===2&&592<ft)return 1;for(;;){for(U=L-st,D=w[N]<R?(O=0,w[N]):w[N]>R?(O=Mt[Zt+w[N]],H[wt+w[N]]):(O=96,0),T=1<<L-st,E=A=1<<j;p[S+(Z>>st)+(A-=T)]=U<<24|O<<16|D|0,A!==0;);for(T=1<<L-1;Z&T;)T>>=1;if(T!==0?(Z&=T-1,Z+=T):Z=0,N++,--at[L]==0){if(L===B)break;L=f[d+w[N]]}if(Q<L&&(Z&C)!==v){for(st===0&&(st=Q),S+=E,et=1<<(j=L-st);j+st<B&&!((et-=at[j+st])<=0);)j++,et<<=1;if(ft+=1<<j,u===1&&852<ft||u===2&&592<ft)return 1;p[v=Z&C]=Q<<24|j<<16|S-m|0}}return Z!==0&&(p[S+Z]=L-st<<24|64<<16|0),b.bits=Q,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var Y=F.length;0<=--Y;)F[Y]=0}var l=0,u=29,f=256,d=f+1+u,h=30,p=19,m=2*d+1,w=15,b=16,T=7,A=256,v=16,C=17,S=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(d+2));c(V);var L=new Array(2*h);c(L);var N=new Array(512);c(N);var E=new Array(256);c(E);var B=new Array(u);c(B);var Q,j,st,et=new Array(h);function ft(F,Y,ct,ht,J){this.static_tree=F,this.extra_bits=Y,this.extra_base=ct,this.elems=ht,this.max_length=J,this.has_stree=F&&F.length}function Z(F,Y){this.dyn_tree=F,this.max_code=0,this.stat_desc=Y}function H(F){return F<256?N[F]:N[256+(F>>>7)]}function wt(F,Y){F.pending_buf[F.pending++]=255&Y,F.pending_buf[F.pending++]=Y>>>8&255}function at(F,Y,ct){F.bi_valid>b-ct?(F.bi_buf|=Y<<F.bi_valid&65535,wt(F,F.bi_buf),F.bi_buf=Y>>b-F.bi_valid,F.bi_valid+=ct-b):(F.bi_buf|=Y<<F.bi_valid&65535,F.bi_valid+=ct)}function lt(F,Y,ct){at(F,ct[2*Y],ct[2*Y+1])}function Mt(F,Y){for(var ct=0;ct|=1&F,F>>>=1,ct<<=1,0<--Y;);return ct>>>1}function Zt(F,Y,ct){var ht,J,mt=new Array(w+1),bt=0;for(ht=1;ht<=w;ht++)mt[ht]=bt=bt+ct[ht-1]<<1;for(J=0;J<=Y;J++){var dt=F[2*J+1];dt!==0&&(F[2*J]=Mt(mt[dt]++,dt))}}function Ut(F){var Y;for(Y=0;Y<d;Y++)F.dyn_ltree[2*Y]=0;for(Y=0;Y<h;Y++)F.dyn_dtree[2*Y]=0;for(Y=0;Y<p;Y++)F.bl_tree[2*Y]=0;F.dyn_ltree[2*A]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Tt(F){8<F.bi_valid?wt(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function Dt(F,Y,ct,ht){var J=2*Y,mt=2*ct;return F[J]<F[mt]||F[J]===F[mt]&&ht[Y]<=ht[ct]}function Ft(F,Y,ct){for(var ht=F.heap[ct],J=ct<<1;J<=F.heap_len&&(J<F.heap_len&&Dt(Y,F.heap[J+1],F.heap[J],F.depth)&&J++,!Dt(Y,ht,F.heap[J],F.depth));)F.heap[ct]=F.heap[J],ct=J,J<<=1;F.heap[ct]=ht}function Re(F,Y,ct){var ht,J,mt,bt,dt=0;if(F.last_lit!==0)for(;ht=F.pending_buf[F.d_buf+2*dt]<<8|F.pending_buf[F.d_buf+2*dt+1],J=F.pending_buf[F.l_buf+dt],dt++,ht===0?lt(F,J,Y):(lt(F,(mt=E[J])+f+1,Y),(bt=R[mt])!==0&&at(F,J-=B[mt],bt),lt(F,mt=H(--ht),ct),(bt=U[mt])!==0&&at(F,ht-=et[mt],bt)),dt<F.last_lit;);lt(F,A,Y)}function Be(F,Y){var ct,ht,J,mt=Y.dyn_tree,bt=Y.stat_desc.static_tree,dt=Y.stat_desc.has_stree,At=Y.stat_desc.elems,he=-1;for(F.heap_len=0,F.heap_max=m,ct=0;ct<At;ct++)mt[2*ct]!==0?(F.heap[++F.heap_len]=he=ct,F.depth[ct]=0):mt[2*ct+1]=0;for(;F.heap_len<2;)mt[2*(J=F.heap[++F.heap_len]=he<2?++he:0)]=1,F.depth[J]=0,F.opt_len--,dt&&(F.static_len-=bt[2*J+1]);for(Y.max_code=he,ct=F.heap_len>>1;1<=ct;ct--)Ft(F,mt,ct);for(J=At;ct=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Ft(F,mt,1),ht=F.heap[1],F.heap[--F.heap_max]=ct,F.heap[--F.heap_max]=ht,mt[2*J]=mt[2*ct]+mt[2*ht],F.depth[J]=(F.depth[ct]>=F.depth[ht]?F.depth[ct]:F.depth[ht])+1,mt[2*ct+1]=mt[2*ht+1]=J,F.heap[1]=J++,Ft(F,mt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(Pt,Kn){var I,g,y,M,z,tt,it=Kn.dyn_tree,Wt=Kn.max_code,Ie=Kn.stat_desc.static_tree,Ee=Kn.stat_desc.has_stree,Ne=Kn.stat_desc.extra_bits,ue=Kn.stat_desc.extra_base,Dc=Kn.stat_desc.max_length,fh=0;for(M=0;M<=w;M++)Pt.bl_count[M]=0;for(it[2*Pt.heap[Pt.heap_max]+1]=0,I=Pt.heap_max+1;I<m;I++)Dc<(M=it[2*it[2*(g=Pt.heap[I])+1]+1]+1)&&(M=Dc,fh++),it[2*g+1]=M,Wt<g||(Pt.bl_count[M]++,z=0,ue<=g&&(z=Ne[g-ue]),tt=it[2*g],Pt.opt_len+=tt*(M+z),Ee&&(Pt.static_len+=tt*(Ie[2*g+1]+z)));if(fh!==0){do{for(M=Dc-1;Pt.bl_count[M]===0;)M--;Pt.bl_count[M]--,Pt.bl_count[M+1]+=2,Pt.bl_count[Dc]--,fh-=2}while(0<fh);for(M=Dc;M!==0;M--)for(g=Pt.bl_count[M];g!==0;)Wt<(y=Pt.heap[--I])||(it[2*y+1]!==M&&(Pt.opt_len+=(M-it[2*y+1])*it[2*y],it[2*y+1]=M),g--)}}(F,Y),Zt(mt,he,F.bl_count)}function k(F,Y,ct){var ht,J,mt=-1,bt=Y[1],dt=0,At=7,he=4;for(bt===0&&(At=138,he=3),Y[2*(ct+1)+1]=65535,ht=0;ht<=ct;ht++)J=bt,bt=Y[2*(ht+1)+1],++dt<At&&J===bt||(dt<he?F.bl_tree[2*J]+=dt:J!==0?(J!==mt&&F.bl_tree[2*J]++,F.bl_tree[2*v]++):dt<=10?F.bl_tree[2*C]++:F.bl_tree[2*S]++,mt=J,he=(dt=0)===bt?(At=138,3):J===bt?(At=6,3):(At=7,4))}function ot(F,Y,ct){var ht,J,mt=-1,bt=Y[1],dt=0,At=7,he=4;for(bt===0&&(At=138,he=3),ht=0;ht<=ct;ht++)if(J=bt,bt=Y[2*(ht+1)+1],!(++dt<At&&J===bt)){if(dt<he)for(;lt(F,J,F.bl_tree),--dt!=0;);else J!==0?(J!==mt&&(lt(F,J,F.bl_tree),dt--),lt(F,v,F.bl_tree),at(F,dt-3,2)):dt<=10?(lt(F,C,F.bl_tree),at(F,dt-3,3)):(lt(F,S,F.bl_tree),at(F,dt-11,7));mt=J,he=(dt=0)===bt?(At=138,3):J===bt?(At=6,3):(At=7,4)}}c(et);var nt=!1;function P(F,Y,ct,ht){at(F,(l<<1)+(ht?1:0),3),function(J,mt,bt,dt){Tt(J),wt(J,bt),wt(J,~bt),s.arraySet(J.pending_buf,J.window,mt,bt,J.pending),J.pending+=bt}(F,Y,ct)}i._tr_init=function(F){nt||(function(){var Y,ct,ht,J,mt,bt=new Array(w+1);for(J=ht=0;J<u-1;J++)for(B[J]=ht,Y=0;Y<1<<R[J];Y++)E[ht++]=J;for(E[ht-1]=J,J=mt=0;J<16;J++)for(et[J]=mt,Y=0;Y<1<<U[J];Y++)N[mt++]=J;for(mt>>=7;J<h;J++)for(et[J]=mt<<7,Y=0;Y<1<<U[J]-7;Y++)N[256+mt++]=J;for(ct=0;ct<=w;ct++)bt[ct]=0;for(Y=0;Y<=143;)V[2*Y+1]=8,Y++,bt[8]++;for(;Y<=255;)V[2*Y+1]=9,Y++,bt[9]++;for(;Y<=279;)V[2*Y+1]=7,Y++,bt[7]++;for(;Y<=287;)V[2*Y+1]=8,Y++,bt[8]++;for(Zt(V,d+1,bt),Y=0;Y<h;Y++)L[2*Y+1]=5,L[2*Y]=Mt(Y,5);Q=new ft(V,R,f+1,d,w),j=new ft(L,U,0,h,w),st=new ft(new Array(0),O,0,p,T)}(),nt=!0),F.l_desc=new Z(F.dyn_ltree,Q),F.d_desc=new Z(F.dyn_dtree,j),F.bl_desc=new Z(F.bl_tree,st),F.bi_buf=0,F.bi_valid=0,Ut(F)},i._tr_stored_block=P,i._tr_flush_block=function(F,Y,ct,ht){var J,mt,bt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(dt){var At,he=4093624447;for(At=0;At<=31;At++,he>>>=1)if(1&he&&dt.dyn_ltree[2*At]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(At=32;At<f;At++)if(dt.dyn_ltree[2*At]!==0)return a;return o}(F)),Be(F,F.l_desc),Be(F,F.d_desc),bt=function(dt){var At;for(k(dt,dt.dyn_ltree,dt.l_desc.max_code),k(dt,dt.dyn_dtree,dt.d_desc.max_code),Be(dt,dt.bl_desc),At=p-1;3<=At&&dt.bl_tree[2*D[At]+1]===0;At--);return dt.opt_len+=3*(At+1)+5+5+4,At}(F),J=F.opt_len+3+7>>>3,(mt=F.static_len+3+7>>>3)<=J&&(J=mt)):J=mt=ct+5,ct+4<=J&&Y!==-1?P(F,Y,ct,ht):F.strategy===4||mt===J?(at(F,2+(ht?1:0),3),Re(F,V,L)):(at(F,4+(ht?1:0),3),function(dt,At,he,Pt){var Kn;for(at(dt,At-257,5),at(dt,he-1,5),at(dt,Pt-4,4),Kn=0;Kn<Pt;Kn++)at(dt,dt.bl_tree[2*D[Kn]+1],3);ot(dt,dt.dyn_ltree,At-1),ot(dt,dt.dyn_dtree,he-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,bt+1),Re(F,F.dyn_ltree,F.dyn_dtree)),Ut(F),ht&&Tt(F)},i._tr_tally=function(F,Y,ct){return F.pending_buf[F.d_buf+2*F.last_lit]=Y>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&Y,F.pending_buf[F.l_buf+F.last_lit]=255&ct,F.last_lit++,Y===0?F.dyn_ltree[2*ct]++:(F.matches++,Y--,F.dyn_ltree[2*(E[ct]+f+1)]++,F.dyn_dtree[2*H(Y)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){at(F,2,3),lt(F,A,V),function(Y){Y.bi_valid===16?(wt(Y,Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0):8<=Y.bi_valid&&(Y.pending_buf[Y.pending++]=255&Y.bi_buf,Y.bi_buf>>=8,Y.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},p=!1,m=o.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(o);w=w&&w.setTimeout?w:o,c={}.toString.call(o.process)==="[object process]"?function(v){Sr.nextTick(function(){T(v)})}:function(){if(o.postMessage&&!o.importScripts){var v=!0,C=o.onmessage;return o.onmessage=function(){v=!1},o.postMessage("","*"),o.onmessage=C,v}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(v){o.postMessage(f+v,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(v){T(v.data)},function(v){u.port2.postMessage(v)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(v){var C=m.createElement("script");C.onreadystatechange=function(){T(v),C.onreadystatechange=null,l.removeChild(C),C=null},l.appendChild(C)}):function(v){setTimeout(T,0,v)},w.setImmediate=function(v){typeof v!="function"&&(v=new Function(""+v));for(var C=new Array(arguments.length-1),S=0;S<C.length;S++)C[S]=arguments[S+1];var R={callback:v,args:C};return h[d]=R,c(d),d++},w.clearImmediate=b}function b(v){delete h[v]}function T(v){if(p)setTimeout(T,0,v);else{var C=h[v];if(C){p=!0;try{(function(S){var R=S.callback,U=S.args;switch(U.length){case 0:R();break;case 1:R(U[0]);break;case 2:R(U[0],U[1]);break;case 3:R(U[0],U[1],U[2]);break;default:R.apply(a,U)}})(C)}finally{b(v),p=!1}}}}function A(v){v.source===o&&typeof v.data=="string"&&v.data.indexOf(f)===0&&T(+v.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Cn<"u"?Cn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Tx);var DB=Tx.exports,_p=io(DB);const vx={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(vx);var Tr=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},da,Pc,eo;class $B{constructor(...e){da.set(this,new Map),Pc.set(this,new Map),eo.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Tr(this,eo,"f").has(r)||Tr(this,eo,"f").set(r,new Set);const s=Tr(this,eo,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Tr(this,Pc,"f").set(r,a),o=!1,c)continue;const l=Tr(this,da,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Tr(this,da,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Tr(this,da,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&Tr(this,Pc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Tr(this,eo,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Tr(this,eo,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Tr(this,da,"f"),extensions:Tr(this,Pc,"f")}}}da=new WeakMap,Pc=new WeakMap,eo=new WeakMap;var jB=new $B(vx)._freeze();function Ax(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:if(t.endsWith(".xp"))return"application/rexpaint";break}return jB.getType(t)??"application/octet-stream"}async function zB(t,e,n){try{Ei(G,t,e.name);const r=await e.arrayBuffer();(await new _p().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=Ax(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{de(G,t,"crash",c.message)})})}catch(r){de(G,t,"crash",r.message)}}async function Sx(t,e,n){try{Ei(G,e,t.name);const r=await t.arrayBuffer();n(new Uint8Array(r))}catch(r){de(G,e,"crash",r.message)}}function Rx(t,e){function n(r){if(x(e))switch(r){case"text/plain":e.text().then(i=>nl(G,t,void 0,"text",`file:${e.name}`,i)).catch(i=>de(G,t,"crash",i.message));break;case"application/json":e.text().then(i=>nl(G,t,void 0,"json",`file:${e.name}`,i)).catch(i=>de(G,t,"crash",i.message));break;case"application/zip":zB(t,e,i=>Rx(t,i)).catch(i=>de(G,t,"crash",i.message));break;case"application/rexpaint":Sx(e,t,i=>nl(G,t,void 0,"rexpaint",`file:${e.name}`,i)).catch(i=>de(G,t,"crash",i.message));break;case"application/octet-stream":Sx(e,t,i=>nl(G,t,void 0,"binary",`file:${e.name}`,i)).catch(i=>de(G,t,"crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=Ax(e.name,new Uint8Array(i));if(s)n(s);else return de(G,t,"parsewebfile",`unsupported file ${e.name}`)}).catch(i=>de(G,t,"crash",i.message));return}}n((e==null?void 0:e.type)??"")}function pa(t,e,n){function r(i){de(t,e,"crash",i.message)}n().catch(r)}function WB(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function HB(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const KB=new Date("1980/09/02");async function Ix(t){return console.info("saved",t),new Promise((e,n)=>{const r=new _p;for(let i=0;i<t.length;++i){const s=t[i],o=KU(s);if(o){const a=zN(o);x(a)&&r.file(s.id,a,{date:KB})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(HB(i))}).catch(n)})}async function GB(t){return new Promise((e,n)=>{const r=new _p;r.loadAsync(WB(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=GU(WN(c));x(l)&&i.push(l)}e(i)}).catch(n)})}const Nx="$yellow$205$205$205$196";function Ox(t,e){return`${t.x},${t.y},${e.x},${e.y}`}let rn;function YB(){return!!rn}function VB(t,e,n){const r=Math.min(e.x,n.x),i=Math.min(e.y,n.y),s=Math.max(e.x,n.x),o=Math.max(e.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},p=_e(t,{x:d,y:f});(p==null?void 0:p.category)===or.ISOBJECT?(l.push(Yn(Wo(t,d,f))),os(p)!=="player"&&u.push({...Yn(p),...h,id:"blank"})):l.push({...Yn(p),...h})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}function ZB(t,e,n,r){const i=sr(t);if(x(i))switch(rn=VB(i,e,n),r){case"copyobjects":rn.terrain=[];break;case"copyterrain":rn.objects=[];break}}function XB(t,e,n){const r=Ox(e,n);ae(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,Nx),$t(t,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),$t(t,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),$t(t,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=On(t);i.scroll=gi(t)}function qB(t,e,n,r){const i=sr(t);if(!x(i)||!x(rn))return;const s=Math.min(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.x,n.x),c=Math.max(e.y,n.y),l=a-s+1,u=c-o+1,f=Math.min(rn.width,l),d=Math.min(rn.height,u);switch(r){case"pasteall":{for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Uo({x:p,y:h},rn.width);un(i,{...rn.terrain[m],x:s+p,y:o+h})}for(let h=0;h<rn.objects.length;++h){const p=rn.objects[h];x(p.x)&&x(p.y)&&Fo(p.x,p.y,0,l-1,u-1,0)&&Ed(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let h=0;h<rn.objects.length;++h){const p=rn.objects[h];x(p.x)&&x(p.y)&&Fo(p.x,p.y,0,l-1,u-1,0)&&Ed(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Uo({x:p,y:h},rn.width);un(i,{...rn.terrain[m],x:s+p,y:o+h})}break;case"pasteterraintiled":for(let h=o;h<=c;++h)for(let p=s;p<=a;++p){const m=(p-s)%rn.width,w=(h-o)%rn.height,b=Uo({x:m,y:w},rn.width);un(i,{...rn.terrain[b],x:p,y:h})}break}}function JB(t,e,n){const r=Ox(e,n);ae(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,Nx),$t(t,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),$t(t,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),$t(t,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),$t(t,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=On(t);i.scroll=gi(t)}const no="$yellow$205$205$205$196";function hh(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function QB(t,e,n,r){const i=sr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){St(u)&&(s=u,ey(e.x,e.y,n.x,n.y).forEach(f=>{const d=_e(i,f);x(d)&&(d[l]=u)}))}ae(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,no),$t(t,`batch:${hh(e,n)}`,"char",[r,"charedit"],o,a);const c=On(t);c.scroll=gi(t)}function tD(t,e,n,r){const i=sr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){if(St(u)){s=u;for(let f=e.y;f<=n.y;++f)for(let d=e.x;d<=n.x;++d){const h=_e(i,{x:d,y:f});x(h)&&(h[l]=u)}}}ae(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,no),$t(t,`batch:${hh(e,n)}`,"color",[r,"coloredit"],o,a);const c=On(t);c.scroll=gi(t)}function eD(t,e,n,r){const i=sr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){St(u)&&(s=u,ey(e.x,e.y,n.x,n.y).forEach(f=>{const d=_e(i,f);x(d)&&(d[l]=u)}))}ae(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,no),$t(t,`batch:${hh(e,n)}`,"color",[r,"coloredit"],o,a);const c=On(t);c.scroll=gi(t)}const Bc={stat:"",patternsize:2,mirror:1};function nD(t,e,n){const r=Nn(Bt.MAIN);if(!x(r))return;const i=sr(t);if(!x(i))return;const s=hh(e,n);ae(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,no),$t(t,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),YB()&&$t(t,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),$t(t,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(h){const{target:p}=Ar(h);return Bc[p]}function a(h,p){if(St(p)||Et(p)){const{target:m}=Ar(h);Bc[m]=p}}$t(t,"batch","remix",[`stat:${s}`,"text"],o,a),$t(t,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),$t(t,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),$t(t,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),ae(t,no),$t(t,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),$t(t,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),$t(t,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),ae(t,no),$t(t,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),ae(t,no),ae(t,"codepages:");const c=Math.min(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.x,n.x),f=Math.max(e.y,n.y),d=new Set;for(let h=l;h<=f;++h)for(let p=c;p<=u;++p){const m=_e(i,{x:p,y:h}),w=cE(r,m);x(w)&&!d.has(w.id)&&(d.add(w.id),$t(t,"batch",`edit @${je(w)}`,[`pageopen:${w.id}`]))}}const ma="$yellow$205$205$205$196";function yp(t,e){return`inspect:${e!=null&&e.id?e.id:Cr(t,e)}`}function rD(t,e,n){const r=Nn(Bt.MAIN);if(!x(r))return;const i=sr(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===or.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=yp(i,e);ae(t,`${a}: ${c} ${l}`),ae(t,ma),$t(t,u,"color",[n,"coloredit"],s,o);const f=On(t);f.scroll=gi(t)}function iD(t,e,n){const r=Nn(Bt.MAIN);if(!x(r))return;const i=sr(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===or.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=yp(i,e);ae(t,`${a}: ${c} ${l}`),ae(t,ma),$t(t,u,"char",[n,"charedit"],s,o);const f=On(t);f.scroll=gi(t)}function sD(t,e,n,r,i,s){var f,d,h;function o(p){var w;const m=(r==null?void 0:r[p])??((w=r==null?void 0:r.kinddata)==null?void 0:w[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Kt.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?ae(t,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ae(t,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ae(t,ma);const c=yp(e,r);s?($t(t,c,"cycle",["cycle","number","1","255"],o,a),$t(t,c,"collision",["collision","select","iswalking",`${Kt.ISWALK}`,"isswimming",`${Kt.ISSWIM}`],o,a)):$t(t,c,"collision",["collision","select","iswalkable",`${Kt.ISWALK}`,"isswimable",`${Kt.ISSWIM}`,"issolid",`${Kt.ISSOLID}`],o,a),s&&$t(t,c,"pushable",["pushable","select","no","0","yes","1"],o,a),$t(t,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const l=Rc(n),u=jr(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(le(l[m])){const[w,b,...T]=l[m];Et(b)&&$t(t,c,b||m,[m,w,...T],o,a)}break}}$t(t,c,"copy coords",["copycoords","hk","5"," 5 "]),ae(t,ma),$t(t,c,`char: ${r.char??((f=r.kinddata)==null?void 0:f.char)??1}`,["char","hk","a"," A ","next"],o,a),$t(t,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),$t(t,c,`bg: ${r.bg??((h=r.kinddata)==null?void 0:h.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ae(t,ma),$t(t,c,"make empty",["empty","hk","0"],o,a),ae(t,ma),$t(t,"batch",`edit @${je(n)}`,[`pageopen:${n.id}`])}const Cx="$yellow$205$205$205$196";function oD(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function aD(t,e,n,r){const i=Nn(Bt.MAIN);if(!x(i))return;const s=sr(t);if(x(s))switch(r){case"emptyall":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=_e(s,{x:a,y:o});(c==null?void 0:c.category)===or.ISOBJECT&&rr(i,s,c,i.timestamp),un(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=_e(s,{x:a,y:o});(c==null?void 0:c.category)===or.ISOBJECT&&rr(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a)un(s,{x:a,y:o});break}}}function cD(t,e,n){const r=oD(e,n);ae(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,Cx),$t(t,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),$t(t,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),$t(t,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=On(t);i.scroll=gi(t)}function lD(t,e,n){const r=Nn(Bt.MAIN);if(!x(r))return;const i=sr(t);if(!x(i))return;if(Ke(r,i),e.x===n.x&&e.y===n.y){const o=_e(i,e),a=cE(r,o);x(o)&&x(a)&&sD(t,i,a,o,e,bn(o)),o!=null&&o.kind||(ae(t,`empty: ${e.x}, ${e.y}`),ae(t,Cx),$t(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]))}else nD(t,e,n);const s=On(t);s.scroll=gi(t)}function uD(t,e){const n=fe(Bt.MAIN);if(!x(n))return;const r=sr(e);if(!x(r))return;const i=Ar(t),s=YN(r,i.target);if(x(s))switch(i.path){case"copycoords":tf(G,kr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":rD(e,s,i.path);break;case"char":iD(e,s,i.path);break;case"empty":rr(n,r,s,n.timestamp);break;case"code":pa(G,e,async()=>{const o=os(s),a="object";Ge(G,e,`opened [${a}] ${o}`);const c=[r.id,s.id];Jf(el(n.id,c),s.code??""),RA(G,e),await ag(800),ig(G,e,n.id,c,a,`${o} - ${n.name}`,[])});break;default:console.info("unknown inspect",i);break}}function hD(t,e){const n=sr(e);if(!x(n))return;const r=Ar(t),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":XB(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":ZB(e,c,l,r.target);break;case"paste":JB(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":qB(e,c,l,r.target);break;case"empty":cD(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":aD(e,c,l,r.target);break;case"chars":QB(e,c,l,"char");break;case"colors":tD(e,c,l,"color");break;case"bgs":eD(e,c,l,"bg");break;case"copycoords":tf(G,e,[i,s,o,a].join(" "));break;case"remixrun":{const u=zn(_.book,_t.BOARD,Bc.stat),f=Ae(...u);x(f)&&HE(n.id,f.id,Bc.patternsize,Bc.mirror,c,l,"all");break}case"pageopen":pa(G,e,async()=>{await ag(800),YA(G,e,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const fD=16,ro={},dD=15*60*5;let Lx=0;const ga={},_a={};async function Mx(t){const e=la(),n=fe(Bt.MAIN);if(e.length&&x(n)){const r=await Ix(e),i=t?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;OA(ce,kr(),i,r)}}async function pD(){const t=la(),e=fe(Bt.MAIN);if(t.length&&x(e)){const n=await Ix(t);CA(ce,kr(),n)}}const ce=oo("vm",["tick","second"],t=>{var n;if(!ce.session(t))return;const e=kr();switch(t.target){case"operator":mB(t.player),zt(ce,t.player,`operator set to ${t.player}`),ce.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=fe(Bt.MAIN);ce.replynext(t,"ackzsswords",{cli:rp(_s.CLI),loader:rp(_s.LOADER),runtime:rp(_s.RUNTIME),flags:[...jr(mi(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...Zs(r,_t.OBJECT).map(i=>je(i)),...jr(J0)],altkinds:[...Zs(r,_t.TERRAIN),...Zs(r,_t.BOARD),...Zs(r,_t.PALETTE),...Zs(r,_t.CHARSET),...Zs(r,_t.LOADER)].map(i=>je(i)),colors:[...jr(Qa)],dirs:[...jr(sd).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...jr(Q0)]});break}case"books":t.player===e&&pa(ce,t.player,async()=>{if(le(t.data)){const[r,i]=t.data,s=await GB(r),o=s.map(a=>a.name);EB(s,i),zt(ce,t.player,`loading ${o.join(", ")}`),Qh(ce,t.player)}});break;case"search":vB(t.player)||Qh(ce,t.player);break;case"logout":TB(t.player),delete ro[t.player],zt(ce,e,`player ${t.player} logout`),Qh(ce,t.player);break;case"login":kB(t.player)?(ro[t.player]=0,zt(ce,kr(),`login from ${t.player}`),ce.replynext(t,"acklogin",!0)):NA(ce,t.player);break;case"doot":ro[t.player]=0,eg(ce,t.player,"active");break;case"input":{const r=mi(t.player),[i=An.NONE,s=0]=t.data??[An.NONE,0];le(r.inputqueue)||(r.inputqueue=[]),i!==An.NONE&&r.inputqueue.push([i,s]);break}case"codewatch":if(le(t.data)){const[r,i]=t.data,s=el(r,i);x(_a[s])||(_a[s]=Q_(s,o=>{const[a,c]=i,l=$r(r),u=ji(l,a);if(x(u))if(Di(u)===_t.BOARD&&x(c)){const f=Le(u),d=vn(f,c);x(d)&&(d.code=o,M0(rE(o),d))}else u.code=o,HU(u)})),ga[s]=ga[s]??new Set,ga[s].add(t.player)}break;case"coderelease":if(le(t.data)){const[r,i]=t.data,[,s]=i,o=el(r,i);x(ga[o])&&(ga[o].delete(t.player),ga[o].size===0&&((n=_a[o])==null||n.call(_a),_a[o]=void 0,Et(s)&&RB(s)))}break;case"halt":t.player===e&&yk(t.data)&&gB(t.data);break;case"tick":_B()||NB();break;case"synthsend":Et(t.data)&&pp(t.data,void 0);break;case"second":{AB(ro);const r=Object.keys(ro);for(let i=0;i<r.length;++i)++ro[r[i]];for(let i=0;i<r.length;++i){const s=r[i];ro[s]>=fD&&sg(ce,s)}++Lx>=dD&&(Lx=0,pa(ce,t.player,async()=>{await Mx(!0)}));break}case"copyjsonfile":if(t.player===e){const r=fe(Bt.MAIN);if(x(r)&&le(t.data)){const[i]=t.data,s=ji(r,i);x(s)&&LA(ce,e,s,`${je(s)}.${$i(s)}.json`)}}break;case"refsheet":{const r=fe(Bt.MAIN),i=$u(r);x(r)&&le(t.data)&&(GA(ce,t.player),Js(ce,t.player,"use as refsheet"),i.forEach(s=>{const o=je(s),a=$i(s);zt(ce,t.player,`!pageopenwith ${s.id} ${t.data.join(" ")};$blue[${a}]$white ${o}`)}));break}case"fork":t.player===e&&pa(ce,t.player,async()=>{await pD()});break;case"flush":t.player===e&&pa(ce,t.player,async()=>{await Mx()});break;case"cli":wx(t.player,t.data);break;case"clirepeatlast":OB(t.player);break;case"restart":t.player===e&&(IB(),og(ce,t.player));break;case"inspect":if(le(t.data)){const[r,i]=t.data;lD(t.player,r,i)}break;case"loader":if(le(t.data)){const[r,i,s,o]=t.data;if(i==="file")Rx(t.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){zt(ce,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=fe(Bt.MAIN);x(c)&&x(a.data)&&Et(a.exported)&&(dp(a.data),zt(ce,t.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){zt(ce,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=fe(Bt.MAIN);x(c)&&x(a.data)&&Et(a.exported)&&(lE(c,a.data),zt(ce,t.player,`loaded ${a.exported}`))}else UF(r,i,s,o,t.player)}break;default:{const{target:r,path:i}=Ar(t.target);switch(Nt(r)){case"batch":hD(i,t.player);break;case"empty":{const s=Ar(i);switch(s.target){case"copycoords":tf(ce,kr(),s.path.split(",").join(" "));break}break}case"inspect":uD(i,t.player);break;case"touched":if(le(t.data)){const[s,o,a]=t.data;yx({...t,target:`${s}:${a}`,data:void 0,sender:o})}break;default:yx(t);break}break}}},pB());function mD(){IA(ce)}const{forward:gD}=tS(t=>{eS(t)&&postMessage(t)});onmessage=function(e){gD(e.data)},setTimeout(mD,100)})();

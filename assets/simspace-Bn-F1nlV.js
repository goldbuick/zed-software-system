var V7=Object.defineProperty;var q7=(yi,sn,Br)=>sn in yi?V7(yi,sn,{enumerable:!0,configurable:!0,writable:!0,value:Br}):yi[sn]=Br;var vt=(yi,sn,Br)=>q7(yi,typeof sn!="symbol"?sn+"":sn,Br);(function(){"use strict";const yi=new Set,sn={emit(e,t,r,n,i){sn.invoke(AA(e,t,r,n,i))},invoke(e){yi.forEach(t=>t.handle(e))},connect(e){yi.add(e)},disconnect(e){yi.delete(e)}};var Br=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Wx(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var d0={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Br,function(){return r.importState=function(i){var s=new r;return s.importState(i),s},r;function r(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=n();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function n(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(d0);var Hx=d0.exports,p0=fs(Hx),m0={};(function(e){var t=Br&&Br.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,m;d<h;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function r(l){return l[Math.floor(Math.random()*l.length)]}function n(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,_=l.addAdverb,w=_===void 0?!1:_,v=t(t(t([],t([],Array(p),!0).map(function(A){return r(e.adjectives)}),!0),[r(e.nouns),r(e.verbs)],!1),w?[r(e.adverbs)]:[],!0);return h&&(v=v.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),v.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return n(e.adjectives).length*f+f*p.length+n(e.nouns).length+p.length+n(e.verbs).length+(h?n(e.adverbs).length+p.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(e.adjectives).length*f+f*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(h?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(m0);var g0=fs(m0);const Kx="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Yx=e=>crypto.getRandomValues(new Uint8Array(e)),Vx=(e,t,r)=>{let n=(2<<Math.log2(e.length-1))-1,i=-~(1.6*n*t/e.length);return(s=t)=>{let o="";for(;;){let a=r(i),c=i;for(;c--;)if(o+=e[a[c]&n]||"",o.length===s)return o}}},y0=(e,t=21)=>Vx(e,t,Yx),qx=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=Kx[r[e]&63];return t};var _0="abcdefghijklmnopqrstuvwxyz",b0="ABCDEFGHIJKLMNOPQRSTUVWXYZ",w0="0123456789",Xx="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Jx="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const Zx=w0,Qx=_0,tA=b0;var eA=Zx+Qx+tA,nh={lowercase:_0,uppercase:b0,numbers:w0,nolookalikes:Xx,nolookalikesSafe:Jx,alphanumeric:eA};function We(){return`sid_${qx(12).replaceAll("-",".")}`}y0(nh.numbers,4),y0(`${nh.numbers}${nh.lowercase}`,16);function xr(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function rA(){return g0({capitalize:!1,adjectiveCount:1})}function nA(){return g0({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var iA=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),sA=Object.prototype.hasOwnProperty;function ih(e,t){return sA.call(e,t)}function sh(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);var n=[];for(var i in e)ih(e,i)&&n.push(i);return n}function Dr(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function oh(e){for(var t=0,r=e.length,n;t<r;){if(n=e.charCodeAt(t),n>=48&&n<=57){t++;continue}return!1}return!0}function ds(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function E0(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ah(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)if(ah(e[t]))return!0}else if(typeof e=="object"){for(var n=sh(e),i=n.length,s=0;s<i;s++)if(ah(e[n[s]]))return!0}}return!1}function k0(e,t){var r=[e];for(var n in t){var i=typeof t[n]=="object"?JSON.stringify(t[n],null,2):t[n];typeof i<"u"&&r.push(n+": "+i)}return r.join(`
`)}var v0=function(e){iA(t,e);function t(r,n,i,s,o){var a=this.constructor,c=e.call(this,k0(r,{name:n,index:i,operation:s,tree:o}))||this;return c.name=n,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=k0(r,{name:n,index:i,operation:s,tree:o}),c}return t}(Error),Be=v0,oA=Dr,Ys={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=mc(r,this.path);n&&(n=Dr(n));var i=ps(r,{op:"remove",path:this.from}).removed;return ps(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=mc(r,this.from);return ps(r,{op:"add",path:this.path,value:Dr(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:ta(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},aA={add:function(e,t,r){return oh(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){var n=e.splice(t,1);return{newDocument:r,removed:n[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:Ys.move,copy:Ys.copy,test:Ys.test,_get:Ys._get};function mc(e,t){if(t=="")return e;var r={op:"_get",path:t};return ps(e,r),r.value}function ps(e,t,r,n,i,s){if(r===void 0&&(r=!1),n===void 0&&(n=!0),i===void 0&&(i=!0),s===void 0&&(s=0),r&&(typeof r=="function"?r(t,0,e,t.path):gc(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=mc(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=ta(e,t.value),o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(r)throw new Be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{n||(e=Dr(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,m=void 0;for(typeof r=="function"?m=r:m=gc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=E0(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(r&&!oh(h))throw new Be("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);oh(h)&&(h=~~h)}if(u>=f){if(r&&t.op==="add"&&h>l.length)throw new Be("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=aA[t.op].call(t,l,h,e);if(o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Ys[t.op].call(t,l,h,e);if(o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],r&&u<f&&(!l||typeof l!="object"))throw new Be("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function ch(e,t,r,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!0),r&&!Array.isArray(t))throw new Be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=Dr(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=ps(e,t[o],r,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function cA(e,t,r){var n=ps(e,t);if(n.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function gc(e,t,r,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new Be("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(Ys[e.op]){if(typeof e.path!="string")throw new Be("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Be('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Be("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&ah(e.value))throw new Be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r){if(e.op=="add"){var i=e.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new Be("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new Be("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=x0([o],r);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Be("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new Be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function x0(e,t,r){try{if(!Array.isArray(e))throw new Be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)ch(Dr(t),Dr(e),r||!0);else{r=r||gc;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(i){if(i instanceof Be)return i;throw i}}function ta(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Array.isArray(e),n=Array.isArray(t),i,s,o;if(r&&n){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!ta(e[i],t[i]))return!1;return!0}if(r!=n)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ta(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var lA=Object.freeze({__proto__:null,JsonPatchError:Be,_areEquals:ta,applyOperation:ps,applyPatch:ch,applyReducer:cA,deepClone:oA,getValueByPointer:mc,validate:x0,validator:gc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var lh=new WeakMap,uA=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),hA=function(){function e(t,r){this.callback=t,this.observer=r}return e}();function fA(e){return lh.get(e)}function dA(e,t){return e.observers.get(t)}function pA(e,t){e.observers.delete(t.callback)}function mA(e,t){t.unobserve()}function gA(e,t){var r=[],n,i=fA(e);if(!i)i=new uA(e),lh.set(e,i);else{var s=dA(i,t);n=s&&s.observer}if(n)return n;if(n={},i.value=Dr(e),t){n.callback=t,n.next=null;var o=function(){uh(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=r,n.object=e,n.unobserve=function(){uh(n),clearTimeout(n.next),pA(i,n),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new hA(t,n)),n}function uh(e,t){t===void 0&&(t=!1);var r=lh.get(e.object);hh(r.value,e.object,e.patches,"",t),e.patches.length&&ch(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function hh(e,t,r,n,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=sh(t),o=sh(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(ih(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?hh(u,f,r,n+"/"+ds(l),i):u!==f&&(i&&r.push({op:"test",path:n+"/"+ds(l),value:Dr(u)}),r.push({op:"replace",path:n+"/"+ds(l),value:Dr(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&r.push({op:"test",path:n+"/"+ds(l),value:Dr(u)}),r.push({op:"remove",path:n+"/"+ds(l)}),a=!0):(i&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!ih(e,l)&&t[l]!==void 0&&r.push({op:"add",path:n+"/"+ds(l),value:Dr(t[l])})}}}function A0(e,t,r){r===void 0&&(r=!1);var n=[];return hh(e,t,n,"",r),n}var yA=Object.freeze({__proto__:null,compare:A0,generate:uh,observe:gA,unobserve:mA});Object.assign({},lA,yA,{JsonPatchError:v0,deepClone:Dr,escapePathComponent:ds,unescapePathComponent:E0});var _A=typeof Element<"u",bA=typeof Map=="function",wA=typeof Set=="function",EA=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function yc(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,i;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!yc(e[n],t[n]))return!1;return!0}var s;if(bA&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(n=s.next()).done;)if(!t.has(n.value[0]))return!1;for(s=e.entries();!(n=s.next()).done;)if(!yc(n.value[1],t.get(n.value[0])))return!1;return!0}if(wA&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(n=s.next()).done;)if(!t.has(n.value[0]))return!1;return!0}if(EA&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;if(_A&&e instanceof Element)return!1;for(n=r;n--!==0;)if(!((i[n]==="_owner"||i[n]==="__v"||i[n]==="__o")&&e.$$typeof)&&!yc(e[i[n]],t[i[n]]))return!1;return!0}return e!==e&&t!==t}var kA=function(t,r){try{return yc(t,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}},vA=fs(kA);function y(e){return e!=null}const on=Object.keys;function Yn(e){return Dr(e)}function xA(e){return typeof e=="boolean"}function wt(e){return typeof e=="number"&&isNaN(e)===!1}function pt(e){return typeof e=="string"}function ce(e){return Array.isArray(e)}function fh(e){return e}var Lt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Lt||{}),Mt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e[e.ISGHOST=4]="ISGHOST",e))(Mt||{}),jr=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(jr||{}),yt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.FIND=18]="FIND",e[e.FLEE=19]="FLEE",e[e.TO=20]="TO",e[e.MID=21]="MID",e[e.OVER=22]="OVER",e[e.UNDER=23]="UNDER",e))(yt||{}),Rt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.VIEWIT=14]="VIEWIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(Rt||{});function It(e){return pt(e)?e.toLowerCase().trim():""}function AA(e,t,r,n,i){return{session:e,player:t,id:We(),sender:r,target:n,data:i}}function zr(e){const[t,...r]=e.split(":");return{target:t,path:r.join(":")}}function Vs(e,t=[],r=fh,n=""){const i=We(),s=It(e),o=t.map(It);let a=n;const c={id(){return i},name(){return e},session(l){return y(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,f){sn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=zr(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&y(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&r(l),(i===u||d==="all"||s===d)&&r({...l,target:f})}};return sn.connect(c),c}function TA(e){return typeof e=="object"&&pt(e.session)&&pt(e.player)&&pt(e.id)&&pt(e.sender)&&pt(e.target)}function de(e,t,r,...n){return e.emit(t,"error",[`$red${r}$blue>>`,...n]),!1}function SA(e,t,...r){return e.emit(t,"info",r),!0}function Ae(e,t,...r){return e.emit(t,"log",r),!0}function _c(e,t,r){e.emit(t,"toast",r)}function RA(e,t,r){e.emit(t,"bridge:streamstart",r)}function OA(e,t){e.emit(t,"bridge:streamstop",void 0)}function IA(e,t,r){e.emit(t,"bridge:chatstart",r)}function NA(e,t){e.emit(t,"bridge:chatstop")}function CA(e,t,r,n,i,s,o){e.emit(t,"bridge:fetch",[r,n,i,s,o])}function LA(e,t){e.emit(t,"bridge:talkstart",t)}function MA(e,t){e.emit(t,"bridge:talkstop",t)}function UA(e,t){e.emit(t,"bridge:mediastart",t)}function PA(e,t){e.emit(t,"bridge:mediastop",t)}function $A(e,t,r){e.emit(t,"bridge:start",r)}function FA(e,t,r){e.emit(t,"bridge:tab",r)}function BA(e,t,r){e.emit(t,"gadgetclient:paint",r)}function DA(e,t,r){e.emit(t,"gadgetclient:patch",r)}function jA(e,t){e.emit(t,"gadgetserver:clearscroll")}function zA(e,t){e.emit(t,"gadgetserver:clearplayer")}function GA(e){e.emit("","ready")}function T0(e,t){e.emit(t,"register:loginfail")}function dh(e,t){e.emit(t,"register:loginready",!0)}function WA(e,t,r,n){e.emit(t,"register:savemem",[r,n])}function HA(e,t,r){e.emit(t,"register:forkmem",[r])}function KA(e,t,r,n){e.emit(t,"register:itchiopublishmem",[r,n])}function ph(e,t,r){e.emit(t,"register:copy",r)}function YA(e,t,r,n){e.emit(t,"register:copyjsonfile",[r,n])}function S0(e,t,r,n){e.emit(t,"register:downloadjsonfile",[r,n])}function VA(e,t){e.emit(t,"register:dev",void 0)}function qA(e,t){e.emit(t,"register:share",void 0)}function XA(e,t){e.emit(t,"register:nuke",void 0)}function JA(e,t){e.emit(t,"register:enterar",void 0)}function ZA(e,t,r,n){e.emit(t,"synth:tts",[r,n])}function QA(e,t,r,n){e.emit(t,"synth:play",[r,n])}function tT(e,t,r,n,i){e.emit(t,"synth:bgplay",[r,n,i])}function eT(e,t,r){e.emit(t,"synth:focus",r)}function rT(e,t,r){e.emit(t,"synth:bpm",r)}function nT(e,t,r){e.emit(t,"synth:playvolume",r)}function iT(e,t,r){e.emit(t,"synth:bgplayvolume",r)}function sT(e,t,r){e.emit(t,"synth:ttsvolume",r)}function mh(e,t,r,n,i){e.emit(t,"synth:voice",[r,n,i])}function R0(e,t,r,n,i,s){e.emit(t,"synth:voicefx",[r,n,i,s])}function O0(e,t,r,n){e.emit(t,"register:config",[r,n])}function oT(e,t){e.emit(t,"register:configshow")}function aT(e,t){e.emit(t,"register:inspector")}function cT(e,t){e.emit(t,"register:terminal:full")}function I0(e,t,r,n,i,s){e.emit(t,"register:editor:open",[r,n,i,s])}function lT(e,t,r,n){e.emit(t,"vm:zztsearch",[r,n])}function uT(e,t){e.emit(t,"vm:zztrandom")}function hT(e,t){e.emit(t,"vm:local")}function N0(e,t){e.emit(t,"vm:logout")}function C0(e,t,r,n,i){e.emit(t,"vm:touched",[r,n,i])}function fT(e,t){e.emit(t,"vm:readzipfilelist")}function bc(e,t){const[r,n]=t;return`${e}:${[r,n].filter(y).join(":")}`}function dT(e,t,r){e.emit(t,"vm:cli",r)}function pT(e,t){e.emit(t,"vm:restart")}function L0(e,t){e.emit(t,"vm:flush")}function mT(e,t){e.emit(t,"vm:fork")}function gT(e,t){e.emit(t,"vm:itchiopublish")}function yT(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function _T(e,t){return{filename:e,json:t}}function bT(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function gh(e,t,r,n,i,s){let o;switch(n){case"file":o=s;break;case"text":o=yT(i,s);break;case"json":o=_T(i,s);break;case"binary":o=bT(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[r,n,i,o])},1)}function wT(e){const t=new Set;function r(s){TA(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),sn.invoke(s))}const n=Vs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){sn.disconnect(n)}return{forward:r,disconnect:i}}function ET(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=zr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const yh=66.666,wc=Math.round(1e3/yh),M0=3;function _h(e){return new Promise(t=>setTimeout(t,e))}const bh=Vs("clock");let wh=0,Ec=0,Eh=0,U0=performance.now();function P0(){const e=performance.now(),t=e-U0;Eh+=t,Eh>=yh&&(Eh%=yh,bh.emit("","tick",Ec),bh.emit("","tock",Ec),++wh,++Ec,wh>=wc&&(wh%=wc,bh.emit("","second",Ec))),U0=e,setTimeout(P0,2)}P0();function kT(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $0={exports:{}},He=$0.exports={},Vn,qn;function kh(){throw new Error("setTimeout has not been defined")}function vh(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Vn=setTimeout:Vn=kh}catch{Vn=kh}try{typeof clearTimeout=="function"?qn=clearTimeout:qn=vh}catch{qn=vh}})();function F0(e){if(Vn===setTimeout)return setTimeout(e,0);if((Vn===kh||!Vn)&&setTimeout)return Vn=setTimeout,setTimeout(e,0);try{return Vn(e,0)}catch{try{return Vn.call(null,e,0)}catch{return Vn.call(this,e,0)}}}function vT(e){if(qn===clearTimeout)return clearTimeout(e);if((qn===vh||!qn)&&clearTimeout)return qn=clearTimeout,clearTimeout(e);try{return qn(e)}catch{try{return qn.call(null,e)}catch{return qn.call(this,e)}}}var _i=[],qs=!1,ms,kc=-1;function xT(){!qs||!ms||(qs=!1,ms.length?_i=ms.concat(_i):kc=-1,_i.length&&B0())}function B0(){if(!qs){var e=F0(xT);qs=!0;for(var t=_i.length;t;){for(ms=_i,_i=[];++kc<t;)ms&&ms[kc].run();kc=-1,t=_i.length}ms=null,qs=!1,vT(e)}}He.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];_i.push(new D0(e,t)),_i.length===1&&!qs&&F0(B0)};function D0(e,t){this.fun=e,this.array=t}D0.prototype.run=function(){this.fun.apply(null,this.array)},He.title="browser",He.browser=!0,He.env={},He.argv=[],He.version="",He.versions={};function bi(){}He.on=bi,He.addListener=bi,He.once=bi,He.off=bi,He.removeListener=bi,He.removeAllListeners=bi,He.emit=bi,He.prependListener=bi,He.prependOnceListener=bi,He.listeners=function(e){return[]},He.binding=function(e){throw new Error("process.binding is not supported")},He.cwd=function(){return"/"},He.chdir=function(e){throw new Error("process.chdir is not supported")},He.umask=function(){return 0};var AT=$0.exports;const Ln=kT(AT);var qt={},xh=Symbol.for("react.transitional.element"),TT=Symbol.for("react.portal"),ST=Symbol.for("react.fragment"),RT=Symbol.for("react.strict_mode"),OT=Symbol.for("react.profiler"),IT=Symbol.for("react.consumer"),NT=Symbol.for("react.context"),CT=Symbol.for("react.forward_ref"),LT=Symbol.for("react.suspense"),MT=Symbol.for("react.memo"),j0=Symbol.for("react.lazy"),z0=Symbol.iterator;function UT(e){return e===null||typeof e!="object"?null:(e=z0&&e[z0]||e["@@iterator"],typeof e=="function"?e:null)}var G0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W0=Object.assign,H0={};function Xs(e,t,r){this.props=e,this.context=t,this.refs=H0,this.updater=r||G0}Xs.prototype.isReactComponent={},Xs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Xs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function K0(){}K0.prototype=Xs.prototype;function Ah(e,t,r){this.props=e,this.context=t,this.refs=H0,this.updater=r||G0}var Th=Ah.prototype=new K0;Th.constructor=Ah,W0(Th,Xs.prototype),Th.isPureReactComponent=!0;var Y0=Array.isArray,Te={H:null,A:null,T:null,S:null,V:null},V0=Object.prototype.hasOwnProperty;function Sh(e,t,r,n,i,s){return r=s.ref,{$$typeof:xh,type:e,key:t,ref:r!==void 0?r:null,props:s}}function PT(e,t){return Sh(e.type,t,void 0,void 0,void 0,e.props)}function Rh(e){return typeof e=="object"&&e!==null&&e.$$typeof===xh}function $T(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var q0=/\/+/g;function Oh(e,t){return typeof e=="object"&&e!==null&&e.key!=null?$T(""+e.key):t.toString(36)}function X0(){}function FT(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(X0,X0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function Js(e,t,r,n,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case xh:case TT:o=!0;break;case j0:return o=e._init,Js(o(e._payload),t,r,n,i)}}if(o)return i=i(e),o=n===""?"."+Oh(e,0):n,Y0(i)?(r="",o!=null&&(r=o.replace(q0,"$&/")+"/"),Js(i,t,r,"",function(l){return l})):i!=null&&(Rh(i)&&(i=PT(i,r+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(q0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=n===""?".":n+":";if(Y0(e))for(var c=0;c<e.length;c++)n=e[c],s=a+Oh(n,c),o+=Js(n,t,r,s,i);else if(c=UT(e),typeof c=="function")for(e=c.call(e),c=0;!(n=e.next()).done;)n=n.value,s=a+Oh(n,c++),o+=Js(n,t,r,s,i);else if(s==="object"){if(typeof e.then=="function")return Js(FT(e),t,r,n,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function vc(e,t,r){if(e==null)return e;var n=[],i=0;return Js(e,n,"","",function(s){return t.call(r,s,i++)}),n}function BT(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var J0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Ln=="object"&&typeof Ln.emit=="function"){Ln.emit("uncaughtException",e);return}console.error(e)};function DT(){}qt.Children={map:vc,forEach:function(e,t,r){vc(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return vc(e,function(){t++}),t},toArray:function(e){return vc(e,function(t){return t})||[]},only:function(e){if(!Rh(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},qt.Component=Xs,qt.Fragment=ST,qt.Profiler=OT,qt.PureComponent=Ah,qt.StrictMode=RT,qt.Suspense=LT,qt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Te,qt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return Te.H.useMemoCache(e)}},qt.cache=function(e){return function(){return e.apply(null,arguments)}},qt.cloneElement=function(e,t,r){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var n=W0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!V0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(n[o]=t[o]);var o=arguments.length-2;if(o===1)n.children=r;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];n.children=a}return Sh(e.type,i,void 0,void 0,s,n)},qt.createContext=function(e){return e={$$typeof:NT,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:IT,_context:e},e},qt.createElement=function(e,t,r){var n,i={},s=null;if(t!=null)for(n in t.key!==void 0&&(s=""+t.key),t)V0.call(t,n)&&n!=="key"&&n!=="__self"&&n!=="__source"&&(i[n]=t[n]);var o=arguments.length-2;if(o===1)i.children=r;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)i[n]===void 0&&(i[n]=o[n]);return Sh(e,s,void 0,void 0,null,i)},qt.createRef=function(){return{current:null}},qt.forwardRef=function(e){return{$$typeof:CT,render:e}},qt.isValidElement=Rh,qt.lazy=function(e){return{$$typeof:j0,_payload:{_status:-1,_result:e},_init:BT}},qt.memo=function(e,t){return{$$typeof:MT,type:e,compare:t===void 0?null:t}},qt.startTransition=function(e){var t=Te.T,r={};Te.T=r;try{var n=e(),i=Te.S;i!==null&&i(r,n),typeof n=="object"&&n!==null&&typeof n.then=="function"&&n.then(DT,J0)}catch(s){J0(s)}finally{Te.T=t}},qt.unstable_useCacheRefresh=function(){return Te.H.useCacheRefresh()},qt.use=function(e){return Te.H.use(e)},qt.useActionState=function(e,t,r){return Te.H.useActionState(e,t,r)},qt.useCallback=function(e,t){return Te.H.useCallback(e,t)},qt.useContext=function(e){return Te.H.useContext(e)},qt.useDebugValue=function(){},qt.useDeferredValue=function(e,t){return Te.H.useDeferredValue(e,t)},qt.useEffect=function(e,t,r){var n=Te.H;if(typeof r=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(e,t)},qt.useId=function(){return Te.H.useId()},qt.useImperativeHandle=function(e,t,r){return Te.H.useImperativeHandle(e,t,r)},qt.useInsertionEffect=function(e,t){return Te.H.useInsertionEffect(e,t)},qt.useLayoutEffect=function(e,t){return Te.H.useLayoutEffect(e,t)},qt.useMemo=function(e,t){return Te.H.useMemo(e,t)},qt.useOptimistic=function(e,t){return Te.H.useOptimistic(e,t)},qt.useReducer=function(e,t,r){return Te.H.useReducer(e,t,r)},qt.useRef=function(e){return Te.H.useRef(e)},qt.useState=function(e){return Te.H.useState(e)},qt.useSyncExternalStore=function(e,t,r){return Te.H.useSyncExternalStore(e,t,r)},qt.useTransition=function(){return Te.H.useTransition()},qt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Z0="0123456789abcdef",Q0=[],xc=[];for(let e=0;e<256;e++)Q0[e]=Z0[e>>4&15]+Z0[e&15],e<16&&(e<10?xc[48+e]=e:xc[87+e]=e);const tm=e=>{const t=e.length;let r="",n=0;for(;n<t;)r+=Q0[e[n++]];return r},Ac=e=>{const t=e.length>>1,r=t<<1,n=new Uint8Array(t);let i=0,s=0;for(;s<r;)n[i++]=xc[e.charCodeAt(s++)]<<4|xc[e.charCodeAt(s++)];return n};for(var em="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jT=typeof Uint8Array>"u"?[]:new Uint8Array(256),Tc=0;Tc<em.length;Tc++)jT[em.charCodeAt(Tc)]=Tc;new TextDecoder,new TextEncoder;const rm=typeof window<"u"?window:self,nm=rm.crypto||rm.msCrypto||{};nm.subtle||nm.webkitSubtle;const Zs=globalThis||void 0||self,Mn=()=>new Map,Ih=e=>{const t=Mn();return e.forEach((r,n)=>{t.set(n,r)}),t},Di=(e,t,r)=>{let n=e.get(t);return n===void 0&&e.set(t,n=r()),n},zT=(e,t)=>{const r=[];for(const[n,i]of e)r.push(t(i,n));return r},GT=(e,t)=>{for(const[r,n]of e)if(t(n,r))return!0;return!1},Qs=()=>new Set,Nh=e=>e[e.length-1],WT=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},gs=Array.from,HT=Array.isArray;class KT{constructor(){this._observers=Mn()}on(t,r){return Di(this._observers,t,Qs).add(r),r}once(t,r){const n=(...i)=>{this.off(t,n),r(...i)};this.on(t,n)}off(t,r){const n=this._observers.get(t);n!==void 0&&(n.delete(r),n.size===0&&this._observers.delete(t))}emit(t,r){return gs((this._observers.get(t)||Mn()).values()).forEach(n=>n(...r))}destroy(){this._observers=Mn()}}const ji=Math.floor,Sc=Math.abs,im=(e,t)=>e<t?e:t,ys=(e,t)=>e>t?e:t,sm=e=>e!==0?e<0:1/e<0,om=1,am=2,Ch=4,Lh=8,ea=32,wi=64,an=128,Rc=31,Mh=63,_s=127,YT=2147483647,cm=Number.MAX_SAFE_INTEGER,VT=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&ji(e)===e),qT=e=>e.toLowerCase(),XT=/^\s*/g,JT=e=>e.replace(XT,""),ZT=/([A-Z])/g,lm=(e,t)=>JT(e.replace(ZT,r=>`${t}${qT(r)}`)),QT=e=>{const t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.codePointAt(i);return n},ra=typeof TextEncoder<"u"?new TextEncoder:null,tS=ra?e=>ra.encode(e):QT;let na=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});na&&na.decode(new Uint8Array).length===1&&(na=null);class ia{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Oc=()=>new ia,eS=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},Xn=e=>{const t=new Uint8Array(eS(e));let r=0;for(let n=0;n<e.bufs.length;n++){const i=e.bufs[n];t.set(i,r),r+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),r),t},rS=(e,t)=>{const r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(ys(r,t)*2),e.cpos=0)},ur=(e,t)=>{const r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(r*2),e.cpos=0),e.cbuf[e.cpos++]=t},Uh=ur,ae=(e,t)=>{for(;t>_s;)ur(e,an|_s&t),t=ji(t/128);ur(e,_s&t)},Ph=(e,t)=>{const r=sm(t);for(r&&(t=-t),ur(e,(t>Mh?an:0)|(r?wi:0)|Mh&t),t=ji(t/64);t>0;)ur(e,(t>_s?an:0)|_s&t),t=ji(t/128)},$h=new Uint8Array(3e4),nS=$h.length/3,iS=(e,t)=>{if(t.length<nS){const r=ra.encodeInto(t,$h).written||0;ae(e,r);for(let n=0;n<r;n++)ur(e,$h[n])}else cn(e,tS(t))},sS=(e,t)=>{const r=unescape(encodeURIComponent(t)),n=r.length;ae(e,n);for(let i=0;i<n;i++)ur(e,r.codePointAt(i))},to=ra&&ra.encodeInto?iS:sS,Ic=(e,t)=>{const r=e.cbuf.length,n=e.cpos,i=im(r-n,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),n),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ys(r*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},cn=(e,t)=>{ae(e,t.byteLength),Ic(e,t)},Fh=(e,t)=>{rS(e,t);const r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},oS=(e,t)=>Fh(e,4).setFloat32(0,t,!1),aS=(e,t)=>Fh(e,8).setFloat64(0,t,!1),cS=(e,t)=>Fh(e,8).setBigInt64(0,t,!1),um=new DataView(new ArrayBuffer(4)),lS=e=>(um.setFloat32(0,e),um.getFloat32(0)===e),sa=(e,t)=>{switch(typeof t){case"string":ur(e,119),to(e,t);break;case"number":VT(t)&&Sc(t)<=YT?(ur(e,125),Ph(e,t)):lS(t)?(ur(e,124),oS(e,t)):(ur(e,123),aS(e,t));break;case"bigint":ur(e,122),cS(e,t);break;case"object":if(t===null)ur(e,126);else if(HT(t)){ur(e,117),ae(e,t.length);for(let r=0;r<t.length;r++)sa(e,t[r])}else if(t instanceof Uint8Array)ur(e,116),cn(e,t);else{ur(e,118);const r=Object.keys(t);ae(e,r.length);for(let n=0;n<r.length;n++){const i=r[n];to(e,i),sa(e,t[i])}}break;case"boolean":ur(e,t?120:121);break;default:ur(e,127)}};class hm extends ia{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&ae(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const fm=e=>{e.count>0&&(Ph(e.encoder,e.count===1?e.s:-e.s),e.count>1&&ae(e.encoder,e.count-2))};class Nc{constructor(){this.encoder=new ia,this.s=0,this.count=0}write(t){this.s===t?this.count++:(fm(this),this.count=1,this.s=t)}toUint8Array(){return fm(this),Xn(this.encoder)}}const dm=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Ph(e.encoder,t),e.count>1&&ae(e.encoder,e.count-2)}};class Bh{constructor(){this.encoder=new ia,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(dm(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return dm(this),Xn(this.encoder)}}class uS{constructor(){this.sarr=[],this.s="",this.lensE=new Nc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new ia;return this.sarr.push(this.s),this.s="",to(t,this.sarr.join("")),Ic(t,this.lensE.toUint8Array()),Xn(t)}}const zi=e=>new Error(e),Jn=()=>{throw zi("Method unimplemented")},Zn=()=>{throw zi("Unexpected case")},pm=zi("Unexpected end of array"),mm=zi("Integer out of Range");class Cc{constructor(t){this.arr=t,this.pos=0}}const eo=e=>new Cc(e),hS=e=>e.pos!==e.arr.length,fS=(e,t)=>{const r=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r},ln=e=>fS(e,Xt(e)),ro=e=>e.arr[e.pos++],Xt=e=>{let t=0,r=1;const n=e.arr.length;for(;e.pos<n;){const i=e.arr[e.pos++];if(t=t+(i&_s)*r,r*=128,i<an)return t;if(t>cm)throw mm}throw pm},Dh=e=>{let t=e.arr[e.pos++],r=t&Mh,n=64;const i=(t&wi)>0?-1:1;if(!(t&an))return i*r;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],r=r+(t&_s)*n,n*=128,t<an)return i*r;if(r>cm)throw mm}throw pm},no=na?e=>na.decode(ln(e)):e=>{let t=Xt(e);if(t===0)return"";{let r=String.fromCodePoint(ro(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(ro(e));else for(;t>0;){const n=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,i),t-=n}return decodeURIComponent(escape(r))}},jh=(e,t)=>{const r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},dS=[e=>{},e=>null,Dh,e=>jh(e,4).getFloat32(0,!1),e=>jh(e,8).getFloat64(0,!1),e=>jh(e,8).getBigInt64(0,!1),e=>!1,e=>!0,no,e=>{const t=Xt(e),r={};for(let n=0;n<t;n++){const i=no(e);r[i]=oa(e)}return r},e=>{const t=Xt(e),r=[];for(let n=0;n<t;n++)r.push(oa(e));return r},ln],oa=e=>dS[127-ro(e)](e);class gm extends Cc{constructor(t,r){super(t),this.reader=r,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),hS(this)?this.count=Xt(this)+1:this.count=-1),this.count--,this.s}}class Lc extends Cc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Dh(this);const t=sm(this.s);this.count=1,t&&(this.s=-this.s,this.count=Xt(this)+2)}return this.count--,this.s}}class zh extends Cc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Dh(this),r=t&1;this.diff=ji(t/2),this.count=1,r&&(this.count=Xt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class pS{constructor(t){this.decoder=new Lc(t),this.str=no(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),r=this.str.slice(this.spos,t);return this.spos=t,r}}const mS=crypto.getRandomValues.bind(crypto),ym=()=>mS(new Uint32Array(1))[0],gS="10000000-1000-4000-8000"+-1e11,yS=()=>gS.replace(/[018]/g,e=>(e^ym()&15>>e/4).toString(16)),_m=e=>new Promise(e);Promise.all.bind(Promise);var bm={},Mc={};Mc.byteLength=wS,Mc.toByteArray=kS,Mc.fromByteArray=AS;for(var Qn=[],mn=[],_S=typeof Uint8Array<"u"?Uint8Array:Array,Gh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",io=0,bS=Gh.length;io<bS;++io)Qn[io]=Gh[io],mn[Gh.charCodeAt(io)]=io;mn[45]=62,mn[95]=63;function wm(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function wS(e){var t=wm(e),r=t[0],n=t[1];return(r+n)*3/4-n}function ES(e,t,r){return(t+r)*3/4-r}function kS(e){var t,r=wm(e),n=r[0],i=r[1],s=new _S(ES(e,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)t=mn[e.charCodeAt(c)]<<18|mn[e.charCodeAt(c+1)]<<12|mn[e.charCodeAt(c+2)]<<6|mn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=mn[e.charCodeAt(c)]<<2|mn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=mn[e.charCodeAt(c)]<<10|mn[e.charCodeAt(c+1)]<<4|mn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function vS(e){return Qn[e>>18&63]+Qn[e>>12&63]+Qn[e>>6&63]+Qn[e&63]}function xS(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(vS(n));return i.join("")}function AS(e){for(var t,r=e.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(xS(e,o,o+s>a?a:o+s));return n===1?(t=e[r-1],i.push(Qn[t>>2]+Qn[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(Qn[t>>10]+Qn[t>>4&63]+Qn[t<<2&63]+"=")),i.join("")}var Wh={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Wh.read=function(e,t,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,u=-7,f=r?i-1:0,d=r?-1:1,h=e[t+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+e[t+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+e[t+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(h?-1:1)*o*Math.pow(2,s-n)},Wh.write=function(e,t,r,n,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:s-1,m=n?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=d/c:t+=d*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(t*c-1)*Math.pow(2,i),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[r+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[r+h]=o&255,h+=m,o/=256,l-=8);e[r+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Mc,r=Wh,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=I,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const R=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(R,g),R.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(R){if(R>i)throw new RangeError('The value "'+R+'" is invalid for option "size"');const g=new s(R);return Object.setPrototypeOf(g,u.prototype),g}function u(R,g,b){if(typeof R=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(R)}return f(R,g,b)}u.poolSize=8192;function f(R,g,b){if(typeof R=="string")return p(R,g);if(o.isView(R))return w(R);if(R==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R);if(mt(R,o)||R&&mt(R.buffer,o)||typeof a<"u"&&(mt(R,a)||R&&mt(R.buffer,a)))return v(R,g,b);if(typeof R=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const U=R.valueOf&&R.valueOf();if(U!=null&&U!==R)return u.from(U,g,b);const W=A(R);if(W)return W;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof R[Symbol.toPrimitive]=="function")return u.from(R[Symbol.toPrimitive]("string"),g,b);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R)}u.from=function(R,g,b){return f(R,g,b)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(R){if(typeof R!="number")throw new TypeError('"size" argument must be of type number');if(R<0)throw new RangeError('The value "'+R+'" is invalid for option "size"')}function h(R,g,b){return d(R),R<=0?l(R):g!==void 0?typeof b=="string"?l(R).fill(g,b):l(R).fill(g):l(R)}u.alloc=function(R,g,b){return h(R,g,b)};function m(R){return d(R),l(R<0?0:T(R)|0)}u.allocUnsafe=function(R){return m(R)},u.allocUnsafeSlow=function(R){return m(R)};function p(R,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const b=S(R,g)|0;let U=l(b);const W=U.write(R,g);return W!==b&&(U=U.slice(0,W)),U}function _(R){const g=R.length<0?0:T(R.length)|0,b=l(g);for(let U=0;U<g;U+=1)b[U]=R[U]&255;return b}function w(R){if(mt(R,s)){const g=new s(R);return v(g.buffer,g.byteOffset,g.byteLength)}return _(R)}function v(R,g,b){if(g<0||R.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(R.byteLength<g+(b||0))throw new RangeError('"length" is outside of buffer bounds');let U;return g===void 0&&b===void 0?U=new s(R):b===void 0?U=new s(R,g):U=new s(R,g,b),Object.setPrototypeOf(U,u.prototype),U}function A(R){if(u.isBuffer(R)){const g=T(R.length)|0,b=l(g);return b.length===0||R.copy(b,0,0,g),b}if(R.length!==void 0)return typeof R.length!="number"||Ct(R.length)?l(0):_(R);if(R.type==="Buffer"&&Array.isArray(R.data))return _(R.data)}function T(R){if(R>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return R|0}function I(R){return+R!=R&&(R=0),u.alloc(+R)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,b){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),mt(b,s)&&(b=u.from(b,b.offset,b.byteLength)),!u.isBuffer(g)||!u.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===b)return 0;let U=g.length,W=b.length;for(let rt=0,ct=Math.min(U,W);rt<ct;++rt)if(g[rt]!==b[rt]){U=g[rt],W=b[rt];break}return U<W?-1:W<U?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,b){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let U;if(b===void 0)for(b=0,U=0;U<g.length;++U)b+=g[U].length;const W=u.allocUnsafe(b);let rt=0;for(U=0;U<g.length;++U){let ct=g[U];if(mt(ct,s))rt+ct.length>W.length?(u.isBuffer(ct)||(ct=u.from(ct)),ct.copy(W,rt)):s.prototype.set.call(W,ct,rt);else if(u.isBuffer(ct))ct.copy(W,rt);else throw new TypeError('"list" argument must be an Array of Buffers');rt+=ct.length}return W};function S(R,g){if(u.isBuffer(R))return R.length;if(o.isView(R)||mt(R,o))return R.byteLength;if(typeof R!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof R);const b=R.length,U=arguments.length>2&&arguments[2]===!0;if(!U&&b===0)return 0;let W=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return b;case"utf8":case"utf-8":return ht(R).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b*2;case"hex":return b>>>1;case"base64":return gt(R).length;default:if(W)return U?-1:ht(R).length;g=(""+g).toLowerCase(),W=!0}}u.byteLength=S;function C(R,g,b){let U=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((b===void 0||b>this.length)&&(b=this.length),b<=0)||(b>>>=0,g>>>=0,b<=g))return"";for(R||(R="utf8");;)switch(R){case"hex":return D(this,g,b);case"utf8":case"utf-8":return $(this,g,b);case"ascii":return st(this,g,b);case"latin1":case"binary":return G(this,g,b);case"base64":return B(this,g,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _t(this,g,b);default:if(U)throw new TypeError("Unknown encoding: "+R);R=(R+"").toLowerCase(),U=!0}}u.prototype._isBuffer=!0;function P(R,g,b){const U=R[g];R[g]=R[b],R[b]=U}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let b=0;b<g;b+=2)P(this,b,b+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let b=0;b<g;b+=4)P(this,b,b+3),P(this,b+1,b+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let b=0;b<g;b+=8)P(this,b,b+7),P(this,b+1,b+6),P(this,b+2,b+5),P(this,b+3,b+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?$(this,0,g):C.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const b=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,b).replace(/(.{2})/g,"$1 ").trim(),this.length>b&&(g+=" ... "),"<Buffer "+g+">"},n&&(u.prototype[n]=u.prototype.inspect),u.prototype.compare=function(g,b,U,W,rt){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(b===void 0&&(b=0),U===void 0&&(U=g?g.length:0),W===void 0&&(W=0),rt===void 0&&(rt=this.length),b<0||U>g.length||W<0||rt>this.length)throw new RangeError("out of range index");if(W>=rt&&b>=U)return 0;if(W>=rt)return-1;if(b>=U)return 1;if(b>>>=0,U>>>=0,W>>>=0,rt>>>=0,this===g)return 0;let ct=rt-W,Vt=U-b;const Ue=Math.min(ct,Vt),ve=this.slice(W,rt),Pe=g.slice(b,U);for(let fe=0;fe<Ue;++fe)if(ve[fe]!==Pe[fe]){ct=ve[fe],Vt=Pe[fe];break}return ct<Vt?-1:Vt<ct?1:0};function N(R,g,b,U,W){if(R.length===0)return-1;if(typeof b=="string"?(U=b,b=0):b>2147483647?b=2147483647:b<-2147483648&&(b=-2147483648),b=+b,Ct(b)&&(b=W?0:R.length-1),b<0&&(b=R.length+b),b>=R.length){if(W)return-1;b=R.length-1}else if(b<0)if(W)b=0;else return-1;if(typeof g=="string"&&(g=u.from(g,U)),u.isBuffer(g))return g.length===0?-1:z(R,g,b,U,W);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?W?s.prototype.indexOf.call(R,g,b):s.prototype.lastIndexOf.call(R,g,b):z(R,[g],b,U,W);throw new TypeError("val must be string, number or Buffer")}function z(R,g,b,U,W){let rt=1,ct=R.length,Vt=g.length;if(U!==void 0&&(U=String(U).toLowerCase(),U==="ucs2"||U==="ucs-2"||U==="utf16le"||U==="utf-16le")){if(R.length<2||g.length<2)return-1;rt=2,ct/=2,Vt/=2,b/=2}function Ue(Pe,fe){return rt===1?Pe[fe]:Pe.readUInt16BE(fe*rt)}let ve;if(W){let Pe=-1;for(ve=b;ve<ct;ve++)if(Ue(R,ve)===Ue(g,Pe===-1?0:ve-Pe)){if(Pe===-1&&(Pe=ve),ve-Pe+1===Vt)return Pe*rt}else Pe!==-1&&(ve-=ve-Pe),Pe=-1}else for(b+Vt>ct&&(b=ct-Vt),ve=b;ve>=0;ve--){let Pe=!0;for(let fe=0;fe<Vt;fe++)if(Ue(R,ve+fe)!==Ue(g,fe)){Pe=!1;break}if(Pe)return ve}return-1}u.prototype.includes=function(g,b,U){return this.indexOf(g,b,U)!==-1},u.prototype.indexOf=function(g,b,U){return N(this,g,b,U,!0)},u.prototype.lastIndexOf=function(g,b,U){return N(this,g,b,U,!1)};function J(R,g,b,U){b=Number(b)||0;const W=R.length-b;U?(U=Number(U),U>W&&(U=W)):U=W;const rt=g.length;U>rt/2&&(U=rt/2);let ct;for(ct=0;ct<U;++ct){const Vt=parseInt(g.substr(ct*2,2),16);if(Ct(Vt))return ct;R[b+ct]=Vt}return ct}function M(R,g,b,U){return xt(ht(g,R.length-b),R,b,U)}function O(R,g,b,U){return xt(dt(g),R,b,U)}function k(R,g,b,U){return xt(gt(g),R,b,U)}function L(R,g,b,U){return xt(tt(g,R.length-b),R,b,U)}u.prototype.write=function(g,b,U,W){if(b===void 0)W="utf8",U=this.length,b=0;else if(U===void 0&&typeof b=="string")W=b,U=this.length,b=0;else if(isFinite(b))b=b>>>0,isFinite(U)?(U=U>>>0,W===void 0&&(W="utf8")):(W=U,U=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const rt=this.length-b;if((U===void 0||U>rt)&&(U=rt),g.length>0&&(U<0||b<0)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");W||(W="utf8");let ct=!1;for(;;)switch(W){case"hex":return J(this,g,b,U);case"utf8":case"utf-8":return M(this,g,b,U);case"ascii":case"latin1":case"binary":return O(this,g,b,U);case"base64":return k(this,g,b,U);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,g,b,U);default:if(ct)throw new TypeError("Unknown encoding: "+W);W=(""+W).toLowerCase(),ct=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function B(R,g,b){return g===0&&b===R.length?t.fromByteArray(R):t.fromByteArray(R.slice(g,b))}function $(R,g,b){b=Math.min(R.length,b);const U=[];let W=g;for(;W<b;){const rt=R[W];let ct=null,Vt=rt>239?4:rt>223?3:rt>191?2:1;if(W+Vt<=b){let Ue,ve,Pe,fe;switch(Vt){case 1:rt<128&&(ct=rt);break;case 2:Ue=R[W+1],(Ue&192)===128&&(fe=(rt&31)<<6|Ue&63,fe>127&&(ct=fe));break;case 3:Ue=R[W+1],ve=R[W+2],(Ue&192)===128&&(ve&192)===128&&(fe=(rt&15)<<12|(Ue&63)<<6|ve&63,fe>2047&&(fe<55296||fe>57343)&&(ct=fe));break;case 4:Ue=R[W+1],ve=R[W+2],Pe=R[W+3],(Ue&192)===128&&(ve&192)===128&&(Pe&192)===128&&(fe=(rt&15)<<18|(Ue&63)<<12|(ve&63)<<6|Pe&63,fe>65535&&fe<1114112&&(ct=fe))}}ct===null?(ct=65533,Vt=1):ct>65535&&(ct-=65536,U.push(ct>>>10&1023|55296),ct=56320|ct&1023),U.push(ct),W+=Vt}return et(U)}const ot=4096;function et(R){const g=R.length;if(g<=ot)return String.fromCharCode.apply(String,R);let b="",U=0;for(;U<g;)b+=String.fromCharCode.apply(String,R.slice(U,U+=ot));return b}function st(R,g,b){let U="";b=Math.min(R.length,b);for(let W=g;W<b;++W)U+=String.fromCharCode(R[W]&127);return U}function G(R,g,b){let U="";b=Math.min(R.length,b);for(let W=g;W<b;++W)U+=String.fromCharCode(R[W]);return U}function D(R,g,b){const U=R.length;(!g||g<0)&&(g=0),(!b||b<0||b>U)&&(b=U);let W="";for(let rt=g;rt<b;++rt)W+=ge[R[rt]];return W}function _t(R,g,b){const U=R.slice(g,b);let W="";for(let rt=0;rt<U.length-1;rt+=2)W+=String.fromCharCode(U[rt]+U[rt+1]*256);return W}u.prototype.slice=function(g,b){const U=this.length;g=~~g,b=b===void 0?U:~~b,g<0?(g+=U,g<0&&(g=0)):g>U&&(g=U),b<0?(b+=U,b<0&&(b=0)):b>U&&(b=U),b<g&&(b=g);const W=this.subarray(g,b);return Object.setPrototypeOf(W,u.prototype),W};function q(R,g,b){if(R%1!==0||R<0)throw new RangeError("offset is not uint");if(R+g>b)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,b,U){g=g>>>0,b=b>>>0,U||q(g,b,this.length);let W=this[g],rt=1,ct=0;for(;++ct<b&&(rt*=256);)W+=this[g+ct]*rt;return W},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,b,U){g=g>>>0,b=b>>>0,U||q(g,b,this.length);let W=this[g+--b],rt=1;for(;b>0&&(rt*=256);)W+=this[g+--b]*rt;return W},u.prototype.readUint8=u.prototype.readUInt8=function(g,b){return g=g>>>0,b||q(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,b){return g=g>>>0,b||q(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,b){return g=g>>>0,b||q(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,b){return g=g>>>0,b||q(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,b){return g=g>>>0,b||q(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Gt(function(g){g=g>>>0,it(g,"offset");const b=this[g],U=this[g+7];(b===void 0||U===void 0)&&j(g,this.length-8);const W=b+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,rt=this[++g]+this[++g]*2**8+this[++g]*2**16+U*2**24;return BigInt(W)+(BigInt(rt)<<BigInt(32))}),u.prototype.readBigUInt64BE=Gt(function(g){g=g>>>0,it(g,"offset");const b=this[g],U=this[g+7];(b===void 0||U===void 0)&&j(g,this.length-8);const W=b*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],rt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U;return(BigInt(W)<<BigInt(32))+BigInt(rt)}),u.prototype.readIntLE=function(g,b,U){g=g>>>0,b=b>>>0,U||q(g,b,this.length);let W=this[g],rt=1,ct=0;for(;++ct<b&&(rt*=256);)W+=this[g+ct]*rt;return rt*=128,W>=rt&&(W-=Math.pow(2,8*b)),W},u.prototype.readIntBE=function(g,b,U){g=g>>>0,b=b>>>0,U||q(g,b,this.length);let W=b,rt=1,ct=this[g+--W];for(;W>0&&(rt*=256);)ct+=this[g+--W]*rt;return rt*=128,ct>=rt&&(ct-=Math.pow(2,8*b)),ct},u.prototype.readInt8=function(g,b){return g=g>>>0,b||q(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,b){g=g>>>0,b||q(g,2,this.length);const U=this[g]|this[g+1]<<8;return U&32768?U|4294901760:U},u.prototype.readInt16BE=function(g,b){g=g>>>0,b||q(g,2,this.length);const U=this[g+1]|this[g]<<8;return U&32768?U|4294901760:U},u.prototype.readInt32LE=function(g,b){return g=g>>>0,b||q(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,b){return g=g>>>0,b||q(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Gt(function(g){g=g>>>0,it(g,"offset");const b=this[g],U=this[g+7];(b===void 0||U===void 0)&&j(g,this.length-8);const W=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(U<<24);return(BigInt(W)<<BigInt(32))+BigInt(b+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Gt(function(g){g=g>>>0,it(g,"offset");const b=this[g],U=this[g+7];(b===void 0||U===void 0)&&j(g,this.length-8);const W=(b<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(W)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U)}),u.prototype.readFloatLE=function(g,b){return g=g>>>0,b||q(g,4,this.length),r.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,b){return g=g>>>0,b||q(g,4,this.length),r.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,b){return g=g>>>0,b||q(g,8,this.length),r.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,b){return g=g>>>0,b||q(g,8,this.length),r.read(this,g,!1,52,8)};function at(R,g,b,U,W,rt){if(!u.isBuffer(R))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>W||g<rt)throw new RangeError('"value" argument is out of bounds');if(b+U>R.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,b,U,W){if(g=+g,b=b>>>0,U=U>>>0,!W){const Vt=Math.pow(2,8*U)-1;at(this,g,b,U,Vt,0)}let rt=1,ct=0;for(this[b]=g&255;++ct<U&&(rt*=256);)this[b+ct]=g/rt&255;return b+U},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,b,U,W){if(g=+g,b=b>>>0,U=U>>>0,!W){const Vt=Math.pow(2,8*U)-1;at(this,g,b,U,Vt,0)}let rt=U-1,ct=1;for(this[b+rt]=g&255;--rt>=0&&(ct*=256);)this[b+rt]=g/ct&255;return b+U},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,1,255,0),this[b]=g&255,b+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,2,65535,0),this[b]=g&255,this[b+1]=g>>>8,b+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,2,65535,0),this[b]=g>>>8,this[b+1]=g&255,b+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,4,4294967295,0),this[b+3]=g>>>24,this[b+2]=g>>>16,this[b+1]=g>>>8,this[b]=g&255,b+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,4,4294967295,0),this[b]=g>>>24,this[b+1]=g>>>16,this[b+2]=g>>>8,this[b+3]=g&255,b+4};function Ft(R,g,b,U,W){lt(g,U,W,R,b,7);let rt=Number(g&BigInt(4294967295));R[b++]=rt,rt=rt>>8,R[b++]=rt,rt=rt>>8,R[b++]=rt,rt=rt>>8,R[b++]=rt;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return R[b++]=ct,ct=ct>>8,R[b++]=ct,ct=ct>>8,R[b++]=ct,ct=ct>>8,R[b++]=ct,b}function Wt(R,g,b,U,W){lt(g,U,W,R,b,7);let rt=Number(g&BigInt(4294967295));R[b+7]=rt,rt=rt>>8,R[b+6]=rt,rt=rt>>8,R[b+5]=rt,rt=rt>>8,R[b+4]=rt;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return R[b+3]=ct,ct=ct>>8,R[b+2]=ct,ct=ct>>8,R[b+1]=ct,ct=ct>>8,R[b]=ct,b+8}u.prototype.writeBigUInt64LE=Gt(function(g,b=0){return Ft(this,g,b,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Gt(function(g,b=0){return Wt(this,g,b,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,b,U,W){if(g=+g,b=b>>>0,!W){const Ue=Math.pow(2,8*U-1);at(this,g,b,U,Ue-1,-Ue)}let rt=0,ct=1,Vt=0;for(this[b]=g&255;++rt<U&&(ct*=256);)g<0&&Vt===0&&this[b+rt-1]!==0&&(Vt=1),this[b+rt]=(g/ct>>0)-Vt&255;return b+U},u.prototype.writeIntBE=function(g,b,U,W){if(g=+g,b=b>>>0,!W){const Ue=Math.pow(2,8*U-1);at(this,g,b,U,Ue-1,-Ue)}let rt=U-1,ct=1,Vt=0;for(this[b+rt]=g&255;--rt>=0&&(ct*=256);)g<0&&Vt===0&&this[b+rt+1]!==0&&(Vt=1),this[b+rt]=(g/ct>>0)-Vt&255;return b+U},u.prototype.writeInt8=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,1,127,-128),g<0&&(g=255+g+1),this[b]=g&255,b+1},u.prototype.writeInt16LE=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,2,32767,-32768),this[b]=g&255,this[b+1]=g>>>8,b+2},u.prototype.writeInt16BE=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,2,32767,-32768),this[b]=g>>>8,this[b+1]=g&255,b+2},u.prototype.writeInt32LE=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,4,2147483647,-2147483648),this[b]=g&255,this[b+1]=g>>>8,this[b+2]=g>>>16,this[b+3]=g>>>24,b+4},u.prototype.writeInt32BE=function(g,b,U){return g=+g,b=b>>>0,U||at(this,g,b,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[b]=g>>>24,this[b+1]=g>>>16,this[b+2]=g>>>8,this[b+3]=g&255,b+4},u.prototype.writeBigInt64LE=Gt(function(g,b=0){return Ft(this,g,b,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Gt(function(g,b=0){return Wt(this,g,b,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function jt(R,g,b,U,W,rt){if(b+U>R.length)throw new RangeError("Index out of range");if(b<0)throw new RangeError("Index out of range")}function Bt(R,g,b,U,W){return g=+g,b=b>>>0,W||jt(R,g,b,4),r.write(R,g,b,U,23,4),b+4}u.prototype.writeFloatLE=function(g,b,U){return Bt(this,g,b,!0,U)},u.prototype.writeFloatBE=function(g,b,U){return Bt(this,g,b,!1,U)};function he(R,g,b,U,W){return g=+g,b=b>>>0,W||jt(R,g,b,8),r.write(R,g,b,U,52,8),b+8}u.prototype.writeDoubleLE=function(g,b,U){return he(this,g,b,!0,U)},u.prototype.writeDoubleBE=function(g,b,U){return he(this,g,b,!1,U)},u.prototype.copy=function(g,b,U,W){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(U||(U=0),!W&&W!==0&&(W=this.length),b>=g.length&&(b=g.length),b||(b=0),W>0&&W<U&&(W=U),W===U||g.length===0||this.length===0)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(U<0||U>=this.length)throw new RangeError("Index out of range");if(W<0)throw new RangeError("sourceEnd out of bounds");W>this.length&&(W=this.length),g.length-b<W-U&&(W=g.length-b+U);const rt=W-U;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(b,U,W):s.prototype.set.call(g,this.subarray(U,W),b),rt},u.prototype.fill=function(g,b,U,W){if(typeof g=="string"){if(typeof b=="string"?(W=b,b=0,U=this.length):typeof U=="string"&&(W=U,U=this.length),W!==void 0&&typeof W!="string")throw new TypeError("encoding must be a string");if(typeof W=="string"&&!u.isEncoding(W))throw new TypeError("Unknown encoding: "+W);if(g.length===1){const ct=g.charCodeAt(0);(W==="utf8"&&ct<128||W==="latin1")&&(g=ct)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(b<0||this.length<b||this.length<U)throw new RangeError("Out of range index");if(U<=b)return this;b=b>>>0,U=U===void 0?this.length:U>>>0,g||(g=0);let rt;if(typeof g=="number")for(rt=b;rt<U;++rt)this[rt]=g;else{const ct=u.isBuffer(g)?g:u.from(g,W),Vt=ct.length;if(Vt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(rt=0;rt<U-b;++rt)this[rt+b]=ct[rt%Vt]}return this};const Zt={};function Me(R,g,b){Zt[R]=class extends b{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${R}]`,this.stack,delete this.name}get code(){return R}set code(W){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:W,writable:!0})}toString(){return`${this.name} [${R}]: ${this.message}`}}}Me("ERR_BUFFER_OUT_OF_BOUNDS",function(R){return R?`${R} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Me("ERR_INVALID_ARG_TYPE",function(R,g){return`The "${R}" argument must be of type number. Received type ${typeof g}`},TypeError),Me("ERR_OUT_OF_RANGE",function(R,g,b){let U=`The value of "${R}" is out of range.`,W=b;return Number.isInteger(b)&&Math.abs(b)>2**32?W=Ge(String(b)):typeof b=="bigint"&&(W=String(b),(b>BigInt(2)**BigInt(32)||b<-(BigInt(2)**BigInt(32)))&&(W=Ge(W)),W+="n"),U+=` It must be ${g}. Received ${W}`,U},RangeError);function Ge(R){let g="",b=R.length;const U=R[0]==="-"?1:0;for(;b>=U+4;b-=3)g=`_${R.slice(b-3,b)}${g}`;return`${R.slice(0,b)}${g}`}function x(R,g,b){it(g,"offset"),(R[g]===void 0||R[g+b]===void 0)&&j(g,R.length-(b+1))}function lt(R,g,b,U,W,rt){if(R>b||R<g){const ct=typeof g=="bigint"?"n":"";let Vt;throw g===0||g===BigInt(0)?Vt=`>= 0${ct} and < 2${ct} ** ${(rt+1)*8}${ct}`:Vt=`>= -(2${ct} ** ${(rt+1)*8-1}${ct}) and < 2 ** ${(rt+1)*8-1}${ct}`,new Zt.ERR_OUT_OF_RANGE("value",Vt,R)}x(U,W,rt)}function it(R,g){if(typeof R!="number")throw new Zt.ERR_INVALID_ARG_TYPE(g,"number",R)}function j(R,g,b){throw Math.floor(R)!==R?(it(R,b),new Zt.ERR_OUT_OF_RANGE("offset","an integer",R)):g<0?new Zt.ERR_BUFFER_OUT_OF_BOUNDS:new Zt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,R)}const F=/[^+/0-9A-Za-z-_]/g;function V(R){if(R=R.split("=")[0],R=R.trim().replace(F,""),R.length<2)return"";for(;R.length%4!==0;)R=R+"=";return R}function ht(R,g){g=g||1/0;let b;const U=R.length;let W=null;const rt=[];for(let ct=0;ct<U;++ct){if(b=R.charCodeAt(ct),b>55295&&b<57344){if(!W){if(b>56319){(g-=3)>-1&&rt.push(239,191,189);continue}else if(ct+1===U){(g-=3)>-1&&rt.push(239,191,189);continue}W=b;continue}if(b<56320){(g-=3)>-1&&rt.push(239,191,189),W=b;continue}b=(W-55296<<10|b-56320)+65536}else W&&(g-=3)>-1&&rt.push(239,191,189);if(W=null,b<128){if((g-=1)<0)break;rt.push(b)}else if(b<2048){if((g-=2)<0)break;rt.push(b>>6|192,b&63|128)}else if(b<65536){if((g-=3)<0)break;rt.push(b>>12|224,b>>6&63|128,b&63|128)}else if(b<1114112){if((g-=4)<0)break;rt.push(b>>18|240,b>>12&63|128,b>>6&63|128,b&63|128)}else throw new Error("Invalid code point")}return rt}function dt(R){const g=[];for(let b=0;b<R.length;++b)g.push(R.charCodeAt(b)&255);return g}function tt(R,g){let b,U,W;const rt=[];for(let ct=0;ct<R.length&&!((g-=2)<0);++ct)b=R.charCodeAt(ct),U=b>>8,W=b%256,rt.push(W),rt.push(U);return rt}function gt(R){return t.toByteArray(V(R))}function xt(R,g,b,U){let W;for(W=0;W<U&&!(W+b>=g.length||W>=R.length);++W)g[W+b]=R[W];return W}function mt(R,g){return R instanceof g||R!=null&&R.constructor!=null&&R.constructor.name!=null&&R.constructor.name===g.name}function Ct(R){return R!==R}const ge=function(){const R="0123456789abcdef",g=new Array(256);for(let b=0;b<16;++b){const U=b*16;for(let W=0;W<16;++W)g[U+W]=R[b]+R[W]}return g}();function Gt(R){return typeof BigInt>"u"?nn:R}function nn(){throw new Error("BigInt not supported")}})(bm);const wr=bm.Buffer,Em=e=>e===void 0?null:e;class TS{constructor(){this.map=new Map}setItem(t,r){this.map.set(t,r)}getItem(t){return this.map.get(t)}}let km=new TS,SS=!0;try{typeof localStorage<"u"&&localStorage&&(km=localStorage,SS=!1)}catch{}const RS=km,OS=Object.assign,IS=Object.keys,NS=(e,t)=>{for(const r in e)t(e[r],r)},vm=e=>IS(e).length,CS=e=>{for(const t in e)return!1;return!0},LS=(e,t)=>{for(const r in e)if(!t(e[r],r))return!1;return!0},MS=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),US=(e,t)=>e===t||vm(e)===vm(t)&&LS(e,(r,n)=>(r!==void 0||MS(t,n))&&t[n]===r),PS=Object.freeze,xm=e=>{for(const t in e){const r=e[t];(typeof r=="object"||typeof r=="function")&&xm(e[t])}return PS(e)},Hh=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&Hh(e,t,r+1)}},$S=e=>e,FS=(e,t)=>t.includes(e);var Am={};const aa=typeof Ln<"u"&&Ln.release&&/node|io\.js/.test(Ln.release.name)&&Object.prototype.toString.call(typeof Ln<"u"?Ln:0)==="[object process]";let ti;const BS=()=>{if(ti===void 0)if(aa){ti=Mn();const e=Ln.argv;let t=null;for(let r=0;r<e.length;r++){const n=e[r];n[0]==="-"?(t!==null&&ti.set(t,""),t=n):t!==null&&(ti.set(t,n),t=null)}t!==null&&ti.set(t,"")}else typeof location=="object"?(ti=Mn(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,r]=e.split("=");ti.set(`--${lm(t,"-")}`,r),ti.set(`-${lm(t,"-")}`,r)}})):ti=Mn();return ti},Kh=e=>BS().has(e),Uc=e=>Em(aa?Am[e.toUpperCase().replaceAll("-","_")]:RS.getItem(e)),Tm=e=>Kh("--"+e)||Uc(e)!==null;Tm("production");const DS=aa&&FS(Am.FORCE_COLOR,["true","1","2"])||!Kh("--no-colors")&&!Tm("no-color")&&(!aa||Ln.stdout.isTTY)&&(!aa||Kh("--color")||Uc("COLORTERM")!==null||(Uc("TERM")||"").includes("color")),jS=e=>new Uint8Array(e),zS=e=>{const t=jS(e.byteLength);return t.set(e),t};class GS{constructor(t,r){this.left=t,this.right=r}}const Ei=(e,t)=>new GS(e,t);typeof DOMParser<"u"&&new DOMParser;const WS=e=>zT(e,(t,r)=>`${r}:${t};`).join(""),ki=Symbol,Sm=ki(),Rm=ki(),HS=ki(),KS=ki(),YS=ki(),Om=ki(),VS=ki(),Yh=ki(),qS=ki(),XS=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],r=[];let n=0;for(;n<e.length;n++){const s=e[n];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(n>0&&r.push(t.join(""));n<e.length;n++){const s=e[n];s instanceof Symbol||r.push(s)}return r},JS={[Sm]:Ei("font-weight","bold"),[Rm]:Ei("font-weight","normal"),[HS]:Ei("color","blue"),[YS]:Ei("color","green"),[KS]:Ei("color","grey"),[Om]:Ei("color","red"),[VS]:Ei("color","purple"),[Yh]:Ei("color","orange"),[qS]:Ei("color","black")},Im=DS?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],r=[],n=Mn();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=JS[a];if(c!==void 0)n.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=WS(n);s>0||l.length>0?(t.push("%c"+a),r.push(l)):t.push(a)}else break}}for(s>0&&(i=r,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:XS,ZS=(...e)=>{console.log(...Im(e)),Nm.forEach(t=>t.print(e))},QS=(...e)=>{console.warn(...Im(e)),e.unshift(Yh),Nm.forEach(t=>t.print(e))},Nm=Qs(),Cm=e=>({[Symbol.iterator](){return this},next:e}),tR=(e,t)=>Cm(()=>{let r;do r=e.next();while(!r.done&&!t(r.value));return r}),Vh=(e,t)=>Cm(()=>{const{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}});class qh{constructor(t,r){this.clock=t,this.len=r}}class ca{constructor(){this.clients=new Map}}const Lm=(e,t,r)=>t.clients.forEach((n,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<n.length;o++){const a=n[o];qm(e,s,a.clock,a.len,r)}}),eR=(e,t)=>{let r=0,n=e.length-1;for(;r<=n;){const i=ji((r+n)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;r=i+1}else n=i-1}return null},Mm=(e,t)=>{const r=e.clients.get(t.client);return r!==void 0&&eR(r,t.clock)!==null},Xh=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let r,n;for(r=1,n=1;r<t.length;r++){const i=t[n-1],s=t[r];i.clock+i.len>=s.clock?i.len=ys(i.len,s.clock+s.len-i.clock):(n<r&&(t[n]=s),n++)}t.length=n})},rR=e=>{const t=new ca;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,i)=>{if(!t.clients.has(i)){const s=n.slice();for(let o=r+1;o<e.length;o++)WT(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Xh(t),t},Pc=(e,t,r,n)=>{Di(e.clients,t,()=>[]).push(new qh(r,n))},nR=()=>new ca,iR=e=>{const t=nR();return e.clients.forEach((r,n)=>{const i=[];for(let s=0;s<r.length;s++){const o=r[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<r.length)for(let l=r[s+1];s+1<r.length&&l.deleted;l=r[++s+1])c+=l.length;i.push(new qh(a,c))}}i.length>0&&t.clients.set(n,i)}),t},so=(e,t)=>{ae(e.restEncoder,t.clients.size),gs(t.clients.entries()).sort((r,n)=>n[0]-r[0]).forEach(([r,n])=>{e.resetDsCurVal(),ae(e.restEncoder,r);const i=n.length;ae(e.restEncoder,i);for(let s=0;s<i;s++){const o=n[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Jh=e=>{const t=new ca,r=Xt(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();const i=Xt(e.restDecoder),s=Xt(e.restDecoder);if(s>0){const o=Di(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new qh(e.readDsClock(),e.readDsLen()))}}return t},Um=(e,t,r)=>{const n=new ca,i=Xt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Xt(e.restDecoder),a=Xt(e.restDecoder),c=r.clients.get(o)||[],l=hr(r,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&Pc(n,o,l,d-l);let h=ei(c,f),m=c[h];for(!m.deleted&&m.id.clock<f&&(c.splice(h+1,0,Xc(t,m,f-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(h,0,Xc(t,m,d-m.id.clock)),m.delete(t))}else Pc(n,o,f,d-f)}}if(n.clients.size>0){const s=new bs;return ae(s.restEncoder,0),so(s,n),s.toUint8Array()}return null},Pm=ym;class oo extends KT{constructor({guid:t=yS(),collectionid:r=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=Pm(),this.guid=t,this.collectionid=r,this.share=new Map,this.store=new Km,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=_m(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>_m(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&ye(t.parent.doc,r=>{r.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(gs(this.subdocs).map(t=>t.guid))}transact(t,r=null){return ye(this,t,r)}get(t,r=Er){const n=Di(this.share,t,()=>{const s=new r;return s._integrate(this,null),s}),i=n.constructor;if(r!==Er&&i!==r)if(i===Er){const s=new r;s._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=n._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=n._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,uo)}getText(t=""){return this.get(t,vi)}getMap(t=""){return this.get(t,ho)}getXmlElement(t=""){return this.get(t,po)}getXmlFragment(t=""){return this.get(t,ws)}toJSON(){const t={};return this.share.forEach((r,n)=>{t[n]=r.toJSON()}),t}destroy(){this.isDestroyed=!0,gs(this.subdocs).forEach(r=>r.destroy());const t=this._item;if(t!==null){this._item=null;const r=t.content;r.doc=new oo({guid:this.guid,...r.opts,shouldLoad:!1}),r.doc._item=t,ye(t.parent.doc,n=>{const i=r.doc;t.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class $m{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Xt(this.restDecoder)}readDsLen(){return Xt(this.restDecoder)}}class Fm extends $m{readLeftID(){return ee(Xt(this.restDecoder),Xt(this.restDecoder))}readRightID(){return ee(Xt(this.restDecoder),Xt(this.restDecoder))}readClient(){return Xt(this.restDecoder)}readInfo(){return ro(this.restDecoder)}readString(){return no(this.restDecoder)}readParentInfo(){return Xt(this.restDecoder)===1}readTypeRef(){return Xt(this.restDecoder)}readLen(){return Xt(this.restDecoder)}readAny(){return oa(this.restDecoder)}readBuf(){return zS(ln(this.restDecoder))}readJSON(){return JSON.parse(no(this.restDecoder))}readKey(){return no(this.restDecoder)}}class sR{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Xt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Xt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class ao extends sR{constructor(t){super(t),this.keys=[],Xt(t),this.keyClockDecoder=new zh(ln(t)),this.clientDecoder=new Lc(ln(t)),this.leftClockDecoder=new zh(ln(t)),this.rightClockDecoder=new zh(ln(t)),this.infoDecoder=new gm(ln(t),ro),this.stringDecoder=new pS(ln(t)),this.parentInfoDecoder=new gm(ln(t),ro),this.typeRefDecoder=new Lc(ln(t)),this.lenDecoder=new Lc(ln(t))}readLeftID(){return new co(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new co(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return oa(this.restDecoder)}readBuf(){return ln(this.restDecoder)}readJSON(){return oa(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const r=this.stringDecoder.read();return this.keys.push(r),r}}}class oR{constructor(){this.restEncoder=Oc()}toUint8Array(){return Xn(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){ae(this.restEncoder,t)}writeDsLen(t){ae(this.restEncoder,t)}}class la extends oR{writeLeftID(t){ae(this.restEncoder,t.client),ae(this.restEncoder,t.clock)}writeRightID(t){ae(this.restEncoder,t.client),ae(this.restEncoder,t.clock)}writeClient(t){ae(this.restEncoder,t)}writeInfo(t){Uh(this.restEncoder,t)}writeString(t){to(this.restEncoder,t)}writeParentInfo(t){ae(this.restEncoder,t?1:0)}writeTypeRef(t){ae(this.restEncoder,t)}writeLen(t){ae(this.restEncoder,t)}writeAny(t){sa(this.restEncoder,t)}writeBuf(t){cn(this.restEncoder,t)}writeJSON(t){to(this.restEncoder,JSON.stringify(t))}writeKey(t){to(this.restEncoder,t)}}class aR{constructor(){this.restEncoder=Oc(),this.dsCurrVal=0}toUint8Array(){return Xn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const r=t-this.dsCurrVal;this.dsCurrVal=t,ae(this.restEncoder,r)}writeDsLen(t){t===0&&Zn(),ae(this.restEncoder,t-1),this.dsCurrVal+=t}}class bs extends aR{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Bh,this.clientEncoder=new Nc,this.leftClockEncoder=new Bh,this.rightClockEncoder=new Bh,this.infoEncoder=new hm(Uh),this.stringEncoder=new uS,this.parentInfoEncoder=new hm(Uh),this.typeRefEncoder=new Nc,this.lenEncoder=new Nc}toUint8Array(){const t=Oc();return ae(t,0),cn(t,this.keyClockEncoder.toUint8Array()),cn(t,this.clientEncoder.toUint8Array()),cn(t,this.leftClockEncoder.toUint8Array()),cn(t,this.rightClockEncoder.toUint8Array()),cn(t,Xn(this.infoEncoder)),cn(t,this.stringEncoder.toUint8Array()),cn(t,Xn(this.parentInfoEncoder)),cn(t,this.typeRefEncoder.toUint8Array()),cn(t,this.lenEncoder.toUint8Array()),Ic(t,Xn(this.restEncoder)),Xn(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){sa(this.restEncoder,t)}writeBuf(t){cn(this.restEncoder,t)}writeJSON(t){sa(this.restEncoder,t)}writeKey(t){const r=this.keyMap.get(t);r===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(r)}}const cR=(e,t,r,n)=>{n=ys(n,t[0].id.clock);const i=ei(t,n);ae(e.restEncoder,t.length-i),e.writeClient(r),ae(e.restEncoder,n);const s=t[i];s.write(e,n-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Zh=(e,t,r)=>{const n=new Map;r.forEach((i,s)=>{hr(t,s)>i&&n.set(s,i)}),tf(t).forEach((i,s)=>{r.has(s)||n.set(s,0)}),ae(e.restEncoder,n.size),gs(n.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{cR(e,t.clients.get(i),i,s)})},lR=(e,t)=>{const r=Mn(),n=Xt(e.restDecoder);for(let i=0;i<n;i++){const s=Xt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Xt(e.restDecoder);r.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(Rc&u){case 0:{const f=e.readLen();o[l]=new gn(ee(a,c),f),c+=f;break}case 10:{const f=Xt(e.restDecoder);o[l]=new yn(ee(a,c),f),c+=f;break}default:{const f=(u&(wi|an))===0,d=new rr(ee(a,c),null,(u&an)===an?e.readLeftID():null,null,(u&wi)===wi?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&ea)===ea?e.readString():null,wg(e,u));o[l]=d,c+=d.length}}}}return r},uR=(e,t,r)=>{const n=[];let i=gs(r.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=r.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=r.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new Km,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of n){const m=h.id.client,p=r.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),r.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(_=>_!==m)}n.length=0};for(;;){if(u.constructor!==yn){const m=Di(f,u.id.client,()=>hr(t,u.id.client))-u.id.clock;if(m<0)n.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(e,t);if(p!==null){n.push(u);const _=r.get(p)||{refs:[],i:0};if(_.refs.length===_.i)l(p,hr(t,p)),d();else{u=_.refs[_.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),f.set(u.id.client,u.id.clock+u.length))}}if(n.length>0)u=n.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new bs;return Zh(h,a,new Map),ae(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},hR=(e,t)=>Zh(e,t.doc.store,t.beforeState),fR=(e,t,r,n=new ao(e))=>ye(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=lR(n,o),l=uR(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<hr(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const m=u.missing.get(d);(m==null||m>h)&&u.missing.set(d,h)}u.update=Bc([u.update,l.update])}}else a.pendingStructs=l;const f=Um(n,i,a);if(a.pendingDs){const d=new ao(eo(a.pendingDs));Xt(d.restDecoder);const h=Um(d,i,a);f&&h?a.pendingDs=Bc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,Bm(i.doc,d)}},r,!1),Bm=(e,t,r,n=ao)=>{const i=eo(t);fR(i,e,r,new n(i))},Dm=(e,t,r)=>Bm(e,t,r,Fm),dR=(e,t,r=new Map)=>{Zh(e,t.store,r),so(e,iR(t.store))},pR=(e,t=new Uint8Array([0]),r=new bs)=>{const n=jm(t);dR(r,e,n);const i=[r.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(TR(e.store.pendingStructs.update,t)),i.length>1){if(r.constructor===la)return xR(i.map((s,o)=>o===0?s:RR(s)));if(r.constructor===bs)return Bc(i)}return i[0]},mR=(e,t)=>pR(e,t,new la),gR=e=>{const t=new Map,r=Xt(e.restDecoder);for(let n=0;n<r;n++){const i=Xt(e.restDecoder),s=Xt(e.restDecoder);t.set(i,s)}return t},jm=e=>gR(new $m(eo(e)));class yR{constructor(){this.l=[]}}const zm=()=>new yR,Gm=(e,t)=>e.l.push(t),Wm=(e,t)=>{const r=e.l,n=r.length;e.l=r.filter(i=>t!==i),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Hm=(e,t,r)=>Hh(e.l,[t,r]);class co{constructor(t,r){this.client=t,this.clock=r}}const $c=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,ee=(e,t)=>new co(e,t),_R=e=>{for(const[t,r]of e.doc.share.entries())if(r===e)return t;throw Zn()},lo=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Mm(t.ds,e.id),Qh=(e,t)=>{const r=Di(e.meta,Qh,Qs),n=e.doc.store;r.has(t)||(t.sv.forEach((i,s)=>{i<hr(n,s)&&Gi(e,ee(s,i))}),Lm(e,t.ds,i=>{}),r.add(t))};class Km{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const tf=e=>{const t=new Map;return e.clients.forEach((r,n)=>{const i=r[r.length-1];t.set(n,i.id.clock+i.length)}),t},hr=(e,t)=>{const r=e.clients.get(t);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},Ym=(e,t)=>{let r=e.clients.get(t.id.client);if(r===void 0)r=[],e.clients.set(t.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==t.id.clock)throw Zn()}r.push(t)},ei=(e,t)=>{let r=0,n=e.length-1,i=e[n],s=i.id.clock;if(s===t)return n;let o=ji(t/(s+i.length-1)*n);for(;r<=n;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;r=o+1}else n=o-1;o=ji((r+n)/2)}throw Zn()},ef=(e,t)=>{const r=e.clients.get(t.client);return r[ei(r,t.clock)]},rf=(e,t,r)=>{const n=ei(t,r),i=t[n];return i.id.clock<r&&i instanceof rr?(t.splice(n+1,0,Xc(e,i,r-i.id.clock)),n+1):n},Gi=(e,t)=>{const r=e.doc.store.clients.get(t.client);return r[rf(e,r,t.clock)]},Vm=(e,t,r)=>{const n=t.clients.get(r.client),i=ei(n,r.clock),s=n[i];return r.clock!==s.id.clock+s.length-1&&s.constructor!==gn&&n.splice(i+1,0,Xc(e,s,r.clock-s.id.clock+1)),s},bR=(e,t,r)=>{const n=e.clients.get(t.id.client);n[ei(n,t.id.clock)]=r},qm=(e,t,r,n,i)=>{if(n===0)return;const s=r+n;let o=rf(e,t,r),a;do a=t[o++],s<a.id.clock+a.length&&rf(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class wR{constructor(t,r,n){this.doc=t,this.deleteSet=new ca,this.beforeState=tf(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=r,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Xm=(e,t)=>t.deleteSet.clients.size===0&&!GT(t.afterState,(r,n)=>t.beforeState.get(n)!==r)?!1:(Xh(t.deleteSet),hR(e,t),so(e,t.deleteSet),!0),Jm=(e,t,r)=>{const n=t._item;(n===null||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&Di(e.changed,t,Qs).add(r)},Fc=(e,t)=>{let r=e[t],n=e[t-1],i=t;for(;i>0;r=n,n=e[--i-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof rr&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},ER=(e,t,r)=>{for(const[n,i]of e.clients.entries()){const s=t.clients.get(n);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ei(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof rr&&f.deleted&&!f.keep&&r(f)&&f.gc(t,!1)}}}},kR=(e,t)=>{e.clients.forEach((r,n)=>{const i=t.clients.get(n);for(let s=r.length-1;s>=0;s--){const o=r[s],a=im(i.length-1,1+ei(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Fc(i,c)}})},Zm=(e,t)=>{if(t<e.length){const r=e[t],n=r.doc,i=n.store,s=r.deleteSet,o=r._mergeStructs;try{Xh(s),r.afterState=tf(r.doc.store),n.emit("beforeObserverCalls",[r,n]);const a=[];r.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(r,c)})),a.push(()=>{r.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),Hm(l._dEH,c,r))})}),a.push(()=>n.emit("afterTransaction",[r,n])),Hh(a,[]),r._needFormattingCleanup&&zR(r)}finally{n.gc&&ER(s,i,n.gcFilter),kR(s,i),r.afterState.forEach((u,f)=>{const d=r.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),m=ys(ei(h,d),1);for(let p=h.length-1;p>=m;)p-=1+Fc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),m=ei(h,d);m+1<h.length&&Fc(h,m+1)>1||m>0&&Fc(h,m)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(ZS(Yh,Sm,"[yjs] ",Rm,Om,"Changed the client-id because another client seems to be using it."),n.clientID=Pm()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const u=new la;Xm(u,r)&&n.emit("update",[u.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const u=new bs;Xm(u,r)&&n.emit("updateV2",[u.toUint8Array(),r.origin,n,r])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=r;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=n.clientID,u.collectionid==null&&(u.collectionid=n.collectionid),n.subdocs.add(u)}),l.forEach(u=>n.subdocs.delete(u)),n.emit("subdocs",[{loaded:c,added:a,removed:l},n,r]),l.forEach(u=>u.destroy())),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):Zm(e,t+1)}}},ye=(e,t,r=null,n=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new wR(e,r,n),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Zm(i,0)}}return o};function*vR(e){const t=Xt(e.restDecoder);for(let r=0;r<t;r++){const n=Xt(e.restDecoder),i=e.readClient();let s=Xt(e.restDecoder);for(let o=0;o<n;o++){const a=e.readInfo();if(a===10){const c=Xt(e.restDecoder);yield new yn(ee(i,s),c),s+=c}else if(Rc&a){const c=(a&(wi|an))===0,l=new rr(ee(i,s),null,(a&an)===an?e.readLeftID():null,null,(a&wi)===wi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&ea)===ea?e.readString():null,wg(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new gn(ee(i,s),c),s+=c}}}}class nf{constructor(t,r){this.gen=vR(t),this.curr=null,this.done=!1,this.filterSkips=r,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===yn);return this.curr}}class sf{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const xR=e=>Bc(e,Fm,la),AR=(e,t)=>{if(e.constructor===gn){const{client:r,clock:n}=e.id;return new gn(ee(r,n+t),e.length-t)}else if(e.constructor===yn){const{client:r,clock:n}=e.id;return new yn(ee(r,n+t),e.length-t)}else{const r=e,{client:n,clock:i}=r.id;return new rr(ee(n,i+t),null,ee(n,i+t-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(t))}},Bc=(e,t=ao,r=bs)=>{if(e.length===1)return e[0];const n=e.map(u=>new t(eo(u)));let i=n.map(u=>new nf(u,!0)),s=null;const o=new r,a=new sf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const m=d.curr.id.clock-h.curr.id.clock;return m===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===yn?1:-1:m}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Wi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===yn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Wi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new yn(ee(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===yn?s.struct.length-=m:d=AR(d,m)),s.struct.mergeWith(d)||(Wi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==yn;d=u.next())Wi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Wi(a,s.struct,s.offset),s=null),of(a);const c=n.map(u=>Jh(u)),l=rR(c);return so(o,l),o.toUint8Array()},TR=(e,t,r=ao,n=bs)=>{const i=jm(t),s=new n,o=new sf(s),a=new r(eo(e)),c=new nf(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===yn){c.next();continue}if(u.id.clock+u.length>d)for(Wi(o,u,ys(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Wi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}of(o);const l=Jh(a);return so(s,l),s.toUint8Array()},Qm=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Xn(e.encoder.restEncoder)}),e.encoder.restEncoder=Oc(),e.written=0)},Wi=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&Qm(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ae(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},of=e=>{Qm(e);const t=e.encoder.restEncoder;ae(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){const n=e.clientStructs[r];ae(t,n.written),Ic(t,n.restEncoder)}},SR=(e,t,r,n)=>{const i=new r(eo(e)),s=new nf(i,!1),o=new n,a=new sf(o);for(let l=s.curr;l!==null;l=s.next())Wi(a,t(l),0);of(a);const c=Jh(i);return so(o,c),o.toUint8Array()},RR=e=>SR(e,$S,ao,la),tg="You must not compute changes after the event-handler fired.";class Dc{constructor(t,r){this.target=t,this.currentTarget=t,this.transaction=r,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=OR(this.currentTarget,this.target))}deletes(t){return Mm(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw zi(tg);const t=new Map,r=this.target;this.transaction.changed.get(r).forEach(i=>{if(i!==null){const s=r._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Nh(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Nh(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Nh(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw zi(tg);const r=this.target,n=Qs(),i=Qs(),s=[];if(t={added:n,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(r).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=r._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),n.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const OR=(e,t)=>{const r=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)r.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;r.unshift(n)}t=t._item.parent}return r},Ar=()=>{QS("Invalid access: Add Yjs type to a document before reading data.")},eg=80;let af=0;class IR{constructor(t,r){t.marker=!0,this.p=t,this.index=r,this.timestamp=af++}}const NR=e=>{e.timestamp=af++},rg=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=af++},CR=(e,t,r)=>{if(e.length>=eg){const n=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return rg(n,t,r),n}else{const n=new IR(t,r);return e.push(n),n}},jc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const r=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Sc(t-s.index)<Sc(t-o.index)?s:o);let n=e._start,i=0;for(r!==null&&(n=r.p,i=r.index,NR(r));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&Sc(r.index-i)<n.parent.length/eg?(rg(r,n,i),r):CR(e._searchMarker,n,i)},ua=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){const i=e[n];if(r>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(n,1);continue}i.p=s,s.marker=!0}(t<i.index||r>0&&t===i.index)&&(i.index=ys(t,i.index+r))}},zc=(e,t,r)=>{const n=e,i=t.changedParentTypes;for(;Di(i,e,()=>[]).push(r),e._item!==null;)e=e._item.parent;Hm(n._eH,r,t)};class Er{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=zm(),this._dEH=zm(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,r){this.doc=t,this._item=r}_copy(){throw Jn()}clone(){throw Jn()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,r){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Gm(this._eH,t)}observeDeep(t){Gm(this._dEH,t)}unobserve(t){Wm(this._eH,t)}unobserveDeep(t){Wm(this._dEH,t)}toJSON(){}}const ng=(e,t,r)=>{e.doc??Ar(),t<0&&(t=e._length+t),r<0&&(r=e._length+r);let n=r-t;const i=[];let s=e._start;for(;s!==null&&n>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&n>0;a++)i.push(o[a]),n--;t=0}}s=s.right}return i},ig=e=>{e.doc??Ar();const t=[];let r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}r=r.right}return t},ha=(e,t)=>{let r=0,n=e._start;for(e.doc??Ar();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)t(i[s],r++,e)}n=n.right}},sg=(e,t)=>{const r=[];return ha(e,(n,i)=>{r.push(t(n,i,e))}),r},LR=e=>{let t=e._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};r=t.content.getContent(),n=0,t=t.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},og=(e,t)=>{e.doc??Ar();const r=jc(e,t);let n=e._start;for(r!==null&&(n=r.p,t-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Gc=(e,t,r,n)=>{let i=r;const s=e.doc,o=s.clientID,a=s.store,c=r===null?t._start:r.right;let l=[];const u=()=>{l.length>0&&(i=new rr(ee(o,hr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ks(l)),i.integrate(e,0),l=[])};n.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new rr(ee(o,hr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new fa(new Uint8Array(f))),i.integrate(e,0);break;case oo:i=new rr(ee(o,hr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new pa(f)),i.integrate(e,0);break;default:if(f instanceof Er)i=new rr(ee(o,hr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new xi(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},ag=()=>zi("Length exceeded!"),cg=(e,t,r,n)=>{if(r>t._length)throw ag();if(r===0)return t._searchMarker&&ua(t._searchMarker,r,n.length),Gc(e,t,null,n);const i=r,s=jc(t,r);let o=t._start;for(s!==null&&(o=s.p,r-=s.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&Gi(e,ee(o.id.client,o.id.clock+r));break}r-=o.length}return t._searchMarker&&ua(t._searchMarker,i,n.length),Gc(e,t,o,n)},MR=(e,t,r)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Gc(e,t,i,r)},lg=(e,t,r,n)=>{if(n===0)return;const i=r,s=n,o=jc(t,r);let a=t._start;for(o!==null&&(a=o.p,r-=o.index);a!==null&&r>0;a=a.right)!a.deleted&&a.countable&&(r<a.length&&Gi(e,ee(a.id.client,a.id.clock+r)),r-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&Gi(e,ee(a.id.client,a.id.clock+n)),a.delete(e),n-=a.length),a=a.right;if(n>0)throw ag();t._searchMarker&&ua(t._searchMarker,i,-s+n)},Wc=(e,t,r)=>{const n=t._map.get(r);n!==void 0&&n.delete(e)},cf=(e,t,r,n)=>{const i=t._map.get(r)||null,s=e.doc,o=s.clientID;let a;if(n==null)a=new ks([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ks([n]);break;case Uint8Array:a=new fa(n);break;case oo:a=new pa(n);break;default:if(n instanceof Er)a=new xi(n);else throw new Error("Unexpected content type")}new rr(ee(o,hr(s.store,o)),i,i&&i.lastId,null,null,t,r,a).integrate(e,0)},lf=(e,t)=>{e.doc??Ar();const r=e._map.get(t);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},ug=e=>{const t={};return e.doc??Ar(),e._map.forEach((r,n)=>{r.deleted||(t[n]=r.content.getContent()[r.length-1])}),t},hg=(e,t)=>{e.doc??Ar();const r=e._map.get(t);return r!==void 0&&!r.deleted},UR=(e,t)=>{const r={};return e._map.forEach((n,i)=>{let s=n;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&lo(s,t)&&(r[i]=s.content.getContent()[s.length-1])}),r},Hc=e=>(e.doc??Ar(),tR(e._map.entries(),t=>!t[1].deleted));class PR extends Dc{}class uo extends Er{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const r=new uo;return r.push(t),r}_integrate(t,r){super._integrate(t,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new uo}clone(){const t=new uo;return t.insert(0,this.toArray().map(r=>r instanceof Er?r.clone():r)),t}get length(){return this.doc??Ar(),this._length}_callObserver(t,r){super._callObserver(t,r),zc(this,t,new PR(this,t))}insert(t,r){this.doc!==null?ye(this.doc,n=>{cg(n,this,t,r)}):this._prelimContent.splice(t,0,...r)}push(t){this.doc!==null?ye(this.doc,r=>{MR(r,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,r=1){this.doc!==null?ye(this.doc,n=>{lg(n,this,t,r)}):this._prelimContent.splice(t,r)}get(t){return og(this,t)}toArray(){return ig(this)}slice(t=0,r=this.length){return ng(this,t,r)}toJSON(){return this.map(t=>t instanceof Er?t.toJSON():t)}map(t){return sg(this,t)}forEach(t){ha(this,t)}[Symbol.iterator](){return LR(this)}_write(t){t.writeTypeRef(aO)}}const $R=e=>new uo;class FR extends Dc{constructor(t,r,n){super(t,r),this.keysChanged=n}}class ho extends Er{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,r){super._integrate(t,r),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new ho}clone(){const t=new ho;return this.forEach((r,n)=>{t.set(n,r instanceof Er?r.clone():r)}),t}_callObserver(t,r){zc(this,t,new FR(this,t,r))}toJSON(){this.doc??Ar();const t={};return this._map.forEach((r,n)=>{if(!r.deleted){const i=r.content.getContent()[r.length-1];t[n]=i instanceof Er?i.toJSON():i}}),t}get size(){return[...Hc(this)].length}keys(){return Vh(Hc(this),t=>t[0])}values(){return Vh(Hc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Vh(Hc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??Ar(),this._map.forEach((r,n)=>{r.deleted||t(r.content.getContent()[r.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ye(this.doc,r=>{Wc(r,this,t)}):this._prelimContent.delete(t)}set(t,r){return this.doc!==null?ye(this.doc,n=>{cf(n,this,t,r)}):this._prelimContent.set(t,r),r}get(t){return lf(this,t)}has(t){return hg(this,t)}clear(){this.doc!==null?ye(this.doc,t=>{this.forEach(function(r,n,i){Wc(t,i,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(cO)}}const BR=e=>new ho,Hi=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&US(e,t);class uf{constructor(t,r,n,i){this.left=t,this.right=r,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Zn(),this.right.content.constructor){case er:this.right.deleted||fo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const fg=(e,t,r)=>{for(;t.right!==null&&r>0;){switch(t.right.content.constructor){case er:t.right.deleted||fo(t.currentAttributes,t.right.content);break;default:t.right.deleted||(r<t.right.length&&Gi(e,ee(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Kc=(e,t,r,n)=>{const i=new Map,s=n?jc(t,r):null;if(s){const o=new uf(s.p.left,s.p,s.index,i);return fg(e,o,r-s.index)}else{const o=new uf(null,t._start,0,i);return fg(e,o,r)}},dg=(e,t,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===er&&Hi(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=e.doc,s=i.clientID;n.forEach((o,a)=>{const c=r.left,l=r.right,u=new rr(ee(s,hr(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new er(a,o));u.integrate(e,0),r.right=u,r.forward()})},fo=(e,t)=>{const{key:r,value:n}=t;n===null?e.delete(r):e.set(r,n)},pg=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===er&&Hi(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},mg=(e,t,r,n)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in n){const c=n[a],l=r.currentAttributes.get(a)??null;if(!Hi(l,c)){o.set(a,l);const{left:u,right:f}=r;r.right=new rr(ee(s,hr(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new er(a,c)),r.right.integrate(e,0),r.forward()}}return o},hf=(e,t,r,n,i)=>{r.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;pg(r,i);const a=mg(e,t,r,i),c=n.constructor===String?new ri(n):n instanceof Er?new xi(n):new Es(n);let{left:l,right:u,index:f}=r;t._searchMarker&&ua(t._searchMarker,r.index,c.getLength()),u=new rr(ee(o,hr(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),r.right=u,r.index=f,r.forward(),dg(e,t,r,a)},gg=(e,t,r,n,i)=>{const s=e.doc,o=s.clientID;pg(r,i);const a=mg(e,t,r,i);t:for(;r.right!==null&&(n>0||a.size>0&&(r.right.deleted||r.right.content.constructor===er));){if(!r.right.deleted)switch(r.right.content.constructor){case er:{const{key:c,value:l}=r.right.content,u=i[c];if(u!==void 0){if(Hi(u,l))a.delete(c);else{if(n===0)break t;a.set(c,l)}r.right.delete(e)}else r.currentAttributes.set(c,l);break}default:n<r.right.length&&Gi(e,ee(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new rr(ee(o,hr(s.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new ri(c)),r.right.integrate(e,0),r.forward()}dg(e,t,r,a)},yg=(e,t,r,n,i)=>{let s=t;const o=Mn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===er){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(r===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case er:{const{key:u,value:f}=l,d=n.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&fo(i,l);break}}}t=t.right}return a},DR=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const r=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===er){const n=t.content.key;r.has(n)?t.delete(e):r.add(n)}t=t.left}},jR=e=>{let t=0;return ye(e.doc,r=>{let n=e._start,i=e._start,s=Mn();const o=Ih(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case er:fo(o,i.content);break;default:t+=yg(r,n,i,s,o),s=Ih(o),n=i;break}i=i.right}}),t},zR=e=>{const t=new Set,r=e.doc;for(const[n,i]of e.afterState.entries()){const s=e.beforeState.get(n)||0;i!==s&&qm(e,r.store.clients.get(n),s,i,o=>{!o.deleted&&o.content.constructor===er&&o.constructor!==gn&&t.add(o.parent)})}ye(r,n=>{Lm(e,e.deleteSet,i=>{if(i instanceof gn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===er?t.add(s):DR(n,i)});for(const i of t)jR(i)})},_g=(e,t,r)=>{const n=r,i=Ih(t.currentAttributes),s=t.right;for(;r>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case xi:case Es:case ri:r<t.right.length&&Gi(e,ee(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e);break}t.forward()}s&&yg(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&ua(o._searchMarker,t.index,-n+r),t};class GR extends Dc{constructor(t,r,n){super(t,r),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,r=[];ye(t,n=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},CS(c)||(h.attributes=OS({},c))),u=0;break}h&&r.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case xi:case Es:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ri:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case er:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;Hi(p,m)?m!==null&&o.delete(n):(a==="retain"&&d(),Hi(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;Hi(p,m)||(a==="retain"&&d(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&(Hi(p,m)?p!==null&&o.delete(n):(a==="retain"&&d(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&d(),fo(i,o.content));break}}o=o.right}for(d();r.length>0;){const h=r[r.length-1];if(h.retain!==void 0&&h.attributes===void 0)r.pop();else break}}),this._delta=r}return this._delta}}class vi extends Er{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Ar(),this._length}_integrate(t,r){super._integrate(t,r);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new vi}clone(){const t=new vi;return t.applyDelta(this.toDelta()),t}_callObserver(t,r){super._callObserver(t,r);const n=new GR(this,t,r);zc(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??Ar();let t="",r=this._start;for(;r!==null;)!r.deleted&&r.countable&&r.content.constructor===ri&&(t+=r.content.str),r=r.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:r=!0}={}){this.doc!==null?ye(this.doc,n=>{const i=new uf(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!r&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&hf(n,this,i,a,o.attributes||{})}else o.retain!==void 0?gg(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&_g(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,r,n){this.doc??Ar();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((m,p)=>{d=!0,f[p]=m});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(lo(c,t)||r!==void 0&&lo(c,r))switch(c.content.constructor){case ri:{const f=s.get("ychange");t!==void 0&&!lo(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",n?n("removed",c.id):{type:"removed"})):r!==void 0&&!lo(c,r)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",n?n("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case xi:case Es:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,m)=>{d[m]=h})}i.push(f);break}case er:lo(c,t)&&(l(),fo(s,c.content));break}c=c.right}l()};return t||r?ye(o,f=>{t&&Qh(f,t),r&&Qh(f,r),u()},"cleanup"):u(),i}insert(t,r,n){if(r.length<=0)return;const i=this.doc;i!==null?ye(i,s=>{const o=Kc(s,this,t,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),hf(s,this,o,r,n)}):this._pending.push(()=>this.insert(t,r,n))}insertEmbed(t,r,n){const i=this.doc;i!==null?ye(i,s=>{const o=Kc(s,this,t,!n);hf(s,this,o,r,n||{})}):this._pending.push(()=>this.insertEmbed(t,r,n||{}))}delete(t,r){if(r===0)return;const n=this.doc;n!==null?ye(n,i=>{_g(i,Kc(i,this,t,!0),r)}):this._pending.push(()=>this.delete(t,r))}format(t,r,n){if(r===0)return;const i=this.doc;i!==null?ye(i,s=>{const o=Kc(s,this,t,!1);o.right!==null&&gg(s,this,o,r,n)}):this._pending.push(()=>this.format(t,r,n))}removeAttribute(t){this.doc!==null?ye(this.doc,r=>{Wc(r,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,r){this.doc!==null?ye(this.doc,n=>{cf(n,this,t,r)}):this._pending.push(()=>this.setAttribute(t,r))}getAttribute(t){return lf(this,t)}getAttributes(){return ug(this)}_write(t){t.writeTypeRef(lO)}}const WR=e=>new vi;class ff{constructor(t,r=()=>!0){this._filter=r,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??Ar()}[Symbol.iterator](){return this}next(){let t=this._currentNode,r=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(r)))do if(r=t.content.type,!t.deleted&&(r.constructor===po||r.constructor===ws)&&r._start!==null)t=r._start;else for(;t!==null;){const n=t.next;if(n!==null){t=n;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class ws extends Er{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,r){super._integrate(t,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ws}clone(){const t=new ws;return t.insert(0,this.toArray().map(r=>r instanceof Er?r.clone():r)),t}get length(){return this.doc??Ar(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new ff(this,t)}querySelector(t){t=t.toUpperCase();const n=new ff(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),gs(new ff(this,r=>r.nodeName&&r.nodeName.toUpperCase()===t))}_callObserver(t,r){zc(this,t,new YR(this,r,t))}toString(){return sg(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,r={},n){const i=t.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),ha(this,s=>{i.insertBefore(s.toDOM(t,r,n),null)}),i}insert(t,r){this.doc!==null?ye(this.doc,n=>{cg(n,this,t,r)}):this._prelimContent.splice(t,0,...r)}insertAfter(t,r){if(this.doc!==null)ye(this.doc,n=>{const i=t&&t instanceof Er?t._item:t;Gc(n,this,i,r)});else{const n=this._prelimContent,i=t===null?0:n.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw zi("Reference item not found");n.splice(i,0,...r)}}delete(t,r=1){this.doc!==null?ye(this.doc,n=>{lg(n,this,t,r)}):this._prelimContent.splice(t,r)}toArray(){return ig(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return og(this,t)}slice(t=0,r=this.length){return ng(this,t,r)}forEach(t){ha(this,t)}_write(t){t.writeTypeRef(hO)}}const HR=e=>new ws;class po extends ws{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,r){super._integrate(t,r),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new po(this.nodeName)}clone(){const t=new po(this.nodeName),r=this.getAttributes();return NS(r,(n,i)=>{typeof n=="string"&&t.setAttribute(i,n)}),t.insert(0,this.toArray().map(n=>n instanceof Er?n.clone():n)),t}toString(){const t=this.getAttributes(),r=[],n=[];for(const a in t)n.push(a);n.sort();const i=n.length;for(let a=0;a<i;a++){const c=n[a];r.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=r.length>0?" "+r.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?ye(this.doc,r=>{Wc(r,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,r){this.doc!==null?ye(this.doc,n=>{cf(n,this,t,r)}):this._prelimAttrs.set(t,r)}getAttribute(t){return lf(this,t)}hasAttribute(t){return hg(this,t)}getAttributes(t){return t?UR(this,t):ug(this)}toDOM(t=document,r={},n){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return ha(this,o=>{i.appendChild(o.toDOM(t,r,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(uO),t.writeKey(this.nodeName)}}const KR=e=>new po(e.readKey());class YR extends Dc{constructor(t,r,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Yc extends ho{constructor(t){super(),this.hookName=t}_copy(){return new Yc(this.hookName)}clone(){const t=new Yc(this.hookName);return this.forEach((r,n)=>{t.set(n,r)}),t}toDOM(t=document,r={},n){const i=r[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(s,this),s}_write(t){t.writeTypeRef(fO),t.writeKey(this.hookName)}}const VR=e=>new Yc(e.readKey());class Vc extends vi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Vc}clone(){const t=new Vc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,r,n){const i=t.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const r=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),r.push({nodeName:i,attrs:s})}r.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let n="";for(let i=0;i<r.length;i++){const s=r[i];n+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=t.insert;for(let i=r.length-1;i>=0;i--)n+=`</${r[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(dO)}}const qR=e=>new Vc;class df{constructor(t,r){this.id=t,this.length=r}get deleted(){throw Jn()}mergeWith(t){return!1}write(t,r,n){throw Jn()}integrate(t,r){throw Jn()}}const XR=0;class gn extends df{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,r){r>0&&(this.id.clock+=r,this.length-=r),Ym(t.doc.store,this)}write(t,r){t.writeInfo(XR),t.writeLen(this.length-r)}getMissing(t,r){return null}}class fa{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new fa(this.content)}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeBuf(this.content)}getRef(){return 3}}const JR=e=>new fa(e.readBuf());class da{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new da(this.len)}splice(t){const r=new da(this.len-t);return this.len=t,r}mergeWith(t){return this.len+=t.len,!0}integrate(t,r){Pc(t.deleteSet,r.id.client,r.id.clock,this.len),r.markDeleted()}delete(t){}gc(t){}write(t,r){t.writeLen(this.len-r)}getRef(){return 1}}const ZR=e=>new da(e.readLen()),bg=(e,t)=>new oo({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class pa{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const r={};this.opts=r,t.gc||(r.gc=!1),t.autoLoad&&(r.autoLoad=!0),t.meta!==null&&(r.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new pa(bg(this.doc.guid,this.opts))}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){this.doc._item=r,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,r){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const QR=e=>new pa(bg(e.readString(),e.readAny()));class Es{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Es(this.embed)}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeJSON(this.embed)}getRef(){return 5}}const tO=e=>new Es(e.readJSON());class er{constructor(t,r){this.key=t,this.value=r}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new er(this.key,this.value)}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){const n=r.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,r){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const eO=e=>new er(e.readKey(),e.readJSON());class qc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new qc(this.arr)}splice(t){const r=new qc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),r}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){const n=this.arr.length;t.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const rO=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++){const i=e.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new qc(r)},nO=Uc("node_env")==="development";class ks{constructor(t){this.arr=t,nO&&xm(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ks(this.arr)}splice(t){const r=new ks(this.arr.slice(t));return this.arr=this.arr.slice(0,t),r}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){const n=this.arr.length;t.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const iO=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new ks(r)};class ri{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ri(this.str)}splice(t){const r=new ri(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",r.str="ï¿½"+r.str.slice(1)),r}mergeWith(t){return this.str+=t.str,!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeString(r===0?this.str:this.str.slice(r))}getRef(){return 4}}const sO=e=>new ri(e.readString()),oO=[$R,BR,WR,KR,HR,VR,qR],aO=0,cO=1,lO=2,uO=3,hO=4,fO=5,dO=6;class xi{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new xi(this.type._copy())}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){this.type._integrate(t.doc,r)}delete(t){let r=this.type._start;for(;r!==null;)r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t),r=r.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let r=this.type._start;for(;r!==null;)r.gc(t,!0),r=r.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,r){this.type._write(t)}getRef(){return 7}}const pO=e=>new xi(oO[e.readTypeRef()](e)),Xc=(e,t,r)=>{const{client:n,clock:i}=t.id,s=new rr(ee(n,i+r),t,ee(n,i+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=ee(t.redone.client,t.redone.clock+r)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=r,s};class rr extends df{constructor(t,r,n,i,s,o,a,c){super(t,c.getLength()),this.origin=n,this.left=r,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?am:0}set marker(t){(this.info&Lh)>0!==t&&(this.info^=Lh)}get marker(){return(this.info&Lh)>0}get keep(){return(this.info&om)>0}set keep(t){this.keep!==t&&(this.info^=om)}get countable(){return(this.info&am)>0}get deleted(){return(this.info&Ch)>0}set deleted(t){this.deleted!==t&&(this.info^=Ch)}markDeleted(){this.info|=Ch}getMissing(t,r){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=hr(r,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=hr(r,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===co&&this.id.client!==this.parent.client&&this.parent.clock>=hr(r,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Vm(t,r,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Gi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===gn||this.right&&this.right.constructor===gn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===rr?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===rr&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===co){const n=ef(r,this.parent);n.constructor===gn?this.parent=null:this.parent=n.content.type}return null}integrate(t,r){if(r>0&&(this.id.clock+=r,this.left=Vm(t,t.doc.store,ee(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(r),this.length-=r),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),$c(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,s.clear();else if($c(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(ef(t.doc.store,i.origin)))s.has(ef(t.doc.store,i.origin))||(n=i,s.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ym(t.doc.store,this),this.content.integrate(t,this),Jm(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new gn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:ee(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&$c(t.origin,this.lastId)&&this.right===t&&$c(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const r=this.parent._searchMarker;return r&&r.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const r=this.parent;this.countable&&this.parentSub===null&&(r._length-=this.length),this.markDeleted(),Pc(t.deleteSet,this.id.client,this.id.clock,this.length),Jm(t,r,this.parentSub),this.content.delete(t)}}gc(t,r){if(!this.deleted)throw Zn();this.content.gc(t),r?bR(t,this,new gn(this.id,this.length)):this.content=new da(this.length)}write(t,r){const n=r>0?ee(this.id.client,this.id.clock+r-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Rc|(n===null?0:an)|(i===null?0:wi)|(s===null?0:ea);if(t.writeInfo(o),n!==null&&t.writeLeftID(n),i!==null&&t.writeRightID(i),n===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=_R(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===co?(t.writeParentInfo(!1),t.writeLeftID(a)):Zn();s!==null&&t.writeString(s)}this.content.write(t,r)}}const wg=(e,t)=>mO[t&Rc](e),mO=[()=>{Zn()},ZR,rO,JR,sO,tO,eO,pO,iO,QR,()=>{Zn()}],gO=10;class yn extends df{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,r){Zn()}write(t,r){t.writeInfo(gO),ae(t.restEncoder,this.length-r)}getMissing(t,r){return null}}const Eg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Zs<"u"?Zs:{},kg="__ $YJS$ __";Eg[kg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Eg[kg]=!0;let vg=!1;const un=new oo;function xg(e,t,r){const n=un.getMap();if(!n.has(e))switch(t){case 0:case 1:n.set(e,r);break}}function yO(e,t){xg(e,0,t)}function pf(e,t){const r=new vi(t);xg(e,1,r)}function _O(e,t){un.getMap().set(e,t)}function bO(e,t){const r=un.getMap(),n=new vi(t);r.set(e,n)}function Ag(e,t){const r=un.getMap();function n(i){const s=r.get(e);for(let o=0;o<i.length;++o)(i[o].target===r||i[o].target===s)&&t(s)}return r.has(e)&&t(r.get(e)),r.observeDeep(n),()=>{r.observeDeep(n)}}function wO(e,t){return Ag(e,r=>{wt(r)&&t(r)})}function Tg(e,t){return Ag(e,r=>{r instanceof vi&&t(r.toJSON())})}const vs=Vs("modem",["second"],e=>{if(vs.session(e))switch(e.target){case"second":!vg&&e.data%2===0&&vs.emit(e.player,"modem:join");break;case"join":e.sender!==vs.id()&&vs.reply(e,"joinack",tm(mR(un)));break;case"joinack":e.sender!==vs.id()&&(vg=!0,Dm(un,Ac(e.data),un));break;case"sync":{e.sender!==vs.id()&&y(e.data)&&Dm(un,Ac(e.data),un);break}}});function Sg(e,t){t!==un&&vs.emit("","modem:sync",tm(e))}un.on("update",Sg),un.on("destroy",()=>{un.off("update",Sg)});function Rg(e,t){return e%t}function Og(e,t){return Math.floor(e/t)}function EO(e,t){return{x:Rg(e,t),y:Og(e,t)}}function Gr(e,t){return e.x+e.y*t}function mo(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function mf(e,t,r,n,i,s){return e>=s&&e<=n&&t>=r&&t<=i}function Ig(e,t,r,n){const i=[],s=Math.min(e,r),o=Math.max(e,r),a=Math.min(t,n),c=Math.max(t,n);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function Ng(e,t,r,n){const i=[],s=Math.abs(r-e),o=Math.abs(n-t),a=e<r?1:-1,c=t<n?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==r||t!==n;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Cg="176",kO="",Un="srgb",Lg="srgb-linear",Mg="linear",gf="srgb";function Pn(e,t,r){return Math.max(t,Math.min(r,e))}function vO(e,t){return(e%t+t)%t}function yf(e,t,r){return(1-r)*e+r*t}class ma{constructor(t=0,r=0){ma.prototype.isVector2=!0,this.x=t,this.y=r}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,r){return this.x=t,this.y=r,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,r){switch(t){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this}addScaledVector(t,r){return this.x+=t.x*r,this.y+=t.y*r,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const r=this.x,n=this.y,i=t.elements;return this.x=i[0]*r+i[3]*n+i[6],this.y=i[1]*r+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,r){return this.x=Pn(this.x,t.x,r.x),this.y=Pn(this.y,t.y,r.y),this}clampScalar(t,r){return this.x=Pn(this.x,t,r),this.y=Pn(this.y,t,r),this}clampLength(t,r){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Pn(n,t,r))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const r=Math.sqrt(this.lengthSq()*t.lengthSq());if(r===0)return Math.PI/2;const n=this.dot(t)/r;return Math.acos(Pn(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const r=this.x-t.x,n=this.y-t.y;return r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,r){return this.x+=(t.x-this.x)*r,this.y+=(t.y-this.y)*r,this}lerpVectors(t,r,n){return this.x=t.x+(r.x-t.x)*n,this.y=t.y+(r.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,r=0){return this.x=t[r],this.y=t[r+1],this}toArray(t=[],r=0){return t[r]=this.x,t[r+1]=this.y,t}fromBufferAttribute(t,r){return this.x=t.getX(r),this.y=t.getY(r),this}rotateAround(t,r){const n=Math.cos(r),i=Math.sin(r),s=this.x-t.x,o=this.y-t.y;return this.x=s*n-o*i+t.x,this.y=s*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ga{constructor(t,r,n,i,s,o,a,c,l){ga.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,r,n,i,s,o,a,c,l)}set(t,r,n,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=r,u[4]=s,u[5]=c,u[6]=n,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const r=this.elements,n=t.elements;return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],this}extractBasis(t,r,n){return t.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const r=t.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,r){const n=t.elements,i=r.elements,s=this.elements,o=n[0],a=n[3],c=n[6],l=n[1],u=n[4],f=n[7],d=n[2],h=n[5],m=n[8],p=i[0],_=i[3],w=i[6],v=i[1],A=i[4],T=i[7],I=i[2],S=i[5],C=i[8];return s[0]=o*p+a*v+c*I,s[3]=o*_+a*A+c*S,s[6]=o*w+a*T+c*C,s[1]=l*p+u*v+f*I,s[4]=l*_+u*A+f*S,s[7]=l*w+u*T+f*C,s[2]=d*p+h*v+m*I,s[5]=d*_+h*A+m*S,s[8]=d*w+h*T+m*C,this}multiplyScalar(t){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=t,r[4]*=t,r[7]*=t,r[2]*=t,r[5]*=t,r[8]*=t,this}determinant(){const t=this.elements,r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return r*o*u-r*a*l-n*s*u+n*a*c+i*s*l-i*o*c}invert(){const t=this.elements,r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,m=r*f+n*d+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=f*p,t[1]=(i*l-u*n)*p,t[2]=(a*n-i*o)*p,t[3]=d*p,t[4]=(u*r-i*c)*p,t[5]=(i*s-a*r)*p,t[6]=h*p,t[7]=(n*c-l*r)*p,t[8]=(o*r-n*s)*p,this}transpose(){let t;const r=this.elements;return t=r[1],r[1]=r[3],r[3]=t,t=r[2],r[2]=r[6],r[6]=t,t=r[5],r[5]=r[7],r[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const r=this.elements;return t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8],this}setUvTransform(t,r,n,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(n*c,n*l,-n*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+r,0,0,1),this}scale(t,r){return this.premultiply(_f.makeScale(t,r)),this}rotate(t){return this.premultiply(_f.makeRotation(-t)),this}translate(t,r){return this.premultiply(_f.makeTranslation(t,r)),this}makeTranslation(t,r){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,r,0,0,1),this}makeRotation(t){const r=Math.cos(t),n=Math.sin(t);return this.set(r,-n,0,n,r,0,0,0,1),this}makeScale(t,r){return this.set(t,0,0,0,r,0,0,0,1),this}equals(t){const r=this.elements,n=t.elements;for(let i=0;i<9;i++)if(r[i]!==n[i])return!1;return!0}fromArray(t,r=0){for(let n=0;n<9;n++)this.elements[n]=t[n+r];return this}toArray(t=[],r=0){const n=this.elements;return t[r]=n[0],t[r+1]=n[1],t[r+2]=n[2],t[r+3]=n[3],t[r+4]=n[4],t[r+5]=n[5],t[r+6]=n[6],t[r+7]=n[7],t[r+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const _f=new ga,Ug=new ga().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Pg=new ga().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function xO(){const e={enabled:!0,workingColorSpace:Lg,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===gf&&(i.r=go(i.r),i.g=go(i.g),i.b=go(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===gf&&(i.r=yo(i.r),i.g=yo(i.g),i.b=yo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===kO?Mg:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],n=[.3127,.329];return e.define({[Lg]:{primaries:t,whitePoint:n,transfer:Mg,toXYZ:Ug,fromXYZ:Pg,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:Un},outputColorSpaceConfig:{drawingBufferColorSpace:Un}},[Un]:{primaries:t,whitePoint:n,transfer:gf,toXYZ:Ug,fromXYZ:Pg,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:Un}}}),e}const $n=xO();function go(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function yo(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const $g={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ki={h:0,s:0,l:0},Jc={h:0,s:0,l:0};function bf(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*6*(2/3-r):e}class wf{constructor(t,r,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,r,n)}set(t,r,n){if(r===void 0&&n===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,r,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,r=Un){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,$n.toWorkingColorSpace(this,r),this}setRGB(t,r,n,i=$n.workingColorSpace){return this.r=t,this.g=r,this.b=n,$n.toWorkingColorSpace(this,i),this}setHSL(t,r,n,i=$n.workingColorSpace){if(t=vO(t,1),r=Pn(r,0,1),n=Pn(n,0,1),r===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+r):n+r-n*r,o=2*n-s;this.r=bf(o,s,t+1/3),this.g=bf(o,s,t),this.b=bf(o,s,t-1/3)}return $n.toWorkingColorSpace(this,i),this}setStyle(t,r=Un){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,r);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,r);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,r);if(o===6)return this.setHex(parseInt(s,16),r);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,r);return this}setColorName(t,r=Un){const n=$g[t.toLowerCase()];return n!==void 0?this.setHex(n,r):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=go(t.r),this.g=go(t.g),this.b=go(t.b),this}copyLinearToSRGB(t){return this.r=yo(t.r),this.g=yo(t.g),this.b=yo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Un){return $n.fromWorkingColorSpace(Tr.copy(this),t),Math.round(Pn(Tr.r*255,0,255))*65536+Math.round(Pn(Tr.g*255,0,255))*256+Math.round(Pn(Tr.b*255,0,255))}getHexString(t=Un){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,r=$n.workingColorSpace){$n.fromWorkingColorSpace(Tr.copy(this),r);const n=Tr.r,i=Tr.g,s=Tr.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case n:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-n)/f+2;break;case s:c=(n-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,r=$n.workingColorSpace){return $n.fromWorkingColorSpace(Tr.copy(this),r),t.r=Tr.r,t.g=Tr.g,t.b=Tr.b,t}getStyle(t=Un){$n.fromWorkingColorSpace(Tr.copy(this),t);const r=Tr.r,n=Tr.g,i=Tr.b;return t!==Un?`color(${t} ${r.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(r*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,r,n){return this.getHSL(Ki),this.setHSL(Ki.h+t,Ki.s+r,Ki.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,r){return this.r=t.r+r.r,this.g=t.g+r.g,this.b=t.b+r.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,r){return this.r+=(t.r-this.r)*r,this.g+=(t.g-this.g)*r,this.b+=(t.b-this.b)*r,this}lerpColors(t,r,n){return this.r=t.r+(r.r-t.r)*n,this.g=t.g+(r.g-t.g)*n,this.b=t.b+(r.b-t.b)*n,this}lerpHSL(t,r){this.getHSL(Ki),t.getHSL(Jc);const n=yf(Ki.h,Jc.h,r),i=yf(Ki.s,Jc.s,r),s=yf(Ki.l,Jc.l,r);return this.setHSL(n,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const r=this.r,n=this.g,i=this.b,s=t.elements;return this.r=s[0]*r+s[3]*n+s[6]*i,this.g=s[1]*r+s[4]*n+s[7]*i,this.b=s[2]*r+s[5]*n+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,r=0){return this.r=t[r],this.g=t[r+1],this.b=t[r+2],this}toArray(t=[],r=0){return t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t}fromBufferAttribute(t,r){return this.r=t.getX(r),this.g=t.getY(r),this.b=t.getZ(r),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Tr=new wf;wf.NAMES=$g,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Cg}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Cg),new ma,new ma;function Ke(e,t,r){return Math.max(t,Math.min(r,e))}function Fg(e){return e/180*Math.PI}function Bg(e){return e*180/Math.PI}const AO=p0("089fad0j9awfem09wavefc09uwaef");function TO(){return AO()}function SO(e){return p0(e)()}function _n(e,t){const r=Math.min(e,t),i=Math.max(e,t)-r+1;return r+Math.floor(TO()*i)}function Dg(e,t,r){const n=Math.min(t,r),s=Math.max(t,r)-n+1;return n+Math.floor(SO(e)*s)}function jg(e,t,r){typeof r!="number"&&(r=1);const n=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=r)n.push(o);return n}function RO(e){return e[_n(0,e.length-1)]}function OO(e,t){return t[Dg(e,0,t.length-1)]}function bn(...e){return RO(e.flat())}function IO(e,...t){return OO(e,t.flat())}function NO(e){return[...new Set(e)].filter(y)}function ya(e){return y(e)&&y(e.x)&&y(e.y)}function De(e,t){switch(t){case yt.NORTH:--e.y;break;case yt.SOUTH:++e.y;break;case yt.WEST:--e.x;break;case yt.EAST:++e.x;break}return e}function Ef(e,t){return e<0?yt.WEST:e>0?yt.EAST:t<0?yt.NORTH:t>0?yt.SOUTH:yt.IDLE}function Fn(e,t){return Ef(t.x-e.x,t.y-e.y)}const kf={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Wr(e){return ce(e)&&zg(e[0])}function zg(e){return y(yt[e])&&pt(e)}function Gg(e){const t=yt[e];return y(t)?t:yt.IDLE}function Zc(e){if(pt(e))return kf[It(e)]}function CO(e){if(Wr(e))return e;if(zg(e))return[e];const t=Zc(e);if(y(t))return[t]}function Wg(e){const t=E.words[e],r=CO(t);return Wr(r)?[r,e+1]:[void 0,e]}function Hg(e){var i,s;const t=[];let[r,n]=Wg(e);for(;Wr(r);){switch(t.push(...r),r[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=nt(E.words,n,[H.NUMBER,H.NUMBER]);t.push(c,l),n=u;break}case"FLEE":case"FIND":{const[c,l]=nt(E.words,n,[H.KIND]);console.info("kind",c),n=l;break}case"TO":{const[c,l,u]=nt(E.words,n,[H.DIR,H.DIR]),f=((i=E.element)==null?void 0:i.x)??0,d=((s=E.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,t.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),n=u;break}}switch(r[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,n]}const[o,a]=Wg(n);r=o,n=a}return t.length?[t,n]:[void 0,e]}function LO(e){return y(e)&&e<Lt.ONBLACK?e:void 0}function vf(e){return y(e)&&e>Lt.WHITE&&e<Lt.ONCLEAR?e-Lt.ONBLACK:void 0}const _a={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Ir(e){return ce(e)&&Kg(e[0])}function MO(e){return Ir(e)&&e[0].startsWith("ON")}function Kg(e){return y(Lt[e])&&pt(e)}function ba(e){if(pt(e))return _a[It(e)]}function Qc(e,t){return[y(e)?`${Lt[e]}`:void 0,y(t)?`ON${Lt[t]}`:void 0].filter(y)}function tl(e){return e.map(t=>Lt[t]).find(t=>y(t)&&t<Lt.ONBLACK)}function el(e){return e.map(t=>Lt[t]).find(t=>y(t)&&t>=Lt.ONBLACK)}function UO(e){if(Ir(e))return e;if(Kg(e))return[e];const t=ba(e);if(y(t))return[t]}function Yg(e){const t=E.words[e],r=UO(t);return Ir(r)?[r,e+1]:[void 0,e]}function rl(e){const t=[];let r=e;const[n,i]=Yg(e);Ir(n)&&(t.push(...n),r=i);const[s,o]=Yg(i);return MO(s)&&(t.push(...s),r=o),t.length?[t,r]:[void 0,e]}function Vg(e){const t={};for(let r=0;r<e.length;++r){const n=e[r],i=Lt[n];y(i)&&(i<Lt.ONBLACK?t.color=i:t.bg=vf(i))}return t}var qg={exports:{}},xf={exports:{}},Xg;function PO(){return Xg||(Xg=1,function(e,t){(function(r,n){e.exports=n()})(Br,function(){function r(p){return!isNaN(parseFloat(p))&&isFinite(p)}function n(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(p){if(p)for(var _=0;_<u.length;_++)p[u[_]]!==void 0&&this["set"+n(u[_])](p[u[_]])}f.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof f)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new f(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",_=this.getLineNumber()||"",w=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+_+":"+w+")":"[eval]:"+_+":"+w:v?v+" ("+p+":"+_+":"+w+")":p+":"+_+":"+w}},f.fromString=function(_){var w=_.indexOf("("),v=_.lastIndexOf(")"),A=_.substring(0,w),T=_.substring(w+1,v).split(","),I=_.substring(v+1);if(I.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(I,""),C=S[1],P=S[2],N=S[3];return new f({functionName:A,args:T||void 0,fileName:C,lineNumber:P||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+n(s[d])]=i(s[d]),f.prototype["set"+n(s[d])]=function(p){return function(_){this[p]=!!_}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+n(o[h])]=i(o[h]),f.prototype["set"+n(o[h])]=function(p){return function(_){if(!r(_))throw new TypeError(p+" must be a Number");this[p]=Number(_)}}(o[h]);for(var m=0;m<a.length;m++)f.prototype["get"+n(a[m])]=i(a[m]),f.prototype["set"+n(a[m])]=function(p){return function(_){this[p]=String(_)}}(a[m]);return f})}(xf)),xf.exports}(function(e,t){(function(r,n){e.exports=n(PO())})(Br,function(n){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),m=d&&f||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new n({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new n({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(f,""));return new n({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new n({fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new n({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var _=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new n({functionName:m,args:_,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(qg);var $O=qg.exports,FO=fs($O);const Tt=60,Yt=25,Af=Tt*Yt;var bt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(bt||{});const Tf=14,nl=3,Yi=8,Vi=14,il=16,BO=16,DO=16;var sl=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(sl||{});function wa(e,t){return new Array(e).fill(t)}function jO(e,t,r,n,i,s=0){const o=n*i;return{id:`tiles:${e}:${t}`,type:1,tag:r,width:n,height:i,char:wa(o,0),color:wa(o,0),bg:wa(o,s),wall:wa(o,0)}}function zO(e,t,r,n=1,i=15){return{id:`sprites:${e}:${t}:${r}`,x:0,y:0,char:n,color:i,bg:Lt.ONCLEAR}}function GO(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function WO(e,t,r,n,i=0){const s=r*n;return{id:`dither:${e}:${t}`,type:3,width:r,height:n,alphas:wa(s,i)}}function HO(e,t,r,n){return{id:`media:${e}:${t}`,type:4,mime:r,media:n}}function KO(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Jg(e,t){return`${e}:${t}`}const YO=1,VO=16,qO=256;var Nr=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Nr||{});const ni=!!JSON.parse("false"),XO=!!JSON.parse("false");JSON.parse("false");const Zg=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Ai={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Yi*Ai.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Vi*Ai.DRAW_CHAR_SCALE}},Z=Vs("SOFTWARE");function Ti(e){const t={},r={tick(){},everytick(){},listcommands(){return on(t)},...e,getcommand(n){return t[n]},command(n,i){return t[n]=i,r}};return r}function Se(e){return`${e??""}`}function Ea(e,t){const r=parseFloat(Se(e));return isNaN(r)?t:r}function Hr(e,t,r,n){const[i,s]=nt(n,0,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);R0(Z,e,t,r,i,s)}const JO=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Qg(e,t,r){const[n,i]=nt(r,0,[H.NUMBER_OR_STRING]);if(wt(n))mh(Z,e,t,"volume",n);else if(JO.includes(It(n))){const[s,o]=nt(r,i,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);R0(Z,e,t,n,s,o)}else{const[s]=nt(r,i,[H.MAYBE_NUMBER_OR_STRING]);if(wt(s)){const o=r.length-i,a=new Array(o).fill(H.NUMBER),c=nt(r,i,a).slice(0,o),l=c.length===1?c[0]:c;mh(Z,e,t,n,l)}else{const[o]=nt(r,i,[H.MAYBE_NUMBER_OR_STRING]);mh(Z,e,t,n,o)}}}let ty="en-US-GuyNeural";function qi(e,t){var n;const[r]=nt(e,0,[H.MAYBE_NAME]);tT(Z,E.elementfocus,((n=E.board)==null?void 0:n.id)??"",r??"",t)}const Sf=Ti().command("talk",(e,t)=>{const[r]=nt(t,0,[H.ANY]);switch(It(r)){default:LA(Z,E.elementfocus);break;case"stop":MA(Z,E.elementfocus);break}return 0}).command("media",(e,t)=>{const[r]=nt(t,0,[H.ANY]);switch(It(r)){default:UA(Z,E.elementfocus);break;case"stop":PA(Z,E.elementfocus);break}return 0}).command("tts",(e,t)=>{const r=t.map(Se).join("");return ZA(Z,E.elementfocus,ty,r),0}).command("ttsvoice",(e,t)=>(ty=t.map(Se).join(""),0)).command("bpm",(e,t)=>{const[r]=nt(t,0,[H.NUMBER]);return rT(Z,E.elementfocus,r),0}).command("vol",(e,t)=>{const[r]=nt(t,0,[H.NUMBER]);return nT(Z,E.elementfocus,r),0}).command("bgvol",(e,t)=>{const[r]=nt(t,0,[H.NUMBER]);return iT(Z,E.elementfocus,r),0}).command("ttsvol",(e,t)=>{const[r]=nt(t,0,[H.NUMBER]);return sT(Z,E.elementfocus,r),0}).command("play",(e,t)=>{var n;const[r]=nt(t,0,[H.MAYBE_NAME]);return QA(Z,E.elementfocus,((n=E.board)==null?void 0:n.id)??"",r??""),0}).command("bgplay",(e,t)=>(qi(t,""),0)).command("bgplayon64n",(e,t)=>(qi(t,"@64n"),0)).command("bgplayon32n",(e,t)=>(qi(t,"@32n"),0)).command("bgplayon16n",(e,t)=>(qi(t,"@16n"),0)).command("bgplayon8n",(e,t)=>(qi(t,"@8n"),0)).command("bgplayon4n",(e,t)=>(qi(t,"@4n"),0)).command("bgplayon2n",(e,t)=>(qi(t,"@2n"),0)).command("bgplayon1n",(e,t)=>(qi(t,"@1m"),0)).command("synth",(e,t)=>{for(let r=0;r<8;++r)Qg(E.elementfocus,r,t);return 0}).command("echo",(e,t)=>{for(let r=0;r<3;++r)Hr(E.elementfocus,r,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let r=0;r<3;++r)Hr(E.elementfocus,r,"fc",t);return 0}).command("phaser",(e,t)=>{for(let r=0;r<3;++r)Hr(E.elementfocus,r,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let r=0;r<3;++r)Hr(E.elementfocus,r,"reverb",t);return 0}).command("distort",(e,t)=>{for(let r=0;r<3;++r)Hr(E.elementfocus,r,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let r=0;r<3;++r)Hr(E.elementfocus,r,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let r=0;r<3;++r)Hr(E.elementfocus,r,"autowah",t);return 0});for(let e=0;e<8;++e)Sf.command(`synth${e+1}`,(t,r)=>(Qg(E.elementfocus,e,r),0));for(let e=0;e<3;++e){const t=e+1;Sf.command(`echo${t}`,(r,n)=>(Hr(E.elementfocus,e,"echo",n),0)).command(`fcrush${t}`,(r,n)=>(Hr(E.elementfocus,e,"fcrush",n),0)).command(`phaser${t}`,(r,n)=>(Hr(E.elementfocus,e,"phaser",n),0)).command(`reverb${t}`,(r,n)=>(Hr(E.elementfocus,e,"reverb",n),0)).command(`distort${t}`,(r,n)=>(Hr(E.elementfocus,e,"distort",n),0)).command(`vibrato${t}`,(r,n)=>(Hr(E.elementfocus,e,"vibrato",n),0)).command(`autowah${t}`,(r,n)=>(Hr(E.elementfocus,e,"autowah",n),0))}var ol={},Rf,ey;function ZO(){if(ey)return Rf;ey=1;var e,t,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},n;function i(h){throw{name:"SyntaxError",message:h,at:e,text:n}}function s(h){return h&&h!==t&&i("Expected '"+h+"' instead of '"+t+"'"),t=n.charAt(e),e+=1,t}function o(){var h,m="";for(t==="-"&&(m="-",s("-"));t>="0"&&t<="9";)m+=t,s();if(t===".")for(m+=".";s()&&t>="0"&&t<="9";)m+=t;if(t==="e"||t==="E")for(m+=t,s(),(t==="-"||t==="+")&&(m+=t,s());t>="0"&&t<="9";)m+=t,s();return h=Number(m),isFinite(h)||i("Bad number"),h}function a(){var h,m,p="",_;if(t==='"')for(;s();){if(t==='"')return s(),p;if(t==="\\")if(s(),t==="u"){for(_=0,m=0;m<4&&(h=parseInt(s(),16),!!isFinite(h));m+=1)_=_*16+h;p+=String.fromCharCode(_)}else if(typeof r[t]=="string")p+=r[t];else break;else p+=t}i("Bad string")}function c(){for(;t&&t<=" ";)s()}function l(){switch(t){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null;default:i("Unexpected '"+t+"'")}}function u(){var h=[];if(t==="["){if(s("["),c(),t==="]")return s("]"),h;for(;t;){if(h.push(d()),c(),t==="]")return s("]"),h;s(","),c()}}i("Bad array")}function f(){var h,m={};if(t==="{"){if(s("{"),c(),t==="}")return s("}"),m;for(;t;){if(h=a(),c(),s(":"),Object.prototype.hasOwnProperty.call(m,h)&&i('Duplicate key "'+h+'"'),m[h]=d(),c(),t==="}")return s("}"),m;s(","),c()}}i("Bad object")}function d(){switch(c(),t){case"{":return f();case"[":return u();case'"':return a();case"-":return o();default:return t>="0"&&t<="9"?o():l()}}return Rf=function(h,m){var p;return n=h,e=0,t=" ",p=d(),c(),t&&i("Syntax error"),typeof m=="function"?function _(w,v){var A,T,I=w[v];if(I&&typeof I=="object")for(A in d)Object.prototype.hasOwnProperty.call(I,A)&&(T=_(I,A),typeof T>"u"?delete I[A]:I[A]=T);return m.call(w,v,I)}({"":p},""):p},Rf}var Of,ry;function QO(){if(ry)return Of;ry=1;var e=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t,r,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;function s(a){return e.lastIndex=0,e.test(a)?'"'+a.replace(e,function(c){var l=n[c];return typeof l=="string"?l:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function o(a,c){var l,u,f,d,h=t,m,p=c[a];switch(p&&typeof p=="object"&&typeof p.toJSON=="function"&&(p=p.toJSON(a)),typeof i=="function"&&(p=i.call(c,a,p)),typeof p){case"string":return s(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(t+=r,m=[],Object.prototype.toString.apply(p)==="[object Array]"){for(d=p.length,l=0;l<d;l+=1)m[l]=o(l,p)||"null";return f=m.length===0?"[]":t?`[
`+t+m.join(`,
`+t)+`
`+h+"]":"["+m.join(",")+"]",t=h,f}if(i&&typeof i=="object")for(d=i.length,l=0;l<d;l+=1)u=i[l],typeof u=="string"&&(f=o(u,p),f&&m.push(s(u)+(t?": ":":")+f));else for(u in p)Object.prototype.hasOwnProperty.call(p,u)&&(f=o(u,p),f&&m.push(s(u)+(t?": ":":")+f));return f=m.length===0?"{}":t?`{
`+t+m.join(`,
`+t)+`
`+h+"}":"{"+m.join(",")+"}",t=h,f}}return Of=function(a,c,l){var u;if(t="",r="",typeof l=="number")for(u=0;u<l;u+=1)r+=" ";else typeof l=="string"&&(r=l);if(i=c,c&&typeof c!="function"&&(typeof c!="object"||typeof c.length!="number"))throw new Error("JSON.stringify");return o("",{"":a})},Of}var ny;function tI(){return ny||(ny=1,ol.parse=ZO(),ol.stringify=QO()),ol}var eI={}.toString,rI=Array.isArray||function(e){return eI.call(e)=="[object Array]"},iy=Object.prototype.toString,sy=function(t){var r=iy.call(t),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&iy.call(t.callee)==="[object Function]"),n},If,oy;function nI(){if(oy)return If;oy=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=sy,i=Object.prototype.propertyIsEnumerable,s=!i.call({toString:null},"toString"),o=i.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(d){var h=d.constructor;return h&&h.prototype===d},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},u=function(){if(typeof window>"u")return!1;for(var d in window)try{if(!l["$"+d]&&t.call(window,d)&&window[d]!==null&&typeof window[d]=="object")try{c(window[d])}catch{return!0}}catch{return!0}return!1}(),f=function(d){if(typeof window>"u"||!u)return c(d);try{return c(d)}catch{return!1}};e=function(h){var m=h!==null&&typeof h=="object",p=r.call(h)==="[object Function]",_=n(h),w=m&&r.call(h)==="[object String]",v=[];if(!m&&!p&&!_)throw new TypeError("Object.keys called on a non-object");var A=o&&p;if(w&&h.length>0&&!t.call(h,0))for(var T=0;T<h.length;++T)v.push(String(T));if(_&&h.length>0)for(var I=0;I<h.length;++I)v.push(String(I));else for(var S in h)!(A&&S==="prototype")&&t.call(h,S)&&v.push(String(S));if(s)for(var C=f(h),P=0;P<a.length;++P)!(C&&a[P]==="constructor")&&t.call(h,a[P])&&v.push(a[P]);return v}}return If=e,If}var iI=Array.prototype.slice,sI=sy,ay=Object.keys,al=ay?function(t){return ay(t)}:nI(),cy=Object.keys;al.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(n){return sI(n)?cy(iI.call(n)):cy(n)})}else Object.keys=al;return Object.keys||al};var oI=al,ly={exports:{}},uy=Error,hy=EvalError,fy=RangeError,dy=ReferenceError,Nf=SyntaxError,_o=TypeError,py=URIError,aI=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var s=Object.getOwnPropertySymbols(t);if(s.length!==1||s[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,r);if(o.value!==i||o.enumerable!==!0)return!1}return!0},my=typeof Symbol<"u"&&Symbol,cI=aI,lI=function(){return typeof my!="function"||typeof Symbol!="function"||typeof my("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:cI()},Cf={__proto__:null,foo:{}},uI=Object,hI=function(){return{__proto__:Cf}.foo===Cf.foo&&!(Cf instanceof uI)},fI="Function.prototype.bind called on incompatible ",dI=Object.prototype.toString,pI=Math.max,mI="[object Function]",gy=function(t,r){for(var n=[],i=0;i<t.length;i+=1)n[i]=t[i];for(var s=0;s<r.length;s+=1)n[s+t.length]=r[s];return n},gI=function(t,r){for(var n=[],i=r,s=0;i<t.length;i+=1,s+=1)n[s]=t[i];return n},yI=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r},_I=function(t){var r=this;if(typeof r!="function"||dI.apply(r)!==mI)throw new TypeError(fI+r);for(var n=gI(arguments,1),i,s=function(){if(this instanceof i){var u=r.apply(this,gy(n,arguments));return Object(u)===u?u:this}return r.apply(t,gy(n,arguments))},o=pI(0,r.length-n.length),a=[],c=0;c<o;c++)a[c]="$"+c;if(i=Function("binder","return function ("+yI(a,",")+"){ return binder.apply(this,arguments); }")(s),r.prototype){var l=function(){};l.prototype=r.prototype,i.prototype=new l,l.prototype=null}return i},bI=_I,Xi=Function.prototype.bind||bI,wI=Function.prototype.call,EI=Object.prototype.hasOwnProperty,kI=Xi,yy=kI.call(wI,EI),Qt,vI=uy,xI=hy,AI=fy,TI=dy,bo=Nf,wo=_o,SI=py,_y=Function,Lf=function(e){try{return _y('"use strict"; return ('+e+").constructor;")()}catch{}},xs=Object.getOwnPropertyDescriptor;if(xs)try{xs({},"")}catch{xs=null}var Mf=function(){throw new wo},RI=xs?function(){try{return arguments.callee,Mf}catch{try{return xs(arguments,"callee").get}catch{return Mf}}}():Mf,Eo=lI(),OI=hI(),fr=Object.getPrototypeOf||(OI?function(e){return e.__proto__}:null),ko={},II=typeof Uint8Array>"u"||!fr?Qt:fr(Uint8Array),As={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Qt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Qt:ArrayBuffer,"%ArrayIteratorPrototype%":Eo&&fr?fr([][Symbol.iterator]()):Qt,"%AsyncFromSyncIteratorPrototype%":Qt,"%AsyncFunction%":ko,"%AsyncGenerator%":ko,"%AsyncGeneratorFunction%":ko,"%AsyncIteratorPrototype%":ko,"%Atomics%":typeof Atomics>"u"?Qt:Atomics,"%BigInt%":typeof BigInt>"u"?Qt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Qt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Qt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Qt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":vI,"%eval%":eval,"%EvalError%":xI,"%Float32Array%":typeof Float32Array>"u"?Qt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Qt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Qt:FinalizationRegistry,"%Function%":_y,"%GeneratorFunction%":ko,"%Int8Array%":typeof Int8Array>"u"?Qt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Qt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Qt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Eo&&fr?fr(fr([][Symbol.iterator]())):Qt,"%JSON%":typeof JSON=="object"?JSON:Qt,"%Map%":typeof Map>"u"?Qt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Eo||!fr?Qt:fr(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Qt:Promise,"%Proxy%":typeof Proxy>"u"?Qt:Proxy,"%RangeError%":AI,"%ReferenceError%":TI,"%Reflect%":typeof Reflect>"u"?Qt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Qt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Eo||!fr?Qt:fr(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Qt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Eo&&fr?fr(""[Symbol.iterator]()):Qt,"%Symbol%":Eo?Symbol:Qt,"%SyntaxError%":bo,"%ThrowTypeError%":RI,"%TypedArray%":II,"%TypeError%":wo,"%Uint8Array%":typeof Uint8Array>"u"?Qt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Qt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Qt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Qt:Uint32Array,"%URIError%":SI,"%WeakMap%":typeof WeakMap>"u"?Qt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Qt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Qt:WeakSet};if(fr)try{null.error}catch(e){var NI=fr(fr(e));As["%Error.prototype%"]=NI}var CI=function e(t){var r;if(t==="%AsyncFunction%")r=Lf("async function () {}");else if(t==="%GeneratorFunction%")r=Lf("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=Lf("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&fr&&(r=fr(i.prototype))}return As[t]=r,r},by={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ka=Xi,cl=yy,LI=ka.call(Function.call,Array.prototype.concat),MI=ka.call(Function.apply,Array.prototype.splice),wy=ka.call(Function.call,String.prototype.replace),ll=ka.call(Function.call,String.prototype.slice),UI=ka.call(Function.call,RegExp.prototype.exec),PI=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,$I=/\\(\\)?/g,FI=function(t){var r=ll(t,0,1),n=ll(t,-1);if(r==="%"&&n!=="%")throw new bo("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new bo("invalid intrinsic syntax, expected opening `%`");var i=[];return wy(t,PI,function(s,o,a,c){i[i.length]=a?wy(c,$I,"$1"):o||s}),i},BI=function(t,r){var n=t,i;if(cl(by,n)&&(i=by[n],n="%"+i[0]+"%"),cl(As,n)){var s=As[n];if(s===ko&&(s=CI(n)),typeof s>"u"&&!r)throw new wo("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:s}}throw new bo("intrinsic "+t+" does not exist!")},Uf=function(t,r){if(typeof t!="string"||t.length===0)throw new wo("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new wo('"allowMissing" argument must be a boolean');if(UI(/^%?[^%]*%?$/,t)===null)throw new bo("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=FI(t),i=n.length>0?n[0]:"",s=BI("%"+i+"%",r),o=s.name,a=s.value,c=!1,l=s.alias;l&&(i=l[0],MI(n,LI([0,1],l)));for(var u=1,f=!0;u<n.length;u+=1){var d=n[u],h=ll(d,0,1),m=ll(d,-1);if((h==='"'||h==="'"||h==="`"||m==='"'||m==="'"||m==="`")&&h!==m)throw new bo("property names with quotes must have matching quotes");if((d==="constructor"||!f)&&(c=!0),i+="."+d,o="%"+i+"%",cl(As,o))a=As[o];else if(a!=null){if(!(d in a)){if(!r)throw new wo("base intrinsic for "+t+" exists, but the property is not available.");return}if(xs&&u+1>=n.length){var p=xs(a,d);f=!!p,f&&"get"in p&&!("originalValue"in p.get)?a=p.get:a=a[d]}else f=cl(a,d),a=a[d];f&&!c&&(As[o]=a)}}return a},DI=Uf,ul=DI("%Object.defineProperty%",!0)||!1;if(ul)try{ul({},"a",{value:1})}catch{ul=!1}var Pf=ul,jI=Uf,hl=jI("%Object.getOwnPropertyDescriptor%",!0);if(hl)try{hl([],"length")}catch{hl=null}var Ey=hl,ky=Pf,zI=Nf,vo=_o,vy=Ey,GI=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new vo("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new vo("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new vo("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new vo("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new vo("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new vo("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,c=!!vy&&vy(t,r);if(ky)ky(t,r,{configurable:o===null&&c?c.configurable:!o,enumerable:i===null&&c?c.enumerable:!i,value:n,writable:s===null&&c?c.writable:!s});else if(a||!i&&!s&&!o)t[r]=n;else throw new zI("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},$f=Pf,xy=function(){return!!$f};xy.hasArrayLengthDefineBug=function(){if(!$f)return null;try{return $f([],"length",{value:1}).length!==1}catch{return!0}};var WI=xy,HI=Uf,Ay=GI,KI=WI(),Ty=Ey,Sy=_o,YI=HI("%Math.floor%"),VI=function(t,r){if(typeof t!="function")throw new Sy("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||YI(r)!==r)throw new Sy("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,s=!0;if("length"in t&&Ty){var o=Ty(t,"length");o&&!o.configurable&&(i=!1),o&&!o.writable&&(s=!1)}return(i||s||!n)&&(KI?Ay(t,"length",r,!0,!0):Ay(t,"length",r)),t},Ry=Function.prototype.call,Oy=Function.prototype.apply,qI=typeof Reflect<"u"&&Reflect&&Reflect.apply,XI=Xi,JI=Oy,ZI=Ry,QI=qI,Iy=QI||XI.call(ZI,JI),tN=Xi,eN=_o,rN=Ry,nN=Iy,Ny=function(t){if(t.length<1||typeof t[0]!="function")throw new eN("a function is required");return nN(tN,rN,t)},iN=Xi,sN=Oy,oN=Iy,aN=function(){return oN(iN,sN,arguments)};(function(e){var t=VI,r=Pf,n=Ny,i=aN;e.exports=function(o){var a=n(arguments),c=o.length-(arguments.length-1);return t(a,1+(c>0?c:0),!0)},r?r(e.exports,"apply",{value:i}):e.exports.apply=i})(ly);var cN=ly.exports,lN=Object,uN=Math.abs,hN=Math.floor,fN=Math.max,dN=Math.min,pN=Math.pow,mN=Math.round,gN=Number.isNaN||function(t){return t!==t},yN=gN,_N=function(t){return yN(t)||t===0?t:t<0?-1:1},bN=Object.getOwnPropertyDescriptor,fl=bN;if(fl)try{fl([],"length")}catch{fl=null}var wN=fl,dl=Object.defineProperty||!1;if(dl)try{dl({},"a",{value:1})}catch{dl=!1}var EN=dl,Ff,Cy;function kN(){return Cy||(Cy=1,Ff=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Ff}var Bf,Ly;function vN(){if(Ly)return Bf;Ly=1;var e=typeof Symbol<"u"&&Symbol,t=kN();return Bf=function(){return typeof e!="function"||typeof Symbol!="function"||typeof e("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Bf}var Df,My;function Uy(){return My||(My=1,Df=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Df}var jf,Py;function xN(){return Py||(Py=1,jf=Object),jf}var zf,$y;function Fy(){if($y)return zf;$y=1;var e=xN();return zf=e.getPrototypeOf||null,zf}var Gf,By;function AN(){return By||(By=1,Gf=Object.getOwnPropertyDescriptor),Gf}var Wf,Dy;function TN(){if(Dy)return Wf;Dy=1;var e=AN();if(e)try{e([],"length")}catch{e=null}return Wf=e,Wf}var Hf,jy;function SN(){if(jy)return Hf;jy=1;var e=Ny,t=TN(),r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var n=!!r&&t&&t(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return Hf=n&&typeof n.get=="function"?e([n.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,Hf}var Kf,zy;function RN(){if(zy)return Kf;zy=1;var e=Uy(),t=Fy(),r=SN();return Kf=e?function(i){return e(i)}:t?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return t(i)}:r?function(i){return r(i)}:null,Kf}var Yf,Gy;function Wy(){return Gy||(Gy=1,Yf=Function.prototype.apply),Yf}var Vf=Function.prototype.call,Jt,ON=lN,IN=uy,NN=hy,CN=fy,LN=dy,xo=Nf,Ao=_o,MN=py,UN=uN,PN=hN,$N=fN,FN=dN,BN=pN,DN=mN,jN=_N,Hy=Function,qf=function(e){try{return Hy('"use strict"; return ('+e+").constructor;")()}catch{}},va=wN,zN=EN,Xf=function(){throw new Ao},GN=va?function(){try{return arguments.callee,Xf}catch{try{return va(arguments,"callee").get}catch{return Xf}}}():Xf,To=vN()(),dr=RN(),WN=Fy(),HN=Uy(),Ky=Wy(),xa=Vf,So={},KN=typeof Uint8Array>"u"||!dr?Jt:dr(Uint8Array),Ts={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Jt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Jt:ArrayBuffer,"%ArrayIteratorPrototype%":To&&dr?dr([][Symbol.iterator]()):Jt,"%AsyncFromSyncIteratorPrototype%":Jt,"%AsyncFunction%":So,"%AsyncGenerator%":So,"%AsyncGeneratorFunction%":So,"%AsyncIteratorPrototype%":So,"%Atomics%":typeof Atomics>"u"?Jt:Atomics,"%BigInt%":typeof BigInt>"u"?Jt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Jt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Jt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Jt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":IN,"%eval%":eval,"%EvalError%":NN,"%Float16Array%":typeof Float16Array>"u"?Jt:Float16Array,"%Float32Array%":typeof Float32Array>"u"?Jt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Jt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Jt:FinalizationRegistry,"%Function%":Hy,"%GeneratorFunction%":So,"%Int8Array%":typeof Int8Array>"u"?Jt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Jt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Jt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":To&&dr?dr(dr([][Symbol.iterator]())):Jt,"%JSON%":typeof JSON=="object"?JSON:Jt,"%Map%":typeof Map>"u"?Jt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!To||!dr?Jt:dr(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":ON,"%Object.getOwnPropertyDescriptor%":va,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Jt:Promise,"%Proxy%":typeof Proxy>"u"?Jt:Proxy,"%RangeError%":CN,"%ReferenceError%":LN,"%Reflect%":typeof Reflect>"u"?Jt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Jt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!To||!dr?Jt:dr(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Jt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":To&&dr?dr(""[Symbol.iterator]()):Jt,"%Symbol%":To?Symbol:Jt,"%SyntaxError%":xo,"%ThrowTypeError%":GN,"%TypedArray%":KN,"%TypeError%":Ao,"%Uint8Array%":typeof Uint8Array>"u"?Jt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Jt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Jt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Jt:Uint32Array,"%URIError%":MN,"%WeakMap%":typeof WeakMap>"u"?Jt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Jt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Jt:WeakSet,"%Function.prototype.call%":xa,"%Function.prototype.apply%":Ky,"%Object.defineProperty%":zN,"%Object.getPrototypeOf%":WN,"%Math.abs%":UN,"%Math.floor%":PN,"%Math.max%":$N,"%Math.min%":FN,"%Math.pow%":BN,"%Math.round%":DN,"%Math.sign%":jN,"%Reflect.getPrototypeOf%":HN};if(dr)try{null.error}catch(e){var YN=dr(dr(e));Ts["%Error.prototype%"]=YN}var VN=function e(t){var r;if(t==="%AsyncFunction%")r=qf("async function () {}");else if(t==="%GeneratorFunction%")r=qf("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=qf("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&dr&&(r=dr(i.prototype))}return Ts[t]=r,r},Yy={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Aa=Xi,pl=yy,qN=Aa.call(xa,Array.prototype.concat),XN=Aa.call(Ky,Array.prototype.splice),Vy=Aa.call(xa,String.prototype.replace),ml=Aa.call(xa,String.prototype.slice),JN=Aa.call(xa,RegExp.prototype.exec),ZN=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,QN=/\\(\\)?/g,tC=function(t){var r=ml(t,0,1),n=ml(t,-1);if(r==="%"&&n!=="%")throw new xo("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new xo("invalid intrinsic syntax, expected opening `%`");var i=[];return Vy(t,ZN,function(s,o,a,c){i[i.length]=a?Vy(c,QN,"$1"):o||s}),i},eC=function(t,r){var n=t,i;if(pl(Yy,n)&&(i=Yy[n],n="%"+i[0]+"%"),pl(Ts,n)){var s=Ts[n];if(s===So&&(s=VN(n)),typeof s>"u"&&!r)throw new Ao("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:s}}throw new xo("intrinsic "+t+" does not exist!")},rC=function(t,r){if(typeof t!="string"||t.length===0)throw new Ao("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Ao('"allowMissing" argument must be a boolean');if(JN(/^%?[^%]*%?$/,t)===null)throw new xo("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=tC(t),i=n.length>0?n[0]:"",s=eC("%"+i+"%",r),o=s.name,a=s.value,c=!1,l=s.alias;l&&(i=l[0],XN(n,qN([0,1],l)));for(var u=1,f=!0;u<n.length;u+=1){var d=n[u],h=ml(d,0,1),m=ml(d,-1);if((h==='"'||h==="'"||h==="`"||m==='"'||m==="'"||m==="`")&&h!==m)throw new xo("property names with quotes must have matching quotes");if((d==="constructor"||!f)&&(c=!0),i+="."+d,o="%"+i+"%",pl(Ts,o))a=Ts[o];else if(a!=null){if(!(d in a)){if(!r)throw new Ao("base intrinsic for "+t+" exists, but the property is not available.");return}if(va&&u+1>=n.length){var p=va(a,d);f=!!p,f&&"get"in p&&!("originalValue"in p.get)?a=p.get:a=a[d]}else f=pl(a,d),a=a[d];f&&!c&&(Ts[o]=a)}}return a},nC=typeof Reflect<"u"&&Reflect&&Reflect.apply,iC=Xi,sC=Wy(),oC=Vf,aC=nC,cC=aC||iC.call(oC,sC),lC=Xi,uC=_o,hC=Vf,fC=cC,dC=function(t){if(t.length<1||typeof t[0]!="function")throw new uC("a function is required");return fC(lC,hC,t)},qy=rC,Xy=dC,pC=Xy([qy("%String.prototype.indexOf%")]),mC=function(t,r){var n=qy(t,!!r);return typeof n=="function"&&pC(t,".prototype.")>-1?Xy([n]):n},gl=(typeof JSON<"u"?JSON:tI()).stringify,gC=rI,yC=oI,_C=cN,yl=mC,bC=yl("Array.prototype.join"),Jy=yl("Array.prototype.indexOf"),wC=yl("Array.prototype.splice"),EC=yl("Array.prototype.sort"),Zy=function(t,r){for(var n="",i=0;i<t;i+=1)n+=r;return n},kC=function(e,t,r){return r},vC=function(t){var r=arguments.length>1?arguments[1]:void 0,n=r&&r.space||"";typeof n=="number"&&(n=Zy(n," "));var i=!!r&&typeof r.cycles=="boolean"&&r.cycles,s=r&&r.replacer?_C(r.replacer):kC;if(r&&typeof r.collapseEmpty<"u"&&typeof r.collapseEmpty!="boolean")throw new TypeError("`collapseEmpty` must be a boolean, if provided");var o=!!r&&r.collapseEmpty,a=typeof r=="function"?r:r&&r.cmp,c=a&&function(u){var f=a.length>2&&function(h){return u[h]};return function(d,h){return a({key:d,value:u[d]},{key:h,value:u[h]},f?{__proto__:null,get:f}:void 0)}},l=[];return function u(f,d,h,m){var p=n?`
`+Zy(m,n):"",_=n?": ":":";if(h&&h.toJSON&&typeof h.toJSON=="function"&&(h=h.toJSON()),h=s(f,d,h),h!==void 0){if(typeof h!="object"||h===null)return gl(h);var w=function(P,N){return o&&P.length===0?N:(N==="[]"?"[":"{")+bC(P,",")+p+(N==="[]"?"]":"}")};if(gC(h)){for(var I=[],v=0;v<h.length;v++){var A=u(h,v,h[v],m+1)||gl(null);I[I.length]=p+n+A}return w(I,"[]")}if(Jy(l,h)!==-1){if(i)return gl("__cycle__");throw new TypeError("Converting circular structure to JSON")}else l[l.length]=h;for(var T=EC(yC(h),c&&c(h)),I=[],v=0;v<T.length;v++){var d=T[v],S=u(h,d,h[d],m+1);if(S){var C=gl(d)+_+S;I[I.length]=p+n+C}}return wC(l,Jy(l,h),1),w(I,"{}")}}({"":t},"",t,0)},xC=fs(vC),Jf;try{Jf=new TextDecoder}catch{}var Et,wn,K=0,_e={},re,Ji,En=0,ii=0,pr,Si,Kr=[],te,Qy={useRecords:!1,mapsAsObjects:!0};class t_{}const e_=new t_;e_.name="MessagePack 0xC1";var Zi=!1,r_=2,n_;try{new Function("")}catch{r_=1/0}class Ta{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,r){if(Et)return g_(()=>(rd(),this?this.unpack(t,r):Ta.prototype.unpack.call(Qy,t,r)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof wr<"u"?wr.from(t):new Uint8Array(t)),typeof r=="object"?(wn=r.end||t.length,K=r.start||0):(K=0,wn=r>-1?r:t.length),ii=0,Ji=null,pr=null,Et=t;try{te=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(n){throw Et=null,t instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Ta){if(_e=this,this.structures)return re=this.structures,_l(r);(!re||re.length>0)&&(re=[])}else _e=Qy,(!re||re.length>0)&&(re=[]);return _l(r)}unpackMultiple(t,r){let n,i=0;try{Zi=!0;let s=t.length,o=this?this.unpack(t,s):bl.unpack(t,s);if(r){if(r(o,i,K)===!1)return;for(;K<s;)if(i=K,r(_l(),i,K)===!1)return}else{for(n=[o];K<s;)i=K,n.push(_l());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{Zi=!1,rd()}}_mergeStructures(t,r){t=t||[],Object.isFrozen(t)&&(t=t.map(n=>n.slice(0)));for(let n=0,i=t.length;n<i;n++){let s=t[n];s&&(s.isShared=!0,n>=32&&(s.highByte=n-32>>5))}t.sharedLength=t.length;for(let n in r||[])if(n>=0){let i=t[n],s=r[n];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[n]=i),t[n]=s)}return this.structures=t}decode(t,r){return this.unpack(t,r)}}function _l(e){try{if(!_e.trusted&&!Zi){let r=re.sharedLength||0;r<re.length&&(re.length=r)}let t;if(_e.randomAccessStructure&&Et[K]<64&&Et[K]>=32&&n_?(t=n_(Et,K,wn,_e),Et=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),K=wn):t=Ye(),pr&&(K=pr.postBundlePosition,pr=null),Zi&&(re.restoreStructures=null),K==wn)re&&re.restoreStructures&&i_(),re=null,Et=null,Si&&(Si=null);else{if(K>wn)throw new Error("Unexpected end of MessagePack data");if(!Zi){let r;try{r=JSON.stringify(t,(n,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return t}catch(t){throw re&&re.restoreStructures&&i_(),rd(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||K>wn)&&(t.incomplete=!0),t}}function i_(){for(let e in re.restoreStructures)re[e]=re.restoreStructures[e];re.restoreStructures=null}function Ye(){let e=Et[K++];if(e<160)if(e<128){if(e<64)return e;{let t=re[e&63]||_e.getStructures&&o_()[e&63];return t?(t.read||(t.read=Zf(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,_e.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=f_();n==="__proto__"&&(n="__proto_"),t[n]=Ye()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(Ye(),Ye());return t}else{e-=144;let t=new Array(e);for(let r=0;r<e;r++)t[r]=Ye();return _e.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(ii>=K)return Ji.slice(K-En,(K+=t)-En);if(ii==0&&wn<140){let r=t<16?td(t):l_(t);if(r!=null)return r}return Qf(t)}else{let t;switch(e){case 192:return null;case 193:return pr?(t=Ye(),t>0?pr[1].slice(pr.position1,pr.position1+=t):pr[0].slice(pr.position0,pr.position0-=t)):e_;case 194:return!1;case 195:return!0;case 196:if(t=Et[K++],t===void 0)throw new Error("Unexpected end of buffer");return ed(t);case 197:return t=te.getUint16(K),K+=2,ed(t);case 198:return t=te.getUint32(K),K+=4,ed(t);case 199:return Ss(Et[K++]);case 200:return t=te.getUint16(K),K+=2,Ss(t);case 201:return t=te.getUint32(K),K+=4,Ss(t);case 202:if(t=te.getFloat32(K),_e.useFloat32>2){let r=nd[(Et[K]&127)<<1|Et[K+1]>>7];return K+=4,(r*t+(t>0?.5:-.5)>>0)/r}return K+=4,t;case 203:return t=te.getFloat64(K),K+=8,t;case 204:return Et[K++];case 205:return t=te.getUint16(K),K+=2,t;case 206:return t=te.getUint32(K),K+=4,t;case 207:return _e.int64AsType==="number"?(t=te.getUint32(K)*4294967296,t+=te.getUint32(K+4)):_e.int64AsType==="string"?t=te.getBigUint64(K).toString():_e.int64AsType==="auto"?(t=te.getBigUint64(K),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=te.getBigUint64(K),K+=8,t;case 208:return te.getInt8(K++);case 209:return t=te.getInt16(K),K+=2,t;case 210:return t=te.getInt32(K),K+=4,t;case 211:return _e.int64AsType==="number"?(t=te.getInt32(K)*4294967296,t+=te.getUint32(K+4)):_e.int64AsType==="string"?t=te.getBigInt64(K).toString():_e.int64AsType==="auto"?(t=te.getBigInt64(K),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=te.getBigInt64(K),K+=8,t;case 212:if(t=Et[K++],t==114)return p_(Et[K++]&63);{let r=Kr[t];if(r)return r.read?(K++,r.read(Ye())):r.noBuffer?(K++,r()):r(Et.subarray(K,++K));throw new Error("Unknown extension "+t)}case 213:return t=Et[K],t==114?(K++,p_(Et[K++]&63,Et[K++])):Ss(2);case 214:return Ss(4);case 215:return Ss(8);case 216:return Ss(16);case 217:return t=Et[K++],ii>=K?Ji.slice(K-En,(K+=t)-En):TC(t);case 218:return t=te.getUint16(K),K+=2,ii>=K?Ji.slice(K-En,(K+=t)-En):SC(t);case 219:return t=te.getUint32(K),K+=4,ii>=K?Ji.slice(K-En,(K+=t)-En):RC(t);case 220:return t=te.getUint16(K),K+=2,a_(t);case 221:return t=te.getUint32(K),K+=4,a_(t);case 222:return t=te.getUint16(K),K+=2,c_(t);case 223:return t=te.getUint32(K),K+=4,c_(t);default:if(e>=224)return e-256;if(e===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+e)}}}const AC=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Zf(e,t){function r(){if(r.count++>r_){let i=e.read=new Function("r","return function(){return "+(_e.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":AC.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ye);return e.highByte===0&&(e.read=s_(t,e.read)),i()}let n={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),n[o]=Ye()}return _e.freezeData?Object.freeze(n):n}return r.count=0,e.highByte===0?s_(t,r):r}const s_=(e,t)=>function(){let r=Et[K++];if(r===0)return t();let n=e<32?-(e+(r<<5)):e+(r<<5),i=re[n]||o_()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=Zf(i,e)),i.read()};function o_(){let e=g_(()=>(Et=null,_e.getStructures()));return re=_e._mergeStructures(e,re)}var Qf=Sa,TC=Sa,SC=Sa,RC=Sa;function Sa(e){let t;if(e<16&&(t=td(e)))return t;if(e>64&&Jf)return Jf.decode(Et.subarray(K,K+=e));const r=K+e,n=[];for(t="";K<r;){const i=Et[K++];if(!(i&128))n.push(i);else if((i&224)===192){const s=Et[K++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=Et[K++]&63,o=Et[K++]&63;n.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Et[K++]&63,o=Et[K++]&63,a=Et[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c)}else n.push(i);n.length>=4096&&(t+=mr.apply(String,n),n.length=0)}return n.length>0&&(t+=mr.apply(String,n)),t}function a_(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=Ye();return _e.freezeData?Object.freeze(t):t}function c_(e){if(_e.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=f_();n==="__proto__"&&(n="__proto_"),t[n]=Ye()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(Ye(),Ye());return t}}var mr=String.fromCharCode;function l_(e){let t=K,r=new Array(e);for(let n=0;n<e;n++){const i=Et[K++];if((i&128)>0){K=t;return}r[n]=i}return mr.apply(String,r)}function td(e){if(e<4)if(e<2){if(e===0)return"";{let t=Et[K++];if((t&128)>1){K-=1;return}return mr(t)}}else{let t=Et[K++],r=Et[K++];if((t&128)>0||(r&128)>0){K-=2;return}if(e<3)return mr(t,r);let n=Et[K++];if((n&128)>0){K-=3;return}return mr(t,r,n)}else{let t=Et[K++],r=Et[K++],n=Et[K++],i=Et[K++];if((t&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){K-=4;return}if(e<6){if(e===4)return mr(t,r,n,i);{let s=Et[K++];if((s&128)>0){K-=5;return}return mr(t,r,n,i,s)}}else if(e<8){let s=Et[K++],o=Et[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(e<7)return mr(t,r,n,i,s,o);let a=Et[K++];if((a&128)>0){K-=7;return}return mr(t,r,n,i,s,o,a)}else{let s=Et[K++],o=Et[K++],a=Et[K++],c=Et[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(e<10){if(e===8)return mr(t,r,n,i,s,o,a,c);{let l=Et[K++];if((l&128)>0){K-=9;return}return mr(t,r,n,i,s,o,a,c,l)}}else if(e<12){let l=Et[K++],u=Et[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(e<11)return mr(t,r,n,i,s,o,a,c,l,u);let f=Et[K++];if((f&128)>0){K-=11;return}return mr(t,r,n,i,s,o,a,c,l,u,f)}else{let l=Et[K++],u=Et[K++],f=Et[K++],d=Et[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(e<14){if(e===12)return mr(t,r,n,i,s,o,a,c,l,u,f,d);{let h=Et[K++];if((h&128)>0){K-=13;return}return mr(t,r,n,i,s,o,a,c,l,u,f,d,h)}}else{let h=Et[K++],m=Et[K++];if((h&128)>0||(m&128)>0){K-=14;return}if(e<15)return mr(t,r,n,i,s,o,a,c,l,u,f,d,h,m);let p=Et[K++];if((p&128)>0){K-=15;return}return mr(t,r,n,i,s,o,a,c,l,u,f,d,h,m,p)}}}}}function u_(){let e=Et[K++],t;if(e<192)t=e-160;else switch(e){case 217:t=Et[K++];break;case 218:t=te.getUint16(K),K+=2;break;case 219:t=te.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return Sa(t)}function ed(e){return _e.copyBuffers?Uint8Array.prototype.slice.call(Et,K,K+=e):Et.subarray(K,K+=e)}function Ss(e){let t=Et[K++];if(Kr[t]){let r;return Kr[t](Et.subarray(K,r=K+=e),n=>{K=n;try{return Ye()}finally{K=r}})}else throw new Error("Unknown extension type "+t)}var h_=new Array(4096);function f_(){let e=Et[K++];if(e>=160&&e<192){if(e=e-160,ii>=K)return Ji.slice(K-En,(K+=e)-En);if(!(ii==0&&wn<180))return Qf(e)}else return K--,d_(Ye());let t=(e<<5^(e>1?te.getUint16(K):e>0?Et[K]:0))&4095,r=h_[t],n=K,i=K+e-3,s,o=0;if(r&&r.bytes==e){for(;n<i;){if(s=te.getUint32(n),s!=r[o++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(s=Et[n++],s!=r[o++]){n=1879048192;break}if(n===i)return K=n,r.string;i-=3,n=K}for(r=[],h_[t]=r,r.bytes=e;n<i;)s=te.getUint32(n),r.push(s),n+=4;for(i+=3;n<i;)s=Et[n++],r.push(s);let a=e<16?td(e):l_(e);return a!=null?r.string=a:r.string=Qf(e)}function d_(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const p_=(e,t)=>{let r=Ye().map(d_),n=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);let i=re[e];return i&&(i.isShared||Zi)&&((re.restoreStructures||(re.restoreStructures=[]))[e]=i),re[e]=r,r.read=Zf(r,n),r.read()};Kr[0]=()=>{},Kr[0].noBuffer=!0,Kr[66]=e=>{let t=e.length,r=BigInt(e[0]&128?e[0]-256:e[0]);for(let n=1;n<t;n++)r<<=BigInt(8),r+=BigInt(e[n]);return r};let OC={Error,TypeError,ReferenceError};Kr[101]=()=>{let e=Ye();return(OC[e[0]]||Error)(e[1],{cause:e[2]})},Kr[105]=e=>{if(_e.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=te.getUint32(K-4);Si||(Si=new Map);let r=Et[K],n;r>=144&&r<160||r==220||r==221?n=[]:n={};let i={target:n};Si.set(t,i);let s=Ye();return i.used?Object.assign(n,s):(i.target=s,s)},Kr[112]=e=>{if(_e.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=te.getUint32(K-4),r=Si.get(t);return r.used=!0,r.target},Kr[115]=()=>new Set(Ye());const m_=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let IC=typeof globalThis=="object"?globalThis:window;Kr[116]=e=>{let t=e[0],r=m_[t];if(!r){if(t===16){let n=new ArrayBuffer(e.length-1);return new Uint8Array(n).set(e.subarray(1)),n}throw new Error("Could not find typed array for code "+t)}return new IC[r](Uint8Array.prototype.slice.call(e,1).buffer)},Kr[120]=()=>{let e=Ye();return new RegExp(e[0],e[1])};const NC=[];Kr[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=K;return K+=t-e.length,pr=NC,pr=[u_(),u_()],pr.position0=0,pr.position1=0,pr.postBundlePosition=K,K=r,Ye()},Kr[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function g_(e){let t=wn,r=K,n=En,i=ii,s=Ji,o=Si,a=pr,c=new Uint8Array(Et.slice(0,wn)),l=re,u=re.slice(0,re.length),f=_e,d=Zi,h=e();return wn=t,K=r,En=n,ii=i,Ji=s,Si=o,pr=a,Et=c,Zi=d,re=l,re.splice(0,re.length,...u),_e=f,te=new DataView(Et.buffer,Et.byteOffset,Et.byteLength),h}function rd(){Et=null,Si=null,re=null}const nd=new Array(147);for(let e=0;e<256;e++)nd[e]=+("1e"+Math.floor(45.15-e*.30103));var bl=new Ta({useRecords:!1});const CC=bl.unpack;bl.unpackMultiple,bl.unpack;let LC=new Float32Array(1);new Uint8Array(LC.buffer,0,4);let wl;try{wl=new TextEncoder}catch{}let id,y_;const El=typeof wr<"u",kl=El?function(e){return wr.allocUnsafeSlow(e)}:Uint8Array,__=El?wr:Uint8Array,b_=El?4294967296:2144337920;let Q,Ra,be,Y=0,Cr,$e=null,MC;const UC=21760,PC=/[\u0080-\uFFFF]/,Ro=Symbol("record-id");class $C extends Ta{constructor(t){super(t),this.offset=0;let r,n,i,s,o=__.prototype.utf8Write?function(O,k){return Q.utf8Write(O,k,Q.byteLength-k)}:wl&&wl.encodeInto?function(O,k){return wl.encodeInto(O,Q.subarray(k)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,m=u+f+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],_=0,w=0;this.pack=this.encode=function(O,k){if(Q||(Q=new kl(8192),be=Q.dataView||(Q.dataView=new DataView(Q.buffer,0,8192)),Y=0),Cr=Q.length-10,Cr-Y<2048?(Q=new kl(Q.length),be=Q.dataView||(Q.dataView=new DataView(Q.buffer,0,Q.length)),Cr=Q.length-10,Y=0):Y=Y+7&2147483640,r=Y,k&GC&&(Y+=k&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof O!="string"?($e=[],$e.size=1/0):$e=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let B=i.sharedLength||0;if(B>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let $=0;$<B;$++){let ot=i[$];if(!ot)continue;let et,st=i.transitions;for(let G=0,D=ot.length;G<D;G++){let _t=ot[G];et=st[_t],et||(et=st[_t]=Object.create(null)),st=et}st[Ro]=$+64}this.lastNamedStructuresLength=B}c||(i.nextId=B+64)}n&&(n=!1);let L;try{a.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?M(O):T(O);let B=$e;if($e&&k_(r,T,0),s&&s.idsToInsert){let $=s.idsToInsert.sort((G,D)=>G.offset>D.offset?1:-1),ot=$.length,et=-1;for(;B&&ot>0;){let G=$[--ot].offset+r;G<B.stringsPosition+r&&et===-1&&(et=0),G>B.position+r?et>=0&&(et+=6):(et>=0&&(be.setUint32(B.position+r,be.getUint32(B.position+r)+et),et=-1),B=B.previous,ot++)}et>=0&&B&&be.setUint32(B.position+r,be.getUint32(B.position+r)+et),Y+=$.length*6,Y>Cr&&N(Y),a.offset=Y;let st=BC(Q.subarray(r,Y),$);return s=null,st}return a.offset=Y,k&jC?(Q.start=r,Q.end=Y,Q):Q.subarray(r,Y)}catch(B){throw L=B,B}finally{if(i&&(v(),n&&a.saveStructures)){let B=i.sharedLength||0,$=Q.subarray(r,Y),ot=DC(i,a);if(!L)return a.saveStructures(ot,ot.isCompatible)===!1?a.pack(O,k):(a.lastNamedStructuresLength=B,Q.length>1073741824&&(Q=null),$)}Q.length>1073741824&&(Q=null),k&zC&&(Y=r)}};const v=()=>{w<10&&w++;let O=i.sharedLength||0;if(i.length>O&&!c&&(i.length=O),_>1e4)i.transitions=null,w=0,_=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let k=0,L=p.length;k<L;k++)p[k][Ro]=0;p=[]}},A=O=>{var k=O.length;k<16?Q[Y++]=144|k:k<65536?(Q[Y++]=220,Q[Y++]=k>>8,Q[Y++]=k&255):(Q[Y++]=221,be.setUint32(Y,k),Y+=4);for(let L=0;L<k;L++)T(O[L])},T=O=>{Y>Cr&&(Q=N(Y));var k=typeof O,L;if(k==="string"){let B=O.length;if($e&&B>=4&&B<4096){if(($e.size+=B)>UC){let st,G=($e[0]?$e[0].length*3+$e[1].length:0)+10;Y+G>Cr&&(Q=N(Y+G));let D;$e.position?(D=$e,Q[Y]=200,Y+=3,Q[Y++]=98,st=Y-r,Y+=4,k_(r,T,0),be.setUint16(st+r-3,Y-r-st)):(Q[Y++]=214,Q[Y++]=98,st=Y-r,Y+=4),$e=["",""],$e.previous=D,$e.size=0,$e.position=st}let et=PC.test(O);$e[et?0:1]+=O,Q[Y++]=193,T(et?-B:B);return}let $;B<32?$=1:B<256?$=2:B<65536?$=3:$=5;let ot=B*3;if(Y+ot>Cr&&(Q=N(Y+ot)),B<64||!o){let et,st,G,D=Y+$;for(et=0;et<B;et++)st=O.charCodeAt(et),st<128?Q[D++]=st:st<2048?(Q[D++]=st>>6|192,Q[D++]=st&63|128):(st&64512)===55296&&((G=O.charCodeAt(et+1))&64512)===56320?(st=65536+((st&1023)<<10)+(G&1023),et++,Q[D++]=st>>18|240,Q[D++]=st>>12&63|128,Q[D++]=st>>6&63|128,Q[D++]=st&63|128):(Q[D++]=st>>12|224,Q[D++]=st>>6&63|128,Q[D++]=st&63|128);L=D-Y-$}else L=o(O,Y+$);L<32?Q[Y++]=160|L:L<256?($<2&&Q.copyWithin(Y+2,Y+1,Y+1+L),Q[Y++]=217,Q[Y++]=L):L<65536?($<3&&Q.copyWithin(Y+3,Y+2,Y+2+L),Q[Y++]=218,Q[Y++]=L>>8,Q[Y++]=L&255):($<5&&Q.copyWithin(Y+5,Y+3,Y+3+L),Q[Y++]=219,be.setUint32(Y,L),Y+=4),Y+=L}else if(k==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?Q[Y++]=O:O<256?(Q[Y++]=204,Q[Y++]=O):O<65536?(Q[Y++]=205,Q[Y++]=O>>8,Q[Y++]=O&255):(Q[Y++]=206,be.setUint32(Y,O),Y+=4);else if(O>>0===O)O>=-32?Q[Y++]=256+O:O>=-128?(Q[Y++]=208,Q[Y++]=O+256):O>=-32768?(Q[Y++]=209,be.setInt16(Y,O),Y+=2):(Q[Y++]=210,be.setInt32(Y,O),Y+=4);else{let B;if((B=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){Q[Y++]=202,be.setFloat32(Y,O);let $;if(B<4||($=O*nd[(Q[Y]&127)<<1|Q[Y+1]>>7])>>0===$){Y+=4;return}else Y--}Q[Y++]=203,be.setFloat64(Y,O),Y+=8}else if(k==="object"||k==="function")if(!O)Q[Y++]=192;else{if(s){let $=s.get(O);if($){if(!$.id){let ot=s.idsToInsert||(s.idsToInsert=[]);$.id=ot.push($)}Q[Y++]=214,Q[Y++]=112,be.setUint32(Y,$.id),Y+=4;return}else s.set(O,{offset:Y-r})}let B=O.constructor;if(B===Object)P(O);else if(B===Array)A(O);else if(B===Map)if(this.mapAsEmptyObject)Q[Y++]=128;else{L=O.size,L<16?Q[Y++]=128|L:L<65536?(Q[Y++]=222,Q[Y++]=L>>8,Q[Y++]=L&255):(Q[Y++]=223,be.setUint32(Y,L),Y+=4);for(let[$,ot]of O)T($),T(ot)}else{for(let $=0,ot=id.length;$<ot;$++){let et=y_[$];if(O instanceof et){let st=id[$];if(st.write){st.type&&(Q[Y++]=212,Q[Y++]=st.type,Q[Y++]=0);let at=st.write.call(this,O);at===O?Array.isArray(O)?A(O):P(O):T(at);return}let G=Q,D=be,_t=Y;Q=null;let q;try{q=st.pack.call(this,O,at=>(Q=G,G=null,Y+=at,Y>Cr&&N(Y),{target:Q,targetView:be,position:Y-at}),T)}finally{G&&(Q=G,be=D,Y=_t,Cr=Q.length-10)}q&&(q.length+Y>Cr&&N(q.length+Y),Y=FC(q,Q,Y,st.type));return}}if(Array.isArray(O))A(O);else{if(O.toJSON){const $=O.toJSON();if($!==O)return T($)}if(k==="function")return T(this.writeFunction&&this.writeFunction(O));P(O)}}}else if(k==="boolean")Q[Y++]=O?195:194;else if(k==="bigint"){if(O<BigInt(1)<<BigInt(63)&&O>=-(BigInt(1)<<BigInt(63)))Q[Y++]=211,be.setBigInt64(Y,O);else if(O<BigInt(1)<<BigInt(64)&&O>0)Q[Y++]=207,be.setBigUint64(Y,O);else if(this.largeBigIntToFloat)Q[Y++]=203,be.setFloat64(Y,Number(O));else{if(this.largeBigIntToString)return T(O.toString());if(this.useBigIntExtension&&O<BigInt(2)**BigInt(1023)&&O>-(BigInt(2)**BigInt(1023))){Q[Y++]=199,Y++,Q[Y++]=66;let B=[],$;do{let ot=O&BigInt(255);$=(ot&BigInt(128))===(O<BigInt(0)?BigInt(128):BigInt(0)),B.push(ot),O>>=BigInt(8)}while(!((O===BigInt(0)||O===BigInt(-1))&&$));Q[Y-2]=B.length;for(let ot=B.length;ot>0;)Q[Y++]=Number(B[--ot]);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Y+=8}else if(k==="undefined")this.encodeUndefinedAsNil?Q[Y++]=192:(Q[Y++]=212,Q[Y++]=0,Q[Y++]=0);else throw new Error("Unknown type: "+k)},I=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let k;if(this.skipValues){k=[];for(let $ in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty($))&&!this.skipValues.includes(O[$])&&k.push($)}else k=Object.keys(O);let L=k.length;L<16?Q[Y++]=128|L:L<65536?(Q[Y++]=222,Q[Y++]=L>>8,Q[Y++]=L&255):(Q[Y++]=223,be.setUint32(Y,L),Y+=4);let B;if(this.coercibleKeyAsNumber)for(let $=0;$<L;$++){B=k[$];let ot=Number(B);T(isNaN(ot)?B:ot),T(O[B])}else for(let $=0;$<L;$++)T(B=k[$]),T(O[B])}:O=>{Q[Y++]=222;let k=Y-r;Y+=2;let L=0;for(let B in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(B))&&(T(B),T(O[B]),L++);if(L>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');Q[k+++r]=L>>8,Q[k+r]=L&255},S=this.useRecords===!1?I:t.progressiveRecords&&!d?O=>{let k,L=i.transitions||(i.transitions=Object.create(null)),B=Y++-r,$;for(let ot in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot)){if(k=L[ot],k)L=k;else{let et=Object.keys(O),st=L;L=i.transitions;let G=0;for(let D=0,_t=et.length;D<_t;D++){let q=et[D];k=L[q],k||(k=L[q]=Object.create(null),G++),L=k}B+r+1==Y?(Y--,z(L,et,G)):J(L,et,B,G),$=!0,L=st[ot]}T(O[ot])}if(!$){let ot=L[Ro];ot?Q[B+r]=ot:J(L,Object.keys(O),B,0)}}:O=>{let k,L=i.transitions||(i.transitions=Object.create(null)),B=0;for(let ot in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot))&&(k=L[ot],k||(k=L[ot]=Object.create(null),B++),L=k);let $=L[Ro];$?$>=96&&d?(Q[Y++]=(($-=96)&31)+96,Q[Y++]=$>>5):Q[Y++]=$:z(L,L.__keys__||Object.keys(O),B);for(let ot in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot))&&T(O[ot])},C=typeof this.useRecords=="function"&&this.useRecords,P=C?O=>{C(O)?S(O):I(O)}:S,N=O=>{let k;if(O>16777216){if(O-r>b_)throw new Error("Packed buffer would be larger than maximum buffer size");k=Math.min(b_,Math.round(Math.max((O-r)*(O>67108864?1.25:2),4194304)/4096)*4096)}else k=(Math.max(O-r<<2,Q.length-1)>>12)+1<<12;let L=new kl(k);return be=L.dataView||(L.dataView=new DataView(L.buffer,0,k)),O=Math.min(O,Q.length),Q.copy?Q.copy(L,0,r,O):L.set(Q.slice(r,O)),Y-=r,r=0,Cr=L.length-10,Q=L},z=(O,k,L)=>{let B=i.nextId;B||(B=64),B<h&&this.shouldShareStructure&&!this.shouldShareStructure(k)?(B=i.nextOwnId,B<m||(B=h),i.nextOwnId=B+1):(B>=m&&(B=h),i.nextId=B+1);let $=k.highByte=B>=96&&d?B-96>>5:-1;O[Ro]=B,O.__keys__=k,i[B-64]=k,B<h?(k.isShared=!0,i.sharedLength=B-63,n=!0,$>=0?(Q[Y++]=(B&31)+96,Q[Y++]=$):Q[Y++]=B):($>=0?(Q[Y++]=213,Q[Y++]=114,Q[Y++]=(B&31)+96,Q[Y++]=$):(Q[Y++]=212,Q[Y++]=114,Q[Y++]=B),L&&(_+=w*L),p.length>=f&&(p.shift()[Ro]=0),p.push(O),T(k))},J=(O,k,L,B)=>{let $=Q,ot=Y,et=Cr,st=r;Q=Ra,Y=0,r=0,Q||(Ra=Q=new kl(8192)),Cr=Q.length-10,z(O,k,B),Ra=Q;let G=Y;if(Q=$,Y=ot,Cr=et,r=st,G>1){let D=Y+G-1;D>Cr&&N(D);let _t=L+r;Q.copyWithin(_t+G,_t+1,Y),Q.set(Ra.slice(0,G),_t),Y=D}else Q[L+r]=Ra[0]},M=O=>{let k=MC(O,Q,r,Y,i,N,(L,B,$)=>{if($)return n=!0;Y=B;let ot=Q;return T(L),v(),ot!==Q?{position:Y,targetView:be,target:Q}:Y},this);if(k===0)return P(O);Y=k}}useBuffer(t){Q=t,Q.dataView||(Q.dataView=new DataView(Q.buffer,Q.byteOffset,Q.byteLength)),Y=0}set position(t){Y=t}get position(){return Y}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}y_=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,t_],id=[{pack(e,t,r){let n=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,n)}else if(n>0&&n<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(e,t,r){if(this.setAsEmptyObject)return t(0),r({});let n=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([e.name,e.message,e.cause])}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([e.source,e.flags])}},{pack(e,t){this.moreTypes?w_(e,16,t):E_(El?wr.from(e):new Uint8Array(e),t)}},{pack(e,t){let r=e.constructor;r!==__&&this.moreTypes?w_(e,m_.indexOf(r.name),t):E_(e,t)}},{pack(e,t){let{target:r,position:n}=t(1);r[n]=193}}];function w_(e,t,r,n){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=r(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=r(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=r(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function E_(e,t){let r=e.byteLength;var n,i;if(r<256){var{target:n,position:i}=t(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=t(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:s}=t(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(e,i)}function FC(e,t,r,n){let i=e.length;switch(i){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:i<256?(t[r++]=199,t[r++]=i):i<65536?(t[r++]=200,t[r++]=i>>8,t[r++]=i&255):(t[r++]=201,t[r++]=i>>24,t[r++]=i>>16&255,t[r++]=i>>8&255,t[r++]=i&255)}return t[r++]=n,t.set(e,r),r+=i,r}function BC(e,t){let r,n=t.length*6,i=e.length-n;for(;r=t.pop();){let s=r.offset,o=r.id;e.copyWithin(s+n,s,i),n-=6;let a=s+n;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function k_(e,t,r){if($e.length>0){be.setUint32($e.position+e,Y+r-$e.position-e),$e.stringsPosition=Y-e;let n=$e;$e=null,t(n[0]),t(n[1])}}function DC(e,t){return e.isCompatible=r=>{let n=!r||(t.lastNamedStructuresLength||0)===r.length;return n||t._mergeStructures(r),n},e}let v_=new $C({useRecords:!1});v_.pack,v_.pack;const jC=512,zC=1024,GC=2048;function Re(){return null}function Oo(e,t,r={}){if(!y(e))return;const n=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=r[o];y(c)&&(a=c(a));const l=t[o];y(l)&&(o=l),a!==null&&n.push(o,a)}return n}function Oa(e,t,r={}){if(y(e))try{const n={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];y(a)&&(s=a);const c=r[s];y(c)&&(o=c(o)),n[s]=o}return n}catch(n){de(Z,"","binary",n.message)}}function WC(e){try{return xC(e)}catch(t){de(Z,"","binary",t.message)}}function x_(e){if(pt(e)){try{return JSON.parse(e)}catch(t){de(Z,"","binary",t.message)}return}try{return CC(e)}catch(t){de(Z,"","binary",t.message)}}function A_(){return{id:We()}}var vl=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e[e.shootx=39]="shootx",e[e.shooty=40]="shooty",e))(vl||{});function xl(e){return y(e==null?void 0:e.id)?Oo(e,vl,{category:Re,kinddata:Re,stopped:Re,removed:Re,bucket:Re}):Oo(e,vl,{id:Re,x:Re,y:Re,lx:Re,ly:Re,code:Re,category:Re,kinddata:Re,stopped:Re,removed:Re,bucket:Re})}function Al(e){return Oa(e,vl)}function Ve(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function Ia(e,t){if(!y(e)||!Ir(t))return;const{color:r,bg:n}=Vg(t);y(r)&&(e.color=r),y(n)&&(e.bg=n)}function T_(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function S_(e){const t=Math.floor(e.length/nl);if(t*nl!==e.length)return;const r=T_(3,t);for(let n=0;n<r.bits.length;++n)r.bits[n]=e[n];return r}function HC(e,t){return e&1<<t?255:0}function R_(e){const t=Math.floor(e.length/Tf);if(t*Tf!==e.length)return;const r=Math.ceil(t/il),n=Yi*il,i=T_(n,Vi*r);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*Vi+a,u=e[c];for(let f=0;f<Yi;++f){const d=s*Yi+f;i.bits[d+l*n]=HC(u,7-f)}++a,a===Vi&&(a=0,++s,s===il&&(s=0,++o))}return i}const KC=Ac("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),YC=Ac("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var O_=typeof Zs=="object"&&Zs&&Zs.Object===Object&&Zs,VC=typeof self=="object"&&self&&self.Object===Object&&self,si=O_||VC||Function("return this")(),kn=si.Symbol,I_=Object.prototype,qC=I_.hasOwnProperty,XC=I_.toString,Na=kn?kn.toStringTag:void 0;function JC(e){var t=qC.call(e,Na),r=e[Na];try{e[Na]=void 0;var n=!0}catch{}var i=XC.call(e);return n&&(t?e[Na]=r:delete e[Na]),i}var ZC=Object.prototype,QC=ZC.toString;function tL(e){return QC.call(e)}var eL="[object Null]",rL="[object Undefined]",N_=kn?kn.toStringTag:void 0;function Qi(e){return e==null?e===void 0?rL:eL:N_&&N_ in Object(e)?JC(e):tL(e)}function Bn(e){return e!=null&&typeof e=="object"}var nL="[object Symbol]";function Tl(e){return typeof e=="symbol"||Bn(e)&&Qi(e)==nL}function Sl(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var oe=Array.isArray,iL=1/0,C_=kn?kn.prototype:void 0,L_=C_?C_.toString:void 0;function M_(e){if(typeof e=="string")return e;if(oe(e))return Sl(e,M_)+"";if(Tl(e))return L_?L_.call(e):"";var t=e+"";return t=="0"&&1/e==-iL?"-0":t}var sL=/\s/;function oL(e){for(var t=e.length;t--&&sL.test(e.charAt(t)););return t}var aL=/^\s+/;function cL(e){return e&&e.slice(0,oL(e)+1).replace(aL,"")}function vn(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var U_=NaN,lL=/^[-+]0x[0-9a-f]+$/i,uL=/^0b[01]+$/i,hL=/^0o[0-7]+$/i,fL=parseInt;function dL(e){if(typeof e=="number")return e;if(Tl(e))return U_;if(vn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=vn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=cL(e);var r=uL.test(e);return r||hL.test(e)?fL(e.slice(2),r?2:8):lL.test(e)?U_:+e}var P_=1/0,pL=17976931348623157e292;function mL(e){if(!e)return e===0?e:0;if(e=dL(e),e===P_||e===-P_){var t=e<0?-1:1;return t*pL}return e===e?e:0}function Rl(e){var t=mL(e),r=t%1;return t===t?r?t-r:t:0}function Io(e){return e}var gL="[object AsyncFunction]",yL="[object Function]",_L="[object GeneratorFunction]",bL="[object Proxy]";function Ri(e){if(!vn(e))return!1;var t=Qi(e);return t==yL||t==_L||t==gL||t==bL}var sd=si["__core-js_shared__"],$_=function(){var e=/[^.]+$/.exec(sd&&sd.keys&&sd.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function wL(e){return!!$_&&$_ in e}var EL=Function.prototype,kL=EL.toString;function Rs(e){if(e!=null){try{return kL.call(e)}catch{}try{return e+""}catch{}}return""}var vL=/[\\^$.*+?()[\]{}|]/g,xL=/^\[object .+?Constructor\]$/,AL=Function.prototype,TL=Object.prototype,SL=AL.toString,RL=TL.hasOwnProperty,OL=RegExp("^"+SL.call(RL).replace(vL,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function IL(e){if(!vn(e)||wL(e))return!1;var t=Ri(e)?OL:xL;return t.test(Rs(e))}function NL(e,t){return e==null?void 0:e[t]}function Os(e,t){var r=NL(e,t);return IL(r)?r:void 0}var od=Os(si,"WeakMap"),F_=Object.create,CL=function(){function e(){}return function(t){if(!vn(t))return{};if(F_)return F_(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function LL(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function nr(){}function ML(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var UL=800,PL=16,$L=Date.now;function FL(e){var t=0,r=0;return function(){var n=$L(),i=PL-(n-r);if(r=n,i>0){if(++t>=UL)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function BL(e){return function(){return e}}var Ol=function(){try{var e=Os(Object,"defineProperty");return e({},"",{}),e}catch{}}(),DL=Ol?function(e,t){return Ol(e,"toString",{configurable:!0,enumerable:!1,value:BL(t),writable:!0})}:Io,jL=FL(DL);function B_(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}function D_(e,t,r,n){for(var i=e.length,s=r+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function zL(e){return e!==e}function GL(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function ad(e,t,r){return t===t?GL(e,t,r):D_(e,zL,r)}function j_(e,t){var r=e==null?0:e.length;return!!r&&ad(e,t,0)>-1}var WL=9007199254740991,HL=/^(?:0|[1-9]\d*)$/;function Il(e,t){var r=typeof e;return t=t??WL,!!t&&(r=="number"||r!="symbol"&&HL.test(e))&&e>-1&&e%1==0&&e<t}function cd(e,t,r){t=="__proto__"&&Ol?Ol(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Ca(e,t){return e===t||e!==e&&t!==t}var KL=Object.prototype,YL=KL.hasOwnProperty;function Nl(e,t,r){var n=e[t];(!(YL.call(e,t)&&Ca(n,r))||r===void 0&&!(t in e))&&cd(e,t,r)}function ld(e,t,r,n){var i=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?cd(r,a,c):Nl(r,a,c)}return r}var z_=Math.max;function VL(e,t,r){return t=z_(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,s=z_(n.length-t,0),o=Array(s);++i<s;)o[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(o),LL(e,this,a)}}function ud(e,t){return jL(VL(e,t,Io),e+"")}var qL=9007199254740991;function hd(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=qL}function oi(e){return e!=null&&hd(e.length)&&!Ri(e)}function G_(e,t,r){if(!vn(r))return!1;var n=typeof t;return(n=="number"?oi(r)&&Il(t,r.length):n=="string"&&t in r)?Ca(r[t],e):!1}function XL(e){return ud(function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&G_(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++n<i;){var a=r[n];a&&e(t,a,n,s)}return t})}var JL=Object.prototype;function La(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||JL;return e===r}function ZL(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var QL="[object Arguments]";function W_(e){return Bn(e)&&Qi(e)==QL}var H_=Object.prototype,t6=H_.hasOwnProperty,e6=H_.propertyIsEnumerable,Cl=W_(function(){return arguments}())?W_:function(e){return Bn(e)&&t6.call(e,"callee")&&!e6.call(e,"callee")};function r6(){return!1}var K_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Y_=K_&&typeof module=="object"&&module&&!module.nodeType&&module,n6=Y_&&Y_.exports===K_,V_=n6?si.Buffer:void 0,i6=V_?V_.isBuffer:void 0,Ma=i6||r6,s6="[object Arguments]",o6="[object Array]",a6="[object Boolean]",c6="[object Date]",l6="[object Error]",u6="[object Function]",h6="[object Map]",f6="[object Number]",d6="[object Object]",p6="[object RegExp]",m6="[object Set]",g6="[object String]",y6="[object WeakMap]",_6="[object ArrayBuffer]",b6="[object DataView]",w6="[object Float32Array]",E6="[object Float64Array]",k6="[object Int8Array]",v6="[object Int16Array]",x6="[object Int32Array]",A6="[object Uint8Array]",T6="[object Uint8ClampedArray]",S6="[object Uint16Array]",R6="[object Uint32Array]",xe={};xe[w6]=xe[E6]=xe[k6]=xe[v6]=xe[x6]=xe[A6]=xe[T6]=xe[S6]=xe[R6]=!0,xe[s6]=xe[o6]=xe[_6]=xe[a6]=xe[b6]=xe[c6]=xe[l6]=xe[u6]=xe[h6]=xe[f6]=xe[d6]=xe[p6]=xe[m6]=xe[g6]=xe[y6]=!1;function O6(e){return Bn(e)&&hd(e.length)&&!!xe[Qi(e)]}function Ll(e){return function(t){return e(t)}}var q_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ua=q_&&typeof module=="object"&&module&&!module.nodeType&&module,I6=Ua&&Ua.exports===q_,fd=I6&&O_.process,ts=function(){try{var e=Ua&&Ua.require&&Ua.require("util").types;return e||fd&&fd.binding&&fd.binding("util")}catch{}}(),X_=ts&&ts.isTypedArray,dd=X_?Ll(X_):O6,N6=Object.prototype,C6=N6.hasOwnProperty;function J_(e,t){var r=oe(e),n=!r&&Cl(e),i=!r&&!n&&Ma(e),s=!r&&!n&&!i&&dd(e),o=r||n||i||s,a=o?ZL(e.length,String):[],c=a.length;for(var l in e)(t||C6.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Il(l,c)))&&a.push(l);return a}function Z_(e,t){return function(r){return e(t(r))}}var L6=Z_(Object.keys,Object),M6=Object.prototype,U6=M6.hasOwnProperty;function Q_(e){if(!La(e))return L6(e);var t=[];for(var r in Object(e))U6.call(e,r)&&r!="constructor"&&t.push(r);return t}function xn(e){return oi(e)?J_(e):Q_(e)}var P6=Object.prototype,$6=P6.hasOwnProperty,Yr=XL(function(e,t){if(La(t)||oi(t)){ld(t,xn(t),e);return}for(var r in t)$6.call(t,r)&&Nl(e,r,t[r])});function F6(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var B6=Object.prototype,D6=B6.hasOwnProperty;function j6(e){if(!vn(e))return F6(e);var t=La(e),r=[];for(var n in e)n=="constructor"&&(t||!D6.call(e,n))||r.push(n);return r}function tb(e){return oi(e)?J_(e,!0):j6(e)}var z6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,G6=/^\w*$/;function pd(e,t){if(oe(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Tl(e)?!0:G6.test(e)||!z6.test(e)||t!=null&&e in Object(t)}var Pa=Os(Object,"create");function W6(){this.__data__=Pa?Pa(null):{},this.size=0}function H6(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var K6="__lodash_hash_undefined__",Y6=Object.prototype,V6=Y6.hasOwnProperty;function q6(e){var t=this.__data__;if(Pa){var r=t[e];return r===K6?void 0:r}return V6.call(t,e)?t[e]:void 0}var X6=Object.prototype,J6=X6.hasOwnProperty;function Z6(e){var t=this.__data__;return Pa?t[e]!==void 0:J6.call(t,e)}var Q6="__lodash_hash_undefined__";function tM(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Pa&&t===void 0?Q6:t,this}function Is(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Is.prototype.clear=W6,Is.prototype.delete=H6,Is.prototype.get=q6,Is.prototype.has=Z6,Is.prototype.set=tM;function eM(){this.__data__=[],this.size=0}function Ml(e,t){for(var r=e.length;r--;)if(Ca(e[r][0],t))return r;return-1}var rM=Array.prototype,nM=rM.splice;function iM(e){var t=this.__data__,r=Ml(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():nM.call(t,r,1),--this.size,!0}function sM(e){var t=this.__data__,r=Ml(t,e);return r<0?void 0:t[r][1]}function oM(e){return Ml(this.__data__,e)>-1}function aM(e,t){var r=this.__data__,n=Ml(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function Oi(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Oi.prototype.clear=eM,Oi.prototype.delete=iM,Oi.prototype.get=sM,Oi.prototype.has=oM,Oi.prototype.set=aM;var $a=Os(si,"Map");function cM(){this.size=0,this.__data__={hash:new Is,map:new($a||Oi),string:new Is}}function lM(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ul(e,t){var r=e.__data__;return lM(t)?r[typeof t=="string"?"string":"hash"]:r.map}function uM(e){var t=Ul(this,e).delete(e);return this.size-=t?1:0,t}function hM(e){return Ul(this,e).get(e)}function fM(e){return Ul(this,e).has(e)}function dM(e,t){var r=Ul(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function Ii(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ii.prototype.clear=cM,Ii.prototype.delete=uM,Ii.prototype.get=hM,Ii.prototype.has=fM,Ii.prototype.set=dM;var pM="Expected a function";function md(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(pM);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(md.Cache||Ii),r}md.Cache=Ii;var mM=500;function gM(e){var t=md(e,function(n){return r.size===mM&&r.clear(),n}),r=t.cache;return t}var yM=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_M=/\\(\\)?/g,bM=gM(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(yM,function(r,n,i,s){t.push(i?s.replace(_M,"$1"):n||r)}),t});function eb(e){return e==null?"":M_(e)}function Pl(e,t){return oe(e)?e:pd(e,t)?[e]:bM(eb(e))}var wM=1/0;function Fa(e){if(typeof e=="string"||Tl(e))return e;var t=e+"";return t=="0"&&1/e==-wM?"-0":t}function gd(e,t){t=Pl(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Fa(t[r++])];return r&&r==n?e:void 0}function EM(e,t,r){var n=e==null?void 0:gd(e,t);return n===void 0?r:n}function yd(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var rb=kn?kn.isConcatSpreadable:void 0;function kM(e){return oe(e)||Cl(e)||!!(rb&&e&&e[rb])}function _d(e,t,r,n,i){var s=-1,o=e.length;for(r||(r=kM),i||(i=[]);++s<o;){var a=e[s];r(a)?yd(i,a):n||(i[i.length]=a)}return i}function hn(e){var t=e==null?0:e.length;return t?_d(e):[]}var nb=Z_(Object.getPrototypeOf,Object);function bd(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function vM(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:bd(e,t,r)}var xM="\\ud800-\\udfff",AM="\\u0300-\\u036f",TM="\\ufe20-\\ufe2f",SM="\\u20d0-\\u20ff",RM=AM+TM+SM,OM="\\ufe0e\\ufe0f",IM="\\u200d",NM=RegExp("["+IM+xM+RM+OM+"]");function ib(e){return NM.test(e)}function CM(e){return e.split("")}var sb="\\ud800-\\udfff",LM="\\u0300-\\u036f",MM="\\ufe20-\\ufe2f",UM="\\u20d0-\\u20ff",PM=LM+MM+UM,$M="\\ufe0e\\ufe0f",FM="["+sb+"]",wd="["+PM+"]",Ed="\\ud83c[\\udffb-\\udfff]",BM="(?:"+wd+"|"+Ed+")",ob="[^"+sb+"]",ab="(?:\\ud83c[\\udde6-\\uddff]){2}",cb="[\\ud800-\\udbff][\\udc00-\\udfff]",DM="\\u200d",lb=BM+"?",ub="["+$M+"]?",jM="(?:"+DM+"(?:"+[ob,ab,cb].join("|")+")"+ub+lb+")*",zM=ub+lb+jM,GM="(?:"+[ob+wd+"?",wd,ab,cb,FM].join("|")+")",WM=RegExp(Ed+"(?="+Ed+")|"+GM+zM,"g");function HM(e){return e.match(WM)||[]}function KM(e){return ib(e)?HM(e):CM(e)}function YM(e){return function(t){t=eb(t);var r=ib(t)?KM(t):void 0,n=r?r[0]:t.charAt(0),i=r?vM(r,1).join(""):t.slice(1);return n[e]()+i}}var hb=YM("toUpperCase");function VM(e,t,r,n){var i=-1,s=e==null?0:e.length;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function qM(){this.__data__=new Oi,this.size=0}function XM(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function JM(e){return this.__data__.get(e)}function ZM(e){return this.__data__.has(e)}var QM=200;function tU(e,t){var r=this.__data__;if(r instanceof Oi){var n=r.__data__;if(!$a||n.length<QM-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ii(n)}return r.set(e,t),this.size=r.size,this}function ai(e){var t=this.__data__=new Oi(e);this.size=t.size}ai.prototype.clear=qM,ai.prototype.delete=XM,ai.prototype.get=JM,ai.prototype.has=ZM,ai.prototype.set=tU;function eU(e,t){return e&&ld(t,xn(t),e)}var fb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,db=fb&&typeof module=="object"&&module&&!module.nodeType&&module,rU=db&&db.exports===fb,pb=rU?si.Buffer:void 0,mb=pb?pb.allocUnsafe:void 0;function nU(e,t){var r=e.length,n=mb?mb(r):new e.constructor(r);return e.copy(n),n}function kd(e,t){for(var r=-1,n=e==null?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}function gb(){return[]}var iU=Object.prototype,sU=iU.propertyIsEnumerable,yb=Object.getOwnPropertySymbols,vd=yb?function(e){return e==null?[]:(e=Object(e),kd(yb(e),function(t){return sU.call(e,t)}))}:gb;function oU(e,t){return ld(e,vd(e),t)}var aU=Object.getOwnPropertySymbols,cU=aU?function(e){for(var t=[];e;)yd(t,vd(e)),e=nb(e);return t}:gb;function _b(e,t,r){var n=t(e);return oe(e)?n:yd(n,r(e))}function xd(e){return _b(e,xn,vd)}function lU(e){return _b(e,tb,cU)}var Ad=Os(si,"DataView"),Td=Os(si,"Promise"),No=Os(si,"Set"),bb="[object Map]",uU="[object Object]",wb="[object Promise]",Eb="[object Set]",kb="[object WeakMap]",vb="[object DataView]",hU=Rs(Ad),fU=Rs($a),dU=Rs(Td),pU=Rs(No),mU=Rs(od),An=Qi;(Ad&&An(new Ad(new ArrayBuffer(1)))!=vb||$a&&An(new $a)!=bb||Td&&An(Td.resolve())!=wb||No&&An(new No)!=Eb||od&&An(new od)!=kb)&&(An=function(e){var t=Qi(e),r=t==uU?e.constructor:void 0,n=r?Rs(r):"";if(n)switch(n){case hU:return vb;case fU:return bb;case dU:return wb;case pU:return Eb;case mU:return kb}return t});var gU=Object.prototype,yU=gU.hasOwnProperty;function _U(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&yU.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var $l=si.Uint8Array;function bU(e){var t=new e.constructor(e.byteLength);return new $l(t).set(new $l(e)),t}function wU(e,t){var r=e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var EU=/\w*$/;function kU(e){var t=new e.constructor(e.source,EU.exec(e));return t.lastIndex=e.lastIndex,t}var xb=kn?kn.prototype:void 0,Ab=xb?xb.valueOf:void 0;function vU(e){return Ab?Object(Ab.call(e)):{}}function xU(e,t){var r=e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var AU="[object Boolean]",TU="[object Date]",SU="[object Map]",RU="[object Number]",OU="[object RegExp]",IU="[object Set]",NU="[object String]",CU="[object Symbol]",LU="[object ArrayBuffer]",MU="[object DataView]",UU="[object Float32Array]",PU="[object Float64Array]",$U="[object Int8Array]",FU="[object Int16Array]",BU="[object Int32Array]",DU="[object Uint8Array]",jU="[object Uint8ClampedArray]",zU="[object Uint16Array]",GU="[object Uint32Array]";function WU(e,t,r){var n=e.constructor;switch(t){case LU:return bU(e);case AU:case TU:return new n(+e);case MU:return wU(e);case UU:case PU:case $U:case FU:case BU:case DU:case jU:case zU:case GU:return xU(e);case SU:return new n;case RU:case NU:return new n(e);case OU:return kU(e);case IU:return new n;case CU:return vU(e)}}function HU(e){return typeof e.constructor=="function"&&!La(e)?CL(nb(e)):{}}var KU="[object Map]";function YU(e){return Bn(e)&&An(e)==KU}var Tb=ts&&ts.isMap,VU=Tb?Ll(Tb):YU,qU="[object Set]";function XU(e){return Bn(e)&&An(e)==qU}var Sb=ts&&ts.isSet,JU=Sb?Ll(Sb):XU,Rb="[object Arguments]",ZU="[object Array]",QU="[object Boolean]",t2="[object Date]",e2="[object Error]",Ob="[object Function]",r2="[object GeneratorFunction]",n2="[object Map]",i2="[object Number]",Ib="[object Object]",s2="[object RegExp]",o2="[object Set]",a2="[object String]",c2="[object Symbol]",l2="[object WeakMap]",u2="[object ArrayBuffer]",h2="[object DataView]",f2="[object Float32Array]",d2="[object Float64Array]",p2="[object Int8Array]",m2="[object Int16Array]",g2="[object Int32Array]",y2="[object Uint8Array]",_2="[object Uint8ClampedArray]",b2="[object Uint16Array]",w2="[object Uint32Array]",we={};we[Rb]=we[ZU]=we[u2]=we[h2]=we[QU]=we[t2]=we[f2]=we[d2]=we[p2]=we[m2]=we[g2]=we[n2]=we[i2]=we[Ib]=we[s2]=we[o2]=we[a2]=we[c2]=we[y2]=we[_2]=we[b2]=we[w2]=!0,we[e2]=we[Ob]=we[l2]=!1;function Fl(e,t,r,n,i,s){var o;if(o!==void 0)return o;if(!vn(e))return e;var a=oe(e);if(a)return o=_U(e),ML(e,o);var c=An(e),l=c==Ob||c==r2;if(Ma(e))return nU(e);if(c==Ib||c==Rb||l&&!i)return o=l?{}:HU(e),oU(e,eU(o,e));if(!we[c])return i?e:{};o=WU(e,c),s||(s=new ai);var u=s.get(e);if(u)return u;s.set(e,o),JU(e)?e.forEach(function(h){o.add(Fl(h,t,r,h,e,s))}):VU(e)&&e.forEach(function(h,m){o.set(m,Fl(h,t,r,m,e,s))});var f=xd,d=a?void 0:f(e);return B_(d||e,function(h,m){d&&(m=h,h=e[m]),Nl(o,m,Fl(h,t,r,m,e,s))}),o}var E2=4;function kr(e){return Fl(e,E2)}function Ba(e){for(var t=-1,r=e==null?0:e.length,n=0,i=[];++t<r;){var s=e[t];s&&(i[n++]=s)}return i}var k2="__lodash_hash_undefined__";function v2(e){return this.__data__.set(e,k2),this}function x2(e){return this.__data__.has(e)}function Co(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Ii;++t<r;)this.add(e[t])}Co.prototype.add=Co.prototype.push=v2,Co.prototype.has=x2;function Nb(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Sd(e,t){return e.has(t)}var A2=1,T2=2;function Cb(e,t,r,n,i,s){var o=r&A2,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=r&T2?new Co:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var m=e[f],p=t[f];if(n)var _=o?n(p,m,f,t,e,s):n(m,p,f,e,t,s);if(_!==void 0){if(_)continue;d=!1;break}if(h){if(!Nb(t,function(w,v){if(!Sd(h,v)&&(m===w||i(m,w,r,n,s)))return h.push(v)})){d=!1;break}}else if(!(m===p||i(m,p,r,n,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function S2(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function Rd(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var R2=1,O2=2,I2="[object Boolean]",N2="[object Date]",C2="[object Error]",L2="[object Map]",M2="[object Number]",U2="[object RegExp]",P2="[object Set]",$2="[object String]",F2="[object Symbol]",B2="[object ArrayBuffer]",D2="[object DataView]",Lb=kn?kn.prototype:void 0,Od=Lb?Lb.valueOf:void 0;function j2(e,t,r,n,i,s,o){switch(r){case D2:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case B2:return!(e.byteLength!=t.byteLength||!s(new $l(e),new $l(t)));case I2:case N2:case M2:return Ca(+e,+t);case C2:return e.name==t.name&&e.message==t.message;case U2:case $2:return e==t+"";case L2:var a=S2;case P2:var c=n&R2;if(a||(a=Rd),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;n|=O2,o.set(e,t);var u=Cb(a(e),a(t),n,i,s,o);return o.delete(e),u;case F2:if(Od)return Od.call(e)==Od.call(t)}return!1}var z2=1,G2=Object.prototype,W2=G2.hasOwnProperty;function H2(e,t,r,n,i,s){var o=r&z2,a=xd(e),c=a.length,l=xd(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:W2.call(t,d)))return!1}var h=s.get(e),m=s.get(t);if(h&&m)return h==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var _=o;++f<c;){d=a[f];var w=e[d],v=t[d];if(n)var A=o?n(v,w,d,t,e,s):n(w,v,d,e,t,s);if(!(A===void 0?w===v||i(w,v,r,n,s):A)){p=!1;break}_||(_=d=="constructor")}if(p&&!_){var T=e.constructor,I=t.constructor;T!=I&&"constructor"in e&&"constructor"in t&&!(typeof T=="function"&&T instanceof T&&typeof I=="function"&&I instanceof I)&&(p=!1)}return s.delete(e),s.delete(t),p}var K2=1,Mb="[object Arguments]",Ub="[object Array]",Bl="[object Object]",Y2=Object.prototype,Pb=Y2.hasOwnProperty;function V2(e,t,r,n,i,s){var o=oe(e),a=oe(t),c=o?Ub:An(e),l=a?Ub:An(t);c=c==Mb?Bl:c,l=l==Mb?Bl:l;var u=c==Bl,f=l==Bl,d=c==l;if(d&&Ma(e)){if(!Ma(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ai),o||dd(e)?Cb(e,t,r,n,i,s):j2(e,t,c,r,n,i,s);if(!(r&K2)){var h=u&&Pb.call(e,"__wrapped__"),m=f&&Pb.call(t,"__wrapped__");if(h||m){var p=h?e.value():e,_=m?t.value():t;return s||(s=new ai),i(p,_,r,n,s)}}return d?(s||(s=new ai),H2(e,t,r,n,i,s)):!1}function Id(e,t,r,n,i){return e===t?!0:e==null||t==null||!Bn(e)&&!Bn(t)?e!==e&&t!==t:V2(e,t,r,n,Id,i)}var q2=1,X2=2;function J2(e,t,r,n){var i=r.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=r[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=r[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ai,f;if(!(f===void 0?Id(l,c,q2|X2,n,u):f))return!1}}return!0}function $b(e){return e===e&&!vn(e)}function Z2(e){for(var t=xn(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,$b(i)]}return t}function Fb(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function Q2(e){var t=Z2(e);return t.length==1&&t[0][2]?Fb(t[0][0],t[0][1]):function(r){return r===e||J2(r,e,t)}}function t3(e,t){return e!=null&&t in Object(e)}function Bb(e,t,r){t=Pl(t,e);for(var n=-1,i=t.length,s=!1;++n<i;){var o=Fa(t[n]);if(!(s=e!=null&&r(e,o)))break;e=e[o]}return s||++n!=i?s:(i=e==null?0:e.length,!!i&&hd(i)&&Il(o,i)&&(oe(e)||Cl(e)))}function e3(e,t){return e!=null&&Bb(e,t,t3)}var r3=1,n3=2;function i3(e,t){return pd(e)&&$b(t)?Fb(Fa(e),t):function(r){var n=EM(r,e);return n===void 0&&n===t?e3(r,e):Id(t,n,r3|n3)}}function s3(e){return function(t){return t==null?void 0:t[e]}}function o3(e){return function(t){return gd(t,e)}}function a3(e){return pd(e)?s3(Fa(e)):o3(e)}function ci(e){return typeof e=="function"?e:e==null?Io:typeof e=="object"?oe(e)?i3(e[0],e[1]):Q2(e):a3(e)}function c3(e,t,r,n){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(n,o,r(o),e)}return n}function l3(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[++i];if(r(s[c],c,s)===!1)break}return t}}var u3=l3();function h3(e,t){return e&&u3(e,t,xn)}function f3(e,t){return function(r,n){if(r==null)return r;if(!oi(r))return e(r,n);for(var i=r.length,s=-1,o=Object(r);++s<i&&n(o[s],s,o)!==!1;);return r}}var Ns=f3(h3);function d3(e,t,r,n){return Ns(e,function(i,s,o){t(n,i,r(i),o)}),n}function p3(e,t){return function(r,n){var i=oe(r)?c3:d3,s=t?t():{};return i(r,e,ci(n),s)}}var Db=Object.prototype,m3=Db.hasOwnProperty,Nd=ud(function(e,t){e=Object(e);var r=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&G_(t[0],t[1],i)&&(n=1);++r<n;)for(var s=t[r],o=tb(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||Ca(u,Db[l])&&!m3.call(e,l))&&(e[l]=s[l])}return e});function jb(e){return Bn(e)&&oi(e)}var g3=200;function y3(e,t,r,n){var i=-1,s=j_,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=g3&&(s=Sd,o=!1,t=new Co(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,n)||c.push(u)}return c}var Dl=ud(function(e,t){return jb(e)?y3(e,_d(t,1,jb,!0)):[]});function Lo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function vr(e,t,r){var n=e==null?0:e.length;return n?(t=t===void 0?1:Rl(t),bd(e,t<0?0:t,n)):[]}function Da(e,t,r){var n=e==null?0:e.length;return n?(t=t===void 0?1:Rl(t),t=n-t,bd(e,0,t<0?0:t)):[]}function _3(e){return typeof e=="function"?e:Io}function Pt(e,t){var r=oe(e)?B_:Ns;return r(e,_3(t))}function b3(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function w3(e,t){var r=!0;return Ns(e,function(n,i,s){return r=!!t(n,i,s),r}),r}function Dn(e,t,r){var n=oe(e)?b3:w3;return n(e,ci(t))}function zb(e,t){var r=[];return Ns(e,function(n,i,s){t(n,i,s)&&r.push(n)}),r}function Tn(e,t){var r=oe(e)?kd:zb;return r(e,ci(t))}function E3(e){return function(t,r,n){var i=Object(t);if(!oi(t)){var s=ci(r);t=xn(t),r=function(a){return s(i[a],a,i)}}var o=e(t,r,n);return o>-1?i[s?t[o]:o]:void 0}}var k3=Math.max;function v3(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=r==null?0:Rl(r);return i<0&&(i=k3(n+i,0)),D_(e,ci(t),i)}var Mo=E3(v3);function jn(e){return e&&e.length?e[0]:void 0}function x3(e,t){var r=-1,n=oi(e)?Array(e.length):[];return Ns(e,function(i,s,o){n[++r]=t(i,s,o)}),n}function St(e,t){var r=oe(e)?Sl:x3;return r(e,ci(t))}function Sn(e,t){return _d(St(e,t))}var A3=Object.prototype,T3=A3.hasOwnProperty,Gb=p3(function(e,t,r){T3.call(e,r)?e[r].push(t):cd(e,r,[t])}),S3=Object.prototype,R3=S3.hasOwnProperty;function O3(e,t){return e!=null&&R3.call(e,t)}function Ut(e,t){return e!=null&&Bb(e,t,O3)}var I3="[object String]";function Vr(e){return typeof e=="string"||!oe(e)&&Bn(e)&&Qi(e)==I3}function N3(e,t){return Sl(t,function(r){return e[r]})}function Ze(e){return e==null?[]:N3(e,xn(e))}var C3=Math.max;function Lr(e,t,r,n){e=oi(e)?e:Ze(e),r=r&&!n?Rl(r):0;var i=e.length;return r<0&&(r=C3(i+r,0)),Vr(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&ad(e,t,r)>-1}function Wb(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=0;return ad(e,t,i)}var L3="[object Map]",M3="[object Set]",U3=Object.prototype,P3=U3.hasOwnProperty;function Ee(e){if(e==null)return!0;if(oi(e)&&(oe(e)||typeof e=="string"||typeof e.splice=="function"||Ma(e)||dd(e)||Cl(e)))return!e.length;var t=An(e);if(t==L3||t==M3)return!e.size;if(La(e))return!Q_(e).length;for(var r in e)if(P3.call(e,r))return!1;return!0}var $3="[object RegExp]";function F3(e){return Bn(e)&&Qi(e)==$3}var Hb=ts&&ts.isRegExp,Ni=Hb?Ll(Hb):F3;function Ci(e){return e===void 0}var B3="Expected a function";function D3(e){if(typeof e!="function")throw new TypeError(B3);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function j3(e,t,r,n){if(!vn(e))return e;t=Pl(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Fa(t[i]),l=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=vn(u)?u:Il(t[i+1])?[]:{})}Nl(a,c,l),a=a[c]}return e}function z3(e,t,r){for(var n=-1,i=t.length,s={};++n<i;){var o=t[n],a=gd(e,o);r(a,o)&&j3(s,Pl(o,e),a)}return s}function zn(e,t){if(e==null)return{};var r=Sl(lU(e),function(n){return[n]});return t=ci(t),z3(e,r,function(n,i){return t(n,i[0])})}function G3(e,t,r,n,i){return i(e,function(s,o,a){r=n?(n=!1,s):t(r,s,o,a)}),r}function qr(e,t,r){var n=oe(e)?VM:G3,i=arguments.length<3;return n(e,ci(t),r,i,Ns)}function jl(e,t){var r=oe(e)?kd:zb;return r(e,D3(ci(t)))}function W3(e,t){var r;return Ns(e,function(n,i,s){return r=t(n,i,s),!r}),!!r}function Cd(e,t,r){var n=oe(e)?Nb:W3;return n(e,ci(t))}var H3=1/0,K3=No&&1/Rd(new No([,-0]))[1]==H3?function(e){return new No(e)}:nr,Y3=200;function V3(e,t,r){var n=-1,i=j_,s=e.length,o=!0,a=[],c=a;if(s>=Y3){var l=K3(e);if(l)return Rd(l);o=!1,i=Sd,c=new Co}else c=a;t:for(;++n<s;){var u=e[n],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,r)||(c!==a&&c.push(f),a.push(u))}return a}function zl(e){return e&&e.length?V3(e):[]}function Ld(e){console&&console.error&&console.error(`Error: ${e}`)}function Kb(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Yb(e){const t=new Date().getTime(),r=e();return{time:new Date().getTime()-t,value:r}}function Vb(e){function t(){}t.prototype=e;const r=new t;function n(){return typeof r.bar}return n(),n(),e}function q3(e){return X3(e)?e.LABEL:e.name}function X3(e){return Vr(e.LABEL)&&e.LABEL!==""}class li{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Pt(this.definition,r=>{r.accept(t)})}}class Xr extends li{constructor(t){super([]),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class Uo extends li{constructor(t){super(t.definition),this.orgText="",Yr(this,zn(t,r=>r!==void 0))}}class Jr extends li{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Yr(this,zn(t,r=>r!==void 0))}}class Zr extends li{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class ui extends li{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class hi extends li{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class ir extends li{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class Gn extends li{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class Wn extends li{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Yr(this,zn(t,r=>r!==void 0))}}class Fe{constructor(t){this.idx=1,Yr(this,zn(t,r=>r!==void 0))}accept(t){t.visit(this)}}function J3(e){return St(e,Gl)}function Gl(e){function t(r){return St(r,Gl)}if(e instanceof Xr){const r={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Vr(e.label)&&(r.label=e.label),r}else{if(e instanceof Jr)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Zr)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof ui)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof hi)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Gl(new Fe({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Gn)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Gl(new Fe({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof ir)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Wn)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Fe){const r={type:"Terminal",name:e.terminalType.name,label:q3(e.terminalType),idx:e.idx};Vr(e.label)&&(r.terminalLabel=e.label);const n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=Ni(n)?n.source:n),r}else{if(e instanceof Uo)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class Cs{visit(t){const r=t;switch(r.constructor){case Xr:return this.visitNonTerminal(r);case Jr:return this.visitAlternative(r);case Zr:return this.visitOption(r);case ui:return this.visitRepetitionMandatory(r);case hi:return this.visitRepetitionMandatoryWithSeparator(r);case Gn:return this.visitRepetitionWithSeparator(r);case ir:return this.visitRepetition(r);case Wn:return this.visitAlternation(r);case Fe:return this.visitTerminal(r);case Uo:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function Z3(e){return e instanceof Jr||e instanceof Zr||e instanceof ir||e instanceof ui||e instanceof hi||e instanceof Gn||e instanceof Fe||e instanceof Uo}function Wl(e,t=[]){return e instanceof Zr||e instanceof ir||e instanceof Gn?!0:e instanceof Wn?Cd(e.definition,n=>Wl(n,t)):e instanceof Xr&&Lr(t,e)?!1:e instanceof li?(e instanceof Xr&&t.push(e),Dn(e.definition,n=>Wl(n,t))):!1}function Q3(e){return e instanceof Wn}function fi(e){if(e instanceof Xr)return"SUBRULE";if(e instanceof Zr)return"OPTION";if(e instanceof Wn)return"OR";if(e instanceof ui)return"AT_LEAST_ONE";if(e instanceof hi)return"AT_LEAST_ONE_SEP";if(e instanceof Gn)return"MANY_SEP";if(e instanceof ir)return"MANY";if(e instanceof Fe)return"CONSUME";throw Error("non exhaustive match")}class Hl{walk(t,r=[]){Pt(t.definition,(n,i)=>{const s=vr(t.definition,i+1);if(n instanceof Xr)this.walkProdRef(n,s,r);else if(n instanceof Fe)this.walkTerminal(n,s,r);else if(n instanceof Jr)this.walkFlat(n,s,r);else if(n instanceof Zr)this.walkOption(n,s,r);else if(n instanceof ui)this.walkAtLeastOne(n,s,r);else if(n instanceof hi)this.walkAtLeastOneSep(n,s,r);else if(n instanceof Gn)this.walkManySep(n,s,r);else if(n instanceof ir)this.walkMany(n,s,r);else if(n instanceof Wn)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(t,r,n){}walkProdRef(t,r,n){}walkFlat(t,r,n){const i=r.concat(n);this.walk(t,i)}walkOption(t,r,n){const i=r.concat(n);this.walk(t,i)}walkAtLeastOne(t,r,n){const i=[new Zr({definition:t.definition})].concat(r,n);this.walk(t,i)}walkAtLeastOneSep(t,r,n){const i=qb(t,r,n);this.walk(t,i)}walkMany(t,r,n){const i=[new Zr({definition:t.definition})].concat(r,n);this.walk(t,i)}walkManySep(t,r,n){const i=qb(t,r,n);this.walk(t,i)}walkOr(t,r,n){const i=r.concat(n);Pt(t.definition,s=>{const o=new Jr({definition:[s]});this.walk(o,i)})}}function qb(e,t,r){return[new Zr({definition:[new Fe({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}function ja(e){if(e instanceof Xr)return ja(e.referencedRule);if(e instanceof Fe)return r8(e);if(Z3(e))return t8(e);if(Q3(e))return e8(e);throw Error("non exhaustive match")}function t8(e){let t=[];const r=e.definition;let n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=Wl(s),t=t.concat(ja(s)),n=n+1,i=r.length>n;return zl(t)}function e8(e){const t=St(e.definition,r=>ja(r));return zl(hn(t))}function r8(e){return[e.terminalType]}const Xb="_~IN~_";class n8 extends Hl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,r,n){}walkProdRef(t,r,n){const i=s8(t.referencedRule,t.idx)+this.topProd.name,s=r.concat(n),o=new Jr({definition:s}),a=ja(o);this.follows[i]=a}}function i8(e){const t={};return Pt(e,r=>{const n=new n8(r).startWalking();Yr(t,n)}),t}function s8(e,t){return e.name+t+Xb}function $t(e){return e.charCodeAt(0)}function Md(e,t){Array.isArray(e)?e.forEach(function(r){t.push(r)}):t.push(e)}function za(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function Po(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function o8(){throw Error("Internal Error - Should never get here!")}function Jb(e){return e.type==="Character"}const Kl=[];for(let e=$t("0");e<=$t("9");e++)Kl.push(e);const Yl=[$t("_")].concat(Kl);for(let e=$t("a");e<=$t("z");e++)Yl.push(e);for(let e=$t("A");e<=$t("Z");e++)Yl.push(e);const Zb=[$t(" "),$t("\f"),$t(`
`),$t("\r"),$t("	"),$t("\v"),$t("	"),$t("Â "),$t("á"),$t("â"),$t("â"),$t("â"),$t("â"),$t("â"),$t("â"),$t("â"),$t("â"),$t("â"),$t("â"),$t("â"),$t("\u2028"),$t("\u2029"),$t("â¯"),$t("â"),$t("ã"),$t("\uFEFF")],a8=/[0-9a-fA-F]/,Vl=/[0-9]/,c8=/[1-9]/;class l8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const r=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":za(n,"global");break;case"i":za(n,"ignoreCase");break;case"m":za(n,"multiLine");break;case"u":za(n,"unicode");break;case"y":za(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){const t=[],r=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(r)}}alternative(){const t=[],r=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}Po(r);const n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(t)}}return o8()}quantifier(t=!1){let r;const n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&r===void 0)return;Po(r);break}if(!(t===!0&&r===void 0)&&Po(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let t;const r=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),Po(t))return t.loc=this.loc(r),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[$t(`
`),$t("\r"),$t("\u2028"),$t("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,r=!1;switch(this.popChar()){case"d":t=Kl;break;case"D":t=Kl,r=!0;break;case"s":t=Zb;break;case"S":t=Zb,r=!0;break;case"w":t=Yl;break;case"W":t=Yl,r=!0;break}if(Po(t))return{type:"Set",value:t,complement:r}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=$t("\f");break;case"n":t=$t(`
`);break;case"r":t=$t("\r");break;case"t":t=$t("	");break;case"v":t=$t("\v");break}if(Po(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:$t("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:$t(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:$t(t)}}}characterClass(){const t=[];let r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){const n=this.classAtom();if(n.type,Jb(n)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,Jb(i)){if(i.value<n.value)throw Error("Range out of order in character class");t.push({from:n.value,to:i.value})}else Md(n.value,t),t.push($t("-")),Md(i.value,t)}else Md(n.value,t)}return this.consumeChar("]"),{type:"Set",complement:r,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:$t("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const r=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:t,value:r};return t&&(n.idx=this.groupIdx),n}positiveInteger(){let t=this.popChar();if(c8.test(t)===!1)throw Error("Expecting a positive integer");for(;Vl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Vl.test(t)===!1)throw Error("Expecting an integer");for(;Vl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:$t(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Vl.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let r="";for(let i=0;i<t;i++){const s=this.popChar();if(a8.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Ud{visitChildren(t){for(const r in t){const n=t[r];t.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let ql={};const u8=new l8;function Xl(e){const t=e.toString();if(ql.hasOwnProperty(t))return ql[t];{const r=u8.pattern(t);return ql[t]=r,r}}function h8(){ql={}}const Qb="Complement Sets are not supported for first char optimization",Jl=`Unable to use "first char" lexer optimizations:
`;function f8(e,t=!1){try{const r=Xl(e);return Pd(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===Qb)t&&Kb(`${Jl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";t&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Ld(`${Jl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function Pd(e,t,r){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Pd(e.value[i],t,r);break;case"Alternative":const n=e.value;for(let i=0;i<n.length;i++){const s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Zl(o.value,t,r);break;case"Set":if(o.complement===!0)throw Error(Qb);Pt(o.value,c=>{if(typeof c=="number")Zl(c,t,r);else{const l=c;if(r===!0)for(let u=l.from;u<=l.to;u++)Zl(u,t,r);else{for(let u=l.from;u<=l.to&&u<Wa;u++)Zl(u,t,r);if(l.to>=Wa){const u=l.from>=Wa?l.from:Wa,f=l.to,d=es(u),h=es(f);for(let m=d;m<=h;m++)t[m]=m}}}});break;case"Group":Pd(o.value,t,r);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&$d(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ze(t)}function Zl(e,t,r){const n=es(e);t[n]=n,r===!0&&d8(e,t)}function d8(e,t){const r=String.fromCharCode(e),n=r.toUpperCase();if(n!==r){const i=es(n.charCodeAt(0));t[i]=i}else{const i=r.toLowerCase();if(i!==r){const s=es(i.charCodeAt(0));t[s]=s}}}function t1(e,t){return Mo(e.value,r=>{if(typeof r=="number")return Lr(t,r);{const n=r;return Mo(t,i=>n.from<=i&&i<=n.to)!==void 0}})}function $d(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?oe(e.value)?Dn(e.value,$d):$d(e.value):!1}class p8 extends Ud{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Lr(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?t1(t,this.targetCharCodes)===void 0&&(this.found=!0):t1(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Fd(e,t){if(t instanceof RegExp){const r=Xl(t),n=new p8(e);return n.visit(r),n.found}else return Mo(t,r=>Lr(e,r.charCodeAt(0)))!==void 0}const Ls="PATTERN",Ga="defaultMode",Ql="modes";let e1=typeof new RegExp("(?:)").sticky=="boolean";function m8(e,t){t=Nd(t,{useSticky:e1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,A)=>A()});const r=t.tracer;r("initCharCodeToOptimizedIndexMap",()=>{F8()});let n;r("Reject Lexer.NA",()=>{n=jl(e,v=>v[Ls]===gr.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=St(n,v=>{const A=v[Ls];if(Ni(A)){const T=A.source;return T.length===1&&T!=="^"&&T!=="$"&&T!=="."&&!A.ignoreCase?T:T.length===2&&T[0]==="\\"&&!Lr(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],T[1])?T[1]:t.useSticky?n1(A):r1(A)}else{if(Ri(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const T=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),I=new RegExp(T);return t.useSticky?n1(I):r1(I)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;r("misc mapping",()=>{o=St(n,v=>v.tokenTypeIdx),a=St(n,v=>{const A=v.GROUP;if(A!==gr.SKIPPED){if(Vr(A))return A;if(Ci(A))return!1;throw Error("non exhaustive match")}}),c=St(n,v=>{const A=v.LONGER_ALT;if(A)return oe(A)?St(A,I=>Wb(n,I)):[Wb(n,A)]}),l=St(n,v=>v.PUSH_MODE),u=St(n,v=>Ut(v,"POP_MODE"))});let f;r("Line Terminator Handling",()=>{const v=o1(t.lineTerminatorCharacters);f=St(n,A=>!1),t.positionTracking!=="onlyOffset"&&(f=St(n,A=>Ut(A,"LINE_BREAKS")?!!A.LINE_BREAKS:s1(A,v)===!1&&Fd(v,A.PATTERN)))});let d,h,m,p;r("Misc Mapping #2",()=>{d=St(n,i1),h=St(s,U8),m=qr(n,(v,A)=>{const T=A.GROUP;return Vr(T)&&T!==gr.SKIPPED&&(v[T]=[]),v},{}),p=St(s,(v,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:f[A],isCustom:d[A],short:h[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:n[A]}))});let _=!0,w=[];return t.safeMode||r("First Char Optimization",()=>{w=qr(n,(v,A,T)=>{if(typeof A.PATTERN=="string"){const I=A.PATTERN.charCodeAt(0),S=es(I);Bd(v,S,p[T])}else if(oe(A.START_CHARS_HINT)){let I;Pt(A.START_CHARS_HINT,S=>{const C=typeof S=="string"?S.charCodeAt(0):S,P=es(C);I!==P&&(I=P,Bd(v,P,p[T]))})}else if(Ni(A.PATTERN))if(A.PATTERN.unicode)_=!1,t.ensureOptimizations&&Ld(`${Jl}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const I=f8(A.PATTERN,t.ensureOptimizations);Ee(I)&&(_=!1),Pt(I,S=>{Bd(v,S,p[T])})}else t.ensureOptimizations&&Ld(`${Jl}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),_=!1;return v},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:_}}function g8(e,t){let r=[];const n=_8(e);r=r.concat(n.errors);const i=b8(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(y8(s)),r=r.concat(S8(s)),r=r.concat(R8(s,t)),r=r.concat(O8(s)),r}function y8(e){let t=[];const r=Tn(e,n=>Ni(n[Ls]));return t=t.concat(E8(r)),t=t.concat(x8(r)),t=t.concat(A8(r)),t=t.concat(T8(r)),t=t.concat(k8(r)),t}function _8(e){const t=Tn(e,i=>!Ut(i,Ls)),r=St(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:je.MISSING_PATTERN,tokenTypes:[i]})),n=Dl(e,t);return{errors:r,valid:n}}function b8(e){const t=Tn(e,i=>{const s=i[Ls];return!Ni(s)&&!Ri(s)&&!Ut(s,"exec")&&!Vr(s)}),r=St(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:je.INVALID_PATTERN,tokenTypes:[i]})),n=Dl(e,t);return{errors:r,valid:n}}const w8=/[^\\][$]/;function E8(e){class t extends Ud{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const r=Tn(e,i=>{const s=i.PATTERN;try{const o=Xl(s),a=new t;return a.visit(o),a.found}catch{return w8.test(s.source)}});return St(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:je.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function k8(e){const t=Tn(e,n=>n.PATTERN.test(""));return St(t,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:je.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}const v8=/[^\\[][\^]|^\^/;function x8(e){class t extends Ud{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const r=Tn(e,i=>{const s=i.PATTERN;try{const o=Xl(s),a=new t;return a.visit(o),a.found}catch{return v8.test(s.source)}});return St(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:je.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function A8(e){const t=Tn(e,n=>{const i=n[Ls];return i instanceof RegExp&&(i.multiline||i.global)});return St(t,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:je.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function T8(e){const t=[];let r=St(e,s=>qr(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Lr(t,a)&&a.PATTERN!==gr.NA&&(t.push(a),o.push(a)),o),[]));r=Ba(r);const n=Tn(r,s=>s.length>1);return St(n,s=>{const o=St(s,c=>c.name);return{message:`The same RegExp pattern ->${jn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:je.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function S8(e){const t=Tn(e,n=>{if(!Ut(n,"GROUP"))return!1;const i=n.GROUP;return i!==gr.SKIPPED&&i!==gr.NA&&!Vr(i)});return St(t,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:je.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function R8(e,t){const r=Tn(e,i=>i.PUSH_MODE!==void 0&&!Lr(t,i.PUSH_MODE));return St(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:je.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function O8(e){const t=[],r=qr(e,(n,i,s)=>{const o=i.PATTERN;return o===gr.NA||(Vr(o)?n.push({str:o,idx:s,tokenType:i}):Ni(o)&&N8(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return Pt(e,(n,i)=>{Pt(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&I8(s,n.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:je.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),t}function I8(e,t){if(Ni(t)){const r=t.exec(e);return r!==null&&r.index===0}else{if(Ri(t))return t(e,0,[],{});if(Ut(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function N8(e){return Mo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>e.source.indexOf(r)!==-1)===void 0}function r1(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function n1(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function C8(e,t,r){const n=[];return Ut(e,Ga)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ga+`> property in its definition
`,type:je.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ut(e,Ql)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ql+`> property in its definition
`,type:je.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ut(e,Ql)&&Ut(e,Ga)&&!Ut(e.modes,e.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${Ga}: <${e.defaultMode}>which does not exist
`,type:je.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ut(e,Ql)&&Pt(e.modes,(i,s)=>{Pt(i,(o,a)=>{if(Ci(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:je.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ut(o,"LONGER_ALT")){const c=oe(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Pt(c,l=>{!Ci(l)&&!Lr(i,l)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:je.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function L8(e,t,r){const n=[];let i=!1;const s=Ba(hn(Ze(e.modes))),o=jl(s,c=>c[Ls]===gr.NA),a=o1(r);return t&&Pt(o,c=>{const l=s1(c,a);if(l!==!1){const f={message:$8(c,l),type:l.issue,tokenType:c};n.push(f)}else Ut(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Fd(a,c.PATTERN)&&(i=!0)}),t&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:je.NO_LINE_BREAKS_FLAGS}),n}function M8(e){const t={},r=xn(e);return Pt(r,n=>{const i=e[n];if(oe(i))t[n]=[];else throw Error("non exhaustive match")}),t}function i1(e){const t=e.PATTERN;if(Ni(t))return!1;if(Ri(t))return!0;if(Ut(t,"exec"))return!0;if(Vr(t))return!1;throw Error("non exhaustive match")}function U8(e){return Vr(e)&&e.length===1?e.charCodeAt(0):!1}const P8={test:function(e){const t=e.length;for(let r=this.lastIndex;r<t;r++){const n=e.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return e.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function s1(e,t){if(Ut(e,"LINE_BREAKS"))return!1;if(Ni(e.PATTERN)){try{Fd(t,e.PATTERN)}catch(r){return{issue:je.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(Vr(e.PATTERN))return!1;if(i1(e))return{issue:je.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function $8(e,t){if(t.issue===je.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===je.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function o1(e){return St(e,r=>Vr(r)?r.charCodeAt(0):r)}function Bd(e,t,r){e[t]===void 0?e[t]=[r]:e[t].push(r)}const Wa=256;let tu=[];function es(e){return e<Wa?e:tu[e]}function F8(){if(Ee(tu)){tu=new Array(65536);for(let e=0;e<65536;e++)tu[e]=e>255?255+~~(e/255):e}}function Ha(e,t){const r=e.tokenTypeIdx;return r===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[r]===!0}function eu(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let a1=1;const c1={};function Ka(e){const t=B8(e);D8(t),z8(t),j8(t),Pt(t,r=>{r.isParent=r.categoryMatches.length>0})}function B8(e){let t=kr(e),r=e,n=!0;for(;n;){r=Ba(hn(St(r,s=>s.CATEGORIES)));const i=Dl(r,t);t=t.concat(i),Ee(i)?n=!1:r=i}return t}function D8(e){Pt(e,t=>{u1(t)||(c1[a1]=t,t.tokenTypeIdx=a1++),h1(t)&&!oe(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),h1(t)||(t.CATEGORIES=[]),G8(t)||(t.categoryMatches=[]),W8(t)||(t.categoryMatchesMap={})})}function j8(e){Pt(e,t=>{t.categoryMatches=[],Pt(t.categoryMatchesMap,(r,n)=>{t.categoryMatches.push(c1[n].tokenTypeIdx)})})}function z8(e){Pt(e,t=>{l1([],t)})}function l1(e,t){Pt(e,r=>{t.categoryMatchesMap[r.tokenTypeIdx]=!0}),Pt(t.CATEGORIES,r=>{const n=e.concat(t);Lr(n,r)||l1(n,r)})}function u1(e){return Ut(e,"tokenTypeIdx")}function h1(e){return Ut(e,"CATEGORIES")}function G8(e){return Ut(e,"categoryMatches")}function W8(e){return Ut(e,"categoryMatchesMap")}function H8(e){return Ut(e,"tokenTypeIdx")}const K8={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,r,n,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${r} characters.`}};var je;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(je||(je={}));const Ya={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:K8,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Ya);let gr=class{constructor(t,r=Ya){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Yb(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Yr({},Ya,r);const n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Ya.lineTerminatorsPattern)this.config.lineTerminatorsPattern=P8;else if(this.config.lineTerminatorCharacters===Ya.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),oe(t)?i={modes:{defaultMode:kr(t)},defaultMode:Ga}:(s=!1,i=kr(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(C8(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(L8(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Pt(i.modes,(a,c)=>{i.modes[c]=jl(a,l=>Ci(l))});const o=xn(i.modes);if(Pt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(g8(a,o))}),Ee(this.lexerDefinitionErrors)){Ka(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=m8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Yr({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Ee(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=St(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Pt(this.lexerDefinitionWarning,a=>{Kb(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(e1?(this.chopInput=Io,this.match=this.matchWithTest):(this.updateLastIndex=nr,this.match=this.matchWithExec),s&&(this.handleModes=nr),this.trackStartLines===!1&&(this.computeNewColumn=Io),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=nr),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=qr(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(r.ensureOptimizations&&!Ee(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{h8()}),this.TRACE_INIT("toFastProperties",()=>{Vb(this)})})}tokenize(t,r=this.defaultMode){if(!Ee(this.lexerDefinitionErrors)){const i=St(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,r)}tokenizeInternal(t,r){let n,i,s,o,a,c,l,u,f,d,h,m,p,_,w;const v=t,A=v.length;let T=0,I=0;const S=this.hasCustom?0:Math.floor(t.length/10),C=new Array(S),P=[];let N=this.trackStartLines?1:void 0,z=this.trackStartLines?1:void 0;const J=M8(this.emptyGroups),M=this.trackStartLines,O=this.config.lineTerminatorsPattern;let k=0,L=[],B=[];const $=[],ot=[];Object.freeze(ot);let et;function st(){return L}function G(Ft){const Wt=es(Ft),jt=B[Wt];return jt===void 0?ot:jt}const D=Ft=>{if($.length===1&&Ft.tokenType.PUSH_MODE===void 0){const Wt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ft);P.push({offset:Ft.startOffset,line:Ft.startLine,column:Ft.startColumn,length:Ft.image.length,message:Wt})}else{$.pop();const Wt=Lo($);L=this.patternIdxToConfig[Wt],B=this.charCodeToPatternIdxToConfig[Wt],k=L.length;const jt=this.canModeBeOptimized[Wt]&&this.config.safeMode===!1;B&&jt?et=G:et=st}};function _t(Ft){$.push(Ft),B=this.charCodeToPatternIdxToConfig[Ft],L=this.patternIdxToConfig[Ft],k=L.length,k=L.length;const Wt=this.canModeBeOptimized[Ft]&&this.config.safeMode===!1;B&&Wt?et=G:et=st}_t.call(this,r);let q;const at=this.config.recoveryEnabled;for(;T<A;){c=null;const Ft=v.charCodeAt(T),Wt=et(Ft),jt=Wt.length;for(n=0;n<jt;n++){q=Wt[n];const Bt=q.pattern;l=null;const he=q.short;if(he!==!1?Ft===he&&(c=Bt):q.isCustom===!0?(w=Bt.exec(v,T,C,J),w!==null?(c=w[0],w.payload!==void 0&&(l=w.payload)):c=null):(this.updateLastIndex(Bt,T),c=this.match(Bt,t,T)),c!==null){if(a=q.longerAlt,a!==void 0){const Zt=a.length;for(s=0;s<Zt;s++){const Me=L[a[s]],Ge=Me.pattern;if(u=null,Me.isCustom===!0?(w=Ge.exec(v,T,C,J),w!==null?(o=w[0],w.payload!==void 0&&(u=w.payload)):o=null):(this.updateLastIndex(Ge,T),o=this.match(Ge,t,T)),o&&o.length>c.length){c=o,l=u,q=Me;break}}}break}}if(c!==null){if(f=c.length,d=q.group,d!==void 0&&(h=q.tokenTypeIdx,m=this.createTokenInstance(c,T,h,q.tokenType,N,z,f),this.handlePayload(m,l),d===!1?I=this.addToken(C,I,m):J[d].push(m)),t=this.chopInput(t,f),T=T+f,z=this.computeNewColumn(z,f),M===!0&&q.canLineTerminator===!0){let Bt=0,he,Zt;O.lastIndex=0;do he=O.test(c),he===!0&&(Zt=O.lastIndex-1,Bt++);while(he===!0);Bt!==0&&(N=N+Bt,z=f-Zt,this.updateTokenEndLineColumnLocation(m,d,Zt,Bt,N,z,f))}this.handleModes(q,D,_t,m)}else{const Bt=T,he=N,Zt=z;let Me=at===!1;for(;Me===!1&&T<A;)for(t=this.chopInput(t,1),T++,i=0;i<k;i++){const Ge=L[i],x=Ge.pattern,lt=Ge.short;if(lt!==!1?v.charCodeAt(T)===lt&&(Me=!0):Ge.isCustom===!0?Me=x.exec(v,T,C,J)!==null:(this.updateLastIndex(x,T),Me=x.exec(t)!==null),Me===!0)break}if(p=T-Bt,z=this.computeNewColumn(z,p),_=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Bt,p,he,Zt),P.push({offset:Bt,line:he,column:Zt,length:p,message:_}),at===!1)break}}return this.hasCustom||(C.length=I),{tokens:C,groups:J,errors:P}}handleModes(t,r,n,i){if(t.pop===!0){const s=t.push;r(i),s!==void 0&&n.call(this,s)}else t.push!==void 0&&n.call(this,t.push)}chopInput(t,r){return t.substring(r)}updateLastIndex(t,r){t.lastIndex=r}updateTokenEndLineColumnLocation(t,r,n,i,s,o,a){let c,l;r!==void 0&&(c=n===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,r){return t+r}createOffsetOnlyToken(t,r,n,i){return{image:t,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(t,r,n,i,s,o){return{image:t,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(t,r,n,i,s,o,a){return{image:t,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(t,r,n){return t.push(n),r}addTokenUsingMemberAccess(t,r,n){return t[r]=n,r++,r}handlePayloadNoCustom(t,r){}handlePayloadWithCustom(t,r){r!==null&&(t.payload=r)}matchWithTest(t,r,n){return t.test(r)===!0?r.substring(n,t.lastIndex):null}matchWithExec(t,r){const n=t.exec(r);return n!==null?n[0]:null}};gr.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",gr.NA=/NOT_APPLICABLE/;function Va(e){return f1(e)?e.LABEL:e.name}function f1(e){return Vr(e.LABEL)&&e.LABEL!==""}const Y8="parent",d1="categories",p1="label",m1="group",g1="push_mode",y1="pop_mode",_1="longer_alt",b1="line_breaks",w1="start_chars_hint";function fn(e){return V8(e)}function V8(e){const t=e.pattern,r={};if(r.name=e.name,Ci(t)||(r.PATTERN=t),Ut(e,Y8))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ut(e,d1)&&(r.CATEGORIES=e[d1]),Ka([r]),Ut(e,p1)&&(r.LABEL=e[p1]),Ut(e,m1)&&(r.GROUP=e[m1]),Ut(e,y1)&&(r.POP_MODE=e[y1]),Ut(e,g1)&&(r.PUSH_MODE=e[g1]),Ut(e,_1)&&(r.LONGER_ALT=e[_1]),Ut(e,b1)&&(r.LINE_BREAKS=e[b1]),Ut(e,w1)&&(r.START_CHARS_HINT=e[w1]),r}const Ms=fn({name:"EOF",pattern:gr.NA});Ka([Ms]);function ru(e,t,r,n,i,s,o,a){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function q8(e,t){return Ha(e,t)}const E1={buildMismatchTokenMessage({expected:e,actual:t,previous:r,ruleName:n}){return`Expecting ${f1(e)?`--> ${Va(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:r,customUserDescription:n,ruleName:i}){const s="Expecting: ",a=`
but found: '`+jn(t).image+"'";if(n)return s+n+a;{const c=qr(e,(d,h)=>d.concat(h),[]),l=St(c,d=>`[${St(d,h=>Va(h)).join(", ")}]`),f=`one of these possible Token sequences:
${St(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:r,ruleName:n}){const i="Expecting: ",o=`
but found: '`+jn(t).image+"'";if(r)return i+r+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${St(e,l=>`[${St(l,u=>Va(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(E1);const X8={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},Us={buildDuplicateFoundError(e,t){function r(u){return u instanceof Fe?u.terminalType.name:u instanceof Xr?u.nonTerminalName:""}const n=e.name,i=jn(t),s=i.idx,o=fi(i),a=r(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=St(e.prefixPath,i=>Va(i)).join(", "),r=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=St(e.prefixPath,i=>Va(i)).join(", "),r=e.alternation.idx===0?"":e.alternation.idx;let n=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(e){let t=fi(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,r=St(e.leftRecursionPath,s=>s.name),n=`${t} --> ${r.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof Uo?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function J8(e,t){const r=new Z8(e,t);return r.resolveRefs(),r.errors}class Z8 extends Cs{constructor(t,r){super(),this.nameToTopRule=t,this.errMsgProvider=r,this.errors=[]}resolveRefs(){Pt(Ze(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{const n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:Mr.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class Q8 extends Hl{constructor(t,r){super(),this.topProd=t,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=kr(this.path.ruleStack).reverse(),this.occurrenceStack=kr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,r=[]){this.found||super.walk(t,r)}walkProdRef(t,r,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=r.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){Ee(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class tP extends Q8{constructor(t,r){super(t,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,r,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=r.concat(n),s=new Jr({definition:i});this.possibleTokTypes=ja(s),this.found=!0}}}class nu extends Hl{constructor(t,r){super(),this.topRule=t,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class eP extends nu{walkMany(t,r,n){if(t.idx===this.occurrence){const i=jn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,r,n)}}class k1 extends nu{walkManySep(t,r,n){if(t.idx===this.occurrence){const i=jn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,r,n)}}class rP extends nu{walkAtLeastOne(t,r,n){if(t.idx===this.occurrence){const i=jn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,r,n)}}class v1 extends nu{walkAtLeastOneSep(t,r,n){if(t.idx===this.occurrence){const i=jn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,r,n)}}function Dd(e,t,r=[]){r=kr(r);let n=[],i=0;function s(a){return a.concat(vr(e,i+1))}function o(a){const c=Dd(s(a),t,r);return n.concat(c)}for(;r.length<t&&i<e.length;){const a=e[i];if(a instanceof Jr)return o(a.definition);if(a instanceof Xr)return o(a.definition);if(a instanceof Zr)n=o(a.definition);else if(a instanceof ui){const c=a.definition.concat([new ir({definition:a.definition})]);return o(c)}else if(a instanceof hi){const c=[new Jr({definition:a.definition}),new ir({definition:[new Fe({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Gn){const c=a.definition.concat([new ir({definition:[new Fe({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof ir){const c=a.definition.concat([new ir({definition:a.definition})]);n=o(c)}else{if(a instanceof Wn)return Pt(a.definition,c=>{Ee(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof Fe)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:vr(e,i)}),n}function x1(e,t,r,n){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-n-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!Ee(f);){const d=f.pop();if(d===o){a&&Lo(f).idx<=l&&f.pop();continue}const h=d.def,m=d.idx,p=d.ruleStack,_=d.occurrenceStack;if(Ee(h))continue;const w=h[0];if(w===i){const v={idx:m,def:vr(h),ruleStack:Da(p),occurrenceStack:Da(_)};f.push(v)}else if(w instanceof Fe)if(m<c-1){const v=m+1,A=t[v];if(r(A,w.terminalType)){const T={idx:v,def:vr(h),ruleStack:p,occurrenceStack:_};f.push(T)}}else if(m===c-1)u.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:p,occurrenceStack:_}),a=!0;else throw Error("non exhaustive match");else if(w instanceof Xr){const v=kr(p);v.push(w.nonTerminalName);const A=kr(_);A.push(w.idx);const T={idx:m,def:w.definition.concat(s,vr(h)),ruleStack:v,occurrenceStack:A};f.push(T)}else if(w instanceof Zr){const v={idx:m,def:vr(h),ruleStack:p,occurrenceStack:_};f.push(v),f.push(o);const A={idx:m,def:w.definition.concat(vr(h)),ruleStack:p,occurrenceStack:_};f.push(A)}else if(w instanceof ui){const v=new ir({definition:w.definition,idx:w.idx}),A=w.definition.concat([v],vr(h)),T={idx:m,def:A,ruleStack:p,occurrenceStack:_};f.push(T)}else if(w instanceof hi){const v=new Fe({terminalType:w.separator}),A=new ir({definition:[v].concat(w.definition),idx:w.idx}),T=w.definition.concat([A],vr(h)),I={idx:m,def:T,ruleStack:p,occurrenceStack:_};f.push(I)}else if(w instanceof Gn){const v={idx:m,def:vr(h),ruleStack:p,occurrenceStack:_};f.push(v),f.push(o);const A=new Fe({terminalType:w.separator}),T=new ir({definition:[A].concat(w.definition),idx:w.idx}),I=w.definition.concat([T],vr(h)),S={idx:m,def:I,ruleStack:p,occurrenceStack:_};f.push(S)}else if(w instanceof ir){const v={idx:m,def:vr(h),ruleStack:p,occurrenceStack:_};f.push(v),f.push(o);const A=new ir({definition:w.definition,idx:w.idx}),T=w.definition.concat([A],vr(h)),I={idx:m,def:T,ruleStack:p,occurrenceStack:_};f.push(I)}else if(w instanceof Wn)for(let v=w.definition.length-1;v>=0;v--){const A=w.definition[v],T={idx:m,def:A.definition.concat(vr(h)),ruleStack:p,occurrenceStack:_};f.push(T),f.push(o)}else if(w instanceof Jr)f.push({idx:m,def:w.definition.concat(vr(h)),ruleStack:p,occurrenceStack:_});else if(w instanceof Uo)f.push(nP(w,m,p,_));else throw Error("non exhaustive match")}return u}function nP(e,t,r,n){const i=kr(r);i.push(e.name);const s=kr(n);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var ze;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(ze||(ze={}));function A1(e){if(e instanceof Zr||e==="Option")return ze.OPTION;if(e instanceof ir||e==="Repetition")return ze.REPETITION;if(e instanceof ui||e==="RepetitionMandatory")return ze.REPETITION_MANDATORY;if(e instanceof hi||e==="RepetitionMandatoryWithSeparator")return ze.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Gn||e==="RepetitionWithSeparator")return ze.REPETITION_WITH_SEPARATOR;if(e instanceof Wn||e==="Alternation")return ze.ALTERNATION;throw Error("non exhaustive match")}function iP(e,t,r,n,i,s){const o=zd(e,t,r),a=O1(o)?eu:Ha;return s(o,n,a,i)}function sP(e,t,r,n,i,s){const o=Gd(e,t,i,r),a=O1(o)?eu:Ha;return s(o[0],a,n)}function oP(e,t,r,n){const i=e.length,s=Dn(e,o=>Dn(o,a=>a.length===1));if(t)return function(o){const a=St(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],m=h.length;for(let p=0;p<m;p++){const _=this.LA(p+1);if(r(_,h[p])===!1)continue t}return c}}};if(s&&!n){const o=St(e,c=>hn(c)),a=qr(o,(c,l,u)=>(Pt(l,f=>{Ut(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Pt(f.categoryMatches,d=>{Ut(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(r(h,u[d])===!1)continue t}return o}}}}function aP(e,t,r){const n=Dn(e,s=>s.length===1),i=e.length;if(n&&!r){const s=hn(e);if(s.length===1&&Ee(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=qr(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Pt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class cP extends Hl{constructor(t,r,n){super(),this.topProd=t,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,r,n,i){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(t,r,n){this.checkIsTarget(t,ze.OPTION,r,n)||super.walkOption(t,r,n)}walkAtLeastOne(t,r,n){this.checkIsTarget(t,ze.REPETITION_MANDATORY,r,n)||super.walkOption(t,r,n)}walkAtLeastOneSep(t,r,n){this.checkIsTarget(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(t,r,n)}walkMany(t,r,n){this.checkIsTarget(t,ze.REPETITION,r,n)||super.walkOption(t,r,n)}walkManySep(t,r,n){this.checkIsTarget(t,ze.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(t,r,n)}}class T1 extends Cs{constructor(t,r,n){super(),this.targetOccurrence=t,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,ze.OPTION)}visitRepetition(t){this.checkIsTarget(t,ze.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,ze.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,ze.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,ze.ALTERNATION)}}function S1(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=[];return t}function jd(e){let t=[""];for(let r=0;r<e.length;r++){const n=e[r],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){const c="_"+n.categoryMatches[a];i.push(o+c)}}t=i}return t}function lP(e,t,r){for(let n=0;n<e.length;n++){if(n===r)continue;const i=e[n];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function R1(e,t){const r=St(e,o=>Dd([o],1)),n=S1(r.length),i=St(r,o=>{const a={};return Pt(o,c=>{const l=jd(c.partialPath);Pt(l,u=>{a[u]=!0})}),a});let s=r;for(let o=1;o<=t;o++){const a=s;s=S1(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=jd(f);if(lP(i,h,c)||Ee(d)||f.length===t){const p=n[c];if(Wd(p,f)===!1){p.push(f);for(let _=0;_<h.length;_++){const w=h[_];i[c][w]=!0}}}else{const p=Dd(d,o+1,f);s[c]=s[c].concat(p),Pt(p,_=>{const w=jd(_.partialPath);Pt(w,v=>{i[c][v]=!0})})}}}}return n}function zd(e,t,r,n){const i=new T1(e,ze.ALTERNATION,n);return t.accept(i),R1(i.result,r)}function Gd(e,t,r,n){const i=new T1(e,r);t.accept(i);const s=i.result,a=new cP(t,e,r).startWalking(),c=new Jr({definition:s}),l=new Jr({definition:a});return R1([c,l],n)}function Wd(e,t){t:for(let r=0;r<e.length;r++){const n=e[r];if(n.length===t.length){for(let i=0;i<n.length;i++){const s=t[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function uP(e,t){return e.length<t.length&&Dn(e,(r,n)=>{const i=t[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function O1(e){return Dn(e,t=>Dn(t,r=>Dn(r,n=>Ee(n.categoryMatches))))}function hP(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return St(t,r=>Object.assign({type:Mr.CUSTOM_LOOKAHEAD_VALIDATION},r))}function fP(e,t,r,n){const i=Sn(e,c=>dP(c,r)),s=AP(e,t,r),o=Sn(e,c=>EP(c,r)),a=Sn(e,c=>gP(c,e,n,r));return i.concat(s,o,a)}function dP(e,t){const r=new mP;e.accept(r);const n=r.allProductions,i=Gb(n,pP),s=zn(i,a=>a.length>1);return St(Ze(s),a=>{const c=jn(a),l=t.buildDuplicateFoundError(e,a),u=fi(c),f={message:l,type:Mr.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=I1(c);return d&&(f.parameter=d),f})}function pP(e){return`${fi(e)}_#_${e.idx}_#_${I1(e)}`}function I1(e){return e instanceof Fe?e.terminalType.name:e instanceof Xr?e.nonTerminalName:""}class mP extends Cs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function gP(e,t,r,n){const i=[];if(qr(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:o,type:Mr.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function yP(e,t,r){const n=[];let i;return Lr(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:Mr.INVALID_RULE_OVERRIDE,ruleName:e})),n}function N1(e,t,r,n=[]){const i=[],s=iu(t.definition);if(Ee(s))return[];{const o=e.name;Lr(s,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:Mr.LEFT_RECURSION,ruleName:o});const c=Dl(s,n.concat([e])),l=Sn(c,u=>{const f=kr(n);return f.push(u),N1(e,u,r,f)});return i.concat(l)}}function iu(e){let t=[];if(Ee(e))return t;const r=jn(e);if(r instanceof Xr)t.push(r.referencedRule);else if(r instanceof Jr||r instanceof Zr||r instanceof ui||r instanceof hi||r instanceof Gn||r instanceof ir)t=t.concat(iu(r.definition));else if(r instanceof Wn)t=hn(St(r.definition,s=>iu(s.definition)));else if(!(r instanceof Fe))throw Error("non exhaustive match");const n=Wl(r),i=e.length>1;if(n&&i){const s=vr(e);return t.concat(iu(s))}else return t}class Hd extends Cs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function _P(e,t){const r=new Hd;e.accept(r);const n=r.alternations;return Sn(n,s=>{const o=Da(s.definition);return Sn(o,(a,c)=>{const l=x1([a],[],Ha,1);return Ee(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:Mr.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function bP(e,t,r){const n=new Hd;e.accept(n);let i=n.alternations;return i=jl(i,o=>o.ignoreAmbiguities===!0),Sn(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=zd(a,e,c,o),u=vP(l,o,e,r),f=xP(l,o,e,r);return u.concat(f)})}class wP extends Cs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function EP(e,t){const r=new Hd;e.accept(r);const n=r.alternations;return Sn(n,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:Mr.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function kP(e,t,r){const n=[];return Pt(e,i=>{const s=new wP;i.accept(s);const o=s.allProductions;Pt(o,a=>{const c=A1(a),l=a.maxLookahead||t,u=a.idx,d=Gd(u,i,c,l)[0];if(Ee(hn(d))){const h=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:h,type:Mr.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function vP(e,t,r,n){const i=[],s=qr(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Pt(c,u=>{const f=[l];Pt(e,(d,h)=>{l!==h&&Wd(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!Wd(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return St(s,a=>{const c=St(a.alts,u=>u+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Mr.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:a.alts}})}function xP(e,t,r,n){const i=qr(e,(o,a,c)=>{const l=St(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Ba(Sn(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Tn(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&uP(d.path,l));return St(u,d=>{const h=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:Mr.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:m,alternatives:h}})}))}function AP(e,t,r){const n=[],i=St(t,s=>s.name);return Pt(e,s=>{const o=s.name;if(Lr(i,o)){const a=r.buildNamespaceConflictError(s);n.push({message:a,type:Mr.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function TP(e){const t=Nd(e,{errMsgProvider:X8}),r={};return Pt(e.rules,n=>{r[n.name]=n}),J8(r,t.errMsgProvider)}function SP(e){return e=Nd(e,{errMsgProvider:Us}),fP(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const C1="MismatchedTokenException",L1="NoViableAltException",M1="EarlyExitException",U1="NotAllInputParsedException",P1=[C1,L1,M1,U1];Object.freeze(P1);function su(e){return Lr(P1,e.name)}class ou extends Error{constructor(t,r){super(t),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class $1 extends ou{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=C1}}class RP extends ou{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=L1}}class OP extends ou{constructor(t,r){super(t,r),this.name=U1}}class IP extends ou{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=M1}}const Kd={},F1="InRuleRecoveryException";class NP extends Error{constructor(t){super(t),this.name=F1}}class CP{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ut(t,"recoveryEnabled")?t.recoveryEnabled:Li.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=LP)}getTokenToInsert(t){const r=ru(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,r,n,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new $1(h,l,this.LA(0));m.resyncedTokens=Da(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(n.call(this)){f(),t.apply(this,r);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,r)))}getFollowsForInRuleRecovery(t,r){const n=this.getCurrentGrammarPath(t,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(t,r){if(this.canRecoverWithSingleTokenInsertion(t,r))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new NP("sad sad panda")}canPerformInRuleRecovery(t,r){return this.canRecoverWithSingleTokenInsertion(t,r)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,r){if(!this.canTokenTypeBeInsertedInRecovery(t)||Ee(r))return!1;const n=this.LA(1);return Mo(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Lr(n,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let r=this.LA(1),n=2;for(;;){const i=Mo(t,s=>q8(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Kd;const t=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return St(t,(n,i)=>i===0?Kd:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=St(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return hn(t)}getFollowSetFromFollowKey(t){if(t===Kd)return[Ms];const r=t.ruleName+t.idxInCallingRule+Xb+t.inRule;return this.resyncFollows[r]}addToResyncTokens(t,r){return this.tokenMatcher(t,Ms)||r.push(t),r}reSyncTo(t){const r=[];let n=this.LA(1);for(;this.tokenMatcher(n,t)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return Da(r)}attemptInRepetitionRecovery(t,r,n,i,s,o,a){}getCurrentGrammarPath(t,r){const n=this.getHumanReadableRuleStack(),i=kr(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:t,lastTokOccurrence:r}}getHumanReadableRuleStack(){return St(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function LP(e,t,r,n,i,s,o){const a=this.getKeyForAutomaticLookahead(n,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=Ms,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,r,l)}const MP=4,rs=8,B1=1<<rs,D1=2<<rs,Yd=3<<rs,Vd=4<<rs,qd=5<<rs,au=6<<rs;function Xd(e,t,r){return r|t|e}class UP{constructor(t){var r;this.maxLookahead=(r=t==null?void 0:t.maxLookahead)!==null&&r!==void 0?r:Li.maxLookahead}validate(t){const r=this.validateNoLeftRecursion(t.rules);if(Ee(r)){const n=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(t){return Sn(t,r=>N1(r,r,Us))}validateEmptyOrAlternatives(t){return Sn(t,r=>_P(r,Us))}validateAmbiguousAlternationAlternatives(t,r){return Sn(t,n=>bP(n,r,Us))}validateSomeNonEmptyLookaheadPath(t,r){return kP(t,r,Us)}buildLookaheadForAlternation(t){return iP(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,oP)}buildLookaheadForOptional(t){return sP(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,A1(t.prodType),aP)}}class PP{initLooksAhead(t){this.dynamicTokensEnabled=Ut(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Li.dynamicTokensEnabled,this.maxLookahead=Ut(t,"maxLookahead")?t.maxLookahead:Li.maxLookahead,this.lookaheadStrategy=Ut(t,"lookaheadStrategy")?t.lookaheadStrategy:new UP({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Pt(t,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{const{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=FP(r);Pt(n,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${fi(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:r,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Xd(this.fullRuleNameToShort[r.name],B1,l.idx);this.setLaFuncCache(d,f)})}),Pt(i,l=>{this.computeLookaheadFunc(r,l.idx,Yd,"Repetition",l.maxLookahead,fi(l))}),Pt(s,l=>{this.computeLookaheadFunc(r,l.idx,D1,"Option",l.maxLookahead,fi(l))}),Pt(o,l=>{this.computeLookaheadFunc(r,l.idx,Vd,"RepetitionMandatory",l.maxLookahead,fi(l))}),Pt(a,l=>{this.computeLookaheadFunc(r,l.idx,au,"RepetitionMandatoryWithSeparator",l.maxLookahead,fi(l))}),Pt(c,l=>{this.computeLookaheadFunc(r,l.idx,qd,"RepetitionWithSeparator",l.maxLookahead,fi(l))})})})}computeLookaheadFunc(t,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Xd(this.fullRuleNameToShort[t.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,r){const n=this.getLastExplicitRuleShortName();return Xd(n,t,r)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,r){this.lookAheadFuncsCache.set(t,r)}}class $P extends Cs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const cu=new $P;function FP(e){cu.reset(),e.accept(cu);const t=cu.dslMethods;return cu.reset(),t}function j1(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function z1(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function BP(e,t,r){e.children[r]===void 0?e.children[r]=[t]:e.children[r].push(t)}function DP(e,t,r){e.children[t]===void 0?e.children[t]=[r]:e.children[t].push(r)}const jP="name";function G1(e,t){Object.defineProperty(e,jP,{enumerable:!1,configurable:!0,writable:!1,value:t})}function zP(e,t){const r=xn(e),n=r.length;for(let i=0;i<n;i++){const s=r[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function GP(e,t){const r=function(){};G1(r,e+"BaseSemantics");const n={visit:function(i,s){if(oe(i)&&(i=i[0]),!Ci(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=HP(this,t);if(!Ee(i)){const s=St(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=t,r}function WP(e,t,r){const n=function(){};G1(n,e+"BaseSemanticsWithDefaults");const i=Object.create(r.prototype);return Pt(t,s=>{i[s]=zP}),n.prototype=i,n.prototype.constructor=n,n}var Jd;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Jd||(Jd={}));function HP(e,t){return KP(e,t)}function KP(e,t){const r=Tn(t,i=>Ri(e[i])===!1),n=St(r,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Jd.MISSING_METHOD,methodName:i}));return Ba(n)}class YP{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Ut(t,"nodeLocationTracking")?t.nodeLocationTracking:Li.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=nr,this.cstFinallyStateUpdate=nr,this.cstPostTerminal=nr,this.cstPostNonTerminal=nr,this.cstPostRule=nr;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=z1,this.setNodeLocationFromNode=z1,this.cstPostRule=nr,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=nr,this.setNodeLocationFromNode=nr,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=j1,this.setNodeLocationFromNode=j1,this.cstPostRule=nr,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=nr,this.setNodeLocationFromNode=nr,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=nr,this.setNodeLocationFromNode=nr,this.cstPostRule=nr,this.setInitialNodeLocation=nr;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const r=this.LA(1);t.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const r={name:t,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const r=this.LA(0),n=t.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(t){const r=this.LA(0),n=t.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(t,r){const n=this.CST_STACK[this.CST_STACK.length-1];BP(n,r,t),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(t,r){const n=this.CST_STACK[this.CST_STACK.length-1];DP(n,r,t),this.setNodeLocationFromNode(n.location,t.location)}getBaseCstVisitorConstructor(){if(Ci(this.baseCstVisitorConstructor)){const t=GP(this.className,xn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Ci(this.baseCstVisitorWithDefaultsConstructor)){const t=WP(this.className,xn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class VP{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):hu}LA(t){const r=this.currIdx+t;return r<0||this.tokVectorLength<=r?hu:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class qP{ACTION(t){return t.call(this)}consume(t,r,n){return this.consumeInternal(r,t,n)}subrule(t,r,n){return this.subruleInternal(r,t,n)}option(t,r){return this.optionInternal(r,t)}or(t,r){return this.orInternal(r,t)}many(t,r){return this.manyInternal(t,r)}atLeastOne(t,r){return this.atLeastOneInternal(t,r)}CONSUME(t,r){return this.consumeInternal(t,0,r)}CONSUME1(t,r){return this.consumeInternal(t,1,r)}CONSUME2(t,r){return this.consumeInternal(t,2,r)}CONSUME3(t,r){return this.consumeInternal(t,3,r)}CONSUME4(t,r){return this.consumeInternal(t,4,r)}CONSUME5(t,r){return this.consumeInternal(t,5,r)}CONSUME6(t,r){return this.consumeInternal(t,6,r)}CONSUME7(t,r){return this.consumeInternal(t,7,r)}CONSUME8(t,r){return this.consumeInternal(t,8,r)}CONSUME9(t,r){return this.consumeInternal(t,9,r)}SUBRULE(t,r){return this.subruleInternal(t,0,r)}SUBRULE1(t,r){return this.subruleInternal(t,1,r)}SUBRULE2(t,r){return this.subruleInternal(t,2,r)}SUBRULE3(t,r){return this.subruleInternal(t,3,r)}SUBRULE4(t,r){return this.subruleInternal(t,4,r)}SUBRULE5(t,r){return this.subruleInternal(t,5,r)}SUBRULE6(t,r){return this.subruleInternal(t,6,r)}SUBRULE7(t,r){return this.subruleInternal(t,7,r)}SUBRULE8(t,r){return this.subruleInternal(t,8,r)}SUBRULE9(t,r){return this.subruleInternal(t,9,r)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,r,n=fu){if(Lr(this.definedRulesNames,t)){const o={message:Us.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Mr.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,r,n);return this[t]=i,i}OVERRIDE_RULE(t,r,n=fu){const i=yP(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,r,n);return this[t]=s,s}BACKTRACK(t,r){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return t.apply(this,r),!0}catch(i){if(su(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return J3(Ze(this.gastProductionsCache))}}class XP{initRecognizerEngine(t,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=eu,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ut(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(oe(t)){if(Ee(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(oe(t))this.tokensMap=qr(t,(s,o)=>(s[o.name]=o,s),{});else if(Ut(t,"modes")&&Dn(hn(Ze(t.modes)),H8)){const s=hn(Ze(t.modes)),o=zl(s);this.tokensMap=qr(o,(a,c)=>(a[c.name]=c,a),{})}else if(vn(t))this.tokensMap=kr(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Ms;const n=Ut(t,"modes")?hn(Ze(t.modes)):Ze(t),i=Dn(n,s=>Ee(s.categoryMatches));this.tokenMatcher=i?eu:Ha,Ka(Ze(this.tokensMap))}defineRule(t,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ut(n,"resyncEnabled")?n.resyncEnabled:fu.resyncEnabled,s=Ut(n,"recoveryValueFunc")?n.recoveryValueFunc:fu.recoveryValueFunc,o=this.ruleShortNameIdx<<MP+rs;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),r.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),r.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:r})}invokeRuleCatch(t,r,n){const i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if(su(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(t);throw o}}else throw t}optionInternal(t,r){const n=this.getKeyForAutomaticLookahead(D1,r);return this.optionInternalLogic(t,r,n)}optionInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,r){const n=this.getKeyForAutomaticLookahead(Vd,t);return this.atLeastOneInternalLogic(t,r,n)}atLeastOneInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const o=r.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,ze.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,r],i,Vd,t,rP)}atLeastOneSepFirstInternal(t,r){const n=this.getKeyForAutomaticLookahead(au,t);this.atLeastOneSepFirstInternalLogic(t,r,n)}atLeastOneSepFirstInternalLogic(t,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,v1],a,au,t,v1)}else throw this.raiseEarlyExitException(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(t,r){const n=this.getKeyForAutomaticLookahead(Yd,t);return this.manyInternalLogic(t,r,n)}manyInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const a=r.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,r],i,Yd,t,eP,o)}manySepFirstInternal(t,r){const n=this.getKeyForAutomaticLookahead(qd,t);this.manySepFirstInternalLogic(t,r,n)}manySepFirstInternalLogic(t,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,k1],a,qd,t,k1)}}repetitionSepSecondInternal(t,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,r,n,i,s],n,au,t,s)}doSingleRepetition(t){const r=this.getLexerPosition();return t.call(this),this.getLexerPosition()>r}orInternal(t,r){const n=this.getKeyForAutomaticLookahead(B1,r),i=oe(t)?t:t.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new OP(r,t))}}subruleInternal(t,r,n){let i;try{const s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=t.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,n,t.ruleName)}}subruleInternalError(t,r,n){throw su(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete t.partialCstResult),t}consumeInternal(t,r,n){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,n)}catch(s){i=this.consumeInternalRecovery(t,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:t.name,i),i}consumeInternalError(t,r,n){let i;const s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new $1(i,r,s))}consumeInternalRecovery(t,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,r);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===F1?n:s}}else throw n}saveRecogState(){const t=this.errors,r=kr(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Ms)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class JP{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Ut(t,"errorMessageProvider")?t.errorMessageProvider:Li.errorMessageProvider}SAVE_ERROR(t){if(su(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:kr(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return kr(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,r,n){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Gd(t,s,r,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new IP(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,r){const n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=zd(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new RP(c,this.LA(1),a))}}class ZP{initContentAssist(){}computeContentAssist(t,r){const n=this.gastProductionsCache[t];if(Ci(n))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return x1([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const r=jn(t.ruleStack),i=this.getGAstProductions()[r];return new tP(i,t).startWalking()}}const lu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(lu);const W1=!0,H1=Math.pow(2,rs)-1,K1=fn({name:"RECORDING_PHASE_TOKEN",pattern:gr.NA});Ka([K1]);const Y1=ru(K1,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Y1);const QP={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class t${initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const r=t>0?t:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,t,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,t,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,t)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,t)},this[`MANY${r}`]=function(n){this.manyInternalRecord(t,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(t,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(t,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(t,n)}}this.consume=function(t,r,n){return this.consumeInternalRecord(r,t,n)},this.subrule=function(t,r,n){return this.subruleInternalRecord(r,t,n)},this.option=function(t,r){return this.optionInternalRecord(r,t)},this.or=function(t,r){return this.orInternalRecord(r,t)},this.many=function(t,r){this.manyInternalRecord(t,r)},this.atLeastOne=function(t,r){this.atLeastOneInternalRecord(t,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let r=0;r<10;r++){const n=r>0?r:"";delete t[`CONSUME${n}`],delete t[`SUBRULE${n}`],delete t[`OPTION${n}`],delete t[`OR${n}`],delete t[`MANY${n}`],delete t[`MANY_SEP${n}`],delete t[`AT_LEAST_ONE${n}`],delete t[`AT_LEAST_ONE_SEP${n}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,r){return()=>!0}LA_RECORD(t){return hu}topLevelRuleRecord(t,r){try{const n=new Uo({definition:[],name:t});return n.name=t,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(t,r){return qa.call(this,Zr,t,r)}atLeastOneInternalRecord(t,r){qa.call(this,ui,r,t)}atLeastOneSepFirstInternalRecord(t,r){qa.call(this,hi,r,t,W1)}manyInternalRecord(t,r){qa.call(this,ir,r,t)}manySepFirstInternalRecord(t,r){qa.call(this,Gn,r,t,W1)}orInternalRecord(t,r){return e$.call(this,t,r)}subruleInternalRecord(t,r,n){if(uu(r),!t||Ut(t,"ruleName")===!1){const a=new Error(`<SUBRULE${V1(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Lo(this.recordingProdStack),s=t.ruleName,o=new Xr({idx:r,nonTerminalName:s,label:n==null?void 0:n.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?QP:lu}consumeInternalRecord(t,r,n){if(uu(r),!u1(t)){const o=new Error(`<CONSUME${V1(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Lo(this.recordingProdStack),s=new Fe({idx:r,terminalType:t,label:n==null?void 0:n.LABEL});return i.definition.push(s),Y1}}function qa(e,t,r,n=!1){uu(r);const i=Lo(this.recordingProdStack),s=Ri(t)?t:t.DEF,o=new e({definition:[],idx:r});return n&&(o.separator=t.SEP),Ut(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),lu}function e$(e,t){uu(t);const r=Lo(this.recordingProdStack),n=oe(e)===!1,i=n===!1?e:e.DEF,s=new Wn({definition:[],idx:t,ignoreAmbiguities:n&&e.IGNORE_AMBIGUITIES===!0});Ut(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Cd(i,a=>Ri(a.GATE));return s.hasPredicates=o,r.definition.push(s),Pt(i,a=>{const c=new Jr({definition:[]});s.definition.push(c),Ut(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ut(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),lu}function V1(e){return e===0?"":`${e}`}function uu(e){if(e<0||e>H1){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${H1+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class r${initPerformanceTracer(t){if(Ut(t,"traceInitPerf")){const r=t.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=Li.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,r){if(this.traceInitPerf===!0){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${t}>`);const{time:i,value:s}=Yb(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}}function n$(e,t){t.forEach(r=>{const n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=r.prototype[i]})})}const hu=ru(Ms,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(hu);const Li=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:E1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),fu=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Mr;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Mr||(Mr={}));let Zd=class jx{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const r=this.className;this.TRACE_INIT("toFastProps",()=>{Vb(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Pt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=TP({rules:Ze(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(Ee(n)&&this.skipValidations===!1){const i=SP({rules:Ze(this.gastProductionsCache),tokenTypes:Ze(this.tokensMap),errMsgProvider:Us,grammarName:r}),s=hP({lookaheadStrategy:this.lookaheadStrategy,rules:Ze(this.gastProductionsCache),tokenTypes:Ze(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Ee(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=i8(Ze(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ze(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ze(this.gastProductionsCache))})),!jx.DEFER_DEFINITION_ERRORS_HANDLING&&!Ee(this.definitionErrors))throw t=St(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,r){this.definitionErrors=[],this.selfAnalysisDone=!1;const n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(t,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),Ut(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ut(r,"skipValidations")?r.skipValidations:Li.skipValidations}};Zd.DEFER_DEFINITION_ERRORS_HANDLING=!1,n$(Zd,[CP,PP,YP,VP,XP,qP,JP,ZP,t$,r$]);class i$ extends Zd{constructor(t,r=Li){const n=kr(r);n.outputCst=!0,super(t,n)}}function s$(e){const t=new o$,r=Ze(e);return St(r,n=>t.visitRule(n))}class o$ extends Cs{visitRule(t){const r=this.visitEach(t.definition),n=Gb(r,s=>s.propertyName),i=St(n,(s,o)=>{const a=!Cd(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=St(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:du(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:du(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:du(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:du(t)}]}visitEachAndOverrideWith(t,r){return St(this.visitEach(t),n=>Yr({},n,r))}visitEach(t){return hn(St(t,r=>this.visit(r)))}}function du(e){return e instanceof Xr?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function a$(e,t){let r=[];return r=r.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),r=r.concat(hn(St(e,n=>c$(n)))),t.includeVisitorInterface&&(r=r.concat(f$(t.visitorInterfaceName,e))),r.join(`

`)+`
`}function c$(e){const t=l$(e),r=u$(e);return[t,r]}function l$(e){const t=X1(e.name),r=Qd(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${r};
}`}function u$(e){return`export type ${Qd(e.name)} = {
  ${St(e.properties,r=>h$(r)).join(`
  `)}
};`}function h$(e){const t=p$(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function f$(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${St(t,r=>d$(r)).join(`
  `)}
}`}function d$(e){const t=Qd(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function p$(e){if(oe(e)){const t=zl(St(e,n=>q1(n)));return"("+qr(t,(n,i)=>n+" | "+i)+")"}else return q1(e)}function q1(e){return e.kind==="token"?"IToken":X1(e.name)}function X1(e){return hb(e)+"CstNode"}function Qd(e){return hb(e)+"CstChildren"}const m$={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function g$(e,t){const r=Object.assign(Object.assign({},m$),t),n=s$(e);return a$(n,r)}const Xa=jg(32,126).map(e=>String.fromCharCode(e));function Ht(e){return fn({...e,name:`token_${e.name}`})}function ut(e){return Ht({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:qe})}const pu=Ht({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),y$=Ht({name:"whitespace",pattern:/ +/,group:gr.SKIPPED}),_$=Ht({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:gr.SKIPPED}),tp=Ht({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),$o=Ht({name:"command",pattern:/#/,start_chars_hint:["#"]});let J1=!1;const b$="@#/?':!",w$=/[#\d]+/i,E$=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function k$(e,t){if(!J1)return null;let r=t;const n=e[r-1]??"";if(r>0&&n!==" "&&n!==`
`)return null;if(e[r]===" "){for(;e[r]===" ";)r++;if(b$.includes(e[r]))return null}for(;r>0&&`$@#':!/?
`.includes(e[r])===!1;)r--;switch(e[r]){case"?":case"/":{const o=e.substring(r+1,t+1).toLowerCase();if(o.indexOf(" ")<1||E$.test(o))return null;break}case"#":{const o=e.substring(r+1,r+4).toLowerCase();if(w$.test(o)===!1)return null;break}case"@":case"'":case":":case"!":return null}let i=t;for(;i<e.length&&e[i]!==`
`;)i++;const s=e.substring(t,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const Z1=Ht({name:"text",pattern:k$,line_breaks:!1,start_chars_hint:Xa}),Q1=Ht({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),ep=Ht({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),tw=Ht({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),ew=Ht({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),qe=Ht({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Xa}),mu=Ht({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),rp=Ht({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),rw=ut("isterrain"),nw=ut("isobject"),iw=ut("issolid"),sw=ut("iswalk"),ow=ut("isswim"),aw=ut("isbullet"),cw=ut("isghost"),lw=ut("iswalking"),uw=ut("iswalkable"),hw=ut("isswimming"),fw=ut("isswimmable"),dw=ut("black"),pw=ut("dkblue"),mw=ut("dkgreen"),gw=ut("dkcyan"),yw=ut("dkred"),_w=ut("dkpurple"),bw=ut("dkyellow"),ww=ut("ltgray"),Ew=ut("dkgray"),kw=ut("blue"),vw=ut("green"),xw=ut("cyan"),Aw=ut("red"),Tw=ut("purple"),Sw=ut("yellow"),Rw=ut("white"),Ow=ut("brown"),Iw=ut("dkwhite"),Nw=ut("ltgrey"),Cw=ut("gray"),Lw=ut("grey"),Mw=ut("dkgrey"),Uw=ut("ltblack"),Pw=ut("onblack"),$w=ut("ondkblue"),Fw=ut("ondkgreen"),Bw=ut("ondkcyan"),Dw=ut("ondkred"),jw=ut("ondkpurple"),zw=ut("ondkyellow"),Gw=ut("onltgray"),Ww=ut("ondkgray"),Hw=ut("onblue"),Kw=ut("ongreen"),Yw=ut("oncyan"),Vw=ut("onred"),qw=ut("onpurple"),Xw=ut("onyellow"),Jw=ut("onwhite"),Zw=ut("onbrown"),Qw=ut("ondkwhite"),tE=ut("onltgrey"),eE=ut("ongray"),rE=ut("ongrey"),nE=ut("ondkgrey"),iE=ut("onltblack"),sE=ut("onclear"),oE=ut("idle"),aE=ut("up"),cE=ut("down"),lE=ut("left"),uE=ut("right"),hE=ut("by"),fE=ut("at"),dE=ut("flow"),pE=ut("seek"),mE=ut("rndns"),gE=ut("rndne"),yE=ut("rnd"),_E=ut("cw"),bE=ut("ccw"),wE=ut("opp"),EE=ut("rndp"),kE=ut("away"),vE=ut("toward"),xE=ut("find"),AE=ut("flee"),TE=ut("to"),SE=ut("i"),RE=ut("u"),OE=ut("north"),IE=ut("n"),NE=ut("d"),CE=ut("south"),LE=ut("s"),ME=ut("l"),UE=ut("west"),PE=ut("w"),$E=ut("r"),FE=ut("east"),BE=ut("e"),DE=ut("over"),jE=ut("under"),zE=Ht({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:qe}),GE=ut("contact"),WE=ut("blocked"),HE=ut("any"),KE=ut("countof"),YE=ut("abs"),VE=ut("intceil"),qE=ut("intfloor"),XE=ut("intround"),JE=ut("clamp"),ZE=ut("min"),QE=ut("max"),tk=ut("pick"),ek=ut("pickwith"),rk=ut("random"),nk=ut("randomwith"),ik=ut("run"),sk=ut("runwith"),ok=Ht({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),ak=Ht({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:qe}),ck=Ht({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:qe}),lk=Ht({name:"islessthan",pattern:/<|below/i,longer_alt:qe}),uk=Ht({name:"isgreaterthan",pattern:/>|above/i,longer_alt:qe}),hk=Ht({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:qe}),fk=Ht({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:qe}),np=Ht({name:"or",pattern:/or/i,longer_alt:qe}),ip=Ht({name:"not",pattern:/not/i,longer_alt:qe}),sp=Ht({name:"and",pattern:/and/i,longer_alt:qe}),op=Ht({name:"plus",pattern:/\+/}),ap=Ht({name:"minus",pattern:/-/}),dk=Ht({name:"power",pattern:/\*\*/}),pk=Ht({name:"multiply",pattern:/\*/}),cp=Ht({name:"divide",pattern:/\//}),mk=Ht({name:"moddivide",pattern:/%/}),gk=Ht({name:"floordivide",pattern:/%%/}),yk=Ht({name:"query",pattern:/\?/}),_k=Ht({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),bk=Ht({name:"rparen",pattern:/\)/,pop_mode:!0}),wk=Ht({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:Xa,longer_alt:qe}),Ek=Ht({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Xa,longer_alt:qe}),kk=Ht({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Xa,longer_alt:qe}),lp=Ht({name:"if",pattern:/if|try|take|give/i,longer_alt:qe}),gu=Ht({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:qe}),up=ut("done"),hp=ut("else"),vk=ut("while"),xk=ut("repeat"),Ak=ut("waitfor"),Tk=Ht({name:"foreach",pattern:/foreach|for/i,longer_alt:qe}),Sk=ut("break"),Rk=ut("continue");function Ok(e,t){return[...e,cE,...t,rp,rw,nw,iw,uw,lw,sw,fw,hw,ow,aw,cw,dw,pw,mw,gw,yw,_w,bw,ww,Ew,kw,vw,xw,Aw,Tw,Sw,Rw,Ow,Iw,Nw,Cw,Lw,Mw,Uw,Pw,$w,Fw,Bw,Dw,jw,zw,Gw,Ww,Hw,Kw,Yw,Vw,qw,Xw,Jw,Zw,Qw,tE,eE,rE,nE,iE,sE,oE,aE,lE,uE,hE,fE,dE,pE,EE,mE,gE,yE,_E,bE,wE,kE,vE,xE,AE,TE,OE,CE,UE,FE,DE,jE,zE,GE,WE,HE,KE,YE,VE,qE,XE,JE,ZE,QE,ek,tk,nk,rk,sk,ik,ok,ak,ck,hk,lk,fk,uk,np,ip,sp,op,ap,dk,pk,cp,gk,mk,yk,_k,bk,SE,RE,IE,NE,LE,ME,PE,$E,BE,mu,qe]}const Ik=Ok([Z1,tp,wk,Ek,kk,$o,Q1,ep,tw,ew,pu,y$],[Sk,Rk,up,gu,hp,Tk,lp,xk,Ak,vk]),v$=new gr({defaultMode:"use_newlines",modes:{use_newlines:Ik,ignore_newlines:Ok([_$],[])}},{skipValidations:!ni,ensureOptimizations:ni,positionTracking:"full"});function Nk(e){J1=!0;const t=v$.tokenize(e||` 
`),[r]=(ce(t.tokens)?t.tokens:[]).slice(-1);return r&&r.tokenType.name!=="Newline"&&t.tokens.push(ru(pu,`
`,r.startOffset,r.endOffset??NaN,r.startLine??NaN,r.endLine??NaN,r.startColumn??NaN,r.endColumn??NaN)),t}function x$(e,t,r=!0){if(r){const[n,...i]=t;switch(It(n??"")){default:return{type:Rt.OBJECT,values:t};case"loader":return{type:Rt.LOADER,values:i};case"board":return{type:Rt.BOARD,values:i};case"object":return{type:Rt.OBJECT,values:i};case"terrain":return{type:Rt.TERRAIN,values:i};case"charset":return{type:Rt.CHARSET,values:i};case"palette":return{type:Rt.PALETTE,values:i}}}else{const[n,i,...s]=t,o=It(i??""),a=[n,e,...s];switch(o){default:return{type:Rt.CONST,values:t};case"rn":case"range":return{type:Rt.RANGE,values:a};case"sl":case"select":return{type:Rt.SELECT,values:a};case"nm":case"number":return{type:Rt.NUMBER,values:a};case"tx":case"text":return{type:Rt.TEXT,values:a};case"hk":case"hotkey":return{type:Rt.HOTKEY,values:a};case"copyit":return{type:Rt.COPYIT,values:a};case"openit":return{type:Rt.OPENIT,values:a};case"zssedit":return{type:Rt.ZSSEDIT,values:a};case"charedit":return{type:Rt.CHAREDIT,values:a};case"coloredit":return{type:Rt.COLOREDIT,values:a}}}}function dn(e){switch(e){case Rt.LOADER:return"loader";case Rt.BOARD:return"board";case Rt.OBJECT:return"object";case Rt.TERRAIN:return"terrain";case Rt.CHARSET:return"charset";case Rt.PALETTE:return"palette";case Rt.CONST:return"const";case Rt.RANGE:return"range";case Rt.SELECT:return"select";case Rt.NUMBER:return"number";case Rt.TEXT:return"text";case Rt.HOTKEY:return"hotkey";case Rt.COPYIT:return"copyit";case Rt.OPENIT:return"openit";case Rt.VIEWIT:return"viewit";case Rt.ZSSEDIT:return"zssedit";case Rt.CHAREDIT:return"charedit";case Rt.COLOREDIT:return"coloredit"}}var fp=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(fp||{});function Ck(e){return Oo(e,fp,{bits:t=>Array.from(t)})}function Lk(e){return Oa(e,fp,{bits:t=>new Uint8Array(t)})}function yu(e,t){return{id:We(),code:e,...t}}var dp=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(dp||{});function A$(e){return Oo(e,dp,{board:$z,object:xl,terrain:xl,charset:Ck,palette:Ck,stats:Re})}function T$(e){return Oa(e,dp,{board:Fz,object:Al,terrain:Al,charset:Lk,palette:Lk})}function Ja(e){const t={...Ps(e)};return Object.keys(t).forEach(r=>{switch(r){case"type":case"name":delete t[r];break}}),t}function S$(e){return y(e)?(e.stats=void 0,Ps(e)):{}}function pp(e){const t=Nk(e),r={};let n=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===tp){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=x$(pt(c)?c:"",l,n),f=u.values.join(" ");switch(n=!1,u.type){case Rt.LOADER:r.type=bt.LOADER,r.name=f;break;case Rt.BOARD:r.type=bt.BOARD,r.name=f;break;case Rt.OBJECT:r.type=bt.OBJECT,r.name=f||"object";break;case Rt.TERRAIN:r.type=bt.TERRAIN,r.name=f;break;case Rt.CHARSET:r.type=bt.CHARSET,r.name=f;break;case Rt.PALETTE:r.type=bt.PALETTE,r.name=f;break;case Rt.CONST:{const[d,...h]=u.values;if(pt(d)){const m=It(d),p=h.join(" ");if(pt(p)){const _=parseFloat(p);r[m]=wt(_)?_:p}else r[m]=1}break}case Rt.RANGE:case Rt.SELECT:case Rt.NUMBER:case Rt.TEXT:case Rt.HOTKEY:case Rt.ZSSEDIT:case Rt.CHAREDIT:case Rt.COLOREDIT:{const[d,...h]=u.values;if(pt(d)){const m=It(d);r[m]=[dn(u.type),...h]}break}}}}return r}function Ps(e){var t;return y(e)?(y((t=e.stats)==null?void 0:t.type)||(e.stats=pp(e.code),y(e.stats.type)||(e.stats.type=bt.OBJECT)),e.stats):{}}function Mk(e){switch(e){default:case bt.ERROR:return"error";case bt.LOADER:return dn(Rt.LOADER);case bt.BOARD:return dn(Rt.BOARD);case bt.OBJECT:return dn(Rt.OBJECT);case bt.TERRAIN:return dn(Rt.TERRAIN);case bt.CHARSET:return dn(Rt.CHARSET);case bt.PALETTE:return dn(Rt.PALETTE)}}function di(e){return Ps(e).type??bt.ERROR}function pi(e){return Mk(di(e))}function pe(e){return Ps(e).name??""}function R$(e,t){return Ps(e)[t]}const _u=new wf;function O$(e){if(!pt(e))return;const t=ba(e);if(y(t)&&y(Lt[t]))return Lt[t];const r=It(e),n=yt[r];if(y(n))return n}function bu(e,t){const r=Object.keys(e);for(let n=0;n<r.length;++n){const i=r[n],s=e[i];if(ce(s)){const[o,...a]=s;switch(o){case"text":y(t[i])||(t[i]="");break;case"range":y(t[i])||(t[i]=4);break;case"number":y(t[i])||(t[i]=0);break;case"select":if(!y(t[i])){const[,c]=a;t[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":t[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":t[i]=O$(s)??s;break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=s===""?1:s;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Mt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Mt.ISSWIM;break;case"issolid":t.collision=Mt.ISSOLID;break;case"isbullet":t.collision=Mt.ISBULLET;break;case"isghost":t.collision=Mt.ISGHOST;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Oe(e){var t;if(y(e))switch(di(e)){default:return;case bt.ERROR:return e.code??"";case bt.LOADER:return e.code??"";case bt.BOARD:{y(e.board)||(e.board=Ku()),e.board.id=e.id;const r=Ja(e);return r.isdark&&(e.board.isdark=1),r.notdark&&(e.board.isdark=0),wt(r.startx)&&(e.board.startx=r.startx),wt(r.starty)&&(e.board.starty=r.starty),pt(r.over)&&(It(r.over)==="empty"?e.board.over=void 0:e.board.over=r.over,e.board.overboard=void 0),pt(r.under)&&(It(r.under)==="empty"?e.board.under=void 0:e.board.under=r.under,e.board.underboard=void 0),pt(r.camera)&&(It(r.camera)==="empty"?e.board.camera=void 0:e.board.camera=r.camera),pt(r.graphics)&&(It(r.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=r.graphics),wt(r.facing)&&(e.board.facing=r.facing),pt(r.facing)&&It(r.facing)==="empty"&&(e.board.facing=void 0),pt(r.exitnorth)&&(e.board.exitnorth=r.exitnorth),pt(r.exitsouth)&&(e.board.exitsouth=r.exitsouth),pt(r.exitwest)&&(e.board.exitwest=r.exitwest),pt(r.exiteast)&&(e.board.exiteast=r.exiteast),wt(r.timelimit)&&(e.board.timelimit=r.timelimit),r.restartonzap&&(e.board.restartonzap=1),r.norestartonzap&&(e.board.restartonzap=0),wt(r.maxplayershots)&&(e.board.maxplayershots=r.maxplayershots),e.board}case bt.OBJECT:return y(e.object)||(e.object=A_()),e.object.id=e.id,e.object.code=e.code,e.object.name=pe(e),e.object.category=jr.ISOBJECT,bu(Ja(e),e.object),e.object;case bt.TERRAIN:return y(e.terrain)||(e.terrain=A_()),e.terrain.id=e.id,e.terrain.name=pe(e),e.terrain.category=jr.ISTERRAIN,bu(Ja(e),e.terrain),e.terrain;case bt.PALETTE:{if(y(e.palette)||(e.palette=S_(YC)),y((t=e.palette)==null?void 0:t.bits)){const r=Ja(e),n=on(r);for(let i=0;i<n.length;++i){const s=n[i].toLowerCase(),o=r[s];if(s.startsWith("color")&&pt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){_u.set(o);const c=a*nl,l=_u.r*63,u=_u.g*63,f=_u.b*63;e.palette.bits[c+0]=Ke(l,0,63),e.palette.bits[c+1]=Ke(u,0,63),e.palette.bits[c+2]=Ke(f,0,63)}}}}return e.palette}case bt.CHARSET:return y(e.charset)||(e.charset=R_(KC)),e.charset}}function mp(e){return{id:We(),name:rA(),timestamp:0,activelist:[],pages:e,flags:{}}}var gp=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(gp||{});function I$(e){return Oo(e,gp,{pages:t=>t.map(A$),flags:t=>{const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function Uk(e){return Oa(e,gp,{pages:t=>t.map(T$)})}function Pk(e){y(e)&&(e.token=`${nA()}${_n(1111,9999)}`)}function $s(e,t){if(!y(e))return;const r=It(t);return e.pages.find(i=>i.id===t||r===pe(i))}function sr(e,t,r){if(!y(e))return;const n=It(r);return e.pages.find(s=>di(s)===t&&(s.id===r||n===pe(s)))}function yp(e,t,r){let n=sr(e,t,r);if(!y(n)){const i=Mk(t);return n=yu(i==="object"?`@${r||"object"}
`:`@${i} ${r}
`,{}),Qa(e,n),[n,!0]}return[n,!1]}function Fs(e,t){return y(e)?e.pages.filter(r=>di(r)===t):[]}function $k(e,t,r){if(!y(e))return[];const n=It(r);return e.pages.filter(s=>di(s)===t).filter(s=>{const o=Ps(s),a=It(pe(s));return s.id===r||n===a||y(o[r])})}function Za(e){return y(e)?Yn(e.pages).sort((r,n)=>{const i=di(r),s=di(n);return i===s?pe(r).localeCompare(pe(n)):s-i}):[]}function Fk(e,t){if(y(t)){const r=sr(e,bt.TERRAIN,t.kind??"");if(y(r))return r;const n=sr(e,bt.OBJECT,t.kind??"");if(y(n))return n}}function Qa(e,t){if(!y(e)||!y(t))return!1;const r=$s(e,t.id);return y(r)?!1:(e.pages.push(t),Pk(e),!0)}function Bk(e,t){const r=$s(e,t);if(y(e)&&y(r)){const n=It(t);return e.pages=e.pages.filter(i=>i.id!==t&&n!==pe(i)),Pk(e),r}}function yr(e,t=1,r=Lt.WHITE,n=Lt.BLACK){const i=e==null?void 0:e.kinddata;return{name:It((e==null?void 0:e.name)??(i==null?void 0:i.name)),char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??r,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??n,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function N$(e,t){return!!(e!=null&&e.flags[t])}function Mi(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function Dk(e,t){e&&delete e.flags[t]}function jk(e,t,r){const n=Mi(e,t);return n==null?void 0:n[r]}function C$(e,t,r,n){const i=Mi(e,t);return i&&(i[r]=n),n}function Ie(e){if(!y(e)||y(e.lookup)&&y(e.named))return;const t=new Array(Tt*Yt).fill(void 0),r={},n=Object.values(e.objects);for(let o=0;o<n.length;++o){const a=n[o];if(y(a.x)&&y(a.y)&&y(a.id)&&!y(a.removed)){a.category=jr.ISOBJECT,t[a.x+a.y*Tt]=a.id,pt(a.code)&&!y(a.name)&&bu(pp(a.code),a);const c=yr(a);r[c.name]||(r[c.name]=new Set),r[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];if(y(a)){a.x=i,a.y=s,a.category=jr.ISTERRAIN;const c=yr(On(a));r[c.name]||(r[c.name]=new Set),r[c.name].add(o)}++i,i>=Tt&&(i=0,++s)}e.lookup=t,e.named=r}function tc(e){y(e)&&(delete e.named,delete e.lookup,Ie(e))}function zk(e,t,r){var i;if(!y(e)||!y(e.named)||!y(t))return;const n=It(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[n]||(e.named[n]=new Set),e.named[n].add((t==null?void 0:t.id)??r??"")}function L$(e,t){if(!(!y(e)||!y(e.lookup)||!y(t==null?void 0:t.id))&&!y(t.removed)&&zt(t,"collision")!==Mt.ISGHOST){const r=t.x??0,n=t.y??0;e.lookup[r+n*Tt]=t.id}}function M$(e,t){var r;if(y(e)&&y(t==null?void 0:t.x)&&y(t.y)){const n=yr(t),i=Kn(e,t);y((r=e.named)==null?void 0:r[n.name])&&e.named[n.name].delete(i)}}function _p(e,t){var r;if(y(e)&&y(t==null?void 0:t.id)){if(y(e.lookup)&&y(t.x)&&y(t.y)){const i=t.x+t.y*Tt;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const n=yr(t);y((r=e.named)==null?void 0:r[n.name])&&y(t.id)&&e.named[n.name].delete(t.id)}}function bp(e,t,r,n=!1){if(!y(e)||!y(e.lookup)||r.x<0||r.x>=Tt||r.y<0||r.y>=Yt)return;const i=r.x+r.y*Tt,s=Fr(e,e.lookup[i]??"404");if(y(s))return n&&xr(s.id)?void 0:s;const o=e.terrain[i];if(y(o)&&uc(t,zt(o,"collision")))return o}function U$(e,t,r){const n=Fr(e,(t==null?void 0:t.id)??""),i=(n==null?void 0:n.x)??-1,s=(n==null?void 0:n.y)??-1;if(i-r.x===0&&s-r.y===0)return!0;const o=zt(n,"collision");return y(bp(e,o,r))}function wp(e,t,r){var d;const n=Fr(e,(t==null?void 0:t.id)??"");if(!y(e)||!y(n)||!y(n.x)||!y(n.y)||!y(e.lookup)||r.x<0||r.x>=Tt||r.y<0||r.y>=Yt)return{name:"edge",kind:"edge",collision:Mt.ISSOLID,x:r.x,y:r.y};if(n.x-r.x===0&&n.y-r.y===0)return;const i=Kn(e,n),s=Kn(e,r),o=zt(n,"collision");if(o===Mt.ISGHOST)return;const a=xr(n==null?void 0:n.id),c=o===Mt.ISBULLET,l=Fr(e,e.lookup[s]??"");if(zt(l,"collision")===Mt.ISGHOST)return;const u=xr((l==null?void 0:l.id)??"");if(y(l)&&(!a||!u)){const h=zt(n,"group"),m=zt(l,"group");if((h||m)&&h!=m)return{...l};const p=!!zt(l,"breakable");if(c&&p)return n.x=r.x,n.y=r.y,{...l};if(o===Mt.ISBULLET)return{...l};const _=!!zt(l,"item");if(Xp(n,l)&&(!a||!_)){const v=Fn({x:n.x,y:n.y},r),A=De({x:l.x??0,y:l.y??0},v),T=wp(e,l,A);if(y(T))return{...l}}else return{...l}}const f=e.terrain[s];if(y(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??Mt.ISWALK;if(uc(o,h))return{...f,x:r.x,y:r.y}}n.x=r.x,n.y=r.y,y(n.removed)||(e.lookup[i]=void 0,e.lookup[s]=n.id??"")}function P$(e,t){const r=[];if(!y(e))return r;const n=Object.values(e.objects);for(let i=0;i<n.length;++i){const s=n[i];y(s.id)&&y(s.removed)&&t-s.removed>wc*5&&(r.push(s.id),bx(e,s.id))}return r}function $$(e,t){const r=[];if(!y(e))return r;e.lookup=void 0,Ie(e);const n=Object.values(e.objects);for(let s=0;s<n.length;++s){const o=n[s];if(!y(o.id))continue;o.lx=o.x,o.ly=o.y;const a=On(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=zt(o,"cycle");if(l>u)continue}r.push({id:o.id,type:bt.OBJECT,code:c,object:o,terrain:void 0})}}const i=P$(e,t);for(let s=0;s<i.length;++s)r.push({id:i[s],type:bt.ERROR,code:"",object:void 0,terrain:void 0});return r}function Gk(e,t,r){const n=[],i=[];if(!y(e))return{objectelements:n,terrainelements:i};function s(a,c){switch(r){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=zt(a,r);return y(l)||yr(a).name===r||zt(a,"group")===r}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&n.push(c)}for(let a=0;a<Af;++a){const c=e.terrain[a];y(c)&&s(c,!0)&&i.push(c)}return{objectelements:n,terrainelements:i}}function Wk(e,t,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=se(t,{x:s,y:i});Ve(o)&&Or(t,o,e.timestamp),Ce(t,{x:s,y:i})}}function F$(e,t,r){for(let n=t.y;n<=r.y;++n)for(let i=t.x;i<=r.x;++i)Ce(e,{x:i,y:n})}function Hk(e,t,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=se(t,{x:s,y:i});Ve(o)&&Or(t,o,e.timestamp),Ce(t,{x:s,y:i})}}function Fo(e,t){y(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.displaychar=t.displaychar,e.displaycolor=t.displaycolor,e.displaybg=t.displaybg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.p4=t.p4,e.p5=t.p5,e.p6=t.p6,e.code=t.code,e.item=t.item,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.lightdir=t.lightdir,e.stepx=t.stepx,e.stepy=t.stepy,e.shootx=t.shootx,e.shooty=t.shooty,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function wu(e,t,r,n,i){switch(i){case"all":case"object":case"terrain":break;default:return B$(e,t,r,"",i)}if(!y(E.book))return;const s=E.book,o=sr(s,bt.BOARD,e),a=Oe(o);if(!y(a))return;const c=sr(s,bt.BOARD,t),l=Oe(c);if(!y(l))return;Ie(a),Ie(l);let u=!1;if(y(a)&&y(l)){switch(i){case"all":Wk(s,l,r,n);break;case"object":Hk(s,l,r,n);break;case"terrain":F$(l,r,n);break;default:u=!0;break}for(let f=r.y;f<=n.y;++f)for(let d=r.x;d<=n.x;++d){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:d,y:f};let _,w=se(a,p);if(Ve(w)?(_=ls(a,d,f),xr(w==null?void 0:w.id)&&(w=void 0)):(_=w,w=void 0),y(_)&&(m||u&&zt(_,"group")===i)){u&&Wk(s,l,p,p);const v=In(l,[_.kind??""],p);Fo(v,_)}if(y(w)&&(h||u&&zt(w,"group")===i)){u&&Hk(s,l,p,p);const v=In(l,[w.kind??""],p);Fo(v,w)}}tc(l)}}function B$(e,t,r,n,i){if(!y(E.book))return;const s=E.book,o=sr(s,bt.BOARD,e),a=Oe(o);if(!y(a))return;const c=sr(s,bt.BOARD,t),l=Oe(c);if(y(l)&&(Ie(a),Ie(l),y(a)&&y(l))){const{terrainelements:u,objectelements:f}=Gk(a,n,i);if(u.length===0&&f.length===0)return;const d={x:Tt,y:Yt};for(let h=0;h<u.length;++h){const m=u[h];wt(m.x)&&(d.x=Math.min(d.x,m.x)),wt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<f.length;++h){const m=f[h];wt(m.x)&&(d.x=Math.min(d.x,m.x)),wt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},_=se(l,p);y(_)&&(Ve(_)&&Or(l,_,s.timestamp),Ce(l,p));const w=In(l,[m.kind??""],p);Fo(w,m)}for(let h=0;h<f.length;++h){const m=f[h],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},_=In(l,[m.kind??""],p);Fo(_,m)}tc(l)}}function D$(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Eu(e,t,r){if(!y(e))return;C$(e,t,"board",r);const n=ar(r);y(n)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function Bo(e,t,r,n,i=!1){const s=Je(t);if(!y(e)||!y(s))return;const o=Fr(s,t);if(!Ve(o)||!(o!=null&&o.id))return;const a=ar(r);if(!y(a))return;Ie(a);const c=bp(a,Mt.ISWALK,n,!0);if(i===!1&&y(c))if(zt(c,"item"))cr(t,o,c,"touch");else return;delete s.objects[o.id];const l=Kn(s,o);s.lookup&&(s.lookup[l]=void 0),o.x=n.x,o.y=n.y,a.objects[o.id]=o;const u=Kn(a,o);a.lookup&&(a.lookup[u]=o.id),Eu(e,t,a.id)}function j$(e){const r=((e==null?void 0:e.activelist)??[]).map(n=>{const i=jk(e,n,"board");return pt(i)?i:""});return NO(r)}function Do(e){const t=j$(e),r=new Set,n=[];for(let i=0;i<t.length;++i){const s=ar(t[i]);if(y(s)&&!r.has(s.id)){if(pt(s.over))if(pt(s.overboard)){const o=ar(s.overboard);y(o)?r.has(o.id)||n.push(o):delete s.overboard}else{const o=ar(s.over);y(o)&&(s.overboard=o.id)}else pt(s.overboard)&&delete s.overboard;if(n.push(s),pt(s.under))if(pt(s.underboard)){const o=ar(s.underboard);y(o)||delete s.underboard}else{const o=ar(s.under);y(o)&&(s.underboard=o.id)}else pt(s.underboard)&&delete s.underboard}}return n}const z$=jg(32,126).map(e=>String.fromCharCode(e)),G$=fn({name:"Whitespace",pattern:/ +/}),W$=fn({name:"WhitespaceSkipped",pattern:/ +/,group:gr.SKIPPED}),Ep=fn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Kk=fn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:z$}),kp=fn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),vp=fn({name:"EscapedDollar",pattern:"$$"}),xp=fn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Ap=fn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Yk=fn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function H$(e,t=""){return fn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const Vk=Object.keys(_a).map(e=>H$(`\\$(${e})`,e)),K$=[G$,Ep,...Vk,kp,Kk,Ap,vp,Yk,xp],Y$=new gr(K$,{skipValidations:!ni,ensureOptimizations:ni}),V$=new gr([W$,Ep,...Vk,kp,Kk,Ap,vp,Yk,xp],{skipValidations:!ni,ensureOptimizations:ni}),qk=/\$CENTER/i;function q$(e){if(qk.test(e))return e.replace(qk,"")}function Tp(e,t=!1){return t?V$.tokenize(e):Y$.tokenize(e)}function Sp(e,t,r,n,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Xk(e){e.active={...e.reset}}function Jk(e,t){const r=t.y;function n(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}n()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case vp:s("$");break;case Ap:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}n();break;case kp:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Ep:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=_a[l],f=LO(Lt[u]),d=vf(Lt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):y(f)?t.active.color=f:y(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(y(t.writefullwidth)&&(t.x>o||t.y===r)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Xk(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;J$(u,u+l.length,t.active.color,t.active.bg,t),X$(u,l,t)}}}function Zk(e,t,r){const n=Tp(e);n.tokens&&(Jk(n.tokens,t),r&&Xk(t),t.changed())}function Qk(e,t,r){const n=Tp(e);if(!n.tokens)return;const i=Sp(t,r,Lt.WHITE,Lt.BLACK);return i.measureonly=!0,Jk(n.tokens,i),i.x>0&&++i.y,i}function X$(e,t,r){let n=0;const i=e+t.length;for(let s=e;s<i;++s)r.char[s]=t.charCodeAt(n++);r.changed()}function J$(e,t,r,n,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=r,i.bg[a]=n;i.changed()}function ku(e,t,r){var a;if(!y((a=E.element)==null?void 0:a.x)||!y(E.element.y))return 0;const[n,i]=nt(t,0,[H.DIR,H.MAYBE_KIND]);E.element.shootx=Ke(n.destpt.x-n.startpt.x,-1,1),E.element.shooty=Ke(n.destpt.y-n.startpt.y,-1,1);const s=i??["bullet"],o=bz(E.board,s,{x:E.element.x,y:E.element.y});if(y(o)){y(r)&&(o.arg=r),o.cycle=1,o.party=E.elementid,o.collision=Mt.ISBULLET,o.breakable=1,o.stepx=n.destpt.x-E.element.x,o.stepy=n.destpt.y-E.element.y,o.bg=Lt.ONCLEAR;const c=On(o),l=o.code??(c==null?void 0:c.code)??"";lx(E.book,E.board,o,l)}return e.yield(),0}function vu(e,t,r){var i,s;if(!ya(E.element)||!y(E.book)||!y(E.board)||!y(E.element))return 0;Ie(E.board);const[n]=nt(E.words,0,[H.ANY]);if(Wr(n)){const[o,a]=nt(e,0,[H.DIR,H.KIND]),{destpt:c}=o;if(c.x<0||c.x>=Tt||c.y<0||c.y>=Yt)return 0;const[l]=a,u=On({kind:l}),f=zt(u,"collision");if(f===Mt.ISGHOST)return In(E.board,a,o.destpt,t),0;const d=se(E.board,o.destpt);if((d==null?void 0:d.category)===jr.ISOBJECT&&(d!=null&&d.pushable)){const h={x:((i=E.element)==null?void 0:i.x)??0,y:((s=E.element)==null?void 0:s.y)??0},m=De(o.destpt,Fn(h,o.destpt));wp(E.board,d,m)}if(Ve(u)||In(E.board,a,o.destpt,t),Ve(u)){const h=bp(E.board,f,o.destpt);if(!y(h)){const m=In(E.board,a,o.destpt,t);y(m)&&y(r)&&(m.arg=r)}}}return 0}function Z$(e,t,r){if(!y(E.book)||!y(E.board))return 0;Ie(E.board);const[n,i]=nt(t,0,[H.DIR,H.DIR]),s=se(E.board,n.destpt);return Ve(s),0}const Q$={x:0,y:0},tF={x:Tt-1,y:Yt-1},eF="all",rF=Ti().command("goto",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;const[r,n]=nt(t,0,[H.STRING]),[i,s]=nt(t,n,[H.MAYBE_NUMBER,H.MAYBE_NUMBER]),o=ar(r);if(!y(o))return 0;Ie(o);const a={x:i??o.startx??Math.round(Tt*.5),y:s??o.starty??Math.round(Yt*.5)},c=yr(E.element);if(c.name!=="player"){const l=zt(E.element,"color"),u=zt(E.element,"bg"),f=Qc(l,u),d=Hu(o,[c.name,f]),[h]=d.sort((m,p)=>{const _=m.y??1e4,w=p.y??1e4,v=_-w;if(v!==0)return v;const A=m.x??1e4,T=p.x??1e4;return A-T});y(h)&&wt(h.x)&&wt(h.y)&&(a.x=h.x,a.y=h.y)}return Bo(E.book,E.elementfocus,o.id,a,!0),0}).command("build",(e,t)=>{if(!y(E.book)||!y(E.board)||!y(E.element))return 0;const[r,n]=nt(t,0,[H.NAME,H.MAYBE_STRING]),i=Ku();if(y(i)){if(pt(n)){const s=ar(n);y(s)&&wu(s.id,i.id,Q$,tF,eF)}e.set(r,i.id)}return 0}).command("shove",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;Ie(E.board);const[r,n]=nt(t,0,[H.DIR,H.DIR]),i=se(E.board,r.destpt);return Ve(i)&&cs(E.book,E.board,i,n.destpt),0}).command("duplicate",Z$).command("write",(e,t)=>{var d;if(!y(E.book)||!y(E.board))return 0;Ie(E.board);const[r,n,i]=nt(t,0,[H.DIR,H.COLOR]),s=t.slice(i).map(Se).join(" "),{color:o,bg:a}=Vg(n),c=((d=Qk(s,256,1))==null?void 0:d.measuredwidth)??1,l=Sp(256,1,o??Lt.WHITE,a??Lt.BLACK);Zk(s,l,!1);const u=c-1;switch(Fn(r.startpt,r.destpt)){case yt.EAST:for(let h=0;h<c;++h)Ce(E.board,{x:r.destpt.x+h,y:r.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case yt.WEST:for(let h=0;h<c;++h)Ce(E.board,{x:r.destpt.x+h-u,y:r.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case yt.NORTH:for(let h=0;h<c;++h)Ce(E.board,{x:r.destpt.x,y:r.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case yt.SOUTH:for(let h=0;h<c;++h)Ce(E.board,{x:r.destpt.x,y:r.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;Ie(E.board);const[r,n]=nt(t,0,[H.KIND,H.KIND]);(lc(r)??"")==="empty"&&Mz(E.board).forEach(c=>{In(E.board,n,c)});const s=lc(n),o=Wu(n),a=hx(n);return Hu(E.board,r).forEach(c=>{if(y(o)&&(c.color=o),y(a)&&(c.bg=a),yr(c).name!==s){const u=zt(c,"color"),f=zt(c,"bg");if(Or(E.board,c,E.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},h=In(E.board,n,d);y(h)&&(h.color=u,h.bg=f)}}}),0}).command("put",(e,t)=>vu(t)).command("putwith",(e,t)=>{const[r,n]=nt(t,0,[H.ANY]);return vu(t.slice(n),void 0,r)}).command("oneof",(e,t)=>{const[r,n]=nt(t,0,[H.ANY]);return y(E.board)&&Fr(E.board,r)?0:vu(t.slice(n),r)}).command("oneofwith",(e,t)=>{const[r,n,i]=nt(t,0,[H.ANY,H.ANY]);return y(E.board)&&Fr(E.board,n)?0:vu(t.slice(i),n,r)}).command("shoot",ku).command("shootwith",(e,t)=>{const[r,n]=nt(t,0,[H.ANY]);return ku(e,t.slice(n),r)}).command("throwstar",(e,t)=>ku(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[r,n]=nt(t,0,[H.ANY]);return ku(e,[...t.slice(n),"star"],r)});var Bs=(e=>(e[e.Border=-1]="Border",e[e.Data=0]="Data",e[e.Function=1]="Function",e[e.Position=2]="Position",e[e.Timing=3]="Timing",e[e.Alignment=4]="Alignment",e))(Bs||{}),nF=Object.defineProperty,iF=(e,t,r)=>t in e?nF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,xu=(e,t,r)=>(iF(e,typeof t!="symbol"?t+"":t,r),r);const sF=[0,1],tv=[1,0],ev=[2,3],rv=[3,2],oF={L:sF,M:tv,Q:ev,H:rv},aF=/^[0-9]*$/,cF=/^[A-Z0-9 $%*+.\/:-]*$/,Rp="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Op=1,Ip=40,nv=3,lF=3,Au=40,uF=10,iv=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],sv=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class hF{constructor(t,r,n,i){if(this.version=t,this.ecc=r,xu(this,"size"),xu(this,"mask"),xu(this,"modules",[]),xu(this,"types",[]),t<Op||t>Ip)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=t*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(n);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(t,r){return t>=0&&t<this.size&&r>=0&&r<this.size&&this.modules[r][t]}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2===0,Bs.Timing),this.setFunctionModule(n,6,n%2===0,Bs.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const t=this.getAlignmentPatternPositions(),r=t.length;for(let n=0;n<r;n++)for(let i=0;i<r;i++)n===0&&i===0||n===0&&i===r-1||n===r-1&&i===0||this.drawAlignmentPattern(t[n],t[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(t){const r=this.ecc[1]<<3|t;let n=r;for(let s=0;s<10;s++)n=n<<1^(n>>>9)*1335;const i=(r<<10|n)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Pi(i,s));this.setFunctionModule(8,7,Pi(i,6)),this.setFunctionModule(8,8,Pi(i,7)),this.setFunctionModule(7,8,Pi(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Pi(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Pi(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Pi(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let t=this.version;for(let n=0;n<12;n++)t=t<<1^(t>>>11)*7973;const r=this.version<<12|t;for(let n=0;n<18;n++){const i=Pi(r,n),s=this.size-11+n%3,o=Math.floor(n/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(t,r){for(let n=-4;n<=4;n++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(n)),o=t+i,a=r+n;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,Bs.Position)}}drawAlignmentPattern(t,r){for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++)this.setFunctionModule(t+i,r+n,Math.max(Math.abs(i),Math.abs(n))!==1,Bs.Alignment)}setFunctionModule(t,r,n,i=Bs.Function){this.modules[r][t]=n,this.types[r][t]=i}addEccAndInterleave(t){const r=this.version,n=this.ecc;if(t.length!==Tu(r,n))throw new RangeError("Invalid argument");const i=sv[n[0]][r],s=iv[n[0]][r],o=Math.floor(Cp(r)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=wF(s);for(let d=0,h=0;d<i;d++){const m=t.slice(h,h+c-s+(d<a?0:1));h+=m.length;const p=EF(m,u);d<a&&m.push(0),l.push(m.concat(p))}const f=[];for(let d=0;d<l[0].length;d++)l.forEach((h,m)=>{(d!==c-s||m>=a)&&f.push(h[d])});return f}drawCodewords(t){if(t.length!==Math.floor(Cp(this.version)/8))throw new RangeError("Invalid argument");let r=0;for(let n=this.size-1;n>=1;n-=2){n===6&&(n=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=n-s,c=(n+1&2)===0?this.size-1-i:i;!this.types[c][o]&&r<t.length*8&&(this.modules[c][o]=Pi(t[r>>>3],7-(r&7)),r++)}}}applyMask(t){if(t<0||t>7)throw new RangeError("Mask value out of range");for(let r=0;r<this.size;r++)for(let n=0;n<this.size;n++){let i;switch(t){case 0:i=(n+r)%2===0;break;case 1:i=r%2===0;break;case 2:i=n%3===0;break;case 3:i=(n+r)%3===0;break;case 4:i=(Math.floor(n/3)+Math.floor(r/2))%2===0;break;case 5:i=n*r%2+n*r%3===0;break;case 6:i=(n*r%2+n*r%3)%2===0;break;case 7:i=((n+r)%2+n*r%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[r][n]&&i&&(this.modules[r][n]=!this.modules[r][n])}}getPenaltyScore(){let t=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?t+=nv:a>5&&t++):(this.finderPenaltyAddHistory(a,c),o||(t+=this.finderPenaltyCountPatterns(c)*Au),o=this.modules[s][l],a=1);t+=this.finderPenaltyTerminateAndCount(o,a,c)*Au}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?t+=nv:a>5&&t++):(this.finderPenaltyAddHistory(a,c),o||(t+=this.finderPenaltyCountPatterns(c)*Au),o=this.modules[l][s],a=1);t+=this.finderPenaltyTerminateAndCount(o,a,c)*Au}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(t+=lF)}let r=0;for(const s of this.modules)r=s.reduce((o,a)=>o+(a?1:0),r);const n=this.size*this.size,i=Math.ceil(Math.abs(r*20-n*10)/n)-1;return t+=i*uF,t}getAlignmentPatternPositions(){if(this.version===1)return[];{const t=Math.floor(this.version/7)+2,r=this.version===32?26:Math.ceil((this.version*4+4)/(t*2-2))*2,n=[6];for(let i=this.size-7;n.length<t;i-=r)n.splice(1,0,i);return n}}finderPenaltyCountPatterns(t){const r=t[1],n=r>0&&t[2]===r&&t[3]===r*3&&t[4]===r&&t[5]===r;return(n&&t[0]>=r*4&&t[6]>=r?1:0)+(n&&t[6]>=r*4&&t[0]>=r?1:0)}finderPenaltyTerminateAndCount(t,r,n){return t&&(this.finderPenaltyAddHistory(r,n),r=0),r+=this.size,this.finderPenaltyAddHistory(r,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(t,r){r[0]===0&&(t+=this.size),r.pop(),r.unshift(t)}}function Ui(e,t,r){if(t<0||t>31||e>>>t)throw new RangeError("Value out of range");for(let n=t-1;n>=0;n--)r.push(e>>>n&1)}function Pi(e,t){return(e>>>t&1)!==0}class Np{constructor(t,r,n){if(this.mode=t,this.numChars=r,this.bitData=n,r<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}getData(){return this.bitData.slice()}}const fF=[1,10,12,14],dF=[2,9,11,13],pF=[4,8,16,16];function ov(e,t){return e[Math.floor((t+7)/17)+1]}function av(e){const t=[];for(const r of e)Ui(r,8,t);return new Np(pF,e.length,t)}function mF(e){if(!cv(e))throw new RangeError("String contains non-numeric characters");const t=[];for(let r=0;r<e.length;){const n=Math.min(e.length-r,3);Ui(Number.parseInt(e.substring(r,r+n),10),n*3+1,t),r+=n}return new Np(fF,e.length,t)}function gF(e){if(!lv(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");const t=[];let r;for(r=0;r+2<=e.length;r+=2){let n=Rp.indexOf(e.charAt(r))*45;n+=Rp.indexOf(e.charAt(r+1)),Ui(n,11,t)}return r<e.length&&Ui(Rp.indexOf(e.charAt(r)),6,t),new Np(dF,e.length,t)}function yF(e){return e===""?[]:cv(e)?[mF(e)]:lv(e)?[gF(e)]:[av(bF(e))]}function cv(e){return aF.test(e)}function lv(e){return cF.test(e)}function _F(e,t){let r=0;for(const n of e){const i=ov(n.mode,t);if(n.numChars>=1<<i)return Number.POSITIVE_INFINITY;r+=4+i+n.bitData.length}return r}function bF(e){e=encodeURI(e);const t=[];for(let r=0;r<e.length;r++)e.charAt(r)!=="%"?t.push(e.charCodeAt(r)):(t.push(Number.parseInt(e.substring(r+1,r+3),16)),r+=2);return t}function Cp(e){if(e<Op||e>Ip)throw new RangeError("Version number out of range");let t=(16*e+128)*e+64;if(e>=2){const r=Math.floor(e/7)+2;t-=(25*r-10)*r-55,e>=7&&(t-=36)}return t}function Tu(e,t){return Math.floor(Cp(e)/8)-iv[t[0]][e]*sv[t[0]][e]}function wF(e){if(e<1||e>255)throw new RangeError("Degree out of range");const t=[];for(let n=0;n<e-1;n++)t.push(0);t.push(1);let r=1;for(let n=0;n<e;n++){for(let i=0;i<t.length;i++)t[i]=Lp(t[i],r),i+1<t.length&&(t[i]^=t[i+1]);r=Lp(r,2)}return t}function EF(e,t){const r=t.map(n=>0);for(const n of e){const i=n^r.shift();r.push(0),t.forEach((s,o)=>r[o]^=Lp(s,i))}return r}function Lp(e,t){if(e>>>8||t>>>8)throw new RangeError("Byte out of range");let r=0;for(let n=7;n>=0;n--)r=r<<1^(r>>>7)*285,r^=(t>>>n&1)*e;return r}function kF(e,t,r=1,n=40,i=-1,s=!0){if(!(Op<=r&&r<=n&&n<=Ip)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=r;;o++){const f=Tu(o,t)*8,d=_F(e,o);if(d<=f){a=d;break}if(o>=n)throw new RangeError("Data too long")}for(const f of[tv,ev,rv])s&&a<=Tu(o,f)*8&&(t=f);const c=[];for(const f of e){Ui(f.mode[0],4,c),Ui(f.numChars,ov(f.mode,o),c);for(const d of f.getData())c.push(d)}const l=Tu(o,t)*8;Ui(0,Math.min(4,l-c.length),c),Ui(0,(8-c.length%8)%8,c);for(let f=236;c.length<l;f^=253)Ui(f,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((f,d)=>u[d>>>3]|=f<<7-(d&7)),new hF(o,t,u,i)}function vF(e,t){var f;const{ecc:r="L",boostEcc:n=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=t||{},c=typeof e=="string"?yF(e):Array.isArray(e)?[av(e)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof e}`);const l=kF(c,oF[r],i,s,o,n),u=xF({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return t!=null&&t.invert&&(u.data=u.data.map(d=>d.map(h=>!h))),(f=t==null?void 0:t.onEncoded)==null||f.call(t,u),u}function xF(e,t=1){if(!t)return e;const{size:r}=e,n=r+t*2;e.size=n,e.data.forEach(s=>{for(let o=0;o<t;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<t;s++)e.data.unshift(Array.from({length:n},o=>!1)),e.data.push(Array.from({length:n},o=>!1));const i=Bs.Border;e.types.forEach(s=>{for(let o=0;o<t;o++)s.unshift(i),s.push(i)});for(let s=0;s<t;s++)e.types.unshift(Array.from({length:n},o=>i)),e.types.push(Array.from({length:n},o=>i));return e}function AF(e,t,r,n=!1){return t<0||r<0||t>=e.length||r>=e.length?n:e[r][t]}function TF(e,t={}){const r={WHITE_ALL:"â",WHITE_BLACK:"â",BLACK_WHITE:"â",BLACK_ALL:" "},n=vF(e,t),i=!1,s=!0,o=(l,u)=>AF(n.data,l,u,!0),a=[];let c="";for(let l=0;l<n.size;l+=2){for(let u=0;u<n.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=r.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=r.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=r.BLACK_WHITE:c+=r.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const ns="$dkpurple",SF="$196",RF="$205",Qe="$yellow$205$205$205$196";function me(e,t,r){SA(e,t,r)}function OF(e,t,r){const n=SF.repeat(r);me(e,t,`${ns}${n}`)}function Mp(e,t,r){const n=RF.repeat(r);me(e,t,`${ns}${n}`)}function Up(e,t,r){me(e,t,`${ns} ${" ".repeat(r.length)} `),OF(e,t,r.length+2),me(e,t,`${ns} $white${r} `),Mp(e,t,r.length+2)}function Ds(e,t,r){me(e,t,`${ns} ${" ".repeat(r.length)} `),me(e,t,`${ns} $gray${r} `),Mp(e,t,r.length+2)}function js(e,t,r,n){me(e,t,`${ns} $white${r} $blue${n}`)}function Qr(e,t,r){me(e,t,`${ns}$blue${r}`)}function IF(e,t,r,n){me(e,t,`!${r};${n}`)}function NF(e,t,r,n,i=!0){if(i){const s=TF(r).split(`
`),o={32:32,9600:223,9604:220,9608:219};for(let a=0;a<s.length;a++){const c=[...s[a]].map(l=>`$${o[l.charCodeAt(0)]}`).join("");me(e,t,c)}}me(e,t,`!copyit ${r};${n}`),cT(e,t)}var CF=`desc;$DKGRAYname and type of codepage
`,LF=Object.freeze({__proto__:null,default:CF}),MF="desc;changes object into specified element",UF=Object.freeze({__proto__:null,default:MF}),PF="desc;like #play but for sound effects",$F=Object.freeze({__proto__:null,default:PF}),FF="",BF=Object.freeze({__proto__:null,default:FF}),DF="",jF=Object.freeze({__proto__:null,default:DF}),zF="",GF=Object.freeze({__proto__:null,default:zF}),WF="",HF=Object.freeze({__proto__:null,default:WF}),KF="",YF=Object.freeze({__proto__:null,default:KF}),VF="",qF=Object.freeze({__proto__:null,default:VF}),XF="",JF=Object.freeze({__proto__:null,default:XF}),ZF="",QF=Object.freeze({__proto__:null,default:ZF}),tB="",eB=Object.freeze({__proto__:null,default:tB}),rB="",nB=Object.freeze({__proto__:null,default:rB}),iB="",sB=Object.freeze({__proto__:null,default:iB}),oB="",aB=Object.freeze({__proto__:null,default:oB}),cB="",lB=Object.freeze({__proto__:null,default:cB}),uB="",hB=Object.freeze({__proto__:null,default:uB}),fB="",dB=Object.freeze({__proto__:null,default:fB}),pB=`desc;$DKGRAYstarts a section of an if-do-done block
`,mB=Object.freeze({__proto__:null,default:pB}),gB=`desc;$DKGRAYcompletes an if-do-done block
`,yB=Object.freeze({__proto__:null,default:gB}),_B="",bB=Object.freeze({__proto__:null,default:_B}),wB="",EB=Object.freeze({__proto__:null,default:wB}),kB="",vB=Object.freeze({__proto__:null,default:kB}),xB=`desc;$DKGRAYelse logic in an if-do-done block
`,AB=Object.freeze({__proto__:null,default:xB}),TB=`desc;$DKGRAYconditional else logic in an if-do-done block
`,SB=Object.freeze({__proto__:null,default:TB}),RB="",OB=Object.freeze({__proto__:null,default:RB}),IB="",NB=Object.freeze({__proto__:null,default:IB}),CB="",LB=Object.freeze({__proto__:null,default:CB}),MB="",UB=Object.freeze({__proto__:null,default:MB}),PB="",$B=Object.freeze({__proto__:null,default:PB}),FB="",BB=Object.freeze({__proto__:null,default:FB}),DB="",jB=Object.freeze({__proto__:null,default:DB}),zB="",GB=Object.freeze({__proto__:null,default:zB}),WB=`desc;$DKGRAYhalt until the next cycle
`,HB=Object.freeze({__proto__:null,default:WB}),KB=`desc;$DKGRAYevals condition for true or false
`,YB=Object.freeze({__proto__:null,default:KB}),VB="",qB=Object.freeze({__proto__:null,default:VB}),XB="",JB=Object.freeze({__proto__:null,default:XB}),ZB="",QB=Object.freeze({__proto__:null,default:ZB}),tD="",eD=Object.freeze({__proto__:null,default:tD}),rD="",nD=Object.freeze({__proto__:null,default:rD}),iD="",sD=Object.freeze({__proto__:null,default:iD}),oD="",aD=Object.freeze({__proto__:null,default:oD}),cD="",lD=Object.freeze({__proto__:null,default:cD}),uD="",hD=Object.freeze({__proto__:null,default:uD}),fD="",dD=Object.freeze({__proto__:null,default:fD}),pD="",mD=Object.freeze({__proto__:null,default:pD}),gD="",yD=Object.freeze({__proto__:null,default:gD}),_D="",bD=Object.freeze({__proto__:null,default:_D}),wD="",ED=Object.freeze({__proto__:null,default:wD}),kD="",vD=Object.freeze({__proto__:null,default:kD}),xD="",AD=Object.freeze({__proto__:null,default:xD}),TD="",SD=Object.freeze({__proto__:null,default:TD}),RD="",OD=Object.freeze({__proto__:null,default:RD}),ID="",ND=Object.freeze({__proto__:null,default:ID}),CD="",LD=Object.freeze({__proto__:null,default:CD}),MD="",UD=Object.freeze({__proto__:null,default:MD}),PD=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,$D=Object.freeze({__proto__:null,default:PD}),FD="",BD=Object.freeze({__proto__:null,default:FD}),DD="",jD=Object.freeze({__proto__:null,default:DD}),zD="",GD=Object.freeze({__proto__:null,default:zD}),WD="",HD=Object.freeze({__proto__:null,default:WD}),KD="",YD=Object.freeze({__proto__:null,default:KD}),VD="",qD=Object.freeze({__proto__:null,default:VD}),XD="",JD=Object.freeze({__proto__:null,default:XD}),ZD="",QD=Object.freeze({__proto__:null,default:ZD}),t4="",e4=Object.freeze({__proto__:null,default:t4}),r4="",n4=Object.freeze({__proto__:null,default:r4}),i4="",s4=Object.freeze({__proto__:null,default:i4}),o4="",a4=Object.freeze({__proto__:null,default:o4}),c4="",l4=Object.freeze({__proto__:null,default:c4}),u4="",h4=Object.freeze({__proto__:null,default:u4}),f4="",d4=Object.freeze({__proto__:null,default:f4}),p4="",m4=Object.freeze({__proto__:null,default:p4}),g4="",y4=Object.freeze({__proto__:null,default:g4}),_4="",b4=Object.freeze({__proto__:null,default:_4}),w4="",E4=Object.freeze({__proto__:null,default:w4}),k4=`desc;$DKGRAYdesignates an inactive label or comment
`,v4=Object.freeze({__proto__:null,default:k4}),x4=`desc;$DKGRAYadds hyperlink text

`,A4=Object.freeze({__proto__:null,default:x4}),T4=`desc;$DKGRAYsends the given message when hotkey is pressed

`,S4=Object.freeze({__proto__:null,default:T4}),R4=`desc;$DKGRAYread number input into given stat/flag
`,O4=Object.freeze({__proto__:null,default:R4}),I4=`desc;$DKGRAYa slider input from 1 to 9 

`,N4=Object.freeze({__proto__:null,default:I4}),C4=`desc;$DKGRAYlist with label value pairs to pick from
`,L4=Object.freeze({__proto__:null,default:C4}),M4=`desc;$DKGRAYread text input into given stat/flag
`,U4=Object.freeze({__proto__:null,default:M4}),P4=`desc;$DKGRAYdesignates a starting point for running code
`,$4=Object.freeze({__proto__:null,default:P4}),F4=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,B4=Object.freeze({__proto__:null,default:F4}),D4=`desc;$DKGRAYwill move the object in the given direction
`,j4=Object.freeze({__proto__:null,default:D4}),z4=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,G4=Object.freeze({__proto__:null,default:z4}),W4=`desc;$DKGRAYcustom 8x14 charset
`,H4=Object.freeze({__proto__:null,default:W4}),K4=`desc;$DKGRAYsets stat to given value

`,Y4=Object.freeze({__proto__:null,default:K4}),V4=`desc;$DKGRAYsends the given message when hotkey is pressed

`,q4=Object.freeze({__proto__:null,default:V4}),X4=`desc;$DKGRAYread external content and/or handle events
`,J4=Object.freeze({__proto__:null,default:X4}),Z4=`desc;$DKGRAYread number input into given stat/flag
`,Q4=Object.freeze({__proto__:null,default:Z4}),tj=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,ej=Object.freeze({__proto__:null,default:tj}),rj=`desc;$DKGRAYcustom palette colors
`,nj=Object.freeze({__proto__:null,default:rj}),ij=`desc;$DKGRAYa slider input from 1 to 9 

`,sj=Object.freeze({__proto__:null,default:ij}),oj=`desc;$DKGRAYlist with label value pairs to pick from
`,aj=Object.freeze({__proto__:null,default:oj}),cj=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,lj=Object.freeze({__proto__:null,default:cj}),uj=`desc;$DKGRAYread text input into given stat/flag
`,hj=Object.freeze({__proto__:null,default:uj}),fj=`desc;$DKGRAYadds text
`,dj=Object.freeze({__proto__:null,default:fj}),pj=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,mj=Object.freeze({__proto__:null,default:pj}),gj=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,yj=Object.freeze({__proto__:null,default:gj}),_j=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,bj=Object.freeze({__proto__:null,default:_j}),wj=`header;player settings
#set user "name goes here"
`,Ej=Object.freeze({__proto__:null,default:wj}),kj=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,vj=Object.freeze({__proto__:null,default:kj});const uv=Object.assign({"./editor/codepagename.txt":LF,"./editor/command/become.txt":UF,"./editor/command/bgplay.txt":$F,"./editor/command/bgvol.txt":BF,"./editor/command/bind.txt":jF,"./editor/command/board.txt":GF,"./editor/command/bpm.txt":HF,"./editor/command/break.txt":YF,"./editor/command/change.txt":qF,"./editor/command/char.txt":JF,"./editor/command/charset.txt":QF,"./editor/command/clear.txt":eB,"./editor/command/color.txt":nB,"./editor/command/continue.txt":sB,"./editor/command/copy.txt":aB,"./editor/command/cycle.txt":lB,"./editor/command/die.txt":hB,"./editor/command/distort.txt":dB,"./editor/command/do.txt":mB,"./editor/command/done.txt":yB,"./editor/command/duplicate.txt":bB,"./editor/command/echo.txt":EB,"./editor/command/edge.txt":vB,"./editor/command/else.txt":AB,"./editor/command/elseif.txt":SB,"./editor/command/end.txt":OB,"./editor/command/endgame.txt":NB,"./editor/command/endwith.txt":LB,"./editor/command/fcrush.txt":UB,"./editor/command/fetch.txt":$B,"./editor/command/fetchwith.txt":BB,"./editor/command/foreach.txt":jB,"./editor/command/go.txt":GB,"./editor/command/idle.txt":HB,"./editor/command/if.txt":YB,"./editor/command/lock.txt":qB,"./editor/command/oneof.txt":JB,"./editor/command/oneofwith.txt":QB,"./editor/command/palette.txt":eD,"./editor/command/phaser.txt":nD,"./editor/command/pivot.txt":sD,"./editor/command/play.txt":aD,"./editor/command/put.txt":lD,"./editor/command/putwith.txt":hD,"./editor/command/readbin.txt":dD,"./editor/command/readjson.txt":mD,"./editor/command/readline.txt":yD,"./editor/command/readrexpaint.txt":bD,"./editor/command/remix.txt":ED,"./editor/command/repeat.txt":vD,"./editor/command/restore.txt":AD,"./editor/command/reverb.txt":SD,"./editor/command/revert.txt":OD,"./editor/command/run.txt":ND,"./editor/command/runwith.txt":LD,"./editor/command/set.txt":UD,"./editor/command/shoot.txt":$D,"./editor/command/shootwith.txt":BD,"./editor/command/shove.txt":jD,"./editor/command/snapshot.txt":GD,"./editor/command/synth.txt":HD,"./editor/command/toast.txt":YD,"./editor/command/tts.txt":qD,"./editor/command/ttsvol.txt":JD,"./editor/command/twitchbroadcast.txt":QD,"./editor/command/twitchchat.txt":e4,"./editor/command/unlock.txt":n4,"./editor/command/vibrato.txt":s4,"./editor/command/vol.txt":a4,"./editor/command/waitfor.txt":l4,"./editor/command/walk.txt":h4,"./editor/command/weave.txt":d4,"./editor/command/while.txt":m4,"./editor/command/with.txt":y4,"./editor/command/write.txt":b4,"./editor/command/zap.txt":E4,"./editor/comment.txt":v4,"./editor/hyperlink.txt":A4,"./editor/hyperlink/hotkey.txt":S4,"./editor/hyperlink/number.txt":O4,"./editor/hyperlink/range.txt":N4,"./editor/hyperlink/select.txt":L4,"./editor/hyperlink/text.txt":U4,"./editor/label.txt":$4,"./editor/shortgo.txt":B4,"./editor/shorttry.txt":j4,"./editor/stat/board.txt":G4,"./editor/stat/charset.txt":H4,"./editor/stat/const.txt":Y4,"./editor/stat/hotkey.txt":q4,"./editor/stat/loader.txt":J4,"./editor/stat/number.txt":Q4,"./editor/stat/object.txt":ej,"./editor/stat/palette.txt":nj,"./editor/stat/range.txt":sj,"./editor/stat/select.txt":aj,"./editor/stat/terrain.txt":lj,"./editor/stat/text.txt":hj,"./editor/text.txt":dj,"./help/controls.txt":mj,"./help/developer.txt":yj,"./help/menu.txt":bj,"./help/player.txt":Ej,"./help/text.txt":vj}),hv={};on(uv).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");hv[t]=uv[e].default});function xj(e){const t=It(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),r=hv[t];if(y(r))return r;const{target:n,path:i}=zr(t);switch(n){case"editor":{const s=zr(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function Aj(e,t){const r=(e??"").split(`
`);for(let n=0;n<r.length;++n)t(r[n].split(";"))}function Tj(e,t){const[r,...n]=t,i=n[0]??"",s=n[1]??"";switch(It(r.trim())){case"header":Up(Z,e,i);break;case"section":Ds(Z,e,i);break;case"option":js(Z,e,i,s);break;default:r.trimStart().startsWith("!")?IF(Z,e,r.trimStart().slice(1),i):me(Z,e,r);break}}function $i(e){const[t,r]=nt(e,0,[H.ANY,H.ANY]);if(It(t)==="send"&&Wr(r)){const[,n,i,s]=nt(e,0,[H.NAME,H.DIR,H.MAYBE_NAME]);return pt(i)&&i.startsWith(":")?{targetdir:n,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:n,label:e.slice(s-1).join(" ")}}else if(pt(t)){const[n,i,s]=nt(e,0,[H.NAME,H.MAYBE_NAME]);if(pt(i)&&i.startsWith(":")){const a=[i.substring(1).trim(),...e.slice(s)];return{targetname:n,label:a.join(" ")}}return{targetname:"self",label:[n,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function zs(){L0(Z,$r())}function ec(e){Aj(xj(`help:${e}`),t=>Tj(E.elementfocus,t))}function fv(e){switch(e.label){case"helpmenu":ec("menu");break;case"helpcontrols":ec("controls");break;case"helptext":ec("text");break;case"helpdeveloper":ec("developer");break;case"helpplayer":ec("player");break;default:{const t=ue(Dt.MAIN),r=Do(t);y(e.targetname)?Vo(e.targetname,e.label,void 0,r):y(e.targetdir)&&Vo(e.targetdir.destpt,e.label,void 0,r);break}}}const Sj=Ti().command("shortsend",(e,t)=>{const r=$i(t);return fv(r),0}).command("send",(e,t)=>{const r=$i(["send",...t]);return fv(r),0}).command("stat",(e,t)=>{const[r,...n]=t.map(Se),i=n.join(" ");function s(o,a){if(y(o)&&(e.command("pageopen",o.id),a)){const c=pe(o),l=pi(o);me(Z,E.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(It(r)){case dn(Rt.LOADER):{const[o,a]=as(Dt.MAIN,i,bt.LOADER);s(o,a);break}default:{const[o,a]=as(Dt.MAIN,[r,...n].join(" "),bt.OBJECT);s(o,a);break}case dn(Rt.BOARD):{const[o,a]=as(Dt.MAIN,i,bt.BOARD);s(o,a);break}case dn(Rt.OBJECT):{const[o,a]=as(Dt.MAIN,i,bt.OBJECT);s(o,a);break}case dn(Rt.TERRAIN):{const[o,a]=as(Dt.MAIN,i,bt.TERRAIN);s(o,a);break}case dn(Rt.CHARSET):{const[o,a]=as(Dt.MAIN,i,bt.CHARSET);s(o,a);break}case dn(Rt.PALETTE):{const[o,a]=as(Dt.MAIN,i,bt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const r=t.map(Se).join(" ");if(y(E.element)&&E.elementisplayer){const{user:n}=Nn(E.elementid),i=pt(n)?n:"player";E.element.tickertext=`${i}: ${r}`,E.element.tickertime=E.timestamp;const s=yr(E.element);Ae(Z,E.elementid,`$${Lt[s.color]}$ON${Lt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${r}`),gh(Z,E.elementid,void 0,"text","chat:message:game",`${i}:${r}`)}return 0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Se(r),s=$i(n);if(y(s.targetname)){const{user:o}=Nn(E.elementid),a=pt(o)?o:"player",c=yr(E.element),l=`$${Lt[c.color]}$ON${Lt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;Ae(Z,E.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[r,n]=nt(t,0,[H.MAYBE_NAME,H.MAYBE_STRING]);return pt(r)&&pt(n)?O0(Z,E.elementfocus,r,n):oT(Z,E.elementfocus),0}).command("bookcreate",(e,t)=>{const[r]=nt(t,0,[H.MAYBE_NAME]),n=ix(r);return y(n)&&e.command("bookopen",n.id),0}).command("bookopen",(e,t)=>{const[r]=nt(t,0,[H.NAME]),n=Hn(r);return y(n)?(O0(Z,E.elementfocus,"selected",n.id),zs()):de(Z,E.elementfocus,"bookopen",`book ${r} not found`),0}).command("booktrash",(e,t)=>{const[r]=nt(t,0,[H.NAME]),n=ue(Dt.MAIN),i=Hn(r);return y(i)&&(n===i&&nx(Dt.MAIN,""),kz(r),Ae(Z,E.elementfocus,`trashed [book] ${i.name}`),zs(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[r]=nt(t,0,[H.NAME]),n=ar(r);return y(n)&&Bo(E.book,E.elementfocus,n.id,{x:_n(0,Tt-1),y:_n(0,Yt-1)},!0),0}).command("pageopen",(e,t)=>{const[r,n]=nt(t,0,[H.NAME,H.MAYBE_NAME]);let i,s;const o=Rn();for(let a=0;a<o.length&&(s=o[a],i=$s(s,r),!y(i));++a);if(y(i)&&y(s)){const a=pe(i),c=pi(i);Ae(Z,E.elementfocus,`opened [${c}] ${a}`);const l=[i.id,n];pf(bc(s.id,l),i.code);const u=pi(i);I0(Z,E.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else de(Z,"pageopen",`page ${r} not found`,E.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[r]=nt(t,0,[H.NAME]),n=_r(Dt.MAIN),i=Bk(n,r);if(y(r)){const s=pe(i),o=pi(i);Ae(Z,E.elementfocus,`trashed [${o}] ${s}`),zs(),e.command("pages")}return 0}).command("help",(e,t)=>{const r=t.map(Se).join(" ")||"menu";return e.command(`help${r}`),0}).command("books",()=>{Ds(Z,E.elementfocus,"books");const e=ue(Dt.MAIN);js(Z,E.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ue(Dt.MAIN);js(Z,E.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Mp(Z,E.elementfocus,7);const r=Rn();return r.length?r.forEach(n=>{me(Z,E.elementfocus,`!bookopen ${n.id};${n.name}`)}):Qr(Z,E.elementfocus,"no books found"),me(Z,E.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=_r(Dt.MAIN);if(!y(e))return 0;Ds(Z,E.elementfocus,"pages"),js(Z,E.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Za(e).forEach(n=>{const i=pe(n),s=pi(n);me(Z,E.elementfocus,`!pageopen ${n.id};$blue[${s}]$white ${i}`)}):(me(Z,E.elementfocus,""),Qr(Z,E.elementfocus,"$white no pages found"),Qr(Z,E.elementfocus,"$white use @ to create a page"),Qr(Z,E.elementfocus,"$white @board name of board"),Qr(Z,E.elementfocus,"$white @object name of object"),Qr(Z,E.elementfocus,"$white @terrain name of terrain"),Qr(Z,E.elementfocus,"$white You can omit the type and it will default to object"),Qr(Z,E.elementfocus,"$white @object name of object"),Qr(Z,E.elementfocus,"$white @name of object"));const t=Rn();for(let r=0;r<t.length;++r){const n=t[r];n.id!==e.id&&(js(Z,E.elementfocus,"content",`${n.name} $GREEN${n.id}`),Za(n).forEach(s=>{const o=pe(s),a=pi(s);me(Z,E.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Ds(Z,E.elementfocus,"boards");const e=_r(Dt.MAIN);if(y(e)){js(Z,E.elementfocus,"main",`${e.name} $GREEN${e.id}`);const r=Za(e);r.filter(n=>di(n)===bt.BOARD).forEach(n=>{const i=pe(n);me(Z,E.elementfocus,`!boardopen ${n.id};$blue[#goto]$white ${i}`)}),r.length===0&&(me(Z,E.elementfocus,""),Qr(Z,E.elementfocus,"$white no boards found"),Qr(Z,E.elementfocus,"$white use @ to create a board"),Qr(Z,E.elementfocus,"$white @board name of board"))}const t=Rn();for(let r=0;r<t.length;++r){const n=t[r];n.id!==e.id&&(js(Z,E.elementfocus,"content",`${n.name} $GREEN${n.id}`),Za(n).filter(s=>di(s)===bt.BOARD).forEach(s=>{const o=pe(s);me(Z,E.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{Ds(Z,E.elementfocus,"$REDTRASH"),Qr(Z,E.elementfocus,"books");const e=Rn();e.length&&(e.forEach(r=>{me(Z,E.elementfocus,`!booktrash ${r.id};$REDTRASH ${r.name}`)}),me(Z,E.elementfocus,""));const t=ue(Dt.MAIN);return y(t)&&(Qr(Z,E.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(r=>{const n=pe(r);me(Z,E.elementfocus,`!pagetrash ${r.id};$REDTRASH ${n}`)}),me(Z,E.elementfocus,"")),0}).command("dev",()=>(zs(),VA(Z,E.elementfocus),0)).command("share",()=>(zs(),qA(Z,E.elementfocus),0)).command("save",()=>(zs(),0)).command("fork",()=>(mT(Z,E.elementfocus),0)).command("itchiopublish",()=>(gT(Z,E.elementfocus),0)).command("nuke",()=>(XA(Z,E.elementfocus),0)).command("restart",()=>(pT(Z,E.elementfocus),zs(),0)).command("export",()=>{Up(Z,E.elementfocus,"E X P O R T"),Ds(Z,E.elementfocus,"books");const e=Rn();return e.length&&e.forEach(t=>me(Z,E.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[r]=nt(t,0,[H.NAME]),n=Hn(r);return y(n)&&(Up(Z,E.elementfocus,"E X P O R T"),Ds(Z,E.elementfocus,"pages"),setTimeout(()=>{if(n.pages.length){const i=Za(n);me(Z,E.elementfocus,`!bookallexport ${r};$blue[all]$white export book`),i.forEach(s=>{const o=pe(s),a=pi(s);me(Z,E.elementfocus,`!pageexport ${r}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[r]=nt(t,0,[H.NAME]),n=Hn(r);return y(n)&&S0(Z,E.elementfocus,Yn(n),`${n.name}.book.json`),0}).command("pageexport",(e,t)=>{const[r]=nt(t,0,[H.NAME]),{target:n,path:i}=zr(r),s=Hn(n),o=$s(s,i);return y(o)&&S0(Z,E.elementfocus,Yn(o),`${pe(o)}.${pi(o)}.json`),0}).command("gadget",()=>(aT(Z,E.elementfocus),0)).command("zztsearch",(e,t)=>{const[r,n]=nt(t,0,[H.NAME,H.MAYBE_NAME]),i=y(n)?r:"title",s=y(n)?n:r;return lT(Z,E.elementfocus,i,s),0}).command("zztrandom",()=>(uT(Z,E.elementfocus),0)).command("joincode",(e,t)=>{const[r]=nt(t,0,[H.MAYBE_NAME]);return $A(Z,E.elementfocus,!!r),0}).command("jointab",(e,t)=>{const[r]=nt(t,0,[H.MAYBE_NAME]);return FA(Z,E.elementfocus,!!r),0}).command("startlookingglass",()=>(JA(Z,E.elementfocus),0)),Rj=Ti().command("toast",(e,t)=>{const r=t.map(Se).join("");return _c(Z,E.elementfocus,r),0}).command("ticker",(e,t)=>{const r=t.map(Se).join("");return y(E.element)&&(E.element.tickertext=r,E.element.tickertime=E.timestamp),0}).command("palette",(e,t)=>{const[r]=nt(t,0,[H.NAME]),n=ox(),i=sr(E.book,bt.PALETTE,r);return y(i)?(n.palette=i.id,Ae(Z,E.elementfocus,`loaded palette ${r}`)):de(Z,E.elementfocus,"not-found",`unabled to find palette ${r}`),0}).command("charset",(e,t)=>{const[r]=nt(t,0,[H.NAME]),n=ox(),i=sr(E.book,bt.CHARSET,r);return y(i)?(n.charset=i.id,Ae(Z,E.elementfocus,`loaded charset ${r}`)):de(Z,E.elementfocus,"not-found",`unabled to find charset ${r}`),0}),Pp={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Mt.ISSOLID,Mt.ISWALK,Mt.ISSWIM,Mt.ISBULLET,Mt.ISGHOST,Mt.ISWALK,Mt.ISSWIM;function Su(e){return ce(e)&&$p(e[0])}function $p(e){return y(Mt[e])&&pt(e)}function Oj(e){if(pt(e))return Pp[It(e)]}function Ij(e){const t=E.words[e];if(Su(t))return[t,e+1];if($p(t))return[[t],e+1];const[r,n]=Ur(e);return Su(r)?[r,n]:$p(r)?[[r],n]:[void 0,e]}function jo(e,t=0){const r=[];let n=e;for(;n<E.words.length;){const[i,s]=Ur(n);if(ce(i)&&!Wr(i)&&!rc(i)&&!Su(i)&&!Ir(i)&&r.push(...i),i==="|")return[r,s];if(n=s,r.push(i),t>0&&r.length>=t)return[r,n]}return[r,n]}function Ur(e){var n,i,s,o,a,c,l,u,f;const t=E.words[e],r=e+1;if(pv(t)){const[d,h]=Nj(e);if(y(d))return[d,h]}if(Oj(t)){const[d,h]=Ij(e);if(y(d))return[d,h]}if(ba(t)){const[d,h]=rl(e);if(y(d))return[d,h]}if(pt(t)&&It(t)==="rnd"){const[d,h]=Ur(r),[m,p]=Ur(h);return wt(d)&&wt(m)?[_n(d,m),p]:wt(d)?[_n(0,d),h]:[_n(0,1),r]}if(Zc(t)){const[d,h]=Hg(e);if(y(d))return[d,h]}if(!y(t))return[void 0,e];if(wt(t)||ce(t))return[t,r];if(pt(t)){const d=It(t),h=(n=E.get)==null?void 0:n.call(E,t);if(y(h))return[h,r];switch(d){case"aligned":case"alligned":{const m=hc(E.board,{x:((i=E.element)==null?void 0:i.x)??-1,y:((s=E.element)==null?void 0:s.y)??-1},E.elementfocus);return!y(E.element)||!y(m)?[0,r]:[E.element.x===m.x||E.element.y===m.y?1:0,r]}case"contact":{const m=hc(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus);if(!y(E.element)||!y(m))return[0,r];const p=(m.x??0)-(((c=E.element)==null?void 0:c.x)??0),_=(m.y??0)-(((l=E.element)==null?void 0:l.y)??0);return[p===0&&Math.abs(_)<2||_===0&&Math.abs(p)<2?1:0,r]}case"blocked":{const[m,p]=nt(E.words,r,[H.DIR]);return[U$(E.board,E.element,m.destpt)?1:0,p]}case"any":{const[m]=nt(E.words,r,[H.ANY]);if(Wr(m)){const[v,A,T]=nt(E.words,r,[H.DIR,H.COLOR_OR_KIND]),I=v.layer===yt.MID?se(E.board,v.destpt):ls(E.board,v.destpt.x,v.destpt.y);if(y(I)){const S=yr(I);if(Ir(A))return[tl(A)===S.color||el(A)===S.bg?[I]:[],T];const C=It(lc(A)),P=Wu(A);if((C.length&&C!==S.name||y(P)&&P!==S.color)===!1)return[[I],T]}return[[],T]}const[p,_]=nt(E.words,r,[H.COLOR_OR_KIND]);return Ir(p)?[fx(E.board,p),_]:[Hu(E.board,p),_]}case"countof":{const[m]=nt(E.words,r,[H.ANY]);if(Wr(m)){const[v,A,T]=nt(E.words,r,[H.DIR,H.COLOR_OR_KIND]),I=v.layer===yt.MID?se(E.board,v.destpt):ls(E.board,v.destpt.x,v.destpt.y);if(y(I)){const S=yr(I);if(Ir(A))return[tl(A)===S.color||el(A)===S.bg?1:0,T];const C=It(lc(A)),P=Wu(A),N=C.length?C===S.name:!0,z=y(P)?P===S.color:!0;if(N&&z)return[1,T]}return[0,T]}const[p,_]=nt(E.words,r,[H.COLOR_OR_KIND]);return Ir(p)?[fx(E.board,p).length,_]:[Hu(E.board,p).length,_]}case"rnd":return[_n(0,1),r];case"abs":{const[m,p]=nt(E.words,r,[H.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=nt(E.words,r,[H.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=nt(E.words,r,[H.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=nt(E.words,r,[H.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,_,w]=nt(E.words,r,[H.NUMBER,H.NUMBER,H.NUMBER]);return[Ke(m,p,_),w]}case"min":{const[m,p]=jo(r);return[Math.min(...m),p]}case"max":{const[m,p]=jo(r);return[Math.max(...m),p]}case"pick":{const[m,p]=jo(r);return[bn(m),p]}case"pickwith":{const[m,p]=nt(E.words,r,[H.NUMBER_OR_STRING]),[_,w]=jo(p);return[IO(`${m}`,_),w]}case"random":{const[m,p]=jo(r,2),[_,w]=m;return[_n(_,w??0),p]}case"randomwith":{const[m,p]=nt(E.words,r,[H.NUMBER_OR_STRING]),[_,w]=jo(p,2),[v,A]=_;return[Dg(`${m}`,v,A??0),w]}case"run":{const[m,p]=nt(E.words,r,[H.NAME]);return Gu(m),[(u=E.get)==null?void 0:u.call(E,"arg"),p]}case"runwith":{const[m,p,_]=nt(E.words,r,[H.ANY,H.NAME]);return y(E.element)&&(E.element.arg=m),Gu(p),[(f=E.get)==null?void 0:f.call(E,"arg"),_]}}}return[t,r]}const Fp={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function rc(e){return ce(e)&&dv(e[0])}function dv(e){return y(jr[e])&&pt(e)}function pv(e){if(pt(e))return Fp[It(e)]}function mv(e){if(rc(e))return e;if(dv(e))return[e];const t=pv(e);if(y(t))return[t]}function Nj(e){const t=E.words[e],r=mv(t);if(rc(r))return[r,e+1];const[n,i]=Ur(e),s=mv(n);return rc(s)?[s,i]:[void 0,e]}const Cj=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),gv=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"]),Lj=["NORTH","SOUTH","WEST","EAST"];function Mj(e){const t=Nn(e);if(wt(t.inputcurrent)||(t.inputcurrent=0),ce(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[r]=t.inputqueue,[n=Nr.NONE,i=0]=r??[Nr.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&YO?1:0,t.inputctrl=i&VO?1:0,t.inputshift=i&qO?1:0,n){case Nr.MOVE_UP:case Nr.MOVE_DOWN:case Nr.MOVE_LEFT:case Nr.MOVE_RIGHT:t.inputmove=[Lj[n-Nr.MOVE_UP]];break;case Nr.OK_BUTTON:t.inputok=1;break;case Nr.CANCEL_BUTTON:t.inputcancel=1;break;case Nr.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=n,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Nr.NONE&&o!==n}),t}function Uj(e){const t=Fp[e];if(y(t))return t;const r=Pp[e];if(y(r))return r;const n=_a[e];if(y(n))return n;const i=kf[e];if(y(i))return i}function yv(){var t,r;if(Or(E.board,E.element,E.timestamp),!!zt(E.element,"item")){const n={x:((t=E.element)==null?void 0:t.x)??-1,y:((r=E.element)==null?void 0:r.y)??-1},i=hc(E.board,n,E.elementfocus);y(i)&&(i.x=n.x,i.y=n.y)}}const Pj=Ti({get(e,t){var l,u,f,d,h,m,p,_,w,v,A,T,I,S,C,P,N,z,J,M,O,k;const r=Uj(t);if(y(r))return[!0,r];if(E.elementisplayer&&Cj.has(t)){const L=Mj(E.elementid)[t];return[y(L),L]}const n=hc(E.board,{x:((l=E.element)==null?void 0:l.x)??-1,y:((u=E.element)==null?void 0:u.y)??-1},E.elementfocus),i=(n==null?void 0:n.id)??E.elementfocus??$r(),s=(f=E.element)==null?void 0:f.sender,o=yx(E.board,pt(s)?s:""),a=(o==null?void 0:o.id)??"";switch(t){case"camera":case"graphics":case"facing":if(y((d=E.board)==null?void 0:d[t]))return[!0,(h=E.board)==null?void 0:h[t]];break;case"isdark":return[!0,(m=E.board)!=null&&m.isdark?1:0];case"startx":return[!0,((p=E.board)==null?void 0:p.startx)??0];case"starty":return[!0,((_=E.board)==null?void 0:_.starty)??0];case"over":return[!0,((w=E.board)==null?void 0:w.over)??""];case"under":return[!0,((v=E.board)==null?void 0:v.under)??""];case"exitnorth":return[!0,((A=E.board)==null?void 0:A.exitnorth)??""];case"exitsouth":return[!0,((T=E.board)==null?void 0:T.exitsouth)??""];case"exitwest":return[!0,((I=E.board)==null?void 0:I.exitwest)??""];case"exiteast":return[!0,((S=E.board)==null?void 0:S.exiteast)??""];case"timelimit":return[!0,((C=E.board)==null?void 0:C.timelimit)??0];case"restartonzap":return[!0,((P=E.board)==null?void 0:P.restartonzap)??0];case"maxplayershots":return[!0,((N=E.board)==null?void 0:N.maxplayershots)??0];case"currenttick":return[!0,E.timestamp];case"boardid":return[!0,((z=E.board)==null?void 0:z.id)??""];case"playerid":return[!0,i];case"playerx":return[!0,(n==null?void 0:n.x)??-1];case"playery":return[!0,(n==null?void 0:n.y)??-1];case"thisid":return[!0,((J=E.element)==null?void 0:J.id)??""];case"thisx":return[!0,((M=E.element)==null?void 0:M.x)??-1];case"thisy":return[!0,((O=E.element)==null?void 0:O.y)??-1];case"senderid":return[!0,a];case"senderx":return[!0,(o==null?void 0:o.x)??-1];case"sendery":return[!0,(o==null?void 0:o.y)??-1];default:{if(gv.has(t))return[!0,((k=E.element)==null?void 0:k[t])??0];break}}const c=Nn(i)[t];return[y(c),c]},set(e,t,r){var o,a;const n=hc(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus),i=(n==null?void 0:n.id)??E.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(y(E.board))return E.board.isdark=r?1:0,[!0,E.board.isdark];break;case"startx":if(y(E.board))return E.board.startx=Ea(r,0),[!0,E.board.startx];break;case"starty":if(y(E.board))return E.board.starty=Ea(r,0),[!0,E.board.starty];break;case"over":if(y(E.board))return E.board.over=Se(r),[!0,E.board.over];break;case"under":if(y(E.board))return[!0,E.board.under=Se(r)];break;case"exitnorth":if(y(E.board))return[!0,E.board.exitnorth=Se(r)];break;case"exitsouth":if(y(E.board))return[!0,E.board.exitsouth=Se(r)];break;case"exitwest":if(y(E.board))return[!0,E.board.exitwest=Se(r)];break;case"exiteast":if(y(E.board))return[!0,E.board.exiteast=Se(r)];break;case"timelimit":if(y(E.board))return[!0,E.board.timelimit=Ea(r,0)];break;case"restartonzap":if(y(E.board))return[!0,E.board.restartonzap=r?1:0];break;case"maxplayershots":if(y(E.board))return[!0,E.board.maxplayershots=Ea(r,0)];break;case"currenttick":return[!1,r];case"boardid":return[!1,r];case"playerid":return[!1,r];case"playerx":return[!1,r];case"playery":return[!1,r];case"thisid":return[!1,r];case"thisx":return[!1,r];case"thisy":return[!1,r];case"senderid":return[!1,r];case"senderx":return[!1,r];case"sendery":return[!1,r];default:{if(gv.has(t))return y(E.element)&&(E.element[t]=r),[!0,r];break}}const s=Nn(i);return y(s)?(s[t]=r,[!0,r]):[!1,r]},everytick(){var e,t,r,n,i;if(!((e=E.element)!=null&&e.removed)&&(y((t=E.element)==null?void 0:t.stepx)||y((r=E.element)==null?void 0:r.stepy))){const s={x:((n=E.element)==null?void 0:n.x)??0,y:((i=E.element)==null?void 0:i.y)??0};cs(E.book,E.board,E.element,{x:s.x+(E.element.stepx??0),y:s.y+(E.element.stepy??0)})===!1&&zt(E.element,"breakable")&&Or(E.board,E.element,E.timestamp)}}}).command("clear",(e,t)=>{for(let r=0;r<t.length;++r)e.set(Se(t[r]),0);return 0}).command("set",(e,t)=>{const[r,n]=nt(t,0,[H.NAME,H.ANY]);return e.set(r,n??1),0}).command("become",(e,t)=>{var c,l;const[r]=nt(t,0,[H.KIND]);Ie(E.board);const n=yr(E.element),[i,s]=r,o=[...Qc(n.color,n.bg),...s??[]],a=[i,o];if(_p(E.board,E.element),Or(E.board,E.element,E.timestamp)){const u={x:((c=E.element)==null?void 0:c.x)??0,y:((l=E.element)==null?void 0:l.y)??0};In(E.board,a,u)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[r]=nt(t,0,[H.ANY]);if(Wr(r)){const[n,i]=nt(t,0,[H.DIR,H.NUMBER]),s=se(E.board,n.destpt);y(s)&&(s.char=i)}else y(E.element)&&wt(r)&&(E.element.char=r);return 0}).command("color",(e,t)=>{const[r]=nt(t,0,[H.ANY]);if(Wr(r)){const[n,i]=nt(t,0,[H.DIR,H.COLOR]),s=se(E.board,n.destpt);y(s)&&Ia(E.element,i)}else{const[n]=nt(t,0,[H.COLOR]);y(E.element)&&y(n)&&Ia(E.element,n)}return 0}).command("go",(e,t)=>{if(y(E.element)){const[r]=nt(t,0,[H.DIR]);if(cs(E.book,E.board,E.element,r.destpt),e.yield(),E.element.x===r.destpt.x&&E.element.y===r.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!y(E.element))return 0;const[r]=nt(t,0,[H.DIR]),n=E.element.x??0,i=E.element.y??0;return E.element.stepx=r.destpt.x-n,E.element.stepy=r.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[r]=nt(t,0,[H.ANY]);return e.set("arg",r),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Se(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Se(t[0])),0)).command("cycle",(e,t)=>{if(y(E.element)){const[r]=nt(t,0,[H.NUMBER]);E.element.cycle=Ke(Math.round(r),1,255)}return 0}).command("die",e=>(yv(),e.endofprogram(),0)).command("dieonend",()=>(yv(),0)).command("endgame",()=>(N0(Z,E.elementfocus),0)).command("run",(e,t)=>{const[r]=nt(t,0,[H.NAME]);return Gu(r),0}).command("runwith",(e,t)=>{const[r,n]=nt(t,0,[H.ANY,H.NAME]);return e.set("arg",r),Gu(n),0}),Ru={};function $j(e){var t;return(t=Ru[e])==null?void 0:t.arg}function Fj(e){var t;return(t=Ru[e])==null?void 0:t.format}function zo(e){var t;return(t=Ru[e])==null?void 0:t.content}function _v(e,t,r,n,i){const s=ue(Dt.MAIN);if(!y(s))return;const o=Fs(s,bt.LOADER).filter(a=>{const c=Ps(a),l=c.format,u=pt(l)?new RegExp(l).test(t):!1,f=c.event,d=pt(f)?new RegExp(f).test(r):!1;return pt(l)&&pt(f)?u&&d:pt(l)?u:pt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${We()}_loader`;Ru[c]={arg:e,format:t,content:n,player:i},Sz(c,o[a].code)}}function bv(e,t){if(!y(e))return;const r=It(t),n=r.endsWith("le");switch(r){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,n);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,n);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,n);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,n);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,n);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,n);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,n);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,n);return e.cursor+=8,i}}}const Bj=(e,t)=>{const r=zo(e.id());if(!y(r))return 0;const[n,i]=nt(t,0,[H.NAME]),s=It(n);switch(s){case"seek":{const[o]=nt(t,i,[H.NUMBER]);r.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=nt(t,i,[H.NAME]);e.set(o,bv(r,s));break}case"text":{const[o,a]=nt(t,i,[H.NAME,H.NAME]),c=bv(r,o);if(wt(c)&&pt(a)){const l=new Uint8Array(r.bytes.buffer,r.cursor,c),f=new TextDecoder("utf-8").decode(l);e.set(a,f),r.cursor+=c}break}case"palette":{const[o]=nt(t,i,[H.NAME]),[a]=yp(E.book,bt.PALETTE,o),c=Oe(a);if(y(c)){const l=DO*nl,u=S_(new Uint8Array(r.bytes.buffer,r.cursor,l));y(u)&&(c.bits=u.bits),r.cursor+=l}break}case"charset":{const[o]=nt(t,i,[H.NAME]),[a]=yp(E.book,bt.CHARSET,o),c=Oe(a);if(y(c)){const l=il*BO*Tf,u=R_(new Uint8Array(r.bytes.buffer,r.cursor,l));y(u)&&(c.bits=u.bits),r.cursor+=l}break}}return 0},Go=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Ou=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(!Ou(e[r],t[r]))return!1;return!0}if(Go(e)&&Go(t)){const r=Object.entries(e),n=new Set(Object.keys(t));if(r.length!==n.size)return!1;for(const[i,s]of r){if(!Ou(s,t[i]))return!1;n.delete(i)}return n.size===0}return!1},Iu=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(Go(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},Dj=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",wv=e=>e>="0"&&e<="9"||e==="-",jj=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var X;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(X||(X={}));const Ev={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},zj={"!":!0,"<":!0,"=":!0,">":!0},Gj={"	":!0,"\n":!0,"\r":!0," ":!0};class Wj{constructor(){this._current=0}tokenize(t){const r=[];this._current=0;let n,i,s;for(;this._current<t.length;)if(Dj(t[this._current]))n=this._current,i=this.consumeUnquotedIdentifier(t),r.push({start:n,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Ev[t[this._current]]!==void 0)r.push({start:this._current,type:Ev[t[this._current]],value:t[this._current]}),this._current+=1;else if(wv(t[this._current]))s=this.consumeNumber(t),r.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),r.push(s);else if(t[this._current]==='"')n=this._current,i=this.consumeQuotedIdentifier(t),r.push({start:n,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")n=this._current,i=this.consumeRawStringLiteral(t),r.push({start:n,type:X.TOK_LITERAL,value:i});else if(t[this._current]==="`"){n=this._current;const o=this.consumeLiteral(t);r.push({start:n,type:X.TOK_LITERAL,value:o})}else if(zj[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&r.push(s);else if(Gj[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")n=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,r.push({start:n,type:X.TOK_AND,value:"&&"})):r.push({start:n,type:X.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")n=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,r.push({start:n,type:X.TOK_OR,value:"||"})):r.push({start:n,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return r}consumeUnquotedIdentifier(t){const r=this._current;for(this._current+=1;this._current<t.length&&jj(t[this._current]);)this._current+=1;return t.slice(r,this._current)}consumeQuotedIdentifier(t){const r=this._current;this._current+=1;const n=t.length;for(;t[this._current]!=='"'&&this._current<n;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(r,this._current))}consumeRawStringLiteral(t){const r=this._current;this._current+=1;const n=t.length;for(;t[this._current]!=="'"&&this._current<n;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(r+1,this._current-1).replace("\\'","'")}consumeNumber(t){const r=this._current;this._current+=1;const n=t.length;for(;wv(t[this._current])&&this._current<n;)this._current+=1;const i=parseInt(t.slice(r,this._current),10);return{start:r,value:i,type:X.TOK_NUMBER}}consumeLBracket(t){const r=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:r,type:X.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:r,type:X.TOK_FLATTEN,value:"[]"}):{start:r,type:X.TOK_LBRACKET,value:"["}}consumeOperator(t){const r=this._current,n=t[r];if(this._current+=1,n==="!")return t[this._current]==="="?(this._current+=1,{start:r,type:X.TOK_NE,value:"!="}):{start:r,type:X.TOK_NOT,value:"!"};if(n==="<")return t[this._current]==="="?(this._current+=1,{start:r,type:X.TOK_LTE,value:"<="}):{start:r,type:X.TOK_LT,value:"<"};if(n===">")return t[this._current]==="="?(this._current+=1,{start:r,type:X.TOK_GTE,value:">="}):{start:r,type:X.TOK_GT,value:">"};if(n==="="&&t[this._current]==="=")return this._current+=1,{start:r,type:X.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const r=this._current,n=t.length;for(;t[this._current]!=="`"&&this._current<n;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(r,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const r='[{"',n=["true","false","null"],i="-0123456789";if(t==="")return!1;if(r.includes(t[0])||n.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const Hj=new Wj,Sr={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class Kj{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const r=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const n=this.lookaheadToken(0);this.errorToken(n,`Unexpected token type: ${n.type}, value: ${n.value}`)}return r}loadTokens(t){this.tokens=[...Hj.tokenize(t),{type:X.TOK_EOF,value:"",start:t.length}]}expression(t){const r=this.lookaheadToken(0);this.advance();let n=this.nud(r),i=this.lookahead(0);for(;t<Sr[i];)this.advance(),n=this.led(i,n),i=this.lookahead(0);return n}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let r,n,i;switch(t.type){case X.TOK_LITERAL:return{type:"Literal",value:t.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return n=this.expression(Sr.Not),{type:"NotExpression",children:[n]};case X.TOK_STAR:return r={type:"Identity"},n=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Sr.Star),{type:"ValueProjection",children:[r,n]};case X.TOK_FILTER:return this.led(t.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return r={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},n=this.parseProjectionRHS(Sr.Flatten),{type:"Projection",children:[r,n]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},n)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),n=this.parseProjectionRHS(Sr.Star),{children:[{type:"Identity"},n],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(Sr.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,r){let n;switch(t){case X.TOK_DOT:const i=Sr.Dot;return this.lookahead(0)!==X.TOK_STAR?(n=this.parseDotRHS(i),{type:"Subexpression",children:[r,n]}):(this.advance(),n=this.parseProjectionRHS(i),{type:"ValueProjection",children:[r,n]});case X.TOK_PIPE:return n=this.expression(Sr.Pipe),{type:X.TOK_PIPE,children:[r,n]};case X.TOK_OR:return n=this.expression(Sr.Or),{type:"OrExpression",children:[r,n]};case X.TOK_AND:return n=this.expression(Sr.And),{type:"AndExpression",children:[r,n]};case X.TOK_LPAREN:const s=r.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),n=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Sr.Filter),{type:"FilterProjection",children:[r,n,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[r]},f=this.parseProjectionRHS(Sr.Flatten);return{type:"Projection",children:[u,f]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(r,t);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice(r,n)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),n=this.parseProjectionRHS(Sr.Star),{type:"Projection",children:[r,n]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const r=this.lookaheadToken(0);this.errorToken(r,`Expected ${t}, got: ${r.type}`)}}errorToken(t,r=""){const n=new Error(r||`Invalid token (${t.type}): "${t.value}"`);throw n.name="ParserError",n}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),t}projectIfSlice(t,r){const n={type:"IndexExpression",children:[t,r]};return r.type==="Slice"?{children:[n,this.parseProjectionRHS(Sr.Star)],type:"Projection"}:n}parseSliceExpression(){const t=[null,null,null];let r=0,n=this.lookahead(0);for(;n!==X.TOK_RBRACKET&&r<3;){if(n===X.TOK_COLON)r+=1,this.advance();else if(n===X.TOK_NUMBER)t[r]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}n=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,r){const n=this.expression(Sr[r]);return{type:"Comparator",name:r,children:[t,n]}}parseDotRHS(t){const r=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(r))return this.expression(t);if(r===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(r===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(Sr[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(t);const r=this.lookaheadToken(0);this.errorToken(r,`Syntax error, unexpected token: ${r.value}(${r.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const r=this.expression(0);if(t.push(r),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],r=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let n,i,s;for(;;){if(n=this.lookaheadToken(0),!r.includes(n.type))throw new Error(`Expecting an identifier token, got: ${n.type}`);if(i=n.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const Yj=new Kj;var ft;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ft||(ft={}));class Vj{constructor(t){this.TYPE_NAME_TABLE={[ft.TYPE_NUMBER]:"number",[ft.TYPE_ANY]:"any",[ft.TYPE_STRING]:"string",[ft.TYPE_ARRAY]:"array",[ft.TYPE_OBJECT]:"object",[ft.TYPE_BOOLEAN]:"boolean",[ft.TYPE_EXPREF]:"expression",[ft.TYPE_NULL]:"null",[ft.TYPE_ARRAY_NUMBER]:"Array<number>",[ft.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([r])=>Math.abs(r),this.functionAvg=([r])=>{let n=0;for(let i=0;i<r.length;i+=1)n+=r[i];return n/r.length},this.functionCeil=([r])=>Math.ceil(r),this.functionContains=r=>{const[n,i]=r;return n.includes(i)},this.functionEndsWith=r=>{const[n,i]=r;return n.includes(i,n.length-i.length)},this.functionFloor=([r])=>Math.floor(r),this.functionJoin=r=>{const[n,i]=r;return i.join(n)},this.functionKeys=([r])=>Object.keys(r),this.functionLength=([r])=>Go(r)?Object.keys(r).length:r.length,this.functionMap=r=>{if(!this._interpreter)return[];const n=[],i=this._interpreter,s=r[0],o=r[1];for(let a=0;a<o.length;a+=1)n.push(i.visit(s,o[a]));return n},this.functionMax=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===ft.TYPE_NUMBER)return Math.max(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=r=>{let n={};for(let i=0;i<r.length;i+=1){const s=r[i];n=Object.assign(n,s)}return n},this.functionMin=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===ft.TYPE_NUMBER)return Math.min(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=r=>{for(let n=0;n<r.length;n+=1)if(this.getTypeName(r[n])!==ft.TYPE_NULL)return r[n];return null},this.functionReverse=([r])=>{if(this.getTypeName(r)===ft.TYPE_STRING){const s=r;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=r.slice(0);return i.reverse(),i},this.functionSort=([r])=>[...r].sort(),this.functionSortBy=r=>{if(!this._interpreter)return[];const n=r[0].slice(0);if(n.length===0)return n;const i=this._interpreter,s=r[1],o=this.getTypeName(i.visit(s,n[0]));if(o!==void 0&&![ft.TYPE_NUMBER,ft.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<n.length;c+=1)a.push([c,n[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)n[c]=a[c][1];return n},this.functionStartsWith=([r,n])=>r.startsWith(n),this.functionSum=([r])=>r.reduce((n,i)=>n+i,0),this.functionToArray=([r])=>this.getTypeName(r)===ft.TYPE_ARRAY?r:[r],this.functionToNumber=([r])=>{const n=this.getTypeName(r);let i;return n===ft.TYPE_NUMBER?r:n===ft.TYPE_STRING&&(i=+r,!isNaN(i))?i:null},this.functionToString=([r])=>this.getTypeName(r)===ft.TYPE_STRING?r:JSON.stringify(r),this.functionType=([r])=>{switch(this.getTypeName(r)){case ft.TYPE_NUMBER:return"number";case ft.TYPE_STRING:return"string";case ft.TYPE_ARRAY:return"array";case ft.TYPE_OBJECT:return"object";case ft.TYPE_BOOLEAN:return"boolean";case ft.TYPE_EXPREF:return"expref";case ft.TYPE_NULL:return"null";default:return}},this.functionValues=([r])=>Object.values(r),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ft.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ft.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]},{types:[ft.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ft.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ft.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY,ft.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ft.TYPE_EXPREF]},{types:[ft.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ft.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ft.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ft.TYPE_ARRAY_STRING,ft.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ft.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ft.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ft.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ft.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ft.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,r,n){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:r.bind(this),_signature:n}}callFunction(t,r){const n=this.functionTable[t];if(n===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,r,n._signature),n._func.call(this,r)}validateInputSignatures(t,r){for(let n=0;n<r.length;n+=1)if("variadic"in r[n]&&n!==r.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${n+1} must occur last`)}validateArgs(t,r,n){var i,s;let o;this.validateInputSignatures(t,n);const a=n.filter(p=>{var _;return(_=!p.optional)!==null&&_!==void 0?_:!1}).length,c=(s=(i=n[n.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=r.length<a,u=r.length>n.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=n.length>1,new Error(`ArgumentError: ${t}() takes ${f}${a} argument${o&&"s"||""} but received ${r.length}`);let d,h,m;for(let p=0;p<n.length;p+=1){m=!1,d=n[p].types,h=this.getTypeName(r[p]);let _;for(_=0;_<d.length;_+=1)if(h!==void 0&&this.typeMatches(h,d[_],r[p])){m=!0;break}if(!m&&h!==void 0){const w=d.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(t,r,n){if(r===ft.TYPE_ANY)return!0;if(r===ft.TYPE_ARRAY_STRING||r===ft.TYPE_ARRAY_NUMBER||r===ft.TYPE_ARRAY){if(r===ft.TYPE_ARRAY)return t===ft.TYPE_ARRAY;if(t===ft.TYPE_ARRAY){let i;r===ft.TYPE_ARRAY_NUMBER?i=ft.TYPE_NUMBER:r===ft.TYPE_ARRAY_STRING&&(i=ft.TYPE_STRING);for(let s=0;s<n.length;s+=1){const o=this.getTypeName(n[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,n[s]))return!1}return!0}}else return t===r;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ft.TYPE_STRING;case"[object Number]":return ft.TYPE_NUMBER;case"[object Array]":return ft.TYPE_ARRAY;case"[object Boolean]":return ft.TYPE_BOOLEAN;case"[object Null]":return ft.TYPE_NULL;case"[object Object]":return t.jmespathType===X.TOK_EXPREF?ft.TYPE_EXPREF:ft.TYPE_OBJECT;default:return}}createKeyFunction(t,r){if(!this._interpreter)return;const n=this._interpreter;return s=>{const o=n.visit(t,s);if(!r.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${r.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class qj{constructor(){this._rootValue=null,this.runtime=new Vj(this)}search(t,r){return this._rootValue=r,this.visit(t,r)}visit(t,r){let n,i,s,o,a,c,l,u,f,d,h;switch(t.type){case"Field":return r===null?null:Go(r)?(c=r[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],r),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],r),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(r))return null;let m=t.value;return m<0&&(m=r.length+m),s=r[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(r))return null;const p=[...t.children],_=this.computeSliceParams(r.length,p),[w,v,A]=_;if(s=[],A>0)for(d=w;d<v;d+=A)s.push(r[d]);else for(d=w;d>v;d+=A)s.push(r[d]);return s;case"Projection":if(h=this.visit(t.children[0],r),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(t.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(t.children[0],r),!Go(h))return null;f=[];const T=Object.values(h);for(d=0;d<T.length;d+=1)i=this.visit(t.children[1],T[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(t.children[0],r),!Array.isArray(h))return null;const I=[],S=[];for(d=0;d<h.length;d+=1)n=this.visit(t.children[2],h[d]),Iu(n)||I.push(h[d]);for(let M=0;M<I.length;M+=1)i=this.visit(t.children[1],I[M]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],r),a=this.visit(t.children[1],r),t.name){case X.TOK_EQ:s=Ou(o,a);break;case X.TOK_NE:s=!Ou(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case X.TOK_FLATTEN:const C=this.visit(t.children[0],r);if(!Array.isArray(C))return null;let P=[];for(d=0;d<C.length;d+=1)i=C[d],Array.isArray(i)?P=[...P,...i]:P.push(i);return P;case"Identity":return r;case"MultiSelectList":if(r===null)return null;for(f=[],d=0;d<t.children.length;d+=1)f.push(this.visit(t.children[d],r));return f;case"MultiSelectHash":if(r===null)return null;f={};let N;for(d=0;d<t.children.length;d+=1)N=t.children[d],f[N.name]=this.visit(N.value,r);return f;case"OrExpression":return n=this.visit(t.children[0],r),Iu(n)&&(n=this.visit(t.children[1],r)),n;case"AndExpression":return o=this.visit(t.children[0],r),Iu(o)?o:this.visit(t.children[1],r);case"NotExpression":return o=this.visit(t.children[0],r),Iu(o);case"Literal":return t.value;case X.TOK_PIPE:return l=this.visit(t.children[0],r),this.visit(t.children[1],l);case X.TOK_CURRENT:return r;case X.TOK_ROOT:return this._rootValue;case"Function":const z=[];for(let M=0;M<t.children.length;M+=1)z.push(this.visit(t.children[M],r));return this.runtime.callFunction(t.name,z);case"ExpressionReference":const J=t.children[0];return J.jmespathType=X.TOK_EXPREF,J;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,r){let[n,i,s]=r;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return n=n===null?o?t-1:0:this.capSliceRange(t,n,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[n,i,s]}capSliceRange(t,r,n){let i=r;return i<0?(i+=t,i<0&&(i=n<0?-1:0)):i>=t&&(i=n<0?t-1:t),i}}const Xj=new qj;ft.TYPE_ANY,ft.TYPE_ARRAY,ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING,ft.TYPE_BOOLEAN,ft.TYPE_EXPREF,ft.TYPE_NULL,ft.TYPE_NUMBER,ft.TYPE_OBJECT,ft.TYPE_STRING;function Jj(e,t){const r=Yj.parse(t);return Xj.search(r,e)}const Zj=(e,t)=>{const r=zo(e.id());if(!y(r))return 0;const[n,i]=nt(t,0,[H.NAME,H.NAME]),s=Jj(r.json,n);return e.set(i,s),0},Qj=(e,t)=>{const r=zo(e.id());if(!y(r))return 0;const[n,i]=nt(t,0,[H.NAME]);switch(It(n)){case"seek":{const[o]=nt(t,i,[H.NUMBER]);r.cursor=Ke(o,0,r.lines.length-1);break}case"line":r.cursor=Ke(r.cursor+1,0,r.lines.length-1);break;default:{const o=r.lines[r.cursor]??"",c=new RegExp(n,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[f,d]=nt(t,u,[H.NAME]);e.set(f,c[l]??0),++l,u=d}break}}return 0};function kv(e){const t=ue(Dt.MAIN),r=Do(t);y(e.targetdir)?Vo(e.targetdir.destpt,e.label,void 0,r):y(e.targetname)&&Vo(e.targetname,e.label,void 0,r)}const t5=Ti({get(e,t){const r=Fj(e.id());if(t==="format")return[!0,r];switch(r){case"text":{const n=zo(e.id());switch(t){case"filename":return[!0,n.filename];case"cursor":return[!0,n.cursor];case"lines":return[!0,n.lines.length]}break}case"json":{const n=zo(e.id());switch(t){case"filename":return[!0,n.filename]}break}case"binary":{const n=zo(e.id());switch(t){case"filename":return[!0,n.filename];case"cursor":return[!0,n.cursor];case"bytes":return[!0,n.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const r=$i(t);return kv(r),0}).command("send",(e,t)=>{const r=$i(["send",...t]);return kv(r),0}).command("stat",()=>0).command("text",(e,t)=>{const r=t.map(Se).join(" ");return Ae(Z,E.elementfocus,"$175",r),0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Se(r),s=$i(n);return y(s.targetname)&&Ae(Z,E.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",Qj).command("readjson",Zj).command("readbin",Bj).command("withboard",(e,t)=>{const[r]=nt(t,0,[H.STRING]),n=ar(r);return y(n)&&(E.board=n,E.element={x:-1,y:-1}),0});function vv(e,t,r,n,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=nt(i,a,[H.ANY]);ce(c)&&!Wr(c)&&!rc(c)&&!Su(c)&&!Ir(c)?o.push(...c):o.push(c),a=l}switch(It(n)){case"get":case"post:json":CA(Z,E.elementfocus,e,t,r,n,o);break}return 0}const e5=Ti().command("fetch",(e,t)=>{const[r,n,i="get",s]=nt(t,0,[H.NAME,H.NAME,H.MAYBE_STRING]);return vv(void 0,r,n,i,t,s),0}).command("fetchwith",(e,t)=>{const[r,n,i,s="get",o]=nt(t,0,[H.ANY,H.NAME,H.NAME,H.MAYBE_STRING]);return vv(r,n,i,s,t,o),0}).command("chat",(e,t)=>{const[r]=nt(t,0,[H.MAYBE_NAME]);return r?IA(Z,E.elementfocus,r):NA(Z,E.elementfocus),0}).command("broadcast",(e,t)=>{const[r]=nt(t,0,[H.MAYBE_NAME]);return r?RA(Z,E.elementfocus,r):OA(Z,E.elementfocus),0});function xv(e,t){var r;if(y(t.targetname)){const n=Object.keys(((r=E.board)==null?void 0:r.objects)??{});switch(t.targetname){case"all":for(let i=0;i<n.length;++i){const s=n[i];e.send(E.elementfocus,s,t.label)}break;case"others":for(let i=0;i<n.length;++i){const s=n[i];s!==e.id()&&e.send(E.elementfocus,s,t.label)}break;case"self":e.message({session:Z.session(),player:E.elementfocus,id:We(),sender:e.id(),target:t.label});break;default:{const i=dx(E.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];y(o.id)&&e.send(E.elementfocus,o.id,t.label)}break}}}else if(y(t.targetdir)){const n=se(E.board,t.targetdir.destpt);y(n==null?void 0:n.id)&&e.send(E.elementfocus,n.id,t.label)}}const r5=Ti({set(e,t,r){return Kz(e,t,r),[!1,void 0]},everytick(){var r,n,i;const e=lr(E.elementid),[t]=e;if(e.length===1&&pt(t)){if(y(E.element))if(t.trim().length===0){const s=Le(E.elementid);s.sidebar=[]}else E.element.tickertext=t,E.element.tickertime=E.timestamp}else if(e.length>1)if(E.elementisplayer){const s=Le(E.elementid);s.sidebar=vx(e)}else{const s=Le(E.elementfocus);s.scrollname=((r=E.element)==null?void 0:r.name)??((i=(n=E.element)==null?void 0:n.kinddata)==null?void 0:i.name)??"",s.scroll=vx(e)}}}).command("shortsend",(e,t)=>{const r=$i(t);return xv(e,r),0}).command("send",(e,t)=>{const r=$i(["send",...t]);return xv(e,r),0}).command("stat",()=>0).command("text",(e,t)=>{const r=t.map(Se).join("");return At(E.elementid,r),0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Se(r),s=$i(n);return y(s.targetname)&&Nt(E.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function n5(e,t,r,n,i){if(!y(E.book))return;const s=E.book,o=sr(s,bt.BOARD,e),a=Oe(o);if(!y(a))return;const c=Ku(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Ie(a),Ie(c);const f=-Math.tan(t*.5),d=Math.sin(t),h=Math.round(12.5*f),m=Math.round(12.5*d),p=new Array(Yt).fill(0);Ng(h,0,-h,Yt-1).forEach(T=>{T.x<0?p[T.y]=Math.min(p[T.y],T.x):p[T.y]=Math.max(p[T.y],T.x)});const w=new Array(Tt).fill(0);Ng(0,m,Tt-1,-m).forEach(T=>{T.y<0?w[T.x]=Math.min(w[T.x],T.y):w[T.x]=Math.max(w[T.x],T.y)});const A=[p,w,p];for(let T=0;T<A.length;++T){const I=A[T];if(T!==1){for(let S=0;S<Yt;++S){const C=I[S],P=S*Tt;for(let N=0;N<Tt;N++){const z=(N+C+Tt)%Tt;u&&(c.terrain[z+P]=a.terrain[N+P])}}if(l){const S=Object.keys(a.objects);for(let C=0;C<S.length;++C){const P=S[C],{x:N,y:z}=a.objects[P];if(y(N)&&y(z)){const J=I[z];a.objects[P].x=(N+J+Tt)%Tt,a.objects[P].lx=a.objects[P].x}}}}if(T===1){for(let S=0;S<Tt;++S){const C=I[S];for(let P=0;P<Yt;++P){const N=(P+C+Yt)%Yt;u&&(c.terrain[S+N*Tt]=a.terrain[S+P*Tt])}}if(l){const S=Object.keys(a.objects);for(let C=0;C<S.length;++C){const P=S[C],{x:N,y:z}=a.objects[P];if(y(N)&&y(z)){const J=I[N];a.objects[P].y=(z+J+Yt)%Yt,a.objects[P].ly=a.objects[P].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Ie(c),Ie(a)}}function i5(e,t){let r=0,n=0,i=0;for(;i<e.length;i++)r+=e[i];for(i=0,t*=r;t&&i<e.length;){if(n+=e[i],t<=n)return i;i++}return 0}var s5=i5;const o5=s5,ne=function(){};ne.prototype.FMX=0,ne.prototype.FMY=0,ne.prototype.FMXxFMY=0,ne.prototype.T=0,ne.prototype.N=0,ne.prototype.initiliazedField=!1,ne.prototype.generationComplete=!1,ne.prototype.wave=null,ne.prototype.compatible=null,ne.prototype.weightLogWeights=null,ne.prototype.sumOfWeights=0,ne.prototype.sumOfWeightLogWeights=0,ne.prototype.startingEntropy=0,ne.prototype.sumsOfOnes=null,ne.prototype.sumsOfWeights=null,ne.prototype.sumsOfWeightLogWeights=null,ne.prototype.entropies=null,ne.prototype.propagator=null,ne.prototype.observed=null,ne.prototype.distribution=null,ne.prototype.stack=null,ne.prototype.stackSize=0,ne.prototype.DX=[-1,0,1,0],ne.prototype.DY=[0,1,0,-1],ne.prototype.opposite=[2,3,0,1],ne.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},ne.prototype.observe=function(e){let t=1e3,r=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,r=s)}}if(r===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[r][s]?this.weights[s]:0;const n=o5(this.distribution,e()),i=this.wave[r];for(let s=0;s<this.T;s++)i[s]!==(s===n)&&this.ban(r,s);return null},ne.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],r=t%this.FMX,n=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=r+s,c=n+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],m=f[h];m[i]--,m[i]==0&&this.ban(l,h)}}}},ne.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},ne.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let r=0;r<e||e===0;r++){const n=this.singleIteration(t);if(n!==null)return!!n}return!0},ne.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},ne.prototype.isGenerationComplete=function(){return this.generationComplete},ne.prototype.ban=function(e,t){const r=this.compatible[e][t];for(let i=0;i<4;i++)r[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const n=this.sumsOfWeights[e];this.entropies[e]=Math.log(n)-this.sumsOfWeightLogWeights[e]/n},ne.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let r=0;r<4;r++)this.compatible[e][t][r]=this.propagator[this.opposite[r]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Av=ne;const Tv=Av,Fi=function(t,r,n,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=r,d=new Array(f);for(let N=0;N<f;N++)d[N]=new Array(n);this.colors=[];const h={};for(let N=0;N<n;N++)for(let z=0;z<r;z++){const J=(N*r+z)*4,M=[t[J],t[J+1],t[J+2],t[J+3]],O=M.join("-");h.hasOwnProperty(O)||(h[O]=this.colors.length,this.colors.push(M)),d[z][N]=h[O]}const m=this.colors.length,p=Math.pow(m,i*i),_=function(z){let J=new Array(i*i);for(let M=0;M<i;M++)for(let O=0;O<i;O++)J[O+M*i]=z(O,M);return J},w=function(z,J){return _(function(M,O){return d[(z+M)%r][(J+O)%n]})},v=function(z){return _(function(J,M){return z[i-1-M+J*i]})},A=function(z){return _(function(J,M){return z[i-1-J+M*i]})},T=function(z){let J=0,M=1;for(let O=0;O<z.length;O++)J+=z[z.length-1-O]*M,M*=m;return J},I=function(z){let J=z,M=p;const O=new Array(i*i);for(let k=0;k<O.length;k++){M/=m;let L=0;for(;J>=M;)J-=M,L++;O[k]=L}return O},S={},C=[];for(let N=0;N<(a?n:n-i+1);N++)for(let z=0;z<(a?r:r-i+1);z++){const J=new Array(8);J[0]=w(z,N),J[1]=A(J[0]),J[2]=v(J[0]),J[3]=A(J[2]),J[4]=v(J[2]),J[5]=A(J[4]),J[6]=v(J[4]),J[7]=A(J[6]);for(let M=0;M<l;M++){const O=T(J[M]);S[O]?S[O]++:(C.push(O),S[O]=1)}}this.T=C.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const z=parseInt(C[N],10);this.patterns[N]=I(z),this.weights[N]=S[z]}const P=function(z,J,M,O){const k=M<0?0:M,L=M<0?M+i:i,B=O<0?0:O,$=O<0?O+i:i;for(let ot=B;ot<$;ot++)for(let et=k;et<L;et++)if(z[et+i*ot]!=J[et-M+i*(ot-O)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let z=0;z<this.T;z++){const J=[];for(let M=0;M<this.T;M++)P(this.patterns[z],this.patterns[M],this.DX[N],this.DY[N])&&J.push(M);this.propagator[N][z]=J}}};Fi.prototype=Object.create(Tv.prototype),Fi.prototype.constructor=Fi,Fi.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Fi.prototype.clear=function(){if(Tv.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Fi.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Fi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const r=t<this.FMY-this.N+1?0:this.N-1;for(let n=0;n<this.FMX;n++){const i=n<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+n)*4,o=this.colors[this.patterns[this.observed[n-i+(t-r)*this.FMX]][i+r*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Fi.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const r=t%this.FMX,n=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=r-f;d<0&&(d+=this.FMX);let h=n-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const m=d+h*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const _=this.colors[this.patterns[p][f+u*this.N]];s+=_[0],o+=_[1],a+=_[2],c+=_[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var a5=Fi;const c5=Av,is=function(t,r,n,i,s){const o=t.tilesize||16;this.FMX=n,this.FMY=i,this.FMXxFMY=n*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;r&&t.subsets&&t.subsets[r]&&(c=t.subsets[r]);const l=function(T){const I=new Array(o*o);for(let S=0;S<o;S++)for(let C=0;C<o;C++)I[C+S*o]=T(C,S);return I},u=function(T){return l(function(I,S){return T[o-1-S+I*o]})},f=function(T){return l(function(I,S){return T[o-1-I+S*o]})};this.tiles=[];const d=[],h=[],m={};let p,_,w;for(let A=0;A<t.tiles.length;A++){const T=t.tiles[A];if(c!==null&&c.indexOf(T.name)===-1)continue;switch(T.symmetry){case"L":w=4,p=function(S){return(S+1)%4},_=function(S){return S%2===0?S+1:S-1};break;case"T":w=4,p=function(S){return(S+1)%4},_=function(S){return S%2===0?S:4-S};break;case"I":w=2,p=function(S){return 1-S},_=function(S){return S};break;case"\\":w=2,p=function(S){return 1-S},_=function(S){return 1-S};break;case"F":w=8,p=function(S){return S<4?(S+1)%4:4+(S-1)%4},_=function(S){return S<4?S+4:S-4};break;default:w=1,p=function(S){return S},_=function(S){return S};break}this.T=h.length,m[T.name]=this.T;for(let S=0;S<w;S++)h.push([this.T+S,this.T+p(S),this.T+p(p(S)),this.T+p(p(p(S))),this.T+_(S),this.T+_(p(S)),this.T+_(p(p(S))),this.T+_(p(p(p(S))))]);let I;if(a)for(let S=0;S<w;S++)I=T.bitmap[S],this.tiles.push(l(function(C,P){return[I[(o*P+C)*4],I[(o*P+C)*4+1],I[(o*P+C)*4+2],I[(o*P+C)*4+3]]}));else{I=T.bitmap,this.tiles.push(l(function(S,C){return[I[(o*C+S)*4],I[(o*C+S)*4+1],I[(o*C+S)*4+2],I[(o*C+S)*4+3]]}));for(let S=1;S<w;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):f(this.tiles[this.T+S-4]))}for(let S=0;S<w;S++)d.push(T.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const v=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),v[A]=new Array(this.T);for(let T=0;T<this.T;T++){v[A][T]=new Array(this.T);for(let I=0;I<this.T;I++)v[A][T][I]=!1}}for(let A=0;A<t.neighbors.length;A++){const T=t.neighbors[A],I=T.left.split(" ").filter(function(J){return J.length}),S=T.right.split(" ").filter(function(J){return J.length});if(c!==null&&(c.indexOf(I[0])===-1||c.indexOf(S[0])===-1))continue;const C=h[m[I[0]]][I.length==1?0:parseInt(I[1],10)],P=h[C][1],N=h[m[S[0]]][S.length==1?0:parseInt(S[1],10)],z=h[N][1];v[0][N][C]=!0,v[0][h[N][6]][h[C][6]]=!0,v[0][h[C][4]][h[N][4]]=!0,v[0][h[C][2]][h[N][2]]=!0,v[1][z][P]=!0,v[1][h[P][6]][h[z][6]]=!0,v[1][h[z][4]][h[P][4]]=!0,v[1][h[P][2]][h[z][2]]=!0}for(let A=0;A<this.T;A++)for(let T=0;T<this.T;T++)v[2][A][T]=v[0][T][A],v[3][A][T]=v[1][T][A];for(let A=0;A<4;A++)for(let T=0;T<this.T;T++){const I=[],S=v[A][T];for(let C=0;C<this.T;C++)S[C]&&I.push(C);this.propagator[A][T]=I}};is.prototype=Object.create(c5.prototype),is.prototype.constructor=is,is.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},is.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},is.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let r=0;r<this.FMY;r++){const n=this.tiles[this.observed[t+r*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(r*this.tilesize+i)*this.FMX*this.tilesize)*4,a=n[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},is.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let r=0;r<this.FMX;r++)for(let n=0;n<this.FMY;n++){const i=this.wave[r+n*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(r*this.tilesize+l+(n*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let f=0,d=0,h=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const _=this.tiles[p][l+c*this.tilesize],w=this.weights[p]*a;f+=_[0]*w,d+=_[1]*w,h+=_[2]*w,m+=_[3]*w}e[u]=f,e[u+1]=d,e[u+2]=h,e[u+3]=m}}}};var l5=is,u5={OverlappingModel:a5,SimpleTiledModel:l5},h5=fs(u5);const Sv=5;function Rv(e,t,r,n,i,s,o){if(!y(E.book))return!1;const a=E.book,c=sr(a,bt.BOARD,e),l=sr(a,bt.BOARD,t),u=Oe(c),f=Oe(l);if(!y(u)||!y(f))return!1;Ie(u),Ie(f);let d=0;const h=new Map,m=new Map;let p=0;const _=32,w=new Uint8Array(Af*4);for(let C=0;C<Yt;++C)for(let P=0;P<Tt;++P){const N=se(f,{x:P,y:C}),z=(N==null?void 0:N.char)??0,J=(N==null?void 0:N.color)??_,M=(N==null?void 0:N.bg)??_;w[p++]=z,w[p++]=J,w[p++]=M;const O=On(N),k=It((O==null?void 0:O.name)??"empty"),L=h.get(k);wt(L)?w[p++]=L:(h.set(k,d),m.set(d,k),w[p++]=d++)}const v=s.x-i.x+1,A=s.y-i.y+1,T=new h5.OverlappingModel(w,Tt,Yt,r,v,A,!1,!1,n,0);let I=0;for(;I<Sv&&!T.generate();++I);if(I===Sv)return!1;p=0;const S=T.graphics();for(let C=i.y;C<=s.y;++C)for(let P=i.x;P<=s.x;++P){const N={x:P,y:C},z=S[p++],J=S[p++],M=S[p++];switch(d=S[p++],o){case"all":{const B=se(u,{x:P,y:C});Ve(B)&&Or(u,B,a.timestamp),Ce(u,{x:P,y:C});break}case"object":{const B=se(u,{x:P,y:C});Ve(B)&&Or(u,B,a.timestamp);break}case"terrain":Ce(u,{x:P,y:C});break}let O=m.get(d)??"";const k=On({kind:O});switch(o){case"all":break;case"object":Ve(k)||(O="");break;case"terrain":Ve(k)&&(O="");break;default:if(zt(k,"group")!==o&&(O=""),O){const B=se(u,{x:P,y:C});Ve(B)&&Or(u,B,a.timestamp),Ce(u,{x:P,y:C})}break}const L=O?In(u,[O],N):void 0;if(!(!y(L)||!y(k))&&(Fo(L,k),z>0&&(L.char=z),J<_&&(L.color=J),M<_&&(L.bg=M),Ve(L))){const B=bn(fc(f,O));y(B)&&(Ce(u,{...ls(f,B.x??0,B.y??0),x:P,y:C}),Fo(L,B))}}return!0}function Ov(e){return`zss_snapshot_${e}`}const Iv={x:0,y:0},Nv={x:Tt-1,y:Yt-1},Cv="all";function f5(e){const t=sr(E.book,bt.BOARD,e),r=Oe(t);if(!y(r))return;const n=Ov(r.id);Bk(E.book,n);const[i]=as(Dt.MAIN,n,bt.BOARD),s=Oe(i);if(y(s))return wu(e,s.id,Iv,Nv,Cv),s}function d5(e){const t=sr(E.book,bt.BOARD,e),r=Oe(t);if(!y(r))return;const n=Ov(r.id),i=sr(E.book,bt.BOARD,n),s=Oe(i);if(y(s))return wu(s.id,e,Iv,Nv,Cv),s}function p5(e,t,r,n,i,s){switch(s){case"all":case"object":case"terrain":break;default:return m5(e,t,i,s)}if(!y(E.book))return;const o=E.book,a=sr(o,bt.BOARD,e),c=Oe(a);if(!y(c))return;const l=Ku();Ie(c);for(let u=r.y;u<=n.y;++u)for(let f=r.x;f<=n.x;++f){let d=!1,h=!1;switch(s){case"all":d=!0,h=!0;break;case"object":d=!0;break;case"terrain":h=!0;break}const m=(f+t.x+Tt)%Tt,p=(u+t.y+Yt)%Yt;if(d){const _=se(c,{x:f,y:u});Ve(_)&&y(_==null?void 0:_.x)&&y(_==null?void 0:_.y)&&(_.x=m,_.lx=m,_.y=p,_.ly=p)}h&&(l.terrain[m+p*Tt]=c.terrain[f+u*Tt])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),tc(c)}function m5(e,t,r,n){if(!y(E.book))return;const i=E.book,s=sr(i,bt.BOARD,e),o=Oe(s);if(!y(o))return;Ie(o);const{terrainelements:a,objectelements:c}=Gk(o,r,n);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>Gr({x:p.x??0,y:p.y??0},Tt)),f=[],d=[];for(let p=0;p<a.length;++p){const _=a[p],w={x:_.x??-1,y:_.y??-1},v=se(o,w);y(v)&&Ve(v)&&(f.push(v.id??""),f.push(v.id??""),d.push(Gr({x:v.x??0,y:v.y??0},Tt)))}let h=!1;for(let p=0;p<a.length;++p){const _=a[p],w=zt(_,"collision"),v={x:_.x??-1,y:_.y??-1},A=Gr(v,Tt),T={x:v.x+t.x,y:v.y+t.y};if(Yu(T)){const I=se(o,T),S=(I==null?void 0:I.id)??"",C=Gr({x:(I==null?void 0:I.x)??0,y:(I==null?void 0:I.y)??0},Tt),P=zt(I,"collision");if(y(I)&&Ve(I)&&f.includes(S)!==!0&&l.includes(S)!==!0){let N=!1;const z=d.includes(A),J=z?se(o,v):void 0,M=z?zt(J,"pushable"):!1,O=z&&M;if(Xp(_,I)&&(w!==Mt.ISWALK||z)){let k=z;y(J)&&M&&(h=cs(i,o,J,{x:(J.x??0)-t.x,y:(J.y??0)-t.y})!==!0,h||(k=!1)),(k||w!==Mt.ISWALK)&&(h=cs(i,o,I,{x:(I.x??0)+t.x,y:(I.y??0)+t.y})!==!0,h&&(N=O))}else(w!==Mt.ISWALK||O)&&(h=!0,N=O);N&&y(J)&&(h=cs(i,o,J,{x:(J.x??0)-t.x,y:(J.y??0)-t.y})!==!0)}else P===Mt.ISSOLID&&u.includes(C)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const _=c[p],w=zt(_,"collision"),v={x:_.x??0,y:_.y??0},A={x:v.x+t.x,y:v.y+t.y};if(Yu(A)){const T=se(o,A),I=(T==null?void 0:T.id)??"",S=zt(T,"collision"),C=zt(T,"group");y(T)&&Ve(T)&&f.includes(I)&&l.includes(I)!==!0?Xp(_,T)?h=cs(i,o,T,A)!==!0:h=!0:uc(w,S)&&n!==C&&(h=!0)}else h=!0}if(h)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const _=a[p],w={x:_.x??-1,y:_.y??-1},v={x:w.x+t.x,y:w.y+t.y},A=ls(o,v.x,v.y);if(y(_)&&y(A)){Ce(o,{..._,x:v.x,y:v.y}),Ce(o,{...A,x:w.x,y:w.y});const T=se(o,w);Ve(T)&&y(T)&&(T.x=(T.x??0)+t.x,T.y=(T.y??0)+t.y,T.lx=(T.lx??0)+t.x,T.ly=(T.ly??0)+t.y)}}tc(o);for(let p=0;p<c.length;++p){const _=c[p],w={x:_.x??-1,y:_.y??-1},v={x:w.x+t.x,y:w.y+t.y};if(!cs(i,o,_,v))break}tc(o)}function Nu(e,t){let r="all";const n={x:0,y:0},i={x:Tt-1,y:Yt-1};for(let s=t;s<e.length;){const[o,a]=nt(e,s,[H.MAYBE_NUMBER_OR_STRING]);if(pt(o))r=It(o),s=a;else if(wt(o)){const[c,l,u,f]=nt(e,a,[H.NUMBER,H.MAYBE_NUMBER,H.MAYBE_NUMBER]);n.x=Math.min(o,l??o),n.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:r,pt1:n,pt2:i}}const g5=Ti().command("snapshot",()=>(!y(E.book)||!y(E.board)||f5(E.board.id),0)).command("revert",()=>(!y(E.book)||!y(E.board)||d5(E.board.id),0)).command("copy",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;const[r,n]=nt(t,0,[H.STRING]),i=bookreadcodepagesbytypeandstat(E.book,bt.BOARD,r),s=bn(...i);if(y(s)){const o=Nu(t,n);wu(s.id,E.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;const[r,n,i,s]=nt(t,0,[H.STRING,H.NUMBER,H.NUMBER]),o=bookreadcodepagesbytypeandstat(E.book,bt.BOARD,r),a=bn(...o);if(y(a)){const c=Nu(t,s);Rv(E.board.id,a.id,n,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!y(E.book)||!y(E.board))return 0;const[r,n]=nt(t,0,[H.DIR]),i={x:r.destpt.x-(((o=E.element)==null?void 0:o.x)??0),y:r.destpt.y-(((a=E.element)==null?void 0:a.y)??0)},s=Nu(t,n);return p5(E.board.id,i,s.pt1,s.pt2,E.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;const[r,n]=nt(t,0,[H.NUMBER]),i=Nu(t,n);return n5(E.board.id,Fg(r),i.pt1,i.pt2,i.targetset),0});var ss=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(ss||{});const y5={audio:Sf,board:rF,cli:Sj,display:Rj,element:Pj,runtime:r5,loader:t5,network:e5,transform:g5},Bp=["audio","board","display","network","transform","element"],_5={0:[],1:["cli",...Bp],2:["loader",...Bp],3:["runtime",...Bp]},b5={0:new Map,1:new Map,2:new Map,3:new Map};function Wo(e){return(_5[e]??[]).map(r=>y5[r]).filter(y)}function Dp(e){const t=[],r=Wo(e);for(let n=0;n<r.length;++n)t.push(...r[n].listcommands());return t}function w5(e,t){const r=b5[e];if(!r.has(t)){let n;const i=Wo(e);for(let s=0;s<i.length&&(n=i[s].getcommand(t),!y(n));++s);r.set(t,n)}return r.get(t)}function E5(e,t,r){const n=Wo(e);for(let i=0;i<n.length;++i){const s=n[i];if(s.get!==void 0){const[o,a]=s.get(t,r);if(o)return[o,a]}}return[!1,void 0]}function k5(e,t,r,n){const i=Wo(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,r,n);if(a)return[a,n]}}return[!1,void 0]}function v5(e,t){const r=Wo(e);for(let n=0;n<r.length;++n)r[n].tick(t)}function Lv(e,t){const r=Wo(e);for(let n=0;n<r.length;++n)r[n].everytick(t)}var Mv={},Uv={},Pv={};const $v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Pv.encode=function(e){if(0<=e&&e<$v.length)return $v[e];throw new TypeError("Must be between 0 and 63: "+e)};const x5=Pv,Fv=5,Bv=1<<Fv,A5=Bv-1,T5=Bv;function S5(e){return e<0?(-e<<1)+1:(e<<1)+0}Uv.encode=function(t){let r="",n,i=S5(t);do n=i&A5,i>>>=Fv,i>0&&(n|=T5),r+=x5.encode(n);while(i>0);return r};var nc={};(function(e){function t(S,C,P){if(C in S)return S[C];if(arguments.length===3)return P;throw new Error('"'+C+'" is a required argument.')}e.getArg=t;const r=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,n=/^data:.+\,.+$/;function i(S){const C=S.match(r);return C?{scheme:C[1],auth:C[2],host:C[3],port:C[4],path:C[5]}:null}e.urlParse=i;function s(S){let C="";return S.scheme&&(C+=S.scheme+":"),C+="//",S.auth&&(C+=S.auth+"@"),S.host&&(C+=S.host),S.port&&(C+=":"+S.port),S.path&&(C+=S.path),C}e.urlGenerate=s;const o=32;function a(S){const C=[];return function(P){for(let z=0;z<C.length;z++)if(C[z].input===P){const J=C[0];return C[0]=C[z],C[z]=J,C[0].result}const N=S(P);return C.unshift({input:P,result:N}),C.length>o&&C.pop(),N}}const c=a(function(C){let P=C;const N=i(C);if(N){if(!N.path)return C;P=N.path}const z=e.isAbsolute(P),J=[];let M=0,O=0;for(;;)if(M=O,O=P.indexOf("/",M),O===-1){J.push(P.slice(M));break}else for(J.push(P.slice(M,O));O<P.length&&P[O]==="/";)O++;let k=0;for(O=J.length-1;O>=0;O--){const L=J[O];L==="."?J.splice(O,1):L===".."?k++:k>0&&(L===""?(J.splice(O+1,k),k=0):(J.splice(O,2),k--))}return P=J.join("/"),P===""&&(P=z?"/":"."),N?(N.path=P,s(N)):P});e.normalize=c;function l(S,C){S===""&&(S="."),C===""&&(C=".");const P=i(C),N=i(S);if(N&&(S=N.path||"/"),P&&!P.scheme)return N&&(P.scheme=N.scheme),s(P);if(P||C.match(n))return C;if(N&&!N.host&&!N.path)return N.host=C,s(N);const z=C.charAt(0)==="/"?C:c(S.replace(/\/+$/,"")+"/"+C);return N?(N.path=z,s(N)):z}e.join=l,e.isAbsolute=function(S){return S.charAt(0)==="/"||r.test(S)};function u(S,C){S===""&&(S="."),S=S.replace(/\/$/,"");let P=0;for(;C.indexOf(S+"/")!==0;){const N=S.lastIndexOf("/");if(N<0||(S=S.slice(0,N),S.match(/^([^\/]+:\/)?\/*$/)))return C;++P}return Array(P+1).join("../")+C.substr(S.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function h(S){return p(S)?"$"+S:S}e.toSetString=f?d:h;function m(S){return p(S)?S.slice(1):S}e.fromSetString=f?d:m;function p(S){if(!S)return!1;const C=S.length;if(C<9||S.charCodeAt(C-1)!==95||S.charCodeAt(C-2)!==95||S.charCodeAt(C-3)!==111||S.charCodeAt(C-4)!==116||S.charCodeAt(C-5)!==111||S.charCodeAt(C-6)!==114||S.charCodeAt(C-7)!==112||S.charCodeAt(C-8)!==95||S.charCodeAt(C-9)!==95)return!1;for(let P=C-10;P>=0;P--)if(S.charCodeAt(P)!==36)return!1;return!0}function _(S,C,P){let N=v(S.source,C.source);return N!==0||(N=S.originalLine-C.originalLine,N!==0)||(N=S.originalColumn-C.originalColumn,N!==0||P)||(N=S.generatedColumn-C.generatedColumn,N!==0)||(N=S.generatedLine-C.generatedLine,N!==0)?N:v(S.name,C.name)}e.compareByOriginalPositions=_;function w(S,C,P){let N=S.generatedLine-C.generatedLine;return N!==0||(N=S.generatedColumn-C.generatedColumn,N!==0||P)||(N=v(S.source,C.source),N!==0)||(N=S.originalLine-C.originalLine,N!==0)||(N=S.originalColumn-C.originalColumn,N!==0)?N:v(S.name,C.name)}e.compareByGeneratedPositionsDeflated=w;function v(S,C){return S===C?0:S===null?1:C===null?-1:S>C?1:-1}function A(S,C){let P=S.generatedLine-C.generatedLine;return P!==0||(P=S.generatedColumn-C.generatedColumn,P!==0)||(P=v(S.source,C.source),P!==0)||(P=S.originalLine-C.originalLine,P!==0)||(P=S.originalColumn-C.originalColumn,P!==0)?P:v(S.name,C.name)}e.compareByGeneratedPositionsInflated=A;function T(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=T;function I(S,C,P){if(C=C||"",S&&(S[S.length-1]!=="/"&&C[0]!=="/"&&(S+="/"),C=S+C),P){const N=i(P);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const z=N.path.lastIndexOf("/");z>=0&&(N.path=N.path.substring(0,z+1))}C=l(s(N),C)}return c(C)}e.computeSourceURL=I})(nc);var jp={};let R5=class zx{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const n=new zx;for(let i=0,s=t.length;i<s;i++)n.add(t[i],r);return n}size(){return this._set.size}add(t,r){const n=this.has(t),i=this._array.length;(!n||r)&&this._array.push(t),n||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const r=this._set.get(t);if(r>=0)return r;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};jp.ArraySet=R5;var Dv={};const jv=nc;function O5(e,t){const r=e.generatedLine,n=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return n>r||n==r&&s>=i||jv.compareByGeneratedPositionsInflated(e,t)<=0}let I5=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,r){this._array.forEach(t,r)}add(t){O5(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(jv.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Dv.MappingList=I5;const ic=Uv,tr=nc,Cu=jp.ArraySet,N5=Dv.MappingList;let zv=class Gx{constructor(t){t||(t={}),this._file=tr.getArg(t,"file",null),this._sourceRoot=tr.getArg(t,"sourceRoot",null),this._skipValidation=tr.getArg(t,"skipValidation",!1),this._sources=new Cu,this._names=new Cu,this._mappings=new N5,this._sourcesContents=null}static fromSourceMap(t){const r=t.sourceRoot,n=new Gx({file:t.file,sourceRoot:r});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,r!=null&&(s.source=tr.relative(r,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),n.addMapping(s)}),t.sources.forEach(function(i){let s=i;r!==null&&(s=tr.relative(r,i)),n._sources.has(s)||n._sources.add(s);const o=t.sourceContentFor(i);o!=null&&n.setSourceContent(i,o)}),n}addMapping(t){const r=tr.getArg(t,"generated"),n=tr.getArg(t,"original",null);let i=tr.getArg(t,"source",null),s=tr.getArg(t,"name",null);this._skipValidation||this._validateMapping(r,n,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:r.line,generatedColumn:r.column,originalLine:n!=null&&n.line,originalColumn:n!=null&&n.column,source:i,name:s})}setSourceContent(t,r){let n=t;this._sourceRoot!=null&&(n=tr.relative(this._sourceRoot,n)),r!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[tr.toSetString(n)]=r):this._sourcesContents&&(delete this._sourcesContents[tr.toSetString(n)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,r,n){let i=r;if(r==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=tr.relative(s,i));const o=this._mappings.toArray().length>0?new Cu:this._sources,a=new Cu;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,n!=null&&(c.source=tr.join(n,c.source)),s!=null&&(c.source=tr.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(n!=null&&(c=tr.join(n,c)),s!=null&&(c=tr.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,r,n,i){if(r&&typeof r.line!="number"&&typeof r.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!r&&!n&&!i)){if(!(t&&"line"in t&&"column"in t&&r&&"line"in r&&"column"in r&&t.line>0&&t.column>=0&&r.line>0&&r.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:n,original:r,name:i}))}}_serializeMappings(){let t=0,r=1,n=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,m=d.length;h<m;h++){if(l=d[h],c="",l.generatedLine!==r)for(t=0;l.generatedLine!==r;)c+=";",r++;else if(h>0){if(!tr.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=ic.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=ic.encode(f-o),o=f,c+=ic.encode(l.originalLine-1-i),i=l.originalLine-1,c+=ic.encode(l.originalColumn-n),n=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=ic.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,r){return t.map(function(n){if(!this._sourcesContents)return null;r!=null&&(n=tr.relative(r,n));const i=tr.toSetString(n);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};zv.prototype._version=3,Mv.SourceMapGenerator=zv;var Gv={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(r,n,i,s,o,a){const c=Math.floor((n-r)/2)+r,l=o(i,s[c],!0);return l===0?c:l>0?n-c>1?t(c,n,i,s,o,a):a==e.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-r>1?t(r,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:r<0?-1:r}e.search=function(n,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,n,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(Gv);var sc={exports:{}},C5={},L5=Object.freeze({__proto__:null,default:C5}),Wv=Wx(L5);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;sc.exports=function(){if(typeof e=="string")return fetch(e).then(r=>r.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},sc.exports.initialize=t=>e=t}else{const e=Wv,t=Wv;sc.exports=function(){return new Promise((n,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}n(a.buffer)})})},sc.exports.initialize=r=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Hv=sc.exports;const M5=Hv;function U5(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let oc=null;var P5=function(){if(oc)return oc;const t=[];return oc=M5().then(r=>WebAssembly.instantiate(r,{env:{mapping_callback(n,i,s,o,a,c,l,u,f,d){const h=new U5;h.generatedLine=n+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(r=>({exports:r.instance.exports,withMappingCallback:(n,i)=>{t.push(n);try{i()}finally{t.pop()}}})).then(null,r=>{throw oc=null,r}),oc};const Ot=nc,zp=Gv,Lu=jp.ArraySet,$5=Hv,F5=P5,Gp=Symbol("smcInternal");class Xe{constructor(t,r){return t==Gp?Promise.resolve(this):D5(t,r)}static initialize(t){$5.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,r){return j5(t,r)}static async with(t,r,n){const i=await new Xe(t,r);try{return await n(i)}finally{i.destroy()}}_parseMappings(t,r){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,r,n){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Xe.prototype._version=3,Xe.GENERATED_ORDER=1,Xe.ORIGINAL_ORDER=2,Xe.GREATEST_LOWER_BOUND=1,Xe.LEAST_UPPER_BOUND=2;class ac extends Xe{constructor(t,r){return super(Gp).then(n=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version");let o=Ot.getArg(i,"sources");const a=Ot.getArg(i,"names",[]);let c=Ot.getArg(i,"sourceRoot",null);const l=Ot.getArg(i,"sourcesContent",null),u=Ot.getArg(i,"mappings"),f=Ot.getArg(i,"file",null);if(s!=n._version)throw new Error("Unsupported version: "+s);return c&&(c=Ot.normalize(c)),o=o.map(String).map(Ot.normalize).map(function(d){return c&&Ot.isAbsolute(c)&&Ot.isAbsolute(d)?Ot.relative(c,d):d}),n._names=Lu.fromArray(a.map(String),!0),n._sources=Lu.fromArray(o,!0),n._absoluteSources=n._sources.toArray().map(function(d){return Ot.computeSourceURL(c,d,r)}),n.sourceRoot=c,n.sourcesContent=l,n._mappings=u,n._sourceMapURL=r,n.file=f,n._computedColumnSpans=!1,n._mappingsPtr=0,n._wasm=null,F5().then(d=>(n._wasm=d,n))})}_findSourceIndex(t){let r=t;if(this.sourceRoot!=null&&(r=Ot.relative(this.sourceRoot,r)),this._sources.has(r))return this._sources.indexOf(r);for(let n=0;n<this._absoluteSources.length;++n)if(this._absoluteSources[n]==t)return n;return-1}static fromSourceMap(t,r){return new ac(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,r){const n=t.length,i=this._wasm.exports.allocate_mappings(n),s=new Uint8Array(this._wasm.exports.memory.buffer,i,n);for(let a=0;a<n;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,r,n){const i=r||null,s=n||Xe.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Ot.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Xe.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Xe.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let r=Ot.getArg(t,"source");const n=Ot.getArg(t,"line"),i=t.column||0;if(r=this._findSourceIndex(r),r<0)return[];if(n<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),r,n-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const r={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")};if(r.generatedLine<1)throw new Error("Line numbers must be >= 1");if(r.generatedColumn<0)throw new Error("Column numbers must be >= 0");let n=Ot.getArg(t,"bias",Xe.GREATEST_LOWER_BOUND);n==null&&(n=Xe.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),r.generatedLine-1,r.generatedColumn,n)}),i&&i.generatedLine===r.generatedLine){let s=Ot.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Ot.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Ot.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Ot.getArg(i,"originalLine",null),column:Ot.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,r){if(!this.sourcesContent)return null;const n=this._findSourceIndex(t);if(n>=0)return this.sourcesContent[n];let i=t;this.sourceRoot!=null&&(i=Ot.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Ot.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(r)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let r=Ot.getArg(t,"source");if(r=this._findSourceIndex(r),r<0)return{line:null,column:null,lastColumn:null};const n={source:r,originalLine:Ot.getArg(t,"line"),originalColumn:Ot.getArg(t,"column")};if(n.originalLine<1)throw new Error("Line numbers must be >= 1");if(n.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Ot.getArg(t,"bias",Xe.GREATEST_LOWER_BOUND);i==null&&(i=Xe.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),n.source,n.originalLine-1,n.originalColumn,i)}),s&&s.source===n.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Ot.getArg(s,"generatedLine",null),column:Ot.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}ac.prototype.consumer=Xe;class B5 extends Xe{constructor(t,r){return super(Gp).then(n=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version"),o=Ot.getArg(i,"sections");if(s!=n._version)throw new Error("Unsupported version: "+s);n._sources=new Lu,n._names=new Lu,n.__generatedMappings=null,n.__originalMappings=null,n.__generatedMappingsUnsorted=null,n.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Ot.getArg(c,"offset"),u=Ot.getArg(l,"line"),f=Ot.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Xe(Ot.getArg(c,"map"),r).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(n._sections=c,n))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Ot.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Ot.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let r=0;r<this._sections.length;r++)for(let n=0;n<this._sections[r].consumer.sources.length;n++)t.push(this._sections[r].consumer.sources[n]);return t}originalPositionFor(t){const r={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")},n=zp.search(r,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[n];return i?i.consumer.originalPositionFor({line:r.generatedLine-(i.generatedOffset.generatedLine-1),column:r.generatedColumn-(i.generatedOffset.generatedLine===r.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,r){for(let n=0;n<this._sections.length;n++){const s=this._sections[n].consumer.sourceContentFor(t,!0);if(s)return s}if(r)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let r=0;r<this._sections.length;r++){const n=this._sections[r];if(n.consumer._findSourceIndex(Ot.getArg(t,"source"))===-1)continue;const i=n.consumer.generatedPositionFor(t);if(i)return{line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,r){const n=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Ot.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};n.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,r,n){const i=r||null,s=n||Xe.GENERATED_ORDER;let o;switch(s){case Xe.GENERATED_ORDER:o=this._generatedMappings;break;case Xe.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Ot.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,r,n,i,s,o){if(t[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[n]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return zp.search(t,r,s,o)}allGeneratedPositionsFor(t){const r=Ot.getArg(t,"line"),n={source:Ot.getArg(t,"source"),originalLine:r,originalColumn:Ot.getArg(t,"column",0)};if(n.source=this._findSourceIndex(n.source),n.source<0)return[];if(n.originalLine<1)throw new Error("Line numbers must be >= 1");if(n.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",Ot.compareByOriginalPositions,zp.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===r&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function D5(e,t){let r=e;typeof e=="string"&&(r=Ot.parseSourceMapInput(e));const n=r.sections!=null?new B5(r,t):new ac(r,t);return Promise.resolve(n)}function j5(e,t){return ac.fromSourceMap(e,t)}var Kv={};const z5=Mv.SourceMapGenerator,Mu=nc,G5=/(\r?\n)/,W5=10,Ho="$$$isSourceNode$$$";let H5=class f0{constructor(t,r,n,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=r??null,this.source=n??null,this.name=s??null,this[Ho]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,r,n){const i=new f0,s=t.split(G5);let o=0;const a=function(){const h=p(),m=p()||"";return h+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return r.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const m=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,m),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),r.sources.forEach(function(h){const m=r.sourceContentFor(h);m!=null&&(n!=null&&(h=Mu.join(n,h)),i.setSourceContent(h,m))}),i;function d(h,m){if(h===null||h.source===void 0)i.add(m);else{const p=n?Mu.join(n,h.source):h.source;i.add(new f0(h.originalLine,h.originalColumn,p,m,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(r){this.add(r)},this);else if(t[Ho]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let r=t.length-1;r>=0;r--)this.prepend(t[r]);else if(t[Ho]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let r;for(let n=0,i=this.children.length;n<i;n++)r=this.children[n],r[Ho]?r.walk(t):r!==""&&t(r,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let r,n;const i=this.children.length;if(i>0){for(r=[],n=0;n<i-1;n++)r.push(this.children[n]),r.push(t);r.push(this.children[n]),this.children=r}return this}replaceRight(t,r){const n=this.children[this.children.length-1];return n[Ho]?n.replaceRight(t,r):typeof n=="string"?this.children[this.children.length-1]=n.replace(t,r):this.children.push("".replace(t,r)),this}setSourceContent(t,r){this.sourceContents[Mu.toSetString(t)]=r}walkSourceContents(t){for(let n=0,i=this.children.length;n<i;n++)this.children[n][Ho]&&this.children[n].walkSourceContents(t);const r=Object.keys(this.sourceContents);for(let n=0,i=r.length;n<i;n++)t(Mu.fromSetString(r[n]),this.sourceContents[r[n]])}toString(){let t="";return this.walk(function(r){t+=r}),t}toStringWithSourceMap(t){const r={code:"",line:1,column:0},n=new z5(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){r.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&n.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:r.line,column:r.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(n.addMapping({generated:{line:r.line,column:r.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===W5?(r.line++,r.column=0,f+1===d?(s=null,i=!1):i&&n.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:r.line,column:r.column},name:u.name})):r.column++}),this.walkSourceContents(function(l,u){n.setSourceContent(l,u)}),{code:r.code,map:n}}};Kv.SourceNode=H5;var K5=Kv.SourceNode;let Yv=0;const Vv=ni,Y5=["Command","lines"];class V5 extends i${constructor(){super(Ik,{traceInitPerf:ni,skipValidations:!ni,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});vt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));vt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(pu)}])}));vt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));vt(this,"inline_go",this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))}));vt(this,"inline_try",this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))}));vt(this,"inline_command",this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))}));vt(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])}));vt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(ep)}));vt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(tp)}));vt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Z1)}])}));vt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Q1)}));vt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(tw),this.CONSUME(ew)}));vt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME($o),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));vt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));vt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(cp),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));vt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(yk),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));vt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(lp),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));vt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(pu)),this.CONSUME4($o),this.CONSUME4(up)}}])}));vt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME($o),this.CONSUME(up)}}])}));vt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));vt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME($o),this.CONSUME(hp),this.CONSUME(lp),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));vt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME($o),this.CONSUME(hp),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));vt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(vk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));vt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(xk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));vt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Ak),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));vt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(Tk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));vt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(Sk)}));vt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(Rk)}));vt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(wk)}));vt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Ek)}));vt(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(kk)}));vt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(np),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})}));vt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(sp),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})}));vt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(ip),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));vt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})}));vt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(ak)},{ALT:()=>this.CONSUME(ck)},{ALT:()=>this.CONSUME(lk)},{ALT:()=>this.CONSUME(uk)},{ALT:()=>this.CONSUME(hk)},{ALT:()=>this.CONSUME(fk)}])}));vt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(np),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})}));vt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(sp),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})}));vt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(ip),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));vt(this,"arith_expr",this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])}));vt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(op)},{ALT:()=>this.CONSUME(ap)}]),this.SUBRULE(this.term)}));vt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));vt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(pk)},{ALT:()=>this.CONSUME(cp)},{ALT:()=>this.CONSUME(mk)},{ALT:()=>this.CONSUME(gk)}]),this.SUBRULE(this.factor)}));vt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(op)},{ALT:()=>this.CONSUME(ap)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])}));vt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(dk),this.SUBRULE(this.factor)})}));vt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));vt(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));vt(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(rw)},{ALT:()=>this.CONSUME(nw)}])}));vt(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(iw)},{ALT:()=>this.CONSUME(sw)},{ALT:()=>this.CONSUME(ow)},{ALT:()=>this.CONSUME(aw)},{ALT:()=>this.CONSUME(cw)},{ALT:()=>this.CONSUME(lw)},{ALT:()=>this.CONSUME(uw)},{ALT:()=>this.CONSUME(hw)},{ALT:()=>this.CONSUME(fw)}])}));vt(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(dw)},{ALT:()=>this.CONSUME(pw)},{ALT:()=>this.CONSUME(mw)},{ALT:()=>this.CONSUME(gw)},{ALT:()=>this.CONSUME(yw)},{ALT:()=>this.CONSUME(_w)},{ALT:()=>this.CONSUME(bw)},{ALT:()=>this.CONSUME(ww)},{ALT:()=>this.CONSUME(Ew)},{ALT:()=>this.CONSUME(kw)},{ALT:()=>this.CONSUME(vw)},{ALT:()=>this.CONSUME(xw)},{ALT:()=>this.CONSUME(Aw)},{ALT:()=>this.CONSUME(Tw)},{ALT:()=>this.CONSUME(Sw)},{ALT:()=>this.CONSUME(Rw)},{ALT:()=>this.CONSUME(Ow)},{ALT:()=>this.CONSUME(Iw)},{ALT:()=>this.CONSUME(Nw)},{ALT:()=>this.CONSUME(Cw)},{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Gw)},{ALT:()=>this.CONSUME(Ww)},{ALT:()=>this.CONSUME(Hw)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(Yw)},{ALT:()=>this.CONSUME(Vw)},{ALT:()=>this.CONSUME(qw)},{ALT:()=>this.CONSUME(Xw)},{ALT:()=>this.CONSUME(Jw)},{ALT:()=>this.CONSUME(Zw)},{ALT:()=>this.CONSUME(Qw)},{ALT:()=>this.CONSUME(tE)},{ALT:()=>this.CONSUME(eE)},{ALT:()=>this.CONSUME(rE)},{ALT:()=>this.CONSUME(nE)},{ALT:()=>this.CONSUME(iE)},{ALT:()=>this.CONSUME(sE)}])}));vt(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(_E)},{ALT:()=>this.CONSUME(bE)},{ALT:()=>this.CONSUME(wE)},{ALT:()=>this.CONSUME(EE)},{ALT:()=>this.CONSUME(DE)},{ALT:()=>this.CONSUME(jE)}])}));vt(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(oE)},{ALT:()=>this.CONSUME(aE)},{ALT:()=>this.CONSUME(cE)},{ALT:()=>this.CONSUME(lE)},{ALT:()=>this.CONSUME(uE)},{ALT:()=>{this.CONSUME(hE),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}},{ALT:()=>{this.CONSUME(fE),this.SUBRULE3(this.simple_token),this.SUBRULE4(this.simple_token)}},{ALT:()=>{this.CONSUME(kE),this.SUBRULE5(this.simple_token),this.SUBRULE6(this.simple_token)}},{ALT:()=>{this.CONSUME(vE),this.SUBRULE7(this.simple_token),this.SUBRULE8(this.simple_token)}},{ALT:()=>this.CONSUME(dE)},{ALT:()=>this.CONSUME(pE)},{ALT:()=>this.CONSUME(mE)},{ALT:()=>this.CONSUME(gE)},{ALT:()=>this.CONSUME(yE)},{ALT:()=>{this.CONSUME(xE),this.SUBRULE1(this.kind)}},{ALT:()=>{this.CONSUME(AE),this.SUBRULE2(this.kind)}},{ALT:()=>{this.CONSUME(TE),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}},{ALT:()=>this.CONSUME(SE)},{ALT:()=>this.CONSUME(RE)},{ALT:()=>this.CONSUME(OE)},{ALT:()=>this.CONSUME(IE)},{ALT:()=>this.CONSUME(NE)},{ALT:()=>this.CONSUME(CE)},{ALT:()=>this.CONSUME(LE)},{ALT:()=>this.CONSUME(ME)},{ALT:()=>this.CONSUME(UE)},{ALT:()=>this.CONSUME(PE)},{ALT:()=>this.CONSUME($E)},{ALT:()=>this.CONSUME(FE)},{ALT:()=>this.CONSUME(BE)}])}));vt(this,"expr_any",this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])}));vt(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(HE),this.SUBRULE(this.expr_any)}));vt(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(KE),this.SUBRULE(this.expr_any)}));vt(this,"token_expr_blocked",this.RULED("token_expr_blocked",()=>{this.CONSUME(WE),this.SUBRULE(this.dir)}));vt(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(YE),this.SUBRULE(this.simple_token)}));vt(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(VE),this.SUBRULE(this.simple_token)}));vt(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(qE),this.SUBRULE(this.simple_token)}));vt(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(XE),this.SUBRULE(this.simple_token)}));vt(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(JE),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));vt(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(ZE),this.SUBRULE(this.simple_tokens)}));vt(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(QE),this.SUBRULE(this.simple_tokens)}));vt(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(tk),this.SUBRULE(this.simple_tokens)}));vt(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME(ek),this.SUBRULE(this.simple_token),this.SUBRULE(this.simple_tokens)}));vt(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(rk),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));vt(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(nk),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));vt(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME(ik),this.SUBRULE(this.string_token)}));vt(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(sk),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));vt(this,"token_expr",this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(zE)},{ALT:()=>this.CONSUME(GE)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])}));vt(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(mu)}])}));vt(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(rp)},{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(mu)}])}));vt(this,"simple_tokens",this.RULED("simple_tokens",()=>{this.AT_LEAST_ONE(this.simple_token)}));vt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(ep)},{ALT:()=>this.CONSUME(mu)},{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(rp)},{ALT:()=>this.CONSUME(ok)},{ALT:()=>{this.CONSUME(_k),this.SUBRULE(this.expr),this.CONSUME(bk)}}])}));this.performSelfAnalysis()}PEEK(r,n,...i){console.info(r,i.map(s=>[s.image,s.tokenType]),n)}RULED(r,n,i){const s=Y5.some(o=>r.includes(o));return this.RULE(r,()=>{const a=(Yv++).toString().padStart(3),c=s?"font-weight: bold;":"";if(Vv&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${r} ${l.join(" ")}`,c)}n(),Vv&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${r} `,c),Yv--},i)}}const Ko=new V5;if(XO){const e=Ko.getGAstProductions(),t=g$(e);console.info(t)}const q5=Ko.getBaseCstVisitorConstructor();var kt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(kt||{}),Gs=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Gs||{}),mi=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(mi||{}),Uu=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Uu||{});function Ne(e,t){const[r]=e??[];return((r==null?void 0:r.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class X5 extends q5{constructor(){super();vt(this,"unique",0);ni&&this.validateVisitor()}visit(r){if(ce(r)&&(r=r[0]),!!y(r))return this[r.name](r.children,r.location)}createcodenode(r,n){return[{...n,...r,lineindex:0}]}createstringnode(r,n){return this.createcodenode(r,{type:12,literal:1,value:n})}createtemplatenode(r,n){return this.createcodenode(r,{type:12,literal:2,value:n})}createmarknode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:3,id:n,comment:i}))}creategotonode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:4,id:n,comment:i}))}createlinenode(r,n){return this.createcodenode(r,{type:2,stmts:n})}createapinode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:1,words:i,method:n}))}createlogicnode(r,n,i,s){return this.createlinenode(r,this.createcodenode(r,{type:14,skip:i,words:s,method:n}))}createcountnode(r){return this.createcodenode(r,{type:5,index:this.unique++})}createexprnodeondemand(r,n){return r.length===1?r[0]:this.createcodenode(n,{type:31,words:r})[0]}go(r){return Array.isArray(r)?r.map(n=>this.visit(n)).flat():y(r)?[this.visit(r)].flat():[]}program(r,n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(r.line)].flat()})}line(r){return r.stmt?this.go(r.stmt):[]}stmt(r){return r.stmt_label?this.go(r.stmt_label):r.stmt_stat?this.go(r.stmt_stat):r.stmt_text?this.go(r.stmt_text):r.stmt_comment?this.go(r.stmt_comment):r.stmt_hyperlink?this.go(r.stmt_hyperlink):r.stmt_command?this.go(r.stmt_command):r.short_go?this.go(r.short_go):r.short_try?this.go(r.short_try):[]}inline_go(r){const n=[];return r.short_go&&n.push(...this.go(r.short_go)),r.inline&&n.push(...this.go(r.inline)),n}inline_try(r){const n=[];return r.short_try&&n.push(...this.go(r.short_try)),r.inline&&n.push(...this.go(r.inline)),n}inline_command(r){const n=[];return r.stmt_command&&n.push(...this.go(r.stmt_command)),r.inline&&n.push(...this.go(r.inline)),n}inline(r){const n=[];return r.stmt_stat&&n.push(...this.go(r.stmt_stat)),r.stmt_text&&n.push(...this.go(r.stmt_text)),r.stmt_comment&&n.push(...this.go(r.stmt_comment)),r.stmt_hyperlink&&n.push(...this.go(r.stmt_hyperlink)),r.inline_go&&n.push(...this.go(r.inline_go)),r.inline_try&&n.push(...this.go(r.inline_try)),r.inline_command&&n.push(...this.go(r.inline_command)),r.structured_cmd&&n.push(...this.go(r.structured_cmd)),n}stmt_label(r,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Ne(r.token_label,":").slice(1).trim()}))}stmt_stat(r,n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Ne(r.token_stat,"@").slice(1)}))}stmt_text(r,n){const i=Ne(r.token_text,"");return this.createlinenode(n,this.createcodenode(n,{type:6,value:i}))}stmt_comment(r,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Ne(r.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(r,n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:Ne(r.token_hyperlink,"!").slice(1),text:Ne(r.token_hyperlinktext,";").slice(1)}))}stmt_command(r,n){return r.structured_cmd?this.go(r.structured_cmd):this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(r.words)}))}structured_cmd(r){return r.command_if?this.go(r.command_if):r.command_while?this.go(r.command_while):r.command_repeat?this.go(r.command_repeat):r.command_waitfor?this.go(r.command_waitfor):r.command_foreach?this.go(r.command_foreach):r.command_break?this.go(r.command_break):r.command_continue?this.go(r.command_continue):[]}short_go(r,n){return r.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:[this.go(r.string_token),this.go(r.dir)].flat()})):[]}short_try(r,n){return r.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:[this.go(r.string_token),this.go(r.dir)].flat()})):[]}command_if(r,n){const[i]=this.createlogicnode(n,Ne(r.token_if,"if").toLowerCase(),"",this.go(r.words)),[s]=this.go(r.command_if_block)??[];return this.createcodenode(n,{type:13,check:i,block:s})}command_if_block(r,n){const i=We(),s=We();return this.createcodenode(n,{type:15,skip:i,done:s,lines:[this.go(r.inline),this.go(r.line),this.creategotonode(n,s,"end of if"),this.createmarknode(n,i,"alt logic")].flat(),altlines:[this.go(r.command_else_if),this.go(r.command_else),this.createmarknode(n,s,"end of if")].flat()})}command_block(r){return[this.go(r.inline),this.go(r.line)].flat()}command_fork(r){return[this.go(r.inline),this.go(r.line)].flat()}command_else_if(r,n){const i=We(),s=We();return this.createcodenode(n,{type:16,done:s,lines:[this.createlogicnode(n,Ne(r.token_if,"if"),i,this.go(r.words)),this.go(r.command_fork),this.creategotonode(n,s,"end of if"),this.createmarknode(n,i,"skip")].flat()})}command_else(r,n){const i=[];return r.words&&i.push(...this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(r.words)}))),r.command_fork&&i.push(...this.go(r.command_fork)),this.createcodenode(n,{type:17,lines:i})}command_while(r,n){const i=We(),s=We();return this.createcodenode(n,{type:18,loop:i,done:s,lines:[this.createmarknode(n,i,"start of while"),this.createlogicnode(n,"if",s,this.go(r.words)),this.go(r.command_block),this.creategotonode(n,i,"loop of while"),this.createmarknode(n,s,"end of while")].flat()})}command_repeat(r,n){const i=We(),s=We(),a=[this.createcountnode(n),this.go(r.words)].flat();return this.createcodenode(n,{type:21,loop:i,done:s,lines:[this.createapinode(n,"repeatstart",a),this.createmarknode(n,i,"start of repeat"),this.createlogicnode(n,"repeat",s,a),this.go(r.command_block),this.creategotonode(n,i,"loop of repeat"),this.createmarknode(n,s,"end of repeat")].flat()})}command_foreach(r,n){const i=We(),s=We(),a=[this.createcountnode(n),this.go(r.words)].flat();return this.createcodenode(n,{type:23,loop:i,done:s,lines:[this.createapinode(n,"foreachstart",a),this.createmarknode(n,i,"start of foreach"),this.createlogicnode(n,"foreach",s,a),this.go(r.command_block),this.creategotonode(n,i,"loop of foreach"),this.createmarknode(n,s,"end of foreach")].flat()})}command_waitfor(r,n){const i=We();return this.createcodenode(n,{type:22,loop:i,lines:[this.createmarknode(n,i,"start of waitfor"),this.createlogicnode(n,"waitfor",i,this.go(r.words))].flat()})}command_break(r,n){return this.createcodenode(n,{type:19,goto:0})}command_continue(r,n){return this.createcodenode(n,{type:20,goto:0})}command_play(r,n){const i=Ne(r.token_command_play,"").trim(),[s,...o]=i.split(" ");return[this.createstringnode(n,s),this.createstringnode(n,o.join(" "))].flat()}command_toast(r,n){const s=Ne(r.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(n,"toast"),this.createtemplatenode(n,s)].flat()}command_ticker(r,n){const s=Ne(r.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(n,"ticker"),this.createtemplatenode(n,s)].flat()}expr(r,n){return r.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}and_test(r,n){return r.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}not_test(r,n){return r.comparison?this.go(r.comparison):r.LHS?this.createcodenode(n,{type:26,items:this.go(r.LHS)}):[]}comparison(r,n){if(r.RHS){const[i]=this.go(r.comp_op);return this.createcodenode(n,{type:27,compare:i,lhs:this.createexprnodeondemand(this.go(r.LHS),n),rhs:this.createexprnodeondemand(this.go(r.RHS),n)})}return this.go(r.LHS)}comp_op(r,n){return r.token_iseq?this.createcodenode(n,{type:28,method:0}):r.token_isnoteq?this.createcodenode(n,{type:28,method:1}):r.token_islessthan?this.createcodenode(n,{type:28,method:2}):r.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):r.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):r.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(r,n){return r.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}and_test_value(r,n){return r.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}not_test_value(r,n){return r.arith_expr?this.go(r.arith_expr):r.LHS?this.createcodenode(n,{type:26,items:this.go(r.LHS)}):[]}arith_expr(r,n){if(r.LHS)return this.go(r.LHS);const i=this.go(r.term);return r.RHS?this.createcodenode(n,{type:29,lhs:i[0],items:this.go(r.RHS)}):i}arith_expr_item(r,n){return this.createcodenode(n,{type:30,operator:r.token_plus?1:2,rhs:this.go(r.term)[0]})}term(r,n){return r.term_item?this.createcodenode(n,{type:29,lhs:this.go(r.factor)[0],items:this.go(r.term_item)}):this.go(r.factor)}term_item(r,n){let i=0;return r.token_multiply&&(i=4),r.token_divide&&(i=5),r.token_moddivide&&(i=6),r.token_floordivide&&(i=7),this.createcodenode(n,{type:30,operator:i,rhs:this.go(r.factor)[0]})}factor(r,n){if(r.power)return this.go(r.power);let i=0;return r.token_plus&&(i=8),r.token_minus&&(i=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:i,rhs:this.go(r.LHS)[0]})})}power(r,n){const i=this.go(r.token);return r.factor?this.createcodenode(n,{type:29,lhs:i[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(r.factor)[0]})}):i}words(r){return this.go(r.expr)}kind(r){return[this.go(r.color),this.go(r.string_token)].flat()}category(r,n){return r.token_isterrain?this.createcodenode(n,{type:12,literal:1,value:"isterrain"}):r.token_isobject?this.createcodenode(n,{type:12,literal:1,value:"isobject"}):[]}collision(r,n){return r.token_iswalkable?this.createcodenode(n,{type:12,literal:1,value:"iswalkable"}):r.token_iswalking?this.createcodenode(n,{type:12,literal:1,value:"iswalking"}):r.token_iswalk?this.createcodenode(n,{type:12,literal:1,value:"iswalk"}):r.token_isswimmable?this.createcodenode(n,{type:12,literal:1,value:"isswimmable"}):r.token_isswimming?this.createcodenode(n,{type:12,literal:1,value:"isswimming"}):r.token_isswim?this.createcodenode(n,{type:12,literal:1,value:"isswim"}):r.token_issolid?this.createcodenode(n,{type:12,literal:1,value:"issolid"}):r.token_isbullet?this.createcodenode(n,{type:12,literal:1,value:"isbullet"}):r.token_isghost?this.createcodenode(n,{type:12,literal:1,value:"isghost"}):[]}color(r,n){let i="ERROR";return r.token_black&&(i="black"),r.token_dkblue&&(i="dkblue"),r.token_dkgreen&&(i="dkgreen"),r.token_dkcyan&&(i="dkcyan"),r.token_dkred&&(i="dkred"),r.token_dkpurple&&(i="dkpurple"),r.token_dkyellow&&(i="dkyellow"),r.token_ltgray&&(i="ltgray"),r.token_dkgray&&(i="dkgray"),r.token_blue&&(i="blue"),r.token_green&&(i="green"),r.token_cyan&&(i="cyan"),r.token_red&&(i="red"),r.token_purple&&(i="purple"),r.token_yellow&&(i="yellow"),r.token_white&&(i="white"),r.token_brown&&(i="brown"),r.token_dkwhite&&(i="dkwhite"),r.token_ltgrey&&(i="ltgrey"),r.token_gray&&(i="gray"),r.token_grey&&(i="grey"),r.token_dkgrey&&(i="dkgrey"),r.token_ltblack&&(i="ltblack"),r.token_onblack&&(i="onblack"),r.token_ondkblue&&(i="ondkblue"),r.token_ondkgreen&&(i="ondkgreen"),r.token_ondkcyan&&(i="ondkcyan"),r.token_ondkred&&(i="ondkred"),r.token_ondkpurple&&(i="ondkpurple"),r.token_ondkyellow&&(i="ondkyellow"),r.token_onltgray&&(i="onltgray"),r.token_ondkgray&&(i="ondkgray"),r.token_onblue&&(i="onblue"),r.token_ongreen&&(i="ongreen"),r.token_oncyan&&(i="oncyan"),r.token_onred&&(i="onred"),r.token_onpurple&&(i="onpurple"),r.token_onyellow&&(i="onyellow"),r.token_onwhite&&(i="onwhite"),r.token_onbrown&&(i="onbrown"),r.token_ondkwhite&&(i="ondkwhite"),r.token_onltgrey&&(i="onltgrey"),r.token_ongray&&(i="ongray"),r.token_ongrey&&(i="ongrey"),r.token_ondkgrey&&(i="ondkgrey"),r.token_onltblack&&(i="onltblack"),r.token_onclear&&(i="onclear"),this.createcodenode(n,{type:12,literal:1,value:i})}dir_mod(r,n){let i="ERROR";return r.token_cw&&(i="cw"),r.token_ccw&&(i="ccw"),r.token_opp&&(i="opp"),r.token_rndp&&(i="rndp"),r.token_over&&(i="over"),r.token_under&&(i="under"),this.createcodenode(n,{type:12,literal:1,value:i})}dir(r,n){const i=this.go(r.dir_mod)??[];return r.token_i&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"i"})),r.token_idle&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"idle"})),r.token_n&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"n"})),r.token_u&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"u"})),r.token_north&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"north"})),r.token_up&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"up"})),r.token_s&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"s"})),r.token_d&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"d"})),r.token_south&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"south"})),r.token_down&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"down"})),r.token_w&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"w"})),r.token_l&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"l"})),r.token_west&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"west"})),r.token_left&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"left"})),r.token_e&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"e"})),r.token_r&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"r"})),r.token_east&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"east"})),r.token_right&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"right"})),r.token_rnd&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rnd"})),r.token_rndne&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rndne"})),r.token_rndns&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rndns"})),r.token_flow&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"flow"})),r.token_seek&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"seek"})),r.token_by&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"by"}),...this.go(r.simple_token)),r.token_at&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"at"}),...this.go(r.simple_token)),r.token_away&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"away"}),...this.go(r.simple_token)),r.token_toward&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"toward"}),...this.go(r.simple_token)),r.token_find&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"find"}),...this.go(r.kind)),r.token_flee&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"flee"}),...this.go(r.kind)),r.token_to&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"to"}),...this.go(r.dir)),i.flat()}expr_any(r){return[this.go(r.dir),this.go(r.kind),this.go(r.color)].flat()}token_expr_any(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"any"}),this.go(r.expr_any)].flat()}token_expr_count(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"countof"}),this.go(r.expr_any)].flat()}token_expr_blocked(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"blocked"}),this.go(r.dir)].flat()}token_expr_abs(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"abs"}),...this.go(r.simple_token)]}token_expr_intceil(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intceil"}),...this.go(r.simple_token)]}token_expr_intfloor(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intfloor"}),...this.go(r.simple_token)]}token_expr_intround(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intround"}),...this.go(r.simple_token)]}token_expr_clamp(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"clamp"}),...this.go(r.simple_token)]}token_expr_min(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"min"}),...this.go(r.simple_tokens)]}token_expr_max(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"max"}),...this.go(r.simple_tokens)]}token_expr_pick(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pick"}),...this.go(r.simple_tokens)]}token_expr_pickwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pickwith"}),...this.go(r.simple_tokens)]}token_expr_random(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"random"}),...this.go(r.simple_token)]}token_expr_randomwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"randomwith"}),...this.go(r.simple_token)]}token_expr_run(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"run"}),...this.go(r.string_token)]}token_expr_runwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"runwith"}),...this.go(r.simple_token),...this.go(r.string_token)]}token_expr(r,n){return r.token_expr_aligned?this.createcodenode(n,{type:12,literal:1,value:"aligned"}):r.token_contact?this.createcodenode(n,{type:12,literal:1,value:"contact"}):r.token_expr_any?this.go(r.token_expr_any):r.token_expr_count?this.go(r.token_expr_count):r.token_expr_abs?this.go(r.token_expr_abs):r.token_expr_intceil?this.go(r.token_expr_intceil):r.token_expr_intfloor?this.go(r.token_expr_intfloor):r.token_expr_intround?this.go(r.token_expr_intround):r.token_expr_clamp?this.go(r.token_expr_clamp):r.token_expr_min?this.go(r.token_expr_min):r.token_expr_max?this.go(r.token_expr_max):r.token_expr_pick?this.go(r.token_expr_pick):r.token_expr_pickwith?this.go(r.token_expr_pickwith):r.token_expr_random?this.go(r.token_expr_random):r.token_expr_randomwith?this.go(r.token_expr_randomwith):r.token_expr_run?this.go(r.token_expr_run):r.token_expr_runwith?this.go(r.token_expr_runwith):[]}string_token(r,n){if(r.token_stringliteraldouble){const i=Ne(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Ne(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}return[]}simple_token(r,n){if(r.token_stringliteraldouble){const i=Ne(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Ne(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Ne(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}return[]}simple_tokens(r,n){if(r.token_stringliteraldouble){const i=Ne(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Ne(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Ne(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}return[]}token(r,n){if(r.category)return this.go(r.category);if(r.collision)return this.go(r.collision);if(r.color)return this.go(r.color);if(r.dir)return this.go(r.dir);if(r.command_play)return this.go(r.command_play);if(r.command_toast)return this.go(r.command_toast);if(r.command_ticker)return this.go(r.command_ticker);if(r.token_label){const i=Ne(r.token_label,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_stringliteraldouble){const i=Ne(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Ne(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Ne(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}if(r.token_lparen)return this.go(r.expr);if(r.token_stop){const i=Ne(r.token_stop,"");return this.createcodenode(n,{type:12,literal:1,value:i})}return[]}}const J5=new X5,tn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Pu="zss.js";function ie(e,t){return new K5(e.startLine??1,e.startColumn??1,Pu,t)}function Wp(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function $u(e){return`'${Wp(e)}'`}function Hp(e){const t=Tp(e);return t.errors.length?e:`['${t.tokens.map(n=>{if(n.tokenType===xp){const i=Wp(n.image.substring(1));return It(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return Wp(n.image)}).join("")}'].join('')`}function cc(e){return e.filter(t=>t!==void 0).map(le)}function qv(e){return ie(e,"")}function Z5(e,t){const r=[];return e.forEach(n=>{r.push(n,t)}),r.pop(),r}function or(e,t,r){return ie(e,[`api.${t}(`,...Z5(r,", "),")"])}function Q5(e){if(e.type===kt.COMPARE&&e.compare.type===kt.COMPARE_ITEM)switch(e.compare.method){case Gs.IS_EQ:return or(e,"isEq",[le(e.lhs),le(e.rhs)]);case Gs.IS_NOT_EQ:return or(e,"isNotEq",[le(e.lhs),le(e.rhs)]);case Gs.IS_LESS_THAN:return or(e,"isLessThan",[le(e.lhs),le(e.rhs)]);case Gs.IS_GREATER_THAN:return or(e,"isGreaterThan",[le(e.lhs),le(e.rhs)]);case Gs.IS_LESS_THAN_OR_EQ:return or(e,"isLessThanOrEq",[le(e.lhs),le(e.rhs)]);case Gs.IS_GREATER_THAN_OR_EQ:return or(e,"isGreaterThanOrEq",[le(e.lhs),le(e.rhs)])}return ie(e,"")}function Ws(e,t,r){return e.prepend(`api.${t}(`),e.add([", ",le(r),")"])}function Xv(e,t,r){return e.prepend(`api.${t}(`),e.add([le(r),")"])}function tz(e,t){if(e.type===kt.OPERATOR_ITEM)switch(e.operator){case mi.PLUS:return Ws(t,"opPlus",e.rhs);case mi.MINUS:return Ws(t,"opMinus",e.rhs);case mi.POWER:return Ws(t,"opPower",e.rhs);case mi.MULTIPLY:return Ws(t,"opMultiply",e.rhs);case mi.DIVIDE:return Ws(t,"opDivide",e.rhs);case mi.MOD_DIVIDE:return Ws(t,"opModDivide",e.rhs);case mi.FLOOR_DIVIDE:return Ws(t,"opFloorDivide",e.rhs);case mi.UNI_PLUS:return Xv(t,"opUniPlus",e.rhs);case mi.UNI_MINUS:return Xv(t,"opUniMinus",e.rhs)}return ie(e,"")}function ez(e){if(e.type===kt.OPERATOR){const t=e.lhs?le(e.lhs):ie(e,"");return e.items.forEach(r=>tz(r,t)),t}return ie(e,"")}function Fu(e,t){return ie(e,[or(e,"jump",[`${t}`]),"; continue;"])}function Bi(e){return tn.linelookup[e??""]??-1}function Kp(e,t){tn.linelookup[e]=t}function Yo(e,t,r){for(let n=0;n<e.length;++n){const i=e[n];switch(i.type){case kt.WHILE:case kt.REPEAT:case kt.FOREACH:case kt.ELSE_IF:i.type===t&&(i.done=r);break;case kt.IF_BLOCK:case kt.IF_CHECK:i.type===t&&(i.skip=r);break;case kt.LINE:Yo(i.stmts,t,r);break}}}function Jv(e,t,r){for(let n=0;n<e.length;++n){const i=e[n];switch(i.type){case kt.WHILE:case kt.REPEAT:case kt.FOREACH:case kt.ELSE_IF:i.type===t&&Kp(i.done,r);break;case kt.IF_BLOCK:case kt.IF_CHECK:i.type===t&&Kp(i.skip,r);break;case kt.LINE:Jv(i.stmts,t,r);break}}}function le(e){var t;switch(e.type){case kt.PROGRAM:return ie(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(le).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Pu}`]);case kt.API:return ie(e,["  ",or(e,e.method,cc(e.words)),`;
`]);case kt.LINE:return ie(e,[`case ${e.lineindex}:
`,...e.stmts.map(le).flat(),`  break;
`]);case kt.MARK:return ie(e,`  // ${e.comment}
`);case kt.GOTO:{const r=Bi(e.id);return ie(e,["  ",Fu(e,r),`
`])}case kt.COUNT:return ie(e,`${e.index}`);case kt.LITERAL:switch(e.literal){case Uu.NUMBER:return ie(e,`${e.value}`);case Uu.STRING:return ie(e,$u(e.value));case Uu.TEMPLATE:return ie(e,Hp(e.value))}return qv(e);case kt.TEXT:return ie(e,["  ",or(e,"text",[Hp(e.value)]),`;
`]);case kt.STAT:if(tn.isfirststat){tn.isfirststat=!1;const r=e.value.trim().split(" ").map($u);return ie(e,["  ",or(e,"stat",r),`;
`])}return ie(e,`  // skipped ${e.value}
`);case kt.LABEL:{const r=It(e.name),n=e.active?"label":"comment";tn.labels[r]||(tn.labels[r]=[]);const i=(e.active?1:-1)*e.lineindex;return tn.labels[r].push(i),ie(e,`  // ${i} '${r}' ${n}
`)}case kt.HYPERLINK:return ie(e,["  ",or(e,"hyperlink",[Hp(e.text),...e.link.split(" ").filter(r=>r.length>0).map($u)]),`;
`]);case kt.MOVE:{const r=or(e,"command",[$u("go"),cc(e.words)].flat());return e.wait?ie(e,["  if (",r,`) { continue; };
`]):ie(e,["  ",r,`;
`])}case kt.COMMAND:return ie(e,["  if (",or(e,"command",cc(e.words)),`) { continue; };
`]);case kt.IF:{const r=((t=e.block)==null?void 0:t.type)===kt.IF_BLOCK?e.block:void 0;if(y(r)){Yo([e.check],kt.IF_CHECK,r.skip);const n=ie(e,le(e.check));return r.lines.forEach(i=>n.add(le(i))),Jv(r.altlines,kt.ELSE_IF,Bi(r.done)),r.altlines.forEach(i=>n.add(le(i))),n}return ie(e,le(e.check))}case kt.IF_CHECK:{const r=Bi(e.skip);return r===-1?ie(e,["  ",or(e,e.method,cc(e.words)),`;
`]):ie(e,["  if (!",or(e,e.method,cc(e.words)),") { ",Fu(e,r),` }
`])}case kt.ELSE_IF:case kt.ELSE:{const r=ie(e,"");return e.lines.forEach(n=>r.add(le(n))),r}case kt.WHILE:{const r=Bi(e.loop),n=Bi(e.done),i=ie(e,"");return Yo(e.lines,kt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case kt.BREAK:s.goto=n;break;case kt.CONTINUE:s.goto=r;break}i.add(le(s))}),i}case kt.REPEAT:{const r=Bi(e.loop),n=Bi(e.done),i=ie(e,"");return Yo(e.lines,kt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case kt.BREAK:s.goto=n;break;case kt.CONTINUE:s.goto=r;break}i.add(le(s))}),i}case kt.WAITFOR:{const r=ie(e,"");return Yo(e.lines,kt.IF_CHECK,e.loop),e.lines.forEach(n=>{r.add(le(n))}),r}case kt.FOREACH:{const r=Bi(e.loop),n=Bi(e.done),i=ie(e,"");return Yo(e.lines,kt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case kt.BREAK:s.goto=n;break;case kt.CONTINUE:s.goto=r;break}i.add(le(s))}),i}case kt.BREAK:return ie(e,["  ",Fu(e,e.goto),`
`]);case kt.CONTINUE:return ie(e,["  ",Fu(e,e.goto),`
`]);case kt.OR:return or(e,"or",e.items.map(le));case kt.AND:return or(e,"and",e.items.map(le));case kt.NOT:return or(e,"not",e.items.map(le));case kt.COMPARE:return Q5(e);case kt.OPERATOR:return ez(e);case kt.EXPR:return or(e,"expr",e.words.map(le));default:return console.error("<unsupported node>",e.type,e),qv(e)}}function gi(e){if(y(e))switch(e.type===kt.LINE&&++tn.lineindex,e.lineindex=tn.lineindex,e.type){case kt.PROGRAM:e.lines.forEach(gi);break;case kt.LINE:e.stmts.forEach(gi);break;case kt.MARK:Kp(e.id,e.lineindex);break;case kt.IF:gi(e.check),gi(e.block);break;case kt.IF_BLOCK:e.lines.forEach(gi),e.altlines.forEach(gi);break;case kt.ELSE_IF:e.lines.forEach(gi);break;case kt.ELSE:case kt.WHILE:case kt.REPEAT:case kt.FOREACH:case kt.WAITFOR:e.lines.forEach(gi);break;case kt.MOVE:case kt.COMMAND:case kt.IF_CHECK:e.words.forEach(gi);break}}function rz(e){tn.labels={},tn.internal=1,tn.lineindex=0,tn.isfirststat=!0,gi(e)}function nz(e){return rz(e),{...le(e).toStringWithSourceMap({file:`${Pu}.map`}),...tn}}function Zv(e){return ce(e)?e.length>0?1:0:e??0}function iz(e){return`${e}_chip`}function Qv(e=""){return`vm:${e??""}`}function sz(e,t,r){var l,u;const n=iz(e),i=Nn(n);let s;const o=Yn(Object.entries(r.labels??{}));(!ce(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=r.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){E.words=d;const h=w5(t,f);return y(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){wz(n)},id(){return e},set(f,d){const[h,m]=k5(t,c,f,d);if(h)return m},get(f){const[d,h]=E5(t,c,f);if(d)return h},tick(f){const d=wt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return Lv(t,c),!1;i.lc=0,i.ys=0,E.get=c.get,v5(t,c);try{const m=s==null?void 0:s.next();m!=null&&m.done&&(i.es=1)}catch(m){de(Z,E.elementfocus,"crash",m.message),i.es=1}return Lv(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return wt(i.lc)?++i.lc>Ai.HALT_AT_COUNT:!0},haslabel(f){if(ce(i.lb))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return(m.find(_=>wt(_)&&_>0)??0)>0}return!1},hm(){if(ce(i.mg)&&ce(i.lb)){const[f]=i.mg;if(y(f))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return m.find(p=>wt(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,m){Z.emit(f,`${Qv(d)}:${h}`,m)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||c.haslabel(f.target)&&(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ce(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const m=h[1].findIndex(p=>p>0);if(m>=0&&y(h[1])){h[1][m]*=-1;break}}}},restore(f){if(ce(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let m=0;m<h[1].length;m++)h[1][m]=Math.abs(h[1][m])}},getcase(){i.ec=wt(i.ec)?i.ec:1;const f=c.hm();if(f&&ce(i.mg)){const[,d,h,m]=i.mg;c.set("sender",h),y(d)&&c.set("arg",d),m&&(c.set("player",m),E.elementfocus=m),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=wt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=FO.parse(f),[h]=d.filter(m=>m.fileName===Pu);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(Se(d)),h)},if(...f){const[d,h]=nt(f,0,[H.ANY]),m=Zv(d);return m&&h<f.length&&c.command(...f.slice(h)),m?1:0},try(...f){const[,d]=nt(f,0,[H.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,m]=nt(f,0,[H.NAME,H.ANY]),p=wt(h),_=p?m:1,w=c.get(d),v=p?h:1;if(!wt(w))return _<f.length&&c.command(...f.slice(_)),1;const A=w-v;return A<0?(_<f.length&&c.command(...f.slice(_)),1):(c.set(d,A),0)},give(...f){const[d,h,m]=nt(f,0,[H.NAME,H.ANY]),p=wt(h),_=p?m:1,w=c.get(d),v=p?h:1,A=w===void 0?1:0;return A&&_<f.length&&c.command(...f.slice(_)),c.set(d,Ea(w,0)+v),A},repeatstart(f,...d){const[h,m]=nt(d,0,[H.NUMBER]),p=`repeatcount${f}`,_=`repeatwords${f}`;i[p]=h,i[_]=m<d.length?d.slice(m):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!wt(i[d]))return 0;const m=i[d];i[d]=m-1;const p=m>0,_=i[h];return p&&ce(_)&&c.command(..._),p?1:0},foreachstart(f,...d){const[h,m,p,_]=nt(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let w=Math.min(m,p),v=Math.max(m,p);const A=(_??0)||1;if(A<0){const T=w;w=v,v=T}return c.set(h,w-A),0},foreach(f,...d){const[h,m,p,_,w]=nt(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let v=Math.min(m,p),A=Math.max(m,p);const T=(_??0)||1;if(T<0){const C=v;v=A,A=C}let I=c.get(h);!wt(I)||I<v||I>A?I=v:I+=T;const S=I<=A?1:0;return S&&(c.set(h,I),w<d.length&&c.command(...d.slice(w))),S},waitfor(...f){const[d]=nt(f,0,[H.ANY]),h=Zv(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=nt(f,h,[H.ANY]);if(d=m,d)break;h=p}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=nt(f,h,[H.ANY]);if(d=m,!d)break;h=p}return d},not(...f){const[d]=nt(f,0,[H.ANY]);return d?0:1},expr(...f){const[d]=nt(f,0,[H.ANY]);return d},isEq(f,d){const[h]=nt([f],0,[H.ANY]),[m]=nt([d],0,[H.ANY]);return typeof h=="object"||typeof m=="object"?vA(h,m)?1:0:h===m?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return h<m?1:0},isGreaterThan(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return h>m?1:0},isLessThanOrEq(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return h<=m?1:0},isGreaterThanOrEq(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return h>=m?1:0},opPlus(f,d){const[h]=nt([f],0,[H.ANY]),[m]=nt([d],0,[H.ANY]);return h+m},opMinus(f,d){const[h]=nt([f],0,[H.ANY]),[m]=nt([d],0,[H.ANY]);return h-m},opPower(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return Math.pow(h,m)},opMultiply(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return h*m},opDivide(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return h/m},opModDivide(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return h%m},opFloorDivide(f,d){const[h]=nt([f],0,[H.NUMBER]),[m]=nt([d],0,[H.NUMBER]);return Math.floor(h/m)},opUniPlus(f){const[d]=nt([f],0,[H.NUMBER]);return+d},opUniMinus(f){const[d]=nt([f],0,[H.NUMBER]);return-d}};return s=(u=r.code)==null?void 0:u.call(r,c),c}function Yp(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(r=>{if(r!=="parent"){const n=e[r];ce(n)?n.forEach(i=>{t.push(Yp(i))}):t.push(Yp(n))}}),e.range={start:Math.min(...t.filter(r=>r).map(r=>(r==null?void 0:r.start)??0)),end:Math.max(...t.filter(r=>r).map(r=>(r==null?void 0:r.end)??0))},e.range}function oz(e){const t=Nk(`${e}
`);if(t.errors.length>0)return t;Ko.input=t.tokens;const r=Ko.program();if(Ko.errors.length>0)return{tokens:t.tokens,errors:Ko.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[n]=J5.go(r);return n?(Yp(n),{tokens:t.tokens,cst:r,ast:n}):{tokens:t.tokens,cst:r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Vp=Object.getPrototypeOf(function*(){}).constructor;function az(e,t){const r=`compile-${e}`;console.time(r);const n=oz(t);if(console.timeEnd(r),Zg&&console.info(t,n.errors),n.errors&&n.errors.length>0)return console.info(t,n.tokens,n.errors),n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=nz(n.ast);if(i.code){Zg&&console.info(i.code);try{return{...n,...i,source:i.code,code:new Vp("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Vp("api"," ")}}}return{...n,...i,source:"",code:new Vp("api"," ")}}function cz(){const e={},t={};function r(i,s){const o=e[s];if(o)return o;const a=az(i,s);return e[s]=a,a}const n={ids(){return Object.keys(t)},isended(i){const s=t[i];return y(s)?s.isended():!0},halt(i){const s=t[i];return y(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=n.ids();for(let s=0;s<i.length;++s)n.isended(i[s])&&n.halt(i[s])},arg(i,s){const o=t[i];y(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!y(t[i])){const f=r(a,c);if(l=t[i]=sz(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((T,I)=>[T,I]),p=m.slice(h-2,h);for(let T=0;T<p.length;++T){const[I,S]=p[T];de(Z,$r(),"build",`$grey${S+1} $grey${I}`)}const[_,w]=m[h]??[];if(pt(_)&&y(w)){const T=(d.column??1)-1,I=T+d.length,S=T<_.length?_:`${_}*`,C=S.substring(0,T),P=S.substring(T,I),N=S.substring(I);de(Z,$r(),"build",`$red${w+1} $grey${C}$red${P}$grey${N}`)}const v=m.slice(h+1,h+3);for(let T=0;T<v.length;++T){const[I,S]=v[T];de(Z,$r(),"build",`$grey${S+1} $grey${I}`)}const A=d.message.split(`
`).slice(0,4).join(" ");return de(Z,$r(),"build",A),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=n.tick(i,s,1,o,a);return n.halt(i)&&c},message(i){const{target:s,path:o}=zr(i.target),a=t[s];if(y(a)){const c={...i,target:o};a.message(c)}}};return n}const Rr=new ma,Pr={},Bu={};function tx(e,t,r,n,i,s=0){const o=`tiles:${e}:${t}`;return y(Pr[o])||(Pr[o]=jO(e,t,r,n,i,s)),Pr[o]}function lz(e,t,r,n){const i=`sprites:${e}:${t}:${r}`,s=`sprite:${e}:${t}:${n}`;return y(Bu[s])||(Bu[s]=zO(e,t,r)),Bu[s].id=i,Bu[s]}function uz(e,t){const r=`sprites:${e}:${t}`;return y(Pr[r])||(Pr[r]=GO(e,t)),Pr[r]}function hz(e,t,r,n,i=0){const s=`dither:${e}:${t}`;return y(Pr[s])||(Pr[s]=WO(e,t,r,n,i)),Pr[s]}function Du(e,t,r,n){const i=`media:${e}:${t}`;y(Pr[i])||(Pr[i]=HO(e,t,r,n));const s=Pr[i];return s.mime=r,s.media=n,s}function fz(e,t){const r=`control:${e}:${t}`;return y(Pr[r])||(Pr[r]=KO(e,t)),Pr[r]}const os=3;function ex(e,t){const r=[],n=(e.x+.5)*Yi,i=(e.y+.5)*Vi,s=t.x*Yi,o=t.y*Vi,a=s-n,c=o-i;Rr.x=a-os,Rr.y=c-os,r.push(Rr.angle()),Rr.x=a+Yi+os,Rr.y=c-os,r.push(Rr.angle()),Rr.x=a-os,Rr.y=c+Vi+os,r.push(Rr.angle()),Rr.x=a+Yi+os,Rr.y=c+Vi+os,r.push(Rr.angle());const l=r.map(h=>Math.round(Bg(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(w=>w<180),m=l.filter(w=>w>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,f]}function ju(e,t,r,n,i,s,o,a,c){var A;const l={x:a,y:c},u=Kn(e,l);if(u===-1)return;Rr.x=a-i.x,Rr.y=Math.round((c-i.y)*1.333);const f=Rr.length();if(f>s)return;const d=Math.round(Bg(Rr.angle()));let h=0;for(let T=0;T<r.length;++T){const[I,S,C]=r[T];I>S?(d>=I||d<=S)&&(h=Math.max(h,C)):d>=I&&d<=S&&(h=Math.max(h,C))}const m=s*.5;t[u]=Math.min(t[u],h+(f<m?0:(f-m)*o)),t[u]=Ke(t[u],0,1);const p=Fr(e,((A=e.lookup)==null?void 0:A[u])??"");if(y(p)){const T=[...ex(i,l),.25];n.push(T)}const _=e.terrain[u],w=On(_),v=(_==null?void 0:_.collision)??(w==null?void 0:w.collision);if(uc(Mt.ISBULLET,v)){const T=[...ex(i,l),1];n.push(T)}}function qp(e,t,r,n,i,s){if(!y(r)||!y(r.terrain)||!y(r.objects))return[];const o=[];let a=t;const c=Tt,l=Yt,u=s?Lt.BLACK:Lt.ONCLEAR,f=tx(e,a++,"terrain",c,l,u);o.push(f);const d=a++,h=uz(e,d);h.sprites=[],o.push(h);const m=r.isdark?1:0,p=hz(e,a++,c,l,m);o.push(p),p.alphas.fill(m);const _=tx(e,a++,"tickers",c,l,Lt.ONCLEAR);o.push(_),_.char.fill(0);const w={...Sp(Tt,Yt,n,Lt.ONCLEAR),..._},v=fz(e,a++);if(i){o.push(v);const{graphics:P,camera:N,facing:z}=Nn(e),J=r.graphics??P??"",M=r.camera??N??"",O=r.facing??z??"";if(pt(J)){const k=It(J);switch(k){case"fpv":case"iso":case"flat":case"mode7":v.graphics=k;break;default:v.graphics="flat";break}}if(pt(M))switch(It(M)){default:case"mid":v.viewscale=sl.MID;break;case"near":v.viewscale=sl.NEAR;break;case"far":v.viewscale=sl.FAR;break}wt(O)&&(v.facing=Fg(O%360))}for(let P=0;P<r.terrain.length;++P){const N=r.terrain[P],z=yr(N,0,Lt.WHITE,s?Lt.BLACK:Lt.ONCLEAR),J=zt(N,"collision");f.char[P]=z.char,f.color[P]=z.color,f.bg[P]=z.bg,f.wall[P]=J===Mt.ISSOLID?1:0}const A=Object.values(r.objects??{}),T=new Set;for(let P=0;P<A.length;++P){const N=A[P];xr(N.id)&&wt(N.x)&&wt(N.y)&&T.add(Gr(N,Tt))}for(let P=0;P<A.length;++P){const N=A[P];if(y(N.removed))continue;const z=N.id??"";if(xr(z)===!1&&wt(N.x)&&wt(N.y)&&T.has(Gr(N,Tt))===!0)continue;const J=yr(N),M=lz(e,d,z,P);if(M.x=N.x??0,M.y=N.y??0,M.char=J.char,M.color=J.color,M.bg=J.bg,h.sprites.push(M),m){if(J.light>0){const O=Kn(r,M),k=Ke(Math.round(J.light),1,Yt),L=1/(k*.5);if(p.alphas[O]=0,k>1){const B=[];for(let $=1;$<=k;++$){if($===2){const st=zt(N,"lightdir");if(Wr(st)){const G=Vu(r,N,"",st,M);switch(Fn(M,G.destpt)){case yt.EAST:B.push([45,315,1]);break;case yt.WEST:B.push([225,135,1]);break;case yt.NORTH:B.push([315,225,1]);break;case yt.SOUTH:B.push([135,45,1]);break}}}const ot=[];for(let st=M.y-$;st<=M.y+$;++st)ju(r,p.alphas,B,ot,M,k,L,M.x-$,st),ju(r,p.alphas,B,ot,M,k,L,M.x+$,st);const et=$-1;for(let st=M.x-et;st<=M.x+et;++st)ju(r,p.alphas,B,ot,M,k,L,st,M.y-$),ju(r,p.alphas,B,ot,M,k,L,st,M.y+$);for(let st=0;st<ot.length;++st){const G=ot[st];let D=0;for(D=0;D<B.length;++D){const _t=B[D];if(_t[1]>_t[0]&&G[1]>=_t[0]&&G[0]<=_t[1]&&G[2]>=1&&_t[2]>=1){B[D]=[Math.min(G[0],_t[0]),Math.max(G[1],_t[1]),1];break}}D===B.length&&B.push(G)}}}}else if(xr(z)){const O=Kn(r,M);p.alphas[O]=0}}z===e&&(v.focusx=M.x,v.focusy=M.y,v.focusid=z)}for(let P=0;P<A.length;++P){const N=A[P];if(pt(N.tickertext)&&wt(N.tickertime)&&N.tickertext.length){const z=Tt,J=Qk(N.tickertext,z,Yt-1),M=(J==null?void 0:J.measuredwidth)??1,O=N.x??0,k=N.y??0,L=k<Yt*.5;w.x=O-Math.floor(M*.5),w.y=k+(L?2:-2),w.x+M>Tt&&(w.x=Tt-M),w.x<0&&(w.x=0);const B={x:w.x,y:w.y};Zk(N.tickertext,w,!0);for(let $=0;$<M;++$){const ot=Gr({x:B.x+$,y:B.y},Tt);p.alphas[ot]=Math.max(p.alphas[ot],.666)}}}o.push(Du(e,a++,"text/mood",m?"dark":"bright"));const I=ue(Dt.MAIN),S=Mi(I,Dt.MAIN);if(pt(S.palette)){const P=sr(I,bt.PALETTE,S.palette),N=Oe(P);y(N==null?void 0:N.bits)&&o.push(Du(e,a++,"image/palette",Array.from(N.bits)))}if(pt(S.charset)){const P=sr(I,bt.CHARSET,S.charset),N=Oe(P);y(N==null?void 0:N.bits)&&o.push(Du(e,a++,"image/charset",Array.from(N.bits)))}const C=Object.keys(r.objects).filter(xr);return o.push(Du(e,a++,"text/players",C.join(","))),o}const pn=cz();var Dt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Dt||{});const ke={halt:!1,session:We(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function dz(){return ke.session}function $r(){return ke.operator}function pz(e){ke.operator=e}function mz(e){ke.halt=e}function gz(){return ke.halt}function Rn(){return[...ke.books.values()]}function yz(){const[e]=ke.books.values();return e}function rx(){const e=Rn(),t=ue("main"),[r]=e.filter(n=>n.id!==(t==null?void 0:t.id));return r??t}function Hn(e){const t=It(e);return ke.books.get(e)??Rn().find(r=>r.name===t)}function nx(e,t){y(Hn(t))&&(ke.software[e]=t)}function ue(e){return Hn(ke.software[e])}function ix(e){const t=mp([]);return pt(e)&&(t.name=e),zu(t),Ae(Z,ke.operator,`created [book] ${t.name}`),t}function _z(e){let t=Hn(e);return y(t)||(t=mp([]),t.name=e),zu(t),Ae(Z,ke.operator,`created [book] ${t.name}`),t}function _r(e,t){let r=y(t)?_z(t):ue(e);return y(r)||(y(r)||(r=yz()),y(r)||(r=ix(t)),y(r)&&Ae(Z,ke.operator,`opened [book] ${r.name} for ${e}`)),nx(e,r.id),r}function as(e,t,r){return yp(_r(e),r,t)}function en(e,t){const r=ue("main"),n=bn($k(r,e,t));if(y(n))return n;const i=Rn();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(r==null?void 0:r.id)){const a=bn($k(o,e,t));if(y(a))return a}}}function On(e){if(y(e==null?void 0:e.kinddata))return e.kinddata;if(!pt(e==null?void 0:e.kind)||!e.kind)return;const t=en(bt.OBJECT,e.kind);if(y(t))return e.kinddata=Oe(t),e.kinddata;const r=en(bt.TERRAIN,e.kind);if(y(r))return e.kinddata=Oe(r),e.kinddata}function zt(e,t){const r=e==null?void 0:e.kinddata,n=(r==null?void 0:r.id)??"",i=e==null?void 0:e[t];if(y(i))return i;const s=r==null?void 0:r[t];if(y(s))return s;const o=en(bt.OBJECT,n)??en(bt.TERRAIN,n),a=R$(o,t);if(y(a))return a;switch(t){case"group":return"";case"cycle":return M0;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"item":case"pushable":case"breakable":return 0;case"collision":return Mt.ISWALK;default:return}}function Xp(e,t){const r={x:(e==null?void 0:e.x)??-1,y:(e==null?void 0:e.y)??-1},n={x:(t==null?void 0:t.x)??-1,y:(t==null?void 0:t.y)??-1},i=Fn(r,n),s=zt(t,"pushable");return wt(s)?s!==0:pt(s)?s.trim().split(" ").map(o=>Gg(Zc(o))).some(o=>o===i):!1}function In(e,t,r,n){if(!y(e)||!y(t))return;const[i,s]=t,o=en(bt.OBJECT,i);if(y(o)){const c=e0(e,r,i,n);if(y(c))return Ia(c,s),L$(e,c),On(c),zk(e,c),c}const a=en(bt.TERRAIN,i);if(y(a)){const c=Bz(e,r,i);if(y(c)){Ia(c,s);const l=Gr(r,Tt);return On(c),zk(e,c,l),c}}}function bz(e,t,r){if(!y(e)||!y(t))return;const[n,i]=t,s=en(bt.OBJECT,n);if(y(s)){const o=e0(e,r,n);return Ia(o,i),o}}function ar(e){const t=en(bt.BOARD,e);return Oe(t)}function Nn(e){const t=_r("main");return Mi(t,e)}function sx(e){const t=_r("main");return N$(t,e)}function ox(){const e=_r("main");return Mi(e,"main")}function wz(e){const t=_r("main");return Dk(t,e)}function Ez(e,t){ke.books.clear(),e.forEach(n=>{ke.books.set(n.id,n),n.name==="main"&&(ke.software.main=n.id)});const r=Hn(t);if(y(r)&&(ke.software.main=r.id),!ke.software.main){const n=ke.books.values().next();n.value&&(ke.software.main=n.value.id)}}function zu(e){return ke.books.set(e.id,e),e.id}function kz(e){const t=Hn(e);t&&ke.books.delete(t.id)}function ax(e){if(!pt(e)||!e)return de(Z,e,"login",`failed for playerid ==>${e}<==`);const t=ue("main");if(!y(t))return de(Z,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);let r=Je(e);if(y(r==null?void 0:r.objects[e]))return!0;if(!y(r)){const l=en(bt.BOARD,"title");r=Oe(l)}if(!y(r))return de(Z,e,"login:title","login failed to find board with 'title' stat");const n=en(bt.OBJECT,"player");if(!y(n))return de(Z,e,"login:player","login failed to find object type 'player'");const i=r.startx??0,s=r.starty??0,o=wt(i)?i:Math.round(Tt*.5),a=wt(s)?s:Math.round(Yt*.5),c=e0(r,{x:o,y:a},"player",e);return y(c==null?void 0:c.id)?(c.player=e,Eu(t,e,r.id),!0):!1}function vz(e){const t=ue("main"),r=ar(e);if(!y(t))return;const n=[e];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&n.push(s)}for(let i=0;i<n.length;++i){const s=n[i];Eu(t,s,""),_p(r,Fr(r,s)),bx(r,s),pn.halt(s),Dk(t,s)}}function Je(e){const t=ue("main"),r=jk(t,e,"board"),n=en(bt.BOARD,r);return Oe(n)}function xz(e){const t=ue("main"),r=D$(t,e),n=Je(e),i=Fr(n,e);return r&&y(i)}function Az(e){const t=ue("main"),r=Do(t);for(let n=0;n<r.length;++n){const i=r[n],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;xr(c)&&y(e[c])===!1&&(e[c]=0,Eu(t,c,i.id))}}}function cx(e){pn.message(e)}function cr(e,t,r,n){if(pt(r.id))if(pt(t.id))C0(Z,e,t.id,r.id,n);else{const i=`${Gr({x:t.x??0,y:t.y??0},Tt)}`;C0(Z,e,i,r.id,n)}}function Tz(e,t,r,n){const i=r.id??"";if(n.x<0){const s=ar((t==null?void 0:t.exitwest)??"");y(s)&&Bo(e,i,s.id,{x:Tt-1,y:n.y})}else if(n.x>=Tt){const s=ar((t==null?void 0:t.exiteast)??"");y(s)&&Bo(e,i,s.id,{x:0,y:n.y})}else if(n.y<0){const s=ar((t==null?void 0:t.exitnorth)??"");y(s)&&Bo(e,i,s.id,{x:n.x,y:Yt-1})}else if(n.y>=Yt){const s=ar((t==null?void 0:t.exitsouth)??"");y(s)&&Bo(e,i,s.id,{x:n.x,y:0})}}function cs(e,t,r,n){if(!y(r==null?void 0:r.id))return!1;const i=wp(t,r,n);if(y(i)){const s=xr(r.id),o=xr(r.party??r.id),a=zt(r,"collision")===Mt.ISBULLET;let c="";r.party&&o&&(c=r.party),s&&(c=r.id);const l=xr(i.id),u=xr(i.party??i.id),f=zt(i,"collision")===Mt.ISBULLET,d=o===u;let h="";if(i.party&&u&&(h=i.party),l&&(h=i.id??""),s&&i.kind==="edge"?Tz(e,t,r,n):s?l?(cr(d?"":h,i,r,"thud"),cr(d?"":c,r,i,"bump")):f?(cr(d?"":h,i,r,d?"partyshot":"shot"),cr(c,r,i,"thud")):(cr(d?"":h,i,r,"thud"),cr(d?"":c,r,i,"touch")):a?l?(cr(d?"":h,i,r,"thud"),cr(d?"":c,r,i,d?"partyshot":"shot")):f?(cr(d?"":h,i,r,"thud"),cr(d?"":c,r,i,"thud")):(cr(d?"":h,i,r,"thud"),cr(d?"":c,r,i,d?"partyshot":"shot")):l?(cr(d?"":h,i,r,"thud"),cr(d?"":c,r,i,"bump")):f?(cr(d?"":h,i,r,d?"partyshot":"shot"),cr(d?"":c,r,i,"thud")):(cr(d?"":h,i,r,"thud"),cr(d?"":c,r,i,"bump")),a&&zt(i,"breakable")){if(y(i==null?void 0:i.id)){const m=se(t,{x:i.x??-1,y:i.y??-1});y(m)&&Or(E.board,m,E.timestamp)}else Ce(t,{x:n.x,y:n.y});return!0}return!1}return!0}function lx(e,t,r,n){var l;if(!y(e)||!y(t)||!y(r))return;const i={...E};E.book=e,E.board=t,E.element=r,E.elementid=r.id??"",E.elementisplayer=xr(E.elementid);const s=E.element.player??ke.operator;E.elementfocus=E.elementisplayer?E.elementid:s;const o=zt(r,"cycle"),a=r.id??"",c=It(r.name??((l=r.kinddata)==null?void 0:l.name)??"");if(pn.tick(a,ss.RUNTIME,o,c,n),wt(r==null?void 0:r.tickertime)&&E.timestamp-r.tickertime>wc*5&&(r.tickertime=0,r.tickertext=""),E.elementisplayer){const u=Nn(E.elementid);wt(u.inputcurrent)&&(u.inputcurrent=0)}on(i).forEach(u=>{E[u]=i[u]})}function Sz(e,t){ke.loaders.set(e,t)}function Rz(e){pn.halt(e)}function Oz(){const e=pn.ids();for(let r=0;r<e.length;++r)pn.halt(e[r]);const t=ue("main");y(t)&&(t.flags={})}function Iz(e=!1){const t=ue("main");if(!y(t))return;const r=t.timestamp+1,n=Ai.HALT_AT_COUNT;Ai.HALT_AT_COUNT=n*2,ke.loaders.forEach((s,o)=>{const a={...E};E.timestamp=t.timestamp,E.book=t,E.board=void 0,E.element=void 0,E.elementid=o,E.elementisplayer=!1,E.elementfocus=$r();const c=$j(o);y(c)&&pn.arg(o,c),pn.tick(o,ss.LOADER,1,"loader",s),pn.isended(o)&&(pn.halt(o),ke.loaders.delete(o)),on(a).forEach(l=>{E[l]=a[l]})}),Ai.HALT_AT_COUNT=n,t.timestamp=r,E.timestamp=r;const i=Do(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)On(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];On(o.objects[u])}const c=$$(o,r);for(let l=0;l<c.length;++l){const{id:u,type:f,code:d,object:h}=c[l];f===bt.ERROR?pn.halt(u):(!e||xr((h==null?void 0:h.id)??""))&&lx(t,o,h,d)}}}function Vo(e,t,r,n){const i=ue("main");if(!y(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(y(c.id)){const l=`${Qv(c.id)}:${t}`;Z.emit("",l,r)}}}if(ya(e)){for(let o=0;o<n.length;++o){const a=n[o],c=se(a,e);y(c)&&s([c])}return}for(let o=0;o<n.length;++o){const a=n[o];switch(It(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(dx(a,[e]));break}}}}function Nz(e){const t=Nn(e),r=t.playbuffer=pt(t.playbuffer)?t.playbuffer:"";r&&ux(e,r,!1)}function ux(e,t,r=!0){var o;const n=_r("main");if(!y(n))return;const i=`${e}_cli`;E.timestamp=n.timestamp,E.book=n,E.board=Je(e),E.element=Fr(E.board,e),E.elementid=((o=E.element)==null?void 0:o.id)??"",E.elementisplayer=!0,E.elementfocus=E.elementid||e;const s=Ai.HALT_AT_COUNT;if(Ai.HALT_AT_COUNT=s*8,pn.once(i,ss.CLI,"cli",t),r){const a=Nn(e);a.playbuffer=t}Ai.HALT_AT_COUNT=s}function Gu(e){var a;const t=_r("main"),r=$s(t,e);if(!y(t)||!y(r)||!y(E.element))return;const n={...E},i=`${e}_run`,s=It(E.element.name??((a=E.element.kinddata)==null?void 0:a.name)??""),o=(r==null?void 0:r.code)??"";pn.once(i,ss.RUNTIME,s,o),on(n).forEach(c=>{E[c]=n[c]})}function Cz(e,t){const r=ue("main"),n=Je(e),i=[],s=[],o=[];if(!y(r)||!y(n))return{over:i,under:s,layers:o};const a=n.graphics??"flat",c=ar(n.overboard??""),l=ar(n.underboard??"");return s.push(...qp(e,0,l,t,!1,!0)),o.push(...qp(e,s.length,n,t,!0,a!=="flat")),i.push(...qp(e,s.length+o.length,c,t,!1,!1)),{over:i,under:s,layers:o}}function Hs(e){return ce(e)&&typeof e[0]=="string"}function Lz(e){const t=E.words[e];return pt(t)?[t,e+1]:[void 0,e]}function Jp(e){const t=E.words[e];if(Hs(t))return[t,e+1];const[r,n]=rl(e),[i,s]=Lz(n);return pt(i)&&(i==="empty"||On({kind:i}))?[[i,r],s]:[void 0,e]}function lc(e){if(!Hs(e))return;const[t]=e;return t}function Wu(e){if(!Hs(e))return;const[,t]=e,r=y(t)?tl(t):void 0;return y(r)?r:void 0}function hx(e){if(!Hs(e))return;const[,t]=e,r=y(t)?el(t):void 0;return y(r)?vf(r):void 0}function uc(e,t){const r=e??Mt.ISWALK,n=t??Mt.ISWALK;if(r===Mt.ISGHOST||n===Mt.ISGHOST)return!1;switch(r){case Mt.ISWALK:return n!==Mt.ISWALK;case Mt.ISSWIM:return n!==Mt.ISSWIM;case Mt.ISSOLID:return!0;case Mt.ISBULLET:return n!==Mt.ISWALK&&n!==Mt.ISSWIM}}function hc(e,t,r){const n=e==null?void 0:e.objects[r];if(y(n))return n;const i=fc(e,"player");return y(t)?(t.x<0&&(t.x=_n(0,Tt-1)),t.y<0&&(t.y=_n(0,Yt-1)),px(t,i)):bn(...i)}function fc(e,t){var i;const r=(i=e==null?void 0:e.named)==null?void 0:i[t];return y(r)?[...r.values()].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(y):[]}function Mz(e){const t=[];for(let r=0;r<Yt;++r)for(let n=0;n<Tt;++n){const i={x:n,y:r},s=se(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Zp(e,t,r,n){if(!y(e))return!1;const i=yr(e);return!(y(t)&&t!==i.name||y(r)&&r!==i.color||y(n)&&n!==i.bg)}function Hu(e,t){const r=lc(t),n=Wu(t),i=hx(t);return fc(e,r??"").filter(s=>Zp(s,r,n,i))}function fx(e,t){const r=y(t)?tl(t):void 0,n=y(t)?el(t):void 0,i=[];if(y(e)){for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];y(a)&&Zp(a,void 0,r,n)&&i.push(a)}const s=Object.values(e.objects);for(let o=0;o<s.length;++o){const a=s[o];Zp(a,void 0,r,n)&&i.push(a)}}return i}function dx(e,t){return y(e)?t.map(r=>{var n;if(typeof r=="string"){const i=e.objects[r];if(y(i))return i;const s=fc(e,It(r));if(s.length)return s}else if(ya(r)&&r.x>=0&&r.x<Tt&&r.y>=0&&r.y<Yt){const i=r.x+r.y*Tt,s=(n=e.lookup)==null?void 0:n[i];return y(s)?e.objects[s]:e.terrain[i]}}).flat().filter(y):[]}function px(e,t){let r=0,n;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(n===void 0||c<r)&&(r=c,n=s)}}return n}function Uz(e,t,r,n){if(!y(e))return;y(e.distmaps)||(e.distmaps={});const i=`${t}.${r.x}.${r.y}.${n.x}.${n.y}`;let s=e.distmaps[i];if(!y(s)){s=new Array(Af).fill(-2);const o=[{...n}];let a=0;for(;o.length;){const c=o.shift();if(y(c)&&Yu(c)){const l=Gr(c,Tt);if(s[l]===-2){const u=ls(e,c.x,c.y);uc(t,zt(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function mx(e,t){return Yu(e)?t[Gr(e,Tt)]:-1}function gx(e,t,r,n,i){if(!y(e))return;const s=Uz(e,t,r,n);if(!y(s))return;const o=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=mx(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=mx(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function Pz(){return new Array(Tt*Yt).map(()=>{})}function Ku(e=fh){const t={terrain:Pz(),objects:{},id:""};return e(t)}var Qp=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(Qp||{});function $z(e){return Oo(e,Qp,{terrain:t=>t.map(xl),objects:t=>Object.values(t).filter(r=>!r.removed).map(xl),id:Re,named:Re,lookup:Re,codepage:Re,distmaps:Re,overboard:Re,underboard:Re})}function Fz(e){return Oa(e,Qp,{terrain:t=>t.map(Al),objects:t=>{const r={};for(let n=0;n<t.length;++n){const i=Al(t[n]);y(i==null?void 0:i.id)&&(r[i.id]=i)}return r}})}function Yu(e){return mf(e.x,e.y,0,Tt-1,Yt-1,0)}function Kn(e,t){return!y(e)||!y(t==null?void 0:t.x)||!y(t==null?void 0:t.y)||t.x<0||t.x>=Tt||t.y<0||t.y>=Yt?-1:t.x+t.y*Tt}function se(e,t){const r=Kn(e,t);if(r<0||!y(e==null?void 0:e.lookup))return;const n=Fr(e,e.lookup[r]??"");return y(n)?n:e.terrain[r]}function yx(e,t){const r=Fr(e,t);if(y(r))return r;const n=parseFloat(t),i=EO(isNaN(n)?-1:n,Tt);return ls(e,i.x,i.y)}function ls(e,t,r){return(t>=0&&t<Tt)??(r>=0&&r<Yt)?e==null?void 0:e.terrain[t+r*Tt]:void 0}function Ce(e,t){if(!y(e)||!y(t)||!y(t.x)||!y(t.y)||t.x<0||t.x>=Tt||t.y<0||t.y>=Yt)return;const r=Yn(t),n=t.x+t.y*Tt;return e.terrain[n]=r,delete e.distmaps,e.terrain[n]}function t0(e,t){if(!y(e)||!y(t))return;const r=Yn(t);return r.id=r.id??We(),e.objects[r.id]=r,e.objects[r.id]}function Bz(e,t,r){return Ce(e,{...t,kind:r})}function e0(e,t,r,n){return t0(e,{...t,kind:r,id:n})}function Fr(e,t){if(e)return e.objects[t]}function _x(e,t){const r=Kn(e,t);if(r<0||!y(e==null?void 0:e.lookup))return;const n=Fr(e,e.lookup[r]??"");if(y(n))return n}function Or(e,t,r){return!y(t)||yr(t).name==="player"?!1:(t.id?(t.removed=r,_p(e,t)):(Ce(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),M$(e,t)),!0)}function bx(e,t){return y(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function Dz(e,t,r){if(!y(e)||!y(t))return;const n=e.objects[r];if(y(n))return n;if(ya(t))return px(t,fc(e,"player"))}function Vu(e,t,r,n,i){const s=yt.MID;if(!y(e)||!y(t))return{dir:n,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:o.x+(t.stepx??0),y:o.y+(t.stepy??0)},c=Fn(o,a),l=Tt-1,u=Yt-1;for(let f=0;f<n.length;++f){const d=Gg(n[f]);switch(d){case yt.IDLE:break;case yt.NORTH:case yt.SOUTH:case yt.WEST:case yt.EAST:De(o,d);break;case yt.BY:{const[h,m]=n.slice(f+1);wt(h)&&wt(m)&&(o.x=Ke(o.x+h,0,l),o.y=Ke(o.y+m,0,u)),f+=2;break}case yt.TO:{const[h,m]=n.slice(f+1);wt(h)&&wt(m)&&(o.x=Ke(h,0,l),o.y=Ke(m,0,u)),f+=2;break}case yt.AT:{const[h,m]=n.slice(f+1);wt(h)&&wt(m)&&(o.x=Ke(h,0,l),o.y=Ke(m,0,u)),f+=2;break}case yt.FLOW:De(o,c);break;case yt.SEEK:{const h=Dz(e,t,r);ya(h)&&De(o,Fn(i,h));break}case yt.RNDNS:De(o,bn(yt.NORTH,yt.SOUTH));break;case yt.RNDNE:De(o,bn(yt.NORTH,yt.EAST));break;case yt.RND:De(o,bn(yt.NORTH,yt.SOUTH,yt.WEST,yt.EAST));break;case yt.CW:case yt.CCW:case yt.OPP:case yt.RNDP:{const h=Vu(e,t,r,n.slice(f+1),i);switch(o.x=i.x,o.y=i.y,d){case yt.CW:switch(Fn(i,h.destpt)){case yt.NORTH:De(o,yt.EAST);break;case yt.SOUTH:De(o,yt.WEST);break;case yt.EAST:De(o,yt.SOUTH);break;case yt.WEST:De(o,yt.NORTH);break}break;case yt.CCW:switch(Fn(i,h.destpt)){case yt.NORTH:De(o,yt.WEST);break;case yt.SOUTH:De(o,yt.EAST);break;case yt.EAST:De(o,yt.NORTH);break;case yt.WEST:De(o,yt.SOUTH);break}break;case yt.OPP:switch(Fn(i,h.destpt)){case yt.NORTH:De(o,yt.SOUTH);break;case yt.SOUTH:De(o,yt.NORTH);break;case yt.EAST:De(o,yt.WEST);break;case yt.WEST:De(o,yt.EAST);break}break;case yt.RNDP:switch(Fn(i,h.destpt)){case yt.NORTH:case yt.SOUTH:o.x+=bn(-1,1);break;case yt.WEST:case yt.EAST:o.y+=bn(-1,1);break}break}return{dir:n,startpt:i,destpt:o,layer:s}}case yt.FLEE:break;case yt.AWAY:{const[h,m]=n.slice(f+1);if(wt(h)&&wt(m)){const p={x:Ke(h,0,l),y:Ke(m,0,u)},_=p.x-o.x,w=p.y-o.y;if(Math.abs(_)>1||Math.abs(w)>1){const v=zt(t,"collision"),A=gx(e,v,o,p,!0);y(A)&&A.x!==h&&A.y!==m&&!_x(e,A)&&(o.x=A.x,o.y=A.y)}else{const v=Ef(-_,-w);De(o,v)}}f+=2;break}case yt.FIND:break;case yt.TOWARD:{const[h,m]=n.slice(f+1);if(wt(h)&&wt(m)){const p={x:Ke(h,0,l),y:Ke(m,0,u)},_=p.x-o.x,w=p.y-o.y;if(Math.abs(_)>1||Math.abs(w)>1){const v=zt(t,"collision"),A=gx(e,v,o,p,!1);y(A)&&A.x!==h&&A.y!==m&&!_x(e,A)&&(o.x=A.x,o.y=A.y)}else{const v=Ef(_,w);De(o,v)}}f+=2;break}case yt.OVER:case yt.UNDER:{const h=Vu(e,t,r,n.slice(f+1),i);return h.layer=d,h}}}return{dir:n,startpt:i,destpt:o,layer:s}}const E={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var H=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.COLOR_OR_KIND=7]="COLOR_OR_KIND",e[e.MAYBE_KIND=8]="MAYBE_KIND",e[e.MAYBE_NAME=9]="MAYBE_NAME",e[e.MAYBE_NUMBER=10]="MAYBE_NUMBER",e[e.MAYBE_STRING=11]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",e[e.ANY=13]="ANY",e))(H||{});function br(e,t,r){throw console.info(r,E.element,E.elementid,E.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function wx(e){var r,n;const t={x:((r=E.element)==null?void 0:r.x)??0,y:((n=E.element)==null?void 0:n.y)??0};return Vu(E.board,E.element,E.elementfocus,e,t)}function nt(e,t,r){const n=E.words;E.words=e;const i=[];let s=t;for(let o=0;o<r.length;++o)switch(r[o]){case 1:{const[a,c]=Jp(s);Hs(a)?(s=c,i.push(a)):br("kind",a,e);break}case 0:{if(ba(e[s])===void 0){const[a,c]=Ur(s);Ir(a)?(s=c,i.push(a)):br("color",a,e)}else{const[a,c]=rl(s);Ir(a)?(s=c,i.push(a)):br("color",a,e)}break}case 2:{if(Zc(e[s])===void 0){const[a,c]=Ur(s);Wr(a)?(s=c,i.push(wx(a))):br("direction",a,e)}else{const[a,c]=Hg(s);Wr(a)?(s=c,i.push(wx(a))):br("direction",a,e)}break}case 3:{const a=E.words[s];pt(a)||br("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Ur(s);if(pt(a)){const l=parseFloat(a);wt(l)?i.push(l):br("number",a,e)}else wt(a)?i.push(a):br("number",a,e);s=c;break}case 5:{const[a,c]=Ur(s);pt(a)||br("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Ur(s);let l=a;if(pt(l)){const u=parseFloat(l);wt(u)&&(l=u)}else wt(l)||br("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=Jp(s);if(Hs(a))s=c,i.push(a);else if(ba(e[s])===void 0){const[l,u]=Ur(s);Ir(l)?(s=u,i.push(l)):br("color",l,e)}else{const[l,u]=rl(s);Ir(l)?(s=u,i.push(l)):br("color or kind",l,e)}break}case 8:{const[a,c]=Jp(s);a!==void 0&&!Hs(a)&&br("optional kind",a,e),s=c,i.push(a);break}case 9:{const a=E.words[s];a!==void 0&&!pt(a)&&br("optional string",a,e),++s,i.push(a);break}case 10:{const[a,c]=Ur(s);if(pt(a)){const l=parseFloat(a);wt(l)?i.push(l):br("optional number",a,e)}else wt(a)||a===void 0?i.push(a):br("optional number",a,e);s=c;break}case 11:{const[a,c]=Ur(s);a!==void 0&&!pt(a)&&br("optional string",a,e),s=c,i.push(a);break}case 12:{const[a,c]=Ur(s);let l=a;if(pt(l)){const u=parseFloat(l);wt(u)&&(l=u)}else l!==void 0&&!wt(l)&&br("number or string",l,e);s=c,i.push(l);break}case 13:{const[a,c]=Ur(s);s=c,i.push(a);break}}return E.words=n,[...i,s]}const qu={},qo={};function r0(){return{id:We(),layers:[],scroll:[],sidebar:[]}}const jz=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),zz=new Set(["tx","text"]),Gz={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Ex={};let kx=e=>{let t=Ex[e];return y(t)||(Ex[e]=t=r0()),t};function Wz(e){kx=e}function Le(e){return kx(e)}function n0(e){return y(qu[e])||(qu[e]=[]),qu[e]}function Hz(e){const t=Le(e);t.scrollname="",t.scroll=[]}function Kz(e,t,r){Object.values(qo).forEach(n=>{if(n[t]!==void 0){const i=Jg(e.id(),t);wt(r)&&_O(i,r),pt(r)&&bO(i,r)}})}function lr(e){const t=n0(e);return qu[e]=[],t}function vx(e){const t=[];for(let r=0;r<e.length;++r){const n=e[r];pt(n)&&y(q$(n))?t.push(" ",n," "):t.push(n)}return t}function At(e,t){n0(e).push(t)}function Nt(e,t,r,n,i=()=>0,s=fh){const o=[t,r,...n],a=It(`${o[3]}`),c={...E};function l(u,f){y(f)&&f!==i(u)&&(E.board=c.board,E.element=c.element,E.elementfocus=c.elementfocus,s(u,f))}if(jz.has(a)){const u=`${o[2]}`;qo[t]=qo[t]??{};const f=i(u)??Gz[a];if(qo[t][u]===void 0){const d=Jg(t,u);wt(f)&&yO(d,f),pt(f)&&pf(d,f),zz.has(a)?qo[t][u]=Tg(d,h=>{l(u,h)}):qo[t][u]=wO(d,h=>{l(u,h)})}}n0(e).push(o)}Wz(e=>{if(xr(e)){const t=ue(Dt.MAIN),r=Mi(t,Dt.GADGETSTORE);let n=r[e];return y(n)||(r[e]=n=r0()),n}return r0()});let xx=0;function Yz(){switch(xx++){case 0:return Lt.BLUE;case 1:return Lt.BLACK;case 2:return Lt.GREEN;case 3:return Lt.BLACK;case 4:return Lt.CYAN;case 5:return Lt.BLACK;case 6:return Lt.RED;case 7:return Lt.BLACK;case 8:return Lt.PURPLE;case 9:return Lt.BLACK;case 10:return Lt.YELLOW;case 11:return Lt.BLACK;case 12:return Lt.WHITE;default:return xx=0,Lt.BLACK}}const Xu=Vs("gadgetserver",["tock","second"],e=>{if(!Xu.session(e))return;const t=ue(Dt.MAIN),r=[...(t==null?void 0:t.activelist)??[],$r()],n=[...new Set(r.values())],i=Mi(t,Dt.GADGETSYNC);switch(e.target){case"tock":{const s=Yz();for(let o=0;o<n.length;++o){const a=n[o],{over:c,under:l,layers:u}=Cz(a,s),f=Le(a);f.over=c,f.under=l,f.layers=u;const d=i[a]??{},h=A0(d,f);h.length&&(i[a]=Yn(f),DA(Xu,a,h))}break}case"second":for(let s=0;s<n.length;++s){const o=n[s],a=Je(o);y(a)&&eT(Xu,o,a.id)}break;case"desync":BA(Xu,e.player,Le(e.player));break;case"clearscroll":Hz(e.player);break;case"clearplayer":{const s=Mi(t,Dt.GADGETSTORE);delete s[e.player];const o=Mi(t,Dt.GADGETSYNC);delete o[e.player];break}}});function Ju(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ax={exports:{}};(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,i,s){function o(l,u){if(!i[l]){if(!n[l]){var f=typeof Ju=="function"&&Ju;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};n[l][0].call(h.exports,function(m){var p=n[l][1][m];return o(p||m)},h,h.exports,r,n,i,s)}return i[l].exports}for(var a=typeof Ju=="function"&&Ju,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(r,n,i){var s=r("./utils"),o=r("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,m,p,_=[],w=0,v=c.length,A=v,T=s.getTypeOf(c)!=="string";w<c.length;)A=v-w,f=T?(l=c[w++],u=w<v?c[w++]:0,w<v?c[w++]:0):(l=c.charCodeAt(w++),u=w<v?c.charCodeAt(w++):0,w<v?c.charCodeAt(w++):0),d=l>>2,h=(3&l)<<4|u>>4,m=1<A?(15&u)<<2|f>>6:64,p=2<A?63&f:64,_.push(a.charAt(d)+a.charAt(h)+a.charAt(m)+a.charAt(p));return _.join("")},i.decode=function(c){var l,u,f,d,h,m,p=0,_=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var v,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|A):new Array(0|A);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(p++)))>>2,f=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),v[_++]=l,h!==64&&(v[_++]=u),m!==64&&(v[_++]=f);return v}},{"./support":30,"./utils":32}],2:[function(r,n,i){var s=r("./external"),o=r("./stream/DataWorker"),a=r("./stream/Crc32Probe"),c=r("./stream/DataLengthProbe");function l(u,f,d,h,m){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},n.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,i){var s=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,i){var s=r("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();n.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(r,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,n,i){var s=null;s=typeof Promise<"u"?Promise:r("lie"),n.exports={Promise:s}},{lie:37}],7:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),a=r("./utils"),c=r("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,i){function s(h,m){var p,_="";for(p=0;p<m;p++)_+=String.fromCharCode(255&h),h>>>=8;return _}function o(h,m,p,_,w,v){var A,T,I=h.file,S=h.compression,C=v!==l.utf8encode,P=a.transformTo("string",v(I.name)),N=a.transformTo("string",l.utf8encode(I.name)),z=I.comment,J=a.transformTo("string",v(z)),M=a.transformTo("string",l.utf8encode(z)),O=N.length!==I.name.length,k=M.length!==z.length,L="",B="",$="",ot=I.dir,et=I.date,st={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(st.crc32=h.crc32,st.compressedSize=h.compressedSize,st.uncompressedSize=h.uncompressedSize);var G=0;m&&(G|=8),C||!O&&!k||(G|=2048);var D=0,_t=0;ot&&(D|=16),w==="UNIX"?(_t=798,D|=function(at,Ft){var Wt=at;return at||(Wt=Ft?16893:33204),(65535&Wt)<<16}(I.unixPermissions,ot)):(_t=20,D|=function(at){return 63&(at||0)}(I.dosPermissions)),A=et.getUTCHours(),A<<=6,A|=et.getUTCMinutes(),A<<=5,A|=et.getUTCSeconds()/2,T=et.getUTCFullYear()-1980,T<<=4,T|=et.getUTCMonth()+1,T<<=5,T|=et.getUTCDate(),O&&(B=s(1,1)+s(u(P),4)+N,L+="up"+s(B.length,2)+B),k&&($=s(1,1)+s(u(J),4)+M,L+="uc"+s($.length,2)+$);var q="";return q+=`
\0`,q+=s(G,2),q+=S.magic,q+=s(A,2),q+=s(T,2),q+=s(st.crc32,4),q+=s(st.compressedSize,4),q+=s(st.uncompressedSize,4),q+=s(P.length,2),q+=s(L.length,2),{fileRecord:f.LOCAL_FILE_HEADER+q+P+L,dirRecord:f.CENTRAL_FILE_HEADER+s(_t,2)+q+s(J.length,2)+"\0\0\0\0"+s(D,4)+s(_,4)+P+L+J}}var a=r("../utils"),c=r("../stream/GenericWorker"),l=r("../utf8"),u=r("../crc32"),f=r("../signature");function d(h,m,p,_){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=_,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-_-1))/p:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(_){return f.DATA_DESCRIPTOR+s(_.crc32,4)+s(_.compressedSize,4)+s(_.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,_=function(w,v,A,T,I){var S=a.transformTo("string",I(T));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(v,4)+s(A,4)+s(S.length,2)+S}(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},n.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,i){var s=r("../compressions"),o=r("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var m=function(v,A){var T=v||A,I=s[T];if(!I)throw new Error(T+" is not a valid compression method !");return I}(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},_=h.dir,w=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:d,dir:_,date:w,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=r("./object")).loadAsync=r("./load"),s.support=r("./support"),s.defaults=r("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=r("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,i){var s=r("./utils"),o=r("./external"),a=r("./utf8"),c=r("./zipEntries"),l=r("./stream/Crc32Probe"),u=r("./nodejsUtils");function f(d){return new o.Promise(function(h,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(_){m(_)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}n.exports=function(d,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(p){var _=new c(h);return _.load(p),_}).then(function(p){var _=[o.Promise.resolve(p)],w=p.files;if(h.checkCRC32)for(var v=0;v<w.length;v++)_.push(f(w[v]));return o.Promise.all(_)}).then(function(p){for(var _=p.shift(),w=_.files,v=0;v<w.length;v++){var A=w[v],T=A.fileNameStr,I=s.resolve(A.fileNameStr);m.file(I,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:h.createFolders}),A.dir||(m.file(I).unsafeOriginalName=T)}return _.zipComment.length&&(m.comment=_.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,i){var s=r("../utils"),o=r("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,i){var s=r("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}r("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,i){n.exports={isNode:typeof wr<"u",newBufferFrom:function(s,o){if(wr.from&&wr.from!==Uint8Array.from)return wr.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new wr(s,o)},allocBuffer:function(s){if(wr.alloc)return wr.alloc(s);var o=new wr(s);return o.fill(0),o},isBuffer:function(s){return wr.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(r,n,i){function s(I,S,C){var P,N=a.getTypeOf(S),z=a.extend(C||{},u);z.date=z.date||new Date,z.compression!==null&&(z.compression=z.compression.toUpperCase()),typeof z.unixPermissions=="string"&&(z.unixPermissions=parseInt(z.unixPermissions,8)),z.unixPermissions&&16384&z.unixPermissions&&(z.dir=!0),z.dosPermissions&&16&z.dosPermissions&&(z.dir=!0),z.dir&&(I=w(I)),z.createFolders&&(P=_(I))&&v.call(this,P,!0);var J=N==="string"&&z.binary===!1&&z.base64===!1;C&&C.binary!==void 0||(z.binary=!J),(S instanceof f&&S.uncompressedSize===0||z.dir||!S||S.length===0)&&(z.base64=!1,z.binary=!0,S="",z.compression="STORE",N="string");var M=null;M=S instanceof f||S instanceof c?S:m.isNode&&m.isStream(S)?new p(I,S):a.prepareContent(I,S,z.binary,z.optimizedBinaryString,z.base64);var O=new d(I,M,z);this.files[I]=O}var o=r("./utf8"),a=r("./utils"),c=r("./stream/GenericWorker"),l=r("./stream/StreamHelper"),u=r("./defaults"),f=r("./compressedObject"),d=r("./zipObject"),h=r("./generate"),m=r("./nodejsUtils"),p=r("./nodejs/NodejsStreamInputAdapter"),_=function(I){I.slice(-1)==="/"&&(I=I.substring(0,I.length-1));var S=I.lastIndexOf("/");return 0<S?I.substring(0,S):""},w=function(I){return I.slice(-1)!=="/"&&(I+="/"),I},v=function(I,S){return S=S!==void 0?S:u.createFolders,I=w(I),this.files[I]||s.call(this,I,null,{dir:!0,createFolders:S}),this.files[I]};function A(I){return Object.prototype.toString.call(I)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(I){var S,C,P;for(S in this.files)P=this.files[S],(C=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&I(C,P)},filter:function(I){var S=[];return this.forEach(function(C,P){I(C,P)&&S.push(P)}),S},file:function(I,S,C){if(arguments.length!==1)return I=this.root+I,s.call(this,I,S,C),this;if(A(I)){var P=I;return this.filter(function(z,J){return!J.dir&&P.test(z)})}var N=this.files[this.root+I];return N&&!N.dir?N:null},folder:function(I){if(!I)return this;if(A(I))return this.filter(function(N,z){return z.dir&&I.test(N)});var S=this.root+I,C=v.call(this,S),P=this.clone();return P.root=C.name,P},remove:function(I){I=this.root+I;var S=this.files[I];if(S||(I.slice(-1)!=="/"&&(I+="/"),S=this.files[I]),S&&!S.dir)delete this.files[I];else for(var C=this.filter(function(N,z){return z.name.slice(0,I.length)===I}),P=0;P<C.length;P++)delete this.files[C[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(I){var S,C={};try{if((C=a.extend(I||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var P=C.comment||this.comment||"";S=h.generateWorker(this,C,P)}catch(N){(S=new c("error")).error(N)}return new l(S,C.type||"string",C.mimeType)},generateAsync:function(I,S){return this.generateInternalStream(I).accumulate(S)},generateNodeStream:function(I,S){return(I=I||{}).type||(I.type="nodebuffer"),this.generateInternalStream(I).toNodejsStream(S)}};n.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,i){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,i){var s=r("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(r,n,i){var s=r("./Uint8ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,i){var s=r("./ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,i){var s=r("../utils"),o=r("../support"),a=r("./ArrayReader"),c=r("./StringReader"),l=r("./NodeBufferReader"),u=r("./Uint8ArrayReader");n.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,i){var s=r("./GenericWorker"),o=r("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,i){var s=r("./GenericWorker"),o=r("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(r,n,i){var s=r("../utils"),o=r("./ConvertWorker"),a=r("./GenericWorker"),c=r("../base64"),l=r("../support"),u=r("../external"),f=null;if(l.nodestream)try{f=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(_,w){var v=[],A=m._internalType,T=m._outputType,I=m._mimeType;m.on("data",function(S,C){v.push(S),p&&p(C)}).on("error",function(S){v=[],w(S)}).on("end",function(){try{var S=function(C,P,N){switch(C){case"blob":return s.newBlob(s.transformTo("arraybuffer",P),N);case"base64":return c.encode(P);default:return s.transformTo(C,P)}}(T,function(C,P){var N,z=0,J=null,M=0;for(N=0;N<P.length;N++)M+=P[N].length;switch(C){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(J=new Uint8Array(M),N=0;N<P.length;N++)J.set(P[N],z),z+=P[N].length;return J;case"nodebuffer":return wr.concat(P);default:throw new Error("concat : unsupported type '"+C+"'")}}(A,v),I);_(S)}catch(C){w(C)}v=[]}).resume()})}function h(m,p,_){var w=p;switch(p){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=p,this._mimeType=_,s.checkSupport(w),this._worker=m.pipe(new o(w)),m.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var _=this;return m==="data"?this._worker.on(m,function(w){p.call(_,w.data,w.meta)}):this._worker.on(m,function(){s.delay(p,arguments,_)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof wr<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,i){for(var s=r("./utils"),o=r("./support"),a=r("./nodejsUtils"),c=r("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(m){var p,_,w,v,A,T=m.length,I=0;for(v=0;v<T;v++)(64512&(_=m.charCodeAt(v)))==55296&&v+1<T&&(64512&(w=m.charCodeAt(v+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),v++),I+=_<128?1:_<2048?2:_<65536?3:4;for(p=o.uint8array?new Uint8Array(I):new Array(I),v=A=0;A<I;v++)(64512&(_=m.charCodeAt(v)))==55296&&v+1<T&&(64512&(w=m.charCodeAt(v+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),v++),_<128?p[A++]=_:(_<2048?p[A++]=192|_>>>6:(_<65536?p[A++]=224|_>>>12:(p[A++]=240|_>>>18,p[A++]=128|_>>>12&63),p[A++]=128|_>>>6&63),p[A++]=128|63&_);return p}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(m){var p,_,w,v,A=m.length,T=new Array(2*A);for(p=_=0;p<A;)if((w=m[p++])<128)T[_++]=w;else if(4<(v=l[w]))T[_++]=65533,p+=v-1;else{for(w&=v===2?31:v===3?15:7;1<v&&p<A;)w=w<<6|63&m[p++],v--;1<v?T[_++]=65533:w<65536?T[_++]=w:(w-=65536,T[_++]=55296|w>>10&1023,T[_++]=56320|1023&w)}return T.length!==_&&(T.subarray?T=T.subarray(0,_):T.length=_),s.applyFromCharCode(T)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var _=function(v,A){var T;for((A=A||v.length)>v.length&&(A=v.length),T=A-1;0<=T&&(192&v[T])==128;)T--;return T<0||T===0?A:T+l[v[T]]>A?T:A}(m),w=m;_!==m.length&&(o.uint8array?(w=m.subarray(0,_),this.leftOver=m.subarray(_,m.length)):(w=m.slice(0,_),this.leftOver=m.slice(_,m.length))),this.push({data:i.utf8decode(w),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,i){var s=r("./support"),o=r("./base64"),a=r("./nodejsUtils"),c=r("./external");function l(p){return p}function u(p,_){for(var w=0;w<p.length;++w)_[w]=255&p.charCodeAt(w);return _}r("setimmediate"),i.newBlob=function(p,_){i.checkSupport("blob");try{return new Blob([p],{type:_})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(p),w.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,_,w){var v=[],A=0,T=p.length;if(T<=w)return String.fromCharCode.apply(null,p);for(;A<T;)_==="array"||_==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(A,Math.min(A+w,T)))):v.push(String.fromCharCode.apply(null,p.subarray(A,Math.min(A+w,T)))),A+=w;return v.join("")},stringifyByChar:function(p){for(var _="",w=0;w<p.length;w++)_+=String.fromCharCode(p[w]);return _},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var _=65536,w=i.getTypeOf(p),v=!0;if(w==="uint8array"?v=f.applyCanBeUsed.uint8array:w==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<_;)try{return f.stringifyByChunk(p,w,_)}catch{_=Math.floor(_/2)}return f.stringifyByChar(p)}function h(p,_){for(var w=0;w<p.length;w++)_[w]=p[w];return _}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,_){if(_=_||"",!p)return _;i.checkSupport(p);var w=i.getTypeOf(_);return m[w][p](_)},i.resolve=function(p){for(var _=p.split("/"),w=[],v=0;v<_.length;v++){var A=_[v];A==="."||A===""&&v!==0&&v!==_.length-1||(A===".."?w.pop():w.push(A))}return w.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var _,w,v="";for(w=0;w<(p||"").length;w++)v+="\\x"+((_=p.charCodeAt(w))<16?"0":"")+_.toString(16).toUpperCase();return v},i.delay=function(p,_,w){setImmediate(function(){p.apply(w||null,_||[])})},i.inherits=function(p,_){function w(){}w.prototype=_.prototype,p.prototype=new w},i.extend=function(){var p,_,w={};for(p=0;p<arguments.length;p++)for(_ in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],_)&&w[_]===void 0&&(w[_]=arguments[p][_]);return w},i.prepareContent=function(p,_,w,v,A){return c.Promise.resolve(_).then(function(T){return s.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new c.Promise(function(I,S){var C=new FileReader;C.onload=function(P){I(P.target.result)},C.onerror=function(P){S(P.target.error)},C.readAsArrayBuffer(T)}):T}).then(function(T){var I=i.getTypeOf(T);return I?(I==="arraybuffer"?T=i.transformTo("uint8array",T):I==="string"&&(A?T=o.decode(T):w&&v!==!0&&(T=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(T))),T):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./signature"),c=r("./zipEntry"),l=r("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=d-h;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./compressedObject"),c=r("./crc32"),l=r("./utf8"),u=r("./compressions"),f=r("./support");function d(h,m){this.options=h,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(_){for(var w in u)if(Object.prototype.hasOwnProperty.call(u,w)&&u[w].magic===_)return u[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,_,w=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<w;)m=h.readInt(2),p=h.readInt(2),_=h.readData(p),this.extraFields[m]={id:m,length:p,value:_};h.setIndex(w)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var w=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},n.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,i){function s(m,p,_){this.name=m,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=p,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var o=r("./stream/StreamHelper"),a=r("./stream/DataWorker"),c=r("./utf8"),l=r("./compressedObject"),u=r("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,_="string";try{if(!m)throw new Error("No output type specified.");var w=(_=m.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!w&&(p=p.pipe(new c.Utf8EncodeWorker)),!v&&w&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(A){(p=new u("error")).error(A)}return new o(p,_,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(_,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var h=[];function m(){var p,_;a=!0;for(var w=h.length;w;){for(_=h,h=[],p=-1;++p<w;)_[p]();w=h.length}a=!1}n.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof Br<"u"?Br:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,n,i){var s=r("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,w!==o&&p(this,w)}function d(w,v,A){this.promise=w,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function h(w,v,A){s(function(){var T;try{T=v(A)}catch(I){return a.reject(w,I)}T===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,T)})}function m(w){var v=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof v=="function")return function(){v.apply(w,arguments)}}function p(w,v){var A=!1;function T(C){A||(A=!0,a.reject(w,C))}function I(C){A||(A=!0,a.resolve(w,C))}var S=_(function(){v(I,T)});S.status==="error"&&T(S.value)}function _(w,v){var A={};try{A.value=w(v),A.status="success"}catch(T){A.status="error",A.value=T}return A}(n.exports=f).prototype.finally=function(w){if(typeof w!="function")return this;var v=this.constructor;return this.then(function(A){return v.resolve(w()).then(function(){return A})},function(A){return v.resolve(w()).then(function(){throw A})})},f.prototype.catch=function(w){return this.then(null,w)},f.prototype.then=function(w,v){if(typeof w!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?h(A,this.state===l?w:v,this.outcome):this.queue.push(new d(A,w,v)),A},d.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},d.prototype.otherCallFulfilled=function(w){h(this.promise,this.onFulfilled,w)},d.prototype.callRejected=function(w){a.reject(this.promise,w)},d.prototype.otherCallRejected=function(w){h(this.promise,this.onRejected,w)},a.resolve=function(w,v){var A=_(m,v);if(A.status==="error")return a.reject(w,A.value);var T=A.value;if(T)p(w,T);else{w.state=l,w.outcome=v;for(var I=-1,S=w.queue.length;++I<S;)w.queue[I].callFulfilled(v)}return w},a.reject=function(w,v){w.state=c,w.outcome=v;for(var A=-1,T=w.queue.length;++A<T;)w.queue[A].callRejected(v);return w},f.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},f.reject=function(w){var v=new this(o);return a.reject(v,w)},f.all=function(w){var v=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=w.length,T=!1;if(!A)return this.resolve([]);for(var I=new Array(A),S=0,C=-1,P=new this(o);++C<A;)N(w[C],C);return P;function N(z,J){v.resolve(z).then(function(M){I[J]=M,++S!==A||T||(T=!0,a.resolve(P,I))},function(M){T||(T=!0,a.reject(P,M))})}},f.race=function(w){var v=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=w.length,T=!1;if(!A)return this.resolve([]);for(var I=-1,S=new this(o);++I<A;)C=w[I],v.resolve(C).then(function(P){T||(T=!0,a.resolve(S,P))},function(P){T||(T=!0,a.reject(S,P))});var C;return S}},{immediate:36}],38:[function(r,n,i){var s={};(0,r("./lib/utils/common").assign)(s,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,i){var s=r("./zlib/deflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/messages"),l=r("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,m=8;function p(w){if(!(this instanceof p))return new p(w);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},w||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(A!==f)throw new Error(c[A]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var T;if(T=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(A=s.deflateSetDictionary(this.strm,T))!==f)throw new Error(c[A]);this._dict_set=!0}}function _(w,v){var A=new p(v);if(A.push(w,!0),A.err)throw A.msg||c[A.err];return A.result}p.prototype.push=function(w,v){var A,T,I=this.strm,S=this.options.chunkSize;if(this.ended)return!1;T=v===~~v?v:v===!0?4:0,typeof w=="string"?I.input=a.string2buf(w):u.call(w)==="[object ArrayBuffer]"?I.input=new Uint8Array(w):I.input=w,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8(S),I.next_out=0,I.avail_out=S),(A=s.deflate(I,T))!==1&&A!==f)return this.onEnd(A),!(this.ended=!0);I.avail_out!==0&&(I.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(I.output,I.next_out))):this.onData(o.shrinkBuf(I.output,I.next_out)))}while((0<I.avail_in||I.avail_out===0)&&A!==1);return T===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===f):T!==2||(this.onEnd(f),!(I.avail_out=0))},p.prototype.onData=function(w){this.chunks.push(w)},p.prototype.onEnd=function(w){w===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=p,i.deflate=_,i.deflateRaw=function(w,v){return(v=v||{}).raw=!0,_(w,v)},i.gzip=function(w,v){return(v=v||{}).gzip=!0,_(w,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,i){var s=r("./zlib/inflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/constants"),l=r("./zlib/messages"),u=r("./zlib/zstream"),f=r("./zlib/gzheader"),d=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||p&&p.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&!(15&_.windowBits)&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,_.windowBits);if(w!==c.Z_OK)throw new Error(l[w]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function m(p,_){var w=new h(_);if(w.push(p,!0),w.err)throw w.msg||l[w.err];return w.result}h.prototype.push=function(p,_){var w,v,A,T,I,S,C=this.strm,P=this.options.chunkSize,N=this.options.dictionary,z=!1;if(this.ended)return!1;v=_===~~_?_:_===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?C.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?C.input=new Uint8Array(p):C.input=p,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(P),C.next_out=0,C.avail_out=P),(w=s.inflate(C,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(S=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,w=s.inflateSetDictionary(this.strm,S)),w===c.Z_BUF_ERROR&&z===!0&&(w=c.Z_OK,z=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&w!==c.Z_STREAM_END&&(C.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(C.output,C.next_out),T=C.next_out-A,I=a.buf2string(C.output,A),C.next_out=T,C.avail_out=P-T,T&&o.arraySet(C.output,C.output,A,T,0),this.onData(I)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(z=!0)}while((0<C.avail_in||C.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(C.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,_){return(_=_||{}).raw=!0,m(p,_)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,m;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(m=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],m.set(h,d),d+=h.length;return m}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(r,n,i){var s=r("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",m=0;m<d;m++)h+=String.fromCharCode(f[m]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,m,p,_,w=f.length,v=0;for(p=0;p<w;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<w&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),v+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(v),p=_=0;_<v;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<w&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?d[_++]=h:(h<2048?d[_++]=192|h>>>6:(h<65536?d[_++]=224|h>>>12:(d[_++]=240|h>>>18,d[_++]=128|h>>>12&63),d[_++]=128|h>>>6&63),d[_++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,m=d.length;h<m;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,m,p,_,w=d||f.length,v=new Array(2*w);for(h=m=0;h<w;)if((p=f[h++])<128)v[m++]=p;else if(4<(_=c[p]))v[m++]=65533,h+=_-1;else{for(p&=_===2?31:_===3?15:7;1<_&&h<w;)p=p<<6|63&f[h++],_--;1<_?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return u(v,m)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(r,n,i){n.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(r,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();n.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(r,n,i){var s,o=r("../utils/common"),a=r("./trees"),c=r("./adler32"),l=r("./crc32"),u=r("./messages"),f=0,d=4,h=0,m=-2,p=-1,_=4,w=2,v=8,A=9,T=286,I=30,S=19,C=2*T+1,P=15,N=3,z=258,J=z+N+1,M=42,O=113,k=1,L=2,B=3,$=4;function ot(x,lt){return x.msg=u[lt],lt}function et(x){return(x<<1)-(4<x?9:0)}function st(x){for(var lt=x.length;0<=--lt;)x[lt]=0}function G(x){var lt=x.state,it=lt.pending;it>x.avail_out&&(it=x.avail_out),it!==0&&(o.arraySet(x.output,lt.pending_buf,lt.pending_out,it,x.next_out),x.next_out+=it,lt.pending_out+=it,x.total_out+=it,x.avail_out-=it,lt.pending-=it,lt.pending===0&&(lt.pending_out=0))}function D(x,lt){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,lt),x.block_start=x.strstart,G(x.strm)}function _t(x,lt){x.pending_buf[x.pending++]=lt}function q(x,lt){x.pending_buf[x.pending++]=lt>>>8&255,x.pending_buf[x.pending++]=255&lt}function at(x,lt){var it,j,F=x.max_chain_length,V=x.strstart,ht=x.prev_length,dt=x.nice_match,tt=x.strstart>x.w_size-J?x.strstart-(x.w_size-J):0,gt=x.window,xt=x.w_mask,mt=x.prev,Ct=x.strstart+z,ge=gt[V+ht-1],Gt=gt[V+ht];x.prev_length>=x.good_match&&(F>>=2),dt>x.lookahead&&(dt=x.lookahead);do if(gt[(it=lt)+ht]===Gt&&gt[it+ht-1]===ge&&gt[it]===gt[V]&&gt[++it]===gt[V+1]){V+=2,it++;do;while(gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&V<Ct);if(j=z-(Ct-V),V=Ct-z,ht<j){if(x.match_start=lt,dt<=(ht=j))break;ge=gt[V+ht-1],Gt=gt[V+ht]}}while((lt=mt[lt&xt])>tt&&--F!=0);return ht<=x.lookahead?ht:x.lookahead}function Ft(x){var lt,it,j,F,V,ht,dt,tt,gt,xt,mt=x.w_size;do{if(F=x.window_size-x.lookahead-x.strstart,x.strstart>=mt+(mt-J)){for(o.arraySet(x.window,x.window,mt,mt,0),x.match_start-=mt,x.strstart-=mt,x.block_start-=mt,lt=it=x.hash_size;j=x.head[--lt],x.head[lt]=mt<=j?j-mt:0,--it;);for(lt=it=mt;j=x.prev[--lt],x.prev[lt]=mt<=j?j-mt:0,--it;);F+=mt}if(x.strm.avail_in===0)break;if(ht=x.strm,dt=x.window,tt=x.strstart+x.lookahead,gt=F,xt=void 0,xt=ht.avail_in,gt<xt&&(xt=gt),it=xt===0?0:(ht.avail_in-=xt,o.arraySet(dt,ht.input,ht.next_in,xt,tt),ht.state.wrap===1?ht.adler=c(ht.adler,dt,xt,tt):ht.state.wrap===2&&(ht.adler=l(ht.adler,dt,xt,tt)),ht.next_in+=xt,ht.total_in+=xt,xt),x.lookahead+=it,x.lookahead+x.insert>=N)for(V=x.strstart-x.insert,x.ins_h=x.window[V],x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+N-1])&x.hash_mask,x.prev[V&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=V,V++,x.insert--,!(x.lookahead+x.insert<N)););}while(x.lookahead<J&&x.strm.avail_in!==0)}function Wt(x,lt){for(var it,j;;){if(x.lookahead<J){if(Ft(x),x.lookahead<J&&lt===f)return k;if(x.lookahead===0)break}if(it=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,it=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),it!==0&&x.strstart-it<=x.w_size-J&&(x.match_length=at(x,it)),x.match_length>=N)if(j=a._tr_tally(x,x.strstart-x.match_start,x.match_length-N),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=N){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,it=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else j=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(j&&(D(x,!1),x.strm.avail_out===0))return k}return x.insert=x.strstart<N-1?x.strstart:N-1,lt===d?(D(x,!0),x.strm.avail_out===0?B:$):x.last_lit&&(D(x,!1),x.strm.avail_out===0)?k:L}function jt(x,lt){for(var it,j,F;;){if(x.lookahead<J){if(Ft(x),x.lookahead<J&&lt===f)return k;if(x.lookahead===0)break}if(it=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,it=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=N-1,it!==0&&x.prev_length<x.max_lazy_match&&x.strstart-it<=x.w_size-J&&(x.match_length=at(x,it),x.match_length<=5&&(x.strategy===1||x.match_length===N&&4096<x.strstart-x.match_start)&&(x.match_length=N-1)),x.prev_length>=N&&x.match_length<=x.prev_length){for(F=x.strstart+x.lookahead-N,j=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-N),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=F&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,it=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=N-1,x.strstart++,j&&(D(x,!1),x.strm.avail_out===0))return k}else if(x.match_available){if((j=a._tr_tally(x,0,x.window[x.strstart-1]))&&D(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return k}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(j=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<N-1?x.strstart:N-1,lt===d?(D(x,!0),x.strm.avail_out===0?B:$):x.last_lit&&(D(x,!1),x.strm.avail_out===0)?k:L}function Bt(x,lt,it,j,F){this.good_length=x,this.max_lazy=lt,this.nice_length=it,this.max_chain=j,this.func=F}function he(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*I+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),st(this.dyn_ltree),st(this.dyn_dtree),st(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*T+1),st(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*T+1),st(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Zt(x){var lt;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=w,(lt=x.state).pending=0,lt.pending_out=0,lt.wrap<0&&(lt.wrap=-lt.wrap),lt.status=lt.wrap?M:O,x.adler=lt.wrap===2?0:1,lt.last_flush=f,a._tr_init(lt),h):ot(x,m)}function Me(x){var lt=Zt(x);return lt===h&&function(it){it.window_size=2*it.w_size,st(it.head),it.max_lazy_match=s[it.level].max_lazy,it.good_match=s[it.level].good_length,it.nice_match=s[it.level].nice_length,it.max_chain_length=s[it.level].max_chain,it.strstart=0,it.block_start=0,it.lookahead=0,it.insert=0,it.match_length=it.prev_length=N-1,it.match_available=0,it.ins_h=0}(x.state),lt}function Ge(x,lt,it,j,F,V){if(!x)return m;var ht=1;if(lt===p&&(lt=6),j<0?(ht=0,j=-j):15<j&&(ht=2,j-=16),F<1||A<F||it!==v||j<8||15<j||lt<0||9<lt||V<0||_<V)return ot(x,m);j===8&&(j=9);var dt=new he;return(x.state=dt).strm=x,dt.wrap=ht,dt.gzhead=null,dt.w_bits=j,dt.w_size=1<<dt.w_bits,dt.w_mask=dt.w_size-1,dt.hash_bits=F+7,dt.hash_size=1<<dt.hash_bits,dt.hash_mask=dt.hash_size-1,dt.hash_shift=~~((dt.hash_bits+N-1)/N),dt.window=new o.Buf8(2*dt.w_size),dt.head=new o.Buf16(dt.hash_size),dt.prev=new o.Buf16(dt.w_size),dt.lit_bufsize=1<<F+6,dt.pending_buf_size=4*dt.lit_bufsize,dt.pending_buf=new o.Buf8(dt.pending_buf_size),dt.d_buf=1*dt.lit_bufsize,dt.l_buf=3*dt.lit_bufsize,dt.level=lt,dt.strategy=V,dt.method=it,Me(x)}s=[new Bt(0,0,0,0,function(x,lt){var it=65535;for(it>x.pending_buf_size-5&&(it=x.pending_buf_size-5);;){if(x.lookahead<=1){if(Ft(x),x.lookahead===0&&lt===f)return k;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var j=x.block_start+it;if((x.strstart===0||x.strstart>=j)&&(x.lookahead=x.strstart-j,x.strstart=j,D(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-J&&(D(x,!1),x.strm.avail_out===0))return k}return x.insert=0,lt===d?(D(x,!0),x.strm.avail_out===0?B:$):(x.strstart>x.block_start&&(D(x,!1),x.strm.avail_out),k)}),new Bt(4,4,8,4,Wt),new Bt(4,5,16,8,Wt),new Bt(4,6,32,32,Wt),new Bt(4,4,16,16,jt),new Bt(8,16,32,32,jt),new Bt(8,16,128,128,jt),new Bt(8,32,128,256,jt),new Bt(32,128,258,1024,jt),new Bt(32,258,258,4096,jt)],i.deflateInit=function(x,lt){return Ge(x,lt,v,15,8,0)},i.deflateInit2=Ge,i.deflateReset=Me,i.deflateResetKeep=Zt,i.deflateSetHeader=function(x,lt){return x&&x.state?x.state.wrap!==2?m:(x.state.gzhead=lt,h):m},i.deflate=function(x,lt){var it,j,F,V;if(!x||!x.state||5<lt||lt<0)return x?ot(x,m):m;if(j=x.state,!x.output||!x.input&&x.avail_in!==0||j.status===666&&lt!==d)return ot(x,x.avail_out===0?-5:m);if(j.strm=x,it=j.last_flush,j.last_flush=lt,j.status===M)if(j.wrap===2)x.adler=0,_t(j,31),_t(j,139),_t(j,8),j.gzhead?(_t(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),_t(j,255&j.gzhead.time),_t(j,j.gzhead.time>>8&255),_t(j,j.gzhead.time>>16&255),_t(j,j.gzhead.time>>24&255),_t(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),_t(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(_t(j,255&j.gzhead.extra.length),_t(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(x.adler=l(x.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(_t(j,0),_t(j,0),_t(j,0),_t(j,0),_t(j,0),_t(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),_t(j,3),j.status=O);else{var ht=v+(j.w_bits-8<<4)<<8;ht|=(2<=j.strategy||j.level<2?0:j.level<6?1:j.level===6?2:3)<<6,j.strstart!==0&&(ht|=32),ht+=31-ht%31,j.status=O,q(j,ht),j.strstart!==0&&(q(j,x.adler>>>16),q(j,65535&x.adler)),x.adler=1}if(j.status===69)if(j.gzhead.extra){for(F=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),G(x),F=j.pending,j.pending!==j.pending_buf_size));)_t(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(j.status===73)if(j.gzhead.name){F=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),G(x),F=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,_t(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),V===0&&(j.gzindex=0,j.status=91)}else j.status=91;if(j.status===91)if(j.gzhead.comment){F=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),G(x),F=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,_t(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),V===0&&(j.status=103)}else j.status=103;if(j.status===103&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&G(x),j.pending+2<=j.pending_buf_size&&(_t(j,255&x.adler),_t(j,x.adler>>8&255),x.adler=0,j.status=O)):j.status=O),j.pending!==0){if(G(x),x.avail_out===0)return j.last_flush=-1,h}else if(x.avail_in===0&&et(lt)<=et(it)&&lt!==d)return ot(x,-5);if(j.status===666&&x.avail_in!==0)return ot(x,-5);if(x.avail_in!==0||j.lookahead!==0||lt!==f&&j.status!==666){var dt=j.strategy===2?function(tt,gt){for(var xt;;){if(tt.lookahead===0&&(Ft(tt),tt.lookahead===0)){if(gt===f)return k;break}if(tt.match_length=0,xt=a._tr_tally(tt,0,tt.window[tt.strstart]),tt.lookahead--,tt.strstart++,xt&&(D(tt,!1),tt.strm.avail_out===0))return k}return tt.insert=0,gt===d?(D(tt,!0),tt.strm.avail_out===0?B:$):tt.last_lit&&(D(tt,!1),tt.strm.avail_out===0)?k:L}(j,lt):j.strategy===3?function(tt,gt){for(var xt,mt,Ct,ge,Gt=tt.window;;){if(tt.lookahead<=z){if(Ft(tt),tt.lookahead<=z&&gt===f)return k;if(tt.lookahead===0)break}if(tt.match_length=0,tt.lookahead>=N&&0<tt.strstart&&(mt=Gt[Ct=tt.strstart-1])===Gt[++Ct]&&mt===Gt[++Ct]&&mt===Gt[++Ct]){ge=tt.strstart+z;do;while(mt===Gt[++Ct]&&mt===Gt[++Ct]&&mt===Gt[++Ct]&&mt===Gt[++Ct]&&mt===Gt[++Ct]&&mt===Gt[++Ct]&&mt===Gt[++Ct]&&mt===Gt[++Ct]&&Ct<ge);tt.match_length=z-(ge-Ct),tt.match_length>tt.lookahead&&(tt.match_length=tt.lookahead)}if(tt.match_length>=N?(xt=a._tr_tally(tt,1,tt.match_length-N),tt.lookahead-=tt.match_length,tt.strstart+=tt.match_length,tt.match_length=0):(xt=a._tr_tally(tt,0,tt.window[tt.strstart]),tt.lookahead--,tt.strstart++),xt&&(D(tt,!1),tt.strm.avail_out===0))return k}return tt.insert=0,gt===d?(D(tt,!0),tt.strm.avail_out===0?B:$):tt.last_lit&&(D(tt,!1),tt.strm.avail_out===0)?k:L}(j,lt):s[j.level].func(j,lt);if(dt!==B&&dt!==$||(j.status=666),dt===k||dt===B)return x.avail_out===0&&(j.last_flush=-1),h;if(dt===L&&(lt===1?a._tr_align(j):lt!==5&&(a._tr_stored_block(j,0,0,!1),lt===3&&(st(j.head),j.lookahead===0&&(j.strstart=0,j.block_start=0,j.insert=0))),G(x),x.avail_out===0))return j.last_flush=-1,h}return lt!==d?h:j.wrap<=0?1:(j.wrap===2?(_t(j,255&x.adler),_t(j,x.adler>>8&255),_t(j,x.adler>>16&255),_t(j,x.adler>>24&255),_t(j,255&x.total_in),_t(j,x.total_in>>8&255),_t(j,x.total_in>>16&255),_t(j,x.total_in>>24&255)):(q(j,x.adler>>>16),q(j,65535&x.adler)),G(x),0<j.wrap&&(j.wrap=-j.wrap),j.pending!==0?h:1)},i.deflateEnd=function(x){var lt;return x&&x.state?(lt=x.state.status)!==M&&lt!==69&&lt!==73&&lt!==91&&lt!==103&&lt!==O&&lt!==666?ot(x,m):(x.state=null,lt===O?ot(x,-3):h):m},i.deflateSetDictionary=function(x,lt){var it,j,F,V,ht,dt,tt,gt,xt=lt.length;if(!x||!x.state||(V=(it=x.state).wrap)===2||V===1&&it.status!==M||it.lookahead)return m;for(V===1&&(x.adler=c(x.adler,lt,xt,0)),it.wrap=0,xt>=it.w_size&&(V===0&&(st(it.head),it.strstart=0,it.block_start=0,it.insert=0),gt=new o.Buf8(it.w_size),o.arraySet(gt,lt,xt-it.w_size,it.w_size,0),lt=gt,xt=it.w_size),ht=x.avail_in,dt=x.next_in,tt=x.input,x.avail_in=xt,x.next_in=0,x.input=lt,Ft(it);it.lookahead>=N;){for(j=it.strstart,F=it.lookahead-(N-1);it.ins_h=(it.ins_h<<it.hash_shift^it.window[j+N-1])&it.hash_mask,it.prev[j&it.w_mask]=it.head[it.ins_h],it.head[it.ins_h]=j,j++,--F;);it.strstart=j,it.lookahead=N-1,Ft(it)}return it.strstart+=it.lookahead,it.block_start=it.strstart,it.insert=it.lookahead,it.lookahead=0,it.match_length=it.prev_length=N-1,it.match_available=0,x.next_in=dt,x.input=tt,x.avail_in=ht,it.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,n,i){n.exports=function(s,o){var a,c,l,u,f,d,h,m,p,_,w,v,A,T,I,S,C,P,N,z,J,M,O,k,L;a=s.state,c=s.next_in,k=s.input,l=c+(s.avail_in-5),u=s.next_out,L=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,_=a.wnext,w=a.window,v=a.hold,A=a.bits,T=a.lencode,I=a.distcode,S=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;t:do{A<15&&(v+=k[c++]<<A,A+=8,v+=k[c++]<<A,A+=8),P=T[v&S];e:for(;;){if(v>>>=N=P>>>24,A-=N,(N=P>>>16&255)===0)L[u++]=65535&P;else{if(!(16&N)){if(!(64&N)){P=T[(65535&P)+(v&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}z=65535&P,(N&=15)&&(A<N&&(v+=k[c++]<<A,A+=8),z+=v&(1<<N)-1,v>>>=N,A-=N),A<15&&(v+=k[c++]<<A,A+=8,v+=k[c++]<<A,A+=8),P=I[v&C];r:for(;;){if(v>>>=N=P>>>24,A-=N,!(16&(N=P>>>16&255))){if(!(64&N)){P=I[(65535&P)+(v&(1<<N)-1)];continue r}s.msg="invalid distance code",a.mode=30;break t}if(J=65535&P,A<(N&=15)&&(v+=k[c++]<<A,(A+=8)<N&&(v+=k[c++]<<A,A+=8)),h<(J+=v&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=N,A-=N,(N=u-f)<J){if(p<(N=J-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(O=w,(M=0)===_){if(M+=m-N,N<z){for(z-=N;L[u++]=w[M++],--N;);M=u-J,O=L}}else if(_<N){if(M+=m+_-N,(N-=_)<z){for(z-=N;L[u++]=w[M++],--N;);if(M=0,_<z){for(z-=N=_;L[u++]=w[M++],--N;);M=u-J,O=L}}}else if(M+=_-N,N<z){for(z-=N;L[u++]=w[M++],--N;);M=u-J,O=L}for(;2<z;)L[u++]=O[M++],L[u++]=O[M++],L[u++]=O[M++],z-=3;z&&(L[u++]=O[M++],1<z&&(L[u++]=O[M++]))}else{for(M=u-J;L[u++]=L[M++],L[u++]=L[M++],L[u++]=L[M++],2<(z-=3););z&&(L[u++]=L[M++],1<z&&(L[u++]=L[M++]))}break}}break}}while(c<l&&u<d);c-=z=A>>3,v&=(1<<(A-=z<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=v,a.bits=A}},{}],49:[function(r,n,i){var s=r("../utils/common"),o=r("./adler32"),a=r("./crc32"),c=r("./inffast"),l=r("./inftrees"),u=1,f=2,d=0,h=-2,m=1,p=852,_=592;function w(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(M){var O;return M&&M.state?(O=M.state,M.total_in=M.total_out=O.total=0,M.msg="",O.wrap&&(M.adler=1&O.wrap),O.mode=m,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(p),O.distcode=O.distdyn=new s.Buf32(_),O.sane=1,O.back=-1,d):h}function T(M){var O;return M&&M.state?((O=M.state).wsize=0,O.whave=0,O.wnext=0,A(M)):h}function I(M,O){var k,L;return M&&M.state?(L=M.state,O<0?(k=0,O=-O):(k=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:(L.window!==null&&L.wbits!==O&&(L.window=null),L.wrap=k,L.wbits=O,T(M))):h}function S(M,O){var k,L;return M?(L=new v,(M.state=L).window=null,(k=I(M,O))!==d&&(M.state=null),k):h}var C,P,N=!0;function z(M){if(N){var O;for(C=new s.Buf32(512),P=new s.Buf32(32),O=0;O<144;)M.lens[O++]=8;for(;O<256;)M.lens[O++]=9;for(;O<280;)M.lens[O++]=7;for(;O<288;)M.lens[O++]=8;for(l(u,M.lens,0,288,C,0,M.work,{bits:9}),O=0;O<32;)M.lens[O++]=5;l(f,M.lens,0,32,P,0,M.work,{bits:5}),N=!1}M.lencode=C,M.lenbits=9,M.distcode=P,M.distbits=5}function J(M,O,k,L){var B,$=M.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),L>=$.wsize?(s.arraySet($.window,O,k-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(L<(B=$.wsize-$.wnext)&&(B=L),s.arraySet($.window,O,k-L,B,$.wnext),(L-=B)?(s.arraySet($.window,O,k-L,L,0),$.wnext=L,$.whave=$.wsize):($.wnext+=B,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=B))),0}i.inflateReset=T,i.inflateReset2=I,i.inflateResetKeep=A,i.inflateInit=function(M){return S(M,15)},i.inflateInit2=S,i.inflate=function(M,O){var k,L,B,$,ot,et,st,G,D,_t,q,at,Ft,Wt,jt,Bt,he,Zt,Me,Ge,x,lt,it,j,F=0,V=new s.Buf8(4),ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return h;(k=M.state).mode===12&&(k.mode=13),ot=M.next_out,B=M.output,st=M.avail_out,$=M.next_in,L=M.input,et=M.avail_in,G=k.hold,D=k.bits,_t=et,q=st,lt=d;t:for(;;)switch(k.mode){case m:if(k.wrap===0){k.mode=13;break}for(;D<16;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(2&k.wrap&&G===35615){V[k.check=0]=255&G,V[1]=G>>>8&255,k.check=a(k.check,V,2,0),D=G=0,k.mode=2;break}if(k.flags=0,k.head&&(k.head.done=!1),!(1&k.wrap)||(((255&G)<<8)+(G>>8))%31){M.msg="incorrect header check",k.mode=30;break}if((15&G)!=8){M.msg="unknown compression method",k.mode=30;break}if(D-=4,x=8+(15&(G>>>=4)),k.wbits===0)k.wbits=x;else if(x>k.wbits){M.msg="invalid window size",k.mode=30;break}k.dmax=1<<x,M.adler=k.check=1,k.mode=512&G?10:12,D=G=0;break;case 2:for(;D<16;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(k.flags=G,(255&k.flags)!=8){M.msg="unknown compression method",k.mode=30;break}if(57344&k.flags){M.msg="unknown header flags set",k.mode=30;break}k.head&&(k.head.text=G>>8&1),512&k.flags&&(V[0]=255&G,V[1]=G>>>8&255,k.check=a(k.check,V,2,0)),D=G=0,k.mode=3;case 3:for(;D<32;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}k.head&&(k.head.time=G),512&k.flags&&(V[0]=255&G,V[1]=G>>>8&255,V[2]=G>>>16&255,V[3]=G>>>24&255,k.check=a(k.check,V,4,0)),D=G=0,k.mode=4;case 4:for(;D<16;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}k.head&&(k.head.xflags=255&G,k.head.os=G>>8),512&k.flags&&(V[0]=255&G,V[1]=G>>>8&255,k.check=a(k.check,V,2,0)),D=G=0,k.mode=5;case 5:if(1024&k.flags){for(;D<16;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}k.length=G,k.head&&(k.head.extra_len=G),512&k.flags&&(V[0]=255&G,V[1]=G>>>8&255,k.check=a(k.check,V,2,0)),D=G=0}else k.head&&(k.head.extra=null);k.mode=6;case 6:if(1024&k.flags&&(et<(at=k.length)&&(at=et),at&&(k.head&&(x=k.head.extra_len-k.length,k.head.extra||(k.head.extra=new Array(k.head.extra_len)),s.arraySet(k.head.extra,L,$,at,x)),512&k.flags&&(k.check=a(k.check,L,at,$)),et-=at,$+=at,k.length-=at),k.length))break t;k.length=0,k.mode=7;case 7:if(2048&k.flags){if(et===0)break t;for(at=0;x=L[$+at++],k.head&&x&&k.length<65536&&(k.head.name+=String.fromCharCode(x)),x&&at<et;);if(512&k.flags&&(k.check=a(k.check,L,at,$)),et-=at,$+=at,x)break t}else k.head&&(k.head.name=null);k.length=0,k.mode=8;case 8:if(4096&k.flags){if(et===0)break t;for(at=0;x=L[$+at++],k.head&&x&&k.length<65536&&(k.head.comment+=String.fromCharCode(x)),x&&at<et;);if(512&k.flags&&(k.check=a(k.check,L,at,$)),et-=at,$+=at,x)break t}else k.head&&(k.head.comment=null);k.mode=9;case 9:if(512&k.flags){for(;D<16;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(G!==(65535&k.check)){M.msg="header crc mismatch",k.mode=30;break}D=G=0}k.head&&(k.head.hcrc=k.flags>>9&1,k.head.done=!0),M.adler=k.check=0,k.mode=12;break;case 10:for(;D<32;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}M.adler=k.check=w(G),D=G=0,k.mode=11;case 11:if(k.havedict===0)return M.next_out=ot,M.avail_out=st,M.next_in=$,M.avail_in=et,k.hold=G,k.bits=D,2;M.adler=k.check=1,k.mode=12;case 12:if(O===5||O===6)break t;case 13:if(k.last){G>>>=7&D,D-=7&D,k.mode=27;break}for(;D<3;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}switch(k.last=1&G,D-=1,3&(G>>>=1)){case 0:k.mode=14;break;case 1:if(z(k),k.mode=20,O!==6)break;G>>>=2,D-=2;break t;case 2:k.mode=17;break;case 3:M.msg="invalid block type",k.mode=30}G>>>=2,D-=2;break;case 14:for(G>>>=7&D,D-=7&D;D<32;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if((65535&G)!=(G>>>16^65535)){M.msg="invalid stored block lengths",k.mode=30;break}if(k.length=65535&G,D=G=0,k.mode=15,O===6)break t;case 15:k.mode=16;case 16:if(at=k.length){if(et<at&&(at=et),st<at&&(at=st),at===0)break t;s.arraySet(B,L,$,at,ot),et-=at,$+=at,st-=at,ot+=at,k.length-=at;break}k.mode=12;break;case 17:for(;D<14;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(k.nlen=257+(31&G),G>>>=5,D-=5,k.ndist=1+(31&G),G>>>=5,D-=5,k.ncode=4+(15&G),G>>>=4,D-=4,286<k.nlen||30<k.ndist){M.msg="too many length or distance symbols",k.mode=30;break}k.have=0,k.mode=18;case 18:for(;k.have<k.ncode;){for(;D<3;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}k.lens[ht[k.have++]]=7&G,G>>>=3,D-=3}for(;k.have<19;)k.lens[ht[k.have++]]=0;if(k.lencode=k.lendyn,k.lenbits=7,it={bits:k.lenbits},lt=l(0,k.lens,0,19,k.lencode,0,k.work,it),k.lenbits=it.bits,lt){M.msg="invalid code lengths set",k.mode=30;break}k.have=0,k.mode=19;case 19:for(;k.have<k.nlen+k.ndist;){for(;Bt=(F=k.lencode[G&(1<<k.lenbits)-1])>>>16&255,he=65535&F,!((jt=F>>>24)<=D);){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(he<16)G>>>=jt,D-=jt,k.lens[k.have++]=he;else{if(he===16){for(j=jt+2;D<j;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(G>>>=jt,D-=jt,k.have===0){M.msg="invalid bit length repeat",k.mode=30;break}x=k.lens[k.have-1],at=3+(3&G),G>>>=2,D-=2}else if(he===17){for(j=jt+3;D<j;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}D-=jt,x=0,at=3+(7&(G>>>=jt)),G>>>=3,D-=3}else{for(j=jt+7;D<j;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}D-=jt,x=0,at=11+(127&(G>>>=jt)),G>>>=7,D-=7}if(k.have+at>k.nlen+k.ndist){M.msg="invalid bit length repeat",k.mode=30;break}for(;at--;)k.lens[k.have++]=x}}if(k.mode===30)break;if(k.lens[256]===0){M.msg="invalid code -- missing end-of-block",k.mode=30;break}if(k.lenbits=9,it={bits:k.lenbits},lt=l(u,k.lens,0,k.nlen,k.lencode,0,k.work,it),k.lenbits=it.bits,lt){M.msg="invalid literal/lengths set",k.mode=30;break}if(k.distbits=6,k.distcode=k.distdyn,it={bits:k.distbits},lt=l(f,k.lens,k.nlen,k.ndist,k.distcode,0,k.work,it),k.distbits=it.bits,lt){M.msg="invalid distances set",k.mode=30;break}if(k.mode=20,O===6)break t;case 20:k.mode=21;case 21:if(6<=et&&258<=st){M.next_out=ot,M.avail_out=st,M.next_in=$,M.avail_in=et,k.hold=G,k.bits=D,c(M,q),ot=M.next_out,B=M.output,st=M.avail_out,$=M.next_in,L=M.input,et=M.avail_in,G=k.hold,D=k.bits,k.mode===12&&(k.back=-1);break}for(k.back=0;Bt=(F=k.lencode[G&(1<<k.lenbits)-1])>>>16&255,he=65535&F,!((jt=F>>>24)<=D);){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(Bt&&!(240&Bt)){for(Zt=jt,Me=Bt,Ge=he;Bt=(F=k.lencode[Ge+((G&(1<<Zt+Me)-1)>>Zt)])>>>16&255,he=65535&F,!(Zt+(jt=F>>>24)<=D);){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}G>>>=Zt,D-=Zt,k.back+=Zt}if(G>>>=jt,D-=jt,k.back+=jt,k.length=he,Bt===0){k.mode=26;break}if(32&Bt){k.back=-1,k.mode=12;break}if(64&Bt){M.msg="invalid literal/length code",k.mode=30;break}k.extra=15&Bt,k.mode=22;case 22:if(k.extra){for(j=k.extra;D<j;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}k.length+=G&(1<<k.extra)-1,G>>>=k.extra,D-=k.extra,k.back+=k.extra}k.was=k.length,k.mode=23;case 23:for(;Bt=(F=k.distcode[G&(1<<k.distbits)-1])>>>16&255,he=65535&F,!((jt=F>>>24)<=D);){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(!(240&Bt)){for(Zt=jt,Me=Bt,Ge=he;Bt=(F=k.distcode[Ge+((G&(1<<Zt+Me)-1)>>Zt)])>>>16&255,he=65535&F,!(Zt+(jt=F>>>24)<=D);){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}G>>>=Zt,D-=Zt,k.back+=Zt}if(G>>>=jt,D-=jt,k.back+=jt,64&Bt){M.msg="invalid distance code",k.mode=30;break}k.offset=he,k.extra=15&Bt,k.mode=24;case 24:if(k.extra){for(j=k.extra;D<j;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}k.offset+=G&(1<<k.extra)-1,G>>>=k.extra,D-=k.extra,k.back+=k.extra}if(k.offset>k.dmax){M.msg="invalid distance too far back",k.mode=30;break}k.mode=25;case 25:if(st===0)break t;if(at=q-st,k.offset>at){if((at=k.offset-at)>k.whave&&k.sane){M.msg="invalid distance too far back",k.mode=30;break}Ft=at>k.wnext?(at-=k.wnext,k.wsize-at):k.wnext-at,at>k.length&&(at=k.length),Wt=k.window}else Wt=B,Ft=ot-k.offset,at=k.length;for(st<at&&(at=st),st-=at,k.length-=at;B[ot++]=Wt[Ft++],--at;);k.length===0&&(k.mode=21);break;case 26:if(st===0)break t;B[ot++]=k.length,st--,k.mode=21;break;case 27:if(k.wrap){for(;D<32;){if(et===0)break t;et--,G|=L[$++]<<D,D+=8}if(q-=st,M.total_out+=q,k.total+=q,q&&(M.adler=k.check=k.flags?a(k.check,B,q,ot-q):o(k.check,B,q,ot-q)),q=st,(k.flags?G:w(G))!==k.check){M.msg="incorrect data check",k.mode=30;break}D=G=0}k.mode=28;case 28:if(k.wrap&&k.flags){for(;D<32;){if(et===0)break t;et--,G+=L[$++]<<D,D+=8}if(G!==(4294967295&k.total)){M.msg="incorrect length check",k.mode=30;break}D=G=0}k.mode=29;case 29:lt=1;break t;case 30:lt=-3;break t;case 31:return-4;case 32:default:return h}return M.next_out=ot,M.avail_out=st,M.next_in=$,M.avail_in=et,k.hold=G,k.bits=D,(k.wsize||q!==M.avail_out&&k.mode<30&&(k.mode<27||O!==4))&&J(M,M.output,M.next_out,q-M.avail_out)?(k.mode=31,-4):(_t-=M.avail_in,q-=M.avail_out,M.total_in+=_t,M.total_out+=q,k.total+=q,k.wrap&&q&&(M.adler=k.check=k.flags?a(k.check,B,q,M.next_out-q):o(k.check,B,q,M.next_out-q)),M.data_type=k.bits+(k.last?64:0)+(k.mode===12?128:0)+(k.mode===20||k.mode===15?256:0),(_t==0&&q===0||O===4)&&lt===d&&(lt=-5),lt)},i.inflateEnd=function(M){if(!M||!M.state)return h;var O=M.state;return O.window&&(O.window=null),M.state=null,d},i.inflateGetHeader=function(M,O){var k;return M&&M.state&&2&(k=M.state).wrap?((k.head=O).done=!1,d):h},i.inflateSetDictionary=function(M,O){var k,L=O.length;return M&&M.state?(k=M.state).wrap!==0&&k.mode!==11?h:k.mode===11&&o(1,O,L,0)!==k.check?-3:J(M,O,L,L)?(k.mode=31,-4):(k.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,i){var s=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,f,d,h,m,p,_,w){var v,A,T,I,S,C,P,N,z,J=w.bits,M=0,O=0,k=0,L=0,B=0,$=0,ot=0,et=0,st=0,G=0,D=null,_t=0,q=new s.Buf16(16),at=new s.Buf16(16),Ft=null,Wt=0;for(M=0;M<=15;M++)q[M]=0;for(O=0;O<h;O++)q[f[d+O]]++;for(B=J,L=15;1<=L&&q[L]===0;L--);if(L<B&&(B=L),L===0)return m[p++]=20971520,m[p++]=20971520,w.bits=1,0;for(k=1;k<L&&q[k]===0;k++);for(B<k&&(B=k),M=et=1;M<=15;M++)if(et<<=1,(et-=q[M])<0)return-1;if(0<et&&(u===0||L!==1))return-1;for(at[1]=0,M=1;M<15;M++)at[M+1]=at[M]+q[M];for(O=0;O<h;O++)f[d+O]!==0&&(_[at[f[d+O]]++]=O);if(C=u===0?(D=Ft=_,19):u===1?(D=o,_t-=257,Ft=a,Wt-=257,256):(D=c,Ft=l,-1),M=k,S=p,ot=O=G=0,T=-1,I=(st=1<<($=B))-1,u===1&&852<st||u===2&&592<st)return 1;for(;;){for(P=M-ot,z=_[O]<C?(N=0,_[O]):_[O]>C?(N=Ft[Wt+_[O]],D[_t+_[O]]):(N=96,0),v=1<<M-ot,k=A=1<<$;m[S+(G>>ot)+(A-=v)]=P<<24|N<<16|z|0,A!==0;);for(v=1<<M-1;G&v;)v>>=1;if(v!==0?(G&=v-1,G+=v):G=0,O++,--q[M]==0){if(M===L)break;M=f[d+_[O]]}if(B<M&&(G&I)!==T){for(ot===0&&(ot=B),S+=k,et=1<<($=M-ot);$+ot<L&&!((et-=q[$+ot])<=0);)$++,et<<=1;if(st+=1<<$,u===1&&852<st||u===2&&592<st)return 1;m[T=G&I]=B<<24|$<<16|S-p|0}}return G!==0&&(m[S+G]=M-ot<<24|64<<16|0),w.bits=B,0}},{"../utils/common":41}],51:[function(r,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,i){var s=r("../utils/common"),o=0,a=1;function c(F){for(var V=F.length;0<=--V;)F[V]=0}var l=0,u=29,f=256,d=f+1+u,h=30,m=19,p=2*d+1,_=15,w=16,v=7,A=256,T=16,I=17,S=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(d+2));c(J);var M=new Array(2*h);c(M);var O=new Array(512);c(O);var k=new Array(256);c(k);var L=new Array(u);c(L);var B,$,ot,et=new Array(h);function st(F,V,ht,dt,tt){this.static_tree=F,this.extra_bits=V,this.extra_base=ht,this.elems=dt,this.max_length=tt,this.has_stree=F&&F.length}function G(F,V){this.dyn_tree=F,this.max_code=0,this.stat_desc=V}function D(F){return F<256?O[F]:O[256+(F>>>7)]}function _t(F,V){F.pending_buf[F.pending++]=255&V,F.pending_buf[F.pending++]=V>>>8&255}function q(F,V,ht){F.bi_valid>w-ht?(F.bi_buf|=V<<F.bi_valid&65535,_t(F,F.bi_buf),F.bi_buf=V>>w-F.bi_valid,F.bi_valid+=ht-w):(F.bi_buf|=V<<F.bi_valid&65535,F.bi_valid+=ht)}function at(F,V,ht){q(F,ht[2*V],ht[2*V+1])}function Ft(F,V){for(var ht=0;ht|=1&F,F>>>=1,ht<<=1,0<--V;);return ht>>>1}function Wt(F,V,ht){var dt,tt,gt=new Array(_+1),xt=0;for(dt=1;dt<=_;dt++)gt[dt]=xt=xt+ht[dt-1]<<1;for(tt=0;tt<=V;tt++){var mt=F[2*tt+1];mt!==0&&(F[2*tt]=Ft(gt[mt]++,mt))}}function jt(F){var V;for(V=0;V<d;V++)F.dyn_ltree[2*V]=0;for(V=0;V<h;V++)F.dyn_dtree[2*V]=0;for(V=0;V<m;V++)F.bl_tree[2*V]=0;F.dyn_ltree[2*A]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Bt(F){8<F.bi_valid?_t(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function he(F,V,ht,dt){var tt=2*V,gt=2*ht;return F[tt]<F[gt]||F[tt]===F[gt]&&dt[V]<=dt[ht]}function Zt(F,V,ht){for(var dt=F.heap[ht],tt=ht<<1;tt<=F.heap_len&&(tt<F.heap_len&&he(V,F.heap[tt+1],F.heap[tt],F.depth)&&tt++,!he(V,dt,F.heap[tt],F.depth));)F.heap[ht]=F.heap[tt],ht=tt,tt<<=1;F.heap[ht]=dt}function Me(F,V,ht){var dt,tt,gt,xt,mt=0;if(F.last_lit!==0)for(;dt=F.pending_buf[F.d_buf+2*mt]<<8|F.pending_buf[F.d_buf+2*mt+1],tt=F.pending_buf[F.l_buf+mt],mt++,dt===0?at(F,tt,V):(at(F,(gt=k[tt])+f+1,V),(xt=C[gt])!==0&&q(F,tt-=L[gt],xt),at(F,gt=D(--dt),ht),(xt=P[gt])!==0&&q(F,dt-=et[gt],xt)),mt<F.last_lit;);at(F,A,V)}function Ge(F,V){var ht,dt,tt,gt=V.dyn_tree,xt=V.stat_desc.static_tree,mt=V.stat_desc.has_stree,Ct=V.stat_desc.elems,ge=-1;for(F.heap_len=0,F.heap_max=p,ht=0;ht<Ct;ht++)gt[2*ht]!==0?(F.heap[++F.heap_len]=ge=ht,F.depth[ht]=0):gt[2*ht+1]=0;for(;F.heap_len<2;)gt[2*(tt=F.heap[++F.heap_len]=ge<2?++ge:0)]=1,F.depth[tt]=0,F.opt_len--,mt&&(F.static_len-=xt[2*tt+1]);for(V.max_code=ge,ht=F.heap_len>>1;1<=ht;ht--)Zt(F,gt,ht);for(tt=Ct;ht=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Zt(F,gt,1),dt=F.heap[1],F.heap[--F.heap_max]=ht,F.heap[--F.heap_max]=dt,gt[2*tt]=gt[2*ht]+gt[2*dt],F.depth[tt]=(F.depth[ht]>=F.depth[dt]?F.depth[ht]:F.depth[dt])+1,gt[2*ht+1]=gt[2*dt+1]=tt,F.heap[1]=tt++,Zt(F,gt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(Gt,nn){var R,g,b,U,W,rt,ct=nn.dyn_tree,Vt=nn.max_code,Ue=nn.stat_desc.static_tree,ve=nn.stat_desc.has_stree,Pe=nn.stat_desc.extra_bits,fe=nn.stat_desc.extra_base,pc=nn.stat_desc.max_length,rh=0;for(U=0;U<=_;U++)Gt.bl_count[U]=0;for(ct[2*Gt.heap[Gt.heap_max]+1]=0,R=Gt.heap_max+1;R<p;R++)pc<(U=ct[2*ct[2*(g=Gt.heap[R])+1]+1]+1)&&(U=pc,rh++),ct[2*g+1]=U,Vt<g||(Gt.bl_count[U]++,W=0,fe<=g&&(W=Pe[g-fe]),rt=ct[2*g],Gt.opt_len+=rt*(U+W),ve&&(Gt.static_len+=rt*(Ue[2*g+1]+W)));if(rh!==0){do{for(U=pc-1;Gt.bl_count[U]===0;)U--;Gt.bl_count[U]--,Gt.bl_count[U+1]+=2,Gt.bl_count[pc]--,rh-=2}while(0<rh);for(U=pc;U!==0;U--)for(g=Gt.bl_count[U];g!==0;)Vt<(b=Gt.heap[--R])||(ct[2*b+1]!==U&&(Gt.opt_len+=(U-ct[2*b+1])*ct[2*b],ct[2*b+1]=U),g--)}}(F,V),Wt(gt,ge,F.bl_count)}function x(F,V,ht){var dt,tt,gt=-1,xt=V[1],mt=0,Ct=7,ge=4;for(xt===0&&(Ct=138,ge=3),V[2*(ht+1)+1]=65535,dt=0;dt<=ht;dt++)tt=xt,xt=V[2*(dt+1)+1],++mt<Ct&&tt===xt||(mt<ge?F.bl_tree[2*tt]+=mt:tt!==0?(tt!==gt&&F.bl_tree[2*tt]++,F.bl_tree[2*T]++):mt<=10?F.bl_tree[2*I]++:F.bl_tree[2*S]++,gt=tt,ge=(mt=0)===xt?(Ct=138,3):tt===xt?(Ct=6,3):(Ct=7,4))}function lt(F,V,ht){var dt,tt,gt=-1,xt=V[1],mt=0,Ct=7,ge=4;for(xt===0&&(Ct=138,ge=3),dt=0;dt<=ht;dt++)if(tt=xt,xt=V[2*(dt+1)+1],!(++mt<Ct&&tt===xt)){if(mt<ge)for(;at(F,tt,F.bl_tree),--mt!=0;);else tt!==0?(tt!==gt&&(at(F,tt,F.bl_tree),mt--),at(F,T,F.bl_tree),q(F,mt-3,2)):mt<=10?(at(F,I,F.bl_tree),q(F,mt-3,3)):(at(F,S,F.bl_tree),q(F,mt-11,7));gt=tt,ge=(mt=0)===xt?(Ct=138,3):tt===xt?(Ct=6,3):(Ct=7,4)}}c(et);var it=!1;function j(F,V,ht,dt){q(F,(l<<1)+(dt?1:0),3),function(tt,gt,xt,mt){Bt(tt),_t(tt,xt),_t(tt,~xt),s.arraySet(tt.pending_buf,tt.window,gt,xt,tt.pending),tt.pending+=xt}(F,V,ht)}i._tr_init=function(F){it||(function(){var V,ht,dt,tt,gt,xt=new Array(_+1);for(tt=dt=0;tt<u-1;tt++)for(L[tt]=dt,V=0;V<1<<C[tt];V++)k[dt++]=tt;for(k[dt-1]=tt,tt=gt=0;tt<16;tt++)for(et[tt]=gt,V=0;V<1<<P[tt];V++)O[gt++]=tt;for(gt>>=7;tt<h;tt++)for(et[tt]=gt<<7,V=0;V<1<<P[tt]-7;V++)O[256+gt++]=tt;for(ht=0;ht<=_;ht++)xt[ht]=0;for(V=0;V<=143;)J[2*V+1]=8,V++,xt[8]++;for(;V<=255;)J[2*V+1]=9,V++,xt[9]++;for(;V<=279;)J[2*V+1]=7,V++,xt[7]++;for(;V<=287;)J[2*V+1]=8,V++,xt[8]++;for(Wt(J,d+1,xt),V=0;V<h;V++)M[2*V+1]=5,M[2*V]=Ft(V,5);B=new st(J,C,f+1,d,_),$=new st(M,P,0,h,_),ot=new st(new Array(0),N,0,m,v)}(),it=!0),F.l_desc=new G(F.dyn_ltree,B),F.d_desc=new G(F.dyn_dtree,$),F.bl_desc=new G(F.bl_tree,ot),F.bi_buf=0,F.bi_valid=0,jt(F)},i._tr_stored_block=j,i._tr_flush_block=function(F,V,ht,dt){var tt,gt,xt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(mt){var Ct,ge=4093624447;for(Ct=0;Ct<=31;Ct++,ge>>>=1)if(1&ge&&mt.dyn_ltree[2*Ct]!==0)return o;if(mt.dyn_ltree[18]!==0||mt.dyn_ltree[20]!==0||mt.dyn_ltree[26]!==0)return a;for(Ct=32;Ct<f;Ct++)if(mt.dyn_ltree[2*Ct]!==0)return a;return o}(F)),Ge(F,F.l_desc),Ge(F,F.d_desc),xt=function(mt){var Ct;for(x(mt,mt.dyn_ltree,mt.l_desc.max_code),x(mt,mt.dyn_dtree,mt.d_desc.max_code),Ge(mt,mt.bl_desc),Ct=m-1;3<=Ct&&mt.bl_tree[2*z[Ct]+1]===0;Ct--);return mt.opt_len+=3*(Ct+1)+5+5+4,Ct}(F),tt=F.opt_len+3+7>>>3,(gt=F.static_len+3+7>>>3)<=tt&&(tt=gt)):tt=gt=ht+5,ht+4<=tt&&V!==-1?j(F,V,ht,dt):F.strategy===4||gt===tt?(q(F,2+(dt?1:0),3),Me(F,J,M)):(q(F,4+(dt?1:0),3),function(mt,Ct,ge,Gt){var nn;for(q(mt,Ct-257,5),q(mt,ge-1,5),q(mt,Gt-4,4),nn=0;nn<Gt;nn++)q(mt,mt.bl_tree[2*z[nn]+1],3);lt(mt,mt.dyn_ltree,Ct-1),lt(mt,mt.dyn_dtree,ge-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,xt+1),Me(F,F.dyn_ltree,F.dyn_dtree)),jt(F),dt&&Bt(F)},i._tr_tally=function(F,V,ht){return F.pending_buf[F.d_buf+2*F.last_lit]=V>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&V,F.pending_buf[F.l_buf+F.last_lit]=255&ht,F.last_lit++,V===0?F.dyn_ltree[2*ht]++:(F.matches++,V--,F.dyn_ltree[2*(k[ht]+f+1)]++,F.dyn_dtree[2*D(V)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){q(F,2,3),at(F,A,J),function(V){V.bi_valid===16?(_t(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(r,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,n,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},m=!1,p=o.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(o);_=_&&_.setTimeout?_:o,c={}.toString.call(o.process)==="[object process]"?function(T){Ln.nextTick(function(){v(T)})}:function(){if(o.postMessage&&!o.importScripts){var T=!0,I=o.onmessage;return o.onmessage=function(){T=!1},o.postMessage("","*"),o.onmessage=I,T}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(T){o.postMessage(f+T,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(T){v(T.data)},function(T){u.port2.postMessage(T)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(T){var I=p.createElement("script");I.onreadystatechange=function(){v(T),I.onreadystatechange=null,l.removeChild(I),I=null},l.appendChild(I)}):function(T){setTimeout(v,0,T)},_.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var I=new Array(arguments.length-1),S=0;S<I.length;S++)I[S]=arguments[S+1];var C={callback:T,args:I};return h[d]=C,c(d),d++},_.clearImmediate=w}function w(T){delete h[T]}function v(T){if(m)setTimeout(v,0,T);else{var I=h[T];if(I){m=!0;try{(function(S){var C=S.callback,P=S.args;switch(P.length){case 0:C();break;case 1:C(P[0]);break;case 2:C(P[0],P[1]);break;case 3:C(P[0],P[1],P[2]);break;default:C.apply(a,P)}})(I)}finally{w(T),m=!1}}}}function A(T){T.source===o&&typeof T.data=="string"&&T.data.indexOf(f)===0&&v(+T.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Br<"u"?Br:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ax);var Vz=Ax.exports,i0=fs(Vz);const Tx={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Tx);var Cn=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},Xo,dc,Ks;class qz{constructor(...t){Xo.set(this,new Map),dc.set(this,new Map),Ks.set(this,new Map);for(const r of t)this.define(r)}define(t,r=!1){for(let[n,i]of Object.entries(t)){n=n.toLowerCase(),i=i.map(a=>a.toLowerCase()),Cn(this,Ks,"f").has(n)||Cn(this,Ks,"f").set(n,new Set);const s=Cn(this,Ks,"f").get(n);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Cn(this,dc,"f").set(n,a),o=!1,c)continue;const l=Cn(this,Xo,"f").get(a);if(l&&l!=n&&!r)throw new Error(`"${n} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Cn(this,Xo,"f").set(a,n)}}return this}getType(t){if(typeof t!="string")return null;const r=t.replace(/^.*[/\\]/,"").toLowerCase(),n=r.replace(/^.*\./,"").toLowerCase(),i=r.length<t.length;return!(n.length<r.length-1)&&i?null:Cn(this,Xo,"f").get(n)??null}getExtension(t){var r;return typeof t!="string"?null:(t=(r=t==null?void 0:t.split)==null?void 0:r.call(t,";")[0],(t&&Cn(this,dc,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Cn(this,Ks,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of Cn(this,Ks,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Cn(this,Xo,"f"),extensions:Cn(this,dc,"f")}}}Xo=new WeakMap,dc=new WeakMap,Ks=new WeakMap;var Xz=new qz(Tx)._freeze();function Jz(e,t){console.info(t)}const Zz=/; \$(\w+) ?(.*)/,Qz=/title (.+?) (.*)/i;function s0(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function t7(e,t){const r=rx();if(!y(r))return;const n=t.split(/\r?\n/),i={title:"",gendate:"",gentime:"",songs:[]};function s(m){return i.songs.find(p=>p.order===m)}function o(m,p){return{order:m,title:p,lines:[]}}for(let m=0;m<n.length;++m){const p=n[m],_=Zz.exec(p);if(y(_)){const w=_[1].toLowerCase(),v=_[2];switch(w){case"title":i.title=v;break;case"gendate":i.gendate=v;break;case"gentime":i.gentime=v;break;case"song":{const A=Qz.exec(v);if(y(A)){const T=parseFloat(A[1]),I=A[2],S=s(T);y(S)?S.title=I:i.songs.push(o(T,I))}else{const T=parseFloat(v);if(wt(T)){const I=s(T);y(I)||i.songs.push(o(T,""))}}break}}}else{const w=i.songs[i.songs.length-1];y(w)&&p.trim().length&&w.lines.push(p)}}i.songs.sort((m,p)=>m.order-p.order);const a=i.songs.map(m=>m.title),c=`@play_${It(i.title).replace(/\W/g,"")}
@cycle 1
@char 14
#end

:touch
"ALBUM: ${s0(i.title)}"
"$purple  ${s0(i.gendate)}"
"$purple  ${s0(i.gentime)}"
${a.map((m,p)=>`!song_${p};${p+1} ${m||"untitled"}`).join(`
`)}
#end

${i.songs.map((m,p)=>`:song_${p}
${m.lines.map(_=>`#play ${_}`).join(`
`)}
#end
`).join(`
`)}
`,l=yu(c,{}),u=pe(l);Qa(r,l),_c(Z,e,`imported zzt zzm file ${u} into ${r.name} book`);const f=pe(l),d=pi(l);me(Z,e,`!pageopen ${l.id};$blue[${d}]$white ${f}`);const h=`#put n ${u}`;NF(Z,e,h,h,!1)}const Zu=60,e7=Zu*25;function r7(e,t){let r=0;const n=new DataView(t.buffer);function i(){const L=n.getUint8(r);return r++,L}function s(){const L=n.getInt16(r,!0);return r+=2,L}function o(){const L=n.getInt32(r,!0);return r+=4,L}function a(L){let B="";const $=t.subarray(r,r+L);for(let ot=0;ot<$.length;++ot)B+=String.fromCharCode($[ot]);return r+=L,B.replace("\r",`
`)}function c(L,B,$,ot){const et=In(L,B,$);if(y(et)&&y(ot)){const st=on(ot);for(let G=0;G<st.length;++G){const D=st[G];et[D]=ot[D]}}}function l(L){let B="";for(let $=0;$<L.length;++$){const ot=L.charCodeAt($);ot<32||ot>127?B+=`$${ot}`:B+=L[$]}return B}function u(L){return L.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(B=>B.replace("$","$CENTER ")).map(l).join(`
`)}function f(L,B,$,ot,et){const st=ot.color%16,G=Math.floor(ot.color/16)%8,D=Qc(st,G),_t=Qc((G+8)%16,st),q={},at=et.find(Ft=>Ft.x===B&&Ft.y===$);switch(y(at)&&(wt(at.cycle)&&at.cycle>0&&(q.cycle=at.cycle),y(at.p1)&&(q.p1=at.p1),y(at.p2)&&(q.p2=at.p2),y(at.p3)&&(q.p3=at.p3),y(at.code)&&at.code&&(q.code=u(at.code)),y(at.stepx)&&(q.stepx=at.stepx),y(at.stepy)&&(q.stepy=at.stepy)),ot.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(L,["ammo",D],{x:B,y:$},q);break;case 6:c(L,["torch",D],{x:B,y:$},q);break;case 7:c(L,["gem",D],{x:B,y:$},q);break;case 8:c(L,["key",D],{x:B,y:$},q);break;case 9:c(L,["door",_t],{x:B,y:$},q);break;case 10:c(L,["scroll",D],{x:B,y:$},q);break;case 11:{q.p3=d(at==null?void 0:at.p3)??"",c(L,["passage",D],{x:B,y:$},q);break}case 12:c(L,["duplicator",D],{x:B,y:$},q);break;case 13:c(L,["bomb",D],{x:B,y:$},q);break;case 14:c(L,["energize",D],{x:B,y:$},q);break;case 15:c(L,["star",D],{x:B,y:$},q);break;case 16:c(L,["clockwise",D],{x:B,y:$},q);break;case 17:c(L,["counter",D],{x:B,y:$},q);break;case 18:c(L,["bullet",D],{x:B,y:$},q);break;case 19:c(L,["water",D],{x:B,y:$},q);break;case 20:c(L,["forest",D],{x:B,y:$},q);break;case 21:c(L,["solid",D],{x:B,y:$},q);break;case 22:c(L,["normal",D],{x:B,y:$},q);break;case 23:c(L,["breakable",D],{x:B,y:$},q);break;case 24:c(L,["boulder",D],{x:B,y:$},q);break;case 25:c(L,["sliderns",D],{x:B,y:$},q);break;case 26:c(L,["sliderew",D],{x:B,y:$},q);break;case 27:c(L,["fake",D],{x:B,y:$},q);break;case 28:c(L,["invisible",D],{x:B,y:$},q);break;case 29:c(L,["blinkwall",D],{x:B,y:$},{...q,stepx:0,stepy:0,shootx:q.stepx??0,shooty:q.stepx??0});break;case 30:c(L,["transporter",D],{x:B,y:$},q);break;case 31:c(L,["line",D],{x:B,y:$},q);break;case 32:c(L,["ricochet",D],{x:B,y:$},q);break;case 33:c(L,["blinkns",D],{x:B,y:$},q);break;case 34:c(L,["bear",D],{x:B,y:$},q);break;case 35:c(L,["ruffian",D],{x:B,y:$},q);break;case 36:c(L,["object",D],{x:B,y:$},{...q,char:(at==null?void 0:at.p1)??1});break;case 37:c(L,["slime",D],{x:B,y:$},q);break;case 38:c(L,["shark",D],{x:B,y:$},q);break;case 39:c(L,["spinninggun",D],{x:B,y:$},q);break;case 40:c(L,["pusher",D],{x:B,y:$},q);break;case 41:c(L,["lion",D],{x:B,y:$},q);break;case 42:c(L,["tiger",D],{x:B,y:$},q);break;case 43:c(L,["blinkns",D],{x:B,y:$},q);break;case 44:c(L,["head",D],{x:B,y:$},q);break;case 45:c(L,["segment",D],{x:B,y:$},q);break;case 46:break;case 47:c(L,["text",["WHITE","ONDKBLUE"]],{x:B,y:$},{...q,char:ot.color});break;case 48:c(L,["text",["WHITE","ONDKGREEN"]],{x:B,y:$},{...q,char:ot.color});break;case 49:c(L,["text",["WHITE","ONDKCYAN"]],{x:B,y:$},{...q,char:ot.color});break;case 50:c(L,["text",["WHITE","ONDKRED"]],{x:B,y:$},{...q,char:ot.color});break;case 51:c(L,["text",["WHITE","ONDKPURPLE"]],{x:B,y:$},{...q,char:ot.color});break;case 52:c(L,["text",["WHITE","ONDKYELLOW"]],{x:B,y:$},{...q,char:ot.color});break;case 53:c(L,["text",["WHITE","ONBLACK"]],{x:B,y:$},{...q,char:ot.color});break}}function d(L){if(wt(L)&&L>0)return`zztboard${L}`}if(s()!=-1)return;const m=s(),p=s(),_=s(),w=a(7),v=s(),A=s(),T=s(),I=s(),S=s();s();const C=s(),P=i(),N=a(20).slice(0,P);for(let L=0;L<9;L++){const B=i();a(20).slice(0,B)}const z=s(),J=s(),M=i();console.info(p,_,w,v,A,T,I,S,C,z,J,M),r=512;const O=[];for(let L=0;L<m;++L){const B=s(),$=r,ot=i(),st={boardname:a(50).slice(0,ot),elements:[],stats:[]};for(;st.elements.length<e7;){let D=i();D===0&&(D=255);const _t=i(),q=i();for(let at=0;at<D;++at)st.elements.push({element:_t,color:q})}st.maxplayershots=i(),st.isdark=i(),st.exitnorth=i(),st.exitsouth=i(),st.exitwest=i(),st.exiteast=i(),st.restartonzap=i(),st.messagelength=i(),st.message=a(58).slice(0,st.messagelength),st.playerenterx=i(),st.playerentery=i(),st.timelimit=s(),r+=16;const G=s()+1;for(;st.stats.length<G;){const D={};D.x=i()-1,D.y=i()-1,D.stepx=s(),D.stepy=s(),D.cycle=s(),D.p1=i(),D.p2=i(),D.p3=i(),D.follower=s(),D.leader=s(),D.underelement=i(),D.undercolor=i(),D.pointer=o(),D.currentinstruction=s();const _t=s();r+=8,_t<0?D.bind=Math.abs(_t):D.code=a(_t),st.stats.push(D)}O.push(st),r=$+B}const k=mp([]);k.name=N;for(let L=0;L<O.length;++L){const B=O[L],$=[`@zztboard${L}`,""];L===0?$.push("@title"):L===A&&$.push("@zztstartboard");for(let Wt=0;Wt<B.elements.length;++Wt)B.elements[Wt].element===4&&($.push(`@startx ${Rg(Wt,Zu)}`),$.push(`@starty ${Og(Wt,Zu)}`));wt(B.maxplayershots)&&$.push(`@maxplayershots ${B.maxplayershots}`),wt(B.isdark)&&$.push(`@isdark ${B.isdark}`),wt(B.restartonzap)&&$.push(`@restartonzap ${B.restartonzap}`),wt(B.timelimit)&&$.push(`@timelimit ${B.timelimit}`);const ot=d(B.exitnorth);pt(ot)&&$.push(`@exitnorth ${ot}`);const et=d(B.exitsouth);pt(et)&&$.push(`@exitsouth ${et}`);const st=d(B.exitwest);pt(st)&&$.push(`@exitwest ${st}`);const G=d(B.exiteast);pt(G)&&$.push(`@exiteast ${G}`);const D=`@board ${String(L).padStart(3,"0")}. ${B.boardname}
${$.join(`
`)}`,_t=yu(D,{});Qa(k,_t);const q=Oe(_t);if(!y(q))continue;let at=0,Ft=0;for(let Wt=0;Wt<B.elements.length;++Wt){const jt=B.elements[Wt];f(q,at,Ft,jt,B.stats),++at,at===Zu&&(at=0,++Ft)}Ie(q)}zu(k),_c(Z,e,`imported zzt file into ${k.name} book`)}function n7(e,t){const r=rx();if(!y(r))return;const n=yu(t,{}),i=pe(n);Qa(r,n),_c(Z,e,`imported zzt obj file ${i} into ${r.name} book`)}function Sx(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return Xz.getType(e)??"application/octet-stream"}function Rx(e,t){if(!y(t))return"";switch(e){case"model/obj":return"obj";case"text/plain":return"txt";case"application/json":return"json";case"application/zip":return"zip";case"application/octet-stream":if(/.zzt$/i.test(t.name))return"zzt";if(/.brd$/i.test(t.name))return"brd";if(/.zzl$/i.test(t.name))return"zzl";if(/.zzm$/i.test(t.name))return"zzm";break}return""}let Jo=[],Qu={};async function i7(e,t){try{Ae(Z,e,"parsezipfile",t.name);const r=await t.arrayBuffer(),i=await new i0().loadAsync(r);Jo=[],Qu={};const s=[];i.forEach((o,a)=>s.push([o,a]));for(let o=0;o<s.length;++o){const[a,c]=s[o],l=await c.async("uint8array"),u=Sx(a,l),f=new File([l],c.name,{type:u});Jo.push(f)}fT(Z,e)}catch(r){de(Z,e,"crash",r.message)}}function s7(){const e=[];for(let t=0;t<Jo.length;++t){const r=Jo[t];e.push([Rx(r.type,r),r.name])}return e}function o7(e,t){Qu[e]=t}function a7(e){return Qu[e]}async function c7(e){for(let t=0;t<Jo.length;++t){const r=Jo[t];Qu[r.name]&&(o0(e,r),await _h(2e3))}}function Ox(e,t,r){if(!y(r))return;switch(Rx(t,r)){case"obj":r.text().then(i=>n7(e,i)).catch(i=>de(Z,e,"crash",i.message));break;case"txt":r.text().then(i=>gh(Z,e,void 0,"text",`file:${r.name}`,i)).catch(i=>de(Z,e,"crash",i.message));break;case"json":r.text().then(i=>gh(Z,e,void 0,"json",`file:${r.name}`,i)).catch(i=>de(Z,e,"crash",i.message));break;case"zip":i7(e,r).catch(i=>de(Z,e,"crash",i.message));break;case"zzt":r.arrayBuffer().then(i=>{r7(e,new Uint8Array(i))}).catch(i=>de(Z,e,"crash",i.message));break;case"brd":r.arrayBuffer().then(i=>{}).catch(i=>de(Z,e,"crash",i.message));break;case"zzl":r.text().then(i=>{Jz(e,i)}).catch(i=>de(Z,e,"crash",i.message));break;case"zzm":r.text().then(i=>{t7(e,i)}).catch(i=>de(Z,e,"crash",i.message));break;default:t||r.arrayBuffer().then(i=>{const s=Sx(r.name,new Uint8Array(i));if(s)Ox(e,s,r);else return de(Z,e,"parsewebfile",`unsupported file ${r.name}`)}).catch(i=>de(Z,e,"crash",i.message));return}}function o0(e,t){Ox(e,(t==null?void 0:t.type)??"",t)}const th="https://bridge.zed.cafe";async function l7(e,t,r){const n=`offset=${r}&${e}=${t}`,i=new Request(`${th}/api/v1/search/files/?${n}`);return(await(await fetch(i)).json()).data.results}async function u7(){const e=new Request(`${th}/api/v1/get/random-file/`);return[(await(await fetch(e)).json()).data]}function h7(e){return`${th}/static/${e}`}async function f7(e,t){const n=await(await fetch(`${th}/zgames/${t}`)).arrayBuffer(),i=new File([n],t);o0(e,i)}function rn(e,t,r){r().catch(n=>{console.error(n),de(e,t,"crash",n==null?void 0:n.message)})}function d7(e){const[t,r]=e.split(":"),n=y(r);return[n?t:"self",n?r:e]}function p7(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-t.length%4)%4);return t+r}function m7(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const g7=new Date("1980/09/02");async function a0(e){return console.info("saved",e),new Promise((t,r)=>{const n=new i0;for(let i=0;i<e.length;++i){const s=e[i],o=I$(s);if(o){const a=WC(o);y(a)&&n.file(s.id,a,{date:g7})}}n.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(m7(i))}).catch(r)})}async function y7(e){return new Promise((t,r)=>{const n=new i0,i=p7(e);n.loadAsync(i,{base64:!0}).then(async()=>{const s=[],o=[];n.forEach((a,c)=>o.push(c));for(let a=0;a<o.length;++a){const c=o[a],l=await c.async("uint8array"),u=x_(l);if(y(u)){const f=Uk(u);y(f)&&s.push(f)}else{const f=await c.async("string"),d=x_(f);if(y(d)){const h=Uk(d);y(h)&&s.push(h)}}}t(s)}).catch(r)})}function _7(e,t,r,n){const i=Je(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){wt(u)&&(s=u,Ig(t.x,t.y,r.x,r.y).forEach(f=>{const d=se(i,f);y(d)&&(d[l]=u)}))}At(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe),Nt(e,`batch:${mo(t,r)}`,"char",[n,"charedit"],o,a);const c=Le(e);c.scrollname="bulk set char",c.scroll=lr(e)}function b7(e,t,r,n){const i=Je(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){if(wt(u)){s=u;for(let f=t.y;f<=r.y;++f)for(let d=t.x;d<=r.x;++d){const h=se(i,{x:d,y:f});y(h)&&(h[l]=u)}}}At(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe),Nt(e,`batch:${mo(t,r)}`,"color",[n,"coloredit"],o,a);const c=Le(e);c.scrollname="bulk set color",c.scroll=lr(e)}function w7(e,t,r,n){const i=Je(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){wt(u)&&(s=u,Ig(t.x,t.y,r.x,r.y).forEach(f=>{const d=se(i,f);y(d)&&(d[l]=u)}))}At(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe),Nt(e,`batch:${mo(t,r)}`,"color",[n,"coloredit"],o,a);const c=Le(e);c.scrollname="bulk set bg",c.scroll=lr(e)}function E7(e,t,r,n){const i=_r(Dt.MAIN);if(!y(i))return;const s=Je(e);if(!y(s))return;const o=mo(t,r);At(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe),Nt(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Nt(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),n&&Nt(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Nt(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),Nt(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),At(e,Qe),Nt(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Nt(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Nt(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),At(e,Qe),Nt(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),At(e,Qe),At(e,"codepages:");const a=Math.min(t.x,r.x),c=Math.min(t.y,r.y),l=Math.max(t.x,r.x),u=Math.max(t.y,r.y),f=new Set;for(let h=c;h<=u;++h)for(let m=a;m<=l;++m){const p=se(s,{x:m,y:h}),_=Fk(i,p);y(_)&&!f.has(_.id)&&(f.add(_.id),Nt(e,"batch",`edit @${pe(_)}`,[`pageopen:${_.id}`]))}const d=en(bt.BOARD,s.id);At(e,pe(d)),Nt(e,"batch",`id ${s.id}`,["","copyit",s.id]),Nt(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}function c0(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function k7(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=c0(r);return(i,s)=>n.then(o=>s(o.transaction(t,i).objectStore(t)))}let l0;function Ix(){return l0||(l0=k7("keyval-store","keyval")),l0}function Nx(e,t=Ix()){return t("readonly",r=>c0(r.get(e)))}function Cx(e,t,r=Ix()){return r("readwrite",n=>new Promise((i,s)=>{n.get(e).onsuccess=function(){try{n.put(t(this.result),e),i(c0(n.transaction))}catch(o){s(o)}}}))}function u0(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function Lx(){return Nx("secretheap")}async function Mx(e){return Cx("secretheap",e)}async function v7(){return!!await Lx()}function Ux(e,t,r){const n=Math.min(t.x,r.x),i=Math.min(t.y,r.y),s=Math.max(t.x,r.x),o=Math.max(t.y,r.y),a=s-n+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=n;d<=s;++d){const h={x:d-n,y:f-i},m=se(e,{x:d,y:f});(m==null?void 0:m.category)===jr.ISOBJECT?(l.push(Yn(ls(e,d,f))),yr(m).name!=="player"&&u.push({...Yn(m),...h,id:"blank"})):l.push({...Yn(m),...h})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function x7(e,t,r,n){const i=Je(e);if(!y(i))return;const s=Ux(i,t,r);switch(n){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await Mx(()=>s)}function A7(e,t,r){const n=u0(t,r);At(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe),Nt(e,"batch","copy terrain & objects",[`copyall:${n}`,"hk","1"]),Nt(e,"batch","copy objects",[`copyobjects:${n}`,"hk","2"]),Nt(e,"batch","copy terrain",[`copyterrain:${n}`,"hk","3"]);const i=Le(e);i.scrollname="copy",i.scroll=lr(e)}async function T7(e,t,r,n){const i=_r(Dt.MAIN);if(!y(i))return;const s=Je(e);if(!y(s))return;const o=Ux(s,t,r);switch(n){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(n){case"cutall":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c){const l=se(s,{x:c,y:a});(l==null?void 0:l.category)===jr.ISOBJECT&&Or(s,l,i.timestamp),Ce(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c){const l=se(s,{x:c,y:a});(l==null?void 0:l.category)===jr.ISOBJECT&&Or(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c)Ce(s,{x:c,y:a});break}}await Mx(()=>o)}function S7(e,t,r){const n=u0(t,r);At(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe),Nt(e,"batch","cut terrain & objects",[`cutall:${n}`,"hk","1"]),Nt(e,"batch","cut objects",[`cutobjects:${n}`,"hk","2"]),Nt(e,"batch","cut terrain",[`cutterrain:${n}`,"hk","3"]);const i=Le(e);i.scrollname="cut",i.scroll=lr(e)}async function R7(e,t,r,n){const i=Je(e),s=await Lx();if(!y(i)||!y(s))return;const o=Math.min(t.x,r.x),a=Math.min(t.y,r.y),c=Math.max(t.x,r.x),l=Math.max(t.y,r.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(n){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<d;++p){const _=Gr({x:p,y:m},s.width);Ce(i,{...s.terrain[_],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];y(p.x)&&y(p.y)&&mf(p.x,p.y,0,u-1,f-1,0)&&t0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];y(p.x)&&y(p.y)&&mf(p.x,p.y,0,u-1,f-1,0)&&t0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<d;++p){const _=Gr({x:p,y:m},s.width);Ce(i,{...s.terrain[_],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const _=(p-o)%s.width,w=(m-a)%s.height,v=Gr({x:_,y:w},s.width);Ce(i,{...s.terrain[v],x:p,y:m})}break}}function O7(e,t,r){const n=u0(t,r);At(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe),Nt(e,"batch","paste terrain & objects",[`pasteall:${n}`,"hk","1"]),Nt(e,"batch","paste objects",[`pasteobjects:${n}`,"hk","2"]),Nt(e,"batch","paste terrain",[`pasteterrain:${n}`,"hk","3"]),Nt(e,"batch","paste terrain tiled",[`pasteterraintiled:${n}`,"hk","4"]);const i=Le(e);i.scrollname="paste",i.scroll=lr(e)}function h0(e,t){return`inspect:${t!=null&&t.id?t.id:Kn(e,t)}`}function I7(e,t,r){const n=_r(Dt.MAIN);if(!y(n))return;const i=Je(e);if(!y(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){y(t)&&(t[d]=h)}const a=t.category===jr.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=h0(i,t);At(e,`${a}: ${c} ${l}`),At(e,Qe),Nt(e,u,"color",[r,"coloredit"],s,o);const f=Le(e);f.scrollname="color",f.scroll=lr(e)}function N7(e,t,r){const n=_r(Dt.MAIN);if(!y(n))return;const i=Je(e);if(!y(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){y(t)&&(t[d]=h)}const a=t.category===jr.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=h0(i,t);At(e,`${a}: ${c} ${l}`),At(e,Qe),Nt(e,u,"char",[r,"charedit"],s,o);const f=Le(e);f.scrollname="char",f.scroll=lr(e)}function C7(e,t,r,n,i,s){var m,p,_;const o=_r(Dt.MAIN);if(!y(o))return;function a(w){var A;const v=(n==null?void 0:n[w])??((A=n==null?void 0:n.kinddata)==null?void 0:A[w]);if(!y(v))switch(w){case"color":return 15;case"bg":return 0;case"cycle":return M0;case"collision":return Mt.ISWALK;case"pushable":return 0;case"breakable":return 0}return v}function c(w,v){y(n)&&(n[w]=v)}s?At(e,`object: ${n.name??n.kind??"ERR"} ${i.x}, ${i.y}`):At(e,`terrain: ${n.kind??"ERR"} ${i.x}, ${i.y}`);const l=h0(t,n);switch(s&&At(e,`cycle: ${zt(n,"cycle")}`),zt(n,"collision")){case Mt.ISWALK:At(e,"collision: iswalk");break;case Mt.ISSWIM:At(e,"collision: isswim");break;case Mt.ISSOLID:At(e,"collision: issolid");break;case Mt.ISBULLET:At(e,"collision: isbullet");break;case Mt.ISGHOST:At(e,"collision: isghost");break}if(s){const w=zt(n,"pushable");At(e,`ispushable: ${w||"no"}`)}At(e,`isbreakable: ${zt(n,"breakable")?"yes":"no"}`),At(e,Qe);const f=Ja(r),d=on(f);for(let w=0;w<d.length;++w){const v=d[w];switch(v){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ce(f[v])){const[A,T,...I]=f[v];pt(T)&&Nt(e,l,T||v,[v,A,...I],a,c)}break}}Nt(e,l,"copy coords",["copycoords","hk","5"," 5 "]),At(e,Qe),Nt(e,l,`char: ${n.char??((m=n.kinddata)==null?void 0:m.char)??1}`,["char","hk","a"," A ","next"],a,c),Nt(e,l,`color: ${n.color??((p=n.kinddata)==null?void 0:p.color)??15}`,["color","hk","c"," C ","next"],a,c),Nt(e,l,`bg: ${n.bg??((_=n.kinddata)==null?void 0:_.bg)??0}`,["bg","hk","b"," B ","next"],a,c),At(e,Qe),Nt(e,l,"make empty",["empty","hk","0"],a,c),At(e,Qe),Nt(e,"batch",`edit @${pe(r)}`,[`pageopen:${r.id}`]);const h=en(bt.BOARD,t.id);At(e,pe(h)),Nt(e,"batch",`id ${t.id}`,["","copyit",t.id]),Nt(e,"batch","edit @board codepage",[`pageopen:${t.id}`])}function L7(e,t,r,n){const i=_r(Dt.MAIN);if(!y(i))return;const s=Je(e);if(y(s))switch(n){case"emptyall":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a){const c=se(s,{x:a,y:o});(c==null?void 0:c.category)===jr.ISOBJECT&&Or(s,c,i.timestamp),Ce(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a){const c=se(s,{x:a,y:o});(c==null?void 0:c.category)===jr.ISOBJECT&&Or(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a)Ce(s,{x:a,y:o});break}}}function M7(e,t,r){const n=_r(Dt.MAIN);if(!y(n))return;const i=Je(e);if(!y(i))return;const s=mo(t,r);At(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe),Nt(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Nt(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Nt(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Le(e);o.scrollname="empty",o.scroll=lr(e)}async function U7(e,t,r){const n=_r(Dt.MAIN),i=await v7();if(!y(n))return;const s=Je(e);if(!y(s))return;if(Ie(s),t.x===r.x&&t.y===r.y){const a=se(s,t),c=Fk(n,a);if(y(a)&&y(c)&&C7(e,s,c,a,t,Ve(a)),!(a!=null&&a.kind)){At(e,`empty: ${t.x}, ${t.y}`),At(e,Qe),Nt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]);const l=en(bt.BOARD,s.id);At(e,pe(l)),Nt(e,"batch",`id ${s.id}`,["","copyit",s.id]),Nt(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}}else E7(e,t,r,i);const o=Le(e);o.scrollname="inspect",o.scroll=lr(e)}function P7(e,t){const r=ue(Dt.MAIN);if(!y(r))return;const n=Je(t);if(!y(n))return;const i=zr(e),s=yx(n,i.target);if(y(s))switch(i.path){case"copycoords":ph(Z,$r(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":I7(t,s,i.path);break;case"char":N7(t,s,i.path);break;case"empty":Or(n,s,r.timestamp);break;case"code":rn(Z,t,async()=>{const o=yr(s),a="object";Ae(Z,t,`opened [${a}] ${o.name}`);const c=[n.id,s.id];pf(bc(r.id,c),s.code??""),jA(Z,t),await _h(800),I0(Z,t,r.id,c,a,`${name} - ${r.name}`)});break;default:console.info("unknown inspect",i);break}}async function $7(e,t){const r=Je(t);if(!y(r))return;const n=zr(e),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"copy":A7(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await x7(t,c,l,n.target);break;case"cut":S7(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await T7(t,c,l,n.target);break;case"paste":O7(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await R7(t,c,l,n.target);break;case"empty":M7(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":L7(t,c,l,n.target);break;case"chars":_7(t,c,l,"char");break;case"colors":b7(t,c,l,"color");break;case"bgs":w7(t,c,l,"bg");break;case"copycoords":ph(Z,t,[i,s,o,a].join(" "));break;case"pageopen":rn(Z,t,async()=>{await _h(800),dT(Z,t,`#pageopen ${n.path}`)});break;default:console.info("unknown batch",n);break}}async function F7(){return Nx("remixconfig")}async function B7(e){return Cx("remixconfig",e)}let us={stat:"",patternsize:2,mirror:1};async function D7(e,t){const r=Je(t);if(!y(r))return;const n=zr(e),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"remix":{await j7(t,c,l);break}case"remixrun":{const u=ar(us.stat);y(u)&&Rv(r.id,u.id,us.patternsize,us.mirror,c,l,"all"),await B7(()=>us);break}default:console.info("unknown remix",n);break}}async function j7(e,t,r){const n=await F7();us={...us,...n};const i=mo(t,r);At(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),At(e,Qe);function s(c){const{target:l}=zr(c);return us[l]}function o(c,l){if(wt(l)||pt(l)){const{target:u}=zr(c);us[u]=l}}Nt(e,"remix","source board",[`stat:${i}`,"text"],s,o),Nt(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),Nt(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),At(e,Qe),Nt(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Le(e);a.scrollname="remix",a.scroll=lr(e)}const z7=16,hs={},eh={},G7=60;let Px=0;const Zo={},Qo={};async function $x(e){const t=Rn(),r=ue(Dt.MAIN);if(t.length&&y(r)){const n=await a0(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${r.name} ${n.length} chars`;WA(Kt,$r(),i,n)}}async function W7(){const e=Rn(),t=ue(Dt.MAIN);if(e.length&&y(t)){const r=await a0(e);HA(Kt,$r(),r)}}async function H7(){const e=Rn(),t=ue(Dt.MAIN);return e.length&&y(t)?a0(e):""}const Fx="$176$176$177$177$178 ZZT BRIDGE $178$177$177$176$176";function Bx(e){At(e,`Searching ${"$6".repeat(_n(1,6))}`);const t=Le(e);t.scrollname=Fx,t.scroll=lr(e)}function Dx(e,t){for(let n=0;n<e.length;++n){const i=e[n],s=`pub: ${new Date(i.publish_date).toLocaleDateString()}`;At(t,`$white${i.title}`),At(t,`$yellow  ${i.author.join(", ")}`),At(t,`$dkgreen  ${i.genres.join(", ")}`),At(t,`$purple  ${s}`),i.screenshot&&Nt(t,"zztbridge",i.screenshot,["screenshot","viewit",h7(i.screenshot)]),Nt(t,"zztbridge",i.filename,["zztimport","hyperlink",`${i.letter}/${i.filename}`]),At(t," ")}const r=Le(t);r.scrollname=Fx,r.scroll=lr(t)}const Kt=Vs("vm",["tick","second"],e=>{var r;if(!Kt.session(e))return;const t=$r();switch(e.target){case"operator":pz(e.player),Ae(Kt,e.player,`operator set to ${e.player}`),Kt.replynext(e,"ackoperator",!0);break;case"zsswords":{const n=ue(Dt.MAIN);Kt.replynext(e,"ackzsswords",{cli:Dp(ss.CLI),loader:Dp(ss.LOADER),runtime:Dp(ss.RUNTIME),flags:[...on(Nn(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","playerid","playerx","playery","thisid","thisx","thisy","senderid","senderx","sendery","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isghost","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"],kinds:[...Fs(n,bt.OBJECT).map(i=>pe(i)),...on(Fp)],altkinds:[...Fs(n,bt.TERRAIN),...Fs(n,bt.BOARD),...Fs(n,bt.PALETTE),...Fs(n,bt.CHARSET),...Fs(n,bt.LOADER)].map(i=>pe(i)),colors:[...on(_a)],dirs:[...on(kf).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...on(Pp)],exprs:["aligned","alligned","contact","blocked","any","countof","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&rn(Kt,e.player,async()=>{if(ce(e.data)){const[n,i]=e.data,s=await y7(n),o=s.map(a=>a.name);Ez(s,i),Ae(Kt,e.player,`loading ${o.join(", ")}`),dh(Kt,e.player)}});break;case"search":xz(e.player)||dh(Kt,e.player);break;case"logout":vz(e.player),delete hs[e.player],Ae(Kt,t,`player ${e.player} logout`),dh(Kt,e.player);break;case"login":ax(e.player)?(zA(Kt,e.player),hs[e.player]=0,Ae(Kt,$r(),`login from ${e.player}`),Kt.replynext(e,"acklogin",!0)):T0(Kt,e.player);break;case"local":ax(e.player)?(hs[e.player]=0,Ae(Kt,$r(),`login from ${e.player}`)):T0(Kt,e.player);break;case"doot":hs[e.player]=0,eh[e.player]=eh[e.player]??0,eh[e.player]%32===0&&Ae(Kt,e.player,`$whiteactive $blue${e.player}`),++eh[e.player];break;case"input":{if(e.player.includes("local")&&!sx(e.player)&&hT(Kt,e.player),!e.player.includes("local")||sx(e.player)){const n=Nn(e.player),[i=Nr.NONE,s=0]=e.data??[Nr.NONE,0];ce(n.inputqueue)||(n.inputqueue=[]),i!==Nr.NONE&&n.inputqueue.push([i,s])}break}case"codewatch":if(ce(e.data)){const[n,i]=e.data,s=bc(n,i);y(Qo[s])||(Qo[s]=Tg(s,o=>{const[a,c]=i,l=Hn(n),u=$s(l,a);if(y(u))if(di(u)===bt.BOARD&&y(c)){const f=Oe(u),d=Fr(f,c);y(d)&&(d.code=o,bu(pp(o),d))}else u.code=o,S$(u)})),Zo[s]=Zo[s]??new Set,Zo[s].add(e.player)}break;case"coderelease":if(ce(e.data)){const[n,i]=e.data,[,s]=i,o=bc(n,i);y(Zo[o])&&(Zo[o].delete(e.player),Zo[o].size===0&&((r=Qo[o])==null||r.call(Qo),Qo[o]=void 0,pt(s)&&Rz(s)))}break;case"halt":e.player===t&&xA(e.data)&&mz(e.data);break;case"tick":Iz(gz());break;case"synthsend":if(pt(e.data)){const[n,i]=d7(e.data),s=ue(Dt.MAIN);Vo(n,i,void 0,Do(s))}break;case"second":{Az(hs);const n=Object.keys(hs);for(let i=0;i<n.length;++i)++hs[n[i]];for(let i=0;i<n.length;++i){const s=n[i];hs[s]>=z7&&N0(Kt,s)}++Px>=G7&&(Px=0,rn(Kt,e.player,async()=>{await $x(!0)}));break}case"copyjsonfile":if(e.player===t){const n=ue(Dt.MAIN);if(y(n)&&ce(e.data)){const[i]=e.data,s=$s(n,i);y(s)&&YA(Kt,t,s,`${pe(s)}.${pi(s)}.json`)}}break;case"refscroll":{Nt(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Nt(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Nt(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const n=Le(e.player);n.scrollname="refscroll",n.scroll=lr(e.player);break}case"readzipfilelist":{const n=s7();At(e.player,"$CENTER Select Files"),Nt(e.player,"zipfilelist","import selected",["importselectedfiles"]);for(let s=0;s<n.length;++s){const[o,a]=n[s];Nt(e.player,"zipfilelist",`[${o}] ${a}`,[It(a),"select","NO","0","YES","1"],c=>a7(c)?1:0,(c,l)=>{o7(c,!!l)})}const i=Le(e.player);i.scrollname="zipfilelist",i.scroll=lr(e.player);break}case"fork":e.player===t&&rn(Kt,e.player,async()=>{await W7()});break;case"zztsearch":rn(Kt,e.player,async()=>{if(ce(e.data)){const[n,i]=e.data;let s=0;const o=[];for(;o.length<256;){Bx(e.player);const a=await l7(n,i,s);if(s+=a.length,o.push(...a),a.length<25)break}Dx(o,e.player)}});break;case"zztrandom":rn(Kt,e.player,async()=>{Bx(e.player);const n=await u7();Dx(n,e.player)});break;case"itchiopublish":rn(Kt,e.player,async()=>{if(e.player===t){const n=ue(Dt.MAIN);if(y(n)){const i=await H7();KA(Kt,e.player,n.name,i)}}});break;case"flush":e.player===t&&rn(Kt,e.player,async()=>{await $x()});break;case"cli":ux(e.player,e.data);break;case"clirepeatlast":Nz(e.player);break;case"restart":e.player===t&&(Oz(),L0(Kt,e.player));break;case"inspect":rn(Kt,e.player,async()=>{if(ce(e.data)){const[n,i]=e.data;await U7(e.player,n,i)}});break;case"loader":if(ce(e.data)){const[n,i,s,o]=e.data;switch(i){case"file":o0(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){Ae(Kt,e.player,`loading ${s}`);const a=JSON.parse(o.json);y(a.data)&&pt(a.exported)&&(zu(a.data),Ae(Kt,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){Ae(Kt,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ue(Dt.MAIN);y(c)&&y(a.data)&&pt(a.exported)&&(Qa(c,a.data),Ae(Kt,e.player,`loaded ${a.exported}`))}else _v(n,i,s,o,e.player);break;default:_v(n,i,s,o,e.player);break}}break;default:{const{target:n,path:i}=zr(e.target);switch(It(n)){case"refscroll":switch(i){case"charscroll":{Nt(e.player,"refscroll","char",["char","charedit"]);const s=Le(e.player);s.scrollname="chars",s.scroll=lr(e.player);break}case"colorscroll":{Nt(e.player,"refscroll","color",["color","coloredit"]);const s=Le(e.player);s.scrollname="colors",s.scroll=lr(e.player);break}case"notesscroll":{At(e.player,"duration             cdefgab - notes "),At(e.player,"y - 64th note        x - rest"),At(e.player,"t - 32nd note        "),At(e.player,"s - 16th note.       drums"),At(e.player,"i - eight note.      0 - tick"),At(e.player,"q - quarter note     1 - tweet"),At(e.player,"h - half note        2 - cowbell"),At(e.player,"w - whole note       p - clap"),At(e.player,"                     4 - high snare"),At(e.player,"mods                 5 - high woodblock"),At(e.player,"3 - triplet          6 - low snare"),At(e.player,". - time and a half  7 - low tom"),At(e.player,"# - sharp            8 - low woodblock"),At(e.player,"! - flat             9 - bass drum");const s=Le(e.player);s.scrollname="music notation",s.scroll=lr(e.player);break}}break;case"batch":rn(Kt,e.player,async()=>{await $7(i,e.player)});break;case"remix":rn(Kt,e.player,async()=>{await D7(i,e.player)});break;case"empty":{const s=zr(i);switch(s.target){case"copycoords":ph(Kt,$r(),s.path.split(",").join(" "));break}break}case"inspect":P7(i,e.player);break;case"touched":if(ce(e.data)){const[s,o,a]=e.data;cx({...e,target:`${o}:${a}`,data:void 0,sender:s})}break;case"zztbridge":rn(Kt,e.player,async()=>{pt(e.data)&&await f7(e.player,e.data)});break;case"zipfilelist":rn(Kt,e.player,async()=>{await c7(e.player)});break;default:{const s=zr(i);if(It(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),cx(e);else{const o=ue(Dt.MAIN);Vo(s.target,s.path,void 0,Do(o))}break}}break}}},dz());function K7(){GA(Kt)}const{forward:Y7}=wT(e=>{ET(e)&&postMessage(e)});onmessage=function(t){Y7(t.data)},setTimeout(K7,100)})();

var i7=Object.defineProperty;var s7=(gi,tn,Qe)=>tn in gi?i7(gi,tn,{enumerable:!0,configurable:!0,writable:!0,value:Qe}):gi[tn]=Qe;var kt=(gi,tn,Qe)=>s7(gi,typeof tn!="symbol"?tn+"":tn,Qe);(function(){"use strict";const gi=new Set,tn={emit(e,t,r,n,i){tn.invoke(dT(e,t,r,n,i))},invoke(e){gi.forEach(t=>t.handle(e))},connect(e){gi.add(e)},disconnect(e){gi.delete(e)}};var Qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function CA(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var $0={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Qe,function(){return r.importState=function(i){var s=new r;return s.importState(i),s},r;function r(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=n();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function n(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})($0);var LA=$0.exports,D0=qs(LA),j0={};(function(e){var t=Qe&&Qe.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var d=0,f=l.length,m;d<f;d++)(m||!(d in l))&&(m||(m=Array.prototype.slice.call(l,0,d)),m[d]=l[d]);return u.concat(m||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function r(u){return u[Math.floor(Math.random()*u.length)]}function n(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,d=u.capitalize,f=d===void 0?!0:d,m=u.adjectiveCount,p=m===void 0?1:m,g=u.addAdverb,y=g===void 0?!1:g,b=t(t(t([],t([],Array(p),!0).map(function(S){return r(e.adjectives)}),!0),[r(e.nouns),r(e.verbs)],!1),y?[r(e.adverbs)]:[],!0);return f&&(b=b.map(function(S){return S.charAt(0).toUpperCase()+S.substr(1)})),b.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(f?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d,m=u.separator,p=m===void 0?"":m;return n(e.adjectives).length*h+h*p.length+n(e.nouns).length+p.length+n(e.verbs).length+(f?n(e.adverbs).length+p.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d,m=u.separator,p=m===void 0?"":m;return i(e.adjectives).length*h+h*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(f?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(j0);var z0=qs(j0);const MA="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let UA=e=>crypto.getRandomValues(new Uint8Array(e)),PA=(e,t,r)=>{let n=(2<<Math.log2(e.length-1))-1,i=-~(1.6*n*t/e.length);return(s=t)=>{let o="";for(;;){let a=r(i),c=i|0;for(;c--;)if(o+=e[a[c]&n]||"",o.length>=s)return o}}},W0=(e,t=21)=>PA(e,t|0,UA),FA=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=MA[r[e]&63];return t};var H0="abcdefghijklmnopqrstuvwxyz",G0="ABCDEFGHIJKLMNOPQRSTUVWXYZ",K0="0123456789",BA="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",$A="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const DA=K0,jA=H0,zA=G0;var WA=DA+jA+zA,Gu={lowercase:H0,uppercase:G0,numbers:K0,nolookalikes:BA,nolookalikesSafe:$A,alphanumeric:WA};function De(){return`sid_${FA(12).replaceAll("-",".")}`}W0(Gu.numbers,4),W0(`${Gu.numbers}${Gu.lowercase}`,16);function br(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function HA(){return z0({capitalize:!1,adjectiveCount:1})}function GA(){return z0({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var KA=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),YA=Object.prototype.hasOwnProperty;function Ku(e,t){return YA.call(e,t)}function Yu(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);var n=[];for(var i in e)Ku(e,i)&&n.push(i);return n}function Fr(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function qu(e){for(var t=0,r=e.length,n;t<r;){if(n=e.charCodeAt(t),n>=48&&n<=57){t++;continue}return!1}return!0}function fs(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Y0(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Vu(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)if(Vu(e[t]))return!0}else if(typeof e=="object"){for(var n=Yu(e),i=n.length,s=0;s<i;s++)if(Vu(e[n[s]]))return!0}}return!1}function q0(e,t){var r=[e];for(var n in t){var i=typeof t[n]=="object"?JSON.stringify(t[n],null,2):t[n];typeof i<"u"&&r.push(n+": "+i)}return r.join(`
`)}var V0=function(e){KA(t,e);function t(r,n,i,s,o){var a=this.constructor,c=e.call(this,q0(r,{name:n,index:i,operation:s,tree:o}))||this;return c.name=n,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=q0(r,{name:n,index:i,operation:s,tree:o}),c}return t}(Error),Ue=V0,qA=Fr,Vs={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=pc(r,this.path);n&&(n=Fr(n));var i=hs(r,{op:"remove",path:this.from}).removed;return hs(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=pc(r,this.from);return hs(r,{op:"add",path:this.path,value:Fr(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:ea(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},VA={add:function(e,t,r){return qu(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){var n=e.splice(t,1);return{newDocument:r,removed:n[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:Vs.move,copy:Vs.copy,test:Vs.test,_get:Vs._get};function pc(e,t){if(t=="")return e;var r={op:"_get",path:t};return hs(e,r),r.value}function hs(e,t,r,n,i,s){if(r===void 0&&(r=!1),n===void 0&&(n=!0),i===void 0&&(i=!0),s===void 0&&(s=0),r&&(typeof r=="function"?r(t,0,e,t.path):mc(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=pc(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=ea(e,t.value),o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(r)throw new Ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{n||(e=Fr(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,d=void 0,f=void 0,m=void 0;for(typeof r=="function"?m=r:m=mc;;){if(f=c[l],f&&f.indexOf("~")!=-1&&(f=Y0(f)),i&&(f=="__proto__"||f=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(u[f]===void 0?d=c.slice(0,l).join("/"):l==h-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),l++,Array.isArray(u)){if(f==="-")f=u.length;else{if(r&&!qu(f))throw new Ue("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);qu(f)&&(f=~~f)}if(l>=h){if(r&&t.op==="add"&&f>u.length)throw new Ue("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=VA[t.op].call(t,u,f,e);if(o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=Vs[t.op].call(t,u,f,e);if(o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[f],r&&l<h&&(!u||typeof u!="object"))throw new Ue("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Xu(e,t,r,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!0),r&&!Array.isArray(t))throw new Ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=Fr(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=hs(e,t[o],r,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function XA(e,t,r){var n=hs(e,t);if(n.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function mc(e,t,r,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new Ue("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(Vs[e.op]){if(typeof e.path!="string")throw new Ue("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Ue('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Ue("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Vu(e.value))throw new Ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r){if(e.op=="add"){var i=e.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new Ue("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new Ue("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=X0([o],r);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ue("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new Ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function X0(e,t,r){try{if(!Array.isArray(e))throw new Ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Xu(Fr(t),Fr(e),r||!0);else{r=r||mc;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(i){if(i instanceof Ue)return i;throw i}}function ea(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Array.isArray(e),n=Array.isArray(t),i,s,o;if(r&&n){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!ea(e[i],t[i]))return!1;return!0}if(r!=n)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ea(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var JA=Object.freeze({__proto__:null,JsonPatchError:Ue,_areEquals:ea,applyOperation:hs,applyPatch:Xu,applyReducer:XA,deepClone:qA,getValueByPointer:pc,validate:X0,validator:mc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Ju=new WeakMap,ZA=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),QA=function(){function e(t,r){this.callback=t,this.observer=r}return e}();function tT(e){return Ju.get(e)}function eT(e,t){return e.observers.get(t)}function rT(e,t){e.observers.delete(t.callback)}function nT(e,t){t.unobserve()}function iT(e,t){var r=[],n,i=tT(e);if(!i)i=new ZA(e),Ju.set(e,i);else{var s=eT(i,t);n=s&&s.observer}if(n)return n;if(n={},i.value=Fr(e),t){n.callback=t,n.next=null;var o=function(){Zu(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=r,n.object=e,n.unobserve=function(){Zu(n),clearTimeout(n.next),rT(i,n),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new QA(t,n)),n}function Zu(e,t){t===void 0&&(t=!1);var r=Ju.get(e.object);Qu(r.value,e.object,e.patches,"",t),e.patches.length&&Xu(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function Qu(e,t,r,n,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Yu(t),o=Yu(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(Ku(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Qu(l,h,r,n+"/"+fs(u),i):l!==h&&(i&&r.push({op:"test",path:n+"/"+fs(u),value:Fr(l)}),r.push({op:"replace",path:n+"/"+fs(u),value:Fr(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&r.push({op:"test",path:n+"/"+fs(u),value:Fr(l)}),r.push({op:"remove",path:n+"/"+fs(u)}),a=!0):(i&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!Ku(e,u)&&t[u]!==void 0&&r.push({op:"add",path:n+"/"+fs(u),value:Fr(t[u])})}}}function J0(e,t,r){r===void 0&&(r=!1);var n=[];return Qu(e,t,n,"",r),n}var sT=Object.freeze({__proto__:null,compare:J0,generate:Zu,observe:iT,unobserve:nT});Object.assign({},JA,sT,{JsonPatchError:V0,deepClone:Fr,escapePathComponent:fs,unescapePathComponent:Y0});var oT=typeof Element<"u",aT=typeof Map=="function",cT=typeof Set=="function",lT=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function gc(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,i;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!gc(e[n],t[n]))return!1;return!0}var s;if(aT&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(n=s.next()).done;)if(!t.has(n.value[0]))return!1;for(s=e.entries();!(n=s.next()).done;)if(!gc(n.value[1],t.get(n.value[0])))return!1;return!0}if(cT&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(n=s.next()).done;)if(!t.has(n.value[0]))return!1;return!0}if(lT&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;if(oT&&e instanceof Element)return!1;for(n=r;n--!==0;)if(!((i[n]==="_owner"||i[n]==="__v"||i[n]==="__o")&&e.$$typeof)&&!gc(e[i[n]],t[i[n]]))return!1;return!0}return e!==e&&t!==t}var uT=function(t,r){try{return gc(t,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}},fT=qs(uT);function w(e){return e!=null}const Br=Object.keys;function Nn(e){return Fr(e)}function hT(e){return typeof e=="boolean"}function xt(e){return typeof e=="number"&&isNaN(e)===!1}function _t(e){return typeof e=="string"}function he(e){return Array.isArray(e)}function tf(e){return e}var Kt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Kt||{}),Wt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e[e.ISGHOST=4]="ISGHOST",e))(Wt||{}),$r=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))($r||{}),bt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.FIND=18]="FIND",e[e.FLEE=19]="FLEE",e[e.TO=20]="TO",e[e.MID=21]="MID",e[e.OVER=22]="OVER",e[e.UNDER=23]="UNDER",e[e.WITHIN=24]="WITHIN",e[e.AWAYBY=25]="AWAYBY",e))(bt||{}),Ft=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.VIEWIT=14]="VIEWIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(Ft||{});function zt(e){return _t(e)?e.toLowerCase().trim():""}function dT(e,t,r,n,i){return{session:e,player:t,id:De(),sender:r,target:n,data:i}}function Dr(e){const[t,...r]=e.split(":");return{target:t,path:r.join(":")}}function Xs(e,t=[],r=tf,n=""){const i=De(),s=zt(e),o=t.map(zt);let a=n;const c={id(){return i},name(){return e},session(u){return w(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){tn.emit(a,u,i,l,h)},reply(u,l,h){c.emit(u.player,`${u.sender}:${l}`,h)},replynext(u,l,h){setTimeout(()=>c.emit(u.player,`${u.sender}:${l}`,h),64)},handle(u){const{target:l,path:h}=Dr(u.target),d=zt(l);!a&&d==="ready"&&(a=u.session),d==="session_reset"&&(a=""),o.findIndex(f=>f==="all"||f===d)!==-1&&r(u),(i===l||d==="all"||s===d)&&r({...u,target:h})}};return tn.connect(c),c}function pT(e){return typeof e=="object"&&_t(e.session)&&_t(e.player)&&_t(e.id)&&_t(e.sender)&&_t(e.target)}function ye(e,t,r,...n){return e.emit(t,"error",[`$red${r}$blue>>`,...n]),!1}function mT(e,t,...r){return e.emit(t,"info",r),!0}function Pe(e,t,...r){return e.emit(t,"log",r),!0}function yc(e,t,r){e.emit(t,"toast",r)}function gT(e,t,r){e.emit(t,"bridge:streamstart",r)}function yT(e,t){e.emit(t,"bridge:streamstop",void 0)}function _T(e,t,r){e.emit(t,"bridge:chatstart",r)}function bT(e,t){e.emit(t,"bridge:chatstop")}function wT(e,t,r,n,i,s,o){e.emit(t,"bridge:fetch",[r,n,i,s,o])}function ET(e,t){e.emit(t,"bridge:talkstart",t)}function vT(e,t){e.emit(t,"bridge:talkstop",t)}function kT(e,t){e.emit(t,"bridge:mediastart",t)}function xT(e,t){e.emit(t,"bridge:mediastop",t)}function AT(e,t,r){e.emit(t,"bridge:start",r)}function TT(e,t,r){e.emit(t,"bridge:tab",r)}function ST(e,t,r){e.emit(t,"gadgetclient:paint",r)}function RT(e,t,r){e.emit(t,"gadgetclient:patch",r)}function OT(e,t){e.emit(t,"gadgetserver:clearscroll")}function IT(e,t){e.emit(t,"gadgetserver:clearplayer")}function NT(e){e.emit("","ready")}function Z0(e,t){e.emit(t,"register:loginfail")}function ef(e,t){e.emit(t,"register:loginready",!0)}function CT(e,t,r,n){e.emit(t,"register:savemem",[r,n])}function LT(e,t,r){e.emit(t,"register:forkmem",[r])}function MT(e,t,r,n){e.emit(t,"register:itchiopublishmem",[r,n])}function rf(e,t,r){e.emit(t,"register:copy",r)}function UT(e,t,r,n){e.emit(t,"register:copyjsonfile",[r,n])}function Q0(e,t,r,n){e.emit(t,"register:downloadjsonfile",[r,n])}function PT(e,t){e.emit(t,"register:dev",void 0)}function FT(e,t){e.emit(t,"register:share",void 0)}function BT(e,t){e.emit(t,"register:nuke",void 0)}function $T(e,t){e.emit(t,"register:enterar",void 0)}function DT(e,t,r,n){e.emit(t,"synth:tts",[r,n])}function jT(e,t,r,n){e.emit(t,"synth:play",[r,n])}function zT(e,t,r,n,i){e.emit(t,"synth:bgplay",[r,n,i])}function WT(e,t,r){e.emit(t,"synth:bpm",r)}function HT(e,t,r){e.emit(t,"synth:playvolume",r)}function GT(e,t,r){e.emit(t,"synth:bgplayvolume",r)}function KT(e,t,r){e.emit(t,"synth:ttsvolume",r)}function nf(e,t,r,n,i){e.emit(t,"synth:voice",[r,n,i])}function tm(e,t,r,n,i,s){e.emit(t,"synth:voicefx",[r,n,i,s])}function em(e,t,r,n){e.emit(t,"register:config",[r,n])}function YT(e,t){e.emit(t,"register:configshow")}function qT(e,t){e.emit(t,"register:inspector")}function VT(e,t){e.emit(t,"register:terminal:full")}function rm(e,t,r,n,i,s){e.emit(t,"register:editor:open",[r,n,i,s])}function XT(e,t,r,n){e.emit(t,"vm:zztsearch",[r,n])}function JT(e,t){e.emit(t,"vm:zztrandom")}function ZT(e,t){e.emit(t,"vm:local")}function sf(e,t){e.emit(t,"vm:logout")}function nm(e,t,r,n,i){e.emit(t,"vm:touched",[r,n,i])}function QT(e,t){e.emit(t,"vm:readzipfilelist")}function _c(e,t){const[r,n]=t;return`${e}:${[r,n].filter(w).join(":")}`}function tS(e,t,r){e.emit(t,"vm:cli",r)}function eS(e,t){e.emit(t,"vm:restart")}function im(e,t){e.emit(t,"vm:flush")}function rS(e,t){e.emit(t,"vm:fork")}function nS(e,t){e.emit(t,"vm:itchiopublish")}function iS(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function sS(e,t){return{filename:e,json:t}}function oS(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function of(e,t,r,n,i,s){let o;switch(n){case"file":o=s;break;case"text":o=iS(i,s);break;case"json":o=sS(i,s);break;case"binary":o=oS(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[r,n,i,o])},1)}function aS(e){const t=new Set;function r(s){pT(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),tn.invoke(s))}const n=Xs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){tn.disconnect(n)}return{forward:r,disconnect:i}}function cS(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=Dr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const af=80,bc=Math.floor(1e3/af),sm=3;function wc(e){return new Promise(t=>setTimeout(t,e))}const cf=Xs("clock");let lf=0,Ec=0,uf=0,om=performance.now();function am(){const e=performance.now(),t=e-om;uf+=t,uf>=af&&(uf%=af,cf.emit("","tick",Ec),cf.emit("","tock",Ec),++lf,++Ec,lf>=bc&&(lf%=bc,cf.emit("","second",Ec))),om=e,setTimeout(am,2)}am();function lS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var cm={exports:{}},je=cm.exports={},Yn,qn;function ff(){throw new Error("setTimeout has not been defined")}function hf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Yn=setTimeout:Yn=ff}catch{Yn=ff}try{typeof clearTimeout=="function"?qn=clearTimeout:qn=hf}catch{qn=hf}})();function lm(e){if(Yn===setTimeout)return setTimeout(e,0);if((Yn===ff||!Yn)&&setTimeout)return Yn=setTimeout,setTimeout(e,0);try{return Yn(e,0)}catch{try{return Yn.call(null,e,0)}catch{return Yn.call(this,e,0)}}}function uS(e){if(qn===clearTimeout)return clearTimeout(e);if((qn===hf||!qn)&&clearTimeout)return qn=clearTimeout,clearTimeout(e);try{return qn(e)}catch{try{return qn.call(null,e)}catch{return qn.call(this,e)}}}var yi=[],Js=!1,ds,vc=-1;function fS(){!Js||!ds||(Js=!1,ds.length?yi=ds.concat(yi):vc=-1,yi.length&&um())}function um(){if(!Js){var e=lm(fS);Js=!0;for(var t=yi.length;t;){for(ds=yi,yi=[];++vc<t;)ds&&ds[vc].run();vc=-1,t=yi.length}ds=null,Js=!1,uS(e)}}je.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];yi.push(new fm(e,t)),yi.length===1&&!Js&&lm(um)};function fm(e,t){this.fun=e,this.array=t}fm.prototype.run=function(){this.fun.apply(null,this.array)},je.title="browser",je.browser=!0,je.env={},je.argv=[],je.version="",je.versions={};function _i(){}je.on=_i,je.addListener=_i,je.once=_i,je.off=_i,je.removeListener=_i,je.removeAllListeners=_i,je.emit=_i,je.prependListener=_i,je.prependOnceListener=_i,je.listeners=function(e){return[]},je.binding=function(e){throw new Error("process.binding is not supported")},je.cwd=function(){return"/"},je.chdir=function(e){throw new Error("process.chdir is not supported")},je.umask=function(){return 0};var hS=cm.exports;const Cn=lS(hS);var re={},df=Symbol.for("react.transitional.element"),dS=Symbol.for("react.portal"),pS=Symbol.for("react.fragment"),mS=Symbol.for("react.strict_mode"),gS=Symbol.for("react.profiler"),yS=Symbol.for("react.consumer"),_S=Symbol.for("react.context"),bS=Symbol.for("react.forward_ref"),wS=Symbol.for("react.suspense"),ES=Symbol.for("react.memo"),hm=Symbol.for("react.lazy"),dm=Symbol.iterator;function vS(e){return e===null||typeof e!="object"?null:(e=dm&&e[dm]||e["@@iterator"],typeof e=="function"?e:null)}var pm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mm=Object.assign,gm={};function Zs(e,t,r){this.props=e,this.context=t,this.refs=gm,this.updater=r||pm}Zs.prototype.isReactComponent={},Zs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Zs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function ym(){}ym.prototype=Zs.prototype;function pf(e,t,r){this.props=e,this.context=t,this.refs=gm,this.updater=r||pm}var mf=pf.prototype=new ym;mf.constructor=pf,mm(mf,Zs.prototype),mf.isPureReactComponent=!0;var _m=Array.isArray,Se={H:null,A:null,T:null,S:null,V:null},bm=Object.prototype.hasOwnProperty;function gf(e,t,r,n,i,s){return r=s.ref,{$$typeof:df,type:e,key:t,ref:r!==void 0?r:null,props:s}}function kS(e,t){return gf(e.type,t,void 0,void 0,void 0,e.props)}function yf(e){return typeof e=="object"&&e!==null&&e.$$typeof===df}function xS(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var wm=/\/+/g;function _f(e,t){return typeof e=="object"&&e!==null&&e.key!=null?xS(""+e.key):t.toString(36)}function Em(){}function AS(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(Em,Em):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function Qs(e,t,r,n,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case df:case dS:o=!0;break;case hm:return o=e._init,Qs(o(e._payload),t,r,n,i)}}if(o)return i=i(e),o=n===""?"."+_f(e,0):n,_m(i)?(r="",o!=null&&(r=o.replace(wm,"$&/")+"/"),Qs(i,t,r,"",function(u){return u})):i!=null&&(yf(i)&&(i=kS(i,r+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(wm,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=n===""?".":n+":";if(_m(e))for(var c=0;c<e.length;c++)n=e[c],s=a+_f(n,c),o+=Qs(n,t,r,s,i);else if(c=vS(e),typeof c=="function")for(e=c.call(e),c=0;!(n=e.next()).done;)n=n.value,s=a+_f(n,c++),o+=Qs(n,t,r,s,i);else if(s==="object"){if(typeof e.then=="function")return Qs(AS(e),t,r,n,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function kc(e,t,r){if(e==null)return e;var n=[],i=0;return Qs(e,n,"","",function(s){return t.call(r,s,i++)}),n}function TS(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var vm=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Cn=="object"&&typeof Cn.emit=="function"){Cn.emit("uncaughtException",e);return}console.error(e)};function SS(){}re.Children={map:kc,forEach:function(e,t,r){kc(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return kc(e,function(){t++}),t},toArray:function(e){return kc(e,function(t){return t})||[]},only:function(e){if(!yf(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},re.Component=Zs,re.Fragment=pS,re.Profiler=gS,re.PureComponent=pf,re.StrictMode=mS,re.Suspense=wS,re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Se,re.__COMPILER_RUNTIME={__proto__:null,c:function(e){return Se.H.useMemoCache(e)}},re.cache=function(e){return function(){return e.apply(null,arguments)}},re.cloneElement=function(e,t,r){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var n=mm({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!bm.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(n[o]=t[o]);var o=arguments.length-2;if(o===1)n.children=r;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];n.children=a}return gf(e.type,i,void 0,void 0,s,n)},re.createContext=function(e){return e={$$typeof:_S,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:yS,_context:e},e},re.createElement=function(e,t,r){var n,i={},s=null;if(t!=null)for(n in t.key!==void 0&&(s=""+t.key),t)bm.call(t,n)&&n!=="key"&&n!=="__self"&&n!=="__source"&&(i[n]=t[n]);var o=arguments.length-2;if(o===1)i.children=r;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)i[n]===void 0&&(i[n]=o[n]);return gf(e,s,void 0,void 0,null,i)},re.createRef=function(){return{current:null}},re.forwardRef=function(e){return{$$typeof:bS,render:e}},re.isValidElement=yf,re.lazy=function(e){return{$$typeof:hm,_payload:{_status:-1,_result:e},_init:TS}},re.memo=function(e,t){return{$$typeof:ES,type:e,compare:t===void 0?null:t}},re.startTransition=function(e){var t=Se.T,r={};Se.T=r;try{var n=e(),i=Se.S;i!==null&&i(r,n),typeof n=="object"&&n!==null&&typeof n.then=="function"&&n.then(SS,vm)}catch(s){vm(s)}finally{Se.T=t}},re.unstable_useCacheRefresh=function(){return Se.H.useCacheRefresh()},re.use=function(e){return Se.H.use(e)},re.useActionState=function(e,t,r){return Se.H.useActionState(e,t,r)},re.useCallback=function(e,t){return Se.H.useCallback(e,t)},re.useContext=function(e){return Se.H.useContext(e)},re.useDebugValue=function(){},re.useDeferredValue=function(e,t){return Se.H.useDeferredValue(e,t)},re.useEffect=function(e,t,r){var n=Se.H;if(typeof r=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(e,t)},re.useId=function(){return Se.H.useId()},re.useImperativeHandle=function(e,t,r){return Se.H.useImperativeHandle(e,t,r)},re.useInsertionEffect=function(e,t){return Se.H.useInsertionEffect(e,t)},re.useLayoutEffect=function(e,t){return Se.H.useLayoutEffect(e,t)},re.useMemo=function(e,t){return Se.H.useMemo(e,t)},re.useOptimistic=function(e,t){return Se.H.useOptimistic(e,t)},re.useReducer=function(e,t,r){return Se.H.useReducer(e,t,r)},re.useRef=function(e){return Se.H.useRef(e)},re.useState=function(e){return Se.H.useState(e)},re.useSyncExternalStore=function(e,t,r){return Se.H.useSyncExternalStore(e,t,r)},re.useTransition=function(){return Se.H.useTransition()},re.version="19.1.1";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const km="0123456789abcdef",xm=[],xc=[];for(let e=0;e<256;e++)xm[e]=km[e>>4&15]+km[e&15],e<16&&(e<10?xc[48+e]=e:xc[87+e]=e);const Am=e=>{const t=e.length;let r="",n=0;for(;n<t;)r+=xm[e[n++]];return r},Ac=e=>{const t=e.length>>1,r=t<<1,n=new Uint8Array(t);let i=0,s=0;for(;s<r;)n[i++]=xc[e.charCodeAt(s++)]<<4|xc[e.charCodeAt(s++)];return n};for(var Tm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",RS=typeof Uint8Array>"u"?[]:new Uint8Array(256),Tc=0;Tc<Tm.length;Tc++)RS[Tm.charCodeAt(Tc)]=Tc;new TextDecoder,new TextEncoder;const Sm=typeof window<"u"?window:self,Rm=Sm.crypto||Sm.msCrypto||{};Rm.subtle||Rm.webkitSubtle;const to=globalThis||void 0||self,Ln=()=>new Map,bf=e=>{const t=Ln();return e.forEach((r,n)=>{t.set(n,r)}),t},Di=(e,t,r)=>{let n=e.get(t);return n===void 0&&e.set(t,n=r()),n},OS=(e,t)=>{const r=[];for(const[n,i]of e)r.push(t(i,n));return r},IS=(e,t)=>{for(const[r,n]of e)if(t(n,r))return!0;return!1},eo=()=>new Set,wf=e=>e[e.length-1],NS=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},ps=Array.from,CS=Array.isArray;class LS{constructor(){this._observers=Ln()}on(t,r){return Di(this._observers,t,eo).add(r),r}once(t,r){const n=(...i)=>{this.off(t,n),r(...i)};this.on(t,n)}off(t,r){const n=this._observers.get(t);n!==void 0&&(n.delete(r),n.size===0&&this._observers.delete(t))}emit(t,r){return ps((this._observers.get(t)||Ln()).values()).forEach(n=>n(...r))}destroy(){this._observers=Ln()}}const ji=Math.floor,Sc=Math.abs,Om=(e,t)=>e<t?e:t,ms=(e,t)=>e>t?e:t,Im=e=>e!==0?e<0:1/e<0,Nm=1,Cm=2,Ef=4,vf=8,ra=32,bi=64,en=128,Rc=31,kf=63,gs=127,MS=2147483647,Lm=Number.MAX_SAFE_INTEGER,US=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&ji(e)===e),PS=e=>e.toLowerCase(),FS=/^\s*/g,BS=e=>e.replace(FS,""),$S=/([A-Z])/g,Mm=(e,t)=>BS(e.replace($S,r=>`${t}${PS(r)}`)),DS=e=>{const t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.codePointAt(i);return n},na=typeof TextEncoder<"u"?new TextEncoder:null,jS=na?e=>na.encode(e):DS;let ia=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ia&&ia.decode(new Uint8Array).length===1&&(ia=null);class sa{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Oc=()=>new sa,zS=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},Vn=e=>{const t=new Uint8Array(zS(e));let r=0;for(let n=0;n<e.bufs.length;n++){const i=e.bufs[n];t.set(i,r),r+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),r),t},WS=(e,t)=>{const r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(ms(r,t)*2),e.cpos=0)},cr=(e,t)=>{const r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(r*2),e.cpos=0),e.cbuf[e.cpos++]=t},xf=cr,de=(e,t)=>{for(;t>gs;)cr(e,en|gs&t),t=ji(t/128);cr(e,gs&t)},Af=(e,t)=>{const r=Im(t);for(r&&(t=-t),cr(e,(t>kf?en:0)|(r?bi:0)|kf&t),t=ji(t/64);t>0;)cr(e,(t>gs?en:0)|gs&t),t=ji(t/128)},Tf=new Uint8Array(3e4),HS=Tf.length/3,GS=(e,t)=>{if(t.length<HS){const r=na.encodeInto(t,Tf).written||0;de(e,r);for(let n=0;n<r;n++)cr(e,Tf[n])}else rn(e,jS(t))},KS=(e,t)=>{const r=unescape(encodeURIComponent(t)),n=r.length;de(e,n);for(let i=0;i<n;i++)cr(e,r.codePointAt(i))},ro=na&&na.encodeInto?GS:KS,Ic=(e,t)=>{const r=e.cbuf.length,n=e.cpos,i=Om(r-n,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),n),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ms(r*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},rn=(e,t)=>{de(e,t.byteLength),Ic(e,t)},Sf=(e,t)=>{WS(e,t);const r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},YS=(e,t)=>Sf(e,4).setFloat32(0,t,!1),qS=(e,t)=>Sf(e,8).setFloat64(0,t,!1),VS=(e,t)=>Sf(e,8).setBigInt64(0,t,!1),Um=new DataView(new ArrayBuffer(4)),XS=e=>(Um.setFloat32(0,e),Um.getFloat32(0)===e),oa=(e,t)=>{switch(typeof t){case"string":cr(e,119),ro(e,t);break;case"number":US(t)&&Sc(t)<=MS?(cr(e,125),Af(e,t)):XS(t)?(cr(e,124),YS(e,t)):(cr(e,123),qS(e,t));break;case"bigint":cr(e,122),VS(e,t);break;case"object":if(t===null)cr(e,126);else if(CS(t)){cr(e,117),de(e,t.length);for(let r=0;r<t.length;r++)oa(e,t[r])}else if(t instanceof Uint8Array)cr(e,116),rn(e,t);else{cr(e,118);const r=Object.keys(t);de(e,r.length);for(let n=0;n<r.length;n++){const i=r[n];ro(e,i),oa(e,t[i])}}break;case"boolean":cr(e,t?120:121);break;default:cr(e,127)}};class Pm extends sa{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&de(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Fm=e=>{e.count>0&&(Af(e.encoder,e.count===1?e.s:-e.s),e.count>1&&de(e.encoder,e.count-2))};class Nc{constructor(){this.encoder=new sa,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Fm(this),this.count=1,this.s=t)}toUint8Array(){return Fm(this),Vn(this.encoder)}}const Bm=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Af(e.encoder,t),e.count>1&&de(e.encoder,e.count-2)}};class Rf{constructor(){this.encoder=new sa,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Bm(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Bm(this),Vn(this.encoder)}}class JS{constructor(){this.sarr=[],this.s="",this.lensE=new Nc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new sa;return this.sarr.push(this.s),this.s="",ro(t,this.sarr.join("")),Ic(t,this.lensE.toUint8Array()),Vn(t)}}const zi=e=>new Error(e),Xn=()=>{throw zi("Method unimplemented")},Jn=()=>{throw zi("Unexpected case")},$m=zi("Unexpected end of array"),Dm=zi("Integer out of Range");class Cc{constructor(t){this.arr=t,this.pos=0}}const no=e=>new Cc(e),ZS=e=>e.pos!==e.arr.length,QS=(e,t)=>{const r=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r},nn=e=>QS(e,ie(e)),io=e=>e.arr[e.pos++],ie=e=>{let t=0,r=1;const n=e.arr.length;for(;e.pos<n;){const i=e.arr[e.pos++];if(t=t+(i&gs)*r,r*=128,i<en)return t;if(t>Lm)throw Dm}throw $m},Of=e=>{let t=e.arr[e.pos++],r=t&kf,n=64;const i=(t&bi)>0?-1:1;if(!(t&en))return i*r;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],r=r+(t&gs)*n,n*=128,t<en)return i*r;if(r>Lm)throw Dm}throw $m},so=ia?e=>ia.decode(nn(e)):e=>{let t=ie(e);if(t===0)return"";{let r=String.fromCodePoint(io(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(io(e));else for(;t>0;){const n=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,i),t-=n}return decodeURIComponent(escape(r))}},If=(e,t)=>{const r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},tR=[e=>{},e=>null,Of,e=>If(e,4).getFloat32(0,!1),e=>If(e,8).getFloat64(0,!1),e=>If(e,8).getBigInt64(0,!1),e=>!1,e=>!0,so,e=>{const t=ie(e),r={};for(let n=0;n<t;n++){const i=so(e);r[i]=aa(e)}return r},e=>{const t=ie(e),r=[];for(let n=0;n<t;n++)r.push(aa(e));return r},nn],aa=e=>tR[127-io(e)](e);class jm extends Cc{constructor(t,r){super(t),this.reader=r,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),ZS(this)?this.count=ie(this)+1:this.count=-1),this.count--,this.s}}class Lc extends Cc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Of(this);const t=Im(this.s);this.count=1,t&&(this.s=-this.s,this.count=ie(this)+2)}return this.count--,this.s}}class Nf extends Cc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Of(this),r=t&1;this.diff=ji(t/2),this.count=1,r&&(this.count=ie(this)+2)}return this.s+=this.diff,this.count--,this.s}}class eR{constructor(t){this.decoder=new Lc(t),this.str=so(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),r=this.str.slice(this.spos,t);return this.spos=t,r}}const rR=crypto.getRandomValues.bind(crypto),zm=()=>rR(new Uint32Array(1))[0],nR="10000000-1000-4000-8000"+-1e11,iR=()=>nR.replace(/[018]/g,e=>(e^zm()&15>>e/4).toString(16)),Wm=e=>new Promise(e);Promise.all.bind(Promise);var Hm={},Mc={};Mc.byteLength=aR,Mc.toByteArray=lR,Mc.fromByteArray=hR;for(var Zn=[],pn=[],sR=typeof Uint8Array<"u"?Uint8Array:Array,Cf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",oo=0,oR=Cf.length;oo<oR;++oo)Zn[oo]=Cf[oo],pn[Cf.charCodeAt(oo)]=oo;pn[45]=62,pn[95]=63;function Gm(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function aR(e){var t=Gm(e),r=t[0],n=t[1];return(r+n)*3/4-n}function cR(e,t,r){return(t+r)*3/4-r}function lR(e){var t,r=Gm(e),n=r[0],i=r[1],s=new sR(cR(e,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)t=pn[e.charCodeAt(c)]<<18|pn[e.charCodeAt(c+1)]<<12|pn[e.charCodeAt(c+2)]<<6|pn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=pn[e.charCodeAt(c)]<<2|pn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=pn[e.charCodeAt(c)]<<10|pn[e.charCodeAt(c+1)]<<4|pn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function uR(e){return Zn[e>>18&63]+Zn[e>>12&63]+Zn[e>>6&63]+Zn[e&63]}function fR(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(uR(n));return i.join("")}function hR(e){for(var t,r=e.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(fR(e,o,o+s>a?a:o+s));return n===1?(t=e[r-1],i.push(Zn[t>>2]+Zn[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(Zn[t>>10]+Zn[t>>4&63]+Zn[t<<2&63]+"=")),i.join("")}var Lf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Lf.read=function(e,t,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,u=c>>1,l=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-l)-1,f>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=d,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=n;l>0;o=o*256+e[t+h],h+=d,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-u}return(f?-1:1)*o*Math.pow(2,s-n)},Lf.write=function(e,t,r,n,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,m=n?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=d/c:t+=d*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=a&255,f+=m,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[r+f]=o&255,f+=m,o/=256,u-=8);e[r+f-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Mc,r=Lf,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=x,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const C=new s(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,s.prototype),Object.setPrototypeOf(C,_),C.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(C){if(C>i)throw new RangeError('The value "'+C+'" is invalid for option "size"');const _=new s(C);return Object.setPrototypeOf(_,l.prototype),_}function l(C,_,E){if(typeof C=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(C)}return h(C,_,E)}l.poolSize=8192;function h(C,_,E){if(typeof C=="string")return p(C,_);if(o.isView(C))return y(C);if(C==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof C);if(yt(C,o)||C&&yt(C.buffer,o)||typeof a<"u"&&(yt(C,a)||C&&yt(C.buffer,a)))return b(C,_,E);if(typeof C=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const F=C.valueOf&&C.valueOf();if(F!=null&&F!==C)return l.from(F,_,E);const q=S(C);if(q)return q;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof C[Symbol.toPrimitive]=="function")return l.from(C[Symbol.toPrimitive]("string"),_,E);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof C)}l.from=function(C,_,E){return h(C,_,E)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function d(C){if(typeof C!="number")throw new TypeError('"size" argument must be of type number');if(C<0)throw new RangeError('The value "'+C+'" is invalid for option "size"')}function f(C,_,E){return d(C),C<=0?u(C):_!==void 0?typeof E=="string"?u(C).fill(_,E):u(C).fill(_):u(C)}l.alloc=function(C,_,E){return f(C,_,E)};function m(C){return d(C),u(C<0?0:T(C)|0)}l.allocUnsafe=function(C){return m(C)},l.allocUnsafeSlow=function(C){return m(C)};function p(C,_){if((typeof _!="string"||_==="")&&(_="utf8"),!l.isEncoding(_))throw new TypeError("Unknown encoding: "+_);const E=N(C,_)|0;let F=u(E);const q=F.write(C,_);return q!==E&&(F=F.slice(0,q)),F}function g(C){const _=C.length<0?0:T(C.length)|0,E=u(_);for(let F=0;F<_;F+=1)E[F]=C[F]&255;return E}function y(C){if(yt(C,s)){const _=new s(C);return b(_.buffer,_.byteOffset,_.byteLength)}return g(C)}function b(C,_,E){if(_<0||C.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(C.byteLength<_+(E||0))throw new RangeError('"length" is outside of buffer bounds');let F;return _===void 0&&E===void 0?F=new s(C):E===void 0?F=new s(C,_):F=new s(C,_,E),Object.setPrototypeOf(F,l.prototype),F}function S(C){if(l.isBuffer(C)){const _=T(C.length)|0,E=u(_);return E.length===0||C.copy(E,0,0,_),E}if(C.length!==void 0)return typeof C.length!="number"||Bt(C.length)?u(0):g(C);if(C.type==="Buffer"&&Array.isArray(C.data))return g(C.data)}function T(C){if(C>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return C|0}function x(C){return+C!=C&&(C=0),l.alloc(+C)}l.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==l.prototype},l.compare=function(_,E){if(yt(_,s)&&(_=l.from(_,_.offset,_.byteLength)),yt(E,s)&&(E=l.from(E,E.offset,E.byteLength)),!l.isBuffer(_)||!l.isBuffer(E))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===E)return 0;let F=_.length,q=E.length;for(let ct=0,D=Math.min(F,q);ct<D;++ct)if(_[ct]!==E[ct]){F=_[ct],q=E[ct];break}return F<q?-1:q<F?1:0},l.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(_,E){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return l.alloc(0);let F;if(E===void 0)for(E=0,F=0;F<_.length;++F)E+=_[F].length;const q=l.allocUnsafe(E);let ct=0;for(F=0;F<_.length;++F){let D=_[F];if(yt(D,s))ct+D.length>q.length?(l.isBuffer(D)||(D=l.from(D)),D.copy(q,ct)):s.prototype.set.call(q,D,ct);else if(l.isBuffer(D))D.copy(q,ct);else throw new TypeError('"list" argument must be an Array of Buffers');ct+=D.length}return q};function N(C,_){if(l.isBuffer(C))return C.length;if(o.isView(C)||yt(C,o))return C.byteLength;if(typeof C!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof C);const E=C.length,F=arguments.length>2&&arguments[2]===!0;if(!F&&E===0)return 0;let q=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return E;case"utf8":case"utf-8":return dt(C).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E*2;case"hex":return E>>>1;case"base64":return gt(C).length;default:if(q)return F?-1:dt(C).length;_=(""+_).toLowerCase(),q=!0}}l.byteLength=N;function R(C,_,E){let F=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((E===void 0||E>this.length)&&(E=this.length),E<=0)||(E>>>=0,_>>>=0,E<=_))return"";for(C||(C="utf8");;)switch(C){case"hex":return P(this,_,E);case"utf8":case"utf-8":return U(this,_,E);case"ascii":return K(this,_,E);case"latin1":case"binary":return W(this,_,E);case"base64":return z(this,_,E);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ot(this,_,E);default:if(F)throw new TypeError("Unknown encoding: "+C);C=(C+"").toLowerCase(),F=!0}}l.prototype._isBuffer=!0;function B(C,_,E){const F=C[_];C[_]=C[E],C[E]=F}l.prototype.swap16=function(){const _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let E=0;E<_;E+=2)B(this,E,E+1);return this},l.prototype.swap32=function(){const _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let E=0;E<_;E+=4)B(this,E,E+3),B(this,E+1,E+2);return this},l.prototype.swap64=function(){const _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let E=0;E<_;E+=8)B(this,E,E+7),B(this,E+1,E+6),B(this,E+2,E+5),B(this,E+3,E+4);return this},l.prototype.toString=function(){const _=this.length;return _===0?"":arguments.length===0?U(this,0,_):R.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(_){if(!l.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:l.compare(this,_)===0},l.prototype.inspect=function(){let _="";const E=e.INSPECT_MAX_BYTES;return _=this.toString("hex",0,E).replace(/(.{2})/g,"$1 ").trim(),this.length>E&&(_+=" ... "),"<Buffer "+_+">"},n&&(l.prototype[n]=l.prototype.inspect),l.prototype.compare=function(_,E,F,q,ct){if(yt(_,s)&&(_=l.from(_,_.offset,_.byteLength)),!l.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(E===void 0&&(E=0),F===void 0&&(F=_?_.length:0),q===void 0&&(q=0),ct===void 0&&(ct=this.length),E<0||F>_.length||q<0||ct>this.length)throw new RangeError("out of range index");if(q>=ct&&E>=F)return 0;if(q>=ct)return-1;if(E>=F)return 1;if(E>>>=0,F>>>=0,q>>>=0,ct>>>=0,this===_)return 0;let D=ct-q,tt=F-E;const jt=Math.min(D,tt),Ht=this.slice(q,ct),qt=_.slice(E,F);for(let Lt=0;Lt<jt;++Lt)if(Ht[Lt]!==qt[Lt]){D=Ht[Lt],tt=qt[Lt];break}return D<tt?-1:tt<D?1:0};function M(C,_,E,F,q){if(C.length===0)return-1;if(typeof E=="string"?(F=E,E=0):E>2147483647?E=2147483647:E<-2147483648&&(E=-2147483648),E=+E,Bt(E)&&(E=q?0:C.length-1),E<0&&(E=C.length+E),E>=C.length){if(q)return-1;E=C.length-1}else if(E<0)if(q)E=0;else return-1;if(typeof _=="string"&&(_=l.from(_,F)),l.isBuffer(_))return _.length===0?-1:H(C,_,E,F,q);if(typeof _=="number")return _=_&255,typeof s.prototype.indexOf=="function"?q?s.prototype.indexOf.call(C,_,E):s.prototype.lastIndexOf.call(C,_,E):H(C,[_],E,F,q);throw new TypeError("val must be string, number or Buffer")}function H(C,_,E,F,q){let ct=1,D=C.length,tt=_.length;if(F!==void 0&&(F=String(F).toLowerCase(),F==="ucs2"||F==="ucs-2"||F==="utf16le"||F==="utf-16le")){if(C.length<2||_.length<2)return-1;ct=2,D/=2,tt/=2,E/=2}function jt(qt,Lt){return ct===1?qt[Lt]:qt.readUInt16BE(Lt*ct)}let Ht;if(q){let qt=-1;for(Ht=E;Ht<D;Ht++)if(jt(C,Ht)===jt(_,qt===-1?0:Ht-qt)){if(qt===-1&&(qt=Ht),Ht-qt+1===tt)return qt*ct}else qt!==-1&&(Ht-=Ht-qt),qt=-1}else for(E+tt>D&&(E=D-tt),Ht=E;Ht>=0;Ht--){let qt=!0;for(let Lt=0;Lt<tt;Lt++)if(jt(C,Ht+Lt)!==jt(_,Lt)){qt=!1;break}if(qt)return Ht}return-1}l.prototype.includes=function(_,E,F){return this.indexOf(_,E,F)!==-1},l.prototype.indexOf=function(_,E,F){return M(this,_,E,F,!0)},l.prototype.lastIndexOf=function(_,E,F){return M(this,_,E,F,!1)};function V(C,_,E,F){E=Number(E)||0;const q=C.length-E;F?(F=Number(F),F>q&&(F=q)):F=q;const ct=_.length;F>ct/2&&(F=ct/2);let D;for(D=0;D<F;++D){const tt=parseInt(_.substr(D*2,2),16);if(Bt(tt))return D;C[E+D]=tt}return D}function O(C,_,E,F){return St(dt(_,C.length-E),C,E,F)}function I(C,_,E,F){return St(pt(_),C,E,F)}function v(C,_,E,F){return St(gt(_),C,E,F)}function L(C,_,E,F){return St(it(_,C.length-E),C,E,F)}l.prototype.write=function(_,E,F,q){if(E===void 0)q="utf8",F=this.length,E=0;else if(F===void 0&&typeof E=="string")q=E,F=this.length,E=0;else if(isFinite(E))E=E>>>0,isFinite(F)?(F=F>>>0,q===void 0&&(q="utf8")):(q=F,F=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ct=this.length-E;if((F===void 0||F>ct)&&(F=ct),_.length>0&&(F<0||E<0)||E>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");let D=!1;for(;;)switch(q){case"hex":return V(this,_,E,F);case"utf8":case"utf-8":return O(this,_,E,F);case"ascii":case"latin1":case"binary":return I(this,_,E,F);case"base64":return v(this,_,E,F);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,_,E,F);default:if(D)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),D=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function z(C,_,E){return _===0&&E===C.length?t.fromByteArray(C):t.fromByteArray(C.slice(_,E))}function U(C,_,E){E=Math.min(C.length,E);const F=[];let q=_;for(;q<E;){const ct=C[q];let D=null,tt=ct>239?4:ct>223?3:ct>191?2:1;if(q+tt<=E){let jt,Ht,qt,Lt;switch(tt){case 1:ct<128&&(D=ct);break;case 2:jt=C[q+1],(jt&192)===128&&(Lt=(ct&31)<<6|jt&63,Lt>127&&(D=Lt));break;case 3:jt=C[q+1],Ht=C[q+2],(jt&192)===128&&(Ht&192)===128&&(Lt=(ct&15)<<12|(jt&63)<<6|Ht&63,Lt>2047&&(Lt<55296||Lt>57343)&&(D=Lt));break;case 4:jt=C[q+1],Ht=C[q+2],qt=C[q+3],(jt&192)===128&&(Ht&192)===128&&(qt&192)===128&&(Lt=(ct&15)<<18|(jt&63)<<12|(Ht&63)<<6|qt&63,Lt>65535&&Lt<1114112&&(D=Lt))}}D===null?(D=65533,tt=1):D>65535&&(D-=65536,F.push(D>>>10&1023|55296),D=56320|D&1023),F.push(D),q+=tt}return X(F)}const Y=4096;function X(C){const _=C.length;if(_<=Y)return String.fromCharCode.apply(String,C);let E="",F=0;for(;F<_;)E+=String.fromCharCode.apply(String,C.slice(F,F+=Y));return E}function K(C,_,E){let F="";E=Math.min(C.length,E);for(let q=_;q<E;++q)F+=String.fromCharCode(C[q]&127);return F}function W(C,_,E){let F="";E=Math.min(C.length,E);for(let q=_;q<E;++q)F+=String.fromCharCode(C[q]);return F}function P(C,_,E){const F=C.length;(!_||_<0)&&(_=0),(!E||E<0||E>F)&&(E=F);let q="";for(let ct=_;ct<E;++ct)q+=ge[C[ct]];return q}function ot(C,_,E){const F=C.slice(_,E);let q="";for(let ct=0;ct<F.length-1;ct+=2)q+=String.fromCharCode(F[ct]+F[ct+1]*256);return q}l.prototype.slice=function(_,E){const F=this.length;_=~~_,E=E===void 0?F:~~E,_<0?(_+=F,_<0&&(_=0)):_>F&&(_=F),E<0?(E+=F,E<0&&(E=0)):E>F&&(E=F),E<_&&(E=_);const q=this.subarray(_,E);return Object.setPrototypeOf(q,l.prototype),q};function G(C,_,E){if(C%1!==0||C<0)throw new RangeError("offset is not uint");if(C+_>E)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(_,E,F){_=_>>>0,E=E>>>0,F||G(_,E,this.length);let q=this[_],ct=1,D=0;for(;++D<E&&(ct*=256);)q+=this[_+D]*ct;return q},l.prototype.readUintBE=l.prototype.readUIntBE=function(_,E,F){_=_>>>0,E=E>>>0,F||G(_,E,this.length);let q=this[_+--E],ct=1;for(;E>0&&(ct*=256);)q+=this[_+--E]*ct;return q},l.prototype.readUint8=l.prototype.readUInt8=function(_,E){return _=_>>>0,E||G(_,1,this.length),this[_]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(_,E){return _=_>>>0,E||G(_,2,this.length),this[_]|this[_+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(_,E){return _=_>>>0,E||G(_,2,this.length),this[_]<<8|this[_+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(_,E){return _=_>>>0,E||G(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(_,E){return _=_>>>0,E||G(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},l.prototype.readBigUInt64LE=Zt(function(_){_=_>>>0,nt(_,"offset");const E=this[_],F=this[_+7];(E===void 0||F===void 0)&&j(_,this.length-8);const q=E+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,ct=this[++_]+this[++_]*2**8+this[++_]*2**16+F*2**24;return BigInt(q)+(BigInt(ct)<<BigInt(32))}),l.prototype.readBigUInt64BE=Zt(function(_){_=_>>>0,nt(_,"offset");const E=this[_],F=this[_+7];(E===void 0||F===void 0)&&j(_,this.length-8);const q=E*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],ct=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+F;return(BigInt(q)<<BigInt(32))+BigInt(ct)}),l.prototype.readIntLE=function(_,E,F){_=_>>>0,E=E>>>0,F||G(_,E,this.length);let q=this[_],ct=1,D=0;for(;++D<E&&(ct*=256);)q+=this[_+D]*ct;return ct*=128,q>=ct&&(q-=Math.pow(2,8*E)),q},l.prototype.readIntBE=function(_,E,F){_=_>>>0,E=E>>>0,F||G(_,E,this.length);let q=E,ct=1,D=this[_+--q];for(;q>0&&(ct*=256);)D+=this[_+--q]*ct;return ct*=128,D>=ct&&(D-=Math.pow(2,8*E)),D},l.prototype.readInt8=function(_,E){return _=_>>>0,E||G(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},l.prototype.readInt16LE=function(_,E){_=_>>>0,E||G(_,2,this.length);const F=this[_]|this[_+1]<<8;return F&32768?F|4294901760:F},l.prototype.readInt16BE=function(_,E){_=_>>>0,E||G(_,2,this.length);const F=this[_+1]|this[_]<<8;return F&32768?F|4294901760:F},l.prototype.readInt32LE=function(_,E){return _=_>>>0,E||G(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},l.prototype.readInt32BE=function(_,E){return _=_>>>0,E||G(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},l.prototype.readBigInt64LE=Zt(function(_){_=_>>>0,nt(_,"offset");const E=this[_],F=this[_+7];(E===void 0||F===void 0)&&j(_,this.length-8);const q=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(F<<24);return(BigInt(q)<<BigInt(32))+BigInt(E+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),l.prototype.readBigInt64BE=Zt(function(_){_=_>>>0,nt(_,"offset");const E=this[_],F=this[_+7];(E===void 0||F===void 0)&&j(_,this.length-8);const q=(E<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(q)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+F)}),l.prototype.readFloatLE=function(_,E){return _=_>>>0,E||G(_,4,this.length),r.read(this,_,!0,23,4)},l.prototype.readFloatBE=function(_,E){return _=_>>>0,E||G(_,4,this.length),r.read(this,_,!1,23,4)},l.prototype.readDoubleLE=function(_,E){return _=_>>>0,E||G(_,8,this.length),r.read(this,_,!0,52,8)},l.prototype.readDoubleBE=function(_,E){return _=_>>>0,E||G(_,8,this.length),r.read(this,_,!1,52,8)};function rt(C,_,E,F,q,ct){if(!l.isBuffer(C))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>q||_<ct)throw new RangeError('"value" argument is out of bounds');if(E+F>C.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(_,E,F,q){if(_=+_,E=E>>>0,F=F>>>0,!q){const tt=Math.pow(2,8*F)-1;rt(this,_,E,F,tt,0)}let ct=1,D=0;for(this[E]=_&255;++D<F&&(ct*=256);)this[E+D]=_/ct&255;return E+F},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(_,E,F,q){if(_=+_,E=E>>>0,F=F>>>0,!q){const tt=Math.pow(2,8*F)-1;rt(this,_,E,F,tt,0)}let ct=F-1,D=1;for(this[E+ct]=_&255;--ct>=0&&(D*=256);)this[E+ct]=_/D&255;return E+F},l.prototype.writeUint8=l.prototype.writeUInt8=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,1,255,0),this[E]=_&255,E+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,2,65535,0),this[E]=_&255,this[E+1]=_>>>8,E+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,2,65535,0),this[E]=_>>>8,this[E+1]=_&255,E+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,4,4294967295,0),this[E+3]=_>>>24,this[E+2]=_>>>16,this[E+1]=_>>>8,this[E]=_&255,E+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,4,4294967295,0),this[E]=_>>>24,this[E+1]=_>>>16,this[E+2]=_>>>8,this[E+3]=_&255,E+4};function wt(C,_,E,F,q){ut(_,F,q,C,E,7);let ct=Number(_&BigInt(4294967295));C[E++]=ct,ct=ct>>8,C[E++]=ct,ct=ct>>8,C[E++]=ct,ct=ct>>8,C[E++]=ct;let D=Number(_>>BigInt(32)&BigInt(4294967295));return C[E++]=D,D=D>>8,C[E++]=D,D=D>>8,C[E++]=D,D=D>>8,C[E++]=D,E}function Rt(C,_,E,F,q){ut(_,F,q,C,E,7);let ct=Number(_&BigInt(4294967295));C[E+7]=ct,ct=ct>>8,C[E+6]=ct,ct=ct>>8,C[E+5]=ct,ct=ct>>8,C[E+4]=ct;let D=Number(_>>BigInt(32)&BigInt(4294967295));return C[E+3]=D,D=D>>8,C[E+2]=D,D=D>>8,C[E+1]=D,D=D>>8,C[E]=D,E+8}l.prototype.writeBigUInt64LE=Zt(function(_,E=0){return wt(this,_,E,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Zt(function(_,E=0){return Rt(this,_,E,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(_,E,F,q){if(_=+_,E=E>>>0,!q){const jt=Math.pow(2,8*F-1);rt(this,_,E,F,jt-1,-jt)}let ct=0,D=1,tt=0;for(this[E]=_&255;++ct<F&&(D*=256);)_<0&&tt===0&&this[E+ct-1]!==0&&(tt=1),this[E+ct]=(_/D>>0)-tt&255;return E+F},l.prototype.writeIntBE=function(_,E,F,q){if(_=+_,E=E>>>0,!q){const jt=Math.pow(2,8*F-1);rt(this,_,E,F,jt-1,-jt)}let ct=F-1,D=1,tt=0;for(this[E+ct]=_&255;--ct>=0&&(D*=256);)_<0&&tt===0&&this[E+ct+1]!==0&&(tt=1),this[E+ct]=(_/D>>0)-tt&255;return E+F},l.prototype.writeInt8=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,1,127,-128),_<0&&(_=255+_+1),this[E]=_&255,E+1},l.prototype.writeInt16LE=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,2,32767,-32768),this[E]=_&255,this[E+1]=_>>>8,E+2},l.prototype.writeInt16BE=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,2,32767,-32768),this[E]=_>>>8,this[E+1]=_&255,E+2},l.prototype.writeInt32LE=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,4,2147483647,-2147483648),this[E]=_&255,this[E+1]=_>>>8,this[E+2]=_>>>16,this[E+3]=_>>>24,E+4},l.prototype.writeInt32BE=function(_,E,F){return _=+_,E=E>>>0,F||rt(this,_,E,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[E]=_>>>24,this[E+1]=_>>>16,this[E+2]=_>>>8,this[E+3]=_&255,E+4},l.prototype.writeBigInt64LE=Zt(function(_,E=0){return wt(this,_,E,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Zt(function(_,E=0){return Rt(this,_,E,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ct(C,_,E,F,q,ct){if(E+F>C.length)throw new RangeError("Index out of range");if(E<0)throw new RangeError("Index out of range")}function Et(C,_,E,F,q){return _=+_,E=E>>>0,q||Ct(C,_,E,4),r.write(C,_,E,F,23,4),E+4}l.prototype.writeFloatLE=function(_,E,F){return Et(this,_,E,!0,F)},l.prototype.writeFloatBE=function(_,E,F){return Et(this,_,E,!1,F)};function vt(C,_,E,F,q){return _=+_,E=E>>>0,q||Ct(C,_,E,8),r.write(C,_,E,F,52,8),E+8}l.prototype.writeDoubleLE=function(_,E,F){return vt(this,_,E,!0,F)},l.prototype.writeDoubleBE=function(_,E,F){return vt(this,_,E,!1,F)},l.prototype.copy=function(_,E,F,q){if(!l.isBuffer(_))throw new TypeError("argument should be a Buffer");if(F||(F=0),!q&&q!==0&&(q=this.length),E>=_.length&&(E=_.length),E||(E=0),q>0&&q<F&&(q=F),q===F||_.length===0||this.length===0)return 0;if(E<0)throw new RangeError("targetStart out of bounds");if(F<0||F>=this.length)throw new RangeError("Index out of range");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),_.length-E<q-F&&(q=_.length-E+F);const ct=q-F;return this===_&&typeof s.prototype.copyWithin=="function"?this.copyWithin(E,F,q):s.prototype.set.call(_,this.subarray(F,q),E),ct},l.prototype.fill=function(_,E,F,q){if(typeof _=="string"){if(typeof E=="string"?(q=E,E=0,F=this.length):typeof F=="string"&&(q=F,F=this.length),q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!l.isEncoding(q))throw new TypeError("Unknown encoding: "+q);if(_.length===1){const D=_.charCodeAt(0);(q==="utf8"&&D<128||q==="latin1")&&(_=D)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(E<0||this.length<E||this.length<F)throw new RangeError("Out of range index");if(F<=E)return this;E=E>>>0,F=F===void 0?this.length:F>>>0,_||(_=0);let ct;if(typeof _=="number")for(ct=E;ct<F;++ct)this[ct]=_;else{const D=l.isBuffer(_)?_:l.from(_,q),tt=D.length;if(tt===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(ct=0;ct<F-E;++ct)this[ct+E]=D[ct%tt]}return this};const At={};function Ut(C,_,E){At[C]=class extends E{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${C}]`,this.stack,delete this.name}get code(){return C}set code(q){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:q,writable:!0})}toString(){return`${this.name} [${C}]: ${this.message}`}}}Ut("ERR_BUFFER_OUT_OF_BOUNDS",function(C){return C?`${C} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ut("ERR_INVALID_ARG_TYPE",function(C,_){return`The "${C}" argument must be of type number. Received type ${typeof _}`},TypeError),Ut("ERR_OUT_OF_RANGE",function(C,_,E){let F=`The value of "${C}" is out of range.`,q=E;return Number.isInteger(E)&&Math.abs(E)>2**32?q=Dt(String(E)):typeof E=="bigint"&&(q=String(E),(E>BigInt(2)**BigInt(32)||E<-(BigInt(2)**BigInt(32)))&&(q=Dt(q)),q+="n"),F+=` It must be ${_}. Received ${q}`,F},RangeError);function Dt(C){let _="",E=C.length;const F=C[0]==="-"?1:0;for(;E>=F+4;E-=3)_=`_${C.slice(E-3,E)}${_}`;return`${C.slice(0,E)}${_}`}function A(C,_,E){nt(_,"offset"),(C[_]===void 0||C[_+E]===void 0)&&j(_,C.length-(E+1))}function ut(C,_,E,F,q,ct){if(C>E||C<_){const D=typeof _=="bigint"?"n":"";let tt;throw _===0||_===BigInt(0)?tt=`>= 0${D} and < 2${D} ** ${(ct+1)*8}${D}`:tt=`>= -(2${D} ** ${(ct+1)*8-1}${D}) and < 2 ** ${(ct+1)*8-1}${D}`,new At.ERR_OUT_OF_RANGE("value",tt,C)}A(F,q,ct)}function nt(C,_){if(typeof C!="number")throw new At.ERR_INVALID_ARG_TYPE(_,"number",C)}function j(C,_,E){throw Math.floor(C)!==C?(nt(C,E),new At.ERR_OUT_OF_RANGE("offset","an integer",C)):_<0?new At.ERR_BUFFER_OUT_OF_BOUNDS:new At.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${_}`,C)}const $=/[^+/0-9A-Za-z-_]/g;function Z(C){if(C=C.split("=")[0],C=C.trim().replace($,""),C.length<2)return"";for(;C.length%4!==0;)C=C+"=";return C}function dt(C,_){_=_||1/0;let E;const F=C.length;let q=null;const ct=[];for(let D=0;D<F;++D){if(E=C.charCodeAt(D),E>55295&&E<57344){if(!q){if(E>56319){(_-=3)>-1&&ct.push(239,191,189);continue}else if(D+1===F){(_-=3)>-1&&ct.push(239,191,189);continue}q=E;continue}if(E<56320){(_-=3)>-1&&ct.push(239,191,189),q=E;continue}E=(q-55296<<10|E-56320)+65536}else q&&(_-=3)>-1&&ct.push(239,191,189);if(q=null,E<128){if((_-=1)<0)break;ct.push(E)}else if(E<2048){if((_-=2)<0)break;ct.push(E>>6|192,E&63|128)}else if(E<65536){if((_-=3)<0)break;ct.push(E>>12|224,E>>6&63|128,E&63|128)}else if(E<1114112){if((_-=4)<0)break;ct.push(E>>18|240,E>>12&63|128,E>>6&63|128,E&63|128)}else throw new Error("Invalid code point")}return ct}function pt(C){const _=[];for(let E=0;E<C.length;++E)_.push(C.charCodeAt(E)&255);return _}function it(C,_){let E,F,q;const ct=[];for(let D=0;D<C.length&&!((_-=2)<0);++D)E=C.charCodeAt(D),F=E>>8,q=E%256,ct.push(q),ct.push(F);return ct}function gt(C){return t.toByteArray(Z(C))}function St(C,_,E,F){let q;for(q=0;q<F&&!(q+E>=_.length||q>=C.length);++q)_[q+E]=C[q];return q}function yt(C,_){return C instanceof _||C!=null&&C.constructor!=null&&C.constructor.name!=null&&C.constructor.name===_.name}function Bt(C){return C!==C}const ge=function(){const C="0123456789abcdef",_=new Array(256);for(let E=0;E<16;++E){const F=E*16;for(let q=0;q<16;++q)_[F+q]=C[E]+C[q]}return _}();function Zt(C){return typeof BigInt>"u"?Ze:C}function Ze(){throw new Error("BigInt not supported")}})(Hm);const tr=Hm.Buffer,Km=e=>e===void 0?null:e;class dR{constructor(){this.map=new Map}setItem(t,r){this.map.set(t,r)}getItem(t){return this.map.get(t)}}let Ym=new dR,pR=!0;try{typeof localStorage<"u"&&localStorage&&(Ym=localStorage,pR=!1)}catch{}const mR=Ym,gR=Object.assign,yR=Object.keys,_R=(e,t)=>{for(const r in e)t(e[r],r)},qm=e=>yR(e).length,bR=e=>{for(const t in e)return!1;return!0},wR=(e,t)=>{for(const r in e)if(!t(e[r],r))return!1;return!0},ER=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),vR=(e,t)=>e===t||qm(e)===qm(t)&&wR(e,(r,n)=>(r!==void 0||ER(t,n))&&t[n]===r),kR=Object.freeze,Vm=e=>{for(const t in e){const r=e[t];(typeof r=="object"||typeof r=="function")&&Vm(e[t])}return kR(e)},Mf=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&Mf(e,t,r+1)}},xR=e=>e,AR=(e,t)=>t.includes(e);var Xm={};const ca=typeof Cn<"u"&&Cn.release&&/node|io\.js/.test(Cn.release.name)&&Object.prototype.toString.call(typeof Cn<"u"?Cn:0)==="[object process]";let Qn;const TR=()=>{if(Qn===void 0)if(ca){Qn=Ln();const e=Cn.argv;let t=null;for(let r=0;r<e.length;r++){const n=e[r];n[0]==="-"?(t!==null&&Qn.set(t,""),t=n):t!==null&&(Qn.set(t,n),t=null)}t!==null&&Qn.set(t,"")}else typeof location=="object"?(Qn=Ln(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,r]=e.split("=");Qn.set(`--${Mm(t,"-")}`,r),Qn.set(`-${Mm(t,"-")}`,r)}})):Qn=Ln();return Qn},Uf=e=>TR().has(e),Uc=e=>Km(ca?Xm[e.toUpperCase().replaceAll("-","_")]:mR.getItem(e)),Jm=e=>Uf("--"+e)||Uc(e)!==null;Jm("production");const SR=ca&&AR(Xm.FORCE_COLOR,["true","1","2"])||!Uf("--no-colors")&&!Jm("no-color")&&(!ca||Cn.stdout.isTTY)&&(!ca||Uf("--color")||Uc("COLORTERM")!==null||(Uc("TERM")||"").includes("color")),RR=e=>new Uint8Array(e),OR=e=>{const t=RR(e.byteLength);return t.set(e),t};class IR{constructor(t,r){this.left=t,this.right=r}}const wi=(e,t)=>new IR(e,t);typeof DOMParser<"u"&&new DOMParser;const NR=e=>OS(e,(t,r)=>`${r}:${t};`).join(""),Ei=Symbol,Zm=Ei(),Qm=Ei(),CR=Ei(),LR=Ei(),MR=Ei(),tg=Ei(),UR=Ei(),Pf=Ei(),PR=Ei(),FR=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],r=[];let n=0;for(;n<e.length;n++){const s=e[n];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(n>0&&r.push(t.join(""));n<e.length;n++){const s=e[n];s instanceof Symbol||r.push(s)}return r},BR={[Zm]:wi("font-weight","bold"),[Qm]:wi("font-weight","normal"),[CR]:wi("color","blue"),[MR]:wi("color","green"),[LR]:wi("color","grey"),[tg]:wi("color","red"),[UR]:wi("color","purple"),[Pf]:wi("color","orange"),[PR]:wi("color","black")},eg=SR?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],r=[],n=Ln();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=BR[a];if(c!==void 0)n.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=NR(n);s>0||u.length>0?(t.push("%c"+a),r.push(u)):t.push(a)}else break}}for(s>0&&(i=r,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:FR,$R=(...e)=>{console.log(...eg(e)),rg.forEach(t=>t.print(e))},DR=(...e)=>{console.warn(...eg(e)),e.unshift(Pf),rg.forEach(t=>t.print(e))},rg=eo(),ng=e=>({[Symbol.iterator](){return this},next:e}),jR=(e,t)=>ng(()=>{let r;do r=e.next();while(!r.done&&!t(r.value));return r}),Ff=(e,t)=>ng(()=>{const{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}});class Bf{constructor(t,r){this.clock=t,this.len=r}}class la{constructor(){this.clients=new Map}}const ig=(e,t,r)=>t.clients.forEach((n,i)=>{const s=e.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,u=n[c];c<n.length&&u.clock<a;u=n[++c])wg(e,s,u.clock,u.len,r)}}),zR=(e,t)=>{let r=0,n=e.length-1;for(;r<=n;){const i=ji((r+n)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;r=i+1}else n=i-1}return null},sg=(e,t)=>{const r=e.clients.get(t.client);return r!==void 0&&zR(r,t.clock)!==null},$f=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let r,n;for(r=1,n=1;r<t.length;r++){const i=t[n-1],s=t[r];i.clock+i.len>=s.clock?i.len=ms(i.len,s.clock+s.len-i.clock):(n<r&&(t[n]=s),n++)}t.length=n})},WR=e=>{const t=new la;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,i)=>{if(!t.clients.has(i)){const s=n.slice();for(let o=r+1;o<e.length;o++)NS(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return $f(t),t},Pc=(e,t,r,n)=>{Di(e.clients,t,()=>[]).push(new Bf(r,n))},HR=()=>new la,GR=e=>{const t=HR();return e.clients.forEach((r,n)=>{const i=[];for(let s=0;s<r.length;s++){const o=r[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<r.length)for(let u=r[s+1];s+1<r.length&&u.deleted;u=r[++s+1])c+=u.length;i.push(new Bf(a,c))}}i.length>0&&t.clients.set(n,i)}),t},ao=(e,t)=>{de(e.restEncoder,t.clients.size),ps(t.clients.entries()).sort((r,n)=>n[0]-r[0]).forEach(([r,n])=>{e.resetDsCurVal(),de(e.restEncoder,r);const i=n.length;de(e.restEncoder,i);for(let s=0;s<i;s++){const o=n[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Df=e=>{const t=new la,r=ie(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();const i=ie(e.restDecoder),s=ie(e.restDecoder);if(s>0){const o=Di(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Bf(e.readDsClock(),e.readDsLen()))}}return t},og=(e,t,r)=>{const n=new la,i=ie(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=ie(e.restDecoder),a=ie(e.restDecoder),c=r.clients.get(o)||[],u=lr(r,o);for(let l=0;l<a;l++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<u){u<d&&Pc(n,o,u,d-u);let f=ti(c,h),m=c[f];for(!m.deleted&&m.id.clock<h&&(c.splice(f+1,0,Xc(t,m,h-m.id.clock)),f++);f<c.length&&(m=c[f++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(f,0,Xc(t,m,d-m.id.clock)),m.delete(t))}else Pc(n,o,h,d-h)}}if(n.clients.size>0){const s=new ys;return de(s.restEncoder,0),ao(s,n),s.toUint8Array()}return null},ag=zm;class co extends LS{constructor({guid:t=iR(),collectionid:r=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=ag(),this.guid=t,this.collectionid=r,this.share=new Map,this.store=new yg,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Wm(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>Wm(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Ee(t.parent.doc,r=>{r.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ps(this.subdocs).map(t=>t.guid))}transact(t,r=null){return Ee(this,t,r)}get(t,r=wr){const n=Di(this.share,t,()=>{const s=new r;return s._integrate(this,null),s}),i=n.constructor;if(r!==wr&&i!==r)if(i===wr){const s=new r;s._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=n._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=n._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,ho)}getText(t=""){return this.get(t,vi)}getMap(t=""){return this.get(t,po)}getXmlElement(t=""){return this.get(t,go)}getXmlFragment(t=""){return this.get(t,_s)}toJSON(){const t={};return this.share.forEach((r,n)=>{t[n]=r.toJSON()}),t}destroy(){this.isDestroyed=!0,ps(this.subdocs).forEach(r=>r.destroy());const t=this._item;if(t!==null){this._item=null;const r=t.content;r.doc=new co({guid:this.guid,...r.opts,shouldLoad:!1}),r.doc._item=t,Ee(t.parent.doc,n=>{const i=r.doc;t.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class cg{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return ie(this.restDecoder)}readDsLen(){return ie(this.restDecoder)}}class lg extends cg{readLeftID(){return ae(ie(this.restDecoder),ie(this.restDecoder))}readRightID(){return ae(ie(this.restDecoder),ie(this.restDecoder))}readClient(){return ie(this.restDecoder)}readInfo(){return io(this.restDecoder)}readString(){return so(this.restDecoder)}readParentInfo(){return ie(this.restDecoder)===1}readTypeRef(){return ie(this.restDecoder)}readLen(){return ie(this.restDecoder)}readAny(){return aa(this.restDecoder)}readBuf(){return OR(nn(this.restDecoder))}readJSON(){return JSON.parse(so(this.restDecoder))}readKey(){return so(this.restDecoder)}}class KR{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ie(this.restDecoder),this.dsCurrVal}readDsLen(){const t=ie(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class lo extends KR{constructor(t){super(t),this.keys=[],ie(t),this.keyClockDecoder=new Nf(nn(t)),this.clientDecoder=new Lc(nn(t)),this.leftClockDecoder=new Nf(nn(t)),this.rightClockDecoder=new Nf(nn(t)),this.infoDecoder=new jm(nn(t),io),this.stringDecoder=new eR(nn(t)),this.parentInfoDecoder=new jm(nn(t),io),this.typeRefDecoder=new Lc(nn(t)),this.lenDecoder=new Lc(nn(t))}readLeftID(){return new uo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new uo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return aa(this.restDecoder)}readBuf(){return nn(this.restDecoder)}readJSON(){return aa(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const r=this.stringDecoder.read();return this.keys.push(r),r}}}class YR{constructor(){this.restEncoder=Oc()}toUint8Array(){return Vn(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){de(this.restEncoder,t)}writeDsLen(t){de(this.restEncoder,t)}}class ua extends YR{writeLeftID(t){de(this.restEncoder,t.client),de(this.restEncoder,t.clock)}writeRightID(t){de(this.restEncoder,t.client),de(this.restEncoder,t.clock)}writeClient(t){de(this.restEncoder,t)}writeInfo(t){xf(this.restEncoder,t)}writeString(t){ro(this.restEncoder,t)}writeParentInfo(t){de(this.restEncoder,t?1:0)}writeTypeRef(t){de(this.restEncoder,t)}writeLen(t){de(this.restEncoder,t)}writeAny(t){oa(this.restEncoder,t)}writeBuf(t){rn(this.restEncoder,t)}writeJSON(t){ro(this.restEncoder,JSON.stringify(t))}writeKey(t){ro(this.restEncoder,t)}}class qR{constructor(){this.restEncoder=Oc(),this.dsCurrVal=0}toUint8Array(){return Vn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const r=t-this.dsCurrVal;this.dsCurrVal=t,de(this.restEncoder,r)}writeDsLen(t){t===0&&Jn(),de(this.restEncoder,t-1),this.dsCurrVal+=t}}class ys extends qR{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Rf,this.clientEncoder=new Nc,this.leftClockEncoder=new Rf,this.rightClockEncoder=new Rf,this.infoEncoder=new Pm(xf),this.stringEncoder=new JS,this.parentInfoEncoder=new Pm(xf),this.typeRefEncoder=new Nc,this.lenEncoder=new Nc}toUint8Array(){const t=Oc();return de(t,0),rn(t,this.keyClockEncoder.toUint8Array()),rn(t,this.clientEncoder.toUint8Array()),rn(t,this.leftClockEncoder.toUint8Array()),rn(t,this.rightClockEncoder.toUint8Array()),rn(t,Vn(this.infoEncoder)),rn(t,this.stringEncoder.toUint8Array()),rn(t,Vn(this.parentInfoEncoder)),rn(t,this.typeRefEncoder.toUint8Array()),rn(t,this.lenEncoder.toUint8Array()),Ic(t,Vn(this.restEncoder)),Vn(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){oa(this.restEncoder,t)}writeBuf(t){rn(this.restEncoder,t)}writeJSON(t){oa(this.restEncoder,t)}writeKey(t){const r=this.keyMap.get(t);r===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(r)}}const VR=(e,t,r,n)=>{n=ms(n,t[0].id.clock);const i=ti(t,n);de(e.restEncoder,t.length-i),e.writeClient(r),de(e.restEncoder,n);const s=t[i];s.write(e,n-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},jf=(e,t,r)=>{const n=new Map;r.forEach((i,s)=>{lr(t,s)>i&&n.set(s,i)}),Wf(t).forEach((i,s)=>{r.has(s)||n.set(s,0)}),de(e.restEncoder,n.size),ps(n.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{VR(e,t.clients.get(i),i,s)})},XR=(e,t)=>{const r=Ln(),n=ie(e.restDecoder);for(let i=0;i<n;i++){const s=ie(e.restDecoder),o=new Array(s),a=e.readClient();let c=ie(e.restDecoder);r.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Rc&l){case 0:{const h=e.readLen();o[u]=new mn(ae(a,c),h),c+=h;break}case 10:{const h=ie(e.restDecoder);o[u]=new gn(ae(a,c),h),c+=h;break}default:{const h=(l&(bi|en))===0,d=new rr(ae(a,c),null,(l&en)===en?e.readLeftID():null,null,(l&bi)===bi?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&ra)===ra?e.readString():null,Gg(e,l));o[u]=d,c+=d.length}}}}return r},JR=(e,t,r)=>{const n=[];let i=ps(r.keys()).sort((f,m)=>f-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=r.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=r.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new yg,c=new Map,u=(f,m)=>{const p=c.get(f);(p==null||p>m)&&c.set(f,m)};let l=o.refs[o.i++];const h=new Map,d=()=>{for(const f of n){const m=f.id.client,p=r.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),r.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[f]),i=i.filter(g=>g!==m)}n.length=0};for(;;){if(l.constructor!==gn){const m=Di(h,l.id.client,()=>lr(t,l.id.client))-l.id.clock;if(m<0)n.push(l),u(l.id.client,l.id.clock-1),d();else{const p=l.getMissing(e,t);if(p!==null){n.push(l);const g=r.get(p)||{refs:[],i:0};if(g.refs.length===g.i)u(p,lr(t,p)),d();else{l=g.refs[g.i++];continue}}else(m===0||m<l.length)&&(l.integrate(e,m),h.set(l.id.client,l.id.clock+l.length))}}if(n.length>0)l=n.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const f=new ys;return jf(f,a,new Map),de(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},ZR=(e,t)=>jf(e,t.doc.store,t.beforeState),QR=(e,t,r,n=new lo(e))=>Ee(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=XR(n,o),u=JR(i,a,c),l=a.pendingStructs;if(l){for(const[d,f]of l.missing)if(f<lr(a,d)){s=!0;break}if(u){for(const[d,f]of u.missing){const m=l.missing.get(d);(m==null||m>f)&&l.missing.set(d,f)}l.update=$c([l.update,u.update])}}else a.pendingStructs=u;const h=og(n,i,a);if(a.pendingDs){const d=new lo(no(a.pendingDs));ie(d.restDecoder);const f=og(d,i,a);h&&f?a.pendingDs=$c([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,ug(i.doc,d)}},r,!1),ug=(e,t,r,n=lo)=>{const i=no(t);QR(i,e,r,new n(i))},fg=(e,t,r)=>ug(e,t,r,lg),tO=(e,t,r=new Map)=>{jf(e,t.store,r),ao(e,GR(t.store))},eO=(e,t=new Uint8Array([0]),r=new ys)=>{const n=hg(t);tO(r,e,n);const i=[r.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(dO(e.store.pendingStructs.update,t)),i.length>1){if(r.constructor===ua)return fO(i.map((s,o)=>o===0?s:mO(s)));if(r.constructor===ys)return $c(i)}return i[0]},rO=(e,t)=>eO(e,t,new ua),nO=e=>{const t=new Map,r=ie(e.restDecoder);for(let n=0;n<r;n++){const i=ie(e.restDecoder),s=ie(e.restDecoder);t.set(i,s)}return t},hg=e=>nO(new cg(no(e)));class iO{constructor(){this.l=[]}}const dg=()=>new iO,pg=(e,t)=>e.l.push(t),mg=(e,t)=>{const r=e.l,n=r.length;e.l=r.filter(i=>t!==i),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},gg=(e,t,r)=>Mf(e.l,[t,r]);class uo{constructor(t,r){this.client=t,this.clock=r}}const Fc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,ae=(e,t)=>new uo(e,t),sO=e=>{for(const[t,r]of e.doc.share.entries())if(r===e)return t;throw Jn()},fo=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!sg(t.ds,e.id),zf=(e,t)=>{const r=Di(e.meta,zf,eo),n=e.doc.store;r.has(t)||(t.sv.forEach((i,s)=>{i<lr(n,s)&&Wi(e,ae(s,i))}),ig(e,t.ds,i=>{}),r.add(t))};class yg{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Wf=e=>{const t=new Map;return e.clients.forEach((r,n)=>{const i=r[r.length-1];t.set(n,i.id.clock+i.length)}),t},lr=(e,t)=>{const r=e.clients.get(t);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},_g=(e,t)=>{let r=e.clients.get(t.id.client);if(r===void 0)r=[],e.clients.set(t.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==t.id.clock)throw Jn()}r.push(t)},ti=(e,t)=>{let r=0,n=e.length-1,i=e[n],s=i.id.clock;if(s===t)return n;let o=ji(t/(s+i.length-1)*n);for(;r<=n;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;r=o+1}else n=o-1;o=ji((r+n)/2)}throw Jn()},Hf=(e,t)=>{const r=e.clients.get(t.client);return r[ti(r,t.clock)]},Gf=(e,t,r)=>{const n=ti(t,r),i=t[n];return i.id.clock<r&&i instanceof rr?(t.splice(n+1,0,Xc(e,i,r-i.id.clock)),n+1):n},Wi=(e,t)=>{const r=e.doc.store.clients.get(t.client);return r[Gf(e,r,t.clock)]},bg=(e,t,r)=>{const n=t.clients.get(r.client),i=ti(n,r.clock),s=n[i];return r.clock!==s.id.clock+s.length-1&&s.constructor!==mn&&n.splice(i+1,0,Xc(e,s,r.clock-s.id.clock+1)),s},oO=(e,t,r)=>{const n=e.clients.get(t.id.client);n[ti(n,t.id.clock)]=r},wg=(e,t,r,n,i)=>{if(n===0)return;const s=r+n;let o=Gf(e,t,r),a;do a=t[o++],s<a.id.clock+a.length&&Gf(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class aO{constructor(t,r,n){this.doc=t,this.deleteSet=new la,this.beforeState=Wf(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=r,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Eg=(e,t)=>t.deleteSet.clients.size===0&&!IS(t.afterState,(r,n)=>t.beforeState.get(n)!==r)?!1:($f(t.deleteSet),ZR(e,t),ao(e,t.deleteSet),!0),vg=(e,t,r)=>{const n=t._item;(n===null||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&Di(e.changed,t,eo).add(r)},Bc=(e,t)=>{let r=e[t],n=e[t-1],i=t;for(;i>0;r=n,n=e[--i-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof rr&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},cO=(e,t,r)=>{for(const[n,i]of e.clients.entries()){const s=t.clients.get(n);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=ti(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof rr&&h.deleted&&!h.keep&&r(h)&&h.gc(t,!1)}}}},lO=(e,t)=>{e.clients.forEach((r,n)=>{const i=t.clients.get(n);for(let s=r.length-1;s>=0;s--){const o=r[s],a=Om(i.length-1,1+ti(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Bc(i,c)}})},kg=(e,t)=>{if(t<e.length){const r=e[t],n=r.doc,i=n.store,s=r.deleteSet,o=r._mergeStructs;try{$f(s),r.afterState=Wf(r.doc.store),n.emit("beforeObserverCalls",[r,n]);const a=[];r.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(r,c)})),a.push(()=>{r.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),gg(u._dEH,c,r))})}),a.push(()=>n.emit("afterTransaction",[r,n])),Mf(a,[]),r._needFormattingCleanup&&OO(r)}finally{n.gc&&cO(s,i,n.gcFilter),lO(s,i),r.afterState.forEach((l,h)=>{const d=r.beforeState.get(h)||0;if(d!==l){const f=i.clients.get(h),m=ms(ti(f,d),1);for(let p=f.length-1;p>=m;)p-=1+Bc(f,p)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:d}=o[l].id,f=i.clients.get(h),m=ti(f,d);m+1<f.length&&Bc(f,m+1)>1||m>0&&Bc(f,m)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&($R(Pf,Zm,"[yjs] ",Qm,tg,"Changed the client-id because another client seems to be using it."),n.clientID=ag()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const l=new ua;Eg(l,r)&&n.emit("update",[l.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const l=new ys;Eg(l,r)&&n.emit("updateV2",[l.toUint8Array(),r.origin,n,r])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=r;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=n.clientID,l.collectionid==null&&(l.collectionid=n.collectionid),n.subdocs.add(l)}),u.forEach(l=>n.subdocs.delete(l)),n.emit("subdocs",[{loaded:c,added:a,removed:u},n,r]),u.forEach(l=>l.destroy())),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):kg(e,t+1)}}},Ee=(e,t,r=null,n=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new aO(e,r,n),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&kg(i,0)}}return o};function*uO(e){const t=ie(e.restDecoder);for(let r=0;r<t;r++){const n=ie(e.restDecoder),i=e.readClient();let s=ie(e.restDecoder);for(let o=0;o<n;o++){const a=e.readInfo();if(a===10){const c=ie(e.restDecoder);yield new gn(ae(i,s),c),s+=c}else if(Rc&a){const c=(a&(bi|en))===0,u=new rr(ae(i,s),null,(a&en)===en?e.readLeftID():null,null,(a&bi)===bi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&ra)===ra?e.readString():null,Gg(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new mn(ae(i,s),c),s+=c}}}}class Kf{constructor(t,r){this.gen=uO(t),this.curr=null,this.done=!1,this.filterSkips=r,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===gn);return this.curr}}class Yf{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const fO=e=>$c(e,lg,ua),hO=(e,t)=>{if(e.constructor===mn){const{client:r,clock:n}=e.id;return new mn(ae(r,n+t),e.length-t)}else if(e.constructor===gn){const{client:r,clock:n}=e.id;return new gn(ae(r,n+t),e.length-t)}else{const r=e,{client:n,clock:i}=r.id;return new rr(ae(n,i+t),null,ae(n,i+t-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(t))}},$c=(e,t=lo,r=ys)=>{if(e.length===1)return e[0];const n=e.map(l=>new t(no(l)));let i=n.map(l=>new Kf(l,!0)),s=null;const o=new r,a=new Yf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const m=d.curr.id.clock-f.curr.id.clock;return m===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===gn?1:-1:m}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let d=l.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=l.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Hi(a,s.struct,s.offset),s={struct:d,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===gn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Hi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new gn(ae(h,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===gn?s.struct.length-=m:d=hO(d,m)),s.struct.mergeWith(d)||(Hi(a,s.struct,s.offset),s={struct:d,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let d=l.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==gn;d=l.next())Hi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Hi(a,s.struct,s.offset),s=null),qf(a);const c=n.map(l=>Df(l)),u=WR(c);return ao(o,u),o.toUint8Array()},dO=(e,t,r=lo,n=ys)=>{const i=hg(t),s=new n,o=new Yf(s),a=new r(no(e)),c=new Kf(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,d=i.get(h)||0;if(c.curr.constructor===gn){c.next();continue}if(l.id.clock+l.length>d)for(Hi(o,l,ms(d-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Hi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}qf(o);const u=Df(a);return ao(s,u),s.toUint8Array()},xg=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Vn(e.encoder.restEncoder)}),e.encoder.restEncoder=Oc(),e.written=0)},Hi=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&xg(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),de(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},qf=e=>{xg(e);const t=e.encoder.restEncoder;de(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){const n=e.clientStructs[r];de(t,n.written),Ic(t,n.restEncoder)}},pO=(e,t,r,n)=>{const i=new r(no(e)),s=new Kf(i,!1),o=new n,a=new Yf(o);for(let u=s.curr;u!==null;u=s.next())Hi(a,t(u),0);qf(a);const c=Df(i);return ao(o,c),o.toUint8Array()},mO=e=>pO(e,xR,lo,ua),Ag="You must not compute changes after the event-handler fired.";class Dc{constructor(t,r){this.target=t,this.currentTarget=t,this.transaction=r,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=gO(this.currentTarget,this.target))}deletes(t){return sg(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw zi(Ag);const t=new Map,r=this.target;this.transaction.changed.get(r).forEach(i=>{if(i!==null){const s=r._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=wf(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=wf(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=wf(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw zi(Ag);const r=this.target,n=eo(),i=eo(),s=[];if(t={added:n,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(r).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=r._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),n.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const gO=(e,t)=>{const r=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)r.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;r.unshift(n)}t=t._item.parent}return r},xr=()=>{DR("Invalid access: Add Yjs type to a document before reading data.")},Tg=80;let Vf=0;class yO{constructor(t,r){t.marker=!0,this.p=t,this.index=r,this.timestamp=Vf++}}const _O=e=>{e.timestamp=Vf++},Sg=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=Vf++},bO=(e,t,r)=>{if(e.length>=Tg){const n=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Sg(n,t,r),n}else{const n=new yO(t,r);return e.push(n),n}},jc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const r=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Sc(t-s.index)<Sc(t-o.index)?s:o);let n=e._start,i=0;for(r!==null&&(n=r.p,i=r.index,_O(r));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&Sc(r.index-i)<n.parent.length/Tg?(Sg(r,n,i),r):bO(e._searchMarker,n,i)},fa=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){const i=e[n];if(r>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(n,1);continue}i.p=s,s.marker=!0}(t<i.index||r>0&&t===i.index)&&(i.index=ms(t,i.index+r))}},zc=(e,t,r)=>{const n=e,i=t.changedParentTypes;for(;Di(i,e,()=>[]).push(r),e._item!==null;)e=e._item.parent;gg(n._eH,r,t)};class wr{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=dg(),this._dEH=dg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,r){this.doc=t,this._item=r}_copy(){throw Xn()}clone(){throw Xn()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,r){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){pg(this._eH,t)}observeDeep(t){pg(this._dEH,t)}unobserve(t){mg(this._eH,t)}unobserveDeep(t){mg(this._dEH,t)}toJSON(){}}const Rg=(e,t,r)=>{e.doc??xr(),t<0&&(t=e._length+t),r<0&&(r=e._length+r);let n=r-t;const i=[];let s=e._start;for(;s!==null&&n>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&n>0;a++)i.push(o[a]),n--;t=0}}s=s.right}return i},Og=e=>{e.doc??xr();const t=[];let r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}r=r.right}return t},ha=(e,t)=>{let r=0,n=e._start;for(e.doc??xr();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)t(i[s],r++,e)}n=n.right}},Ig=(e,t)=>{const r=[];return ha(e,(n,i)=>{r.push(t(n,i,e))}),r},wO=e=>{let t=e._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};r=t.content.getContent(),n=0,t=t.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},Ng=(e,t)=>{e.doc??xr();const r=jc(e,t);let n=e._start;for(r!==null&&(n=r.p,t-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Wc=(e,t,r,n)=>{let i=r;const s=e.doc,o=s.clientID,a=s.store,c=r===null?t._start:r.right;let u=[];const l=()=>{u.length>0&&(i=new rr(ae(o,lr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ws(u)),i.integrate(e,0),u=[])};n.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new rr(ae(o,lr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new da(new Uint8Array(h))),i.integrate(e,0);break;case co:i=new rr(ae(o,lr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ma(h)),i.integrate(e,0);break;default:if(h instanceof wr)i=new rr(ae(o,lr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ki(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},Cg=()=>zi("Length exceeded!"),Lg=(e,t,r,n)=>{if(r>t._length)throw Cg();if(r===0)return t._searchMarker&&fa(t._searchMarker,r,n.length),Wc(e,t,null,n);const i=r,s=jc(t,r);let o=t._start;for(s!==null&&(o=s.p,r-=s.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&Wi(e,ae(o.id.client,o.id.clock+r));break}r-=o.length}return t._searchMarker&&fa(t._searchMarker,i,n.length),Wc(e,t,o,n)},EO=(e,t,r)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Wc(e,t,i,r)},Mg=(e,t,r,n)=>{if(n===0)return;const i=r,s=n,o=jc(t,r);let a=t._start;for(o!==null&&(a=o.p,r-=o.index);a!==null&&r>0;a=a.right)!a.deleted&&a.countable&&(r<a.length&&Wi(e,ae(a.id.client,a.id.clock+r)),r-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&Wi(e,ae(a.id.client,a.id.clock+n)),a.delete(e),n-=a.length),a=a.right;if(n>0)throw Cg();t._searchMarker&&fa(t._searchMarker,i,-s+n)},Hc=(e,t,r)=>{const n=t._map.get(r);n!==void 0&&n.delete(e)},Xf=(e,t,r,n)=>{const i=t._map.get(r)||null,s=e.doc,o=s.clientID;let a;if(n==null)a=new ws([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new ws([n]);break;case Uint8Array:a=new da(n);break;case co:a=new ma(n);break;default:if(n instanceof wr)a=new ki(n);else throw new Error("Unexpected content type")}new rr(ae(o,lr(s.store,o)),i,i&&i.lastId,null,null,t,r,a).integrate(e,0)},Jf=(e,t)=>{e.doc??xr();const r=e._map.get(t);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},Ug=e=>{const t={};return e.doc??xr(),e._map.forEach((r,n)=>{r.deleted||(t[n]=r.content.getContent()[r.length-1])}),t},Pg=(e,t)=>{e.doc??xr();const r=e._map.get(t);return r!==void 0&&!r.deleted},vO=(e,t)=>{const r={};return e._map.forEach((n,i)=>{let s=n;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&fo(s,t)&&(r[i]=s.content.getContent()[s.length-1])}),r},Gc=e=>(e.doc??xr(),jR(e._map.entries(),t=>!t[1].deleted));class kO extends Dc{}class ho extends wr{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const r=new ho;return r.push(t),r}_integrate(t,r){super._integrate(t,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ho}clone(){const t=new ho;return t.insert(0,this.toArray().map(r=>r instanceof wr?r.clone():r)),t}get length(){return this.doc??xr(),this._length}_callObserver(t,r){super._callObserver(t,r),zc(this,t,new kO(this,t))}insert(t,r){this.doc!==null?Ee(this.doc,n=>{Lg(n,this,t,r)}):this._prelimContent.splice(t,0,...r)}push(t){this.doc!==null?Ee(this.doc,r=>{EO(r,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,r=1){this.doc!==null?Ee(this.doc,n=>{Mg(n,this,t,r)}):this._prelimContent.splice(t,r)}get(t){return Ng(this,t)}toArray(){return Og(this)}slice(t=0,r=this.length){return Rg(this,t,r)}toJSON(){return this.map(t=>t instanceof wr?t.toJSON():t)}map(t){return Ig(this,t)}forEach(t){ha(this,t)}[Symbol.iterator](){return wO(this)}_write(t){t.writeTypeRef(qO)}}const xO=e=>new ho;class AO extends Dc{constructor(t,r,n){super(t,r),this.keysChanged=n}}class po extends wr{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,r){super._integrate(t,r),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new po}clone(){const t=new po;return this.forEach((r,n)=>{t.set(n,r instanceof wr?r.clone():r)}),t}_callObserver(t,r){zc(this,t,new AO(this,t,r))}toJSON(){this.doc??xr();const t={};return this._map.forEach((r,n)=>{if(!r.deleted){const i=r.content.getContent()[r.length-1];t[n]=i instanceof wr?i.toJSON():i}}),t}get size(){return[...Gc(this)].length}keys(){return Ff(Gc(this),t=>t[0])}values(){return Ff(Gc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Ff(Gc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??xr(),this._map.forEach((r,n)=>{r.deleted||t(r.content.getContent()[r.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Ee(this.doc,r=>{Hc(r,this,t)}):this._prelimContent.delete(t)}set(t,r){return this.doc!==null?Ee(this.doc,n=>{Xf(n,this,t,r)}):this._prelimContent.set(t,r),r}get(t){return Jf(this,t)}has(t){return Pg(this,t)}clear(){this.doc!==null?Ee(this.doc,t=>{this.forEach(function(r,n,i){Hc(t,i,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(VO)}}const TO=e=>new po,Gi=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&vR(e,t);class Zf{constructor(t,r,n,i){this.left=t,this.right=r,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Jn(),this.right.content.constructor){case er:this.right.deleted||mo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Fg=(e,t,r)=>{for(;t.right!==null&&r>0;){switch(t.right.content.constructor){case er:t.right.deleted||mo(t.currentAttributes,t.right.content);break;default:t.right.deleted||(r<t.right.length&&Wi(e,ae(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Kc=(e,t,r,n)=>{const i=new Map,s=n?jc(t,r):null;if(s){const o=new Zf(s.p.left,s.p,s.index,i);return Fg(e,o,r-s.index)}else{const o=new Zf(null,t._start,0,i);return Fg(e,o,r)}},Bg=(e,t,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===er&&Gi(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=e.doc,s=i.clientID;n.forEach((o,a)=>{const c=r.left,u=r.right,l=new rr(ae(s,lr(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new er(a,o));l.integrate(e,0),r.right=l,r.forward()})},mo=(e,t)=>{const{key:r,value:n}=t;n===null?e.delete(r):e.set(r,n)},$g=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===er&&Gi(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Dg=(e,t,r,n)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in n){const c=n[a],u=r.currentAttributes.get(a)??null;if(!Gi(u,c)){o.set(a,u);const{left:l,right:h}=r;r.right=new rr(ae(s,lr(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new er(a,c)),r.right.integrate(e,0),r.forward()}}return o},Qf=(e,t,r,n,i)=>{r.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=e.doc,o=s.clientID;$g(r,i);const a=Dg(e,t,r,i),c=n.constructor===String?new ei(n):n instanceof wr?new ki(n):new bs(n);let{left:u,right:l,index:h}=r;t._searchMarker&&fa(t._searchMarker,r.index,c.getLength()),l=new rr(ae(o,lr(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),r.right=l,r.index=h,r.forward(),Bg(e,t,r,a)},jg=(e,t,r,n,i)=>{const s=e.doc,o=s.clientID;$g(r,i);const a=Dg(e,t,r,i);t:for(;r.right!==null&&(n>0||a.size>0&&(r.right.deleted||r.right.content.constructor===er));){if(!r.right.deleted)switch(r.right.content.constructor){case er:{const{key:c,value:u}=r.right.content,l=i[c];if(l!==void 0){if(Gi(l,u))a.delete(c);else{if(n===0)break t;a.set(c,u)}r.right.delete(e)}else r.currentAttributes.set(c,u);break}default:n<r.right.length&&Wi(e,ae(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new rr(ae(o,lr(s.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new ei(c)),r.right.integrate(e,0),r.forward()}Bg(e,t,r,a)},zg=(e,t,r,n,i)=>{let s=t;const o=Ln();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===er){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(r===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case er:{const{key:l,value:h}=u,d=n.get(l)??null;(o.get(l)!==u||d===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&d!==h&&(d===null?i.delete(l):i.set(l,d))),!c&&!t.deleted&&mo(i,u);break}}}t=t.right}return a},SO=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const r=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===er){const n=t.content.key;r.has(n)?t.delete(e):r.add(n)}t=t.left}},RO=e=>{let t=0;return Ee(e.doc,r=>{let n=e._start,i=e._start,s=Ln();const o=bf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case er:mo(o,i.content);break;default:t+=zg(r,n,i,s,o),s=bf(o),n=i;break}i=i.right}}),t},OO=e=>{const t=new Set,r=e.doc;for(const[n,i]of e.afterState.entries()){const s=e.beforeState.get(n)||0;i!==s&&wg(e,r.store.clients.get(n),s,i,o=>{!o.deleted&&o.content.constructor===er&&o.constructor!==mn&&t.add(o.parent)})}Ee(r,n=>{ig(e,e.deleteSet,i=>{if(i instanceof mn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===er?t.add(s):SO(n,i)});for(const i of t)RO(i)})},Wg=(e,t,r)=>{const n=r,i=bf(t.currentAttributes),s=t.right;for(;r>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case ki:case bs:case ei:r<t.right.length&&Wi(e,ae(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e);break}t.forward()}s&&zg(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&fa(o._searchMarker,t.index,-n+r),t};class IO extends Dc{constructor(t,r,n){super(t,r),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,r=[];Ee(t,n=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(f={insert:u},i.size>0&&(f.attributes={},i.forEach((m,p)=>{m!==null&&(f.attributes[p]=m)}))),u="";break;case"retain":l>0&&(f={retain:l},bR(c)||(f.attributes=gR({},c))),l=0;break}f&&r.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case ki:case bs:this.adds(o)?this.deletes(o)||(d(),a="insert",u=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),l+=1);break;case ei:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),l+=o.length);break;case er:{const{key:f,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(f)??null;Gi(p,m)?m!==null&&o.delete(n):(a==="retain"&&d(),Gi(m,s.get(f)??null)?delete c[f]:c[f]=m)}}else if(this.deletes(o)){s.set(f,m);const p=i.get(f)??null;Gi(p,m)||(a==="retain"&&d(),c[f]=p)}else if(!o.deleted){s.set(f,m);const p=c[f];p!==void 0&&(Gi(p,m)?p!==null&&o.delete(n):(a==="retain"&&d(),m===null?delete c[f]:c[f]=m))}o.deleted||(a==="insert"&&d(),mo(i,o.content));break}}o=o.right}for(d();r.length>0;){const f=r[r.length-1];if(f.retain!==void 0&&f.attributes===void 0)r.pop();else break}}),this._delta=r}return this._delta}}class vi extends wr{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??xr(),this._length}_integrate(t,r){super._integrate(t,r);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new vi}clone(){const t=new vi;return t.applyDelta(this.toDelta()),t}_callObserver(t,r){super._callObserver(t,r);const n=new IO(this,t,r);zc(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??xr();let t="",r=this._start;for(;r!==null;)!r.deleted&&r.countable&&r.content.constructor===ei&&(t+=r.content.str),r=r.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:r=!0}={}){this.doc!==null?Ee(this.doc,n=>{const i=new Zf(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!r&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Qf(n,this,i,a,o.attributes||{})}else o.retain!==void 0?jg(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Wg(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,r,n){this.doc??xr();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let d=!1;s.forEach((m,p)=>{d=!0,h[p]=m});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const l=()=>{for(;c!==null;){if(fo(c,t)||r!==void 0&&fo(c,r))switch(c.content.constructor){case ei:{const h=s.get("ychange");t!==void 0&&!fo(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",n?n("removed",c.id):{type:"removed"})):r!==void 0&&!fo(c,r)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",n?n("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case ki:case bs:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,m)=>{d[m]=f})}i.push(h);break}case er:fo(c,t)&&(u(),mo(s,c.content));break}c=c.right}u()};return t||r?Ee(o,h=>{t&&zf(h,t),r&&zf(h,r),l()},"cleanup"):l(),i}insert(t,r,n){if(r.length<=0)return;const i=this.doc;i!==null?Ee(i,s=>{const o=Kc(s,this,t,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),Qf(s,this,o,r,n)}):this._pending.push(()=>this.insert(t,r,n))}insertEmbed(t,r,n){const i=this.doc;i!==null?Ee(i,s=>{const o=Kc(s,this,t,!n);Qf(s,this,o,r,n||{})}):this._pending.push(()=>this.insertEmbed(t,r,n||{}))}delete(t,r){if(r===0)return;const n=this.doc;n!==null?Ee(n,i=>{Wg(i,Kc(i,this,t,!0),r)}):this._pending.push(()=>this.delete(t,r))}format(t,r,n){if(r===0)return;const i=this.doc;i!==null?Ee(i,s=>{const o=Kc(s,this,t,!1);o.right!==null&&jg(s,this,o,r,n)}):this._pending.push(()=>this.format(t,r,n))}removeAttribute(t){this.doc!==null?Ee(this.doc,r=>{Hc(r,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,r){this.doc!==null?Ee(this.doc,n=>{Xf(n,this,t,r)}):this._pending.push(()=>this.setAttribute(t,r))}getAttribute(t){return Jf(this,t)}getAttributes(){return Ug(this)}_write(t){t.writeTypeRef(XO)}}const NO=e=>new vi;class th{constructor(t,r=()=>!0){this._filter=r,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??xr()}[Symbol.iterator](){return this}next(){let t=this._currentNode,r=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(r)))do if(r=t.content.type,!t.deleted&&(r.constructor===go||r.constructor===_s)&&r._start!==null)t=r._start;else for(;t!==null;){const n=t.next;if(n!==null){t=n;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class _s extends wr{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,r){super._integrate(t,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new _s}clone(){const t=new _s;return t.insert(0,this.toArray().map(r=>r instanceof wr?r.clone():r)),t}get length(){return this.doc??xr(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new th(this,t)}querySelector(t){t=t.toUpperCase();const n=new th(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),ps(new th(this,r=>r.nodeName&&r.nodeName.toUpperCase()===t))}_callObserver(t,r){zc(this,t,new MO(this,r,t))}toString(){return Ig(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,r={},n){const i=t.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),ha(this,s=>{i.insertBefore(s.toDOM(t,r,n),null)}),i}insert(t,r){this.doc!==null?Ee(this.doc,n=>{Lg(n,this,t,r)}):this._prelimContent.splice(t,0,...r)}insertAfter(t,r){if(this.doc!==null)Ee(this.doc,n=>{const i=t&&t instanceof wr?t._item:t;Wc(n,this,i,r)});else{const n=this._prelimContent,i=t===null?0:n.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw zi("Reference item not found");n.splice(i,0,...r)}}delete(t,r=1){this.doc!==null?Ee(this.doc,n=>{Mg(n,this,t,r)}):this._prelimContent.splice(t,r)}toArray(){return Og(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Ng(this,t)}slice(t=0,r=this.length){return Rg(this,t,r)}forEach(t){ha(this,t)}_write(t){t.writeTypeRef(ZO)}}const CO=e=>new _s;class go extends _s{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,r){super._integrate(t,r),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new go(this.nodeName)}clone(){const t=new go(this.nodeName),r=this.getAttributes();return _R(r,(n,i)=>{typeof n=="string"&&t.setAttribute(i,n)}),t.insert(0,this.toArray().map(n=>n instanceof wr?n.clone():n)),t}toString(){const t=this.getAttributes(),r=[],n=[];for(const a in t)n.push(a);n.sort();const i=n.length;for(let a=0;a<i;a++){const c=n[a];r.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=r.length>0?" "+r.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?Ee(this.doc,r=>{Hc(r,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,r){this.doc!==null?Ee(this.doc,n=>{Xf(n,this,t,r)}):this._prelimAttrs.set(t,r)}getAttribute(t){return Jf(this,t)}hasAttribute(t){return Pg(this,t)}getAttributes(t){return t?vO(this,t):Ug(this)}toDOM(t=document,r={},n){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return ha(this,o=>{i.appendChild(o.toDOM(t,r,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(JO),t.writeKey(this.nodeName)}}const LO=e=>new go(e.readKey());class MO extends Dc{constructor(t,r,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Yc extends po{constructor(t){super(),this.hookName=t}_copy(){return new Yc(this.hookName)}clone(){const t=new Yc(this.hookName);return this.forEach((r,n)=>{t.set(n,r)}),t}toDOM(t=document,r={},n){const i=r[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(s,this),s}_write(t){t.writeTypeRef(QO),t.writeKey(this.hookName)}}const UO=e=>new Yc(e.readKey());class qc extends vi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new qc}clone(){const t=new qc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,r,n){const i=t.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const r=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),r.push({nodeName:i,attrs:s})}r.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let n="";for(let i=0;i<r.length;i++){const s=r[i];n+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=t.insert;for(let i=r.length-1;i>=0;i--)n+=`</${r[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(tI)}}const PO=e=>new qc;class eh{constructor(t,r){this.id=t,this.length=r}get deleted(){throw Xn()}mergeWith(t){return!1}write(t,r,n){throw Xn()}integrate(t,r){throw Xn()}}const FO=0;class mn extends eh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,r){r>0&&(this.id.clock+=r,this.length-=r),_g(t.doc.store,this)}write(t,r){t.writeInfo(FO),t.writeLen(this.length-r)}getMissing(t,r){return null}}class da{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new da(this.content)}splice(t){throw Xn()}mergeWith(t){return!1}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeBuf(this.content)}getRef(){return 3}}const BO=e=>new da(e.readBuf());class pa{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new pa(this.len)}splice(t){const r=new pa(this.len-t);return this.len=t,r}mergeWith(t){return this.len+=t.len,!0}integrate(t,r){Pc(t.deleteSet,r.id.client,r.id.clock,this.len),r.markDeleted()}delete(t){}gc(t){}write(t,r){t.writeLen(this.len-r)}getRef(){return 1}}const $O=e=>new pa(e.readLen()),Hg=(e,t)=>new co({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class ma{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const r={};this.opts=r,t.gc||(r.gc=!1),t.autoLoad&&(r.autoLoad=!0),t.meta!==null&&(r.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ma(Hg(this.doc.guid,this.opts))}splice(t){throw Xn()}mergeWith(t){return!1}integrate(t,r){this.doc._item=r,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,r){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const DO=e=>new ma(Hg(e.readString(),e.readAny()));class bs{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new bs(this.embed)}splice(t){throw Xn()}mergeWith(t){return!1}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeJSON(this.embed)}getRef(){return 5}}const jO=e=>new bs(e.readJSON());class er{constructor(t,r){this.key=t,this.value=r}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new er(this.key,this.value)}splice(t){throw Xn()}mergeWith(t){return!1}integrate(t,r){const n=r.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,r){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const zO=e=>new er(e.readKey(),e.readJSON());class Vc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Vc(this.arr)}splice(t){const r=new Vc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),r}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){const n=this.arr.length;t.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const WO=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++){const i=e.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new Vc(r)},HO=Uc("node_env")==="development";class ws{constructor(t){this.arr=t,HO&&Vm(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ws(this.arr)}splice(t){const r=new ws(this.arr.slice(t));return this.arr=this.arr.slice(0,t),r}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){const n=this.arr.length;t.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const GO=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new ws(r)};class ei{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ei(this.str)}splice(t){const r=new ei(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"�",r.str="�"+r.str.slice(1)),r}mergeWith(t){return this.str+=t.str,!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeString(r===0?this.str:this.str.slice(r))}getRef(){return 4}}const KO=e=>new ei(e.readString()),YO=[xO,TO,NO,LO,CO,UO,PO],qO=0,VO=1,XO=2,JO=3,ZO=4,QO=5,tI=6;class ki{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ki(this.type._copy())}splice(t){throw Xn()}mergeWith(t){return!1}integrate(t,r){this.type._integrate(t.doc,r)}delete(t){let r=this.type._start;for(;r!==null;)r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t),r=r.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let r=this.type._start;for(;r!==null;)r.gc(t,!0),r=r.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,r){this.type._write(t)}getRef(){return 7}}const eI=e=>new ki(YO[e.readTypeRef()](e)),Xc=(e,t,r)=>{const{client:n,clock:i}=t.id,s=new rr(ae(n,i+r),t,ae(n,i+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=ae(t.redone.client,t.redone.clock+r)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=r,s};class rr extends eh{constructor(t,r,n,i,s,o,a,c){super(t,c.getLength()),this.origin=n,this.left=r,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Cm:0}set marker(t){(this.info&vf)>0!==t&&(this.info^=vf)}get marker(){return(this.info&vf)>0}get keep(){return(this.info&Nm)>0}set keep(t){this.keep!==t&&(this.info^=Nm)}get countable(){return(this.info&Cm)>0}get deleted(){return(this.info&Ef)>0}set deleted(t){this.deleted!==t&&(this.info^=Ef)}markDeleted(){this.info|=Ef}getMissing(t,r){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=lr(r,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=lr(r,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===uo&&this.id.client!==this.parent.client&&this.parent.clock>=lr(r,this.parent.client))return this.parent.client;if(this.origin&&(this.left=bg(t,r,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Wi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===mn||this.right&&this.right.constructor===mn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===rr?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===rr&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===uo){const n=Hf(r,this.parent);n.constructor===mn?this.parent=null:this.parent=n.content.type}return null}integrate(t,r){if(r>0&&(this.id.clock+=r,this.left=bg(t,t.doc.store,ae(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(r),this.length-=r),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Fc(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,s.clear();else if(Fc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Hf(t.doc.store,i.origin)))s.has(Hf(t.doc.store,i.origin))||(n=i,s.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),_g(t.doc.store,this),this.content.integrate(t,this),vg(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new mn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:ae(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Fc(t.origin,this.lastId)&&this.right===t&&Fc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const r=this.parent._searchMarker;return r&&r.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const r=this.parent;this.countable&&this.parentSub===null&&(r._length-=this.length),this.markDeleted(),Pc(t.deleteSet,this.id.client,this.id.clock,this.length),vg(t,r,this.parentSub),this.content.delete(t)}}gc(t,r){if(!this.deleted)throw Jn();this.content.gc(t),r?oO(t,this,new mn(this.id,this.length)):this.content=new pa(this.length)}write(t,r){const n=r>0?ae(this.id.client,this.id.clock+r-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Rc|(n===null?0:en)|(i===null?0:bi)|(s===null?0:ra);if(t.writeInfo(o),n!==null&&t.writeLeftID(n),i!==null&&t.writeRightID(i),n===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=sO(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===uo?(t.writeParentInfo(!1),t.writeLeftID(a)):Jn();s!==null&&t.writeString(s)}this.content.write(t,r)}}const Gg=(e,t)=>rI[t&Rc](e),rI=[()=>{Jn()},$O,WO,BO,KO,jO,zO,eI,GO,DO,()=>{Jn()}],nI=10;class gn extends eh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,r){Jn()}write(t,r){t.writeInfo(nI),de(t.restEncoder,this.length-r)}getMissing(t,r){return null}}const Kg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof to<"u"?to:{},Yg="__ $YJS$ __";Kg[Yg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Kg[Yg]=!0;let qg=!1;const sn=new co;function Vg(e,t,r){const n=sn.getMap();if(!n.has(e))switch(t){case 0:case 1:n.set(e,r);break}}function iI(e,t){Vg(e,0,t)}function rh(e,t){const r=new vi(t);Vg(e,1,r)}function sI(e,t){sn.getMap().set(e,t)}function oI(e,t){const r=sn.getMap(),n=new vi(t);r.set(e,n)}function Xg(e,t){const r=sn.getMap();function n(i){const s=r.get(e);for(let o=0;o<i.length;++o)(i[o].target===r||i[o].target===s)&&t(s)}return r.has(e)&&t(r.get(e)),r.observeDeep(n),()=>{r.observeDeep(n)}}function aI(e,t){return Xg(e,r=>{xt(r)&&t(r)})}function Jg(e,t){return Xg(e,r=>{r instanceof vi&&t(r.toJSON())})}const Es=Xs("modem",["second"],e=>{if(Es.session(e))switch(e.target){case"second":!qg&&e.data%2===0&&Es.emit(e.player,"modem:join");break;case"join":e.sender!==Es.id()&&Es.reply(e,"joinack",Am(rO(sn)));break;case"joinack":e.sender!==Es.id()&&(qg=!0,fg(sn,Ac(e.data),sn));break;case"sync":{e.sender!==Es.id()&&w(e.data)&&fg(sn,Ac(e.data),sn);break}}});function Zg(e,t){t!==sn&&Es.emit("","modem:sync",Am(e))}sn.on("update",Zg),sn.on("destroy",()=>{sn.off("update",Zg)});function Qg(e,t){return e%t}function ty(e,t){return Math.floor(e/t)}function cI(e,t){return{x:Qg(e,t),y:ty(e,t)}}function ey(e,t){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function jr(e,t){return e.x+e.y*t}function yo(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function nh(e,t,r,n,i,s){return e>=s&&e<=n&&t>=r&&t<=i}function ry(e,t,r,n){const i=[],s=Math.min(e,r),o=Math.max(e,r),a=Math.min(t,n),c=Math.max(t,n);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}function ny(e,t,r,n){const i=[],s=Math.abs(r-e),o=Math.abs(n-t),a=e<r?1:-1,c=t<n?1:-1;let u=s-o;for(i.push({x:e,y:t});e!==r||t!==n;){const l=2*u;l>-o&&(u-=o,e+=a),l<s&&(u+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const iy="176",lI="",Mn="srgb",sy="srgb-linear",oy="linear",ih="srgb";function Un(e,t,r){return Math.max(t,Math.min(r,e))}function uI(e,t){return(e%t+t)%t}function sh(e,t,r){return(1-r)*e+r*t}class ga{constructor(t=0,r=0){ga.prototype.isVector2=!0,this.x=t,this.y=r}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,r){return this.x=t,this.y=r,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,r){switch(t){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this}addScaledVector(t,r){return this.x+=t.x*r,this.y+=t.y*r,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const r=this.x,n=this.y,i=t.elements;return this.x=i[0]*r+i[3]*n+i[6],this.y=i[1]*r+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,r){return this.x=Un(this.x,t.x,r.x),this.y=Un(this.y,t.y,r.y),this}clampScalar(t,r){return this.x=Un(this.x,t,r),this.y=Un(this.y,t,r),this}clampLength(t,r){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Un(n,t,r))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const r=Math.sqrt(this.lengthSq()*t.lengthSq());if(r===0)return Math.PI/2;const n=this.dot(t)/r;return Math.acos(Un(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const r=this.x-t.x,n=this.y-t.y;return r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,r){return this.x+=(t.x-this.x)*r,this.y+=(t.y-this.y)*r,this}lerpVectors(t,r,n){return this.x=t.x+(r.x-t.x)*n,this.y=t.y+(r.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,r=0){return this.x=t[r],this.y=t[r+1],this}toArray(t=[],r=0){return t[r]=this.x,t[r+1]=this.y,t}fromBufferAttribute(t,r){return this.x=t.getX(r),this.y=t.getY(r),this}rotateAround(t,r){const n=Math.cos(r),i=Math.sin(r),s=this.x-t.x,o=this.y-t.y;return this.x=s*n-o*i+t.x,this.y=s*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ya{constructor(t,r,n,i,s,o,a,c,u){ya.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,r,n,i,s,o,a,c,u)}set(t,r,n,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=r,l[4]=s,l[5]=c,l[6]=n,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const r=this.elements,n=t.elements;return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],this}extractBasis(t,r,n){return t.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const r=t.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,r){const n=t.elements,i=r.elements,s=this.elements,o=n[0],a=n[3],c=n[6],u=n[1],l=n[4],h=n[7],d=n[2],f=n[5],m=n[8],p=i[0],g=i[3],y=i[6],b=i[1],S=i[4],T=i[7],x=i[2],N=i[5],R=i[8];return s[0]=o*p+a*b+c*x,s[3]=o*g+a*S+c*N,s[6]=o*y+a*T+c*R,s[1]=u*p+l*b+h*x,s[4]=u*g+l*S+h*N,s[7]=u*y+l*T+h*R,s[2]=d*p+f*b+m*x,s[5]=d*g+f*S+m*N,s[8]=d*y+f*T+m*R,this}multiplyScalar(t){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=t,r[4]*=t,r[7]*=t,r[2]*=t,r[5]*=t,r[8]*=t,this}determinant(){const t=this.elements,r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return r*o*l-r*a*u-n*s*l+n*a*c+i*s*u-i*o*c}invert(){const t=this.elements,r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,d=a*c-l*s,f=u*s-o*c,m=r*h+n*d+i*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=h*p,t[1]=(i*u-l*n)*p,t[2]=(a*n-i*o)*p,t[3]=d*p,t[4]=(l*r-i*c)*p,t[5]=(i*s-a*r)*p,t[6]=f*p,t[7]=(n*c-u*r)*p,t[8]=(o*r-n*s)*p,this}transpose(){let t;const r=this.elements;return t=r[1],r[1]=r[3],r[3]=t,t=r[2],r[2]=r[6],r[6]=t,t=r[5],r[5]=r[7],r[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const r=this.elements;return t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8],this}setUvTransform(t,r,n,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(n*c,n*u,-n*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+r,0,0,1),this}scale(t,r){return this.premultiply(oh.makeScale(t,r)),this}rotate(t){return this.premultiply(oh.makeRotation(-t)),this}translate(t,r){return this.premultiply(oh.makeTranslation(t,r)),this}makeTranslation(t,r){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,r,0,0,1),this}makeRotation(t){const r=Math.cos(t),n=Math.sin(t);return this.set(r,-n,0,n,r,0,0,0,1),this}makeScale(t,r){return this.set(t,0,0,0,r,0,0,0,1),this}equals(t){const r=this.elements,n=t.elements;for(let i=0;i<9;i++)if(r[i]!==n[i])return!1;return!0}fromArray(t,r=0){for(let n=0;n<9;n++)this.elements[n]=t[n+r];return this}toArray(t=[],r=0){const n=this.elements;return t[r]=n[0],t[r+1]=n[1],t[r+2]=n[2],t[r+3]=n[3],t[r+4]=n[4],t[r+5]=n[5],t[r+6]=n[6],t[r+7]=n[7],t[r+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const oh=new ya,ay=new ya().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),cy=new ya().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function fI(){const e={enabled:!0,workingColorSpace:sy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===ih&&(i.r=_o(i.r),i.g=_o(i.g),i.b=_o(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===ih&&(i.r=bo(i.r),i.g=bo(i.g),i.b=bo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===lI?oy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],n=[.3127,.329];return e.define({[sy]:{primaries:t,whitePoint:n,transfer:oy,toXYZ:ay,fromXYZ:cy,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:Mn},outputColorSpaceConfig:{drawingBufferColorSpace:Mn}},[Mn]:{primaries:t,whitePoint:n,transfer:ih,toXYZ:ay,fromXYZ:cy,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:Mn}}}),e}const Pn=fI();function _o(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function bo(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const ly={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ki={h:0,s:0,l:0},Jc={h:0,s:0,l:0};function ah(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*6*(2/3-r):e}class ch{constructor(t,r,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,r,n)}set(t,r,n){if(r===void 0&&n===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,r,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,r=Mn){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Pn.toWorkingColorSpace(this,r),this}setRGB(t,r,n,i=Pn.workingColorSpace){return this.r=t,this.g=r,this.b=n,Pn.toWorkingColorSpace(this,i),this}setHSL(t,r,n,i=Pn.workingColorSpace){if(t=uI(t,1),r=Un(r,0,1),n=Un(n,0,1),r===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+r):n+r-n*r,o=2*n-s;this.r=ah(o,s,t+1/3),this.g=ah(o,s,t),this.b=ah(o,s,t-1/3)}return Pn.toWorkingColorSpace(this,i),this}setStyle(t,r=Mn){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,r);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,r);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,r);if(o===6)return this.setHex(parseInt(s,16),r);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,r);return this}setColorName(t,r=Mn){const n=ly[t.toLowerCase()];return n!==void 0?this.setHex(n,r):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=_o(t.r),this.g=_o(t.g),this.b=_o(t.b),this}copyLinearToSRGB(t){return this.r=bo(t.r),this.g=bo(t.g),this.b=bo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Mn){return Pn.fromWorkingColorSpace(Ar.copy(this),t),Math.round(Un(Ar.r*255,0,255))*65536+Math.round(Un(Ar.g*255,0,255))*256+Math.round(Un(Ar.b*255,0,255))}getHexString(t=Mn){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,r=Pn.workingColorSpace){Pn.fromWorkingColorSpace(Ar.copy(this),r);const n=Ar.r,i=Ar.g,s=Ar.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let c,u;const l=(a+o)/2;if(a===o)c=0,u=0;else{const h=o-a;switch(u=l<=.5?h/(o+a):h/(2-o-a),o){case n:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-n)/h+2;break;case s:c=(n-i)/h+4;break}c/=6}return t.h=c,t.s=u,t.l=l,t}getRGB(t,r=Pn.workingColorSpace){return Pn.fromWorkingColorSpace(Ar.copy(this),r),t.r=Ar.r,t.g=Ar.g,t.b=Ar.b,t}getStyle(t=Mn){Pn.fromWorkingColorSpace(Ar.copy(this),t);const r=Ar.r,n=Ar.g,i=Ar.b;return t!==Mn?`color(${t} ${r.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(r*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,r,n){return this.getHSL(Ki),this.setHSL(Ki.h+t,Ki.s+r,Ki.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,r){return this.r=t.r+r.r,this.g=t.g+r.g,this.b=t.b+r.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,r){return this.r+=(t.r-this.r)*r,this.g+=(t.g-this.g)*r,this.b+=(t.b-this.b)*r,this}lerpColors(t,r,n){return this.r=t.r+(r.r-t.r)*n,this.g=t.g+(r.g-t.g)*n,this.b=t.b+(r.b-t.b)*n,this}lerpHSL(t,r){this.getHSL(Ki),t.getHSL(Jc);const n=sh(Ki.h,Jc.h,r),i=sh(Ki.s,Jc.s,r),s=sh(Ki.l,Jc.l,r);return this.setHSL(n,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const r=this.r,n=this.g,i=this.b,s=t.elements;return this.r=s[0]*r+s[3]*n+s[6]*i,this.g=s[1]*r+s[4]*n+s[7]*i,this.b=s[2]*r+s[5]*n+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,r=0){return this.r=t[r],this.g=t[r+1],this.b=t[r+2],this}toArray(t=[],r=0){return t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t}fromBufferAttribute(t,r){return this.r=t.getX(r),this.g=t.getY(r),this.b=t.getZ(r),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ar=new ch;ch.NAMES=ly,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:iy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=iy),new ga,new ga;function ze(e,t,r){return Math.max(t,Math.min(r,e))}function uy(e){return e/180*Math.PI}function fy(e){return e*180/Math.PI}const hI=D0("089fad0j9awfem09wavefc09uwaef");function dI(){return hI()}function pI(e){return D0(e)()}function yn(e,t){const r=Math.min(e,t),i=Math.max(e,t)-r+1;return r+Math.floor(dI()*i)}function hy(e,t,r){const n=Math.min(t,r),s=Math.max(t,r)-n+1;return n+Math.floor(pI(e)*s)}function dy(e,t,r){typeof r!="number"&&(r=1);const n=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=r)n.push(o);return n}function mI(e){return e[yn(0,e.length-1)]}function gI(e,t){return t[hy(e,0,t.length-1)]}function _n(...e){return mI(e.flat())}function yI(e,...t){return gI(e,t.flat())}function _I(e){return[...new Set(e)].filter(w)}function vs(e){return w(e)&&w(e.x)&&w(e.y)}function Fe(e,t){switch(t){case bt.NORTH:--e.y;break;case bt.SOUTH:++e.y;break;case bt.WEST:--e.x;break;case bt.EAST:++e.x;break}return e}function lh(e,t){return e<0?bt.WEST:e>0?bt.EAST:t<0?bt.NORTH:t>0?bt.SOUTH:bt.IDLE}function Fn(e,t){return lh(t.x-e.x,t.y-e.y)}const uh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER",within:"WITHIN",awayby:"AWAYBY"};function on(e){return he(e)&&py(e[0])}function py(e){return w(bt[e])&&_t(e)}function my(e){const t=bt[e];return w(t)?t:bt.IDLE}function Zc(e){if(_t(e))return uh[zt(e)]}function bI(e){if(on(e))return e;if(py(e))return[e];const t=Zc(e);if(w(t))return[t]}function gy(e){const t=k.words[e],r=bI(t);return on(r)?[r,e+1]:[void 0,e]}function yy(e){var i,s;const t=[];let[r,n]=gy(e);for(;on(r);){switch(t.push(...r),r[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[u,l,h]=ft(k.words,n,[J.NUMBER,J.NUMBER]);t.push(u,l),n=h;break}case"FLEE":case"FIND":{const[u,l]=ft(k.words,n,[J.KIND]);console.info("kind",u),n=l;break}case"TO":{const[u,l,h]=ft(k.words,n,[J.DIR,J.DIR]),d=((i=k.element)==null?void 0:i.x)??0,f=((s=k.element)==null?void 0:s.y)??0;u.destpt.x-=d,u.destpt.y-=f,l.destpt.x-=d,l.destpt.y-=f,t.push(d+u.destpt.x+l.destpt.x,f+u.destpt.y+l.destpt.y),n=h;break}case"WITHIN":case"AWAYBY":{const[u,l]=ft(k.words,n,[J.NUMBER]);t.push(u),n=l;break}}const o=n;switch(r[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":case"WITHIN":case"AWAYBY":break;default:return[t,n]}const[a,c]=gy(o);r=a,n=c}return t.length?[t,n]:[void 0,e]}function wI(e){return w(e)&&e<Kt.ONBLACK?e:void 0}function fh(e){return w(e)&&e>Kt.WHITE&&e<Kt.ONCLEAR?e-Kt.ONBLACK:void 0}const _a={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Ir(e){return he(e)&&_y(e[0])}function EI(e){return Ir(e)&&e[0].startsWith("ON")}function _y(e){return w(Kt[e])&&_t(e)}function ba(e){if(_t(e))return _a[zt(e)]}function wo(e,t){return[w(e)?`${Kt[e]}`:void 0,w(t)?`ON${Kt[t]}`:void 0].filter(w)}function Qc(e){return e.map(t=>Kt[t]).find(t=>w(t)&&t<Kt.ONBLACK)}function tl(e){return e.map(t=>Kt[t]).find(t=>w(t)&&t>=Kt.ONBLACK)}function vI(e){if(Ir(e))return e;if(_y(e))return[e];const t=ba(e);if(w(t))return[t]}function by(e){const t=k.words[e],r=vI(t);return Ir(r)?[r,e+1]:[void 0,e]}function el(e){const t=[];let r=e;const n=parseFloat(k.words[e]);if(xt(n))return[wo(n,void 0),e+1];const[i,s]=by(e);Ir(i)&&(t.push(...i),r=s);const[o,a]=by(s);return EI(o)&&(t.push(...o),r=a),t.length?[t,r]:[void 0,e]}function wy(e){const t={};for(let r=0;r<e.length;++r){const n=e[r],i=Kt[n];w(i)&&(i<Kt.ONBLACK?t.color=i:t.bg=fh(i))}return t}var Ey={exports:{}},hh={exports:{}},vy;function kI(){return vy||(vy=1,function(e,t){(function(r,n){e.exports=n()})(Qe,function(){function r(p){return!isNaN(parseFloat(p))&&isFinite(p)}function n(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(p){if(p)for(var g=0;g<l.length;g++)p[l[g]]!==void 0&&this["set"+n(l[g])](p[l[g]])}h.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof h)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new h(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",g=this.getLineNumber()||"",y=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+g+":"+y+")":"[eval]:"+g+":"+y:b?b+" ("+p+":"+g+":"+y+")":p+":"+g+":"+y}},h.fromString=function(g){var y=g.indexOf("("),b=g.lastIndexOf(")"),S=g.substring(0,y),T=g.substring(y+1,b).split(","),x=g.substring(b+1);if(x.indexOf("@")===0)var N=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(x,""),R=N[1],B=N[2],M=N[3];return new h({functionName:S,args:T||void 0,fileName:R,lineNumber:B||void 0,columnNumber:M||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+n(s[d])]=i(s[d]),h.prototype["set"+n(s[d])]=function(p){return function(g){this[p]=!!g}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+n(o[f])]=i(o[f]),h.prototype["set"+n(o[f])]=function(p){return function(g){if(!r(g))throw new TypeError(p+" must be a Number");this[p]=Number(g)}}(o[f]);for(var m=0;m<a.length;m++)h.prototype["get"+n(a[m])]=i(a[m]),h.prototype["set"+n(a[m])]=function(p){return function(g){this[p]=String(g)}}(a[m]);return h})}(hh)),hh.exports}(function(e,t){(function(r,n){e.exports=n(kI())})(Qe,function(n){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),m=d&&h||void 0,p=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new n({functionName:m,fileName:p,lineNumber:f[1],columnNumber:f[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new n({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=l.match(h),f=d&&d[1]?d[1]:void 0,m=this.extractLocation(l.replace(h,""));return new n({functionName:f,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],d=2,f=l.length;d<f;d+=2){var m=u.exec(l[d]);m&&h.push(new n({fileName:m[2],lineNumber:m[1],source:l[d]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],d=0,f=l.length;d<f;d+=2){var m=u.exec(l[d]);m&&h.push(new n({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:l[d]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",m=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;f.match(/\(([^)]*)\)/)&&(p=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new n({functionName:m,args:g,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:l})},this)}}})})(Ey);var xI=Ey.exports,AI=qs(xI);const Nt=60,Qt=25,dh=Nt*Qt;var Tt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(Tt||{});const ph=14,rl=3,ks=8,xs=14,nl=16,TI=16,SI=16;var il=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(il||{});function wa(e,t){return new Array(e).fill(t)}function RI(e,t,r,n,i,s=0){const o=n*i;return{id:`tiles:${e}:${t}`,type:1,tag:r,width:n,height:i,char:wa(o,0),color:wa(o,0),bg:wa(o,s),wall:wa(o,0)}}function OI(e,t,r,n=1,i=15){return{id:`sprites:${e}:${t}:${r}`,x:0,y:0,char:n,color:i,bg:Kt.ONCLEAR}}function II(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function NI(e,t,r,n,i=0){const s=r*n;return{id:`dither:${e}:${t}`,type:3,width:r,height:n,alphas:wa(s,i)}}function CI(e,t,r,n){return{id:`media:${e}:${t}`,type:4,mime:r,media:n}}function LI(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function ky(e,t){return`${e}:${t}`}const MI=1,UI=16,PI=256;var Nr=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Nr||{});const ri=!!JSON.parse("false"),FI=!!JSON.parse("false");JSON.parse("false");const xy=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const As={HALT_AT_COUNT:256},lt=Xs("SOFTWARE");function xi(e){const t={},r={everytick(){},aftertick(){},listcommands(){return Br(t)},...e,getcommand(n){return t[n]},command(n,i){return t[n]=i,r}};return r}function Re(e){return`${e??""}`}function Ea(e,t){const r=parseFloat(Re(e));return isNaN(r)?t:r}function zr(e,t,r,n){const[i,s]=ft(n,0,[J.NUMBER_OR_STRING,J.MAYBE_NUMBER_OR_STRING]);tm(lt,e,t,r,i,s)}const BI=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function mh(e,t,r){const[n,i]=ft(r,0,[J.NUMBER_OR_STRING]);if(xt(n))nf(lt,e,t,"volume",n);else if(BI.includes(zt(n))){const[s,o]=ft(r,i,[J.NUMBER_OR_STRING,J.MAYBE_NUMBER_OR_STRING]);tm(lt,e,t,n,s,o)}else{const[s]=ft(r,i,[J.MAYBE_NUMBER_OR_STRING]);if(xt(s)){const o=r.length-i,a=new Array(o).fill(J.NUMBER),c=ft(r,i,a).slice(0,o),u=c.length===1?c[0]:c;nf(lt,e,t,n,u)}else{const[o]=ft(r,i,[J.MAYBE_NUMBER_OR_STRING]);nf(lt,e,t,n,o)}}}let Ay="en-US-GuyNeural";function Yi(e,t){var n;const[r]=ft(e,0,[J.MAYBE_NAME]);zT(lt,k.elementfocus,((n=k.board)==null?void 0:n.id)??"",r??"",t)}const sl=xi().command("talk",(e,t)=>{const[r]=ft(t,0,[J.ANY]);switch(zt(r)){default:ET(lt,k.elementfocus);break;case"stop":vT(lt,k.elementfocus);break}return 0}).command("media",(e,t)=>{const[r]=ft(t,0,[J.ANY]);switch(zt(r)){default:kT(lt,k.elementfocus);break;case"stop":xT(lt,k.elementfocus);break}return 0}).command("tts",(e,t)=>{const r=t.map(Re).join("");return DT(lt,k.elementfocus,Ay,r),0}).command("ttsvoice",(e,t)=>(Ay=t.map(Re).join(""),0)).command("bpm",(e,t)=>{const[r]=ft(t,0,[J.NUMBER]);return WT(lt,k.elementfocus,r),0}).command("vol",(e,t)=>{const[r]=ft(t,0,[J.NUMBER]);return HT(lt,k.elementfocus,r),0}).command("bgvol",(e,t)=>{const[r]=ft(t,0,[J.NUMBER]);return GT(lt,k.elementfocus,r),0}).command("ttsvol",(e,t)=>{const[r]=ft(t,0,[J.NUMBER]);return KT(lt,k.elementfocus,r),0}).command("play",(e,t)=>{var n;const[r]=ft(t,0,[J.MAYBE_NAME]);return jT(lt,k.elementfocus,((n=k.board)==null?void 0:n.id)??"",r??""),0}).command("bgplay",(e,t)=>(Yi(t,""),0)).command("bgplayon64n",(e,t)=>(Yi(t,"@64n"),0)).command("bgplayon32n",(e,t)=>(Yi(t,"@32n"),0)).command("bgplayon16n",(e,t)=>(Yi(t,"@16n"),0)).command("bgplayon8n",(e,t)=>(Yi(t,"@8n"),0)).command("bgplayon4n",(e,t)=>(Yi(t,"@4n"),0)).command("bgplayon2n",(e,t)=>(Yi(t,"@2n"),0)).command("bgplayon1n",(e,t)=>(Yi(t,"@1m"),0)).command("synth",(e,t)=>{for(let r=0;r<4;++r)mh(k.elementfocus,r,t);return 0}).command("echo",(e,t)=>{for(let r=0;r<2;++r)zr(k.elementfocus,r,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let r=0;r<2;++r)zr(k.elementfocus,r,"fc",t);return 0}).command("phaser",(e,t)=>{for(let r=0;r<2;++r)zr(k.elementfocus,r,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let r=0;r<2;++r)zr(k.elementfocus,r,"reverb",t);return 0}).command("distort",(e,t)=>{for(let r=0;r<2;++r)zr(k.elementfocus,r,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let r=0;r<2;++r)zr(k.elementfocus,r,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let r=0;r<2;++r)zr(k.elementfocus,r,"autowah",t);return 0});for(let e=0;e<4;++e)sl.command(`synth${e+1}`,(t,r)=>(mh(k.elementfocus,e,r),0));sl.command("synth5",(e,t)=>{for(let r=4;r<8;++r)mh(k.elementfocus,r,t);return 0});for(let e=0;e<3;++e){const t=e+1;sl.command(`echo${t}`,(r,n)=>(zr(k.elementfocus,e,"echo",n),0)).command(`fcrush${t}`,(r,n)=>(zr(k.elementfocus,e,"fcrush",n),0)).command(`phaser${t}`,(r,n)=>(zr(k.elementfocus,e,"phaser",n),0)).command(`reverb${t}`,(r,n)=>(zr(k.elementfocus,e,"reverb",n),0)).command(`distort${t}`,(r,n)=>(zr(k.elementfocus,e,"distort",n),0)).command(`vibrato${t}`,(r,n)=>(zr(k.elementfocus,e,"vibrato",n),0)).command(`autowah${t}`,(r,n)=>(zr(k.elementfocus,e,"autowah",n),0))}var gh;try{gh=new TextDecoder}catch{}var Ot,ni,Q=0,ve={},ce,qi,bn=0,ii=0,ur,Ai,Wr=[],oe,Ty={useRecords:!1,mapsAsObjects:!0};class Sy{}const Ry=new Sy;Ry.name="MessagePack 0xC1";var Vi=!1,Oy=2,$I;try{new Function("")}catch{Oy=1/0}class va{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,r){if(Ot)return Wy(()=>(Eh(),this?this.unpack(t,r):va.prototype.unpack.call(Ty,t,r)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof tr<"u"?tr.from(t):new Uint8Array(t)),typeof r=="object"?(ni=r.end||t.length,Q=r.start||0):(Q=0,ni=r>-1?r:t.length),ii=0,qi=null,ur=null,Ot=t;try{oe=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(n){throw Ot=null,t instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof va){if(ve=this,this.structures)return ce=this.structures,ol(r);(!ce||ce.length>0)&&(ce=[])}else ve=Ty,(!ce||ce.length>0)&&(ce=[]);return ol(r)}unpackMultiple(t,r){let n,i=0;try{Vi=!0;let s=t.length,o=this?this.unpack(t,s):al.unpack(t,s);if(r){if(r(o,i,Q)===!1)return;for(;Q<s;)if(i=Q,r(ol(),i,Q)===!1)return}else{for(n=[o];Q<s;)i=Q,n.push(ol());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{Vi=!1,Eh()}}_mergeStructures(t,r){t=t||[],Object.isFrozen(t)&&(t=t.map(n=>n.slice(0)));for(let n=0,i=t.length;n<i;n++){let s=t[n];s&&(s.isShared=!0,n>=32&&(s.highByte=n-32>>5))}t.sharedLength=t.length;for(let n in r||[])if(n>=0){let i=t[n],s=r[n];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[n]=i),t[n]=s)}return this.structures=t}decode(t,r){return this.unpack(t,r)}}function ol(e){try{if(!ve.trusted&&!Vi){let r=ce.sharedLength||0;r<ce.length&&(ce.length=r)}let t;if(ve.randomAccessStructure&&Ot[Q]<64&&Ot[Q]>=32&&$I||(t=We()),ur&&(Q=ur.postBundlePosition,ur=null),Vi&&(ce.restoreStructures=null),Q==ni)ce&&ce.restoreStructures&&Iy(),ce=null,Ot=null,Ai&&(Ai=null);else{if(Q>ni)throw new Error("Unexpected end of MessagePack data");if(!Vi){let r;try{r=JSON.stringify(t,(n,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return t}catch(t){throw ce&&ce.restoreStructures&&Iy(),Eh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||Q>ni)&&(t.incomplete=!0),t}}function Iy(){for(let e in ce.restoreStructures)ce[e]=ce.restoreStructures[e];ce.restoreStructures=null}function We(){let e=Ot[Q++];if(e<160)if(e<128){if(e<64)return e;{let t=ce[e&63]||ve.getStructures&&Cy()[e&63];return t?(t.read||(t.read=yh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,ve.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=By();n==="__proto__"&&(n="__proto_"),t[n]=We()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(We(),We());return t}else{e-=144;let t=new Array(e);for(let r=0;r<e;r++)t[r]=We();return ve.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(ii>=Q)return qi.slice(Q-bn,(Q+=t)-bn);if(ii==0&&ni<140){let r=t<16?bh(t):Uy(t);if(r!=null)return r}return _h(t)}else{let t;switch(e){case 192:return null;case 193:return ur?(t=We(),t>0?ur[1].slice(ur.position1,ur.position1+=t):ur[0].slice(ur.position0,ur.position0-=t)):Ry;case 194:return!1;case 195:return!0;case 196:if(t=Ot[Q++],t===void 0)throw new Error("Unexpected end of buffer");return wh(t);case 197:return t=oe.getUint16(Q),Q+=2,wh(t);case 198:return t=oe.getUint32(Q),Q+=4,wh(t);case 199:return Ts(Ot[Q++]);case 200:return t=oe.getUint16(Q),Q+=2,Ts(t);case 201:return t=oe.getUint32(Q),Q+=4,Ts(t);case 202:if(t=oe.getFloat32(Q),ve.useFloat32>2){let r=vh[(Ot[Q]&127)<<1|Ot[Q+1]>>7];return Q+=4,(r*t+(t>0?.5:-.5)>>0)/r}return Q+=4,t;case 203:return t=oe.getFloat64(Q),Q+=8,t;case 204:return Ot[Q++];case 205:return t=oe.getUint16(Q),Q+=2,t;case 206:return t=oe.getUint32(Q),Q+=4,t;case 207:return ve.int64AsType==="number"?(t=oe.getUint32(Q)*4294967296,t+=oe.getUint32(Q+4)):ve.int64AsType==="string"?t=oe.getBigUint64(Q).toString():ve.int64AsType==="auto"?(t=oe.getBigUint64(Q),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=oe.getBigUint64(Q),Q+=8,t;case 208:return oe.getInt8(Q++);case 209:return t=oe.getInt16(Q),Q+=2,t;case 210:return t=oe.getInt32(Q),Q+=4,t;case 211:return ve.int64AsType==="number"?(t=oe.getInt32(Q)*4294967296,t+=oe.getUint32(Q+4)):ve.int64AsType==="string"?t=oe.getBigInt64(Q).toString():ve.int64AsType==="auto"?(t=oe.getBigInt64(Q),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=oe.getBigInt64(Q),Q+=8,t;case 212:if(t=Ot[Q++],t==114)return Dy(Ot[Q++]&63);{let r=Wr[t];if(r)return r.read?(Q++,r.read(We())):r.noBuffer?(Q++,r()):r(Ot.subarray(Q,++Q));throw new Error("Unknown extension "+t)}case 213:return t=Ot[Q],t==114?(Q++,Dy(Ot[Q++]&63,Ot[Q++])):Ts(2);case 214:return Ts(4);case 215:return Ts(8);case 216:return Ts(16);case 217:return t=Ot[Q++],ii>=Q?qi.slice(Q-bn,(Q+=t)-bn):jI(t);case 218:return t=oe.getUint16(Q),Q+=2,ii>=Q?qi.slice(Q-bn,(Q+=t)-bn):zI(t);case 219:return t=oe.getUint32(Q),Q+=4,ii>=Q?qi.slice(Q-bn,(Q+=t)-bn):WI(t);case 220:return t=oe.getUint16(Q),Q+=2,Ly(t);case 221:return t=oe.getUint32(Q),Q+=4,Ly(t);case 222:return t=oe.getUint16(Q),Q+=2,My(t);case 223:return t=oe.getUint32(Q),Q+=4,My(t);default:if(e>=224)return e-256;if(e===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+e)}}}const DI=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function yh(e,t){function r(){if(r.count++>Oy){let i=e.read=new Function("r","return function(){return "+(ve.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":DI.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(We);return e.highByte===0&&(e.read=Ny(t,e.read)),i()}let n={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),n[o]=We()}return ve.freezeData?Object.freeze(n):n}return r.count=0,e.highByte===0?Ny(t,r):r}const Ny=(e,t)=>function(){let r=Ot[Q++];if(r===0)return t();let n=e<32?-(e+(r<<5)):e+(r<<5),i=ce[n]||Cy()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=yh(i,e)),i.read()};function Cy(){let e=Wy(()=>(Ot=null,ve.getStructures()));return ce=ve._mergeStructures(e,ce)}var _h=ka,jI=ka,zI=ka,WI=ka;function ka(e){let t;if(e<16&&(t=bh(e)))return t;if(e>64&&gh)return gh.decode(Ot.subarray(Q,Q+=e));const r=Q+e,n=[];for(t="";Q<r;){const i=Ot[Q++];if(!(i&128))n.push(i);else if((i&224)===192){const s=Ot[Q++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=Ot[Q++]&63,o=Ot[Q++]&63;n.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Ot[Q++]&63,o=Ot[Q++]&63,a=Ot[Q++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c)}else n.push(i);n.length>=4096&&(t+=fr.apply(String,n),n.length=0)}return n.length>0&&(t+=fr.apply(String,n)),t}function Ly(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=We();return ve.freezeData?Object.freeze(t):t}function My(e){if(ve.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=By();n==="__proto__"&&(n="__proto_"),t[n]=We()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(We(),We());return t}}var fr=String.fromCharCode;function Uy(e){let t=Q,r=new Array(e);for(let n=0;n<e;n++){const i=Ot[Q++];if((i&128)>0){Q=t;return}r[n]=i}return fr.apply(String,r)}function bh(e){if(e<4)if(e<2){if(e===0)return"";{let t=Ot[Q++];if((t&128)>1){Q-=1;return}return fr(t)}}else{let t=Ot[Q++],r=Ot[Q++];if((t&128)>0||(r&128)>0){Q-=2;return}if(e<3)return fr(t,r);let n=Ot[Q++];if((n&128)>0){Q-=3;return}return fr(t,r,n)}else{let t=Ot[Q++],r=Ot[Q++],n=Ot[Q++],i=Ot[Q++];if((t&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){Q-=4;return}if(e<6){if(e===4)return fr(t,r,n,i);{let s=Ot[Q++];if((s&128)>0){Q-=5;return}return fr(t,r,n,i,s)}}else if(e<8){let s=Ot[Q++],o=Ot[Q++];if((s&128)>0||(o&128)>0){Q-=6;return}if(e<7)return fr(t,r,n,i,s,o);let a=Ot[Q++];if((a&128)>0){Q-=7;return}return fr(t,r,n,i,s,o,a)}else{let s=Ot[Q++],o=Ot[Q++],a=Ot[Q++],c=Ot[Q++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){Q-=8;return}if(e<10){if(e===8)return fr(t,r,n,i,s,o,a,c);{let u=Ot[Q++];if((u&128)>0){Q-=9;return}return fr(t,r,n,i,s,o,a,c,u)}}else if(e<12){let u=Ot[Q++],l=Ot[Q++];if((u&128)>0||(l&128)>0){Q-=10;return}if(e<11)return fr(t,r,n,i,s,o,a,c,u,l);let h=Ot[Q++];if((h&128)>0){Q-=11;return}return fr(t,r,n,i,s,o,a,c,u,l,h)}else{let u=Ot[Q++],l=Ot[Q++],h=Ot[Q++],d=Ot[Q++];if((u&128)>0||(l&128)>0||(h&128)>0||(d&128)>0){Q-=12;return}if(e<14){if(e===12)return fr(t,r,n,i,s,o,a,c,u,l,h,d);{let f=Ot[Q++];if((f&128)>0){Q-=13;return}return fr(t,r,n,i,s,o,a,c,u,l,h,d,f)}}else{let f=Ot[Q++],m=Ot[Q++];if((f&128)>0||(m&128)>0){Q-=14;return}if(e<15)return fr(t,r,n,i,s,o,a,c,u,l,h,d,f,m);let p=Ot[Q++];if((p&128)>0){Q-=15;return}return fr(t,r,n,i,s,o,a,c,u,l,h,d,f,m,p)}}}}}function Py(){let e=Ot[Q++],t;if(e<192)t=e-160;else switch(e){case 217:t=Ot[Q++];break;case 218:t=oe.getUint16(Q),Q+=2;break;case 219:t=oe.getUint32(Q),Q+=4;break;default:throw new Error("Expected string")}return ka(t)}function wh(e){return ve.copyBuffers?Uint8Array.prototype.slice.call(Ot,Q,Q+=e):Ot.subarray(Q,Q+=e)}function Ts(e){let t=Ot[Q++];if(Wr[t]){let r;return Wr[t](Ot.subarray(Q,r=Q+=e),n=>{Q=n;try{return We()}finally{Q=r}})}else throw new Error("Unknown extension type "+t)}var Fy=new Array(4096);function By(){let e=Ot[Q++];if(e>=160&&e<192){if(e=e-160,ii>=Q)return qi.slice(Q-bn,(Q+=e)-bn);if(!(ii==0&&ni<180))return _h(e)}else return Q--,$y(We());let t=(e<<5^(e>1?oe.getUint16(Q):e>0?Ot[Q]:0))&4095,r=Fy[t],n=Q,i=Q+e-3,s,o=0;if(r&&r.bytes==e){for(;n<i;){if(s=oe.getUint32(n),s!=r[o++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(s=Ot[n++],s!=r[o++]){n=1879048192;break}if(n===i)return Q=n,r.string;i-=3,n=Q}for(r=[],Fy[t]=r,r.bytes=e;n<i;)s=oe.getUint32(n),r.push(s),n+=4;for(i+=3;n<i;)s=Ot[n++],r.push(s);let a=e<16?bh(e):Uy(e);return a!=null?r.string=a:r.string=_h(e)}function $y(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";if(ve.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return e.flat().toString();throw new Error(`Invalid property type for record: ${typeof e}`)}const Dy=(e,t)=>{let r=We().map($y),n=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);let i=ce[e];return i&&(i.isShared||Vi)&&((ce.restoreStructures||(ce.restoreStructures=[]))[e]=i),ce[e]=r,r.read=yh(r,n),r.read()};Wr[0]=()=>{},Wr[0].noBuffer=!0,Wr[66]=e=>{let t=e.byteLength%8||8,r=BigInt(e[0]&128?e[0]-256:e[0]);for(let n=1;n<t;n++)r<<=BigInt(8),r+=BigInt(e[n]);if(e.byteLength!==t){let n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=n.getBigUint64(s);for(let d=s+8;d<o;d+=8)h<<=64n,h|=n.getBigUint64(d);return h}let c=s+(a>>4<<3),u=i(s,c),l=i(c,o);return u<<BigInt((o-c)*8)|l};r=r<<BigInt((n.byteLength-t)*8)|i(t,n.byteLength)}return r};let jy={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};Wr[101]=()=>{let e=We();if(!jy[e[0]]){let t=Error(e[1],{cause:e[2]});return t.name=e[0],t}return jy[e[0]](e[1],{cause:e[2]})},Wr[105]=e=>{if(ve.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=oe.getUint32(Q-4);Ai||(Ai=new Map);let r=Ot[Q],n;r>=144&&r<160||r==220||r==221?n=[]:r>=128&&r<144||r==222||r==223?n=new Map:(r>=199&&r<=201||r>=212&&r<=216)&&Ot[Q+1]===115?n=new Set:n={};let i={target:n};Ai.set(t,i);let s=We();if(i.used)Object.assign(n,s);else return i.target=s;if(n instanceof Map)for(let[o,a]of s.entries())n.set(o,a);if(n instanceof Set)for(let o of Array.from(s))n.add(o);return n},Wr[112]=e=>{if(ve.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=oe.getUint32(Q-4),r=Ai.get(t);return r.used=!0,r.target},Wr[115]=()=>new Set(We());const zy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let HI=typeof globalThis=="object"?globalThis:window;Wr[116]=e=>{let t=e[0],r=Uint8Array.prototype.slice.call(e,1).buffer,n=zy[t];if(!n){if(t===16)return r;if(t===17)return new DataView(r);throw new Error("Could not find typed array for code "+t)}return new HI[n](r)},Wr[120]=()=>{let e=We();return new RegExp(e[0],e[1])};const GI=[];Wr[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=Q;return Q+=t-e.length,ur=GI,ur=[Py(),Py()],ur.position0=0,ur.position1=0,ur.postBundlePosition=Q,Q=r,We()},Wr[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Wy(e){let t=ni,r=Q,n=bn,i=ii,s=qi,o=Ai,a=ur,c=new Uint8Array(Ot.slice(0,ni)),u=ce,l=ce.slice(0,ce.length),h=ve,d=Vi,f=e();return ni=t,Q=r,bn=n,ii=i,qi=s,Ai=o,ur=a,Ot=c,Vi=d,ce=u,ce.splice(0,ce.length,...l),ve=h,oe=new DataView(Ot.buffer,Ot.byteOffset,Ot.byteLength),f}function Eh(){Ot=null,Ai=null,ce=null}const vh=new Array(147);for(let e=0;e<256;e++)vh[e]=+("1e"+Math.floor(45.15-e*.30103));var al=new va({useRecords:!1});const KI=al.unpack;al.unpackMultiple,al.unpack;let YI=new Float32Array(1);new Uint8Array(YI.buffer,0,4);let cl;try{cl=new TextEncoder}catch{}let kh,Hy;const Eo=typeof tr<"u",ll=Eo?function(e){return tr.allocUnsafeSlow(e)}:Uint8Array,Gy=Eo?tr:Uint8Array,Ky=Eo?4294967296:2144337920;let at,xa,we,et=0,Tr,Le=null,qI;const VI=21760,XI=/[\u0080-\uFFFF]/,vo=Symbol("record-id");class JI extends va{constructor(t){super(t),this.offset=0;let r,n,i,s,o=Gy.prototype.utf8Write?function(I,v){return at.utf8Write(I,v,at.byteLength-v)}:cl&&cl.encodeInto?function(I,v){return cl.encodeInto(I,at.subarray(v)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=l>32||h+l>64,f=l+64,m=l+h+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],g=0,y=0;this.pack=this.encode=function(I,v){if(at||(at=new ll(8192),we=at.dataView||(at.dataView=new DataView(at.buffer,0,8192)),et=0),Tr=at.length-10,Tr-et<2048?(at=new ll(at.length),we=at.dataView||(at.dataView=new DataView(at.buffer,0,at.length)),Tr=at.length-10,et=0):et=et+7&2147483640,r=et,v&nN&&(et+=v&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof I!="string"?(Le=[],Le.size=1/0):Le=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let z=i.sharedLength||0;if(z>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let U=0;U<z;U++){let Y=i[U];if(!Y)continue;let X,K=i.transitions;for(let W=0,P=Y.length;W<P;W++){let ot=Y[W];X=K[ot],X||(X=K[ot]=Object.create(null)),K=X}K[vo]=U+64}this.lastNamedStructuresLength=z}c||(i.nextId=z+64)}n&&(n=!1);let L;try{a.randomAccessStructure&&I&&I.constructor&&I.constructor===Object?O(I):T(I);let z=Le;if(Le&&qy(r,T,0),s&&s.idsToInsert){let U=s.idsToInsert.sort((W,P)=>W.offset>P.offset?1:-1),Y=U.length,X=-1;for(;z&&Y>0;){let W=U[--Y].offset+r;W<z.stringsPosition+r&&X===-1&&(X=0),W>z.position+r?X>=0&&(X+=6):(X>=0&&(we.setUint32(z.position+r,we.getUint32(z.position+r)+X),X=-1),z=z.previous,Y++)}X>=0&&z&&we.setUint32(z.position+r,we.getUint32(z.position+r)+X),et+=U.length*6,et>Tr&&M(et),a.offset=et;let K=ZI(at.subarray(r,et),U);return s=null,K}return a.offset=et,v&eN?(at.start=r,at.end=et,at):at.subarray(r,et)}catch(z){throw L=z,z}finally{if(i&&(b(),n&&a.saveStructures)){let z=i.sharedLength||0,U=at.subarray(r,et),Y=QI(i,a);if(!L)return a.saveStructures(Y,Y.isCompatible)===!1?a.pack(I,v):(a.lastNamedStructuresLength=z,at.length>1073741824&&(at=null),U)}at.length>1073741824&&(at=null),v&rN&&(et=r)}};const b=()=>{y<10&&y++;let I=i.sharedLength||0;if(i.length>I&&!c&&(i.length=I),g>1e4)i.transitions=null,y=0,g=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let v=0,L=p.length;v<L;v++)p[v][vo]=0;p=[]}},S=I=>{var v=I.length;v<16?at[et++]=144|v:v<65536?(at[et++]=220,at[et++]=v>>8,at[et++]=v&255):(at[et++]=221,we.setUint32(et,v),et+=4);for(let L=0;L<v;L++)T(I[L])},T=I=>{et>Tr&&(at=M(et));var v=typeof I,L;if(v==="string"){let z=I.length;if(Le&&z>=4&&z<4096){if((Le.size+=z)>VI){let K,W=(Le[0]?Le[0].length*3+Le[1].length:0)+10;et+W>Tr&&(at=M(et+W));let P;Le.position?(P=Le,at[et]=200,et+=3,at[et++]=98,K=et-r,et+=4,qy(r,T,0),we.setUint16(K+r-3,et-r-K)):(at[et++]=214,at[et++]=98,K=et-r,et+=4),Le=["",""],Le.previous=P,Le.size=0,Le.position=K}let X=XI.test(I);Le[X?0:1]+=I,at[et++]=193,T(X?-z:z);return}let U;z<32?U=1:z<256?U=2:z<65536?U=3:U=5;let Y=z*3;if(et+Y>Tr&&(at=M(et+Y)),z<64||!o){let X,K,W,P=et+U;for(X=0;X<z;X++)K=I.charCodeAt(X),K<128?at[P++]=K:K<2048?(at[P++]=K>>6|192,at[P++]=K&63|128):(K&64512)===55296&&((W=I.charCodeAt(X+1))&64512)===56320?(K=65536+((K&1023)<<10)+(W&1023),X++,at[P++]=K>>18|240,at[P++]=K>>12&63|128,at[P++]=K>>6&63|128,at[P++]=K&63|128):(at[P++]=K>>12|224,at[P++]=K>>6&63|128,at[P++]=K&63|128);L=P-et-U}else L=o(I,et+U);L<32?at[et++]=160|L:L<256?(U<2&&at.copyWithin(et+2,et+1,et+1+L),at[et++]=217,at[et++]=L):L<65536?(U<3&&at.copyWithin(et+3,et+2,et+2+L),at[et++]=218,at[et++]=L>>8,at[et++]=L&255):(U<5&&at.copyWithin(et+5,et+3,et+3+L),at[et++]=219,we.setUint32(et,L),et+=4),et+=L}else if(v==="number")if(I>>>0===I)I<32||I<128&&this.useRecords===!1||I<64&&!this.randomAccessStructure?at[et++]=I:I<256?(at[et++]=204,at[et++]=I):I<65536?(at[et++]=205,at[et++]=I>>8,at[et++]=I&255):(at[et++]=206,we.setUint32(et,I),et+=4);else if(I>>0===I)I>=-32?at[et++]=256+I:I>=-128?(at[et++]=208,at[et++]=I+256):I>=-32768?(at[et++]=209,we.setInt16(et,I),et+=2):(at[et++]=210,we.setInt32(et,I),et+=4);else{let z;if((z=this.useFloat32)>0&&I<4294967296&&I>=-2147483648){at[et++]=202,we.setFloat32(et,I);let U;if(z<4||(U=I*vh[(at[et]&127)<<1|at[et+1]>>7])>>0===U){et+=4;return}else et--}at[et++]=203,we.setFloat64(et,I),et+=8}else if(v==="object"||v==="function")if(!I)at[et++]=192;else{if(s){let U=s.get(I);if(U){if(!U.id){let Y=s.idsToInsert||(s.idsToInsert=[]);U.id=Y.push(U)}at[et++]=214,at[et++]=112,we.setUint32(et,U.id),et+=4;return}else s.set(I,{offset:et-r})}let z=I.constructor;if(z===Object)B(I);else if(z===Array)S(I);else if(z===Map)if(this.mapAsEmptyObject)at[et++]=128;else{L=I.size,L<16?at[et++]=128|L:L<65536?(at[et++]=222,at[et++]=L>>8,at[et++]=L&255):(at[et++]=223,we.setUint32(et,L),et+=4);for(let[U,Y]of I)T(U),T(Y)}else{for(let U=0,Y=kh.length;U<Y;U++){let X=Hy[U];if(I instanceof X){let K=kh[U];if(K.write){K.type&&(at[et++]=212,at[et++]=K.type,at[et++]=0);let rt=K.write.call(this,I);rt===I?Array.isArray(I)?S(I):B(I):T(rt);return}let W=at,P=we,ot=et;at=null;let G;try{G=K.pack.call(this,I,rt=>(at=W,W=null,et+=rt,et>Tr&&M(et),{target:at,targetView:we,position:et-rt}),T)}finally{W&&(at=W,we=P,et=ot,Tr=at.length-10)}G&&(G.length+et>Tr&&M(G.length+et),et=Yy(G,at,et,K.type));return}}if(Array.isArray(I))S(I);else{if(I.toJSON){const U=I.toJSON();if(U!==I)return T(U)}if(v==="function")return T(this.writeFunction&&this.writeFunction(I));B(I)}}}else if(v==="boolean")at[et++]=I?195:194;else if(v==="bigint"){if(I<9223372036854776e3&&I>=-9223372036854776e3)at[et++]=211,we.setBigInt64(et,I);else if(I<18446744073709552e3&&I>0)at[et++]=207,we.setBigUint64(et,I);else if(this.largeBigIntToFloat)at[et++]=203,we.setFloat64(et,Number(I));else{if(this.largeBigIntToString)return T(I.toString());if(this.useBigIntExtension||this.moreTypes){let z=I<0?BigInt(-1):BigInt(0),U;if(I>>BigInt(65536)===z){let Y=BigInt(18446744073709552e3)-BigInt(1),X=[];for(;X.push(I&Y),I>>BigInt(63)!==z;)I>>=BigInt(64);U=new Uint8Array(new BigUint64Array(X).buffer),U.reverse()}else{let Y=I<0,X=(Y?~I:I).toString(16);if(X.length%2?X="0"+X:parseInt(X.charAt(0),16)>=8&&(X="00"+X),Eo)U=tr.from(X,"hex");else{U=new Uint8Array(X.length/2);for(let K=0;K<U.length;K++)U[K]=parseInt(X.slice(K*2,K*2+2),16)}if(Y)for(let K=0;K<U.length;K++)U[K]=~U[K]}U.length+et>Tr&&M(U.length+et),et=Yy(U,at,et,66);return}else throw new RangeError(I+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}et+=8}else if(v==="undefined")this.encodeUndefinedAsNil?at[et++]=192:(at[et++]=212,at[et++]=0,at[et++]=0);else throw new Error("Unknown type: "+v)},x=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?I=>{let v;if(this.skipValues){v=[];for(let U in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(U))&&!this.skipValues.includes(I[U])&&v.push(U)}else v=Object.keys(I);let L=v.length;L<16?at[et++]=128|L:L<65536?(at[et++]=222,at[et++]=L>>8,at[et++]=L&255):(at[et++]=223,we.setUint32(et,L),et+=4);let z;if(this.coercibleKeyAsNumber)for(let U=0;U<L;U++){z=v[U];let Y=Number(z);T(isNaN(Y)?z:Y),T(I[z])}else for(let U=0;U<L;U++)T(z=v[U]),T(I[z])}:I=>{at[et++]=222;let v=et-r;et+=2;let L=0;for(let z in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(z))&&(T(z),T(I[z]),L++);if(L>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');at[v+++r]=L>>8,at[v+r]=L&255},N=this.useRecords===!1?x:t.progressiveRecords&&!d?I=>{let v,L=i.transitions||(i.transitions=Object.create(null)),z=et++-r,U;for(let Y in I)if(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Y)){if(v=L[Y],v)L=v;else{let X=Object.keys(I),K=L;L=i.transitions;let W=0;for(let P=0,ot=X.length;P<ot;P++){let G=X[P];v=L[G],v||(v=L[G]=Object.create(null),W++),L=v}z+r+1==et?(et--,H(L,X,W)):V(L,X,z,W),U=!0,L=K[Y]}T(I[Y])}if(!U){let Y=L[vo];Y?at[z+r]=Y:V(L,Object.keys(I),z,0)}}:I=>{let v,L=i.transitions||(i.transitions=Object.create(null)),z=0;for(let Y in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Y))&&(v=L[Y],v||(v=L[Y]=Object.create(null),z++),L=v);let U=L[vo];U?U>=96&&d?(at[et++]=((U-=96)&31)+96,at[et++]=U>>5):at[et++]=U:H(L,L.__keys__||Object.keys(I),z);for(let Y in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Y))&&T(I[Y])},R=typeof this.useRecords=="function"&&this.useRecords,B=R?I=>{R(I)?N(I):x(I)}:N,M=I=>{let v;if(I>16777216){if(I-r>Ky)throw new Error("Packed buffer would be larger than maximum buffer size");v=Math.min(Ky,Math.round(Math.max((I-r)*(I>67108864?1.25:2),4194304)/4096)*4096)}else v=(Math.max(I-r<<2,at.length-1)>>12)+1<<12;let L=new ll(v);return we=L.dataView||(L.dataView=new DataView(L.buffer,0,v)),I=Math.min(I,at.length),at.copy?at.copy(L,0,r,I):L.set(at.slice(r,I)),et-=r,r=0,Tr=L.length-10,at=L},H=(I,v,L)=>{let z=i.nextId;z||(z=64),z<f&&this.shouldShareStructure&&!this.shouldShareStructure(v)?(z=i.nextOwnId,z<m||(z=f),i.nextOwnId=z+1):(z>=m&&(z=f),i.nextId=z+1);let U=v.highByte=z>=96&&d?z-96>>5:-1;I[vo]=z,I.__keys__=v,i[z-64]=v,z<f?(v.isShared=!0,i.sharedLength=z-63,n=!0,U>=0?(at[et++]=(z&31)+96,at[et++]=U):at[et++]=z):(U>=0?(at[et++]=213,at[et++]=114,at[et++]=(z&31)+96,at[et++]=U):(at[et++]=212,at[et++]=114,at[et++]=z),L&&(g+=y*L),p.length>=h&&(p.shift()[vo]=0),p.push(I),T(v))},V=(I,v,L,z)=>{let U=at,Y=et,X=Tr,K=r;at=xa,et=0,r=0,at||(xa=at=new ll(8192)),Tr=at.length-10,H(I,v,z),xa=at;let W=et;if(at=U,et=Y,Tr=X,r=K,W>1){let P=et+W-1;P>Tr&&M(P);let ot=L+r;at.copyWithin(ot+W,ot+1,et),at.set(xa.slice(0,W),ot),et=P}else at[L+r]=xa[0]},O=I=>{let v=qI(I,at,r,et,i,M,(L,z,U)=>{if(U)return n=!0;et=z;let Y=at;return T(L),b(),Y!==at?{position:et,targetView:we,target:at}:et},this);if(v===0)return B(I);et=v}}useBuffer(t){at=t,at.dataView||(at.dataView=new DataView(at.buffer,at.byteOffset,at.byteLength)),we=at.dataView,et=0}set position(t){et=t}get position(){return et}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Hy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,Sy],kh=[{pack(e,t,r){let n=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,n)}else if(n>0&&n<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(e,t,r){if(this.setAsEmptyObject)return t(0),r({});let n=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([e.name,e.message,e.cause])}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([e.source,e.flags])}},{pack(e,t){this.moreTypes?xh(e,16,t):Ah(Eo?tr.from(e):new Uint8Array(e),t)}},{pack(e,t){let r=e.constructor;r!==Gy&&this.moreTypes?xh(e,zy.indexOf(r.name),t):Ah(e,t)}},{pack(e,t){this.moreTypes?xh(e,17,t):Ah(Eo?tr.from(e):new Uint8Array(e),t)}},{pack(e,t){let{target:r,position:n}=t(1);r[n]=193}}];function xh(e,t,r,n){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=r(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=r(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=r(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Ah(e,t){let r=e.byteLength;var n,i;if(r<256){var{target:n,position:i}=t(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=t(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:s}=t(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(e,i)}function Yy(e,t,r,n){let i=e.length;switch(i){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:i<256?(t[r++]=199,t[r++]=i):i<65536?(t[r++]=200,t[r++]=i>>8,t[r++]=i&255):(t[r++]=201,t[r++]=i>>24,t[r++]=i>>16&255,t[r++]=i>>8&255,t[r++]=i&255)}return t[r++]=n,t.set(e,r),r+=i,r}function ZI(e,t){let r,n=t.length*6,i=e.length-n;for(;r=t.pop();){let s=r.offset,o=r.id;e.copyWithin(s+n,s,i),n-=6;let a=s+n;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function qy(e,t,r){if(Le.length>0){we.setUint32(Le.position+e,et+r-Le.position-e),Le.stringsPosition=et-e;let n=Le;Le=null,t(n[0]),t(n[1])}}function QI(e,t){return e.isCompatible=r=>{let n=!r||(t.lastNamedStructuresLength||0)===r.length;return n||t._mergeStructures(r),n},e}let Vy=new JI({useRecords:!1});const tN=Vy.pack;Vy.pack;const eN=512,rN=1024,nN=2048;function Oe(){return null}function ko(e,t,r={}){if(!w(e))return;const n=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=r[o];w(c)&&(a=c(a));const u=t[o];w(u)&&(o=u),a!==null&&n.push(o,a)}return n}function Aa(e,t,r={}){if(w(e))try{const n={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];w(a)&&(s=a);const c=r[s];w(c)&&(o=c(o)),n[s]=o}return n}catch(n){ye(lt,"","format",n.message)}}function iN(e){try{return tN(e)}catch(t){ye(lt,"","format",t.message)}}function Xy(e){if(_t(e)){try{return JSON.parse(e)}catch(t){ye(lt,"","format",t.message)}return}try{return KI(e)}catch(t){ye(lt,"","format",t.message)}}function Jy(){return{id:De()}}var ul=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e[e.shootx=39]="shootx",e[e.shooty=40]="shooty",e[e.p7=41]="p7",e[e.p8=42]="p8",e[e.p9=43]="p9",e[e.p10=44]="p10",e))(ul||{});function fl(e){return w(e==null?void 0:e.id)?ko(e,ul,{category:Oe,kinddata:Oe,stopped:Oe,removed:Oe,bucket:Oe}):ko(e,ul,{id:Oe,x:Oe,y:Oe,lx:Oe,ly:Oe,code:Oe,category:Oe,kinddata:Oe,stopped:Oe,removed:Oe,bucket:Oe})}function hl(e){return Aa(e,ul)}function He(e){return(e==null?void 0:e.category)===$r.ISOBJECT}function Ta(e,t){if(!w(e)||!Ir(t))return;const{color:r,bg:n}=wy(t);w(r)&&(e.color=r),w(n)&&(e.bg=n)}function Zy(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function Qy(e){const t=Math.floor(e.length/rl);if(t*rl!==e.length)return;const r=Zy(3,t);for(let n=0;n<r.bits.length;++n)r.bits[n]=e[n];return r}function sN(e,t){return e&1<<t?255:0}function t_(e){const t=Math.floor(e.length/ph);if(t*ph!==e.length)return;const r=Math.ceil(t/nl),n=ks*nl,i=Zy(n,xs*r);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*xs+a,l=e[c];for(let h=0;h<ks;++h){const d=s*ks+h;i.bits[d+u*n]=sN(l,7-h)}++a,a===xs&&(a=0,++s,s===nl&&(s=0,++o))}return i}const oN=Ac("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),aN=Ac("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var e_=typeof to=="object"&&to&&to.Object===Object&&to,cN=typeof self=="object"&&self&&self.Object===Object&&self,si=e_||cN||Function("return this")(),wn=si.Symbol,r_=Object.prototype,lN=r_.hasOwnProperty,uN=r_.toString,Sa=wn?wn.toStringTag:void 0;function fN(e){var t=lN.call(e,Sa),r=e[Sa];try{e[Sa]=void 0;var n=!0}catch{}var i=uN.call(e);return n&&(t?e[Sa]=r:delete e[Sa]),i}var hN=Object.prototype,dN=hN.toString;function pN(e){return dN.call(e)}var mN="[object Null]",gN="[object Undefined]",n_=wn?wn.toStringTag:void 0;function Xi(e){return e==null?e===void 0?gN:mN:n_&&n_ in Object(e)?fN(e):pN(e)}function Bn(e){return e!=null&&typeof e=="object"}var yN="[object Symbol]";function dl(e){return typeof e=="symbol"||Bn(e)&&Xi(e)==yN}function pl(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var fe=Array.isArray,i_=wn?wn.prototype:void 0,s_=i_?i_.toString:void 0;function o_(e){if(typeof e=="string")return e;if(fe(e))return pl(e,o_)+"";if(dl(e))return s_?s_.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var _N=/\s/;function bN(e){for(var t=e.length;t--&&_N.test(e.charAt(t)););return t}var wN=/^\s+/;function EN(e){return e&&e.slice(0,bN(e)+1).replace(wN,"")}function En(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var a_=NaN,vN=/^[-+]0x[0-9a-f]+$/i,kN=/^0b[01]+$/i,xN=/^0o[0-7]+$/i,AN=parseInt;function TN(e){if(typeof e=="number")return e;if(dl(e))return a_;if(En(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=En(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=EN(e);var r=kN.test(e);return r||xN.test(e)?AN(e.slice(2),r?2:8):vN.test(e)?a_:+e}var c_=1/0,SN=17976931348623157e292;function RN(e){if(!e)return e===0?e:0;if(e=TN(e),e===c_||e===-c_){var t=e<0?-1:1;return t*SN}return e===e?e:0}function ml(e){var t=RN(e),r=t%1;return t===t?r?t-r:t:0}function xo(e){return e}var ON="[object AsyncFunction]",IN="[object Function]",NN="[object GeneratorFunction]",CN="[object Proxy]";function Ti(e){if(!En(e))return!1;var t=Xi(e);return t==IN||t==NN||t==ON||t==CN}var Th=si["__core-js_shared__"],l_=function(){var e=/[^.]+$/.exec(Th&&Th.keys&&Th.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function LN(e){return!!l_&&l_ in e}var MN=Function.prototype,UN=MN.toString;function Ss(e){if(e!=null){try{return UN.call(e)}catch{}try{return e+""}catch{}}return""}var PN=/[\\^$.*+?()[\]{}|]/g,FN=/^\[object .+?Constructor\]$/,BN=Function.prototype,$N=Object.prototype,DN=BN.toString,jN=$N.hasOwnProperty,zN=RegExp("^"+DN.call(jN).replace(PN,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function WN(e){if(!En(e)||LN(e))return!1;var t=Ti(e)?zN:FN;return t.test(Ss(e))}function HN(e,t){return e==null?void 0:e[t]}function Rs(e,t){var r=HN(e,t);return WN(r)?r:void 0}var Sh=Rs(si,"WeakMap"),u_=Object.create,GN=function(){function e(){}return function(t){if(!En(t))return{};if(u_)return u_(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function KN(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function nr(){}function YN(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var qN=800,VN=16,XN=Date.now;function JN(e){var t=0,r=0;return function(){var n=XN(),i=VN-(n-r);if(r=n,i>0){if(++t>=qN)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function ZN(e){return function(){return e}}var gl=function(){try{var e=Rs(Object,"defineProperty");return e({},"",{}),e}catch{}}(),QN=gl?function(e,t){return gl(e,"toString",{configurable:!0,enumerable:!1,value:ZN(t),writable:!0})}:xo,tC=JN(QN);function f_(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}function h_(e,t,r,n){for(var i=e.length,s=r+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function eC(e){return e!==e}function rC(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function Rh(e,t,r){return t===t?rC(e,t,r):h_(e,eC,r)}function d_(e,t){var r=e==null?0:e.length;return!!r&&Rh(e,t,0)>-1}var nC=9007199254740991,iC=/^(?:0|[1-9]\d*)$/;function yl(e,t){var r=typeof e;return t=t??nC,!!t&&(r=="number"||r!="symbol"&&iC.test(e))&&e>-1&&e%1==0&&e<t}function Oh(e,t,r){t=="__proto__"&&gl?gl(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Ra(e,t){return e===t||e!==e&&t!==t}var sC=Object.prototype,oC=sC.hasOwnProperty;function _l(e,t,r){var n=e[t];(!(oC.call(e,t)&&Ra(n,r))||r===void 0&&!(t in e))&&Oh(e,t,r)}function Oa(e,t,r,n){var i=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Oh(r,a,c):_l(r,a,c)}return r}var p_=Math.max;function aC(e,t,r){return t=p_(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,s=p_(n.length-t,0),o=Array(s);++i<s;)o[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(o),KN(e,this,a)}}function Ih(e,t){return tC(aC(e,t,xo),e+"")}var cC=9007199254740991;function Nh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=cC}function oi(e){return e!=null&&Nh(e.length)&&!Ti(e)}function m_(e,t,r){if(!En(r))return!1;var n=typeof t;return(n=="number"?oi(r)&&yl(t,r.length):n=="string"&&t in r)?Ra(r[t],e):!1}function lC(e){return Ih(function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&m_(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++n<i;){var a=r[n];a&&e(t,a,n,s)}return t})}var uC=Object.prototype;function Ia(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||uC;return e===r}function fC(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var hC="[object Arguments]";function g_(e){return Bn(e)&&Xi(e)==hC}var y_=Object.prototype,dC=y_.hasOwnProperty,pC=y_.propertyIsEnumerable,bl=g_(function(){return arguments}())?g_:function(e){return Bn(e)&&dC.call(e,"callee")&&!pC.call(e,"callee")};function mC(){return!1}var __=typeof exports=="object"&&exports&&!exports.nodeType&&exports,b_=__&&typeof module=="object"&&module&&!module.nodeType&&module,gC=b_&&b_.exports===__,w_=gC?si.Buffer:void 0,yC=w_?w_.isBuffer:void 0,Na=yC||mC,_C="[object Arguments]",bC="[object Array]",wC="[object Boolean]",EC="[object Date]",vC="[object Error]",kC="[object Function]",xC="[object Map]",AC="[object Number]",TC="[object Object]",SC="[object RegExp]",RC="[object Set]",OC="[object String]",IC="[object WeakMap]",NC="[object ArrayBuffer]",CC="[object DataView]",LC="[object Float32Array]",MC="[object Float64Array]",UC="[object Int8Array]",PC="[object Int16Array]",FC="[object Int32Array]",BC="[object Uint8Array]",$C="[object Uint8ClampedArray]",DC="[object Uint16Array]",jC="[object Uint32Array]",Te={};Te[LC]=Te[MC]=Te[UC]=Te[PC]=Te[FC]=Te[BC]=Te[$C]=Te[DC]=Te[jC]=!0,Te[_C]=Te[bC]=Te[NC]=Te[wC]=Te[CC]=Te[EC]=Te[vC]=Te[kC]=Te[xC]=Te[AC]=Te[TC]=Te[SC]=Te[RC]=Te[OC]=Te[IC]=!1;function zC(e){return Bn(e)&&Nh(e.length)&&!!Te[Xi(e)]}function wl(e){return function(t){return e(t)}}var E_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ca=E_&&typeof module=="object"&&module&&!module.nodeType&&module,WC=Ca&&Ca.exports===E_,Ch=WC&&e_.process,Ji=function(){try{var e=Ca&&Ca.require&&Ca.require("util").types;return e||Ch&&Ch.binding&&Ch.binding("util")}catch{}}(),v_=Ji&&Ji.isTypedArray,Lh=v_?wl(v_):zC,HC=Object.prototype,GC=HC.hasOwnProperty;function k_(e,t){var r=fe(e),n=!r&&bl(e),i=!r&&!n&&Na(e),s=!r&&!n&&!i&&Lh(e),o=r||n||i||s,a=o?fC(e.length,String):[],c=a.length;for(var u in e)(t||GC.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||yl(u,c)))&&a.push(u);return a}function x_(e,t){return function(r){return e(t(r))}}var KC=x_(Object.keys,Object),YC=Object.prototype,qC=YC.hasOwnProperty;function A_(e){if(!Ia(e))return KC(e);var t=[];for(var r in Object(e))qC.call(e,r)&&r!="constructor"&&t.push(r);return t}function vn(e){return oi(e)?k_(e):A_(e)}var VC=Object.prototype,XC=VC.hasOwnProperty,Hr=lC(function(e,t){if(Ia(t)||oi(t)){Oa(t,vn(t),e);return}for(var r in t)XC.call(t,r)&&_l(e,r,t[r])});function JC(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var ZC=Object.prototype,QC=ZC.hasOwnProperty;function tL(e){if(!En(e))return JC(e);var t=Ia(e),r=[];for(var n in e)n=="constructor"&&(t||!QC.call(e,n))||r.push(n);return r}function Mh(e){return oi(e)?k_(e,!0):tL(e)}var eL=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rL=/^\w*$/;function Uh(e,t){if(fe(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||dl(e)?!0:rL.test(e)||!eL.test(e)||t!=null&&e in Object(t)}var La=Rs(Object,"create");function nL(){this.__data__=La?La(null):{},this.size=0}function iL(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var sL="__lodash_hash_undefined__",oL=Object.prototype,aL=oL.hasOwnProperty;function cL(e){var t=this.__data__;if(La){var r=t[e];return r===sL?void 0:r}return aL.call(t,e)?t[e]:void 0}var lL=Object.prototype,uL=lL.hasOwnProperty;function fL(e){var t=this.__data__;return La?t[e]!==void 0:uL.call(t,e)}var hL="__lodash_hash_undefined__";function dL(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=La&&t===void 0?hL:t,this}function Os(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Os.prototype.clear=nL,Os.prototype.delete=iL,Os.prototype.get=cL,Os.prototype.has=fL,Os.prototype.set=dL;function pL(){this.__data__=[],this.size=0}function El(e,t){for(var r=e.length;r--;)if(Ra(e[r][0],t))return r;return-1}var mL=Array.prototype,gL=mL.splice;function yL(e){var t=this.__data__,r=El(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():gL.call(t,r,1),--this.size,!0}function _L(e){var t=this.__data__,r=El(t,e);return r<0?void 0:t[r][1]}function bL(e){return El(this.__data__,e)>-1}function wL(e,t){var r=this.__data__,n=El(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function Si(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Si.prototype.clear=pL,Si.prototype.delete=yL,Si.prototype.get=_L,Si.prototype.has=bL,Si.prototype.set=wL;var Ma=Rs(si,"Map");function EL(){this.size=0,this.__data__={hash:new Os,map:new(Ma||Si),string:new Os}}function vL(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function vl(e,t){var r=e.__data__;return vL(t)?r[typeof t=="string"?"string":"hash"]:r.map}function kL(e){var t=vl(this,e).delete(e);return this.size-=t?1:0,t}function xL(e){return vl(this,e).get(e)}function AL(e){return vl(this,e).has(e)}function TL(e,t){var r=vl(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function Ri(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ri.prototype.clear=EL,Ri.prototype.delete=kL,Ri.prototype.get=xL,Ri.prototype.has=AL,Ri.prototype.set=TL;var SL="Expected a function";function Ph(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(SL);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(Ph.Cache||Ri),r}Ph.Cache=Ri;var RL=500;function OL(e){var t=Ph(e,function(n){return r.size===RL&&r.clear(),n}),r=t.cache;return t}var IL=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,NL=/\\(\\)?/g,CL=OL(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(IL,function(r,n,i,s){t.push(i?s.replace(NL,"$1"):n||r)}),t});function T_(e){return e==null?"":o_(e)}function kl(e,t){return fe(e)?e:Uh(e,t)?[e]:CL(T_(e))}function Ua(e){if(typeof e=="string"||dl(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function Fh(e,t){t=kl(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Ua(t[r++])];return r&&r==n?e:void 0}function LL(e,t,r){var n=e==null?void 0:Fh(e,t);return n===void 0?r:n}function Bh(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var S_=wn?wn.isConcatSpreadable:void 0;function ML(e){return fe(e)||bl(e)||!!(S_&&e&&e[S_])}function $h(e,t,r,n,i){var s=-1,o=e.length;for(r||(r=ML),i||(i=[]);++s<o;){var a=e[s];r(a)?Bh(i,a):n||(i[i.length]=a)}return i}function an(e){var t=e==null?0:e.length;return t?$h(e):[]}var R_=x_(Object.getPrototypeOf,Object);function Dh(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function UL(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:Dh(e,t,r)}var PL="\\ud800-\\udfff",FL="\\u0300-\\u036f",BL="\\ufe20-\\ufe2f",$L="\\u20d0-\\u20ff",DL=FL+BL+$L,jL="\\ufe0e\\ufe0f",zL="\\u200d",WL=RegExp("["+zL+PL+DL+jL+"]");function O_(e){return WL.test(e)}function HL(e){return e.split("")}var I_="\\ud800-\\udfff",GL="\\u0300-\\u036f",KL="\\ufe20-\\ufe2f",YL="\\u20d0-\\u20ff",qL=GL+KL+YL,VL="\\ufe0e\\ufe0f",XL="["+I_+"]",jh="["+qL+"]",zh="\\ud83c[\\udffb-\\udfff]",JL="(?:"+jh+"|"+zh+")",N_="[^"+I_+"]",C_="(?:\\ud83c[\\udde6-\\uddff]){2}",L_="[\\ud800-\\udbff][\\udc00-\\udfff]",ZL="\\u200d",M_=JL+"?",U_="["+VL+"]?",QL="(?:"+ZL+"(?:"+[N_,C_,L_].join("|")+")"+U_+M_+")*",t6=U_+M_+QL,e6="(?:"+[N_+jh+"?",jh,C_,L_,XL].join("|")+")",r6=RegExp(zh+"(?="+zh+")|"+e6+t6,"g");function n6(e){return e.match(r6)||[]}function i6(e){return O_(e)?n6(e):HL(e)}function s6(e){return function(t){t=T_(t);var r=O_(t)?i6(t):void 0,n=r?r[0]:t.charAt(0),i=r?UL(r,1).join(""):t.slice(1);return n[e]()+i}}var P_=s6("toUpperCase");function o6(e,t,r,n){var i=-1,s=e==null?0:e.length;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function a6(){this.__data__=new Si,this.size=0}function c6(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function l6(e){return this.__data__.get(e)}function u6(e){return this.__data__.has(e)}var f6=200;function h6(e,t){var r=this.__data__;if(r instanceof Si){var n=r.__data__;if(!Ma||n.length<f6-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ri(n)}return r.set(e,t),this.size=r.size,this}function ai(e){var t=this.__data__=new Si(e);this.size=t.size}ai.prototype.clear=a6,ai.prototype.delete=c6,ai.prototype.get=l6,ai.prototype.has=u6,ai.prototype.set=h6;function d6(e,t){return e&&Oa(t,vn(t),e)}function p6(e,t){return e&&Oa(t,Mh(t),e)}var F_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,B_=F_&&typeof module=="object"&&module&&!module.nodeType&&module,m6=B_&&B_.exports===F_,$_=m6?si.Buffer:void 0,D_=$_?$_.allocUnsafe:void 0;function g6(e,t){var r=e.length,n=D_?D_(r):new e.constructor(r);return e.copy(n),n}function Wh(e,t){for(var r=-1,n=e==null?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}function j_(){return[]}var y6=Object.prototype,_6=y6.propertyIsEnumerable,z_=Object.getOwnPropertySymbols,Hh=z_?function(e){return e==null?[]:(e=Object(e),Wh(z_(e),function(t){return _6.call(e,t)}))}:j_;function b6(e,t){return Oa(e,Hh(e),t)}var w6=Object.getOwnPropertySymbols,W_=w6?function(e){for(var t=[];e;)Bh(t,Hh(e)),e=R_(e);return t}:j_;function E6(e,t){return Oa(e,W_(e),t)}function H_(e,t,r){var n=t(e);return fe(e)?n:Bh(n,r(e))}function Gh(e){return H_(e,vn,Hh)}function v6(e){return H_(e,Mh,W_)}var Kh=Rs(si,"DataView"),Yh=Rs(si,"Promise"),Ao=Rs(si,"Set"),G_="[object Map]",k6="[object Object]",K_="[object Promise]",Y_="[object Set]",q_="[object WeakMap]",V_="[object DataView]",x6=Ss(Kh),A6=Ss(Ma),T6=Ss(Yh),S6=Ss(Ao),R6=Ss(Sh),kn=Xi;(Kh&&kn(new Kh(new ArrayBuffer(1)))!=V_||Ma&&kn(new Ma)!=G_||Yh&&kn(Yh.resolve())!=K_||Ao&&kn(new Ao)!=Y_||Sh&&kn(new Sh)!=q_)&&(kn=function(e){var t=Xi(e),r=t==k6?e.constructor:void 0,n=r?Ss(r):"";if(n)switch(n){case x6:return V_;case A6:return G_;case T6:return K_;case S6:return Y_;case R6:return q_}return t});var O6=Object.prototype,I6=O6.hasOwnProperty;function N6(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&I6.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var xl=si.Uint8Array;function C6(e){var t=new e.constructor(e.byteLength);return new xl(t).set(new xl(e)),t}function L6(e,t){var r=e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var M6=/\w*$/;function U6(e){var t=new e.constructor(e.source,M6.exec(e));return t.lastIndex=e.lastIndex,t}var X_=wn?wn.prototype:void 0,J_=X_?X_.valueOf:void 0;function P6(e){return J_?Object(J_.call(e)):{}}function F6(e,t){var r=e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var B6="[object Boolean]",$6="[object Date]",D6="[object Map]",j6="[object Number]",z6="[object RegExp]",W6="[object Set]",H6="[object String]",G6="[object Symbol]",K6="[object ArrayBuffer]",Y6="[object DataView]",q6="[object Float32Array]",V6="[object Float64Array]",X6="[object Int8Array]",J6="[object Int16Array]",Z6="[object Int32Array]",Q6="[object Uint8Array]",tM="[object Uint8ClampedArray]",eM="[object Uint16Array]",rM="[object Uint32Array]";function nM(e,t,r){var n=e.constructor;switch(t){case K6:return C6(e);case B6:case $6:return new n(+e);case Y6:return L6(e);case q6:case V6:case X6:case J6:case Z6:case Q6:case tM:case eM:case rM:return F6(e);case D6:return new n;case j6:case H6:return new n(e);case z6:return U6(e);case W6:return new n;case G6:return P6(e)}}function iM(e){return typeof e.constructor=="function"&&!Ia(e)?GN(R_(e)):{}}var sM="[object Map]";function oM(e){return Bn(e)&&kn(e)==sM}var Z_=Ji&&Ji.isMap,aM=Z_?wl(Z_):oM,cM="[object Set]";function lM(e){return Bn(e)&&kn(e)==cM}var Q_=Ji&&Ji.isSet,uM=Q_?wl(Q_):lM,fM=2,tb="[object Arguments]",hM="[object Array]",dM="[object Boolean]",pM="[object Date]",mM="[object Error]",eb="[object Function]",gM="[object GeneratorFunction]",yM="[object Map]",_M="[object Number]",rb="[object Object]",bM="[object RegExp]",wM="[object Set]",EM="[object String]",vM="[object Symbol]",kM="[object WeakMap]",xM="[object ArrayBuffer]",AM="[object DataView]",TM="[object Float32Array]",SM="[object Float64Array]",RM="[object Int8Array]",OM="[object Int16Array]",IM="[object Int32Array]",NM="[object Uint8Array]",CM="[object Uint8ClampedArray]",LM="[object Uint16Array]",MM="[object Uint32Array]",ke={};ke[tb]=ke[hM]=ke[xM]=ke[AM]=ke[dM]=ke[pM]=ke[TM]=ke[SM]=ke[RM]=ke[OM]=ke[IM]=ke[yM]=ke[_M]=ke[rb]=ke[bM]=ke[wM]=ke[EM]=ke[vM]=ke[NM]=ke[CM]=ke[LM]=ke[MM]=!0,ke[mM]=ke[eb]=ke[kM]=!1;function Al(e,t,r,n,i,s){var o,a=t&fM;if(o!==void 0)return o;if(!En(e))return e;var c=fe(e);if(c)return o=N6(e),YN(e,o);var u=kn(e),l=u==eb||u==gM;if(Na(e))return g6(e);if(u==rb||u==tb||l&&!i)return o=l?{}:iM(e),a?E6(e,p6(o,e)):b6(e,d6(o,e));if(!ke[u])return i?e:{};o=nM(e,u),s||(s=new ai);var h=s.get(e);if(h)return h;s.set(e,o),uM(e)?e.forEach(function(m){o.add(Al(m,t,r,m,e,s))}):aM(e)&&e.forEach(function(m,p){o.set(p,Al(m,t,r,p,e,s))});var d=Gh,f=c?void 0:d(e);return f_(f||e,function(m,p){f&&(p=m,m=e[p]),_l(o,p,Al(m,t,r,p,e,s))}),o}var UM=4;function Er(e){return Al(e,UM)}function Pa(e){for(var t=-1,r=e==null?0:e.length,n=0,i=[];++t<r;){var s=e[t];s&&(i[n++]=s)}return i}var PM="__lodash_hash_undefined__";function FM(e){return this.__data__.set(e,PM),this}function BM(e){return this.__data__.has(e)}function To(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Ri;++t<r;)this.add(e[t])}To.prototype.add=To.prototype.push=FM,To.prototype.has=BM;function nb(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function qh(e,t){return e.has(t)}var $M=1,DM=2;function ib(e,t,r,n,i,s){var o=r&$M,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,d=!0,f=r&DM?new To:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var m=e[h],p=t[h];if(n)var g=o?n(p,m,h,t,e,s):n(m,p,h,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!nb(t,function(y,b){if(!qh(f,b)&&(m===y||i(m,y,r,n,s)))return f.push(b)})){d=!1;break}}else if(!(m===p||i(m,p,r,n,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function jM(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function Vh(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var zM=1,WM=2,HM="[object Boolean]",GM="[object Date]",KM="[object Error]",YM="[object Map]",qM="[object Number]",VM="[object RegExp]",XM="[object Set]",JM="[object String]",ZM="[object Symbol]",QM="[object ArrayBuffer]",tU="[object DataView]",sb=wn?wn.prototype:void 0,Xh=sb?sb.valueOf:void 0;function eU(e,t,r,n,i,s,o){switch(r){case tU:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case QM:return!(e.byteLength!=t.byteLength||!s(new xl(e),new xl(t)));case HM:case GM:case qM:return Ra(+e,+t);case KM:return e.name==t.name&&e.message==t.message;case VM:case JM:return e==t+"";case YM:var a=jM;case XM:var c=n&zM;if(a||(a=Vh),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;n|=WM,o.set(e,t);var l=ib(a(e),a(t),n,i,s,o);return o.delete(e),l;case ZM:if(Xh)return Xh.call(e)==Xh.call(t)}return!1}var rU=1,nU=Object.prototype,iU=nU.hasOwnProperty;function sU(e,t,r,n,i,s){var o=r&rU,a=Gh(e),c=a.length,u=Gh(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:iU.call(t,d)))return!1}var f=s.get(e),m=s.get(t);if(f&&m)return f==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var g=o;++h<c;){d=a[h];var y=e[d],b=t[d];if(n)var S=o?n(b,y,d,t,e,s):n(y,b,d,e,t,s);if(!(S===void 0?y===b||i(y,b,r,n,s):S)){p=!1;break}g||(g=d=="constructor")}if(p&&!g){var T=e.constructor,x=t.constructor;T!=x&&"constructor"in e&&"constructor"in t&&!(typeof T=="function"&&T instanceof T&&typeof x=="function"&&x instanceof x)&&(p=!1)}return s.delete(e),s.delete(t),p}var oU=1,ob="[object Arguments]",ab="[object Array]",Tl="[object Object]",aU=Object.prototype,cb=aU.hasOwnProperty;function cU(e,t,r,n,i,s){var o=fe(e),a=fe(t),c=o?ab:kn(e),u=a?ab:kn(t);c=c==ob?Tl:c,u=u==ob?Tl:u;var l=c==Tl,h=u==Tl,d=c==u;if(d&&Na(e)){if(!Na(t))return!1;o=!0,l=!1}if(d&&!l)return s||(s=new ai),o||Lh(e)?ib(e,t,r,n,i,s):eU(e,t,c,r,n,i,s);if(!(r&oU)){var f=l&&cb.call(e,"__wrapped__"),m=h&&cb.call(t,"__wrapped__");if(f||m){var p=f?e.value():e,g=m?t.value():t;return s||(s=new ai),i(p,g,r,n,s)}}return d?(s||(s=new ai),sU(e,t,r,n,i,s)):!1}function Jh(e,t,r,n,i){return e===t?!0:e==null||t==null||!Bn(e)&&!Bn(t)?e!==e&&t!==t:cU(e,t,r,n,Jh,i)}var lU=1,uU=2;function fU(e,t,r,n){var i=r.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=r[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=r[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new ai,h;if(!(h===void 0?Jh(u,c,lU|uU,n,l):h))return!1}}return!0}function lb(e){return e===e&&!En(e)}function hU(e){for(var t=vn(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,lb(i)]}return t}function ub(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function dU(e){var t=hU(e);return t.length==1&&t[0][2]?ub(t[0][0],t[0][1]):function(r){return r===e||fU(r,e,t)}}function pU(e,t){return e!=null&&t in Object(e)}function fb(e,t,r){t=kl(t,e);for(var n=-1,i=t.length,s=!1;++n<i;){var o=Ua(t[n]);if(!(s=e!=null&&r(e,o)))break;e=e[o]}return s||++n!=i?s:(i=e==null?0:e.length,!!i&&Nh(i)&&yl(o,i)&&(fe(e)||bl(e)))}function mU(e,t){return e!=null&&fb(e,t,pU)}var gU=1,yU=2;function _U(e,t){return Uh(e)&&lb(t)?ub(Ua(e),t):function(r){var n=LL(r,e);return n===void 0&&n===t?mU(r,e):Jh(t,n,gU|yU)}}function bU(e){return function(t){return t==null?void 0:t[e]}}function wU(e){return function(t){return Fh(t,e)}}function EU(e){return Uh(e)?bU(Ua(e)):wU(e)}function ci(e){return typeof e=="function"?e:e==null?xo:typeof e=="object"?fe(e)?_U(e[0],e[1]):dU(e):EU(e)}function vU(e,t,r,n){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(n,o,r(o),e)}return n}function kU(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[++i];if(r(s[c],c,s)===!1)break}return t}}var xU=kU();function AU(e,t){return e&&xU(e,t,vn)}function TU(e,t){return function(r,n){if(r==null)return r;if(!oi(r))return e(r,n);for(var i=r.length,s=-1,o=Object(r);++s<i&&n(o[s],s,o)!==!1;);return r}}var Is=TU(AU);function SU(e,t,r,n){return Is(e,function(i,s,o){t(n,i,r(i),o)}),n}function RU(e,t){return function(r,n){var i=fe(r)?vU:SU,s=t?t():{};return i(r,e,ci(n),s)}}var hb=Object.prototype,OU=hb.hasOwnProperty,Zh=Ih(function(e,t){e=Object(e);var r=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&m_(t[0],t[1],i)&&(n=1);++r<n;)for(var s=t[r],o=Mh(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Ra(l,hb[u])&&!OU.call(e,u))&&(e[u]=s[u])}return e});function db(e){return Bn(e)&&oi(e)}var IU=200;function NU(e,t,r,n){var i=-1,s=d_,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=IU&&(s=qh,o=!1,t=new To(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var d=u;d--;)if(t[d]===h)continue t;c.push(l)}else s(t,h,n)||c.push(l)}return c}var Sl=Ih(function(e,t){return db(e)?NU(e,$h(t,1,db,!0)):[]});function So(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function vr(e,t,r){var n=e==null?0:e.length;return n?(t=t===void 0?1:ml(t),Dh(e,t<0?0:t,n)):[]}function Fa(e,t,r){var n=e==null?0:e.length;return n?(t=t===void 0?1:ml(t),t=n-t,Dh(e,0,t<0?0:t)):[]}function CU(e){return typeof e=="function"?e:xo}function Vt(e,t){var r=fe(e)?f_:Is;return r(e,CU(t))}function LU(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function MU(e,t){var r=!0;return Is(e,function(n,i,s){return r=!!t(n,i,s),r}),r}function $n(e,t,r){var n=fe(e)?LU:MU;return n(e,ci(t))}function pb(e,t){var r=[];return Is(e,function(n,i,s){t(n,i,s)&&r.push(n)}),r}function xn(e,t){var r=fe(e)?Wh:pb;return r(e,ci(t))}function UU(e){return function(t,r,n){var i=Object(t);if(!oi(t)){var s=ci(r);t=vn(t),r=function(a){return s(i[a],a,i)}}var o=e(t,r,n);return o>-1?i[s?t[o]:o]:void 0}}var PU=Math.max;function FU(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=r==null?0:ml(r);return i<0&&(i=PU(n+i,0)),h_(e,ci(t),i)}var Ro=UU(FU);function Dn(e){return e&&e.length?e[0]:void 0}function BU(e,t){var r=-1,n=oi(e)?Array(e.length):[];return Is(e,function(i,s,o){n[++r]=t(i,s,o)}),n}function Pt(e,t){var r=fe(e)?pl:BU;return r(e,ci(t))}function An(e,t){return $h(Pt(e,t))}var $U=Object.prototype,DU=$U.hasOwnProperty,mb=RU(function(e,t,r){DU.call(e,r)?e[r].push(t):Oh(e,r,[t])}),jU=Object.prototype,zU=jU.hasOwnProperty;function WU(e,t){return e!=null&&zU.call(e,t)}function Yt(e,t){return e!=null&&fb(e,t,WU)}var HU="[object String]";function Gr(e){return typeof e=="string"||!fe(e)&&Bn(e)&&Xi(e)==HU}function GU(e,t){return pl(t,function(r){return e[r]})}function Ve(e){return e==null?[]:GU(e,vn(e))}var KU=Math.max;function Cr(e,t,r,n){e=oi(e)?e:Ve(e),r=r?ml(r):0;var i=e.length;return r<0&&(r=KU(i+r,0)),Gr(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&Rh(e,t,r)>-1}function gb(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=0;return Rh(e,t,i)}var YU="[object Map]",qU="[object Set]",VU=Object.prototype,XU=VU.hasOwnProperty;function xe(e){if(e==null)return!0;if(oi(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||Na(e)||Lh(e)||bl(e)))return!e.length;var t=kn(e);if(t==YU||t==qU)return!e.size;if(Ia(e))return!A_(e).length;for(var r in e)if(XU.call(e,r))return!1;return!0}var JU="[object RegExp]";function ZU(e){return Bn(e)&&Xi(e)==JU}var yb=Ji&&Ji.isRegExp,Oi=yb?wl(yb):ZU;function Ii(e){return e===void 0}var QU="Expected a function";function t2(e){if(typeof e!="function")throw new TypeError(QU);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function e2(e,t,r,n){if(!En(e))return e;t=kl(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Ua(t[i]),u=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=En(l)?l:yl(t[i+1])?[]:{})}_l(a,c,u),a=a[c]}return e}function r2(e,t,r){for(var n=-1,i=t.length,s={};++n<i;){var o=t[n],a=Fh(e,o);r(a,o)&&e2(s,kl(o,e),a)}return s}function jn(e,t){if(e==null)return{};var r=pl(v6(e),function(n){return[n]});return t=ci(t),r2(e,r,function(n,i){return t(n,i[0])})}function n2(e,t,r,n,i){return i(e,function(s,o,a){r=n?(n=!1,s):t(r,s,o,a)}),r}function Kr(e,t,r){var n=fe(e)?o6:n2,i=arguments.length<3;return n(e,ci(t),r,i,Is)}function Rl(e,t){var r=fe(e)?Wh:pb;return r(e,t2(ci(t)))}function i2(e,t){var r;return Is(e,function(n,i,s){return r=t(n,i,s),!r}),!!r}function Qh(e,t,r){var n=fe(e)?nb:i2;return n(e,ci(t))}var s2=1/0,o2=Ao&&1/Vh(new Ao([,-0]))[1]==s2?function(e){return new Ao(e)}:nr,a2=200;function c2(e,t,r){var n=-1,i=d_,s=e.length,o=!0,a=[],c=a;if(s>=a2){var u=o2(e);if(u)return Vh(u);o=!1,i=qh,c=new To}else c=a;t:for(;++n<s;){var l=e[n],h=l;if(l=l!==0?l:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(l)}else i(c,h,r)||(c!==a&&c.push(h),a.push(l))}return a}function Ol(e){return e&&e.length?c2(e):[]}function td(e){console&&console.error&&console.error(`Error: ${e}`)}function _b(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function bb(e){const t=new Date().getTime(),r=e();return{time:new Date().getTime()-t,value:r}}function wb(e){function t(){}t.prototype=e;const r=new t;function n(){return typeof r.bar}return n(),n(),e}function l2(e){return u2(e)?e.LABEL:e.name}function u2(e){return Gr(e.LABEL)&&e.LABEL!==""}class li{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Vt(this.definition,r=>{r.accept(t)})}}class Yr extends li{constructor(t){super([]),this.idx=1,Hr(this,jn(t,r=>r!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class Oo extends li{constructor(t){super(t.definition),this.orgText="",Hr(this,jn(t,r=>r!==void 0))}}class qr extends li{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Hr(this,jn(t,r=>r!==void 0))}}class Vr extends li{constructor(t){super(t.definition),this.idx=1,Hr(this,jn(t,r=>r!==void 0))}}class ui extends li{constructor(t){super(t.definition),this.idx=1,Hr(this,jn(t,r=>r!==void 0))}}class fi extends li{constructor(t){super(t.definition),this.idx=1,Hr(this,jn(t,r=>r!==void 0))}}class ir extends li{constructor(t){super(t.definition),this.idx=1,Hr(this,jn(t,r=>r!==void 0))}}class zn extends li{constructor(t){super(t.definition),this.idx=1,Hr(this,jn(t,r=>r!==void 0))}}class Wn extends li{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Hr(this,jn(t,r=>r!==void 0))}}class Me{constructor(t){this.idx=1,Hr(this,jn(t,r=>r!==void 0))}accept(t){t.visit(this)}}function f2(e){return Pt(e,Il)}function Il(e){function t(r){return Pt(r,Il)}if(e instanceof Yr){const r={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Gr(e.label)&&(r.label=e.label),r}else{if(e instanceof qr)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Vr)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof ui)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof fi)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Il(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof zn)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Il(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof ir)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Wn)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Me){const r={type:"Terminal",name:e.terminalType.name,label:l2(e.terminalType),idx:e.idx};Gr(e.label)&&(r.terminalLabel=e.label);const n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=Oi(n)?n.source:n),r}else{if(e instanceof Oo)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class Ns{visit(t){const r=t;switch(r.constructor){case Yr:return this.visitNonTerminal(r);case qr:return this.visitAlternative(r);case Vr:return this.visitOption(r);case ui:return this.visitRepetitionMandatory(r);case fi:return this.visitRepetitionMandatoryWithSeparator(r);case zn:return this.visitRepetitionWithSeparator(r);case ir:return this.visitRepetition(r);case Wn:return this.visitAlternation(r);case Me:return this.visitTerminal(r);case Oo:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function h2(e){return e instanceof qr||e instanceof Vr||e instanceof ir||e instanceof ui||e instanceof fi||e instanceof zn||e instanceof Me||e instanceof Oo}function Nl(e,t=[]){return e instanceof Vr||e instanceof ir||e instanceof zn?!0:e instanceof Wn?Qh(e.definition,n=>Nl(n,t)):e instanceof Yr&&Cr(t,e)?!1:e instanceof li?(e instanceof Yr&&t.push(e),$n(e.definition,n=>Nl(n,t))):!1}function d2(e){return e instanceof Wn}function hi(e){if(e instanceof Yr)return"SUBRULE";if(e instanceof Vr)return"OPTION";if(e instanceof Wn)return"OR";if(e instanceof ui)return"AT_LEAST_ONE";if(e instanceof fi)return"AT_LEAST_ONE_SEP";if(e instanceof zn)return"MANY_SEP";if(e instanceof ir)return"MANY";if(e instanceof Me)return"CONSUME";throw Error("non exhaustive match")}class Cl{walk(t,r=[]){Vt(t.definition,(n,i)=>{const s=vr(t.definition,i+1);if(n instanceof Yr)this.walkProdRef(n,s,r);else if(n instanceof Me)this.walkTerminal(n,s,r);else if(n instanceof qr)this.walkFlat(n,s,r);else if(n instanceof Vr)this.walkOption(n,s,r);else if(n instanceof ui)this.walkAtLeastOne(n,s,r);else if(n instanceof fi)this.walkAtLeastOneSep(n,s,r);else if(n instanceof zn)this.walkManySep(n,s,r);else if(n instanceof ir)this.walkMany(n,s,r);else if(n instanceof Wn)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(t,r,n){}walkProdRef(t,r,n){}walkFlat(t,r,n){const i=r.concat(n);this.walk(t,i)}walkOption(t,r,n){const i=r.concat(n);this.walk(t,i)}walkAtLeastOne(t,r,n){const i=[new Vr({definition:t.definition})].concat(r,n);this.walk(t,i)}walkAtLeastOneSep(t,r,n){const i=Eb(t,r,n);this.walk(t,i)}walkMany(t,r,n){const i=[new Vr({definition:t.definition})].concat(r,n);this.walk(t,i)}walkManySep(t,r,n){const i=Eb(t,r,n);this.walk(t,i)}walkOr(t,r,n){const i=r.concat(n);Vt(t.definition,s=>{const o=new qr({definition:[s]});this.walk(o,i)})}}function Eb(e,t,r){return[new Vr({definition:[new Me({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}function Ba(e){if(e instanceof Yr)return Ba(e.referencedRule);if(e instanceof Me)return g2(e);if(h2(e))return p2(e);if(d2(e))return m2(e);throw Error("non exhaustive match")}function p2(e){let t=[];const r=e.definition;let n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=Nl(s),t=t.concat(Ba(s)),n=n+1,i=r.length>n;return Ol(t)}function m2(e){const t=Pt(e.definition,r=>Ba(r));return Ol(an(t))}function g2(e){return[e.terminalType]}const vb="_~IN~_";class y2 extends Cl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,r,n){}walkProdRef(t,r,n){const i=b2(t.referencedRule,t.idx)+this.topProd.name,s=r.concat(n),o=new qr({definition:s}),a=Ba(o);this.follows[i]=a}}function _2(e){const t={};return Vt(e,r=>{const n=new y2(r).startWalking();Hr(t,n)}),t}function b2(e,t){return e.name+t+vb}function Xt(e){return e.charCodeAt(0)}function ed(e,t){Array.isArray(e)?e.forEach(function(r){t.push(r)}):t.push(e)}function $a(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function Io(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function w2(){throw Error("Internal Error - Should never get here!")}function kb(e){return e.type==="Character"}const Ll=[];for(let e=Xt("0");e<=Xt("9");e++)Ll.push(e);const Ml=[Xt("_")].concat(Ll);for(let e=Xt("a");e<=Xt("z");e++)Ml.push(e);for(let e=Xt("A");e<=Xt("Z");e++)Ml.push(e);const xb=[Xt(" "),Xt("\f"),Xt(`
`),Xt("\r"),Xt("	"),Xt("\v"),Xt("	"),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt(" "),Xt("\u2028"),Xt("\u2029"),Xt(" "),Xt(" "),Xt("　"),Xt("\uFEFF")],E2=/[0-9a-fA-F]/,Ul=/[0-9]/,v2=/[1-9]/;class k2{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const r=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":$a(n,"global");break;case"i":$a(n,"ignoreCase");break;case"m":$a(n,"multiLine");break;case"u":$a(n,"unicode");break;case"y":$a(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){const t=[],r=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(r)}}alternative(){const t=[],r=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}Io(r);const n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(t)}}return w2()}quantifier(t=!1){let r;const n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&r===void 0)return;Io(r);break}if(!(t===!0&&r===void 0)&&Io(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let t;const r=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),Io(t))return t.loc=this.loc(r),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Xt(`
`),Xt("\r"),Xt("\u2028"),Xt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,r=!1;switch(this.popChar()){case"d":t=Ll;break;case"D":t=Ll,r=!0;break;case"s":t=xb;break;case"S":t=xb,r=!0;break;case"w":t=Ml;break;case"W":t=Ml,r=!0;break}if(Io(t))return{type:"Set",value:t,complement:r}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Xt("\f");break;case"n":t=Xt(`
`);break;case"r":t=Xt("\r");break;case"t":t=Xt("	");break;case"v":t=Xt("\v");break}if(Io(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Xt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Xt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Xt(t)}}}characterClass(){const t=[];let r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){const n=this.classAtom();if(n.type,kb(n)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,kb(i)){if(i.value<n.value)throw Error("Range out of order in character class");t.push({from:n.value,to:i.value})}else ed(n.value,t),t.push(Xt("-")),ed(i.value,t)}else ed(n.value,t)}return this.consumeChar("]"),{type:"Set",complement:r,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Xt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const r=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:t,value:r};return t&&(n.idx=this.groupIdx),n}positiveInteger(){let t=this.popChar();if(v2.test(t)===!1)throw Error("Expecting a positive integer");for(;Ul.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Ul.test(t)===!1)throw Error("Expecting an integer");for(;Ul.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Xt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Ul.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let r="";for(let i=0;i<t;i++){const s=this.popChar();if(E2.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class rd{visitChildren(t){for(const r in t){const n=t[r];t.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Pl={};const x2=new k2;function Fl(e){const t=e.toString();if(Pl.hasOwnProperty(t))return Pl[t];{const r=x2.pattern(t);return Pl[t]=r,r}}function A2(){Pl={}}const Ab="Complement Sets are not supported for first char optimization",Bl=`Unable to use "first char" lexer optimizations:
`;function T2(e,t=!1){try{const r=Fl(e);return nd(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===Ab)t&&_b(`${Bl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";t&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),td(`${Bl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function nd(e,t,r){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)nd(e.value[i],t,r);break;case"Alternative":const n=e.value;for(let i=0;i<n.length;i++){const s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":$l(o.value,t,r);break;case"Set":if(o.complement===!0)throw Error(Ab);Vt(o.value,c=>{if(typeof c=="number")$l(c,t,r);else{const u=c;if(r===!0)for(let l=u.from;l<=u.to;l++)$l(l,t,r);else{for(let l=u.from;l<=u.to&&l<ja;l++)$l(l,t,r);if(u.to>=ja){const l=u.from>=ja?u.from:ja,h=u.to,d=Zi(l),f=Zi(h);for(let m=d;m<=f;m++)t[m]=m}}}});break;case"Group":nd(o.value,t,r);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&id(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ve(t)}function $l(e,t,r){const n=Zi(e);t[n]=n,r===!0&&S2(e,t)}function S2(e,t){const r=String.fromCharCode(e),n=r.toUpperCase();if(n!==r){const i=Zi(n.charCodeAt(0));t[i]=i}else{const i=r.toLowerCase();if(i!==r){const s=Zi(i.charCodeAt(0));t[s]=s}}}function Tb(e,t){return Ro(e.value,r=>{if(typeof r=="number")return Cr(t,r);{const n=r;return Ro(t,i=>n.from<=i&&i<=n.to)!==void 0}})}function id(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?fe(e.value)?$n(e.value,id):id(e.value):!1}class R2 extends rd{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Cr(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Tb(t,this.targetCharCodes)===void 0&&(this.found=!0):Tb(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function sd(e,t){if(t instanceof RegExp){const r=Fl(t),n=new R2(e);return n.visit(r),n.found}else return Ro(t,r=>Cr(e,r.charCodeAt(0)))!==void 0}const Cs="PATTERN",Da="defaultMode",Dl="modes";let Sb=typeof new RegExp("(?:)").sticky=="boolean";function O2(e,t){t=Zh(t,{useSticky:Sb,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(b,S)=>S()});const r=t.tracer;r("initCharCodeToOptimizedIndexMap",()=>{Z2()});let n;r("Reject Lexer.NA",()=>{n=Rl(e,b=>b[Cs]===hr.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=Pt(n,b=>{const S=b[Cs];if(Oi(S)){const T=S.source;return T.length===1&&T!=="^"&&T!=="$"&&T!=="."&&!S.ignoreCase?T:T.length===2&&T[0]==="\\"&&!Cr(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],T[1])?T[1]:t.useSticky?Ob(S):Rb(S)}else{if(Ti(S))return i=!0,{exec:S};if(typeof S=="object")return i=!0,S;if(typeof S=="string"){if(S.length===1)return S;{const T=S.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),x=new RegExp(T);return t.useSticky?Ob(x):Rb(x)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;r("misc mapping",()=>{o=Pt(n,b=>b.tokenTypeIdx),a=Pt(n,b=>{const S=b.GROUP;if(S!==hr.SKIPPED){if(Gr(S))return S;if(Ii(S))return!1;throw Error("non exhaustive match")}}),c=Pt(n,b=>{const S=b.LONGER_ALT;if(S)return fe(S)?Pt(S,x=>gb(n,x)):[gb(n,S)]}),u=Pt(n,b=>b.PUSH_MODE),l=Pt(n,b=>Yt(b,"POP_MODE"))});let h;r("Line Terminator Handling",()=>{const b=Cb(t.lineTerminatorCharacters);h=Pt(n,S=>!1),t.positionTracking!=="onlyOffset"&&(h=Pt(n,S=>Yt(S,"LINE_BREAKS")?!!S.LINE_BREAKS:Nb(S,b)===!1&&sd(b,S.PATTERN)))});let d,f,m,p;r("Misc Mapping #2",()=>{d=Pt(n,Ib),f=Pt(s,V2),m=Kr(n,(b,S)=>{const T=S.GROUP;return Gr(T)&&T!==hr.SKIPPED&&(b[T]=[]),b},{}),p=Pt(s,(b,S)=>({pattern:s[S],longerAlt:c[S],canLineTerminator:h[S],isCustom:d[S],short:f[S],group:a[S],push:u[S],pop:l[S],tokenTypeIdx:o[S],tokenType:n[S]}))});let g=!0,y=[];return t.safeMode||r("First Char Optimization",()=>{y=Kr(n,(b,S,T)=>{if(typeof S.PATTERN=="string"){const x=S.PATTERN.charCodeAt(0),N=Zi(x);od(b,N,p[T])}else if(fe(S.START_CHARS_HINT)){let x;Vt(S.START_CHARS_HINT,N=>{const R=typeof N=="string"?N.charCodeAt(0):N,B=Zi(R);x!==B&&(x=B,od(b,B,p[T]))})}else if(Oi(S.PATTERN))if(S.PATTERN.unicode)g=!1,t.ensureOptimizations&&td(`${Bl}	Unable to analyze < ${S.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const x=T2(S.PATTERN,t.ensureOptimizations);xe(x)&&(g=!1),Vt(x,N=>{od(b,N,p[T])})}else t.ensureOptimizations&&td(`${Bl}	TokenType: <${S.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return b},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:g}}function I2(e,t){let r=[];const n=C2(e);r=r.concat(n.errors);const i=L2(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(N2(s)),r=r.concat(j2(s)),r=r.concat(z2(s,t)),r=r.concat(W2(s)),r}function N2(e){let t=[];const r=xn(e,n=>Oi(n[Cs]));return t=t.concat(U2(r)),t=t.concat(B2(r)),t=t.concat($2(r)),t=t.concat(D2(r)),t=t.concat(P2(r)),t}function C2(e){const t=xn(e,i=>!Yt(i,Cs)),r=Pt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Be.MISSING_PATTERN,tokenTypes:[i]})),n=Sl(e,t);return{errors:r,valid:n}}function L2(e){const t=xn(e,i=>{const s=i[Cs];return!Oi(s)&&!Ti(s)&&!Yt(s,"exec")&&!Gr(s)}),r=Pt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Be.INVALID_PATTERN,tokenTypes:[i]})),n=Sl(e,t);return{errors:r,valid:n}}const M2=/[^\\][$]/;function U2(e){class t extends rd{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const r=xn(e,i=>{const s=i.PATTERN;try{const o=Fl(s),a=new t;return a.visit(o),a.found}catch{return M2.test(s.source)}});return Pt(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function P2(e){const t=xn(e,n=>n.PATTERN.test(""));return Pt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:Be.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}const F2=/[^\\[][\^]|^\^/;function B2(e){class t extends rd{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const r=xn(e,i=>{const s=i.PATTERN;try{const o=Fl(s),a=new t;return a.visit(o),a.found}catch{return F2.test(s.source)}});return Pt(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function $2(e){const t=xn(e,n=>{const i=n[Cs];return i instanceof RegExp&&(i.multiline||i.global)});return Pt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Be.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function D2(e){const t=[];let r=Pt(e,s=>Kr(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Cr(t,a)&&a.PATTERN!==hr.NA&&(t.push(a),o.push(a)),o),[]));r=Pa(r);const n=xn(r,s=>s.length>1);return Pt(n,s=>{const o=Pt(s,c=>c.name);return{message:`The same RegExp pattern ->${Dn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Be.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function j2(e){const t=xn(e,n=>{if(!Yt(n,"GROUP"))return!1;const i=n.GROUP;return i!==hr.SKIPPED&&i!==hr.NA&&!Gr(i)});return Pt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Be.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function z2(e,t){const r=xn(e,i=>i.PUSH_MODE!==void 0&&!Cr(t,i.PUSH_MODE));return Pt(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Be.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function W2(e){const t=[],r=Kr(e,(n,i,s)=>{const o=i.PATTERN;return o===hr.NA||(Gr(o)?n.push({str:o,idx:s,tokenType:i}):Oi(o)&&G2(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return Vt(e,(n,i)=>{Vt(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&H2(s,n.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Be.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),t}function H2(e,t){if(Oi(t)){const r=t.exec(e);return r!==null&&r.index===0}else{if(Ti(t))return t(e,0,[],{});if(Yt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function G2(e){return Ro([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>e.source.indexOf(r)!==-1)===void 0}function Rb(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Ob(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function K2(e,t,r){const n=[];return Yt(e,Da)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Da+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Yt(e,Dl)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Dl+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Yt(e,Dl)&&Yt(e,Da)&&!Yt(e.modes,e.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${Da}: <${e.defaultMode}>which does not exist
`,type:Be.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Yt(e,Dl)&&Vt(e.modes,(i,s)=>{Vt(i,(o,a)=>{if(Ii(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Be.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Yt(o,"LONGER_ALT")){const c=fe(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Vt(c,u=>{!Ii(u)&&!Cr(i,u)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Be.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function Y2(e,t,r){const n=[];let i=!1;const s=Pa(an(Ve(e.modes))),o=Rl(s,c=>c[Cs]===hr.NA),a=Cb(r);return t&&Vt(o,c=>{const u=Nb(c,a);if(u!==!1){const h={message:J2(c,u),type:u.issue,tokenType:c};n.push(h)}else Yt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):sd(a,c.PATTERN)&&(i=!0)}),t&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Be.NO_LINE_BREAKS_FLAGS}),n}function q2(e){const t={},r=vn(e);return Vt(r,n=>{const i=e[n];if(fe(i))t[n]=[];else throw Error("non exhaustive match")}),t}function Ib(e){const t=e.PATTERN;if(Oi(t))return!1;if(Ti(t))return!0;if(Yt(t,"exec"))return!0;if(Gr(t))return!1;throw Error("non exhaustive match")}function V2(e){return Gr(e)&&e.length===1?e.charCodeAt(0):!1}const X2={test:function(e){const t=e.length;for(let r=this.lastIndex;r<t;r++){const n=e.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return e.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function Nb(e,t){if(Yt(e,"LINE_BREAKS"))return!1;if(Oi(e.PATTERN)){try{sd(t,e.PATTERN)}catch(r){return{issue:Be.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(Gr(e.PATTERN))return!1;if(Ib(e))return{issue:Be.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function J2(e,t){if(t.issue===Be.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Be.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Cb(e){return Pt(e,r=>Gr(r)?r.charCodeAt(0):r)}function od(e,t,r){e[t]===void 0?e[t]=[r]:e[t].push(r)}const ja=256;let jl=[];function Zi(e){return e<ja?e:jl[e]}function Z2(){if(xe(jl)){jl=new Array(65536);for(let e=0;e<65536;e++)jl[e]=e>255?255+~~(e/255):e}}function za(e,t){const r=e.tokenTypeIdx;return r===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[r]===!0}function zl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let Lb=1;const Mb={};function Wa(e){const t=Q2(e);t8(t),r8(t),e8(t),Vt(t,r=>{r.isParent=r.categoryMatches.length>0})}function Q2(e){let t=Er(e),r=e,n=!0;for(;n;){r=Pa(an(Pt(r,s=>s.CATEGORIES)));const i=Sl(r,t);t=t.concat(i),xe(i)?n=!1:r=i}return t}function t8(e){Vt(e,t=>{Pb(t)||(Mb[Lb]=t,t.tokenTypeIdx=Lb++),Fb(t)&&!fe(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),Fb(t)||(t.CATEGORIES=[]),n8(t)||(t.categoryMatches=[]),i8(t)||(t.categoryMatchesMap={})})}function e8(e){Vt(e,t=>{t.categoryMatches=[],Vt(t.categoryMatchesMap,(r,n)=>{t.categoryMatches.push(Mb[n].tokenTypeIdx)})})}function r8(e){Vt(e,t=>{Ub([],t)})}function Ub(e,t){Vt(e,r=>{t.categoryMatchesMap[r.tokenTypeIdx]=!0}),Vt(t.CATEGORIES,r=>{const n=e.concat(t);Cr(n,r)||Ub(n,r)})}function Pb(e){return Yt(e,"tokenTypeIdx")}function Fb(e){return Yt(e,"CATEGORIES")}function n8(e){return Yt(e,"categoryMatches")}function i8(e){return Yt(e,"categoryMatchesMap")}function s8(e){return Yt(e,"tokenTypeIdx")}const o8={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,r,n,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${r} characters.`}};var Be;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Be||(Be={}));const Ha={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:o8,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Ha);let hr=class{constructor(t,r=Ha){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=bb(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Hr({},Ha,r);const n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Ha.lineTerminatorsPattern)this.config.lineTerminatorsPattern=X2;else if(this.config.lineTerminatorCharacters===Ha.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),fe(t)?i={modes:{defaultMode:Er(t)},defaultMode:Da}:(s=!1,i=Er(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(K2(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(Y2(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Vt(i.modes,(a,c)=>{i.modes[c]=Rl(a,u=>Ii(u))});const o=vn(i.modes);if(Vt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(I2(a,o))}),xe(this.lexerDefinitionErrors)){Wa(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=O2(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=Hr({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!xe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Pt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Vt(this.lexerDefinitionWarning,a=>{_b(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Sb?(this.chopInput=xo,this.match=this.matchWithTest):(this.updateLastIndex=nr,this.match=this.matchWithExec),s&&(this.handleModes=nr),this.trackStartLines===!1&&(this.computeNewColumn=xo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=nr),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Kr(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(r.ensureOptimizations&&!xe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{A2()}),this.TRACE_INIT("toFastProperties",()=>{wb(this)})})}tokenize(t,r=this.defaultMode){if(!xe(this.lexerDefinitionErrors)){const i=Pt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,r)}tokenizeInternal(t,r){let n,i,s,o,a,c,u,l,h,d,f,m,p,g,y;const b=t,S=b.length;let T=0,x=0;const N=this.hasCustom?0:Math.floor(t.length/10),R=new Array(N),B=[];let M=this.trackStartLines?1:void 0,H=this.trackStartLines?1:void 0;const V=q2(this.emptyGroups),O=this.trackStartLines,I=this.config.lineTerminatorsPattern;let v=0,L=[],z=[];const U=[],Y=[];Object.freeze(Y);let X;function K(){return L}function W(wt){const Rt=Zi(wt),Ct=z[Rt];return Ct===void 0?Y:Ct}const P=wt=>{if(U.length===1&&wt.tokenType.PUSH_MODE===void 0){const Rt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(wt);B.push({offset:wt.startOffset,line:wt.startLine,column:wt.startColumn,length:wt.image.length,message:Rt})}else{U.pop();const Rt=So(U);L=this.patternIdxToConfig[Rt],z=this.charCodeToPatternIdxToConfig[Rt],v=L.length;const Ct=this.canModeBeOptimized[Rt]&&this.config.safeMode===!1;z&&Ct?X=W:X=K}};function ot(wt){U.push(wt),z=this.charCodeToPatternIdxToConfig[wt],L=this.patternIdxToConfig[wt],v=L.length,v=L.length;const Rt=this.canModeBeOptimized[wt]&&this.config.safeMode===!1;z&&Rt?X=W:X=K}ot.call(this,r);let G;const rt=this.config.recoveryEnabled;for(;T<S;){c=null;const wt=b.charCodeAt(T),Rt=X(wt),Ct=Rt.length;for(n=0;n<Ct;n++){G=Rt[n];const Et=G.pattern;u=null;const vt=G.short;if(vt!==!1?wt===vt&&(c=Et):G.isCustom===!0?(y=Et.exec(b,T,R,V),y!==null?(c=y[0],y.payload!==void 0&&(u=y.payload)):c=null):(this.updateLastIndex(Et,T),c=this.match(Et,t,T)),c!==null){if(a=G.longerAlt,a!==void 0){const At=a.length;for(s=0;s<At;s++){const Ut=L[a[s]],Dt=Ut.pattern;if(l=null,Ut.isCustom===!0?(y=Dt.exec(b,T,R,V),y!==null?(o=y[0],y.payload!==void 0&&(l=y.payload)):o=null):(this.updateLastIndex(Dt,T),o=this.match(Dt,t,T)),o&&o.length>c.length){c=o,u=l,G=Ut;break}}}break}}if(c!==null){if(h=c.length,d=G.group,d!==void 0&&(f=G.tokenTypeIdx,m=this.createTokenInstance(c,T,f,G.tokenType,M,H,h),this.handlePayload(m,u),d===!1?x=this.addToken(R,x,m):V[d].push(m)),t=this.chopInput(t,h),T=T+h,H=this.computeNewColumn(H,h),O===!0&&G.canLineTerminator===!0){let Et=0,vt,At;I.lastIndex=0;do vt=I.test(c),vt===!0&&(At=I.lastIndex-1,Et++);while(vt===!0);Et!==0&&(M=M+Et,H=h-At,this.updateTokenEndLineColumnLocation(m,d,At,Et,M,H,h))}this.handleModes(G,P,ot,m)}else{const Et=T,vt=M,At=H;let Ut=rt===!1;for(;Ut===!1&&T<S;)for(t=this.chopInput(t,1),T++,i=0;i<v;i++){const Dt=L[i],A=Dt.pattern,ut=Dt.short;if(ut!==!1?b.charCodeAt(T)===ut&&(Ut=!0):Dt.isCustom===!0?Ut=A.exec(b,T,R,V)!==null:(this.updateLastIndex(A,T),Ut=A.exec(t)!==null),Ut===!0)break}if(p=T-Et,H=this.computeNewColumn(H,p),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,Et,p,vt,At),B.push({offset:Et,line:vt,column:At,length:p,message:g}),rt===!1)break}}return this.hasCustom||(R.length=x),{tokens:R,groups:V,errors:B}}handleModes(t,r,n,i){if(t.pop===!0){const s=t.push;r(i),s!==void 0&&n.call(this,s)}else t.push!==void 0&&n.call(this,t.push)}chopInput(t,r){return t.substring(r)}updateLastIndex(t,r){t.lastIndex=r}updateTokenEndLineColumnLocation(t,r,n,i,s,o,a){let c,u;r!==void 0&&(c=n===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,r){return t+r}createOffsetOnlyToken(t,r,n,i){return{image:t,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(t,r,n,i,s,o){return{image:t,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(t,r,n,i,s,o,a){return{image:t,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(t,r,n){return t.push(n),r}addTokenUsingMemberAccess(t,r,n){return t[r]=n,r++,r}handlePayloadNoCustom(t,r){}handlePayloadWithCustom(t,r){r!==null&&(t.payload=r)}matchWithTest(t,r,n){return t.test(r)===!0?r.substring(n,t.lastIndex):null}matchWithExec(t,r){const n=t.exec(r);return n!==null?n[0]:null}};hr.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",hr.NA=/NOT_APPLICABLE/;function Ga(e){return Bb(e)?e.LABEL:e.name}function Bb(e){return Gr(e.LABEL)&&e.LABEL!==""}const a8="parent",$b="categories",Db="label",jb="group",zb="push_mode",Wb="pop_mode",Hb="longer_alt",Gb="line_breaks",Kb="start_chars_hint";function cn(e){return c8(e)}function c8(e){const t=e.pattern,r={};if(r.name=e.name,Ii(t)||(r.PATTERN=t),Yt(e,a8))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Yt(e,$b)&&(r.CATEGORIES=e[$b]),Wa([r]),Yt(e,Db)&&(r.LABEL=e[Db]),Yt(e,jb)&&(r.GROUP=e[jb]),Yt(e,Wb)&&(r.POP_MODE=e[Wb]),Yt(e,zb)&&(r.PUSH_MODE=e[zb]),Yt(e,Hb)&&(r.LONGER_ALT=e[Hb]),Yt(e,Gb)&&(r.LINE_BREAKS=e[Gb]),Yt(e,Kb)&&(r.START_CHARS_HINT=e[Kb]),r}const Ls=cn({name:"EOF",pattern:hr.NA});Wa([Ls]);function Wl(e,t,r,n,i,s,o,a){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function l8(e,t){return za(e,t)}const Yb={buildMismatchTokenMessage({expected:e,actual:t,previous:r,ruleName:n}){return`Expecting ${Bb(e)?`--> ${Ga(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:r,customUserDescription:n,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Dn(t).image+"'";if(n)return s+n+a;{const c=Kr(e,(d,f)=>d.concat(f),[]),u=Pt(c,d=>`[${Pt(d,f=>Ga(f)).join(", ")}]`),h=`one of these possible Token sequences:
${Pt(u,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:r,ruleName:n}){const i="Expecting: ",o=`
but found: '`+Dn(t).image+"'";if(r)return i+r+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Pt(e,u=>`[${Pt(u,l=>Ga(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Yb);const u8={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},Ms={buildDuplicateFoundError(e,t){function r(l){return l instanceof Me?l.terminalType.name:l instanceof Yr?l.nonTerminalName:""}const n=e.name,i=Dn(t),s=i.idx,o=hi(i),a=r(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Pt(e.prefixPath,i=>Ga(i)).join(", "),r=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Pt(e.prefixPath,i=>Ga(i)).join(", "),r=e.alternation.idx===0?"":e.alternation.idx;let n=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(e){let t=hi(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,r=Pt(e.leftRecursionPath,s=>s.name),n=`${t} --> ${r.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof Oo?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function f8(e,t){const r=new h8(e,t);return r.resolveRefs(),r.errors}class h8 extends Ns{constructor(t,r){super(),this.nameToTopRule=t,this.errMsgProvider=r,this.errors=[]}resolveRefs(){Vt(Ve(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{const n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:Lr.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class d8 extends Cl{constructor(t,r){super(),this.topProd=t,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Er(this.path.ruleStack).reverse(),this.occurrenceStack=Er(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,r=[]){this.found||super.walk(t,r)}walkProdRef(t,r,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=r.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){xe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class p8 extends d8{constructor(t,r){super(t,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,r,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=r.concat(n),s=new qr({definition:i});this.possibleTokTypes=Ba(s),this.found=!0}}}class Hl extends Cl{constructor(t,r){super(),this.topRule=t,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class m8 extends Hl{walkMany(t,r,n){if(t.idx===this.occurrence){const i=Dn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,r,n)}}class qb extends Hl{walkManySep(t,r,n){if(t.idx===this.occurrence){const i=Dn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,r,n)}}class g8 extends Hl{walkAtLeastOne(t,r,n){if(t.idx===this.occurrence){const i=Dn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,r,n)}}class Vb extends Hl{walkAtLeastOneSep(t,r,n){if(t.idx===this.occurrence){const i=Dn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,r,n)}}function ad(e,t,r=[]){r=Er(r);let n=[],i=0;function s(a){return a.concat(vr(e,i+1))}function o(a){const c=ad(s(a),t,r);return n.concat(c)}for(;r.length<t&&i<e.length;){const a=e[i];if(a instanceof qr)return o(a.definition);if(a instanceof Yr)return o(a.definition);if(a instanceof Vr)n=o(a.definition);else if(a instanceof ui){const c=a.definition.concat([new ir({definition:a.definition})]);return o(c)}else if(a instanceof fi){const c=[new qr({definition:a.definition}),new ir({definition:[new Me({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof zn){const c=a.definition.concat([new ir({definition:[new Me({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof ir){const c=a.definition.concat([new ir({definition:a.definition})]);n=o(c)}else{if(a instanceof Wn)return Vt(a.definition,c=>{xe(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof Me)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:vr(e,i)}),n}function Xb(e,t,r,n){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-n-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!xe(h);){const d=h.pop();if(d===o){a&&So(h).idx<=u&&h.pop();continue}const f=d.def,m=d.idx,p=d.ruleStack,g=d.occurrenceStack;if(xe(f))continue;const y=f[0];if(y===i){const b={idx:m,def:vr(f),ruleStack:Fa(p),occurrenceStack:Fa(g)};h.push(b)}else if(y instanceof Me)if(m<c-1){const b=m+1,S=t[b];if(r(S,y.terminalType)){const T={idx:b,def:vr(f),ruleStack:p,occurrenceStack:g};h.push(T)}}else if(m===c-1)l.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:p,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(y instanceof Yr){const b=Er(p);b.push(y.nonTerminalName);const S=Er(g);S.push(y.idx);const T={idx:m,def:y.definition.concat(s,vr(f)),ruleStack:b,occurrenceStack:S};h.push(T)}else if(y instanceof Vr){const b={idx:m,def:vr(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const S={idx:m,def:y.definition.concat(vr(f)),ruleStack:p,occurrenceStack:g};h.push(S)}else if(y instanceof ui){const b=new ir({definition:y.definition,idx:y.idx}),S=y.definition.concat([b],vr(f)),T={idx:m,def:S,ruleStack:p,occurrenceStack:g};h.push(T)}else if(y instanceof fi){const b=new Me({terminalType:y.separator}),S=new ir({definition:[b].concat(y.definition),idx:y.idx}),T=y.definition.concat([S],vr(f)),x={idx:m,def:T,ruleStack:p,occurrenceStack:g};h.push(x)}else if(y instanceof zn){const b={idx:m,def:vr(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const S=new Me({terminalType:y.separator}),T=new ir({definition:[S].concat(y.definition),idx:y.idx}),x=y.definition.concat([T],vr(f)),N={idx:m,def:x,ruleStack:p,occurrenceStack:g};h.push(N)}else if(y instanceof ir){const b={idx:m,def:vr(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const S=new ir({definition:y.definition,idx:y.idx}),T=y.definition.concat([S],vr(f)),x={idx:m,def:T,ruleStack:p,occurrenceStack:g};h.push(x)}else if(y instanceof Wn)for(let b=y.definition.length-1;b>=0;b--){const S=y.definition[b],T={idx:m,def:S.definition.concat(vr(f)),ruleStack:p,occurrenceStack:g};h.push(T),h.push(o)}else if(y instanceof qr)h.push({idx:m,def:y.definition.concat(vr(f)),ruleStack:p,occurrenceStack:g});else if(y instanceof Oo)h.push(y8(y,m,p,g));else throw Error("non exhaustive match")}return l}function y8(e,t,r,n){const i=Er(r);i.push(e.name);const s=Er(n);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var $e;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})($e||($e={}));function Jb(e){if(e instanceof Vr||e==="Option")return $e.OPTION;if(e instanceof ir||e==="Repetition")return $e.REPETITION;if(e instanceof ui||e==="RepetitionMandatory")return $e.REPETITION_MANDATORY;if(e instanceof fi||e==="RepetitionMandatoryWithSeparator")return $e.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof zn||e==="RepetitionWithSeparator")return $e.REPETITION_WITH_SEPARATOR;if(e instanceof Wn||e==="Alternation")return $e.ALTERNATION;throw Error("non exhaustive match")}function _8(e,t,r,n,i,s){const o=ld(e,t,r),a=e1(o)?zl:za;return s(o,n,a,i)}function b8(e,t,r,n,i,s){const o=ud(e,t,i,r),a=e1(o)?zl:za;return s(o[0],a,n)}function w8(e,t,r,n){const i=e.length,s=$n(e,o=>$n(o,a=>a.length===1));if(t)return function(o){const a=Pt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<l;d++){const f=u[d],m=f.length;for(let p=0;p<m;p++){const g=this.LA(p+1);if(r(g,f[p])===!1)continue t}return c}}};if(s&&!n){const o=Pt(e,c=>an(c)),a=Kr(o,(c,u,l)=>(Vt(u,h=>{Yt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),Vt(h.categoryMatches,d=>{Yt(c,d)||(c[d]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(r(f,l[d])===!1)continue t}return o}}}}function E8(e,t,r){const n=$n(e,s=>s.length===1),i=e.length;if(n&&!r){const s=an(e);if(s.length===1&&xe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Kr(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,Vt(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class v8 extends Cl{constructor(t,r,n){super(),this.topProd=t,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,r,n,i){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(t,r,n){this.checkIsTarget(t,$e.OPTION,r,n)||super.walkOption(t,r,n)}walkAtLeastOne(t,r,n){this.checkIsTarget(t,$e.REPETITION_MANDATORY,r,n)||super.walkOption(t,r,n)}walkAtLeastOneSep(t,r,n){this.checkIsTarget(t,$e.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(t,r,n)}walkMany(t,r,n){this.checkIsTarget(t,$e.REPETITION,r,n)||super.walkOption(t,r,n)}walkManySep(t,r,n){this.checkIsTarget(t,$e.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(t,r,n)}}class Zb extends Ns{constructor(t,r,n){super(),this.targetOccurrence=t,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,$e.OPTION)}visitRepetition(t){this.checkIsTarget(t,$e.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,$e.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,$e.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,$e.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,$e.ALTERNATION)}}function Qb(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=[];return t}function cd(e){let t=[""];for(let r=0;r<e.length;r++){const n=e[r],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){const c="_"+n.categoryMatches[a];i.push(o+c)}}t=i}return t}function k8(e,t,r){for(let n=0;n<e.length;n++){if(n===r)continue;const i=e[n];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function t1(e,t){const r=Pt(e,o=>ad([o],1)),n=Qb(r.length),i=Pt(r,o=>{const a={};return Vt(o,c=>{const u=cd(c.partialPath);Vt(u,l=>{a[l]=!0})}),a});let s=r;for(let o=1;o<=t;o++){const a=s;s=Qb(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,d=u[l].suffixDef,f=cd(h);if(k8(i,f,c)||xe(d)||h.length===t){const p=n[c];if(fd(p,h)===!1){p.push(h);for(let g=0;g<f.length;g++){const y=f[g];i[c][y]=!0}}}else{const p=ad(d,o+1,h);s[c]=s[c].concat(p),Vt(p,g=>{const y=cd(g.partialPath);Vt(y,b=>{i[c][b]=!0})})}}}}return n}function ld(e,t,r,n){const i=new Zb(e,$e.ALTERNATION,n);return t.accept(i),t1(i.result,r)}function ud(e,t,r,n){const i=new Zb(e,r);t.accept(i);const s=i.result,a=new v8(t,e,r).startWalking(),c=new qr({definition:s}),u=new qr({definition:a});return t1([c,u],n)}function fd(e,t){t:for(let r=0;r<e.length;r++){const n=e[r];if(n.length===t.length){for(let i=0;i<n.length;i++){const s=t[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function x8(e,t){return e.length<t.length&&$n(e,(r,n)=>{const i=t[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function e1(e){return $n(e,t=>$n(t,r=>$n(r,n=>xe(n.categoryMatches))))}function A8(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Pt(t,r=>Object.assign({type:Lr.CUSTOM_LOOKAHEAD_VALIDATION},r))}function T8(e,t,r,n){const i=An(e,c=>S8(c,r)),s=$8(e,t,r),o=An(e,c=>U8(c,r)),a=An(e,c=>I8(c,e,n,r));return i.concat(s,o,a)}function S8(e,t){const r=new O8;e.accept(r);const n=r.allProductions,i=mb(n,R8),s=jn(i,a=>a.length>1);return Pt(Ve(s),a=>{const c=Dn(a),u=t.buildDuplicateFoundError(e,a),l=hi(c),h={message:u,type:Lr.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},d=r1(c);return d&&(h.parameter=d),h})}function R8(e){return`${hi(e)}_#_${e.idx}_#_${r1(e)}`}function r1(e){return e instanceof Me?e.terminalType.name:e instanceof Yr?e.nonTerminalName:""}class O8 extends Ns{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function I8(e,t,r,n){const i=[];if(Kr(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:o,type:Lr.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function N8(e,t,r){const n=[];let i;return Cr(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:Lr.INVALID_RULE_OVERRIDE,ruleName:e})),n}function n1(e,t,r,n=[]){const i=[],s=Gl(t.definition);if(xe(s))return[];{const o=e.name;Cr(s,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:Lr.LEFT_RECURSION,ruleName:o});const c=Sl(s,n.concat([e])),u=An(c,l=>{const h=Er(n);return h.push(l),n1(e,l,r,h)});return i.concat(u)}}function Gl(e){let t=[];if(xe(e))return t;const r=Dn(e);if(r instanceof Yr)t.push(r.referencedRule);else if(r instanceof qr||r instanceof Vr||r instanceof ui||r instanceof fi||r instanceof zn||r instanceof ir)t=t.concat(Gl(r.definition));else if(r instanceof Wn)t=an(Pt(r.definition,s=>Gl(s.definition)));else if(!(r instanceof Me))throw Error("non exhaustive match");const n=Nl(r),i=e.length>1;if(n&&i){const s=vr(e);return t.concat(Gl(s))}else return t}class hd extends Ns{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function C8(e,t){const r=new hd;e.accept(r);const n=r.alternations;return An(n,s=>{const o=Fa(s.definition);return An(o,(a,c)=>{const u=Xb([a],[],za,1);return xe(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:Lr.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function L8(e,t,r){const n=new hd;e.accept(n);let i=n.alternations;return i=Rl(i,o=>o.ignoreAmbiguities===!0),An(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=ld(a,e,c,o),l=F8(u,o,e,r),h=B8(u,o,e,r);return l.concat(h)})}class M8 extends Ns{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function U8(e,t){const r=new hd;e.accept(r);const n=r.alternations;return An(n,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:Lr.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function P8(e,t,r){const n=[];return Vt(e,i=>{const s=new M8;i.accept(s);const o=s.allProductions;Vt(o,a=>{const c=Jb(a),u=a.maxLookahead||t,l=a.idx,d=ud(l,i,c,u)[0];if(xe(an(d))){const f=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:f,type:Lr.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function F8(e,t,r,n){const i=[],s=Kr(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||Vt(c,l=>{const h=[u];Vt(e,(d,f)=>{u!==f&&fd(d,l)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!fd(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return Pt(s,a=>{const c=Pt(a.alts,l=>l+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Lr.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:a.alts}})}function B8(e,t,r,n){const i=Kr(e,(o,a,c)=>{const u=Pt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return Pa(An(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=xn(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&x8(d.path,u));return Pt(l,d=>{const f=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:Lr.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:m,alternatives:f}})}))}function $8(e,t,r){const n=[],i=Pt(t,s=>s.name);return Vt(e,s=>{const o=s.name;if(Cr(i,o)){const a=r.buildNamespaceConflictError(s);n.push({message:a,type:Lr.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function D8(e){const t=Zh(e,{errMsgProvider:u8}),r={};return Vt(e.rules,n=>{r[n.name]=n}),f8(r,t.errMsgProvider)}function j8(e){return e=Zh(e,{errMsgProvider:Ms}),T8(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const i1="MismatchedTokenException",s1="NoViableAltException",o1="EarlyExitException",a1="NotAllInputParsedException",c1=[i1,s1,o1,a1];Object.freeze(c1);function Kl(e){return Cr(c1,e.name)}class Yl extends Error{constructor(t,r){super(t),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class l1 extends Yl{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=i1}}class z8 extends Yl{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=s1}}class W8 extends Yl{constructor(t,r){super(t,r),this.name=a1}}class H8 extends Yl{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=o1}}const dd={},u1="InRuleRecoveryException";class G8 extends Error{constructor(t){super(t),this.name=u1}}class K8{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Yt(t,"recoveryEnabled")?t.recoveryEnabled:Ni.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Y8)}getTokenToInsert(t){const r=Wl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,r,n,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:d,ruleName:this.getCurrRuleFullName()}),m=new l1(f,u,this.LA(0));m.resyncedTokens=Fa(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(n.call(this)){h(),t.apply(this,r);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,r)))}getFollowsForInRuleRecovery(t,r){const n=this.getCurrentGrammarPath(t,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(t,r){if(this.canRecoverWithSingleTokenInsertion(t,r))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new G8("sad sad panda")}canPerformInRuleRecovery(t,r){return this.canRecoverWithSingleTokenInsertion(t,r)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,r){if(!this.canTokenTypeBeInsertedInRecovery(t)||xe(r))return!1;const n=this.LA(1);return Ro(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Cr(n,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let r=this.LA(1),n=2;for(;;){const i=Ro(t,s=>l8(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return dd;const t=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return Pt(t,(n,i)=>i===0?dd:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Pt(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return an(t)}getFollowSetFromFollowKey(t){if(t===dd)return[Ls];const r=t.ruleName+t.idxInCallingRule+vb+t.inRule;return this.resyncFollows[r]}addToResyncTokens(t,r){return this.tokenMatcher(t,Ls)||r.push(t),r}reSyncTo(t){const r=[];let n=this.LA(1);for(;this.tokenMatcher(n,t)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return Fa(r)}attemptInRepetitionRecovery(t,r,n,i,s,o,a){}getCurrentGrammarPath(t,r){const n=this.getHumanReadableRuleStack(),i=Er(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:t,lastTokOccurrence:r}}getHumanReadableRuleStack(){return Pt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function Y8(e,t,r,n,i,s,o){const a=this.getKeyForAutomaticLookahead(n,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=Ls,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,r,u)}const q8=4,Qi=8,f1=1<<Qi,h1=2<<Qi,pd=3<<Qi,md=4<<Qi,gd=5<<Qi,ql=6<<Qi;function yd(e,t,r){return r|t|e}class V8{constructor(t){var r;this.maxLookahead=(r=t==null?void 0:t.maxLookahead)!==null&&r!==void 0?r:Ni.maxLookahead}validate(t){const r=this.validateNoLeftRecursion(t.rules);if(xe(r)){const n=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(t){return An(t,r=>n1(r,r,Ms))}validateEmptyOrAlternatives(t){return An(t,r=>C8(r,Ms))}validateAmbiguousAlternationAlternatives(t,r){return An(t,n=>L8(n,r,Ms))}validateSomeNonEmptyLookaheadPath(t,r){return P8(t,r,Ms)}buildLookaheadForAlternation(t){return _8(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,w8)}buildLookaheadForOptional(t){return b8(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Jb(t.prodType),E8)}}class X8{initLooksAhead(t){this.dynamicTokensEnabled=Yt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ni.dynamicTokensEnabled,this.maxLookahead=Yt(t,"maxLookahead")?t.maxLookahead:Ni.maxLookahead,this.lookaheadStrategy=Yt(t,"lookaheadStrategy")?t.lookaheadStrategy:new V8({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Vt(t,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{const{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=Z8(r);Vt(n,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${hi(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:r,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=yd(this.fullRuleNameToShort[r.name],f1,u.idx);this.setLaFuncCache(d,h)})}),Vt(i,u=>{this.computeLookaheadFunc(r,u.idx,pd,"Repetition",u.maxLookahead,hi(u))}),Vt(s,u=>{this.computeLookaheadFunc(r,u.idx,h1,"Option",u.maxLookahead,hi(u))}),Vt(o,u=>{this.computeLookaheadFunc(r,u.idx,md,"RepetitionMandatory",u.maxLookahead,hi(u))}),Vt(a,u=>{this.computeLookaheadFunc(r,u.idx,ql,"RepetitionMandatoryWithSeparator",u.maxLookahead,hi(u))}),Vt(c,u=>{this.computeLookaheadFunc(r,u.idx,gd,"RepetitionWithSeparator",u.maxLookahead,hi(u))})})})}computeLookaheadFunc(t,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=yd(this.fullRuleNameToShort[t.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,r){const n=this.getLastExplicitRuleShortName();return yd(n,t,r)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,r){this.lookAheadFuncsCache.set(t,r)}}class J8 extends Ns{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const Vl=new J8;function Z8(e){Vl.reset(),e.accept(Vl);const t=Vl.dslMethods;return Vl.reset(),t}function d1(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function p1(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function Q8(e,t,r){e.children[r]===void 0?e.children[r]=[t]:e.children[r].push(t)}function t3(e,t,r){e.children[t]===void 0?e.children[t]=[r]:e.children[t].push(r)}const e3="name";function m1(e,t){Object.defineProperty(e,e3,{enumerable:!1,configurable:!0,writable:!1,value:t})}function r3(e,t){const r=vn(e),n=r.length;for(let i=0;i<n;i++){const s=r[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function n3(e,t){const r=function(){};m1(r,e+"BaseSemantics");const n={visit:function(i,s){if(fe(i)&&(i=i[0]),!Ii(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=s3(this,t);if(!xe(i)){const s=Pt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=t,r}function i3(e,t,r){const n=function(){};m1(n,e+"BaseSemanticsWithDefaults");const i=Object.create(r.prototype);return Vt(t,s=>{i[s]=r3}),n.prototype=i,n.prototype.constructor=n,n}var _d;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(_d||(_d={}));function s3(e,t){return o3(e,t)}function o3(e,t){const r=xn(t,i=>Ti(e[i])===!1),n=Pt(r,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:_d.MISSING_METHOD,methodName:i}));return Pa(n)}class a3{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Yt(t,"nodeLocationTracking")?t.nodeLocationTracking:Ni.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=nr,this.cstFinallyStateUpdate=nr,this.cstPostTerminal=nr,this.cstPostNonTerminal=nr,this.cstPostRule=nr;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=p1,this.setNodeLocationFromNode=p1,this.cstPostRule=nr,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=nr,this.setNodeLocationFromNode=nr,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=d1,this.setNodeLocationFromNode=d1,this.cstPostRule=nr,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=nr,this.setNodeLocationFromNode=nr,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=nr,this.setNodeLocationFromNode=nr,this.cstPostRule=nr,this.setInitialNodeLocation=nr;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const r=this.LA(1);t.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const r={name:t,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const r=this.LA(0),n=t.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(t){const r=this.LA(0),n=t.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(t,r){const n=this.CST_STACK[this.CST_STACK.length-1];Q8(n,r,t),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(t,r){const n=this.CST_STACK[this.CST_STACK.length-1];t3(n,r,t),this.setNodeLocationFromNode(n.location,t.location)}getBaseCstVisitorConstructor(){if(Ii(this.baseCstVisitorConstructor)){const t=n3(this.className,vn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Ii(this.baseCstVisitorWithDefaultsConstructor)){const t=i3(this.className,vn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class c3{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Zl}LA(t){const r=this.currIdx+t;return r<0||this.tokVectorLength<=r?Zl:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class l3{ACTION(t){return t.call(this)}consume(t,r,n){return this.consumeInternal(r,t,n)}subrule(t,r,n){return this.subruleInternal(r,t,n)}option(t,r){return this.optionInternal(r,t)}or(t,r){return this.orInternal(r,t)}many(t,r){return this.manyInternal(t,r)}atLeastOne(t,r){return this.atLeastOneInternal(t,r)}CONSUME(t,r){return this.consumeInternal(t,0,r)}CONSUME1(t,r){return this.consumeInternal(t,1,r)}CONSUME2(t,r){return this.consumeInternal(t,2,r)}CONSUME3(t,r){return this.consumeInternal(t,3,r)}CONSUME4(t,r){return this.consumeInternal(t,4,r)}CONSUME5(t,r){return this.consumeInternal(t,5,r)}CONSUME6(t,r){return this.consumeInternal(t,6,r)}CONSUME7(t,r){return this.consumeInternal(t,7,r)}CONSUME8(t,r){return this.consumeInternal(t,8,r)}CONSUME9(t,r){return this.consumeInternal(t,9,r)}SUBRULE(t,r){return this.subruleInternal(t,0,r)}SUBRULE1(t,r){return this.subruleInternal(t,1,r)}SUBRULE2(t,r){return this.subruleInternal(t,2,r)}SUBRULE3(t,r){return this.subruleInternal(t,3,r)}SUBRULE4(t,r){return this.subruleInternal(t,4,r)}SUBRULE5(t,r){return this.subruleInternal(t,5,r)}SUBRULE6(t,r){return this.subruleInternal(t,6,r)}SUBRULE7(t,r){return this.subruleInternal(t,7,r)}SUBRULE8(t,r){return this.subruleInternal(t,8,r)}SUBRULE9(t,r){return this.subruleInternal(t,9,r)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,r,n=Ql){if(Cr(this.definedRulesNames,t)){const o={message:Ms.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Lr.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,r,n);return this[t]=i,i}OVERRIDE_RULE(t,r,n=Ql){const i=N8(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,r,n);return this[t]=s,s}BACKTRACK(t,r){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return t.apply(this,r),!0}catch(i){if(Kl(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return f2(Ve(this.gastProductionsCache))}}class u3{initRecognizerEngine(t,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=zl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Yt(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(fe(t)){if(xe(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(fe(t))this.tokensMap=Kr(t,(s,o)=>(s[o.name]=o,s),{});else if(Yt(t,"modes")&&$n(an(Ve(t.modes)),s8)){const s=an(Ve(t.modes)),o=Ol(s);this.tokensMap=Kr(o,(a,c)=>(a[c.name]=c,a),{})}else if(En(t))this.tokensMap=Er(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Ls;const n=Yt(t,"modes")?an(Ve(t.modes)):Ve(t),i=$n(n,s=>xe(s.categoryMatches));this.tokenMatcher=i?zl:za,Wa(Ve(this.tokensMap))}defineRule(t,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Yt(n,"resyncEnabled")?n.resyncEnabled:Ql.resyncEnabled,s=Yt(n,"recoveryValueFunc")?n.recoveryValueFunc:Ql.recoveryValueFunc,o=this.ruleShortNameIdx<<q8+Qi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),r.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),r.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:r})}invokeRuleCatch(t,r,n){const i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if(Kl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(t);throw o}}else throw t}optionInternal(t,r){const n=this.getKeyForAutomaticLookahead(h1,r);return this.optionInternalLogic(t,r,n)}optionInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,r){const n=this.getKeyForAutomaticLookahead(md,t);return this.atLeastOneInternalLogic(t,r,n)}atLeastOneInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const o=r.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,$e.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,r],i,md,t,g8)}atLeastOneSepFirstInternal(t,r){const n=this.getKeyForAutomaticLookahead(ql,t);this.atLeastOneSepFirstInternalLogic(t,r,n)}atLeastOneSepFirstInternalLogic(t,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Vb],a,ql,t,Vb)}else throw this.raiseEarlyExitException(t,$e.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(t,r){const n=this.getKeyForAutomaticLookahead(pd,t);return this.manyInternalLogic(t,r,n)}manyInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const a=r.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,r],i,pd,t,m8,o)}manySepFirstInternal(t,r){const n=this.getKeyForAutomaticLookahead(gd,t);this.manySepFirstInternalLogic(t,r,n)}manySepFirstInternalLogic(t,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,qb],a,gd,t,qb)}}repetitionSepSecondInternal(t,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,r,n,i,s],n,ql,t,s)}doSingleRepetition(t){const r=this.getLexerPosition();return t.call(this),this.getLexerPosition()>r}orInternal(t,r){const n=this.getKeyForAutomaticLookahead(f1,r),i=fe(t)?t:t.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new W8(r,t))}}subruleInternal(t,r,n){let i;try{const s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=t.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,n,t.ruleName)}}subruleInternalError(t,r,n){throw Kl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete t.partialCstResult),t}consumeInternal(t,r,n){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,n)}catch(s){i=this.consumeInternalRecovery(t,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:t.name,i),i}consumeInternalError(t,r,n){let i;const s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new l1(i,r,s))}consumeInternalRecovery(t,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,r);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===u1?n:s}}else throw n}saveRecogState(){const t=this.errors,r=Er(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Ls)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class f3{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Yt(t,"errorMessageProvider")?t.errorMessageProvider:Ni.errorMessageProvider}SAVE_ERROR(t){if(Kl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Er(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Er(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,r,n){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=ud(t,s,r,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new H8(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,r){const n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=ld(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new z8(c,this.LA(1),a))}}class h3{initContentAssist(){}computeContentAssist(t,r){const n=this.gastProductionsCache[t];if(Ii(n))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Xb([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const r=Dn(t.ruleStack),i=this.getGAstProductions()[r];return new p8(i,t).startWalking()}}const Xl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Xl);const g1=!0,y1=Math.pow(2,Qi)-1,_1=cn({name:"RECORDING_PHASE_TOKEN",pattern:hr.NA});Wa([_1]);const b1=Wl(_1,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(b1);const d3={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class p3{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const r=t>0?t:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,t,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,t,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,t)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,t)},this[`MANY${r}`]=function(n){this.manyInternalRecord(t,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(t,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(t,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(t,n)}}this.consume=function(t,r,n){return this.consumeInternalRecord(r,t,n)},this.subrule=function(t,r,n){return this.subruleInternalRecord(r,t,n)},this.option=function(t,r){return this.optionInternalRecord(r,t)},this.or=function(t,r){return this.orInternalRecord(r,t)},this.many=function(t,r){this.manyInternalRecord(t,r)},this.atLeastOne=function(t,r){this.atLeastOneInternalRecord(t,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let r=0;r<10;r++){const n=r>0?r:"";delete t[`CONSUME${n}`],delete t[`SUBRULE${n}`],delete t[`OPTION${n}`],delete t[`OR${n}`],delete t[`MANY${n}`],delete t[`MANY_SEP${n}`],delete t[`AT_LEAST_ONE${n}`],delete t[`AT_LEAST_ONE_SEP${n}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,r){return()=>!0}LA_RECORD(t){return Zl}topLevelRuleRecord(t,r){try{const n=new Oo({definition:[],name:t});return n.name=t,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(t,r){return Ka.call(this,Vr,t,r)}atLeastOneInternalRecord(t,r){Ka.call(this,ui,r,t)}atLeastOneSepFirstInternalRecord(t,r){Ka.call(this,fi,r,t,g1)}manyInternalRecord(t,r){Ka.call(this,ir,r,t)}manySepFirstInternalRecord(t,r){Ka.call(this,zn,r,t,g1)}orInternalRecord(t,r){return m3.call(this,t,r)}subruleInternalRecord(t,r,n){if(Jl(r),!t||Yt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${w1(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=So(this.recordingProdStack),s=t.ruleName,o=new Yr({idx:r,nonTerminalName:s,label:n==null?void 0:n.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?d3:Xl}consumeInternalRecord(t,r,n){if(Jl(r),!Pb(t)){const o=new Error(`<CONSUME${w1(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=So(this.recordingProdStack),s=new Me({idx:r,terminalType:t,label:n==null?void 0:n.LABEL});return i.definition.push(s),b1}}function Ka(e,t,r,n=!1){Jl(r);const i=So(this.recordingProdStack),s=Ti(t)?t:t.DEF,o=new e({definition:[],idx:r});return n&&(o.separator=t.SEP),Yt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Xl}function m3(e,t){Jl(t);const r=So(this.recordingProdStack),n=fe(e)===!1,i=n===!1?e:e.DEF,s=new Wn({definition:[],idx:t,ignoreAmbiguities:n&&e.IGNORE_AMBIGUITIES===!0});Yt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Qh(i,a=>Ti(a.GATE));return s.hasPredicates=o,r.definition.push(s),Vt(i,a=>{const c=new qr({definition:[]});s.definition.push(c),Yt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Yt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Xl}function w1(e){return e===0?"":`${e}`}function Jl(e){if(e<0||e>y1){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${y1+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class g3{initPerformanceTracer(t){if(Yt(t,"traceInitPerf")){const r=t.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=Ni.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,r){if(this.traceInitPerf===!0){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${t}>`);const{time:i,value:s}=bb(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}}function y3(e,t){t.forEach(r=>{const n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=r.prototype[i]})})}const Zl=Wl(Ls,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Zl);const Ni=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Yb,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Ql=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Lr;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Lr||(Lr={}));let bd=class OA{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const r=this.className;this.TRACE_INIT("toFastProps",()=>{wb(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Vt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=D8({rules:Ve(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(xe(n)&&this.skipValidations===!1){const i=j8({rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),errMsgProvider:Ms,grammarName:r}),s=A8({lookaheadStrategy:this.lookaheadStrategy,rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),xe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=_2(Ve(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ve(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ve(this.gastProductionsCache))})),!OA.DEFER_DEFINITION_ERRORS_HANDLING&&!xe(this.definitionErrors))throw t=Pt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,r){this.definitionErrors=[],this.selfAnalysisDone=!1;const n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(t,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),Yt(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Yt(r,"skipValidations")?r.skipValidations:Ni.skipValidations}};bd.DEFER_DEFINITION_ERRORS_HANDLING=!1,y3(bd,[K8,X8,a3,c3,u3,l3,f3,h3,p3,g3]);class _3 extends bd{constructor(t,r=Ni){const n=Er(r);n.outputCst=!0,super(t,n)}}function b3(e){const t=new w3,r=Ve(e);return Pt(r,n=>t.visitRule(n))}class w3 extends Ns{visitRule(t){const r=this.visitEach(t.definition),n=mb(r,s=>s.propertyName),i=Pt(n,(s,o)=>{const a=!Qh(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=Pt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:tu(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:tu(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:tu(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:tu(t)}]}visitEachAndOverrideWith(t,r){return Pt(this.visitEach(t),n=>Hr({},n,r))}visitEach(t){return an(Pt(t,r=>this.visit(r)))}}function tu(e){return e instanceof Yr?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function E3(e,t){let r=[];return r=r.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),r=r.concat(an(Pt(e,n=>v3(n)))),t.includeVisitorInterface&&(r=r.concat(T3(t.visitorInterfaceName,e))),r.join(`

`)+`
`}function v3(e){const t=k3(e),r=x3(e);return[t,r]}function k3(e){const t=v1(e.name),r=wd(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${r};
}`}function x3(e){return`export type ${wd(e.name)} = {
  ${Pt(e.properties,r=>A3(r)).join(`
  `)}
};`}function A3(e){const t=R3(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function T3(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Pt(t,r=>S3(r)).join(`
  `)}
}`}function S3(e){const t=wd(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function R3(e){if(fe(e)){const t=Ol(Pt(e,n=>E1(n)));return"("+Kr(t,(n,i)=>n+" | "+i)+")"}else return E1(e)}function E1(e){return e.kind==="token"?"IToken":v1(e.name)}function v1(e){return P_(e)+"CstNode"}function wd(e){return P_(e)+"CstChildren"}const O3={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function I3(e,t){const r=Object.assign(Object.assign({},O3),t),n=b3(e);return E3(n,r)}const Ya=dy(32,126).map(e=>String.fromCharCode(e));function te(e){return cn({...e,name:`token_${e.name}`})}function ht(e){return te({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Ge})}const eu=te({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),N3=te({name:"whitespace",pattern:/ +/,group:hr.SKIPPED}),C3=te({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:hr.SKIPPED}),Ed=te({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),No=te({name:"command",pattern:/#/,start_chars_hint:["#"]});let k1=!1;const L3="@#/?':!",M3=/[#\d]+/i,U3=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function P3(e,t){if(!k1)return null;let r=t;const n=e[r-1]??"";if(r>0&&n!==" "&&n!==`
`)return null;if(e[r]===" "){for(;e[r]===" ";)r++;if(L3.includes(e[r]))return null}for(;r>0&&`$"@#':!/?
`.includes(e[r])===!1;)r--;switch(e[r]){case"?":case"/":{const o=e.substring(r+1,t+1).toLowerCase();if(o.indexOf(" ")<1||U3.test(o))return null;break}case"#":{const o=e.substring(r+1,r+4).toLowerCase();if(M3.test(o)===!1)return null;break}case'"':{for(r--;r>0&&e[r]===" ";)r--;if(!(r<1||e[r]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=t;for(e[i]==='"'&&++i;i<e.length&&e[i]!==`
`;)i++;const s=e.substring(t,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const x1=te({name:"text",pattern:P3,line_breaks:!1,start_chars_hint:Ya}),A1=te({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),vd=te({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),T1=te({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),S1=te({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Ge=te({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Ya}),ru=te({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),kd=te({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),R1=ht("isterrain"),O1=ht("isobject"),I1=ht("issolid"),N1=ht("iswalk"),C1=ht("isswim"),L1=ht("isbullet"),M1=ht("isghost"),U1=ht("iswalking"),P1=ht("iswalkable"),F1=ht("isswimming"),B1=ht("isswimmable"),$1=ht("black"),D1=ht("dkblue"),j1=ht("dkgreen"),z1=ht("dkcyan"),W1=ht("dkred"),H1=ht("dkpurple"),G1=ht("dkyellow"),K1=ht("ltgray"),Y1=ht("dkgray"),q1=ht("blue"),V1=ht("green"),X1=ht("cyan"),J1=ht("red"),Z1=ht("purple"),Q1=ht("yellow"),tw=ht("white"),ew=ht("brown"),rw=ht("dkwhite"),nw=ht("ltgrey"),iw=ht("gray"),sw=ht("grey"),ow=ht("dkgrey"),aw=ht("ltblack"),cw=ht("onblack"),lw=ht("ondkblue"),uw=ht("ondkgreen"),fw=ht("ondkcyan"),hw=ht("ondkred"),dw=ht("ondkpurple"),pw=ht("ondkyellow"),mw=ht("onltgray"),gw=ht("ondkgray"),yw=ht("onblue"),_w=ht("ongreen"),bw=ht("oncyan"),ww=ht("onred"),Ew=ht("onpurple"),vw=ht("onyellow"),kw=ht("onwhite"),xw=ht("onbrown"),Aw=ht("ondkwhite"),Tw=ht("onltgrey"),Sw=ht("ongray"),Rw=ht("ongrey"),Ow=ht("ondkgrey"),Iw=ht("onltblack"),Nw=ht("onclear"),Cw=ht("idle"),Lw=ht("up"),Mw=ht("down"),Uw=ht("left"),Pw=ht("right"),Fw=ht("by"),Bw=ht("at"),$w=ht("flow"),Dw=ht("seek"),jw=ht("rndns"),zw=ht("rndne"),Ww=ht("rnd"),Hw=ht("cw"),Gw=ht("ccw"),Kw=ht("opp"),Yw=ht("rndp"),qw=ht("away"),Vw=ht("toward"),Xw=ht("find"),Jw=ht("flee"),Zw=ht("to"),Qw=ht("i"),tE=ht("u"),eE=ht("north"),rE=ht("n"),nE=ht("d"),iE=ht("south"),sE=ht("s"),oE=ht("l"),aE=ht("west"),cE=ht("w"),lE=ht("r"),uE=ht("east"),fE=ht("e"),hE=ht("over"),dE=ht("under"),pE=ht("within"),mE=ht("awayby"),gE=te({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:Ge}),yE=ht("contact"),_E=ht("blocked"),bE=ht("any"),wE=ht("countof"),EE=ht("abs"),vE=ht("intceil"),kE=ht("intfloor"),xE=ht("intround"),AE=ht("clamp"),TE=ht("min"),SE=ht("max"),RE=ht("pick"),OE=ht("pickwith"),IE=ht("random"),NE=ht("randomwith"),CE=ht("run"),LE=ht("runwith"),ME=te({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),UE=te({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:Ge}),PE=te({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:Ge}),FE=te({name:"islessthan",pattern:/<|below/i,longer_alt:Ge}),BE=te({name:"isgreaterthan",pattern:/>|above/i,longer_alt:Ge}),$E=te({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:Ge}),DE=te({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:Ge}),xd=te({name:"or",pattern:/or/i,longer_alt:Ge}),Ad=te({name:"not",pattern:/not/i,longer_alt:Ge}),Td=te({name:"and",pattern:/and/i,longer_alt:Ge}),Sd=te({name:"plus",pattern:/\+/}),Rd=te({name:"minus",pattern:/-/}),jE=te({name:"power",pattern:/\*\*/}),zE=te({name:"multiply",pattern:/\*/}),Od=te({name:"divide",pattern:/\//}),WE=te({name:"moddivide",pattern:/%/}),HE=te({name:"floordivide",pattern:/%%/}),GE=te({name:"query",pattern:/\?/}),KE=te({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),YE=te({name:"rparen",pattern:/\)/,pop_mode:!0}),qE=te({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:Ya,longer_alt:Ge}),VE=te({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Ya,longer_alt:Ge}),XE=te({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Ya,longer_alt:Ge}),Id=te({name:"if",pattern:/if|try|take|give|duplicate/i,longer_alt:Ge}),nu=te({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:Ge}),Nd=ht("done"),Cd=ht("else"),JE=ht("while"),ZE=ht("repeat"),QE=ht("waitfor"),tv=te({name:"foreach",pattern:/foreach|for/i,longer_alt:Ge}),ev=ht("break"),rv=ht("continue");function nv(e,t){return[...e,Mw,...t,kd,R1,O1,I1,P1,U1,N1,B1,F1,C1,L1,M1,$1,D1,j1,z1,W1,H1,G1,K1,Y1,q1,V1,X1,J1,Z1,Q1,tw,ew,rw,nw,iw,sw,ow,aw,cw,lw,uw,fw,hw,dw,pw,mw,gw,yw,_w,bw,ww,Ew,vw,kw,xw,Aw,Tw,Sw,Rw,Ow,Iw,Nw,Cw,Lw,Uw,Pw,Fw,Bw,$w,Dw,Yw,jw,zw,Ww,Hw,Gw,Kw,pE,mE,qw,Vw,Xw,Jw,Zw,eE,iE,aE,uE,hE,dE,gE,yE,_E,bE,wE,EE,vE,kE,xE,AE,TE,SE,OE,RE,NE,IE,LE,CE,ME,UE,PE,$E,FE,DE,BE,xd,Ad,Td,Sd,Rd,jE,zE,Od,HE,WE,GE,KE,YE,Qw,tE,rE,nE,sE,oE,cE,lE,fE,ru,Ge]}const iv=nv([x1,Ed,qE,VE,XE,No,A1,vd,T1,S1,eu,N3],[ev,rv,Nd,nu,Cd,tv,Id,ZE,QE,JE]),F3=new hr({defaultMode:"use_newlines",modes:{use_newlines:iv,ignore_newlines:nv([C3],[])}},{skipValidations:!ri,ensureOptimizations:ri,positionTracking:"full"});function sv(e){k1=!0;const t=F3.tokenize(e||` 
`),[r]=(he(t.tokens)?t.tokens:[]).slice(-1);return r&&r.tokenType.name!=="Newline"&&t.tokens.push(Wl(eu,`
`,r.startOffset,r.endOffset??NaN,r.startLine??NaN,r.endLine??NaN,r.startColumn??NaN,r.endColumn??NaN)),t}function B3(e,t,r=!0){if(r){const[n,...i]=t;switch(zt(n??"")){default:return{type:Ft.OBJECT,values:t};case"loader":return{type:Ft.LOADER,values:i};case"board":return{type:Ft.BOARD,values:i};case"object":return{type:Ft.OBJECT,values:i};case"terrain":return{type:Ft.TERRAIN,values:i};case"charset":return{type:Ft.CHARSET,values:i};case"palette":return{type:Ft.PALETTE,values:i}}}else{const[n,i,...s]=t,o=zt(i??""),a=[n,e,...s];switch(o){default:return{type:Ft.CONST,values:t};case"rn":case"range":return{type:Ft.RANGE,values:a};case"sl":case"select":return{type:Ft.SELECT,values:a};case"nm":case"number":return{type:Ft.NUMBER,values:a};case"tx":case"text":return{type:Ft.TEXT,values:a};case"hk":case"hotkey":return{type:Ft.HOTKEY,values:a};case"copyit":return{type:Ft.COPYIT,values:a};case"openit":return{type:Ft.OPENIT,values:a};case"zssedit":return{type:Ft.ZSSEDIT,values:a};case"charedit":return{type:Ft.CHAREDIT,values:a};case"coloredit":return{type:Ft.COLOREDIT,values:a}}}}function ln(e){switch(e){case Ft.LOADER:return"loader";case Ft.BOARD:return"board";case Ft.OBJECT:return"object";case Ft.TERRAIN:return"terrain";case Ft.CHARSET:return"charset";case Ft.PALETTE:return"palette";case Ft.CONST:return"const";case Ft.RANGE:return"range";case Ft.SELECT:return"select";case Ft.NUMBER:return"number";case Ft.TEXT:return"text";case Ft.HOTKEY:return"hotkey";case Ft.COPYIT:return"copyit";case Ft.OPENIT:return"openit";case Ft.VIEWIT:return"viewit";case Ft.ZSSEDIT:return"zssedit";case Ft.CHAREDIT:return"charedit";case Ft.COLOREDIT:return"coloredit"}}var Ld=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Ld||{});function ov(e){return ko(e,Ld,{bits:t=>Array.from(t)})}function av(e){return Aa(e,Ld,{bits:t=>new Uint8Array(t)})}function iu(e,t){return{id:De(),code:e,...t}}var Md=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Md||{});function $3(e){return ko(e,Md,{board:Gj,object:fl,terrain:fl,charset:ov,palette:ov,stats:Oe})}function D3(e){return Aa(e,Md,{board:Kj,object:hl,terrain:hl,charset:av,palette:av})}function qa(e){const t={...Us(e)};return Object.keys(t).forEach(r=>{switch(r){case"type":case"name":delete t[r];break}}),t}function j3(e){return w(e)?(e.stats=void 0,Us(e)):{}}function Ud(e){const t=sv(e),r={};let n=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Ed){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),u=a.split(" "),l=B3(_t(c)?c:"",u,n),h=l.values.join(" ");switch(n=!1,l.type){case Ft.LOADER:r.type=Tt.LOADER,r.name=h;break;case Ft.BOARD:r.type=Tt.BOARD,r.name=h;break;case Ft.OBJECT:r.type=Tt.OBJECT,r.name=h||"object";break;case Ft.TERRAIN:r.type=Tt.TERRAIN,r.name=h;break;case Ft.CHARSET:r.type=Tt.CHARSET,r.name=h;break;case Ft.PALETTE:r.type=Tt.PALETTE,r.name=h;break;case Ft.CONST:{const[d,...f]=l.values;if(_t(d)){const m=zt(d),p=f.join(" ");if(_t(p)){const g=parseFloat(p);r[m]=xt(g)?g:p}else r[m]=1}break}case Ft.RANGE:case Ft.SELECT:case Ft.NUMBER:case Ft.TEXT:case Ft.HOTKEY:case Ft.ZSSEDIT:case Ft.CHAREDIT:case Ft.COLOREDIT:{const[d,...f]=l.values;if(_t(d)){const m=zt(d);r[m]=[ln(l.type),...f]}break}}}}return r}function Us(e){var t;return w(e)?(w((t=e.stats)==null?void 0:t.type)||(e.stats=Ud(e.code),w(e.stats.type)||(e.stats.type=Tt.OBJECT)),e.stats):{}}function cv(e){switch(e){default:case Tt.ERROR:return"error";case Tt.LOADER:return ln(Ft.LOADER);case Tt.BOARD:return ln(Ft.BOARD);case Tt.OBJECT:return ln(Ft.OBJECT);case Tt.TERRAIN:return ln(Ft.TERRAIN);case Tt.CHARSET:return ln(Ft.CHARSET);case Tt.PALETTE:return ln(Ft.PALETTE)}}function di(e){return Us(e).type??Tt.ERROR}function Ci(e){return cv(di(e))}function _e(e){return Us(e).name??""}function z3(e,t){return Us(e)[t]}const su=new ch;function W3(e){if(!_t(e))return;const t=ba(e);if(w(t)&&w(Kt[t]))return Kt[t];const r=zt(e),n=bt[r];if(w(n))return n}function ou(e,t){const r=Object.keys(e);for(let n=0;n<r.length;++n){const i=r[n],s=e[i];if(he(s)){const[o,...a]=s;switch(o){case"text":w(t[i])||(t[i]="");break;case"range":w(t[i])||(t[i]=4);break;case"number":w(t[i])||(t[i]=0);break;case"select":if(!w(t[i])){const[,c]=a;t[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":t[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":t[i]=W3(s)??s;break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=s===""?1:s;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Wt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Wt.ISSWIM;break;case"issolid":t.collision=Wt.ISSOLID;break;case"isbullet":t.collision=Wt.ISBULLET;break;case"isghost":t.collision=Wt.ISGHOST;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Ie(e){var t;if(w(e))switch(di(e)){default:return;case Tt.ERROR:return e.code??"";case Tt.LOADER:return e.code??"";case Tt.BOARD:{w(e.board)||(e.board=Uu()),e.board.id=e.id;const r=qa(e);return r.isdark&&(e.board.isdark=1),r.notdark&&(e.board.isdark=0),xt(r.startx)&&(e.board.startx=r.startx),xt(r.starty)&&(e.board.starty=r.starty),_t(r.over)&&(zt(r.over)==="empty"?e.board.over=void 0:e.board.over=r.over,e.board.overboard=void 0),_t(r.under)&&(zt(r.under)==="empty"?e.board.under=void 0:e.board.under=r.under,e.board.underboard=void 0),_t(r.camera)&&(zt(r.camera)==="empty"?e.board.camera=void 0:e.board.camera=r.camera),_t(r.graphics)&&(zt(r.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=r.graphics),xt(r.facing)&&(e.board.facing=r.facing),_t(r.facing)&&zt(r.facing)==="empty"&&(e.board.facing=void 0),_t(r.exitnorth)&&(e.board.exitnorth=r.exitnorth),_t(r.exitsouth)&&(e.board.exitsouth=r.exitsouth),_t(r.exitwest)&&(e.board.exitwest=r.exitwest),_t(r.exiteast)&&(e.board.exiteast=r.exiteast),xt(r.timelimit)&&(e.board.timelimit=r.timelimit),r.restartonzap&&(e.board.restartonzap=1),r.norestartonzap&&(e.board.restartonzap=0),xt(r.maxplayershots)&&(e.board.maxplayershots=r.maxplayershots),e.board}case Tt.OBJECT:return w(e.object)||(e.object=Jy()),e.object.id=e.id,e.object.code=e.code,e.object.name=_e(e),e.object.category=$r.ISOBJECT,ou(qa(e),e.object),e.object;case Tt.TERRAIN:return w(e.terrain)||(e.terrain=Jy()),e.terrain.id=e.id,e.terrain.name=_e(e),e.terrain.category=$r.ISTERRAIN,ou(qa(e),e.terrain),e.terrain;case Tt.PALETTE:{if(w(e.palette)||(e.palette=Qy(aN)),w((t=e.palette)==null?void 0:t.bits)){const r=qa(e),n=Br(r);for(let i=0;i<n.length;++i){const s=n[i].toLowerCase(),o=r[s];if(s.startsWith("color")&&_t(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){su.set(o);const c=a*rl,u=su.r*63,l=su.g*63,h=su.b*63;e.palette.bits[c+0]=ze(u,0,63),e.palette.bits[c+1]=ze(l,0,63),e.palette.bits[c+2]=ze(h,0,63)}}}}return e.palette}case Tt.CHARSET:return w(e.charset)||(e.charset=t_(oN)),e.charset}}function Pd(e){return{id:De(),name:HA(),timestamp:0,activelist:[],pages:e,flags:{}}}var Fd=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(Fd||{});function H3(e){return ko(e,Fd,{pages:t=>t.map($3),flags:t=>{const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function lv(e){return Aa(e,Fd,{pages:t=>t.map(D3)})}function uv(e){w(e)&&(e.token=`${GA()}${yn(1111,9999)}`)}function Ps(e,t){if(!w(e))return;const r=zt(t);return e.pages.find(i=>i.id===t||r===_e(i))}function sr(e,t,r){if(!w(e))return;const n=zt(r);return e.pages.find(s=>di(s)===t&&(s.id===r||n===_e(s)))}function Bd(e,t,r){let n=sr(e,t,r);if(!w(n)){const i=cv(t);return n=iu(i==="object"?`@${r||"object"}
`:`@${i} ${r}
`,{}),Xa(e,n),[n,!0]}return[n,!1]}function Fs(e,t){return w(e)?e.pages.filter(r=>di(r)===t):[]}function fv(e,t,r){if(!w(e))return[];const n=zt(r);return e.pages.filter(s=>di(s)===t).filter(s=>{const o=Us(s),a=zt(_e(s));return s.id===r||n===a||w(o[r])})}function Va(e){return w(e)?Nn(e.pages).sort((r,n)=>{const i=di(r),s=di(n);return i===s?_e(r).localeCompare(_e(n)):s-i}):[]}function hv(e,t){if(w(t)){const r=sr(e,Tt.TERRAIN,t.kind??"");if(w(r))return r;const n=sr(e,Tt.OBJECT,t.kind??"");if(w(n))return n}}function Xa(e,t){if(!w(e)||!w(t))return!1;const r=Ps(e,t.id);return w(r)?!1:(e.pages.push(t),uv(e),!0)}function dv(e,t){const r=Ps(e,t);if(w(e)&&w(r)){const n=zt(t);return e.pages=e.pages.filter(i=>i.id!==t&&n!==_e(i)),uv(e),r}}function dr(e,t=1,r=Kt.WHITE,n=Kt.BLACK){const i=e==null?void 0:e.kinddata;return{name:zt((e==null?void 0:e.name)??(i==null?void 0:i.name)),char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??r,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??n,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function G3(e,t){return!!(e!=null&&e.flags[t])}function Li(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function pv(e,t){e&&delete e.flags[t]}function mv(e,t,r){const n=Li(e,t);return n==null?void 0:n[r]}function K3(e,t,r,n){const i=Li(e,t);return i&&(i[r]=n),n}function pr(e){if(!w(e)||w(e.lookup)&&w(e.named))return;const t=new Array(Nt*Qt).fill(void 0),r={},n=Object.values(e.objects);for(let o=0;o<n.length;++o){const a=n[o];if(w(a.x)&&w(a.y)&&w(a.id)&&!w(a.removed)&&Gt(a,"collision")!==Wt.ISGHOST){a.category=$r.ISOBJECT,t[a.x+a.y*Nt]=a.id,_t(a.code)&&!w(a.name)&&ou(Ud(a.code),a);const c=dr(a);r[c.name]||(r[c.name]=new Set),r[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];if(w(a)){a.x=i,a.y=s,a.category=$r.ISTERRAIN;const c=dr(Sn(a));r[c.name]||(r[c.name]=new Set),r[c.name].add(o)}++i,i>=Nt&&(i=0,++s)}e.lookup=t,e.named=r}function Ja(e){w(e)&&(delete e.named,delete e.lookup,pr(e))}function $d(e,t,r){var i;if(!w(e)||!w(e.named)||!w(t))return;const n=zt(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[n]||(e.named[n]=new Set),e.named[n].add((t==null?void 0:t.id)??r??"")}function gv(e,t){if(!(!w(e)||!w(e.lookup)||!w(t==null?void 0:t.id))&&!w(t.removed)&&Gt(t,"collision")!==Wt.ISGHOST){const r=t.x??0,n=t.y??0;e.lookup[r+n*Nt]=t.id}}function Y3(e,t){var r;if(w(e)&&w(t==null?void 0:t.x)&&w(t.y)){const n=dr(t),i=$i(e,t);w((r=e.named)==null?void 0:r[n.name])&&e.named[n.name].delete(i)}}function au(e,t){var r;if(w(e)&&w(t==null?void 0:t.id)){if(w(e.lookup)&&w(t.x)&&w(t.y)){const i=t.x+t.y*Nt;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const n=dr(t);w((r=e.named)==null?void 0:r[n.name])&&w(t.id)&&e.named[n.name].delete(t.id)}}function cu(e,t,r,n=!1){if(!w(e)||!w(e.lookup)||r.x<0||r.x>=Nt||r.y<0||r.y>=Qt)return;const i=r.x+r.y*Nt,s=Or(e,e.lookup[i]??"404");if(w(s))return n&&br(s.id)?void 0:s;const o=e.terrain[i];if(w(o)&&lc(t,Gt(o,"collision")))return o}function q3(e,t,r){const n=Or(e,(t==null?void 0:t.id)??""),i=(n==null?void 0:n.x)??-1,s=(n==null?void 0:n.y)??-1;if(i-r.x===0&&s-r.y===0)return!0;const o=Gt(n,"collision");return w(cu(e,o,r))}function yv(e,t,r){var d;const n=Or(e,(t==null?void 0:t.id)??"");if(!w(e)||!w(n)||!w(n.x)||!w(n.y)||!w(e.lookup)||r.x<0||r.x>=Nt||r.y<0||r.y>=Qt)return{name:"edge",kind:"edge",collision:Wt.ISSOLID,x:r.x,y:r.y};if(n.x-r.x===0&&n.y-r.y===0)return;const i=$i(e,n),s=$i(e,r),o=Gt(n,"collision");if(o===Wt.ISGHOST)return;const a=br(n==null?void 0:n.id),c=Or(e,e.lookup[s]??"");if(Gt(c,"collision")===Wt.ISGHOST)return;const u=br((c==null?void 0:c.id)??"");if(w(c)&&(!a||!u))return{...c};const l=e.terrain[s],h=(l==null?void 0:l.collision)??((d=l==null?void 0:l.kinddata)==null?void 0:d.collision)??Wt.ISWALK;if(lc(o,h))return{...l,x:r.x,y:r.y};n.x=r.x,n.y=r.y,w(n.removed)||(e.lookup[i]=void 0,e.lookup[s]=n.id??"")}function V3(e,t){const r=[];if(!w(e))return r;const n=Object.values(e.objects);for(let i=0;i<n.length;++i){const s=n[i];w(s.id)&&w(s.removed)&&t-s.removed>bc*5&&(r.push(s.id),Qx(e,s.id))}return r}function X3(e,t){const r=[];if(!w(e))return r;e.lookup=void 0,pr(e);const n=Object.values(e.objects);for(let s=0;s<n.length;++s){const o=n[s];if(!w(o.id))continue;o.lx=o.x,o.ly=o.y;const a=Sn(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const u=t-o.removed,l=Gt(o,"cycle");if(u>l)continue}r.push({id:o.id,type:Tt.OBJECT,code:c,object:o,terrain:void 0})}}const i=V3(e,t);for(let s=0;s<i.length;++s)r.push({id:i[s],type:Tt.ERROR,code:"",object:void 0,terrain:void 0});return r}function _v(e,t,r){const n=[],i=[];if(!w(e))return{objectelements:n,terrainelements:i};function s(a,c){switch(r){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const u=Gt(a,r);return w(u)||dr(a).name===r||Gt(a,"group")===r}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&n.push(c)}for(let a=0;a<dh;++a){const c=e.terrain[a];w(c)&&s(c,!0)&&i.push(c)}return{objectelements:n,terrainelements:i}}function bv(e,t,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=se(t,{x:s,y:i});He(o)&&kr(t,o,e.timestamp),Ne(t,{x:s,y:i})}}function J3(e,t,r){for(let n=t.y;n<=r.y;++n)for(let i=t.x;i<=r.x;++i)Ne(e,{x:i,y:n})}function wv(e,t,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=se(t,{x:s,y:i});He(o)&&kr(t,o,e.timestamp),Ne(t,{x:s,y:i})}}function Bs(e,t){w(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.displaychar=t.displaychar,e.displaycolor=t.displaycolor,e.displaybg=t.displaybg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.p4=t.p4,e.p5=t.p5,e.p6=t.p6,e.code=t.code,e.item=t.item,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.lightdir=t.lightdir,e.stepx=t.stepx,e.stepy=t.stepy,e.shootx=t.shootx,e.shooty=t.shooty,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function lu(e,t,r,n,i){switch(i){case"all":case"object":case"terrain":break;default:return Z3(e,t,r,"",i)}if(!w(k.book))return;const s=k.book,o=sr(s,Tt.BOARD,e),a=Ie(o);if(!w(a))return;const c=sr(s,Tt.BOARD,t),u=Ie(c);if(!w(u))return;pr(a),pr(u);let l=!1;if(w(a)&&w(u)){switch(i){case"all":bv(s,u,r,n);break;case"object":wv(s,u,r,n);break;case"terrain":J3(u,r,n);break;default:l=!0;break}for(let h=r.y;h<=n.y;++h)for(let d=r.x;d<=n.x;++d){let f=!1,m=!1;switch(i){case"all":f=!0,m=!0;break;case"object":f=!0;break;case"terrain":m=!0;break}const p={x:d,y:h};let g,y=se(a,p);if(He(y)?(g=as(a,d,h),br(y==null?void 0:y.id)&&(y=void 0)):(g=y,y=void 0),w(g)&&(m||l&&Gt(g,"group")===i)){l&&bv(s,u,p,p);const b=hn(u,[g.kind??""],p);Bs(b,g)}if(w(y)&&(f||l&&Gt(y,"group")===i)){l&&wv(s,u,p,p);const b=hn(u,[y.kind??""],p);Bs(b,y)}}Ja(u)}}function Z3(e,t,r,n,i){if(!w(k.book))return;const s=k.book,o=sr(s,Tt.BOARD,e),a=Ie(o);if(!w(a))return;const c=sr(s,Tt.BOARD,t),u=Ie(c);if(w(u)&&(pr(a),pr(u),w(a)&&w(u))){const{terrainelements:l,objectelements:h}=_v(a,n,i);if(l.length===0&&h.length===0)return;const d={x:Nt,y:Qt};for(let f=0;f<l.length;++f){const m=l[f];xt(m.x)&&(d.x=Math.min(d.x,m.x)),xt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let f=0;f<h.length;++f){const m=h[f];xt(m.x)&&(d.x=Math.min(d.x,m.x)),xt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let f=0;f<l.length;++f){const m=l[f],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},g=se(u,p);w(g)&&(He(g)&&kr(u,g,s.timestamp),Ne(u,p));const y=hn(u,[m.kind??""],p);Bs(y,m)}for(let f=0;f<h.length;++f){const m=h[f],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},g=hn(u,[m.kind??""],p);Bs(g,m)}Ja(u)}}function Q3(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function uu(e,t,r){if(!w(e))return;K3(e,t,"board",r);const n=yr(r);w(n)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function Co(e,t,r,n,i=!1){const s=Ye(t);if(!w(e)||!w(s))return;const o=Or(s,t);if(!He(o)||!(o!=null&&o.id))return;const a=yr(r);if(!w(a))return;pr(a);const c=cu(a,Wt.ISWALK,n,!0);if(i===!1&&w(c))if(Gt(c,"item"))qe(t,o,c,"touch");else return;au(s,o),delete s.objects[o.id],o.x=n.x,o.y=n.y,a.objects[o.id]=o,$d(a,o),gv(a,o),uu(e,t,a.id)}function tP(e){const r=((e==null?void 0:e.activelist)??[]).map(n=>{const i=mv(e,n,"board");return _t(i)?i:""});return _I(r)}function Lo(e){const t=tP(e),r=new Set,n=[];for(let i=0;i<t.length;++i){const s=yr(t[i]);if(w(s)&&!r.has(s.id)){if(_t(s.over))if(_t(s.overboard)){const o=yr(s.overboard);w(o)?r.has(o.id)||n.push(o):delete s.overboard}else{const o=yr(s.over);w(o)&&(s.overboard=o.id)}else _t(s.overboard)&&delete s.overboard;if(n.push(s),_t(s.under))if(_t(s.underboard)){const o=yr(s.underboard);w(o)||delete s.underboard}else{const o=yr(s.under);w(o)&&(s.underboard=o.id)}else _t(s.underboard)&&delete s.underboard}}return n}const eP=dy(32,126).map(e=>String.fromCharCode(e)),rP=cn({name:"Whitespace",pattern:/ +/}),nP=cn({name:"WhitespaceSkipped",pattern:/ +/,group:hr.SKIPPED}),Dd=cn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Ev=cn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:eP}),jd=cn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),zd=cn({name:"EscapedDollar",pattern:"$$"}),Wd=cn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Hd=cn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),vv=cn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function iP(e,t=""){return cn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const kv=Object.keys(_a).map(e=>iP(`\\$(${e})`,e)),sP=[rP,Dd,...kv,jd,Ev,Hd,zd,vv,Wd],oP=new hr(sP,{skipValidations:!ri,ensureOptimizations:ri}),aP=new hr([nP,Dd,...kv,jd,Ev,Hd,zd,vv,Wd],{skipValidations:!ri,ensureOptimizations:ri}),xv=/\$CENTER/i;function cP(e){if(xv.test(e))return e.replace(xv,"")}function Gd(e,t=!1){return t?aP.tokenize(e):oP.tokenize(e)}function Kd(e,t,r,n,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Av(e){e.active={...e.reset}}function Tv(e,t){const r=t.y;function n(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}n()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case zd:s("$");break;case Hd:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}n();break;case jd:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Dd:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=_a[u],h=wI(Kt[l]),d=fh(Kt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):w(h)?t.active.color=h:w(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(w(t.writefullwidth)&&(t.x>o||t.y===r)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Av(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;uP(l,l+u.length,t.active.color,t.active.bg,t),lP(l,u,t)}}}function Sv(e,t,r){const n=Gd(e);n.tokens&&(Tv(n.tokens,t),r&&Av(t),t.changed())}function Rv(e,t,r){const n=Gd(e);if(!n.tokens)return;const i=Kd(t,r,Kt.WHITE,Kt.BLACK);return i.measureonly=!0,Tv(n.tokens,i),i.x>0&&++i.y,i}function lP(e,t,r){let n=0;const i=e+t.length;for(let s=e;s<i;++s)r.char[s]=t.charCodeAt(n++);r.changed()}function uP(e,t,r,n,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=r,i.bg[a]=n;i.changed()}function fu(e,t,r){var a;if(!w((a=k.element)==null?void 0:a.x)||!w(k.element.y))return 0;const[n,i]=ft(t,0,[J.DIR,J.MAYBE_KIND]);k.element.shootx=ze(n.destpt.x-n.startpt.x,-1,1),k.element.shooty=ze(n.destpt.y-n.startpt.y,-1,1);const s=i??["bullet"],o=Sj(k.board,s,{x:k.element.x,y:k.element.y});if(w(o)){w(r)&&(o.arg=r),o.cycle=1,o.party=k.elementid,o.collision=Wt.ISBULLET,o.breakable=1,o.stepx=n.destpt.x-k.element.x,o.stepy=n.destpt.y-k.element.y,o.bg=Kt.ONCLEAR;const c=Sn(o),u=o.code??(c==null?void 0:c.code)??"";Wx(k.book,k.board,o,u)}return e.yield(),0}function Za(e,t,r){var d,f;if(!vs(k.element)||!w(k.book)||!w(k.board)||!w(k.element))return 0;const[n,i]=ft(e,0,[J.DIR,J.KIND]);if(n.targets.length){for(let m=0;m<n.targets.length;++m){const p=n.targets[m];Za(["at",p.x,p.y,...i],t,r)}return 0}const{destpt:s}=n;if(s.x<0||s.x>=Nt||s.y<0||s.y>=Qt)return 0;const[o]=i,a={x:((d=k.element)==null?void 0:d.x)??0,y:((f=k.element)==null?void 0:f.y)??0},c=Sn({kind:o}),u=Gt(c,"collision");if(u===Wt.ISGHOST)return hn(k.board,i,n.destpt,t),0;let l=se(k.board,n.destpt);if(Gt(l,"pushable")){const m=Nn(n.destpt),p=Fe(m,Fn(a,m));Gn(k.book,k.board,l,p),l=se(k.board,n.destpt)}if(o==="empty")return kr(k.board,l,k.timestamp),0;if(He(l)&&kr(k.board,l,k.timestamp),He(c)||hn(k.board,i,n.destpt,t),He(c)){const m=cu(k.board,u,n.destpt);if(!w(m)){const p=hn(k.board,i,n.destpt,t);w(p)&&w(r)&&(p.arg=r)}}return 0}function fP(e,t,r){if(!w(k.book)||!w(k.board))return 1;const[n,i]=ft(t,0,[J.DIR,J.DIR]),s=se(k.board,n.destpt);if(w(s)&&w(s.kind)){const o=Gt(s,"collision"),a=cu(k.board,o,i.destpt);if(w(a))return 1;const c=hn(k.board,[s.kind],i.destpt);if(!w(c))return 1;Bs(c,s)}else return 1;return 0}const hP={x:0,y:0},dP={x:Nt-1,y:Qt-1},pP="all",mP=xi().command("build",(e,t)=>{if(!w(k.book)||!w(k.board)||!w(k.element))return 0;const[r,n]=ft(t,0,[J.NAME,J.MAYBE_STRING]),i=Uu();if(w(i)){if(_t(n)){const s=yr(n);w(s)&&lu(s.id,i.id,hP,dP,pP)}e.set(r,i.id)}return 0}).command("goto",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ft(t,0,[J.STRING]),[i,s]=ft(t,n,[J.MAYBE_NUMBER,J.MAYBE_NUMBER]),o=yr(r);if(!w(o))return 0;const a={x:i??o.startx??Math.round(Nt*.5),y:s??o.starty??Math.round(Qt*.5)},c=dr(k.element);if(c.name!=="player"){const u=Gt(k.element,"color"),l=Gt(k.element,"bg"),h=wo(u,l),d=Mu(o,[c.name,h]),[f]=d.sort((m,p)=>{const g=m.y??1e4,y=p.y??1e4,b=g-y;if(b!==0)return b;const S=m.x??1e4,T=p.x??1e4;return S-T});w(f)&&xt(f.x)&&xt(f.y)&&(a.x=f.x,a.y=f.y)}return Co(k.book,k.elementfocus,o.id,a,!0),0}).command("transport",(e,t)=>{var i;if(!w(k.book)||!w(k.board)||!w(k.element))return 0;const[r]=ft(t,0,[J.STRING]),n=Or(k.board,r);if(w((i=k.element)==null?void 0:i.x)&&w(k.element.y)&&w(n==null?void 0:n.x)&&w(n.y)){let s=!0;const o={x:k.element.x,y:k.element.y},a=o.x-n.x,c=o.y-n.y;if(Gt(k.element,"shootx")!==a||Gt(k.element,"shooty")!==c)return 0;for(;s&&(o.x+=a,o.y+=c,!(o.x<0&&o.x>=Nt&&o.y<0&&o.y>=Qt));){const u=se(k.board,o);(u==null?void 0:u.kind)===k.element.kind&&Gt(u,"shootx")===-a&&Gt(u,"shooty")===-c&&Gn(k.book,k.board,n,{x:o.x+a,y:o.y+c})&&(s=!1)}}return 0}).command("shove",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ft(t,0,[J.DIR,J.DIR]),i=se(k.board,r.destpt);if(He(i)&&Gt(i,"pushable")){const s=r.destpt.x+(n.destpt.x-n.startpt.x),o=r.destpt.y+(n.destpt.y-n.startpt.y);Gn(k.book,k.board,i,{x:s,y:o})}return 0}).command("duplicate",fP).command("write",(e,t)=>{var d;if(!w(k.book)||!w(k.board))return 0;const[r,n,i]=ft(t,0,[J.DIR,J.COLOR]),s=t.slice(i).map(Re).join(" "),{color:o,bg:a}=wy(n),c=((d=Rv(s,256,1))==null?void 0:d.measuredwidth)??1,u=Kd(256,1,o??Kt.WHITE,a??Kt.BLACK);Sv(s,u,!1);const l=c-1;switch(Fn(r.startpt,r.destpt)){case bt.EAST:for(let f=0;f<c;++f)Ne(k.board,{x:r.destpt.x+f,y:r.destpt.y,name:"text",char:u.char[f],color:u.color[f],bg:u.bg[f]});break;case bt.WEST:for(let f=0;f<c;++f)Ne(k.board,{x:r.destpt.x+f-l,y:r.destpt.y,name:"text",char:u.char[f],color:u.color[f],bg:u.bg[f]});break;case bt.NORTH:for(let f=0;f<c;++f)Ne(k.board,{x:r.destpt.x,y:r.destpt.y+f-l,name:"text",char:u.char[f],color:u.color[f],bg:u.bg[f]});break;case bt.SOUTH:for(let f=0;f<c;++f)Ne(k.board,{x:r.destpt.x,y:r.destpt.y+f,name:"text",char:u.char[f],color:u.color[f],bg:u.bg[f]});break}return 0}).command("change",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ft(t,0,[J.KIND,J.KIND]);(cc(r)??"")==="empty"&&zj(k.board).forEach(c=>{hn(k.board,n,c)});const s=cc(n),o=Lu(n),a=Gx(n);return Mu(k.board,r).forEach(c=>{if(w(o)&&(c.color=o),w(a)&&(c.bg=a),dr(c).name!==s){const l=Gt(c,"color"),h=Gt(c,"bg");if(kr(k.board,c,k.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},f=hn(k.board,n,d);w(f)&&(f.color=l,f.bg=h)}}}),0}).command("put",(e,t)=>Za(t)).command("putwith",(e,t)=>{const[r,n]=ft(t,0,[J.ANY]);return Za(t.slice(n),void 0,r)}).command("oneof",(e,t)=>{const[r,n]=ft(t,0,[J.ANY]);return w(k.board)&&Or(k.board,r)?0:Za(t.slice(n),r)}).command("oneofwith",(e,t)=>{const[r,n,i]=ft(t,0,[J.ANY,J.ANY]);return w(k.board)&&Or(k.board,n)?0:Za(t.slice(i),n,r)}).command("shoot",fu).command("shootwith",(e,t)=>{const[r,n]=ft(t,0,[J.ANY]);return fu(e,t.slice(n),r)}).command("throwstar",(e,t)=>fu(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[r,n]=ft(t,0,[J.ANY]);return fu(e,[...t.slice(n),"star"],r)});var $s=(e=>(e[e.Border=-1]="Border",e[e.Data=0]="Data",e[e.Function=1]="Function",e[e.Position=2]="Position",e[e.Timing=3]="Timing",e[e.Alignment=4]="Alignment",e))($s||{}),gP=Object.defineProperty,yP=(e,t,r)=>t in e?gP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,hu=(e,t,r)=>(yP(e,typeof t!="symbol"?t+"":t,r),r);const _P=[0,1],Ov=[1,0],Iv=[2,3],Nv=[3,2],bP={L:_P,M:Ov,Q:Iv,H:Nv},wP=/^[0-9]*$/,EP=/^[A-Z0-9 $%*+.\/:-]*$/,Yd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",qd=1,Vd=40,Cv=3,vP=3,du=40,kP=10,Lv=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],Mv=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class xP{constructor(t,r,n,i){if(this.version=t,this.ecc=r,hu(this,"size"),hu(this,"mask"),hu(this,"modules",[]),hu(this,"types",[]),t<qd||t>Vd)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=t*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(n);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const u=this.getPenaltyScore();u<a&&(i=c,a=u),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(t,r){return t>=0&&t<this.size&&r>=0&&r<this.size&&this.modules[r][t]}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2===0,$s.Timing),this.setFunctionModule(n,6,n%2===0,$s.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const t=this.getAlignmentPatternPositions(),r=t.length;for(let n=0;n<r;n++)for(let i=0;i<r;i++)n===0&&i===0||n===0&&i===r-1||n===r-1&&i===0||this.drawAlignmentPattern(t[n],t[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(t){const r=this.ecc[1]<<3|t;let n=r;for(let s=0;s<10;s++)n=n<<1^(n>>>9)*1335;const i=(r<<10|n)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Ui(i,s));this.setFunctionModule(8,7,Ui(i,6)),this.setFunctionModule(8,8,Ui(i,7)),this.setFunctionModule(7,8,Ui(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Ui(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Ui(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Ui(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let t=this.version;for(let n=0;n<12;n++)t=t<<1^(t>>>11)*7973;const r=this.version<<12|t;for(let n=0;n<18;n++){const i=Ui(r,n),s=this.size-11+n%3,o=Math.floor(n/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(t,r){for(let n=-4;n<=4;n++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(n)),o=t+i,a=r+n;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,$s.Position)}}drawAlignmentPattern(t,r){for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++)this.setFunctionModule(t+i,r+n,Math.max(Math.abs(i),Math.abs(n))!==1,$s.Alignment)}setFunctionModule(t,r,n,i=$s.Function){this.modules[r][t]=n,this.types[r][t]=i}addEccAndInterleave(t){const r=this.version,n=this.ecc;if(t.length!==pu(r,n))throw new RangeError("Invalid argument");const i=Mv[n[0]][r],s=Lv[n[0]][r],o=Math.floor(Jd(r)/8),a=i-o%i,c=Math.floor(o/i),u=[],l=LP(s);for(let d=0,f=0;d<i;d++){const m=t.slice(f,f+c-s+(d<a?0:1));f+=m.length;const p=MP(m,l);d<a&&m.push(0),u.push(m.concat(p))}const h=[];for(let d=0;d<u[0].length;d++)u.forEach((f,m)=>{(d!==c-s||m>=a)&&h.push(f[d])});return h}drawCodewords(t){if(t.length!==Math.floor(Jd(this.version)/8))throw new RangeError("Invalid argument");let r=0;for(let n=this.size-1;n>=1;n-=2){n===6&&(n=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=n-s,c=(n+1&2)===0?this.size-1-i:i;!this.types[c][o]&&r<t.length*8&&(this.modules[c][o]=Ui(t[r>>>3],7-(r&7)),r++)}}}applyMask(t){if(t<0||t>7)throw new RangeError("Mask value out of range");for(let r=0;r<this.size;r++)for(let n=0;n<this.size;n++){let i;switch(t){case 0:i=(n+r)%2===0;break;case 1:i=r%2===0;break;case 2:i=n%3===0;break;case 3:i=(n+r)%3===0;break;case 4:i=(Math.floor(n/3)+Math.floor(r/2))%2===0;break;case 5:i=n*r%2+n*r%3===0;break;case 6:i=(n*r%2+n*r%3)%2===0;break;case 7:i=((n+r)%2+n*r%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[r][n]&&i&&(this.modules[r][n]=!this.modules[r][n])}}getPenaltyScore(){let t=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let u=0;u<this.size;u++)this.modules[s][u]===o?(a++,a===5?t+=Cv:a>5&&t++):(this.finderPenaltyAddHistory(a,c),o||(t+=this.finderPenaltyCountPatterns(c)*du),o=this.modules[s][u],a=1);t+=this.finderPenaltyTerminateAndCount(o,a,c)*du}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let u=0;u<this.size;u++)this.modules[u][s]===o?(a++,a===5?t+=Cv:a>5&&t++):(this.finderPenaltyAddHistory(a,c),o||(t+=this.finderPenaltyCountPatterns(c)*du),o=this.modules[u][s],a=1);t+=this.finderPenaltyTerminateAndCount(o,a,c)*du}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(t+=vP)}let r=0;for(const s of this.modules)r=s.reduce((o,a)=>o+(a?1:0),r);const n=this.size*this.size,i=Math.ceil(Math.abs(r*20-n*10)/n)-1;return t+=i*kP,t}getAlignmentPatternPositions(){if(this.version===1)return[];{const t=Math.floor(this.version/7)+2,r=this.version===32?26:Math.ceil((this.version*4+4)/(t*2-2))*2,n=[6];for(let i=this.size-7;n.length<t;i-=r)n.splice(1,0,i);return n}}finderPenaltyCountPatterns(t){const r=t[1],n=r>0&&t[2]===r&&t[3]===r*3&&t[4]===r&&t[5]===r;return(n&&t[0]>=r*4&&t[6]>=r?1:0)+(n&&t[6]>=r*4&&t[0]>=r?1:0)}finderPenaltyTerminateAndCount(t,r,n){return t&&(this.finderPenaltyAddHistory(r,n),r=0),r+=this.size,this.finderPenaltyAddHistory(r,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(t,r){r[0]===0&&(t+=this.size),r.pop(),r.unshift(t)}}function Mi(e,t,r){if(t<0||t>31||e>>>t)throw new RangeError("Value out of range");for(let n=t-1;n>=0;n--)r.push(e>>>n&1)}function Ui(e,t){return(e>>>t&1)!==0}class Xd{constructor(t,r,n){if(this.mode=t,this.numChars=r,this.bitData=n,r<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}getData(){return this.bitData.slice()}}const AP=[1,10,12,14],TP=[2,9,11,13],SP=[4,8,16,16];function Uv(e,t){return e[Math.floor((t+7)/17)+1]}function Pv(e){const t=[];for(const r of e)Mi(r,8,t);return new Xd(SP,e.length,t)}function RP(e){if(!Fv(e))throw new RangeError("String contains non-numeric characters");const t=[];for(let r=0;r<e.length;){const n=Math.min(e.length-r,3);Mi(Number.parseInt(e.substring(r,r+n),10),n*3+1,t),r+=n}return new Xd(AP,e.length,t)}function OP(e){if(!Bv(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");const t=[];let r;for(r=0;r+2<=e.length;r+=2){let n=Yd.indexOf(e.charAt(r))*45;n+=Yd.indexOf(e.charAt(r+1)),Mi(n,11,t)}return r<e.length&&Mi(Yd.indexOf(e.charAt(r)),6,t),new Xd(TP,e.length,t)}function IP(e){return e===""?[]:Fv(e)?[RP(e)]:Bv(e)?[OP(e)]:[Pv(CP(e))]}function Fv(e){return wP.test(e)}function Bv(e){return EP.test(e)}function NP(e,t){let r=0;for(const n of e){const i=Uv(n.mode,t);if(n.numChars>=1<<i)return Number.POSITIVE_INFINITY;r+=4+i+n.bitData.length}return r}function CP(e){e=encodeURI(e);const t=[];for(let r=0;r<e.length;r++)e.charAt(r)!=="%"?t.push(e.charCodeAt(r)):(t.push(Number.parseInt(e.substring(r+1,r+3),16)),r+=2);return t}function Jd(e){if(e<qd||e>Vd)throw new RangeError("Version number out of range");let t=(16*e+128)*e+64;if(e>=2){const r=Math.floor(e/7)+2;t-=(25*r-10)*r-55,e>=7&&(t-=36)}return t}function pu(e,t){return Math.floor(Jd(e)/8)-Lv[t[0]][e]*Mv[t[0]][e]}function LP(e){if(e<1||e>255)throw new RangeError("Degree out of range");const t=[];for(let n=0;n<e-1;n++)t.push(0);t.push(1);let r=1;for(let n=0;n<e;n++){for(let i=0;i<t.length;i++)t[i]=Zd(t[i],r),i+1<t.length&&(t[i]^=t[i+1]);r=Zd(r,2)}return t}function MP(e,t){const r=t.map(n=>0);for(const n of e){const i=n^r.shift();r.push(0),t.forEach((s,o)=>r[o]^=Zd(s,i))}return r}function Zd(e,t){if(e>>>8||t>>>8)throw new RangeError("Byte out of range");let r=0;for(let n=7;n>=0;n--)r=r<<1^(r>>>7)*285,r^=(t>>>n&1)*e;return r}function UP(e,t,r=1,n=40,i=-1,s=!0){if(!(qd<=r&&r<=n&&n<=Vd)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=r;;o++){const h=pu(o,t)*8,d=NP(e,o);if(d<=h){a=d;break}if(o>=n)throw new RangeError("Data too long")}for(const h of[Ov,Iv,Nv])s&&a<=pu(o,h)*8&&(t=h);const c=[];for(const h of e){Mi(h.mode[0],4,c),Mi(h.numChars,Uv(h.mode,o),c);for(const d of h.getData())c.push(d)}const u=pu(o,t)*8;Mi(0,Math.min(4,u-c.length),c),Mi(0,(8-c.length%8)%8,c);for(let h=236;c.length<u;h^=253)Mi(h,8,c);const l=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,d)=>l[d>>>3]|=h<<7-(d&7)),new xP(o,t,l,i)}function PP(e,t){var h;const{ecc:r="L",boostEcc:n=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=t||{},c=typeof e=="string"?IP(e):Array.isArray(e)?[Pv(e)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof e}`);const u=UP(c,bP[r],i,s,o,n),l=FP({version:u.version,maskPattern:u.mask,size:u.size,data:u.modules,types:u.types},a);return t!=null&&t.invert&&(l.data=l.data.map(d=>d.map(f=>!f))),(h=t==null?void 0:t.onEncoded)==null||h.call(t,l),l}function FP(e,t=1){if(!t)return e;const{size:r}=e,n=r+t*2;e.size=n,e.data.forEach(s=>{for(let o=0;o<t;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<t;s++)e.data.unshift(Array.from({length:n},o=>!1)),e.data.push(Array.from({length:n},o=>!1));const i=$s.Border;e.types.forEach(s=>{for(let o=0;o<t;o++)s.unshift(i),s.push(i)});for(let s=0;s<t;s++)e.types.unshift(Array.from({length:n},o=>i)),e.types.push(Array.from({length:n},o=>i));return e}function BP(e,t,r,n=!1){return t<0||r<0||t>=e.length||r>=e.length?n:e[r][t]}function $P(e,t={}){const r={WHITE_ALL:"█",WHITE_BLACK:"▀",BLACK_WHITE:"▄",BLACK_ALL:" "},n=PP(e,t),i=!1,s=!0,o=(u,l)=>BP(n.data,u,l,!0),a=[];let c="";for(let u=0;u<n.size;u+=2){for(let l=0;l<n.size;l++)o(l,u)===i&&o(l,u+1)===i?c+=r.WHITE_ALL:o(l,u)===i&&o(l,u+1)===s?c+=r.WHITE_BLACK:o(l,u)===s&&o(l,u+1)===i?c+=r.BLACK_WHITE:c+=r.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const ts="$dkpurple",DP="$196",jP="$205",Xe="$yellow$205$205$205$196";function be(e,t,r){mT(e,t,r)}function zP(e,t,r){const n=DP.repeat(r);be(e,t,`${ts}${n}`)}function Qd(e,t,r){const n=jP.repeat(r);be(e,t,`${ts}${n}`)}function tp(e,t,r){be(e,t,`${ts} ${" ".repeat(r.length)} `),zP(e,t,r.length+2),be(e,t,`${ts} $white${r} `),Qd(e,t,r.length+2)}function Ds(e,t,r){be(e,t,`${ts} ${" ".repeat(r.length)} `),be(e,t,`${ts} $gray${r} `),Qd(e,t,r.length+2)}function js(e,t,r,n){be(e,t,`${ts} $white${r} $blue${n}`)}function Mo(e,t,r){be(e,t,`${ts}$blue${r}`)}function WP(e,t,r,n){be(e,t,`!${r};${n}`)}function HP(e,t,r,n,i=!0){if(i){const s=$P(r).split(`
`),o={32:32,9600:223,9604:220,9608:219};for(let a=0;a<s.length;a++){const c=[...s[a]].map(u=>`$${o[u.charCodeAt(0)]}`).join("");be(e,t,c)}}be(e,t,`!copyit ${r};${n}`),VT(e,t)}var GP=`desc;$DKGRAYname and type of codepage
`,KP=Object.freeze({__proto__:null,default:GP}),YP="desc;changes object into specified element",qP=Object.freeze({__proto__:null,default:YP}),VP="desc;like #play but for sound effects",XP=Object.freeze({__proto__:null,default:VP}),JP="",ZP=Object.freeze({__proto__:null,default:JP}),QP="",tF=Object.freeze({__proto__:null,default:QP}),eF="",rF=Object.freeze({__proto__:null,default:eF}),nF="",iF=Object.freeze({__proto__:null,default:nF}),sF="",oF=Object.freeze({__proto__:null,default:sF}),aF="",cF=Object.freeze({__proto__:null,default:aF}),lF="",uF=Object.freeze({__proto__:null,default:lF}),fF="",hF=Object.freeze({__proto__:null,default:fF}),dF="",pF=Object.freeze({__proto__:null,default:dF}),mF="",gF=Object.freeze({__proto__:null,default:mF}),yF="",_F=Object.freeze({__proto__:null,default:yF}),bF="",wF=Object.freeze({__proto__:null,default:bF}),EF="",vF=Object.freeze({__proto__:null,default:EF}),kF="",xF=Object.freeze({__proto__:null,default:kF}),AF="",TF=Object.freeze({__proto__:null,default:AF}),SF=`desc;$DKGRAYstarts a section of an if-do-done block
`,RF=Object.freeze({__proto__:null,default:SF}),OF=`desc;$DKGRAYcompletes an if-do-done block
`,IF=Object.freeze({__proto__:null,default:OF}),NF="",CF=Object.freeze({__proto__:null,default:NF}),LF="",MF=Object.freeze({__proto__:null,default:LF}),UF="",PF=Object.freeze({__proto__:null,default:UF}),FF=`desc;$DKGRAYelse logic in an if-do-done block
`,BF=Object.freeze({__proto__:null,default:FF}),$F=`desc;$DKGRAYconditional else logic in an if-do-done block
`,DF=Object.freeze({__proto__:null,default:$F}),jF="",zF=Object.freeze({__proto__:null,default:jF}),WF="",HF=Object.freeze({__proto__:null,default:WF}),GF="",KF=Object.freeze({__proto__:null,default:GF}),YF="",qF=Object.freeze({__proto__:null,default:YF}),VF="",XF=Object.freeze({__proto__:null,default:VF}),JF="",ZF=Object.freeze({__proto__:null,default:JF}),QF="",tB=Object.freeze({__proto__:null,default:QF}),eB="",rB=Object.freeze({__proto__:null,default:eB}),nB=`desc;$DKGRAYhalt until the next cycle
`,iB=Object.freeze({__proto__:null,default:nB}),sB=`desc;$DKGRAYevals condition for true or false
`,oB=Object.freeze({__proto__:null,default:sB}),aB="",cB=Object.freeze({__proto__:null,default:aB}),lB="",uB=Object.freeze({__proto__:null,default:lB}),fB="",hB=Object.freeze({__proto__:null,default:fB}),dB="",pB=Object.freeze({__proto__:null,default:dB}),mB="",gB=Object.freeze({__proto__:null,default:mB}),yB="",_B=Object.freeze({__proto__:null,default:yB}),bB="",wB=Object.freeze({__proto__:null,default:bB}),EB="",vB=Object.freeze({__proto__:null,default:EB}),kB="",xB=Object.freeze({__proto__:null,default:kB}),AB="",TB=Object.freeze({__proto__:null,default:AB}),SB="",RB=Object.freeze({__proto__:null,default:SB}),OB="",IB=Object.freeze({__proto__:null,default:OB}),NB="",CB=Object.freeze({__proto__:null,default:NB}),LB="",MB=Object.freeze({__proto__:null,default:LB}),UB="",PB=Object.freeze({__proto__:null,default:UB}),FB="",BB=Object.freeze({__proto__:null,default:FB}),$B="",DB=Object.freeze({__proto__:null,default:$B}),jB="",zB=Object.freeze({__proto__:null,default:jB}),WB="",HB=Object.freeze({__proto__:null,default:WB}),GB="",KB=Object.freeze({__proto__:null,default:GB}),YB="",qB=Object.freeze({__proto__:null,default:YB}),VB=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,XB=Object.freeze({__proto__:null,default:VB}),JB="",ZB=Object.freeze({__proto__:null,default:JB}),QB="",t$=Object.freeze({__proto__:null,default:QB}),e$="",r$=Object.freeze({__proto__:null,default:e$}),n$="",i$=Object.freeze({__proto__:null,default:n$}),s$="",o$=Object.freeze({__proto__:null,default:s$}),a$="",c$=Object.freeze({__proto__:null,default:a$}),l$="",u$=Object.freeze({__proto__:null,default:l$}),f$="",h$=Object.freeze({__proto__:null,default:f$}),d$="",p$=Object.freeze({__proto__:null,default:d$}),m$="",g$=Object.freeze({__proto__:null,default:m$}),y$="",_$=Object.freeze({__proto__:null,default:y$}),b$="",w$=Object.freeze({__proto__:null,default:b$}),E$="",v$=Object.freeze({__proto__:null,default:E$}),k$="",x$=Object.freeze({__proto__:null,default:k$}),A$="",T$=Object.freeze({__proto__:null,default:A$}),S$="",R$=Object.freeze({__proto__:null,default:S$}),O$="",I$=Object.freeze({__proto__:null,default:O$}),N$="",C$=Object.freeze({__proto__:null,default:N$}),L$="",M$=Object.freeze({__proto__:null,default:L$}),U$=`desc;$DKGRAYdesignates an inactive label or comment
`,P$=Object.freeze({__proto__:null,default:U$}),F$=`desc;$DKGRAYadds hyperlink text

`,B$=Object.freeze({__proto__:null,default:F$}),$$=`desc;$DKGRAYsends the given message when hotkey is pressed

`,D$=Object.freeze({__proto__:null,default:$$}),j$=`desc;$DKGRAYread number input into given stat/flag
`,z$=Object.freeze({__proto__:null,default:j$}),W$=`desc;$DKGRAYa slider input from 1 to 9 

`,H$=Object.freeze({__proto__:null,default:W$}),G$=`desc;$DKGRAYlist with label value pairs to pick from
`,K$=Object.freeze({__proto__:null,default:G$}),Y$=`desc;$DKGRAYread text input into given stat/flag
`,q$=Object.freeze({__proto__:null,default:Y$}),V$=`desc;$DKGRAYdesignates a starting point for running code
`,X$=Object.freeze({__proto__:null,default:V$}),J$=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,Z$=Object.freeze({__proto__:null,default:J$}),Q$=`desc;$DKGRAYwill move the object in the given direction
`,tD=Object.freeze({__proto__:null,default:Q$}),eD=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,rD=Object.freeze({__proto__:null,default:eD}),nD=`desc;$DKGRAYcustom 8x14 charset
`,iD=Object.freeze({__proto__:null,default:nD}),sD=`desc;$DKGRAYsets stat to given value

`,oD=Object.freeze({__proto__:null,default:sD}),aD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,cD=Object.freeze({__proto__:null,default:aD}),lD=`desc;$DKGRAYread external content and/or handle events
`,uD=Object.freeze({__proto__:null,default:lD}),fD=`desc;$DKGRAYread number input into given stat/flag
`,hD=Object.freeze({__proto__:null,default:fD}),dD=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,pD=Object.freeze({__proto__:null,default:dD}),mD=`desc;$DKGRAYcustom palette colors
`,gD=Object.freeze({__proto__:null,default:mD}),yD=`desc;$DKGRAYa slider input from 1 to 9 

`,_D=Object.freeze({__proto__:null,default:yD}),bD=`desc;$DKGRAYlist with label value pairs to pick from
`,wD=Object.freeze({__proto__:null,default:bD}),ED=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,vD=Object.freeze({__proto__:null,default:ED}),kD=`desc;$DKGRAYread text input into given stat/flag
`,xD=Object.freeze({__proto__:null,default:kD}),AD=`desc;$DKGRAYadds text
`,TD=Object.freeze({__proto__:null,default:AD}),SD=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,RD=Object.freeze({__proto__:null,default:SD}),OD=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,ID=Object.freeze({__proto__:null,default:OD}),ND=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,CD=Object.freeze({__proto__:null,default:ND}),LD=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,MD=Object.freeze({__proto__:null,default:LD}),UD=`header;player settings
#set user "name goes here"
`,PD=Object.freeze({__proto__:null,default:UD}),FD=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,BD=Object.freeze({__proto__:null,default:FD});const $v=Object.assign({"./editor/codepagename.txt":KP,"./editor/command/become.txt":qP,"./editor/command/bgplay.txt":XP,"./editor/command/bgvol.txt":ZP,"./editor/command/bind.txt":tF,"./editor/command/board.txt":rF,"./editor/command/bpm.txt":iF,"./editor/command/break.txt":oF,"./editor/command/change.txt":cF,"./editor/command/char.txt":uF,"./editor/command/charset.txt":hF,"./editor/command/clear.txt":pF,"./editor/command/color.txt":gF,"./editor/command/continue.txt":_F,"./editor/command/copy.txt":wF,"./editor/command/cycle.txt":vF,"./editor/command/die.txt":xF,"./editor/command/distort.txt":TF,"./editor/command/do.txt":RF,"./editor/command/done.txt":IF,"./editor/command/duplicate.txt":CF,"./editor/command/echo.txt":MF,"./editor/command/edge.txt":PF,"./editor/command/else.txt":BF,"./editor/command/elseif.txt":DF,"./editor/command/end.txt":zF,"./editor/command/endgame.txt":HF,"./editor/command/endwith.txt":KF,"./editor/command/fcrush.txt":qF,"./editor/command/fetch.txt":XF,"./editor/command/fetchwith.txt":ZF,"./editor/command/foreach.txt":tB,"./editor/command/go.txt":rB,"./editor/command/idle.txt":iB,"./editor/command/if.txt":oB,"./editor/command/lock.txt":cB,"./editor/command/oneof.txt":uB,"./editor/command/oneofwith.txt":hB,"./editor/command/palette.txt":pB,"./editor/command/phaser.txt":gB,"./editor/command/pivot.txt":_B,"./editor/command/play.txt":wB,"./editor/command/put.txt":vB,"./editor/command/putwith.txt":xB,"./editor/command/readbin.txt":TB,"./editor/command/readjson.txt":RB,"./editor/command/readline.txt":IB,"./editor/command/readrexpaint.txt":CB,"./editor/command/remix.txt":MB,"./editor/command/repeat.txt":PB,"./editor/command/restore.txt":BB,"./editor/command/reverb.txt":DB,"./editor/command/revert.txt":zB,"./editor/command/run.txt":HB,"./editor/command/runwith.txt":KB,"./editor/command/set.txt":qB,"./editor/command/shoot.txt":XB,"./editor/command/shootwith.txt":ZB,"./editor/command/shove.txt":t$,"./editor/command/snapshot.txt":r$,"./editor/command/synth.txt":i$,"./editor/command/toast.txt":o$,"./editor/command/tts.txt":c$,"./editor/command/ttsvol.txt":u$,"./editor/command/twitchbroadcast.txt":h$,"./editor/command/twitchchat.txt":p$,"./editor/command/unlock.txt":g$,"./editor/command/vibrato.txt":_$,"./editor/command/vol.txt":w$,"./editor/command/waitfor.txt":v$,"./editor/command/walk.txt":x$,"./editor/command/weave.txt":T$,"./editor/command/while.txt":R$,"./editor/command/with.txt":I$,"./editor/command/write.txt":C$,"./editor/command/zap.txt":M$,"./editor/comment.txt":P$,"./editor/hyperlink.txt":B$,"./editor/hyperlink/hotkey.txt":D$,"./editor/hyperlink/number.txt":z$,"./editor/hyperlink/range.txt":H$,"./editor/hyperlink/select.txt":K$,"./editor/hyperlink/text.txt":q$,"./editor/label.txt":X$,"./editor/shortgo.txt":Z$,"./editor/shorttry.txt":tD,"./editor/stat/board.txt":rD,"./editor/stat/charset.txt":iD,"./editor/stat/const.txt":oD,"./editor/stat/hotkey.txt":cD,"./editor/stat/loader.txt":uD,"./editor/stat/number.txt":hD,"./editor/stat/object.txt":pD,"./editor/stat/palette.txt":gD,"./editor/stat/range.txt":_D,"./editor/stat/select.txt":wD,"./editor/stat/terrain.txt":vD,"./editor/stat/text.txt":xD,"./editor/text.txt":TD,"./help/controls.txt":RD,"./help/developer.txt":ID,"./help/menu.txt":CD,"./help/nopages.txt":MD,"./help/player.txt":PD,"./help/text.txt":BD}),Dv={};Br($v).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");Dv[t]=$v[e].default});function $D(e){const t=zt(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),r=Dv[t];if(w(r))return r;const{target:n,path:i}=Dr(t);switch(n){case"editor":{const s=Dr(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function DD(e,t){const r=(e??"").split(`
`);for(let n=0;n<r.length;++n)t(r[n].split(";"))}function jD(e,t){const[r,...n]=t,i=n[0]??"",s=n[1]??"";switch(zt(r.trim())){case"header":tp(lt,e,i);break;case"section":Ds(lt,e,i);break;case"option":js(lt,e,i,s);break;default:r.trimStart().startsWith("!")?WP(lt,e,r.trimStart().slice(1),i):be(lt,e,r);break}}function Pi(e,t=!1){const[r]=ft(e,0,[J.ANY]);if(t&&on(r)){const[n,i,s]=ft(e,0,[J.DIR,J.MAYBE_NAME]);return _t(i)&&i.startsWith(":")?{targetdir:n,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:n,label:e.slice(s-1).join(" ")}}else if(_t(r)){const[n,i,s]=ft(e,0,[J.NAME,J.MAYBE_NAME]);if(_t(i)&&i.startsWith(":")){const a=[i.substring(1).trim(),...e.slice(s)];return{targetname:n,label:a.join(" ")}}return{targetname:"self",label:[n,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function zs(){im(lt,Pr())}function Uo(e){DD($D(`help:${e}`),t=>jD(k.elementfocus,t))}function jv(e){switch(e.label){case"helpmenu":Uo("menu");break;case"helpcontrols":Uo("controls");break;case"helptext":Uo("text");break;case"helpdeveloper":Uo("developer");break;case"helpplayer":Uo("player");break;default:{const t=me(Jt.MAIN),r=Lo(t);w(e.targetname)?Go(e.targetname,e.label,void 0,r):w(e.targetdir)&&Go(e.targetdir.destpt,e.label,void 0,r);break}}}const zD=xi().command("shortsend",(e,t)=>{const r=Pi(t);return jv(r),0}).command("send",(e,t)=>{const r=Pi(t,!0);return jv(r),0}).command("stat",(e,t)=>{const[r,...n]=t.map(Re),i=n.join(" ");function s(o,a){if(w(o)&&(e.command("pageopen",o.id),a)){const c=_e(o),u=Ci(o);be(lt,k.elementfocus,`!pageopen ${o.id};$blue[${u}]$white ${c}`)}}switch(zt(r)){case ln(Ft.LOADER):{const[o,a]=os(Jt.MAIN,i,Tt.LOADER);s(o,a);break}default:{const[o,a]=os(Jt.MAIN,[r,...n].join(" "),Tt.OBJECT);s(o,a);break}case ln(Ft.BOARD):{const[o,a]=os(Jt.MAIN,i,Tt.BOARD);s(o,a);break}case ln(Ft.OBJECT):{const[o,a]=os(Jt.MAIN,i,Tt.OBJECT);s(o,a);break}case ln(Ft.TERRAIN):{const[o,a]=os(Jt.MAIN,i,Tt.TERRAIN);s(o,a);break}case ln(Ft.CHARSET):{const[o,a]=os(Jt.MAIN,i,Tt.CHARSET);s(o,a);break}case ln(Ft.PALETTE):{const[o,a]=os(Jt.MAIN,i,Tt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const r=t.map(Re).join(" ");if(w(k.element)&&k.elementisplayer){const{user:n}=Rn(k.elementid),i=_t(n)?n:"player";k.element.tickertext=`${i}: ${r}`,k.element.tickertime=k.timestamp;const s=dr(k.element);Pe(lt,k.elementid,`$${Kt[s.color]}$ON${Kt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${r}`),of(lt,k.elementid,void 0,"text","chat:message:game",`${i}:${r}`)}return 0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Re(r),s=Pi(n);if(w(s.targetname)){const{user:o}=Rn(k.elementid),a=_t(o)?o:"player",c=dr(k.element),u=`$${Kt[c.color]}$ON${Kt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;Pe(lt,k.elementid,`!${s.targetname}:${s.label};${u}`)}return 0}).command("config",(e,t)=>{const[r,n]=ft(t,0,[J.MAYBE_NAME,J.MAYBE_STRING]);return _t(r)&&_t(n)?em(lt,k.elementfocus,r,n):YT(lt,k.elementfocus),0}).command("bookcreate",(e,t)=>{const[r]=ft(t,0,[J.MAYBE_NAME]),n=Bx(r);return w(n)&&e.command("bookopen",n.id),0}).command("bookopen",(e,t)=>{const[r]=ft(t,0,[J.NAME]),n=Hn(r);return w(n)?(em(lt,k.elementfocus,"selected",n.id),zs()):ye(lt,k.elementfocus,"bookopen",`book ${r} not found`),0}).command("booktrash",(e,t)=>{const[r]=ft(t,0,[J.NAME]),n=me(Jt.MAIN),i=Hn(r);return w(i)&&(n===i&&Fx(Jt.MAIN,""),Ij(r),Pe(lt,k.elementfocus,`trashed [book] ${i.name}`),zs(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[r]=ft(t,0,[J.NAME]),n=yr(r);return w(n)&&Co(k.book,k.elementfocus,n.id,{x:yn(0,Nt-1),y:yn(0,Qt-1)},!0),0}).command("pageopen",(e,t)=>{const[r,n]=ft(t,0,[J.NAME,J.MAYBE_NAME]);let i,s;const o=Tn();for(let a=0;a<o.length&&(s=o[a],i=Ps(s,r),!w(i));++a);if(w(i)&&w(s)){const a=_e(i),c=[i.id,n];rh(_c(s.id,c),i.code);const u=Ci(i);rm(lt,k.elementfocus,s.id,c,u,`${a} - ${s.name}`)}else ye(lt,"pageopen",`page ${r} not found`,k.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[r]=ft(t,0,[J.NAME]),n=gr(Jt.MAIN),i=dv(n,r);if(w(r)){const s=_e(i),o=Ci(i);Pe(lt,k.elementfocus,`trashed [${o}] ${s}`),zs(),e.command("pages")}return 0}).command("help",(e,t)=>{const r=t.map(Re).join(" ")||"menu";return e.command(`help${r}`),0}).command("books",()=>{Ds(lt,k.elementfocus,"books");const e=me(Jt.MAIN);js(lt,k.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=me(Jt.MAIN);js(lt,k.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Qd(lt,k.elementfocus,7);const r=Tn();return r.length?r.forEach(n=>{be(lt,k.elementfocus,`!bookopen ${n.id};${n.name}`)}):Mo(lt,k.elementfocus,"no books found"),be(lt,k.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=gr(Jt.MAIN);if(!w(e))return 0;Ds(lt,k.elementfocus,"pages"),js(lt,k.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Va(e).forEach(n=>{const i=_e(n),s=Ci(n);be(lt,k.elementfocus,`!pageopen ${n.id};$blue[${s}]$white ${i}`)}):(be(lt,k.elementfocus,""),Uo("nopages"));const t=Tn();for(let r=0;r<t.length;++r){const n=t[r];n.id!==e.id&&(js(lt,k.elementfocus,"content",`${n.name} $GREEN${n.id}`),Va(n).forEach(s=>{const o=_e(s),a=Ci(s);be(lt,k.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Ds(lt,k.elementfocus,"boards");const e=gr(Jt.MAIN);if(w(e)){js(lt,k.elementfocus,"main",`${e.name} $GREEN${e.id}`);const r=Va(e);r.filter(n=>di(n)===Tt.BOARD).forEach(n=>{const i=_e(n);be(lt,k.elementfocus,`!boardopen ${n.id};$blue[#goto]$white ${i}`)}),r.length===0&&(be(lt,k.elementfocus,""),Mo(lt,k.elementfocus,"$white no boards found"),Mo(lt,k.elementfocus,"$white use @ to create a board"),Mo(lt,k.elementfocus,"$white @board name of board"))}const t=Tn();for(let r=0;r<t.length;++r){const n=t[r];n.id!==e.id&&(js(lt,k.elementfocus,"content",`${n.name} $GREEN${n.id}`),Va(n).filter(s=>di(s)===Tt.BOARD).forEach(s=>{const o=_e(s);be(lt,k.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{Ds(lt,k.elementfocus,"$REDTRASH"),Mo(lt,k.elementfocus,"books");const e=Tn();e.length&&(e.forEach(r=>{be(lt,k.elementfocus,`!booktrash ${r.id};$REDTRASH ${r.name}`)}),be(lt,k.elementfocus,""));const t=me(Jt.MAIN);return w(t)&&(Mo(lt,k.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(r=>{const n=_e(r);be(lt,k.elementfocus,`!pagetrash ${r.id};$REDTRASH ${n}`)}),be(lt,k.elementfocus,"")),0}).command("dev",()=>(zs(),PT(lt,k.elementfocus),0)).command("share",()=>(zs(),FT(lt,k.elementfocus),0)).command("save",()=>(zs(),0)).command("fork",()=>(rS(lt,k.elementfocus),0)).command("itchiopublish",()=>(nS(lt,k.elementfocus),0)).command("nuke",()=>(BT(lt,k.elementfocus),0)).command("restart",()=>(eS(lt,k.elementfocus),zs(),0)).command("export",()=>{tp(lt,k.elementfocus,"E X P O R T"),Ds(lt,k.elementfocus,"books");const e=Tn();return e.length&&e.forEach(t=>be(lt,k.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[r]=ft(t,0,[J.NAME]),n=Hn(r);return w(n)&&(tp(lt,k.elementfocus,"E X P O R T"),Ds(lt,k.elementfocus,"pages"),setTimeout(()=>{if(n.pages.length){const i=Va(n);be(lt,k.elementfocus,`!bookallexport ${r};$blue[all]$white export book`),i.forEach(s=>{const o=_e(s),a=Ci(s);be(lt,k.elementfocus,`!pageexport ${r}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[r]=ft(t,0,[J.NAME]),n=Hn(r);return w(n)&&Q0(lt,k.elementfocus,Nn(n),`${n.name}.book.json`),0}).command("pageexport",(e,t)=>{const[r]=ft(t,0,[J.NAME]),{target:n,path:i}=Dr(r),s=Hn(n),o=Ps(s,i);return w(o)&&Q0(lt,k.elementfocus,Nn(o),`${_e(o)}.${Ci(o)}.json`),0}).command("gadget",()=>(qT(lt,k.elementfocus),0)).command("zztsearch",(e,t)=>{const[r,n]=ft(t,0,[J.NAME,J.MAYBE_NAME]),i=w(n)?r:"title",s=w(n)?n:r;return XT(lt,k.elementfocus,i,s),0}).command("zztrandom",()=>(JT(lt,k.elementfocus),0)).command("joincode",(e,t)=>{const[r]=ft(t,0,[J.MAYBE_NAME]);return AT(lt,k.elementfocus,!!r),0}).command("jointab",(e,t)=>{const[r]=ft(t,0,[J.MAYBE_NAME]);return TT(lt,k.elementfocus,!!r),0}).command("startlookingglass",()=>($T(lt,k.elementfocus),0)),WD=xi().command("toast",(e,t)=>{const r=t.map(Re).join("");return yc(lt,k.elementfocus,r),0}).command("ticker",(e,t)=>{const r=t.map(Re).join("");return w(k.element)&&(k.element.tickertext=r,k.element.tickertime=k.timestamp),0}).command("palette",(e,t)=>{const[r]=ft(t,0,[J.NAME]),n=Dx(),i=sr(k.book,Tt.PALETTE,r);return w(i)?(n.palette=i.id,Pe(lt,k.elementfocus,`loaded palette ${r}`)):ye(lt,k.elementfocus,"not-found",`unabled to find palette ${r}`),0}).command("charset",(e,t)=>{const[r]=ft(t,0,[J.NAME]),n=Dx(),i=sr(k.book,Tt.CHARSET,r);return w(i)?(n.charset=i.id,Pe(lt,k.elementfocus,`loaded charset ${r}`)):ye(lt,k.elementfocus,"not-found",`unabled to find charset ${r}`),0}),ep={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Wt.ISSOLID,Wt.ISWALK,Wt.ISSWIM,Wt.ISBULLET,Wt.ISGHOST,Wt.ISWALK,Wt.ISSWIM;function mu(e){return he(e)&&rp(e[0])}function rp(e){return w(Wt[e])&&_t(e)}function HD(e){if(_t(e))return ep[zt(e)]}function GD(e){const t=k.words[e];if(mu(t))return[t,e+1];if(rp(t))return[[t],e+1];const[r,n]=Mr(e);return mu(r)?[r,n]:rp(r)?[[r],n]:[void 0,e]}function Po(e,t=0){const r=[];let n=e;for(;n<k.words.length;){const[i,s]=Mr(n);if(he(i)&&!on(i)&&!Qa(i)&&!mu(i)&&!Ir(i)&&r.push(...i),i==="|")return[r,s];if(n=s,r.push(i),t>0&&r.length>=t)return[r,n]}return[r,n]}function Mr(e){var n,i,s,o,a,c,u,l,h;const t=k.words[e],r=e+1;if(Wv(t)){const[d,f]=KD(e);if(w(d))return[d,f]}if(HD(t)){const[d,f]=GD(e);if(w(d))return[d,f]}if(ba(t)){const[d,f]=el(e);if(w(d))return[d,f]}if(_t(t)&&zt(t)==="rnd"){const[d,f]=Mr(r),[m,p]=Mr(f);return xt(d)&&xt(m)?[yn(d,m),p]:xt(d)?[yn(0,d),f]:[yn(0,1),r]}if(Zc(t)){const[d,f]=yy(e);if(w(d))return[d,f]}if(!w(t))return[void 0,e];if(xt(t)||he(t))return[t,r];if(_t(t)){const d=zt(t),f=(n=k.get)==null?void 0:n.call(k,t);if(w(f))return[f,r];switch(d){case"aligned":case"alligned":{const m=uc(k.board,{x:((i=k.element)==null?void 0:i.x)??-1,y:((s=k.element)==null?void 0:s.y)??-1},k.elementfocus);return!w(k.element)||!w(m)?[0,r]:[k.element.x===m.x||k.element.y===m.y?1:0,r]}case"contact":{const m=uc(k.board,{x:((o=k.element)==null?void 0:o.x)??-1,y:((a=k.element)==null?void 0:a.y)??-1},k.elementfocus);if(!w(k.element)||!w(m))return[0,r];const p=(m.x??0)-(((c=k.element)==null?void 0:c.x)??0),g=(m.y??0)-(((u=k.element)==null?void 0:u.y)??0);return[p===0&&Math.abs(g)<2||g===0&&Math.abs(p)<2?1:0,r]}case"blocked":{const[m,p]=ft(k.words,r,[J.DIR]);return[q3(k.board,k.element,m.destpt)?1:0,p]}case"any":{const[m]=ft(k.words,r,[J.ANY]);if(on(m)){const[b,S,T]=ft(k.words,r,[J.DIR,J.COLOR_OR_KIND]);if(b.targets.length){const N=[];for(let R=0;R<b.targets.length;++R){const B=b.targets[R],M=["any","at",B.x,B.y,...S],[H]=ft(M,0,[J.ANY]);he(H)&&H.length&&N.push(...H)}return[N,T]}const x=b.layer===bt.MID?se(k.board,b.destpt):as(k.board,b.destpt.x,b.destpt.y);if(w(x)){const N=dr(x);if(Ir(S))return[Qc(S)===N.color||tl(S)===N.bg?[x]:[],T];const R=zt(cc(S)),B=Lu(S);if((R.length&&R!==N.name||w(B)&&B!==N.color)===!1)return[[x],T]}return[[],T]}const[p,g]=ft(k.words,r,[J.COLOR_OR_KIND]);return Ir(p)?[Kx(k.board,p),g]:[Mu(k.board,p),g]}case"countof":{const[m]=ft(k.words,r,[J.ANY]);if(on(m)){const[b,S,T]=ft(k.words,r,[J.DIR,J.COLOR_OR_KIND]);if(b.targets.length){let N=0;for(let R=0;R<b.targets.length;++R){const B=b.targets[R],M=["countof","at",B.x,B.y,...S],[H]=ft(M,0,[J.ANY]);xt(H)&&(N+=H)}return[N,T]}const x=b.layer===bt.MID?se(k.board,b.destpt):as(k.board,b.destpt.x,b.destpt.y);if(w(x)){const N=dr(x);if(Ir(S))return[Qc(S)===N.color||tl(S)===N.bg?1:0,T];const R=zt(cc(S)),B=Lu(S),M=R.length?R===N.name:!0,H=w(B)?B===N.color:!0;if(M&&H)return[1,T]}return[0,T]}const[p,g]=ft(k.words,r,[J.COLOR_OR_KIND]);return Ir(p)?[Kx(k.board,p).length,g]:[Mu(k.board,p).length,g]}case"rnd":return[yn(0,1),r];case"abs":{const[m,p]=ft(k.words,r,[J.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=ft(k.words,r,[J.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=ft(k.words,r,[J.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=ft(k.words,r,[J.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,g,y]=ft(k.words,r,[J.NUMBER,J.NUMBER,J.NUMBER]);return[ze(m,p,g),y]}case"min":{const[m,p]=Po(r);return[Math.min(...m),p]}case"max":{const[m,p]=Po(r);return[Math.max(...m),p]}case"pick":{const[m,p]=Po(r);return[_n(m),p]}case"pickwith":{const[m,p]=ft(k.words,r,[J.NUMBER_OR_STRING]),[g,y]=Po(p);return[yI(`${m}`,g),y]}case"random":{const[m,p]=Po(r,2),[g,y]=m;return[yn(g,y??0),p]}case"randomwith":{const[m,p]=ft(k.words,r,[J.NUMBER_OR_STRING]),[g,y]=Po(p,2),[b,S]=g;return[hy(`${m}`,b,S??0),y]}case"run":{const[m,p]=ft(k.words,r,[J.NAME]);return Cu(m),[(l=k.get)==null?void 0:l.call(k,"arg"),p]}case"runwith":{const[m,p,g]=ft(k.words,r,[J.ANY,J.NAME]);return w(k.element)&&(k.element.arg=m),Cu(p),[(h=k.get)==null?void 0:h.call(k,"arg"),g]}}}return[t,r]}const np={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Qa(e){return he(e)&&zv(e[0])}function zv(e){return w($r[e])&&_t(e)}function Wv(e){if(_t(e))return np[zt(e)]}function Hv(e){if(Qa(e))return e;if(zv(e))return[e];const t=Wv(e);if(w(t))return[t]}function KD(e){const t=k.words[e],r=Hv(t);if(Qa(r))return[r,e+1];const[n,i]=Mr(e),s=Hv(n);return Qa(s)?[s,i]:[void 0,e]}const YD=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Gv=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"]),qD=["NORTH","SOUTH","WEST","EAST"];function VD(e){const t=Rn(e);if(xt(t.inputcurrent)||(t.inputcurrent=0),he(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[r]=t.inputqueue,[n=Nr.NONE,i=0]=r??[Nr.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&MI?1:0,t.inputctrl=i&UI?1:0,t.inputshift=i&PI?1:0,n){case Nr.MOVE_UP:case Nr.MOVE_DOWN:case Nr.MOVE_LEFT:case Nr.MOVE_RIGHT:t.inputmove=[qD[n-Nr.MOVE_UP]];break;case Nr.OK_BUTTON:t.inputok=1;break;case Nr.CANCEL_BUTTON:t.inputcancel=1;break;case Nr.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=n,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Nr.NONE&&o!==n}),t}function XD(e){const t=np[e];if(w(t))return t;const r=ep[e];if(w(r))return r;const n=_a[e];if(w(n))return n;const i=uh[e];if(w(i))return i}function Kv(){var t,r;if(kr(k.board,k.element,k.timestamp),!!Gt(k.element,"item")){const n={x:((t=k.element)==null?void 0:t.x)??-1,y:((r=k.element)==null?void 0:r.y)??-1},i=uc(k.board,n,k.elementfocus);w(i)&&(i.x=n.x,i.y=n.y)}}const JD=xi({get(e,t){var u,l,h,d,f,m,p,g,y,b,S,T,x,N,R,B,M,H,V,O,I;const r=XD(t);if(w(r))return[!0,r];if(k.elementisplayer&&YD.has(t)){const v=VD(k.elementid)[t];return[w(v),v]}const n=uc(k.board,{x:((u=k.element)==null?void 0:u.x)??-1,y:((l=k.element)==null?void 0:l.y)??-1},k.elementfocus),i=(n==null?void 0:n.id)??k.elementfocus??Pr(),s=(h=k.element)==null?void 0:h.sender,o=Jx(k.board,_t(s)?s:""),a=(o==null?void 0:o.id)??"";switch(t){case"camera":case"graphics":case"facing":if(w((d=k.board)==null?void 0:d[t]))return[!0,(f=k.board)==null?void 0:f[t]];break;case"isdark":return[!0,(m=k.board)!=null&&m.isdark?1:0];case"startx":return[!0,((p=k.board)==null?void 0:p.startx)??0];case"starty":return[!0,((g=k.board)==null?void 0:g.starty)??0];case"over":return[!0,((y=k.board)==null?void 0:y.over)??""];case"under":return[!0,((b=k.board)==null?void 0:b.under)??""];case"exitnorth":return[!0,((S=k.board)==null?void 0:S.exitnorth)??""];case"exitsouth":return[!0,((T=k.board)==null?void 0:T.exitsouth)??""];case"exitwest":return[!0,((x=k.board)==null?void 0:x.exitwest)??""];case"exiteast":return[!0,((N=k.board)==null?void 0:N.exiteast)??""];case"timelimit":return[!0,((R=k.board)==null?void 0:R.timelimit)??0];case"restartonzap":return[!0,((B=k.board)==null?void 0:B.restartonzap)??0];case"maxplayershots":return[!0,((M=k.board)==null?void 0:M.maxplayershots)??0];case"currenttick":return[!0,k.timestamp];case"boardid":return[!0,((H=k.board)==null?void 0:H.id)??""];case"playerid":return[!0,i];case"playerx":return[!0,(n==null?void 0:n.x)??-1];case"playery":return[!0,(n==null?void 0:n.y)??-1];case"thisid":return[!0,((V=k.element)==null?void 0:V.id)??""];case"thisx":return[!0,((O=k.element)==null?void 0:O.x)??-1];case"thisy":return[!0,((I=k.element)==null?void 0:I.y)??-1];case"senderid":return[!0,a];case"senderx":return[!0,(o==null?void 0:o.x)??-1];case"sendery":return[!0,(o==null?void 0:o.y)??-1];default:{if(Gv.has(t))return[!0,Gt(k.element,t)??0];break}}const c=Rn(i)[t];return[w(c),c]},set(e,t,r){var o,a;const n=uc(k.board,{x:((o=k.element)==null?void 0:o.x)??-1,y:((a=k.element)==null?void 0:a.y)??-1},k.elementfocus),i=(n==null?void 0:n.id)??k.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(w(k.board))return k.board.isdark=r?1:0,[!0,k.board.isdark];break;case"startx":if(w(k.board))return k.board.startx=Ea(r,0),[!0,k.board.startx];break;case"starty":if(w(k.board))return k.board.starty=Ea(r,0),[!0,k.board.starty];break;case"over":if(w(k.board))return k.board.over=Re(r),[!0,k.board.over];break;case"under":if(w(k.board))return[!0,k.board.under=Re(r)];break;case"exitnorth":if(w(k.board))return[!0,k.board.exitnorth=Re(r)];break;case"exitsouth":if(w(k.board))return[!0,k.board.exitsouth=Re(r)];break;case"exitwest":if(w(k.board))return[!0,k.board.exitwest=Re(r)];break;case"exiteast":if(w(k.board))return[!0,k.board.exiteast=Re(r)];break;case"timelimit":if(w(k.board))return[!0,k.board.timelimit=Ea(r,0)];break;case"restartonzap":if(w(k.board))return[!0,k.board.restartonzap=r?1:0];break;case"maxplayershots":if(w(k.board))return[!0,k.board.maxplayershots=Ea(r,0)];break;case"currenttick":return[!1,r];case"boardid":return[!1,r];case"playerid":return[!1,r];case"playerx":return[!1,r];case"playery":return[!1,r];case"thisid":return[!1,r];case"thisx":return[!1,r];case"thisy":return[!1,r];case"senderid":return[!1,r];case"senderx":return[!1,r];case"sendery":return[!1,r];default:{if(Gv.has(t))return w(k.element)&&(k.element[t]=r),[!0,r];break}}const s=Rn(i);return w(s)?(s[t]=r,[!0,r]):[!1,r]},everytick(){var e,t;!((e=k.element)!=null&&e.removed)&&w((t=k.element)==null?void 0:t.x)&&w(k.element.y)&&w(k.element.stepx)&&w(k.element.stepy)&&(k.element.stepx||k.element.stepy)&&Gn(k.book,k.board,k.element,{x:k.element.x+k.element.stepx,y:k.element.y+k.element.stepy})}}).command("clear",(e,t)=>{for(let r=0;r<t.length;++r)e.set(Re(t[r]),0);return 0}).command("set",(e,t)=>{const[r,n]=ft(t,0,[J.NAME,J.ANY]);return e.set(r,n??1),0}).command("become",(e,t)=>{var c,u;const[r]=ft(t,0,[J.KIND]);pr(k.board);const n=dr(k.element),[i,s]=r,o=[...wo(n.color,n.bg),...s??[]],a=[i,o];if(au(k.board,k.element),kr(k.board,k.element,k.timestamp)){const l={x:((c=k.element)==null?void 0:c.x)??0,y:((u=k.element)==null?void 0:u.y)??0};hn(k.board,a,l)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[r]=ft(t,0,[J.ANY]);if(on(r)){const[n,i]=ft(t,0,[J.DIR,J.NUMBER]),s=se(k.board,n.destpt);w(s)&&(s.char=i)}else w(k.element)&&xt(r)&&(k.element.char=r);return 0}).command("color",(e,t)=>{const[r]=ft(t,0,[J.ANY]);if(on(r)){const[n,i]=ft(t,0,[J.DIR,J.COLOR]),s=se(k.board,n.destpt);w(s)&&Ta(k.element,i)}else{const[n]=ft(t,0,[J.COLOR]);w(k.element)&&w(n)&&Ta(k.element,n)}return 0}).command("go",(e,t)=>{if(w(k.element)){const[r]=ft(t,0,[J.DIR]);if(Gn(k.book,k.board,k.element,r.destpt),e.yield(),k.element.x===r.destpt.x&&k.element.y===r.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!w(k.element))return 0;const[r]=ft(t,0,[J.DIR]),n=k.element.x??0,i=k.element.y??0;return k.element.stepx=r.destpt.x-n,k.element.stepy=r.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[r]=ft(t,0,[J.ANY]);return e.set("arg",r),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Re(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Re(t[0])),0)).command("cycle",(e,t)=>{if(w(k.element)){const[r]=ft(t,0,[J.NUMBER]);k.element.cycle=ze(Math.round(r),1,255)}return 0}).command("die",e=>(Kv(),e.endofprogram(),0)).command("dieonend",()=>(Kv(),0)).command("endgame",()=>(sf(lt,k.elementfocus),0)).command("run",(e,t)=>{const[r]=ft(t,0,[J.NAME]);return Cu(r),0}).command("runwith",(e,t)=>{const[r,n]=ft(t,0,[J.ANY,J.NAME]);return e.set("arg",r),Cu(n),0}),gu={};function ZD(e){var t;return(t=gu[e])==null?void 0:t.arg}function QD(e){var t;return(t=gu[e])==null?void 0:t.format}function Fo(e){var t;return(t=gu[e])==null?void 0:t.content}function Yv(e,t,r,n,i){const s=me(Jt.MAIN);if(!w(s))return;const o=Fs(s,Tt.LOADER).filter(a=>{const c=Us(a),u=c.format,l=_t(u)?new RegExp(u).test(t):!1,h=c.event,d=_t(h)?new RegExp(h).test(r):!1;return _t(u)&&_t(h)?l&&d:_t(u)?l:_t(h)?d:!1});for(let a=0;a<o.length;++a){const c=`${De()}_loader`;gu[c]={arg:e,format:t,content:n,player:i},Uj(c,o[a].code)}}function qv(e,t){if(!w(e))return;const r=zt(t),n=r.endsWith("le");switch(r){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,n);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,n);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,n);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,n);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,n);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,n);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,n);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,n);return e.cursor+=8,i}}}const t4=(e,t)=>{const r=Fo(e.id());if(!w(r))return 0;const[n,i]=ft(t,0,[J.NAME]),s=zt(n);switch(s){case"seek":{const[o]=ft(t,i,[J.NUMBER]);r.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=ft(t,i,[J.NAME]);e.set(o,qv(r,s));break}case"text":{const[o,a]=ft(t,i,[J.NAME,J.NAME]),c=qv(r,o);if(xt(c)&&_t(a)){const u=new Uint8Array(r.bytes.buffer,r.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),r.cursor+=c}break}case"palette":{const[o]=ft(t,i,[J.NAME]),[a]=Bd(k.book,Tt.PALETTE,o),c=Ie(a);if(w(c)){const u=SI*rl,l=Qy(new Uint8Array(r.bytes.buffer,r.cursor,u));w(l)&&(c.bits=l.bits),r.cursor+=u}break}case"charset":{const[o]=ft(t,i,[J.NAME]),[a]=Bd(k.book,Tt.CHARSET,o),c=Ie(a);if(w(c)){const u=nl*TI*ph,l=t_(new Uint8Array(r.bytes.buffer,r.cursor,u));w(l)&&(c.bits=l.bits),r.cursor+=u}break}}return 0},Bo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",yu=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(!yu(e[r],t[r]))return!1;return!0}if(Bo(e)&&Bo(t)){const r=Object.entries(e),n=new Set(Object.keys(t));if(r.length!==n.size)return!1;for(const[i,s]of r){if(!yu(s,t[i]))return!1;n.delete(i)}return n.size===0}return!1},_u=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(Bo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},e4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Vv=e=>e>="0"&&e<="9"||e==="-",r4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var st;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(st||(st={}));const Xv={"(":st.TOK_LPAREN,")":st.TOK_RPAREN,"*":st.TOK_STAR,",":st.TOK_COMMA,".":st.TOK_DOT,":":st.TOK_COLON,"@":st.TOK_CURRENT,$:st.TOK_ROOT,"]":st.TOK_RBRACKET,"{":st.TOK_LBRACE,"}":st.TOK_RBRACE},n4={"!":!0,"<":!0,"=":!0,">":!0},i4={"	":!0,"\n":!0,"\r":!0," ":!0};class s4{constructor(){this._current=0}tokenize(t){const r=[];this._current=0;let n,i,s;for(;this._current<t.length;)if(e4(t[this._current]))n=this._current,i=this.consumeUnquotedIdentifier(t),r.push({start:n,type:st.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Xv[t[this._current]]!==void 0)r.push({start:this._current,type:Xv[t[this._current]],value:t[this._current]}),this._current+=1;else if(Vv(t[this._current]))s=this.consumeNumber(t),r.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),r.push(s);else if(t[this._current]==='"')n=this._current,i=this.consumeQuotedIdentifier(t),r.push({start:n,type:st.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")n=this._current,i=this.consumeRawStringLiteral(t),r.push({start:n,type:st.TOK_LITERAL,value:i});else if(t[this._current]==="`"){n=this._current;const o=this.consumeLiteral(t);r.push({start:n,type:st.TOK_LITERAL,value:o})}else if(n4[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&r.push(s);else if(i4[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")n=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,r.push({start:n,type:st.TOK_AND,value:"&&"})):r.push({start:n,type:st.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")n=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,r.push({start:n,type:st.TOK_OR,value:"||"})):r.push({start:n,type:st.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return r}consumeUnquotedIdentifier(t){const r=this._current;for(this._current+=1;this._current<t.length&&r4(t[this._current]);)this._current+=1;return t.slice(r,this._current)}consumeQuotedIdentifier(t){const r=this._current;this._current+=1;const n=t.length;for(;t[this._current]!=='"'&&this._current<n;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(r,this._current))}consumeRawStringLiteral(t){const r=this._current;this._current+=1;const n=t.length;for(;t[this._current]!=="'"&&this._current<n;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(r+1,this._current-1).replace("\\'","'")}consumeNumber(t){const r=this._current;this._current+=1;const n=t.length;for(;Vv(t[this._current])&&this._current<n;)this._current+=1;const i=parseInt(t.slice(r,this._current),10);return{start:r,value:i,type:st.TOK_NUMBER}}consumeLBracket(t){const r=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:r,type:st.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:r,type:st.TOK_FLATTEN,value:"[]"}):{start:r,type:st.TOK_LBRACKET,value:"["}}consumeOperator(t){const r=this._current,n=t[r];if(this._current+=1,n==="!")return t[this._current]==="="?(this._current+=1,{start:r,type:st.TOK_NE,value:"!="}):{start:r,type:st.TOK_NOT,value:"!"};if(n==="<")return t[this._current]==="="?(this._current+=1,{start:r,type:st.TOK_LTE,value:"<="}):{start:r,type:st.TOK_LT,value:"<"};if(n===">")return t[this._current]==="="?(this._current+=1,{start:r,type:st.TOK_GTE,value:">="}):{start:r,type:st.TOK_GT,value:">"};if(n==="="&&t[this._current]==="=")return this._current+=1,{start:r,type:st.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const r=this._current,n=t.length;for(;t[this._current]!=="`"&&this._current<n;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(r,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const r='[{"',n=["true","false","null"],i="-0123456789";if(t==="")return!1;if(r.includes(t[0])||n.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const o4=new s4,Sr={[st.TOK_EOF]:0,[st.TOK_UNQUOTEDIDENTIFIER]:0,[st.TOK_QUOTEDIDENTIFIER]:0,[st.TOK_RBRACKET]:0,[st.TOK_RPAREN]:0,[st.TOK_COMMA]:0,[st.TOK_RBRACE]:0,[st.TOK_NUMBER]:0,[st.TOK_CURRENT]:0,[st.TOK_EXPREF]:0,[st.TOK_ROOT]:0,[st.TOK_PIPE]:1,[st.TOK_OR]:2,[st.TOK_AND]:3,[st.TOK_EQ]:5,[st.TOK_GT]:5,[st.TOK_LT]:5,[st.TOK_GTE]:5,[st.TOK_LTE]:5,[st.TOK_NE]:5,[st.TOK_FLATTEN]:9,[st.TOK_STAR]:20,[st.TOK_FILTER]:21,[st.TOK_DOT]:40,[st.TOK_NOT]:45,[st.TOK_LBRACE]:50,[st.TOK_LBRACKET]:55,[st.TOK_LPAREN]:60};class a4{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const r=this.expression(0);if(this.lookahead(0)!==st.TOK_EOF){const n=this.lookaheadToken(0);this.errorToken(n,`Unexpected token type: ${n.type}, value: ${n.value}`)}return r}loadTokens(t){this.tokens=[...o4.tokenize(t),{type:st.TOK_EOF,value:"",start:t.length}]}expression(t){const r=this.lookaheadToken(0);this.advance();let n=this.nud(r),i=this.lookahead(0);for(;t<Sr[i];)this.advance(),n=this.led(i,n),i=this.lookahead(0);return n}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let r,n,i;switch(t.type){case st.TOK_LITERAL:return{type:"Literal",value:t.value};case st.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case st.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===st.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case st.TOK_NOT:return n=this.expression(Sr.Not),{type:"NotExpression",children:[n]};case st.TOK_STAR:return r={type:"Identity"},n=this.lookahead(0)===st.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Sr.Star),{type:"ValueProjection",children:[r,n]};case st.TOK_FILTER:return this.led(t.type,{type:"Identity"});case st.TOK_LBRACE:return this.parseMultiselectHash();case st.TOK_FLATTEN:return r={type:st.TOK_FLATTEN,children:[{type:"Identity"}]},n=this.parseProjectionRHS(Sr.Flatten),{type:"Projection",children:[r,n]};case st.TOK_LBRACKET:return this.lookahead(0)===st.TOK_NUMBER||this.lookahead(0)===st.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},n)):this.lookahead(0)===st.TOK_STAR&&this.lookahead(1)===st.TOK_RBRACKET?(this.advance(),this.advance(),n=this.parseProjectionRHS(Sr.Star),{children:[{type:"Identity"},n],type:"Projection"}):this.parseMultiselectList();case st.TOK_CURRENT:return{type:st.TOK_CURRENT};case st.TOK_ROOT:return{type:st.TOK_ROOT};case st.TOK_EXPREF:return i=this.expression(Sr.Expref),{type:"ExpressionReference",children:[i]};case st.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==st.TOK_RPAREN;)this.lookahead(0)===st.TOK_CURRENT?(i={type:st.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(st.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,r){let n;switch(t){case st.TOK_DOT:const i=Sr.Dot;return this.lookahead(0)!==st.TOK_STAR?(n=this.parseDotRHS(i),{type:"Subexpression",children:[r,n]}):(this.advance(),n=this.parseProjectionRHS(i),{type:"ValueProjection",children:[r,n]});case st.TOK_PIPE:return n=this.expression(Sr.Pipe),{type:st.TOK_PIPE,children:[r,n]};case st.TOK_OR:return n=this.expression(Sr.Or),{type:"OrExpression",children:[r,n]};case st.TOK_AND:return n=this.expression(Sr.And),{type:"AndExpression",children:[r,n]};case st.TOK_LPAREN:const s=r.name,o=[];let a;for(;this.lookahead(0)!==st.TOK_RPAREN;)this.lookahead(0)===st.TOK_CURRENT?(a={type:st.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===st.TOK_COMMA&&this.match(st.TOK_COMMA),o.push(a);return this.match(st.TOK_RPAREN),{name:s,type:"Function",children:o};case st.TOK_FILTER:const u=this.expression(0);return this.match(st.TOK_RBRACKET),n=this.lookahead(0)===st.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Sr.Filter),{type:"FilterProjection",children:[r,n,u]};case st.TOK_FLATTEN:const l={type:st.TOK_FLATTEN,children:[r]},h=this.parseProjectionRHS(Sr.Flatten);return{type:"Projection",children:[l,h]};case st.TOK_EQ:case st.TOK_NE:case st.TOK_GT:case st.TOK_GTE:case st.TOK_LT:case st.TOK_LTE:return this.parseComparator(r,t);case st.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===st.TOK_NUMBER||d.type===st.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice(r,n)):(this.match(st.TOK_STAR),this.match(st.TOK_RBRACKET),n=this.parseProjectionRHS(Sr.Star),{type:"Projection",children:[r,n]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const r=this.lookaheadToken(0);this.errorToken(r,`Expected ${t}, got: ${r.type}`)}}errorToken(t,r=""){const n=new Error(r||`Invalid token (${t.type}): "${t.value}"`);throw n.name="ParserError",n}parseIndexExpression(){if(this.lookahead(0)===st.TOK_COLON||this.lookahead(1)===st.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(st.TOK_RBRACKET),t}projectIfSlice(t,r){const n={type:"IndexExpression",children:[t,r]};return r.type==="Slice"?{children:[n,this.parseProjectionRHS(Sr.Star)],type:"Projection"}:n}parseSliceExpression(){const t=[null,null,null];let r=0,n=this.lookahead(0);for(;n!==st.TOK_RBRACKET&&r<3;){if(n===st.TOK_COLON)r+=1,this.advance();else if(n===st.TOK_NUMBER)t[r]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}n=this.lookahead(0)}return this.match(st.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,r){const n=this.expression(Sr[r]);return{type:"Comparator",name:r,children:[t,n]}}parseDotRHS(t){const r=this.lookahead(0);if([st.TOK_UNQUOTEDIDENTIFIER,st.TOK_QUOTEDIDENTIFIER,st.TOK_STAR].includes(r))return this.expression(t);if(r===st.TOK_LBRACKET)return this.match(st.TOK_LBRACKET),this.parseMultiselectList();if(r===st.TOK_LBRACE)return this.match(st.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(Sr[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===st.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===st.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===st.TOK_DOT)return this.match(st.TOK_DOT),this.parseDotRHS(t);const r=this.lookaheadToken(0);this.errorToken(r,`Syntax error, unexpected token: ${r.value}(${r.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==st.TOK_RBRACKET;){const r=this.expression(0);if(t.push(r),this.lookahead(0)===st.TOK_COMMA&&(this.match(st.TOK_COMMA),this.lookahead(0)===st.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(st.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],r=[st.TOK_UNQUOTEDIDENTIFIER,st.TOK_QUOTEDIDENTIFIER];let n,i,s;for(;;){if(n=this.lookaheadToken(0),!r.includes(n.type))throw new Error(`Expecting an identifier token, got: ${n.type}`);if(i=n.value,this.advance(),this.match(st.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===st.TOK_COMMA)this.match(st.TOK_COMMA);else if(this.lookahead(0)===st.TOK_RBRACE){this.match(st.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const c4=new a4;var mt;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(mt||(mt={}));class l4{constructor(t){this.TYPE_NAME_TABLE={[mt.TYPE_NUMBER]:"number",[mt.TYPE_ANY]:"any",[mt.TYPE_STRING]:"string",[mt.TYPE_ARRAY]:"array",[mt.TYPE_OBJECT]:"object",[mt.TYPE_BOOLEAN]:"boolean",[mt.TYPE_EXPREF]:"expression",[mt.TYPE_NULL]:"null",[mt.TYPE_ARRAY_NUMBER]:"Array<number>",[mt.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([r])=>Math.abs(r),this.functionAvg=([r])=>{let n=0;for(let i=0;i<r.length;i+=1)n+=r[i];return n/r.length},this.functionCeil=([r])=>Math.ceil(r),this.functionContains=r=>{const[n,i]=r;return n.includes(i)},this.functionEndsWith=r=>{const[n,i]=r;return n.includes(i,n.length-i.length)},this.functionFloor=([r])=>Math.floor(r),this.functionJoin=r=>{const[n,i]=r;return i.join(n)},this.functionKeys=([r])=>Object.keys(r),this.functionLength=([r])=>Bo(r)?Object.keys(r).length:r.length,this.functionMap=r=>{if(!this._interpreter)return[];const n=[],i=this._interpreter,s=r[0],o=r[1];for(let a=0;a<o.length;a+=1)n.push(i.visit(s,o[a]));return n},this.functionMax=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===mt.TYPE_NUMBER)return Math.max(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[mt.TYPE_NUMBER,mt.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=r=>{let n={};for(let i=0;i<r.length;i+=1){const s=r[i];n=Object.assign(n,s)}return n},this.functionMin=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===mt.TYPE_NUMBER)return Math.min(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[mt.TYPE_NUMBER,mt.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=r=>{for(let n=0;n<r.length;n+=1)if(this.getTypeName(r[n])!==mt.TYPE_NULL)return r[n];return null},this.functionReverse=([r])=>{if(this.getTypeName(r)===mt.TYPE_STRING){const s=r;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=r.slice(0);return i.reverse(),i},this.functionSort=([r])=>[...r].sort(),this.functionSortBy=r=>{if(!this._interpreter)return[];const n=r[0].slice(0);if(n.length===0)return n;const i=this._interpreter,s=r[1],o=this.getTypeName(i.visit(s,n[0]));if(o!==void 0&&![mt.TYPE_NUMBER,mt.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<n.length;c+=1)a.push([c,n[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)n[c]=a[c][1];return n},this.functionStartsWith=([r,n])=>r.startsWith(n),this.functionSum=([r])=>r.reduce((n,i)=>n+i,0),this.functionToArray=([r])=>this.getTypeName(r)===mt.TYPE_ARRAY?r:[r],this.functionToNumber=([r])=>{const n=this.getTypeName(r);let i;return n===mt.TYPE_NUMBER?r:n===mt.TYPE_STRING&&(i=+r,!isNaN(i))?i:null},this.functionToString=([r])=>this.getTypeName(r)===mt.TYPE_STRING?r:JSON.stringify(r),this.functionType=([r])=>{switch(this.getTypeName(r)){case mt.TYPE_NUMBER:return"number";case mt.TYPE_STRING:return"string";case mt.TYPE_ARRAY:return"array";case mt.TYPE_OBJECT:return"object";case mt.TYPE_BOOLEAN:return"boolean";case mt.TYPE_EXPREF:return"expref";case mt.TYPE_NULL:return"null";default:return}},this.functionValues=([r])=>Object.values(r),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[mt.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[mt.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[mt.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY]},{types:[mt.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[mt.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[mt.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY,mt.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[mt.TYPE_EXPREF]},{types:[mt.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[mt.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[mt.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[mt.TYPE_ARRAY_STRING,mt.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[mt.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[mt.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[mt.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[mt.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[mt.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[mt.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,r,n){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:r.bind(this),_signature:n}}callFunction(t,r){const n=this.functionTable[t];if(n===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,r,n._signature),n._func.call(this,r)}validateInputSignatures(t,r){for(let n=0;n<r.length;n+=1)if("variadic"in r[n]&&n!==r.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${n+1} must occur last`)}validateArgs(t,r,n){var i,s;let o;this.validateInputSignatures(t,n);const a=n.filter(p=>{var g;return(g=!p.optional)!==null&&g!==void 0?g:!1}).length,c=(s=(i=n[n.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=r.length<a,l=r.length>n.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=n.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${r.length}`);let d,f,m;for(let p=0;p<n.length;p+=1){m=!1,d=n[p].types,f=this.getTypeName(r[p]);let g;for(g=0;g<d.length;g+=1)if(f!==void 0&&this.typeMatches(f,d[g],r[p])){m=!0;break}if(!m&&f!==void 0){const y=d.map(b=>this.TYPE_NAME_TABLE[b]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(t,r,n){if(r===mt.TYPE_ANY)return!0;if(r===mt.TYPE_ARRAY_STRING||r===mt.TYPE_ARRAY_NUMBER||r===mt.TYPE_ARRAY){if(r===mt.TYPE_ARRAY)return t===mt.TYPE_ARRAY;if(t===mt.TYPE_ARRAY){let i;r===mt.TYPE_ARRAY_NUMBER?i=mt.TYPE_NUMBER:r===mt.TYPE_ARRAY_STRING&&(i=mt.TYPE_STRING);for(let s=0;s<n.length;s+=1){const o=this.getTypeName(n[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,n[s]))return!1}return!0}}else return t===r;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return mt.TYPE_STRING;case"[object Number]":return mt.TYPE_NUMBER;case"[object Array]":return mt.TYPE_ARRAY;case"[object Boolean]":return mt.TYPE_BOOLEAN;case"[object Null]":return mt.TYPE_NULL;case"[object Object]":return t.jmespathType===st.TOK_EXPREF?mt.TYPE_EXPREF:mt.TYPE_OBJECT;default:return}}createKeyFunction(t,r){if(!this._interpreter)return;const n=this._interpreter;return s=>{const o=n.visit(t,s);if(!r.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${r.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class u4{constructor(){this._rootValue=null,this.runtime=new l4(this)}search(t,r){return this._rootValue=r,this.visit(t,r)}visit(t,r){let n,i,s,o,a,c,u,l,h,d,f;switch(t.type){case"Field":return r===null?null:Bo(r)?(c=r[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],r),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],r),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(r))return null;let m=t.value;return m<0&&(m=r.length+m),s=r[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(r))return null;const p=[...t.children],g=this.computeSliceParams(r.length,p),[y,b,S]=g;if(s=[],S>0)for(d=y;d<b;d+=S)s.push(r[d]);else for(d=y;d>b;d+=S)s.push(r[d]);return s;case"Projection":if(f=this.visit(t.children[0],r),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(t.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(t.children[0],r),!Bo(f))return null;h=[];const T=Object.values(f);for(d=0;d<T.length;d+=1)i=this.visit(t.children[1],T[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(t.children[0],r),!Array.isArray(f))return null;const x=[],N=[];for(d=0;d<f.length;d+=1)n=this.visit(t.children[2],f[d]),_u(n)||x.push(f[d]);for(let O=0;O<x.length;O+=1)i=this.visit(t.children[1],x[O]),i!==null&&N.push(i);return N;case"Comparator":switch(o=this.visit(t.children[0],r),a=this.visit(t.children[1],r),t.name){case st.TOK_EQ:s=yu(o,a);break;case st.TOK_NE:s=!yu(o,a);break;case st.TOK_GT:s=o>a;break;case st.TOK_GTE:s=o>=a;break;case st.TOK_LT:s=o<a;break;case st.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case st.TOK_FLATTEN:const R=this.visit(t.children[0],r);if(!Array.isArray(R))return null;let B=[];for(d=0;d<R.length;d+=1)i=R[d],Array.isArray(i)?B=[...B,...i]:B.push(i);return B;case"Identity":return r;case"MultiSelectList":if(r===null)return null;for(h=[],d=0;d<t.children.length;d+=1)h.push(this.visit(t.children[d],r));return h;case"MultiSelectHash":if(r===null)return null;h={};let M;for(d=0;d<t.children.length;d+=1)M=t.children[d],h[M.name]=this.visit(M.value,r);return h;case"OrExpression":return n=this.visit(t.children[0],r),_u(n)&&(n=this.visit(t.children[1],r)),n;case"AndExpression":return o=this.visit(t.children[0],r),_u(o)?o:this.visit(t.children[1],r);case"NotExpression":return o=this.visit(t.children[0],r),_u(o);case"Literal":return t.value;case st.TOK_PIPE:return u=this.visit(t.children[0],r),this.visit(t.children[1],u);case st.TOK_CURRENT:return r;case st.TOK_ROOT:return this._rootValue;case"Function":const H=[];for(let O=0;O<t.children.length;O+=1)H.push(this.visit(t.children[O],r));return this.runtime.callFunction(t.name,H);case"ExpressionReference":const V=t.children[0];return V.jmespathType=st.TOK_EXPREF,V;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,r){let[n,i,s]=r;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return n=n===null?o?t-1:0:this.capSliceRange(t,n,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[n,i,s]}capSliceRange(t,r,n){let i=r;return i<0?(i+=t,i<0&&(i=n<0?-1:0)):i>=t&&(i=n<0?t-1:t),i}}const f4=new u4;mt.TYPE_ANY,mt.TYPE_ARRAY,mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING,mt.TYPE_BOOLEAN,mt.TYPE_EXPREF,mt.TYPE_NULL,mt.TYPE_NUMBER,mt.TYPE_OBJECT,mt.TYPE_STRING;function h4(e,t){const r=c4.parse(t);return f4.search(r,e)}const d4=(e,t)=>{const r=Fo(e.id());if(!w(r))return 0;const[n,i]=ft(t,0,[J.NAME,J.NAME]),s=h4(r.json,n);return e.set(i,s),0},p4=(e,t)=>{const r=Fo(e.id());if(!w(r))return 0;const[n,i]=ft(t,0,[J.NAME]);switch(zt(n)){case"seek":{const[o]=ft(t,i,[J.NUMBER]);r.cursor=ze(o,0,r.lines.length-1);break}case"line":r.cursor=ze(r.cursor+1,0,r.lines.length-1);break;default:{const o=r.lines[r.cursor]??"",c=new RegExp(n,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,d]=ft(t,l,[J.NAME]);e.set(h,c[u]??0),++u,l=d}break}}return 0};function Jv(e){const t=me(Jt.MAIN),r=Lo(t);w(e.targetdir)?Go(e.targetdir.destpt,e.label,void 0,r):w(e.targetname)&&Go(e.targetname,e.label,void 0,r)}const m4=xi({get(e,t){const r=QD(e.id());if(t==="format")return[!0,r];switch(r){case"text":{const n=Fo(e.id());switch(t){case"filename":return[!0,n.filename];case"cursor":return[!0,n.cursor];case"lines":return[!0,n.lines.length]}break}case"json":{const n=Fo(e.id());switch(t){case"filename":return[!0,n.filename]}break}case"binary":{const n=Fo(e.id());switch(t){case"filename":return[!0,n.filename];case"cursor":return[!0,n.cursor];case"bytes":return[!0,n.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const r=Pi(t);return Jv(r),0}).command("send",(e,t)=>{const r=Pi(t,!0);return Jv(r),0}).command("stat",()=>0).command("text",(e,t)=>{const r=t.map(Re).join(" ");return Pe(lt,k.elementfocus,"$175",r),0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Re(r),s=Pi(n);return w(s.targetname)&&Pe(lt,k.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",p4).command("readjson",d4).command("readbin",t4).command("withboard",(e,t)=>{const[r]=ft(t,0,[J.STRING]),n=yr(r);return w(n)&&(k.board=n,k.element={x:-1,y:-1}),0});function Zv(e,t,r,n,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=ft(i,a,[J.ANY]);he(c)&&!on(c)&&!Qa(c)&&!mu(c)&&!Ir(c)?o.push(...c):o.push(c),a=u}switch(zt(n)){case"get":case"post:json":wT(lt,k.elementfocus,e,t,r,n,o);break}return 0}const g4=xi().command("fetch",(e,t)=>{const[r,n,i="get",s]=ft(t,0,[J.NAME,J.NAME,J.MAYBE_STRING]);return Zv(void 0,r,n,i,t,s),0}).command("fetchwith",(e,t)=>{const[r,n,i,s="get",o]=ft(t,0,[J.ANY,J.NAME,J.NAME,J.MAYBE_STRING]);return Zv(r,n,i,s,t,o),0}).command("chat",(e,t)=>{const[r]=ft(t,0,[J.MAYBE_NAME]);return r?_T(lt,k.elementfocus,r):bT(lt,k.elementfocus),0}).command("broadcast",(e,t)=>{const[r]=ft(t,0,[J.MAYBE_NAME]);return r?gT(lt,k.elementfocus,r):yT(lt,k.elementfocus),0});function Qv(e,t){var r;if(w(t.targetname)){const n=Object.keys(((r=k.board)==null?void 0:r.objects)??{});switch(t.targetname){case"all":for(let i=0;i<n.length;++i){const s=n[i];e.send(k.elementfocus,s,t.label)}break;case"others":for(let i=0;i<n.length;++i){const s=n[i];s!==e.id()&&e.send(k.elementfocus,s,t.label)}break;case"self":k.elementid!==e.id()?e.send(k.elementfocus,k.elementid,t.label):e.message({session:lt.session(),player:k.elementfocus,id:De(),sender:k.elementid,target:t.label});break;default:{const i=Yx(k.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];w(o.id)&&e.send(k.elementfocus,o.id,t.label)}break}}}else if(w(t.targetdir))if(t.targetdir.targets.length)for(let n=0;n<t.targetdir.targets.length;++n){const i=se(k.board,t.targetdir.targets[n]);w(i==null?void 0:i.id)&&e.send(k.elementfocus,i.id,t.label)}else{const n=se(k.board,t.targetdir.destpt);w(n==null?void 0:n.id)&&e.send(k.elementfocus,n.id,t.label)}}const y4=xi({set(e,t,r){return tz(e,t,r),[!1,void 0]},aftertick(){var r,n,i;const e=ar(k.elementid),[t]=e;if(e.length===1&&_t(t)){if(w(k.element))if(t.trim().length===0){const s=Ce(k.elementid);s.sidebar=[]}else k.element.tickertext=t,k.element.tickertime=k.timestamp}else if(e.length>1)if(k.elementisplayer){const s=Ce(k.elementid);s.sidebar=nA(e)}else{const s=Ce(k.elementfocus);s.scrollname=((r=k.element)==null?void 0:r.name)??((i=(n=k.element)==null?void 0:n.kinddata)==null?void 0:i.name)??"",s.scroll=nA(e)}}}).command("shortsend",(e,t)=>{const r=Pi(t);return Qv(e,r),0}).command("send",(e,t)=>{const r=Pi(t,!0);return Qv(e,r),0}).command("stat",()=>0).command("text",(e,t)=>{const r=t.map(Re).join("");return Mt(k.elementid,r),0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Re(r),s=Pi(n);return w(s.targetname)&&$t(k.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function _4(e,t,r,n,i){if(!w(k.book))return;const s=k.book,o=sr(s,Tt.BOARD,e),a=Ie(o);if(!w(a))return;const c=Uu(),u=i==="all"||i==="object",l=i==="all"||i==="terrain";pr(a),pr(c);const h=-Math.tan(t*.5),d=Math.sin(t),f=Math.round(12.5*h),m=Math.round(12.5*d),p=new Array(Qt).fill(0);ny(f,0,-f,Qt-1).forEach(T=>{T.x<0?p[T.y]=Math.min(p[T.y],T.x):p[T.y]=Math.max(p[T.y],T.x)});const y=new Array(Nt).fill(0);ny(0,m,Nt-1,-m).forEach(T=>{T.y<0?y[T.x]=Math.min(y[T.x],T.y):y[T.x]=Math.max(y[T.x],T.y)});const S=[p,y,p];for(let T=0;T<S.length;++T){const x=S[T];if(T!==1){for(let N=0;N<Qt;++N){const R=x[N],B=N*Nt;for(let M=0;M<Nt;M++){const H=(M+R+Nt)%Nt;l&&(c.terrain[H+B]=a.terrain[M+B])}}if(u){const N=Object.keys(a.objects);for(let R=0;R<N.length;++R){const B=N[R],{x:M,y:H}=a.objects[B];if(w(M)&&w(H)){const V=x[H];a.objects[B].x=(M+V+Nt)%Nt,a.objects[B].lx=a.objects[B].x}}}}if(T===1){for(let N=0;N<Nt;++N){const R=x[N];for(let B=0;B<Qt;++B){const M=(B+R+Qt)%Qt;l&&(c.terrain[N+M*Nt]=a.terrain[N+B*Nt])}}if(u){const N=Object.keys(a.objects);for(let R=0;R<N.length;++R){const B=N[R],{x:M,y:H}=a.objects[B];if(w(M)&&w(H)){const V=x[M];a.objects[B].y=(H+V+Qt)%Qt,a.objects[B].ly=a.objects[B].y}}}}l&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,pr(c),pr(a)}}function b4(e,t){let r=0,n=0,i=0;for(;i<e.length;i++)r+=e[i];for(i=0,t*=r;t&&i<e.length;){if(n+=e[i],t<=n)return i;i++}return 0}var w4=b4;const E4=w4,le=function(){};le.prototype.FMX=0,le.prototype.FMY=0,le.prototype.FMXxFMY=0,le.prototype.T=0,le.prototype.N=0,le.prototype.initiliazedField=!1,le.prototype.generationComplete=!1,le.prototype.wave=null,le.prototype.compatible=null,le.prototype.weightLogWeights=null,le.prototype.sumOfWeights=0,le.prototype.sumOfWeightLogWeights=0,le.prototype.startingEntropy=0,le.prototype.sumsOfOnes=null,le.prototype.sumsOfWeights=null,le.prototype.sumsOfWeightLogWeights=null,le.prototype.entropies=null,le.prototype.propagator=null,le.prototype.observed=null,le.prototype.distribution=null,le.prototype.stack=null,le.prototype.stackSize=0,le.prototype.DX=[-1,0,1,0],le.prototype.DY=[0,1,0,-1],le.prototype.opposite=[2,3,0,1],le.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},le.prototype.observe=function(e){let t=1e3,r=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,r=s)}}if(r===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[r][s]?this.weights[s]:0;const n=E4(this.distribution,e()),i=this.wave[r];for(let s=0;s<this.T;s++)i[s]!==(s===n)&&this.ban(r,s);return null},le.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],r=t%this.FMX,n=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=r+s,c=n+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const u=a+c*this.FMX,l=this.propagator[i][e[1]],h=this.compatible[u];for(let d=0;d<l.length;d++){const f=l[d],m=h[f];m[i]--,m[i]==0&&this.ban(u,f)}}}},le.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},le.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let r=0;r<e||e===0;r++){const n=this.singleIteration(t);if(n!==null)return!!n}return!0},le.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},le.prototype.isGenerationComplete=function(){return this.generationComplete},le.prototype.ban=function(e,t){const r=this.compatible[e][t];for(let i=0;i<4;i++)r[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const n=this.sumsOfWeights[e];this.entropies[e]=Math.log(n)-this.sumsOfWeightLogWeights[e]/n},le.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let r=0;r<4;r++)this.compatible[e][t][r]=this.propagator[this.opposite[r]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var tk=le;const ek=tk,Fi=function(t,r,n,i,s,o,a,c,u,l){l=l||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=r,d=new Array(h);for(let M=0;M<h;M++)d[M]=new Array(n);this.colors=[];const f={};for(let M=0;M<n;M++)for(let H=0;H<r;H++){const V=(M*r+H)*4,O=[t[V],t[V+1],t[V+2],t[V+3]],I=O.join("-");f.hasOwnProperty(I)||(f[I]=this.colors.length,this.colors.push(O)),d[H][M]=f[I]}const m=this.colors.length,p=Math.pow(m,i*i),g=function(H){let V=new Array(i*i);for(let O=0;O<i;O++)for(let I=0;I<i;I++)V[I+O*i]=H(I,O);return V},y=function(H,V){return g(function(O,I){return d[(H+O)%r][(V+I)%n]})},b=function(H){return g(function(V,O){return H[i-1-O+V*i]})},S=function(H){return g(function(V,O){return H[i-1-V+O*i]})},T=function(H){let V=0,O=1;for(let I=0;I<H.length;I++)V+=H[H.length-1-I]*O,O*=m;return V},x=function(H){let V=H,O=p;const I=new Array(i*i);for(let v=0;v<I.length;v++){O/=m;let L=0;for(;V>=O;)V-=O,L++;I[v]=L}return I},N={},R=[];for(let M=0;M<(a?n:n-i+1);M++)for(let H=0;H<(a?r:r-i+1);H++){const V=new Array(8);V[0]=y(H,M),V[1]=S(V[0]),V[2]=b(V[0]),V[3]=S(V[2]),V[4]=b(V[2]),V[5]=S(V[4]),V[6]=b(V[4]),V[7]=S(V[6]);for(let O=0;O<u;O++){const I=T(V[O]);N[I]?N[I]++:(R.push(I),N[I]=1)}}this.T=R.length,this.ground=(l+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let M=0;M<this.T;M++){const H=parseInt(R[M],10);this.patterns[M]=x(H),this.weights[M]=N[H]}const B=function(H,V,O,I){const v=O<0?0:O,L=O<0?O+i:i,z=I<0?0:I,U=I<0?I+i:i;for(let Y=z;Y<U;Y++)for(let X=v;X<L;X++)if(H[X+i*Y]!=V[X-O+i*(Y-I)])return!1;return!0};this.propagator=new Array(4);for(let M=0;M<4;M++){this.propagator[M]=new Array(this.T);for(let H=0;H<this.T;H++){const V=[];for(let O=0;O<this.T;O++)B(this.patterns[H],this.patterns[O],this.DX[M],this.DY[M])&&V.push(O);this.propagator[M][H]=V}}};Fi.prototype=Object.create(ek.prototype),Fi.prototype.constructor=Fi,Fi.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Fi.prototype.clear=function(){if(ek.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Fi.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Fi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const r=t<this.FMY-this.N+1?0:this.N-1;for(let n=0;n<this.FMX;n++){const i=n<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+n)*4,o=this.colors[this.patterns[this.observed[n-i+(t-r)*this.FMX]][i+r*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Fi.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const r=t%this.FMX,n=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let l=0;l<this.N;l++)for(let h=0;h<this.N;h++){let d=r-h;d<0&&(d+=this.FMX);let f=n-l;if(f<0&&(f+=this.FMY),this.onBoundary(d,f))continue;const m=d+f*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const g=this.colors[this.patterns[p][h+l*this.N]];s+=g[0],o+=g[1],a+=g[2],c+=g[3]}}const u=t*4;e[u]=s/i,e[u+1]=o/i,e[u+2]=a/i,e[u+3]=c/i}};var v4=Fi;const k4=tk,es=function(t,r,n,i,s){const o=t.tilesize||16;this.FMX=n,this.FMY=i,this.FMXxFMY=n*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;r&&t.subsets&&t.subsets[r]&&(c=t.subsets[r]);const u=function(T){const x=new Array(o*o);for(let N=0;N<o;N++)for(let R=0;R<o;R++)x[R+N*o]=T(R,N);return x},l=function(T){return u(function(x,N){return T[o-1-N+x*o]})},h=function(T){return u(function(x,N){return T[o-1-x+N*o]})};this.tiles=[];const d=[],f=[],m={};let p,g,y;for(let S=0;S<t.tiles.length;S++){const T=t.tiles[S];if(c!==null&&c.indexOf(T.name)===-1)continue;switch(T.symmetry){case"L":y=4,p=function(N){return(N+1)%4},g=function(N){return N%2===0?N+1:N-1};break;case"T":y=4,p=function(N){return(N+1)%4},g=function(N){return N%2===0?N:4-N};break;case"I":y=2,p=function(N){return 1-N},g=function(N){return N};break;case"\\":y=2,p=function(N){return 1-N},g=function(N){return 1-N};break;case"F":y=8,p=function(N){return N<4?(N+1)%4:4+(N-1)%4},g=function(N){return N<4?N+4:N-4};break;default:y=1,p=function(N){return N},g=function(N){return N};break}this.T=f.length,m[T.name]=this.T;for(let N=0;N<y;N++)f.push([this.T+N,this.T+p(N),this.T+p(p(N)),this.T+p(p(p(N))),this.T+g(N),this.T+g(p(N)),this.T+g(p(p(N))),this.T+g(p(p(p(N))))]);let x;if(a)for(let N=0;N<y;N++)x=T.bitmap[N],this.tiles.push(u(function(R,B){return[x[(o*B+R)*4],x[(o*B+R)*4+1],x[(o*B+R)*4+2],x[(o*B+R)*4+3]]}));else{x=T.bitmap,this.tiles.push(u(function(N,R){return[x[(o*R+N)*4],x[(o*R+N)*4+1],x[(o*R+N)*4+2],x[(o*R+N)*4+3]]}));for(let N=1;N<y;N++)this.tiles.push(N<4?l(this.tiles[this.T+N-1]):h(this.tiles[this.T+N-4]))}for(let N=0;N<y;N++)d.push(T.weight||1)}this.T=f.length,this.weights=d,this.propagator=new Array(4);const b=new Array(4);for(let S=0;S<4;S++){this.propagator[S]=new Array(this.T),b[S]=new Array(this.T);for(let T=0;T<this.T;T++){b[S][T]=new Array(this.T);for(let x=0;x<this.T;x++)b[S][T][x]=!1}}for(let S=0;S<t.neighbors.length;S++){const T=t.neighbors[S],x=T.left.split(" ").filter(function(V){return V.length}),N=T.right.split(" ").filter(function(V){return V.length});if(c!==null&&(c.indexOf(x[0])===-1||c.indexOf(N[0])===-1))continue;const R=f[m[x[0]]][x.length==1?0:parseInt(x[1],10)],B=f[R][1],M=f[m[N[0]]][N.length==1?0:parseInt(N[1],10)],H=f[M][1];b[0][M][R]=!0,b[0][f[M][6]][f[R][6]]=!0,b[0][f[R][4]][f[M][4]]=!0,b[0][f[R][2]][f[M][2]]=!0,b[1][H][B]=!0,b[1][f[B][6]][f[H][6]]=!0,b[1][f[H][4]][f[B][4]]=!0,b[1][f[B][2]][f[H][2]]=!0}for(let S=0;S<this.T;S++)for(let T=0;T<this.T;T++)b[2][S][T]=b[0][T][S],b[3][S][T]=b[1][T][S];for(let S=0;S<4;S++)for(let T=0;T<this.T;T++){const x=[],N=b[S][T];for(let R=0;R<this.T;R++)N[R]&&x.push(R);this.propagator[S][T]=x}};es.prototype=Object.create(k4.prototype),es.prototype.constructor=es,es.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},es.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},es.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let r=0;r<this.FMY;r++){const n=this.tiles[this.observed[t+r*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(r*this.tilesize+i)*this.FMX*this.tilesize)*4,a=n[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},es.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let r=0;r<this.FMX;r++)for(let n=0;n<this.FMY;n++){const i=this.wave[r+n*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let u=0;u<this.tilesize;u++){const l=(r*this.tilesize+u+(n*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];else{let h=0,d=0,f=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const g=this.tiles[p][u+c*this.tilesize],y=this.weights[p]*a;h+=g[0]*y,d+=g[1]*y,f+=g[2]*y,m+=g[3]*y}e[l]=h,e[l+1]=d,e[l+2]=f,e[l+3]=m}}}};var x4=es,A4={OverlappingModel:v4,SimpleTiledModel:x4},T4=qs(A4);const rk=5;function nk(e,t,r,n,i,s,o){if(!w(k.book))return!1;const a=k.book,c=sr(a,Tt.BOARD,e),u=sr(a,Tt.BOARD,t),l=Ie(c),h=Ie(u);if(!w(l)||!w(h))return!1;pr(l),pr(h);let d=0;const f=new Map,m=new Map;let p=0;const g=32,y=new Uint8Array(dh*4);for(let R=0;R<Qt;++R)for(let B=0;B<Nt;++B){const M=se(h,{x:B,y:R}),H=(M==null?void 0:M.char)??0,V=(M==null?void 0:M.color)??g,O=(M==null?void 0:M.bg)??g;y[p++]=H,y[p++]=V,y[p++]=O;const I=Sn(M),v=zt((I==null?void 0:I.name)??"empty"),L=f.get(v);xt(L)?y[p++]=L:(f.set(v,d),m.set(d,v),y[p++]=d++)}const b=s.x-i.x+1,S=s.y-i.y+1,T=new T4.OverlappingModel(y,Nt,Qt,r,b,S,!1,!1,n,0);let x=0;for(;x<rk&&!T.generate();++x);if(x===rk)return!1;p=0;const N=T.graphics();for(let R=i.y;R<=s.y;++R)for(let B=i.x;B<=s.x;++B){const M={x:B,y:R},H=N[p++],V=N[p++],O=N[p++];switch(d=N[p++],o){case"all":{const z=se(l,{x:B,y:R});He(z)&&kr(l,z,a.timestamp),Ne(l,{x:B,y:R});break}case"object":{const z=se(l,{x:B,y:R});He(z)&&kr(l,z,a.timestamp);break}case"terrain":Ne(l,{x:B,y:R});break}let I=m.get(d)??"";const v=Sn({kind:I});switch(o){case"all":break;case"object":He(v)||(I="");break;case"terrain":He(v)&&(I="");break;default:if(Gt(v,"group")!==o&&(I=""),I){const z=se(l,{x:B,y:R});He(z)&&kr(l,z,a.timestamp),Ne(l,{x:B,y:R})}break}const L=I?hn(l,[I],M):void 0;if(!(!w(L)||!w(v))&&(Bs(L,v),H>0&&(L.char=H),V<g&&(L.color=V),O<g&&(L.bg=O),He(L))){const z=_n(fc(h,I));w(z)&&(Ne(l,{...as(h,z.x??0,z.y??0),x:B,y:R}),Bs(L,z))}}return!0}function ik(e){return`zss_snapshot_${e}`}const sk={x:0,y:0},ok={x:Nt-1,y:Qt-1},ak="all";function S4(e){const t=sr(k.book,Tt.BOARD,e),r=Ie(t);if(!w(r))return;const n=ik(r.id);dv(k.book,n);const[i]=os(Jt.MAIN,n,Tt.BOARD),s=Ie(i);if(w(s))return lu(e,s.id,sk,ok,ak),s}function R4(e){const t=sr(k.book,Tt.BOARD,e),r=Ie(t);if(!w(r))return;const n=ik(r.id),i=sr(k.book,Tt.BOARD,n),s=Ie(i);if(w(s))return lu(s.id,e,sk,ok,ak),s}function O4(e,t,r,n,i,s){switch(s){case"all":case"object":case"terrain":break;default:return I4(e,t,i,s)}if(!w(k.book))return;const o=k.book,a=sr(o,Tt.BOARD,e),c=Ie(a);if(!w(c))return;const u=Uu();pr(c);for(let l=r.y;l<=n.y;++l)for(let h=r.x;h<=n.x;++h){let d=!1,f=!1;switch(s){case"all":d=!0,f=!0;break;case"object":d=!0;break;case"terrain":f=!0;break}const m=(h+t.x+Nt)%Nt,p=(l+t.y+Qt)%Qt;if(d){const g=se(c,{x:h,y:l});He(g)&&w(g==null?void 0:g.x)&&w(g==null?void 0:g.y)&&(g.x=m,g.lx=m,g.y=p,g.ly=p)}f&&(u.terrain[m+p*Nt]=c.terrain[h+l*Nt])}(s==="all"||s==="terrain")&&(c.terrain=[...u.terrain]),Ja(c)}function I4(e,t,r,n){if(!w(k.book))return;const i=k.book,s=sr(i,Tt.BOARD,e),o=Ie(s);if(!w(o))return;pr(o);const{terrainelements:a,objectelements:c}=_v(o,r,n);if(a.length===0&&c.length===0)return;const u=c.map(p=>p.id??""),l=a.map(p=>jr({x:p.x??0,y:p.y??0},Nt)),h=[],d=[];for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b=se(o,y);w(b)&&He(b)&&(h.push(b.id??""),h.push(b.id??""),d.push(jr({x:b.x??0,y:b.y??0},Nt)))}let f=!1;for(let p=0;p<a.length;++p){const g=a[p],y=Gt(g,"collision"),b={x:g.x??-1,y:g.y??-1},S=jr(b,Nt),T={x:b.x+t.x,y:b.y+t.y};if(Ko(T)){const x=se(o,T),N=(x==null?void 0:x.id)??"",R=jr({x:(x==null?void 0:x.x)??0,y:(x==null?void 0:x.y)??0},Nt),B=Gt(x,"collision");if(w(x)&&He(x)&&h.includes(N)!==!0&&u.includes(N)!==!0){let M=!1;const H=d.includes(S),V=H?se(o,b):void 0,O=H?Gt(V,"pushable"):!1,I=H&&O;if(p0(g,x)&&(y!==Wt.ISWALK||H)){let v=H;w(V)&&O&&(f=Gn(i,o,V,{x:(V.x??0)-t.x,y:(V.y??0)-t.y})!==!0,f||(v=!1)),(v||y!==Wt.ISWALK)&&(f=Gn(i,o,x,{x:(x.x??0)+t.x,y:(x.y??0)+t.y})!==!0,f&&(M=I))}else(y!==Wt.ISWALK||I)&&(f=!0,M=I);M&&w(V)&&(f=Gn(i,o,V,{x:(V.x??0)-t.x,y:(V.y??0)-t.y})!==!0)}else B===Wt.ISSOLID&&l.includes(R)===!1&&(f=!0)}else f=!0}if(f)return;for(let p=0;p<c.length;++p){const g=c[p],y=Gt(g,"collision"),b={x:g.x??0,y:g.y??0},S={x:b.x+t.x,y:b.y+t.y};if(Ko(S)){const T=se(o,S),x=(T==null?void 0:T.id)??"",N=Gt(T,"collision"),R=Gt(T,"group");w(T)&&He(T)&&h.includes(x)&&u.includes(x)!==!0?p0(g,T)?f=Gn(i,o,T,S)!==!0:f=!0:lc(y,N)&&n!==R&&(f=!0)}else f=!0}if(f)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+t.x,y:y.y+t.y},S=as(o,b.x,b.y);if(w(g)&&w(S)){Ne(o,{...g,x:b.x,y:b.y}),Ne(o,{...S,x:y.x,y:y.y});const T=se(o,y);He(T)&&w(T)&&(T.x=(T.x??0)+t.x,T.y=(T.y??0)+t.y,T.lx=(T.lx??0)+t.x,T.ly=(T.ly??0)+t.y)}}Ja(o);for(let p=0;p<c.length;++p){const g=c[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+t.x,y:y.y+t.y};if(!Gn(i,o,g,b))break}Ja(o)}function bu(e,t){let r="all";const n={x:0,y:0},i={x:Nt-1,y:Qt-1};for(let s=t;s<e.length;){const[o,a]=ft(e,s,[J.MAYBE_NUMBER_OR_STRING]);if(_t(o))r=zt(o),s=a;else if(xt(o)){const[c,u,l,h]=ft(e,a,[J.NUMBER,J.MAYBE_NUMBER,J.MAYBE_NUMBER]);n.x=Math.min(o,u??o),n.y=Math.min(c,l??c),i.x=Math.max(o,u??o),i.y=Math.max(c,l??c),s=h}else break}return{targetset:r,pt1:n,pt2:i}}const N4=xi().command("snapshot",()=>(!w(k.book)||!w(k.board)||S4(k.board.id),0)).command("revert",()=>(!w(k.book)||!w(k.board)||R4(k.board.id),0)).command("copy",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ft(t,0,[J.STRING]),i=bookreadcodepagesbytypeandstat(k.book,Tt.BOARD,r),s=_n(...i);if(w(s)){const o=bu(t,n);lu(s.id,k.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n,i,s]=ft(t,0,[J.STRING,J.NUMBER,J.NUMBER]),o=bookreadcodepagesbytypeandstat(k.book,Tt.BOARD,r),a=_n(...o);if(w(a)){const c=bu(t,s);nk(k.board.id,a.id,n,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!w(k.book)||!w(k.board))return 0;const[r,n]=ft(t,0,[J.DIR]),i={x:r.destpt.x-(((o=k.element)==null?void 0:o.x)??0),y:r.destpt.y-(((a=k.element)==null?void 0:a.y)??0)},s=bu(t,n);return O4(k.board.id,i,s.pt1,s.pt2,k.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ft(t,0,[J.NUMBER]),i=bu(t,n);return _4(k.board.id,uy(r),i.pt1,i.pt2,i.targetset),0});var rs=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(rs||{});const C4={audio:sl,board:mP,cli:zD,display:WD,element:JD,runtime:y4,loader:m4,network:g4,transform:N4},ip=["audio","board","display","network","transform","element"],L4={0:[],1:["cli",...ip],2:["loader",...ip],3:["runtime",...ip]},M4={0:new Map,1:new Map,2:new Map,3:new Map};function $o(e){return(L4[e]??[]).map(r=>C4[r]).filter(w)}function sp(e){const t=[],r=$o(e);for(let n=0;n<r.length;++n)t.push(...r[n].listcommands());return t}function U4(e,t){const r=M4[e];if(!r.has(t)){let n;const i=$o(e);for(let s=0;s<i.length&&(n=i[s].getcommand(t),!w(n));++s);r.set(t,n)}return r.get(t)}function P4(e,t,r){const n=$o(e);for(let i=0;i<n.length;++i){const s=n[i];if(s.get!==void 0){const[o,a]=s.get(t,r);if(o)return[o,a]}}return[!1,void 0]}function F4(e,t,r,n){const i=$o(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,r,n);if(a)return[a,n]}}return[!1,void 0]}function B4(e,t){const r=$o(e);for(let n=0;n<r.length;++n)r[n].everytick(t)}function $4(e,t){const r=$o(e);for(let n=0;n<r.length;++n)r[n].aftertick(t)}var ck={},lk={},uk={};const fk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");uk.encode=function(e){if(0<=e&&e<fk.length)return fk[e];throw new TypeError("Must be between 0 and 63: "+e)};const D4=uk,hk=5,dk=1<<hk,j4=dk-1,z4=dk;function W4(e){return e<0?(-e<<1)+1:(e<<1)+0}lk.encode=function(t){let r="",n,i=W4(t);do n=i&j4,i>>>=hk,i>0&&(n|=z4),r+=D4.encode(n);while(i>0);return r};var un={},Ws={},tc={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */tc.exports;var pk;function H4(){return pk||(pk=1,function(e,t){(function(r){var n=t&&!t.nodeType&&t,i=e&&!e.nodeType&&e,s=typeof Qe=="object"&&Qe;(s.global===s||s.window===s||s.self===s)&&(r=s);var o,a=2147483647,c=36,u=1,l=26,h=38,d=700,f=72,m=128,p="-",g=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=c-u,x=Math.floor,N=String.fromCharCode,R;function B(K){throw new RangeError(S[K])}function M(K,W){for(var P=K.length,ot=[];P--;)ot[P]=W(K[P]);return ot}function H(K,W){var P=K.split("@"),ot="";P.length>1&&(ot=P[0]+"@",K=P[1]),K=K.replace(b,".");var G=K.split("."),rt=M(G,W).join(".");return ot+rt}function V(K){for(var W=[],P=0,ot=K.length,G,rt;P<ot;)G=K.charCodeAt(P++),G>=55296&&G<=56319&&P<ot?(rt=K.charCodeAt(P++),(rt&64512)==56320?W.push(((G&1023)<<10)+(rt&1023)+65536):(W.push(G),P--)):W.push(G);return W}function O(K){return M(K,function(W){var P="";return W>65535&&(W-=65536,P+=N(W>>>10&1023|55296),W=56320|W&1023),P+=N(W),P}).join("")}function I(K){return K-48<10?K-22:K-65<26?K-65:K-97<26?K-97:c}function v(K,W){return K+22+75*(K<26)-((W!=0)<<5)}function L(K,W,P){var ot=0;for(K=P?x(K/d):K>>1,K+=x(K/W);K>T*l>>1;ot+=c)K=x(K/T);return x(ot+(T+1)*K/(K+h))}function z(K){var W=[],P=K.length,ot,G=0,rt=m,wt=f,Rt,Ct,Et,vt,At,Ut,Dt,A,ut;for(Rt=K.lastIndexOf(p),Rt<0&&(Rt=0),Ct=0;Ct<Rt;++Ct)K.charCodeAt(Ct)>=128&&B("not-basic"),W.push(K.charCodeAt(Ct));for(Et=Rt>0?Rt+1:0;Et<P;){for(vt=G,At=1,Ut=c;Et>=P&&B("invalid-input"),Dt=I(K.charCodeAt(Et++)),(Dt>=c||Dt>x((a-G)/At))&&B("overflow"),G+=Dt*At,A=Ut<=wt?u:Ut>=wt+l?l:Ut-wt,!(Dt<A);Ut+=c)ut=c-A,At>x(a/ut)&&B("overflow"),At*=ut;ot=W.length+1,wt=L(G-vt,ot,vt==0),x(G/ot)>a-rt&&B("overflow"),rt+=x(G/ot),G%=ot,W.splice(G++,0,rt)}return O(W)}function U(K){var W,P,ot,G,rt,wt,Rt,Ct,Et,vt,At,Ut=[],Dt,A,ut,nt;for(K=V(K),Dt=K.length,W=m,P=0,rt=f,wt=0;wt<Dt;++wt)At=K[wt],At<128&&Ut.push(N(At));for(ot=G=Ut.length,G&&Ut.push(p);ot<Dt;){for(Rt=a,wt=0;wt<Dt;++wt)At=K[wt],At>=W&&At<Rt&&(Rt=At);for(A=ot+1,Rt-W>x((a-P)/A)&&B("overflow"),P+=(Rt-W)*A,W=Rt,wt=0;wt<Dt;++wt)if(At=K[wt],At<W&&++P>a&&B("overflow"),At==W){for(Ct=P,Et=c;vt=Et<=rt?u:Et>=rt+l?l:Et-rt,!(Ct<vt);Et+=c)nt=Ct-vt,ut=c-vt,Ut.push(N(v(vt+nt%ut,0))),Ct=x(nt/ut);Ut.push(N(v(Ct,0))),rt=L(P,A,ot==G),P=0,++ot}++P,++W}return Ut.join("")}function Y(K){return H(K,function(W){return g.test(W)?z(W.slice(4).toLowerCase()):W})}function X(K){return H(K,function(W){return y.test(W)?"xn--"+U(W):W})}if(o={version:"1.4.1",ucs2:{decode:V,encode:O},decode:z,encode:U,toASCII:X,toUnicode:Y},n&&i)if(e.exports==n)i.exports=o;else for(R in o)o.hasOwnProperty(R)&&(n[R]=o[R]);else r.punycode=o})(Qe)}(tc,tc.exports)),tc.exports}var op,mk;function Do(){return mk||(mk=1,op=TypeError),op}var G4={},K4=Object.freeze({__proto__:null,default:G4}),Y4=CA(K4),ap,gk;function wu(){if(gk)return ap;gk=1;var e=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&e?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=e&&t&&typeof t.get=="function"?t.get:null,n=e&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,u=c?WeakMap.prototype.has:null,l=typeof WeakSet=="function"&&WeakSet.prototype,h=l?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,f=d?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,p=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,b=String.prototype.slice,S=String.prototype.replace,T=String.prototype.toUpperCase,x=String.prototype.toLowerCase,N=RegExp.prototype.test,R=Array.prototype.concat,B=Array.prototype.join,M=Array.prototype.slice,H=Math.floor,V=typeof BigInt=="function"?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,v=typeof Symbol=="function"&&typeof Symbol.iterator=="object",L=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===v||!0)?Symbol.toStringTag:null,z=Object.prototype.propertyIsEnumerable,U=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(D){return D.__proto__}:null);function Y(D,tt){if(D===1/0||D===-1/0||D!==D||D&&D>-1e3&&D<1e3||N.call(/e/,tt))return tt;var jt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof D=="number"){var Ht=D<0?-H(-D):H(D);if(Ht!==D){var qt=String(Ht),Lt=b.call(tt,qt.length+1);return S.call(qt,jt,"$&_")+"."+S.call(S.call(Lt,/([0-9]{3})/g,"$&_"),/_$/,"")}}return S.call(tt,jt,"$&_")}var X=Y4,K=X.custom,W=A(K)?K:null,P={__proto__:null,double:'"',single:"'"},ot={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};ap=function D(tt,jt,Ht,qt){var Lt=jt||{};if(j(Lt,"quoteStyle")&&!j(P,Lt.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(j(Lt,"maxStringLength")&&(typeof Lt.maxStringLength=="number"?Lt.maxStringLength<0&&Lt.maxStringLength!==1/0:Lt.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Qr=j(Lt,"customInspect")?Lt.customInspect:!0;if(typeof Qr!="boolean"&&Qr!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(j(Lt,"indent")&&Lt.indent!==null&&Lt.indent!=="	"&&!(parseInt(Lt.indent,10)===Lt.indent&&Lt.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(j(Lt,"numericSeparator")&&typeof Lt.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var In=Lt.numericSeparator;if(typeof tt>"u")return"undefined";if(tt===null)return"null";if(typeof tt=="boolean")return tt?"true":"false";if(typeof tt=="string")return ge(tt,Lt);if(typeof tt=="number"){if(tt===0)return 1/0/tt>0?"0":"-0";var dn=String(tt);return In?Y(tt,dn):dn}if(typeof tt=="bigint"){var us=String(tt)+"n";return In?Y(tt,us):us}var N0=typeof Lt.depth>"u"?5:Lt.depth;if(typeof Ht>"u"&&(Ht=0),Ht>=N0&&N0>0&&typeof tt=="object")return Rt(tt)?"[Array]":"[Object]";var Qo=F(Lt,Ht);if(typeof qt>"u")qt=[];else if(dt(qt,tt)>=0)return"[Circular]";function Kn(ta,Hu,n7){if(Hu&&(qt=M.call(qt),qt.push(Hu)),n7){var RA={depth:Lt.depth};return j(Lt,"quoteStyle")&&(RA.quoteStyle=Lt.quoteStyle),D(ta,RA,Ht+1,qt)}return D(ta,Lt,Ht+1,qt)}if(typeof tt=="function"&&!Et(tt)){var EA=Z(tt),vA=ct(tt,Kn);return"[Function"+(EA?": "+EA:" (anonymous)")+"]"+(vA.length>0?" { "+B.call(vA,", ")+" }":"")}if(A(tt)){var kA=v?S.call(String(tt),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(tt);return typeof tt=="object"&&!v?Ze(kA):kA}if(Bt(tt)){for(var dc="<"+x.call(String(tt.nodeName)),C0=tt.attributes||[],Wu=0;Wu<C0.length;Wu++)dc+=" "+C0[Wu].name+"="+G(rt(C0[Wu].value),"double",Lt);return dc+=">",tt.childNodes&&tt.childNodes.length&&(dc+="..."),dc+="</"+x.call(String(tt.nodeName))+">",dc}if(Rt(tt)){if(tt.length===0)return"[]";var L0=ct(tt,Kn);return Qo&&!E(L0)?"["+q(L0,Qo)+"]":"[ "+B.call(L0,", ")+" ]"}if(vt(tt)){var M0=ct(tt,Kn);return!("cause"in Error.prototype)&&"cause"in tt&&!z.call(tt,"cause")?"{ ["+String(tt)+"] "+B.call(R.call("[cause]: "+Kn(tt.cause),M0),", ")+" }":M0.length===0?"["+String(tt)+"]":"{ ["+String(tt)+"] "+B.call(M0,", ")+" }"}if(typeof tt=="object"&&Qr){if(W&&typeof tt[W]=="function"&&X)return X(tt,{depth:N0-Ht});if(Qr!=="symbol"&&typeof tt.inspect=="function")return tt.inspect()}if(pt(tt)){var xA=[];return n&&n.call(tt,function(ta,Hu){xA.push(Kn(Hu,tt,!0)+" => "+Kn(ta,tt))}),_("Map",r.call(tt),xA,Qo)}if(St(tt)){var AA=[];return a&&a.call(tt,function(ta){AA.push(Kn(ta,tt))}),_("Set",o.call(tt),AA,Qo)}if(it(tt))return C("WeakMap");if(yt(tt))return C("WeakSet");if(gt(tt))return C("WeakRef");if(Ut(tt))return Ze(Kn(Number(tt)));if(ut(tt))return Ze(Kn(V.call(tt)));if(Dt(tt))return Ze(m.call(tt));if(At(tt))return Ze(Kn(String(tt)));if(typeof window<"u"&&tt===window)return"{ [object Window] }";if(typeof globalThis<"u"&&tt===globalThis||typeof Qe<"u"&&tt===Qe)return"{ [object globalThis] }";if(!Ct(tt)&&!Et(tt)){var U0=ct(tt,Kn),TA=U?U(tt)===Object.prototype:tt instanceof Object||tt.constructor===Object,P0=tt instanceof Object?"":"null prototype",SA=!TA&&L&&Object(tt)===tt&&L in tt?b.call($(tt),8,-1):P0?"Object":"",r7=TA||typeof tt.constructor!="function"?"":tt.constructor.name?tt.constructor.name+" ":"",F0=r7+(SA||P0?"["+B.call(R.call([],SA||[],P0||[]),": ")+"] ":"");return U0.length===0?F0+"{}":Qo?F0+"{"+q(U0,Qo)+"}":F0+"{ "+B.call(U0,", ")+" }"}return String(tt)};function G(D,tt,jt){var Ht=jt.quoteStyle||tt,qt=P[Ht];return qt+D+qt}function rt(D){return S.call(String(D),/"/g,"&quot;")}function wt(D){return!L||!(typeof D=="object"&&(L in D||typeof D[L]<"u"))}function Rt(D){return $(D)==="[object Array]"&&wt(D)}function Ct(D){return $(D)==="[object Date]"&&wt(D)}function Et(D){return $(D)==="[object RegExp]"&&wt(D)}function vt(D){return $(D)==="[object Error]"&&wt(D)}function At(D){return $(D)==="[object String]"&&wt(D)}function Ut(D){return $(D)==="[object Number]"&&wt(D)}function Dt(D){return $(D)==="[object Boolean]"&&wt(D)}function A(D){if(v)return D&&typeof D=="object"&&D instanceof Symbol;if(typeof D=="symbol")return!0;if(!D||typeof D!="object"||!I)return!1;try{return I.call(D),!0}catch{}return!1}function ut(D){if(!D||typeof D!="object"||!V)return!1;try{return V.call(D),!0}catch{}return!1}var nt=Object.prototype.hasOwnProperty||function(D){return D in this};function j(D,tt){return nt.call(D,tt)}function $(D){return p.call(D)}function Z(D){if(D.name)return D.name;var tt=y.call(g.call(D),/^function\s*([\w$]+)/);return tt?tt[1]:null}function dt(D,tt){if(D.indexOf)return D.indexOf(tt);for(var jt=0,Ht=D.length;jt<Ht;jt++)if(D[jt]===tt)return jt;return-1}function pt(D){if(!r||!D||typeof D!="object")return!1;try{r.call(D);try{o.call(D)}catch{return!0}return D instanceof Map}catch{}return!1}function it(D){if(!u||!D||typeof D!="object")return!1;try{u.call(D,u);try{h.call(D,h)}catch{return!0}return D instanceof WeakMap}catch{}return!1}function gt(D){if(!f||!D||typeof D!="object")return!1;try{return f.call(D),!0}catch{}return!1}function St(D){if(!o||!D||typeof D!="object")return!1;try{o.call(D);try{r.call(D)}catch{return!0}return D instanceof Set}catch{}return!1}function yt(D){if(!h||!D||typeof D!="object")return!1;try{h.call(D,h);try{u.call(D,u)}catch{return!0}return D instanceof WeakSet}catch{}return!1}function Bt(D){return!D||typeof D!="object"?!1:typeof HTMLElement<"u"&&D instanceof HTMLElement?!0:typeof D.nodeName=="string"&&typeof D.getAttribute=="function"}function ge(D,tt){if(D.length>tt.maxStringLength){var jt=D.length-tt.maxStringLength,Ht="... "+jt+" more character"+(jt>1?"s":"");return ge(b.call(D,0,tt.maxStringLength),tt)+Ht}var qt=ot[tt.quoteStyle||"single"];qt.lastIndex=0;var Lt=S.call(S.call(D,qt,"\\$1"),/[\x00-\x1f]/g,Zt);return G(Lt,"single",tt)}function Zt(D){var tt=D.charCodeAt(0),jt={8:"b",9:"t",10:"n",12:"f",13:"r"}[tt];return jt?"\\"+jt:"\\x"+(tt<16?"0":"")+T.call(tt.toString(16))}function Ze(D){return"Object("+D+")"}function C(D){return D+" { ? }"}function _(D,tt,jt,Ht){var qt=Ht?q(jt,Ht):B.call(jt,", ");return D+" ("+tt+") {"+qt+"}"}function E(D){for(var tt=0;tt<D.length;tt++)if(dt(D[tt],`
`)>=0)return!1;return!0}function F(D,tt){var jt;if(D.indent==="	")jt="	";else if(typeof D.indent=="number"&&D.indent>0)jt=B.call(Array(D.indent+1)," ");else return null;return{base:jt,prev:B.call(Array(tt+1),jt)}}function q(D,tt){if(D.length===0)return"";var jt=`
`+tt.prev+tt.base;return jt+B.call(D,","+jt)+`
`+tt.prev}function ct(D,tt){var jt=Rt(D),Ht=[];if(jt){Ht.length=D.length;for(var qt=0;qt<D.length;qt++)Ht[qt]=j(D,qt)?tt(D[qt],D):""}var Lt=typeof O=="function"?O(D):[],Qr;if(v){Qr={};for(var In=0;In<Lt.length;In++)Qr["$"+Lt[In]]=Lt[In]}for(var dn in D)j(D,dn)&&(jt&&String(Number(dn))===dn&&dn<D.length||v&&Qr["$"+dn]instanceof Symbol||(N.call(/[^\w$]/,dn)?Ht.push(tt(dn,D)+": "+tt(D[dn],D)):Ht.push(dn+": "+tt(D[dn],D))));if(typeof O=="function")for(var us=0;us<Lt.length;us++)z.call(D,Lt[us])&&Ht.push("["+tt(Lt[us])+"]: "+tt(D[Lt[us]],D));return Ht}return ap}var cp,yk;function q4(){if(yk)return cp;yk=1;var e=wu(),t=Do(),r=function(a,c,u){for(var l=a,h;(h=l.next)!=null;l=h)if(h.key===c)return l.next=h.next,u||(h.next=a.next,a.next=h),h},n=function(a,c){if(a){var u=r(a,c);return u&&u.value}},i=function(a,c,u){var l=r(a,c);l?l.value=u:a.next={key:c,next:a.next,value:u}},s=function(a,c){return a?!!r(a,c):!1},o=function(a,c){if(a)return r(a,c,!0)};return cp=function(){var c,u={assert:function(l){if(!u.has(l))throw new t("Side channel does not contain "+e(l))},delete:function(l){var h=c&&c.next,d=o(c,l);return d&&h&&h===d&&(c=void 0),!!d},get:function(l){return n(c,l)},has:function(l){return s(c,l)},set:function(l,h){c||(c={next:void 0}),i(c,l,h)}};return u},cp}var lp,_k;function bk(){return _k||(_k=1,lp=Object),lp}var up,wk;function V4(){return wk||(wk=1,up=Error),up}var fp,Ek;function X4(){return Ek||(Ek=1,fp=EvalError),fp}var hp,vk;function J4(){return vk||(vk=1,hp=RangeError),hp}var dp,kk;function Z4(){return kk||(kk=1,dp=ReferenceError),dp}var pp,xk;function Q4(){return xk||(xk=1,pp=SyntaxError),pp}var mp,Ak;function t5(){return Ak||(Ak=1,mp=URIError),mp}var gp,Tk;function e5(){return Tk||(Tk=1,gp=Math.abs),gp}var yp,Sk;function r5(){return Sk||(Sk=1,yp=Math.floor),yp}var _p,Rk;function n5(){return Rk||(Rk=1,_p=Math.max),_p}var bp,Ok;function i5(){return Ok||(Ok=1,bp=Math.min),bp}var wp,Ik;function s5(){return Ik||(Ik=1,wp=Math.pow),wp}var Ep,Nk;function o5(){return Nk||(Nk=1,Ep=Math.round),Ep}var vp,Ck;function a5(){return Ck||(Ck=1,vp=Number.isNaN||function(t){return t!==t}),vp}var kp,Lk;function c5(){if(Lk)return kp;Lk=1;var e=a5();return kp=function(r){return e(r)||r===0?r:r<0?-1:1},kp}var xp,Mk;function l5(){return Mk||(Mk=1,xp=Object.getOwnPropertyDescriptor),xp}var Ap,Uk;function Pk(){if(Uk)return Ap;Uk=1;var e=l5();if(e)try{e([],"length")}catch{e=null}return Ap=e,Ap}var Tp,Fk;function u5(){if(Fk)return Tp;Fk=1;var e=Object.defineProperty||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return Tp=e,Tp}var Sp,Bk;function f5(){return Bk||(Bk=1,Sp=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Sp}var Rp,$k;function h5(){if($k)return Rp;$k=1;var e=typeof Symbol<"u"&&Symbol,t=f5();return Rp=function(){return typeof e!="function"||typeof Symbol!="function"||typeof e("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Rp}var Op,Dk;function jk(){return Dk||(Dk=1,Op=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Op}var Ip,zk;function Wk(){if(zk)return Ip;zk=1;var e=bk();return Ip=e.getPrototypeOf||null,Ip}var Np,Hk;function d5(){if(Hk)return Np;Hk=1;var e="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,r=Math.max,n="[object Function]",i=function(c,u){for(var l=[],h=0;h<c.length;h+=1)l[h]=c[h];for(var d=0;d<u.length;d+=1)l[d+c.length]=u[d];return l},s=function(c,u){for(var l=[],h=u,d=0;h<c.length;h+=1,d+=1)l[d]=c[h];return l},o=function(a,c){for(var u="",l=0;l<a.length;l+=1)u+=a[l],l+1<a.length&&(u+=c);return u};return Np=function(c){var u=this;if(typeof u!="function"||t.apply(u)!==n)throw new TypeError(e+u);for(var l=s(arguments,1),h,d=function(){if(this instanceof h){var y=u.apply(this,i(l,arguments));return Object(y)===y?y:this}return u.apply(c,i(l,arguments))},f=r(0,u.length-l.length),m=[],p=0;p<f;p++)m[p]="$"+p;if(h=Function("binder","return function ("+o(m,",")+"){ return binder.apply(this,arguments); }")(d),u.prototype){var g=function(){};g.prototype=u.prototype,h.prototype=new g,g.prototype=null}return h},Np}var Cp,Gk;function Eu(){if(Gk)return Cp;Gk=1;var e=d5();return Cp=Function.prototype.bind||e,Cp}var Lp,Kk;function Mp(){return Kk||(Kk=1,Lp=Function.prototype.call),Lp}var Up,Yk;function qk(){return Yk||(Yk=1,Up=Function.prototype.apply),Up}var Pp,Vk;function p5(){return Vk||(Vk=1,Pp=typeof Reflect<"u"&&Reflect&&Reflect.apply),Pp}var Fp,Xk;function m5(){if(Xk)return Fp;Xk=1;var e=Eu(),t=qk(),r=Mp(),n=p5();return Fp=n||e.call(r,t),Fp}var Bp,Jk;function Zk(){if(Jk)return Bp;Jk=1;var e=Eu(),t=Do(),r=Mp(),n=m5();return Bp=function(s){if(s.length<1||typeof s[0]!="function")throw new t("a function is required");return n(e,r,s)},Bp}var $p,Qk;function g5(){if(Qk)return $p;Qk=1;var e=Zk(),t=Pk(),r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var n=!!r&&t&&t(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return $p=n&&typeof n.get=="function"?e([n.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,$p}var Dp,tx;function y5(){if(tx)return Dp;tx=1;var e=jk(),t=Wk(),r=g5();return Dp=e?function(i){return e(i)}:t?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return t(i)}:r?function(i){return r(i)}:null,Dp}var jp,ex;function _5(){if(ex)return jp;ex=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,r=Eu();return jp=r.call(e,t),jp}var zp,rx;function Wp(){if(rx)return zp;rx=1;var e,t=bk(),r=V4(),n=X4(),i=J4(),s=Z4(),o=Q4(),a=Do(),c=t5(),u=e5(),l=r5(),h=n5(),d=i5(),f=s5(),m=o5(),p=c5(),g=Function,y=function(Et){try{return g('"use strict"; return ('+Et+").constructor;")()}catch{}},b=Pk(),S=u5(),T=function(){throw new a},x=b?function(){try{return arguments.callee,T}catch{try{return b(arguments,"callee").get}catch{return T}}}():T,N=h5()(),R=y5(),B=Wk(),M=jk(),H=qk(),V=Mp(),O={},I=typeof Uint8Array>"u"||!R?e:R(Uint8Array),v={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?e:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?e:ArrayBuffer,"%ArrayIteratorPrototype%":N&&R?R([][Symbol.iterator]()):e,"%AsyncFromSyncIteratorPrototype%":e,"%AsyncFunction%":O,"%AsyncGenerator%":O,"%AsyncGeneratorFunction%":O,"%AsyncIteratorPrototype%":O,"%Atomics%":typeof Atomics>"u"?e:Atomics,"%BigInt%":typeof BigInt>"u"?e:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?e:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?e:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?e:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":n,"%Float16Array%":typeof Float16Array>"u"?e:Float16Array,"%Float32Array%":typeof Float32Array>"u"?e:Float32Array,"%Float64Array%":typeof Float64Array>"u"?e:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?e:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":O,"%Int8Array%":typeof Int8Array>"u"?e:Int8Array,"%Int16Array%":typeof Int16Array>"u"?e:Int16Array,"%Int32Array%":typeof Int32Array>"u"?e:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":N&&R?R(R([][Symbol.iterator]())):e,"%JSON%":typeof JSON=="object"?JSON:e,"%Map%":typeof Map>"u"?e:Map,"%MapIteratorPrototype%":typeof Map>"u"||!N||!R?e:R(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":b,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?e:Promise,"%Proxy%":typeof Proxy>"u"?e:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?e:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?e:Set,"%SetIteratorPrototype%":typeof Set>"u"||!N||!R?e:R(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?e:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":N&&R?R(""[Symbol.iterator]()):e,"%Symbol%":N?Symbol:e,"%SyntaxError%":o,"%ThrowTypeError%":x,"%TypedArray%":I,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?e:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?e:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?e:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?e:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?e:WeakMap,"%WeakRef%":typeof WeakRef>"u"?e:WeakRef,"%WeakSet%":typeof WeakSet>"u"?e:WeakSet,"%Function.prototype.call%":V,"%Function.prototype.apply%":H,"%Object.defineProperty%":S,"%Object.getPrototypeOf%":B,"%Math.abs%":u,"%Math.floor%":l,"%Math.max%":h,"%Math.min%":d,"%Math.pow%":f,"%Math.round%":m,"%Math.sign%":p,"%Reflect.getPrototypeOf%":M};if(R)try{null.error}catch(Et){var L=R(R(Et));v["%Error.prototype%"]=L}var z=function Et(vt){var At;if(vt==="%AsyncFunction%")At=y("async function () {}");else if(vt==="%GeneratorFunction%")At=y("function* () {}");else if(vt==="%AsyncGeneratorFunction%")At=y("async function* () {}");else if(vt==="%AsyncGenerator%"){var Ut=Et("%AsyncGeneratorFunction%");Ut&&(At=Ut.prototype)}else if(vt==="%AsyncIteratorPrototype%"){var Dt=Et("%AsyncGenerator%");Dt&&R&&(At=R(Dt.prototype))}return v[vt]=At,At},U={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Y=Eu(),X=_5(),K=Y.call(V,Array.prototype.concat),W=Y.call(H,Array.prototype.splice),P=Y.call(V,String.prototype.replace),ot=Y.call(V,String.prototype.slice),G=Y.call(V,RegExp.prototype.exec),rt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,wt=/\\(\\)?/g,Rt=function(vt){var At=ot(vt,0,1),Ut=ot(vt,-1);if(At==="%"&&Ut!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(Ut==="%"&&At!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var Dt=[];return P(vt,rt,function(A,ut,nt,j){Dt[Dt.length]=nt?P(j,wt,"$1"):ut||A}),Dt},Ct=function(vt,At){var Ut=vt,Dt;if(X(U,Ut)&&(Dt=U[Ut],Ut="%"+Dt[0]+"%"),X(v,Ut)){var A=v[Ut];if(A===O&&(A=z(Ut)),typeof A>"u"&&!At)throw new a("intrinsic "+vt+" exists, but is not available. Please file an issue!");return{alias:Dt,name:Ut,value:A}}throw new o("intrinsic "+vt+" does not exist!")};return zp=function(vt,At){if(typeof vt!="string"||vt.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof At!="boolean")throw new a('"allowMissing" argument must be a boolean');if(G(/^%?[^%]*%?$/,vt)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Ut=Rt(vt),Dt=Ut.length>0?Ut[0]:"",A=Ct("%"+Dt+"%",At),ut=A.name,nt=A.value,j=!1,$=A.alias;$&&(Dt=$[0],W(Ut,K([0,1],$)));for(var Z=1,dt=!0;Z<Ut.length;Z+=1){var pt=Ut[Z],it=ot(pt,0,1),gt=ot(pt,-1);if((it==='"'||it==="'"||it==="`"||gt==='"'||gt==="'"||gt==="`")&&it!==gt)throw new o("property names with quotes must have matching quotes");if((pt==="constructor"||!dt)&&(j=!0),Dt+="."+pt,ut="%"+Dt+"%",X(v,ut))nt=v[ut];else if(nt!=null){if(!(pt in nt)){if(!At)throw new a("base intrinsic for "+vt+" exists, but the property is not available.");return}if(b&&Z+1>=Ut.length){var St=b(nt,pt);dt=!!St,dt&&"get"in St&&!("originalValue"in St.get)?nt=St.get:nt=nt[pt]}else dt=X(nt,pt),nt=nt[pt];dt&&!j&&(v[ut]=nt)}}return nt},zp}var Hp,nx;function ix(){if(nx)return Hp;nx=1;var e=Wp(),t=Zk(),r=t([e("%String.prototype.indexOf%")]);return Hp=function(i,s){var o=e(i,!!s);return typeof o=="function"&&r(i,".prototype.")>-1?t([o]):o},Hp}var Gp,sx;function ox(){if(sx)return Gp;sx=1;var e=Wp(),t=ix(),r=wu(),n=Do(),i=e("%Map%",!0),s=t("Map.prototype.get",!0),o=t("Map.prototype.set",!0),a=t("Map.prototype.has",!0),c=t("Map.prototype.delete",!0),u=t("Map.prototype.size",!0);return Gp=!!i&&function(){var h,d={assert:function(f){if(!d.has(f))throw new n("Side channel does not contain "+r(f))},delete:function(f){if(h){var m=c(h,f);return u(h)===0&&(h=void 0),m}return!1},get:function(f){if(h)return s(h,f)},has:function(f){return h?a(h,f):!1},set:function(f,m){h||(h=new i),o(h,f,m)}};return d},Gp}var Kp,ax;function b5(){if(ax)return Kp;ax=1;var e=Wp(),t=ix(),r=wu(),n=ox(),i=Do(),s=e("%WeakMap%",!0),o=t("WeakMap.prototype.get",!0),a=t("WeakMap.prototype.set",!0),c=t("WeakMap.prototype.has",!0),u=t("WeakMap.prototype.delete",!0);return Kp=s?function(){var h,d,f={assert:function(m){if(!f.has(m))throw new i("Side channel does not contain "+r(m))},delete:function(m){if(s&&m&&(typeof m=="object"||typeof m=="function")){if(h)return u(h,m)}else if(n&&d)return d.delete(m);return!1},get:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&h?o(h,m):d&&d.get(m)},has:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&h?c(h,m):!!d&&d.has(m)},set:function(m,p){s&&m&&(typeof m=="object"||typeof m=="function")?(h||(h=new s),a(h,m,p)):n&&(d||(d=n()),d.set(m,p))}};return f}:n,Kp}var Yp,cx;function w5(){if(cx)return Yp;cx=1;var e=Do(),t=wu(),r=q4(),n=ox(),i=b5(),s=i||n||r;return Yp=function(){var a,c={assert:function(u){if(!c.has(u))throw new e("Side channel does not contain "+t(u))},delete:function(u){return!!a&&a.delete(u)},get:function(u){return a&&a.get(u)},has:function(u){return!!a&&a.has(u)},set:function(u,l){a||(a=s()),a.set(u,l)}};return c},Yp}var qp,lx;function Vp(){if(lx)return qp;lx=1;var e=String.prototype.replace,t=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return qp={default:r.RFC3986,formatters:{RFC1738:function(n){return e.call(n,t,"+")},RFC3986:function(n){return String(n)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986},qp}var Xp,ux;function fx(){if(ux)return Xp;ux=1;var e=Vp(),t=Object.prototype.hasOwnProperty,r=Array.isArray,n=function(){for(var g=[],y=0;y<256;++y)g.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return g}(),i=function(y){for(;y.length>1;){var b=y.pop(),S=b.obj[b.prop];if(r(S)){for(var T=[],x=0;x<S.length;++x)typeof S[x]<"u"&&T.push(S[x]);b.obj[b.prop]=T}}},s=function(y,b){for(var S=b&&b.plainObjects?{__proto__:null}:{},T=0;T<y.length;++T)typeof y[T]<"u"&&(S[T]=y[T]);return S},o=function g(y,b,S){if(!b)return y;if(typeof b!="object"&&typeof b!="function"){if(r(y))y.push(b);else if(y&&typeof y=="object")(S&&(S.plainObjects||S.allowPrototypes)||!t.call(Object.prototype,b))&&(y[b]=!0);else return[y,b];return y}if(!y||typeof y!="object")return[y].concat(b);var T=y;return r(y)&&!r(b)&&(T=s(y,S)),r(y)&&r(b)?(b.forEach(function(x,N){if(t.call(y,N)){var R=y[N];R&&typeof R=="object"&&x&&typeof x=="object"?y[N]=g(R,x,S):y.push(x)}else y[N]=x}),y):Object.keys(b).reduce(function(x,N){var R=b[N];return t.call(x,N)?x[N]=g(x[N],R,S):x[N]=R,x},T)},a=function(y,b){return Object.keys(b).reduce(function(S,T){return S[T]=b[T],S},y)},c=function(g,y,b){var S=g.replace(/\+/g," ");if(b==="iso-8859-1")return S.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(S)}catch{return S}},u=1024,l=function(y,b,S,T,x){if(y.length===0)return y;var N=y;if(typeof y=="symbol"?N=Symbol.prototype.toString.call(y):typeof y!="string"&&(N=String(y)),S==="iso-8859-1")return escape(N).replace(/%u[0-9a-f]{4}/gi,function(I){return"%26%23"+parseInt(I.slice(2),16)+"%3B"});for(var R="",B=0;B<N.length;B+=u){for(var M=N.length>=u?N.slice(B,B+u):N,H=[],V=0;V<M.length;++V){var O=M.charCodeAt(V);if(O===45||O===46||O===95||O===126||O>=48&&O<=57||O>=65&&O<=90||O>=97&&O<=122||x===e.RFC1738&&(O===40||O===41)){H[H.length]=M.charAt(V);continue}if(O<128){H[H.length]=n[O];continue}if(O<2048){H[H.length]=n[192|O>>6]+n[128|O&63];continue}if(O<55296||O>=57344){H[H.length]=n[224|O>>12]+n[128|O>>6&63]+n[128|O&63];continue}V+=1,O=65536+((O&1023)<<10|M.charCodeAt(V)&1023),H[H.length]=n[240|O>>18]+n[128|O>>12&63]+n[128|O>>6&63]+n[128|O&63]}R+=H.join("")}return R},h=function(y){for(var b=[{obj:{o:y},prop:"o"}],S=[],T=0;T<b.length;++T)for(var x=b[T],N=x.obj[x.prop],R=Object.keys(N),B=0;B<R.length;++B){var M=R[B],H=N[M];typeof H=="object"&&H!==null&&S.indexOf(H)===-1&&(b.push({obj:N,prop:M}),S.push(H))}return i(b),y},d=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},f=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},m=function(y,b){return[].concat(y,b)},p=function(y,b){if(r(y)){for(var S=[],T=0;T<y.length;T+=1)S.push(b(y[T]));return S}return b(y)};return Xp={arrayToObject:s,assign:a,combine:m,compact:h,decode:c,encode:l,isBuffer:f,isRegExp:d,maybeMap:p,merge:o},Xp}var Jp,hx;function E5(){if(hx)return Jp;hx=1;var e=w5(),t=fx(),r=Vp(),n=Object.prototype.hasOwnProperty,i={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,y){return g+"["+y+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(p,g){o.apply(p,s(g)?g:[g])},c=Date.prototype.toISOString,u=r.default,l={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:u,formatter:r.formatters[u],indices:!1,serializeDate:function(g){return c.call(g)},skipNulls:!1,strictNullHandling:!1},h=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},d={},f=function p(g,y,b,S,T,x,N,R,B,M,H,V,O,I,v,L,z,U){for(var Y=g,X=U,K=0,W=!1;(X=X.get(d))!==void 0&&!W;){var P=X.get(g);if(K+=1,typeof P<"u"){if(P===K)throw new RangeError("Cyclic object value");W=!0}typeof X.get(d)>"u"&&(K=0)}if(typeof M=="function"?Y=M(y,Y):Y instanceof Date?Y=O(Y):b==="comma"&&s(Y)&&(Y=t.maybeMap(Y,function(ut){return ut instanceof Date?O(ut):ut})),Y===null){if(x)return B&&!L?B(y,l.encoder,z,"key",I):y;Y=""}if(h(Y)||t.isBuffer(Y)){if(B){var ot=L?y:B(y,l.encoder,z,"key",I);return[v(ot)+"="+v(B(Y,l.encoder,z,"value",I))]}return[v(y)+"="+v(String(Y))]}var G=[];if(typeof Y>"u")return G;var rt;if(b==="comma"&&s(Y))L&&B&&(Y=t.maybeMap(Y,B)),rt=[{value:Y.length>0?Y.join(",")||null:void 0}];else if(s(M))rt=M;else{var wt=Object.keys(Y);rt=H?wt.sort(H):wt}var Rt=R?String(y).replace(/\./g,"%2E"):String(y),Ct=S&&s(Y)&&Y.length===1?Rt+"[]":Rt;if(T&&s(Y)&&Y.length===0)return Ct+"[]";for(var Et=0;Et<rt.length;++Et){var vt=rt[Et],At=typeof vt=="object"&&vt&&typeof vt.value<"u"?vt.value:Y[vt];if(!(N&&At===null)){var Ut=V&&R?String(vt).replace(/\./g,"%2E"):String(vt),Dt=s(Y)?typeof b=="function"?b(Ct,Ut):Ct:Ct+(V?"."+Ut:"["+Ut+"]");U.set(g,K);var A=e();A.set(d,U),a(G,p(At,Dt,b,S,T,x,N,R,b==="comma"&&L&&s(Y)?null:B,M,H,V,O,I,v,L,z,A))}}return G},m=function(g){if(!g)return l;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=g.charset||l.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=r.default;if(typeof g.format<"u"){if(!n.call(r.formatters,g.format))throw new TypeError("Unknown format option provided.");b=g.format}var S=r.formatters[b],T=l.filter;(typeof g.filter=="function"||s(g.filter))&&(T=g.filter);var x;if(g.arrayFormat in i?x=g.arrayFormat:"indices"in g?x=g.indices?"indices":"repeat":x=l.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var N=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:l.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:l.addQueryPrefix,allowDots:N,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:l.allowEmptyArrays,arrayFormat:x,charset:y,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:l.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?l.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:l.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:l.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:l.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:l.encodeValuesOnly,filter:T,format:b,formatter:S,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:l.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:l.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:l.strictNullHandling}};return Jp=function(p,g){var y=p,b=m(g),S,T;typeof b.filter=="function"?(T=b.filter,y=T("",y)):s(b.filter)&&(T=b.filter,S=T);var x=[];if(typeof y!="object"||y===null)return"";var N=i[b.arrayFormat],R=N==="comma"&&b.commaRoundTrip;S||(S=Object.keys(y)),b.sort&&S.sort(b.sort);for(var B=e(),M=0;M<S.length;++M){var H=S[M],V=y[H];b.skipNulls&&V===null||a(x,f(V,H,N,R,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,B))}var O=x.join(b.delimiter),I=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?I+="utf8=%26%2310003%3B&":I+="utf8=%E2%9C%93&"),O.length>0?I+O:""},Jp}var Zp,dx;function v5(){if(dx)return Zp;dx=1;var e=fx(),t=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:e.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(d){return d.replace(/&#(\d+);/g,function(f,m){return String.fromCharCode(parseInt(m,10))})},s=function(d,f,m){if(d&&typeof d=="string"&&f.comma&&d.indexOf(",")>-1)return d.split(",");if(f.throwOnLimitExceeded&&m>=f.arrayLimit)throw new RangeError("Array limit exceeded. Only "+f.arrayLimit+" element"+(f.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(f,m){var p={__proto__:null},g=m.ignoreQueryPrefix?f.replace(/^\?/,""):f;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=m.parameterLimit===1/0?void 0:m.parameterLimit,b=g.split(m.delimiter,m.throwOnLimitExceeded?y+1:y);if(m.throwOnLimitExceeded&&b.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var S=-1,T,x=m.charset;if(m.charsetSentinel)for(T=0;T<b.length;++T)b[T].indexOf("utf8=")===0&&(b[T]===a?x="utf-8":b[T]===o&&(x="iso-8859-1"),S=T,T=b.length);for(T=0;T<b.length;++T)if(T!==S){var N=b[T],R=N.indexOf("]="),B=R===-1?N.indexOf("="):R+1,M,H;B===-1?(M=m.decoder(N,n.decoder,x,"key"),H=m.strictNullHandling?null:""):(M=m.decoder(N.slice(0,B),n.decoder,x,"key"),H=e.maybeMap(s(N.slice(B+1),m,r(p[M])?p[M].length:0),function(O){return m.decoder(O,n.decoder,x,"value")})),H&&m.interpretNumericEntities&&x==="iso-8859-1"&&(H=i(String(H))),N.indexOf("[]=")>-1&&(H=r(H)?[H]:H);var V=t.call(p,M);V&&m.duplicates==="combine"?p[M]=e.combine(p[M],H):(!V||m.duplicates==="last")&&(p[M]=H)}return p},u=function(d,f,m,p){var g=0;if(d.length>0&&d[d.length-1]==="[]"){var y=d.slice(0,-1).join("");g=Array.isArray(f)&&f[y]?f[y].length:0}for(var b=p?f:s(f,m,g),S=d.length-1;S>=0;--S){var T,x=d[S];if(x==="[]"&&m.parseArrays)T=m.allowEmptyArrays&&(b===""||m.strictNullHandling&&b===null)?[]:e.combine([],b);else{T=m.plainObjects?{__proto__:null}:{};var N=x.charAt(0)==="["&&x.charAt(x.length-1)==="]"?x.slice(1,-1):x,R=m.decodeDotInKeys?N.replace(/%2E/g,"."):N,B=parseInt(R,10);!m.parseArrays&&R===""?T={0:b}:!isNaN(B)&&x!==R&&String(B)===R&&B>=0&&m.parseArrays&&B<=m.arrayLimit?(T=[],T[B]=b):R!=="__proto__"&&(T[R]=b)}b=T}return b},l=function(f,m,p,g){if(f){var y=p.allowDots?f.replace(/\.([^.[]+)/g,"[$1]"):f,b=/(\[[^[\]]*])/,S=/(\[[^[\]]*])/g,T=p.depth>0&&b.exec(y),x=T?y.slice(0,T.index):y,N=[];if(x){if(!p.plainObjects&&t.call(Object.prototype,x)&&!p.allowPrototypes)return;N.push(x)}for(var R=0;p.depth>0&&(T=S.exec(y))!==null&&R<p.depth;){if(R+=1,!p.plainObjects&&t.call(Object.prototype,T[1].slice(1,-1))&&!p.allowPrototypes)return;N.push(T[1])}if(T){if(p.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+p.depth+" and strictDepth is true");N.push("["+y.slice(T.index)+"]")}return u(N,m,p,g)}},h=function(f){if(!f)return n;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.decodeDotInKeys<"u"&&typeof f.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(f.decoder!==null&&typeof f.decoder<"u"&&typeof f.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof f.throwOnLimitExceeded<"u"&&typeof f.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var m=typeof f.charset>"u"?n.charset:f.charset,p=typeof f.duplicates>"u"?n.duplicates:f.duplicates;if(p!=="combine"&&p!=="first"&&p!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof f.allowDots>"u"?f.decodeDotInKeys===!0?!0:n.allowDots:!!f.allowDots;return{allowDots:g,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:typeof f.allowPrototypes=="boolean"?f.allowPrototypes:n.allowPrototypes,allowSparse:typeof f.allowSparse=="boolean"?f.allowSparse:n.allowSparse,arrayLimit:typeof f.arrayLimit=="number"?f.arrayLimit:n.arrayLimit,charset:m,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:n.charsetSentinel,comma:typeof f.comma=="boolean"?f.comma:n.comma,decodeDotInKeys:typeof f.decodeDotInKeys=="boolean"?f.decodeDotInKeys:n.decodeDotInKeys,decoder:typeof f.decoder=="function"?f.decoder:n.decoder,delimiter:typeof f.delimiter=="string"||e.isRegExp(f.delimiter)?f.delimiter:n.delimiter,depth:typeof f.depth=="number"||f.depth===!1?+f.depth:n.depth,duplicates:p,ignoreQueryPrefix:f.ignoreQueryPrefix===!0,interpretNumericEntities:typeof f.interpretNumericEntities=="boolean"?f.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:typeof f.parameterLimit=="number"?f.parameterLimit:n.parameterLimit,parseArrays:f.parseArrays!==!1,plainObjects:typeof f.plainObjects=="boolean"?f.plainObjects:n.plainObjects,strictDepth:typeof f.strictDepth=="boolean"?!!f.strictDepth:n.strictDepth,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:n.strictNullHandling,throwOnLimitExceeded:typeof f.throwOnLimitExceeded=="boolean"?f.throwOnLimitExceeded:!1}};return Zp=function(d,f){var m=h(f);if(d===""||d===null||typeof d>"u")return m.plainObjects?{__proto__:null}:{};for(var p=typeof d=="string"?c(d,m):d,g=m.plainObjects?{__proto__:null}:{},y=Object.keys(p),b=0;b<y.length;++b){var S=y[b],T=l(S,p[S],m,typeof d=="string");g=e.merge(g,T,m)}return m.allowSparse===!0?g:e.compact(g)},Zp}var Qp,px;function k5(){if(px)return Qp;px=1;var e=E5(),t=v5(),r=Vp();return Qp={formats:r,parse:t,stringify:e},Qp}var mx;function x5(){if(mx)return Ws;mx=1;var e=H4();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),u=["/","?","#"],l=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},p={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=k5();function y(x,N,R){if(x&&typeof x=="object"&&x instanceof t)return x;var B=new t;return B.parse(x,N,R),B}t.prototype.parse=function(x,N,R){if(typeof x!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof x);var B=x.indexOf("?"),M=B!==-1&&B<x.indexOf("#")?"?":"#",H=x.split(M),V=/\\/g;H[0]=H[0].replace(V,"/"),x=H.join(M);var O=x;if(O=O.trim(),!R&&x.split("#").length===1){var I=i.exec(O);if(I)return this.path=O,this.href=O,this.pathname=I[1],I[2]?(this.search=I[2],N?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):N&&(this.search="",this.query={}),this}var v=r.exec(O);if(v){v=v[0];var L=v.toLowerCase();this.protocol=L,O=O.substr(v.length)}if(R||v||O.match(/^\/\/[^@/]+@[^@/]+/)){var z=O.substr(0,2)==="//";z&&!(v&&m[v])&&(O=O.substr(2),this.slashes=!0)}if(!m[v]&&(z||v&&!p[v])){for(var U=-1,Y=0;Y<u.length;Y++){var X=O.indexOf(u[Y]);X!==-1&&(U===-1||X<U)&&(U=X)}var K,W;U===-1?W=O.lastIndexOf("@"):W=O.lastIndexOf("@",U),W!==-1&&(K=O.slice(0,W),O=O.slice(W+1),this.auth=decodeURIComponent(K)),U=-1;for(var Y=0;Y<c.length;Y++){var X=O.indexOf(c[Y]);X!==-1&&(U===-1||X<U)&&(U=X)}U===-1&&(U=O.length),this.host=O.slice(0,U),O=O.slice(U),this.parseHost(),this.hostname=this.hostname||"";var P=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!P)for(var ot=this.hostname.split(/\./),Y=0,G=ot.length;Y<G;Y++){var rt=ot[Y];if(rt&&!rt.match(h)){for(var wt="",Rt=0,Ct=rt.length;Rt<Ct;Rt++)rt.charCodeAt(Rt)>127?wt+="x":wt+=rt[Rt];if(!wt.match(h)){var Et=ot.slice(0,Y),vt=ot.slice(Y+1),At=rt.match(d);At&&(Et.push(At[1]),vt.unshift(At[2])),vt.length&&(O="/"+vt.join(".")+O),this.hostname=Et.join(".");break}}}this.hostname.length>l?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=e.toASCII(this.hostname));var Ut=this.port?":"+this.port:"",Dt=this.hostname||"";this.host=Dt+Ut,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),O[0]!=="/"&&(O="/"+O))}if(!f[L])for(var Y=0,G=a.length;Y<G;Y++){var A=a[Y];if(O.indexOf(A)!==-1){var ut=encodeURIComponent(A);ut===A&&(ut=escape(A)),O=O.split(A).join(ut)}}var nt=O.indexOf("#");nt!==-1&&(this.hash=O.substr(nt),O=O.slice(0,nt));var j=O.indexOf("?");if(j!==-1?(this.search=O.substr(j),this.query=O.substr(j+1),N&&(this.query=g.parse(this.query)),O=O.slice(0,j)):N&&(this.search="",this.query={}),O&&(this.pathname=O),p[L]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Ut=this.pathname||"",$=this.search||"";this.path=Ut+$}return this.href=this.format(),this};function b(x){return typeof x=="string"&&(x=y(x)),x instanceof t?x.format():t.prototype.format.call(x)}t.prototype.format=function(){var x=this.auth||"";x&&(x=encodeURIComponent(x),x=x.replace(/%3A/i,":"),x+="@");var N=this.protocol||"",R=this.pathname||"",B=this.hash||"",M=!1,H="";this.host?M=x+this.host:this.hostname&&(M=x+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(M+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(H=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var V=this.search||H&&"?"+H||"";return N&&N.substr(-1)!==":"&&(N+=":"),this.slashes||(!N||p[N])&&M!==!1?(M="//"+(M||""),R&&R.charAt(0)!=="/"&&(R="/"+R)):M||(M=""),B&&B.charAt(0)!=="#"&&(B="#"+B),V&&V.charAt(0)!=="?"&&(V="?"+V),R=R.replace(/[?#]/g,function(O){return encodeURIComponent(O)}),V=V.replace("#","%23"),N+M+R+V+B};function S(x,N){return y(x,!1,!0).resolve(N)}t.prototype.resolve=function(x){return this.resolveObject(y(x,!1,!0)).format()};function T(x,N){return x?y(x,!1,!0).resolveObject(N):N}return t.prototype.resolveObject=function(x){if(typeof x=="string"){var N=new t;N.parse(x,!1,!0),x=N}for(var R=new t,B=Object.keys(this),M=0;M<B.length;M++){var H=B[M];R[H]=this[H]}if(R.hash=x.hash,x.href==="")return R.href=R.format(),R;if(x.slashes&&!x.protocol){for(var V=Object.keys(x),O=0;O<V.length;O++){var I=V[O];I!=="protocol"&&(R[I]=x[I])}return p[R.protocol]&&R.hostname&&!R.pathname&&(R.pathname="/",R.path=R.pathname),R.href=R.format(),R}if(x.protocol&&x.protocol!==R.protocol){if(!p[x.protocol]){for(var v=Object.keys(x),L=0;L<v.length;L++){var z=v[L];R[z]=x[z]}return R.href=R.format(),R}if(R.protocol=x.protocol,!x.host&&!m[x.protocol]){for(var G=(x.pathname||"").split("/");G.length&&!(x.host=G.shift()););x.host||(x.host=""),x.hostname||(x.hostname=""),G[0]!==""&&G.unshift(""),G.length<2&&G.unshift(""),R.pathname=G.join("/")}else R.pathname=x.pathname;if(R.search=x.search,R.query=x.query,R.host=x.host||"",R.auth=x.auth,R.hostname=x.hostname||x.host,R.port=x.port,R.pathname||R.search){var U=R.pathname||"",Y=R.search||"";R.path=U+Y}return R.slashes=R.slashes||x.slashes,R.href=R.format(),R}var X=R.pathname&&R.pathname.charAt(0)==="/",K=x.host||x.pathname&&x.pathname.charAt(0)==="/",W=K||X||R.host&&x.pathname,P=W,ot=R.pathname&&R.pathname.split("/")||[],G=x.pathname&&x.pathname.split("/")||[],rt=R.protocol&&!p[R.protocol];if(rt&&(R.hostname="",R.port=null,R.host&&(ot[0]===""?ot[0]=R.host:ot.unshift(R.host)),R.host="",x.protocol&&(x.hostname=null,x.port=null,x.host&&(G[0]===""?G[0]=x.host:G.unshift(x.host)),x.host=null),W=W&&(G[0]===""||ot[0]==="")),K)R.host=x.host||x.host===""?x.host:R.host,R.hostname=x.hostname||x.hostname===""?x.hostname:R.hostname,R.search=x.search,R.query=x.query,ot=G;else if(G.length)ot||(ot=[]),ot.pop(),ot=ot.concat(G),R.search=x.search,R.query=x.query;else if(x.search!=null){if(rt){R.host=ot.shift(),R.hostname=R.host;var wt=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;wt&&(R.auth=wt.shift(),R.hostname=wt.shift(),R.host=R.hostname)}return R.search=x.search,R.query=x.query,(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.href=R.format(),R}if(!ot.length)return R.pathname=null,R.search?R.path="/"+R.search:R.path=null,R.href=R.format(),R;for(var Rt=ot.slice(-1)[0],Ct=(R.host||x.host||ot.length>1)&&(Rt==="."||Rt==="..")||Rt==="",Et=0,vt=ot.length;vt>=0;vt--)Rt=ot[vt],Rt==="."?ot.splice(vt,1):Rt===".."?(ot.splice(vt,1),Et++):Et&&(ot.splice(vt,1),Et--);if(!W&&!P)for(;Et--;Et)ot.unshift("..");W&&ot[0]!==""&&(!ot[0]||ot[0].charAt(0)!=="/")&&ot.unshift(""),Ct&&ot.join("/").substr(-1)!=="/"&&ot.push("");var At=ot[0]===""||ot[0]&&ot[0].charAt(0)==="/";if(rt){R.hostname=At?"":ot.length?ot.shift():"",R.host=R.hostname;var wt=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;wt&&(R.auth=wt.shift(),R.hostname=wt.shift(),R.host=R.hostname)}return W=W||R.host&&ot.length,W&&!At&&ot.unshift(""),ot.length>0?R.pathname=ot.join("/"):(R.pathname=null,R.path=null),(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.auth=x.auth||R.auth,R.slashes=R.slashes||x.slashes,R.href=R.format(),R},t.prototype.parseHost=function(){var x=this.host,N=n.exec(x);N&&(N=N[0],N!==":"&&(this.port=N.substr(1)),x=x.substr(0,x.length-N.length)),x&&(this.hostname=x)},Ws.parse=y,Ws.resolve=S,Ws.resolveObject=T,Ws.format=b,Ws.Url=t,Ws}var A5=typeof URL=="function"?URL:x5().URL;const ns=A5;function T5(e,t,r){if(t in e)return e[t];if(arguments.length===3)return r;throw new Error('"'+t+'" is a required argument.')}un.getArg=T5;const gx=function(){return!("__proto__"in Object.create(null))}();function yx(e){return e}function S5(e){return _x(e)?"$"+e:e}un.toSetString=gx?yx:S5;function R5(e){return _x(e)?e.slice(1):e}un.fromSetString=gx?yx:R5;function _x(e){if(!e)return!1;const t=e.length;if(t<9||e.charCodeAt(t-1)!==95||e.charCodeAt(t-2)!==95||e.charCodeAt(t-3)!==111||e.charCodeAt(t-4)!==116||e.charCodeAt(t-5)!==111||e.charCodeAt(t-6)!==114||e.charCodeAt(t-7)!==112||e.charCodeAt(t-8)!==95||e.charCodeAt(t-9)!==95)return!1;for(let r=t-10;r>=0;r--)if(e.charCodeAt(r)!==36)return!1;return!0}function bx(e,t){return e===t?0:e===null?1:t===null?-1:e>t?1:-1}function O5(e,t){let r=e.generatedLine-t.generatedLine;return r!==0||(r=e.generatedColumn-t.generatedColumn,r!==0)||(r=bx(e.source,t.source),r!==0)||(r=e.originalLine-t.originalLine,r!==0)||(r=e.originalColumn-t.originalColumn,r!==0)?r:bx(e.name,t.name)}un.compareByGeneratedPositionsInflated=O5;function I5(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))}un.parseSourceMapInput=I5;const t0="http:",ec=`${t0}//host`;function e0(e){return t=>{const r=jo(t),n=r0(t),i=new ns(t,n);e(i);const s=i.toString();return r==="absolute"?s:r==="scheme-relative"?s.slice(t0.length):r==="path-absolute"?s.slice(ec.length):n0(n,s)}}function is(e,t){return new ns(e,t).toString()}function N5(e,t){let r=0;do{const n=e+r++;if(t.indexOf(n)===-1)return n}while(!0)}function r0(e){const t=e.split("..").length-1,r=N5("p",e);let n=`${ec}/`;for(let i=0;i<t;i++)n+=`${r}/`;return n}const C5=/^[A-Za-z0-9\+\-\.]+:/;function jo(e){return e[0]==="/"?e[1]==="/"?"scheme-relative":"path-absolute":C5.test(e)?"absolute":"path-relative"}function n0(e,t){typeof e=="string"&&(e=new ns(e)),typeof t=="string"&&(t=new ns(t));const r=t.pathname.split("/"),n=e.pathname.split("/");for(n.length>0&&!n[n.length-1]&&n.pop();r.length>0&&n.length>0&&r[0]===n[0];)r.shift(),n.shift();return n.map(()=>"..").concat(r).join("/")+t.search+t.hash}const L5=e0(e=>{e.pathname=e.pathname.replace(/\/?$/,"/")}),M5=e0(e=>{e.href=new ns(".",e.toString()).toString()}),rc=e0(e=>{});un.normalize=rc;function i0(e,t){const r=jo(t),n=jo(e);if(e=L5(e),r==="absolute")return is(t,void 0);if(n==="absolute")return is(t,e);if(r==="scheme-relative")return rc(t);if(n==="scheme-relative")return is(t,is(e,ec)).slice(t0.length);if(r==="path-absolute")return rc(t);if(n==="path-absolute")return is(t,is(e,ec)).slice(ec.length);const i=r0(t+e),s=is(t,is(e,i));return n0(i,s)}un.join=i0;function U5(e,t){const r=P5(e,t);return typeof r=="string"?r:rc(t)}un.relative=U5;function P5(e,t){if(jo(e)!==jo(t))return null;const n=r0(e+t),i=new ns(e,n),s=new ns(t,n);try{new ns("",s.toString())}catch{return null}return s.protocol!==i.protocol||s.user!==i.user||s.password!==i.password||s.hostname!==i.hostname||s.port!==i.port?null:n0(i,s)}function F5(e,t,r){e&&jo(t)==="path-absolute"&&(t=t.replace(/^\//,""));let n=rc(t||"");return e&&(n=i0(e,n)),r&&(n=i0(M5(r),n)),n}un.computeSourceURL=F5;var s0={};let B5=class IA{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const n=new IA;for(let i=0,s=t.length;i<s;i++)n.add(t[i],r);return n}size(){return this._set.size}add(t,r){const n=this.has(t),i=this._array.length;(!n||r)&&this._array.push(t),n||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const r=this._set.get(t);if(r>=0)return r;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};s0.ArraySet=B5;var wx={};const Ex=un;function $5(e,t){const r=e.generatedLine,n=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return n>r||n==r&&s>=i||Ex.compareByGeneratedPositionsInflated(e,t)<=0}let D5=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,r){this._array.forEach(t,r)}add(t){$5(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Ex.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};wx.MappingList=D5;const nc=lk,Je=un,vu=s0.ArraySet,j5=wx.MappingList;let vx=class NA{constructor(t){t||(t={}),this._file=Je.getArg(t,"file",null),this._sourceRoot=Je.getArg(t,"sourceRoot",null),this._skipValidation=Je.getArg(t,"skipValidation",!1),this._sources=new vu,this._names=new vu,this._mappings=new j5,this._sourcesContents=null}static fromSourceMap(t){const r=t.sourceRoot,n=new NA({file:t.file,sourceRoot:r});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,r!=null&&(s.source=Je.relative(r,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),n.addMapping(s)}),t.sources.forEach(function(i){let s=i;r!=null&&(s=Je.relative(r,i)),n._sources.has(s)||n._sources.add(s);const o=t.sourceContentFor(i);o!=null&&n.setSourceContent(i,o)}),n}addMapping(t){const r=Je.getArg(t,"generated"),n=Je.getArg(t,"original",null);let i=Je.getArg(t,"source",null),s=Je.getArg(t,"name",null);this._skipValidation||this._validateMapping(r,n,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:r.line,generatedColumn:r.column,originalLine:n&&n.line,originalColumn:n&&n.column,source:i,name:s})}setSourceContent(t,r){let n=t;this._sourceRoot!=null&&(n=Je.relative(this._sourceRoot,n)),r!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Je.toSetString(n)]=r):this._sourcesContents&&(delete this._sourcesContents[Je.toSetString(n)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,r,n){let i=r;if(r==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Je.relative(s,i));const o=this._mappings.toArray().length>0?new vu:this._sources,a=new vu;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,n!=null&&(c.source=Je.join(n,c.source)),s!=null&&(c.source=Je.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(n!=null&&(c=Je.join(n,c)),s!=null&&(c=Je.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,r,n,i){if(r&&typeof r.line!="number"&&typeof r.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!r&&!n&&!i)){if(!(t&&"line"in t&&"column"in t&&r&&"line"in r&&"column"in r&&t.line>0&&t.column>=0&&r.line>0&&r.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:n,original:r,name:i}))}}_serializeMappings(){let t=0,r=1,n=0,i=0,s=0,o=0,a="",c,u,l,h;const d=this._mappings.toArray();for(let f=0,m=d.length;f<m;f++){if(u=d[f],c="",u.generatedLine!==r)for(t=0;u.generatedLine!==r;)c+=";",r++;else if(f>0){if(!Je.compareByGeneratedPositionsInflated(u,d[f-1]))continue;c+=","}c+=nc.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=nc.encode(h-o),o=h,c+=nc.encode(u.originalLine-1-i),i=u.originalLine-1,c+=nc.encode(u.originalColumn-n),n=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=nc.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,r){return t.map(function(n){if(!this._sourcesContents)return null;r!=null&&(n=Je.relative(r,n));const i=Je.toSetString(n);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};vx.prototype._version=3,ck.SourceMapGenerator=vx;var kx={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(r,n,i,s,o,a){const c=Math.floor((n-r)/2)+r,u=o(i,s[c],!0);return u===0?c:u>0?n-c>1?t(c,n,i,s,o,a):a===e.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-r>1?t(r,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:r<0?-1:r}e.search=function(n,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,n,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(kx);var o0={exports:{}};let ic=null;o0.exports=function(){if(typeof ic=="string")return fetch(ic).then(t=>t.arrayBuffer());if(ic instanceof ArrayBuffer)return Promise.resolve(ic);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},o0.exports.initialize=e=>{ic=e};var xx=o0.exports;const z5=xx;function W5(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let sc=null;var H5=function(){if(sc)return sc;const t=[];return sc=z5().then(r=>WebAssembly.instantiate(r,{env:{mapping_callback(n,i,s,o,a,c,u,l,h,d){const f=new W5;f.generatedLine=n+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=u+1,f.originalColumn=l,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(r=>({exports:r.instance.exports,withMappingCallback:(n,i)=>{t.push(n);try{i()}finally{t.pop()}}})).then(null,r=>{throw sc=null,r}),sc};const ne=un,G5=kx,a0=s0.ArraySet,K5=xx,Y5=H5,c0=Symbol("smcInternal");class mr{constructor(t,r){return t==c0?Promise.resolve(this):V5(t,r)}static initialize(t){K5.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,r){return X5(t,r)}static async with(t,r,n){const i=await new mr(t,r);try{return await n(i)}finally{i.destroy()}}eachMapping(t,r,n){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}mr.prototype._version=3,mr.GENERATED_ORDER=1,mr.ORIGINAL_ORDER=2,mr.GREATEST_LOWER_BOUND=1,mr.LEAST_UPPER_BOUND=2;class oc extends mr{constructor(t,r){return super(c0).then(n=>{let i=t;typeof t=="string"&&(i=ne.parseSourceMapInput(t));const s=ne.getArg(i,"version"),o=ne.getArg(i,"sources").map(String),a=ne.getArg(i,"names",[]),c=ne.getArg(i,"sourceRoot",null),u=ne.getArg(i,"sourcesContent",null),l=ne.getArg(i,"mappings"),h=ne.getArg(i,"file",null),d=ne.getArg(i,"x_google_ignoreList",null);if(s!=n._version)throw new Error("Unsupported version: "+s);return n._sourceLookupCache=new Map,n._names=a0.fromArray(a.map(String),!0),n._sources=a0.fromArray(o,!0),n._absoluteSources=a0.fromArray(n._sources.toArray().map(function(f){return ne.computeSourceURL(c,f,r)}),!0),n.sourceRoot=c,n.sourcesContent=u,n._mappings=l,n._sourceMapURL=r,n.file=h,n.x_google_ignoreList=d,n._computedColumnSpans=!1,n._mappingsPtr=0,n._wasm=null,Y5().then(f=>(n._wasm=f,n))})}_findSourceIndex(t){const r=this._sourceLookupCache.get(t);if(typeof r=="number")return r;const n=ne.computeSourceURL(null,t,this._sourceMapURL);if(this._absoluteSources.has(n)){const s=this._absoluteSources.indexOf(n);return this._sourceLookupCache.set(t,s),s}const i=ne.computeSourceURL(this.sourceRoot,t,this._sourceMapURL);if(this._absoluteSources.has(i)){const s=this._absoluteSources.indexOf(i);return this._sourceLookupCache.set(t,s),s}return-1}static fromSourceMap(t,r){return new oc(t.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const t=this._mappings,r=t.length,n=this._wasm.exports.allocate_mappings(r)>>>0,i=new Uint8Array(this._wasm.exports.memory.buffer,n,r);for(let o=0;o<r;o++)i[o]=t.charCodeAt(o);const s=this._wasm.exports.parse_mappings(n);if(!s){const o=this._wasm.exports.get_last_error();let a=`Error parsing mappings (code ${o}): `;switch(o){case 1:a+="the mappings contained a negative line, column, source index, or name index";break;case 2:a+="the mappings contained a number larger than 2**32";break;case 3:a+="reached EOF while in the middle of parsing a VLQ";break;case 4:a+="invalid base 64 character while parsing a VLQ";break;default:a+="unknown error code";break}throw new Error(a)}this._mappingsPtr=s}eachMapping(t,r,n){const i=r||null,s=n||mr.GENERATED_ORDER;this._wasm.withMappingCallback(o=>{o.source!==null&&(o.source=this._absoluteSources.at(o.source),o.name!==null&&(o.name=this._names.at(o.name))),this._computedColumnSpans&&o.lastGeneratedColumn===null&&(o.lastGeneratedColumn=1/0),t.call(i,o)},()=>{switch(s){case mr.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case mr.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let r=ne.getArg(t,"source");const n=ne.getArg(t,"line"),i=t.column||0;if(r=this._findSourceIndex(r),r<0)return[];if(n<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),r,n-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const r={generatedLine:ne.getArg(t,"line"),generatedColumn:ne.getArg(t,"column")};if(r.generatedLine<1)throw new Error("Line numbers must be >= 1");if(r.generatedColumn<0)throw new Error("Column numbers must be >= 0");let n=ne.getArg(t,"bias",mr.GREATEST_LOWER_BOUND);n==null&&(n=mr.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),r.generatedLine-1,r.generatedColumn,n)}),i&&i.generatedLine===r.generatedLine){let s=ne.getArg(i,"source",null);s!==null&&(s=this._absoluteSources.at(s));let o=ne.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:ne.getArg(i,"originalLine",null),column:ne.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,r){if(!this.sourcesContent)return null;const n=this._findSourceIndex(t);if(n>=0)return this.sourcesContent[n];if(r)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){let r=ne.getArg(t,"source");if(r=this._findSourceIndex(r),r<0)return{line:null,column:null,lastColumn:null};const n={source:r,originalLine:ne.getArg(t,"line"),originalColumn:ne.getArg(t,"column")};if(n.originalLine<1)throw new Error("Line numbers must be >= 1");if(n.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=ne.getArg(t,"bias",mr.GREATEST_LOWER_BOUND);i==null&&(i=mr.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),n.source,n.originalLine-1,n.originalColumn,i)}),s&&s.source===n.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:ne.getArg(s,"generatedLine",null),column:ne.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}oc.prototype.consumer=mr;class q5 extends mr{constructor(t,r){return super(c0).then(n=>{let i=t;typeof t=="string"&&(i=ne.parseSourceMapInput(t));const s=ne.getArg(i,"version"),o=ne.getArg(i,"sections");if(s!=n._version)throw new Error("Unsupported version: "+s);let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=ne.getArg(c,"offset"),l=ne.getArg(u,"line"),h=ne.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new mr(ne.getArg(c,"map"),r).then(f=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:f}))})).then(c=>(n._sections=c,n))})}get sources(){const t=[];for(let r=0;r<this._sections.length;r++)for(let n=0;n<this._sections[r].consumer.sources.length;n++)t.push(this._sections[r].consumer.sources[n]);return t}originalPositionFor(t){const r={generatedLine:ne.getArg(t,"line"),generatedColumn:ne.getArg(t,"column")},n=G5.search(r,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-(o.generatedOffset.generatedColumn-1)}),i=this._sections[n];return i?i.consumer.originalPositionFor({line:r.generatedLine-(i.generatedOffset.generatedLine-1),column:r.generatedColumn-(i.generatedOffset.generatedLine===r.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,r){for(let n=0;n<this._sections.length;n++){const s=this._sections[n].consumer.sourceContentFor(t,!0);if(s)return s}if(r)return null;throw new Error('"'+t+'" is not in the SourceMap.')}_findSectionIndex(t){for(let r=0;r<this._sections.length;r++){const{consumer:n}=this._sections[r];if(n._findSourceIndex(t)!==-1)return r}return-1}generatedPositionFor(t){const r=this._findSectionIndex(ne.getArg(t,"source")),n=r>=0?this._sections[r]:null,i=r>=0&&r+1<this._sections.length?this._sections[r+1]:null,s=n&&n.consumer.generatedPositionFor(t);if(s&&s.line!==null){const o=n.generatedOffset.generatedLine-1,a=n.generatedOffset.generatedColumn-1;return s.line===1&&(s.column+=a,typeof s.lastColumn=="number"&&(s.lastColumn+=a)),s.lastColumn===1/0&&i&&s.line===i.generatedOffset.generatedLine&&(s.lastColumn=i.generatedOffset.generatedColumn-2),s.line+=o,s}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(t){const r=this._findSectionIndex(ne.getArg(t,"source")),n=r>=0?this._sections[r]:null,i=r>=0&&r+1<this._sections.length?this._sections[r+1]:null;return n?n.consumer.allGeneratedPositionsFor(t).map(s=>{const o=n.generatedOffset.generatedLine-1,a=n.generatedOffset.generatedColumn-1;return s.line===1&&(s.column+=a,typeof s.lastColumn=="number"&&(s.lastColumn+=a)),s.lastColumn===1/0&&i&&s.line===i.generatedOffset.generatedLine&&(s.lastColumn=i.generatedOffset.generatedColumn-2),s.line+=o,s}):[]}eachMapping(t,r,n){this._sections.forEach((i,s)=>{const o=s+1<this._sections.length?this._sections[s+1]:null,{generatedOffset:a}=i,c=a.generatedLine-1,u=a.generatedColumn-1;i.consumer.eachMapping(function(l){l.generatedLine===1&&(l.generatedColumn+=u,typeof l.lastGeneratedColumn=="number"&&(l.lastGeneratedColumn+=u)),l.lastGeneratedColumn===1/0&&o&&l.generatedLine===o.generatedOffset.generatedLine&&(l.lastGeneratedColumn=o.generatedOffset.generatedColumn-2),l.generatedLine+=c,t.call(this,l)},r,n)})}computeColumnSpans(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.computeColumnSpans()}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function V5(e,t){let r=e;typeof e=="string"&&(r=ne.parseSourceMapInput(e));const n=r.sections!=null?new q5(r,t):new oc(r,t);return Promise.resolve(n)}function X5(e,t){return oc.fromSourceMap(e,t)}var Ax={};const J5=ck.SourceMapGenerator,ku=un,Z5=/(\r?\n)/,Q5=10,zo="$$$isSourceNode$$$";let tj=class B0{constructor(t,r,n,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=r??null,this.source=n??null,this.name=s??null,this[zo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,r,n){const i=new B0,s=t.split(Z5);let o=0;const a=function(){const f=p(),m=p()||"";return f+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return r.eachMapping(function(f){if(l!==null)if(c<f.generatedLine)d(l,a()),c++,u=0;else{h=s[o]||"";const m=h.substr(0,f.generatedColumn-u);s[o]=h.substr(f.generatedColumn-u),u=f.generatedColumn,d(l,m),l=f;return}for(;c<f.generatedLine;)i.add(a()),c++;u<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),u=f.generatedColumn),l=f},this),o<s.length&&(l&&d(l,a()),i.add(s.splice(o).join(""))),r.sources.forEach(function(f){const m=r.sourceContentFor(f);m!=null&&(n!=null&&(f=ku.join(n,f)),i.setSourceContent(f,m))}),i;function d(f,m){if(f===null||f.source===void 0)i.add(m);else{const p=n?ku.join(n,f.source):f.source;i.add(new B0(f.originalLine,f.originalColumn,p,m,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(r){this.add(r)},this);else if(t[zo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let r=t.length-1;r>=0;r--)this.prepend(t[r]);else if(t[zo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let r;for(let n=0,i=this.children.length;n<i;n++)r=this.children[n],r[zo]?r.walk(t):r!==""&&t(r,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let r,n;const i=this.children.length;if(i>0){for(r=[],n=0;n<i-1;n++)r.push(this.children[n]),r.push(t);r.push(this.children[n]),this.children=r}return this}replaceRight(t,r){const n=this.children[this.children.length-1];return n[zo]?n.replaceRight(t,r):typeof n=="string"?this.children[this.children.length-1]=n.replace(t,r):this.children.push("".replace(t,r)),this}setSourceContent(t,r){this.sourceContents[ku.toSetString(t)]=r}walkSourceContents(t){for(let n=0,i=this.children.length;n<i;n++)this.children[n][zo]&&this.children[n].walkSourceContents(t);const r=Object.keys(this.sourceContents);for(let n=0,i=r.length;n<i;n++)t(ku.fromSetString(r[n]),this.sourceContents[r[n]])}toString(){let t="";return this.walk(function(r){t+=r}),t}toStringWithSourceMap(t){const r={code:"",line:1,column:0},n=new J5(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){r.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&n.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:r.line,column:r.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(n.addMapping({generated:{line:r.line,column:r.column}}),s=null,i=!1);for(let h=0,d=u.length;h<d;h++)u.charCodeAt(h)===Q5?(r.line++,r.column=0,h+1===d?(s=null,i=!1):i&&n.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:r.line,column:r.column},name:l.name})):r.column++}),this.walkSourceContents(function(u,l){n.setSourceContent(u,l)}),{code:r.code,map:n}}};Ax.SourceNode=tj;var ej=Ax.SourceNode;let Tx=0;const Sx=ri,rj=["Command","lines"];class nj extends _3{constructor(){super(iv,{traceInitPerf:ri,skipValidations:!ri,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});kt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));kt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(eu)}])}));kt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));kt(this,"inline_go",this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))}));kt(this,"inline_try",this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))}));kt(this,"inline_command",this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))}));kt(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])}));kt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(vd)}));kt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Ed)}));kt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(x1)}])}));kt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(A1)}));kt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(T1),this.CONSUME(S1)}));kt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(No),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));kt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));kt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Od),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));kt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(GE),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));kt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Id),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));kt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(nu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(eu)),this.CONSUME4(No),this.CONSUME4(Nd)}}])}));kt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(nu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(No),this.CONSUME(Nd)}}])}));kt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(nu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));kt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(No),this.CONSUME(Cd),this.CONSUME(Id),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));kt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(No),this.CONSUME(Cd),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));kt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(JE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));kt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(ZE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));kt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(QE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));kt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(tv),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));kt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(ev)}));kt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(rv)}));kt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(qE)}));kt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(VE)}));kt(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(XE)}));kt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(xd),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})}));kt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Td),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})}));kt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Ad),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));kt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})}));kt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(UE)},{ALT:()=>this.CONSUME(PE)},{ALT:()=>this.CONSUME(FE)},{ALT:()=>this.CONSUME(BE)},{ALT:()=>this.CONSUME($E)},{ALT:()=>this.CONSUME(DE)}])}));kt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(xd),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})}));kt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Td),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})}));kt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Ad),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));kt(this,"arith_expr",this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])}));kt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Sd)},{ALT:()=>this.CONSUME(Rd)}]),this.SUBRULE(this.term)}));kt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));kt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(zE)},{ALT:()=>this.CONSUME(Od)},{ALT:()=>this.CONSUME(WE)},{ALT:()=>this.CONSUME(HE)}]),this.SUBRULE(this.factor)}));kt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Sd)},{ALT:()=>this.CONSUME(Rd)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])}));kt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(jE),this.SUBRULE(this.factor)})}));kt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));kt(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));kt(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(R1)},{ALT:()=>this.CONSUME(O1)}])}));kt(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(I1)},{ALT:()=>this.CONSUME(N1)},{ALT:()=>this.CONSUME(C1)},{ALT:()=>this.CONSUME(L1)},{ALT:()=>this.CONSUME(M1)},{ALT:()=>this.CONSUME(U1)},{ALT:()=>this.CONSUME(P1)},{ALT:()=>this.CONSUME(F1)},{ALT:()=>this.CONSUME(B1)}])}));kt(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME($1)},{ALT:()=>this.CONSUME(D1)},{ALT:()=>this.CONSUME(j1)},{ALT:()=>this.CONSUME(z1)},{ALT:()=>this.CONSUME(W1)},{ALT:()=>this.CONSUME(H1)},{ALT:()=>this.CONSUME(G1)},{ALT:()=>this.CONSUME(K1)},{ALT:()=>this.CONSUME(Y1)},{ALT:()=>this.CONSUME(q1)},{ALT:()=>this.CONSUME(V1)},{ALT:()=>this.CONSUME(X1)},{ALT:()=>this.CONSUME(J1)},{ALT:()=>this.CONSUME(Z1)},{ALT:()=>this.CONSUME(Q1)},{ALT:()=>this.CONSUME(tw)},{ALT:()=>this.CONSUME(ew)},{ALT:()=>this.CONSUME(rw)},{ALT:()=>this.CONSUME(nw)},{ALT:()=>this.CONSUME(iw)},{ALT:()=>this.CONSUME(sw)},{ALT:()=>this.CONSUME(ow)},{ALT:()=>this.CONSUME(aw)},{ALT:()=>this.CONSUME(cw)},{ALT:()=>this.CONSUME(lw)},{ALT:()=>this.CONSUME(uw)},{ALT:()=>this.CONSUME(fw)},{ALT:()=>this.CONSUME(hw)},{ALT:()=>this.CONSUME(dw)},{ALT:()=>this.CONSUME(pw)},{ALT:()=>this.CONSUME(mw)},{ALT:()=>this.CONSUME(gw)},{ALT:()=>this.CONSUME(yw)},{ALT:()=>this.CONSUME(_w)},{ALT:()=>this.CONSUME(bw)},{ALT:()=>this.CONSUME(ww)},{ALT:()=>this.CONSUME(Ew)},{ALT:()=>this.CONSUME(vw)},{ALT:()=>this.CONSUME(kw)},{ALT:()=>this.CONSUME(xw)},{ALT:()=>this.CONSUME(Aw)},{ALT:()=>this.CONSUME(Tw)},{ALT:()=>this.CONSUME(Sw)},{ALT:()=>this.CONSUME(Rw)},{ALT:()=>this.CONSUME(Ow)},{ALT:()=>this.CONSUME(Iw)},{ALT:()=>this.CONSUME(Nw)}])}));kt(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Hw)},{ALT:()=>this.CONSUME(Gw)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(Yw)},{ALT:()=>this.CONSUME(hE)},{ALT:()=>this.CONSUME(dE)},{ALT:()=>this.SUBRULE(this.dir_within)},{ALT:()=>this.SUBRULE(this.dir_awayby)}])}));kt(this,"dir_by",this.RULED("dir_by",()=>{this.CONSUME(Fw),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}));kt(this,"dir_at",this.RULED("dir_at",()=>{this.CONSUME(Bw),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}));kt(this,"dir_away",this.RULED("dir_away",()=>{this.CONSUME(qw),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}));kt(this,"dir_toward",this.RULED("dir_toward",()=>{this.CONSUME(Vw),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}));kt(this,"dir_find",this.RULED("dir_find",()=>{this.CONSUME(Xw),this.SUBRULE1(this.kind)}));kt(this,"dir_flee",this.RULED("dir_flee",()=>{this.CONSUME(Jw),this.SUBRULE1(this.kind)}));kt(this,"dir_to",this.RULED("dir_to",()=>{this.CONSUME(Zw),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}));kt(this,"dir_within",this.RULED("dir_within",()=>{this.CONSUME(pE),this.SUBRULE1(this.simple_token)}));kt(this,"dir_awayby",this.RULED("dir_awayby",()=>{this.CONSUME(mE),this.SUBRULE1(this.simple_token)}));kt(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(Cw)},{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.SUBRULE(this.dir_by)},{ALT:()=>this.SUBRULE(this.dir_at)},{ALT:()=>this.SUBRULE(this.dir_away)},{ALT:()=>this.SUBRULE(this.dir_toward)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Ww)},{ALT:()=>this.SUBRULE(this.dir_find)},{ALT:()=>this.SUBRULE(this.dir_flee)},{ALT:()=>this.SUBRULE(this.dir_to)},{ALT:()=>this.CONSUME(Qw)},{ALT:()=>this.CONSUME(tE)},{ALT:()=>this.CONSUME(eE)},{ALT:()=>this.CONSUME(rE)},{ALT:()=>this.CONSUME(nE)},{ALT:()=>this.CONSUME(iE)},{ALT:()=>this.CONSUME(sE)},{ALT:()=>this.CONSUME(oE)},{ALT:()=>this.CONSUME(aE)},{ALT:()=>this.CONSUME(cE)},{ALT:()=>this.CONSUME(lE)},{ALT:()=>this.CONSUME(uE)},{ALT:()=>this.CONSUME(fE)}])}));kt(this,"expr_any",this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])}));kt(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(bE),this.SUBRULE(this.expr_any)}));kt(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(wE),this.SUBRULE(this.expr_any)}));kt(this,"token_expr_blocked",this.RULED("token_expr_blocked",()=>{this.CONSUME(_E),this.SUBRULE(this.dir)}));kt(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(EE),this.SUBRULE(this.simple_token)}));kt(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(vE),this.SUBRULE(this.simple_token)}));kt(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(kE),this.SUBRULE(this.simple_token)}));kt(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(xE),this.SUBRULE(this.simple_token)}));kt(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(AE),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));kt(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(TE),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))}));kt(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(SE),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))}));kt(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(RE),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))}));kt(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME(OE),this.SUBRULE1(this.simple_token),this.AT_LEAST_ONE(()=>this.SUBRULE2(this.simple_token))}));kt(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(IE),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));kt(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(NE),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));kt(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME(CE),this.SUBRULE(this.string_token)}));kt(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(LE),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));kt(this,"token_expr",this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(gE)},{ALT:()=>this.CONSUME(yE)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])}));kt(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(Ge)},{ALT:()=>this.CONSUME(ru)}])}));kt(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(kd)},{ALT:()=>this.CONSUME(Ge)},{ALT:()=>this.CONSUME(ru)},{ALT:()=>this.SUBRULE(this.color)}])}));kt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(vd)},{ALT:()=>this.CONSUME(ru)},{ALT:()=>this.CONSUME(Ge)},{ALT:()=>this.CONSUME(kd)},{ALT:()=>this.CONSUME(ME)},{ALT:()=>{this.CONSUME(KE),this.SUBRULE(this.expr),this.CONSUME(YE)}}])}));this.performSelfAnalysis()}PEEK(r,n,...i){console.info(r,i.map(s=>[s.image,s.tokenType]),n)}RULED(r,n,i){const s=rj.some(o=>r.includes(o));return this.RULE(r,()=>{const a=(Tx++).toString().padStart(3),c=s?"font-weight: bold;":"";if(Sx&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${r} ${u.join(" ")}`,c)}n(),Sx&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${r} `,c),Tx--},i)}}const Wo=new nj;if(FI){const e=Wo.getGAstProductions(),t=I3(e);console.info(t)}const ij=Wo.getBaseCstVisitorConstructor();var It=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(It||{}),Hs=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Hs||{}),pi=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(pi||{}),xu=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(xu||{});function Ke(e,t){const[r]=e??[];return((r==null?void 0:r.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class sj extends ij{constructor(){super();kt(this,"unique",0);ri&&this.validateVisitor()}visit(r){if(he(r)&&(r=r[0]),!!w(r))return this[r.name](r.children,r.location)}createcodenode(r,n){return[{...n,...r,lineindex:0}]}createstringnode(r,n){return this.createcodenode(r,{type:12,literal:1,value:n})}createtemplatenode(r,n){return this.createcodenode(r,{type:12,literal:2,value:n})}createmarknode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:3,id:n,comment:i}))}creategotonode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:4,id:n,comment:i}))}createlinenode(r,n){return this.createcodenode(r,{type:2,stmts:n})}createapinode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:1,words:i,method:n}))}createlogicnode(r,n,i,s){return this.createlinenode(r,this.createcodenode(r,{type:14,skip:i,words:s,method:n}))}createcountnode(r){return this.createcodenode(r,{type:5,index:this.unique++})}createexprnodeondemand(r,n){return r.length===1?r[0]:this.createcodenode(n,{type:31,words:r})[0]}go(r){return Array.isArray(r)?r.map(n=>this.visit(n)).flat():w(r)?[this.visit(r)].flat():[]}program(r,n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(r.line)].flat()})}line(r){return r.stmt?this.go(r.stmt):[]}stmt(r){return r.stmt_label?this.go(r.stmt_label):r.stmt_stat?this.go(r.stmt_stat):r.stmt_text?this.go(r.stmt_text):r.stmt_comment?this.go(r.stmt_comment):r.stmt_hyperlink?this.go(r.stmt_hyperlink):r.stmt_command?this.go(r.stmt_command):r.short_go?this.go(r.short_go):r.short_try?this.go(r.short_try):[]}inline_go(r){const n=[];return r.short_go&&n.push(...this.go(r.short_go)),r.inline&&n.push(...this.go(r.inline)),n}inline_try(r){const n=[];return r.short_try&&n.push(...this.go(r.short_try)),r.inline&&n.push(...this.go(r.inline)),n}inline_command(r){const n=[];return r.stmt_command&&n.push(...this.go(r.stmt_command)),r.inline&&n.push(...this.go(r.inline)),n}inline(r){const n=[];return r.stmt_stat&&n.push(...this.go(r.stmt_stat)),r.stmt_text&&n.push(...this.go(r.stmt_text)),r.stmt_comment&&n.push(...this.go(r.stmt_comment)),r.stmt_hyperlink&&n.push(...this.go(r.stmt_hyperlink)),r.inline_go&&n.push(...this.go(r.inline_go)),r.inline_try&&n.push(...this.go(r.inline_try)),r.inline_command&&n.push(...this.go(r.inline_command)),r.structured_cmd&&n.push(...this.go(r.structured_cmd)),n}stmt_label(r,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Ke(r.token_label,":").slice(1).trim()}))}stmt_stat(r,n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Ke(r.token_stat,"@").slice(1)}))}stmt_text(r,n){const i=Ke(r.token_text,"");return this.createlinenode(n,this.createcodenode(n,{type:6,value:i}))}stmt_comment(r,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Ke(r.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(r,n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:Ke(r.token_hyperlink,"!").slice(1),text:Ke(r.token_hyperlinktext,";").slice(1)}))}stmt_command(r,n){return r.structured_cmd?this.go(r.structured_cmd):this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(r.words)}))}structured_cmd(r){return r.command_if?this.go(r.command_if):r.command_while?this.go(r.command_while):r.command_repeat?this.go(r.command_repeat):r.command_waitfor?this.go(r.command_waitfor):r.command_foreach?this.go(r.command_foreach):r.command_break?this.go(r.command_break):r.command_continue?this.go(r.command_continue):[]}short_go(r,n){return r.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:[this.go(r.string_token),this.go(r.dir)].flat()})):[]}short_try(r,n){return r.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:[this.go(r.string_token),this.go(r.dir)].flat()})):[]}command_if(r,n){const[i]=this.createlogicnode(n,Ke(r.token_if,"if").toLowerCase(),"",this.go(r.words)),[s]=this.go(r.command_if_block)??[];return this.createcodenode(n,{type:13,check:i,block:s})}command_if_block(r,n){const i=De(),s=De();return this.createcodenode(n,{type:15,skip:i,done:s,lines:[this.go(r.inline),this.go(r.line),this.creategotonode(n,s,"end of if"),this.createmarknode(n,i,"alt logic")].flat(),altlines:[this.go(r.command_else_if),this.go(r.command_else),this.createmarknode(n,s,"end of if")].flat()})}command_block(r){return[this.go(r.inline),this.go(r.line)].flat()}command_fork(r){return[this.go(r.inline),this.go(r.line)].flat()}command_else_if(r,n){const i=De(),s=De();return this.createcodenode(n,{type:16,done:s,lines:[this.createlogicnode(n,Ke(r.token_if,"if"),i,this.go(r.words)),this.go(r.command_fork),this.creategotonode(n,s,"end of if"),this.createmarknode(n,i,"skip")].flat()})}command_else(r,n){const i=[];return r.words&&i.push(...this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(r.words)}))),r.command_fork&&i.push(...this.go(r.command_fork)),this.createcodenode(n,{type:17,lines:i})}command_while(r,n){const i=De(),s=De();return this.createcodenode(n,{type:18,loop:i,done:s,lines:[this.createmarknode(n,i,"start of while"),this.createlogicnode(n,"if",s,this.go(r.words)),this.go(r.command_block),this.creategotonode(n,i,"loop of while"),this.createmarknode(n,s,"end of while")].flat()})}command_repeat(r,n){const i=De(),s=De(),a=[this.createcountnode(n),this.go(r.words)].flat();return this.createcodenode(n,{type:21,loop:i,done:s,lines:[this.createapinode(n,"repeatstart",a),this.createmarknode(n,i,"start of repeat"),this.createlogicnode(n,"repeat",s,a),this.go(r.command_block),this.creategotonode(n,i,"loop of repeat"),this.createmarknode(n,s,"end of repeat")].flat()})}command_foreach(r,n){const i=De(),s=De(),a=[this.createcountnode(n),this.go(r.words)].flat();return this.createcodenode(n,{type:23,loop:i,done:s,lines:[this.createapinode(n,"foreachstart",a),this.createmarknode(n,i,"start of foreach"),this.createlogicnode(n,"foreach",s,a),this.go(r.command_block),this.creategotonode(n,i,"loop of foreach"),this.createmarknode(n,s,"end of foreach")].flat()})}command_waitfor(r,n){const i=De();return this.createcodenode(n,{type:22,loop:i,lines:[this.createmarknode(n,i,"start of waitfor"),this.createlogicnode(n,"waitfor",i,this.go(r.words))].flat()})}command_break(r,n){return this.createcodenode(n,{type:19,goto:0})}command_continue(r,n){return this.createcodenode(n,{type:20,goto:0})}command_play(r,n){const i=Ke(r.token_command_play,"").trim(),[s,...o]=i.split(" ");return[this.createstringnode(n,s),this.createstringnode(n,o.join(" "))].flat()}command_toast(r,n){const s=Ke(r.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(n,"toast"),this.createtemplatenode(n,s)].flat()}command_ticker(r,n){const s=Ke(r.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(n,"ticker"),this.createtemplatenode(n,s)].flat()}expr(r,n){return r.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}and_test(r,n){return r.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}not_test(r,n){return r.comparison?this.go(r.comparison):r.LHS?this.createcodenode(n,{type:26,items:this.go(r.LHS)}):[]}comparison(r,n){if(r.RHS){const[i]=this.go(r.comp_op);return this.createcodenode(n,{type:27,compare:i,lhs:this.createexprnodeondemand(this.go(r.LHS),n),rhs:this.createexprnodeondemand(this.go(r.RHS),n)})}return this.go(r.LHS)}comp_op(r,n){return r.token_iseq?this.createcodenode(n,{type:28,method:0}):r.token_isnoteq?this.createcodenode(n,{type:28,method:1}):r.token_islessthan?this.createcodenode(n,{type:28,method:2}):r.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):r.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):r.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(r,n){return r.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}and_test_value(r,n){return r.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}not_test_value(r,n){return r.arith_expr?this.go(r.arith_expr):r.LHS?this.createcodenode(n,{type:26,items:this.go(r.LHS)}):[]}arith_expr(r,n){if(r.LHS)return this.go(r.LHS);const i=this.go(r.term);return r.RHS?this.createcodenode(n,{type:29,lhs:i[0],items:this.go(r.RHS)}):i}arith_expr_item(r,n){return this.createcodenode(n,{type:30,operator:r.token_plus?1:2,rhs:this.go(r.term)[0]})}term(r,n){return r.term_item?this.createcodenode(n,{type:29,lhs:this.go(r.factor)[0],items:this.go(r.term_item)}):this.go(r.factor)}term_item(r,n){let i=0;return r.token_multiply&&(i=4),r.token_divide&&(i=5),r.token_moddivide&&(i=6),r.token_floordivide&&(i=7),this.createcodenode(n,{type:30,operator:i,rhs:this.go(r.factor)[0]})}factor(r,n){if(r.power)return this.go(r.power);let i=0;return r.token_plus&&(i=8),r.token_minus&&(i=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:i,rhs:this.go(r.LHS)[0]})})}power(r,n){const i=this.go(r.token);return r.factor?this.createcodenode(n,{type:29,lhs:i[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(r.factor)[0]})}):i}words(r){return this.go(r.expr)}kind(r){return[this.go(r.color),this.go(r.string_token)].flat()}category(r,n){return r.token_isterrain?this.createcodenode(n,{type:12,literal:1,value:"isterrain"}):r.token_isobject?this.createcodenode(n,{type:12,literal:1,value:"isobject"}):[]}collision(r,n){return r.token_iswalkable?this.createcodenode(n,{type:12,literal:1,value:"iswalkable"}):r.token_iswalking?this.createcodenode(n,{type:12,literal:1,value:"iswalking"}):r.token_iswalk?this.createcodenode(n,{type:12,literal:1,value:"iswalk"}):r.token_isswimmable?this.createcodenode(n,{type:12,literal:1,value:"isswimmable"}):r.token_isswimming?this.createcodenode(n,{type:12,literal:1,value:"isswimming"}):r.token_isswim?this.createcodenode(n,{type:12,literal:1,value:"isswim"}):r.token_issolid?this.createcodenode(n,{type:12,literal:1,value:"issolid"}):r.token_isbullet?this.createcodenode(n,{type:12,literal:1,value:"isbullet"}):r.token_isghost?this.createcodenode(n,{type:12,literal:1,value:"isghost"}):[]}color(r,n){let i="ERROR";return r.token_black&&(i="black"),r.token_dkblue&&(i="dkblue"),r.token_dkgreen&&(i="dkgreen"),r.token_dkcyan&&(i="dkcyan"),r.token_dkred&&(i="dkred"),r.token_dkpurple&&(i="dkpurple"),r.token_dkyellow&&(i="dkyellow"),r.token_ltgray&&(i="ltgray"),r.token_dkgray&&(i="dkgray"),r.token_blue&&(i="blue"),r.token_green&&(i="green"),r.token_cyan&&(i="cyan"),r.token_red&&(i="red"),r.token_purple&&(i="purple"),r.token_yellow&&(i="yellow"),r.token_white&&(i="white"),r.token_brown&&(i="brown"),r.token_dkwhite&&(i="dkwhite"),r.token_ltgrey&&(i="ltgrey"),r.token_gray&&(i="gray"),r.token_grey&&(i="grey"),r.token_dkgrey&&(i="dkgrey"),r.token_ltblack&&(i="ltblack"),r.token_onblack&&(i="onblack"),r.token_ondkblue&&(i="ondkblue"),r.token_ondkgreen&&(i="ondkgreen"),r.token_ondkcyan&&(i="ondkcyan"),r.token_ondkred&&(i="ondkred"),r.token_ondkpurple&&(i="ondkpurple"),r.token_ondkyellow&&(i="ondkyellow"),r.token_onltgray&&(i="onltgray"),r.token_ondkgray&&(i="ondkgray"),r.token_onblue&&(i="onblue"),r.token_ongreen&&(i="ongreen"),r.token_oncyan&&(i="oncyan"),r.token_onred&&(i="onred"),r.token_onpurple&&(i="onpurple"),r.token_onyellow&&(i="onyellow"),r.token_onwhite&&(i="onwhite"),r.token_onbrown&&(i="onbrown"),r.token_ondkwhite&&(i="ondkwhite"),r.token_onltgrey&&(i="onltgrey"),r.token_ongray&&(i="ongray"),r.token_ongrey&&(i="ongrey"),r.token_ondkgrey&&(i="ondkgrey"),r.token_onltblack&&(i="onltblack"),r.token_onclear&&(i="onclear"),this.createcodenode(n,{type:12,literal:1,value:i})}dir_mod(r,n){if(r.dir_within)return this.go(r.dir_within);if(r.dir_awayby)return this.go(r.dir_awayby);let i="ERROR";return r.token_cw&&(i="cw"),r.token_ccw&&(i="ccw"),r.token_opp&&(i="opp"),r.token_rndp&&(i="rndp"),r.token_over&&(i="over"),r.token_under&&(i="under"),this.createcodenode(n,{type:12,literal:1,value:i})}dir_by(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"by"}),...this.go(r.simple_token)]}dir_at(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"at"}),...this.go(r.simple_token)]}dir_away(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"away"}),...this.go(r.simple_token)]}dir_toward(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"toward"}),...this.go(r.simple_token)]}dir_find(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"find"}),...this.go(r.kind)]}dir_flee(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"flee"}),...this.go(r.kind)]}dir_to(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"to"}),...this.go(r.dir)]}dir_within(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"within"}),...this.go(r.simple_token)]}dir_awayby(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"awayby"}),...this.go(r.simple_token)]}dir(r,n){const i=this.go(r.dir_mod)??[];return r.token_i&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"i"})),r.token_idle&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"idle"})),r.token_n&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"n"})),r.token_u&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"u"})),r.token_north&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"north"})),r.token_up&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"up"})),r.token_s&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"s"})),r.token_d&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"d"})),r.token_south&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"south"})),r.token_down&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"down"})),r.token_w&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"w"})),r.token_l&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"l"})),r.token_west&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"west"})),r.token_left&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"left"})),r.token_e&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"e"})),r.token_r&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"r"})),r.token_east&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"east"})),r.token_right&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"right"})),r.token_rnd&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rnd"})),r.token_rndne&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rndne"})),r.token_rndns&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rndns"})),r.token_flow&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"flow"})),r.token_seek&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"seek"})),r.dir_by&&i.push(...this.go(r.dir_by)),r.dir_at&&i.push(...this.go(r.dir_at)),r.dir_away&&i.push(...this.go(r.dir_away)),r.dir_toward&&i.push(...this.go(r.dir_toward)),r.dir_find&&i.push(...this.go(r.dir_find)),r.dir_flee&&i.push(...this.go(r.dir_flee)),r.dir_to&&i.push(...this.go(r.dir_to)),i.flat()}expr_any(r){return[this.go(r.dir),this.go(r.kind),this.go(r.color)].flat()}token_expr_any(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"any"}),this.go(r.expr_any)].flat()}token_expr_count(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"countof"}),this.go(r.expr_any)].flat()}token_expr_blocked(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"blocked"}),this.go(r.dir)].flat()}token_expr_abs(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"abs"}),...this.go(r.simple_token)]}token_expr_intceil(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intceil"}),...this.go(r.simple_token)]}token_expr_intfloor(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intfloor"}),...this.go(r.simple_token)]}token_expr_intround(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intround"}),...this.go(r.simple_token)]}token_expr_clamp(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"clamp"}),...this.go(r.simple_token)]}token_expr_min(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"min"}),...this.go(r.simple_token)]}token_expr_max(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"max"}),...this.go(r.simple_token)]}token_expr_pick(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pick"}),...this.go(r.simple_token)]}token_expr_pickwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pickwith"}),...this.go(r.simple_token)]}token_expr_random(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"random"}),...this.go(r.simple_token)]}token_expr_randomwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"randomwith"}),...this.go(r.simple_token)]}token_expr_run(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"run"}),...this.go(r.string_token)]}token_expr_runwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"runwith"}),...this.go(r.simple_token),...this.go(r.string_token)]}token_expr(r,n){return r.token_expr_aligned?this.createcodenode(n,{type:12,literal:1,value:"aligned"}):r.token_contact?this.createcodenode(n,{type:12,literal:1,value:"contact"}):r.token_expr_any?this.go(r.token_expr_any):r.token_expr_count?this.go(r.token_expr_count):r.token_expr_blocked?this.go(r.token_expr_blocked):r.token_expr_abs?this.go(r.token_expr_abs):r.token_expr_intceil?this.go(r.token_expr_intceil):r.token_expr_intfloor?this.go(r.token_expr_intfloor):r.token_expr_intround?this.go(r.token_expr_intround):r.token_expr_clamp?this.go(r.token_expr_clamp):r.token_expr_min?this.go(r.token_expr_min):r.token_expr_max?this.go(r.token_expr_max):r.token_expr_pick?this.go(r.token_expr_pick):r.token_expr_pickwith?this.go(r.token_expr_pickwith):r.token_expr_random?this.go(r.token_expr_random):r.token_expr_randomwith?this.go(r.token_expr_randomwith):r.token_expr_run?this.go(r.token_expr_run):r.token_expr_runwith?this.go(r.token_expr_runwith):[]}string_token(r,n){if(r.token_stringliteraldouble){const i=Ke(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Ke(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}return[]}simple_token(r,n){if(r.token_stringliteraldouble){const i=Ke(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Ke(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Ke(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}return r.color?this.go(r.color):[]}token(r,n){if(r.category)return this.go(r.category);if(r.collision)return this.go(r.collision);if(r.color)return this.go(r.color);if(r.dir)return this.go(r.dir);if(r.command_play)return this.go(r.command_play);if(r.command_toast)return this.go(r.command_toast);if(r.command_ticker)return this.go(r.command_ticker);if(r.token_label){const i=Ke(r.token_label,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_stringliteraldouble){const i=Ke(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Ke(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Ke(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}if(r.token_lparen)return[this.createexprnodeondemand(this.go(r.expr),n)];if(r.token_stop){const i=Ke(r.token_stop,"");return this.createcodenode(n,{type:12,literal:1,value:i})}return[]}}const oj=new sj,Xr={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Au="zss.js";function ue(e,t){return new ej(e.startLine??1,e.startColumn??1,Au,t)}function l0(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Tu(e){return`'${l0(e)}'`}function u0(e){const t=Gd(e);return t.errors.length?e:`['${t.tokens.map(n=>{if(n.tokenType===Wd){const i=l0(n.image.substring(1));return zt(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return l0(n.image)}).join("")}'].join('')`}function ac(e){return e.filter(t=>t!==void 0).map(pe)}function Rx(e){return ue(e,"")}function aj(e,t){const r=[];return e.forEach(n=>{r.push(n,t)}),r.pop(),r}function or(e,t,r){return ue(e,[`api.${t}(`,...aj(r,", "),")"])}function cj(e){if(e.type===It.COMPARE&&e.compare.type===It.COMPARE_ITEM)switch(e.compare.method){case Hs.IS_EQ:return or(e,"isEq",[pe(e.lhs),pe(e.rhs)]);case Hs.IS_NOT_EQ:return or(e,"isNotEq",[pe(e.lhs),pe(e.rhs)]);case Hs.IS_LESS_THAN:return or(e,"isLessThan",[pe(e.lhs),pe(e.rhs)]);case Hs.IS_GREATER_THAN:return or(e,"isGreaterThan",[pe(e.lhs),pe(e.rhs)]);case Hs.IS_LESS_THAN_OR_EQ:return or(e,"isLessThanOrEq",[pe(e.lhs),pe(e.rhs)]);case Hs.IS_GREATER_THAN_OR_EQ:return or(e,"isGreaterThanOrEq",[pe(e.lhs),pe(e.rhs)])}return ue(e,"")}function Gs(e,t,r){return e.prepend(`api.${t}(`),e.add([", ",pe(r),")"])}function Ox(e,t,r){return e.prepend(`api.${t}(`),e.add([pe(r),")"])}function lj(e,t){if(e.type===It.OPERATOR_ITEM)switch(e.operator){case pi.PLUS:return Gs(t,"opPlus",e.rhs);case pi.MINUS:return Gs(t,"opMinus",e.rhs);case pi.POWER:return Gs(t,"opPower",e.rhs);case pi.MULTIPLY:return Gs(t,"opMultiply",e.rhs);case pi.DIVIDE:return Gs(t,"opDivide",e.rhs);case pi.MOD_DIVIDE:return Gs(t,"opModDivide",e.rhs);case pi.FLOOR_DIVIDE:return Gs(t,"opFloorDivide",e.rhs);case pi.UNI_PLUS:return Ox(t,"opUniPlus",e.rhs);case pi.UNI_MINUS:return Ox(t,"opUniMinus",e.rhs)}return ue(e,"")}function uj(e){if(e.type===It.OPERATOR){const t=e.lhs?pe(e.lhs):ue(e,"");return e.items.forEach(r=>lj(r,t)),t}return ue(e,"")}function Su(e,t){return ue(e,[or(e,"jump",[`${t}`]),"; continue;"])}function Bi(e){return Xr.linelookup[e??""]??-1}function f0(e,t){Xr.linelookup[e]=t}function Ho(e,t,r){for(let n=0;n<e.length;++n){const i=e[n];switch(i.type){case It.WHILE:case It.REPEAT:case It.FOREACH:case It.ELSE_IF:i.type===t&&(i.done=r);break;case It.IF_BLOCK:case It.IF_CHECK:i.type===t&&(i.skip=r);break;case It.LINE:Ho(i.stmts,t,r);break}}}function Ix(e,t,r){for(let n=0;n<e.length;++n){const i=e[n];switch(i.type){case It.WHILE:case It.REPEAT:case It.FOREACH:case It.ELSE_IF:i.type===t&&f0(i.done,r);break;case It.IF_BLOCK:case It.IF_CHECK:i.type===t&&f0(i.skip,r);break;case It.LINE:Ix(i.stmts,t,r);break}}}function pe(e){var t;switch(e.type){case It.PROGRAM:return ue(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(pe).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Au}`]);case It.API:return ue(e,["  ",or(e,e.method,ac(e.words)),`;
`]);case It.LINE:return ue(e,[`case ${e.lineindex}:
`,...e.stmts.map(pe).flat(),`  break;
`]);case It.MARK:return ue(e,`  // ${e.comment}
`);case It.GOTO:{const r=Bi(e.id);return ue(e,["  ",Su(e,r),`
`])}case It.COUNT:return ue(e,`${e.index}`);case It.LITERAL:switch(e.literal){case xu.NUMBER:return ue(e,`${e.value}`);case xu.STRING:return ue(e,Tu(e.value));case xu.TEMPLATE:return ue(e,u0(e.value))}return Rx(e);case It.TEXT:return ue(e,["  ",or(e,"text",[u0(e.value)]),`;
`]);case It.STAT:if(Xr.isfirststat){Xr.isfirststat=!1;const r=e.value.trim().split(" ").map(Tu);return ue(e,["  ",or(e,"stat",r),`;
`])}return ue(e,`  // skipped ${e.value}
`);case It.LABEL:{const r=zt(e.name),n=e.active?"label":"comment";Xr.labels[r]||(Xr.labels[r]=[]);const i=(e.active?1:-1)*e.lineindex;return Xr.labels[r].push(i),ue(e,`  // ${i} '${r}' ${n}
`)}case It.HYPERLINK:return ue(e,["  ",or(e,"hyperlink",[u0(e.text),...e.link.split(" ").filter(r=>r.length>0).map(Tu)]),`;
`]);case It.MOVE:{const r=or(e,"command",[Tu("go"),ac(e.words)].flat());return e.wait?ue(e,["  if (",r,`) { continue; };
`]):ue(e,["  ",r,`;
`])}case It.COMMAND:return ue(e,["  if (",or(e,"command",ac(e.words)),`) { continue; };
`]);case It.IF:{const r=((t=e.block)==null?void 0:t.type)===It.IF_BLOCK?e.block:void 0;if(w(r)){Ho([e.check],It.IF_CHECK,r.skip);const n=ue(e,pe(e.check));return r.lines.forEach(i=>n.add(pe(i))),Ix(r.altlines,It.ELSE_IF,Bi(r.done)),r.altlines.forEach(i=>n.add(pe(i))),n}return ue(e,pe(e.check))}case It.IF_CHECK:{const r=Bi(e.skip);return r===-1?ue(e,["  ",or(e,e.method,ac(e.words)),`;
`]):ue(e,["  if (!",or(e,e.method,ac(e.words)),") { ",Su(e,r),` }
`])}case It.ELSE_IF:case It.ELSE:{const r=ue(e,"");return e.lines.forEach(n=>r.add(pe(n))),r}case It.WHILE:{const r=Bi(e.loop),n=Bi(e.done),i=ue(e,"");return Ho(e.lines,It.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case It.BREAK:s.goto=n;break;case It.CONTINUE:s.goto=r;break}i.add(pe(s))}),i}case It.REPEAT:{const r=Bi(e.loop),n=Bi(e.done),i=ue(e,"");return Ho(e.lines,It.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case It.BREAK:s.goto=n;break;case It.CONTINUE:s.goto=r;break}i.add(pe(s))}),i}case It.WAITFOR:{const r=ue(e,"");return Ho(e.lines,It.IF_CHECK,e.loop),e.lines.forEach(n=>{r.add(pe(n))}),r}case It.FOREACH:{const r=Bi(e.loop),n=Bi(e.done),i=ue(e,"");return Ho(e.lines,It.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case It.BREAK:s.goto=n;break;case It.CONTINUE:s.goto=r;break}i.add(pe(s))}),i}case It.BREAK:return ue(e,["  ",Su(e,e.goto),`
`]);case It.CONTINUE:return ue(e,["  ",Su(e,e.goto),`
`]);case It.OR:return or(e,"or",e.items.map(pe));case It.AND:return or(e,"and",e.items.map(pe));case It.NOT:return or(e,"not",e.items.map(pe));case It.COMPARE:return cj(e);case It.OPERATOR:return uj(e);case It.EXPR:return or(e,"expr",e.words.map(pe));default:return console.error("<unsupported node>",e.type,e),Rx(e)}}function mi(e){if(w(e))switch(e.type===It.LINE&&++Xr.lineindex,e.lineindex=Xr.lineindex,e.type){case It.PROGRAM:e.lines.forEach(mi);break;case It.LINE:e.stmts.forEach(mi);break;case It.MARK:f0(e.id,e.lineindex);break;case It.IF:mi(e.check),mi(e.block);break;case It.IF_BLOCK:e.lines.forEach(mi),e.altlines.forEach(mi);break;case It.ELSE_IF:e.lines.forEach(mi);break;case It.ELSE:case It.WHILE:case It.REPEAT:case It.FOREACH:case It.WAITFOR:e.lines.forEach(mi);break;case It.MOVE:case It.COMMAND:case It.IF_CHECK:e.words.forEach(mi);break}}function fj(e){Xr.labels={},Xr.internal=1,Xr.lineindex=0,Xr.isfirststat=!0,mi(e)}function hj(e){return fj(e),{...pe(e).toStringWithSourceMap({file:`${Au}.map`}),...Xr}}function Nx(e){return he(e)?e.length>0?1:0:e??0}function dj(e){return`${e}_chip`}function Cx(e=""){return`vm:${e??""}`}function pj(e,t,r){var u;const n=dj(e),i=Rn(n);let s;const o=Nn(Object.entries(r.labels??{}));(!he(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=r.errors)==null?void 0:u.length)??0)!==0?1:0);function a(l,h){k.words=h;const d=U4(t,l);return w(d)?d(c,h):l!=="send"?a("shortsend",[l,...h]):0}const c={halt(){Rj(n)},id(){return e},set(l,h){const[d,f]=F4(t,c,l,h);if(d)return f},get(l){const[h,d]=P4(t,c,l);if(h)return d},tick(l){const h=xt(i.ps)?i.ps:0,d=h%l===0;if(i.ps=h+1,d===!1)return!1;B4(t,c);const f=c.shouldtick();if(f){i.lc=0,i.ys=0,k.get=c.get;try{s!=null&&s(c)||(i.es=1)}catch(m){ye(lt,k.elementfocus,"crash",m.message),i.es=1}}return $4(t,c),f},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return xt(i.lc)?++i.lc>As.HALT_AT_COUNT:!0},haslabel(l){if(he(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l)return(f.find(p=>xt(p)&&p>0)??0)>0}return!1},hm(){if(he(i.mg)&&he(i.lb)){const[l]=i.mg;if(w(l))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l)return f.find(m=>xt(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.shouldhalt()},send(l,h,d,f){lt.emit(l,`${Cx(h)}:${d}`,f)},lock(l){i.lk=l},unlock(){i.lk=""},message(l){i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(he(i.lb))for(let h=0;h<i.lb.length;++h){const d=i.lb[h];if(d[0]===l){const f=d[1].findIndex(m=>m>0);if(f>=0&&w(d[1])){d[1][f]*=-1;break}}}},restore(l){if(he(i.lb))for(let h=0;h<i.lb.length;++h){const d=i.lb[h];if(d[0]===l)for(let f=0;f<d[1].length;f++)d[1][f]=Math.abs(d[1][f])}},getcase(){i.ec=xt(i.ec)?i.ec:1;const l=c.hm();if(l&&he(i.mg)){const[,h,d,f]=i.mg;c.set("sender",d),w(h)&&c.set("arg",h),f&&(c.set("player",f),k.elementfocus=f),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=xt(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const h=AI.parse(l),[d]=h.filter(f=>f.fileName===Au);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},command(...l){if(l.length===0)return 0;const[h,...d]=l;return a(zt(Re(h)),d)},if(...l){const[h,d]=ft(l,0,[J.ANY]),f=Nx(h);return f&&d<l.length&&c.command(...l.slice(d)),f?1:0},try(...l){const[,h]=ft(l,0,[J.DIR]),d=c.command("go",...l);return d&&h<l.length&&c.command(...l.slice(h)),d?1:0},take(...l){const[h,d,f]=ft(l,0,[J.NAME,J.ANY]),m=xt(d),p=m?f:1,g=c.get(h),y=m?d:1;if(!xt(g))return p<l.length&&c.command(...l.slice(p)),1;const b=g-y;return b<0?(p<l.length&&c.command(...l.slice(p)),1):(c.set(h,b),0)},give(...l){const[h,d,f]=ft(l,0,[J.NAME,J.ANY]),m=xt(d),p=m?f:1,g=c.get(h),y=m?d:1,b=g===void 0?1:0;return b&&p<l.length&&c.command(...l.slice(p)),c.set(h,Ea(g,0)+y),b},duplicate(...l){return c.command("duplicate",...l)},repeatstart(l,...h){const[d,f]=ft(h,0,[J.NUMBER]),m=`repeatcount${l}`,p=`repeatwords${l}`;i[m]=d,i[p]=f<h.length?h.slice(f):void 0},repeat(l){const h=`repeatcount${l}`,d=`repeatwords${l}`;if(!xt(i[h]))return 0;const f=i[h];i[h]=f-1;const m=f>0,p=i[d];return m&&he(p)&&c.command(...p),m?1:0},foreachstart(l,...h){const[d,f,m,p]=ft(h,0,[J.NAME,J.NUMBER,J.NUMBER,J.MAYBE_NUMBER]);let g=Math.min(f,m),y=Math.max(f,m);const b=(p??0)||1;if(b<0){const S=g;g=y,y=S}return c.set(d,g-b),0},foreach(l,...h){const[d,f,m,p,g]=ft(h,0,[J.NAME,J.NUMBER,J.NUMBER,J.MAYBE_NUMBER]);let y=Math.min(f,m),b=Math.max(f,m);const S=(p??0)||1;if(S<0){const N=y;y=b,b=N}let T=c.get(d);!xt(T)||T<y||T>b?T=y:T+=S;const x=T<=b?1:0;return x&&(c.set(d,T),g<h.length&&c.command(...h.slice(g))),x},waitfor(...l){const[h]=ft(l,0,[J.ANY]),d=Nx(h);return d||c.yield(),d?1:0},or(...l){let h=0;for(let d=0;d<l.length;){const[f,m]=ft(l,d,[J.ANY]);if(h=f,h)break;d=m}return h},and(...l){let h=0;for(let d=0;d<l.length;){const[f,m]=ft(l,d,[J.ANY]);if(h=f,!h)break;d=m}return h},not(...l){const[h]=ft(l,0,[J.ANY]);return h?0:1},expr(...l){const[h]=ft(l,0,[J.ANY]);return h},isEq(l,h){const[d]=ft([l],0,[J.ANY]),[f]=ft([h],0,[J.ANY]);return typeof d=="object"||typeof f=="object"?fT(d,f)?1:0:d===f?1:0},isNotEq(l,h){return this.isEq(l,h)?0:1},isLessThan(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return d<f?1:0},isGreaterThan(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return d>f?1:0},isLessThanOrEq(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return d<=f?1:0},isGreaterThanOrEq(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return d>=f?1:0},opPlus(l,h){const[d]=ft([l],0,[J.ANY]),[f]=ft([h],0,[J.ANY]);return d+f},opMinus(l,h){const[d]=ft([l],0,[J.ANY]),[f]=ft([h],0,[J.ANY]);return d-f},opPower(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return Math.pow(d,f)},opMultiply(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return d*f},opDivide(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return d/f},opModDivide(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return d%f},opFloorDivide(l,h){const[d]=ft([l],0,[J.NUMBER]),[f]=ft([h],0,[J.NUMBER]);return Math.floor(d/f)},opUniPlus(l){const[h]=ft([l],0,[J.NUMBER]);return+h},opUniMinus(l){const[h]=ft([l],0,[J.NUMBER]);return-h}};return s=r.code,c}function h0(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(r=>{if(r!=="parent"){const n=e[r];he(n)?n.forEach(i=>{t.push(h0(i))}):t.push(h0(n))}}),e.range={start:Math.min(...t.filter(r=>r).map(r=>(r==null?void 0:r.start)??0)),end:Math.max(...t.filter(r=>r).map(r=>(r==null?void 0:r.end)??0))},e.range}function mj(e){const t=sv(`${e}
`);if(t.errors.length>0)return t;Wo.input=t.tokens;const r=Wo.program();if(Wo.errors.length>0)return{tokens:t.tokens,errors:Wo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[n]=oj.go(r);return n?(h0(n),{tokens:t.tokens,cst:r,ast:n}):{tokens:t.tokens,cst:r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}function gj(e,t){const r=`compile-${e}`;console.time(r);const n=mj(t);if(console.timeEnd(r),xy&&console.info(t,n.errors),n.errors&&n.errors.length>0)return console.info(t,n.tokens,n.errors),n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=hj(n.ast);if(i.code){xy&&console.info(i.code);try{return{...n,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...n,...i,source:"",code:new Function("api"," ")}}function yj(){const e={},t={};function r(i,s){const o=e[s];if(o)return o;const a=gj(i,s);return e[s]=a,a}const n={ids(){return Object.keys(t)},isended(i){const s=t[i];return w(s)?s.isended():!0},halt(i){const s=t[i];return w(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=n.ids();for(let s=0;s<i.length;++s)n.isended(i[s])&&n.halt(i[s])},arg(i,s){const o=t[i];w(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!w(t[i])){const h=r(a,c);if(u=t[i]=pj(i,s,h),(l=h.errors)!=null&&l.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((T,x)=>[T,x]),p=m.slice(f-2,f);for(let T=0;T<p.length;++T){const[x,N]=p[T];ye(lt,Pr(),"build",`$grey${N+1} $grey${x}`)}const[g,y]=m[f]??[];if(_t(g)&&w(y)){const T=(d.column??1)-1,x=T+d.length,N=T<g.length?g:`${g}*`,R=N.substring(0,T),B=N.substring(T,x),M=N.substring(x);ye(lt,Pr(),"build",`$red${y+1} $grey${R}$red${B}$grey${M}`)}const b=m.slice(f+1,f+3);for(let T=0;T<b.length;++T){const[x,N]=b[T];ye(lt,Pr(),"build",`$grey${N+1} $grey${x}`)}const S=d.message.split(`
`).slice(0,4).join(" ");return ye(lt,Pr(),"build",S),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=n.tick(i,s,1,o,a);return n.halt(i)&&c},message(i){const{target:s,path:o}=Dr(i.target),a=t[s];if(w(a)){const c={...i,target:o};a.message(c)}}};return n}const Rr=new ga,Ur={},Ru={};function Lx(e,t,r,n,i,s=0){const o=`tiles:${e}:${t}`;return w(Ur[o])||(Ur[o]=RI(e,t,r,n,i,s)),Ur[o]}function Mx(e,t,r,n){const i=`sprites:${e}:${t}:${r}`,s=`sprite:${e}:${t}:${n}`;return w(Ru[s])||(Ru[s]=OI(e,t,r)),Ru[s].id=i,Ru[s]}function _j(e,t){const r=`sprites:${e}:${t}`;return w(Ur[r])||(Ur[r]=II(e,t)),Ur[r]}function bj(e,t,r,n,i=0){const s=`dither:${e}:${t}`;return w(Ur[s])||(Ur[s]=NI(e,t,r,n,i)),Ur[s]}function Ou(e,t,r,n){const i=`media:${e}:${t}`;w(Ur[i])||(Ur[i]=CI(e,t,r,n));const s=Ur[i];return s.mime=r,s.media=n,s}function wj(e,t){const r=`control:${e}:${t}`;return w(Ur[r])||(Ur[r]=LI(e,t)),Ur[r]}const ss=3;function Ux(e,t){const r=[],n=(e.x+.5)*ks,i=(e.y+.5)*xs,s=t.x*ks,o=t.y*xs,a=s-n,c=o-i;Rr.x=a-ss,Rr.y=c-ss,r.push(Rr.angle()),Rr.x=a+ks+ss,Rr.y=c-ss,r.push(Rr.angle()),Rr.x=a-ss,Rr.y=c+xs+ss,r.push(Rr.angle()),Rr.x=a+ks+ss,Rr.y=c+xs+ss,r.push(Rr.angle());const u=r.map(f=>Math.round(fy(f))),l=Math.min(...u),h=Math.max(...u);if(h-l>180){const f=u.filter(y=>y<180),m=u.filter(y=>y>180),p=Math.max(...f);return[Math.min(...m),p]}return[l,h]}function Iu(e,t,r,n,i,s,o,a,c){var S;const u={x:a,y:c},l=$i(e,u);if(l===-1)return;Rr.x=a-i.x,Rr.y=Math.round((c-i.y)*1.333);const h=Rr.length();if(h>s)return;const d=Math.round(fy(Rr.angle()));let f=0;for(let T=0;T<r.length;++T){const[x,N,R]=r[T];x>N?(d>=x||d<=N)&&(f=Math.max(f,R)):d>=x&&d<=N&&(f=Math.max(f,R))}const m=s*.5;t[l]=Math.min(t[l],f+(h<m?0:(h-m)*o)),t[l]=ze(t[l],0,1);const p=Or(e,((S=e.lookup)==null?void 0:S[l])??"");if(w(p)){const T=[...Ux(i,u),.25];n.push(T)}const g=e.terrain[l],y=Sn(g),b=(g==null?void 0:g.collision)??(y==null?void 0:y.collision);if(lc(Wt.ISBULLET,b)){const T=[...Ux(i,u),1];n.push(T)}}function d0(e,t,r,n,i,s){if(!w(r)||!w(r.terrain)||!w(r.objects))return[];const o=[];let a=t;const c=Nt,u=Qt,l=s?Kt.BLACK:Kt.ONCLEAR,h=Lx(e,a++,"terrain",c,u,l);o.push(h);const d=a++,f=_j(e,d);f.sprites=[],o.push(f);const m=r.isdark?1:0,p=bj(e,a++,c,u,m);o.push(p),p.alphas.fill(m);const g=Lx(e,a++,"tickers",c,u,Kt.ONCLEAR);o.push(g),g.char.fill(0);const y={...Kd(Nt,Qt,n,Kt.ONCLEAR),...g},b=wj(e,a++);if(i){o.push(b);const{graphics:B,camera:M,facing:H}=Rn(e),V=r.graphics??B??"",O=r.camera??M??"",I=r.facing??H??"";if(_t(V)){const v=zt(V);switch(v){case"fpv":case"iso":case"flat":case"mode7":b.graphics=v;break;default:b.graphics="flat";break}}if(_t(O))switch(zt(O)){default:case"mid":b.viewscale=il.MID;break;case"near":b.viewscale=il.NEAR;break;case"far":b.viewscale=il.FAR;break}xt(I)&&(b.facing=uy(I%360))}for(let B=0;B<r.terrain.length;++B){const M=r.terrain[B],H=dr(M,0,Kt.WHITE,s?Kt.BLACK:Kt.ONCLEAR),V=Gt(M,"collision");h.char[B]=H.char,h.color[B]=H.color,h.bg[B]=H.bg,h.wall[B]=V===Wt.ISSOLID?1:0}const S=Object.values(r.objects??{}),T=new Set;for(let B=0;B<S.length;++B){const M=S[B];br(M.id)&&xt(M.x)&&xt(M.y)&&T.add(jr(M,Nt))}for(let B=0;B<S.length;++B){const M=S[B],H=Gt(M,"collision");if(w(M.removed)||H===Wt.ISGHOST)continue;const V=M.id??"";if(br(V)===!1&&xt(M.x)&&xt(M.y)&&T.has(jr(M,Nt))===!0)continue;const O=dr(M),I=Mx(e,d,V,B);if(I.x=M.x??0,I.y=M.y??0,I.char=O.char,I.color=O.color,I.bg=O.bg,f.sprites.push(I),m){if(O.light>0){const v=$i(r,I),L=ze(Math.round(O.light),1,Qt),z=1/(L*.5);if(p.alphas[v]=0,L>1){const U=[];for(let Y=1;Y<=L;++Y){if(Y===2){const W=Gt(M,"lightdir");if(on(W)){const P=Yo(r,M,"",W,I);switch(Fn(I,P.destpt)){case bt.EAST:U.push([45,315,1]);break;case bt.WEST:U.push([225,135,1]);break;case bt.NORTH:U.push([315,225,1]);break;case bt.SOUTH:U.push([135,45,1]);break}}}const X=[];for(let W=I.y-Y;W<=I.y+Y;++W)Iu(r,p.alphas,U,X,I,L,z,I.x-Y,W),Iu(r,p.alphas,U,X,I,L,z,I.x+Y,W);const K=Y-1;for(let W=I.x-K;W<=I.x+K;++W)Iu(r,p.alphas,U,X,I,L,z,W,I.y-Y),Iu(r,p.alphas,U,X,I,L,z,W,I.y+Y);for(let W=0;W<X.length;++W){const P=X[W];let ot=0;for(ot=0;ot<U.length;++ot){const G=U[ot];if(G[1]>G[0]&&P[1]>=G[0]&&P[0]<=G[1]&&P[2]>=1&&G[2]>=1){U[ot]=[Math.min(P[0],G[0]),Math.max(P[1],G[1]),1];break}}ot===U.length&&U.push(P)}}}}else if(br(V)){const v=$i(r,I);p.alphas[v]=0}}V===e&&(b.focusx=I.x,b.focusy=I.y,b.focusid=V)}for(let B=0;B<S.length;++B){const M=S[B],H=Gt(M,"collision");if(w(M.removed)||H!==Wt.ISGHOST)continue;const V=M.id??"",O=dr(M),I=Mx(e,d,V,B);I.x=M.x??0,I.y=M.y??0,I.char=O.char,I.color=O.color,I.bg=O.bg,f.sprites.push(I)}for(let B=0;B<S.length;++B){const M=S[B];if(_t(M.tickertext)&&xt(M.tickertime)&&M.tickertext.length){const H=Nt,V=Rv(M.tickertext,H,Qt-1),O=(V==null?void 0:V.measuredwidth)??1,I=M.x??0,v=M.y??0,L=v<Qt*.5;y.x=I-Math.floor(O*.5),y.y=v+(L?2:-2),y.x+O>Nt&&(y.x=Nt-O),y.x<0&&(y.x=0);const z={x:y.x,y:y.y};Sv(M.tickertext,y,!0);for(let U=0;U<O;++U){const Y=jr({x:z.x+U,y:z.y},Nt);p.alphas[Y]=Math.max(p.alphas[Y],.666)}}}o.push(Ou(e,a++,"text/mood",m?"dark":"bright"));const x=me(Jt.MAIN),N=Li(x,Jt.MAIN);if(_t(N.palette)){const B=sr(x,Tt.PALETTE,N.palette),M=Ie(B);w(M==null?void 0:M.bits)&&o.push(Ou(e,a++,"image/palette",Array.from(M.bits)))}if(_t(N.charset)){const B=sr(x,Tt.CHARSET,N.charset),M=Ie(B);w(M==null?void 0:M.bits)&&o.push(Ou(e,a++,"image/charset",Array.from(M.bits)))}const R=Object.keys(r.objects).filter(br);return o.push(Ou(e,a++,"text/players",R.join(","))),o}const fn=yj();var Jt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Jt||{});const Ae={halt:!1,session:De(),operator:"",software:{main:"",content:""},books:new Map,loaders:new Map};function Ej(){return Ae.session}function Pr(){return Ae.operator}function vj(e){Ae.operator=e}function kj(e){Ae.halt=e}function xj(){return Ae.halt}function Tn(){return[...Ae.books.values()]}function Aj(){const[e]=Ae.books.values();return e}function Px(){const e=Tn(),t=me("main"),[r]=e.filter(n=>n.id!==(t==null?void 0:t.id));return r??t}function Hn(e){const t=zt(e);return Ae.books.get(e)??Tn().find(r=>r.name===t)}function Fx(e,t){w(Hn(t))&&(Ae.software[e]=t)}function me(e){return Hn(Ae.software[e])}function Bx(e){const t=Pd([]);return _t(e)&&(t.name=e),Nu(t),Pe(lt,Ae.operator,`created [book] ${t.name}`),t}function Tj(e){let t=Hn(e);return w(t)||(t=Pd([]),t.name=e),Nu(t),Pe(lt,Ae.operator,`created [book] ${t.name}`),t}function gr(e,t){let r=w(t)?Tj(t):me(e);return w(r)||(w(r)||(r=Aj()),w(r)||(r=Bx(t)),w(r)&&Pe(lt,Ae.operator,`opened [book] ${r.name} for ${e}`)),Fx(e,r.id),r}function os(e,t,r){return Bd(gr(e),r,t)}function Jr(e,t){const r=me("main"),n=_n(fv(r,e,t));if(w(n))return n;const i=Tn();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(r==null?void 0:r.id)){const a=_n(fv(o,e,t));if(w(a))return a}}}function Sn(e){if(w(e==null?void 0:e.kinddata))return e.kinddata;if(!_t(e==null?void 0:e.kind)||!e.kind)return;const t=Jr(Tt.OBJECT,e.kind);if(w(t))return e.kinddata=Ie(t),e.kinddata;const r=Jr(Tt.TERRAIN,e.kind);if(w(r))return e.kinddata=Ie(r),e.kinddata}function Gt(e,t){const r=e==null?void 0:e.kinddata,n=(r==null?void 0:r.id)??"",i=e==null?void 0:e[t];if(w(i))return i;const s=r==null?void 0:r[t];if(w(s))return s;const o=Jr(Tt.OBJECT,n)??Jr(Tt.TERRAIN,n),a=z3(o,t);if(w(a))return a;switch(t){case"group":return"";case"cycle":return sm;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return Wt.ISWALK;default:return}}function p0(e,t){const r={x:(e==null?void 0:e.x)??-1,y:(e==null?void 0:e.y)??-1},n={x:(t==null?void 0:t.x)??-1,y:(t==null?void 0:t.y)??-1},i=Fn(r,n),s=Gt(t,"pushable");return xt(s)?s!==0:_t(s)?s.trim().split(" ").map(o=>my(Zc(o))).some(o=>o===i):!1}function hn(e,t,r,n){if(!w(e)||!w(t))return;const[i,s]=t,o=Jr(Tt.OBJECT,i);if(w(o)){const c=b0(e,r,i,n);if(w(c))return Ta(c,s),Sn(c),Gt(c,"collision")!==Wt.ISGHOST&&(gv(e,c),$d(e,c)),c}const a=Jr(Tt.TERRAIN,i);if(w(a)){const c=Yj(e,r,i);if(w(c)){Ta(c,s),Sn(c);const u=jr(r,Nt);return $d(e,c,u),c}}}function Sj(e,t,r){if(!w(e)||!w(t))return;const[n,i]=t,s=Jr(Tt.OBJECT,n);if(w(s)){const o=b0(e,r,n);return Ta(o,i),o}}function yr(e){const t=Jr(Tt.BOARD,e);return Ie(t)}function Rn(e){const t=gr("main");return Li(t,e)}function $x(e){const t=gr("main");return G3(t,e)}function Dx(){const e=gr("main");return Li(e,"main")}function Rj(e){const t=gr("main");return pv(t,e)}function Oj(e,t){Ae.books.clear(),e.forEach(n=>{Ae.books.set(n.id,n),n.name==="main"&&(Ae.software.main=n.id)});const r=Hn(t);if(w(r)&&(Ae.software.main=r.id),!Ae.software.main){const n=Ae.books.values().next();n.value&&(Ae.software.main=n.value.id)}}function Nu(e){return Ae.books.set(e.id,e),e.id}function Ij(e){const t=Hn(e);t&&Ae.books.delete(t.id)}function jx(e){if(!_t(e)||!e)return ye(lt,e,"login",`failed for playerid ==>${e}<==`);const t=me("main");if(!w(t))return ye(lt,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);let r=Ye(e);if(w(r==null?void 0:r.objects[e]))return!0;if(!w(r)){const u=Jr(Tt.BOARD,"title");r=Ie(u)}if(!w(r))return ye(lt,e,"login:title","login failed to find board with 'title' stat");const n=Jr(Tt.OBJECT,"player");if(!w(n))return ye(lt,e,"login:player","login failed to find object type 'player'");const i=r.startx??0,s=r.starty??0,o=xt(i)?i:Math.round(Nt*.5),a=xt(s)?s:Math.round(Qt*.5),c=b0(r,{x:o,y:a},"player",e);return w(c==null?void 0:c.id)?(c.player=e,uu(t,e,r.id),!0):!1}function Nj(e){const t=me("main");if(!w(t))return;const r=[];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}const n=Ye(e);for(let i=0;i<r.length;++i){const s=r[i];uu(t,s,""),au(n,Or(n,s)),Qx(n,s),fn.halt(s),pv(t,s)}}function Ye(e){const t=me("main"),r=mv(t,e,"board"),n=Jr(Tt.BOARD,r);return Ie(n)}function Cj(e){const t=me("main"),r=Q3(t,e),n=Ye(e),i=Or(n,e);return r&&w(i)}function Lj(e){const t=me("main"),r=Lo(t);for(let n=0;n<r.length;++n){const i=r[n],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;br(c)&&(uu(t,c,i.id),w(e[c])||(e[c]=0))}}}function zx(e){fn.message(e)}function qe(e,t,r,n){if(_t(r.id))if(_t(t.id))nm(lt,e,t.id,r.id,n);else{const i=`${jr({x:t.x??0,y:t.y??0},Nt)}`;nm(lt,e,i,r.id,n)}}function Mj(e,t,r,n){const i=r.id??"";if(n.x<0){const s=yr((t==null?void 0:t.exitwest)??"");w(s)&&Co(e,i,s.id,{x:Nt-1,y:n.y})}else if(n.x>=Nt){const s=yr((t==null?void 0:t.exiteast)??"");w(s)&&Co(e,i,s.id,{x:0,y:n.y})}else if(n.y<0){const s=yr((t==null?void 0:t.exitnorth)??"");w(s)&&Co(e,i,s.id,{x:n.x,y:Qt-1})}else if(n.y>=Qt){const s=yr((t==null?void 0:t.exitsouth)??"");w(s)&&Co(e,i,s.id,{x:n.x,y:0})}}function Gn(e,t,r,n){if(!w(r==null?void 0:r.id))return!1;let i=yv(t,r,n);const s=Gt(r,"collision");if(w(i)&&s!==Wt.ISBULLET){const o=br(r==null?void 0:r.id),a=!!Gt(i,"item");if(p0(r,i)&&(!o||!a)){const u=Fn({x:r.x??0,y:r.y??0},n),l=Fe({x:i.x??0,y:i.y??0},u);Gn(e,t,i,l)}i=yv(t,r,n)}if(w(i)){const o=br(r.id),a=br(r.party??r.id),c=Gt(r,"collision")===Wt.ISBULLET,u=r.kind??"";let l="";r.party&&a&&(l=r.party),o&&(l=r.id);const h=br(i.id),d=br(i.party??i.id),f=Gt(i,"collision")===Wt.ISBULLET,m=i.kind??"",p=a===d;let g="";if(i.party&&d&&(g=i.party),h&&(g=i.id??""),o&&m==="edge")Mj(e,t,r,n);else if(o)h?(qe(p?"":g,i,r,"thud"),qe(p?"":l,r,i,"bump")):f?(qe(p?"":g,i,r,p?"partyshot":"shot"),qe(l,r,i,"thud")):(qe(p?"":g,i,r,"thud"),qe(p?"":l,r,i,"touch"));else if(c)if(h)qe(p?"":g,i,r,"thud"),qe(p?"":l,r,i,p?"partyshot":"shot");else if(f)qe(p?"":g,i,r,"thud"),qe(p?"":l,r,i,"thud");else switch(qe(p?"":g,i,r,"thud"),m){case"object":case"scroll":qe(p?"":l,r,i,"shot");break;default:qe(p?"":l,r,i,p?"partyshot":"shot");break}else if(h)qe(p?"":g,i,r,"thud"),qe(p?"":l,r,i,"bump");else if(f){switch(u){case"object":case"scroll":qe(p?"":l,r,i,"shot");break;default:qe(p?"":l,r,i,p?"partyshot":"shot");break}qe(p?"":l,r,i,"thud")}else qe(p?"":g,i,r,"thud"),qe(p?"":l,r,i,"bump");if(c&&Gt(i,"breakable")){if(w(i==null?void 0:i.id)){const y=se(t,{x:i.x??-1,y:i.y??-1});w(y)&&kr(k.board,y,k.timestamp)}else Ne(t,{x:n.x,y:n.y});return!0}return!1}return!0}function Wx(e,t,r,n){var u;if(!w(e)||!w(t)||!w(r))return;const i={...k};k.book=e,k.board=t,k.element=r,k.elementid=r.id??"",k.elementisplayer=br(k.elementid);const s=k.element.player??Ae.operator;k.elementfocus=k.elementisplayer?k.elementid:s;const o=Gt(r,"cycle"),a=r.id??"",c=zt(r.name??((u=r.kinddata)==null?void 0:u.name)??"");if(fn.tick(a,rs.RUNTIME,o,c,n),xt(r==null?void 0:r.tickertime)&&k.timestamp-r.tickertime>bc*5&&(r.tickertime=0,r.tickertext=""),k.elementisplayer){const l=Rn(k.elementid);xt(l.inputcurrent)&&(l.inputcurrent=0)}Br(i).forEach(l=>{k[l]=i[l]})}function Uj(e,t){Ae.loaders.set(e,t)}function Pj(e){fn.halt(e)}function Fj(){const e=fn.ids();for(let r=0;r<e.length;++r)fn.halt(e[r]);const t=me("main");w(t)&&(t.flags={})}function Bj(e=!1){const t=me("main");if(!w(t))return;const r=t.timestamp+1,n=As.HALT_AT_COUNT;As.HALT_AT_COUNT=n*2,Ae.loaders.forEach((s,o)=>{const a={...k};k.timestamp=t.timestamp,k.book=t,k.board=void 0,k.element=void 0,k.elementid=o,k.elementisplayer=!1,k.elementfocus=Pr();const c=ZD(o);w(c)&&fn.arg(o,c),fn.tick(o,rs.LOADER,1,"loader",s),fn.isended(o)&&(fn.halt(o),Ae.loaders.delete(o)),Br(a).forEach(u=>{k[u]=a[u]})}),As.HALT_AT_COUNT=n,t.timestamp=r,k.timestamp=r;const i=Lo(t);for(let s=0;s<i.length;++s){const o=i[s];for(let u=0;u<o.terrain.length;++u)Sn(o.terrain[u]);const a=Object.keys(o.objects);for(let u=0;u<a.length;++u){const l=a[u];Sn(o.objects[l])}const c=X3(o,r);for(let u=0;u<c.length;++u){const{id:l,type:h,code:d,object:f}=c[u];h===Tt.ERROR?fn.halt(l):(!e||br((f==null?void 0:f.id)??""))&&Wx(t,o,f,d)}}}function Go(e,t,r,n){const i=me("main");if(!w(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(w(c.id)){const u=`${Cx(c.id)}:${t}`;lt.emit("",u,r)}}}if(vs(e)){for(let o=0;o<n.length;++o){const a=n[o],c=se(a,e);w(c)&&s([c])}return}for(let o=0;o<n.length;++o){const a=n[o];switch(zt(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(Yx(a,[e]));break}}}}function $j(e){const t=Rn(e),r=t.playbuffer=_t(t.playbuffer)?t.playbuffer:"";r&&Hx(e,r,!1)}function Hx(e,t,r=!0){var o;const n=gr("main");if(!w(n))return;const i=`${e}_cli`;k.timestamp=n.timestamp,k.book=n,k.board=Ye(e),k.element=Or(k.board,e),k.elementid=((o=k.element)==null?void 0:o.id)??"",k.elementisplayer=!0,k.elementfocus=k.elementid||e;const s=As.HALT_AT_COUNT;if(As.HALT_AT_COUNT=s*8,fn.once(i,rs.CLI,"cli",t),r){const a=Rn(e);a.playbuffer=t}As.HALT_AT_COUNT=s}function Cu(e){var a;const t=gr("main"),r=Ps(t,e);if(!w(t)||!w(r)||!w(k.element))return;const n={...k},i=`${e}_run`,s=zt(k.element.name??((a=k.element.kinddata)==null?void 0:a.name)??""),o=(r==null?void 0:r.code)??"";fn.once(i,rs.RUNTIME,s,o),Br(n).forEach(c=>{k[c]=n[c]})}function Dj(e,t){const r=me("main"),n=Ye(e),i=[],s=[],o=[];if(!w(r)||!w(n))return{board:"",over:i,under:s,layers:o};const a=n.graphics??"flat",c=yr(n.overboard??""),u=yr(n.underboard??"");return s.push(...d0(e,0,u,t,!1,!0)),o.push(...d0(e,s.length,n,t,!0,a!=="flat")),i.push(...d0(e,s.length+o.length,c,t,!1,!1)),{board:n.id,over:i,under:s,layers:o}}function Ks(e){return he(e)&&typeof e[0]=="string"}function jj(e){const t=k.words[e];return _t(t)?[t,e+1]:[void 0,e]}function m0(e){const t=k.words[e];if(Ks(t))return[t,e+1];const[r,n]=el(e),[i,s]=jj(n);return _t(i)&&(i==="empty"||Sn({kind:i}))?[[i,r],s]:[void 0,e]}function cc(e){if(!Ks(e))return;const[t]=e;return t}function Lu(e){if(!Ks(e))return;const[,t]=e,r=w(t)?Qc(t):void 0;return w(r)?r:void 0}function Gx(e){if(!Ks(e))return;const[,t]=e,r=w(t)?tl(t):void 0;return w(r)?fh(r):void 0}function lc(e,t){const r=e??Wt.ISWALK,n=t??Wt.ISWALK;if(r===Wt.ISGHOST||n===Wt.ISGHOST)return!1;switch(r){case Wt.ISWALK:return n!==Wt.ISWALK;case Wt.ISSWIM:return n!==Wt.ISSWIM;case Wt.ISSOLID:return!0;case Wt.ISBULLET:return n!==Wt.ISWALK&&n!==Wt.ISSWIM}}function uc(e,t,r){const n=e==null?void 0:e.objects[r];if(w(n))return n;const i=fc(e,"player");return w(t)?(t.x<0&&(t.x=yn(0,Nt-1)),t.y<0&&(t.y=yn(0,Qt-1)),qx(t,i)):_n(...i)}function fc(e,t){var i;const r=(i=e==null?void 0:e.named)==null?void 0:i[t];return w(r)?[...r.values()].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(w):[]}function zj(e){const t=[];for(let r=0;r<Qt;++r)for(let n=0;n<Nt;++n){const i={x:n,y:r},s=se(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function g0(e,t,r,n){if(!w(e))return!1;const i=dr(e);return!(w(t)&&t!==i.name||w(r)&&r!==i.color||w(n)&&n!==i.bg)}function Mu(e,t){const r=cc(t),n=Lu(t),i=Gx(t);return fc(e,r??"").filter(s=>g0(s,r,n,i))}function Kx(e,t){const r=w(t)?Qc(t):void 0,n=w(t)?tl(t):void 0,i=[];if(w(e)){for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];w(a)&&g0(a,void 0,r,n)&&i.push(a)}const s=Object.values(e.objects);for(let o=0;o<s.length;++o){const a=s[o];g0(a,void 0,r,n)&&i.push(a)}}return i}function Yx(e,t){return w(e)?t.map(r=>{var n;if(typeof r=="string"){const i=e.objects[r];if(w(i))return i;const s=fc(e,zt(r));if(s.length)return s}else if(vs(r)&&r.x>=0&&r.x<Nt&&r.y>=0&&r.y<Qt){const i=r.x+r.y*Nt,s=(n=e.lookup)==null?void 0:n[i];return w(s)?e.objects[s]:e.terrain[i]}}).flat().filter(w):[]}function qx(e,t){let r=0,n;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(n===void 0||c<r)&&(r=c,n=s)}}return n}function Wj(e,t,r,n){if(!w(e))return;w(e.distmaps)||(e.distmaps={});const i=`${t}.${r.x}.${r.y}.${n.x}.${n.y}`;let s=e.distmaps[i];if(!w(s)){s=new Array(dh).fill(-2);const o=[{...n}];let a=0;for(;o.length;){const c=o.shift();if(w(c)&&Ko(c)){const u=jr(c,Nt);if(s[u]===-2){const l=as(e,c.x,c.y);lc(t,Gt(l,"collision"))||(s[u]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function Vx(e,t){return Ko(e)?t[jr(e,Nt)]:-1}function Xx(e,t,r,n,i){if(!w(e))return;const s=Wj(e,t,r,n);if(!w(s))return;const o=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let a;if(i){let c=i?0:1e4;for(let u=0;u<o.length;++u){const l=Vx(o[u],s);l>=0&&l>c&&(c=l,a=o[u])}}else{let c=1e5;for(let u=0;u<o.length;++u){const l=Vx(o[u],s);l>=0&&l<c&&(c=l,a=o[u])}}return a}function Hj(){return new Array(Nt*Qt).map(()=>{})}function Uu(e=tf){const t={terrain:Hj(),objects:{},id:""};return e(t)}var y0=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(y0||{});function Gj(e){return ko(e,y0,{terrain:t=>t.map(fl),objects:t=>Object.values(t).filter(r=>!r.removed).map(fl),id:Oe,named:Oe,lookup:Oe,codepage:Oe,distmaps:Oe,overboard:Oe,underboard:Oe})}function Kj(e){return Aa(e,y0,{terrain:t=>t.map(hl),objects:t=>{const r={};for(let n=0;n<t.length;++n){const i=hl(t[n]);w(i==null?void 0:i.id)&&(r[i.id]=i)}return r}})}function Ko(e){return nh(e.x,e.y,0,Nt-1,Qt-1,0)}function $i(e,t){return!w(e)||!w(t==null?void 0:t.x)||!w(t==null?void 0:t.y)||t.x<0||t.x>=Nt||t.y<0||t.y>=Qt?-1:t.x+t.y*Nt}function se(e,t){const r=$i(e,t);if(r<0||!w(e==null?void 0:e.lookup))return;const n=Or(e,e.lookup[r]??"");return w(n)?n:e.terrain[r]}function Jx(e,t){const r=Or(e,t);if(w(r))return r;const n=parseFloat(t),i=cI(isNaN(n)?-1:n,Nt);return as(e,i.x,i.y)}function as(e,t,r){return(t>=0&&t<Nt)??(r>=0&&r<Qt)?e==null?void 0:e.terrain[t+r*Nt]:void 0}function Ne(e,t){if(!w(e)||!w(t)||!w(t.x)||!w(t.y)||t.x<0||t.x>=Nt||t.y<0||t.y>=Qt)return;const r=Nn(t),n=t.x+t.y*Nt;return e.terrain[n]=r,delete e.distmaps,e.terrain[n]}function _0(e,t){if(!w(e)||!w(t))return;const r=Nn(t);return r.id=r.id??De(),e.objects[r.id]=r,e.objects[r.id]}function Yj(e,t,r){return Ne(e,{...t,kind:r})}function b0(e,t,r,n){return _0(e,{...t,kind:r,id:n})}function Or(e,t){if(e)return e.objects[t]}function Zx(e,t){const r=$i(e,t);if(r<0||!w(e==null?void 0:e.lookup))return;const n=Or(e,e.lookup[r]??"");if(w(n))return n}function kr(e,t,r){return!w(t)||dr(t).name==="player"?!1:(t.id?(t.removed=r,au(e,t)):(Ne(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),Y3(e,t)),!0)}function Qx(e,t){return w(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function qj(e,t,r){if(!w(e)||!w(t))return;const n=e.objects[r];if(w(n))return n;if(vs(t))return qx(t,fc(e,"player"))}function Yo(e,t,r,n,i){const s=bt.MID;if(!w(e)||!w(t))return{dir:n,startpt:i,destpt:i,layer:s,targets:[]};const o={x:t.x??0,y:t.y??0},a={x:o.x+(t.stepx??0),y:o.y+(t.stepy??0)},c=Fn(o,a),u=Nt-1,l=Qt-1;for(let h=0;h<n.length;++h){const d=my(n[h]);switch(d){case bt.IDLE:break;case bt.NORTH:case bt.SOUTH:case bt.WEST:case bt.EAST:Fe(o,d);break;case bt.BY:{const[f,m]=n.slice(h+1);xt(f)&&xt(m)&&(o.x=ze(o.x+f,0,u),o.y=ze(o.y+m,0,l)),h+=2;break}case bt.TO:{const[f,m]=n.slice(h+1);xt(f)&&xt(m)&&(o.x=ze(f,0,u),o.y=ze(m,0,l)),h+=2;break}case bt.AT:{const[f,m]=n.slice(h+1);xt(f)&&xt(m)&&(o.x=ze(f,0,u),o.y=ze(m,0,l)),h+=2;break}case bt.FLOW:Fe(o,c);break;case bt.SEEK:{const f=qj(e,t,r);vs(f)&&Fe(o,Fn(i,f));break}case bt.RNDNS:Fe(o,_n(bt.NORTH,bt.SOUTH));break;case bt.RNDNE:Fe(o,_n(bt.NORTH,bt.EAST));break;case bt.RND:Fe(o,_n(bt.NORTH,bt.SOUTH,bt.WEST,bt.EAST));break;case bt.CW:case bt.CCW:case bt.OPP:case bt.RNDP:{const f=Yo(e,t,r,n.slice(h+1),i);switch(o.x=i.x,o.y=i.y,d){case bt.CW:switch(Fn(i,f.destpt)){case bt.NORTH:Fe(o,bt.EAST);break;case bt.SOUTH:Fe(o,bt.WEST);break;case bt.EAST:Fe(o,bt.SOUTH);break;case bt.WEST:Fe(o,bt.NORTH);break}break;case bt.CCW:switch(Fn(i,f.destpt)){case bt.NORTH:Fe(o,bt.WEST);break;case bt.SOUTH:Fe(o,bt.EAST);break;case bt.EAST:Fe(o,bt.NORTH);break;case bt.WEST:Fe(o,bt.SOUTH);break}break;case bt.OPP:switch(Fn(i,f.destpt)){case bt.NORTH:Fe(o,bt.SOUTH);break;case bt.SOUTH:Fe(o,bt.NORTH);break;case bt.EAST:Fe(o,bt.WEST);break;case bt.WEST:Fe(o,bt.EAST);break}break;case bt.RNDP:switch(Fn(i,f.destpt)){case bt.NORTH:case bt.SOUTH:o.x+=_n(-1,1);break;case bt.WEST:case bt.EAST:o.y+=_n(-1,1);break}break}return{dir:n,startpt:i,destpt:o,layer:s,targets:[]}}case bt.FLEE:break;case bt.AWAY:{const[f,m]=n.slice(h+1);if(xt(f)&&xt(m)){const p={x:ze(f,0,u),y:ze(m,0,l)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=Gt(t,"collision"),S=Xx(e,b,o,p,!0);w(S)&&S.x!==f&&S.y!==m&&!Zx(e,S)&&(o.x=S.x,o.y=S.y)}else{const b=lh(-g,-y);Fe(o,b)}}h+=2;break}case bt.FIND:break;case bt.TOWARD:{const[f,m]=n.slice(h+1);if(xt(f)&&xt(m)){const p={x:ze(f,0,u),y:ze(m,0,l)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=Gt(t,"collision"),S=Xx(e,b,o,p,!1);w(S)&&S.x!==f&&S.y!==m&&!Zx(e,S)&&(o.x=S.x,o.y=S.y)}else{const b=lh(g,y);Fe(o,b)}}h+=2;break}case bt.OVER:case bt.UNDER:{const f=Yo(e,t,r,n.slice(h+1),i);return f.layer=d,f}case bt.WITHIN:{const[f]=n.slice(h+1),m=Yo(e,t,r,n.slice(h+2),i);if(m.targets.length===0&&xt(f)&&f>0)for(let p=-f;p<=f;++p)for(let g=-f;g<=f;++g){const y={x:m.destpt.x+g,y:m.destpt.y+p};Ko(y)&&m.targets.push(y)}return xt(f)&&f>0?{...m,targets:m.targets.filter(p=>vs(p)?ey(p,m.destpt)<=f:!1)}:m}case bt.AWAYBY:{const[f]=n.slice(h+1),m=Yo(e,t,r,n.slice(h+2),i);if(m.targets.length===0)for(let p=-Nt;p<=Nt;++p)for(let g=-Nt;g<=Nt;++g){const y={x:m.destpt.x+g,y:m.destpt.y+p};Ko(y)&&m.targets.push(y)}return xt(f)&&f>0?{...m,targets:m.targets.filter(p=>vs(p)?ey(p,m.destpt)>=f:!1)}:m}}}return{dir:n,startpt:i,destpt:o,layer:s,targets:[]}}const k={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var J=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.COLOR_OR_KIND=7]="COLOR_OR_KIND",e[e.MAYBE_KIND=8]="MAYBE_KIND",e[e.MAYBE_NAME=9]="MAYBE_NAME",e[e.MAYBE_NUMBER=10]="MAYBE_NUMBER",e[e.MAYBE_STRING=11]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",e[e.ANY=13]="ANY",e))(J||{});function _r(e,t,r){throw console.info(r,k.element,k.elementid,k.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function tA(e){var r,n;const t={x:((r=k.element)==null?void 0:r.x)??0,y:((n=k.element)==null?void 0:n.y)??0};return Yo(k.board,k.element,k.elementfocus,e,t)}function ft(e,t,r){const n=k.words;k.words=e;const i=[];let s=t;for(let o=0;o<r.length;++o)switch(r[o]){case 1:{const[a,c]=m0(s);Ks(a)?(s=c,i.push(a)):_r("kind",a,e);break}case 0:{if(ba(e[s])===void 0){const[a,c]=Mr(s);Ir(a)?(s=c,i.push(a)):xt(a)?(s=c,i.push(wo(a,void 0))):_r("color",a,e)}else{const[a,c]=el(s);Ir(a)?(s=c,i.push(a)):_r("color",a,e)}break}case 2:{if(Zc(e[s])===void 0){const[a,c]=Mr(s);on(a)?(s=c,i.push(tA(a))):_r("direction",a,e)}else{const[a,c]=yy(s);on(a)?(s=c,i.push(tA(a))):_r("direction",a,e)}break}case 3:{const a=k.words[s];_t(a)||_r("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Mr(s);if(_t(a)){const u=parseFloat(a);xt(u)?i.push(u):_r("number",a,e)}else xt(a)?i.push(a):_r("number",a,e);s=c;break}case 5:{const[a,c]=Mr(s);_t(a)||_r("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Mr(s);let u=a;if(_t(u)){const l=parseFloat(u);xt(l)&&(u=l)}else xt(u)||_r("number or string",u,e);s=c,i.push(u);break}case 7:{const[a,c]=m0(s);if(Ks(a))s=c,i.push(a);else if(ba(e[s])===void 0){const[u,l]=Mr(s);Ir(u)?(s=l,i.push(u)):_r("color",u,e)}else{const[u,l]=el(s);Ir(u)?(s=l,i.push(u)):_r("color or kind",u,e)}break}case 8:{const[a,c]=m0(s);a!==void 0&&!Ks(a)&&_r("optional kind",a,e),s=c,i.push(a);break}case 9:{const a=k.words[s];a!==void 0&&!_t(a)&&_r("optional string",a,e),++s,i.push(a);break}case 10:{const[a,c]=Mr(s);if(_t(a)){const u=parseFloat(a);xt(u)?i.push(u):_r("optional number",a,e)}else xt(a)||a===void 0?i.push(a):_r("optional number",a,e);s=c;break}case 11:{const[a,c]=Mr(s);a!==void 0&&!_t(a)&&_r("optional string",a,e),s=c,i.push(a);break}case 12:{const[a,c]=Mr(s);let u=a;if(_t(u)){const l=parseFloat(u);xt(l)&&(u=l)}else u!==void 0&&!xt(u)&&_r("number or string",u,e);s=c,i.push(u);break}case 13:{const[a,c]=Mr(s);s=c,i.push(a);break}}return k.words=n,[...i,s]}const Pu={},qo={};function w0(){return{id:De(),board:"",layers:[],scroll:[],sidebar:[]}}const Vj=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),Xj=new Set(["tx","text"]),Jj={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},eA={};let rA=e=>{let t=eA[e];return w(t)||(eA[e]=t=w0()),t};function Zj(e){rA=e}function Ce(e){return rA(e)}function E0(e){return w(Pu[e])||(Pu[e]=[]),Pu[e]}function Qj(e){const t=Ce(e);t.scrollname="",t.scroll=[]}function tz(e,t,r){Object.values(qo).forEach(n=>{if(n[t]!==void 0){const i=ky(e.id(),t);xt(r)&&sI(i,r),_t(r)&&oI(i,r)}})}function ar(e){const t=E0(e);return Pu[e]=[],t}function nA(e){const t=[];for(let r=0;r<e.length;++r){const n=e[r];_t(n)&&w(cP(n))?t.push(" ",n," "):t.push(n)}return t}function Mt(e,t){E0(e).push(t)}function $t(e,t,r,n,i=()=>0,s=tf){const o=[t,r,...n],a=zt(`${o[3]}`),c={...k};function u(l,h){w(h)&&h!==i(l)&&(k.board=c.board,k.element=c.element,k.elementfocus=c.elementfocus,s(l,h))}if(Vj.has(a)){const l=`${o[2]}`;qo[t]=qo[t]??{};const h=i(l)??Jj[a];if(qo[t][l]===void 0){const d=ky(t,l);xt(h)&&iI(d,h),_t(h)&&rh(d,h),Xj.has(a)?qo[t][l]=Jg(d,f=>{u(l,f)}):qo[t][l]=aI(d,f=>{u(l,f)})}}E0(e).push(o)}Zj(e=>{if(br(e)){const t=me(Jt.MAIN),r=Li(t,Jt.GADGETSTORE);let n=r[e];return w(n)||(r[e]=n=w0()),n}return w0()});let iA=0;function ez(){switch(iA++){case 0:return Kt.BLUE;case 1:return Kt.BLACK;case 2:return Kt.GREEN;case 3:return Kt.BLACK;case 4:return Kt.CYAN;case 5:return Kt.BLACK;case 6:return Kt.RED;case 7:return Kt.BLACK;case 8:return Kt.PURPLE;case 9:return Kt.BLACK;case 10:return Kt.YELLOW;case 11:return Kt.BLACK;case 12:return Kt.WHITE;default:return iA=0,Kt.BLACK}}const v0=Xs("gadgetserver",["tock"],e=>{if(!v0.session(e))return;const t=me(Jt.MAIN),r=[...(t==null?void 0:t.activelist)??[],Pr()],n=[...new Set(r.values())],i=Li(t,Jt.GADGETSYNC);switch(e.target){case"tock":{const s=ez();for(let o=0;o<n.length;++o){const a=n[o],{board:c,over:u,under:l,layers:h}=Dj(a,s),d=Ce(a);d.board=c,d.over=u,d.under=l,d.layers=h;const f=i[a]??{},m=J0(f,d);m.length&&(i[a]=Nn(d),RT(v0,a,m))}break}case"desync":ST(v0,e.player,Ce(e.player));break;case"clearscroll":Qj(e.player);break;case"clearplayer":{const s=Li(t,Jt.GADGETSTORE);delete s[e.player];const o=Li(t,Jt.GADGETSYNC);delete o[e.player];break}}});function Fu(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var sA={exports:{}};(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,i,s){function o(u,l){if(!i[u]){if(!n[u]){var h=typeof Fu=="function"&&Fu;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[u]={exports:{}};n[u][0].call(f.exports,function(m){var p=n[u][1][m];return o(p||m)},f,f.exports,r,n,i,s)}return i[u].exports}for(var a=typeof Fu=="function"&&Fu,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(r,n,i){var s=r("./utils"),o=r("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,d,f,m,p,g=[],y=0,b=c.length,S=b,T=s.getTypeOf(c)!=="string";y<c.length;)S=b-y,h=T?(u=c[y++],l=y<b?c[y++]:0,y<b?c[y++]:0):(u=c.charCodeAt(y++),l=y<b?c.charCodeAt(y++):0,y<b?c.charCodeAt(y++):0),d=u>>2,f=(3&u)<<4|l>>4,m=1<S?(15&l)<<2|h>>6:64,p=2<S?63&h:64,g.push(a.charAt(d)+a.charAt(f)+a.charAt(m)+a.charAt(p));return g.join("")},i.decode=function(c){var u,l,h,d,f,m,p=0,g=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,S=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&S--,c.charAt(c.length-2)===a.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|S):new Array(0|S);p<c.length;)u=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,l=(15&d)<<4|(f=a.indexOf(c.charAt(p++)))>>2,h=(3&f)<<6|(m=a.indexOf(c.charAt(p++))),b[g++]=u,f!==64&&(b[g++]=l),m!==64&&(b[g++]=h);return b}},{"./support":30,"./utils":32}],2:[function(r,n,i){var s=r("./external"),o=r("./stream/DataWorker"),a=r("./stream/Crc32Probe"),c=r("./stream/DataLengthProbe");function u(l,h,d,f,m){this.compressedSize=l,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=m}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,d){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},n.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,i){var s=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,i){var s=r("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();n.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,d){var f=o,m=d+h;u^=-1;for(var p=d;p<m;p++)u=u>>>8^f[255&(u^l[p])];return-1^u}(0|c,a,a.length,0):function(u,l,h,d){var f=o,m=d+h;u^=-1;for(var p=d;p<m;p++)u=u>>>8^f[255&(u^l.charCodeAt(p))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(r,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,n,i){var s=null;s=typeof Promise<"u"?Promise:r("lie"),n.exports={Promise:s}},{lie:37}],7:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),a=r("./utils"),c=r("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,i){function s(f,m){var p,g="";for(p=0;p<m;p++)g+=String.fromCharCode(255&f),f>>>=8;return g}function o(f,m,p,g,y,b){var S,T,x=f.file,N=f.compression,R=b!==u.utf8encode,B=a.transformTo("string",b(x.name)),M=a.transformTo("string",u.utf8encode(x.name)),H=x.comment,V=a.transformTo("string",b(H)),O=a.transformTo("string",u.utf8encode(H)),I=M.length!==x.name.length,v=O.length!==H.length,L="",z="",U="",Y=x.dir,X=x.date,K={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(K.crc32=f.crc32,K.compressedSize=f.compressedSize,K.uncompressedSize=f.uncompressedSize);var W=0;m&&(W|=8),R||!I&&!v||(W|=2048);var P=0,ot=0;Y&&(P|=16),y==="UNIX"?(ot=798,P|=function(rt,wt){var Rt=rt;return rt||(Rt=wt?16893:33204),(65535&Rt)<<16}(x.unixPermissions,Y)):(ot=20,P|=function(rt){return 63&(rt||0)}(x.dosPermissions)),S=X.getUTCHours(),S<<=6,S|=X.getUTCMinutes(),S<<=5,S|=X.getUTCSeconds()/2,T=X.getUTCFullYear()-1980,T<<=4,T|=X.getUTCMonth()+1,T<<=5,T|=X.getUTCDate(),I&&(z=s(1,1)+s(l(B),4)+M,L+="up"+s(z.length,2)+z),v&&(U=s(1,1)+s(l(V),4)+O,L+="uc"+s(U.length,2)+U);var G="";return G+=`
\0`,G+=s(W,2),G+=N.magic,G+=s(S,2),G+=s(T,2),G+=s(K.crc32,4),G+=s(K.compressedSize,4),G+=s(K.uncompressedSize,4),G+=s(B.length,2),G+=s(L.length,2),{fileRecord:h.LOCAL_FILE_HEADER+G+B+L,dirRecord:h.CENTRAL_FILE_HEADER+s(ot,2)+G+s(V.length,2)+"\0\0\0\0"+s(P,4)+s(g,4)+B+L+V}}var a=r("../utils"),c=r("../stream/GenericWorker"),u=r("../utf8"),l=r("../crc32"),h=r("../signature");function d(f,m,p,g){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var m=f.meta.percent||0,p=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-g-1))/p:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var p=o(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,p=o(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(g){return h.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-f,g=function(y,b,S,T,x){var N=a.transformTo("string",x(T));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(b,4)+s(S,4)+s(N.length,2)+N}(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(p){m.processChunk(p)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var m=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var p=0;p<m.length;p++)try{m[p].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},n.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,i){var s=r("../compressions"),o=r("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var m=function(b,S){var T=b||S,x=s[T];if(!x)throw new Error(T+" is not a valid compression method !");return x}(f.options.compression,c.compression),p=f.options.compressionOptions||c.compressionOptions||{},g=f.dir,y=f.date;f._compressWorker(m,p).withStreamInfo("file",{name:d,dir:g,date:y,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(d){l.error(d)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=r("./object")).loadAsync=r("./load"),s.support=r("./support"),s.defaults=r("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=r("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,i){var s=r("./utils"),o=r("./external"),a=r("./utf8"),c=r("./zipEntries"),u=r("./stream/Crc32Probe"),l=r("./nodejsUtils");function h(d){return new o.Promise(function(f,m){var p=d.decompressed.getContentWorker().pipe(new u);p.on("error",function(g){m(g)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(d,f){var m=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(p){var g=new c(f);return g.load(p),g}).then(function(p){var g=[o.Promise.resolve(p)],y=p.files;if(f.checkCRC32)for(var b=0;b<y.length;b++)g.push(h(y[b]));return o.Promise.all(g)}).then(function(p){for(var g=p.shift(),y=g.files,b=0;b<y.length;b++){var S=y[b],T=S.fileNameStr,x=s.resolve(S.fileNameStr);m.file(x,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:f.createFolders}),S.dir||(m.file(x).unsafeOriginalName=T)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,i){var s=r("../utils"),o=r("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,i){var s=r("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,d){l.push(h)||l._helper.pause(),u&&u(d)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}r("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,i){n.exports={isNode:typeof tr<"u",newBufferFrom:function(s,o){if(tr.from&&tr.from!==Uint8Array.from)return tr.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new tr(s,o)},allocBuffer:function(s){if(tr.alloc)return tr.alloc(s);var o=new tr(s);return o.fill(0),o},isBuffer:function(s){return tr.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(r,n,i){function s(x,N,R){var B,M=a.getTypeOf(N),H=a.extend(R||{},l);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(x=y(x)),H.createFolders&&(B=g(x))&&b.call(this,B,!0);var V=M==="string"&&H.binary===!1&&H.base64===!1;R&&R.binary!==void 0||(H.binary=!V),(N instanceof h&&N.uncompressedSize===0||H.dir||!N||N.length===0)&&(H.base64=!1,H.binary=!0,N="",H.compression="STORE",M="string");var O=null;O=N instanceof h||N instanceof c?N:m.isNode&&m.isStream(N)?new p(x,N):a.prepareContent(x,N,H.binary,H.optimizedBinaryString,H.base64);var I=new d(x,O,H);this.files[x]=I}var o=r("./utf8"),a=r("./utils"),c=r("./stream/GenericWorker"),u=r("./stream/StreamHelper"),l=r("./defaults"),h=r("./compressedObject"),d=r("./zipObject"),f=r("./generate"),m=r("./nodejsUtils"),p=r("./nodejs/NodejsStreamInputAdapter"),g=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var N=x.lastIndexOf("/");return 0<N?x.substring(0,N):""},y=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},b=function(x,N){return N=N!==void 0?N:l.createFolders,x=y(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:N}),this.files[x]};function S(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var N,R,B;for(N in this.files)B=this.files[N],(R=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&x(R,B)},filter:function(x){var N=[];return this.forEach(function(R,B){x(R,B)&&N.push(B)}),N},file:function(x,N,R){if(arguments.length!==1)return x=this.root+x,s.call(this,x,N,R),this;if(S(x)){var B=x;return this.filter(function(H,V){return!V.dir&&B.test(H)})}var M=this.files[this.root+x];return M&&!M.dir?M:null},folder:function(x){if(!x)return this;if(S(x))return this.filter(function(M,H){return H.dir&&x.test(M)});var N=this.root+x,R=b.call(this,N),B=this.clone();return B.root=R.name,B},remove:function(x){x=this.root+x;var N=this.files[x];if(N||(x.slice(-1)!=="/"&&(x+="/"),N=this.files[x]),N&&!N.dir)delete this.files[x];else for(var R=this.filter(function(M,H){return H.name.slice(0,x.length)===x}),B=0;B<R.length;B++)delete this.files[R[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var N,R={};try{if((R=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var B=R.comment||this.comment||"";N=f.generateWorker(this,R,B)}catch(M){(N=new c("error")).error(M)}return new u(N,R.type||"string",R.mimeType)},generateAsync:function(x,N){return this.generateInternalStream(x).accumulate(N)},generateNodeStream:function(x,N){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(N)}};n.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,i){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===u&&this.data[d+2]===l&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&u===d[1]&&l===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,i){var s=r("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(r,n,i){var s=r("./Uint8ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,i){var s=r("./ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,i){var s=r("../utils"),o=r("../support"),a=r("./ArrayReader"),c=r("./StringReader"),u=r("./NodeBufferReader"),l=r("./Uint8ArrayReader");n.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,i){var s=r("./GenericWorker"),o=r("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,i){var s=r("./GenericWorker"),o=r("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(r,n,i){var s=r("../utils"),o=r("./ConvertWorker"),a=r("./GenericWorker"),c=r("../base64"),u=r("../support"),l=r("../external"),h=null;if(u.nodestream)try{h=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new l.Promise(function(g,y){var b=[],S=m._internalType,T=m._outputType,x=m._mimeType;m.on("data",function(N,R){b.push(N),p&&p(R)}).on("error",function(N){b=[],y(N)}).on("end",function(){try{var N=function(R,B,M){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",B),M);case"base64":return c.encode(B);default:return s.transformTo(R,B)}}(T,function(R,B){var M,H=0,V=null,O=0;for(M=0;M<B.length;M++)O+=B[M].length;switch(R){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(V=new Uint8Array(O),M=0;M<B.length;M++)V.set(B[M],H),H+=B[M].length;return V;case"nodebuffer":return tr.concat(B);default:throw new Error("concat : unsupported type '"+R+"'")}}(S,b),x);g(N)}catch(R){y(R)}b=[]}).resume()})}function f(m,p,g){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=g,s.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}f.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var g=this;return m==="data"?this._worker.on(m,function(y){p.call(g,y.data,y.meta)}):this._worker.on(m,function(){s.delay(p,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof tr<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,i){for(var s=r("./utils"),o=r("./support"),a=r("./nodejsUtils"),c=r("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(m){var p,g,y,b,S,T=m.length,x=0;for(b=0;b<T;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<T&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),x+=g<128?1:g<2048?2:g<65536?3:4;for(p=o.uint8array?new Uint8Array(x):new Array(x),b=S=0;S<x;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<T&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),g<128?p[S++]=g:(g<2048?p[S++]=192|g>>>6:(g<65536?p[S++]=224|g>>>12:(p[S++]=240|g>>>18,p[S++]=128|g>>>12&63),p[S++]=128|g>>>6&63),p[S++]=128|63&g);return p}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(m){var p,g,y,b,S=m.length,T=new Array(2*S);for(p=g=0;p<S;)if((y=m[p++])<128)T[g++]=y;else if(4<(b=u[y]))T[g++]=65533,p+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&p<S;)y=y<<6|63&m[p++],b--;1<b?T[g++]=65533:y<65536?T[g++]=y:(y-=65536,T[g++]=55296|y>>10&1023,T[g++]=56320|1023&y)}return T.length!==g&&(T.subarray?T=T.subarray(0,g):T.length=g),s.applyFromCharCode(T)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var m=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=function(b,S){var T;for((S=S||b.length)>b.length&&(S=b.length),T=S-1;0<=T&&(192&b[T])==128;)T--;return T<0||T===0?S:T+u[b[T]]>S?T:S}(m),y=m;g!==m.length&&(o.uint8array?(y=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(y=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:i.utf8decode(y),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,i){var s=r("./support"),o=r("./base64"),a=r("./nodejsUtils"),c=r("./external");function u(p){return p}function l(p,g){for(var y=0;y<p.length;++y)g[y]=255&p.charCodeAt(y);return g}r("setimmediate"),i.newBlob=function(p,g){i.checkSupport("blob");try{return new Blob([p],{type:g})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(p,g,y){var b=[],S=0,T=p.length;if(T<=y)return String.fromCharCode.apply(null,p);for(;S<T;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(S,Math.min(S+y,T)))):b.push(String.fromCharCode.apply(null,p.subarray(S,Math.min(S+y,T)))),S+=y;return b.join("")},stringifyByChar:function(p){for(var g="",y=0;y<p.length;y++)g+=String.fromCharCode(p[y]);return g},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var g=65536,y=i.getTypeOf(p),b=!0;if(y==="uint8array"?b=h.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return h.stringifyByChunk(p,y,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(p)}function f(p,g){for(var y=0;y<p.length;y++)g[y]=p[y];return g}i.applyFromCharCode=d;var m={};m.string={string:u,array:function(p){return l(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return l(p,new Uint8Array(p.length))},nodebuffer:function(p){return l(p,a.allocBuffer(p.length))}},m.array={string:d,array:u,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:u,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:u,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:u},i.transformTo=function(p,g){if(g=g||"",!p)return g;i.checkSupport(p);var y=i.getTypeOf(g);return m[y][p](g)},i.resolve=function(p){for(var g=p.split("/"),y=[],b=0;b<g.length;b++){var S=g[b];S==="."||S===""&&b!==0&&b!==g.length-1||(S===".."?y.pop():y.push(S))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var g,y,b="";for(y=0;y<(p||"").length;y++)b+="\\x"+((g=p.charCodeAt(y))<16?"0":"")+g.toString(16).toUpperCase();return b},i.delay=function(p,g,y){setImmediate(function(){p.apply(y||null,g||[])})},i.inherits=function(p,g){function y(){}y.prototype=g.prototype,p.prototype=new y},i.extend=function(){var p,g,y={};for(p=0;p<arguments.length;p++)for(g in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],g)&&y[g]===void 0&&(y[g]=arguments[p][g]);return y},i.prepareContent=function(p,g,y,b,S){return c.Promise.resolve(g).then(function(T){return s.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new c.Promise(function(x,N){var R=new FileReader;R.onload=function(B){x(B.target.result)},R.onerror=function(B){N(B.target.error)},R.readAsArrayBuffer(T)}):T}).then(function(T){var x=i.getTypeOf(T);return x?(x==="arraybuffer"?T=i.transformTo("uint8array",T):x==="string"&&(S?T=o.decode(T):y&&b!==!0&&(T=function(N){return l(N,s.uint8array?new Uint8Array(N.length):new Array(N.length))}(T))),T):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./signature"),c=r("./zipEntry"),u=r("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===d;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=u.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=d-f;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./compressedObject"),c=r("./crc32"),u=r("./utf8"),l=r("./compressions"),h=r("./support");function d(f,m){this.options=f,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(g){for(var y in l)if(Object.prototype.hasOwnProperty.call(l,y)&&l[y].magic===g)return l[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,p,g,y=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<y;)m=f.readInt(2),p=f.readInt(2),g=f.readData(p),this.extraFields[m]={id:m,length:p,value:g};f.setIndex(y)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var y=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:u.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:u.utf8decode(m.readData(f.length-5))}return null}},n.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,i){function s(m,p,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=p,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=r("./stream/StreamHelper"),a=r("./stream/DataWorker"),c=r("./utf8"),u=r("./compressedObject"),l=r("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,g="string";try{if(!m)throw new Error("No output type specified.");var y=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(p=p.pipe(new c.Utf8EncodeWorker)),!b&&y&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(S){(p=new l("error")).error(S)}return new o(p,g,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof u&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(g,m,p)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(m),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var f=[];function m(){var p,g;a=!0;for(var y=f.length;y;){for(g=f,f=[],p=-1;++p<y;)g[p]();y=f.length}a=!1}n.exports=function(p){f.push(p)!==1||a||o()}}).call(this,typeof Qe<"u"?Qe:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,n,i){var s=r("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function d(y,b,S){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function f(y,b,S){s(function(){var T;try{T=b(S)}catch(x){return a.reject(y,x)}T===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,T)})}function m(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}function p(y,b){var S=!1;function T(R){S||(S=!0,a.reject(y,R))}function x(R){S||(S=!0,a.resolve(y,R))}var N=g(function(){b(x,T)});N.status==="error"&&T(N.value)}function g(y,b){var S={};try{S.value=y(b),S.status="success"}catch(T){S.status="error",S.value=T}return S}(n.exports=h).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(S){return b.resolve(y()).then(function(){return S})},function(S){return b.resolve(y()).then(function(){throw S})})},h.prototype.catch=function(y){return this.then(null,y)},h.prototype.then=function(y,b){if(typeof y!="function"&&this.state===u||typeof b!="function"&&this.state===c)return this;var S=new this.constructor(o);return this.state!==l?f(S,this.state===u?y:b,this.outcome):this.queue.push(new d(S,y,b)),S},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){f(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){f(this.promise,this.onRejected,y)},a.resolve=function(y,b){var S=g(m,b);if(S.status==="error")return a.reject(y,S.value);var T=S.value;if(T)p(y,T);else{y.state=u,y.outcome=b;for(var x=-1,N=y.queue.length;++x<N;)y.queue[x].callFulfilled(b)}return y},a.reject=function(y,b){y.state=c,y.outcome=b;for(var S=-1,T=y.queue.length;++S<T;)y.queue[S].callRejected(b);return y},h.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},h.reject=function(y){var b=new this(o);return a.reject(b,y)},h.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=y.length,T=!1;if(!S)return this.resolve([]);for(var x=new Array(S),N=0,R=-1,B=new this(o);++R<S;)M(y[R],R);return B;function M(H,V){b.resolve(H).then(function(O){x[V]=O,++N!==S||T||(T=!0,a.resolve(B,x))},function(O){T||(T=!0,a.reject(B,O))})}},h.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=y.length,T=!1;if(!S)return this.resolve([]);for(var x=-1,N=new this(o);++x<S;)R=y[x],b.resolve(R).then(function(B){T||(T=!0,a.resolve(N,B))},function(B){T||(T=!0,a.reject(N,B))});var R;return N}},{immediate:36}],38:[function(r,n,i){var s={};(0,r("./lib/utils/common").assign)(s,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,i){var s=r("./zlib/deflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/messages"),u=r("./zlib/zstream"),l=Object.prototype.toString,h=0,d=-1,f=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var S=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(S!==h)throw new Error(c[S]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var T;if(T=typeof b.dictionary=="string"?a.string2buf(b.dictionary):l.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(S=s.deflateSetDictionary(this.strm,T))!==h)throw new Error(c[S]);this._dict_set=!0}}function g(y,b){var S=new p(b);if(S.push(y,!0),S.err)throw S.msg||c[S.err];return S.result}p.prototype.push=function(y,b){var S,T,x=this.strm,N=this.options.chunkSize;if(this.ended)return!1;T=b===~~b?b:b===!0?4:0,typeof y=="string"?x.input=a.string2buf(y):l.call(y)==="[object ArrayBuffer]"?x.input=new Uint8Array(y):x.input=y,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(N),x.next_out=0,x.avail_out=N),(S=s.deflate(x,T))!==1&&S!==h)return this.onEnd(S),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&S!==1);return T===4?(S=s.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===h):T!==2||(this.onEnd(h),!(x.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=g,i.deflateRaw=function(y,b){return(b=b||{}).raw=!0,g(y,b)},i.gzip=function(y,b){return(b=b||{}).gzip=!0,g(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,i){var s=r("./zlib/inflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/constants"),u=r("./zlib/messages"),l=r("./zlib/zstream"),h=r("./zlib/gzheader"),d=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,g.windowBits);if(y!==c.Z_OK)throw new Error(u[y]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function m(p,g){var y=new f(g);if(y.push(p,!0),y.err)throw y.msg||u[y.err];return y.result}f.prototype.push=function(p,g){var y,b,S,T,x,N,R=this.strm,B=this.options.chunkSize,M=this.options.dictionary,H=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?R.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?R.input=new Uint8Array(p):R.input=p,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8(B),R.next_out=0,R.avail_out=B),(y=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&M&&(N=typeof M=="string"?a.string2buf(M):d.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,y=s.inflateSetDictionary(this.strm,N)),y===c.Z_BUF_ERROR&&H===!0&&(y=c.Z_OK,H=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&y!==c.Z_STREAM_END&&(R.avail_in!==0||b!==c.Z_FINISH&&b!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=a.utf8border(R.output,R.next_out),T=R.next_out-S,x=a.buf2string(R.output,S),R.next_out=T,R.avail_out=B-T,T&&o.arraySet(R.output,R.output,S,T,0),this.onData(x)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(H=!0)}while((0<R.avail_in||R.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(b=c.Z_FINISH),b===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):b!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=m,i.inflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,d){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),d);else for(var f=0;f<h;f++)c[d+f]=u[l+f]},flattenChunks:function(c){var u,l,h,d,f,m;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(m=new Uint8Array(h),u=d=0,l=c.length;u<l;u++)f=c[u],m.set(f,d),d+=f.length;return m}},a={arraySet:function(c,u,l,h,d){for(var f=0;f<h;f++)c[d+f]=u[l+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(r,n,i){var s=r("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",m=0;m<d;m++)f+=String.fromCharCode(h[m]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,m,p,g,y=h.length,b=0;for(p=0;p<y;p++)(64512&(f=h.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=h.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),b+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(b),p=g=0;g<b;p++)(64512&(f=h.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=h.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),f<128?d[g++]=f:(f<2048?d[g++]=192|f>>>6:(f<65536?d[g++]=224|f>>>12:(d[g++]=240|f>>>18,d[g++]=128|f>>>12&63),d[g++]=128|f>>>6&63),d[g++]=128|63&f);return d},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,m=d.length;f<m;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,m,p,g,y=d||h.length,b=new Array(2*y);for(f=m=0;f<y;)if((p=h[f++])<128)b[m++]=p;else if(4<(g=c[p]))b[m++]=65533,f+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&f<y;)p=p<<6|63&h[f++],g--;1<g?b[m++]=65533:p<65536?b[m++]=p:(p-=65536,b[m++]=55296|p>>10&1023,b[m++]=56320|1023&p)}return l(b,m)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(r,n,i){n.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(r,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();n.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var d=u;d<h;d++)o=o>>>8^l[255&(o^a[d])];return-1^o}},{}],46:[function(r,n,i){var s,o=r("../utils/common"),a=r("./trees"),c=r("./adler32"),u=r("./crc32"),l=r("./messages"),h=0,d=4,f=0,m=-2,p=-1,g=4,y=2,b=8,S=9,T=286,x=30,N=19,R=2*T+1,B=15,M=3,H=258,V=H+M+1,O=42,I=113,v=1,L=2,z=3,U=4;function Y(A,ut){return A.msg=l[ut],ut}function X(A){return(A<<1)-(4<A?9:0)}function K(A){for(var ut=A.length;0<=--ut;)A[ut]=0}function W(A){var ut=A.state,nt=ut.pending;nt>A.avail_out&&(nt=A.avail_out),nt!==0&&(o.arraySet(A.output,ut.pending_buf,ut.pending_out,nt,A.next_out),A.next_out+=nt,ut.pending_out+=nt,A.total_out+=nt,A.avail_out-=nt,ut.pending-=nt,ut.pending===0&&(ut.pending_out=0))}function P(A,ut){a._tr_flush_block(A,0<=A.block_start?A.block_start:-1,A.strstart-A.block_start,ut),A.block_start=A.strstart,W(A.strm)}function ot(A,ut){A.pending_buf[A.pending++]=ut}function G(A,ut){A.pending_buf[A.pending++]=ut>>>8&255,A.pending_buf[A.pending++]=255&ut}function rt(A,ut){var nt,j,$=A.max_chain_length,Z=A.strstart,dt=A.prev_length,pt=A.nice_match,it=A.strstart>A.w_size-V?A.strstart-(A.w_size-V):0,gt=A.window,St=A.w_mask,yt=A.prev,Bt=A.strstart+H,ge=gt[Z+dt-1],Zt=gt[Z+dt];A.prev_length>=A.good_match&&($>>=2),pt>A.lookahead&&(pt=A.lookahead);do if(gt[(nt=ut)+dt]===Zt&&gt[nt+dt-1]===ge&&gt[nt]===gt[Z]&&gt[++nt]===gt[Z+1]){Z+=2,nt++;do;while(gt[++Z]===gt[++nt]&&gt[++Z]===gt[++nt]&&gt[++Z]===gt[++nt]&&gt[++Z]===gt[++nt]&&gt[++Z]===gt[++nt]&&gt[++Z]===gt[++nt]&&gt[++Z]===gt[++nt]&&gt[++Z]===gt[++nt]&&Z<Bt);if(j=H-(Bt-Z),Z=Bt-H,dt<j){if(A.match_start=ut,pt<=(dt=j))break;ge=gt[Z+dt-1],Zt=gt[Z+dt]}}while((ut=yt[ut&St])>it&&--$!=0);return dt<=A.lookahead?dt:A.lookahead}function wt(A){var ut,nt,j,$,Z,dt,pt,it,gt,St,yt=A.w_size;do{if($=A.window_size-A.lookahead-A.strstart,A.strstart>=yt+(yt-V)){for(o.arraySet(A.window,A.window,yt,yt,0),A.match_start-=yt,A.strstart-=yt,A.block_start-=yt,ut=nt=A.hash_size;j=A.head[--ut],A.head[ut]=yt<=j?j-yt:0,--nt;);for(ut=nt=yt;j=A.prev[--ut],A.prev[ut]=yt<=j?j-yt:0,--nt;);$+=yt}if(A.strm.avail_in===0)break;if(dt=A.strm,pt=A.window,it=A.strstart+A.lookahead,gt=$,St=void 0,St=dt.avail_in,gt<St&&(St=gt),nt=St===0?0:(dt.avail_in-=St,o.arraySet(pt,dt.input,dt.next_in,St,it),dt.state.wrap===1?dt.adler=c(dt.adler,pt,St,it):dt.state.wrap===2&&(dt.adler=u(dt.adler,pt,St,it)),dt.next_in+=St,dt.total_in+=St,St),A.lookahead+=nt,A.lookahead+A.insert>=M)for(Z=A.strstart-A.insert,A.ins_h=A.window[Z],A.ins_h=(A.ins_h<<A.hash_shift^A.window[Z+1])&A.hash_mask;A.insert&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[Z+M-1])&A.hash_mask,A.prev[Z&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=Z,Z++,A.insert--,!(A.lookahead+A.insert<M)););}while(A.lookahead<V&&A.strm.avail_in!==0)}function Rt(A,ut){for(var nt,j;;){if(A.lookahead<V){if(wt(A),A.lookahead<V&&ut===h)return v;if(A.lookahead===0)break}if(nt=0,A.lookahead>=M&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+M-1])&A.hash_mask,nt=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),nt!==0&&A.strstart-nt<=A.w_size-V&&(A.match_length=rt(A,nt)),A.match_length>=M)if(j=a._tr_tally(A,A.strstart-A.match_start,A.match_length-M),A.lookahead-=A.match_length,A.match_length<=A.max_lazy_match&&A.lookahead>=M){for(A.match_length--;A.strstart++,A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+M-1])&A.hash_mask,nt=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart,--A.match_length!=0;);A.strstart++}else A.strstart+=A.match_length,A.match_length=0,A.ins_h=A.window[A.strstart],A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+1])&A.hash_mask;else j=a._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++;if(j&&(P(A,!1),A.strm.avail_out===0))return v}return A.insert=A.strstart<M-1?A.strstart:M-1,ut===d?(P(A,!0),A.strm.avail_out===0?z:U):A.last_lit&&(P(A,!1),A.strm.avail_out===0)?v:L}function Ct(A,ut){for(var nt,j,$;;){if(A.lookahead<V){if(wt(A),A.lookahead<V&&ut===h)return v;if(A.lookahead===0)break}if(nt=0,A.lookahead>=M&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+M-1])&A.hash_mask,nt=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),A.prev_length=A.match_length,A.prev_match=A.match_start,A.match_length=M-1,nt!==0&&A.prev_length<A.max_lazy_match&&A.strstart-nt<=A.w_size-V&&(A.match_length=rt(A,nt),A.match_length<=5&&(A.strategy===1||A.match_length===M&&4096<A.strstart-A.match_start)&&(A.match_length=M-1)),A.prev_length>=M&&A.match_length<=A.prev_length){for($=A.strstart+A.lookahead-M,j=a._tr_tally(A,A.strstart-1-A.prev_match,A.prev_length-M),A.lookahead-=A.prev_length-1,A.prev_length-=2;++A.strstart<=$&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+M-1])&A.hash_mask,nt=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),--A.prev_length!=0;);if(A.match_available=0,A.match_length=M-1,A.strstart++,j&&(P(A,!1),A.strm.avail_out===0))return v}else if(A.match_available){if((j=a._tr_tally(A,0,A.window[A.strstart-1]))&&P(A,!1),A.strstart++,A.lookahead--,A.strm.avail_out===0)return v}else A.match_available=1,A.strstart++,A.lookahead--}return A.match_available&&(j=a._tr_tally(A,0,A.window[A.strstart-1]),A.match_available=0),A.insert=A.strstart<M-1?A.strstart:M-1,ut===d?(P(A,!0),A.strm.avail_out===0?z:U):A.last_lit&&(P(A,!1),A.strm.avail_out===0)?v:L}function Et(A,ut,nt,j,$){this.good_length=A,this.max_lazy=ut,this.nice_length=nt,this.max_chain=j,this.func=$}function vt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*N+1)),K(this.dyn_ltree),K(this.dyn_dtree),K(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(B+1),this.heap=new o.Buf16(2*T+1),K(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*T+1),K(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function At(A){var ut;return A&&A.state?(A.total_in=A.total_out=0,A.data_type=y,(ut=A.state).pending=0,ut.pending_out=0,ut.wrap<0&&(ut.wrap=-ut.wrap),ut.status=ut.wrap?O:I,A.adler=ut.wrap===2?0:1,ut.last_flush=h,a._tr_init(ut),f):Y(A,m)}function Ut(A){var ut=At(A);return ut===f&&function(nt){nt.window_size=2*nt.w_size,K(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=M-1,nt.match_available=0,nt.ins_h=0}(A.state),ut}function Dt(A,ut,nt,j,$,Z){if(!A)return m;var dt=1;if(ut===p&&(ut=6),j<0?(dt=0,j=-j):15<j&&(dt=2,j-=16),$<1||S<$||nt!==b||j<8||15<j||ut<0||9<ut||Z<0||g<Z)return Y(A,m);j===8&&(j=9);var pt=new vt;return(A.state=pt).strm=A,pt.wrap=dt,pt.gzhead=null,pt.w_bits=j,pt.w_size=1<<pt.w_bits,pt.w_mask=pt.w_size-1,pt.hash_bits=$+7,pt.hash_size=1<<pt.hash_bits,pt.hash_mask=pt.hash_size-1,pt.hash_shift=~~((pt.hash_bits+M-1)/M),pt.window=new o.Buf8(2*pt.w_size),pt.head=new o.Buf16(pt.hash_size),pt.prev=new o.Buf16(pt.w_size),pt.lit_bufsize=1<<$+6,pt.pending_buf_size=4*pt.lit_bufsize,pt.pending_buf=new o.Buf8(pt.pending_buf_size),pt.d_buf=1*pt.lit_bufsize,pt.l_buf=3*pt.lit_bufsize,pt.level=ut,pt.strategy=Z,pt.method=nt,Ut(A)}s=[new Et(0,0,0,0,function(A,ut){var nt=65535;for(nt>A.pending_buf_size-5&&(nt=A.pending_buf_size-5);;){if(A.lookahead<=1){if(wt(A),A.lookahead===0&&ut===h)return v;if(A.lookahead===0)break}A.strstart+=A.lookahead,A.lookahead=0;var j=A.block_start+nt;if((A.strstart===0||A.strstart>=j)&&(A.lookahead=A.strstart-j,A.strstart=j,P(A,!1),A.strm.avail_out===0)||A.strstart-A.block_start>=A.w_size-V&&(P(A,!1),A.strm.avail_out===0))return v}return A.insert=0,ut===d?(P(A,!0),A.strm.avail_out===0?z:U):(A.strstart>A.block_start&&(P(A,!1),A.strm.avail_out),v)}),new Et(4,4,8,4,Rt),new Et(4,5,16,8,Rt),new Et(4,6,32,32,Rt),new Et(4,4,16,16,Ct),new Et(8,16,32,32,Ct),new Et(8,16,128,128,Ct),new Et(8,32,128,256,Ct),new Et(32,128,258,1024,Ct),new Et(32,258,258,4096,Ct)],i.deflateInit=function(A,ut){return Dt(A,ut,b,15,8,0)},i.deflateInit2=Dt,i.deflateReset=Ut,i.deflateResetKeep=At,i.deflateSetHeader=function(A,ut){return A&&A.state?A.state.wrap!==2?m:(A.state.gzhead=ut,f):m},i.deflate=function(A,ut){var nt,j,$,Z;if(!A||!A.state||5<ut||ut<0)return A?Y(A,m):m;if(j=A.state,!A.output||!A.input&&A.avail_in!==0||j.status===666&&ut!==d)return Y(A,A.avail_out===0?-5:m);if(j.strm=A,nt=j.last_flush,j.last_flush=ut,j.status===O)if(j.wrap===2)A.adler=0,ot(j,31),ot(j,139),ot(j,8),j.gzhead?(ot(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),ot(j,255&j.gzhead.time),ot(j,j.gzhead.time>>8&255),ot(j,j.gzhead.time>>16&255),ot(j,j.gzhead.time>>24&255),ot(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),ot(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(ot(j,255&j.gzhead.extra.length),ot(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(A.adler=u(A.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(ot(j,0),ot(j,0),ot(j,0),ot(j,0),ot(j,0),ot(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),ot(j,3),j.status=I);else{var dt=b+(j.w_bits-8<<4)<<8;dt|=(2<=j.strategy||j.level<2?0:j.level<6?1:j.level===6?2:3)<<6,j.strstart!==0&&(dt|=32),dt+=31-dt%31,j.status=I,G(j,dt),j.strstart!==0&&(G(j,A.adler>>>16),G(j,65535&A.adler)),A.adler=1}if(j.status===69)if(j.gzhead.extra){for($=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>$&&(A.adler=u(A.adler,j.pending_buf,j.pending-$,$)),W(A),$=j.pending,j.pending!==j.pending_buf_size));)ot(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>$&&(A.adler=u(A.adler,j.pending_buf,j.pending-$,$)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(j.status===73)if(j.gzhead.name){$=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>$&&(A.adler=u(A.adler,j.pending_buf,j.pending-$,$)),W(A),$=j.pending,j.pending===j.pending_buf_size)){Z=1;break}Z=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,ot(j,Z)}while(Z!==0);j.gzhead.hcrc&&j.pending>$&&(A.adler=u(A.adler,j.pending_buf,j.pending-$,$)),Z===0&&(j.gzindex=0,j.status=91)}else j.status=91;if(j.status===91)if(j.gzhead.comment){$=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>$&&(A.adler=u(A.adler,j.pending_buf,j.pending-$,$)),W(A),$=j.pending,j.pending===j.pending_buf_size)){Z=1;break}Z=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,ot(j,Z)}while(Z!==0);j.gzhead.hcrc&&j.pending>$&&(A.adler=u(A.adler,j.pending_buf,j.pending-$,$)),Z===0&&(j.status=103)}else j.status=103;if(j.status===103&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&W(A),j.pending+2<=j.pending_buf_size&&(ot(j,255&A.adler),ot(j,A.adler>>8&255),A.adler=0,j.status=I)):j.status=I),j.pending!==0){if(W(A),A.avail_out===0)return j.last_flush=-1,f}else if(A.avail_in===0&&X(ut)<=X(nt)&&ut!==d)return Y(A,-5);if(j.status===666&&A.avail_in!==0)return Y(A,-5);if(A.avail_in!==0||j.lookahead!==0||ut!==h&&j.status!==666){var pt=j.strategy===2?function(it,gt){for(var St;;){if(it.lookahead===0&&(wt(it),it.lookahead===0)){if(gt===h)return v;break}if(it.match_length=0,St=a._tr_tally(it,0,it.window[it.strstart]),it.lookahead--,it.strstart++,St&&(P(it,!1),it.strm.avail_out===0))return v}return it.insert=0,gt===d?(P(it,!0),it.strm.avail_out===0?z:U):it.last_lit&&(P(it,!1),it.strm.avail_out===0)?v:L}(j,ut):j.strategy===3?function(it,gt){for(var St,yt,Bt,ge,Zt=it.window;;){if(it.lookahead<=H){if(wt(it),it.lookahead<=H&&gt===h)return v;if(it.lookahead===0)break}if(it.match_length=0,it.lookahead>=M&&0<it.strstart&&(yt=Zt[Bt=it.strstart-1])===Zt[++Bt]&&yt===Zt[++Bt]&&yt===Zt[++Bt]){ge=it.strstart+H;do;while(yt===Zt[++Bt]&&yt===Zt[++Bt]&&yt===Zt[++Bt]&&yt===Zt[++Bt]&&yt===Zt[++Bt]&&yt===Zt[++Bt]&&yt===Zt[++Bt]&&yt===Zt[++Bt]&&Bt<ge);it.match_length=H-(ge-Bt),it.match_length>it.lookahead&&(it.match_length=it.lookahead)}if(it.match_length>=M?(St=a._tr_tally(it,1,it.match_length-M),it.lookahead-=it.match_length,it.strstart+=it.match_length,it.match_length=0):(St=a._tr_tally(it,0,it.window[it.strstart]),it.lookahead--,it.strstart++),St&&(P(it,!1),it.strm.avail_out===0))return v}return it.insert=0,gt===d?(P(it,!0),it.strm.avail_out===0?z:U):it.last_lit&&(P(it,!1),it.strm.avail_out===0)?v:L}(j,ut):s[j.level].func(j,ut);if(pt!==z&&pt!==U||(j.status=666),pt===v||pt===z)return A.avail_out===0&&(j.last_flush=-1),f;if(pt===L&&(ut===1?a._tr_align(j):ut!==5&&(a._tr_stored_block(j,0,0,!1),ut===3&&(K(j.head),j.lookahead===0&&(j.strstart=0,j.block_start=0,j.insert=0))),W(A),A.avail_out===0))return j.last_flush=-1,f}return ut!==d?f:j.wrap<=0?1:(j.wrap===2?(ot(j,255&A.adler),ot(j,A.adler>>8&255),ot(j,A.adler>>16&255),ot(j,A.adler>>24&255),ot(j,255&A.total_in),ot(j,A.total_in>>8&255),ot(j,A.total_in>>16&255),ot(j,A.total_in>>24&255)):(G(j,A.adler>>>16),G(j,65535&A.adler)),W(A),0<j.wrap&&(j.wrap=-j.wrap),j.pending!==0?f:1)},i.deflateEnd=function(A){var ut;return A&&A.state?(ut=A.state.status)!==O&&ut!==69&&ut!==73&&ut!==91&&ut!==103&&ut!==I&&ut!==666?Y(A,m):(A.state=null,ut===I?Y(A,-3):f):m},i.deflateSetDictionary=function(A,ut){var nt,j,$,Z,dt,pt,it,gt,St=ut.length;if(!A||!A.state||(Z=(nt=A.state).wrap)===2||Z===1&&nt.status!==O||nt.lookahead)return m;for(Z===1&&(A.adler=c(A.adler,ut,St,0)),nt.wrap=0,St>=nt.w_size&&(Z===0&&(K(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),gt=new o.Buf8(nt.w_size),o.arraySet(gt,ut,St-nt.w_size,nt.w_size,0),ut=gt,St=nt.w_size),dt=A.avail_in,pt=A.next_in,it=A.input,A.avail_in=St,A.next_in=0,A.input=ut,wt(nt);nt.lookahead>=M;){for(j=nt.strstart,$=nt.lookahead-(M-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[j+M-1])&nt.hash_mask,nt.prev[j&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=j,j++,--$;);nt.strstart=j,nt.lookahead=M-1,wt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=M-1,nt.match_available=0,A.next_in=pt,A.input=it,A.avail_in=dt,nt.wrap=Z,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,n,i){n.exports=function(s,o){var a,c,u,l,h,d,f,m,p,g,y,b,S,T,x,N,R,B,M,H,V,O,I,v,L;a=s.state,c=s.next_in,v=s.input,u=c+(s.avail_in-5),l=s.next_out,L=s.output,h=l-(o-s.avail_out),d=l+(s.avail_out-257),f=a.dmax,m=a.wsize,p=a.whave,g=a.wnext,y=a.window,b=a.hold,S=a.bits,T=a.lencode,x=a.distcode,N=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;t:do{S<15&&(b+=v[c++]<<S,S+=8,b+=v[c++]<<S,S+=8),B=T[b&N];e:for(;;){if(b>>>=M=B>>>24,S-=M,(M=B>>>16&255)===0)L[l++]=65535&B;else{if(!(16&M)){if(!(64&M)){B=T[(65535&B)+(b&(1<<M)-1)];continue e}if(32&M){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}H=65535&B,(M&=15)&&(S<M&&(b+=v[c++]<<S,S+=8),H+=b&(1<<M)-1,b>>>=M,S-=M),S<15&&(b+=v[c++]<<S,S+=8,b+=v[c++]<<S,S+=8),B=x[b&R];r:for(;;){if(b>>>=M=B>>>24,S-=M,!(16&(M=B>>>16&255))){if(!(64&M)){B=x[(65535&B)+(b&(1<<M)-1)];continue r}s.msg="invalid distance code",a.mode=30;break t}if(V=65535&B,S<(M&=15)&&(b+=v[c++]<<S,(S+=8)<M&&(b+=v[c++]<<S,S+=8)),f<(V+=b&(1<<M)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(b>>>=M,S-=M,(M=l-h)<V){if(p<(M=V-M)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(I=y,(O=0)===g){if(O+=m-M,M<H){for(H-=M;L[l++]=y[O++],--M;);O=l-V,I=L}}else if(g<M){if(O+=m+g-M,(M-=g)<H){for(H-=M;L[l++]=y[O++],--M;);if(O=0,g<H){for(H-=M=g;L[l++]=y[O++],--M;);O=l-V,I=L}}}else if(O+=g-M,M<H){for(H-=M;L[l++]=y[O++],--M;);O=l-V,I=L}for(;2<H;)L[l++]=I[O++],L[l++]=I[O++],L[l++]=I[O++],H-=3;H&&(L[l++]=I[O++],1<H&&(L[l++]=I[O++]))}else{for(O=l-V;L[l++]=L[O++],L[l++]=L[O++],L[l++]=L[O++],2<(H-=3););H&&(L[l++]=L[O++],1<H&&(L[l++]=L[O++]))}break}}break}}while(c<u&&l<d);c-=H=S>>3,b&=(1<<(S-=H<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<d?d-l+257:257-(l-d),a.hold=b,a.bits=S}},{}],49:[function(r,n,i){var s=r("../utils/common"),o=r("./adler32"),a=r("./crc32"),c=r("./inffast"),u=r("./inftrees"),l=1,h=2,d=0,f=-2,m=1,p=852,g=592;function y(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(O){var I;return O&&O.state?(I=O.state,O.total_in=O.total_out=I.total=0,O.msg="",I.wrap&&(O.adler=1&I.wrap),I.mode=m,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new s.Buf32(p),I.distcode=I.distdyn=new s.Buf32(g),I.sane=1,I.back=-1,d):f}function T(O){var I;return O&&O.state?((I=O.state).wsize=0,I.whave=0,I.wnext=0,S(O)):f}function x(O,I){var v,L;return O&&O.state?(L=O.state,I<0?(v=0,I=-I):(v=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?f:(L.window!==null&&L.wbits!==I&&(L.window=null),L.wrap=v,L.wbits=I,T(O))):f}function N(O,I){var v,L;return O?(L=new b,(O.state=L).window=null,(v=x(O,I))!==d&&(O.state=null),v):f}var R,B,M=!0;function H(O){if(M){var I;for(R=new s.Buf32(512),B=new s.Buf32(32),I=0;I<144;)O.lens[I++]=8;for(;I<256;)O.lens[I++]=9;for(;I<280;)O.lens[I++]=7;for(;I<288;)O.lens[I++]=8;for(u(l,O.lens,0,288,R,0,O.work,{bits:9}),I=0;I<32;)O.lens[I++]=5;u(h,O.lens,0,32,B,0,O.work,{bits:5}),M=!1}O.lencode=R,O.lenbits=9,O.distcode=B,O.distbits=5}function V(O,I,v,L){var z,U=O.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new s.Buf8(U.wsize)),L>=U.wsize?(s.arraySet(U.window,I,v-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(L<(z=U.wsize-U.wnext)&&(z=L),s.arraySet(U.window,I,v-L,z,U.wnext),(L-=z)?(s.arraySet(U.window,I,v-L,L,0),U.wnext=L,U.whave=U.wsize):(U.wnext+=z,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=z))),0}i.inflateReset=T,i.inflateReset2=x,i.inflateResetKeep=S,i.inflateInit=function(O){return N(O,15)},i.inflateInit2=N,i.inflate=function(O,I){var v,L,z,U,Y,X,K,W,P,ot,G,rt,wt,Rt,Ct,Et,vt,At,Ut,Dt,A,ut,nt,j,$=0,Z=new s.Buf8(4),dt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return f;(v=O.state).mode===12&&(v.mode=13),Y=O.next_out,z=O.output,K=O.avail_out,U=O.next_in,L=O.input,X=O.avail_in,W=v.hold,P=v.bits,ot=X,G=K,ut=d;t:for(;;)switch(v.mode){case m:if(v.wrap===0){v.mode=13;break}for(;P<16;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(2&v.wrap&&W===35615){Z[v.check=0]=255&W,Z[1]=W>>>8&255,v.check=a(v.check,Z,2,0),P=W=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&W)<<8)+(W>>8))%31){O.msg="incorrect header check",v.mode=30;break}if((15&W)!=8){O.msg="unknown compression method",v.mode=30;break}if(P-=4,A=8+(15&(W>>>=4)),v.wbits===0)v.wbits=A;else if(A>v.wbits){O.msg="invalid window size",v.mode=30;break}v.dmax=1<<A,O.adler=v.check=1,v.mode=512&W?10:12,P=W=0;break;case 2:for(;P<16;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(v.flags=W,(255&v.flags)!=8){O.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){O.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=W>>8&1),512&v.flags&&(Z[0]=255&W,Z[1]=W>>>8&255,v.check=a(v.check,Z,2,0)),P=W=0,v.mode=3;case 3:for(;P<32;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}v.head&&(v.head.time=W),512&v.flags&&(Z[0]=255&W,Z[1]=W>>>8&255,Z[2]=W>>>16&255,Z[3]=W>>>24&255,v.check=a(v.check,Z,4,0)),P=W=0,v.mode=4;case 4:for(;P<16;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}v.head&&(v.head.xflags=255&W,v.head.os=W>>8),512&v.flags&&(Z[0]=255&W,Z[1]=W>>>8&255,v.check=a(v.check,Z,2,0)),P=W=0,v.mode=5;case 5:if(1024&v.flags){for(;P<16;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}v.length=W,v.head&&(v.head.extra_len=W),512&v.flags&&(Z[0]=255&W,Z[1]=W>>>8&255,v.check=a(v.check,Z,2,0)),P=W=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(X<(rt=v.length)&&(rt=X),rt&&(v.head&&(A=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),s.arraySet(v.head.extra,L,U,rt,A)),512&v.flags&&(v.check=a(v.check,L,rt,U)),X-=rt,U+=rt,v.length-=rt),v.length))break t;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(X===0)break t;for(rt=0;A=L[U+rt++],v.head&&A&&v.length<65536&&(v.head.name+=String.fromCharCode(A)),A&&rt<X;);if(512&v.flags&&(v.check=a(v.check,L,rt,U)),X-=rt,U+=rt,A)break t}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(X===0)break t;for(rt=0;A=L[U+rt++],v.head&&A&&v.length<65536&&(v.head.comment+=String.fromCharCode(A)),A&&rt<X;);if(512&v.flags&&(v.check=a(v.check,L,rt,U)),X-=rt,U+=rt,A)break t}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;P<16;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(W!==(65535&v.check)){O.msg="header crc mismatch",v.mode=30;break}P=W=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),O.adler=v.check=0,v.mode=12;break;case 10:for(;P<32;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}O.adler=v.check=y(W),P=W=0,v.mode=11;case 11:if(v.havedict===0)return O.next_out=Y,O.avail_out=K,O.next_in=U,O.avail_in=X,v.hold=W,v.bits=P,2;O.adler=v.check=1,v.mode=12;case 12:if(I===5||I===6)break t;case 13:if(v.last){W>>>=7&P,P-=7&P,v.mode=27;break}for(;P<3;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}switch(v.last=1&W,P-=1,3&(W>>>=1)){case 0:v.mode=14;break;case 1:if(H(v),v.mode=20,I!==6)break;W>>>=2,P-=2;break t;case 2:v.mode=17;break;case 3:O.msg="invalid block type",v.mode=30}W>>>=2,P-=2;break;case 14:for(W>>>=7&P,P-=7&P;P<32;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if((65535&W)!=(W>>>16^65535)){O.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&W,P=W=0,v.mode=15,I===6)break t;case 15:v.mode=16;case 16:if(rt=v.length){if(X<rt&&(rt=X),K<rt&&(rt=K),rt===0)break t;s.arraySet(z,L,U,rt,Y),X-=rt,U+=rt,K-=rt,Y+=rt,v.length-=rt;break}v.mode=12;break;case 17:for(;P<14;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(v.nlen=257+(31&W),W>>>=5,P-=5,v.ndist=1+(31&W),W>>>=5,P-=5,v.ncode=4+(15&W),W>>>=4,P-=4,286<v.nlen||30<v.ndist){O.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;P<3;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}v.lens[dt[v.have++]]=7&W,W>>>=3,P-=3}for(;v.have<19;)v.lens[dt[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,nt={bits:v.lenbits},ut=u(0,v.lens,0,19,v.lencode,0,v.work,nt),v.lenbits=nt.bits,ut){O.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;Et=($=v.lencode[W&(1<<v.lenbits)-1])>>>16&255,vt=65535&$,!((Ct=$>>>24)<=P);){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(vt<16)W>>>=Ct,P-=Ct,v.lens[v.have++]=vt;else{if(vt===16){for(j=Ct+2;P<j;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(W>>>=Ct,P-=Ct,v.have===0){O.msg="invalid bit length repeat",v.mode=30;break}A=v.lens[v.have-1],rt=3+(3&W),W>>>=2,P-=2}else if(vt===17){for(j=Ct+3;P<j;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}P-=Ct,A=0,rt=3+(7&(W>>>=Ct)),W>>>=3,P-=3}else{for(j=Ct+7;P<j;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}P-=Ct,A=0,rt=11+(127&(W>>>=Ct)),W>>>=7,P-=7}if(v.have+rt>v.nlen+v.ndist){O.msg="invalid bit length repeat",v.mode=30;break}for(;rt--;)v.lens[v.have++]=A}}if(v.mode===30)break;if(v.lens[256]===0){O.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,nt={bits:v.lenbits},ut=u(l,v.lens,0,v.nlen,v.lencode,0,v.work,nt),v.lenbits=nt.bits,ut){O.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,nt={bits:v.distbits},ut=u(h,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,nt),v.distbits=nt.bits,ut){O.msg="invalid distances set",v.mode=30;break}if(v.mode=20,I===6)break t;case 20:v.mode=21;case 21:if(6<=X&&258<=K){O.next_out=Y,O.avail_out=K,O.next_in=U,O.avail_in=X,v.hold=W,v.bits=P,c(O,G),Y=O.next_out,z=O.output,K=O.avail_out,U=O.next_in,L=O.input,X=O.avail_in,W=v.hold,P=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;Et=($=v.lencode[W&(1<<v.lenbits)-1])>>>16&255,vt=65535&$,!((Ct=$>>>24)<=P);){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(Et&&!(240&Et)){for(At=Ct,Ut=Et,Dt=vt;Et=($=v.lencode[Dt+((W&(1<<At+Ut)-1)>>At)])>>>16&255,vt=65535&$,!(At+(Ct=$>>>24)<=P);){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}W>>>=At,P-=At,v.back+=At}if(W>>>=Ct,P-=Ct,v.back+=Ct,v.length=vt,Et===0){v.mode=26;break}if(32&Et){v.back=-1,v.mode=12;break}if(64&Et){O.msg="invalid literal/length code",v.mode=30;break}v.extra=15&Et,v.mode=22;case 22:if(v.extra){for(j=v.extra;P<j;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}v.length+=W&(1<<v.extra)-1,W>>>=v.extra,P-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;Et=($=v.distcode[W&(1<<v.distbits)-1])>>>16&255,vt=65535&$,!((Ct=$>>>24)<=P);){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(!(240&Et)){for(At=Ct,Ut=Et,Dt=vt;Et=($=v.distcode[Dt+((W&(1<<At+Ut)-1)>>At)])>>>16&255,vt=65535&$,!(At+(Ct=$>>>24)<=P);){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}W>>>=At,P-=At,v.back+=At}if(W>>>=Ct,P-=Ct,v.back+=Ct,64&Et){O.msg="invalid distance code",v.mode=30;break}v.offset=vt,v.extra=15&Et,v.mode=24;case 24:if(v.extra){for(j=v.extra;P<j;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}v.offset+=W&(1<<v.extra)-1,W>>>=v.extra,P-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){O.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(K===0)break t;if(rt=G-K,v.offset>rt){if((rt=v.offset-rt)>v.whave&&v.sane){O.msg="invalid distance too far back",v.mode=30;break}wt=rt>v.wnext?(rt-=v.wnext,v.wsize-rt):v.wnext-rt,rt>v.length&&(rt=v.length),Rt=v.window}else Rt=z,wt=Y-v.offset,rt=v.length;for(K<rt&&(rt=K),K-=rt,v.length-=rt;z[Y++]=Rt[wt++],--rt;);v.length===0&&(v.mode=21);break;case 26:if(K===0)break t;z[Y++]=v.length,K--,v.mode=21;break;case 27:if(v.wrap){for(;P<32;){if(X===0)break t;X--,W|=L[U++]<<P,P+=8}if(G-=K,O.total_out+=G,v.total+=G,G&&(O.adler=v.check=v.flags?a(v.check,z,G,Y-G):o(v.check,z,G,Y-G)),G=K,(v.flags?W:y(W))!==v.check){O.msg="incorrect data check",v.mode=30;break}P=W=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;P<32;){if(X===0)break t;X--,W+=L[U++]<<P,P+=8}if(W!==(4294967295&v.total)){O.msg="incorrect length check",v.mode=30;break}P=W=0}v.mode=29;case 29:ut=1;break t;case 30:ut=-3;break t;case 31:return-4;case 32:default:return f}return O.next_out=Y,O.avail_out=K,O.next_in=U,O.avail_in=X,v.hold=W,v.bits=P,(v.wsize||G!==O.avail_out&&v.mode<30&&(v.mode<27||I!==4))&&V(O,O.output,O.next_out,G-O.avail_out)?(v.mode=31,-4):(ot-=O.avail_in,G-=O.avail_out,O.total_in+=ot,O.total_out+=G,v.total+=G,v.wrap&&G&&(O.adler=v.check=v.flags?a(v.check,z,G,O.next_out-G):o(v.check,z,G,O.next_out-G)),O.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(ot==0&&G===0||I===4)&&ut===d&&(ut=-5),ut)},i.inflateEnd=function(O){if(!O||!O.state)return f;var I=O.state;return I.window&&(I.window=null),O.state=null,d},i.inflateGetHeader=function(O,I){var v;return O&&O.state&&2&(v=O.state).wrap?((v.head=I).done=!1,d):f},i.inflateSetDictionary=function(O,I){var v,L=I.length;return O&&O.state?(v=O.state).wrap!==0&&v.mode!==11?f:v.mode===11&&o(1,I,L,0)!==v.check?-3:V(O,I,L,L)?(v.mode=31,-4):(v.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,i){var s=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(l,h,d,f,m,p,g,y){var b,S,T,x,N,R,B,M,H,V=y.bits,O=0,I=0,v=0,L=0,z=0,U=0,Y=0,X=0,K=0,W=0,P=null,ot=0,G=new s.Buf16(16),rt=new s.Buf16(16),wt=null,Rt=0;for(O=0;O<=15;O++)G[O]=0;for(I=0;I<f;I++)G[h[d+I]]++;for(z=V,L=15;1<=L&&G[L]===0;L--);if(L<z&&(z=L),L===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(v=1;v<L&&G[v]===0;v++);for(z<v&&(z=v),O=X=1;O<=15;O++)if(X<<=1,(X-=G[O])<0)return-1;if(0<X&&(l===0||L!==1))return-1;for(rt[1]=0,O=1;O<15;O++)rt[O+1]=rt[O]+G[O];for(I=0;I<f;I++)h[d+I]!==0&&(g[rt[h[d+I]]++]=I);if(R=l===0?(P=wt=g,19):l===1?(P=o,ot-=257,wt=a,Rt-=257,256):(P=c,wt=u,-1),O=v,N=p,Y=I=W=0,T=-1,x=(K=1<<(U=z))-1,l===1&&852<K||l===2&&592<K)return 1;for(;;){for(B=O-Y,H=g[I]<R?(M=0,g[I]):g[I]>R?(M=wt[Rt+g[I]],P[ot+g[I]]):(M=96,0),b=1<<O-Y,v=S=1<<U;m[N+(W>>Y)+(S-=b)]=B<<24|M<<16|H|0,S!==0;);for(b=1<<O-1;W&b;)b>>=1;if(b!==0?(W&=b-1,W+=b):W=0,I++,--G[O]==0){if(O===L)break;O=h[d+g[I]]}if(z<O&&(W&x)!==T){for(Y===0&&(Y=z),N+=v,X=1<<(U=O-Y);U+Y<L&&!((X-=G[U+Y])<=0);)U++,X<<=1;if(K+=1<<U,l===1&&852<K||l===2&&592<K)return 1;m[T=W&x]=z<<24|U<<16|N-p|0}}return W!==0&&(m[N+W]=O-Y<<24|64<<16|0),y.bits=z,0}},{"../utils/common":41}],51:[function(r,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,i){var s=r("../utils/common"),o=0,a=1;function c($){for(var Z=$.length;0<=--Z;)$[Z]=0}var u=0,l=29,h=256,d=h+1+l,f=30,m=19,p=2*d+1,g=15,y=16,b=7,S=256,T=16,x=17,N=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(d+2));c(V);var O=new Array(2*f);c(O);var I=new Array(512);c(I);var v=new Array(256);c(v);var L=new Array(l);c(L);var z,U,Y,X=new Array(f);function K($,Z,dt,pt,it){this.static_tree=$,this.extra_bits=Z,this.extra_base=dt,this.elems=pt,this.max_length=it,this.has_stree=$&&$.length}function W($,Z){this.dyn_tree=$,this.max_code=0,this.stat_desc=Z}function P($){return $<256?I[$]:I[256+($>>>7)]}function ot($,Z){$.pending_buf[$.pending++]=255&Z,$.pending_buf[$.pending++]=Z>>>8&255}function G($,Z,dt){$.bi_valid>y-dt?($.bi_buf|=Z<<$.bi_valid&65535,ot($,$.bi_buf),$.bi_buf=Z>>y-$.bi_valid,$.bi_valid+=dt-y):($.bi_buf|=Z<<$.bi_valid&65535,$.bi_valid+=dt)}function rt($,Z,dt){G($,dt[2*Z],dt[2*Z+1])}function wt($,Z){for(var dt=0;dt|=1&$,$>>>=1,dt<<=1,0<--Z;);return dt>>>1}function Rt($,Z,dt){var pt,it,gt=new Array(g+1),St=0;for(pt=1;pt<=g;pt++)gt[pt]=St=St+dt[pt-1]<<1;for(it=0;it<=Z;it++){var yt=$[2*it+1];yt!==0&&($[2*it]=wt(gt[yt]++,yt))}}function Ct($){var Z;for(Z=0;Z<d;Z++)$.dyn_ltree[2*Z]=0;for(Z=0;Z<f;Z++)$.dyn_dtree[2*Z]=0;for(Z=0;Z<m;Z++)$.bl_tree[2*Z]=0;$.dyn_ltree[2*S]=1,$.opt_len=$.static_len=0,$.last_lit=$.matches=0}function Et($){8<$.bi_valid?ot($,$.bi_buf):0<$.bi_valid&&($.pending_buf[$.pending++]=$.bi_buf),$.bi_buf=0,$.bi_valid=0}function vt($,Z,dt,pt){var it=2*Z,gt=2*dt;return $[it]<$[gt]||$[it]===$[gt]&&pt[Z]<=pt[dt]}function At($,Z,dt){for(var pt=$.heap[dt],it=dt<<1;it<=$.heap_len&&(it<$.heap_len&&vt(Z,$.heap[it+1],$.heap[it],$.depth)&&it++,!vt(Z,pt,$.heap[it],$.depth));)$.heap[dt]=$.heap[it],dt=it,it<<=1;$.heap[dt]=pt}function Ut($,Z,dt){var pt,it,gt,St,yt=0;if($.last_lit!==0)for(;pt=$.pending_buf[$.d_buf+2*yt]<<8|$.pending_buf[$.d_buf+2*yt+1],it=$.pending_buf[$.l_buf+yt],yt++,pt===0?rt($,it,Z):(rt($,(gt=v[it])+h+1,Z),(St=R[gt])!==0&&G($,it-=L[gt],St),rt($,gt=P(--pt),dt),(St=B[gt])!==0&&G($,pt-=X[gt],St)),yt<$.last_lit;);rt($,S,Z)}function Dt($,Z){var dt,pt,it,gt=Z.dyn_tree,St=Z.stat_desc.static_tree,yt=Z.stat_desc.has_stree,Bt=Z.stat_desc.elems,ge=-1;for($.heap_len=0,$.heap_max=p,dt=0;dt<Bt;dt++)gt[2*dt]!==0?($.heap[++$.heap_len]=ge=dt,$.depth[dt]=0):gt[2*dt+1]=0;for(;$.heap_len<2;)gt[2*(it=$.heap[++$.heap_len]=ge<2?++ge:0)]=1,$.depth[it]=0,$.opt_len--,yt&&($.static_len-=St[2*it+1]);for(Z.max_code=ge,dt=$.heap_len>>1;1<=dt;dt--)At($,gt,dt);for(it=Bt;dt=$.heap[1],$.heap[1]=$.heap[$.heap_len--],At($,gt,1),pt=$.heap[1],$.heap[--$.heap_max]=dt,$.heap[--$.heap_max]=pt,gt[2*it]=gt[2*dt]+gt[2*pt],$.depth[it]=($.depth[dt]>=$.depth[pt]?$.depth[dt]:$.depth[pt])+1,gt[2*dt+1]=gt[2*pt+1]=it,$.heap[1]=it++,At($,gt,1),2<=$.heap_len;);$.heap[--$.heap_max]=$.heap[1],function(Zt,Ze){var C,_,E,F,q,ct,D=Ze.dyn_tree,tt=Ze.max_code,jt=Ze.stat_desc.static_tree,Ht=Ze.stat_desc.has_stree,qt=Ze.stat_desc.extra_bits,Lt=Ze.stat_desc.extra_base,Qr=Ze.stat_desc.max_length,In=0;for(F=0;F<=g;F++)Zt.bl_count[F]=0;for(D[2*Zt.heap[Zt.heap_max]+1]=0,C=Zt.heap_max+1;C<p;C++)Qr<(F=D[2*D[2*(_=Zt.heap[C])+1]+1]+1)&&(F=Qr,In++),D[2*_+1]=F,tt<_||(Zt.bl_count[F]++,q=0,Lt<=_&&(q=qt[_-Lt]),ct=D[2*_],Zt.opt_len+=ct*(F+q),Ht&&(Zt.static_len+=ct*(jt[2*_+1]+q)));if(In!==0){do{for(F=Qr-1;Zt.bl_count[F]===0;)F--;Zt.bl_count[F]--,Zt.bl_count[F+1]+=2,Zt.bl_count[Qr]--,In-=2}while(0<In);for(F=Qr;F!==0;F--)for(_=Zt.bl_count[F];_!==0;)tt<(E=Zt.heap[--C])||(D[2*E+1]!==F&&(Zt.opt_len+=(F-D[2*E+1])*D[2*E],D[2*E+1]=F),_--)}}($,Z),Rt(gt,ge,$.bl_count)}function A($,Z,dt){var pt,it,gt=-1,St=Z[1],yt=0,Bt=7,ge=4;for(St===0&&(Bt=138,ge=3),Z[2*(dt+1)+1]=65535,pt=0;pt<=dt;pt++)it=St,St=Z[2*(pt+1)+1],++yt<Bt&&it===St||(yt<ge?$.bl_tree[2*it]+=yt:it!==0?(it!==gt&&$.bl_tree[2*it]++,$.bl_tree[2*T]++):yt<=10?$.bl_tree[2*x]++:$.bl_tree[2*N]++,gt=it,ge=(yt=0)===St?(Bt=138,3):it===St?(Bt=6,3):(Bt=7,4))}function ut($,Z,dt){var pt,it,gt=-1,St=Z[1],yt=0,Bt=7,ge=4;for(St===0&&(Bt=138,ge=3),pt=0;pt<=dt;pt++)if(it=St,St=Z[2*(pt+1)+1],!(++yt<Bt&&it===St)){if(yt<ge)for(;rt($,it,$.bl_tree),--yt!=0;);else it!==0?(it!==gt&&(rt($,it,$.bl_tree),yt--),rt($,T,$.bl_tree),G($,yt-3,2)):yt<=10?(rt($,x,$.bl_tree),G($,yt-3,3)):(rt($,N,$.bl_tree),G($,yt-11,7));gt=it,ge=(yt=0)===St?(Bt=138,3):it===St?(Bt=6,3):(Bt=7,4)}}c(X);var nt=!1;function j($,Z,dt,pt){G($,(u<<1)+(pt?1:0),3),function(it,gt,St,yt){Et(it),ot(it,St),ot(it,~St),s.arraySet(it.pending_buf,it.window,gt,St,it.pending),it.pending+=St}($,Z,dt)}i._tr_init=function($){nt||(function(){var Z,dt,pt,it,gt,St=new Array(g+1);for(it=pt=0;it<l-1;it++)for(L[it]=pt,Z=0;Z<1<<R[it];Z++)v[pt++]=it;for(v[pt-1]=it,it=gt=0;it<16;it++)for(X[it]=gt,Z=0;Z<1<<B[it];Z++)I[gt++]=it;for(gt>>=7;it<f;it++)for(X[it]=gt<<7,Z=0;Z<1<<B[it]-7;Z++)I[256+gt++]=it;for(dt=0;dt<=g;dt++)St[dt]=0;for(Z=0;Z<=143;)V[2*Z+1]=8,Z++,St[8]++;for(;Z<=255;)V[2*Z+1]=9,Z++,St[9]++;for(;Z<=279;)V[2*Z+1]=7,Z++,St[7]++;for(;Z<=287;)V[2*Z+1]=8,Z++,St[8]++;for(Rt(V,d+1,St),Z=0;Z<f;Z++)O[2*Z+1]=5,O[2*Z]=wt(Z,5);z=new K(V,R,h+1,d,g),U=new K(O,B,0,f,g),Y=new K(new Array(0),M,0,m,b)}(),nt=!0),$.l_desc=new W($.dyn_ltree,z),$.d_desc=new W($.dyn_dtree,U),$.bl_desc=new W($.bl_tree,Y),$.bi_buf=0,$.bi_valid=0,Ct($)},i._tr_stored_block=j,i._tr_flush_block=function($,Z,dt,pt){var it,gt,St=0;0<$.level?($.strm.data_type===2&&($.strm.data_type=function(yt){var Bt,ge=4093624447;for(Bt=0;Bt<=31;Bt++,ge>>>=1)if(1&ge&&yt.dyn_ltree[2*Bt]!==0)return o;if(yt.dyn_ltree[18]!==0||yt.dyn_ltree[20]!==0||yt.dyn_ltree[26]!==0)return a;for(Bt=32;Bt<h;Bt++)if(yt.dyn_ltree[2*Bt]!==0)return a;return o}($)),Dt($,$.l_desc),Dt($,$.d_desc),St=function(yt){var Bt;for(A(yt,yt.dyn_ltree,yt.l_desc.max_code),A(yt,yt.dyn_dtree,yt.d_desc.max_code),Dt(yt,yt.bl_desc),Bt=m-1;3<=Bt&&yt.bl_tree[2*H[Bt]+1]===0;Bt--);return yt.opt_len+=3*(Bt+1)+5+5+4,Bt}($),it=$.opt_len+3+7>>>3,(gt=$.static_len+3+7>>>3)<=it&&(it=gt)):it=gt=dt+5,dt+4<=it&&Z!==-1?j($,Z,dt,pt):$.strategy===4||gt===it?(G($,2+(pt?1:0),3),Ut($,V,O)):(G($,4+(pt?1:0),3),function(yt,Bt,ge,Zt){var Ze;for(G(yt,Bt-257,5),G(yt,ge-1,5),G(yt,Zt-4,4),Ze=0;Ze<Zt;Ze++)G(yt,yt.bl_tree[2*H[Ze]+1],3);ut(yt,yt.dyn_ltree,Bt-1),ut(yt,yt.dyn_dtree,ge-1)}($,$.l_desc.max_code+1,$.d_desc.max_code+1,St+1),Ut($,$.dyn_ltree,$.dyn_dtree)),Ct($),pt&&Et($)},i._tr_tally=function($,Z,dt){return $.pending_buf[$.d_buf+2*$.last_lit]=Z>>>8&255,$.pending_buf[$.d_buf+2*$.last_lit+1]=255&Z,$.pending_buf[$.l_buf+$.last_lit]=255&dt,$.last_lit++,Z===0?$.dyn_ltree[2*dt]++:($.matches++,Z--,$.dyn_ltree[2*(v[dt]+h+1)]++,$.dyn_dtree[2*P(Z)]++),$.last_lit===$.lit_bufsize-1},i._tr_align=function($){G($,2,3),rt($,S,V),function(Z){Z.bi_valid===16?(ot(Z,Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0):8<=Z.bi_valid&&(Z.pending_buf[Z.pending++]=255&Z.bi_buf,Z.bi_buf>>=8,Z.bi_valid-=8)}($)}},{"../utils/common":41}],53:[function(r,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,n,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,d=1,f={},m=!1,p=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,c={}.toString.call(o.process)==="[object process]"?function(T){Cn.nextTick(function(){b(T)})}:function(){if(o.postMessage&&!o.importScripts){var T=!0,x=o.onmessage;return o.onmessage=function(){T=!1},o.postMessage("","*"),o.onmessage=x,T}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",S,!1):o.attachEvent("onmessage",S),function(T){o.postMessage(h+T,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(T){b(T.data)},function(T){l.port2.postMessage(T)}):p&&"onreadystatechange"in p.createElement("script")?(u=p.documentElement,function(T){var x=p.createElement("script");x.onreadystatechange=function(){b(T),x.onreadystatechange=null,u.removeChild(x),x=null},u.appendChild(x)}):function(T){setTimeout(b,0,T)},g.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var x=new Array(arguments.length-1),N=0;N<x.length;N++)x[N]=arguments[N+1];var R={callback:T,args:x};return f[d]=R,c(d),d++},g.clearImmediate=y}function y(T){delete f[T]}function b(T){if(m)setTimeout(b,0,T);else{var x=f[T];if(x){m=!0;try{(function(N){var R=N.callback,B=N.args;switch(B.length){case 0:R();break;case 1:R(B[0]);break;case 2:R(B[0],B[1]);break;case 3:R(B[0],B[1],B[2]);break;default:R.apply(a,B)}})(x)}finally{y(T),m=!1}}}}function S(T){T.source===o&&typeof T.data=="string"&&T.data.indexOf(h)===0&&b(+T.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Qe<"u"?Qe:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(sA);var rz=sA.exports,k0=qs(rz);const oA={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(oA);var On=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},Vo,hc,Ys;class nz{constructor(...t){Vo.set(this,new Map),hc.set(this,new Map),Ys.set(this,new Map);for(const r of t)this.define(r)}define(t,r=!1){for(let[n,i]of Object.entries(t)){n=n.toLowerCase(),i=i.map(a=>a.toLowerCase()),On(this,Ys,"f").has(n)||On(this,Ys,"f").set(n,new Set);const s=On(this,Ys,"f").get(n);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&On(this,hc,"f").set(n,a),o=!1,c)continue;const u=On(this,Vo,"f").get(a);if(u&&u!=n&&!r)throw new Error(`"${n} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);On(this,Vo,"f").set(a,n)}}return this}getType(t){if(typeof t!="string")return null;const r=t.replace(/^.*[/\\]/s,"").toLowerCase(),n=r.replace(/^.*\./s,"").toLowerCase(),i=r.length<t.length;return!(n.length<r.length-1)&&i?null:On(this,Vo,"f").get(n)??null}getExtension(t){var r;return typeof t!="string"?null:(t=(r=t==null?void 0:t.split)==null?void 0:r.call(t,";")[0],(t&&On(this,hc,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:On(this,Ys,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of On(this,Ys,"f").values())Object.freeze(t);return this}_getTestState(){return{types:On(this,Vo,"f"),extensions:On(this,hc,"f")}}}Vo=new WeakMap,hc=new WeakMap,Ys=new WeakMap;var iz=new nz(oA)._freeze();function sz(e,t){console.info(t)}const oz=/; \$(\w+) ?(.*)/,az=/title (.+?) (.*)/i;function x0(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function cz(e,t){const r=Px();if(!w(r))return;const n=t.split(/\r?\n/),i={title:"",gendate:"",gentime:"",songs:[]};function s(m){return i.songs.find(p=>p.order===m)}function o(m,p){return{order:m,title:p,lines:[]}}for(let m=0;m<n.length;++m){const p=n[m],g=oz.exec(p);if(w(g)){const y=g[1].toLowerCase(),b=g[2];switch(y){case"title":i.title=b;break;case"gendate":i.gendate=b;break;case"gentime":i.gentime=b;break;case"song":{const S=az.exec(b);if(w(S)){const T=parseFloat(S[1]),x=S[2],N=s(T);w(N)?N.title=x:i.songs.push(o(T,x))}else{const T=parseFloat(b);if(xt(T)){const x=s(T);w(x)||i.songs.push(o(T,""))}}break}}}else{const y=i.songs[i.songs.length-1];w(y)&&p.trim().length&&y.lines.push(p)}}i.songs.sort((m,p)=>m.order-p.order);const a=i.songs.map(m=>m.title),c=`@play_${zt(i.title).replace(/\W/g,"")}
@cycle 1
@char 14
#end

:touch
"ALBUM: ${x0(i.title)}"
"$purple  ${x0(i.gendate)}"
"$purple  ${x0(i.gentime)}"
${a.map((m,p)=>`!song_${p};${p+1} ${m||"untitled"}`).join(`
`)}
#end

${i.songs.map((m,p)=>`:song_${p}
${m.lines.map(g=>`#play ${g}`).join(`
`)}
#end
`).join(`
`)}
`,u=iu(c,{}),l=_e(u);Xa(r,u),yc(lt,e,`imported zzt zzm file ${l} into ${r.name} book`);const h=_e(u),d=Ci(u);be(lt,e,`!pageopen ${u.id};$blue[${d}]$white ${h}`);const f=`#put n ${l}`;HP(lt,e,f,f,!1)}const Bu=60,lz=Bu*25;function uz(e,t){let r=0;const n=new DataView(t.buffer);function i(){const L=n.getUint8(r);return r++,L}function s(){const L=n.getInt16(r,!0);return r+=2,L}function o(){const L=n.getInt32(r,!0);return r+=4,L}function a(L){let z="";const U=t.subarray(r,r+L);for(let Y=0;Y<U.length;++Y)z+=String.fromCharCode(U[Y]);return r+=L,z.replace("\r",`
`)}function c(L,z,U,Y){const X=hn(L,z,U);if(w(X)&&w(Y)){const K=Br(Y);for(let W=0;W<K.length;++W){const P=K[W];X[P]=Y[P]}}}function u(L){let z="";for(let U=0;U<L.length;++U){const Y=L.charCodeAt(U);Y<32||Y>127?z+=`$${Y}`:z+=L[U]}return z}function l(L){return L.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(z=>z.replace("$","$CENTER ")).map(u).join(`
`)}function h(L,z,U,Y,X){const K=Y.color%16,W=Math.floor(Y.color/16)%8,P=wo(K,W),ot=wo((W+8)%16,K),G={},rt=X.find(wt=>wt.x===z&&wt.y===U);switch(w(rt)&&(xt(rt.cycle)&&rt.cycle>0&&(G.cycle=rt.cycle),w(rt.p1)&&(G.p1=rt.p1),w(rt.p2)&&(G.p2=rt.p2),w(rt.p3)&&(G.p3=rt.p3),w(rt.code)&&rt.code&&(G.code=l(rt.code)),w(rt.stepx)&&(G.stepx=rt.stepx),w(rt.stepy)&&(G.stepy=rt.stepy)),Y.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(L,["ammo",P],{x:z,y:U},G);break;case 6:c(L,["torch",P],{x:z,y:U},G);break;case 7:c(L,["gem",P],{x:z,y:U},G);break;case 8:c(L,["key",P],{x:z,y:U},G);break;case 9:c(L,["door",ot],{x:z,y:U},G);break;case 10:c(L,["scroll",P],{x:z,y:U},G);break;case 11:{G.p3=d(rt==null?void 0:rt.p3)??"",c(L,["passage",P],{x:z,y:U},G);break}case 12:c(L,["duplicator",P],{x:z,y:U},{...G,stepx:0,stepy:0,shootx:G.stepx??0,shooty:G.stepy??0});break;case 13:c(L,["bomb",P],{x:z,y:U},G);break;case 14:c(L,["energize",P],{x:z,y:U},G);break;case 15:c(L,["star",P],{x:z,y:U},G);break;case 16:c(L,["clockwise",P],{x:z,y:U},G);break;case 17:c(L,["counter",P],{x:z,y:U},G);break;case 18:c(L,["bullet",P],{x:z,y:U},G);break;case 19:c(L,["water",P],{x:z,y:U},G);break;case 20:c(L,["forest",P],{x:z,y:U},G);break;case 21:c(L,["solid",P],{x:z,y:U},G);break;case 22:c(L,["normal",P],{x:z,y:U},G);break;case 23:c(L,["breakable",P],{x:z,y:U},G);break;case 24:c(L,["boulder",P],{x:z,y:U},G);break;case 25:c(L,["sliderns",P],{x:z,y:U},G);break;case 26:c(L,["sliderew",P],{x:z,y:U},G);break;case 27:c(L,["fake",P],{x:z,y:U},G);break;case 28:c(L,["invisible",P],{x:z,y:U},G);break;case 29:c(L,["blinkwall",P],{x:z,y:U},{...G,stepx:0,stepy:0,shootx:G.stepx??0,shooty:G.stepy??0});break;case 30:c(L,["transporter",P],{x:z,y:U},{...G,stepx:0,stepy:0,shootx:G.stepx??0,shooty:G.stepy??0});break;case 31:c(L,["line",P],{x:z,y:U},G);break;case 32:c(L,["ricochet",P],{x:z,y:U},G);break;case 33:c(L,["blinkns",P],{x:z,y:U},G);break;case 34:c(L,["bear",P],{x:z,y:U},G);break;case 35:c(L,["ruffian",P],{x:z,y:U},G);break;case 36:c(L,["object",P],{x:z,y:U},{...G,char:(rt==null?void 0:rt.p1)??1});break;case 37:c(L,["slime",P],{x:z,y:U},G);break;case 38:c(L,["shark",P],{x:z,y:U},G);break;case 39:c(L,["spinninggun",P],{x:z,y:U},G);break;case 40:c(L,["pusher",P],{x:z,y:U},G);break;case 41:c(L,["lion",P],{x:z,y:U},G);break;case 42:c(L,["tiger",P],{x:z,y:U},G);break;case 43:c(L,["blinkns",P],{x:z,y:U},G);break;case 44:c(L,["head",P],{x:z,y:U},G);break;case 45:c(L,["segment",P],{x:z,y:U},G);break;case 46:break;case 47:c(L,["text",["WHITE","ONDKBLUE"]],{x:z,y:U},{...G,char:Y.color});break;case 48:c(L,["text",["WHITE","ONDKGREEN"]],{x:z,y:U},{...G,char:Y.color});break;case 49:c(L,["text",["WHITE","ONDKCYAN"]],{x:z,y:U},{...G,char:Y.color});break;case 50:c(L,["text",["WHITE","ONDKRED"]],{x:z,y:U},{...G,char:Y.color});break;case 51:c(L,["text",["WHITE","ONDKPURPLE"]],{x:z,y:U},{...G,char:Y.color});break;case 52:c(L,["text",["WHITE","ONDKYELLOW"]],{x:z,y:U},{...G,char:Y.color});break;case 53:c(L,["text",["WHITE","ONBLACK"]],{x:z,y:U},{...G,char:Y.color});break}}function d(L){if(xt(L)&&L>0)return`zztboard${L}`}if(s()!=-1)return;const m=s(),p=s(),g=s(),y=a(7),b=s(),S=s(),T=s(),x=s(),N=s();s();const R=s(),B=i(),M=a(20).slice(0,B);for(let L=0;L<9;L++){const z=i();a(20).slice(0,z)}const H=s(),V=s(),O=i();console.info(p,g,y,b,S,T,x,N,R,H,V,O),r=512;const I=[];for(let L=0;L<=m;++L){const z=s(),U=r,Y=i(),K={boardname:a(50).slice(0,Y),elements:[],stats:[]};for(;K.elements.length<lz;){let P=i();P===0&&(P=255);const ot=i(),G=i();for(let rt=0;rt<P;++rt)K.elements.push({element:ot,color:G})}K.maxplayershots=i(),K.isdark=i(),K.exitnorth=i(),K.exitsouth=i(),K.exitwest=i(),K.exiteast=i(),K.restartonzap=i(),K.messagelength=i(),K.message=a(58).slice(0,K.messagelength),K.playerenterx=i(),K.playerentery=i(),K.timelimit=s(),r+=16;const W=s()+1;for(;K.stats.length<W;){const P={};P.x=i()-1,P.y=i()-1,P.stepx=s(),P.stepy=s(),P.cycle=s(),P.p1=i(),P.p2=i(),P.p3=i(),P.follower=s(),P.leader=s(),P.underelement=i(),P.undercolor=i(),P.pointer=o(),P.currentinstruction=s();const ot=s();r+=8,ot<0?P.bind=Math.abs(ot):P.code=a(ot),K.stats.push(P)}I.push(K),r=U+z}const v=Pd([]);v.name=M;for(let L=0;L<I.length;++L){const z=I[L],U=[`@zztboard${L}`,""];L===0?U.push("@title"):L===S&&U.push("@zztstartboard");for(let Rt=0;Rt<z.elements.length;++Rt)z.elements[Rt].element===4&&(U.push(`@startx ${Qg(Rt,Bu)}`),U.push(`@starty ${ty(Rt,Bu)}`));xt(z.maxplayershots)&&U.push(`@maxplayershots ${z.maxplayershots}`),xt(z.isdark)&&U.push(`@isdark ${z.isdark}`),xt(z.restartonzap)&&U.push(`@restartonzap ${z.restartonzap}`),xt(z.timelimit)&&U.push(`@timelimit ${z.timelimit}`);const Y=d(z.exitnorth);_t(Y)&&U.push(`@exitnorth ${Y}`);const X=d(z.exitsouth);_t(X)&&U.push(`@exitsouth ${X}`);const K=d(z.exitwest);_t(K)&&U.push(`@exitwest ${K}`);const W=d(z.exiteast);_t(W)&&U.push(`@exiteast ${W}`);const P=`@board ${String(L).padStart(3,"0")}. ${z.boardname}
${U.join(`
`)}`,ot=iu(P,{});Xa(v,ot);const G=Ie(ot);if(!w(G))continue;let rt=0,wt=0;for(let Rt=0;Rt<z.elements.length;++Rt){const Ct=z.elements[Rt];h(G,rt,wt,Ct,z.stats),++rt,rt===Bu&&(rt=0,++wt)}pr(G)}Nu(v),yc(lt,e,`imported zzt file into ${v.name} book`)}function fz(e,t){const r=Px();if(!w(r))return;const n=iu(t,{}),i=_e(n);Xa(r,n),yc(lt,e,`imported zzt obj file ${i} into ${r.name} book`)}function aA(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return iz.getType(e)??"application/octet-stream"}function cA(e,t){if(!w(t))return"";switch(e){case"model/obj":return"obj";case"text/plain":return"txt";case"application/json":return"json";case"application/zip":return"zip";case"application/octet-stream":if(/.zzt$/i.test(t.name))return"zzt";if(/.brd$/i.test(t.name))return"brd";if(/.zzl$/i.test(t.name))return"zzl";if(/.zzm$/i.test(t.name))return"zzm";break}return""}let Xo=[],$u={};async function hz(e,t){try{Pe(lt,e,"parsezipfile",t.name);const r=await t.arrayBuffer(),i=await new k0().loadAsync(r);Xo=[],$u={};const s=[];i.forEach((o,a)=>s.push([o,a]));for(let o=0;o<s.length;++o){const[a,c]=s[o],u=await c.async("uint8array"),l=aA(a,u),h=new File([u],c.name,{type:l});Xo.push(h)}QT(lt,e)}catch(r){ye(lt,e,"crash",r.message)}}function dz(){const e=[];for(let t=0;t<Xo.length;++t){const r=Xo[t];e.push([cA(r.type,r),r.name])}return e}function pz(e,t){$u[e.toLowerCase()]=t}function mz(e){return $u[e.toLowerCase()]}async function gz(e){for(let t=0;t<Xo.length;++t){const r=Xo[t];$u[r.name.toLowerCase()]&&(A0(e,r),await wc(2e3))}await wc(2e3),sf(lt,e)}function lA(e,t,r){if(!w(r))return;switch(cA(t,r)){case"obj":r.text().then(i=>fz(e,i)).catch(i=>ye(lt,e,"crash",i.message));break;case"txt":r.text().then(i=>of(lt,e,void 0,"text",`file:${r.name}`,i)).catch(i=>ye(lt,e,"crash",i.message));break;case"json":r.text().then(i=>of(lt,e,void 0,"json",`file:${r.name}`,i)).catch(i=>ye(lt,e,"crash",i.message));break;case"zip":hz(e,r).catch(i=>ye(lt,e,"crash",i.message));break;case"zzt":r.arrayBuffer().then(i=>{uz(e,new Uint8Array(i))}).catch(i=>ye(lt,e,"crash",i.message));break;case"brd":r.arrayBuffer().then(i=>{}).catch(i=>ye(lt,e,"crash",i.message));break;case"zzl":r.text().then(i=>{sz(e,i)}).catch(i=>ye(lt,e,"crash",i.message));break;case"zzm":r.text().then(i=>{cz(e,i)}).catch(i=>ye(lt,e,"crash",i.message));break;default:t||r.arrayBuffer().then(i=>{const s=aA(r.name,new Uint8Array(i));if(s)lA(e,s,r);else return ye(lt,e,"parsewebfile",`unsupported file ${r.name}`)}).catch(i=>ye(lt,e,"crash",i.message));return}}function A0(e,t){lA(e,(t==null?void 0:t.type)??"",t)}const Du="https://bridge.zed.cafe";async function yz(e,t,r){const n=`offset=${r}&${e}=${t}`,i=new Request(`${Du}/api/v1/search/files/?${n}`);return(await(await fetch(i)).json()).data.results}async function _z(){const e=new Request(`${Du}/api/v1/get/random-file/`);return[(await(await fetch(e)).json()).data]}function bz(e){return`${Du}/static/${e}`}async function wz(e,t){const n=await(await fetch(`${Du}/zgames/${t}`)).arrayBuffer(),i=new File([n],t);A0(e,i)}function Zr(e,t,r){r().catch(n=>{console.error(n),ye(e,t,"crash",n==null?void 0:n.message)})}function Ez(e){const[t,r]=e.split(":"),n=w(r);return[n?t:"self",n?r:e]}function vz(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-t.length%4)%4);return t+r}function kz(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const xz=new Date("1980/09/02");async function T0(e){return console.info("saved",e),new Promise((t,r)=>{const n=new k0;for(let i=0;i<e.length;++i){const s=e[i],o=H3(s);if(o){const a=iN(o);w(a)&&n.file(s.id,a,{date:xz})}}n.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(kz(i))}).catch(r)})}async function Az(e){return new Promise((t,r)=>{const n=new k0,i=vz(e);n.loadAsync(i,{base64:!0}).then(async()=>{const s=[],o=[];n.forEach((a,c)=>o.push(c));for(let a=0;a<o.length;++a){const c=o[a],u=await c.async("uint8array"),l=Xy(u);if(w(l)){const h=lv(l);w(h)&&s.push(h)}else{const h=await c.async("string"),d=Xy(h);if(w(d)){const f=lv(d);w(f)&&s.push(f)}}}t(s)}).catch(r)})}function Tz(e,t,r,n){const i=Ye(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){xt(l)&&(s=l,ry(t.x,t.y,r.x,r.y).forEach(h=>{const d=se(i,h);w(d)&&(d[u]=l)}))}Mt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe),$t(e,`batch:${yo(t,r)}`,"char",[n,"charedit"],o,a);const c=Ce(e);c.scrollname="bulk set char",c.scroll=ar(e)}function Sz(e,t,r,n){const i=Ye(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){if(xt(l)){s=l;for(let h=t.y;h<=r.y;++h)for(let d=t.x;d<=r.x;++d){const f=se(i,{x:d,y:h});w(f)&&(f[u]=l)}}}Mt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe),$t(e,`batch:${yo(t,r)}`,"color",[n,"coloredit"],o,a);const c=Ce(e);c.scrollname="bulk set color",c.scroll=ar(e)}function Rz(e,t,r,n){const i=Ye(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){xt(l)&&(s=l,ry(t.x,t.y,r.x,r.y).forEach(h=>{const d=se(i,h);w(d)&&(d[u]=l)}))}Mt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe),$t(e,`batch:${yo(t,r)}`,"color",[n,"coloredit"],o,a);const c=Ce(e);c.scrollname="bulk set bg",c.scroll=ar(e)}function Oz(e,t,r,n){const i=gr(Jt.MAIN);if(!w(i))return;const s=Ye(e);if(!w(s))return;const o=yo(t,r);Mt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe),$t(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),$t(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),n&&$t(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),$t(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),$t(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Mt(e,Xe),$t(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),$t(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),$t(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Mt(e,Xe),$t(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Mt(e,Xe),Mt(e,"codepages:");const a=Math.min(t.x,r.x),c=Math.min(t.y,r.y),u=Math.max(t.x,r.x),l=Math.max(t.y,r.y),h=new Set;for(let f=c;f<=l;++f)for(let m=a;m<=u;++m){const p=se(s,{x:m,y:f}),g=hv(i,p);w(g)&&!h.has(g.id)&&(h.add(g.id),$t(e,"batch",`edit @${_e(g)}`,[`pageopen:${g.id}`]))}const d=Jr(Tt.BOARD,s.id);Mt(e,_e(d)),$t(e,"batch",`id ${s.id}`,["","copyit",s.id]),$t(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}function S0(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function Iz(e,t){let r;const n=()=>{if(r)return r;const i=indexedDB.open(e);return i.onupgradeneeded=()=>i.result.createObjectStore(t),r=S0(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(t,i).objectStore(t)))}let R0;function uA(){return R0||(R0=Iz("keyval-store","keyval")),R0}function fA(e,t=uA()){return t("readonly",r=>S0(r.get(e)))}function hA(e,t,r=uA()){return r("readwrite",n=>new Promise((i,s)=>{n.get(e).onsuccess=function(){try{n.put(t(this.result),e),i(S0(n.transaction))}catch(o){s(o)}}}))}function O0(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function dA(){return fA("secretheap")}async function pA(e){return hA("secretheap",e)}async function Nz(){return!!await dA()}function mA(e,t,r){const n=Math.min(t.x,r.x),i=Math.min(t.y,r.y),s=Math.max(t.x,r.x),o=Math.max(t.y,r.y),a=s-n+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let d=n;d<=s;++d){const f={x:d-n,y:h-i},m=se(e,{x:d,y:h});(m==null?void 0:m.category)===$r.ISOBJECT?(u.push(Nn(as(e,d,h))),dr(m).name!=="player"&&l.push({...Nn(m),...f,id:"blank"})):u.push({...Nn(m),...f})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}async function Cz(e,t,r,n){const i=Ye(e);if(!w(i))return;const s=mA(i,t,r);switch(n){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await pA(()=>s)}function Lz(e,t,r){const n=O0(t,r);Mt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe),$t(e,"batch","copy terrain & objects",[`copyall:${n}`,"hk","1"]),$t(e,"batch","copy objects",[`copyobjects:${n}`,"hk","2"]),$t(e,"batch","copy terrain",[`copyterrain:${n}`,"hk","3"]);const i=Ce(e);i.scrollname="copy",i.scroll=ar(e)}async function Mz(e,t,r,n){const i=gr(Jt.MAIN);if(!w(i))return;const s=Ye(e);if(!w(s))return;const o=mA(s,t,r);switch(n){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(n){case"cutall":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c){const u=se(s,{x:c,y:a});(u==null?void 0:u.category)===$r.ISOBJECT&&kr(s,u,i.timestamp),Ne(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c){const u=se(s,{x:c,y:a});(u==null?void 0:u.category)===$r.ISOBJECT&&kr(s,u,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c)Ne(s,{x:c,y:a});break}}await pA(()=>o)}function Uz(e,t,r){const n=O0(t,r);Mt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe),$t(e,"batch","cut terrain & objects",[`cutall:${n}`,"hk","1"]),$t(e,"batch","cut objects",[`cutobjects:${n}`,"hk","2"]),$t(e,"batch","cut terrain",[`cutterrain:${n}`,"hk","3"]);const i=Ce(e);i.scrollname="cut",i.scroll=ar(e)}async function Pz(e,t,r,n){const i=Ye(e),s=await dA();if(!w(i)||!w(s))return;const o=Math.min(t.x,r.x),a=Math.min(t.y,r.y),c=Math.max(t.x,r.x),u=Math.max(t.y,r.y),l=c-o+1,h=u-a+1,d=Math.min(s.width,l),f=Math.min(s.height,h);switch(n){case"pasteall":{for(let m=0;m<f;++m)for(let p=0;p<d;++p){const g=jr({x:p,y:m},s.width);Ne(i,{...s.terrain[g],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&nh(p.x,p.y,0,l-1,h-1,0)&&_0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&nh(p.x,p.y,0,l-1,h-1,0)&&_0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<f;++m)for(let p=0;p<d;++p){const g=jr({x:p,y:m},s.width);Ne(i,{...s.terrain[g],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=u;++m)for(let p=o;p<=c;++p){const g=(p-o)%s.width,y=(m-a)%s.height,b=jr({x:g,y},s.width);Ne(i,{...s.terrain[b],x:p,y:m})}break}}function Fz(e,t,r){const n=O0(t,r);Mt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe),$t(e,"batch","paste terrain & objects",[`pasteall:${n}`,"hk","1"]),$t(e,"batch","paste objects",[`pasteobjects:${n}`,"hk","2"]),$t(e,"batch","paste terrain",[`pasteterrain:${n}`,"hk","3"]),$t(e,"batch","paste terrain tiled",[`pasteterraintiled:${n}`,"hk","4"]);const i=Ce(e);i.scrollname="paste",i.scroll=ar(e)}function I0(e,t){return`inspect:${t!=null&&t.id?t.id:$i(e,t)}`}function Bz(e,t,r){const n=gr(Jt.MAIN);if(!w(n))return;const i=Ye(e);if(!w(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,f){w(t)&&(t[d]=f)}const a=t.category===$r.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=I0(i,t);Mt(e,`${a}: ${c} ${u}`),Mt(e,Xe),$t(e,l,"color",[r,"coloredit"],s,o);const h=Ce(e);h.scrollname="color",h.scroll=ar(e)}function $z(e,t,r){const n=gr(Jt.MAIN);if(!w(n))return;const i=Ye(e);if(!w(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,f){w(t)&&(t[d]=f)}const a=t.category===$r.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=I0(i,t);Mt(e,`${a}: ${c} ${u}`),Mt(e,Xe),$t(e,l,"char",[r,"charedit"],s,o);const h=Ce(e);h.scrollname="char",h.scroll=ar(e)}function Dz(e,t,r,n,i,s){var m,p,g;const o=gr(Jt.MAIN);if(!w(o))return;function a(y){var S;const b=(n==null?void 0:n[y])??((S=n==null?void 0:n.kinddata)==null?void 0:S[y]);if(!w(b))switch(y){case"color":return 15;case"bg":return 0;case"cycle":return sm;case"collision":return Wt.ISWALK;case"pushable":return 0;case"breakable":return 0}return b}function c(y,b){w(n)&&(n[y]=b)}s?Mt(e,`object: ${n.name??n.kind??"ERR"} ${i.x}, ${i.y}`):Mt(e,`terrain: ${n.kind??"ERR"} ${i.x}, ${i.y}`);const u=I0(t,n);switch(s&&Mt(e,`cycle: ${Gt(n,"cycle")}`),Gt(n,"collision")){case Wt.ISWALK:Mt(e,"collision: iswalk");break;case Wt.ISSWIM:Mt(e,"collision: isswim");break;case Wt.ISSOLID:Mt(e,"collision: issolid");break;case Wt.ISBULLET:Mt(e,"collision: isbullet");break;case Wt.ISGHOST:Mt(e,"collision: isghost");break}if(s){const y=Gt(n,"pushable");Mt(e,`ispushable: ${y||"no"}`)}Mt(e,`isbreakable: ${Gt(n,"breakable")?"yes":"no"}`),Mt(e,Xe);const h=qa(r),d=Br(h);for(let y=0;y<d.length;++y){const b=d[y];switch(b){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(he(h[b])){const[S,T,...x]=h[b];_t(T)&&$t(e,u,T||b,[b,S,...x],a,c)}break}}$t(e,u,"copy coords",["copycoords","hk","5"," 5 "]),Mt(e,Xe),$t(e,u,`char: ${n.char??((m=n.kinddata)==null?void 0:m.char)??1}`,["char","hk","a"," A ","next"],a,c),$t(e,u,`color: ${n.color??((p=n.kinddata)==null?void 0:p.color)??15}`,["color","hk","c"," C ","next"],a,c),$t(e,u,`bg: ${n.bg??((g=n.kinddata)==null?void 0:g.bg)??0}`,["bg","hk","b"," B ","next"],a,c),Mt(e,Xe),$t(e,u,"make empty",["empty","hk","0"],a,c),Mt(e,Xe),$t(e,"batch",`edit @${_e(r)}`,[`pageopen:${r.id}`]);const f=Jr(Tt.BOARD,t.id);Mt(e,_e(f)),$t(e,"batch",`id ${t.id}`,["","copyit",t.id]),$t(e,"batch","edit @board codepage",[`pageopen:${t.id}`])}function jz(e,t,r,n){const i=gr(Jt.MAIN);if(!w(i))return;const s=Ye(e);if(w(s))switch(n){case"emptyall":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a){const c=se(s,{x:a,y:o});(c==null?void 0:c.category)===$r.ISOBJECT&&kr(s,c,i.timestamp),Ne(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a){const c=se(s,{x:a,y:o});(c==null?void 0:c.category)===$r.ISOBJECT&&kr(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a)Ne(s,{x:a,y:o});break}}}function zz(e,t,r){const n=gr(Jt.MAIN);if(!w(n))return;const i=Ye(e);if(!w(i))return;const s=yo(t,r);Mt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe),$t(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),$t(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),$t(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Ce(e);o.scrollname="empty",o.scroll=ar(e)}async function Wz(e,t,r){const n=gr(Jt.MAIN),i=await Nz();if(!w(n))return;const s=Ye(e);if(!w(s))return;if(pr(s),t.x===r.x&&t.y===r.y){const a=se(s,t),c=hv(n,a);if(w(a)&&w(c)&&Dz(e,s,c,a,t,He(a)),!(a!=null&&a.kind)){Mt(e,`empty: ${t.x}, ${t.y}`),Mt(e,Xe),$t(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]);const u=Jr(Tt.BOARD,s.id);Mt(e,_e(u)),$t(e,"batch",`id ${s.id}`,["","copyit",s.id]),$t(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}}else Oz(e,t,r,i);const o=Ce(e);o.scrollname="inspect",o.scroll=ar(e)}function Hz(e,t){const r=me(Jt.MAIN);if(!w(r))return;const n=Ye(t);if(!w(n))return;const i=Dr(e),s=Jx(n,i.target);if(w(s))switch(i.path){case"copycoords":rf(lt,Pr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":Bz(t,s,i.path);break;case"char":$z(t,s,i.path);break;case"empty":kr(n,s,r.timestamp);break;case"code":Zr(lt,t,async()=>{const o="object",a=[n.id,s.id];rh(_c(r.id,a),s.code??""),OT(lt,t),await wc(800),rm(lt,t,r.id,a,o,`${name} - ${r.name}`)});break;default:console.info("unknown inspect",i);break}}async function Gz(e,t){const r=Ye(t);if(!w(r))return;const n=Dr(e),[i,s,o,a]=n.path.split(",").map(l=>parseFloat(l)),c={x:Math.min(i,o),y:Math.min(s,a)},u={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"copy":Lz(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":await Cz(t,c,u,n.target);break;case"cut":Uz(t,c,u);break;case"cutall":case"cutobjects":case"cutterrain":await Mz(t,c,u,n.target);break;case"paste":Fz(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await Pz(t,c,u,n.target);break;case"empty":zz(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":jz(t,c,u,n.target);break;case"chars":Tz(t,c,u,"char");break;case"colors":Sz(t,c,u,"color");break;case"bgs":Rz(t,c,u,"bg");break;case"copycoords":rf(lt,t,[i,s,o,a].join(" "));break;case"pageopen":Zr(lt,t,async()=>{await wc(800),tS(lt,t,`#pageopen ${n.path}`)});break;default:console.info("unknown batch",n);break}}async function Kz(){return fA("remixconfig")}async function Yz(e){return hA("remixconfig",e)}let cs={stat:"",patternsize:2,mirror:1};async function qz(e,t){const r=Ye(t);if(!w(r))return;const n=Dr(e),[i,s,o,a]=n.path.split(",").map(l=>parseFloat(l)),c={x:Math.min(i,o),y:Math.min(s,a)},u={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"remix":{await Vz(t,c,u);break}case"remixrun":{const l=yr(cs.stat);w(l)&&nk(r.id,l.id,cs.patternsize,cs.mirror,c,u,"all"),await Yz(()=>cs);break}default:console.info("unknown remix",n);break}}async function Vz(e,t,r){const n=await Kz();cs={...cs,...n};const i=yo(t,r);Mt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Mt(e,Xe);function s(c){const{target:u}=Dr(c);return cs[u]}function o(c,u){if(xt(u)||_t(u)){const{target:l}=Dr(c);cs[l]=u}}$t(e,"remix","source board",[`stat:${i}`,"text"],s,o),$t(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),$t(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Mt(e,Xe),$t(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Ce(e);a.scrollname="remix",a.scroll=ar(e)}const Xz=16,ls={},ju={},Jz=60;let gA=0;const Jo={},Zo={};async function yA(e){const t=Tn(),r=me(Jt.MAIN);if(t.length&&w(r)){const n=await T0(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${r.name} ${n.length} chars`;CT(ee,Pr(),i,n)}}async function Zz(){const e=Tn(),t=me(Jt.MAIN);if(e.length&&w(t)){const r=await T0(e);LT(ee,Pr(),r)}}async function Qz(){const e=Tn(),t=me(Jt.MAIN);return e.length&&w(t)?T0(e):""}const _A="$176$176$177$177$178 ZZT BRIDGE $178$177$177$176$176";function bA(e){Mt(e,`Searching ${"$6".repeat(yn(1,6))}`);const t=Ce(e);t.scrollname=_A,t.scroll=ar(e)}function wA(e,t){for(let n=0;n<e.length;++n){const i=e[n],s=`pub: ${new Date(i.publish_date).toLocaleDateString()}`;Mt(t,`$white${i.title}`),Mt(t,`$yellow  ${i.author.join(", ")}`),Mt(t,`$dkgreen  ${i.genres.join(", ")}`),Mt(t,`$purple  ${s}`),i.screenshot&&$t(t,"zztbridge",i.screenshot,["screenshot","viewit",bz(i.screenshot)]),$t(t,"zztbridge",i.filename,["zztimport","hyperlink",`${i.letter}/${i.filename}`]),Mt(t," ")}const r=Ce(t);r.scrollname=_A,r.scroll=ar(t)}const zu={},ee=Xs("vm",["tick","second"],e=>{var r;if(!ee.session(e))return;const t=Pr();switch(e.target){case"operator":vj(e.player),Pe(ee,e.player,`operator set to ${e.player}`),ee.replynext(e,"ackoperator",!0);break;case"zsswords":{const n=me(Jt.MAIN);ee.replynext(e,"ackzsswords",{cli:sp(rs.CLI),loader:sp(rs.LOADER),runtime:sp(rs.RUNTIME),flags:[...Br(Rn(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","playerid","playerx","playery","thisid","thisx","thisy","senderid","senderx","sendery","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isghost","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"],kinds:[...Fs(n,Tt.OBJECT).map(i=>_e(i)),...Br(np)],altkinds:[...Fs(n,Tt.TERRAIN),...Fs(n,Tt.BOARD),...Fs(n,Tt.PALETTE),...Fs(n,Tt.CHARSET),...Fs(n,Tt.LOADER)].map(i=>_e(i)),colors:[...Br(_a)],dirs:[...Br(uh).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Br(ep)],exprs:["aligned","alligned","contact","blocked","any","countof","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&Zr(ee,e.player,async()=>{if(he(e.data)){const[n,i]=e.data,s=await Az(n),o=s.map(a=>a.name);Oj(s,i),Pe(ee,e.player,`loading ${o.join(", ")}`),ef(ee,e.player)}});break;case"search":Cj(e.player)||ef(ee,e.player);break;case"logout":Nj(e.player),delete ls[e.player],Pe(ee,t,`player ${e.player} logout`),ef(ee,e.player);break;case"login":jx(e.player)?(IT(ee,e.player),ls[e.player]=0,Pe(ee,Pr(),`login from ${e.player}`),ee.replynext(e,"acklogin",!0)):Z0(ee,e.player);break;case"local":jx(e.player)?(ls[e.player]=0,Pe(ee,Pr(),`login from ${e.player}`)):Z0(ee,e.player);break;case"doot":ls[e.player]=0,ju[e.player]=ju[e.player]??0,ju[e.player]%32===0&&Pe(ee,e.player,`$whiteactive $blue${e.player}`),++ju[e.player];break;case"input":{if(e.player.includes("local")&&!$x(e.player)&&ZT(ee,e.player),!e.player.includes("local")||$x(e.player)){const n=Rn(e.player),[i=Nr.NONE,s=0]=e.data??[Nr.NONE,0];he(n.inputqueue)||(n.inputqueue=[]),i!==Nr.NONE&&n.inputqueue.push([i,s])}break}case"codewatch":if(he(e.data)){const[n,i]=e.data,s=_c(n,i);w(Zo[s])||(Zo[s]=Jg(s,o=>{const[a,c]=i,u=Hn(n),l=Ps(u,a);if(w(l))if(di(l)===Tt.BOARD&&w(c)){const h=Ie(l),d=Or(h,c);w(d)&&(d.code=o,ou(Ud(o),d))}else l.code=o,j3(l)})),Jo[s]=Jo[s]??new Set,Jo[s].add(e.player)}break;case"coderelease":if(he(e.data)){const[n,i]=e.data,[,s]=i,o=_c(n,i);w(Jo[o])&&(Jo[o].delete(e.player),Jo[o].size===0&&((r=Zo[o])==null||r.call(Zo),Zo[o]=void 0,_t(s)&&Pj(s)))}break;case"halt":e.player===t&&hT(e.data)&&kj(e.data);break;case"tick":{Bj(xj());const n=Br(zu);for(let i=0;i<n.length;++i){const s=n[i];--zu[s]}break}case"synthsend":if(_t(e.data)){const n=e.data,[i,s]=Ez(n),o=zu[n];if(!w(o)||o<=0){zu[n]=2;const a=me(Jt.MAIN);Go(i,s,void 0,Lo(a))}}break;case"second":{Lj(ls);const n=Object.keys(ls);for(let i=0;i<n.length;++i)++ls[n[i]];for(let i=0;i<n.length;++i){const s=n[i];ls[s]>=Xz&&sf(ee,s)}++gA>=Jz&&(gA=0,Zr(ee,e.player,async()=>{await yA(!0)}));break}case"copyjsonfile":if(e.player===t){const n=me(Jt.MAIN);if(w(n)&&he(e.data)){const[i]=e.data,s=Ps(n,i);w(s)&&UT(ee,t,s,`${_e(s)}.${Ci(s)}.json`)}}break;case"refscroll":{$t(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),$t(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),$t(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const n=Ce(e.player);n.scrollname="refscroll",n.scroll=ar(e.player);break}case"readzipfilelist":{const n=dz();Mt(e.player,"$CENTER Select Files"),$t(e.player,"zipfilelist","import selected",["importfiles"]);for(let s=0;s<n.length;++s){const[o,a]=n[s];$t(e.player,"zipfilelist",`[${o}] ${a}`,[zt(a),"select","NO","0","YES","1"],c=>mz(c)?1:0,(c,u)=>{pz(c,!!u)})}const i=Ce(e.player);i.scrollname="zipfilelist",i.scroll=ar(e.player);break}case"fork":e.player===t&&Zr(ee,e.player,async()=>{await Zz()});break;case"zztsearch":Zr(ee,e.player,async()=>{if(he(e.data)){const[n,i]=e.data;let s=0;const o=[];for(;o.length<256;){bA(e.player);const a=await yz(n,i,s);if(s+=a.length,o.push(...a),a.length<25)break}wA(o,e.player)}});break;case"zztrandom":Zr(ee,e.player,async()=>{bA(e.player);const n=await _z();wA(n,e.player)});break;case"itchiopublish":Zr(ee,e.player,async()=>{if(e.player===t){const n=me(Jt.MAIN);if(w(n)){const i=await Qz();MT(ee,e.player,n.name,i)}}});break;case"flush":e.player===t&&Zr(ee,e.player,async()=>{await yA()});break;case"cli":Hx(e.player,e.data);break;case"clirepeatlast":$j(e.player);break;case"restart":e.player===t&&(Fj(),im(ee,e.player));break;case"inspect":Zr(ee,e.player,async()=>{if(he(e.data)){const[n,i]=e.data;await Wz(e.player,n,i)}});break;case"loader":if(he(e.data)){const[n,i,s,o]=e.data;switch(i){case"file":A0(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){Pe(ee,e.player,`loading ${s}`);const a=JSON.parse(o.json);w(a.data)&&_t(a.exported)&&(Nu(a.data),Pe(ee,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){Pe(ee,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=me(Jt.MAIN);w(c)&&w(a.data)&&_t(a.exported)&&(Xa(c,a.data),Pe(ee,e.player,`loaded ${a.exported}`))}else Yv(n,i,s,o,e.player);break;default:Yv(n,i,s,o,e.player);break}}break;default:{const{target:n,path:i}=Dr(e.target);switch(zt(n)){case"refscroll":switch(i){case"charscroll":{$t(e.player,"refscroll","char",["char","charedit"]);const s=Ce(e.player);s.scrollname="chars",s.scroll=ar(e.player);break}case"colorscroll":{$t(e.player,"refscroll","color",["color","coloredit"]);const s=Ce(e.player);s.scrollname="colors",s.scroll=ar(e.player);break}case"notesscroll":{Mt(e.player,"duration             cdefgab - notes "),Mt(e.player,"y - 64th note        x - rest"),Mt(e.player,"t - 32nd note        "),Mt(e.player,"s - 16th note.       drums"),Mt(e.player,"i - eight note.      0 - tick"),Mt(e.player,"q - quarter note     1 - tweet"),Mt(e.player,"h - half note        2 - cowbell"),Mt(e.player,"w - whole note       p - clap"),Mt(e.player,"                     4 - high snare"),Mt(e.player,"mods                 5 - high woodblock"),Mt(e.player,"3 - triplet          6 - low snare"),Mt(e.player,". - time and a half  7 - low tom"),Mt(e.player,"# - sharp            8 - low woodblock"),Mt(e.player,"! - flat             9 - bass drum");const s=Ce(e.player);s.scrollname="music notation",s.scroll=ar(e.player);break}}break;case"batch":Zr(ee,e.player,async()=>{await Gz(i,e.player)});break;case"remix":Zr(ee,e.player,async()=>{await qz(i,e.player)});break;case"empty":{const s=Dr(i);switch(s.target){case"copycoords":rf(ee,Pr(),s.path.split(",").join(" "));break}break}case"inspect":Hz(i,e.player);break;case"touched":if(he(e.data)){const[s,o,a]=e.data;zx({...e,target:`${o}:${a}`,data:void 0,sender:s})}break;case"zztbridge":Zr(ee,e.player,async()=>{_t(e.data)&&await wz(e.player,e.data)});break;case"zipfilelist":Zr(ee,e.player,async()=>{await gz(e.player)});break;default:{const s=Dr(i);if(zt(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),zx(e);else{const o=me(Jt.MAIN);Go(s.target,s.path,void 0,Lo(o))}break}}break}}},Ej());function t7(){NT(ee)}const{forward:e7}=aS(e=>{cS(e)&&postMessage(e)});onmessage=function(t){e7(t.data)},setTimeout(t7,100)})();

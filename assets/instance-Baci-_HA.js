var aL=Object.defineProperty;var cL=(Ue,Dt,yn)=>Dt in Ue?aL(Ue,Dt,{enumerable:!0,configurable:!0,writable:!0,value:yn}):Ue[Dt]=yn;var U=(Ue,Dt,yn)=>(cL(Ue,typeof Dt!="symbol"?Dt+"":Dt,yn),yn);(function(){"use strict";const Ue=new Set,Dt={emit(e,t,n,r){Dt.invoke(ug(e,t,n,r))},invoke(e){Ue.forEach(t=>t.handle(e))},connect(e){Ue.add(e)},disconnect(e){Ue.delete(e)}},yn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ag=e=>crypto.getRandomValues(new Uint8Array(e)),cg=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*r*t/e.length);return(i=t)=>{let o="";for(;;){let a=n(s),c=s;for(;c--;)if(o+=e[a[c]&r]||"",o.length===i)return o}}},Bc=(e,t=21)=>cg(e,t,ag),lg=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=yn[n[e]&63];return t};function Pe(){return lg()}function ug(e,t,n,r){return{id:Pe(),target:e,sender:t,data:n,player:r}}function Gc(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Rr(e,t,n){const r=Pe(),s=e.toLowerCase(),i=t.map(a=>a.toLowerCase()),o={id(){return r},name(){return e},tags(){return t},emit(a,c,l){Dt.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=Gc(a.target),u=c.toLowerCase();i.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||s===u)&&n({...a,target:l})}};return Dt.connect(o),o}function hg(e){const t=new Set;function n(r){t.has(r.id)||(t.add(r.id),Dt.invoke(r))}return Rr("forward",["all"],r=>{t.has(r.id)||(t.add(r.id),e(r))}),n}var Ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function io(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function fg(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),n}var Kc="abcdefghijklmnopqrstuvwxyz",Wc="ABCDEFGHIJKLMNOPQRSTUVWXYZ",jc="0123456789",dg="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",pg="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const gg=jc,mg=Kc,Eg=Wc;var _g=gg+mg+Eg,oo={lowercase:Kc,uppercase:Wc,numbers:jc,nolookalikes:dg,nolookalikesSafe:pg,alphanumeric:_g};const Hc=32,yg=33;function Cs(e,t){return new Array(e).fill(t)}function Tg(e,t,n,r,s=0){const i=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:Cs(i,0),color:Cs(i,0),bg:Cs(i,s)}}function Sg(e,t,n,r=1,s=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:s,bg:Hc}}function Ag(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function wg(e,t,n,r,s=0){const i=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:Cs(i,s)}}function vg(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:2}}var Yt=(e=>(e[e.START=0]="START",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.SCROLL=5]="SCROLL",e))(Yt||{});const Rg={start:0,left:1,right:2,top:3,bottom:4,scroll:5},Ng={0:1,1:20,2:20,3:1,4:1,5:40},Cg=1,Ig=16,Lg=256;var lt=(e=>(e[e.NONE=0]="NONE",e[e.MOVE_UP=1]="MOVE_UP",e[e.MOVE_DOWN=2]="MOVE_DOWN",e[e.MOVE_LEFT=3]="MOVE_LEFT",e[e.MOVE_RIGHT=4]="MOVE_RIGHT",e[e.OK_BUTTON=5]="OK_BUTTON",e[e.CANCEL_BUTTON=6]="CANCEL_BUTTON",e[e.MENU_BUTTON=7]="MENU_BUTTON",e))(lt||{}),Vc={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Ns,function(){return n.importState=function(s){var i=new n;return i.importState(s),i},n;function n(){return function(s){var i=0,o=0,a=0,c=1;s.length==0&&(s=[+new Date]);var l=r();i=l(" "),o=l(" "),a=l(" ");for(var u=0;u<s.length;u++)i-=l(s[u]),i<0&&(i+=1),o-=l(s[u]),o<0&&(o+=1),a-=l(s[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*i+c*23283064365386963e-26;return i=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=s,h.exportState=function(){return[i,o,a,c]},h.importState=function(d){i=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,i=function(o){o=o.toString();for(var a=0;a<o.length;a++){s+=o.charCodeAt(a);var c=.02519603282416938*s;s=c>>>0,c-=s,c*=s,s=c>>>0,c-=s,s+=c*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(Vc);var Og=Vc.exports,bg=io(Og);const kg=bg("089fad0j9awfem09wavefc09uwaef");function ao(e,t,n){return Math.max(t,Math.min(n,e))}function Mg(){return kg()}function Hn(e,t){const n=Math.min(e,t),s=Math.max(e,t)-n+1;return n+Math.floor(Mg()*s)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var xg=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)s.hasOwnProperty(i)&&(r[i]=s[i])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ug=Object.prototype.hasOwnProperty;function co(e,t){return Ug.call(e,t)}function lo(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var s in e)co(e,s)&&r.push(s);return r}function It(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function uo(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Tn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Yc(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ho(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(ho(e[t]))return!0}else if(typeof e=="object"){for(var r=lo(e),s=r.length,i=0;i<s;i++)if(ho(e[r[i]]))return!0}}return!1}function zc(e,t){var n=[e];for(var r in t){var s=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof s<"u"&&n.push(r+": "+s)}return n.join(`
`)}var qc=function(e){xg(t,e);function t(n,r,s,i,o){var a=this.constructor,c=e.call(this,zc(n,{name:r,index:s,operation:i,tree:o}))||this;return c.name=r,c.index=s,c.operation=i,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=zc(n,{name:r,index:s,operation:i,tree:o}),c}return t}(Error),et=qc,Pg=It,Vn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Is(n,this.path);r&&(r=It(r));var s=Sn(n,{op:"remove",path:this.from}).removed;return Sn(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Is(n,this.from);return Sn(n,{op:"add",path:this.path,value:It(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Nr(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Dg={add:function(e,t,n){return uo(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Vn.move,copy:Vn.copy,test:Vn.test,_get:Vn._get};function Is(e,t){if(t=="")return e;var n={op:"_get",path:t};return Sn(e,n),n.value}function Sn(e,t,n,r,s,i){if(n===void 0&&(n=!1),r===void 0&&(r=!0),s===void 0&&(s=!0),i===void 0&&(i=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ls(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Is(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Nr(e,t.value),o.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return o}}else{r||(e=It(e));var a=t.path||"",c=a.split("/"),l=e,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=Ls;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=Yc(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=t.path),d!==void 0&&p(t,0,e,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!uo(f))throw new et("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);uo(f)&&(f=~~f)}if(u>=h){if(n&&t.op==="add"&&f>l.length)throw new et("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);var o=Dg[t.op].call(t,l,f,e);if(o.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o}}else if(u>=h){var o=Vn[t.op].call(t,l,f,e);if(o.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new et("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}}function fo(e,t,n,r,s){if(r===void 0&&(r=!0),s===void 0&&(s=!0),n&&!Array.isArray(t))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=It(e));for(var i=new Array(t.length),o=0,a=t.length;o<a;o++)i[o]=Sn(e,t[o],n,!0,s,o),e=i[o].newDocument;return i.newDocument=e,i}function Fg(e,t,n){var r=Sn(e,t);if(r.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ls(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new et("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Vn[e.op]){if(typeof e.path!="string")throw new et("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new et('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new et("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&ho(e.value))throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var s=e.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new et("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new et("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Xc([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new et("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Xc(e,t,n){try{if(!Array.isArray(e))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)fo(It(t),It(e),n||!0);else{n=n||Ls;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(s){if(s instanceof et)return s;throw s}}function Nr(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),s,i,o;if(n&&r){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(!Nr(e[s],t[s]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(i=a.length,i!==Object.keys(t).length)return!1;for(s=i;s--!==0;)if(!t.hasOwnProperty(a[s]))return!1;for(s=i;s--!==0;)if(o=a[s],!Nr(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var $g=Object.freeze({__proto__:null,JsonPatchError:et,_areEquals:Nr,applyOperation:Sn,applyPatch:fo,applyReducer:Fg,deepClone:Pg,getValueByPointer:Is,validate:Xc,validator:Ls});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var po=new WeakMap,Bg=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Gg=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Kg(e){return po.get(e)}function Wg(e,t){return e.observers.get(t)}function jg(e,t){e.observers.delete(t.callback)}function Hg(e,t){t.unobserve()}function Vg(e,t){var n=[],r,s=Kg(e);if(!s)s=new Bg(e),po.set(e,s);else{var i=Wg(s,t);r=i&&i.observer}if(r)return r;if(r={},s.value=It(e),t){r.callback=t,r.next=null;var o=function(){go(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){go(r),clearTimeout(r.next),jg(s,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},s.observers.set(t,new Gg(t,r)),r}function go(e,t){t===void 0&&(t=!1);var n=po.get(e.object);mo(n.value,e.object,e.patches,"",t),e.patches.length&&fo(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function mo(e,t,n,r,s){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var i=lo(t),o=lo(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(co(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var h=t[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?mo(u,h,n,r+"/"+Tn(l),s):u!==h&&(s&&n.push({op:"test",path:r+"/"+Tn(l),value:It(u)}),n.push({op:"replace",path:r+"/"+Tn(l),value:It(h)}))}else Array.isArray(e)===Array.isArray(t)?(s&&n.push({op:"test",path:r+"/"+Tn(l),value:It(u)}),n.push({op:"remove",path:r+"/"+Tn(l)}),a=!0):(s&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&i.length==o.length))for(var c=0;c<i.length;c++){var l=i[c];!co(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+Tn(l),value:It(t[l])})}}}function Eo(e,t,n){n===void 0&&(n=!1);var r=[];return mo(e,t,r,"",n),r}var Yg=Object.freeze({__proto__:null,compare:Eo,generate:go,observe:Vg,unobserve:Hg});Object.assign({},$g,Yg,{JsonPatchError:qc,deepClone:It,escapePathComponent:Tn,unescapePathComponent:Yc});function _(e){return e!=null}function zg(e,t){return Eo(e,t).length===0}function qg(e){return It(e)}function Ft(e){return typeof e=="number"}function ut(e){return typeof e=="string"}function De(e){return Array.isArray(e)}function Xg(e){return e}function _o(e,t,n){typeof e!="number"&&(e=0,t=0,n=1),typeof t!="number"&&(t=e,e=0,n=1),typeof n!="number"&&(n=1);const r=[],s=Math.min(e,t),i=Math.max(e,t);for(let o=s;o<=i;o+=n)r.push(o);return r}function Jg(e){return e[Hn(0,e.length-1)]}function Fe(...e){return Jg(e.flat())}function Qg(e){return[...new Set(e)].filter(_)}function Jc(e,t){const n=e??at.WALK,r=t??at.WALK;switch(n){case at.WALK:return r!==at.WALK;case at.SWIM:return r!==at.SWIM;case at.SOLID:return!0;case at.BULLET:return r!==at.WALK&&r!==at.SWIM}}function yo(e,t){var r,s;return[...((s=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:s.values())??[]].map(i=>typeof i=="string"?e==null?void 0:e.objects[i]:e==null?void 0:e.terrain[i]).filter(_)}function Zg(e,t){const n=Ma(t),r=vf(t),s=Rf(t);return e.filter(i=>!(_(n)&&sm(i)!==n||_(r)&&im(i)!==r||_(s)&&om(i)!==s)).filter(_)}function To(e,t){return _(e)?t.map(n=>{var r;if(typeof n=="string"){const s=e.objects[n];if(_(s))return s;const i=yo(e,n.toLowerCase());if(i.length)return i}else if(Ye(n)&&n.x>=0&&n.x<e.width&&n.y>=0&&n.y<e.height){const s=n.x+n.y*e.width,i=(r=e.lookup)==null?void 0:r[s];return _(i)?e.objects[i]:e.terrain[s]}}).flat().filter(_):[]}function tm(e,t){let n=0,r;for(let s=0;s<t.length;++s){const i=t[s];if(i){const o=e.x-(i.x??0),a=e.y-(i.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=i)}}return r}const Qc=60,Zc=25,em=new Array(Qc*Zc);function tl(e=Xg){const t={id:Pe(),x:0,y:0,width:Qc,height:Zc,terrain:em.slice(0),objects:{}};return e(t)}function nm(e,t){return!_(e)||t.x<0||t.x>=e.width||t.y<0||t.y>=e.height?-1:t.x+t.y*e.width}function rm(e,t){const n=nm(e,t);if(n<0||!_(e==null?void 0:e.lookup))return;const r=wo(e,e.lookup[n]??"");return _(r)?r:e.terrain[n]}function sm(e){var t;return((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"object").toLowerCase()}function im(e){var t;return(e==null?void 0:e.color)??((t=e==null?void 0:e.kinddata)==null?void 0:t.color)??H.BLACK}function om(e){var t;return(e==null?void 0:e.bg)??((t=e==null?void 0:e.kinddata)==null?void 0:t.bg)??H.BLACK}function So(e,t){if(!_(e)||!te(t))return;const n=yf(t);_(n)&&(e.color=n);const r=Tf(t);_(r)&&(e.bg=r)}function am(e,t){if(!(!_(e)||!_(t)||!_(t.x)||!_(t.y)||t.x<0||t.x>=e.width||t.y<0||t.y>=e.height))return e.terrain[t.x+t.y*e.width]=t,t}function Ao(e,t){if(!_(e)||!_(t))return;const n={...t,id:t.id??Pe()};return e.objects[n.id]=n,n}function cm(e,t,n,r){return am(e,{x:t,y:n,kind:r})}function lm(e,t,n,r){return Ao(e,{x:t,y:n,kind:r})}function wo(e,t){if(e)return e.objects[t]}function Yn(e,t,n){const r=(t==null?void 0:t.x)??0,s=(t==null?void 0:t.y)??0,i={x:r,y:s},o={...i},a=bn({x:(t==null?void 0:t.lx)??i.x,y:(t==null?void 0:t.ly)??i.y},i);for(let c=0;c<n.length&&i.x===r&&i.y===s;++c){const l=W[n[c]];switch(l){case W.IDLE:break;case W.NORTH:case W.SOUTH:case W.WEST:case W.EAST:de(i,l);break;case W.BY:break;case W.AT:break;case W.FLOW:de(i,a);break;case W.SEEK:{const u=Ro(e,t);Ye(u)&&de(i,bn(o,u));break}case W.RNDNS:de(i,Fe(W.NORTH,W.SOUTH));break;case W.RNDNE:de(i,Fe(W.NORTH,W.EAST));break;case W.RND:de(i,Fe(W.NORTH,W.SOUTH,W.WEST,W.EAST));break;case W.CW:{const u=Yn(e,t,n.slice(c+1));de(i,bn(o,u));break}case W.CCW:{const u=Yn(e,t,n.slice(c+1));de(i,bn(o,u));break}case W.OPP:{const u=Yn(e,t,n.slice(c+1));de(i,bn(o,u));break}case W.RNDP:{const u=Yn(e,t,n.slice(c+1));switch(bn(o,u)){case W.NORTH:case W.SOUTH:i.x+=Fe(-1,1);break;case W.WEST:case W.EAST:i.y+=Fe(-1,1);break}break}}}return i}function vo(e,t){return _(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function Ro(e,t){var s;if(!_(e)||!_(t))return;const n=((s=t.stats)==null?void 0:s.player)??"",r=e.objects[n];if(_(r))return r;if(Ye(t))return tm(t,yo(e,"player"))}const No=40,Co=Math.round(1e3/No),um=3;var el=typeof global=="object"&&global&&global.Object===Object&&global,hm=typeof self=="object"&&self&&self.Object===Object&&self,Ee=el||hm||Function("return this")(),zt=Ee.Symbol,nl=Object.prototype,fm=nl.hasOwnProperty,dm=nl.toString,Cr=zt?zt.toStringTag:void 0;function pm(e){var t=fm.call(e,Cr),n=e[Cr];try{e[Cr]=void 0;var r=!0}catch{}var s=dm.call(e);return r&&(t?e[Cr]=n:delete e[Cr]),s}var gm=Object.prototype,mm=gm.toString;function Em(e){return mm.call(e)}var _m="[object Null]",ym="[object Undefined]",rl=zt?zt.toStringTag:void 0;function nn(e){return e==null?e===void 0?ym:_m:rl&&rl in Object(e)?pm(e):Em(e)}function ie(e){return e!=null&&typeof e=="object"}var Tm="[object Symbol]";function Os(e){return typeof e=="symbol"||ie(e)&&nn(e)==Tm}function Ir(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s}var K=Array.isArray,Sm=1/0,sl=zt?zt.prototype:void 0,il=sl?sl.toString:void 0;function ol(e){if(typeof e=="string")return e;if(K(e))return Ir(e,ol)+"";if(Os(e))return il?il.call(e):"";var t=e+"";return t=="0"&&1/e==-Sm?"-0":t}var Am=/\s/;function wm(e){for(var t=e.length;t--&&Am.test(e.charAt(t)););return t}var vm=/^\s+/;function Rm(e){return e&&e.slice(0,wm(e)+1).replace(vm,"")}function qt(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var al=NaN,Nm=/^[-+]0x[0-9a-f]+$/i,Cm=/^0b[01]+$/i,Im=/^0o[0-7]+$/i,Lm=parseInt;function Om(e){if(typeof e=="number")return e;if(Os(e))return al;if(qt(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=qt(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Rm(e);var n=Cm.test(e);return n||Im.test(e)?Lm(e.slice(2),n?2:8):Nm.test(e)?al:+e}var cl=1/0,bm=17976931348623157e292;function km(e){if(!e)return e===0?e:0;if(e=Om(e),e===cl||e===-cl){var t=e<0?-1:1;return t*bm}return e===e?e:0}function Lr(e){var t=km(e),n=t%1;return t===t?n?t-n:t:0}function zn(e){return e}var Mm="[object AsyncFunction]",xm="[object Function]",Um="[object GeneratorFunction]",Pm="[object Proxy]";function $e(e){if(!qt(e))return!1;var t=nn(e);return t==xm||t==Um||t==Mm||t==Pm}var Io=Ee["__core-js_shared__"],ll=function(){var e=/[^.]+$/.exec(Io&&Io.keys&&Io.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Dm(e){return!!ll&&ll in e}var Fm=Function.prototype,$m=Fm.toString;function An(e){if(e!=null){try{return $m.call(e)}catch{}try{return e+""}catch{}}return""}var Bm=/[\\^$.*+?()[\]{}|]/g,Gm=/^\[object .+?Constructor\]$/,Km=Function.prototype,Wm=Object.prototype,jm=Km.toString,Hm=Wm.hasOwnProperty,Vm=RegExp("^"+jm.call(Hm).replace(Bm,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ym(e){if(!qt(e)||Dm(e))return!1;var t=$e(e)?Vm:Gm;return t.test(An(e))}function zm(e,t){return e==null?void 0:e[t]}function wn(e,t){var n=zm(e,t);return Ym(n)?n:void 0}var Lo=wn(Ee,"WeakMap"),ul=Object.create,qm=function(){function e(){}return function(t){if(!qt(t))return{};if(ul)return ul(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function Xm(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function ht(){}function Jm(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var Qm=800,Zm=16,tE=Date.now;function eE(e){var t=0,n=0;return function(){var r=tE(),s=Zm-(r-n);if(n=r,s>0){if(++t>=Qm)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function nE(e){return function(){return e}}var bs=function(){try{var e=wn(Object,"defineProperty");return e({},"",{}),e}catch{}}(),rE=bs?function(e,t){return bs(e,"toString",{configurable:!0,enumerable:!1,value:nE(t),writable:!0})}:zn,sE=rE,iE=eE(sE);function hl(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function fl(e,t,n,r){for(var s=e.length,i=n+(r?1:-1);r?i--:++i<s;)if(t(e[i],i,e))return i;return-1}function oE(e){return e!==e}function aE(e,t,n){for(var r=n-1,s=e.length;++r<s;)if(e[r]===t)return r;return-1}function Oo(e,t,n){return t===t?aE(e,t,n):fl(e,oE,n)}function dl(e,t){var n=e==null?0:e.length;return!!n&&Oo(e,t,0)>-1}var cE=9007199254740991,lE=/^(?:0|[1-9]\d*)$/;function ks(e,t){var n=typeof e;return t=t??cE,!!t&&(n=="number"||n!="symbol"&&lE.test(e))&&e>-1&&e%1==0&&e<t}function bo(e,t,n){t=="__proto__"&&bs?bs(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Or(e,t){return e===t||e!==e&&t!==t}var uE=Object.prototype,hE=uE.hasOwnProperty;function Ms(e,t,n){var r=e[t];(!(hE.call(e,t)&&Or(r,n))||n===void 0&&!(t in e))&&bo(e,t,n)}function br(e,t,n,r){var s=!n;n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],c=r?r(n[a],e[a],a,n,e):void 0;c===void 0&&(c=e[a]),s?bo(n,a,c):Ms(n,a,c)}return n}var pl=Math.max;function fE(e,t,n){return t=pl(t===void 0?e.length-1:t,0),function(){for(var r=arguments,s=-1,i=pl(r.length-t,0),o=Array(i);++s<i;)o[s]=r[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=r[s];return a[t]=n(o),Xm(e,this,a)}}function ko(e,t){return iE(fE(e,t,zn),e+"")}var dE=9007199254740991;function Mo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=dE}function _e(e){return e!=null&&Mo(e.length)&&!$e(e)}function xs(e,t,n){if(!qt(n))return!1;var r=typeof t;return(r=="number"?_e(n)&&ks(t,n.length):r=="string"&&t in n)?Or(n[t],e):!1}function pE(e){return ko(function(t,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(i=e.length>3&&typeof i=="function"?(s--,i):void 0,o&&xs(n[0],n[1],o)&&(i=s<3?void 0:i,s=1),t=Object(t);++r<s;){var a=n[r];a&&e(t,a,r,i)}return t})}var gE=Object.prototype;function kr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||gE;return e===n}function mE(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var EE="[object Arguments]";function gl(e){return ie(e)&&nn(e)==EE}var ml=Object.prototype,_E=ml.hasOwnProperty,yE=ml.propertyIsEnumerable,TE=gl(function(){return arguments}())?gl:function(e){return ie(e)&&_E.call(e,"callee")&&!yE.call(e,"callee")},Us=TE;function SE(){return!1}var El=typeof exports=="object"&&exports&&!exports.nodeType&&exports,_l=El&&typeof module=="object"&&module&&!module.nodeType&&module,AE=_l&&_l.exports===El,yl=AE?Ee.Buffer:void 0,wE=yl?yl.isBuffer:void 0,vE=wE||SE,Mr=vE,RE="[object Arguments]",NE="[object Array]",CE="[object Boolean]",IE="[object Date]",LE="[object Error]",OE="[object Function]",bE="[object Map]",kE="[object Number]",ME="[object Object]",xE="[object RegExp]",UE="[object Set]",PE="[object String]",DE="[object WeakMap]",FE="[object ArrayBuffer]",$E="[object DataView]",BE="[object Float32Array]",GE="[object Float64Array]",KE="[object Int8Array]",WE="[object Int16Array]",jE="[object Int32Array]",HE="[object Uint8Array]",VE="[object Uint8ClampedArray]",YE="[object Uint16Array]",zE="[object Uint32Array]",Q={};Q[BE]=Q[GE]=Q[KE]=Q[WE]=Q[jE]=Q[HE]=Q[VE]=Q[YE]=Q[zE]=!0,Q[RE]=Q[NE]=Q[FE]=Q[CE]=Q[$E]=Q[IE]=Q[LE]=Q[OE]=Q[bE]=Q[kE]=Q[ME]=Q[xE]=Q[UE]=Q[PE]=Q[DE]=!1;function qE(e){return ie(e)&&Mo(e.length)&&!!Q[nn(e)]}function xr(e){return function(t){return e(t)}}var Tl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ur=Tl&&typeof module=="object"&&module&&!module.nodeType&&module,XE=Ur&&Ur.exports===Tl,xo=XE&&el.process,rn=function(){try{var e=Ur&&Ur.require&&Ur.require("util").types;return e||xo&&xo.binding&&xo.binding("util")}catch{}}(),Sl=rn&&rn.isTypedArray,JE=Sl?xr(Sl):qE,Uo=JE,QE=Object.prototype,ZE=QE.hasOwnProperty;function Al(e,t){var n=K(e),r=!n&&Us(e),s=!n&&!r&&Mr(e),i=!n&&!r&&!s&&Uo(e),o=n||r||s||i,a=o?mE(e.length,String):[],c=a.length;for(var l in e)(t||ZE.call(e,l))&&!(o&&(l=="length"||s&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ks(l,c)))&&a.push(l);return a}function wl(e,t){return function(n){return e(t(n))}}var t_=wl(Object.keys,Object),e_=Object.prototype,n_=e_.hasOwnProperty;function vl(e){if(!kr(e))return t_(e);var t=[];for(var n in Object(e))n_.call(e,n)&&n!="constructor"&&t.push(n);return t}function $t(e){return _e(e)?Al(e):vl(e)}var r_=Object.prototype,s_=r_.hasOwnProperty,Bt=pE(function(e,t){if(kr(t)||_e(t)){br(t,$t(t),e);return}for(var n in t)s_.call(t,n)&&Ms(e,n,t[n])});function i_(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var o_=Object.prototype,a_=o_.hasOwnProperty;function c_(e){if(!qt(e))return i_(e);var t=kr(e),n=[];for(var r in e)r=="constructor"&&(t||!a_.call(e,r))||n.push(r);return n}function Ps(e){return _e(e)?Al(e,!0):c_(e)}var l_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,u_=/^\w*$/;function Po(e,t){if(K(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Os(e)?!0:u_.test(e)||!l_.test(e)||t!=null&&e in Object(t)}var Pr=wn(Object,"create");function h_(){this.__data__=Pr?Pr(null):{},this.size=0}function f_(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var d_="__lodash_hash_undefined__",p_=Object.prototype,g_=p_.hasOwnProperty;function m_(e){var t=this.__data__;if(Pr){var n=t[e];return n===d_?void 0:n}return g_.call(t,e)?t[e]:void 0}var E_=Object.prototype,__=E_.hasOwnProperty;function y_(e){var t=this.__data__;return Pr?t[e]!==void 0:__.call(t,e)}var T_="__lodash_hash_undefined__";function S_(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Pr&&t===void 0?T_:t,this}function vn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vn.prototype.clear=h_,vn.prototype.delete=f_,vn.prototype.get=m_,vn.prototype.has=y_,vn.prototype.set=S_;function A_(){this.__data__=[],this.size=0}function Ds(e,t){for(var n=e.length;n--;)if(Or(e[n][0],t))return n;return-1}var w_=Array.prototype,v_=w_.splice;function R_(e){var t=this.__data__,n=Ds(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():v_.call(t,n,1),--this.size,!0}function N_(e){var t=this.__data__,n=Ds(t,e);return n<0?void 0:t[n][1]}function C_(e){return Ds(this.__data__,e)>-1}function I_(e,t){var n=this.__data__,r=Ds(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function Be(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Be.prototype.clear=A_,Be.prototype.delete=R_,Be.prototype.get=N_,Be.prototype.has=C_,Be.prototype.set=I_;var Dr=wn(Ee,"Map");function L_(){this.size=0,this.__data__={hash:new vn,map:new(Dr||Be),string:new vn}}function O_(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Fs(e,t){var n=e.__data__;return O_(t)?n[typeof t=="string"?"string":"hash"]:n.map}function b_(e){var t=Fs(this,e).delete(e);return this.size-=t?1:0,t}function k_(e){return Fs(this,e).get(e)}function M_(e){return Fs(this,e).has(e)}function x_(e,t){var n=Fs(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Ge(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ge.prototype.clear=L_,Ge.prototype.delete=b_,Ge.prototype.get=k_,Ge.prototype.has=M_,Ge.prototype.set=x_;var U_="Expected a function";function Do(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(U_);var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var o=e.apply(this,r);return n.cache=i.set(s,o)||i,o};return n.cache=new(Do.Cache||Ge),n}Do.Cache=Ge;var P_=500;function D_(e){var t=Do(e,function(r){return n.size===P_&&n.clear(),r}),n=t.cache;return t}var F_=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$_=/\\(\\)?/g,B_=D_(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(F_,function(n,r,s,i){t.push(s?i.replace($_,"$1"):r||n)}),t});function G_(e){return e==null?"":ol(e)}function $s(e,t){return K(e)?e:Po(e,t)?[e]:B_(G_(e))}var K_=1/0;function Fr(e){if(typeof e=="string"||Os(e))return e;var t=e+"";return t=="0"&&1/e==-K_?"-0":t}function Fo(e,t){t=$s(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Fr(t[n++])];return n&&n==r?e:void 0}function W_(e,t,n){var r=e==null?void 0:Fo(e,t);return r===void 0?n:r}function $o(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e}var Rl=zt?zt.isConcatSpreadable:void 0;function j_(e){return K(e)||Us(e)||!!(Rl&&e&&e[Rl])}function Bs(e,t,n,r,s){var i=-1,o=e.length;for(n||(n=j_),s||(s=[]);++i<o;){var a=e[i];t>0&&n(a)?t>1?Bs(a,t-1,n,r,s):$o(s,a):r||(s[s.length]=a)}return s}function oe(e){var t=e==null?0:e.length;return t?Bs(e,1):[]}var H_=wl(Object.getPrototypeOf,Object),Nl=H_;function Cl(e,t,n){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),n=n>s?s:n,n<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(s);++r<s;)i[r]=e[r+t];return i}function V_(e,t,n,r){var s=-1,i=e==null?0:e.length;for(r&&i&&(n=e[++s]);++s<i;)n=t(n,e[s],s,e);return n}function Y_(){this.__data__=new Be,this.size=0}function z_(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function q_(e){return this.__data__.get(e)}function X_(e){return this.__data__.has(e)}var J_=200;function Q_(e,t){var n=this.__data__;if(n instanceof Be){var r=n.__data__;if(!Dr||r.length<J_-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ge(r)}return n.set(e,t),this.size=n.size,this}function ye(e){var t=this.__data__=new Be(e);this.size=t.size}ye.prototype.clear=Y_,ye.prototype.delete=z_,ye.prototype.get=q_,ye.prototype.has=X_,ye.prototype.set=Q_;function Z_(e,t){return e&&br(t,$t(t),e)}function ty(e,t){return e&&br(t,Ps(t),e)}var Il=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ll=Il&&typeof module=="object"&&module&&!module.nodeType&&module,ey=Ll&&Ll.exports===Il,Ol=ey?Ee.Buffer:void 0,bl=Ol?Ol.allocUnsafe:void 0;function ny(e,t){if(t)return e.slice();var n=e.length,r=bl?bl(n):new e.constructor(n);return e.copy(r),r}function Bo(e,t){for(var n=-1,r=e==null?0:e.length,s=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[s++]=o)}return i}function kl(){return[]}var ry=Object.prototype,sy=ry.propertyIsEnumerable,Ml=Object.getOwnPropertySymbols,Go=Ml?function(e){return e==null?[]:(e=Object(e),Bo(Ml(e),function(t){return sy.call(e,t)}))}:kl;function iy(e,t){return br(e,Go(e),t)}var oy=Object.getOwnPropertySymbols,xl=oy?function(e){for(var t=[];e;)$o(t,Go(e)),e=Nl(e);return t}:kl;function ay(e,t){return br(e,xl(e),t)}function Ul(e,t,n){var r=t(e);return K(e)?r:$o(r,n(e))}function Ko(e){return Ul(e,$t,Go)}function Pl(e){return Ul(e,Ps,xl)}var Wo=wn(Ee,"DataView"),jo=wn(Ee,"Promise"),qn=wn(Ee,"Set"),Dl="[object Map]",cy="[object Object]",Fl="[object Promise]",$l="[object Set]",Bl="[object WeakMap]",Gl="[object DataView]",ly=An(Wo),uy=An(Dr),hy=An(jo),fy=An(qn),dy=An(Lo),Rn=nn;(Wo&&Rn(new Wo(new ArrayBuffer(1)))!=Gl||Dr&&Rn(new Dr)!=Dl||jo&&Rn(jo.resolve())!=Fl||qn&&Rn(new qn)!=$l||Lo&&Rn(new Lo)!=Bl)&&(Rn=function(e){var t=nn(e),n=t==cy?e.constructor:void 0,r=n?An(n):"";if(r)switch(r){case ly:return Gl;case uy:return Dl;case hy:return Fl;case fy:return $l;case dy:return Bl}return t});var Xn=Rn,py=Object.prototype,gy=py.hasOwnProperty;function my(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&gy.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Gs=Ee.Uint8Array;function Ho(e){var t=new e.constructor(e.byteLength);return new Gs(t).set(new Gs(e)),t}function Ey(e,t){var n=t?Ho(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var _y=/\w*$/;function yy(e){var t=new e.constructor(e.source,_y.exec(e));return t.lastIndex=e.lastIndex,t}var Kl=zt?zt.prototype:void 0,Wl=Kl?Kl.valueOf:void 0;function Ty(e){return Wl?Object(Wl.call(e)):{}}function Sy(e,t){var n=t?Ho(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var Ay="[object Boolean]",wy="[object Date]",vy="[object Map]",Ry="[object Number]",Ny="[object RegExp]",Cy="[object Set]",Iy="[object String]",Ly="[object Symbol]",Oy="[object ArrayBuffer]",by="[object DataView]",ky="[object Float32Array]",My="[object Float64Array]",xy="[object Int8Array]",Uy="[object Int16Array]",Py="[object Int32Array]",Dy="[object Uint8Array]",Fy="[object Uint8ClampedArray]",$y="[object Uint16Array]",By="[object Uint32Array]";function Gy(e,t,n){var r=e.constructor;switch(t){case Oy:return Ho(e);case Ay:case wy:return new r(+e);case by:return Ey(e,n);case ky:case My:case xy:case Uy:case Py:case Dy:case Fy:case $y:case By:return Sy(e,n);case vy:return new r;case Ry:case Iy:return new r(e);case Ny:return yy(e);case Cy:return new r;case Ly:return Ty(e)}}function Ky(e){return typeof e.constructor=="function"&&!kr(e)?qm(Nl(e)):{}}var Wy="[object Map]";function jy(e){return ie(e)&&Xn(e)==Wy}var jl=rn&&rn.isMap,Hy=jl?xr(jl):jy,Vy="[object Set]";function Yy(e){return ie(e)&&Xn(e)==Vy}var Hl=rn&&rn.isSet,zy=Hl?xr(Hl):Yy,qy=1,Xy=2,Jy=4,Vl="[object Arguments]",Qy="[object Array]",Zy="[object Boolean]",tT="[object Date]",eT="[object Error]",Yl="[object Function]",nT="[object GeneratorFunction]",rT="[object Map]",sT="[object Number]",zl="[object Object]",iT="[object RegExp]",oT="[object Set]",aT="[object String]",cT="[object Symbol]",lT="[object WeakMap]",uT="[object ArrayBuffer]",hT="[object DataView]",fT="[object Float32Array]",dT="[object Float64Array]",pT="[object Int8Array]",gT="[object Int16Array]",mT="[object Int32Array]",ET="[object Uint8Array]",_T="[object Uint8ClampedArray]",yT="[object Uint16Array]",TT="[object Uint32Array]",z={};z[Vl]=z[Qy]=z[uT]=z[hT]=z[Zy]=z[tT]=z[fT]=z[dT]=z[pT]=z[gT]=z[mT]=z[rT]=z[sT]=z[zl]=z[iT]=z[oT]=z[aT]=z[cT]=z[ET]=z[_T]=z[yT]=z[TT]=!0,z[eT]=z[Yl]=z[lT]=!1;function Ks(e,t,n,r,s,i){var o,a=t&qy,c=t&Xy,l=t&Jy;if(n&&(o=s?n(e,r,s,i):n(e)),o!==void 0)return o;if(!qt(e))return e;var u=K(e);if(u){if(o=my(e),!a)return Jm(e,o)}else{var h=Xn(e),d=h==Yl||h==nT;if(Mr(e))return ny(e,a);if(h==zl||h==Vl||d&&!s){if(o=c||d?{}:Ky(e),!a)return c?ay(e,ty(o,e)):iy(e,Z_(o,e))}else{if(!z[h])return s?e:{};o=Gy(e,h,a)}}i||(i=new ye);var f=i.get(e);if(f)return f;i.set(e,o),zy(e)?e.forEach(function(w){o.add(Ks(w,t,n,w,e,i))}):Hy(e)&&e.forEach(function(w,A){o.set(A,Ks(w,t,n,A,e,i))});var p=l?c?Pl:Ko:c?Ps:$t,E=u?void 0:p(e);return hl(E||e,function(w,A){E&&(A=w,w=e[A]),Ms(o,A,Ks(w,t,n,A,e,i))}),o}var ST=4;function St(e){return Ks(e,ST)}function $r(e){for(var t=-1,n=e==null?0:e.length,r=0,s=[];++t<n;){var i=e[t];i&&(s[r++]=i)}return s}var AT="__lodash_hash_undefined__";function wT(e){return this.__data__.set(e,AT),this}function vT(e){return this.__data__.has(e)}function Jn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Ge;++t<n;)this.add(e[t])}Jn.prototype.add=Jn.prototype.push=wT,Jn.prototype.has=vT;function ql(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Vo(e,t){return e.has(t)}var RT=1,NT=2;function Xl(e,t,n,r,s,i){var o=n&RT,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=i.get(e),u=i.get(t);if(l&&u)return l==t&&u==e;var h=-1,d=!0,f=n&NT?new Jn:void 0;for(i.set(e,t),i.set(t,e);++h<a;){var p=e[h],E=t[h];if(r)var w=o?r(E,p,h,t,e,i):r(p,E,h,e,t,i);if(w!==void 0){if(w)continue;d=!1;break}if(f){if(!ql(t,function(A,v){if(!Vo(f,v)&&(p===A||s(p,A,n,r,i)))return f.push(v)})){d=!1;break}}else if(!(p===E||s(p,E,n,r,i))){d=!1;break}}return i.delete(e),i.delete(t),d}function CT(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n}function Yo(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var IT=1,LT=2,OT="[object Boolean]",bT="[object Date]",kT="[object Error]",MT="[object Map]",xT="[object Number]",UT="[object RegExp]",PT="[object Set]",DT="[object String]",FT="[object Symbol]",$T="[object ArrayBuffer]",BT="[object DataView]",Jl=zt?zt.prototype:void 0,zo=Jl?Jl.valueOf:void 0;function GT(e,t,n,r,s,i,o){switch(n){case BT:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case $T:return!(e.byteLength!=t.byteLength||!i(new Gs(e),new Gs(t)));case OT:case bT:case xT:return Or(+e,+t);case kT:return e.name==t.name&&e.message==t.message;case UT:case DT:return e==t+"";case MT:var a=CT;case PT:var c=r&IT;if(a||(a=Yo),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=LT,o.set(e,t);var u=Xl(a(e),a(t),r,s,i,o);return o.delete(e),u;case FT:if(zo)return zo.call(e)==zo.call(t)}return!1}var KT=1,WT=Object.prototype,jT=WT.hasOwnProperty;function HT(e,t,n,r,s,i){var o=n&KT,a=Ko(e),c=a.length,l=Ko(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:jT.call(t,d)))return!1}var f=i.get(e),p=i.get(t);if(f&&p)return f==t&&p==e;var E=!0;i.set(e,t),i.set(t,e);for(var w=o;++h<c;){d=a[h];var A=e[d],v=t[d];if(r)var y=o?r(v,A,d,t,e,i):r(A,v,d,e,t,i);if(!(y===void 0?A===v||s(A,v,n,r,i):y)){E=!1;break}w||(w=d=="constructor")}if(E&&!w){var N=e.constructor,T=t.constructor;N!=T&&"constructor"in e&&"constructor"in t&&!(typeof N=="function"&&N instanceof N&&typeof T=="function"&&T instanceof T)&&(E=!1)}return i.delete(e),i.delete(t),E}var VT=1,Ql="[object Arguments]",Zl="[object Array]",Ws="[object Object]",YT=Object.prototype,tu=YT.hasOwnProperty;function zT(e,t,n,r,s,i){var o=K(e),a=K(t),c=o?Zl:Xn(e),l=a?Zl:Xn(t);c=c==Ql?Ws:c,l=l==Ql?Ws:l;var u=c==Ws,h=l==Ws,d=c==l;if(d&&Mr(e)){if(!Mr(t))return!1;o=!0,u=!1}if(d&&!u)return i||(i=new ye),o||Uo(e)?Xl(e,t,n,r,s,i):GT(e,t,c,n,r,s,i);if(!(n&VT)){var f=u&&tu.call(e,"__wrapped__"),p=h&&tu.call(t,"__wrapped__");if(f||p){var E=f?e.value():e,w=p?t.value():t;return i||(i=new ye),s(E,w,n,r,i)}}return d?(i||(i=new ye),HT(e,t,n,r,s,i)):!1}function qo(e,t,n,r,s){return e===t?!0:e==null||t==null||!ie(e)&&!ie(t)?e!==e&&t!==t:zT(e,t,n,r,qo,s)}var qT=1,XT=2;function JT(e,t,n,r){var s=n.length,i=s,o=!r;if(e==null)return!i;for(e=Object(e);s--;){var a=n[s];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++s<i;){a=n[s];var c=a[0],l=e[c],u=a[1];if(o&&a[2]){if(l===void 0&&!(c in e))return!1}else{var h=new ye;if(r)var d=r(l,u,c,e,t,h);if(!(d===void 0?qo(u,l,qT|XT,r,h):d))return!1}}return!0}function eu(e){return e===e&&!qt(e)}function QT(e){for(var t=$t(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,eu(s)]}return t}function nu(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function ZT(e){var t=QT(e);return t.length==1&&t[0][2]?nu(t[0][0],t[0][1]):function(n){return n===e||JT(n,e,t)}}function tS(e,t){return e!=null&&t in Object(e)}function ru(e,t,n){t=$s(t,e);for(var r=-1,s=t.length,i=!1;++r<s;){var o=Fr(t[r]);if(!(i=e!=null&&n(e,o)))break;e=e[o]}return i||++r!=s?i:(s=e==null?0:e.length,!!s&&Mo(s)&&ks(o,s)&&(K(e)||Us(e)))}function eS(e,t){return e!=null&&ru(e,t,tS)}var nS=1,rS=2;function sS(e,t){return Po(e)&&eu(t)?nu(Fr(e),t):function(n){var r=W_(n,e);return r===void 0&&r===t?eS(n,e):qo(t,r,nS|rS)}}function iS(e){return function(t){return t==null?void 0:t[e]}}function oS(e){return function(t){return Fo(t,e)}}function aS(e){return Po(e)?iS(Fr(e)):oS(e)}function Te(e){return typeof e=="function"?e:e==null?zn:typeof e=="object"?K(e)?sS(e[0],e[1]):ZT(e):aS(e)}function cS(e,t,n,r){for(var s=-1,i=e==null?0:e.length;++s<i;){var o=e[s];t(r,o,n(o),e)}return r}function lS(e){return function(t,n,r){for(var s=-1,i=Object(t),o=r(t),a=o.length;a--;){var c=o[e?a:++s];if(n(i[c],c,i)===!1)break}return t}}var uS=lS(),hS=uS;function fS(e,t){return e&&hS(e,t,$t)}function dS(e,t){return function(n,r){if(n==null)return n;if(!_e(n))return e(n,r);for(var s=n.length,i=t?s:-1,o=Object(n);(t?i--:++i<s)&&r(o[i],i,o)!==!1;);return n}}var pS=dS(fS),Nn=pS;function gS(e,t,n,r){return Nn(e,function(s,i,o){t(r,s,n(s),o)}),r}function mS(e,t){return function(n,r){var s=K(n)?cS:gS,i=t?t():{};return s(n,e,Te(r),i)}}var su=Object.prototype,ES=su.hasOwnProperty,Xo=ko(function(e,t){e=Object(e);var n=-1,r=t.length,s=r>2?t[2]:void 0;for(s&&xs(t[0],t[1],s)&&(r=1);++n<r;)for(var i=t[n],o=Ps(i),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||Or(u,su[l])&&!ES.call(e,l))&&(e[l]=i[l])}return e});function iu(e){return ie(e)&&_e(e)}function ou(e,t,n){for(var r=-1,s=e==null?0:e.length;++r<s;)if(n(t,e[r]))return!0;return!1}var _S=200;function yS(e,t,n,r){var s=-1,i=dl,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;n&&(t=Ir(t,xr(n))),r?(i=ou,o=!1):t.length>=_S&&(i=Vo,o=!1,t=new Jn(t));t:for(;++s<a;){var u=e[s],h=n==null?u:n(u);if(u=r||u!==0?u:0,o&&h===h){for(var d=l;d--;)if(t[d]===h)continue t;c.push(u)}else i(t,h,r)||c.push(u)}return c}var js=ko(function(e,t){return iu(e)?yS(e,Bs(t,1,iu,!0)):[]});function Qn(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function At(e,t,n){var r=e==null?0:e.length;return r?(t=n||t===void 0?1:Lr(t),Cl(e,t<0?0:t,r)):[]}function Br(e,t,n){var r=e==null?0:e.length;return r?(t=n||t===void 0?1:Lr(t),t=r-t,Cl(e,0,t<0?0:t)):[]}function TS(e){return typeof e=="function"?e:zn}function k(e,t){var n=K(e)?hl:Nn;return n(e,TS(t))}function SS(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function AS(e,t){var n=!0;return Nn(e,function(r,s,i){return n=!!t(r,s,i),n}),n}function ae(e,t,n){var r=K(e)?SS:AS;return n&&xs(e,t,n)&&(t=void 0),r(e,Te(t))}function au(e,t){var n=[];return Nn(e,function(r,s,i){t(r,s,i)&&n.push(r)}),n}function Xt(e,t){var n=K(e)?Bo:au;return n(e,Te(t))}function wS(e){return function(t,n,r){var s=Object(t);if(!_e(t)){var i=Te(n);t=$t(t),n=function(a){return i(s[a],a,s)}}var o=e(t,n,r);return o>-1?s[i?t[o]:o]:void 0}}var vS=Math.max;function RS(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var s=n==null?0:Lr(n);return s<0&&(s=vS(r+s,0)),fl(e,Te(t),s)}var Zn=wS(RS);function ce(e){return e&&e.length?e[0]:void 0}function NS(e,t){var n=-1,r=_e(e)?Array(e.length):[];return Nn(e,function(s,i,o){r[++n]=t(s,i,o)}),r}function L(e,t){var n=K(e)?Ir:NS;return n(e,Te(t))}function Jt(e,t){return Bs(L(e,t),1)}var CS=Object.prototype,IS=CS.hasOwnProperty,LS=mS(function(e,t,n){IS.call(e,n)?e[n].push(t):bo(e,n,[t])}),OS=Object.prototype,bS=OS.hasOwnProperty;function kS(e,t){return e!=null&&bS.call(e,t)}function b(e,t){return e!=null&&ru(e,t,kS)}var MS="[object String]";function Mt(e){return typeof e=="string"||!K(e)&&ie(e)&&nn(e)==MS}function xS(e,t){return Ir(t,function(n){return e[n]})}function ft(e){return e==null?[]:xS(e,$t(e))}var US=Math.max;function Lt(e,t,n,r){e=_e(e)?e:ft(e),n=n&&!r?Lr(n):0;var s=e.length;return n<0&&(n=US(s+n,0)),Mt(e)?n<=s&&e.indexOf(t,n)>-1:!!s&&Oo(e,t,n)>-1}var PS=Math.max;function cu(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var s=n==null?0:Lr(n);return s<0&&(s=PS(r+s,0)),Oo(e,t,s)}var DS="[object Map]",FS="[object Set]",$S=Object.prototype,BS=$S.hasOwnProperty;function q(e){if(e==null)return!0;if(_e(e)&&(K(e)||typeof e=="string"||typeof e.splice=="function"||Mr(e)||Uo(e)||Us(e)))return!e.length;var t=Xn(e);if(t==DS||t==FS)return!e.size;if(kr(e))return!vl(e).length;for(var n in e)if(BS.call(e,n))return!1;return!0}var GS="[object RegExp]";function KS(e){return ie(e)&&nn(e)==GS}var lu=rn&&rn.isRegExp,Ke=lu?xr(lu):KS;function We(e){return e===void 0}var WS="Expected a function";function jS(e){if(typeof e!="function")throw new TypeError(WS);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function HS(e,t,n,r){if(!qt(e))return e;t=$s(t,e);for(var s=-1,i=t.length,o=i-1,a=e;a!=null&&++s<i;){var c=Fr(t[s]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(s!=o){var u=a[c];l=r?r(u,c,a):void 0,l===void 0&&(l=qt(u)?u:ks(t[s+1])?[]:{})}Ms(a,c,l),a=a[c]}return e}function VS(e,t,n){for(var r=-1,s=t.length,i={};++r<s;){var o=t[r],a=Fo(e,o);n(a,o)&&HS(i,$s(o,e),a)}return i}function le(e,t){if(e==null)return{};var n=Ir(Pl(e),function(r){return[r]});return t=Te(t),VS(e,n,function(r,s){return t(r,s[0])})}function YS(e,t,n,r,s){return s(e,function(i,o,a){n=r?(r=!1,i):t(n,i,o,a)}),n}function Gt(e,t,n){var r=K(e)?V_:YS,s=arguments.length<3;return r(e,Te(t),n,s,Nn)}function Hs(e,t){var n=K(e)?Bo:au;return n(e,jS(Te(t)))}function zS(e,t){var n;return Nn(e,function(r,s,i){return n=t(r,s,i),!n}),!!n}function uu(e,t,n){var r=K(e)?ql:zS;return n&&xs(e,t,n)&&(t=void 0),r(e,Te(t))}var qS=1/0,XS=qn&&1/Yo(new qn([,-0]))[1]==qS?function(e){return new qn(e)}:ht,JS=200;function QS(e,t,n){var r=-1,s=dl,i=e.length,o=!0,a=[],c=a;if(n)o=!1,s=ou;else if(i>=JS){var l=t?null:XS(e);if(l)return Yo(l);o=!1,s=Vo,c=new Jn}else c=t?[]:a;t:for(;++r<i;){var u=e[r],h=t?t(u):u;if(u=n||u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;t&&c.push(h),a.push(u)}else s(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function Jo(e){return e&&e.length?QS(e):[]}function Qo(e){console&&console.error&&console.error(`Error: ${e}`)}function hu(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function fu(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function du(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function ZS(e){return tA(e)?e.LABEL:e.name}function tA(e){return Mt(e.LABEL)&&e.LABEL!==""}class Se{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),k(this.definition,n=>{n.accept(t)})}}class Kt extends Se{constructor(t){super([]),this.idx=1,Bt(this,le(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class tr extends Se{constructor(t){super(t.definition),this.orgText="",Bt(this,le(t,n=>n!==void 0))}}class xt extends Se{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Bt(this,le(t,n=>n!==void 0))}}class Ut extends Se{constructor(t){super(t.definition),this.idx=1,Bt(this,le(t,n=>n!==void 0))}}class Ae extends Se{constructor(t){super(t.definition),this.idx=1,Bt(this,le(t,n=>n!==void 0))}}class we extends Se{constructor(t){super(t.definition),this.idx=1,Bt(this,le(t,n=>n!==void 0))}}class dt extends Se{constructor(t){super(t.definition),this.idx=1,Bt(this,le(t,n=>n!==void 0))}}class ue extends Se{constructor(t){super(t.definition),this.idx=1,Bt(this,le(t,n=>n!==void 0))}}class he extends Se{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Bt(this,le(t,n=>n!==void 0))}}class Z{constructor(t){this.idx=1,Bt(this,le(t,n=>n!==void 0))}accept(t){t.visit(this)}}function eA(e){return L(e,Vs)}function Vs(e){function t(n){return L(n,Vs)}if(e instanceof Kt){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Mt(e.label)&&(n.label=e.label),n}else{if(e instanceof xt)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Ut)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Ae)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof we)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Vs(new Z({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof ue)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Vs(new Z({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof dt)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof he)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Z){const n={type:"Terminal",name:e.terminalType.name,label:ZS(e.terminalType),idx:e.idx};Mt(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ke(r)?r.source:r),n}else{if(e instanceof tr)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class er{visit(t){const n=t;switch(n.constructor){case Kt:return this.visitNonTerminal(n);case xt:return this.visitAlternative(n);case Ut:return this.visitOption(n);case Ae:return this.visitRepetitionMandatory(n);case we:return this.visitRepetitionMandatoryWithSeparator(n);case ue:return this.visitRepetitionWithSeparator(n);case dt:return this.visitRepetition(n);case he:return this.visitAlternation(n);case Z:return this.visitTerminal(n);case tr:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function nA(e){return e instanceof xt||e instanceof Ut||e instanceof dt||e instanceof Ae||e instanceof we||e instanceof ue||e instanceof Z||e instanceof tr}function Ys(e,t=[]){return e instanceof Ut||e instanceof dt||e instanceof ue?!0:e instanceof he?uu(e.definition,r=>Ys(r,t)):e instanceof Kt&&Lt(t,e)?!1:e instanceof Se?(e instanceof Kt&&t.push(e),ae(e.definition,r=>Ys(r,t))):!1}function rA(e){return e instanceof he}function ve(e){if(e instanceof Kt)return"SUBRULE";if(e instanceof Ut)return"OPTION";if(e instanceof he)return"OR";if(e instanceof Ae)return"AT_LEAST_ONE";if(e instanceof we)return"AT_LEAST_ONE_SEP";if(e instanceof ue)return"MANY_SEP";if(e instanceof dt)return"MANY";if(e instanceof Z)return"CONSUME";throw Error("non exhaustive match")}class zs{walk(t,n=[]){k(t.definition,(r,s)=>{const i=At(t.definition,s+1);if(r instanceof Kt)this.walkProdRef(r,i,n);else if(r instanceof Z)this.walkTerminal(r,i,n);else if(r instanceof xt)this.walkFlat(r,i,n);else if(r instanceof Ut)this.walkOption(r,i,n);else if(r instanceof Ae)this.walkAtLeastOne(r,i,n);else if(r instanceof we)this.walkAtLeastOneSep(r,i,n);else if(r instanceof ue)this.walkManySep(r,i,n);else if(r instanceof dt)this.walkMany(r,i,n);else if(r instanceof he)this.walkOr(r,i,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const s=n.concat(r);this.walk(t,s)}walkOption(t,n,r){const s=n.concat(r);this.walk(t,s)}walkAtLeastOne(t,n,r){const s=[new Ut({definition:t.definition})].concat(n,r);this.walk(t,s)}walkAtLeastOneSep(t,n,r){const s=pu(t,n,r);this.walk(t,s)}walkMany(t,n,r){const s=[new Ut({definition:t.definition})].concat(n,r);this.walk(t,s)}walkManySep(t,n,r){const s=pu(t,n,r);this.walk(t,s)}walkOr(t,n,r){const s=n.concat(r);k(t.definition,i=>{const o=new xt({definition:[i]});this.walk(o,s)})}}function pu(e,t,n){return[new Ut({definition:[new Z({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function Gr(e){if(e instanceof Kt)return Gr(e.referencedRule);if(e instanceof Z)return oA(e);if(nA(e))return sA(e);if(rA(e))return iA(e);throw Error("non exhaustive match")}function sA(e){let t=[];const n=e.definition;let r=0,s=n.length>r,i,o=!0;for(;s&&o;)i=n[r],o=Ys(i),t=t.concat(Gr(i)),r=r+1,s=n.length>r;return Jo(t)}function iA(e){const t=L(e.definition,n=>Gr(n));return Jo(oe(t))}function oA(e){return[e.terminalType]}const gu="_~IN~_";class aA extends zs{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const s=lA(t.referencedRule,t.idx)+this.topProd.name,i=n.concat(r),o=new xt({definition:i}),a=Gr(o);this.follows[s]=a}}function cA(e){const t={};return k(e,n=>{const r=new aA(n).startWalking();Bt(t,r)}),t}function lA(e,t){return e.name+t+gu}function M(e){return e.charCodeAt(0)}function Zo(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function Kr(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function nr(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function uA(){throw Error("Internal Error - Should never get here!")}function mu(e){return e.type==="Character"}const qs=[];for(let e=M("0");e<=M("9");e++)qs.push(e);const Xs=[M("_")].concat(qs);for(let e=M("a");e<=M("z");e++)Xs.push(e);for(let e=M("A");e<=M("Z");e++)Xs.push(e);const Eu=[M(" "),M("\f"),M(`
`),M("\r"),M("	"),M("\v"),M("	"),M(""),M(""),M(""),M(""),M(""),M(""),M(""),M(""),M(""),M(""),M(""),M(""),M(""),M("\u2028"),M("\u2029"),M(""),M(""),M(""),M("\uFEFF")],hA=/[0-9a-fA-F]/,Js=/[0-9]/,fA=/[1-9]/;class dA{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Kr(r,"global");break;case"i":Kr(r,"ignoreCase");break;case"m":Kr(r,"multiLine");break;case"u":Kr(r,"unicode");break;case"y":Kr(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}nr(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return uA()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const s=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:s,atMost:s};break;case",":let i;this.isDigit()?(i=this.integerIncludingZero(),n={atLeast:s,atMost:i}):n={atLeast:s,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;nr(n);break}if(!(t===!0&&n===void 0)&&nr(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),nr(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[M(`
`),M("\r"),M("\u2028"),M("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=qs;break;case"D":t=qs,n=!0;break;case"s":t=Eu;break;case"S":t=Eu,n=!0;break;case"w":t=Xs;break;case"W":t=Xs,n=!0;break}if(nr(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=M("\f");break;case"n":t=M(`
`);break;case"r":t=M("\r");break;case"t":t=M("	");break;case"v":t=M("\v");break}if(nr(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:M("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:M(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:M(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,mu(r)&&this.isRangeDash()){this.consumeChar("-");const s=this.classAtom();if(s.type,mu(s)){if(s.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:s.value})}else Zo(r.value,t),t.push(M("-")),Zo(s.value,t)}else Zo(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:M("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(fA.test(t)===!1)throw Error("Expecting a positive integer");for(;Js.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Js.test(t)===!1)throw Error("Expecting an integer");for(;Js.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:M(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Js.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let s=0;s<t;s++){const i=this.popChar();if(hA.test(i)===!1)throw Error("Expecting a HexDecimal digits");n+=i}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class ta{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(s=>{this.visit(s)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Qs={};const pA=new dA;function Zs(e){const t=e.toString();if(Qs.hasOwnProperty(t))return Qs[t];{const n=pA.pattern(t);return Qs[t]=n,n}}function gA(){Qs={}}const _u="Complement Sets are not supported for first char optimization",ti=`Unable to use "first char" lexer optimizations:
`;function mA(e,t=!1){try{const n=Zs(e);return ea(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===_u)t&&hu(`${ti}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Qo(`${ti}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function ea(e,t,n){switch(e.type){case"Disjunction":for(let s=0;s<e.value.length;s++)ea(e.value[s],t,n);break;case"Alternative":const r=e.value;for(let s=0;s<r.length;s++){const i=r[s];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=i;switch(o.type){case"Character":ei(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(_u);k(o.value,c=>{if(typeof c=="number")ei(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)ei(u,t,n);else{for(let u=l.from;u<=l.to&&u<jr;u++)ei(u,t,n);if(l.to>=jr){const u=l.from>=jr?l.from:jr,h=l.to,d=sn(u),f=sn(h);for(let p=d;p<=f;p++)t[p]=p}}}});break;case"Group":ea(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&na(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return ft(t)}function ei(e,t,n){const r=sn(e);t[r]=r,n===!0&&EA(e,t)}function EA(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const s=sn(r.charCodeAt(0));t[s]=s}else{const s=n.toLowerCase();if(s!==n){const i=sn(s.charCodeAt(0));t[i]=i}}}function yu(e,t){return Zn(e.value,n=>{if(typeof n=="number")return Lt(t,n);{const r=n;return Zn(t,s=>r.from<=s&&s<=r.to)!==void 0}})}function na(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?K(e.value)?ae(e.value,na):na(e.value):!1}class _A extends ta{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Lt(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?yu(t,this.targetCharCodes)===void 0&&(this.found=!0):yu(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function ra(e,t){if(t instanceof RegExp){const n=Zs(t),r=new _A(e);return r.visit(n),r.found}else return Zn(t,n=>Lt(e,n.charCodeAt(0)))!==void 0}const Cn="PATTERN",Wr="defaultMode",ni="modes";let Tu=typeof new RegExp("(?:)").sticky=="boolean";function yA(e,t){t=Xo(t,{useSticky:Tu,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,y)=>y()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{KA()});let r;n("Reject Lexer.NA",()=>{r=Hs(e,v=>v[Cn]===mt.NA)});let s=!1,i;n("Transform Patterns",()=>{s=!1,i=L(r,v=>{const y=v[Cn];if(Ke(y)){const N=y.source;return N.length===1&&N!=="^"&&N!=="$"&&N!=="."&&!y.ignoreCase?N:N.length===2&&N[0]==="\\"&&!Lt(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],N[1])?N[1]:t.useSticky?Au(y):Su(y)}else{if($e(y))return s=!0,{exec:y};if(typeof y=="object")return s=!0,y;if(typeof y=="string"){if(y.length===1)return y;{const N=y.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),T=new RegExp(N);return t.useSticky?Au(T):Su(T)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=L(r,v=>v.tokenTypeIdx),a=L(r,v=>{const y=v.GROUP;if(y!==mt.SKIPPED){if(Mt(y))return y;if(We(y))return!1;throw Error("non exhaustive match")}}),c=L(r,v=>{const y=v.LONGER_ALT;if(y)return K(y)?L(y,T=>cu(r,T)):[cu(r,y)]}),l=L(r,v=>v.PUSH_MODE),u=L(r,v=>b(v,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const v=Ru(t.lineTerminatorCharacters);h=L(r,y=>!1),t.positionTracking!=="onlyOffset"&&(h=L(r,y=>b(y,"LINE_BREAKS")?!!y.LINE_BREAKS:vu(y,v)===!1&&ra(v,y.PATTERN)))});let d,f,p,E;n("Misc Mapping #2",()=>{d=L(r,wu),f=L(i,$A),p=Gt(r,(v,y)=>{const N=y.GROUP;return Mt(N)&&N!==mt.SKIPPED&&(v[N]=[]),v},{}),E=L(i,(v,y)=>({pattern:i[y],longerAlt:c[y],canLineTerminator:h[y],isCustom:d[y],short:f[y],group:a[y],push:l[y],pop:u[y],tokenTypeIdx:o[y],tokenType:r[y]}))});let w=!0,A=[];return t.safeMode||n("First Char Optimization",()=>{A=Gt(r,(v,y,N)=>{if(typeof y.PATTERN=="string"){const T=y.PATTERN.charCodeAt(0),m=sn(T);sa(v,m,E[N])}else if(K(y.START_CHARS_HINT)){let T;k(y.START_CHARS_HINT,m=>{const g=typeof m=="string"?m.charCodeAt(0):m,S=sn(g);T!==S&&(T=S,sa(v,S,E[N]))})}else if(Ke(y.PATTERN))if(y.PATTERN.unicode)w=!1,t.ensureOptimizations&&Qo(`${ti}	Unable to analyze < ${y.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const T=mA(y.PATTERN,t.ensureOptimizations);q(T)&&(w=!1),k(T,m=>{sa(v,m,E[N])})}else t.ensureOptimizations&&Qo(`${ti}	TokenType: <${y.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return v},[])}),{emptyGroups:p,patternIdxToConfig:E,charCodeToPatternIdxToConfig:A,hasCustom:s,canBeOptimized:w}}function TA(e,t){let n=[];const r=AA(e);n=n.concat(r.errors);const s=wA(r.valid),i=s.valid;return n=n.concat(s.errors),n=n.concat(SA(i)),n=n.concat(bA(i)),n=n.concat(kA(i,t)),n=n.concat(MA(i)),n}function SA(e){let t=[];const n=Xt(e,r=>Ke(r[Cn]));return t=t.concat(RA(n)),t=t.concat(IA(n)),t=t.concat(LA(n)),t=t.concat(OA(n)),t=t.concat(NA(n)),t}function AA(e){const t=Xt(e,s=>!b(s,Cn)),n=L(t,s=>({message:"Token Type: ->"+s.name+"<- missing static 'PATTERN' property",type:nt.MISSING_PATTERN,tokenTypes:[s]})),r=js(e,t);return{errors:n,valid:r}}function wA(e){const t=Xt(e,s=>{const i=s[Cn];return!Ke(i)&&!$e(i)&&!b(i,"exec")&&!Mt(i)}),n=L(t,s=>({message:"Token Type: ->"+s.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:nt.INVALID_PATTERN,tokenTypes:[s]})),r=js(e,t);return{errors:n,valid:r}}const vA=/[^\\][$]/;function RA(e){class t extends ta{constructor(){super(...arguments),this.found=!1}visitEndAnchor(i){this.found=!0}}const n=Xt(e,s=>{const i=s.PATTERN;try{const o=Zs(i),a=new t;return a.visit(o),a.found}catch{return vA.test(i.source)}});return L(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:nt.EOI_ANCHOR_FOUND,tokenTypes:[s]}))}function NA(e){const t=Xt(e,r=>r.PATTERN.test(""));return L(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:nt.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const CA=/[^\\[][\^]|^\^/;function IA(e){class t extends ta{constructor(){super(...arguments),this.found=!1}visitStartAnchor(i){this.found=!0}}const n=Xt(e,s=>{const i=s.PATTERN;try{const o=Zs(i),a=new t;return a.visit(o),a.found}catch{return CA.test(i.source)}});return L(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:nt.SOI_ANCHOR_FOUND,tokenTypes:[s]}))}function LA(e){const t=Xt(e,r=>{const s=r[Cn];return s instanceof RegExp&&(s.multiline||s.global)});return L(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:nt.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function OA(e){const t=[];let n=L(e,i=>Gt(e,(o,a)=>(i.PATTERN.source===a.PATTERN.source&&!Lt(t,a)&&a.PATTERN!==mt.NA&&(t.push(a),o.push(a)),o),[]));n=$r(n);const r=Xt(n,i=>i.length>1);return L(r,i=>{const o=L(i,c=>c.name);return{message:`The same RegExp pattern ->${ce(i).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:nt.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}})}function bA(e){const t=Xt(e,r=>{if(!b(r,"GROUP"))return!1;const s=r.GROUP;return s!==mt.SKIPPED&&s!==mt.NA&&!Mt(s)});return L(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:nt.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function kA(e,t){const n=Xt(e,s=>s.PUSH_MODE!==void 0&&!Lt(t,s.PUSH_MODE));return L(n,s=>({message:`Token Type: ->${s.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${s.PUSH_MODE}<-which does not exist`,type:nt.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[s]}))}function MA(e){const t=[],n=Gt(e,(r,s,i)=>{const o=s.PATTERN;return o===mt.NA||(Mt(o)?r.push({str:o,idx:i,tokenType:s}):Ke(o)&&UA(o)&&r.push({str:o.source,idx:i,tokenType:s})),r},[]);return k(e,(r,s)=>{k(n,({str:i,idx:o,tokenType:a})=>{if(s<o&&xA(i,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:nt.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function xA(e,t){if(Ke(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if($e(t))return t(e,0,[],{});if(b(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function UA(e){return Zn([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Su(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Au(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function PA(e,t,n){const r=[];return b(e,Wr)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Wr+`> property in its definition
`,type:nt.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),b(e,ni)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ni+`> property in its definition
`,type:nt.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),b(e,ni)&&b(e,Wr)&&!b(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Wr}: <${e.defaultMode}>which does not exist
`,type:nt.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),b(e,ni)&&k(e.modes,(s,i)=>{k(s,(o,a)=>{if(We(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${i}> at index: <${a}>
`,type:nt.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(b(o,"LONGER_ALT")){const c=K(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];k(c,l=>{!We(l)&&!Lt(s,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${i}>
`,type:nt.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function DA(e,t,n){const r=[];let s=!1;const i=$r(oe(ft(e.modes))),o=Hs(i,c=>c[Cn]===mt.NA),a=Ru(n);return t&&k(o,c=>{const l=vu(c,a);if(l!==!1){const h={message:GA(c,l),type:l.issue,tokenType:c};r.push(h)}else b(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(s=!0):ra(a,c.PATTERN)&&(s=!0)}),t&&!s&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:nt.NO_LINE_BREAKS_FLAGS}),r}function FA(e){const t={},n=$t(e);return k(n,r=>{const s=e[r];if(K(s))t[r]=[];else throw Error("non exhaustive match")}),t}function wu(e){const t=e.PATTERN;if(Ke(t))return!1;if($e(t))return!0;if(b(t,"exec"))return!0;if(Mt(t))return!1;throw Error("non exhaustive match")}function $A(e){return Mt(e)&&e.length===1?e.charCodeAt(0):!1}const BA={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function vu(e,t){if(b(e,"LINE_BREAKS"))return!1;if(Ke(e.PATTERN)){try{ra(t,e.PATTERN)}catch(n){return{issue:nt.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Mt(e.PATTERN))return!1;if(wu(e))return{issue:nt.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function GA(e,t){if(t.issue===nt.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===nt.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Ru(e){return L(e,n=>Mt(n)?n.charCodeAt(0):n)}function sa(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const jr=256;let ri=[];function sn(e){return e<jr?e:ri[e]}function KA(){if(q(ri)){ri=new Array(65536);for(let e=0;e<65536;e++)ri[e]=e>255?255+~~(e/255):e}}function Hr(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function si(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let Nu=1;const Cu={};function Vr(e){const t=WA(e);jA(t),VA(t),HA(t),k(t,n=>{n.isParent=n.categoryMatches.length>0})}function WA(e){let t=St(e),n=e,r=!0;for(;r;){n=$r(oe(L(n,i=>i.CATEGORIES)));const s=js(n,t);t=t.concat(s),q(s)?r=!1:n=s}return t}function jA(e){k(e,t=>{Lu(t)||(Cu[Nu]=t,t.tokenTypeIdx=Nu++),Ou(t)&&!K(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),Ou(t)||(t.CATEGORIES=[]),YA(t)||(t.categoryMatches=[]),zA(t)||(t.categoryMatchesMap={})})}function HA(e){k(e,t=>{t.categoryMatches=[],k(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(Cu[r].tokenTypeIdx)})})}function VA(e){k(e,t=>{Iu([],t)})}function Iu(e,t){k(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),k(t.CATEGORIES,n=>{const r=e.concat(t);Lt(r,n)||Iu(r,n)})}function Lu(e){return b(e,"tokenTypeIdx")}function Ou(e){return b(e,"CATEGORIES")}function YA(e){return b(e,"categoryMatches")}function zA(e){return b(e,"categoryMatchesMap")}function qA(e){return b(e,"tokenTypeIdx")}const XA={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,s){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var nt;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(nt||(nt={}));const Yr={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:XA,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Yr);class mt{constructor(t,n=Yr){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(s,i)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${s}>`);const{time:a,value:c}=fu(i),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${s}> time: ${a}ms`),this.traceInitIndent--,c}else return i()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Bt({},Yr,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let s,i=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Yr.lineTerminatorsPattern)this.config.lineTerminatorsPattern=BA;else if(this.config.lineTerminatorCharacters===Yr.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),K(t)?s={modes:{defaultMode:St(t)},defaultMode:Wr}:(i=!1,s=St(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(PA(s,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(DA(s,this.trackStartLines,this.config.lineTerminatorCharacters))})),s.modes=s.modes?s.modes:{},k(s.modes,(a,c)=>{s.modes[c]=Hs(a,l=>We(l))});const o=$t(s.modes);if(k(s.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(TA(a,o))}),q(this.lexerDefinitionErrors)){Vr(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=yA(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Bt({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=s.defaultMode,!q(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=L(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}k(this.lexerDefinitionWarning,a=>{hu(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Tu?(this.chopInput=zn,this.match=this.matchWithTest):(this.updateLastIndex=ht,this.match=this.matchWithExec),i&&(this.handleModes=ht),this.trackStartLines===!1&&(this.computeNewColumn=zn),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=ht),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Gt(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!q(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{gA()}),this.TRACE_INIT("toFastProperties",()=>{du(this)})})}tokenize(t,n=this.defaultMode){if(!q(this.lexerDefinitionErrors)){const s=L(this.lexerDefinitionErrors,i=>i.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+s)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,s,i,o,a,c,l,u,h,d,f,p,E,w,A;const v=t,y=v.length;let N=0,T=0;const m=this.hasCustom?0:Math.floor(t.length/10),g=new Array(m),S=[];let R=this.trackStartLines?1:void 0,j=this.trackStartLines?1:void 0;const yt=FA(this.emptyGroups),wr=this.trackStartLines,Tt=this.config.lineTerminatorsPattern;let xe=0,re=[],vs=[];const so=[],Zp=[];Object.freeze(Zp);let Rs;function tg(){return re}function eg(Ct){const se=sn(Ct),vr=vs[se];return vr===void 0?Zp:vr}const oL=Ct=>{if(so.length===1&&Ct.tokenType.PUSH_MODE===void 0){const se=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ct);S.push({offset:Ct.startOffset,line:Ct.startLine,column:Ct.startColumn,length:Ct.image.length,message:se})}else{so.pop();const se=Qn(so);re=this.patternIdxToConfig[se],vs=this.charCodeToPatternIdxToConfig[se],xe=re.length;const vr=this.canModeBeOptimized[se]&&this.config.safeMode===!1;vs&&vr?Rs=eg:Rs=tg}};function ng(Ct){so.push(Ct),vs=this.charCodeToPatternIdxToConfig[Ct],re=this.patternIdxToConfig[Ct],xe=re.length,xe=re.length;const se=this.canModeBeOptimized[Ct]&&this.config.safeMode===!1;vs&&se?Rs=eg:Rs=tg}ng.call(this,n);let me;const rg=this.config.recoveryEnabled;for(;N<y;){c=null;const Ct=v.charCodeAt(N),se=Rs(Ct),vr=se.length;for(r=0;r<vr;r++){me=se[r];const Vt=me.pattern;l=null;const tn=me.short;if(tn!==!1?Ct===tn&&(c=Vt):me.isCustom===!0?(A=Vt.exec(v,N,g,yt),A!==null?(c=A[0],A.payload!==void 0&&(l=A.payload)):c=null):(this.updateLastIndex(Vt,N),c=this.match(Vt,t,N)),c!==null){if(a=me.longerAlt,a!==void 0){const _n=a.length;for(i=0;i<_n;i++){const en=re[a[i]],jn=en.pattern;if(u=null,en.isCustom===!0?(A=jn.exec(v,N,g,yt),A!==null?(o=A[0],A.payload!==void 0&&(u=A.payload)):o=null):(this.updateLastIndex(jn,N),o=this.match(jn,t,N)),o&&o.length>c.length){c=o,l=u,me=en;break}}}break}}if(c!==null){if(h=c.length,d=me.group,d!==void 0&&(f=me.tokenTypeIdx,p=this.createTokenInstance(c,N,f,me.tokenType,R,j,h),this.handlePayload(p,l),d===!1?T=this.addToken(g,T,p):yt[d].push(p)),t=this.chopInput(t,h),N=N+h,j=this.computeNewColumn(j,h),wr===!0&&me.canLineTerminator===!0){let Vt=0,tn,_n;Tt.lastIndex=0;do tn=Tt.test(c),tn===!0&&(_n=Tt.lastIndex-1,Vt++);while(tn===!0);Vt!==0&&(R=R+Vt,j=h-_n,this.updateTokenEndLineColumnLocation(p,d,_n,Vt,R,j,h))}this.handleModes(me,oL,ng,p)}else{const Vt=N,tn=R,_n=j;let en=rg===!1;for(;en===!1&&N<y;)for(t=this.chopInput(t,1),N++,s=0;s<xe;s++){const jn=re[s],Fc=jn.pattern,sg=jn.short;if(sg!==!1?v.charCodeAt(N)===sg&&(en=!0):jn.isCustom===!0?en=Fc.exec(v,N,g,yt)!==null:(this.updateLastIndex(Fc,N),en=Fc.exec(t)!==null),en===!0)break}if(E=N-Vt,j=this.computeNewColumn(j,E),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Vt,E,tn,_n),S.push({offset:Vt,line:tn,column:_n,length:E,message:w}),rg===!1)break}}return this.hasCustom||(g.length=T),{tokens:g,groups:yt,errors:S}}handleModes(t,n,r,s){if(t.pop===!0){const i=t.push;n(s),i!==void 0&&r.call(this,i)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,s,i,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,s===1&&c===!0||(t.endLine=i+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,s){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:s}}createStartOnlyToken(t,n,r,s,i,o){return{image:t,startOffset:n,startLine:i,startColumn:o,tokenTypeIdx:r,tokenType:s}}createFullToken(t,n,r,s,i,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:s}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}}mt.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",mt.NA=/NOT_APPLICABLE/;function zr(e){return bu(e)?e.LABEL:e.name}function bu(e){return Mt(e.LABEL)&&e.LABEL!==""}const JA="parent",ku="categories",Mu="label",xu="group",Uu="push_mode",Pu="pop_mode",Du="longer_alt",Fu="line_breaks",$u="start_chars_hint";function x(e){return QA(e)}function QA(e){const t=e.pattern,n={};if(n.name=e.name,We(t)||(n.PATTERN=t),b(e,JA))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return b(e,ku)&&(n.CATEGORIES=e[ku]),Vr([n]),b(e,Mu)&&(n.LABEL=e[Mu]),b(e,xu)&&(n.GROUP=e[xu]),b(e,Pu)&&(n.POP_MODE=e[Pu]),b(e,Uu)&&(n.PUSH_MODE=e[Uu]),b(e,Du)&&(n.LONGER_ALT=e[Du]),b(e,Fu)&&(n.LINE_BREAKS=e[Fu]),b(e,$u)&&(n.START_CHARS_HINT=e[$u]),n}const In=x({name:"EOF",pattern:mt.NA});Vr([In]);function ii(e,t,n,r,s,i,o,a){return{image:t,startOffset:n,endOffset:r,startLine:s,endLine:i,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function ZA(e,t){return Hr(e,t)}const Bu={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${bu(e)?`--> ${zr(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:s}){const i="Expecting: ",a=`
but found: '`+ce(t).image+"'";if(r)return i+r+a;{const c=Gt(e,(d,f)=>d.concat(f),[]),l=L(c,d=>`[${L(d,f=>zr(f)).join(", ")}]`),h=`one of these possible Token sequences:
${L(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return i+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const s="Expecting: ",o=`
but found: '`+ce(t).image+"'";if(n)return s+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${L(e,l=>`[${L(l,u=>zr(u)).join(",")}]`).join(" ,")}>`;return s+c+o}}};Object.freeze(Bu);const tw={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},Ln={buildDuplicateFoundError(e,t){function n(u){return u instanceof Z?u.terminalType.name:u instanceof Kt?u.nonTerminalName:""}const r=e.name,s=ce(t),i=s.idx,o=ve(s),a=n(s),c=i>0;let l=`->${o}${c?i:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=L(e.prefixPath,s=>zr(s)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=L(e.prefixPath,s=>zr(s)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=ve(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=L(e.leftRecursionPath,i=>i.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof tr?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function ew(e,t){const n=new nw(e,t);return n.resolveRefs(),n.errors}class nw extends er{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){k(ft(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:Ot.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class rw extends zs{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=St(this.path.ruleStack).reverse(),this.occurrenceStack=St(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const s=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,s)}}updateExpectedNext(){q(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class sw extends rw{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const s=n.concat(r),i=new xt({definition:s});this.possibleTokTypes=Gr(i),this.found=!0}}}class oi extends zs{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class iw extends oi{walkMany(t,n,r){if(t.idx===this.occurrence){const s=ce(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Z&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkMany(t,n,r)}}class Gu extends oi{walkManySep(t,n,r){if(t.idx===this.occurrence){const s=ce(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Z&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkManySep(t,n,r)}}class ow extends oi{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const s=ce(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Z&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOne(t,n,r)}}class Ku extends oi{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const s=ce(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Z&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOneSep(t,n,r)}}function ia(e,t,n=[]){n=St(n);let r=[],s=0;function i(a){return a.concat(At(e,s+1))}function o(a){const c=ia(i(a),t,n);return r.concat(c)}for(;n.length<t&&s<e.length;){const a=e[s];if(a instanceof xt)return o(a.definition);if(a instanceof Kt)return o(a.definition);if(a instanceof Ut)r=o(a.definition);else if(a instanceof Ae){const c=a.definition.concat([new dt({definition:a.definition})]);return o(c)}else if(a instanceof we){const c=[new xt({definition:a.definition}),new dt({definition:[new Z({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof ue){const c=a.definition.concat([new dt({definition:[new Z({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof dt){const c=a.definition.concat([new dt({definition:a.definition})]);r=o(c)}else{if(a instanceof he)return k(a.definition,c=>{q(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Z)n.push(a.terminalType);else throw Error("non exhaustive match")}s++}return r.push({partialPath:n,suffixDef:At(e,s)}),r}function Wu(e,t,n,r){const s="EXIT_NONE_TERMINAL",i=[s],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!q(h);){const d=h.pop();if(d===o){a&&Qn(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,E=d.ruleStack,w=d.occurrenceStack;if(q(f))continue;const A=f[0];if(A===s){const v={idx:p,def:At(f),ruleStack:Br(E),occurrenceStack:Br(w)};h.push(v)}else if(A instanceof Z)if(p<c-1){const v=p+1,y=t[v];if(n(y,A.terminalType)){const N={idx:v,def:At(f),ruleStack:E,occurrenceStack:w};h.push(N)}}else if(p===c-1)u.push({nextTokenType:A.terminalType,nextTokenOccurrence:A.idx,ruleStack:E,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(A instanceof Kt){const v=St(E);v.push(A.nonTerminalName);const y=St(w);y.push(A.idx);const N={idx:p,def:A.definition.concat(i,At(f)),ruleStack:v,occurrenceStack:y};h.push(N)}else if(A instanceof Ut){const v={idx:p,def:At(f),ruleStack:E,occurrenceStack:w};h.push(v),h.push(o);const y={idx:p,def:A.definition.concat(At(f)),ruleStack:E,occurrenceStack:w};h.push(y)}else if(A instanceof Ae){const v=new dt({definition:A.definition,idx:A.idx}),y=A.definition.concat([v],At(f)),N={idx:p,def:y,ruleStack:E,occurrenceStack:w};h.push(N)}else if(A instanceof we){const v=new Z({terminalType:A.separator}),y=new dt({definition:[v].concat(A.definition),idx:A.idx}),N=A.definition.concat([y],At(f)),T={idx:p,def:N,ruleStack:E,occurrenceStack:w};h.push(T)}else if(A instanceof ue){const v={idx:p,def:At(f),ruleStack:E,occurrenceStack:w};h.push(v),h.push(o);const y=new Z({terminalType:A.separator}),N=new dt({definition:[y].concat(A.definition),idx:A.idx}),T=A.definition.concat([N],At(f)),m={idx:p,def:T,ruleStack:E,occurrenceStack:w};h.push(m)}else if(A instanceof dt){const v={idx:p,def:At(f),ruleStack:E,occurrenceStack:w};h.push(v),h.push(o);const y=new dt({definition:A.definition,idx:A.idx}),N=A.definition.concat([y],At(f)),T={idx:p,def:N,ruleStack:E,occurrenceStack:w};h.push(T)}else if(A instanceof he)for(let v=A.definition.length-1;v>=0;v--){const y=A.definition[v],N={idx:p,def:y.definition.concat(At(f)),ruleStack:E,occurrenceStack:w};h.push(N),h.push(o)}else if(A instanceof xt)h.push({idx:p,def:A.definition.concat(At(f)),ruleStack:E,occurrenceStack:w});else if(A instanceof tr)h.push(aw(A,p,E,w));else throw Error("non exhaustive match")}return u}function aw(e,t,n,r){const s=St(n);s.push(e.name);const i=St(r);return i.push(1),{idx:t,def:e.definition,ruleStack:s,occurrenceStack:i}}var rt;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(rt||(rt={}));function ju(e){if(e instanceof Ut||e==="Option")return rt.OPTION;if(e instanceof dt||e==="Repetition")return rt.REPETITION;if(e instanceof Ae||e==="RepetitionMandatory")return rt.REPETITION_MANDATORY;if(e instanceof we||e==="RepetitionMandatoryWithSeparator")return rt.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof ue||e==="RepetitionWithSeparator")return rt.REPETITION_WITH_SEPARATOR;if(e instanceof he||e==="Alternation")return rt.ALTERNATION;throw Error("non exhaustive match")}function cw(e,t,n,r,s,i){const o=aa(e,t,n),a=zu(o)?si:Hr;return i(o,r,a,s)}function lw(e,t,n,r,s,i){const o=ca(e,t,s,n),a=zu(o)?si:Hr;return i(o[0],a,r)}function uw(e,t,n,r){const s=e.length,i=ae(e,o=>ae(o,a=>a.length===1));if(t)return function(o){const a=L(o,c=>c.GATE);for(let c=0;c<s;c++){const l=e[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let E=0;E<p;E++){const w=this.LA(E+1);if(n(w,f[E])===!1)continue t}return c}}};if(i&&!r){const o=L(e,c=>oe(c)),a=Gt(o,(c,l,u)=>(k(l,h=>{b(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),k(h.categoryMatches,d=>{b(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<s;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue t}return o}}}}function hw(e,t,n){const r=ae(e,i=>i.length===1),s=e.length;if(r&&!n){const i=oe(e);if(i.length===1&&q(i[0].categoryMatches)){const a=i[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Gt(i,(a,c,l)=>(a[c.tokenTypeIdx]=!0,k(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let i=0;i<s;i++){const o=e[i],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class fw extends zs{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,s){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(s),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,rt.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,rt.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,rt.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,rt.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,rt.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Hu extends er{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,rt.OPTION)}visitRepetition(t){this.checkIsTarget(t,rt.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,rt.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,rt.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,rt.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,rt.ALTERNATION)}}function Vu(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function oa(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],s=[];for(let i=0;i<t.length;i++){const o=t[i];s.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];s.push(o+c)}}t=s}return t}function dw(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const s=e[r];for(let i=0;i<t.length;i++){const o=t[i];if(s[o]===!0)return!1}}return!0}function Yu(e,t){const n=L(e,o=>ia([o],1)),r=Vu(n.length),s=L(n,o=>{const a={};return k(o,c=>{const l=oa(c.partialPath);k(l,u=>{a[u]=!0})}),a});let i=n;for(let o=1;o<=t;o++){const a=i;i=Vu(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=oa(h);if(dw(s,f,c)||q(d)||h.length===t){const E=r[c];if(la(E,h)===!1){E.push(h);for(let w=0;w<f.length;w++){const A=f[w];s[c][A]=!0}}}else{const E=ia(d,o+1,h);i[c]=i[c].concat(E),k(E,w=>{const A=oa(w.partialPath);k(A,v=>{s[c][v]=!0})})}}}}return r}function aa(e,t,n,r){const s=new Hu(e,rt.ALTERNATION,r);return t.accept(s),Yu(s.result,n)}function ca(e,t,n,r){const s=new Hu(e,n);t.accept(s);const i=s.result,a=new fw(t,e,n).startWalking(),c=new xt({definition:i}),l=new xt({definition:a});return Yu([c,l],r)}function la(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let s=0;s<r.length;s++){const i=t[s],o=r[s];if((i===o||o.categoryMatchesMap[i.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function pw(e,t){return e.length<t.length&&ae(e,(n,r)=>{const s=t[r];return n===s||s.categoryMatchesMap[n.tokenTypeIdx]})}function zu(e){return ae(e,t=>ae(t,n=>ae(n,r=>q(r.categoryMatches))))}function gw(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return L(t,n=>Object.assign({type:Ot.CUSTOM_LOOKAHEAD_VALIDATION},n))}function mw(e,t,n,r){const s=Jt(e,c=>Ew(c,n)),i=Lw(e,t,n),o=Jt(e,c=>Rw(c,n)),a=Jt(e,c=>Tw(c,e,r,n));return s.concat(i,o,a)}function Ew(e,t){const n=new yw;e.accept(n);const r=n.allProductions,s=LS(r,_w),i=le(s,a=>a.length>1);return L(ft(i),a=>{const c=ce(a),l=t.buildDuplicateFoundError(e,a),u=ve(c),h={message:l,type:Ot.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=qu(c);return d&&(h.parameter=d),h})}function _w(e){return`${ve(e)}_#_${e.idx}_#_${qu(e)}`}function qu(e){return e instanceof Z?e.terminalType.name:e instanceof Kt?e.nonTerminalName:""}class yw extends er{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function Tw(e,t,n,r){const s=[];if(Gt(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});s.push({message:o,type:Ot.DUPLICATE_RULE_NAME,ruleName:e.name})}return s}function Sw(e,t,n){const r=[];let s;return Lt(t,e)||(s=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:s,type:Ot.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Xu(e,t,n,r=[]){const s=[],i=ai(t.definition);if(q(i))return[];{const o=e.name;Lt(i,e)&&s.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:Ot.LEFT_RECURSION,ruleName:o});const c=js(i,r.concat([e])),l=Jt(c,u=>{const h=St(r);return h.push(u),Xu(e,u,n,h)});return s.concat(l)}}function ai(e){let t=[];if(q(e))return t;const n=ce(e);if(n instanceof Kt)t.push(n.referencedRule);else if(n instanceof xt||n instanceof Ut||n instanceof Ae||n instanceof we||n instanceof ue||n instanceof dt)t=t.concat(ai(n.definition));else if(n instanceof he)t=oe(L(n.definition,i=>ai(i.definition)));else if(!(n instanceof Z))throw Error("non exhaustive match");const r=Ys(n),s=e.length>1;if(r&&s){const i=At(e);return t.concat(ai(i))}else return t}class ua extends er{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function Aw(e,t){const n=new ua;e.accept(n);const r=n.alternations;return Jt(r,i=>{const o=Br(i.definition);return Jt(o,(a,c)=>{const l=Wu([a],[],Hr,1);return q(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:i,emptyChoiceIdx:c}),type:Ot.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:i.idx,alternative:c+1}]:[]})})}function ww(e,t,n){const r=new ua;e.accept(r);let s=r.alternations;return s=Hs(s,o=>o.ignoreAmbiguities===!0),Jt(s,o=>{const a=o.idx,c=o.maxLookahead||t,l=aa(a,e,c,o),u=Cw(l,o,e,n),h=Iw(l,o,e,n);return u.concat(h)})}class vw extends er{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function Rw(e,t){const n=new ua;e.accept(n);const r=n.alternations;return Jt(r,i=>i.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:i}),type:Ot.TOO_MANY_ALTS,ruleName:e.name,occurrence:i.idx}]:[])}function Nw(e,t,n){const r=[];return k(e,s=>{const i=new vw;s.accept(i);const o=i.allProductions;k(o,a=>{const c=ju(a),l=a.maxLookahead||t,u=a.idx,d=ca(u,s,c,l)[0];if(q(oe(d))){const f=n.buildEmptyRepetitionError({topLevelRule:s,repetition:a});r.push({message:f,type:Ot.NO_NON_EMPTY_LOOKAHEAD,ruleName:s.name})}})}),r}function Cw(e,t,n,r){const s=[],i=Gt(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||k(c,u=>{const h=[l];k(e,(d,f)=>{l!==f&&la(d,u)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!la(s,u)&&(s.push(u),a.push({alts:h,path:u}))}),a),[]);return L(i,a=>{const c=L(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Ot.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function Iw(e,t,n,r){const s=Gt(e,(o,a,c)=>{const l=L(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return $r(Jt(s,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Xt(s,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&pw(d.path,l));return L(u,d=>{const f=[d.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:Ot.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function Lw(e,t,n){const r=[],s=L(t,i=>i.name);return k(e,i=>{const o=i.name;if(Lt(s,o)){const a=n.buildNamespaceConflictError(i);r.push({message:a,type:Ot.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function Ow(e){const t=Xo(e,{errMsgProvider:tw}),n={};return k(e.rules,r=>{n[r.name]=r}),ew(n,t.errMsgProvider)}function bw(e){return e=Xo(e,{errMsgProvider:Ln}),mw(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const Ju="MismatchedTokenException",Qu="NoViableAltException",Zu="EarlyExitException",th="NotAllInputParsedException",eh=[Ju,Qu,Zu,th];Object.freeze(eh);function ci(e){return Lt(eh,e.name)}class li extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class nh extends li{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ju}}class kw extends li{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Qu}}class Mw extends li{constructor(t,n){super(t,n),this.name=th}}class xw extends li{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Zu}}const ha={},rh="InRuleRecoveryException";class Uw extends Error{constructor(t){super(t),this.name=rh}}class Pw{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=b(t,"recoveryEnabled")?t.recoveryEnabled:je.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Dw)}getTokenToInsert(t){const n=ii(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,s){const i=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:s,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new nh(f,l,this.LA(0));p.resyncedTokens=Br(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,s)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(u,i)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new Uw("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||q(n))return!1;const r=this.LA(1);return Zn(n,i=>this.tokenMatcher(r,i))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Lt(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const s=Zn(t,i=>ZA(n,i));if(s!==void 0)return s;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return ha;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return L(t,(r,s)=>s===0?ha:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[s],inRule:this.shortRuleNameToFullName(t[s-1])})}flattenFollowSet(){const t=L(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return oe(t)}getFollowSetFromFollowKey(t){if(t===ha)return[In];const n=t.ruleName+t.idxInCallingRule+gu+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,In)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Br(n)}attemptInRepetitionRecovery(t,n,r,s,i,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),s=St(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:s,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return L(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function Dw(e,t,n,r,s,i,o){const a=this.getKeyForAutomaticLookahead(r,s);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new i(f,s).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=In,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const Fw=4,on=8,sh=1<<on,ih=2<<on,fa=3<<on,da=4<<on,pa=5<<on,ui=6<<on;function ga(e,t,n){return n|t|e}class $w{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:je.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(q(n)){const r=this.validateEmptyOrAlternatives(t.rules),s=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),i=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...s,...i]}return n}validateNoLeftRecursion(t){return Jt(t,n=>Xu(n,n,Ln))}validateEmptyOrAlternatives(t){return Jt(t,n=>Aw(n,Ln))}validateAmbiguousAlternationAlternatives(t,n){return Jt(t,r=>ww(r,n,Ln))}validateSomeNonEmptyLookaheadPath(t,n){return Nw(t,n,Ln)}buildLookaheadForAlternation(t){return cw(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,uw)}buildLookaheadForOptional(t){return lw(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,ju(t.prodType),hw)}}class Bw{initLooksAhead(t){this.dynamicTokensEnabled=b(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:je.dynamicTokensEnabled,this.maxLookahead=b(t,"maxLookahead")?t.maxLookahead:je.maxLookahead,this.lookaheadStrategy=b(t,"lookaheadStrategy")?t.lookaheadStrategy:new $w({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){k(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:s,option:i,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=Kw(n);k(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${ve(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=ga(this.fullRuleNameToShort[n.name],sh,l.idx);this.setLaFuncCache(d,h)})}),k(s,l=>{this.computeLookaheadFunc(n,l.idx,fa,"Repetition",l.maxLookahead,ve(l))}),k(i,l=>{this.computeLookaheadFunc(n,l.idx,ih,"Option",l.maxLookahead,ve(l))}),k(o,l=>{this.computeLookaheadFunc(n,l.idx,da,"RepetitionMandatory",l.maxLookahead,ve(l))}),k(a,l=>{this.computeLookaheadFunc(n,l.idx,ui,"RepetitionMandatoryWithSeparator",l.maxLookahead,ve(l))}),k(c,l=>{this.computeLookaheadFunc(n,l.idx,pa,"RepetitionWithSeparator",l.maxLookahead,ve(l))})})})}computeLookaheadFunc(t,n,r,s,i,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:s}),c=ga(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return ga(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class Gw extends er{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const hi=new Gw;function Kw(e){hi.reset(),e.accept(hi);const t=hi.dslMethods;return hi.reset(),t}function oh(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function ah(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function Ww(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function jw(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const Hw="name";function ch(e,t){Object.defineProperty(e,Hw,{enumerable:!1,configurable:!0,writable:!1,value:t})}function Vw(e,t){const n=$t(e),r=n.length;for(let s=0;s<r;s++){const i=n[s],o=e[i],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function Yw(e,t){const n=function(){};ch(n,e+"BaseSemantics");const r={visit:function(s,i){if(K(s)&&(s=s[0]),!We(s))return this[s.name](s.children,i)},validateVisitor:function(){const s=qw(this,t);if(!q(s)){const i=L(s,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${i.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function zw(e,t,n){const r=function(){};ch(r,e+"BaseSemanticsWithDefaults");const s=Object.create(n.prototype);return k(t,i=>{s[i]=Vw}),r.prototype=s,r.prototype.constructor=r,r}var ma;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(ma||(ma={}));function qw(e,t){return Xw(e,t)}function Xw(e,t){const n=Xt(t,s=>$e(e[s])===!1),r=L(n,s=>({msg:`Missing visitor method: <${s}> on ${e.constructor.name} CST Visitor.`,type:ma.MISSING_METHOD,methodName:s}));return $r(r)}class Jw{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=b(t,"nodeLocationTracking")?t.nodeLocationTracking:je.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=ht,this.cstFinallyStateUpdate=ht,this.cstPostTerminal=ht,this.cstPostNonTerminal=ht,this.cstPostRule=ht;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=ah,this.setNodeLocationFromNode=ah,this.cstPostRule=ht,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=ht,this.setNodeLocationFromNode=ht,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=oh,this.setNodeLocationFromNode=oh,this.cstPostRule=ht,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=ht,this.setNodeLocationFromNode=ht,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=ht,this.setNodeLocationFromNode=ht,this.cstPostRule=ht,this.setInitialNodeLocation=ht;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];Ww(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];jw(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(We(this.baseCstVisitorConstructor)){const t=Yw(this.className,$t(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(We(this.baseCstVisitorWithDefaultsConstructor)){const t=zw(this.className,$t(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class Qw{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):pi}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?pi:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class Zw{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=gi){if(Lt(this.definedRulesNames,t)){const o={message:Ln.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Ot.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const s=this.defineRule(t,n,r);return this[t]=s,s}OVERRIDE_RULE(t,n,r=gi){const s=Sw(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(s);const i=this.defineRule(t,n,r);return this[t]=i,i}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(s){if(ci(s))return!1;throw s}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return eA(ft(this.gastProductionsCache))}}class tv{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=si,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},b(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(K(t)){if(q(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(K(t))this.tokensMap=Gt(t,(i,o)=>(i[o.name]=o,i),{});else if(b(t,"modes")&&ae(oe(ft(t.modes)),qA)){const i=oe(ft(t.modes)),o=Jo(i);this.tokensMap=Gt(o,(a,c)=>(a[c.name]=c,a),{})}else if(qt(t))this.tokensMap=St(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=In;const r=b(t,"modes")?oe(ft(t.modes)):ft(t),s=ae(r,i=>q(i.categoryMatches));this.tokenMatcher=s?si:Hr,Vr(ft(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const s=b(r,"resyncEnabled")?r.resyncEnabled:gi.resyncEnabled,i=b(r,"recoveryValueFunc")?r.recoveryValueFunc:gi.recoveryValueFunc,o=this.ruleShortNameIdx<<Fw+on;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const s=this.RULE_STACK.length===1,i=n&&!this.isBackTracking()&&this.recoveryEnabled;if(ci(t)){const o=t;if(i){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(s)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(ih,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof t!="function"){i=t.DEF;const o=t.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=t;if(s.call(this)===!0)return i.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(da,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const o=n.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=n;if(s.call(this)===!0){let o=this.doSingleRepetition(i);for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i)}else throw this.raiseEarlyExitException(t,rt.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],s,da,t,ow)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(ui,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,a,s,Ku],a,ui,t,Ku)}else throw this.raiseEarlyExitException(t,rt.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(fa,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const a=n.GATE;if(a!==void 0){const c=s;s=()=>a.call(this)&&c.call(this)}}else i=n;let o=!0;for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],s,fa,t,iw,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(pa,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,a,s,Gu],a,pa,t,Gu)}}repetitionSepSecondInternal(t,n,r,s,i){for(;r();)this.CONSUME(n),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,s,i],r,ui,t,i)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(sh,n),s=K(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,s);if(o!==void 0)return s[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Mw(n,t))}}subruleInternal(t,n,r){let s;try{const i=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,s=t.apply(this,i),this.cstPostNonTerminal(s,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),s}catch(i){throw this.subruleInternalError(i,r,t.ruleName)}}subruleInternalError(t,n,r){throw ci(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let s;try{const i=this.LA(1);this.tokenMatcher(i,t)===!0?(this.consumeToken(),s=i):this.consumeInternalError(t,i,r)}catch(i){s=this.consumeInternalRecovery(t,n,i)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,s),s}consumeInternalError(t,n,r){let s;const i=this.LA(0);throw r!==void 0&&r.ERR_MSG?s=r.ERR_MSG:s=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new nh(s,n,i))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const s=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,s)}catch(i){throw i.name===rh?r:i}}else throw r}saveRecogState(){const t=this.errors,n=St(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),In)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class ev{initErrorHandler(t){this._errors=[],this.errorMessageProvider=b(t,"errorMessageProvider")?t.errorMessageProvider:je.errorMessageProvider}SAVE_ERROR(t){if(ci(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:St(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return St(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const s=this.getCurrRuleFullName(),i=this.getGAstProductions()[s],a=ca(t,i,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:s});throw this.SAVE_ERROR(new xw(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),s=this.getGAstProductions()[r],i=aa(t,s,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new kw(c,this.LA(1),a))}}class nv{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(We(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Wu([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=ce(t.ruleStack),s=this.getGAstProductions()[n];return new sw(s,t).startWalking()}}const fi={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(fi);const lh=!0,uh=Math.pow(2,on)-1,hh=x({name:"RECORDING_PHASE_TOKEN",pattern:mt.NA});Vr([hh]);const fh=ii(hh,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(fh);const rv={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class sv{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,s){return this.consumeInternalRecord(r,t,s)},this[`SUBRULE${n}`]=function(r,s){return this.subruleInternalRecord(r,t,s)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return pi}topLevelRuleRecord(t,n){try{const r=new tr({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return qr.call(this,Ut,t,n)}atLeastOneInternalRecord(t,n){qr.call(this,Ae,n,t)}atLeastOneSepFirstInternalRecord(t,n){qr.call(this,we,n,t,lh)}manyInternalRecord(t,n){qr.call(this,dt,n,t)}manySepFirstInternalRecord(t,n){qr.call(this,ue,n,t,lh)}orInternalRecord(t,n){return iv.call(this,t,n)}subruleInternalRecord(t,n,r){if(di(n),!t||b(t,"ruleName")===!1){const a=new Error(`<SUBRULE${dh(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const s=Qn(this.recordingProdStack),i=t.ruleName,o=new Kt({idx:n,nonTerminalName:i,label:r==null?void 0:r.LABEL,referencedRule:void 0});return s.definition.push(o),this.outputCst?rv:fi}consumeInternalRecord(t,n,r){if(di(n),!Lu(t)){const o=new Error(`<CONSUME${dh(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const s=Qn(this.recordingProdStack),i=new Z({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return s.definition.push(i),fh}}function qr(e,t,n,r=!1){di(n);const s=Qn(this.recordingProdStack),i=$e(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),b(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),i.call(this),s.definition.push(o),this.recordingProdStack.pop(),fi}function iv(e,t){di(t);const n=Qn(this.recordingProdStack),r=K(e)===!1,s=r===!1?e:e.DEF,i=new he({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});b(e,"MAX_LOOKAHEAD")&&(i.maxLookahead=e.MAX_LOOKAHEAD);const o=uu(s,a=>$e(a.GATE));return i.hasPredicates=o,n.definition.push(i),k(s,a=>{const c=new xt({definition:[]});i.definition.push(c),b(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:b(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),fi}function dh(e){return e===0?"":`${e}`}function di(e){if(e<0||e>uh){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${uh+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class ov{initPerformanceTracer(t){if(b(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=je.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:s,value:i}=fu(n),o=s>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${s}ms`),this.traceInitIndent--,i}else return n()}}function av(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(s=>{if(s==="constructor")return;const i=Object.getOwnPropertyDescriptor(r,s);i&&(i.get||i.set)?Object.defineProperty(e.prototype,s,i):e.prototype[s]=n.prototype[s]})})}const pi=ii(In,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(pi);const je=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Bu,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),gi=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Ot;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Ot||(Ot={}));class Xr{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{du(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),k(this.definedRulesNames,s=>{const o=this[s].originalGrammarAction;let a;this.TRACE_INIT(`${s} Rule`,()=>{a=this.topLevelRuleRecord(s,o)}),this.gastProductionsCache[s]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=Ow({rules:ft(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(q(r)&&this.skipValidations===!1){const s=bw({rules:ft(this.gastProductionsCache),tokenTypes:ft(this.tokensMap),errMsgProvider:Ln,grammarName:n}),i=gw({lookaheadStrategy:this.lookaheadStrategy,rules:ft(this.gastProductionsCache),tokenTypes:ft(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(s,i)}}),q(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const s=cA(ft(this.gastProductionsCache));this.resyncFollows=s}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var s,i;(i=(s=this.lookaheadStrategy).initialize)===null||i===void 0||i.call(s,{rules:ft(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(ft(this.gastProductionsCache))})),!Xr.DEFER_DEFINITION_ERRORS_HANDLING&&!q(this.definitionErrors))throw t=L(this.definitionErrors,s=>s.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),b(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=b(n,"skipValidations")?n.skipValidations:je.skipValidations}}Xr.DEFER_DEFINITION_ERRORS_HANDLING=!1,av(Xr,[Pw,Bw,Jw,Qw,tv,Zw,ev,nv,sv,ov]);class cv extends Xr{constructor(t,n=je){const r=St(n);r.outputCst=!0,super(t,r)}}const Re=!!JSON.parse("false");JSON.parse("false");const lv=!!JSON.parse("false"),Ea=_o(32,126).map(e=>String.fromCharCode(e)),Jr=x({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),uv=x({name:"Whitespace",pattern:/ +/,group:mt.SKIPPED}),hv=x({name:"Whitespace",pattern:/\s+/,line_breaks:!0,group:mt.SKIPPED}),_a=x({name:"Stat",pattern:/@.*/,start_chars_hint:["@"]}),fe=x({name:"Command",pattern:/#/,start_chars_hint:["#"]});let ph=!1;function fv(e,t,n){if(!ph)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Jr)return null;let s=t;for(;e[s]===" ";)s++;if("@#/?':!".includes(e[s]))return null;let i=t+1;for(;i<e.length&&e[i]!==`
`;)i++;return[e.substring(t,i)]}const gh=x({name:"Text",pattern:fv,line_breaks:!1,start_chars_hint:Ea.filter(e=>"@#/?':!".includes(e)===!1)}),mh=x({name:"Comment",pattern:/'.*/,start_chars_hint:["'"]}),Eh=x({name:"Label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),_h=x({name:"HyperLink",pattern:/!/,start_chars_hint:["!"]}),yh=x({name:"HyperLinkText",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Wt=x({name:"StringLiteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Ea}),Th=x({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Sh=x({name:"NumberLiteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/});function Qt(e){return x({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Wt})}const Ah=x({name:"IsEq",pattern:/=|is|eq|equal/,longer_alt:Wt}),wh=x({name:"IsNotEq",pattern:/!=|not ?eq|not ?equal/,longer_alt:Wt}),vh=x({name:"IsLessThan",pattern:/<|below/,longer_alt:Wt}),Rh=x({name:"IsGreaterThan",pattern:/>|above/,longer_alt:Wt}),Nh=x({name:"IsLessThanOrEqual",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:Wt}),Ch=x({name:"IsGreaterThanOrEqual",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:Wt}),ya=x({name:"Or",pattern:/or/i,longer_alt:Wt}),Ta=x({name:"Not",pattern:/not/i,longer_alt:Wt}),Sa=x({name:"And",pattern:/and/i,longer_alt:Wt}),Aa=x({name:"Plus",pattern:/\+/}),wa=x({name:"Minus",pattern:/-/}),Ih=x({name:"Power",pattern:/\*\*/}),Lh=x({name:"Multiply",pattern:/\*/}),va=x({name:"Divide",pattern:/\//}),Oh=x({name:"ModDivide",pattern:/%/}),bh=x({name:"FloorDivide",pattern:/%%/}),kh=x({name:"Query",pattern:/\?/}),Mh=x({name:"LParen",pattern:/\(/,push_mode:"ignore_newlines"}),xh=x({name:"RParen",pattern:/\)/,pop_mode:!0}),Uh=x({name:"play",pattern:/play .*/,start_chars_hint:Ea,longer_alt:Wt}),Ra=Qt("if"),On=Qt("do"),Na=Qt("else"),Ph=Qt("endif"),Dh=Qt("while"),Fh=Qt("endwhile"),$h=Qt("repeat"),Bh=Qt("endrepeat"),Gh=Qt("read"),Kh=Qt("endread"),Wh=Qt("break"),jh=Qt("continue");function Hh(e){return[...e,Ah,wh,Nh,vh,Ch,Rh,ya,Ta,Sa,Aa,wa,Ih,Lh,va,bh,Oh,kh,Mh,xh,Th,Wt,Sh]}const Vh=Hh([gh,_a,Uh,fe,mh,Eh,_h,yh,Jr,uv,Ra,On,Na,Ph,Dh,Fh,$h,Bh,Gh,Kh,Wh,jh]),dv=new mt({defaultMode:"use_newlines",modes:{use_newlines:Vh,ignore_newlines:Hh([hv])}},{skipValidations:!Re,ensureOptimizations:Re});function Ca(e){ph=!0;const t=dv.tokenize(e||` 
`),[n]=(Array.isArray(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(ii(Jr,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}var jt=(e=>(e[e.ERROR=0]="ERROR",e[e.FUNC=1]="FUNC",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(jt||{});function Zt(e,t){return{id:Pe(),code:e,...t}}function pv(e){return e.map(t=>t.image)}function gv(e,t){const[n,r,...s]=t;if(_(e.stats)&&_(n))switch(n.image.toLowerCase()){case"rn":case"range":case"sl":case"select":case"nm":case"number":case"tx":case"text":case"ln":case"link":if(_(r)){const i=r.image.toLowerCase();e.stats[i]=pv(s??[])}break}}function Yh(e){var n;if(!_(e))return{};if(_((n=e.stats)==null?void 0:n.type))return e.stats;e.stats={};const t=Ca(e.code);for(let r=0;r<t.tokens.length;++r){const s=t.tokens[r];if(s.tokenType===_a){const[i,...o]=s.image.slice(1).split(" "),a=o.join(" ");switch(i.toLowerCase()){case"stat":{const c=Ca(`!${a}`);c.tokens.length&&gv(e,c.tokens);break}case"flags":e.stats.flags=a;break;case"func":e.stats.type=1,e.stats.name=a;break;case"board":e.stats.type=2,e.stats.name=a;break;case"object":e.stats.type=3,e.stats.name=a;break;case"terrain":e.stats.type=4,e.stats.name=a;break;case"charset":e.stats.type=5,e.stats.name=a;break;case"palette":e.stats.type=6,e.stats.name=a;break;default:e.stats.type=3,e.stats.name=[i,...o].join(" ");break}}}return _(e.stats.type)||(e.stats.type=3),e.stats}function mv(e){return Yh(e).type??0}function Ev(e){return(Yh(e).name??"").toLowerCase()}function zh(e,t){return{id:Pe(),name:e,pages:t,flags:{},players:{}}}function Ia(e,t,n){if(!_(e))return;const r=n.toLowerCase();return e.pages.find(i=>mv(i)===t&&(i.id===n||r===Ev(i)))}function La(e,t,n){const r=Ia(e,t,n);if(r)switch(t){case jt.ERROR:return r.error;case jt.FUNC:return r.code;case jt.BOARD:return r.board;case jt.OBJECT:return r.object;case jt.TERRAIN:return r.terrain;case jt.CHARSET:return r.charset;case jt.PALETTE:return r.palette}}function He(e,t){if(_(t)&&_(t.kind))return _(t.kinddata)||(t.kinddata=_(t.id)?Oa(e,t.kind):qh(e,t.kind)),t.kinddata}function Oa(e,t){const n=t??"",r=Ia(e,jt.OBJECT,n),s=La(e,jt.OBJECT,n);return _(r)?{...s,name:n,code:r.code}:void 0}function qh(e,t){const n=t??"",r=Ia(e,jt.TERRAIN,n),s=La(e,jt.TERRAIN,n);return _(r)?{...s,name:n,code:r.code}:void 0}function rr(e,t){return La(e,jt.BOARD,t)}function Xh(e,t){if(e)return e.flags[t]=e.flags[t]??{},e.flags[t]}function _v(e,t,n){const r=Xh(e,t);return r==null?void 0:r[n]}function yv(e,t,n,r){const s=Xh(e,t);return s&&(s[n]=r),r}function Jh(e,t){return rr(e,(e==null?void 0:e.players[t])??"")}function Tv(e,t,n){_(e)&&_(rr(e,n))&&(e.players[t]=n)}function Sv(e){return Qg(Object.values((e==null?void 0:e.players)??[])).map(t=>rr(e,t)).filter(_)}function Av(e,t,n,r){const s=wo(t,(n==null?void 0:n.id)??"");if(!_(e)||!_(t)||!_(s)||!_(t.lookup)||r.x<0||r.x>=t.width||r.y<0||r.y>=t.height)return{kind:"edge",...r};const i=r.x+r.y*t.width,o=He(e,s),a=s.collision??(o==null?void 0:o.collision)??at.WALK,c=wo(t,t.lookup[i]??"");if(_(c))return{...c};const l=t.terrain[i];if(_(l)){const u=He(e,l),h=l.collision??(u==null?void 0:u.collision)??at.WALK;if(Jc(a,h))return{...l,...r}}t.lookup[i]=void 0,s.x=r.x,s.y=r.y,t.lookup[s.x+s.y*t.width]=s.id??""}function sr(e,t){if(_(t==null?void 0:t.x)&&_(t.y)&&_(t.id)){const r=He(e,t);return(t.name??(r==null?void 0:r.name)??"object").toLowerCase()}const n=He(e,t);return((t==null?void 0:t.name)??(n==null?void 0:n.name)??"terrain").toLowerCase()}function Qh(e,t,n,r){if(!_(e)||!_(t)||!_(t.named)||!_(n))return;const s=sr(e,n);t.named[s]||(t.named[s]=new Set),t.named[s].add((n==null?void 0:n.id)??r??"")}function Zh(e,t,n){if(!_(e)||!_(t)||!_(t.lookup)||!_(n==null?void 0:n.id))return;const r=n.x??0,s=n.y??0;t.lookup[r+s*t.width]=n.id}function Qr(e,t){if(!_(e)||!_(t)||_(t.lookup)&&_(t.named))return;const n=new Array(t.width*t.height).fill(void 0),r={},s=Object.values(t.objects);for(let a=0;a<s.length;++a){const c=s[a];if(_(c.x)&&_(c.y)&&_(c.id)){c.category=Ei.OBJECT,n[c.x+c.y*t.width]=c.id;const l=sr(e,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let i=0,o=0;for(let a=0;a<t.terrain.length;++a){const c=t.terrain[a];if(_(c)){c.x=i,c.y=o,c.category=Ei.TERRAIN;const l=sr(e,c);r[l]||(r[l]=new Set),r[l].add(a)}++i,i>=t.width&&(i=0,++o)}t.lookup=n,t.named=r}function ba(e,t,n){return sr(e,t)!=="player"&&_(t)?(t.removed=n,!0):!1}function tf(e,t,n){var r;if(_(e)&&_(t)&&_(n==null?void 0:n.id)){if(_(t.lookup)&&_(n.x)&&_(n.y)){const i=n.x+n.y*t.width;t.lookup[i]===n.id&&delete t.lookup[i]}const s=sr(e,n);_((r=t.named)==null?void 0:r[s])&&_(n.id)&&t.named[s].delete(n.id)}}function wv(e,t,n){if(!_(e)||!_(t))return;const r=Object.values(t.objects);for(let s=0;s<r.length;++s){const i=r[s];_(i.id)&&_(i.removed)&&n-i.removed>Co*5&&vo(t,i.id)}}function vv(e,t,n,r){if(!_(e)||!_(t))return;t.lookup=void 0,Qr(e,t);const s=Object.values(t.objects);for(let i=0;i<s.length;++i){const o=s[i];if(!_(o.id))continue;o.lx=o.x,o.ly=o.y;const a=He(e,o),c=o.code??(a==null?void 0:a.code)??"";c&&r(e,t,o,o.id,c)}wv(e,t,n)}var Zr=(e=>(e[e.VIEW=0]="VIEW",e[e.EDIT=1]="EDIT",e))(Zr||{});function ef(e){return{id:Pe(),type:e}}function nf(e,t){const n=ef(0);return n.book=e,n.board=t,n}function Rv(e,t){const n=ef(1);return n.book=e,n.board=t,n}const Ve={defaultplayer:"",books:new Map,chips:new Map,frames:new Map};function Nv(e){Ve.defaultplayer=e}function rf(e){const t=[nf(void 0,void 0)];return Ve.frames.set(e,t),t}function Cv(e,t,n){const r=mi(e);_(r)&&r.push(nf(t,n))}function Iv(e,t,n){const r=mi(e);_(r)&&r.push(Rv(t,n))}function mi(e){return Ve.frames.get(e)??rf(e)}function ts(e){const t=e.toLowerCase();return Ve.books.get(e)??[...Ve.books.values()].find(n=>n.name.toLowerCase()===t)}function sf(e){return Ve.books.set(e.id,e),e.id}function Y(e){let t=Ve.chips.get(e);return _(t)||(t={book:void 0,board:void 0,target:void 0,inputqueue:new Set,inputmods:{[lt.NONE]:0,[lt.MOVE_UP]:0,[lt.MOVE_DOWN]:0,[lt.MOVE_LEFT]:0,[lt.MOVE_RIGHT]:0,[lt.OK_BUTTON]:0,[lt.CANCEL_BUTTON]:0,[lt.MENU_BUTTON]:0},inputcurrent:void 0},Ve.chips.set(e,t)),t}const of="player",af="title";function Lv(e){const t=ts(Ti.name),n=rr(t,af),r=Oa(t,of);if(_(n)&&_(r)){const s=Ao(n,{id:e,x:0,y:0,kind:of,stats:{player:e}});_(s==null?void 0:s.id)&&Tv(t,e,af)}}function Ov(e){Ve.books.forEach(t=>vo(Jh(t,e),e))}function bv(e,t){function n(s,i,o,a,c){const l=Y(a);l.book=s,l.board=i,l.target=o,l.inputcurrent=void 0,e.tick(a,t,c)}const r=ts(Ti.name);Sv(r).forEach(s=>vv(r,s,t,n))}function kv(e,t,n,r,s){const i=[];let o=t;const a=o===0,c=r.width??0,l=r.height??0,u=a?H.BLACK:H.CLEAR,h=Tg(e,o++,c,l,u);i.push(h);const d=wg(e,o++,c,l);i.push(d);const f=o++,p=Ag(e,f);i.push(p);const E=vg(e,o++);s&&i.push(E),r.terrain.forEach((A,v)=>{if(A){const y=He(n,A);h.char[v]=A.char??(y==null?void 0:y.char)??0,h.color[v]=A.color??(y==null?void 0:y.color)??u,h.bg[v]=A.bg??(y==null?void 0:y.bg)??u}});const w=r.objects??{};return Object.values(w).forEach(A=>{if(_(A.removed))return;const v=A.id??"",y=He(n,A),N=Sg(e,f,v),T=A.lx??A.x??0,m=A.ly??A.y??0;N.x=A.x??0,N.y=A.y??0,N.char=A.char??(y==null?void 0:y.char)??1,N.color=A.color??(y==null?void 0:y.color)??H.WHITE,N.bg=A.bg??(y==null?void 0:y.bg)??H.CLEAR,p.sprites.push(N),N.bg===H.SHADOW&&(N.bg=H.CLEAR,d.alphas[T+m*c]=.5),v===e&&(E.focusx=N.x,E.focusy=N.y,E.focusid=v)}),i}function cf(e){switch(e.type){case Zr.EDIT:return 1;case Zr.VIEW:return 2}return 0}function Mv(e){const t=ts(Ti.name),n=Jh(t,e),r=[];if(!_(t)||!_(n))return r;let s=0;return mi(n.id??"").toSorted((o,a)=>cf(o)-cf(a)).forEach(o=>{const a=ts(o.book??"")??t,c=rr(a,o.board??"")??n;if(_(a)&&_(c)){const l=kv(e,s,a,c,o.type===Zr.VIEW);s+=l.length,r.push(...l)}}),r}var H=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.CLEAR=Hc]="CLEAR",e[e.SHADOW=yg]="SHADOW",e))(H||{}),W=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(W||{}),at=(e=>(e[e.SOLID=0]="SOLID",e[e.WALK=1]="WALK",e[e.SWIM=2]="SWIM",e[e.BULLET=3]="BULLET",e))(at||{}),Ei=(e=>(e[e.TERRAIN=0]="TERRAIN",e[e.OBJECT=1]="OBJECT",e))(Ei||{});function Ye(e){return _(e)&&_(e.x)&&_(e.y)}function de(e,t){switch(t){case 1:--e.y;break;case 2:++e.y;break;case 3:--e.x;break;case 4:++e.x;break}return e}function bn(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return 3;if(n>0)return 4;if(r<0)return 1;if(r>0)return 2}const lf={terrain:"TERRAIN",object:"OBJECT"};function an(e){return De(e)&&uf(e[0])}function uf(e){return _(Ei[e])&&ut(e)}function hf(e){if(ut(e))return lf[e.toLowerCase()]}function ff(e){if(an(e))return e;if(uf(e))return[e];const t=hf(e);if(_(t))return[t]}function _i(e,t){const n=e.words[t],r=ff(n);if(an(r))return[r,t+1];const[s,i]=vt(e,t),o=ff(s);return an(o)?[o,i]:[void 0,t]}const df={solid:"SOLID",walk:"WALK",swim:"SWIM",bullet:"BULLET",walkable:"WALK",swimmable:"SWIM"};function kn(e){return De(e)&&ka(e[0])}function ka(e){return _(at[e])&&ut(e)}function xv(e){if(ut(e))return df[e.toLowerCase()]}function pf(e,t){const n=e.words[t];if(kn(n))return[n,t+1];if(ka(n))return[[n],t+1];const[r,s]=vt(e,t);return kn(r)?[r,s]:ka(r)?[[r],s]:[void 0,t]}const gf={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",clear:"CLEAR",shadow:"SHADOW",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY"};function te(e){return De(e)&&Ef(e[0])}function mf(e){return te(e)&&e[0].startsWith("ON")}function Ef(e){return _(H[e])&&ut(e)}function _f(e){if(ut(e))return gf[e.toLowerCase()]}function yf(e){return e.map(t=>H[t]).find(t=>_(t)&&t<16)}function Tf(e){return e.map(t=>H[t]).find(t=>_(t)&&t>=16)}function Sf(e){if(te(e))return e;if(Ef(e))return[e];const t=_f(e);if(_(t))return[t]}function Af(e,t){const n=e.words[t],r=Sf(n);if(te(r))return[r,t+1];const[s,i]=vt(e,t),o=Sf(s);return te(o)?[o,i]:[void 0,t]}function yi(e,t){const n=[];let r=t;const[s,i]=Af(e,t);if(te(s)&&(n.push(...s),r=i),te(n)&&!mf(n)){const[o,a]=Af(e,i);mf(o)&&(n.push(...o),r=a)}return n.length?[n,r]:[void 0,t]}function ir(e){return De(e)&&typeof e[0]=="string"}function wf(e,t){const n=e.words[t];if(ir(n))return[n,t+1];const[r,s]=yi(e,t),[i,o]=vt(e,s,!1);return ut(i)?[[i,r],o]:[void 0,t]}function Ma(e){if(!ir(e))return;const[t]=e;return t}function vf(e){if(!ir(e))return;const[,t]=e,n=_(t)?yf(t):void 0;return _(n)?n:void 0}function Rf(e){if(!ir(e))return;const[,t]=e,n=_(t)?Tf(t):void 0;return _(n)?n:void 0}const Nf={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function ze(e){return De(e)&&Cf(e[0])}function Cf(e){return _(W[e])&&ut(e)}function If(e){if(ut(e))return Nf[e.toLowerCase()]}function Lf(e){if(ze(e))return e;if(Cf(e))return[e];const t=If(e);if(_(t))return[t]}function Of(e,t){const n=e.words[t],r=Lf(n);if(ze(r))return[r,t+1];const[s,i]=vt(e,t),o=Lf(s);return ze(o)?[o,i]:[void 0,t]}function xa(e,t){const n=[];let[r,s]=Of(e,t);for(;ze(r);){n.push(...r);const[i,o]=Of(e,s);r=i,s=o}return n.length?[n,s]:[void 0,t]}function G(e,t){return{...Y(e.id()),chip:e,words:t}}function vt(e,t,n=!0){const r=e.words[t];if(hf(r)){const[s,i]=_i(e,t);if(_(s))return[s,i]}if(xv(r)){const[s,i]=pf(e,t);if(_(s))return[s,i]}if(_f(r)){const[s,i]=yi(e,t);if(_(s))return[s,i]}if(ut(r)&&r.toLowerCase()==="rnd"){const[s,i]=vt(e,t+1),[o,a]=vt(e,i);return Ft(s)&&Ft(o)?[Hn(s,o),a]:Ft(s)?[Hn(0,s),i]:[Hn(0,1),t+1]}if(If(r)){const[s,i]=xa(e,t);if(_(s))return[s,i]}if(!_(r))return[void 0,t];if(Ye(r)||Ft(r)||De(r))return[r,t+1];if(ut(r)){const s=r.toLowerCase();if(n){const i=e.chip.get(r);if(_(i))return[i,t+1]}switch(s){case"aligned":case"alligned":break;case"contact":break;case"blocked":break;case"any":break;case"abs":{const[i,o]=I(e,t+1,[5]);return[Math.abs(i),o]}case"ceil":{const[i,o]=I(e,t+1,[5]);return[Math.ceil(i),o]}case"floor":{const[i,o]=I(e,t+1,[5]);return[Math.floor(i),o]}case"round":{const[i,o]=I(e,t+1,[5]);return[Math.round(i),o]}case"min":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=vt(e,o);if(De(a)&&!Ye(a)&&!ze(a)&&!an(a)&&!kn(a)&&!te(a))return[Fe(a),c];o=c,i.push(a)}return[Math.min(...i),e.words.length]}case"max":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=vt(e,o);if(De(a)&&!Ye(a)&&!ze(a)&&!an(a)&&!kn(a)&&!te(a))return[Fe(a),c];o=c,i.push(a)}return[Math.max(...i),e.words.length]}case"clamp":{const[i,o,a,c]=I(e,t+1,[5,5,5]);return[ao(i,o,a),c]}case"pick":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=vt(e,o);if(De(a)&&!Ye(a)&&!ze(a)&&!an(a)&&!kn(a)&&!te(a))return[Fe(a),c];o=c,i.push(a)}return[Fe(i),e.words.length]}case"range":{const[i,o,a,c]=I(e,t+1,[5,13,13]);return[_o(i,o,a),c]}}}return[r,t+1]}var C=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NUMBER=5]="NUMBER",e[e.STRING=6]="STRING",e[e.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=9]="MAYBE_COLLISION",e[e.MAYBE_COLOR=10]="MAYBE_COLOR",e[e.MAYBE_KIND=11]="MAYBE_KIND",e[e.MAYBE_DIR=12]="MAYBE_DIR",e[e.MAYBE_NUMBER=13]="MAYBE_NUMBER",e[e.MAYBE_STRING=14]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",e[e.ANY=16]="ANY",e))(C||{});function Rt(e,t){throw new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function I(e,t,n){const r=[];let s=t;for(let i=0;i<n.length;++i)switch(n[i]){case 0:{const[o,a]=_i(e,s);an(o)||Rt("terrain or object",o),s=a,r.push(o);break}case 1:{const[o,a]=pf(e,s);kn(o)||Rt("solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 2:{const[o,a]=yi(e,s);te(o)||Rt("color",o),s=a,r.push(o);break}case 3:{const[o,a]=wf(e,s);ir(o)?(s=a,r.push(o)):Rt("kind",o);break}case 4:{const[o,a]=xa(e,s);if(ze(o)){const c=e.board?Yn(e.board,e.target,o):{x:0,y:0};s=a,r.push(c)}else Rt("direction",o);break}case 5:{const[o,a]=vt(e,s);Ft(o)||Rt("number",o),s=a,r.push(o);break}case 6:{const o=e.words[s];ut(o)||Rt("string",o),++s,r.push(o);break}case 7:{const[o,a]=vt(e,s,!1);!Ft(o)&&!ut(o)&&Rt("number or string",o),s=a,r.push(o);break}case 8:{const[o,a]=_i(e,s);o!==void 0&&!an(o)&&Rt("optional terrain or object",o),s=a,r.push(o);break}case 9:{const[o,a]=_i(e,s);o!==void 0&&!kn(o)&&Rt("optional solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 10:{const[o,a]=yi(e,s);o!==void 0&&!te(o)&&Rt("optional color",o),s=a,r.push(o);break}case 11:{const[o,a]=wf(e,s);o!==void 0&&!ir(o)&&Rt("optional kind",o),s=a,r.push(o);break}case 12:{const[o,a]=xa(e,s);if(ze(o)){const c=e.board?Yn(e.board,e.target,o):{x:0,y:0};s=a,r.push(c)}else o===void 0?(s=a,r.push(void 0)):Rt("optional direction",o);break}case 13:{const[o,a]=vt(e,s);o!==void 0&&!Ft(o)&&Rt("optional number",o),s=a,r.push(o);break}case 14:{const o=e.words[s];o!==void 0&&!ut(o)&&Rt("optional string",o),++s,r.push(o);break}case 15:{const[o,a]=vt(e,s,!1);o!==void 0&&!Ft(o)&&!ut(o)&&Rt("optional number or string",o),s=a,r.push(o);break}case 16:{const[o,a]=vt(e,s);s=a,r.push(o);break}}return[...r,s]}var Uv=`@blonk
#repeat 60 idle
#become spin
`,Pv=`@bullet
#cycle 1
#end

:thud
#die
`,Dv=`@player

' create content
#book temp create

' load content in edit frame
#frame temp edit title

' setup ui
#gadget right 20
 
 $white   - - - - -
 $black$ongrey    ZED.CAFE    
 $white    - - - - -
 
!hotkey plot space " Space ";Plot
!hotkey draw tab "  Tab  ";Draw
 
!hotkey menu_test m  ;Menu Test
!hotkey cmmd_test x  ;Cmmd Test

' main loop
#cycle 1
#set blink
#set drawing white
#set playermove idle

:main
#give blink

#if blink < 19 do
  #char 22
  #color drawing
#else if blink < 25 do
  #char 219
#else do
  #clear blink
#endif

#if inputmove do
  #set playermove inputmove
  #if inputshift do
    #shoot playermove
  #else do
    #if inputalt do
      #if drawing is blue do
        #repeat 10 do
          ?playermove
          #put edit idle brown ondkpurple pick wall wall2
        #endrepeat
      #else do
        ?10 playermove
      #endif
    #else do 
      ?playermove
      #if drawing is blue put edit idle brown ondkpurple pick wall wall2
    #endif
  #endif
#else do
  #idle
#endif

#main

:plot
#put edit idle wall
#main

:draw
#if drawing is white do
  #set drawing blue
  #put edit idle brown ondkpurple pick wall wall2
#else do
  #set drawing white
#endif
#main

:menu_test
$3 Here is some test text and yeah! $3
----------------------------------
!number          frank1 100         ;Number Value 
!rn              frank2             ;Slider 
!select          frank3 A BB CC 333 ;Enum 
!text            frank4             ;Text Value 

#idle
#main

:cmmd_test
' #change edit wall blue wall
#change white spin blue blonk
#idle
#main`,Fv=`@spin
#cycle pick range 1 10
#color pick red white blue yellow dkblue dkred dkgreen
#color onblack

:think
#char pick range 1 22

?u
#if rnd ?u
#put edit idle dirt

?r
#if rnd ?r
#put edit idle dirt2

?d
#if rnd ?d
#put edit idle dirt

?l
#if rnd ?l
#put edit idle dirt2

#think
`;const Ti=zh("BIOS",[Zt("@board title",{board:tl(e=>{for(let t=0;t<32;t++)Ao(e,{x:Hn(0,e.width-1),y:Hn(0,e.height-1),kind:"spin"});return e})}),Zt(Uv,{object:{char:15,color:H.WHITE,bg:H.BLACK}}),Zt(Pv,{object:{char:15,color:H.WHITE,bg:H.SHADOW}}),Zt(Dv,{object:{char:219,color:H.WHITE,bg:H.CLEAR}}),Zt(Fv,{object:{char:1,color:H.WHITE,bg:H.CLEAR}}),Zt("@terrain field",{terrain:{char:176,color:H.DKGRAY,collision:at.WALK}}),Zt("@terrain wall",{terrain:{char:219,color:H.CYAN,collision:at.SOLID}})]);var bf={exports:{}},Ua={exports:{}},kf;function $v(){return kf||(kf=1,function(e,t){(function(n,r){e.exports=r()})(Ns,function(){function n(E){return!isNaN(parseFloat(E))&&isFinite(E)}function r(E){return E.charAt(0).toUpperCase()+E.substring(1)}function s(E){return function(){return this[E]}}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=i.concat(o,a,c,l);function h(E){if(E)for(var w=0;w<u.length;w++)E[u[w]]!==void 0&&this["set"+r(u[w])](E[u[w]])}h.prototype={getArgs:function(){return this.args},setArgs:function(E){if(Object.prototype.toString.call(E)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=E},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(E){if(E instanceof h)this.evalOrigin=E;else if(E instanceof Object)this.evalOrigin=new h(E);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var E=this.getFileName()||"",w=this.getLineNumber()||"",A=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?E?"[eval] ("+E+":"+w+":"+A+")":"[eval]:"+w+":"+A:v?v+" ("+E+":"+w+":"+A+")":E+":"+w+":"+A}},h.fromString=function(w){var A=w.indexOf("("),v=w.lastIndexOf(")"),y=w.substring(0,A),N=w.substring(A+1,v).split(","),T=w.substring(v+1);if(T.indexOf("@")===0)var m=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(T,""),g=m[1],S=m[2],R=m[3];return new h({functionName:y,args:N||void 0,fileName:g,lineNumber:S||void 0,columnNumber:R||void 0})};for(var d=0;d<i.length;d++)h.prototype["get"+r(i[d])]=s(i[d]),h.prototype["set"+r(i[d])]=function(E){return function(w){this[E]=!!w}}(i[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=s(o[f]),h.prototype["set"+r(o[f])]=function(E){return function(w){if(!n(w))throw new TypeError(E+" must be a Number");this[E]=Number(w)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=s(a[p]),h.prototype["set"+r(a[p])]=function(E){return function(w){this[E]=String(w)}}(a[p]);return h})}(Ua)),Ua.exports}(function(e,t){(function(n,r){e.exports=r($v())})(Ns,function(r){var s=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(i))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,E=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:E,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,E;f.match(/\(([^)]*)\)/)&&(E=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=E===void 0||E==="[arguments not available]"?void 0:E.split(",");return new r({functionName:p,args:w,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(bf);var Bv=bf.exports,Gv=io(Bv),Mf={},xf={},Uf={};const Pf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Uf.encode=function(e){if(0<=e&&e<Pf.length)return Pf[e];throw new TypeError("Must be between 0 and 63: "+e)};const Kv=Uf,Df=5,Ff=1<<Df,Wv=Ff-1,jv=Ff;function Hv(e){return e<0?(-e<<1)+1:(e<<1)+0}xf.encode=function(t){let n="",r,s=Hv(t);do r=s&Wv,s>>>=Df,s>0&&(r|=jv),n+=Kv.encode(r);while(s>0);return n};var es={};(function(e){function t(m,g,S){if(g in m)return m[g];if(arguments.length===3)return S;throw new Error('"'+g+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function s(m){const g=m.match(n);return g?{scheme:g[1],auth:g[2],host:g[3],port:g[4],path:g[5]}:null}e.urlParse=s;function i(m){let g="";return m.scheme&&(g+=m.scheme+":"),g+="//",m.auth&&(g+=m.auth+"@"),m.host&&(g+=m.host),m.port&&(g+=":"+m.port),m.path&&(g+=m.path),g}e.urlGenerate=i;const o=32;function a(m){const g=[];return function(S){for(let j=0;j<g.length;j++)if(g[j].input===S){const yt=g[0];return g[0]=g[j],g[j]=yt,g[0].result}const R=m(S);return g.unshift({input:S,result:R}),g.length>o&&g.pop(),R}}const c=a(function(g){let S=g;const R=s(g);if(R){if(!R.path)return g;S=R.path}const j=e.isAbsolute(S),yt=[];let wr=0,Tt=0;for(;;)if(wr=Tt,Tt=S.indexOf("/",wr),Tt===-1){yt.push(S.slice(wr));break}else for(yt.push(S.slice(wr,Tt));Tt<S.length&&S[Tt]==="/";)Tt++;let xe=0;for(Tt=yt.length-1;Tt>=0;Tt--){const re=yt[Tt];re==="."?yt.splice(Tt,1):re===".."?xe++:xe>0&&(re===""?(yt.splice(Tt+1,xe),xe=0):(yt.splice(Tt,2),xe--))}return S=yt.join("/"),S===""&&(S=j?"/":"."),R?(R.path=S,i(R)):S});e.normalize=c;function l(m,g){m===""&&(m="."),g===""&&(g=".");const S=s(g),R=s(m);if(R&&(m=R.path||"/"),S&&!S.scheme)return R&&(S.scheme=R.scheme),i(S);if(S||g.match(r))return g;if(R&&!R.host&&!R.path)return R.host=g,i(R);const j=g.charAt(0)==="/"?g:c(m.replace(/\/+$/,"")+"/"+g);return R?(R.path=j,i(R)):j}e.join=l,e.isAbsolute=function(m){return m.charAt(0)==="/"||n.test(m)};function u(m,g){m===""&&(m="."),m=m.replace(/\/$/,"");let S=0;for(;g.indexOf(m+"/")!==0;){const R=m.lastIndexOf("/");if(R<0||(m=m.slice(0,R),m.match(/^([^\/]+:\/)?\/*$/)))return g;++S}return Array(S+1).join("../")+g.substr(m.length+1)}e.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(m){return m}function f(m){return E(m)?"$"+m:m}e.toSetString=h?d:f;function p(m){return E(m)?m.slice(1):m}e.fromSetString=h?d:p;function E(m){if(!m)return!1;const g=m.length;if(g<9||m.charCodeAt(g-1)!==95||m.charCodeAt(g-2)!==95||m.charCodeAt(g-3)!==111||m.charCodeAt(g-4)!==116||m.charCodeAt(g-5)!==111||m.charCodeAt(g-6)!==114||m.charCodeAt(g-7)!==112||m.charCodeAt(g-8)!==95||m.charCodeAt(g-9)!==95)return!1;for(let S=g-10;S>=0;S--)if(m.charCodeAt(S)!==36)return!1;return!0}function w(m,g,S){let R=v(m.source,g.source);return R!==0||(R=m.originalLine-g.originalLine,R!==0)||(R=m.originalColumn-g.originalColumn,R!==0||S)||(R=m.generatedColumn-g.generatedColumn,R!==0)||(R=m.generatedLine-g.generatedLine,R!==0)?R:v(m.name,g.name)}e.compareByOriginalPositions=w;function A(m,g,S){let R=m.generatedLine-g.generatedLine;return R!==0||(R=m.generatedColumn-g.generatedColumn,R!==0||S)||(R=v(m.source,g.source),R!==0)||(R=m.originalLine-g.originalLine,R!==0)||(R=m.originalColumn-g.originalColumn,R!==0)?R:v(m.name,g.name)}e.compareByGeneratedPositionsDeflated=A;function v(m,g){return m===g?0:m===null?1:g===null?-1:m>g?1:-1}function y(m,g){let S=m.generatedLine-g.generatedLine;return S!==0||(S=m.generatedColumn-g.generatedColumn,S!==0)||(S=v(m.source,g.source),S!==0)||(S=m.originalLine-g.originalLine,S!==0)||(S=m.originalColumn-g.originalColumn,S!==0)?S:v(m.name,g.name)}e.compareByGeneratedPositionsInflated=y;function N(m){return JSON.parse(m.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=N;function T(m,g,S){if(g=g||"",m&&(m[m.length-1]!=="/"&&g[0]!=="/"&&(m+="/"),g=m+g),S){const R=s(S);if(!R)throw new Error("sourceMapURL could not be parsed");if(R.path){const j=R.path.lastIndexOf("/");j>=0&&(R.path=R.path.substring(0,j+1))}g=l(i(R),g)}return c(g)}e.computeSourceURL=T})(es);var Pa={};let Vv=class ig{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new ig;for(let s=0,i=t.length;s<i;s++)r.add(t[s],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),s=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,s)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Pa.ArraySet=Vv;var $f={};const Bf=es;function Yv(e,t){const n=e.generatedLine,r=t.generatedLine,s=e.generatedColumn,i=t.generatedColumn;return r>n||r==n&&i>=s||Bf.compareByGeneratedPositionsInflated(e,t)<=0}let zv=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){Yv(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Bf.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};$f.MappingList=zv;const ns=xf,ct=es,Si=Pa.ArraySet,qv=$f.MappingList;let Gf=class og{constructor(t){t||(t={}),this._file=ct.getArg(t,"file",null),this._sourceRoot=ct.getArg(t,"sourceRoot",null),this._skipValidation=ct.getArg(t,"skipValidation",!1),this._sources=new Si,this._names=new Si,this._mappings=new qv,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new og({file:t.file,sourceRoot:n});return t.eachMapping(function(s){const i={generated:{line:s.generatedLine,column:s.generatedColumn}};s.source!=null&&(i.source=s.source,n!=null&&(i.source=ct.relative(n,i.source)),i.original={line:s.originalLine,column:s.originalColumn},s.name!=null&&(i.name=s.name)),r.addMapping(i)}),t.sources.forEach(function(s){let i=s;n!==null&&(i=ct.relative(n,s)),r._sources.has(i)||r._sources.add(i);const o=t.sourceContentFor(s);o!=null&&r.setSourceContent(s,o)}),r}addMapping(t){const n=ct.getArg(t,"generated"),r=ct.getArg(t,"original",null);let s=ct.getArg(t,"source",null),i=ct.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,s,i),s!=null&&(s=String(s),this._sources.has(s)||this._sources.add(s)),i!=null&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:s,name:i})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=ct.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ct.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[ct.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let s=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);s=t.file}const i=this._sourceRoot;i!=null&&(s=ct.relative(i,s));const o=this._mappings.toArray().length>0?new Si:this._sources,a=new Si;this._mappings.unsortedForEach(function(c){if(c.source===s&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=ct.join(r,c.source)),i!=null&&(c.source=ct.relative(i,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=ct.join(r,c)),i!=null&&(c=ct.relative(i,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,s){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!s)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:s}))}}_serializeMappings(){let t=0,n=1,r=0,s=0,i=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!ct.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=ns.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=ns.encode(h-o),o=h,c+=ns.encode(l.originalLine-1-s),s=l.originalLine-1,c+=ns.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=ns.encode(u-i),i=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=ct.relative(n,r));const s=ct.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,s)?this._sourcesContents[s]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Gf.prototype._version=3,Mf.SourceMapGenerator=Gf;var Kf={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,s,i,o,a){const c=Math.floor((r-n)/2)+n,l=o(s,i[c],!0);return l===0?c:l>0?r-c>1?t(c,r,s,i,o,a):a==e.LEAST_UPPER_BOUND?r<i.length?r:-1:c:c-n>1?t(n,c,s,i,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,s,i,o){if(s.length===0)return-1;let a=t(-1,s.length,r,s,i,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&i(s[a],s[a-1],!0)===0;)--a;return a}})(Kf);var rs={exports:{}},Xv={},Jv=Object.freeze({__proto__:null,default:Xv}),Wf=fg(Jv);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;rs.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},rs.exports.initialize=t=>e=t}else{const e=Wf,t=Wf;rs.exports=function(){return new Promise((r,s)=>{const i=t.join(__dirname,"mappings.wasm");e.readFile(i,null,(o,a)=>{if(o){s(o);return}r(a.buffer)})})},rs.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var jf=rs.exports;const Qv=jf;function Zv(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let ss=null;var tR=function(){if(ss)return ss;const t=[];return ss=Qv().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,s,i,o,a,c,l,u,h,d){const f=new Zv;f.generatedLine=r+1,f.generatedColumn=s,i&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,s)=>{t.push(r);try{s()}finally{t.pop()}}})).then(null,n=>{throw ss=null,n}),ss};const O=es,Da=Kf,Ai=Pa.ArraySet,eR=jf,nR=tR,Fa=Symbol("smcInternal");class st{constructor(t,n){return t==Fa?Promise.resolve(this):sR(t,n)}static initialize(t){eR.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return iR(t,n)}static async with(t,n,r){const s=await new st(t,n);try{return await r(s)}finally{s.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}st.prototype._version=3,st.GENERATED_ORDER=1,st.ORIGINAL_ORDER=2,st.GREATEST_LOWER_BOUND=1,st.LEAST_UPPER_BOUND=2;class is extends st{constructor(t,n){return super(Fa).then(r=>{let s=t;typeof t=="string"&&(s=O.parseSourceMapInput(t));const i=O.getArg(s,"version");let o=O.getArg(s,"sources");const a=O.getArg(s,"names",[]);let c=O.getArg(s,"sourceRoot",null);const l=O.getArg(s,"sourcesContent",null),u=O.getArg(s,"mappings"),h=O.getArg(s,"file",null);if(i!=r._version)throw new Error("Unsupported version: "+i);return c&&(c=O.normalize(c)),o=o.map(String).map(O.normalize).map(function(d){return c&&O.isAbsolute(c)&&O.isAbsolute(d)?O.relative(c,d):d}),r._names=Ai.fromArray(a.map(String),!0),r._sources=Ai.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return O.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,nR().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=O.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new is(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,s=this._wasm.exports.allocate_mappings(r),i=new Uint8Array(this._wasm.exports.memory.buffer,s,r);for(let a=0;a<r;a++)i[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(s);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const s=n||null,i=r||st.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=O.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(s,a)},()=>{switch(i){case st.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case st.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=O.getArg(t,"source");const r=O.getArg(t,"line"),s=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(s<0)throw new Error("Column numbers must be >= 0");const i=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),i.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,s)}),i}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:O.getArg(t,"line"),generatedColumn:O.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=O.getArg(t,"bias",st.GREATEST_LOWER_BOUND);r==null&&(r=st.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(i=>s=i,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),s&&s.generatedLine===n.generatedLine){let i=O.getArg(s,"source",null);i!==null&&(i=this._sources.at(i),i=O.computeSourceURL(this.sourceRoot,i,this._sourceMapURL));let o=O.getArg(s,"name",null);return o!==null&&(o=this._names.at(o)),{source:i,line:O.getArg(s,"originalLine",null),column:O.getArg(s,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let s=t;this.sourceRoot!=null&&(s=O.relative(this.sourceRoot,s));let i;if(this.sourceRoot!=null&&(i=O.urlParse(this.sourceRoot))){const o=s.replace(/^file:\/\//,"");if(i.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!i.path||i.path=="/")&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(n)return null;throw new Error('"'+s+'" is not in the SourceMap.')}generatedPositionFor(t){let n=O.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:O.getArg(t,"line"),originalColumn:O.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let s=O.getArg(t,"bias",st.GREATEST_LOWER_BOUND);s==null&&(s=st.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(o=>i=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,s)}),i&&i.source===r.source){let o=i.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:O.getArg(i,"generatedLine",null),column:O.getArg(i,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}is.prototype.consumer=st;class rR extends st{constructor(t,n){return super(Fa).then(r=>{let s=t;typeof t=="string"&&(s=O.parseSourceMapInput(t));const i=O.getArg(s,"version"),o=O.getArg(s,"sections");if(i!=r._version)throw new Error("Unsupported version: "+i);r._sources=new Ai,r._names=new Ai,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=O.getArg(c,"offset"),u=O.getArg(l,"line"),h=O.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new st(O.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(O.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(O.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:O.getArg(t,"line"),generatedColumn:O.getArg(t,"column")},r=Da.search(n,this._sections,function(i,o){const a=i.generatedLine-o.generatedOffset.generatedLine;return a||i.generatedColumn-o.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:n.generatedLine-(s.generatedOffset.generatedLine-1),column:n.generatedColumn-(s.generatedOffset.generatedLine===n.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const i=this._sections[r].consumer.sourceContentFor(t,!0);if(i)return i}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(O.getArg(t,"source"))===-1)continue;const s=r.consumer.generatedPositionFor(t);if(s)return{line:s.line+(r.generatedOffset.generatedLine-1),column:s.column+(r.generatedOffset.generatedLine===s.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],s=this.__originalMappingsUnsorted=[];for(let i=0;i<this._sections.length;i++){const o=this._sections[i],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=O.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&s.push(d)}}}eachMapping(t,n,r){const s=n||null,i=r||st.GENERATED_ORDER;let o;switch(i){case st.GENERATED_ORDER:o=this._generatedMappings;break;case st.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=O.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,s)}_findMapping(t,n,r,s,i,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[s]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[s]);return Da.search(t,n,i,o)}allGeneratedPositionsFor(t){const n=O.getArg(t,"line"),r={source:O.getArg(t,"source"),originalLine:n,originalColumn:O.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const s=[];let i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",O.compareByOriginalPositions,Da.LEAST_UPPER_BOUND);if(i>=0){let o=this._originalMappings[i];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:O.getArg(o,"generatedLine",null),column:O.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:O.getArg(o,"generatedLine",null),column:O.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}}return s}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function sR(e,t){let n=e;typeof e=="string"&&(n=O.parseSourceMapInput(e));const r=n.sections!=null?new rR(n,t):new is(n,t);return Promise.resolve(r)}function iR(e,t){return is.fromSourceMap(e,t)}var Hf={};const oR=Mf.SourceMapGenerator,wi=es,aR=/(\r?\n)/,cR=10,or="$$$isSourceNode$$$";let lR=class $c{constructor(t,n,r,s,i){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=i??null,this[or]=!0,s!=null&&this.add(s)}static fromStringWithSourceMap(t,n,r){const s=new $c,i=t.split(aR);let o=0;const a=function(){const f=E(),p=E()||"";return f+p;function E(){return o<i.length?i[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=i[o]||"";const p=h.substr(0,f.generatedColumn-l);i[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)s.add(a()),c++;l<f.generatedColumn&&(h=i[o]||"",s.add(h.substr(0,f.generatedColumn)),i[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<i.length&&(u&&d(u,a()),s.add(i.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=wi.join(r,f)),s.setSourceContent(f,p))}),s;function d(f,p){if(f===null||f.source===void 0)s.add(p);else{const E=r?wi.join(r,f.source):f.source;s.add(new $c(f.originalLine,f.originalColumn,E,p,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[or]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[or]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,s=this.children.length;r<s;r++)n=this.children[r],n[or]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const s=this.children.length;if(s>0){for(n=[],r=0;r<s-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[or]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[wi.toSetString(t)]=n}walkSourceContents(t){for(let r=0,s=this.children.length;r<s;r++)this.children[r][or]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,s=n.length;r<s;r++)t(wi.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new oR(t);let s=!1,i=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((i!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),i=u.source,o=u.line,a=u.column,c=u.name,s=!0):s&&(r.addMapping({generated:{line:n.line,column:n.column}}),i=null,s=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===cR?(n.line++,n.column=0,h+1===d?(i=null,s=!1):s&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};Hf.SourceNode=lR;var uR=Hf.SourceNode,Vf={exports:{}},$={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var os=Symbol.for("react.element"),hR=Symbol.for("react.portal"),fR=Symbol.for("react.fragment"),dR=Symbol.for("react.strict_mode"),pR=Symbol.for("react.profiler"),gR=Symbol.for("react.provider"),mR=Symbol.for("react.context"),ER=Symbol.for("react.forward_ref"),_R=Symbol.for("react.suspense"),yR=Symbol.for("react.memo"),TR=Symbol.for("react.lazy"),Yf=Symbol.iterator;function SR(e){return e===null||typeof e!="object"?null:(e=Yf&&e[Yf]||e["@@iterator"],typeof e=="function"?e:null)}var zf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qf=Object.assign,Xf={};function ar(e,t,n){this.props=e,this.context=t,this.refs=Xf,this.updater=n||zf}ar.prototype.isReactComponent={},ar.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},ar.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Jf(){}Jf.prototype=ar.prototype;function $a(e,t,n){this.props=e,this.context=t,this.refs=Xf,this.updater=n||zf}var Ba=$a.prototype=new Jf;Ba.constructor=$a,qf(Ba,ar.prototype),Ba.isPureReactComponent=!0;var Qf=Array.isArray,Zf=Object.prototype.hasOwnProperty,Ga={current:null},td={key:!0,ref:!0,__self:!0,__source:!0};function ed(e,t,n){var r,s={},i=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)Zf.call(t,r)&&!td.hasOwnProperty(r)&&(s[r]=t[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:os,type:e,key:i,ref:o,props:s,_owner:Ga.current}}function AR(e,t){return{$$typeof:os,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Ka(e){return typeof e=="object"&&e!==null&&e.$$typeof===os}function wR(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var nd=/\/+/g;function Wa(e,t){return typeof e=="object"&&e!==null&&e.key!=null?wR(""+e.key):t.toString(36)}function vi(e,t,n,r,s){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case os:case hR:o=!0}}if(o)return o=e,s=s(o),e=r===""?"."+Wa(o,0):r,Qf(s)?(n="",e!=null&&(n=e.replace(nd,"$&/")+"/"),vi(s,t,n,"",function(l){return l})):s!=null&&(Ka(s)&&(s=AR(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(nd,"$&/")+"/")+e)),t.push(s)),1;if(o=0,r=r===""?".":r+":",Qf(e))for(var a=0;a<e.length;a++){i=e[a];var c=r+Wa(i,a);o+=vi(i,t,n,c,s)}else if(c=SR(e),typeof c=="function")for(e=c.call(e),a=0;!(i=e.next()).done;)i=i.value,c=r+Wa(i,a++),o+=vi(i,t,n,c,s);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Ri(e,t,n){if(e==null)return e;var r=[],s=0;return vi(e,r,"","",function(i){return t.call(n,i,s++)}),r}function vR(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var bt={current:null},Ni={transition:null},RR={ReactCurrentDispatcher:bt,ReactCurrentBatchConfig:Ni,ReactCurrentOwner:Ga};$.Children={map:Ri,forEach:function(e,t,n){Ri(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ri(e,function(){t++}),t},toArray:function(e){return Ri(e,function(t){return t})||[]},only:function(e){if(!Ka(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},$.Component=ar,$.Fragment=fR,$.Profiler=pR,$.PureComponent=$a,$.StrictMode=dR,$.Suspense=_R,$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RR,$.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=qf({},e.props),s=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=Ga.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Zf.call(t,c)&&!td.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:os,type:e.type,key:s,ref:i,props:r,_owner:o}},$.createContext=function(e){return e={$$typeof:mR,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:gR,_context:e},e.Consumer=e},$.createElement=ed,$.createFactory=function(e){var t=ed.bind(null,e);return t.type=e,t},$.createRef=function(){return{current:null}},$.forwardRef=function(e){return{$$typeof:ER,render:e}},$.isValidElement=Ka,$.lazy=function(e){return{$$typeof:TR,_payload:{_status:-1,_result:e},_init:vR}},$.memo=function(e,t){return{$$typeof:yR,type:e,compare:t===void 0?null:t}},$.startTransition=function(e){var t=Ni.transition;Ni.transition={};try{e()}finally{Ni.transition=t}},$.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},$.useCallback=function(e,t){return bt.current.useCallback(e,t)},$.useContext=function(e){return bt.current.useContext(e)},$.useDebugValue=function(){},$.useDeferredValue=function(e){return bt.current.useDeferredValue(e)},$.useEffect=function(e,t){return bt.current.useEffect(e,t)},$.useId=function(){return bt.current.useId()},$.useImperativeHandle=function(e,t,n){return bt.current.useImperativeHandle(e,t,n)},$.useInsertionEffect=function(e,t){return bt.current.useInsertionEffect(e,t)},$.useLayoutEffect=function(e,t){return bt.current.useLayoutEffect(e,t)},$.useMemo=function(e,t){return bt.current.useMemo(e,t)},$.useReducer=function(e,t,n){return bt.current.useReducer(e,t,n)},$.useRef=function(e){return bt.current.useRef(e)},$.useState=function(e){return bt.current.useState(e)},$.useSyncExternalStore=function(e,t,n){return bt.current.useSyncExternalStore(e,t,n)},$.useTransition=function(){return bt.current.useTransition()},$.version="18.2.0",Vf.exports=$;var NR=Vf.exports;const CR=_o(32,126).map(e=>String.fromCharCode(e)),IR=x({name:"Whitespace",pattern:/ +/}),LR=x({name:"WhitespaceSkipped",pattern:/ +/,group:mt.SKIPPED}),rd=x({name:"StringLiteral",pattern:/[^ $]+/,start_chars_hint:CR}),sd=x({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),ja=x({name:"MaybeFlag",pattern:/\$[^ $]+/}),id=x({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),od=x({name:"ContinueLine",pattern:/\\/});function ad(e,t=""){return x({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const cd=[["blue"],["green"],["cyan"],["red"],["purple"],["yellow"],["white"],["dkblue"],["dkgreen"],["dkcyan"],["dkred"],["dkpurple"],["dkyellow|brown","brown"],["dkwhite|ltgray|ltgrey|gray|grey","gray"],["dkgray|dkgrey|ltblack","dkgray"],["black"],["clear"]],ld=cd.map(([e,t])=>ad(`\\$(${e})`,t||e)),ud=[...cd.map(([e,t])=>ad(`\\$on(${e})`,`on${t||e}`))],OR=[IR,od,...ld,...ud,sd,rd,id,ja],bR=new mt(OR,{skipValidations:!Re,ensureOptimizations:Re}),kR=new mt([LR,od,...ld,...ud,sd,rd,id,ja],{skipValidations:!Re,ensureOptimizations:Re});function MR(e,t=!1){return t?kR.tokenize(e):bR.tokenize(e)}function xR(e,t,n,r){return{measureOnly:!1,resetCheck:!0,x:0,y:0,isEven:!0,resetColor:n,resetBg:r,activeColor:n,activeBg:r,width:e,height:t,leftEdge:void 0,rightEdge:void 0,bottomEdge:void 0,char:[],color:[],bg:[]}}NR.createContext(xR(1,1,15,1));let UR=0,hd=0;const fd=Re,PR=["Command","lines"];class DR extends cv{constructor(){super(Vh,{traceInitPerf:Re,skipValidations:!Re,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});U(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));U(this,"line",this.RULED("line",()=>{this.OPTION(()=>this.SUBRULE(this.stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Jr))}));U(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stat)},{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.label)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));U(this,"stat",this.RULED("stat",()=>{this.CONSUME(_a)}));U(this,"text",this.RULED("text",()=>{this.CONSUME(gh)}));U(this,"label",this.RULED("label",()=>{this.CONSUME(Eh)}));U(this,"comment",this.RULED("comment",()=>{this.CONSUME(mh)}));U(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>{this.CONSUME(fe),this.AT_LEAST_ONE1(()=>this.SUBRULE1(this.command))}},{ALT:()=>{this.AT_LEAST_ONE2(()=>this.SUBRULE2(this.command))}}])}));U(this,"command",this.RULED("command",()=>{this.OR([{ALT:()=>this.SUBRULE(this.flat_cmd)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));U(this,"flat_cmd",this.RULED("flat_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.hyperlink)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)},{ALT:()=>this.SUBRULE(this.Command_play)}])}));U(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.Command_if)},{ALT:()=>this.SUBRULE(this.Command_read)},{ALT:()=>this.SUBRULE(this.Command_while)},{ALT:()=>this.SUBRULE(this.Command_repeat)},{ALT:()=>this.SUBRULE(this.Command_break)},{ALT:()=>this.SUBRULE(this.Command_continue)}])}));U(this,"hyperlink",this.RULED("hyperlink",()=>{this.CONSUME(_h),this.SUBRULE(this.words),this.CONSUME(yh)}));U(this,"Short_go",this.RULED("Short_go",()=>{this.CONSUME(va),this.SUBRULE(this.words)}));U(this,"Short_try",this.RULED("Short_try",()=>{this.CONSUME(kh),this.SUBRULE(this.words)}));U(this,"Command_play",this.RULED("Command_play",()=>{this.CONSUME(Uh)}));U(this,"do_line",this.RULED("do_line",()=>{this.OPTION(()=>this.SUBRULE(this.do_stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Jr))}));U(this,"do_stmt",this.RULED("do_stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));U(this,"Command_if",this.RULED("Command_if",()=>{this.CONSUME(Ra),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(On),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));U(this,"Command_else_if",this.RULED("Command_else_if",()=>{this.CONSUME(fe),this.CONSUME(Na),this.CONSUME(Ra),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(On),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));U(this,"Command_else",this.RULED("Command_else",()=>{this.CONSUME(fe),this.CONSUME(Na),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(On),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.SUBRULE(this.Command_endif)}}])})}));U(this,"Command_endif",this.RULED("Command_endif",()=>{this.CONSUME(fe),this.CONSUME(Ph)}));U(this,"Command_while",this.RULED("Command_while",()=>{this.CONSUME(fe),this.CONSUME(Dh),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(On),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(fe),this.CONSUME4(Fh)}}])})}));U(this,"Command_repeat",this.RULED("Command_repeat",()=>{this.CONSUME(fe),this.CONSUME($h),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(On),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(fe),this.CONSUME4(Bh)}}])})}));U(this,"Command_read",this.RULED("Command_read",()=>{this.CONSUME(fe),this.CONSUME(Gh),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(On),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(fe),this.CONSUME4(Kh)}}])})}));U(this,"Command_break",this.RULED("Command_break",()=>{this.CONSUME(Wh)}));U(this,"Command_continue",this.RULED("Command_continue",()=>{this.CONSUME(jh)}));U(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(ya),this.SUBRULE2(this.and_test)})}));U(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Sa),this.SUBRULE2(this.not_test)})}));U(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Ta),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));U(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));U(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Ah)},{ALT:()=>this.CONSUME(wh)},{ALT:()=>this.CONSUME(vh)},{ALT:()=>this.CONSUME(Rh)},{ALT:()=>this.CONSUME(Nh)},{ALT:()=>this.CONSUME(Ch)}])}));U(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(ya),this.SUBRULE2(this.and_test_value)})}));U(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Sa),this.SUBRULE2(this.not_test_value)})}));U(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Ta),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));U(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));U(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Aa)},{ALT:()=>this.CONSUME(wa)}]),this.SUBRULE(this.term)}));U(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));U(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Lh)},{ALT:()=>this.CONSUME(va)},{ALT:()=>this.CONSUME(Oh)},{ALT:()=>this.CONSUME(bh)}]),this.SUBRULE(this.factor)}));U(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Aa)},{ALT:()=>this.CONSUME(wa)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));U(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Ih),this.SUBRULE(this.factor)})}));U(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));U(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Th)},{ALT:()=>this.CONSUME(Wt)},{ALT:()=>this.CONSUME(Sh)},{ALT:()=>{this.CONSUME(Mh),this.SUBRULE(this.expr),this.CONSUME(xh)}}])}));this.performSelfAnalysis()}PEEK(n,r,...s){console.info(n,s.map(i=>[i.image,i.tokenType]),r)}RULED(n,r,s){const i=PR.some(o=>n.includes(o));return this.RULE(n,()=>{const o=UR++,a=hd++,c=a.toString().padStart(3),l=" ".repeat(a),u=i?"font-weight: bold;":"";if(fd&&!this.RECORDING_PHASE){const d=[this.LA(0),this.LA(1),this.LA(2)].map(f=>[`[${f.tokenType.name}]`,f.image.replaceAll(`
`,"\\n")]).flat();console.info(`${c}%c${l}> ${n} ${o} ${d.join(" ")}`,u)}r(),fd&&!this.RECORDING_PHASE&&console.info(`${c}%c${l}< ${n} ${o}`,u),hd--},s)}}const as=new DR,FR=as.getBaseCstVisitorConstructor();var X=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.TEXT=1]="TEXT",e[e.LABEL=2]="LABEL",e[e.HYPERLINK=3]="HYPERLINK",e[e.STAT=4]="STAT",e[e.MOVE=5]="MOVE",e[e.COMMAND=6]="COMMAND",e[e.LITERAL=7]="LITERAL",e[e.IF=8]="IF",e[e.ELSE_IF=9]="ELSE_IF",e[e.ELSE=10]="ELSE",e[e.WHILE=11]="WHILE",e[e.BREAK=12]="BREAK",e[e.CONTINUE=13]="CONTINUE",e[e.REPEAT=14]="REPEAT",e[e.READ=15]="READ",e[e.OR=16]="OR",e[e.AND=17]="AND",e[e.NOT=18]="NOT",e[e.COMPARE=19]="COMPARE",e[e.OPERATOR=20]="OPERATOR",e[e.OPERATOR_ITEM=21]="OPERATOR_ITEM",e[e.EXPR=22]="EXPR",e))(X||{}),Mn=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Mn||{}),Ne=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Ne||{}),Ci=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Ci||{});function uL(e){return e}function it(e,t){return((t==null?void 0:t.map(n=>e.visit(n)).filter(n=>n))||[]).flat()}function cn(e){return e.image}function dd(e,t){return F(e,{type:7,literal:1,value:t})}function $R(e){return!!(e!=null&&e.tokenType)}function BR(e){const t=Object.values(e).flat().filter(n=>!!n).map(n=>n&&$R(n)?{startLine:n.startLine,startColumn:n.startColumn,startOffset:n.startOffset,endLine:n.endLine,endColumn:n.endColumn,endOffset:n.endOffset}:n!=null&&n.location?{...n.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(n=>n.startLine!==0&&n.endLine!==0);return{startLine:Math.min(...t.map(n=>n.startLine||1)),startColumn:Math.min(...t.map(n=>n.startColumn||1)),startOffset:Math.min(...t.map(n=>n.startOffset||1)),endLine:Math.max(...t.map(n=>n.endLine||1)),endColumn:Math.max(...t.map(n=>n.endColumn||1)),endOffset:Math.max(...t.map(n=>n.endOffset||1))}}function F(e,t){return{...t,...BR(e)}}class GR extends FR{constructor(){super(),Re&&this.validateVisitor()}program(t){return F(t,{type:0,lines:it(this,t.line)})}line(t){if(t.stmt)return this.visit(t.stmt)}stmt(t){if(t.stat)return this.visit(t.stat);if(t.text)return this.visit(t.text);if(t.label)return this.visit(t.label);if(t.comment)return this.visit(t.comment);if(t.commands)return this.visit(t.commands)}stat(){}text(t){if(t.Text)return F(t,{type:1,value:cn(t.Text[0])})}label(t){var n;return F(t,{type:2,active:!0,name:cn(((n=t.Label)==null?void 0:n[0])??":").slice(1).trim()})}comment(t){return F(t,{type:2,active:!1,name:cn(t.Comment[0]).slice(1).trim()})}commands(t){return it(this,t.command)}command(t){if(t.flat_cmd)return this.visit(t.flat_cmd);if(t.structured_cmd)return this.visit(t.structured_cmd)}flat_cmd(t){if(t.words)return F(t,{type:6,words:it(this,t.words).flat()});if(t.hyperlink)return this.visit(t.hyperlink);if(t.Short_go)return this.visit(t.Short_go);if(t.Short_try)return this.visit(t.Short_try);if(t.Command_play)return this.visit(t.Command_play)}structured_cmd(t){if(t.Command_if)return this.visit(t.Command_if);if(t.Command_read)return this.visit(t.Command_read);if(t.Command_while)return this.visit(t.Command_while);if(t.Command_repeat)return this.visit(t.Command_repeat);if(t.Command_break)return this.visit(t.Command_break);if(t.Command_continue)return this.visit(t.Command_continue)}hyperlink(t){var n;return F(t,{type:3,link:it(this,t.words).flat(),text:cn(((n=t.HyperLinkText)==null?void 0:n[0])??";").slice(1)})}Short_go(t){if(t.Divide)return F(t,{type:5,wait:!0,words:it(this,t.words).flat()})}Short_try(t){if(t.Query)return F(t,{type:5,wait:!1,words:it(this,t.words).flat()})}Command_play(t){if(t.Command_play)return F(t,{type:6,words:[dd(t,"play"),dd(t,cn(t.Command_play[0]).replace("#play","").trim())]})}do_line(t){return this.visit(t.do_stmt)}do_stmt(t){if(t.text)return this.visit(t.text);if(t.comment)return this.visit(t.comment);if(t.commands)return this.visit(t.commands)}Command_if(t){const n=it(this,t.words).flat(),r=[this.visit(t.command),...it(this,t.do_line)].flat(),s=[this.visit(t.Command_else_if),this.visit(t.Command_else)].flat();return F(t,{type:8,method:"if",words:n.filter(_),lines:r.filter(_),branches:s.filter(_)})}Command_else_if(t){const n=it(this,t.words).flat(),r=[this.visit(t.command),...it(this,t.do_line)].flat(),s=it(this,t.Command_else_if).flat();return[F(t,{type:9,method:"if",words:n.filter(_),lines:r.filter(_)}),...s.filter(_),this.visit(t.Command_else)]}Command_else(t){const n=it(this,t.words).flat(),r=[this.visit(t.command),...it(this,t.do_line)].flat();return F(t,{type:10,method:"if",words:n.filter(_),lines:r.filter(_)})}Command_endif(){}Command_while(t){const n=it(this,t.words).flat(),r=[this.visit(t.command),...it(this,t.do_line)].flat();return F(t,{type:11,words:n.filter(_),lines:r.filter(_)})}Command_repeat(t){const n=it(this,t.words).flat(),r=[this.visit(t.command),...it(this,t.do_line)].flat();return F(t,{type:14,words:n.filter(_),lines:r.filter(_)})}Command_read(t){const n=it(this,t.words).flat(),r=[this.visit(t.command),...it(this,t.do_line)].flat();return F(t,{type:15,words:n.filter(_),lines:r.filter(_)})}Command_break(t){return F(t,{type:12})}Command_continue(t){return F(t,{type:13})}expr(t){return t.and_test.length===1?this.visit(t.and_test):F(t,{type:16,items:this.visit(t.and_test)})}and_test(t){return t.not_test.length===1?this.visit(t.not_test):F(t,{type:17,items:this.visit(t.not_test)})}not_test(t){if(t.comparison)return this.visit(t.comparison);if(t.not_test)return F(t,{type:18,items:this.visit(t.not_test)})}comparison(t){return t.arith_expr.length===1?this.visit(t.arith_expr):F(t,{type:19,lhs:this.visit(t.arith_expr[0]),compare:this.visit(t.comp_op),rhs:this.visit(t.arith_expr[1])})}comp_op(t){if(t.is||t.IsEq)return 0;if(t.IsNotEq)return 1;if(t.IsLessThan)return 2;if(t.IsGreaterThan)return 3;if(t.IsLessThanOrEqual)return 4;if(t.IsGreaterThanOrEqual)return 5}expr_value(t){return t.and_test_value.length===1?this.visit(t.and_test_value):F(t,{type:16,items:this.visit(t.and_test_value)})}and_test_value(t){return t.not_test_value.length===1?this.visit(t.not_test_value):F(t,{type:17,items:this.visit(t.not_test_value)})}not_test_value(t){if(t.arith_expr)return this.visit(t.arith_expr);if(t.not_test)return F(t,{type:18,items:this.visit(t.not_test)})}arith_expr(t){const n=this.visit(t.term);return t.arith_expr_item?F(t,{type:20,lhs:n,items:this.visit(t.arith_expr_item)}):n}arith_expr_item(t){return F(t,{type:21,operator:t.Plus?1:2,rhs:this.visit(t.term)})}term(t){return t.term_item?F(t,{type:20,lhs:this.visit(t.factor),items:this.visit(t.term_item)}):this.visit(t.factor)}term_item(t){let n=0;return t.Multiply&&(n=4),t.Divide&&(n=5),t.ModDivide&&(n=6),t.FloorDivide&&(n=7),F(t,{type:21,operator:n,rhs:this.visit(t.factor)})}factor(t){if(t.power)return this.visit(t.power);let n=0;return t.Plus&&(n=8),t.Minus&&(n=9),F(t,{type:20,lhs:void 0,items:[F(t,{type:21,operator:n,rhs:this.visit(t.factor)})]})}power(t){const n=this.visit(t.token);return t.factor?F(t,{type:20,lhs:n,items:[F(t,{type:21,operator:3,rhs:this.visit(t.factor)})]}):n}words(t){return it(this,t.expr)}token(t){if(t.StringLiteralDouble){const n=cn(t.StringLiteralDouble[0]);return F(t,{type:7,literal:2,value:n.substring(1,n.length-1)})}if(t.StringLiteral)return F(t,{type:7,literal:1,value:cn(t.StringLiteral[0])});if(t.NumberLiteral)return F(t,{type:7,literal:0,value:parseFloat(cn(t.NumberLiteral[0]))});if(t.LParen)return F(t,{type:22,words:it(this,t.expr).flat()})}}const KR=new GR,Pt={internal:0,labels:{},labelIndex:0},cs="if (api.hm()) { continue zss; }",Ha=`if (api.sy()) { yield 1; ${cs} };`,Ii=`yield 1; ${cs}`,Li="zss.js";function ot(e,t){return new uR(e.startLine||1,e.startColumn||1,Li,t)}function Va(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function WR(e){return`'${Va(e)}'`}function Oi(e){if(e.startsWith('"'))return Oi(e.substring(1,e.length-1));const t=MR(e);return t.errors.length?e:`'${t.tokens.map(r=>r.tokenType===ja?`', api.group('${Va(r.image.substring(1))}'), '`:Va(r.image)).join("")}'`}function Ce(e){return e.filter(t=>t!==void 0).map(V)}function pd(e){return ot(e,"")}function jR(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function tt(e,t,n){return ot(e,[`api.${t}(`,...jR(n,", "),")"])}function HR(e){if(e.type===X.COMPARE)switch(e.compare){case Mn.IS_EQ:return tt(e,"isEq",[V(e.lhs),V(e.rhs)]);case Mn.IS_NOT_EQ:return tt(e,"isNotEq",[V(e.lhs),V(e.rhs)]);case Mn.IS_LESS_THAN:return tt(e,"isLessThan",[V(e.lhs),V(e.rhs)]);case Mn.IS_GREATER_THAN:return tt(e,"isGreaterThan",[V(e.lhs),V(e.rhs)]);case Mn.IS_LESS_THAN_OR_EQ:return tt(e,"isLessThanOrEq",[V(e.lhs),V(e.rhs)]);case Mn.IS_GREATER_THAN_OR_EQ:return tt(e,"isGreaterThanOrEq",[V(e.lhs),V(e.rhs)])}return ot(e,"")}function xn(e,t,n,r){return t.prepend(`api.${n}(`),t.add([", ",V(r),")"])}function gd(e,t,n,r){return t.prepend(`api.${n}(`),t.add([V(r),")"])}function VR(e,t){if(e.type===X.OPERATOR_ITEM)switch(e.operator){case Ne.PLUS:return xn(e,t,"opPlus",e.rhs);case Ne.MINUS:return xn(e,t,"opMinus",e.rhs);case Ne.POWER:return xn(e,t,"opPower",e.rhs);case Ne.MULTIPLY:return xn(e,t,"opMultiply",e.rhs);case Ne.DIVIDE:return xn(e,t,"opDivide",e.rhs);case Ne.MOD_DIVIDE:return xn(e,t,"opModDivide",e.rhs);case Ne.FLOOR_DIVIDE:return xn(e,t,"opFloorDivide",e.rhs);case Ne.UNI_PLUS:return gd(e,t,"opUniPlus",e.rhs);case Ne.UNI_MINUS:return gd(e,t,"opUniMinus",e.rhs)}return ot(e,"")}function YR(e){if(e.type===X.OPERATOR){const t=e.lhs?V(e.lhs):ot(e,"");return e.items.forEach(n=>VR(n,t)),t}return ot(e,"")}function V(e){switch(e.type){case X.PROGRAM:return ot(e,[`try { // first-line
`,`zss: while (true) {
`,`switch (api.getcase()) {
`,`default:
`,`case 1: 
`,...e.lines.map(t=>[V(t),`
`]).flat(),`}
`,`api.endofprogram();
`,`while(true) { ${Ii} }
`,`}
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Li}`]);case X.LITERAL:switch(e.literal){case Ci.NUMBER:return ot(e,`${e.value}`);case Ci.STRING:return ot(e,WR(e.value));case Ci.TEMPLATE:return ot(e,Oi(e.value))}return pd(e);case X.TEXT:return tt(e,"text",[Oi(e.value)]);case X.STAT:return tt(e,"stat",Ce(e.words));case X.LABEL:{const t=Pt.labelIndex++;return Pt.labels[e.name]||(Pt.labels[e.name]=[]),Pt.labels[e.name].push(e.active?t:-t),ot(e,`case ${t}: // ${e.name}`)}case X.HYPERLINK:return tt(e,"hyperlink",[Oi(e.text),...Ce(e.link)]);case X.MOVE:return ot(e,["while (",tt(e,"move",[e.wait?"true":"false",...Ce(e.words)]),`) { ${Ii} };
         ${Ha} ${cs}`]);case X.COMMAND:return ot(e,["while (",tt(e,"command",Ce(e.words)),`) { ${Ii} };
         ${Ha} ${cs}`]);case X.IF:{const t=ot(e,["if (",tt(e,`${e.method}`,Ce(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([V(n),`
`])),e.branches&&e.branches.forEach(n=>t.add(V(n))),t.add("}"),t}case X.ELSE_IF:{const t=ot(e,["} else if (",tt(e,e.method,Ce(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([V(n),`
`])),t}case X.ELSE:{const t=ot(e,`} else {
`);return e.words.length&&t.add(["while (",tt(e,"command",Ce(e.words)),`) { ${Ii} };`]),e.lines&&e.lines.forEach(n=>t.add([V(n),`
`])),t}case X.WHILE:{const t=ot(e,["while (",tt(e,"if",Ce(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([V(n),`
`])),t.add("}"),t}case X.REPEAT:{const t=ot(e,[tt(e,"repeatstart",[`${Pt.internal}`,...Ce(e.words)]),`;
while (`,tt(e,"repeat",[`${Pt.internal}`]),`) {
         ${Ha} ${cs}
`]);return Pt.internal+=1,e.lines&&e.lines.forEach(n=>t.add([V(n),`
`])),t.add("}"),t}case X.READ:{const[t,...n]=e.words,r=ot(e,[tt(e,"readStart",[`${Pt.internal}`,V(t)]),`;
while (`,tt(e,"read",[`${Pt.internal}`,...Ce(n)]),`) {
`]);return Pt.internal+=1,e.lines&&e.lines.forEach(s=>r.add([V(s),`
`])),r.add("}"),r}case X.BREAK:return ot(e,`break;
`);case X.CONTINUE:return ot(e,`continue;
`);case X.OR:return tt(e,"or",e.items.map(V));case X.AND:return tt(e,"and",e.items.map(V));case X.NOT:return tt(e,"not",e.items.map(V));case X.COMPARE:return HR(e);case X.OPERATOR:return YR(e);case X.EXPR:return tt(e,"expr",e.words.map(V));default:return console.error("<unsupported node>",e),pd(e)}}function zR(e){return Pt.internal=0,Pt.labels={restart:[1]},Pt.labelIndex=2,{...V(e).toStringWithSourceMap({file:`${Li}.map`}),...Pt}}const qR=64;function XR(e){return Array.isArray(e)?e.length>0?1:0:e??0}function qe(e){return`${e??""}`}function JR(e,t){var N;const n=qg(t.labels??{});let r,s="",i,o=0;const a={},c={},l={};let u=!1,h=um,d=0,f=0,p=!1;const E=[];let w={};function A(T){if(w[T]===void 0)for(let m=0;m<E.length;++m){const g=E[m].getcommand(T);g&&(w[T]=g)}return w[T]}function v(T,m){const g=A(T);if(!g)throw new Error(`unknown firmware command ${T}`);return g(y,m)}const y={id(){return e},install(T){w={},E.push(T)},set(T,m){const g=T.toLowerCase();for(let S=0;S<E.length;++S){const[R]=E[S].set(y,g,m);if(R)return m}return m},get(T){const m=T.toLowerCase();for(let g=0;g<E.length;++g){const[S,R]=E[g].get(y,m);if(S)return m.startsWith("input"),R}},cycle(T){h=T},timestamp(){return f},tick(T){f=T;for(let g=0;g<E.length;++g)E[g].shouldtick(y);if(!y.shouldtick())return!1;const m=d%h===0;if(++d,!m)return!1;o=0,u=!1;for(let g=0;g<E.length;++g)E[g].tick(y);try{const g=r==null?void 0:r.next();g!=null&&g.done&&(console.error("we crashed?",t.source),p=!0)}catch(g){console.error("we crashed?",g),p=!0}for(let g=0;g<E.length;++g)E[g].tock(y);return!0},shouldtick(){return p===!1||y.hm()!==0},shouldhalt(){return o++>qR},hm(){var m;const T=(i==null?void 0:i.target)??"";return((m=n[T])==null?void 0:m.find(g=>g>0))??0},yield(){u=!0},sy(){return u||y.shouldhalt()},send(T,m,g){const S=`vm:${T}:${m}`;Dt.emit(S,e,g)},lock(T){s=T},unlock(){s=""},message(T){s&&T.sender!==s||(i=T)},zap(T){const m=n[T];if(m){const g=m.findIndex(S=>S>0);g>=0&&(m[g]*=-1)}},restore(T){const m=n[T];if(m)for(let g=0;g<m.length;g++)m[g]=Math.abs(m[g])},getcase(){if(i){const T=y.hm();return y.set("sender",i.sender),y.set("data",i.data),i.player&&y.set("player",i.player),i=void 0,u=!1,p=!1,T}return 0},endofprogram(){y.yield(),p=!0},stacktrace(T){const m=Gv.parse(T),[g]=m.filter(S=>S.fileName===Li);return{line:(g==null?void 0:g.lineNumber)??0,column:(g==null?void 0:g.columnNumber)??0}},text(T){return v("text",[T])},stat(...T){return v("stat",T)},hyperlink(...T){return v("hyperlink",T)},move(T,...m){const g=y.command("go",...m);return y.yield(),g&&T?1:0},command(...T){if(T.length===0)return 0;const[m,...g]=T,S=A(qe(m));return S?S(y,g):v("send",[m,...g])},if(...T){const m=G(y,T),[g,S]=I(m,0,[C.ANY]),R=XR(g);return R&&S<T.length&&y.command(...T.slice(S)),R},repeatstart(T,...m){const g=G(y,m),[S,R]=I(g,0,[C.NUMBER]);a[T]=S,c[T]=R<m.length?m.slice(R):void 0},repeat(T){const m=a[T]??0;a[T]=m-1;const g=m>0,S=c[T];return g&&S&&y.command(...S),g},readstart(T,m){if(!ut(m))return;const g=y.get(m)??[];l[T]=Array.isArray(g)?g:[g]},read(T,...m){const g=l[T];if(Array.isArray(g)===!1)return!1;const S=g.shift();if(S===void 0)return!1;const R=m.map(qe);switch(typeof S){case"number":case"string":R.forEach(j=>{y.set(j,S)});break;case"object":R.forEach(j=>{const yt=S[j];y.set(j,yt)});break}return!0},or(...T){const m=G(y,T);let g=0;for(let S=0;S<T.length;){const[R,j]=I(m,0,[C.ANY]);if(g=R,g)break;S=j}return g},and(...T){const m=G(y,T);let g=0;for(let S=0;S<T.length;){const[R,j]=I(m,0,[C.ANY]);if(g=R,!g)break;S=j}return g},not(...T){const m=G(y,T),[g]=I(m,0,[C.ANY]);return g?0:1},expr(...T){const m=G(y,T),[g]=I(m,0,[C.ANY]);return g},isEq(T,m){const[g]=I(G(y,[T]),0,[C.ANY]),[S]=I(G(y,[m]),0,[C.ANY]);return zg(g,S)?1:0},isNotEq(T,m){const[g]=I(G(y,[T]),0,[C.ANY]),[S]=I(G(y,[m]),0,[C.ANY]);return g!==S?1:0},isLessThan(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return g<S?1:0},isGreaterThan(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return g>S?1:0},isLessThanOrEq(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return g<=S?1:0},isGreaterThanOrEq(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return g>=S?1:0},opPlus(T,m){const[g]=I(G(y,[T]),0,[C.ANY]),[S]=I(G(y,[m]),0,[C.ANY]);return g+S},opMinus(T,m){const[g]=I(G(y,[T]),0,[C.ANY]),[S]=I(G(y,[m]),0,[C.ANY]);return g-S},opPower(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return Math.pow(g,S)},opMultiply(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return g*S},opDivide(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return g/S},opModDivide(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return g%S},opFloorDivide(T,m){const[g]=I(G(y,[T]),0,[C.NUMBER]),[S]=I(G(y,[m]),0,[C.NUMBER]);return Math.floor(g/S)},opUniPlus(T){const[m]=I(G(y,[T]),0,[C.NUMBER]);return+m},opUniMinus(T){const[m]=I(G(y,[T]),0,[C.NUMBER]);return-m}};return r=(N=t.code)==null?void 0:N.call(t,y),y}function md(e){const t={},n={...e,getcommand(r){return t[r]},command(r,s){return t[r]=s,n}};return n}var Ed={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(e){(function(){var t=function(f,p){return p=p||"",f.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=t("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+t("DF-F6,F8-FF","00"),s="A-Z"+t("C0-D6,D8-DE","00"),i="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,p,E,w){return f=f||n,p=p||r,E=E||s,w=w||i,{capitalize:new RegExp("(^|["+f+"])(["+p+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+p+E+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+w+")\\b","g"),relax:new RegExp("([^"+E+"])(["+E+"]*)(["+E+"])(?=[^"+E+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:t,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,p,E){return p!=null&&(f=f.replace(a.fill,function(w,A){return A?p+A:""})),E&&(f=c.deapostrophe(f)),f},prep:function(f,p,E,w){if(f=f==null?"":f+"",!w&&a.upper.test(f)&&(f=c.low.call(f)),!p&&!a.hole.test(f)){var A=c.fill(f," ");a.hole.test(A)&&(f=A)}return!E&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,p,E,w){return p+" "+(E?E+" ":"")+w}},l={_:c,of:function(f){for(var p=0,E=c.types.length;p<E;p++)if(l[c.types[p]].apply(l,arguments)===f)return c.types[p]},flip:function(f){return f.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(f){return f.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(f,p){l[f]=p,c.types.push(f)}},u={lower:function(f,p,E){return c.fill(c.low.call(c.prep(f,p)),p,E)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,p,E){return c.fill(c.up.call(c.prep(f,p,!1,!0)),p,E)},capital:function(f,p,E){return c.fill(c.prep(f).replace(a.capitalize,function(w,A,v){return A+c.up.call(v)}),p,E)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(p,E,w){return c.up.call(w)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(p,E,w,A){return w>0&&w<A.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(f,p,E){return f=l.lower(f).replace(a.sentence,function(w,A,v){return A+c.up.call(v)}),p&&p.forEach(function(w){f=f.replace(new RegExp("\\b"+l.lower(w)+"\\b","g"),c.cap)}),E&&E.forEach(function(w){f=f.replace(new RegExp("(\\b"+l.lower(w)+"\\. +)(\\w)"),function(A,v,y){return v+c.low.call(y)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(e.exports?e.exports=l:this.Case=l)}).call(Ns)})(Ed);var QR=Ed.exports,ZR=io(QR);const _d=1,yd=2,Ya=4,za=8,ls=32,Xe=64,Ht=128,bi=31,qa=63,Un=127,tN=2147483647,ln=Math.floor,ki=Math.abs,Td=(e,t)=>e<t?e:t,Pn=(e,t)=>e>t?e:t,Sd=e=>e!==0?e<0:1/e<0,Ad=Number.MAX_SAFE_INTEGER,eN=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&ln(e)===e),cr=()=>new Set,Xa=e=>e[e.length-1],nN=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},un=Array.from,rN=Array.isArray,sN=e=>e.toLowerCase(),iN=/^\s*/g,oN=e=>e.replace(iN,""),aN=/([A-Z])/g,wd=(e,t)=>oN(e.replace(aN,n=>`${t}${sN(n)}`)),cN=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},us=typeof TextEncoder<"u"?new TextEncoder:null,lN=us?e=>us.encode(e):cN;let hs=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});hs&&hs.decode(new Uint8Array).length===1&&(hs=null);const hn=e=>new Error(e),Ie=()=>{throw hn("Method unimplemented")},Le=()=>{throw hn("Unexpected case")};class fs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const fn=()=>new fs,uN=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},pe=e=>{const t=new Uint8Array(uN(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},hN=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Pn(n,t)*2),e.cpos=0)},Et=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Ja=Et,P=(e,t)=>{for(;t>Un;)Et(e,Ht|Un&t),t=ln(t/128);Et(e,Un&t)},Qa=(e,t)=>{const n=Sd(t);for(n&&(t=-t),Et(e,(t>qa?Ht:0)|(n?Xe:0)|qa&t),t=ln(t/64);t>0;)Et(e,(t>Un?Ht:0)|Un&t),t=ln(t/128)},Za=new Uint8Array(3e4),fN=Za.length/3,dN=(e,t)=>{if(t.length<fN){const n=us.encodeInto(t,Za).written||0;P(e,n);for(let r=0;r<n;r++)Et(e,Za[r])}else Nt(e,lN(t))},pN=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;P(e,r);for(let s=0;s<r;s++)Et(e,n.codePointAt(s))},lr=us&&us.encodeInto?dN:pN,Mi=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Td(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Pn(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},Nt=(e,t)=>{P(e,t.byteLength),Mi(e,t)},tc=(e,t)=>{hN(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},gN=(e,t)=>tc(e,4).setFloat32(0,t,!1),mN=(e,t)=>tc(e,8).setFloat64(0,t,!1),EN=(e,t)=>tc(e,8).setBigInt64(0,t,!1),vd=new DataView(new ArrayBuffer(4)),_N=e=>(vd.setFloat32(0,e),vd.getFloat32(0)===e),ds=(e,t)=>{switch(typeof t){case"string":Et(e,119),lr(e,t);break;case"number":eN(t)&&ki(t)<=tN?(Et(e,125),Qa(e,t)):_N(t)?(Et(e,124),gN(e,t)):(Et(e,123),mN(e,t));break;case"bigint":Et(e,122),EN(e,t);break;case"object":if(t===null)Et(e,126);else if(rN(t)){Et(e,117),P(e,t.length);for(let n=0;n<t.length;n++)ds(e,t[n])}else if(t instanceof Uint8Array)Et(e,116),Nt(e,t);else{Et(e,118);const n=Object.keys(t);P(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];lr(e,s),ds(e,t[s])}}break;case"boolean":Et(e,t?120:121);break;default:Et(e,127)}};class Rd extends fs{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&P(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Nd=e=>{e.count>0&&(Qa(e.encoder,e.count===1?e.s:-e.s),e.count>1&&P(e.encoder,e.count-2))};class xi{constructor(){this.encoder=new fs,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Nd(this),this.count=1,this.s=t)}toUint8Array(){return Nd(this),pe(this.encoder)}}const Cd=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Qa(e.encoder,t),e.count>1&&P(e.encoder,e.count-2)}};class ec{constructor(){this.encoder=new fs,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Cd(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Cd(this),pe(this.encoder)}}class yN{constructor(){this.sarr=[],this.s="",this.lensE=new xi}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new fs;return this.sarr.push(this.s),this.s="",lr(t,this.sarr.join("")),Mi(t,this.lensE.toUint8Array()),pe(t)}}const Id=hn("Unexpected end of array"),Ld=hn("Integer out of Range");class Ui{constructor(t){this.arr=t,this.pos=0}}const Dn=e=>new Ui(e),TN=e=>e.pos!==e.arr.length,SN=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},kt=e=>SN(e,D(e)),ur=e=>e.arr[e.pos++],D=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&Un)*n,n*=128,s<Ht)return t;if(t>Ad)throw Ld}throw Id},nc=e=>{let t=e.arr[e.pos++],n=t&qa,r=64;const s=(t&Xe)>0?-1:1;if(!(t&Ht))return s*n;const i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&Un)*r,r*=128,t<Ht)return s*n;if(n>Ad)throw Ld}throw Id},hr=hs?e=>hs.decode(kt(e)):e=>{let t=D(e);if(t===0)return"";{let n=String.fromCodePoint(ur(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ur(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},rc=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},AN=[e=>{},e=>null,nc,e=>rc(e,4).getFloat32(0,!1),e=>rc(e,8).getFloat64(0,!1),e=>rc(e,8).getBigInt64(0,!1),e=>!1,e=>!0,hr,e=>{const t=D(e),n={};for(let r=0;r<t;r++){const s=hr(e);n[s]=ps(e)}return n},e=>{const t=D(e),n=[];for(let r=0;r<t;r++)n.push(ps(e));return n},kt],ps=e=>AN[127-ur(e)](e);class Od extends Ui{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),TN(this)?this.count=D(this)+1:this.count=-1),this.count--,this.s}}class Pi extends Ui{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=nc(this);const t=Sd(this.s);this.count=1,t&&(this.s=-this.s,this.count=D(this)+2)}return this.count--,this.s}}class sc extends Ui{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=nc(this),n=t&1;this.diff=ln(t/2),this.count=1,n&&(this.count=D(this)+2)}return this.s+=this.diff,this.count--,this.s}}class wN{constructor(t){this.decoder=new Pi(t),this.str=hr(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const ge=()=>new Map,ic=e=>{const t=ge();return e.forEach((n,r)=>{t.set(r,n)}),t},dn=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},vN=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},RN=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class NN{constructor(){this._observers=ge()}on(t,n){return dn(this._observers,t,cr).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return un((this._observers.get(t)||ge()).values()).forEach(r=>r(...n))}destroy(){this._observers=ge()}}const CN=crypto.getRandomValues.bind(crypto),bd=()=>CN(new Uint32Array(1))[0],IN="10000000-1000-4000-8000"+-1e11,LN=()=>IN.replace(/[018]/g,e=>(e^bd()&15>>e/4).toString(16)),kd=e=>new Promise(e);Promise.all.bind(Promise);const Md=e=>e===void 0?null:e;class ON{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let xd=new ON,bN=!0;try{typeof localStorage<"u"&&localStorage&&(xd=localStorage,bN=!1)}catch{}const kN=xd,MN=Object.assign,xN=Object.keys,UN=(e,t)=>{for(const n in e)t(e[n],n)},Ud=e=>xN(e).length,PN=e=>{for(const t in e)return!1;return!0},DN=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},FN=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),$N=(e,t)=>e===t||Ud(e)===Ud(t)&&DN(e,(n,r)=>(n!==void 0||FN(t,r))&&t[r]===n),oc=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&oc(e,t,n+1)}},BN=e=>e,GN=(e,t)=>t.includes(e);var Pd={};const gs=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Oe;const KN=()=>{if(Oe===void 0)if(gs){Oe=ge();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Oe.set(t,""),t=r):t!==null&&(Oe.set(t,r),t=null)}t!==null&&Oe.set(t,"")}else typeof location=="object"?(Oe=ge(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Oe.set(`--${wd(t,"-")}`,n),Oe.set(`-${wd(t,"-")}`,n)}})):Oe=ge();return Oe},ac=e=>KN().has(e),cc=e=>Md(gs?Pd[e.toUpperCase().replaceAll("-","_")]:kN.getItem(e));(e=>ac("--"+e)||cc(e)!==null)("production");const Dd=gs&&GN(Pd.FORCE_COLOR,["true","1","2"]),WN=!ac("no-colors")&&(!gs||process.stdout.isTTY||Dd)&&(!gs||ac("color")||Dd||cc("COLORTERM")!==null||(cc("TERM")||"").includes("color")),jN=e=>new Uint8Array(e),HN=e=>{const t=jN(e.byteLength);return t.set(e),t};class VN{constructor(t,n){this.left=t,this.right=n}}const Je=(e,t)=>new VN(e,t);typeof DOMParser<"u"&&new DOMParser;const YN=e=>vN(e,(t,n)=>`${n}:${t};`).join(""),Qe=Symbol,Fd=Qe(),$d=Qe(),zN=Qe(),qN=Qe(),XN=Qe(),Bd=Qe(),JN=Qe(),Gd=Qe(),QN=Qe(),ZN=e=>{var r;e.length===1&&((r=e[0])==null?void 0:r.constructor)===Function&&(e=e[0]());const t=[];let n=0;for(;n<e.length;n++){const s=e[n];s===void 0||s.constructor===String||s.constructor===Number||s.constructor===Object&&t.push(JSON.stringify(s))}return t},tC={[Fd]:Je("font-weight","bold"),[$d]:Je("font-weight","normal"),[zN]:Je("color","blue"),[XN]:Je("color","green"),[qN]:Je("color","grey"),[Bd]:Je("color","red"),[JN]:Je("color","purple"),[Gd]:Je("color","orange"),[QN]:Je("color","black")},eC=WN?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=ge();let s=[],i=0;for(;i<e.length;i++){const a=e[i],c=tC[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=YN(r);i>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){const a=e[i];a instanceof Symbol||s.push(a)}return s}:ZN,nC=(...e)=>{console.log(...eC(e)),rC.forEach(t=>t.print(e))},rC=cr(),Kd=e=>({[Symbol.iterator](){return this},next:e}),sC=(e,t)=>Kd(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),lc=(e,t)=>Kd(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class uc{constructor(t,n){this.clock=t,this.len=n}}class ms{constructor(){this.clients=new Map}}const Wd=(e,t,n)=>t.clients.forEach((r,s)=>{const i=e.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const a=r[o];ap(e,i,a.clock,a.len,n)}}),iC=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=ln((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},jd=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&iC(n,t.clock)!==null},hc=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=Pn(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},oC=e=>{const t=new ms;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let o=n+1;o<e.length;o++)nN(i,e[o].clients.get(s)||[]);t.clients.set(s,i)}});return hc(t),t},Di=(e,t,n,r)=>{dn(e.clients,t,()=>[]).push(new uc(n,r))},aC=()=>new ms,cC=e=>{const t=aC();return e.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<n.length)for(let l=n[i+1];i+1<n.length&&l.deleted;l=n[++i+1])c+=l.length;s.push(new uc(a,c))}}s.length>0&&t.clients.set(r,s)}),t},fr=(e,t)=>{P(e.restEncoder,t.clients.size),un(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),P(e.restEncoder,n);const s=r.length;P(e.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},fc=e=>{const t=new ms,n=D(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=D(e.restDecoder),i=D(e.restDecoder);if(i>0){const o=dn(t.clients,s,()=>[]);for(let a=0;a<i;a++)o.push(new uc(e.readDsClock(),e.readDsLen()))}}return t},Hd=(e,t,n)=>{const r=new ms,s=D(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const o=D(e.restDecoder),a=D(e.restDecoder),c=n.clients.get(o)||[],l=_t(n,o);for(let u=0;u<a;u++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<l){l<d&&Di(r,o,l,d-l);let f=be(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,Qi(t,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,Qi(t,p,d-p.id.clock)),p.delete(t))}else Di(r,o,h,d-h)}}if(r.clients.size>0){const i=new Fn;return P(i.restEncoder,0),fr(i,r),i.toUint8Array()}return null},Vd=bd;class dr extends NN{constructor({guid:t=LN(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Vd(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new sp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=kd(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>kd(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&J(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(un(this.subdocs).map(t=>t.guid))}transact(t,n=null){return J(this,t,n)}get(t,n=wt){const r=dn(this.share,t,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==wt&&s!==n)if(s===wt){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Er)}getText(t=""){return this.get(t,$n)}getMap(t=""){return this.get(t,_r)}getXmlElement(t=""){return this.get(t,Tr)}getXmlFragment(t=""){return this.get(t,Bn)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){un(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new dr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,J(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Yd{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return D(this.restDecoder)}readDsLen(){return D(this.restDecoder)}}class zd extends Yd{readLeftID(){return B(D(this.restDecoder),D(this.restDecoder))}readRightID(){return B(D(this.restDecoder),D(this.restDecoder))}readClient(){return D(this.restDecoder)}readInfo(){return ur(this.restDecoder)}readString(){return hr(this.restDecoder)}readParentInfo(){return D(this.restDecoder)===1}readTypeRef(){return D(this.restDecoder)}readLen(){return D(this.restDecoder)}readAny(){return ps(this.restDecoder)}readBuf(){return HN(kt(this.restDecoder))}readJSON(){return JSON.parse(hr(this.restDecoder))}readKey(){return hr(this.restDecoder)}}class lC{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=D(this.restDecoder),this.dsCurrVal}readDsLen(){const t=D(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class pr extends lC{constructor(t){super(t),this.keys=[],D(t),this.keyClockDecoder=new sc(kt(t)),this.clientDecoder=new Pi(kt(t)),this.leftClockDecoder=new sc(kt(t)),this.rightClockDecoder=new sc(kt(t)),this.infoDecoder=new Od(kt(t),ur),this.stringDecoder=new wN(kt(t)),this.parentInfoDecoder=new Od(kt(t),ur),this.typeRefDecoder=new Pi(kt(t)),this.lenDecoder=new Pi(kt(t))}readLeftID(){return new gr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new gr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ps(this.restDecoder)}readBuf(){return kt(this.restDecoder)}readJSON(){return ps(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class qd{constructor(){this.restEncoder=fn()}toUint8Array(){return pe(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){P(this.restEncoder,t)}writeDsLen(t){P(this.restEncoder,t)}}class Es extends qd{writeLeftID(t){P(this.restEncoder,t.client),P(this.restEncoder,t.clock)}writeRightID(t){P(this.restEncoder,t.client),P(this.restEncoder,t.clock)}writeClient(t){P(this.restEncoder,t)}writeInfo(t){Ja(this.restEncoder,t)}writeString(t){lr(this.restEncoder,t)}writeParentInfo(t){P(this.restEncoder,t?1:0)}writeTypeRef(t){P(this.restEncoder,t)}writeLen(t){P(this.restEncoder,t)}writeAny(t){ds(this.restEncoder,t)}writeBuf(t){Nt(this.restEncoder,t)}writeJSON(t){lr(this.restEncoder,JSON.stringify(t))}writeKey(t){lr(this.restEncoder,t)}}class Xd{constructor(){this.restEncoder=fn(),this.dsCurrVal=0}toUint8Array(){return pe(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,P(this.restEncoder,n)}writeDsLen(t){t===0&&Le(),P(this.restEncoder,t-1),this.dsCurrVal+=t}}class Fn extends Xd{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ec,this.clientEncoder=new xi,this.leftClockEncoder=new ec,this.rightClockEncoder=new ec,this.infoEncoder=new Rd(Ja),this.stringEncoder=new yN,this.parentInfoEncoder=new Rd(Ja),this.typeRefEncoder=new xi,this.lenEncoder=new xi}toUint8Array(){const t=fn();return P(t,0),Nt(t,this.keyClockEncoder.toUint8Array()),Nt(t,this.clientEncoder.toUint8Array()),Nt(t,this.leftClockEncoder.toUint8Array()),Nt(t,this.rightClockEncoder.toUint8Array()),Nt(t,pe(this.infoEncoder)),Nt(t,this.stringEncoder.toUint8Array()),Nt(t,pe(this.parentInfoEncoder)),Nt(t,this.typeRefEncoder.toUint8Array()),Nt(t,this.lenEncoder.toUint8Array()),Mi(t,pe(this.restEncoder)),pe(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){ds(this.restEncoder,t)}writeBuf(t){Nt(this.restEncoder,t)}writeJSON(t){ds(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const uC=(e,t,n,r)=>{r=Pn(r,t[0].id.clock);const s=be(t,r);P(e.restEncoder,t.length-s),e.writeClient(n),P(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},dc=(e,t,n)=>{const r=new Map;n.forEach((s,i)=>{_t(t,i)>s&&r.set(i,s)}),$i(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),P(e.restEncoder,r.size),un(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{uC(e,t.clients.get(s),s,i)})},hC=(e,t)=>{const n=ge(),r=D(e.restDecoder);for(let s=0;s<r;s++){const i=D(e.restDecoder),o=new Array(i),a=e.readClient();let c=D(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const u=e.readInfo();switch(bi&u){case 0:{const h=e.readLen();o[l]=new ee(B(a,c),h),c+=h;break}case 10:{const h=D(e.restDecoder);o[l]=new ne(B(a,c),h),c+=h;break}default:{const h=(u&(Xe|Ht))===0,d=new gt(B(a,c),null,(u&Ht)===Ht?e.readLeftID():null,null,(u&Xe)===Xe?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(u&ls)===ls?e.readString():null,kp(e,u));o[l]=d,c+=d.length}}}}return n},fC=(e,t,n)=>{const r=[];let s=un(n.keys()).sort((f,p)=>f-p);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new sp,c=new Map,l=(f,p)=>{const E=c.get(f);(E==null||E>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,E=n.get(p);E?(E.i--,a.clients.set(p,E.refs.slice(E.i)),n.delete(p),E.i=0,E.refs=[]):a.clients.set(p,[f]),s=s.filter(w=>w!==p)}r.length=0};for(;;){if(u.constructor!==ne){const p=dn(h,u.id.client,()=>_t(t,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const E=u.getMissing(e,t);if(E!==null){r.push(u);const w=n.get(E)||{refs:[],i:0};if(w.refs.length===w.i)l(E,_t(t,E)),d();else{u=w.refs[w.i++];continue}}else(p===0||p<u.length)&&(u.integrate(e,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new Fn;return dc(f,a,new Map),P(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},dC=(e,t)=>dc(e,t.doc.store,t.beforeState),pC=(e,t,n,r=new pr(e))=>J(t,s=>{s.local=!1;let i=!1;const o=s.doc,a=o.store,c=hC(r,o),l=fC(s,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<_t(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=Gi([u.update,l.update])}}else a.pendingStructs=l;const h=Hd(r,s,a);if(a.pendingDs){const d=new pr(Dn(a.pendingDs));D(d.restDecoder);const f=Hd(d,s,a);h&&f?a.pendingDs=Gi([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,Jd(s.doc,d)}},n,!1),Jd=(e,t,n,r=pr)=>{const s=Dn(t);pC(s,e,n,new r(s))},gC=(e,t,n)=>Jd(e,t,n,zd),mC=(e,t,n=new Map)=>{dc(e,t.store,n),fr(e,cC(t.store))},EC=(e,t=new Uint8Array([0]),n=new Fn)=>{const r=Qd(t);mC(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(kC(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Es)return OC(s.map((i,o)=>o===0?i:xC(i)));if(n.constructor===Fn)return Gi(s)}return s[0]},_C=(e,t)=>EC(e,t,new Es),yC=e=>{const t=new Map,n=D(e.restDecoder);for(let r=0;r<n;r++){const s=D(e.restDecoder),i=D(e.restDecoder);t.set(s,i)}return t},Qd=e=>yC(new Yd(Dn(e))),Zd=(e,t)=>(P(e.restEncoder,t.size),un(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{P(e.restEncoder,n),P(e.restEncoder,r)}),e),TC=(e,t)=>Zd(e,$i(t.store)),SC=(e,t=new Xd)=>(e instanceof Map?Zd(t,e):TC(t,e),t.toUint8Array()),AC=e=>SC(e,new qd);class wC{constructor(){this.l=[]}}const tp=()=>new wC,ep=(e,t)=>e.l.push(t),np=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},rp=(e,t,n)=>oc(e.l,[t,n]);class gr{constructor(t,n){this.client=t,this.clock=n}}const Fi=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,B=(e,t)=>new gr(e,t),vC=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Le()},mr=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!jd(t.ds,e.id),pc=(e,t)=>{const n=dn(e.meta,pc,cr),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<_t(r,i)&&pn(e,B(i,s))}),Wd(e,t.ds,s=>{}),n.add(t))};class sp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const $i=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},_t=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ip=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Le()}n.push(t)},be=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=ln(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=ln((n+r)/2)}throw Le()},gc=(e,t)=>{const n=e.clients.get(t.client);return n[be(n,t.clock)]},mc=(e,t,n)=>{const r=be(t,n),s=t[r];return s.id.clock<n&&s instanceof gt?(t.splice(r+1,0,Qi(e,s,n-s.id.clock)),r+1):r},pn=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[mc(e,n,t.clock)]},op=(e,t,n)=>{const r=t.clients.get(n.client),s=be(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==ee&&r.splice(s+1,0,Qi(e,i,n.clock-i.id.clock+1)),i},RC=(e,t,n)=>{const r=e.clients.get(t.id.client);r[be(r,t.id.clock)]=n},ap=(e,t,n,r,s)=>{if(r===0)return;const i=n+r;let o=mc(e,t,n),a;do a=t[o++],i<a.id.clock+a.length&&mc(e,t,i),s(a);while(o<t.length&&t[o].id.clock<i)};class NC{constructor(t,n,r){this.doc=t,this.deleteSet=new ms,this.beforeState=$i(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const cp=(e,t)=>t.deleteSet.clients.size===0&&!RN(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(hc(t.deleteSet),dC(e,t),fr(e,t.deleteSet),!0),lp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&dn(e.changed,t,cr).add(n)},Bi=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof gt&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=t-s;return i&&e.splice(t+1-i,i),i},CC=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const i=t.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],c=a.clock+a.len;for(let l=be(i,a.clock),u=i[l];l<i.length&&u.id.clock<c;u=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof gt&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},IC=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Td(s.length-1,1+be(s,o.clock+o.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=o.clock;l=s[c])c-=1+Bi(s,c)}})},up=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{hc(i),n.afterState=$i(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),rp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),oc(a,[]),n._needFormattingCleanup&&zC(n)}finally{r.gc&&CC(i,s,r.gcFilter),IC(i,s),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=s.clients.get(h),p=Pn(be(f,d),1);for(let E=f.length-1;E>=p;)E-=1+Bi(f,E)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=s.clients.get(h),p=be(f,d);p+1<f.length&&Bi(f,p+1)>1||p>0&&Bi(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(nC(Gd,Fd,"[yjs] ",$d,Bd,"Changed the client-id because another client seems to be using it."),r.clientID=Vd()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Es;cp(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Fn;cp(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):up(e,t+1)}}},J=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new NC(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const a=e._transaction===s[0];e._transaction=null,a&&up(s,0)}}return o};function*LC(e){const t=D(e.restDecoder);for(let n=0;n<t;n++){const r=D(e.restDecoder),s=e.readClient();let i=D(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=D(e.restDecoder);yield new ne(B(s,i),c),i+=c}else if(bi&a){const c=(a&(Xe|Ht))===0,l=new gt(B(s,i),null,(a&Ht)===Ht?e.readLeftID():null,null,(a&Xe)===Xe?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&ls)===ls?e.readString():null,kp(e,a));yield l,i+=l.length}else{const c=e.readLen();yield new ee(B(s,i),c),i+=c}}}}class Ec{constructor(t,n){this.gen=LC(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ne);return this.curr}}class _c{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const OC=e=>Gi(e,zd,Es),bC=(e,t)=>{if(e.constructor===ee){const{client:n,clock:r}=e.id;return new ee(B(n,r+t),e.length-t)}else if(e.constructor===ne){const{client:n,clock:r}=e.id;return new ne(B(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new gt(B(r,s+t),null,B(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Gi=(e,t=pr,n=Fn)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Dn(u)));let s=r.map(u=>new Ec(u,!0)),i=null;const o=new n,a=new _c(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===ne?1:-1:p}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)gn(a,i.struct,i.offset),i={struct:d,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===ne)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{gn(a,i.struct,i.offset);const p=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new ne(B(h,i.struct.id.clock+i.struct.length),p),offset:0}}else{const p=i.struct.id.clock+i.struct.length-d.id.clock;p>0&&(i.struct.constructor===ne?i.struct.length-=p:d=bC(d,p)),i.struct.mergeWith(d)||(gn(a,i.struct,i.offset),i={struct:d,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==ne;d=u.next())gn(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(gn(a,i.struct,i.offset),i=null),yc(a);const c=r.map(u=>fc(u)),l=oC(c);return fr(o,l),o.toUint8Array()},kC=(e,t,n=pr,r=Fn)=>{const s=Qd(t),i=new r,o=new _c(i),a=new n(Dn(e)),c=new Ec(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=s.get(h)||0;if(c.curr.constructor===ne){c.next();continue}if(u.id.clock+u.length>d)for(gn(o,u,Pn(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)gn(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}yc(o);const l=fc(a);return fr(i,l),i.toUint8Array()},hp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:pe(e.encoder.restEncoder)}),e.encoder.restEncoder=fn(),e.written=0)},gn=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&hp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),P(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},yc=e=>{hp(e);const t=e.encoder.restEncoder;P(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];P(t,r.written),Mi(t,r.restEncoder)}},MC=(e,t,n,r)=>{const s=new n(Dn(e)),i=new Ec(s,!1),o=new r,a=new _c(o);for(let l=i.curr;l!==null;l=i.next())gn(a,t(l),0);yc(a);const c=fc(s);return fr(o,c),o.toUint8Array()},xC=e=>MC(e,BN,pr,Es),fp="You must not compute changes after the event-handler fired.";class Ki{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=UC(this.currentTarget,this.target))}deletes(t){return jd(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw hn(fp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=Xa(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Xa(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Xa(i.content.getContent());else return;t.set(s,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw hn(fp);const n=this.target,r=cr(),s=cr(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const UC=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}t=t._item.parent}return n},dp=80;let Tc=0;class PC{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Tc++}}const DC=e=>{e.timestamp=Tc++},pp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Tc++},FC=(e,t,n)=>{if(e.length>=dp){const r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return pp(r,t,n),r}else{const r=new PC(t,n);return e.push(r),r}},Wi=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>ki(t-i.index)<ki(t-o.index)?i:o);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,DC(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&ki(n.index-s)<r.parent.length/dp?(pp(n,r,s),n):FC(e._searchMarker,r,s)},_s=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=Pn(t,s.index+n))}},ji=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;dn(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;rp(r._eH,n,t)};class wt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=tp(),this._dEH=tp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Ie()}clone(){throw Ie()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){ep(this._eH,t)}observeDeep(t){ep(this._dEH,t)}unobserve(t){np(this._eH,t)}unobserveDeep(t){np(this._dEH,t)}toJSON(){}}const gp=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)s.push(o[a]),r--;t=0}}i=i.right}return s},mp=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},ys=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}r=r.right}},Ep=(e,t)=>{const n=[];return ys(e,(r,s)=>{n.push(t(r,s,e))}),n},$C=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},_p=(e,t)=>{const n=Wi(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Hi=(e,t,n,r)=>{let s=n;const i=e.doc,o=i.clientID,a=i.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new gt(B(o,_t(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Kn(l)),s.integrate(e,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new gt(B(o,_t(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Ts(new Uint8Array(h))),s.integrate(e,0);break;case dr:s=new gt(B(o,_t(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new As(h)),s.integrate(e,0);break;default:if(h instanceof wt)s=new gt(B(o,_t(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Ze(h)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},yp=()=>hn("Length exceeded!"),Tp=(e,t,n,r)=>{if(n>t._length)throw yp();if(n===0)return t._searchMarker&&_s(t._searchMarker,n,r.length),Hi(e,t,null,r);const s=n,i=Wi(t,n);let o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&pn(e,B(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&_s(t._searchMarker,s,r.length),Hi(e,t,o,r)},BC=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return Hi(e,t,s,n)},Sp=(e,t,n,r)=>{if(r===0)return;const s=n,i=r,o=Wi(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&pn(e,B(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&pn(e,B(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw yp();t._searchMarker&&_s(t._searchMarker,s,-i+r)},Vi=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Sc=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,o=i.clientID;let a;if(r==null)a=new Kn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Kn([r]);break;case Uint8Array:a=new Ts(r);break;case dr:a=new As(r);break;default:if(r instanceof wt)a=new Ze(r);else throw new Error("Unexpected content type")}new gt(B(o,_t(i.store,o)),s,s&&s.lastId,null,null,t,n,a).integrate(e,0)},Ac=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Ap=e=>{const t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},wp=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},GC=(e,t)=>{const n={};return e._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&mr(i,t)&&(n[s]=i.content.getContent()[i.length-1])}),n},Yi=e=>sC(e.entries(),t=>!t[1].deleted);class KC extends Ki{constructor(t,n){super(t,n),this._transaction=n}}class Er extends wt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Er;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Er}clone(){const t=new Er;return t.insert(0,this.toArray().map(n=>n instanceof wt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),ji(this,t,new KC(this,t))}insert(t,n){this.doc!==null?J(this.doc,r=>{Tp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?J(this.doc,n=>{BC(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?J(this.doc,r=>{Sp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return _p(this,t)}toArray(){return mp(this)}slice(t=0,n=this.length){return gp(this,t,n)}toJSON(){return this.map(t=>t instanceof wt?t.toJSON():t)}map(t){return Ep(this,t)}forEach(t){ys(this,t)}[Symbol.iterator](){return $C(this)}_write(t){t.writeTypeRef(fI)}}const WC=e=>new Er;class jC extends Ki{constructor(t,n,r){super(t,n),this.keysChanged=r}}class _r extends wt{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new _r}clone(){const t=new _r;return this.forEach((n,r)=>{t.set(r,n instanceof wt?n.clone():n)}),t}_callObserver(t,n){ji(this,t,new jC(this,t,n))}toJSON(){const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof wt?s.toJSON():s}}),t}get size(){return[...Yi(this._map)].length}keys(){return lc(Yi(this._map),t=>t[0])}values(){return lc(Yi(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return lc(Yi(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?J(this.doc,n=>{Vi(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?J(this.doc,r=>{Sc(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Ac(this,t)}has(t){return wp(this,t)}clear(){this.doc!==null?J(this.doc,t=>{this.forEach(function(n,r,s){Vi(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(dI)}}const HC=e=>new _r,mn=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&$N(e,t);class wc{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Le(),this.right.content.constructor){case pt:this.right.deleted||yr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const vp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case pt:t.right.deleted||yr(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&pn(e,B(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},zi=(e,t,n,r)=>{const s=new Map,i=r?Wi(t,n):null;if(i){const o=new wc(i.p.left,i.p,i.index,s);return vp(e,o,n-i.index)}else{const o=new wc(null,t._start,0,s);return vp(e,o,n)}},Rp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===pt&&mn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new gt(B(i,_t(s.store,i)),c,c&&c.lastId,l,l&&l.id,t,null,new pt(a,o));u.integrate(e,0),n.right=u,n.forward()})},yr=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Np=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===pt&&mn(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Cp=(e,t,n,r)=>{const s=e.doc,i=s.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!mn(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new gt(B(i,_t(s.store,i)),u,u&&u.lastId,h,h&&h.id,t,null,new pt(a,c)),n.right.integrate(e,0),n.forward()}}return o},vc=(e,t,n,r,s)=>{n.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});const i=e.doc,o=i.clientID;Np(n,s);const a=Cp(e,t,n,s),c=r.constructor===String?new ke(r):r instanceof wt?new Ze(r):new Gn(r);let{left:l,right:u,index:h}=n;t._searchMarker&&_s(t._searchMarker,n.index,c.getLength()),u=new gt(B(o,_t(i.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=h,n.forward(),Rp(e,t,n,a)},Ip=(e,t,n,r,s)=>{const i=e.doc,o=i.clientID;Np(n,s);const a=Cp(e,t,n,s);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===pt));){if(!n.right.deleted)switch(n.right.content.constructor){case pt:{const{key:c,value:l}=n.right.content,u=s[c];if(u!==void 0){if(mn(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&pn(e,B(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new gt(B(o,_t(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new ke(c)),n.right.integrate(e,0),n.forward()}Rp(e,t,n,a)},Lp=(e,t,n,r,s)=>{let i=t;const o=ge();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===pt){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;t!==i;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case pt:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(t.delete(e),a++,!c&&(s.get(u)??null)===h&&d!==h&&(d===null?s.delete(u):s.set(u,d))),!c&&!t.deleted&&yr(s,l);break}}}t=t.right}return a},VC=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===pt){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},YC=e=>{let t=0;return J(e.doc,n=>{let r=e._start,s=e._start,i=ge();const o=ic(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case pt:yr(o,s.content);break;default:t+=Lp(n,r,s,i,o),i=ic(o),r=s;break}s=s.right}}),t},zC=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const i=e.beforeState.get(r)||0;s!==i&&ap(e,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===pt&&o.constructor!==ee&&t.add(o.parent)})}J(n,r=>{Wd(e,e.deleteSet,s=>{if(s instanceof ee||!s.parent._hasFormatting||t.has(s.parent))return;const i=s.parent;s.content.constructor===pt?t.add(i):VC(r,s)});for(const s of t)YC(s)})},Op=(e,t,n)=>{const r=n,s=ic(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ze:case Gn:case ke:n<t.right.length&&pn(e,B(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&Lp(e,i,t.right,s,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&_s(o._searchMarker,t.index,-r+n),t};class qC extends Ki{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];J(t,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((p,E)=>{p!==null&&(f.attributes[E]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},PN(c)||(f.attributes=MN({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case Ze:case Gn:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ke:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case pt:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const E=s.get(f)??null;mn(E,p)?p!==null&&o.delete(r):(a==="retain"&&d(),mn(p,i.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){i.set(f,p);const E=s.get(f)??null;mn(E,p)||(a==="retain"&&d(),c[f]=E)}else if(!o.deleted){i.set(f,p);const E=c[f];E!==void 0&&(mn(E,p)?E!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),yr(s,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class $n extends wt{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new $n}clone(){const t=new $n;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new qC(this,t,n);ji(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ke&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?J(this.doc,r=>{const s=new wc(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const o=t[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===t.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&vc(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Ip(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Op(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){const s=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;i.forEach((p,E)=>{d=!0,h[E]=p});const f={insert:a};d&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(mr(c,t)||n!==void 0&&mr(c,n))switch(c.content.constructor){case ke:{const h=i.get("ychange");t!==void 0&&!mr(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!mr(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case Ze:case Gn:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((f,p)=>{d[p]=f})}s.push(h);break}case pt:mr(c,t)&&(l(),yr(i,c.content));break}c=c.right}l()};return t||n?J(o,h=>{t&&pc(h,t),n&&pc(h,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?J(s,i=>{const o=zi(i,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),vc(i,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const s=this.doc;s!==null?J(s,i=>{const o=zi(i,this,t,!r);vc(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?J(r,s=>{Op(s,zi(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?J(s,i=>{const o=zi(i,this,t,!1);o.right!==null&&Ip(i,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?J(this.doc,n=>{Vi(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?J(this.doc,r=>{Sc(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Ac(this,t)}getAttributes(){return Ap(this)}_write(t){t.writeTypeRef(pI)}}const XC=e=>new $n;class Rc{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Tr||n.constructor===Bn)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Bn extends wt{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Bn}clone(){const t=new Bn;return t.insert(0,this.toArray().map(n=>n instanceof wt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Rc(this,t)}querySelector(t){t=t.toUpperCase();const r=new Rc(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),un(new Rc(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){ji(this,t,new ZC(this,n,t))}toString(){return Ep(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),ys(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?J(this.doc,r=>{Tp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)J(this.doc,r=>{const s=t&&t instanceof wt?t._item:t;Hi(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw hn("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?J(this.doc,r=>{Sp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return mp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return _p(this,t)}slice(t=0,n=this.length){return gp(this,t,n)}forEach(t){ys(this,t)}_write(t){t.writeTypeRef(mI)}}const JC=e=>new Bn;class Tr extends Bn{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Tr(this.nodeName)}clone(){const t=new Tr(this.nodeName),n=this.getAttributes();return UN(n,(r,s)=>{typeof r=="string"&&t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof wt?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?J(this.doc,n=>{Vi(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?J(this.doc,r=>{Sc(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Ac(this,t)}hasAttribute(t){return wp(this,t)}getAttributes(t){return t?GC(this,t):Ap(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return ys(this,o=>{s.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(gI),t.writeKey(this.nodeName)}}const QC=e=>new Tr(e.readKey());class ZC extends Ki{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class qi extends _r{constructor(t){super(),this.hookName=t}_copy(){return new qi(this.hookName)}clone(){const t=new qi(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(EI),t.writeKey(this.hookName)}}const tI=e=>new qi(e.readKey());class Xi extends $n{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Xi}clone(){const t=new Xi;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const i=[];for(const o in t.attributes[s])i.push({key:o,value:t.attributes[s][o]});i.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(_I)}}const eI=e=>new Xi;class Nc{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Ie()}mergeWith(t){return!1}write(t,n,r){throw Ie()}integrate(t,n){throw Ie()}}const nI=0;class ee extends Nc{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),ip(t.doc.store,this)}write(t,n){t.writeInfo(nI),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ts{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ts(this.content)}splice(t){throw Ie()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const rI=e=>new Ts(e.readBuf());class Ss{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ss(this.len)}splice(t){const n=new Ss(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Di(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const sI=e=>new Ss(e.readLen()),bp=(e,t)=>new dr({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class As{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new As(bp(this.doc.guid,this.opts))}splice(t){throw Ie()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const iI=e=>new As(bp(e.readString(),e.readAny()));class Gn{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Gn(this.embed)}splice(t){throw Ie()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const oI=e=>new Gn(e.readJSON());class pt{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new pt(this.key,this.value)}splice(t){throw Ie()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const aI=e=>new pt(e.readKey(),e.readJSON());class Ji{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ji(this.arr)}splice(t){const n=new Ji(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const cI=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new Ji(n)};class Kn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Kn(this.arr)}splice(t){const n=new Kn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeAny(i)}}getRef(){return 8}}const lI=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Kn(n)};class ke{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ke(this.str)}splice(t){const n=new ke(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const uI=e=>new ke(e.readString()),hI=[WC,HC,XC,QC,JC,tI,eI],fI=0,dI=1,pI=2,gI=3,mI=4,EI=5,_I=6;class Ze{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ze(this.type._copy())}splice(t){throw Ie()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const yI=e=>new Ze(hI[e.readTypeRef()](e)),Qi=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new gt(B(r,s+n),t,B(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=B(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i};class gt extends Nc{constructor(t,n,r,s,i,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?yd:0}set marker(t){(this.info&za)>0!==t&&(this.info^=za)}get marker(){return(this.info&za)>0}get keep(){return(this.info&_d)>0}set keep(t){this.keep!==t&&(this.info^=_d)}get countable(){return(this.info&yd)>0}get deleted(){return(this.info&Ya)>0}set deleted(t){this.deleted!==t&&(this.info^=Ya)}markDeleted(){this.info|=Ya}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=_t(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=_t(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===gr&&this.id.client!==this.parent.client&&this.parent.clock>=_t(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=op(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=pn(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ee||this.right&&this.right.constructor===ee)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===gt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===gt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===gr){const r=gc(n,this.parent);r.constructor===ee?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=op(t,t.doc.store,B(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Fi(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Fi(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(gc(t.doc.store,s.origin)))i.has(gc(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ip(t.doc.store,this),this.content.integrate(t,this),lp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ee(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:B(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Fi(t.origin,this.lastId)&&this.right===t&&Fi(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Di(t.deleteSet,this.id.client,this.id.clock,this.length),lp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Le();this.content.gc(t),n?RC(t,this,new ee(this.id,this.length)):this.content=new Ss(this.length)}write(t,n){const r=n>0?B(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&bi|(r===null?0:Ht)|(s===null?0:Xe)|(i===null?0:ls);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=vC(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===gr?(t.writeParentInfo(!1),t.writeLeftID(a)):Le();i!==null&&t.writeString(i)}this.content.write(t,n)}}const kp=(e,t)=>TI[t&bi](e),TI=[()=>{Le()},sI,cI,rI,uI,oI,aI,yI,lI,iI,()=>{Le()}],SI=10;class ne extends Nc{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Le()}write(t,n){t.writeInfo(SI),P(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Mp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},xp="__ $YJS$ __";Mp[xp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Mp[xp]=!0;const Cc=0,Up=1,Pp=2,AI=(e,t)=>{P(e,Cc);const n=AC(t);Nt(e,n)},Dp=(e,t,n)=>{P(e,Up),Nt(e,_C(t,n))},wI=(e,t,n)=>Dp(t,n,kt(e)),Fp=(e,t,n)=>{try{gC(t,kt(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},vI=(e,t)=>{P(e,Pp),Nt(e,t)},RI=Fp,NI=(e,t,n,r)=>{const s=D(e);switch(s){case Cc:wI(e,t,n);break;case Up:Fp(e,n,r);break;case Pp:RI(e,n,r);break;default:throw new Error("Unknown message type")}return s},Sr={},Ic={},Lc={},ws={},Me=Rr("shared",["second"],e=>{switch(e.target){case"second":Object.keys(Lc).forEach(t=>{const n=ws[t];n===void 0?Me.emit("shared:join",t):n<10?ws[t]=n+1:delete ws[t]}),Object.keys(Ic).forEach(t=>{Me.emit("shared:active",t)});break;case"join":{const t=e.data,n=Sr[t];if(n&&Ic[t]){Me.reply(e,"joinack",t);const r=fn();AI(r,n),Me.reply(e,"sync",to(t,r));const s=fn();Dp(s,n),Me.reply(e,"sync",to(t,s))}break}case"joinack":{const t=e.data;Sr[t]&&Lc[t]&&(ws[t]=0);break}case"active":{const t=e.data;Sr[t]&&Lc[t]&&(ws[t]=0);break}case"sync":{const[t,n,r]=e.data,s=Sr[n];if(s&&t!==Me.id()){const i=Dn(r),o=fn();if(NI(i,o,s,Me)===Cc){const c=to(n,o);Me.emit("shared:sync",c)}}break}}});function CI(e){let t=Sr[e];if(t)return t;Sr[e]=t=new dr({guid:e});function n(r){const s=fn();vI(s,r),Me.emit("shared:sync",to(e,s))}return t.on("update",n),t.on("destroy",()=>{t==null||t.off("update",n)}),t}function Zi(e){return CI(e).getMap()}function to(e,t){const n=pe(t);return[Me.id()??"",e,n]}function $p(e,t){const n=e.get(t);return n!=null&&n.toJSON?n.toJSON():n}function Bp(e,t,n){typeof n=="string"?e.set(t,new $n(n)):e.set(t,n)}function II(e,t,n){console.info({guid:e,key:t,value:n}),Ic[e]=!0;const r=Zi(e);r.get(t)===void 0&&n!==void 0&&Bp(r,t,n)}function LI(e,t,n){const r=Zi(e),s=$p(r,t);(s===void 0||n!==s)&&Bp(r,t,n)}function OI(e,t,n){const r=Zi(e);function s(){n($p(r,t))}function i(o){o.keysChanged.has(t)&&s()}return s(),r.observe(i),()=>{r.unobserve(i)}}function bI(e,t,n){const r=Zi(e);let s=r.get(t);function i(){n(s)}function o(c){c.keysChanged.has(t)&&s===void 0&&a(),s&&r.unobserve(o)}function a(){s=r.get(t),s?(s.observeDeep(i),i()):r.observe(o)}return a(),()=>{s?s.unobserveDeep(i):r.unobserve(o)}}const En={};function Gp(e,t){return e.player=t,e.layers=[],e.layout=[],e.layoutreset=!0,e.layoutfocus="scroll",e}function Kp(e){e.text=[],Object.values(En[e.id]??{}).forEach(t=>t==null?void 0:t()),En[e.id]={}}function Wp(e){const t=e.layout.find(n=>n.name===e.layoutfocus);if(!t){const n={id:Pe(),name:e.layoutfocus,edge:Yt.RIGHT,size:20,text:[]};return e.layout.push(n),e.layoutreset=!1,n}return t}const Oc={},kI=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),MI=new Set(["rn","range","sl","select","nm","number","tx","text"]),xI=new Set(["tx","text"]),UI={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""};function Wn(e){let t=Oc[e];return _(t)?t:Oc[e]=t=Gp({},e)}function PI(){return Object.keys(Oc)}function DI(e){const t=Wn(e);t.layout=t.layout.filter(n=>n.edge!==Yt.SCROLL)}function FI(e,t,n){Object.values(En).forEach(r=>{r[t]!==void 0&&LI(e.id(),t,n)})}function $I(e){const t=Wn(e.id());t.layout=t.layout.filter(n=>n.edge!==Yt.SCROLL||n.text.length>0)}function bc(e,t,n,r,s){const i=Wn(e.id()),o=r,a=s||ZR.capital(t),c=i.layout.find(l=>l.name===a);if(c)i.layoutreset=!0,i.layoutfocus=a,Ft(o)&&(c.size=o);else switch(n){case Yt.START:Gp(i,e.id());break;case Yt.LEFT:case Yt.RIGHT:case Yt.TOP:case Yt.BOTTOM:case Yt.SCROLL:{const l={id:Pe(),name:a,edge:n,size:o??Ng[n],text:[]};i.layout.push(l),i.layoutfocus=a;break}}}function BI(e,t){const n=Wn(e.id()),r=Wp(n);n.layoutreset&&(n.layoutreset=!1,Kp(r)),r.text.push(t)}function GI(e,t,n,r){const s=Wn(e.id()),i=Wp(s);s.layoutreset&&(s.layoutreset=!1,Kp(i));const o=n.toLowerCase(),a=[e.id(),t,...kI.has(o)?[o]:["hypertext",n],...r],c=a[2];if(MI.has(c)){const l=`${a[3]??""}`;En[i.id]=En[i.id]??{};const u=e.get(l);En[i.id][l]===void 0&&(II(e.id(),l,u??UI[c]),xI.has(c)?En[i.id][l]=bI(e.id(),l,h=>{if(h!==void 0){const d=h.toJSON();d!==e.get(l)&&e.set(l,d)}}):En[i.id][l]=OI(e.id(),l,h=>{h!==void 0&&h!==e.get(l)&&e.set(l,h)}))}i.text.push(a)}const KI=md({get(){return[!1,void 0]},set(e,t,n){return FI(e,t,n),[!1,void 0]},shouldtick(){},tick(e){var r,s;const t=Y(e.id()),n=((r=t.target)==null?void 0:r.name)??((s=t.target)==null?void 0:s.kind)??"Scroll";bc(e,"scroll",Yt.SCROLL,void 0,n)},tock(e){$I(e)}}).command("color",(e,t)=>{const n=Y(e.id()),[r]=I({...n,chip:e,words:t},0,[C.COLOR]);return _(n.target)&&_(r)&&So(n.target,r),0}).command("gadget",(e,t)=>{const r={...Y(e.id()),chip:e,words:t},[s]=I(r,0,[C.STRING]),i=Rg[s.toLowerCase()];if(i===Yt.SCROLL){const[,o,a]=I(r,0,[C.STRING,C.MAYBE_STRING,C.MAYBE_NUMBER]);bc(e,s,i,a,o)}else{const[,o,a]=I(r,0,[C.STRING,C.MAYBE_NUMBER,C.MAYBE_STRING]);bc(e,s,i,o,a)}return 0}).command("book",(e,t)=>{const n=Y(e.id()),[r,s]=I({...n,chip:e,words:t},0,[C.STRING,C.STRING]),i=r.toLowerCase(),o=s.toLowerCase();switch(o){case"create":sf(zh(i,[Zt("@board title",{board:tl(a=>a)}),Zt("@terrain dirt",{terrain:{char:176,bg:H.BLACK,color:H.DKYELLOW,collision:at.WALK}}),Zt("@terrain dirt2",{terrain:{char:176,bg:H.BLACK,color:H.DKGRAY,collision:at.WALK}}),Zt("@terrain wall",{terrain:{char:177,bg:H.DKGREEN,color:H.GREEN,collision:at.SOLID}}),Zt("@terrain wall2",{terrain:{char:176,bg:H.DKGREEN,color:H.GREEN,collision:at.SOLID}})]));break;default:console.info("book",{ltarget:i,laction:o});break}return 0}).command("frame",(e,t)=>{var c;const n=Y(e.id()),[r,s,i]=I({...n,chip:e,words:t},0,[C.STRING,C.MAYBE_STRING,C.MAYBE_STRING]),o=((c=n.board)==null?void 0:c.id)??"",a=r.toLowerCase();if(a==="reset")rf(o);else if(_(s)&&_(i)){const l=s.toLowerCase();switch(l){case"edit":Iv(o,a,i);break;case"view":Cv(o,a,i);break;default:console.info("frame",{ltype:l,ltarget:a,maybeboard:i});break}}return 0});function WI(e,t){if(!(!_(e)||!_(t))){_(e.stats)||(e.stats={});for(const[n,r]of Object.entries(t)){const s=n.toLowerCase();e.stats[s]=r}}}function eo(e,t,n,r){if(_(e)&&_(t)&&_(n)){const[s,i]=n,o=qh(e,s);if(_(o)){const c=cm(t,r.x,r.y,s);return So(c,i),Zh(e,t,c),Qh(e,t,c,r.x+r.y*t.width),c}const a=Oa(e,s);if(_(a)&&_(a.name)){const c=lm(t,r.x,r.y,s);return So(c,i),Zh(e,t,c),Qh(e,t,c),c}}}const jp=new Set(["cycle","player","sender","inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu","data"]),jI=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]);function HI(e){const t=lf[e];if(_(t))return t;const n=df[e];if(_(n))return n;const r=gf[e];if(_(r))return r;const s=Nf[e];if(_(s))return s}const VI=["NORTH","SOUTH","WEST","EAST"];function YI(e){const t=Y(e.id??"");if(t.inputcurrent!==void 0)return;const[n=lt.NONE]=t.inputqueue;e.stats===void 0&&(e.stats={}),e.stats.inputmove=[],e.stats.inputok=0,e.stats.inputcancel=0,e.stats.inputmenu=0;const r=t.inputmods[n];switch(e.stats.inputalt=r&Cg?1:0,e.stats.inputctrl=r&Ig?1:0,e.stats.inputshift=r&Lg?1:0,n){case lt.MOVE_UP:case lt.MOVE_DOWN:case lt.MOVE_LEFT:case lt.MOVE_RIGHT:e.stats.inputmove=[VI[n-lt.MOVE_UP]];break;case lt.OK_BUTTON:e.stats.inputok=1;break;case lt.CANCEL_BUTTON:e.stats.inputcancel=1;break;case lt.MENU_BUTTON:e.stats.inputmenu=1;break}t.inputcurrent=n,t.inputqueue.delete(n)}function no(e,t,n,r){const s=ut(t)?t:t.id,i=ut(n)?n:n.id;_(s)&&_(i)&&e.send(i,r,s)}function Hp(e,t,n,r,s){const i=Av(t,n,r,s);return _(i)&&(r.kind==="player"?(no(e,i,e.id(),"thud"),no(e,e.id(),i,"touch")):(no(e,i,e.id(),"thud"),no(e,e.id(),i,"bump"))),!_(i)}function kc(e,t){if(ut(e)){const n=e.toLowerCase();switch(n){case"edit":return[n,t+1]}}return[void 0,t]}function Vp(e,t,n){let r;const s=mi((t==null?void 0:t.id)??"");switch(n){case"edit":{r=s.find(a=>a.type===Zr.EDIT);break}}const i=r?ts((r==null?void 0:r.book)??""):e,o=r?rr(i,(r==null?void 0:r.board)??""):t;return{maybebook:i,maybeboard:o}}const zI={zzt:md({get(e,t){var o;const n=HI(t);if(_(n))return[!0,n];const r=Y(e.id());if(r.target){jI.has(t)&&YI(r.target);const a=(o=r.target.stats)==null?void 0:o[t];if(_(a)||jp.has(t))return[!0,a]}const s=r.board?Ro(r.board,r.target):void 0,i=_v(r.book,(s==null?void 0:s.id)??"",t);return[_(i),i]},set(e,t,n){var i,o;const r=Y(e.id());if(_(r.target)&&(_((o=(i=r.target)==null?void 0:i.stats)==null?void 0:o[t])||jp.has(t)))return r.target.stats||(r.target.stats={}),r.target.stats[t]=n,[!0,n];const s=r.board?Ro(r.board,r.target):void 0;return yv(r.book,(s==null?void 0:s.id)??"",t,n),[!0,n]},shouldtick(e){var n,r,s,i;const t=Y(e.id());if((r=(n=t.target)==null?void 0:n.stats)!=null&&r.stepx||(i=(s=t.target)==null?void 0:s.stats)!=null&&i.stepy){const o={x:(t.target.x??0)+(t.target.stats.stepx??0),y:(t.target.y??0)+(t.target.stats.stepy??0)};Hp(e,t.book,t.board,t.target,o)}},tick(){},tock(){}}).command("become",(e,t)=>{var i,o;const n=Y(e.id()),r={x:((i=n.target)==null?void 0:i.x)??0,y:((o=n.target)==null?void 0:o.y)??0},[s]=I({...n,chip:e,words:t},0,[C.KIND]);return Qr(n.book,n.board),tf(n.book,n.board,n.target),ba(n.book,n.target,e.timestamp())&&eo(n.book,n.board,s,r),e.endofprogram(),0}).command("bind",(e,t)=>(console.info(t),0)).command("change",(e,t)=>{const n=Y(e.id()),[r,s]=kc(t[0],0),[i,o]=I({...n,chip:e,words:t},s,[C.KIND,C.KIND]),{maybebook:a,maybeboard:c}=Vp(n.book,n.board,r);Qr(a,c);const l=Ma(i)??"",u=yo(c,l),h=Zg(u,i),d=Ma(o),f=vf(o),p=Rf(o);return h.forEach(E=>{if(sr(a,E)===d)_(f)&&(E.color=f),_(p)&&(E.bg=p);else{if(_(E.id))switch(tf(a,c,E),r){case"edit":if(!vo(c,E.id))return;break;default:if(!ba(a,E,e.timestamp()))return;break}Ye(E)&&eo(a,c,o,E)}}),0}).command("char",(e,t)=>{const n=Y(e.id()),[r]=I({...n,chip:e,words:t},0,[C.NUMBER]);return _(n.target)&&(n.target.char=r),0}).command("clear",(e,t)=>{const n=qe(t[0]);return e.set(n,void 0),0}).command("cycle",(e,t)=>{const n=Y(e.id()),[r]=I({...n,chip:e,words:t},0,[C.NUMBER]);return e.cycle(ao(Math.round(r),1,255)),0}).command("die",e=>{const t=Y(e.id());return ba(t.book,t.target,e.timestamp()),e.endofprogram(),0}).command("end",e=>(e.endofprogram(),0)).command("endgame",e=>(e.set("health",0),0)).command("give",(e,t)=>{const n=Y(e.id()),[r,s,i]=I({...n,chip:e,words:t},0,[C.STRING,C.MAYBE_NUMBER]),o=e.get(r),a=Ft(o)?o:0,c=s??1;if(!Ft(c))return 0;const l=o===void 0?1:0;return l&&i<t.length&&e.command(...t.slice(i)),e.set(r,a+c),l}).command("go",(e,t)=>{const n=Y(e.id());if(!_(n.target))return 0;let r=0,s=1;const[i,o]=vt({...n,chip:e,words:t},0);for(Ft(i)&&(r=o,s=ao(Math.round(i),1,1024));s>0;){const[l]=I({...n,chip:e,words:t},r,[C.DIR]);Hp(e,n.book,n.board,n.target,l)?--s:s=-1}const a=n.target.x,c=n.target.y;return n.target.x===a&&n.target.y===c?1:0}).command("idle",e=>(e.yield(),0)).command("lock",e=>(e.lock(e.id()),0)).command("play",(e,t)=>(console.info({chip:e,play:t}),0)).command("put",(e,t)=>{const n=Y(e.id()),[r,s]=kc(t[0],0),[i,o]=I({...n,chip:e,words:t},s,[C.DIR,C.KIND]),{maybebook:a,maybeboard:c}=Vp(n.book,n.board,r);return Qr(a,c),eo(a,c,o,i),0}).command("restore",(e,t)=>(e.restore(qe(t[0])),0)).command("send",(e,t)=>{var h,d;const n=Y(e.id()),[r,s]=I({...n,chip:e,words:t},0,[C.STRING,C.ANY]),[i,o]=r.split(":"),a=_(o)?i:"self",c=o??i;function l(f){f.forEach(p=>{_(p.id)&&e.send(p.id,c,s)})}const u=a.toLowerCase();switch(u){case"all":for(const f of Object.keys(((h=n.board)==null?void 0:h.objects)??{}))e.send(f,c,s);break;case"self":e.send(e.id(),c,s);break;case"others":for(const f of Object.keys(((d=n.board)==null?void 0:d.objects)??{}))f!==e.id()&&e.send(f,c,s);break;case"player":break;default:{l(To(n.board,[a]));const f=e.get(u);Array.isArray(f)?l(To(n.board,f)):l(To(n.board,[f]));break}}return 0}).command("set",(e,t)=>{const n=Y(e.id()),[r,s]=I({...n,chip:e,words:t},0,[C.STRING,C.ANY]);return e.set(r,s),0}).command("shoot",(e,t)=>{const n=Y(e.id());if(!Ye(n.target))return 0;const[r,s]=kc(t[0],0),[i,o]=I({...n,chip:e,words:t},s,[C.DIR,C.MAYBE_KIND]),a=bn(n.target,i),c=de({x:0,y:0},a),l=de({x:n.target.x,y:n.target.y},a);let u=rm(n.board,l);if(_(u)&&!_(u.id)){const h=He(n.book,n.target),d=He(n.book,u);Jc(u.collision??(h==null?void 0:h.collision),u.collision??(d==null?void 0:d.collision))||(u=void 0)}if(_(u))console.info(u);else{Qr(n.book,n.board);const h=eo(n.book,n.board,o??["bullet"],l);WI(h,{stepx:c.x,stepy:c.y})}return e.yield(),0}).command("take",(e,t)=>{const n=Y(e.id()),[r,s,i]=I({...n,chip:e,words:t},0,[C.STRING,C.MAYBE_NUMBER]),o=e.get(r),a=s??1;if(!Ft(o))return 1;const c=o-a;return c<0?(i<t.length&&e.command(...t.slice(i)),1):(e.set(r,c),0)}).command("throwstar",(e,t)=>{const n=Y(e.id());return I({...n,chip:e,words:t},0,[C.DIR,C.MAYBE_KIND]),0}).command("try",(e,t)=>{const n=Y(e.id()),[,r]=I({...n,chip:e,words:t},0,[C.DIR]);return e.command("go",...t.slice(0,r))&&r<t.length&&e.command(...t.slice(r)),e.yield(),0}).command("unlock",e=>(e.unlock(),0)).command("walk",(e,t)=>{var s;const n=Y(e.id()),[r]=I({...n,chip:e,words:t},0,[C.DIR]);return _((s=n.target)==null?void 0:s.stats)&&(n.target.stats.stepx=r.x-(n.target.x??0),n.target.stats.stepy=r.y-(n.target.y??0)),0}).command("zap",(e,t)=>(e.zap(qe(t[0])),0)).command("stat",(e,t)=>{const n=Y(e.id());return n.target&&(n.target.name=t.map(qe).join(" ")),0}).command("text",(e,t)=>{const n=t.map(qe).join("");return BI(e,n),0}).command("hyperlink",(e,t)=>{const[n,r,...s]=t,i=qe(n),o=qe(r);return GI(e,i,o,s),0}),zss:KI};function qI(e){Object.values(zI).forEach(t=>{e.install(t)})}function Mc(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset||0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];Array.isArray(r)?r.forEach(s=>{t.push(Mc(s))}):t.push(Mc(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)||0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)||0))},e.range}function XI(e){const t=Ca(`${e}
`);if(t.errors.length>0)return{errors:t.errors,tokens:[]};as.input=t.tokens;const n=as.program();if(as.errors.length>0)return{tokens:t.tokens,errors:as.errors};const r=KR.visit(n);return r?(Mc(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:["no ast output"]}}const xc=Object.getPrototypeOf(function*(){}).constructor;function JI(e){const t=XI(e);if(t.errors&&t.errors.length>0)return t;if(!t.ast)return{...t,errors:["no ast output"]};const n=zR(t.ast);if(n.code){lv&&console.info(n.code);try{return{...t,...n,source:n.code,code:new xc("api",n.code)}}catch(r){return{errors:[{message:r.message}],source:"there was an error",code:new xc("api"," ")}}}return{...t,...n,source:"there was an error",code:new xc("api"," ")}}function QI(){const e={},t={};function n(s){const i=e[s];if(i)return i;const o=JI(s);return e[s]=o,o}return{ids(){return Object.keys(t)},has(s){return _(t[s])},halt(s){const i=t[s];return i&&delete t[s],!!i},tick(s,i,o){var c;let a=t[s];if(!_(t[s])){const l=n(o);if((c=l.errors)!=null&&c.length)return console.error(l.errors),console.info(l.tokens),t[s]=null,!1;a=t[s]=JR(s,l),qI(a)}return!!(a!=null&&a.tick(i))},message(s){const{target:i,path:o}=Gc(s.target),a=t[i];_(a)&&a.message({...s,target:o})}}}const ZI=Bc(oo.numbers,4),tL=Bc(`${oo.numbers}${oo.lowercase}`,16),Yp=`pid_${ZI()}_${tL()}`;Nv(Yp);const zp=QI(),eL=32*15,Ar={},nL=Rr("vm",["login","tick","tock"],e=>{switch(e.target){case"login":e.player&&(Ar[e.player]=0,Lv(e.player));break;case"tick":bv(zp,e.data);break;case"tock":Object.keys(Ar).forEach(t=>{++Ar[t],Ar[t]>eL&&(delete Ar[t],Ov(t))});break;case"doot":e.player&&(Ar[e.player]=0);break;case"input":if(e.player){const t=Y(e.player),[n=lt.NONE,r=0]=e.data??{};t.inputqueue.add(n),t.inputmods[n]=r}break;default:zp.message(e);break}});function rL(){sf(Ti),nL.emit("ready",void 0,Yp)}const Uc=Rr("clock",[],()=>{});let Pc=0,qp=performance.now(),Dc=0,ro=0;function sL(){Uc.emit("tick",ro),Uc.emit("tock",ro),++Dc,++ro,Dc>=Co&&(Dc%=Co,Uc.emit("second",ro))}function Xp(){const e=performance.now(),t=e-qp;Pc+=t,Pc>=No&&(Pc%=No,sL()),qp=e,setTimeout(Xp)}Xp();const Jp={},Qp=Rr("gadgetserver",["tock"],e=>{switch(e.target){case"tock":PI().forEach(t=>{const n=Wn(t);n.layers=Mv(t);const r=Eo(Jp[t]??{},n);r.length&&(Jp[t]=It(n),Qp.emit("gadgetclient:patch",r,t))});break;case"desync":if(e.player){const t=Wn(e.player);Qp.emit("gadgetclient:reset",t,e.player)}break;case"clearscroll":e.player&&DI(e.player);break}}),iL=hg(e=>postMessage(e));onmessage=function(t){iL(t.data)},queueMicrotask(rL)})();

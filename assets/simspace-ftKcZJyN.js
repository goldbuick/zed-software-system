(function(){"use strict";const Wu=new Set,Go={emit(t,e,r,n,i){Go.invoke(zT(t,e,r,n,i))},invoke(t){Wu.forEach(e=>e.handle(t))},connect(t){Wu.add(t)},disconnect(t){Wu.delete(t)}};var Ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function js(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function cT(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var ac={exports:{}},lT=ac.exports,Q0;function uT(){return Q0||(Q0=1,(function(t,e){(function(r,n){t.exports=n()})(lT,function(){return r.importState=function(i){var s=new r;return s.importState(i),s},r;function r(){return(function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=n();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h})(Array.prototype.slice.call(arguments))}function n(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(ac)),ac.exports}var fT=uT(),em=js(fT),Ko={},tm;function hT(){return tm||(tm=1,(function(t){var e=Ko&&Ko.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,m;d<f;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function r(l){return l[Math.floor(Math.random()*l.length)]}function n(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,g=l.addAdverb,y=g===void 0?!1:g,b=e(e(e([],e([],Array(p),!0).map(function(A){return r(t.adjectives)}),!0),[r(t.nouns),r(t.verbs)],!1),y?[r(t.adverbs)]:[],!0);return f&&(b=b.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),b.join(h)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return n(t.adjectives).length*h+h*p.length+n(t.nouns).length+p.length+n(t.verbs).length+(f?n(t.adverbs).length+p.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(t.adjectives).length*h+h*p.length+i(t.nouns).length+p.length+i(t.verbs).length+(f?i(t.adverbs).length+p.length:0)}t.minLength=c,t.default=s})(Ko)),Ko}var dT=hT(),rm=js(dT);const pT="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let mT=t=>crypto.getRandomValues(new Uint8Array(t)),gT=(t,e,r)=>{let n=(2<<Math.log2(t.length-1))-1,i=-~(1.6*n*e/t.length);return(s=e)=>{let o="";for(;;){let a=r(i),c=i|0;for(;c--;)if(o+=t[a[c]&n]||"",o.length>=s)return o}}},nm=(t,e=21)=>gT(t,e|0,mT),yT=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=pT[r[t]&63];return e};var Hu,im;function sm(){return im||(im=1,Hu="abcdefghijklmnopqrstuvwxyz"),Hu}var Gu,om;function am(){return om||(om=1,Gu="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),Gu}var Ku,cm;function lm(){return cm||(cm=1,Ku="0123456789"),Ku}var qu,um;function _T(){return um||(um=1,qu="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz"),qu}var Yu,fm;function bT(){return fm||(fm=1,Yu="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz"),Yu}var Vu,hm;function wT(){if(hm)return Vu;hm=1;const t=lm(),e=sm(),r=am();return Vu=t+e+r,Vu}var Xu,dm;function vT(){return dm||(dm=1,Xu={lowercase:sm(),uppercase:am(),numbers:lm(),nolookalikes:_T(),nolookalikesSafe:bT(),alphanumeric:wT()}),Xu}var Zu=vT();function Ft(){return`sid_${yT(12).replaceAll("-",".")}`}nm(Zu.numbers,4),nm(`${Zu.numbers}${Zu.lowercase}`,16);function gr(t){return t?.startsWith("pid_")??!1}function ET(){return rm({capitalize:!1,adjectiveCount:1})}function kT(){return rm({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var xT=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),AT=Object.prototype.hasOwnProperty;function Ju(t,e){return AT.call(t,e)}function Qu(t){if(Array.isArray(t)){for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=""+r;return e}if(Object.keys)return Object.keys(t);var n=[];for(var i in t)Ju(t,i)&&n.push(i);return n}function Lr(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function ef(t){for(var e=0,r=t.length,n;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function rs(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function pm(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function tf(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,r=t.length;e<r;e++)if(tf(t[e]))return!0}else if(typeof t=="object"){for(var n=Qu(t),i=n.length,s=0;s<i;s++)if(tf(t[n[s]]))return!0}}return!1}function mm(t,e){var r=[t];for(var n in e){var i=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof i<"u"&&r.push(n+": "+i)}return r.join(`
`)}var gm=(function(t){xT(e,t);function e(r,n,i,s,o){var a=this.constructor,c=t.call(this,mm(r,{name:n,index:i,operation:s,tree:o}))||this;return c.name=n,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=mm(r,{name:n,index:i,operation:s,tree:o}),c}return e})(Error),Nt=gm,TT=Lr,zs={add:function(t,e,r){return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){var n=cc(r,this.path);n&&(n=Lr(n));var i=ns(r,{op:"remove",path:this.from}).removed;return ns(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(t,e,r){var n=cc(r,this.from);return ns(r,{op:"add",path:this.path,value:Lr(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:qo(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}},ST={add:function(t,e,r){return ef(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:zs.move,copy:zs.copy,test:zs.test,_get:zs._get};function cc(t,e){if(e=="")return t;var r={op:"_get",path:e};return ns(t,r),r.value}function ns(t,e,r,n,i,s){if(r===void 0&&(r=!1),n===void 0&&(n=!0),i===void 0&&(i=!0),s===void 0&&(s=0),r&&(typeof r=="function"?r(e,0,t,e.path):lc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=cc(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=qo(t,e.value),o.test===!1)throw new Nt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(r)throw new Nt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{n||(t=Lr(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,d=void 0,f=void 0,m=void 0;for(typeof r=="function"?m=r:m=lc;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=pm(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&m(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(r&&!ef(f))throw new Nt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);ef(f)&&(f=~~f)}if(u>=h){if(r&&e.op==="add"&&f>l.length)throw new Nt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=ST[e.op].call(e,l,f,t);if(o.test===!1)throw new Nt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=h){var o=zs[e.op].call(e,l,f,t);if(o.test===!1)throw new Nt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[f],r&&u<h&&(!l||typeof l!="object"))throw new Nt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function rf(t,e,r,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!0),r&&!Array.isArray(e))throw new Nt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=Lr(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=ns(t,e[o],r,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function RT(t,e,r){var n=ns(t,e);if(n.test===!1)throw new Nt("Test operation failed","TEST_OPERATION_FAILED",r,e,t);return n.newDocument}function lc(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new Nt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(zs[t.op]){if(typeof t.path!="string")throw new Nt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Nt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Nt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Nt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&tf(t.value))throw new Nt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var i=t.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new Nt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new Nt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=ym([o],r);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Nt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new Nt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function ym(t,e,r){try{if(!Array.isArray(t))throw new Nt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)rf(Lr(e),Lr(t),r||!0);else{r=r||lc;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(i){if(i instanceof Nt)return i;throw i}}function qo(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),i,s,o;if(r&&n){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!qo(t[i],e[i]))return!1;return!0}if(r!=n)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!qo(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var OT=Object.freeze({__proto__:null,JsonPatchError:Nt,_areEquals:qo,applyOperation:ns,applyPatch:rf,applyReducer:RT,deepClone:TT,getValueByPointer:cc,validate:ym,validator:lc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var nf=new WeakMap,IT=(function(){function t(e){this.observers=new Map,this.obj=e}return t})(),NT=(function(){function t(e,r){this.callback=e,this.observer=r}return t})();function CT(t){return nf.get(t)}function LT(t,e){return t.observers.get(e)}function MT(t,e){t.observers.delete(e.callback)}function UT(t,e){e.unobserve()}function FT(t,e){var r=[],n,i=CT(t);if(!i)i=new IT(t),nf.set(t,i);else{var s=LT(i,e);n=s&&s.observer}if(n)return n;if(n={},i.value=Lr(t),e){n.callback=e,n.next=null;var o=function(){sf(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=r,n.object=t,n.unobserve=function(){sf(n),clearTimeout(n.next),MT(i,n),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new NT(e,n)),n}function sf(t,e){e===void 0&&(e=!1);var r=nf.get(t.object);of(r.value,t.object,t.patches,"",e),t.patches.length&&rf(r.value,t.patches);var n=t.patches;return n.length>0&&(t.patches=[],t.callback&&t.callback(n)),n}function of(t,e,r,n,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Qu(e),o=Qu(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(Ju(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?of(u,h,r,n+"/"+rs(l),i):u!==h&&(i&&r.push({op:"test",path:n+"/"+rs(l),value:Lr(u)}),r.push({op:"replace",path:n+"/"+rs(l),value:Lr(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&r.push({op:"test",path:n+"/"+rs(l),value:Lr(u)}),r.push({op:"remove",path:n+"/"+rs(l)}),a=!0):(i&&r.push({op:"test",path:n,value:t}),r.push({op:"replace",path:n,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Ju(t,l)&&e[l]!==void 0&&r.push({op:"add",path:n+"/"+rs(l),value:Lr(e[l])})}}}function _m(t,e,r){r===void 0&&(r=!1);var n=[];return of(t,e,n,"",r),n}var PT=Object.freeze({__proto__:null,compare:_m,generate:sf,observe:FT,unobserve:UT});Object.assign({},OT,PT,{JsonPatchError:gm,deepClone:Lr,escapePathComponent:rs,unescapePathComponent:pm});var af,bm;function BT(){if(bm)return af;bm=1;var t=typeof Element<"u",e=typeof Map=="function",r=typeof Set=="function",n=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function i(s,o){if(s===o)return!0;if(s&&o&&typeof s=="object"&&typeof o=="object"){if(s.constructor!==o.constructor)return!1;var a,c,l;if(Array.isArray(s)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(!i(s[c],o[c]))return!1;return!0}var u;if(e&&s instanceof Map&&o instanceof Map){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;for(u=s.entries();!(c=u.next()).done;)if(!i(c.value[1],o.get(c.value[0])))return!1;return!0}if(r&&s instanceof Set&&o instanceof Set){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;return!0}if(n&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(o)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(s[c]!==o[c])return!1;return!0}if(s.constructor===RegExp)return s.source===o.source&&s.flags===o.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof o.valueOf=="function")return s.valueOf()===o.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof o.toString=="function")return s.toString()===o.toString();if(l=Object.keys(s),a=l.length,a!==Object.keys(o).length)return!1;for(c=a;c--!==0;)if(!Object.prototype.hasOwnProperty.call(o,l[c]))return!1;if(t&&s instanceof Element)return!1;for(c=a;c--!==0;)if(!((l[c]==="_owner"||l[c]==="__v"||l[c]==="__o")&&s.$$typeof)&&!i(s[l[c]],o[l[c]]))return!1;return!0}return s!==s&&o!==o}return af=function(o,a){try{return i(o,a)}catch(c){if((c.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw c}},af}var $T=BT(),DT=js($T);function v(t){return t!=null}const Mr=Object.keys;function xn(t){return Lr(t)}function jT(t){return typeof t=="boolean"}function Te(t){return typeof t=="number"&&isNaN(t)===!1}function be(t){return typeof t=="string"}function ut(t){return Array.isArray(t)}function cf(t){return t}var Ke=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Ke||{}),We=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t[t.ISGHOST=4]="ISGHOST",t))(We||{}),Ur=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Ur||{}),Ee=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.FIND=18]="FIND",t[t.FLEE=19]="FLEE",t[t.TO=20]="TO",t[t.MID=21]="MID",t[t.OVER=22]="OVER",t[t.UNDER=23]="UNDER",t[t.WITHIN=24]="WITHIN",t[t.AWAYBY=25]="AWAYBY",t))(Ee||{}),Fe=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.VIEWIT=14]="VIEWIT",t[t.ZSSEDIT=15]="ZSSEDIT",t[t.CHAREDIT=16]="CHAREDIT",t[t.COLOREDIT=17]="COLOREDIT",t))(Fe||{});function $e(t){return be(t)?t.toLowerCase().trim():""}function zT(t,e,r,n,i){return{session:t,player:e,id:Ft(),sender:r,target:n,data:i}}function Fr(t){const[e,...r]=t.split(":");return{target:e,path:r.join(":")}}function Ws(t,e=[],r=cf,n=""){const i=Ft(),s=$e(t),o=e.map($e);let a=n;const c={id(){return i},name(){return t},session(l){return v(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,h){Go.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=Fr(l.target),d=$e(u);!a&&d==="ready"&&(a=l.session),d==="session_reset"&&(a=""),o.findIndex(f=>f==="all"||f===d)!==-1&&r(l),(i===u||d==="all"||s===d)&&r({...l,target:h})}};return Go.connect(c),c}function WT(t){return typeof t=="object"&&be(t.session)&&be(t.player)&&be(t.id)&&be(t.sender)&&be(t.target)}function mt(t,e,r,...n){return t.emit(e,"error",[`$red${r}$blue>>`,...n]),!1}function HT(t,e,...r){return t.emit(e,"info",r),!0}function Pt(t,e,...r){return t.emit(e,"log",r),!0}function GT(t,e,...r){return t.emit(e,"chat",r),!0}function Yo(t,e,r){t.emit(e,"toast",r)}function KT(t,e,r){t.emit(e,"bridge:streamstart",r)}function qT(t,e){t.emit(e,"bridge:streamstop",void 0)}function YT(t,e,r){t.emit(e,"bridge:chatstart",r)}function VT(t,e){t.emit(e,"bridge:chatstop")}function XT(t,e,r,n,i,s,o){t.emit(e,"bridge:fetch",[r,n,i,s,o])}function ZT(t,e,r){t.emit(e,"bridge:start",r)}function JT(t,e,r){t.emit(e,"bridge:tab",r)}function QT(t,e,r){t.emit(e,"gadgetclient:paint",r)}function eS(t,e,r){t.emit(e,"gadgetclient:patch",r)}function tS(t,e){t.emit(e,"gadgetserver:clearscroll")}function rS(t,e){t.emit(e,"gadgetserver:clearplayer")}function nS(t){t.emit("","ready")}function wm(t,e){t.emit(e,"register:loginfail")}function lf(t,e){t.emit(e,"register:loginready",!0)}function iS(t,e,r,n){t.emit(e,"register:savemem",[r,n])}function sS(t,e,r){t.emit(e,"register:forkmem",[r])}function oS(t,e,r,n){t.emit(e,"register:itchiopublishmem",[r,n])}function uf(t,e,r){t.emit(e,"register:copy",r)}function aS(t,e,r,n){t.emit(e,"register:copyjsonfile",[r,n])}function vm(t,e,r,n){t.emit(e,"register:downloadjsonfile",[r,n])}function cS(t,e){t.emit(e,"register:dev",void 0)}function lS(t,e){t.emit(e,"register:share",void 0)}function uS(t,e){t.emit(e,"register:nuke",void 0)}function fS(t,e){t.emit(e,"register:enterar",void 0)}function hS(t,e,r,n){t.emit(e,"synth:tts",[r,n])}function dS(t,e,r,n){t.emit(e,"synth:ttsqueue",[r,n])}function pS(t,e,r,n){t.emit(e,"synth:play",[r,n])}function mS(t,e,r,n,i){t.emit(e,"synth:bgplay",[r,n,i])}function gS(t,e,r){t.emit(e,"synth:bpm",r)}function yS(t,e,r){t.emit(e,"synth:playvolume",r)}function _S(t,e,r){t.emit(e,"synth:bgplayvolume",r)}function bS(t,e,r){t.emit(e,"synth:ttsvolume",r)}function ff(t,e,r,n,i){t.emit(e,"synth:voice",[r,n,i])}function Em(t,e,r,n,i,s){t.emit(e,"synth:voicefx",[r,n,i,s])}function wS(t,e,r){t.emit(e,"synth:record",r)}function vS(t,e){t.emit(e,"synth:flush",filename)}function km(t,e,r,n){t.emit(e,"register:config",[r,n])}function ES(t,e){t.emit(e,"register:configshow")}function kS(t,e){t.emit(e,"register:inspector")}function xS(t,e){t.emit(e,"register:terminal:full")}function xm(t,e,r,n,i,s){t.emit(e,"register:editor:open",[r,n,i,s])}function AS(t,e,r,n){t.emit(e,"vm:zztsearch",[r,n])}function TS(t,e){t.emit(e,"vm:zztrandom")}function SS(t,e){t.emit(e,"vm:local")}function hf(t,e){t.emit(e,"vm:logout")}function Am(t,e,r,n,i){t.emit(e,"vm:touched",[r,n,i])}function RS(t,e){t.emit(e,"vm:readzipfilelist")}function uc(t,e){const[r,n]=e;return`${t}:${[r,n].filter(v).join(":")}`}function OS(t,e,r){t.emit(e,"vm:cli",r)}function IS(t,e){t.emit(e,"vm:restart")}function Tm(t,e){t.emit(e,"vm:flush")}function NS(t,e){t.emit(e,"vm:fork")}function CS(t,e){t.emit(e,"vm:itchiopublish")}function LS(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function MS(t,e){return{filename:t,json:e}}function US(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function df(t,e,r,n,i,s){let o;switch(n){case"file":o=s;break;case"text":o=LS(i,s);break;case"json":o=MS(i,s);break;case"binary":o=US(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[r,n,i,o])},1)}function FS(t){const e=new Set;function r(s){WT(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Go.invoke(s))}const n=Ws("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Go.disconnect(n)}return{forward:r,disconnect:i}}function PS(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"chat":case"toast":case"second":return!0;default:{const e=Fr(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const pf=80,fc=Math.floor(1e3/pf),Sm=3;function hc(t){return new Promise(e=>setTimeout(e,t))}const mf=Ws("clock");let gf=0,dc=0,yf=0,Rm=performance.now();function Om(){const t=performance.now(),e=t-Rm;yf+=e,yf>=pf&&(yf%=pf,mf.emit("","tick",dc),mf.emit("","tock",dc),++gf,++dc,gf>=fc&&(gf%=fc,mf.emit("","second",dc))),Rm=t,setTimeout(Om,2)}Om();var _f={exports:{}};function BS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Im={exports:{}},Bt=Im.exports={},jn,zn;function bf(){throw new Error("setTimeout has not been defined")}function wf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?jn=setTimeout:jn=bf}catch{jn=bf}try{typeof clearTimeout=="function"?zn=clearTimeout:zn=wf}catch{zn=wf}})();function Nm(t){if(jn===setTimeout)return setTimeout(t,0);if((jn===bf||!jn)&&setTimeout)return jn=setTimeout,setTimeout(t,0);try{return jn(t,0)}catch{try{return jn.call(null,t,0)}catch{return jn.call(this,t,0)}}}function $S(t){if(zn===clearTimeout)return clearTimeout(t);if((zn===wf||!zn)&&clearTimeout)return zn=clearTimeout,clearTimeout(t);try{return zn(t)}catch{try{return zn.call(null,t)}catch{return zn.call(this,t)}}}var ui=[],Hs=!1,is,pc=-1;function DS(){!Hs||!is||(Hs=!1,is.length?ui=is.concat(ui):pc=-1,ui.length&&Cm())}function Cm(){if(!Hs){var t=Nm(DS);Hs=!0;for(var e=ui.length;e;){for(is=ui,ui=[];++pc<e;)is&&is[pc].run();pc=-1,e=ui.length}is=null,Hs=!1,$S(t)}}Bt.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];ui.push(new Lm(t,e)),ui.length===1&&!Hs&&Nm(Cm)};function Lm(t,e){this.fun=t,this.array=e}Lm.prototype.run=function(){this.fun.apply(null,this.array)},Bt.title="browser",Bt.browser=!0,Bt.env={},Bt.argv=[],Bt.version="",Bt.versions={};function fi(){}Bt.on=fi,Bt.addListener=fi,Bt.once=fi,Bt.off=fi,Bt.removeListener=fi,Bt.removeAllListeners=fi,Bt.emit=fi,Bt.prependListener=fi,Bt.prependOnceListener=fi,Bt.listeners=function(t){return[]},Bt.binding=function(t){throw new Error("process.binding is not supported")},Bt.cwd=function(){return"/"},Bt.chdir=function(t){throw new Error("process.chdir is not supported")},Bt.umask=function(){return 0};var jS=Im.exports;const An=BS(jS);var Qe={},Mm;function zS(){if(Mm)return Qe;Mm=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function d(N){return N===null||typeof N!="object"?null:(N=h&&N[h]||N["@@iterator"],typeof N=="function"?N:null)}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,p={};function g(N,L,F){this.props=N,this.context=L,this.refs=p,this.updater=F||f}g.prototype.isReactComponent={},g.prototype.setState=function(N,L){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,L,"setState")},g.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function y(){}y.prototype=g.prototype;function b(N,L,F){this.props=N,this.context=L,this.refs=p,this.updater=F||f}var A=b.prototype=new y;A.constructor=b,m(A,g.prototype),A.isPureReactComponent=!0;var S=Array.isArray,x={H:null,A:null,T:null,S:null,V:null},B=Object.prototype.hasOwnProperty;function I(N,L,F,Y,K,Q){return F=Q.ref,{$$typeof:t,type:N,key:L,ref:F!==void 0?F:null,props:Q}}function U(N,L){return I(N.type,L,void 0,void 0,void 0,N.props)}function $(N){return typeof N=="object"&&N!==null&&N.$$typeof===t}function j(N){var L={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(F){return L[F]})}var q=/\/+/g;function R(N,L){return typeof N=="object"&&N!==null&&N.key!=null?j(""+N.key):L.toString(36)}function O(){}function w(N){switch(N.status){case"fulfilled":return N.value;case"rejected":throw N.reason;default:switch(typeof N.status=="string"?N.then(O,O):(N.status="pending",N.then(function(L){N.status==="pending"&&(N.status="fulfilled",N.value=L)},function(L){N.status==="pending"&&(N.status="rejected",N.reason=L)})),N.status){case"fulfilled":return N.value;case"rejected":throw N.reason}}throw N}function C(N,L,F,Y,K){var Q=typeof N;(Q==="undefined"||Q==="boolean")&&(N=null);var he=!1;if(N===null)he=!0;else switch(Q){case"bigint":case"string":case"number":he=!0;break;case"object":switch(N.$$typeof){case t:case e:he=!0;break;case u:return he=N._init,C(he(N._payload),L,F,Y,K)}}if(he)return K=K(N),he=Y===""?"."+R(N,0):Y,S(K)?(F="",he!=null&&(F=he.replace(q,"$&/")+"/"),C(K,L,F,"",function(ke){return ke})):K!=null&&($(K)&&(K=U(K,F+(K.key==null||N&&N.key===K.key?"":(""+K.key).replace(q,"$&/")+"/")+he)),L.push(K)),1;he=0;var xe=Y===""?".":Y+":";if(S(N))for(var ve=0;ve<N.length;ve++)Y=N[ve],Q=xe+R(Y,ve),he+=C(Y,L,F,Q,K);else if(ve=d(N),typeof ve=="function")for(N=ve.call(N),ve=0;!(Y=N.next()).done;)Y=Y.value,Q=xe+R(Y,ve++),he+=C(Y,L,F,Q,K);else if(Q==="object"){if(typeof N.then=="function")return C(w(N),L,F,Y,K);throw L=String(N),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.")}return he}function W(N,L,F){if(N==null)return N;var Y=[],K=0;return C(N,Y,"","",function(Q){return L.call(F,Q,K++)}),Y}function P(N){if(N._status===-1){var L=N._result;L=L(),L.then(function(F){(N._status===0||N._status===-1)&&(N._status=1,N._result=F)},function(F){(N._status===0||N._status===-1)&&(N._status=2,N._result=F)}),N._status===-1&&(N._status=0,N._result=L)}if(N._status===1)return N._result.default;throw N._result}var V=typeof reportError=="function"?reportError:function(N){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var L=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof N=="object"&&N!==null&&typeof N.message=="string"?String(N.message):String(N),error:N});if(!window.dispatchEvent(L))return}else if(typeof An=="object"&&typeof An.emit=="function"){An.emit("uncaughtException",N);return}console.error(N)};function J(){}return Qe.Children={map:W,forEach:function(N,L,F){W(N,function(){L.apply(this,arguments)},F)},count:function(N){var L=0;return W(N,function(){L++}),L},toArray:function(N){return W(N,function(L){return L})||[]},only:function(N){if(!$(N))throw Error("React.Children.only expected to receive a single React element child.");return N}},Qe.Component=g,Qe.Fragment=r,Qe.Profiler=i,Qe.PureComponent=b,Qe.StrictMode=n,Qe.Suspense=c,Qe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=x,Qe.__COMPILER_RUNTIME={__proto__:null,c:function(N){return x.H.useMemoCache(N)}},Qe.cache=function(N){return function(){return N.apply(null,arguments)}},Qe.cloneElement=function(N,L,F){if(N==null)throw Error("The argument must be a React element, but you passed "+N+".");var Y=m({},N.props),K=N.key,Q=void 0;if(L!=null)for(he in L.ref!==void 0&&(Q=void 0),L.key!==void 0&&(K=""+L.key),L)!B.call(L,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&L.ref===void 0||(Y[he]=L[he]);var he=arguments.length-2;if(he===1)Y.children=F;else if(1<he){for(var xe=Array(he),ve=0;ve<he;ve++)xe[ve]=arguments[ve+2];Y.children=xe}return I(N.type,K,void 0,void 0,Q,Y)},Qe.createContext=function(N){return N={$$typeof:o,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null},N.Provider=N,N.Consumer={$$typeof:s,_context:N},N},Qe.createElement=function(N,L,F){var Y,K={},Q=null;if(L!=null)for(Y in L.key!==void 0&&(Q=""+L.key),L)B.call(L,Y)&&Y!=="key"&&Y!=="__self"&&Y!=="__source"&&(K[Y]=L[Y]);var he=arguments.length-2;if(he===1)K.children=F;else if(1<he){for(var xe=Array(he),ve=0;ve<he;ve++)xe[ve]=arguments[ve+2];K.children=xe}if(N&&N.defaultProps)for(Y in he=N.defaultProps,he)K[Y]===void 0&&(K[Y]=he[Y]);return I(N,Q,void 0,void 0,null,K)},Qe.createRef=function(){return{current:null}},Qe.forwardRef=function(N){return{$$typeof:a,render:N}},Qe.isValidElement=$,Qe.lazy=function(N){return{$$typeof:u,_payload:{_status:-1,_result:N},_init:P}},Qe.memo=function(N,L){return{$$typeof:l,type:N,compare:L===void 0?null:L}},Qe.startTransition=function(N){var L=x.T,F={};x.T=F;try{var Y=N(),K=x.S;K!==null&&K(F,Y),typeof Y=="object"&&Y!==null&&typeof Y.then=="function"&&Y.then(J,V)}catch(Q){V(Q)}finally{x.T=L}},Qe.unstable_useCacheRefresh=function(){return x.H.useCacheRefresh()},Qe.use=function(N){return x.H.use(N)},Qe.useActionState=function(N,L,F){return x.H.useActionState(N,L,F)},Qe.useCallback=function(N,L){return x.H.useCallback(N,L)},Qe.useContext=function(N){return x.H.useContext(N)},Qe.useDebugValue=function(){},Qe.useDeferredValue=function(N,L){return x.H.useDeferredValue(N,L)},Qe.useEffect=function(N,L,F){var Y=x.H;if(typeof F=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Y.useEffect(N,L)},Qe.useId=function(){return x.H.useId()},Qe.useImperativeHandle=function(N,L,F){return x.H.useImperativeHandle(N,L,F)},Qe.useInsertionEffect=function(N,L){return x.H.useInsertionEffect(N,L)},Qe.useLayoutEffect=function(N,L){return x.H.useLayoutEffect(N,L)},Qe.useMemo=function(N,L){return x.H.useMemo(N,L)},Qe.useOptimistic=function(N,L){return x.H.useOptimistic(N,L)},Qe.useReducer=function(N,L,F){return x.H.useReducer(N,L,F)},Qe.useRef=function(N){return x.H.useRef(N)},Qe.useState=function(N){return x.H.useState(N)},Qe.useSyncExternalStore=function(N,L,F){return x.H.useSyncExternalStore(N,L,F)},Qe.useTransition=function(){return x.H.useTransition()},Qe.version="19.1.1",Qe}var Um;function WS(){return Um||(Um=1,_f.exports=zS()),_f.exports}WS();/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Fm="0123456789abcdef",Pm=[],mc=[];for(let t=0;t<256;t++)Pm[t]=Fm[t>>4&15]+Fm[t&15],t<16&&(t<10?mc[48+t]=t:mc[87+t]=t);const Bm=t=>{const e=t.length;let r="",n=0;for(;n<e;)r+=Pm[t[n++]];return r},gc=t=>{const e=t.length>>1,r=e<<1,n=new Uint8Array(e);let i=0,s=0;for(;s<r;)n[i++]=mc[t.charCodeAt(s++)]<<4|mc[t.charCodeAt(s++)];return n};for(var $m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",HS=typeof Uint8Array>"u"?[]:new Uint8Array(256),yc=0;yc<$m.length;yc++)HS[$m.charCodeAt(yc)]=yc;new TextDecoder,new TextEncoder;const Dm=typeof window<"u"?window:self,jm=Dm.crypto||Dm.msCrypto||{};jm.subtle||jm.webkitSubtle;const Gs=globalThis||void 0||self,Tn=()=>new Map,vf=t=>{const e=Tn();return t.forEach((r,n)=>{e.set(n,r)}),e},Li=(t,e,r)=>{let n=t.get(e);return n===void 0&&t.set(e,n=r()),n},GS=(t,e)=>{const r=[];for(const[n,i]of t)r.push(e(i,n));return r},KS=(t,e)=>{for(const[r,n]of t)if(e(n,r))return!0;return!1},Ks=()=>new Set,Ef=t=>t[t.length-1],qS=(t,e)=>{for(let r=0;r<e.length;r++)t.push(e[r])},ss=Array.from,YS=Array.isArray;class VS{constructor(){this._observers=Tn()}on(e,r){return Li(this._observers,e,Ks).add(r),r}once(e,r){const n=(...i)=>{this.off(e,n),r(...i)};this.on(e,n)}off(e,r){const n=this._observers.get(e);n!==void 0&&(n.delete(r),n.size===0&&this._observers.delete(e))}emit(e,r){return ss((this._observers.get(e)||Tn()).values()).forEach(n=>n(...r))}destroy(){this._observers=Tn()}}const Mi=Math.floor,_c=Math.abs,zm=(t,e)=>t<e?t:e,os=(t,e)=>t>e?t:e,Wm=t=>t!==0?t<0:1/t<0,Hm=1,Gm=2,kf=4,xf=8,Vo=32,hi=64,Xr=128,bc=31,Af=63,as=127,XS=2147483647,Km=Number.MAX_SAFE_INTEGER,ZS=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Mi(t)===t),JS=t=>t.toLowerCase(),QS=/^\s*/g,eR=t=>t.replace(QS,""),tR=/([A-Z])/g,qm=(t,e)=>eR(t.replace(tR,r=>`${e}${JS(r)}`)),rR=t=>{const e=unescape(encodeURIComponent(t)),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.codePointAt(i);return n},Xo=typeof TextEncoder<"u"?new TextEncoder:null,nR=Xo?t=>Xo.encode(t):rR;let Zo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Zo&&Zo.decode(new Uint8Array).length===1&&(Zo=null);class Jo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const wc=()=>new Jo,iR=t=>{let e=t.cpos;for(let r=0;r<t.bufs.length;r++)e+=t.bufs[r].length;return e},Wn=t=>{const e=new Uint8Array(iR(t));let r=0;for(let n=0;n<t.bufs.length;n++){const i=t.bufs[n];e.set(i,r),r+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),r),e},sR=(t,e)=>{const r=t.cbuf.length;r-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(os(r,e)*2),t.cpos=0)},rr=(t,e)=>{const r=t.cbuf.length;t.cpos===r&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(r*2),t.cpos=0),t.cbuf[t.cpos++]=e},Tf=rr,ft=(t,e)=>{for(;e>as;)rr(t,Xr|as&e),e=Mi(e/128);rr(t,as&e)},Sf=(t,e)=>{const r=Wm(e);for(r&&(e=-e),rr(t,(e>Af?Xr:0)|(r?hi:0)|Af&e),e=Mi(e/64);e>0;)rr(t,(e>as?Xr:0)|as&e),e=Mi(e/128)},Rf=new Uint8Array(3e4),oR=Rf.length/3,aR=(t,e)=>{if(e.length<oR){const r=Xo.encodeInto(e,Rf).written||0;ft(t,r);for(let n=0;n<r;n++)rr(t,Rf[n])}else Zr(t,nR(e))},cR=(t,e)=>{const r=unescape(encodeURIComponent(e)),n=r.length;ft(t,n);for(let i=0;i<n;i++)rr(t,r.codePointAt(i))},qs=Xo&&Xo.encodeInto?aR:cR,vc=(t,e)=>{const r=t.cbuf.length,n=t.cpos,i=zm(r-n,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),n),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(os(r*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Zr=(t,e)=>{ft(t,e.byteLength),vc(t,e)},Of=(t,e)=>{sR(t,e);const r=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,r},lR=(t,e)=>Of(t,4).setFloat32(0,e,!1),uR=(t,e)=>Of(t,8).setFloat64(0,e,!1),fR=(t,e)=>Of(t,8).setBigInt64(0,e,!1),Ym=new DataView(new ArrayBuffer(4)),hR=t=>(Ym.setFloat32(0,t),Ym.getFloat32(0)===t),Qo=(t,e)=>{switch(typeof e){case"string":rr(t,119),qs(t,e);break;case"number":ZS(e)&&_c(e)<=XS?(rr(t,125),Sf(t,e)):hR(e)?(rr(t,124),lR(t,e)):(rr(t,123),uR(t,e));break;case"bigint":rr(t,122),fR(t,e);break;case"object":if(e===null)rr(t,126);else if(YS(e)){rr(t,117),ft(t,e.length);for(let r=0;r<e.length;r++)Qo(t,e[r])}else if(e instanceof Uint8Array)rr(t,116),Zr(t,e);else{rr(t,118);const r=Object.keys(e);ft(t,r.length);for(let n=0;n<r.length;n++){const i=r[n];qs(t,i),Qo(t,e[i])}}break;case"boolean":rr(t,e?120:121);break;default:rr(t,127)}};class Vm extends Jo{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ft(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Xm=t=>{t.count>0&&(Sf(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ft(t.encoder,t.count-2))};class Ec{constructor(){this.encoder=new Jo,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Xm(this),this.count=1,this.s=e)}toUint8Array(){return Xm(this),Wn(this.encoder)}}const Zm=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Sf(t.encoder,e),t.count>1&&ft(t.encoder,t.count-2)}};class If{constructor(){this.encoder=new Jo,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Zm(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Zm(this),Wn(this.encoder)}}class dR{constructor(){this.sarr=[],this.s="",this.lensE=new Ec}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Jo;return this.sarr.push(this.s),this.s="",qs(e,this.sarr.join("")),vc(e,this.lensE.toUint8Array()),Wn(e)}}const Ui=t=>new Error(t),Hn=()=>{throw Ui("Method unimplemented")},Gn=()=>{throw Ui("Unexpected case")},Jm=Ui("Unexpected end of array"),Qm=Ui("Integer out of Range");class kc{constructor(e){this.arr=e,this.pos=0}}const Ys=t=>new kc(t),pR=t=>t.pos!==t.arr.length,mR=(t,e)=>{const r=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,r},Jr=t=>mR(t,nt(t)),Vs=t=>t.arr[t.pos++],nt=t=>{let e=0,r=1;const n=t.arr.length;for(;t.pos<n;){const i=t.arr[t.pos++];if(e=e+(i&as)*r,r*=128,i<Xr)return e;if(e>Km)throw Qm}throw Jm},Nf=t=>{let e=t.arr[t.pos++],r=e&Af,n=64;const i=(e&hi)>0?-1:1;if((e&Xr)===0)return i*r;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],r=r+(e&as)*n,n*=128,e<Xr)return i*r;if(r>Km)throw Qm}throw Jm},Xs=Zo?t=>Zo.decode(Jr(t)):t=>{let e=nt(t);if(e===0)return"";{let r=String.fromCodePoint(Vs(t));if(--e<100)for(;e--;)r+=String.fromCodePoint(Vs(t));else for(;e>0;){const n=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+n);t.pos+=n,r+=String.fromCodePoint.apply(null,i),e-=n}return decodeURIComponent(escape(r))}},Cf=(t,e)=>{const r=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,r},gR=[t=>{},t=>null,Nf,t=>Cf(t,4).getFloat32(0,!1),t=>Cf(t,8).getFloat64(0,!1),t=>Cf(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Xs,t=>{const e=nt(t),r={};for(let n=0;n<e;n++){const i=Xs(t);r[i]=ea(t)}return r},t=>{const e=nt(t),r=[];for(let n=0;n<e;n++)r.push(ea(t));return r},Jr],ea=t=>gR[127-Vs(t)](t);class eg extends kc{constructor(e,r){super(e),this.reader=r,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),pR(this)?this.count=nt(this)+1:this.count=-1),this.count--,this.s}}class xc extends kc{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Nf(this);const e=Wm(this.s);this.count=1,e&&(this.s=-this.s,this.count=nt(this)+2)}return this.count--,this.s}}class Lf extends kc{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Nf(this),r=e&1;this.diff=Mi(e/2),this.count=1,r&&(this.count=nt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class yR{constructor(e){this.decoder=new xc(e),this.str=Xs(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),r=this.str.slice(this.spos,e);return this.spos=e,r}}const _R=crypto.getRandomValues.bind(crypto),tg=()=>_R(new Uint32Array(1))[0],bR="10000000-1000-4000-8000"+-1e11,wR=()=>bR.replace(/[018]/g,t=>(t^tg()&15>>t/4).toString(16)),rg=t=>new Promise(t);Promise.all.bind(Promise);var ng={},Ac={};Ac.byteLength=kR,Ac.toByteArray=AR,Ac.fromByteArray=RR;for(var Kn=[],cn=[],vR=typeof Uint8Array<"u"?Uint8Array:Array,Mf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Zs=0,ER=Mf.length;Zs<ER;++Zs)Kn[Zs]=Mf[Zs],cn[Mf.charCodeAt(Zs)]=Zs;cn[45]=62,cn[95]=63;function ig(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function kR(t){var e=ig(t),r=e[0],n=e[1];return(r+n)*3/4-n}function xR(t,e,r){return(e+r)*3/4-r}function AR(t){var e,r=ig(t),n=r[0],i=r[1],s=new vR(xR(t,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=cn[t.charCodeAt(c)]<<18|cn[t.charCodeAt(c+1)]<<12|cn[t.charCodeAt(c+2)]<<6|cn[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=cn[t.charCodeAt(c)]<<2|cn[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=cn[t.charCodeAt(c)]<<10|cn[t.charCodeAt(c+1)]<<4|cn[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function TR(t){return Kn[t>>18&63]+Kn[t>>12&63]+Kn[t>>6&63]+Kn[t&63]}function SR(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(TR(n));return i.join("")}function RR(t){for(var e,r=t.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(SR(t,o,o+s>a?a:o+s));return n===1?(e=t[r-1],i.push(Kn[e>>2]+Kn[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Kn[e>>10]+Kn[e>>4&63]+Kn[e<<2&63]+"=")),i.join("")}var Uf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Uf.read=function(t,e,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+t[e+h],h+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(f?-1:1)*o*Math.pow(2,s-n)},Uf.write=function(t,e,r,n,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,m=n?1:-1,p=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=d/c:e+=d*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+f]=a&255,f+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[r+f]=o&255,f+=m,o/=256,l-=8);t[r+f-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Ac,r=Uf,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=x,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const M=new s(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,s.prototype),Object.setPrototypeOf(M,_),M.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(M){if(M>i)throw new RangeError('The value "'+M+'" is invalid for option "size"');const _=new s(M);return Object.setPrototypeOf(_,u.prototype),_}function u(M,_,E){if(typeof M=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(M)}return h(M,_,E)}u.poolSize=8192;function h(M,_,E){if(typeof M=="string")return p(M,_);if(o.isView(M))return y(M);if(M==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M);if(_e(M,o)||M&&_e(M.buffer,o)||typeof a<"u"&&(_e(M,a)||M&&_e(M.buffer,a)))return b(M,_,E);if(typeof M=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const D=M.valueOf&&M.valueOf();if(D!=null&&D!==M)return u.from(D,_,E);const X=A(M);if(X)return X;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof M[Symbol.toPrimitive]=="function")return u.from(M[Symbol.toPrimitive]("string"),_,E);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M)}u.from=function(M,_,E){return h(M,_,E)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(M){if(typeof M!="number")throw new TypeError('"size" argument must be of type number');if(M<0)throw new RangeError('The value "'+M+'" is invalid for option "size"')}function f(M,_,E){return d(M),M<=0?l(M):_!==void 0?typeof E=="string"?l(M).fill(_,E):l(M).fill(_):l(M)}u.alloc=function(M,_,E){return f(M,_,E)};function m(M){return d(M),l(M<0?0:S(M)|0)}u.allocUnsafe=function(M){return m(M)},u.allocUnsafeSlow=function(M){return m(M)};function p(M,_){if((typeof _!="string"||_==="")&&(_="utf8"),!u.isEncoding(_))throw new TypeError("Unknown encoding: "+_);const E=B(M,_)|0;let D=l(E);const X=D.write(M,_);return X!==E&&(D=D.slice(0,X)),D}function g(M){const _=M.length<0?0:S(M.length)|0,E=l(_);for(let D=0;D<_;D+=1)E[D]=M[D]&255;return E}function y(M){if(_e(M,s)){const _=new s(M);return b(_.buffer,_.byteOffset,_.byteLength)}return g(M)}function b(M,_,E){if(_<0||M.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(M.byteLength<_+(E||0))throw new RangeError('"length" is outside of buffer bounds');let D;return _===void 0&&E===void 0?D=new s(M):E===void 0?D=new s(M,_):D=new s(M,_,E),Object.setPrototypeOf(D,u.prototype),D}function A(M){if(u.isBuffer(M)){const _=S(M.length)|0,E=l(_);return E.length===0||M.copy(E,0,0,_),E}if(M.length!==void 0)return typeof M.length!="number"||Be(M.length)?l(0):g(M);if(M.type==="Buffer"&&Array.isArray(M.data))return g(M.data)}function S(M){if(M>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return M|0}function x(M){return+M!=M&&(M=0),u.alloc(+M)}u.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==u.prototype},u.compare=function(_,E){if(_e(_,s)&&(_=u.from(_,_.offset,_.byteLength)),_e(E,s)&&(E=u.from(E,E.offset,E.byteLength)),!u.isBuffer(_)||!u.isBuffer(E))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===E)return 0;let D=_.length,X=E.length;for(let ce=0,H=Math.min(D,X);ce<H;++ce)if(_[ce]!==E[ce]){D=_[ce],X=E[ce];break}return D<X?-1:X<D?1:0},u.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(_,E){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return u.alloc(0);let D;if(E===void 0)for(E=0,D=0;D<_.length;++D)E+=_[D].length;const X=u.allocUnsafe(E);let ce=0;for(D=0;D<_.length;++D){let H=_[D];if(_e(H,s))ce+H.length>X.length?(u.isBuffer(H)||(H=u.from(H)),H.copy(X,ce)):s.prototype.set.call(X,H,ce);else if(u.isBuffer(H))H.copy(X,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=H.length}return X};function B(M,_){if(u.isBuffer(M))return M.length;if(o.isView(M)||_e(M,o))return M.byteLength;if(typeof M!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof M);const E=M.length,D=arguments.length>2&&arguments[2]===!0;if(!D&&E===0)return 0;let X=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return E;case"utf8":case"utf-8":return pe(M).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E*2;case"hex":return E>>>1;case"base64":return ye(M).length;default:if(X)return D?-1:pe(M).length;_=(""+_).toLowerCase(),X=!0}}u.byteLength=B;function I(M,_,E){let D=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((E===void 0||E>this.length)&&(E=this.length),E<=0)||(E>>>=0,_>>>=0,E<=_))return"";for(M||(M="utf8");;)switch(M){case"hex":return F(this,_,E);case"utf8":case"utf-8":return P(this,_,E);case"ascii":return N(this,_,E);case"latin1":case"binary":return L(this,_,E);case"base64":return W(this,_,E);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,_,E);default:if(D)throw new TypeError("Unknown encoding: "+M);M=(M+"").toLowerCase(),D=!0}}u.prototype._isBuffer=!0;function U(M,_,E){const D=M[_];M[_]=M[E],M[E]=D}u.prototype.swap16=function(){const _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let E=0;E<_;E+=2)U(this,E,E+1);return this},u.prototype.swap32=function(){const _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let E=0;E<_;E+=4)U(this,E,E+3),U(this,E+1,E+2);return this},u.prototype.swap64=function(){const _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let E=0;E<_;E+=8)U(this,E,E+7),U(this,E+1,E+6),U(this,E+2,E+5),U(this,E+3,E+4);return this},u.prototype.toString=function(){const _=this.length;return _===0?"":arguments.length===0?P(this,0,_):I.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(_){if(!u.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:u.compare(this,_)===0},u.prototype.inspect=function(){let _="";const E=t.INSPECT_MAX_BYTES;return _=this.toString("hex",0,E).replace(/(.{2})/g,"$1 ").trim(),this.length>E&&(_+=" ... "),"<Buffer "+_+">"},n&&(u.prototype[n]=u.prototype.inspect),u.prototype.compare=function(_,E,D,X,ce){if(_e(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(E===void 0&&(E=0),D===void 0&&(D=_?_.length:0),X===void 0&&(X=0),ce===void 0&&(ce=this.length),E<0||D>_.length||X<0||ce>this.length)throw new RangeError("out of range index");if(X>=ce&&E>=D)return 0;if(X>=ce)return-1;if(E>=D)return 1;if(E>>>=0,D>>>=0,X>>>=0,ce>>>=0,this===_)return 0;let H=ce-X,re=D-E;const ze=Math.min(H,re),Ge=this.slice(X,ce),Ye=_.slice(E,D);for(let Le=0;Le<ze;++Le)if(Ge[Le]!==Ye[Le]){H=Ge[Le],re=Ye[Le];break}return H<re?-1:re<H?1:0};function $(M,_,E,D,X){if(M.length===0)return-1;if(typeof E=="string"?(D=E,E=0):E>2147483647?E=2147483647:E<-2147483648&&(E=-2147483648),E=+E,Be(E)&&(E=X?0:M.length-1),E<0&&(E=M.length+E),E>=M.length){if(X)return-1;E=M.length-1}else if(E<0)if(X)E=0;else return-1;if(typeof _=="string"&&(_=u.from(_,D)),u.isBuffer(_))return _.length===0?-1:j(M,_,E,D,X);if(typeof _=="number")return _=_&255,typeof s.prototype.indexOf=="function"?X?s.prototype.indexOf.call(M,_,E):s.prototype.lastIndexOf.call(M,_,E):j(M,[_],E,D,X);throw new TypeError("val must be string, number or Buffer")}function j(M,_,E,D,X){let ce=1,H=M.length,re=_.length;if(D!==void 0&&(D=String(D).toLowerCase(),D==="ucs2"||D==="ucs-2"||D==="utf16le"||D==="utf-16le")){if(M.length<2||_.length<2)return-1;ce=2,H/=2,re/=2,E/=2}function ze(Ye,Le){return ce===1?Ye[Le]:Ye.readUInt16BE(Le*ce)}let Ge;if(X){let Ye=-1;for(Ge=E;Ge<H;Ge++)if(ze(M,Ge)===ze(_,Ye===-1?0:Ge-Ye)){if(Ye===-1&&(Ye=Ge),Ge-Ye+1===re)return Ye*ce}else Ye!==-1&&(Ge-=Ge-Ye),Ye=-1}else for(E+re>H&&(E=H-re),Ge=E;Ge>=0;Ge--){let Ye=!0;for(let Le=0;Le<re;Le++)if(ze(M,Ge+Le)!==ze(_,Le)){Ye=!1;break}if(Ye)return Ge}return-1}u.prototype.includes=function(_,E,D){return this.indexOf(_,E,D)!==-1},u.prototype.indexOf=function(_,E,D){return $(this,_,E,D,!0)},u.prototype.lastIndexOf=function(_,E,D){return $(this,_,E,D,!1)};function q(M,_,E,D){E=Number(E)||0;const X=M.length-E;D?(D=Number(D),D>X&&(D=X)):D=X;const ce=_.length;D>ce/2&&(D=ce/2);let H;for(H=0;H<D;++H){const re=parseInt(_.substr(H*2,2),16);if(Be(re))return H;M[E+H]=re}return H}function R(M,_,E,D){return Oe(pe(_,M.length-E),M,E,D)}function O(M,_,E,D){return Oe(me(_),M,E,D)}function w(M,_,E,D){return Oe(ye(_),M,E,D)}function C(M,_,E,D){return Oe(se(_,M.length-E),M,E,D)}u.prototype.write=function(_,E,D,X){if(E===void 0)X="utf8",D=this.length,E=0;else if(D===void 0&&typeof E=="string")X=E,D=this.length,E=0;else if(isFinite(E))E=E>>>0,isFinite(D)?(D=D>>>0,X===void 0&&(X="utf8")):(X=D,D=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-E;if((D===void 0||D>ce)&&(D=ce),_.length>0&&(D<0||E<0)||E>this.length)throw new RangeError("Attempt to write outside buffer bounds");X||(X="utf8");let H=!1;for(;;)switch(X){case"hex":return q(this,_,E,D);case"utf8":case"utf-8":return R(this,_,E,D);case"ascii":case"latin1":case"binary":return O(this,_,E,D);case"base64":return w(this,_,E,D);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,_,E,D);default:if(H)throw new TypeError("Unknown encoding: "+X);X=(""+X).toLowerCase(),H=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function W(M,_,E){return _===0&&E===M.length?e.fromByteArray(M):e.fromByteArray(M.slice(_,E))}function P(M,_,E){E=Math.min(M.length,E);const D=[];let X=_;for(;X<E;){const ce=M[X];let H=null,re=ce>239?4:ce>223?3:ce>191?2:1;if(X+re<=E){let ze,Ge,Ye,Le;switch(re){case 1:ce<128&&(H=ce);break;case 2:ze=M[X+1],(ze&192)===128&&(Le=(ce&31)<<6|ze&63,Le>127&&(H=Le));break;case 3:ze=M[X+1],Ge=M[X+2],(ze&192)===128&&(Ge&192)===128&&(Le=(ce&15)<<12|(ze&63)<<6|Ge&63,Le>2047&&(Le<55296||Le>57343)&&(H=Le));break;case 4:ze=M[X+1],Ge=M[X+2],Ye=M[X+3],(ze&192)===128&&(Ge&192)===128&&(Ye&192)===128&&(Le=(ce&15)<<18|(ze&63)<<12|(Ge&63)<<6|Ye&63,Le>65535&&Le<1114112&&(H=Le))}}H===null?(H=65533,re=1):H>65535&&(H-=65536,D.push(H>>>10&1023|55296),H=56320|H&1023),D.push(H),X+=re}return J(D)}const V=4096;function J(M){const _=M.length;if(_<=V)return String.fromCharCode.apply(String,M);let E="",D=0;for(;D<_;)E+=String.fromCharCode.apply(String,M.slice(D,D+=V));return E}function N(M,_,E){let D="";E=Math.min(M.length,E);for(let X=_;X<E;++X)D+=String.fromCharCode(M[X]&127);return D}function L(M,_,E){let D="";E=Math.min(M.length,E);for(let X=_;X<E;++X)D+=String.fromCharCode(M[X]);return D}function F(M,_,E){const D=M.length;(!_||_<0)&&(_=0),(!E||E<0||E>D)&&(E=D);let X="";for(let ce=_;ce<E;++ce)X+=pt[M[ce]];return X}function Y(M,_,E){const D=M.slice(_,E);let X="";for(let ce=0;ce<D.length-1;ce+=2)X+=String.fromCharCode(D[ce]+D[ce+1]*256);return X}u.prototype.slice=function(_,E){const D=this.length;_=~~_,E=E===void 0?D:~~E,_<0?(_+=D,_<0&&(_=0)):_>D&&(_=D),E<0?(E+=D,E<0&&(E=0)):E>D&&(E=D),E<_&&(E=_);const X=this.subarray(_,E);return Object.setPrototypeOf(X,u.prototype),X};function K(M,_,E){if(M%1!==0||M<0)throw new RangeError("offset is not uint");if(M+_>E)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(_,E,D){_=_>>>0,E=E>>>0,D||K(_,E,this.length);let X=this[_],ce=1,H=0;for(;++H<E&&(ce*=256);)X+=this[_+H]*ce;return X},u.prototype.readUintBE=u.prototype.readUIntBE=function(_,E,D){_=_>>>0,E=E>>>0,D||K(_,E,this.length);let X=this[_+--E],ce=1;for(;E>0&&(ce*=256);)X+=this[_+--E]*ce;return X},u.prototype.readUint8=u.prototype.readUInt8=function(_,E){return _=_>>>0,E||K(_,1,this.length),this[_]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(_,E){return _=_>>>0,E||K(_,2,this.length),this[_]|this[_+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(_,E){return _=_>>>0,E||K(_,2,this.length),this[_]<<8|this[_+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(_,E){return _=_>>>0,E||K(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(_,E){return _=_>>>0,E||K(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},u.prototype.readBigUInt64LE=Je(function(_){_=_>>>0,ie(_,"offset");const E=this[_],D=this[_+7];(E===void 0||D===void 0)&&G(_,this.length-8);const X=E+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,ce=this[++_]+this[++_]*2**8+this[++_]*2**16+D*2**24;return BigInt(X)+(BigInt(ce)<<BigInt(32))}),u.prototype.readBigUInt64BE=Je(function(_){_=_>>>0,ie(_,"offset");const E=this[_],D=this[_+7];(E===void 0||D===void 0)&&G(_,this.length-8);const X=E*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],ce=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+D;return(BigInt(X)<<BigInt(32))+BigInt(ce)}),u.prototype.readIntLE=function(_,E,D){_=_>>>0,E=E>>>0,D||K(_,E,this.length);let X=this[_],ce=1,H=0;for(;++H<E&&(ce*=256);)X+=this[_+H]*ce;return ce*=128,X>=ce&&(X-=Math.pow(2,8*E)),X},u.prototype.readIntBE=function(_,E,D){_=_>>>0,E=E>>>0,D||K(_,E,this.length);let X=E,ce=1,H=this[_+--X];for(;X>0&&(ce*=256);)H+=this[_+--X]*ce;return ce*=128,H>=ce&&(H-=Math.pow(2,8*E)),H},u.prototype.readInt8=function(_,E){return _=_>>>0,E||K(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},u.prototype.readInt16LE=function(_,E){_=_>>>0,E||K(_,2,this.length);const D=this[_]|this[_+1]<<8;return D&32768?D|4294901760:D},u.prototype.readInt16BE=function(_,E){_=_>>>0,E||K(_,2,this.length);const D=this[_+1]|this[_]<<8;return D&32768?D|4294901760:D},u.prototype.readInt32LE=function(_,E){return _=_>>>0,E||K(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},u.prototype.readInt32BE=function(_,E){return _=_>>>0,E||K(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},u.prototype.readBigInt64LE=Je(function(_){_=_>>>0,ie(_,"offset");const E=this[_],D=this[_+7];(E===void 0||D===void 0)&&G(_,this.length-8);const X=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(D<<24);return(BigInt(X)<<BigInt(32))+BigInt(E+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),u.prototype.readBigInt64BE=Je(function(_){_=_>>>0,ie(_,"offset");const E=this[_],D=this[_+7];(E===void 0||D===void 0)&&G(_,this.length-8);const X=(E<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(X)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+D)}),u.prototype.readFloatLE=function(_,E){return _=_>>>0,E||K(_,4,this.length),r.read(this,_,!0,23,4)},u.prototype.readFloatBE=function(_,E){return _=_>>>0,E||K(_,4,this.length),r.read(this,_,!1,23,4)},u.prototype.readDoubleLE=function(_,E){return _=_>>>0,E||K(_,8,this.length),r.read(this,_,!0,52,8)},u.prototype.readDoubleBE=function(_,E){return _=_>>>0,E||K(_,8,this.length),r.read(this,_,!1,52,8)};function Q(M,_,E,D,X,ce){if(!u.isBuffer(M))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>X||_<ce)throw new RangeError('"value" argument is out of bounds');if(E+D>M.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(_,E,D,X){if(_=+_,E=E>>>0,D=D>>>0,!X){const re=Math.pow(2,8*D)-1;Q(this,_,E,D,re,0)}let ce=1,H=0;for(this[E]=_&255;++H<D&&(ce*=256);)this[E+H]=_/ce&255;return E+D},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(_,E,D,X){if(_=+_,E=E>>>0,D=D>>>0,!X){const re=Math.pow(2,8*D)-1;Q(this,_,E,D,re,0)}let ce=D-1,H=1;for(this[E+ce]=_&255;--ce>=0&&(H*=256);)this[E+ce]=_/H&255;return E+D},u.prototype.writeUint8=u.prototype.writeUInt8=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,1,255,0),this[E]=_&255,E+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,2,65535,0),this[E]=_&255,this[E+1]=_>>>8,E+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,2,65535,0),this[E]=_>>>8,this[E+1]=_&255,E+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,4,4294967295,0),this[E+3]=_>>>24,this[E+2]=_>>>16,this[E+1]=_>>>8,this[E]=_&255,E+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,4,4294967295,0),this[E]=_>>>24,this[E+1]=_>>>16,this[E+2]=_>>>8,this[E+3]=_&255,E+4};function he(M,_,E,D,X){ue(_,D,X,M,E,7);let ce=Number(_&BigInt(4294967295));M[E++]=ce,ce=ce>>8,M[E++]=ce,ce=ce>>8,M[E++]=ce,ce=ce>>8,M[E++]=ce;let H=Number(_>>BigInt(32)&BigInt(4294967295));return M[E++]=H,H=H>>8,M[E++]=H,H=H>>8,M[E++]=H,H=H>>8,M[E++]=H,E}function xe(M,_,E,D,X){ue(_,D,X,M,E,7);let ce=Number(_&BigInt(4294967295));M[E+7]=ce,ce=ce>>8,M[E+6]=ce,ce=ce>>8,M[E+5]=ce,ce=ce>>8,M[E+4]=ce;let H=Number(_>>BigInt(32)&BigInt(4294967295));return M[E+3]=H,H=H>>8,M[E+2]=H,H=H>>8,M[E+1]=H,H=H>>8,M[E]=H,E+8}u.prototype.writeBigUInt64LE=Je(function(_,E=0){return he(this,_,E,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Je(function(_,E=0){return xe(this,_,E,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(_,E,D,X){if(_=+_,E=E>>>0,!X){const ze=Math.pow(2,8*D-1);Q(this,_,E,D,ze-1,-ze)}let ce=0,H=1,re=0;for(this[E]=_&255;++ce<D&&(H*=256);)_<0&&re===0&&this[E+ce-1]!==0&&(re=1),this[E+ce]=(_/H>>0)-re&255;return E+D},u.prototype.writeIntBE=function(_,E,D,X){if(_=+_,E=E>>>0,!X){const ze=Math.pow(2,8*D-1);Q(this,_,E,D,ze-1,-ze)}let ce=D-1,H=1,re=0;for(this[E+ce]=_&255;--ce>=0&&(H*=256);)_<0&&re===0&&this[E+ce+1]!==0&&(re=1),this[E+ce]=(_/H>>0)-re&255;return E+D},u.prototype.writeInt8=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,1,127,-128),_<0&&(_=255+_+1),this[E]=_&255,E+1},u.prototype.writeInt16LE=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,2,32767,-32768),this[E]=_&255,this[E+1]=_>>>8,E+2},u.prototype.writeInt16BE=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,2,32767,-32768),this[E]=_>>>8,this[E+1]=_&255,E+2},u.prototype.writeInt32LE=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,4,2147483647,-2147483648),this[E]=_&255,this[E+1]=_>>>8,this[E+2]=_>>>16,this[E+3]=_>>>24,E+4},u.prototype.writeInt32BE=function(_,E,D){return _=+_,E=E>>>0,D||Q(this,_,E,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[E]=_>>>24,this[E+1]=_>>>16,this[E+2]=_>>>8,this[E+3]=_&255,E+4},u.prototype.writeBigInt64LE=Je(function(_,E=0){return he(this,_,E,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Je(function(_,E=0){return xe(this,_,E,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ve(M,_,E,D,X,ce){if(E+D>M.length)throw new RangeError("Index out of range");if(E<0)throw new RangeError("Index out of range")}function ke(M,_,E,D,X){return _=+_,E=E>>>0,X||ve(M,_,E,4),r.write(M,_,E,D,23,4),E+4}u.prototype.writeFloatLE=function(_,E,D){return ke(this,_,E,!0,D)},u.prototype.writeFloatBE=function(_,E,D){return ke(this,_,E,!1,D)};function Ae(M,_,E,D,X){return _=+_,E=E>>>0,X||ve(M,_,E,8),r.write(M,_,E,D,52,8),E+8}u.prototype.writeDoubleLE=function(_,E,D){return Ae(this,_,E,!0,D)},u.prototype.writeDoubleBE=function(_,E,D){return Ae(this,_,E,!1,D)},u.prototype.copy=function(_,E,D,X){if(!u.isBuffer(_))throw new TypeError("argument should be a Buffer");if(D||(D=0),!X&&X!==0&&(X=this.length),E>=_.length&&(E=_.length),E||(E=0),X>0&&X<D&&(X=D),X===D||_.length===0||this.length===0)return 0;if(E<0)throw new RangeError("targetStart out of bounds");if(D<0||D>=this.length)throw new RangeError("Index out of range");if(X<0)throw new RangeError("sourceEnd out of bounds");X>this.length&&(X=this.length),_.length-E<X-D&&(X=_.length-E+D);const ce=X-D;return this===_&&typeof s.prototype.copyWithin=="function"?this.copyWithin(E,D,X):s.prototype.set.call(_,this.subarray(D,X),E),ce},u.prototype.fill=function(_,E,D,X){if(typeof _=="string"){if(typeof E=="string"?(X=E,E=0,D=this.length):typeof D=="string"&&(X=D,D=this.length),X!==void 0&&typeof X!="string")throw new TypeError("encoding must be a string");if(typeof X=="string"&&!u.isEncoding(X))throw new TypeError("Unknown encoding: "+X);if(_.length===1){const H=_.charCodeAt(0);(X==="utf8"&&H<128||X==="latin1")&&(_=H)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(E<0||this.length<E||this.length<D)throw new RangeError("Out of range index");if(D<=E)return this;E=E>>>0,D=D===void 0?this.length:D>>>0,_||(_=0);let ce;if(typeof _=="number")for(ce=E;ce<D;++ce)this[ce]=_;else{const H=u.isBuffer(_)?_:u.from(_,X),re=H.length;if(re===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(ce=0;ce<D-E;++ce)this[ce+E]=H[ce%re]}return this};const Se={};function Me(M,_,E){Se[M]=class extends E{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${M}]`,this.stack,delete this.name}get code(){return M}set code(X){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:X,writable:!0})}toString(){return`${this.name} [${M}]: ${this.message}`}}}Me("ERR_BUFFER_OUT_OF_BOUNDS",function(M){return M?`${M} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Me("ERR_INVALID_ARG_TYPE",function(M,_){return`The "${M}" argument must be of type number. Received type ${typeof _}`},TypeError),Me("ERR_OUT_OF_RANGE",function(M,_,E){let D=`The value of "${M}" is out of range.`,X=E;return Number.isInteger(E)&&Math.abs(E)>2**32?X=je(String(E)):typeof E=="bigint"&&(X=String(E),(E>BigInt(2)**BigInt(32)||E<-(BigInt(2)**BigInt(32)))&&(X=je(X)),X+="n"),D+=` It must be ${_}. Received ${X}`,D},RangeError);function je(M){let _="",E=M.length;const D=M[0]==="-"?1:0;for(;E>=D+4;E-=3)_=`_${M.slice(E-3,E)}${_}`;return`${M.slice(0,E)}${_}`}function T(M,_,E){ie(_,"offset"),(M[_]===void 0||M[_+E]===void 0)&&G(_,M.length-(E+1))}function ue(M,_,E,D,X,ce){if(M>E||M<_){const H=typeof _=="bigint"?"n":"";let re;throw _===0||_===BigInt(0)?re=`>= 0${H} and < 2${H} ** ${(ce+1)*8}${H}`:re=`>= -(2${H} ** ${(ce+1)*8-1}${H}) and < 2 ** ${(ce+1)*8-1}${H}`,new Se.ERR_OUT_OF_RANGE("value",re,M)}T(D,X,ce)}function ie(M,_){if(typeof M!="number")throw new Se.ERR_INVALID_ARG_TYPE(_,"number",M)}function G(M,_,E){throw Math.floor(M)!==M?(ie(M,E),new Se.ERR_OUT_OF_RANGE("offset","an integer",M)):_<0?new Se.ERR_BUFFER_OUT_OF_BOUNDS:new Se.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${_}`,M)}const z=/[^+/0-9A-Za-z-_]/g;function ee(M){if(M=M.split("=")[0],M=M.trim().replace(z,""),M.length<2)return"";for(;M.length%4!==0;)M=M+"=";return M}function pe(M,_){_=_||1/0;let E;const D=M.length;let X=null;const ce=[];for(let H=0;H<D;++H){if(E=M.charCodeAt(H),E>55295&&E<57344){if(!X){if(E>56319){(_-=3)>-1&&ce.push(239,191,189);continue}else if(H+1===D){(_-=3)>-1&&ce.push(239,191,189);continue}X=E;continue}if(E<56320){(_-=3)>-1&&ce.push(239,191,189),X=E;continue}E=(X-55296<<10|E-56320)+65536}else X&&(_-=3)>-1&&ce.push(239,191,189);if(X=null,E<128){if((_-=1)<0)break;ce.push(E)}else if(E<2048){if((_-=2)<0)break;ce.push(E>>6|192,E&63|128)}else if(E<65536){if((_-=3)<0)break;ce.push(E>>12|224,E>>6&63|128,E&63|128)}else if(E<1114112){if((_-=4)<0)break;ce.push(E>>18|240,E>>12&63|128,E>>6&63|128,E&63|128)}else throw new Error("Invalid code point")}return ce}function me(M){const _=[];for(let E=0;E<M.length;++E)_.push(M.charCodeAt(E)&255);return _}function se(M,_){let E,D,X;const ce=[];for(let H=0;H<M.length&&!((_-=2)<0);++H)E=M.charCodeAt(H),D=E>>8,X=E%256,ce.push(X),ce.push(D);return ce}function ye(M){return e.toByteArray(ee(M))}function Oe(M,_,E,D){let X;for(X=0;X<D&&!(X+E>=_.length||X>=M.length);++X)_[X+E]=M[X];return X}function _e(M,_){return M instanceof _||M!=null&&M.constructor!=null&&M.constructor.name!=null&&M.constructor.name===_.name}function Be(M){return M!==M}const pt=(function(){const M="0123456789abcdef",_=new Array(256);for(let E=0;E<16;++E){const D=E*16;for(let X=0;X<16;++X)_[D+X]=M[E]+M[X]}return _})();function Je(M){return typeof BigInt>"u"?Yt:M}function Yt(){throw new Error("BigInt not supported")}})(ng);const Vt=ng.Buffer,sg=t=>t===void 0?null:t;class OR{constructor(){this.map=new Map}setItem(e,r){this.map.set(e,r)}getItem(e){return this.map.get(e)}}let og=new OR,IR=!0;try{typeof localStorage<"u"&&localStorage&&(og=localStorage,IR=!1)}catch{}const NR=og,CR=Object.assign,LR=Object.keys,MR=(t,e)=>{for(const r in t)e(t[r],r)},ag=t=>LR(t).length,UR=t=>{for(const e in t)return!1;return!0},FR=(t,e)=>{for(const r in t)if(!e(t[r],r))return!1;return!0},PR=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),BR=(t,e)=>t===e||ag(t)===ag(e)&&FR(t,(r,n)=>(r!==void 0||PR(e,n))&&e[n]===r),$R=Object.freeze,cg=t=>{for(const e in t){const r=t[e];(typeof r=="object"||typeof r=="function")&&cg(t[e])}return $R(t)},Ff=(t,e,r=0)=>{try{for(;r<t.length;r++)t[r](...e)}finally{r<t.length&&Ff(t,e,r+1)}},DR=t=>t,jR=(t,e)=>e.includes(t);var lg={};const ta=typeof An<"u"&&An.release&&/node|io\.js/.test(An.release.name)&&Object.prototype.toString.call(typeof An<"u"?An:0)==="[object process]";let qn;const zR=()=>{if(qn===void 0)if(ta){qn=Tn();const t=An.argv;let e=null;for(let r=0;r<t.length;r++){const n=t[r];n[0]==="-"?(e!==null&&qn.set(e,""),e=n):e!==null&&(qn.set(e,n),e=null)}e!==null&&qn.set(e,"")}else typeof location=="object"?(qn=Tn(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,r]=t.split("=");qn.set(`--${qm(e,"-")}`,r),qn.set(`-${qm(e,"-")}`,r)}})):qn=Tn();return qn},Pf=t=>zR().has(t),Tc=t=>sg(ta?lg[t.toUpperCase().replaceAll("-","_")]:NR.getItem(t)),ug=t=>Pf("--"+t)||Tc(t)!==null;ug("production");const WR=ta&&jR(lg.FORCE_COLOR,["true","1","2"])||!Pf("--no-colors")&&!ug("no-color")&&(!ta||An.stdout.isTTY)&&(!ta||Pf("--color")||Tc("COLORTERM")!==null||(Tc("TERM")||"").includes("color")),HR=t=>new Uint8Array(t),GR=t=>{const e=HR(t.byteLength);return e.set(t),e};class KR{constructor(e,r){this.left=e,this.right=r}}const di=(t,e)=>new KR(t,e);typeof DOMParser<"u"&&new DOMParser;const qR=t=>GS(t,(e,r)=>`${r}:${e};`).join(""),pi=Symbol,fg=pi(),hg=pi(),YR=pi(),VR=pi(),XR=pi(),dg=pi(),ZR=pi(),Bf=pi(),JR=pi(),QR=t=>{t.length===1&&t[0]?.constructor===Function&&(t=t[0]());const e=[],r=[];let n=0;for(;n<t.length;n++){const i=t[n];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(n>0&&r.push(e.join(""));n<t.length;n++){const i=t[n];i instanceof Symbol||r.push(i)}return r},eO={[fg]:di("font-weight","bold"),[hg]:di("font-weight","normal"),[YR]:di("color","blue"),[XR]:di("color","green"),[VR]:di("color","grey"),[dg]:di("color","red"),[ZR]:di("color","purple"),[Bf]:di("color","orange"),[JR]:di("color","black")},pg=WR?t=>{t.length===1&&t[0]?.constructor===Function&&(t=t[0]());const e=[],r=[],n=Tn();let i=[],s=0;for(;s<t.length;s++){const o=t[s],a=eO[o];if(a!==void 0)n.set(a.left,a.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const c=qR(n);s>0||c.length>0?(e.push("%c"+o),r.push(c)):e.push(o)}else break}}for(s>0&&(i=r,i.unshift(e.join("")));s<t.length;s++){const o=t[s];o instanceof Symbol||i.push(o)}return i}:QR,tO=(...t)=>{console.log(...pg(t)),mg.forEach(e=>e.print(t))},rO=(...t)=>{console.warn(...pg(t)),t.unshift(Bf),mg.forEach(e=>e.print(t))},mg=Ks(),gg=t=>({[Symbol.iterator](){return this},next:t}),nO=(t,e)=>gg(()=>{let r;do r=t.next();while(!r.done&&!e(r.value));return r}),$f=(t,e)=>gg(()=>{const{done:r,value:n}=t.next();return{done:r,value:r?void 0:e(n)}});class Df{constructor(e,r){this.clock=e,this.len=r}}class ra{constructor(){this.clients=new Map}}const yg=(t,e,r)=>e.clients.forEach((n,i)=>{const s=t.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,l=n[c];c<n.length&&l.clock<a;l=n[++c])Lg(t,s,l.clock,l.len,r)}}),iO=(t,e)=>{let r=0,n=t.length-1;for(;r<=n;){const i=Mi((r+n)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;r=i+1}else n=i-1}return null},_g=(t,e)=>{const r=t.clients.get(e.client);return r!==void 0&&iO(r,e.clock)!==null},jf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let r,n;for(r=1,n=1;r<e.length;r++){const i=e[n-1],s=e[r];i.clock+i.len>=s.clock?i.len=os(i.len,s.clock+s.len-i.clock):(n<r&&(e[n]=s),n++)}e.length=n})},sO=t=>{const e=new ra;for(let r=0;r<t.length;r++)t[r].clients.forEach((n,i)=>{if(!e.clients.has(i)){const s=n.slice();for(let o=r+1;o<t.length;o++)qS(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return jf(e),e},Sc=(t,e,r,n)=>{Li(t.clients,e,()=>[]).push(new Df(r,n))},oO=()=>new ra,aO=t=>{const e=oO();return t.clients.forEach((r,n)=>{const i=[];for(let s=0;s<r.length;s++){const o=r[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<r.length)for(let l=r[s+1];s+1<r.length&&l.deleted;l=r[++s+1])c+=l.length;i.push(new Df(a,c))}}i.length>0&&e.clients.set(n,i)}),e},Js=(t,e)=>{ft(t.restEncoder,e.clients.size),ss(e.clients.entries()).sort((r,n)=>n[0]-r[0]).forEach(([r,n])=>{t.resetDsCurVal(),ft(t.restEncoder,r);const i=n.length;ft(t.restEncoder,i);for(let s=0;s<i;s++){const o=n[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},zf=t=>{const e=new ra,r=nt(t.restDecoder);for(let n=0;n<r;n++){t.resetDsCurVal();const i=nt(t.restDecoder),s=nt(t.restDecoder);if(s>0){const o=Li(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Df(t.readDsClock(),t.readDsLen()))}}return e},bg=(t,e,r)=>{const n=new ra,i=nt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=nt(t.restDecoder),a=nt(t.restDecoder),c=r.clients.get(o)||[],l=nr(r,o);for(let u=0;u<a;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&Sc(n,o,l,d-l);let f=Yn(c,h),m=c[f];for(!m.deleted&&m.id.clock<h&&(c.splice(f+1,0,jc(e,m,h-m.id.clock)),f++);f<c.length&&(m=c[f++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(f,0,jc(e,m,d-m.id.clock)),m.delete(e))}else Sc(n,o,h,d-h)}}if(n.clients.size>0){const s=new cs;return ft(s.restEncoder,0),Js(s,n),s.toUint8Array()}return null},wg=tg;class Qs extends VS{constructor({guid:e=wR(),collectionid:r=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=wg(),this.guid=e,this.collectionid=r,this.share=new Map,this.store=new Ig,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=rg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>rg(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&bt(e.parent.doc,r=>{r.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ss(this.subdocs).map(e=>e.guid))}transact(e,r=null){return bt(this,e,r)}get(e,r=yr){const n=Li(this.share,e,()=>{const s=new r;return s._integrate(this,null),s}),i=n.constructor;if(r!==yr&&i!==r)if(i===yr){const s=new r;s._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=n._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=n._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return n}getArray(e=""){return this.get(e,no)}getText(e=""){return this.get(e,mi)}getMap(e=""){return this.get(e,io)}getXmlElement(e=""){return this.get(e,oo)}getXmlFragment(e=""){return this.get(e,ls)}toJSON(){const e={};return this.share.forEach((r,n)=>{e[n]=r.toJSON()}),e}destroy(){this.isDestroyed=!0,ss(this.subdocs).forEach(r=>r.destroy());const e=this._item;if(e!==null){this._item=null;const r=e.content;r.doc=new Qs({guid:this.guid,...r.opts,shouldLoad:!1}),r.doc._item=e,bt(e.parent.doc,n=>{const i=r.doc;e.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class vg{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return nt(this.restDecoder)}readDsLen(){return nt(this.restDecoder)}}class Eg extends vg{readLeftID(){return ot(nt(this.restDecoder),nt(this.restDecoder))}readRightID(){return ot(nt(this.restDecoder),nt(this.restDecoder))}readClient(){return nt(this.restDecoder)}readInfo(){return Vs(this.restDecoder)}readString(){return Xs(this.restDecoder)}readParentInfo(){return nt(this.restDecoder)===1}readTypeRef(){return nt(this.restDecoder)}readLen(){return nt(this.restDecoder)}readAny(){return ea(this.restDecoder)}readBuf(){return GR(Jr(this.restDecoder))}readJSON(){return JSON.parse(Xs(this.restDecoder))}readKey(){return Xs(this.restDecoder)}}class cO{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=nt(this.restDecoder),this.dsCurrVal}readDsLen(){const e=nt(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class eo extends cO{constructor(e){super(e),this.keys=[],nt(e),this.keyClockDecoder=new Lf(Jr(e)),this.clientDecoder=new xc(Jr(e)),this.leftClockDecoder=new Lf(Jr(e)),this.rightClockDecoder=new Lf(Jr(e)),this.infoDecoder=new eg(Jr(e),Vs),this.stringDecoder=new yR(Jr(e)),this.parentInfoDecoder=new eg(Jr(e),Vs),this.typeRefDecoder=new xc(Jr(e)),this.lenDecoder=new xc(Jr(e))}readLeftID(){return new to(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new to(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ea(this.restDecoder)}readBuf(){return Jr(this.restDecoder)}readJSON(){return ea(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const r=this.stringDecoder.read();return this.keys.push(r),r}}}class lO{constructor(){this.restEncoder=wc()}toUint8Array(){return Wn(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ft(this.restEncoder,e)}writeDsLen(e){ft(this.restEncoder,e)}}class na extends lO{writeLeftID(e){ft(this.restEncoder,e.client),ft(this.restEncoder,e.clock)}writeRightID(e){ft(this.restEncoder,e.client),ft(this.restEncoder,e.clock)}writeClient(e){ft(this.restEncoder,e)}writeInfo(e){Tf(this.restEncoder,e)}writeString(e){qs(this.restEncoder,e)}writeParentInfo(e){ft(this.restEncoder,e?1:0)}writeTypeRef(e){ft(this.restEncoder,e)}writeLen(e){ft(this.restEncoder,e)}writeAny(e){Qo(this.restEncoder,e)}writeBuf(e){Zr(this.restEncoder,e)}writeJSON(e){qs(this.restEncoder,JSON.stringify(e))}writeKey(e){qs(this.restEncoder,e)}}class uO{constructor(){this.restEncoder=wc(),this.dsCurrVal=0}toUint8Array(){return Wn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const r=e-this.dsCurrVal;this.dsCurrVal=e,ft(this.restEncoder,r)}writeDsLen(e){e===0&&Gn(),ft(this.restEncoder,e-1),this.dsCurrVal+=e}}class cs extends uO{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new If,this.clientEncoder=new Ec,this.leftClockEncoder=new If,this.rightClockEncoder=new If,this.infoEncoder=new Vm(Tf),this.stringEncoder=new dR,this.parentInfoEncoder=new Vm(Tf),this.typeRefEncoder=new Ec,this.lenEncoder=new Ec}toUint8Array(){const e=wc();return ft(e,0),Zr(e,this.keyClockEncoder.toUint8Array()),Zr(e,this.clientEncoder.toUint8Array()),Zr(e,this.leftClockEncoder.toUint8Array()),Zr(e,this.rightClockEncoder.toUint8Array()),Zr(e,Wn(this.infoEncoder)),Zr(e,this.stringEncoder.toUint8Array()),Zr(e,Wn(this.parentInfoEncoder)),Zr(e,this.typeRefEncoder.toUint8Array()),Zr(e,this.lenEncoder.toUint8Array()),vc(e,Wn(this.restEncoder)),Wn(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Qo(this.restEncoder,e)}writeBuf(e){Zr(this.restEncoder,e)}writeJSON(e){Qo(this.restEncoder,e)}writeKey(e){const r=this.keyMap.get(e);r===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(r)}}const fO=(t,e,r,n)=>{n=os(n,e[0].id.clock);const i=Yn(e,n);ft(t.restEncoder,e.length-i),t.writeClient(r),ft(t.restEncoder,n);const s=e[i];s.write(t,n-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Wf=(t,e,r)=>{const n=new Map;r.forEach((i,s)=>{nr(e,s)>i&&n.set(s,i)}),Gf(e).forEach((i,s)=>{r.has(s)||n.set(s,0)}),ft(t.restEncoder,n.size),ss(n.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{fO(t,e.clients.get(i),i,s)})},hO=(t,e)=>{const r=Tn(),n=nt(t.restDecoder);for(let i=0;i<n;i++){const s=nt(t.restDecoder),o=new Array(s),a=t.readClient();let c=nt(t.restDecoder);r.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(bc&u){case 0:{const h=t.readLen();o[l]=new ln(ot(a,c),h),c+=h;break}case 10:{const h=nt(t.restDecoder);o[l]=new un(ot(a,c),h),c+=h;break}default:{const h=(u&(hi|Xr))===0,d=new Zt(ot(a,c),null,(u&Xr)===Xr?t.readLeftID():null,null,(u&hi)===hi?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&Vo)===Vo?t.readString():null,iy(t,u));o[l]=d,c+=d.length}}}}return r},dO=(t,e,r)=>{const n=[];let i=ss(r.keys()).sort((f,m)=>f-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=r.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=r.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new Ig,c=new Map,l=(f,m)=>{const p=c.get(f);(p==null||p>m)&&c.set(f,m)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of n){const m=f.id.client,p=r.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),r.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[f]),i=i.filter(g=>g!==m)}n.length=0};for(;;){if(u.constructor!==un){const m=Li(h,u.id.client,()=>nr(e,u.id.client))-u.id.clock;if(m<0)n.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(t,e);if(p!==null){n.push(u);const g=r.get(p)||{refs:[],i:0};if(g.refs.length===g.i)l(p,nr(e,p)),d();else{u=g.refs[g.i++];continue}}else(m===0||m<u.length)&&(u.integrate(t,m),h.set(u.id.client,u.id.clock+u.length))}}if(n.length>0)u=n.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new cs;return Wf(f,a,new Map),ft(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},pO=(t,e)=>Wf(t,e.doc.store,e.beforeState),mO=(t,e,r,n=new eo(t))=>bt(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=hO(n,o),l=dO(i,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<nr(a,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const m=u.missing.get(d);(m==null||m>f)&&u.missing.set(d,f)}u.update=Ic([u.update,l.update])}}else a.pendingStructs=l;const h=bg(n,i,a);if(a.pendingDs){const d=new eo(Ys(a.pendingDs));nt(d.restDecoder);const f=bg(d,i,a);h&&f?a.pendingDs=Ic([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,kg(i.doc,d)}},r,!1),kg=(t,e,r,n=eo)=>{const i=Ys(e);mO(i,t,r,new n(i))},xg=(t,e,r)=>kg(t,e,r,Eg),gO=(t,e,r=new Map)=>{Wf(t,e.store,r),Js(t,aO(e.store))},yO=(t,e=new Uint8Array([0]),r=new cs)=>{const n=Ag(e);gO(r,t,n);const i=[r.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(OO(t.store.pendingStructs.update,e)),i.length>1){if(r.constructor===na)return SO(i.map((s,o)=>o===0?s:NO(s)));if(r.constructor===cs)return Ic(i)}return i[0]},_O=(t,e)=>yO(t,e,new na),bO=t=>{const e=new Map,r=nt(t.restDecoder);for(let n=0;n<r;n++){const i=nt(t.restDecoder),s=nt(t.restDecoder);e.set(i,s)}return e},Ag=t=>bO(new vg(Ys(t)));class wO{constructor(){this.l=[]}}const Tg=()=>new wO,Sg=(t,e)=>t.l.push(e),Rg=(t,e)=>{const r=t.l,n=r.length;t.l=r.filter(i=>e!==i),n===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Og=(t,e,r)=>Ff(t.l,[e,r]);class to{constructor(e,r){this.client=e,this.clock=r}}const Rc=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,ot=(t,e)=>new to(t,e),vO=t=>{for(const[e,r]of t.doc.share.entries())if(r===t)return e;throw Gn()},ro=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!_g(e.ds,t.id),Hf=(t,e)=>{const r=Li(t.meta,Hf,Ks),n=t.doc.store;r.has(e)||(e.sv.forEach((i,s)=>{i<nr(n,s)&&Fi(t,ot(s,i))}),yg(t,e.ds,i=>{}),r.add(e))};class Ig{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Gf=t=>{const e=new Map;return t.clients.forEach((r,n)=>{const i=r[r.length-1];e.set(n,i.id.clock+i.length)}),e},nr=(t,e)=>{const r=t.clients.get(e);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},Ng=(t,e)=>{let r=t.clients.get(e.id.client);if(r===void 0)r=[],t.clients.set(e.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==e.id.clock)throw Gn()}r.push(e)},Yn=(t,e)=>{let r=0,n=t.length-1,i=t[n],s=i.id.clock;if(s===e)return n;let o=Mi(e/(s+i.length-1)*n);for(;r<=n;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;r=o+1}else n=o-1;o=Mi((r+n)/2)}throw Gn()},Kf=(t,e)=>{const r=t.clients.get(e.client);return r[Yn(r,e.clock)]},qf=(t,e,r)=>{const n=Yn(e,r),i=e[n];return i.id.clock<r&&i instanceof Zt?(e.splice(n+1,0,jc(t,i,r-i.id.clock)),n+1):n},Fi=(t,e)=>{const r=t.doc.store.clients.get(e.client);return r[qf(t,r,e.clock)]},Cg=(t,e,r)=>{const n=e.clients.get(r.client),i=Yn(n,r.clock),s=n[i];return r.clock!==s.id.clock+s.length-1&&s.constructor!==ln&&n.splice(i+1,0,jc(t,s,r.clock-s.id.clock+1)),s},EO=(t,e,r)=>{const n=t.clients.get(e.id.client);n[Yn(n,e.id.clock)]=r},Lg=(t,e,r,n,i)=>{if(n===0)return;const s=r+n;let o=qf(t,e,r),a;do a=e[o++],s<a.id.clock+a.length&&qf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class kO{constructor(e,r,n){this.doc=e,this.deleteSet=new ra,this.beforeState=Gf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=r,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Mg=(t,e)=>e.deleteSet.clients.size===0&&!KS(e.afterState,(r,n)=>e.beforeState.get(n)!==r)?!1:(jf(e.deleteSet),pO(t,e),Js(t,e.deleteSet),!0),Ug=(t,e,r)=>{const n=e._item;(n===null||n.id.clock<(t.beforeState.get(n.id.client)||0)&&!n.deleted)&&Li(t.changed,e,Ks).add(r)},Oc=(t,e)=>{let r=t[e],n=t[e-1],i=e;for(;i>0;r=n,n=t[--i-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof Zt&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},xO=(t,e,r)=>{for(const[n,i]of t.clients.entries()){const s=e.clients.get(n);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Yn(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof Zt&&h.deleted&&!h.keep&&r(h)&&h.gc(e,!1)}}}},AO=(t,e)=>{t.clients.forEach((r,n)=>{const i=e.clients.get(n);for(let s=r.length-1;s>=0;s--){const o=r[s],a=zm(i.length-1,1+Yn(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Oc(i,c)}})},Fg=(t,e)=>{if(e<t.length){const r=t[e],n=r.doc,i=n.store,s=r.deleteSet,o=r._mergeStructs;try{jf(s),r.afterState=Gf(r.doc.store),n.emit("beforeObserverCalls",[r,n]);const a=[];r.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(r,c)})),a.push(()=>{r.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),Og(l._dEH,c,r))})}),a.push(()=>n.emit("afterTransaction",[r,n])),Ff(a,[]),r._needFormattingCleanup&&GO(r)}finally{n.gc&&xO(s,i,n.gcFilter),AO(s,i),r.afterState.forEach((u,h)=>{const d=r.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),m=os(Yn(f,d),1);for(let p=f.length-1;p>=m;)p-=1+Oc(f,p)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=i.clients.get(h),m=Yn(f,d);m+1<f.length&&Oc(f,m+1)>1||m>0&&Oc(f,m)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(tO(Bf,fg,"[yjs] ",hg,dg,"Changed the client-id because another client seems to be using it."),n.clientID=wg()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const u=new na;Mg(u,r)&&n.emit("update",[u.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const u=new cs;Mg(u,r)&&n.emit("updateV2",[u.toUint8Array(),r.origin,n,r])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=r;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=n.clientID,u.collectionid==null&&(u.collectionid=n.collectionid),n.subdocs.add(u)}),l.forEach(u=>n.subdocs.delete(u)),n.emit("subdocs",[{loaded:c,added:a,removed:l},n,r]),l.forEach(u=>u.destroy())),t.length<=e+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,t])):Fg(t,e+1)}}},bt=(t,e,r=null,n=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new kO(t,r,n),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&Fg(i,0)}}return o};function*TO(t){const e=nt(t.restDecoder);for(let r=0;r<e;r++){const n=nt(t.restDecoder),i=t.readClient();let s=nt(t.restDecoder);for(let o=0;o<n;o++){const a=t.readInfo();if(a===10){const c=nt(t.restDecoder);yield new un(ot(i,s),c),s+=c}else if((bc&a)!==0){const c=(a&(hi|Xr))===0,l=new Zt(ot(i,s),null,(a&Xr)===Xr?t.readLeftID():null,null,(a&hi)===hi?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Vo)===Vo?t.readString():null,iy(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new ln(ot(i,s),c),s+=c}}}}class Yf{constructor(e,r){this.gen=TO(e),this.curr=null,this.done=!1,this.filterSkips=r,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===un);return this.curr}}class Vf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const SO=t=>Ic(t,Eg,na),RO=(t,e)=>{if(t.constructor===ln){const{client:r,clock:n}=t.id;return new ln(ot(r,n+e),t.length-e)}else if(t.constructor===un){const{client:r,clock:n}=t.id;return new un(ot(r,n+e),t.length-e)}else{const r=t,{client:n,clock:i}=r.id;return new Zt(ot(n,i+e),null,ot(n,i+e-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(e))}},Ic=(t,e=eo,r=cs)=>{if(t.length===1)return t[0];const n=t.map(u=>new e(Ys(u)));let i=n.map(u=>new Yf(u,!0)),s=null;const o=new r,a=new Vf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const m=d.curr.id.clock-f.curr.id.clock;return m===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===un?1:-1:m}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===un)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new un(ot(h,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===un?s.struct.length-=m:d=RO(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==un;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),Xf(a);const c=n.map(u=>zf(u)),l=sO(c);return Js(o,l),o.toUint8Array()},OO=(t,e,r=eo,n=cs)=>{const i=Ag(e),s=new n,o=new Vf(s),a=new r(Ys(t)),c=new Yf(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===un){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,os(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Xf(o);const l=zf(a);return Js(s,l),s.toUint8Array()},Pg=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Wn(t.encoder.restEncoder)}),t.encoder.restEncoder=wc(),t.written=0)},Pi=(t,e,r)=>{t.written>0&&t.currClient!==e.id.client&&Pg(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ft(t.encoder.restEncoder,e.id.clock+r)),e.write(t.encoder,r),t.written++},Xf=t=>{Pg(t);const e=t.encoder.restEncoder;ft(e,t.clientStructs.length);for(let r=0;r<t.clientStructs.length;r++){const n=t.clientStructs[r];ft(e,n.written),vc(e,n.restEncoder)}},IO=(t,e,r,n)=>{const i=new r(Ys(t)),s=new Yf(i,!1),o=new n,a=new Vf(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,e(l),0);Xf(a);const c=zf(i);return Js(o,c),o.toUint8Array()},NO=t=>IO(t,DR,eo,na),Bg="You must not compute changes after the event-handler fired.";class Nc{constructor(e,r){this.target=e,this.currentTarget=e,this.transaction=r,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=CO(this.currentTarget,this.target))}deletes(e){return _g(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ui(Bg);const e=new Map,r=this.target;this.transaction.changed.get(r).forEach(i=>{if(i!==null){const s=r._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Ef(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Ef(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Ef(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ui(Bg);const r=this.target,n=Ks(),i=Ks(),s=[];if(e={added:n,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(r).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=r._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),n.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const CO=(t,e)=>{const r=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)r.unshift(e._item.parentSub);else{let n=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;r.unshift(n)}e=e._item.parent}return r},vr=()=>{rO("Invalid access: Add Yjs type to a document before reading data.")},$g=80;let Zf=0;class LO{constructor(e,r){e.marker=!0,this.p=e,this.index=r,this.timestamp=Zf++}}const MO=t=>{t.timestamp=Zf++},Dg=(t,e,r)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=r,t.timestamp=Zf++},UO=(t,e,r)=>{if(t.length>=$g){const n=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Dg(n,e,r),n}else{const n=new LO(e,r);return t.push(n),n}},Cc=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const r=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>_c(e-s.index)<_c(e-o.index)?s:o);let n=t._start,i=0;for(r!==null&&(n=r.p,i=r.index,MO(r));n.right!==null&&i<e;){if(!n.deleted&&n.countable){if(e<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>e;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&_c(r.index-i)<n.parent.length/$g?(Dg(r,n,i),r):UO(t._searchMarker,n,i)},ia=(t,e,r)=>{for(let n=t.length-1;n>=0;n--){const i=t[n];if(r>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(n,1);continue}i.p=s,s.marker=!0}(e<i.index||r>0&&e===i.index)&&(i.index=os(e,i.index+r))}},Lc=(t,e,r)=>{const n=t,i=e.changedParentTypes;for(;Li(i,t,()=>[]).push(r),t._item!==null;)t=t._item.parent;Og(n._eH,r,e)};class yr{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Tg(),this._dEH=Tg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,r){this.doc=e,this._item=r}_copy(){throw Hn()}clone(){throw Hn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,r){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Sg(this._eH,e)}observeDeep(e){Sg(this._dEH,e)}unobserve(e){Rg(this._eH,e)}unobserveDeep(e){Rg(this._dEH,e)}toJSON(){}}const jg=(t,e,r)=>{t.doc??vr(),e<0&&(e=t._length+e),r<0&&(r=t._length+r);let n=r-e;const i=[];let s=t._start;for(;s!==null&&n>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&n>0;a++)i.push(o[a]),n--;e=0}}s=s.right}return i},zg=t=>{t.doc??vr();const e=[];let r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)e.push(n[i])}r=r.right}return e},sa=(t,e)=>{let r=0,n=t._start;for(t.doc??vr();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)e(i[s],r++,t)}n=n.right}},Wg=(t,e)=>{const r=[];return sa(t,(n,i)=>{r.push(e(n,i,t))}),r},FO=t=>{let e=t._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};r=e.content.getContent(),n=0,e=e.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},Hg=(t,e)=>{t.doc??vr();const r=Cc(t,e);let n=t._start;for(r!==null&&(n=r.p,e-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(e<n.length)return n.content.getContent()[e];e-=n.length}},Mc=(t,e,r,n)=>{let i=r;const s=t.doc,o=s.clientID,a=s.store,c=r===null?e._start:r.right;let l=[];const u=()=>{l.length>0&&(i=new Zt(ot(o,nr(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new fs(l)),i.integrate(t,0),l=[])};n.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new Zt(ot(o,nr(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new oa(new Uint8Array(h))),i.integrate(t,0);break;case Qs:i=new Zt(ot(o,nr(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ca(h)),i.integrate(t,0);break;default:if(h instanceof yr)i=new Zt(ot(o,nr(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new gi(h)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Gg=()=>Ui("Length exceeded!"),Kg=(t,e,r,n)=>{if(r>e._length)throw Gg();if(r===0)return e._searchMarker&&ia(e._searchMarker,r,n.length),Mc(t,e,null,n);const i=r,s=Cc(e,r);let o=e._start;for(s!==null&&(o=s.p,r-=s.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&Fi(t,ot(o.id.client,o.id.clock+r));break}r-=o.length}return e._searchMarker&&ia(e._searchMarker,i,n.length),Mc(t,e,o,n)},PO=(t,e,r)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Mc(t,e,i,r)},qg=(t,e,r,n)=>{if(n===0)return;const i=r,s=n,o=Cc(e,r);let a=e._start;for(o!==null&&(a=o.p,r-=o.index);a!==null&&r>0;a=a.right)!a.deleted&&a.countable&&(r<a.length&&Fi(t,ot(a.id.client,a.id.clock+r)),r-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&Fi(t,ot(a.id.client,a.id.clock+n)),a.delete(t),n-=a.length),a=a.right;if(n>0)throw Gg();e._searchMarker&&ia(e._searchMarker,i,-s+n)},Uc=(t,e,r)=>{const n=e._map.get(r);n!==void 0&&n.delete(t)},Jf=(t,e,r,n)=>{const i=e._map.get(r)||null,s=t.doc,o=s.clientID;let a;if(n==null)a=new fs([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new fs([n]);break;case Uint8Array:a=new oa(n);break;case Qs:a=new ca(n);break;default:if(n instanceof yr)a=new gi(n);else throw new Error("Unexpected content type")}new Zt(ot(o,nr(s.store,o)),i,i&&i.lastId,null,null,e,r,a).integrate(t,0)},Qf=(t,e)=>{t.doc??vr();const r=t._map.get(e);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},Yg=t=>{const e={};return t.doc??vr(),t._map.forEach((r,n)=>{r.deleted||(e[n]=r.content.getContent()[r.length-1])}),e},Vg=(t,e)=>{t.doc??vr();const r=t._map.get(e);return r!==void 0&&!r.deleted},BO=(t,e)=>{const r={};return t._map.forEach((n,i)=>{let s=n;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&ro(s,e)&&(r[i]=s.content.getContent()[s.length-1])}),r},Fc=t=>(t.doc??vr(),nO(t._map.entries(),e=>!e[1].deleted));class $O extends Nc{}class no extends yr{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const r=new no;return r.push(e),r}_integrate(e,r){super._integrate(e,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new no}clone(){const e=new no;return e.insert(0,this.toArray().map(r=>r instanceof yr?r.clone():r)),e}get length(){return this.doc??vr(),this._length}_callObserver(e,r){super._callObserver(e,r),Lc(this,e,new $O(this,e))}insert(e,r){this.doc!==null?bt(this.doc,n=>{Kg(n,this,e,r)}):this._prelimContent.splice(e,0,...r)}push(e){this.doc!==null?bt(this.doc,r=>{PO(r,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,r=1){this.doc!==null?bt(this.doc,n=>{qg(n,this,e,r)}):this._prelimContent.splice(e,r)}get(e){return Hg(this,e)}toArray(){return zg(this)}slice(e=0,r=this.length){return jg(this,e,r)}toJSON(){return this.map(e=>e instanceof yr?e.toJSON():e)}map(e){return Wg(this,e)}forEach(e){sa(this,e)}[Symbol.iterator](){return FO(this)}_write(e){e.writeTypeRef(uI)}}const DO=t=>new no;class jO extends Nc{constructor(e,r,n){super(e,r),this.keysChanged=n}}class io extends yr{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,r){super._integrate(e,r),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new io}clone(){const e=new io;return this.forEach((r,n)=>{e.set(n,r instanceof yr?r.clone():r)}),e}_callObserver(e,r){Lc(this,e,new jO(this,e,r))}toJSON(){this.doc??vr();const e={};return this._map.forEach((r,n)=>{if(!r.deleted){const i=r.content.getContent()[r.length-1];e[n]=i instanceof yr?i.toJSON():i}}),e}get size(){return[...Fc(this)].length}keys(){return $f(Fc(this),e=>e[0])}values(){return $f(Fc(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return $f(Fc(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??vr(),this._map.forEach((r,n)=>{r.deleted||e(r.content.getContent()[r.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?bt(this.doc,r=>{Uc(r,this,e)}):this._prelimContent.delete(e)}set(e,r){return this.doc!==null?bt(this.doc,n=>{Jf(n,this,e,r)}):this._prelimContent.set(e,r),r}get(e){return Qf(this,e)}has(e){return Vg(this,e)}clear(){this.doc!==null?bt(this.doc,e=>{this.forEach(function(r,n,i){Uc(e,i,n)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(fI)}}const zO=t=>new io,Bi=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&BR(t,e);class eh{constructor(e,r,n,i){this.left=e,this.right=r,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Gn(),this.right.content.constructor){case Xt:this.right.deleted||so(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Xg=(t,e,r)=>{for(;e.right!==null&&r>0;){switch(e.right.content.constructor){case Xt:e.right.deleted||so(e.currentAttributes,e.right.content);break;default:e.right.deleted||(r<e.right.length&&Fi(t,ot(e.right.id.client,e.right.id.clock+r)),e.index+=e.right.length,r-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Pc=(t,e,r,n)=>{const i=new Map,s=n?Cc(e,r):null;if(s){const o=new eh(s.p.left,s.p,s.index,i);return Xg(t,o,r-s.index)}else{const o=new eh(null,e._start,0,i);return Xg(t,o,r)}},Zg=(t,e,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===Xt&&Bi(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=t.doc,s=i.clientID;n.forEach((o,a)=>{const c=r.left,l=r.right,u=new Zt(ot(s,nr(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Xt(a,o));u.integrate(t,0),r.right=u,r.forward()})},so=(t,e)=>{const{key:r,value:n}=e;n===null?t.delete(r):t.set(r,n)},Jg=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Xt&&Bi(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Qg=(t,e,r,n)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in n){const c=n[a],l=r.currentAttributes.get(a)??null;if(!Bi(l,c)){o.set(a,l);const{left:u,right:h}=r;r.right=new Zt(ot(s,nr(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new Xt(a,c)),r.right.integrate(t,0),r.forward()}}return o},th=(t,e,r,n,i)=>{r.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=t.doc,o=s.clientID;Jg(r,i);const a=Qg(t,e,r,i),c=n.constructor===String?new Vn(n):n instanceof yr?new gi(n):new us(n);let{left:l,right:u,index:h}=r;e._searchMarker&&ia(e._searchMarker,r.index,c.getLength()),u=new Zt(ot(o,nr(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),r.right=u,r.index=h,r.forward(),Zg(t,e,r,a)},ey=(t,e,r,n,i)=>{const s=t.doc,o=s.clientID;Jg(r,i);const a=Qg(t,e,r,i);e:for(;r.right!==null&&(n>0||a.size>0&&(r.right.deleted||r.right.content.constructor===Xt));){if(!r.right.deleted)switch(r.right.content.constructor){case Xt:{const{key:c,value:l}=r.right.content,u=i[c];if(u!==void 0){if(Bi(u,l))a.delete(c);else{if(n===0)break e;a.set(c,l)}r.right.delete(t)}else r.currentAttributes.set(c,l);break}default:n<r.right.length&&Fi(t,ot(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new Zt(ot(o,nr(s.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,e,null,new Vn(c)),r.right.integrate(t,0),r.forward()}Zg(t,e,r,a)},ty=(t,e,r,n,i)=>{let s=e;const o=Tn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Xt){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(r===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Xt:{const{key:u,value:h}=l,d=n.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(t),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&so(i,l);break}}}e=e.right}return a},WO=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const r=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Xt){const n=e.content.key;r.has(n)?e.delete(t):r.add(n)}e=e.left}},HO=t=>{let e=0;return bt(t.doc,r=>{let n=t._start,i=t._start,s=Tn();const o=vf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Xt:so(o,i.content);break;default:e+=ty(r,n,i,s,o),s=vf(o),n=i;break}i=i.right}}),e},GO=t=>{const e=new Set,r=t.doc;for(const[n,i]of t.afterState.entries()){const s=t.beforeState.get(n)||0;i!==s&&Lg(t,r.store.clients.get(n),s,i,o=>{!o.deleted&&o.content.constructor===Xt&&o.constructor!==ln&&e.add(o.parent)})}bt(r,n=>{yg(t,t.deleteSet,i=>{if(i instanceof ln||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Xt?e.add(s):WO(n,i)});for(const i of e)HO(i)})},ry=(t,e,r)=>{const n=r,i=vf(e.currentAttributes),s=e.right;for(;r>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case gi:case us:case Vn:r<e.right.length&&Fi(t,ot(e.right.id.client,e.right.id.clock+r)),r-=e.right.length,e.right.delete(t);break}e.forward()}s&&ty(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&ia(o._searchMarker,e.index,-n+r),e};class KO extends Nc{constructor(e,r,n){super(e,r),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,r=[];bt(e,n=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((m,p)=>{m!==null&&(f.attributes[p]=m)}))),l="";break;case"retain":u>0&&(f={retain:u},UR(c)||(f.attributes=CR({},c))),u=0;break}f&&r.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case gi:case us:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Vn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Xt:{const{key:f,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(f)??null;Bi(p,m)?m!==null&&o.delete(n):(a==="retain"&&d(),Bi(m,s.get(f)??null)?delete c[f]:c[f]=m)}}else if(this.deletes(o)){s.set(f,m);const p=i.get(f)??null;Bi(p,m)||(a==="retain"&&d(),c[f]=p)}else if(!o.deleted){s.set(f,m);const p=c[f];p!==void 0&&(Bi(p,m)?p!==null&&o.delete(n):(a==="retain"&&d(),m===null?delete c[f]:c[f]=m))}o.deleted||(a==="insert"&&d(),so(i,o.content));break}}o=o.right}for(d();r.length>0;){const f=r[r.length-1];if(f.retain!==void 0&&f.attributes===void 0)r.pop();else break}}),this._delta=r}return this._delta}}class mi extends yr{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??vr(),this._length}_integrate(e,r){super._integrate(e,r);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new mi}clone(){const e=new mi;return e.applyDelta(this.toDelta()),e}_callObserver(e,r){super._callObserver(e,r);const n=new KO(this,e,r);Lc(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??vr();let e="",r=this._start;for(;r!==null;)!r.deleted&&r.countable&&r.content.constructor===Vn&&(e+=r.content.str),r=r.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:r=!0}={}){this.doc!==null?bt(this.doc,n=>{const i=new eh(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!r&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&th(n,this,i,a,o.attributes||{})}else o.retain!==void 0?ey(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&ry(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,r,n){this.doc??vr();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((m,p)=>{d=!0,h[p]=m});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const u=()=>{for(;c!==null;){if(ro(c,e)||r!==void 0&&ro(c,r))switch(c.content.constructor){case Vn:{const h=s.get("ychange");e!==void 0&&!ro(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",n?n("removed",c.id):{type:"removed"})):r!==void 0&&!ro(c,r)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",n?n("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case gi:case us:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,m)=>{d[m]=f})}i.push(h);break}case Xt:ro(c,e)&&(l(),so(s,c.content));break}c=c.right}l()};return e||r?bt(o,h=>{e&&Hf(h,e),r&&Hf(h,r),u()},"cleanup"):u(),i}insert(e,r,n){if(r.length<=0)return;const i=this.doc;i!==null?bt(i,s=>{const o=Pc(s,this,e,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),th(s,this,o,r,n)}):this._pending.push(()=>this.insert(e,r,n))}insertEmbed(e,r,n){const i=this.doc;i!==null?bt(i,s=>{const o=Pc(s,this,e,!n);th(s,this,o,r,n||{})}):this._pending.push(()=>this.insertEmbed(e,r,n||{}))}delete(e,r){if(r===0)return;const n=this.doc;n!==null?bt(n,i=>{ry(i,Pc(i,this,e,!0),r)}):this._pending.push(()=>this.delete(e,r))}format(e,r,n){if(r===0)return;const i=this.doc;i!==null?bt(i,s=>{const o=Pc(s,this,e,!1);o.right!==null&&ey(s,this,o,r,n)}):this._pending.push(()=>this.format(e,r,n))}removeAttribute(e){this.doc!==null?bt(this.doc,r=>{Uc(r,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,r){this.doc!==null?bt(this.doc,n=>{Jf(n,this,e,r)}):this._pending.push(()=>this.setAttribute(e,r))}getAttribute(e){return Qf(this,e)}getAttributes(){return Yg(this)}_write(e){e.writeTypeRef(hI)}}const qO=t=>new mi;class rh{constructor(e,r=()=>!0){this._filter=r,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??vr()}[Symbol.iterator](){return this}next(){let e=this._currentNode,r=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(r)))do if(r=e.content.type,!e.deleted&&(r.constructor===oo||r.constructor===ls)&&r._start!==null)e=r._start;else for(;e!==null;){const n=e.next;if(n!==null){e=n;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class ls extends yr{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,r){super._integrate(e,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ls}clone(){const e=new ls;return e.insert(0,this.toArray().map(r=>r instanceof yr?r.clone():r)),e}get length(){return this.doc??vr(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new rh(this,e)}querySelector(e){e=e.toUpperCase();const n=new rh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return n.done?null:n.value}querySelectorAll(e){return e=e.toUpperCase(),ss(new rh(this,r=>r.nodeName&&r.nodeName.toUpperCase()===e))}_callObserver(e,r){Lc(this,e,new XO(this,r,e))}toString(){return Wg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,r={},n){const i=e.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),sa(this,s=>{i.insertBefore(s.toDOM(e,r,n),null)}),i}insert(e,r){this.doc!==null?bt(this.doc,n=>{Kg(n,this,e,r)}):this._prelimContent.splice(e,0,...r)}insertAfter(e,r){if(this.doc!==null)bt(this.doc,n=>{const i=e&&e instanceof yr?e._item:e;Mc(n,this,i,r)});else{const n=this._prelimContent,i=e===null?0:n.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Ui("Reference item not found");n.splice(i,0,...r)}}delete(e,r=1){this.doc!==null?bt(this.doc,n=>{qg(n,this,e,r)}):this._prelimContent.splice(e,r)}toArray(){return zg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Hg(this,e)}slice(e=0,r=this.length){return jg(this,e,r)}forEach(e){sa(this,e)}_write(e){e.writeTypeRef(pI)}}const YO=t=>new ls;class oo extends ls{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,r){super._integrate(e,r),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new oo(this.nodeName)}clone(){const e=new oo(this.nodeName),r=this.getAttributes();return MR(r,(n,i)=>{typeof n=="string"&&e.setAttribute(i,n)}),e.insert(0,this.toArray().map(n=>n instanceof yr?n.clone():n)),e}toString(){const e=this.getAttributes(),r=[],n=[];for(const a in e)n.push(a);n.sort();const i=n.length;for(let a=0;a<i;a++){const c=n[a];r.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=r.length>0?" "+r.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?bt(this.doc,r=>{Uc(r,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,r){this.doc!==null?bt(this.doc,n=>{Jf(n,this,e,r)}):this._prelimAttrs.set(e,r)}getAttribute(e){return Qf(this,e)}hasAttribute(e){return Vg(this,e)}getAttributes(e){return e?BO(this,e):Yg(this)}toDOM(e=document,r={},n){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return sa(this,o=>{i.appendChild(o.toDOM(e,r,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(e){e.writeTypeRef(dI),e.writeKey(this.nodeName)}}const VO=t=>new oo(t.readKey());class XO extends Nc{constructor(e,r,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Bc extends io{constructor(e){super(),this.hookName=e}_copy(){return new Bc(this.hookName)}clone(){const e=new Bc(this.hookName);return this.forEach((r,n)=>{e.set(n,r)}),e}toDOM(e=document,r={},n){const i=r[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(mI),e.writeKey(this.hookName)}}const ZO=t=>new Bc(t.readKey());class $c extends mi{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new $c}clone(){const e=new $c;return e.applyDelta(this.toDelta()),e}toDOM(e=document,r,n){const i=e.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const r=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),r.push({nodeName:i,attrs:s})}r.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let n="";for(let i=0;i<r.length;i++){const s=r[i];n+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=e.insert;for(let i=r.length-1;i>=0;i--)n+=`</${r[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(gI)}}const JO=t=>new $c;class nh{constructor(e,r){this.id=e,this.length=r}get deleted(){throw Hn()}mergeWith(e){return!1}write(e,r,n){throw Hn()}integrate(e,r){throw Hn()}}const QO=0;class ln extends nh{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,r){r>0&&(this.id.clock+=r,this.length-=r),Ng(e.doc.store,this)}write(e,r){e.writeInfo(QO),e.writeLen(this.length-r)}getMissing(e,r){return null}}class oa{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new oa(this.content)}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeBuf(this.content)}getRef(){return 3}}const eI=t=>new oa(t.readBuf());class aa{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new aa(this.len)}splice(e){const r=new aa(this.len-e);return this.len=e,r}mergeWith(e){return this.len+=e.len,!0}integrate(e,r){Sc(e.deleteSet,r.id.client,r.id.clock,this.len),r.markDeleted()}delete(e){}gc(e){}write(e,r){e.writeLen(this.len-r)}getRef(){return 1}}const tI=t=>new aa(t.readLen()),ny=(t,e)=>new Qs({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class ca{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const r={};this.opts=r,e.gc||(r.gc=!1),e.autoLoad&&(r.autoLoad=!0),e.meta!==null&&(r.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ca(ny(this.doc.guid,this.opts))}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){this.doc._item=r,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,r){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const rI=t=>new ca(ny(t.readString(),t.readAny()));class us{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new us(this.embed)}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeJSON(this.embed)}getRef(){return 5}}const nI=t=>new us(t.readJSON());class Xt{constructor(e,r){this.key=e,this.value=r}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Xt(this.key,this.value)}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){const n=r.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,r){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const iI=t=>new Xt(t.readKey(),t.readJSON());class Dc{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Dc(this.arr)}splice(e){const r=new Dc(this.arr.slice(e));return this.arr=this.arr.slice(0,e),r}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){const n=this.arr.length;e.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const sI=t=>{const e=t.readLen(),r=[];for(let n=0;n<e;n++){const i=t.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new Dc(r)},oI=Tc("node_env")==="development";class fs{constructor(e){this.arr=e,oI&&cg(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new fs(this.arr)}splice(e){const r=new fs(this.arr.slice(e));return this.arr=this.arr.slice(0,e),r}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){const n=this.arr.length;e.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const aI=t=>{const e=t.readLen(),r=[];for(let n=0;n<e;n++)r.push(t.readAny());return new fs(r)};class Vn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vn(this.str)}splice(e){const r=new Vn(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"�",r.str="�"+r.str.slice(1)),r}mergeWith(e){return this.str+=e.str,!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeString(r===0?this.str:this.str.slice(r))}getRef(){return 4}}const cI=t=>new Vn(t.readString()),lI=[DO,zO,qO,VO,YO,ZO,JO],uI=0,fI=1,hI=2,dI=3,pI=4,mI=5,gI=6;class gi{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new gi(this.type._copy())}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){this.type._integrate(e.doc,r)}delete(e){let r=this.type._start;for(;r!==null;)r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e),r=r.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e)}),e.changed.delete(this.type)}gc(e){let r=this.type._start;for(;r!==null;)r.gc(e,!0),r=r.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(e,!0),n=n.left}),this.type._map=new Map}write(e,r){this.type._write(e)}getRef(){return 7}}const yI=t=>new gi(lI[t.readTypeRef()](t)),jc=(t,e,r)=>{const{client:n,clock:i}=e.id,s=new Zt(ot(n,i+r),e,ot(n,i+r-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(r));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=ot(e.redone.client,e.redone.clock+r)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=r,s};class Zt extends nh{constructor(e,r,n,i,s,o,a,c){super(e,c.getLength()),this.origin=n,this.left=r,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Gm:0}set marker(e){(this.info&xf)>0!==e&&(this.info^=xf)}get marker(){return(this.info&xf)>0}get keep(){return(this.info&Hm)>0}set keep(e){this.keep!==e&&(this.info^=Hm)}get countable(){return(this.info&Gm)>0}get deleted(){return(this.info&kf)>0}set deleted(e){this.deleted!==e&&(this.info^=kf)}markDeleted(){this.info|=kf}getMissing(e,r){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=nr(r,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=nr(r,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===to&&this.id.client!==this.parent.client&&this.parent.clock>=nr(r,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Cg(e,r,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Fi(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ln||this.right&&this.right.constructor===ln)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Zt?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Zt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===to){const n=Kf(r,this.parent);n.constructor===ln?this.parent=null:this.parent=n.content.type}return null}integrate(e,r){if(r>0&&(this.id.clock+=r,this.left=Cg(e,e.doc.store,ot(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(r),this.length-=r),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Rc(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,s.clear();else if(Rc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Kf(e.doc.store,i.origin)))s.has(Kf(e.doc.store,i.origin))||(n=i,s.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ng(e.doc.store,this),this.content.integrate(e,this),Ug(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new ln(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:ot(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Rc(e.origin,this.lastId)&&this.right===e&&Rc(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const r=this.parent._searchMarker;return r&&r.forEach(n=>{n.p===e&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const r=this.parent;this.countable&&this.parentSub===null&&(r._length-=this.length),this.markDeleted(),Sc(e.deleteSet,this.id.client,this.id.clock,this.length),Ug(e,r,this.parentSub),this.content.delete(e)}}gc(e,r){if(!this.deleted)throw Gn();this.content.gc(e),r?EO(e,this,new ln(this.id,this.length)):this.content=new aa(this.length)}write(e,r){const n=r>0?ot(this.id.client,this.id.clock+r-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&bc|(n===null?0:Xr)|(i===null?0:hi)|(s===null?0:Vo);if(e.writeInfo(o),n!==null&&e.writeLeftID(n),i!==null&&e.writeRightID(i),n===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=vO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===to?(e.writeParentInfo(!1),e.writeLeftID(a)):Gn();s!==null&&e.writeString(s)}this.content.write(e,r)}}const iy=(t,e)=>_I[e&bc](t),_I=[()=>{Gn()},tI,sI,eI,cI,nI,iI,yI,aI,rI,()=>{Gn()}],bI=10;class un extends nh{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,r){Gn()}write(e,r){e.writeInfo(bI),ft(e.restEncoder,this.length-r)}getMissing(e,r){return null}}const sy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Gs<"u"?Gs:{},oy="__ $YJS$ __";sy[oy]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),sy[oy]=!0;let ay=!1;const Qr=new Qs;function cy(t,e,r){const n=Qr.getMap();if(!n.has(t))switch(e){case 0:case 1:n.set(t,r);break}}function wI(t,e){cy(t,0,e)}function ih(t,e){const r=new mi(e);cy(t,1,r)}function vI(t,e){Qr.getMap().set(t,e)}function EI(t,e){const r=Qr.getMap(),n=new mi(e);r.set(t,n)}function ly(t,e){const r=Qr.getMap();function n(i){const s=r.get(t);for(let o=0;o<i.length;++o)(i[o].target===r||i[o].target===s)&&e(s)}return r.has(t)&&e(r.get(t)),r.observeDeep(n),()=>{r.observeDeep(n)}}function kI(t,e){return ly(t,r=>{Te(r)&&e(r)})}function uy(t,e){return ly(t,r=>{r instanceof mi&&e(r.toJSON())})}const hs=Ws("modem",["second"],t=>{if(hs.session(t))switch(t.target){case"second":!ay&&t.data%2===0&&hs.emit(t.player,"modem:join");break;case"join":t.sender!==hs.id()&&hs.reply(t,"joinack",Bm(_O(Qr)));break;case"joinack":t.sender!==hs.id()&&(ay=!0,xg(Qr,gc(t.data),Qr));break;case"sync":{t.sender!==hs.id()&&v(t.data)&&xg(Qr,gc(t.data),Qr);break}}});function fy(t,e){e!==Qr&&hs.emit("","modem:sync",Bm(t))}Qr.on("update",fy),Qr.on("destroy",()=>{Qr.off("update",fy)});function hy(t,e){return t%e}function dy(t,e){return Math.floor(t/e)}function xI(t,e){return{x:hy(t,e),y:dy(t,e)}}function py(t,e){const r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function Pr(t,e){return t.x+t.y*e}function ao(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function sh(t,e,r,n,i,s){return t>=s&&t<=n&&e>=r&&e<=i}function my(t,e,r,n){const i=[],s=Math.min(t,r),o=Math.max(t,r),a=Math.min(e,n),c=Math.max(e,n);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function gy(t,e,r,n){const i=[],s=Math.abs(r-t),o=Math.abs(n-e),a=t<r?1:-1,c=e<n?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==r||e!==n;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const yy="176",AI="",Sn="srgb",_y="srgb-linear",by="linear",oh="srgb";function Rn(t,e,r){return Math.max(e,Math.min(r,t))}function TI(t,e){return(t%e+e)%e}function ah(t,e,r){return(1-r)*t+r*e}class la{constructor(e=0,r=0){la.prototype.isVector2=!0,this.x=e,this.y=r}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,r){return this.x=e,this.y=r,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,r){switch(e){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this}addScaledVector(e,r){return this.x+=e.x*r,this.y+=e.y*r,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const r=this.x,n=this.y,i=e.elements;return this.x=i[0]*r+i[3]*n+i[6],this.y=i[1]*r+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,r){return this.x=Rn(this.x,e.x,r.x),this.y=Rn(this.y,e.y,r.y),this}clampScalar(e,r){return this.x=Rn(this.x,e,r),this.y=Rn(this.y,e,r),this}clampLength(e,r){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Rn(n,e,r))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const r=Math.sqrt(this.lengthSq()*e.lengthSq());if(r===0)return Math.PI/2;const n=this.dot(e)/r;return Math.acos(Rn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const r=this.x-e.x,n=this.y-e.y;return r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,r){return this.x+=(e.x-this.x)*r,this.y+=(e.y-this.y)*r,this}lerpVectors(e,r,n){return this.x=e.x+(r.x-e.x)*n,this.y=e.y+(r.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,r=0){return this.x=e[r],this.y=e[r+1],this}toArray(e=[],r=0){return e[r]=this.x,e[r+1]=this.y,e}fromBufferAttribute(e,r){return this.x=e.getX(r),this.y=e.getY(r),this}rotateAround(e,r){const n=Math.cos(r),i=Math.sin(r),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*i+e.x,this.y=s*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ua{constructor(e,r,n,i,s,o,a,c,l){ua.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,r,n,i,s,o,a,c,l)}set(e,r,n,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=r,u[4]=s,u[5]=c,u[6]=n,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const r=this.elements,n=e.elements;return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],this}extractBasis(e,r,n){return e.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const r=e.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,r){const n=e.elements,i=r.elements,s=this.elements,o=n[0],a=n[3],c=n[6],l=n[1],u=n[4],h=n[7],d=n[2],f=n[5],m=n[8],p=i[0],g=i[3],y=i[6],b=i[1],A=i[4],S=i[7],x=i[2],B=i[5],I=i[8];return s[0]=o*p+a*b+c*x,s[3]=o*g+a*A+c*B,s[6]=o*y+a*S+c*I,s[1]=l*p+u*b+h*x,s[4]=l*g+u*A+h*B,s[7]=l*y+u*S+h*I,s[2]=d*p+f*b+m*x,s[5]=d*g+f*A+m*B,s[8]=d*y+f*S+m*I,this}multiplyScalar(e){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=e,r[4]*=e,r[7]*=e,r[2]*=e,r[5]*=e,r[8]*=e,this}determinant(){const e=this.elements,r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return r*o*u-r*a*l-n*s*u+n*a*c+i*s*l-i*o*c}invert(){const e=this.elements,r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,m=r*h+n*d+i*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=h*p,e[1]=(i*l-u*n)*p,e[2]=(a*n-i*o)*p,e[3]=d*p,e[4]=(u*r-i*c)*p,e[5]=(i*s-a*r)*p,e[6]=f*p,e[7]=(n*c-l*r)*p,e[8]=(o*r-n*s)*p,this}transpose(){let e;const r=this.elements;return e=r[1],r[1]=r[3],r[3]=e,e=r[2],r[2]=r[6],r[6]=e,e=r[5],r[5]=r[7],r[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const r=this.elements;return e[0]=r[0],e[1]=r[3],e[2]=r[6],e[3]=r[1],e[4]=r[4],e[5]=r[7],e[6]=r[2],e[7]=r[5],e[8]=r[8],this}setUvTransform(e,r,n,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(n*c,n*l,-n*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+r,0,0,1),this}scale(e,r){return this.premultiply(ch.makeScale(e,r)),this}rotate(e){return this.premultiply(ch.makeRotation(-e)),this}translate(e,r){return this.premultiply(ch.makeTranslation(e,r)),this}makeTranslation(e,r){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,r,0,0,1),this}makeRotation(e){const r=Math.cos(e),n=Math.sin(e);return this.set(r,-n,0,n,r,0,0,0,1),this}makeScale(e,r){return this.set(e,0,0,0,r,0,0,0,1),this}equals(e){const r=this.elements,n=e.elements;for(let i=0;i<9;i++)if(r[i]!==n[i])return!1;return!0}fromArray(e,r=0){for(let n=0;n<9;n++)this.elements[n]=e[n+r];return this}toArray(e=[],r=0){const n=this.elements;return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],e[r+4]=n[4],e[r+5]=n[5],e[r+6]=n[6],e[r+7]=n[7],e[r+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ch=new ua,wy=new ua().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),vy=new ua().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function SI(){const t={enabled:!0,workingColorSpace:_y,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===oh&&(i.r=co(i.r),i.g=co(i.g),i.b=co(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===oh&&(i.r=lo(i.r),i.g=lo(i.g),i.b=lo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===AI?by:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],n=[.3127,.329];return t.define({[_y]:{primaries:e,whitePoint:n,transfer:by,toXYZ:wy,fromXYZ:vy,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:Sn},outputColorSpaceConfig:{drawingBufferColorSpace:Sn}},[Sn]:{primaries:e,whitePoint:n,transfer:oh,toXYZ:wy,fromXYZ:vy,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:Sn}}}),t}const On=SI();function co(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function lo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const Ey={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$i={h:0,s:0,l:0},zc={h:0,s:0,l:0};function lh(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*6*(2/3-r):t}class uh{constructor(e,r,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,r,n)}set(e,r,n){if(r===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,r,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,r=Sn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,On.toWorkingColorSpace(this,r),this}setRGB(e,r,n,i=On.workingColorSpace){return this.r=e,this.g=r,this.b=n,On.toWorkingColorSpace(this,i),this}setHSL(e,r,n,i=On.workingColorSpace){if(e=TI(e,1),r=Rn(r,0,1),n=Rn(n,0,1),r===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+r):n+r-n*r,o=2*n-s;this.r=lh(o,s,e+1/3),this.g=lh(o,s,e),this.b=lh(o,s,e-1/3)}return On.toWorkingColorSpace(this,i),this}setStyle(e,r=Sn){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,r);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,r);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,r);if(o===6)return this.setHex(parseInt(s,16),r);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,r);return this}setColorName(e,r=Sn){const n=Ey[e.toLowerCase()];return n!==void 0?this.setHex(n,r):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=co(e.r),this.g=co(e.g),this.b=co(e.b),this}copyLinearToSRGB(e){return this.r=lo(e.r),this.g=lo(e.g),this.b=lo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Sn){return On.fromWorkingColorSpace(Er.copy(this),e),Math.round(Rn(Er.r*255,0,255))*65536+Math.round(Rn(Er.g*255,0,255))*256+Math.round(Rn(Er.b*255,0,255))}getHexString(e=Sn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,r=On.workingColorSpace){On.fromWorkingColorSpace(Er.copy(this),r);const n=Er.r,i=Er.g,s=Er.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case n:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-n)/h+2;break;case s:c=(n-i)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,r=On.workingColorSpace){return On.fromWorkingColorSpace(Er.copy(this),r),e.r=Er.r,e.g=Er.g,e.b=Er.b,e}getStyle(e=Sn){On.fromWorkingColorSpace(Er.copy(this),e);const r=Er.r,n=Er.g,i=Er.b;return e!==Sn?`color(${e} ${r.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(r*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,r,n){return this.getHSL($i),this.setHSL($i.h+e,$i.s+r,$i.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,r){return this.r=e.r+r.r,this.g=e.g+r.g,this.b=e.b+r.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,r){return this.r+=(e.r-this.r)*r,this.g+=(e.g-this.g)*r,this.b+=(e.b-this.b)*r,this}lerpColors(e,r,n){return this.r=e.r+(r.r-e.r)*n,this.g=e.g+(r.g-e.g)*n,this.b=e.b+(r.b-e.b)*n,this}lerpHSL(e,r){this.getHSL($i),e.getHSL(zc);const n=ah($i.h,zc.h,r),i=ah($i.s,zc.s,r),s=ah($i.l,zc.l,r);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const r=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*r+s[3]*n+s[6]*i,this.g=s[1]*r+s[4]*n+s[7]*i,this.b=s[2]*r+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,r=0){return this.r=e[r],this.g=e[r+1],this.b=e[r+2],this}toArray(e=[],r=0){return e[r]=this.r,e[r+1]=this.g,e[r+2]=this.b,e}fromBufferAttribute(e,r){return this.r=e.getX(r),this.g=e.getY(r),this.b=e.getZ(r),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Er=new uh;uh.NAMES=Ey,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:yy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=yy),new la,new la;function $t(t,e,r){return Math.max(e,Math.min(r,t))}function ky(t){return t/180*Math.PI}function xy(t){return t*180/Math.PI}const RI=em("089fad0j9awfem09wavefc09uwaef");function OI(){return RI()}function II(t){return em(t)()}function fn(t,e){const r=Math.min(t,e),i=Math.max(t,e)-r+1;return r+Math.floor(OI()*i)}function Ay(t,e,r){const n=Math.min(e,r),s=Math.max(e,r)-n+1;return n+Math.floor(II(t)*s)}function Ty(t,e,r){typeof r!="number"&&(r=1);const n=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=r)n.push(o);return n}function NI(t){return t[fn(0,t.length-1)]}function CI(t,e){return e[Ay(t,0,e.length-1)]}function hn(...t){return NI(t.flat())}function LI(t,...e){return CI(t,e.flat())}function MI(t){return[...new Set(t)].filter(v)}function ds(t){return v(t)&&v(t.x)&&v(t.y)}function Ct(t,e){switch(e){case Ee.NORTH:--t.y;break;case Ee.SOUTH:++t.y;break;case Ee.WEST:--t.x;break;case Ee.EAST:++t.x;break}return t}function fh(t,e){return t<0?Ee.WEST:t>0?Ee.EAST:e<0?Ee.NORTH:e>0?Ee.SOUTH:Ee.IDLE}function In(t,e){return fh(e.x-t.x,e.y-t.y)}const hh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER",within:"WITHIN",awayby:"AWAYBY"};function en(t){return ut(t)&&Sy(t[0])}function Sy(t){return v(Ee[t])&&be(t)}function Ry(t){const e=Ee[t];return v(e)?e:Ee.IDLE}function Wc(t){if(be(t))return hh[$e(t)]}function UI(t){if(en(t))return t;if(Sy(t))return[t];const e=Wc(t);if(v(e))return[e]}function Oy(t){const e=k.words[t],r=UI(e);return en(r)?[r,t+1]:[void 0,t]}function Iy(t){const e=[];let[r,n]=Oy(t);for(;en(r);){switch(e.push(...r),r[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[a,c,l]=fe(k.words,n,[Z.NUMBER,Z.NUMBER]);e.push(a,c),n=l;break}case"FLEE":case"FIND":{const[a,c]=fe(k.words,n,[Z.KIND]);console.info("kind",a),n=c;break}case"TO":{const[a,c,l]=fe(k.words,n,[Z.DIR,Z.DIR]),u=k.element?.x??0,h=k.element?.y??0;a.destpt.x-=u,a.destpt.y-=h,c.destpt.x-=u,c.destpt.y-=h,e.push(u+a.destpt.x+c.destpt.x,h+a.destpt.y+c.destpt.y),n=l;break}case"WITHIN":case"AWAYBY":{const[a,c]=fe(k.words,n,[Z.NUMBER]);e.push(a),n=c;break}}const i=n;switch(r[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":case"WITHIN":case"AWAYBY":break;default:return[e,n]}const[s,o]=Oy(i);r=s,n=o}return e.length?[e,n]:[void 0,t]}function FI(t){return v(t)&&t<Ke.ONBLACK?t:void 0}function dh(t){return v(t)&&t>Ke.WHITE&&t<Ke.ONCLEAR?t-Ke.ONBLACK:void 0}const fa={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Tr(t){return ut(t)&&Ny(t[0])}function PI(t){return Tr(t)&&t[0].startsWith("ON")}function Ny(t){return v(Ke[t])&&be(t)}function ha(t){if(be(t))return fa[$e(t)]}function uo(t,e){return[v(t)?`${Ke[t]}`:void 0,v(e)?`ON${Ke[e]}`:void 0].filter(v)}function Hc(t){return t.map(e=>Ke[e]).find(e=>v(e)&&e<Ke.ONBLACK)}function Gc(t){return t.map(e=>Ke[e]).find(e=>v(e)&&e>=Ke.ONBLACK)}function BI(t){if(Tr(t))return t;if(Ny(t))return[t];const e=ha(t);if(v(e))return[e]}function Cy(t){const e=k.words[t],r=BI(e);return Tr(r)?[r,t+1]:[void 0,t]}function Kc(t){const e=[];let r=t;const n=parseFloat(k.words[t]);if(Te(n))return[uo(n,void 0),t+1];const[i,s]=Cy(t);Tr(i)&&(e.push(...i),r=s);const[o,a]=Cy(s);return PI(o)&&(e.push(...o),r=a),e.length?[e,r]:[void 0,t]}function Ly(t){const e={};for(let r=0;r<t.length;++r){const n=t[r],i=Ke[n];v(i)&&(i<Ke.ONBLACK?e.color=i:e.bg=dh(i))}return e}var qc={exports:{}},Yc={exports:{}},$I=Yc.exports,My;function DI(){return My||(My=1,(function(t,e){(function(r,n){t.exports=n()})($I,function(){function r(p){return!isNaN(parseFloat(p))&&isFinite(p)}function n(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(p){if(p)for(var g=0;g<u.length;g++)p[u[g]]!==void 0&&this["set"+n(u[g])](p[u[g]])}h.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof h)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new h(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",g=this.getLineNumber()||"",y=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+g+":"+y+")":"[eval]:"+g+":"+y:b?b+" ("+p+":"+g+":"+y+")":p+":"+g+":"+y}},h.fromString=function(g){var y=g.indexOf("("),b=g.lastIndexOf(")"),A=g.substring(0,y),S=g.substring(y+1,b).split(","),x=g.substring(b+1);if(x.indexOf("@")===0)var B=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(x,""),I=B[1],U=B[2],$=B[3];return new h({functionName:A,args:S||void 0,fileName:I,lineNumber:U||void 0,columnNumber:$||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+n(s[d])]=i(s[d]),h.prototype["set"+n(s[d])]=(function(p){return function(g){this[p]=!!g}})(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+n(o[f])]=i(o[f]),h.prototype["set"+n(o[f])]=(function(p){return function(g){if(!r(g))throw new TypeError(p+" must be a Number");this[p]=Number(g)}})(o[f]);for(var m=0;m<a.length;m++)h.prototype["get"+n(a[m])]=i(a[m]),h.prototype["set"+n(a[m])]=(function(p){return function(g){this[p]=String(g)}})(a[m]);return h})})(Yc)),Yc.exports}var jI=qc.exports,Uy;function zI(){return Uy||(Uy=1,(function(t,e){(function(r,n){t.exports=n(DI())})(jI,function(n){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),m=d&&h||void 0,p=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new n({functionName:m,fileName:p,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new n({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(h,""));return new n({functionName:f,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new n({fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new n({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",m=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;f.match(/\(([^)]*)\)/)&&(p=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new n({functionName:m,args:g,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(qc)),qc.exports}var WI=zI(),HI=js(WI);const Ce=60,et=25,ph=Ce*et;var Re=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Re||{});const mh=14,Vc=3,ps=8,ms=14,Xc=16,GI=16,KI=16;var Zc=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(Zc||{});function da(t,e){return new Array(t).fill(e)}function qI(t,e,r,n,i,s=0){const o=n*i;return{id:`tiles:${t}:${e}`,type:1,tag:r,width:n,height:i,char:da(o,0),color:da(o,0),bg:da(o,s),wall:da(o,0)}}function YI(t,e,r,n=1,i=15){return{id:`sprites:${t}:${e}:${r}`,x:0,y:0,char:n,color:i,bg:Ke.ONCLEAR}}function VI(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function XI(t,e,r,n,i=0){const s=r*n;return{id:`dither:${t}:${e}`,type:3,width:r,height:n,alphas:da(s,i)}}function ZI(t,e,r,n){return{id:`media:${t}:${e}`,type:4,mime:r,media:n}}function JI(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function Fy(t,e){return`${t}:${e}`}const QI=1,eN=16,tN=256;var Sr=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Sr||{});const Xn=!!JSON.parse("false"),rN=!!JSON.parse("false");JSON.parse("false");const Py=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const gs={HALT_AT_COUNT:256},le=Ws("SOFTWARE");function yi(t){const e={},r={everytick(){},aftertick(){},listcommands(){return Mr(e)},...t,getcommand(n){return e[n]},command(n,i){return e[n]=i,r}};return r}function Br(t,e,r,n){const[i,s]=fe(n,0,[Z.NUMBER_OR_STRING,Z.MAYBE_NUMBER_OR_STRING]);Em(le,t,e,r,i,s)}const nN=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function gh(t,e,r){const[n,i]=fe(r,0,[Z.NUMBER_OR_STRING]);if(Te(n))ff(le,t,e,"volume",n);else if(nN.includes($e(n))){const[s,o]=fe(r,i,[Z.NUMBER_OR_STRING,Z.MAYBE_NUMBER_OR_STRING]);Em(le,t,e,n,s,o)}else{const[s]=fe(r,i,[Z.MAYBE_NUMBER_OR_STRING]);if(Te(s)){const o=r.length-i,a=new Array(o).fill(Z.NUMBER),c=fe(r,i,a).slice(0,o),l=c.length===1?c[0]:c;ff(le,t,e,n,l)}else{const[o]=fe(r,i,[Z.MAYBE_NUMBER_OR_STRING]);ff(le,t,e,n,o)}}}function Di(t,e){const[r]=fe(t,0,[Z.MAYBE_NAME]);mS(le,k.elementfocus,k.board?.id??"",r??"",e)}const Jc=yi().command("tts",(t,e)=>{const[r,n]=fe(e,0,[Z.STRING,Z.STRING]);return hS(le,k.elementfocus,r,n),0}).command("ttsqueue",(t,e)=>{const[r,n]=fe(e,0,[Z.STRING,Z.STRING]);return dS(le,k.elementfocus,r,n),0}).command("bpm",(t,e)=>{const[r]=fe(e,0,[Z.NUMBER]);return gS(le,k.elementfocus,r),0}).command("vol",(t,e)=>{const[r]=fe(e,0,[Z.NUMBER]);return yS(le,k.elementfocus,r),0}).command("bgvol",(t,e)=>{const[r]=fe(e,0,[Z.NUMBER]);return _S(le,k.elementfocus,r),0}).command("ttsvol",(t,e)=>{const[r]=fe(e,0,[Z.NUMBER]);return bS(le,k.elementfocus,r),0}).command("play",(t,e)=>{const[r]=fe(e,0,[Z.MAYBE_NAME]);return pS(le,k.elementfocus,k.board?.id??"",r??""),0}).command("bgplay",(t,e)=>(Di(e,""),0)).command("bgplayon64n",(t,e)=>(Di(e,"@64n"),0)).command("bgplayon32n",(t,e)=>(Di(e,"@32n"),0)).command("bgplayon16n",(t,e)=>(Di(e,"@16n"),0)).command("bgplayon8n",(t,e)=>(Di(e,"@8n"),0)).command("bgplayon4n",(t,e)=>(Di(e,"@4n"),0)).command("bgplayon2n",(t,e)=>(Di(e,"@2n"),0)).command("bgplayon1n",(t,e)=>(Di(e,"@1m"),0)).command("synth",(t,e)=>{for(let r=0;r<4;++r)gh(k.elementfocus,r,e);return 0}).command("synthrecord",(t,e)=>{const[r]=fe(e,0,[Z.MAYBE_STRING]);return wS(le,k.elementfocus,r??""),0}).command("synthflush",()=>(vS(le,k.elementfocus),0)).command("echo",(t,e)=>{for(let r=0;r<2;++r)Br(k.elementfocus,r,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let r=0;r<2;++r)Br(k.elementfocus,r,"fc",e);return 0}).command("phaser",(t,e)=>{for(let r=0;r<2;++r)Br(k.elementfocus,r,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let r=0;r<2;++r)Br(k.elementfocus,r,"reverb",e);return 0}).command("distort",(t,e)=>{for(let r=0;r<2;++r)Br(k.elementfocus,r,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let r=0;r<2;++r)Br(k.elementfocus,r,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let r=0;r<2;++r)Br(k.elementfocus,r,"autowah",e);return 0});for(let t=0;t<4;++t)Jc.command(`synth${t+1}`,(e,r)=>(gh(k.elementfocus,t,r),0));Jc.command("synth5",(t,e)=>{for(let r=4;r<8;++r)gh(k.elementfocus,r,e);return 0});for(let t=0;t<3;++t){const e=t+1;Jc.command(`echo${e}`,(r,n)=>(Br(k.elementfocus,t,"echo",n),0)).command(`fcrush${e}`,(r,n)=>(Br(k.elementfocus,t,"fcrush",n),0)).command(`phaser${e}`,(r,n)=>(Br(k.elementfocus,t,"phaser",n),0)).command(`reverb${e}`,(r,n)=>(Br(k.elementfocus,t,"reverb",n),0)).command(`distort${e}`,(r,n)=>(Br(k.elementfocus,t,"distort",n),0)).command(`vibrato${e}`,(r,n)=>(Br(k.elementfocus,t,"vibrato",n),0)).command(`autowah${e}`,(r,n)=>(Br(k.elementfocus,t,"autowah",n),0))}var yh;try{yh=new TextDecoder}catch{}var Ie,Zn,te=0,wt={},at,ji,dn=0,Jn=0,ir,_i,$r=[],st,By={useRecords:!1,mapsAsObjects:!0};class $y{}const Dy=new $y;Dy.name="MessagePack 0xC1";var zi=!1,jy=2,iN;try{new Function("")}catch{jy=1/0}class pa{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,r){if(Ie)return t_(()=>(Eh(),this?this.unpack(e,r):pa.prototype.unpack.call(By,e,r)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Vt<"u"?Vt.from(e):new Uint8Array(e)),typeof r=="object"?(Zn=r.end||e.length,te=r.start||0):(te=0,Zn=r>-1?r:e.length),Jn=0,ji=null,ir=null,Ie=e;try{st=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(n){throw Ie=null,e instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof pa){if(wt=this,this.structures)return at=this.structures,Qc(r);(!at||at.length>0)&&(at=[])}else wt=By,(!at||at.length>0)&&(at=[]);return Qc(r)}unpackMultiple(e,r){let n,i=0;try{zi=!0;let s=e.length,o=this?this.unpack(e,s):el.unpack(e,s);if(r){if(r(o,i,te)===!1)return;for(;te<s;)if(i=te,r(Qc(),i,te)===!1)return}else{for(n=[o];te<s;)i=te,n.push(Qc());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{zi=!1,Eh()}}_mergeStructures(e,r){e=e||[],Object.isFrozen(e)&&(e=e.map(n=>n.slice(0)));for(let n=0,i=e.length;n<i;n++){let s=e[n];s&&(s.isShared=!0,n>=32&&(s.highByte=n-32>>5))}e.sharedLength=e.length;for(let n in r||[])if(n>=0){let i=e[n],s=r[n];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[n]=i),e[n]=s)}return this.structures=e}decode(e,r){return this.unpack(e,r)}}function Qc(t){try{if(!wt.trusted&&!zi){let r=at.sharedLength||0;r<at.length&&(at.length=r)}let e;if(wt.randomAccessStructure&&Ie[te]<64&&Ie[te]>=32&&iN||(e=Dt()),ir&&(te=ir.postBundlePosition,ir=null),zi&&(at.restoreStructures=null),te==Zn)at&&at.restoreStructures&&zy(),at=null,Ie=null,_i&&(_i=null);else{if(te>Zn)throw new Error("Unexpected end of MessagePack data");if(!zi){let r;try{r=JSON.stringify(e,(n,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return e}catch(e){throw at&&at.restoreStructures&&zy(),Eh(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||te>Zn)&&(e.incomplete=!0),e}}function zy(){for(let t in at.restoreStructures)at[t]=at.restoreStructures[t];at.restoreStructures=null}function Dt(){let t=Ie[te++];if(t<160)if(t<128){if(t<64)return t;{let e=at[t&63]||wt.getStructures&&Hy()[t&63];return e?(e.read||(e.read=_h(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,wt.mapsAsObjects){let e={};for(let r=0;r<t;r++){let n=Xy();n==="__proto__"&&(n="__proto_"),e[n]=Dt()}return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(Dt(),Dt());return e}else{t-=144;let e=new Array(t);for(let r=0;r<t;r++)e[r]=Dt();return wt.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(Jn>=te)return ji.slice(te-dn,(te+=e)-dn);if(Jn==0&&Zn<140){let r=e<16?wh(e):qy(e);if(r!=null)return r}return bh(e)}else{let e;switch(t){case 192:return null;case 193:return ir?(e=Dt(),e>0?ir[1].slice(ir.position1,ir.position1+=e):ir[0].slice(ir.position0,ir.position0-=e)):Dy;case 194:return!1;case 195:return!0;case 196:if(e=Ie[te++],e===void 0)throw new Error("Unexpected end of buffer");return vh(e);case 197:return e=st.getUint16(te),te+=2,vh(e);case 198:return e=st.getUint32(te),te+=4,vh(e);case 199:return ys(Ie[te++]);case 200:return e=st.getUint16(te),te+=2,ys(e);case 201:return e=st.getUint32(te),te+=4,ys(e);case 202:if(e=st.getFloat32(te),wt.useFloat32>2){let r=kh[(Ie[te]&127)<<1|Ie[te+1]>>7];return te+=4,(r*e+(e>0?.5:-.5)>>0)/r}return te+=4,e;case 203:return e=st.getFloat64(te),te+=8,e;case 204:return Ie[te++];case 205:return e=st.getUint16(te),te+=2,e;case 206:return e=st.getUint32(te),te+=4,e;case 207:return wt.int64AsType==="number"?(e=st.getUint32(te)*4294967296,e+=st.getUint32(te+4)):wt.int64AsType==="string"?e=st.getBigUint64(te).toString():wt.int64AsType==="auto"?(e=st.getBigUint64(te),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=st.getBigUint64(te),te+=8,e;case 208:return st.getInt8(te++);case 209:return e=st.getInt16(te),te+=2,e;case 210:return e=st.getInt32(te),te+=4,e;case 211:return wt.int64AsType==="number"?(e=st.getInt32(te)*4294967296,e+=st.getUint32(te+4)):wt.int64AsType==="string"?e=st.getBigInt64(te).toString():wt.int64AsType==="auto"?(e=st.getBigInt64(te),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=st.getBigInt64(te),te+=8,e;case 212:if(e=Ie[te++],e==114)return Jy(Ie[te++]&63);{let r=$r[e];if(r)return r.read?(te++,r.read(Dt())):r.noBuffer?(te++,r()):r(Ie.subarray(te,++te));throw new Error("Unknown extension "+e)}case 213:return e=Ie[te],e==114?(te++,Jy(Ie[te++]&63,Ie[te++])):ys(2);case 214:return ys(4);case 215:return ys(8);case 216:return ys(16);case 217:return e=Ie[te++],Jn>=te?ji.slice(te-dn,(te+=e)-dn):oN(e);case 218:return e=st.getUint16(te),te+=2,Jn>=te?ji.slice(te-dn,(te+=e)-dn):aN(e);case 219:return e=st.getUint32(te),te+=4,Jn>=te?ji.slice(te-dn,(te+=e)-dn):cN(e);case 220:return e=st.getUint16(te),te+=2,Gy(e);case 221:return e=st.getUint32(te),te+=4,Gy(e);case 222:return e=st.getUint16(te),te+=2,Ky(e);case 223:return e=st.getUint32(te),te+=4,Ky(e);default:if(t>=224)return t-256;if(t===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+t)}}}const sN=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function _h(t,e){function r(){if(r.count++>jy){let i=t.read=new Function("r","return function(){return "+(wt.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":sN.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Dt);return t.highByte===0&&(t.read=Wy(e,t.read)),i()}let n={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),n[o]=Dt()}return wt.freezeData?Object.freeze(n):n}return r.count=0,t.highByte===0?Wy(e,r):r}const Wy=(t,e)=>function(){let r=Ie[te++];if(r===0)return e();let n=t<32?-(t+(r<<5)):t+(r<<5),i=at[n]||Hy()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=_h(i,t)),i.read()};function Hy(){let t=t_(()=>(Ie=null,wt.getStructures()));return at=wt._mergeStructures(t,at)}var bh=ma,oN=ma,aN=ma,cN=ma;function ma(t){let e;if(t<16&&(e=wh(t)))return e;if(t>64&&yh)return yh.decode(Ie.subarray(te,te+=t));const r=te+t,n=[];for(e="";te<r;){const i=Ie[te++];if((i&128)===0)n.push(i);else if((i&224)===192){const s=Ie[te++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=Ie[te++]&63,o=Ie[te++]&63;n.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Ie[te++]&63,o=Ie[te++]&63,a=Ie[te++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c)}else n.push(i);n.length>=4096&&(e+=sr.apply(String,n),n.length=0)}return n.length>0&&(e+=sr.apply(String,n)),e}function Gy(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=Dt();return wt.freezeData?Object.freeze(e):e}function Ky(t){if(wt.mapsAsObjects){let e={};for(let r=0;r<t;r++){let n=Xy();n==="__proto__"&&(n="__proto_"),e[n]=Dt()}return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(Dt(),Dt());return e}}var sr=String.fromCharCode;function qy(t){let e=te,r=new Array(t);for(let n=0;n<t;n++){const i=Ie[te++];if((i&128)>0){te=e;return}r[n]=i}return sr.apply(String,r)}function wh(t){if(t<4)if(t<2){if(t===0)return"";{let e=Ie[te++];if((e&128)>1){te-=1;return}return sr(e)}}else{let e=Ie[te++],r=Ie[te++];if((e&128)>0||(r&128)>0){te-=2;return}if(t<3)return sr(e,r);let n=Ie[te++];if((n&128)>0){te-=3;return}return sr(e,r,n)}else{let e=Ie[te++],r=Ie[te++],n=Ie[te++],i=Ie[te++];if((e&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){te-=4;return}if(t<6){if(t===4)return sr(e,r,n,i);{let s=Ie[te++];if((s&128)>0){te-=5;return}return sr(e,r,n,i,s)}}else if(t<8){let s=Ie[te++],o=Ie[te++];if((s&128)>0||(o&128)>0){te-=6;return}if(t<7)return sr(e,r,n,i,s,o);let a=Ie[te++];if((a&128)>0){te-=7;return}return sr(e,r,n,i,s,o,a)}else{let s=Ie[te++],o=Ie[te++],a=Ie[te++],c=Ie[te++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){te-=8;return}if(t<10){if(t===8)return sr(e,r,n,i,s,o,a,c);{let l=Ie[te++];if((l&128)>0){te-=9;return}return sr(e,r,n,i,s,o,a,c,l)}}else if(t<12){let l=Ie[te++],u=Ie[te++];if((l&128)>0||(u&128)>0){te-=10;return}if(t<11)return sr(e,r,n,i,s,o,a,c,l,u);let h=Ie[te++];if((h&128)>0){te-=11;return}return sr(e,r,n,i,s,o,a,c,l,u,h)}else{let l=Ie[te++],u=Ie[te++],h=Ie[te++],d=Ie[te++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){te-=12;return}if(t<14){if(t===12)return sr(e,r,n,i,s,o,a,c,l,u,h,d);{let f=Ie[te++];if((f&128)>0){te-=13;return}return sr(e,r,n,i,s,o,a,c,l,u,h,d,f)}}else{let f=Ie[te++],m=Ie[te++];if((f&128)>0||(m&128)>0){te-=14;return}if(t<15)return sr(e,r,n,i,s,o,a,c,l,u,h,d,f,m);let p=Ie[te++];if((p&128)>0){te-=15;return}return sr(e,r,n,i,s,o,a,c,l,u,h,d,f,m,p)}}}}}function Yy(){let t=Ie[te++],e;if(t<192)e=t-160;else switch(t){case 217:e=Ie[te++];break;case 218:e=st.getUint16(te),te+=2;break;case 219:e=st.getUint32(te),te+=4;break;default:throw new Error("Expected string")}return ma(e)}function vh(t){return wt.copyBuffers?Uint8Array.prototype.slice.call(Ie,te,te+=t):Ie.subarray(te,te+=t)}function ys(t){let e=Ie[te++];if($r[e]){let r;return $r[e](Ie.subarray(te,r=te+=t),n=>{te=n;try{return Dt()}finally{te=r}})}else throw new Error("Unknown extension type "+e)}var Vy=new Array(4096);function Xy(){let t=Ie[te++];if(t>=160&&t<192){if(t=t-160,Jn>=te)return ji.slice(te-dn,(te+=t)-dn);if(!(Jn==0&&Zn<180))return bh(t)}else return te--,Zy(Dt());let e=(t<<5^(t>1?st.getUint16(te):t>0?Ie[te]:0))&4095,r=Vy[e],n=te,i=te+t-3,s,o=0;if(r&&r.bytes==t){for(;n<i;){if(s=st.getUint32(n),s!=r[o++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(s=Ie[n++],s!=r[o++]){n=1879048192;break}if(n===i)return te=n,r.string;i-=3,n=te}for(r=[],Vy[e]=r,r.bytes=t;n<i;)s=st.getUint32(n),r.push(s),n+=4;for(i+=3;n<i;)s=Ie[n++],r.push(s);let a=t<16?wh(t):qy(t);return a!=null?r.string=a:r.string=bh(t)}function Zy(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";if(wt.allowArraysInMapKeys&&Array.isArray(t)&&t.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return t.flat().toString();throw new Error(`Invalid property type for record: ${typeof t}`)}const Jy=(t,e)=>{let r=Dt().map(Zy),n=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,r.highByte=e);let i=at[t];return i&&(i.isShared||zi)&&((at.restoreStructures||(at.restoreStructures=[]))[t]=i),at[t]=r,r.read=_h(r,n),r.read()};$r[0]=()=>{},$r[0].noBuffer=!0,$r[66]=t=>{let e=t.byteLength%8||8,r=BigInt(t[0]&128?t[0]-256:t[0]);for(let n=1;n<e;n++)r<<=BigInt(8),r+=BigInt(t[n]);if(t.byteLength!==e){let n=new DataView(t.buffer,t.byteOffset,t.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=n.getBigUint64(s);for(let d=s+8;d<o;d+=8)h<<=64n,h|=n.getBigUint64(d);return h}let c=s+(a>>4<<3),l=i(s,c),u=i(c,o);return l<<BigInt((o-c)*8)|u};r=r<<BigInt((n.byteLength-e)*8)|i(e,n.byteLength)}return r};let Qy={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};$r[101]=()=>{let t=Dt();if(!Qy[t[0]]){let e=Error(t[1],{cause:t[2]});return e.name=t[0],e}return Qy[t[0]](t[1],{cause:t[2]})},$r[105]=t=>{if(wt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=st.getUint32(te-4);_i||(_i=new Map);let r=Ie[te],n;r>=144&&r<160||r==220||r==221?n=[]:r>=128&&r<144||r==222||r==223?n=new Map:(r>=199&&r<=201||r>=212&&r<=216)&&Ie[te+1]===115?n=new Set:n={};let i={target:n};_i.set(e,i);let s=Dt();if(i.used)Object.assign(n,s);else return i.target=s;if(n instanceof Map)for(let[o,a]of s.entries())n.set(o,a);if(n instanceof Set)for(let o of Array.from(s))n.add(o);return n},$r[112]=t=>{if(wt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=st.getUint32(te-4),r=_i.get(e);return r.used=!0,r.target},$r[115]=()=>new Set(Dt());const e_=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let lN=typeof globalThis=="object"?globalThis:window;$r[116]=t=>{let e=t[0],r=Uint8Array.prototype.slice.call(t,1).buffer,n=e_[e];if(!n){if(e===16)return r;if(e===17)return new DataView(r);throw new Error("Could not find typed array for code "+e)}return new lN[n](r)},$r[120]=()=>{let t=Dt();return new RegExp(t[0],t[1])};const uN=[];$r[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],r=te;return te+=e-t.length,ir=uN,ir=[Yy(),Yy()],ir.position0=0,ir.position1=0,ir.postBundlePosition=te,te=r,Dt()},$r[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function t_(t){let e=Zn,r=te,n=dn,i=Jn,s=ji,o=_i,a=ir,c=new Uint8Array(Ie.slice(0,Zn)),l=at,u=at.slice(0,at.length),h=wt,d=zi,f=t();return Zn=e,te=r,dn=n,Jn=i,ji=s,_i=o,ir=a,Ie=c,zi=d,at=l,at.splice(0,at.length,...u),wt=h,st=new DataView(Ie.buffer,Ie.byteOffset,Ie.byteLength),f}function Eh(){Ie=null,_i=null,at=null}const kh=new Array(147);for(let t=0;t<256;t++)kh[t]=+("1e"+Math.floor(45.15-t*.30103));var el=new pa({useRecords:!1});const fN=el.unpack;el.unpackMultiple,el.unpack;let hN=new Float32Array(1);new Uint8Array(hN.buffer,0,4);let tl;try{tl=new TextEncoder}catch{}let xh,r_;const fo=typeof Vt<"u",rl=fo?function(t){return Vt.allocUnsafeSlow(t)}:Uint8Array,n_=fo?Vt:Uint8Array,i_=fo?4294967296:2144337920;let ae,ga,_t,ne=0,kr,Ot=null,dN;const pN=21760,mN=/[\u0080-\uFFFF]/,ho=Symbol("record-id");class gN extends pa{constructor(e){super(e),this.offset=0;let r,n,i,s,o=n_.prototype.utf8Write?function(O,w){return ae.utf8Write(O,w,ae.byteLength-w)}:tl&&tl.encodeInto?function(O,w){return tl.encodeInto(O,ae.subarray(w)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,m=u+h+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],g=0,y=0;this.pack=this.encode=function(O,w){if(ae||(ae=new rl(8192),_t=ae.dataView||(ae.dataView=new DataView(ae.buffer,0,8192)),ne=0),kr=ae.length-10,kr-ne<2048?(ae=new rl(ae.length),_t=ae.dataView||(ae.dataView=new DataView(ae.buffer,0,ae.length)),kr=ae.length-10,ne=0):ne=ne+7&2147483640,r=ne,w&EN&&(ne+=w&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof O!="string"?(Ot=[],Ot.size=1/0):Ot=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let W=i.sharedLength||0;if(W>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let P=0;P<W;P++){let V=i[P];if(!V)continue;let J,N=i.transitions;for(let L=0,F=V.length;L<F;L++){let Y=V[L];J=N[Y],J||(J=N[Y]=Object.create(null)),N=J}N[ho]=P+64}this.lastNamedStructuresLength=W}c||(i.nextId=W+64)}n&&(n=!1);let C;try{a.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?R(O):S(O);let W=Ot;if(Ot&&o_(r,S,0),s&&s.idsToInsert){let P=s.idsToInsert.sort((L,F)=>L.offset>F.offset?1:-1),V=P.length,J=-1;for(;W&&V>0;){let L=P[--V].offset+r;L<W.stringsPosition+r&&J===-1&&(J=0),L>W.position+r?J>=0&&(J+=6):(J>=0&&(_t.setUint32(W.position+r,_t.getUint32(W.position+r)+J),J=-1),W=W.previous,V++)}J>=0&&W&&_t.setUint32(W.position+r,_t.getUint32(W.position+r)+J),ne+=P.length*6,ne>kr&&$(ne),a.offset=ne;let N=yN(ae.subarray(r,ne),P);return s=null,N}return a.offset=ne,w&wN?(ae.start=r,ae.end=ne,ae):ae.subarray(r,ne)}catch(W){throw C=W,W}finally{if(i&&(b(),n&&a.saveStructures)){let W=i.sharedLength||0,P=ae.subarray(r,ne),V=_N(i,a);if(!C)return a.saveStructures(V,V.isCompatible)===!1?a.pack(O,w):(a.lastNamedStructuresLength=W,ae.length>1073741824&&(ae=null),P)}ae.length>1073741824&&(ae=null),w&vN&&(ne=r)}};const b=()=>{y<10&&y++;let O=i.sharedLength||0;if(i.length>O&&!c&&(i.length=O),g>1e4)i.transitions=null,y=0,g=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let w=0,C=p.length;w<C;w++)p[w][ho]=0;p=[]}},A=O=>{var w=O.length;w<16?ae[ne++]=144|w:w<65536?(ae[ne++]=220,ae[ne++]=w>>8,ae[ne++]=w&255):(ae[ne++]=221,_t.setUint32(ne,w),ne+=4);for(let C=0;C<w;C++)S(O[C])},S=O=>{ne>kr&&(ae=$(ne));var w=typeof O,C;if(w==="string"){let W=O.length;if(Ot&&W>=4&&W<4096){if((Ot.size+=W)>pN){let N,L=(Ot[0]?Ot[0].length*3+Ot[1].length:0)+10;ne+L>kr&&(ae=$(ne+L));let F;Ot.position?(F=Ot,ae[ne]=200,ne+=3,ae[ne++]=98,N=ne-r,ne+=4,o_(r,S,0),_t.setUint16(N+r-3,ne-r-N)):(ae[ne++]=214,ae[ne++]=98,N=ne-r,ne+=4),Ot=["",""],Ot.previous=F,Ot.size=0,Ot.position=N}let J=mN.test(O);Ot[J?0:1]+=O,ae[ne++]=193,S(J?-W:W);return}let P;W<32?P=1:W<256?P=2:W<65536?P=3:P=5;let V=W*3;if(ne+V>kr&&(ae=$(ne+V)),W<64||!o){let J,N,L,F=ne+P;for(J=0;J<W;J++)N=O.charCodeAt(J),N<128?ae[F++]=N:N<2048?(ae[F++]=N>>6|192,ae[F++]=N&63|128):(N&64512)===55296&&((L=O.charCodeAt(J+1))&64512)===56320?(N=65536+((N&1023)<<10)+(L&1023),J++,ae[F++]=N>>18|240,ae[F++]=N>>12&63|128,ae[F++]=N>>6&63|128,ae[F++]=N&63|128):(ae[F++]=N>>12|224,ae[F++]=N>>6&63|128,ae[F++]=N&63|128);C=F-ne-P}else C=o(O,ne+P);C<32?ae[ne++]=160|C:C<256?(P<2&&ae.copyWithin(ne+2,ne+1,ne+1+C),ae[ne++]=217,ae[ne++]=C):C<65536?(P<3&&ae.copyWithin(ne+3,ne+2,ne+2+C),ae[ne++]=218,ae[ne++]=C>>8,ae[ne++]=C&255):(P<5&&ae.copyWithin(ne+5,ne+3,ne+3+C),ae[ne++]=219,_t.setUint32(ne,C),ne+=4),ne+=C}else if(w==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?ae[ne++]=O:O<256?(ae[ne++]=204,ae[ne++]=O):O<65536?(ae[ne++]=205,ae[ne++]=O>>8,ae[ne++]=O&255):(ae[ne++]=206,_t.setUint32(ne,O),ne+=4);else if(O>>0===O)O>=-32?ae[ne++]=256+O:O>=-128?(ae[ne++]=208,ae[ne++]=O+256):O>=-32768?(ae[ne++]=209,_t.setInt16(ne,O),ne+=2):(ae[ne++]=210,_t.setInt32(ne,O),ne+=4);else{let W;if((W=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){ae[ne++]=202,_t.setFloat32(ne,O);let P;if(W<4||(P=O*kh[(ae[ne]&127)<<1|ae[ne+1]>>7])>>0===P){ne+=4;return}else ne--}ae[ne++]=203,_t.setFloat64(ne,O),ne+=8}else if(w==="object"||w==="function")if(!O)ae[ne++]=192;else{if(s){let P=s.get(O);if(P){if(!P.id){let V=s.idsToInsert||(s.idsToInsert=[]);P.id=V.push(P)}ae[ne++]=214,ae[ne++]=112,_t.setUint32(ne,P.id),ne+=4;return}else s.set(O,{offset:ne-r})}let W=O.constructor;if(W===Object)U(O);else if(W===Array)A(O);else if(W===Map)if(this.mapAsEmptyObject)ae[ne++]=128;else{C=O.size,C<16?ae[ne++]=128|C:C<65536?(ae[ne++]=222,ae[ne++]=C>>8,ae[ne++]=C&255):(ae[ne++]=223,_t.setUint32(ne,C),ne+=4);for(let[P,V]of O)S(P),S(V)}else{for(let P=0,V=xh.length;P<V;P++){let J=r_[P];if(O instanceof J){let N=xh[P];if(N.write){N.type&&(ae[ne++]=212,ae[ne++]=N.type,ae[ne++]=0);let Q=N.write.call(this,O);Q===O?Array.isArray(O)?A(O):U(O):S(Q);return}let L=ae,F=_t,Y=ne;ae=null;let K;try{K=N.pack.call(this,O,Q=>(ae=L,L=null,ne+=Q,ne>kr&&$(ne),{target:ae,targetView:_t,position:ne-Q}),S)}finally{L&&(ae=L,_t=F,ne=Y,kr=ae.length-10)}K&&(K.length+ne>kr&&$(K.length+ne),ne=s_(K,ae,ne,N.type));return}}if(Array.isArray(O))A(O);else{if(O.toJSON){const P=O.toJSON();if(P!==O)return S(P)}if(w==="function")return S(this.writeFunction&&this.writeFunction(O));U(O)}}}else if(w==="boolean")ae[ne++]=O?195:194;else if(w==="bigint"){if(O<9223372036854776e3&&O>=-9223372036854776e3)ae[ne++]=211,_t.setBigInt64(ne,O);else if(O<18446744073709552e3&&O>0)ae[ne++]=207,_t.setBigUint64(ne,O);else if(this.largeBigIntToFloat)ae[ne++]=203,_t.setFloat64(ne,Number(O));else{if(this.largeBigIntToString)return S(O.toString());if(this.useBigIntExtension||this.moreTypes){let W=O<0?BigInt(-1):BigInt(0),P;if(O>>BigInt(65536)===W){let V=BigInt(18446744073709552e3)-BigInt(1),J=[];for(;J.push(O&V),O>>BigInt(63)!==W;)O>>=BigInt(64);P=new Uint8Array(new BigUint64Array(J).buffer),P.reverse()}else{let V=O<0,J=(V?~O:O).toString(16);if(J.length%2?J="0"+J:parseInt(J.charAt(0),16)>=8&&(J="00"+J),fo)P=Vt.from(J,"hex");else{P=new Uint8Array(J.length/2);for(let N=0;N<P.length;N++)P[N]=parseInt(J.slice(N*2,N*2+2),16)}if(V)for(let N=0;N<P.length;N++)P[N]=~P[N]}P.length+ne>kr&&$(P.length+ne),ne=s_(P,ae,ne,66);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}ne+=8}else if(w==="undefined")this.encodeUndefinedAsNil?ae[ne++]=192:(ae[ne++]=212,ae[ne++]=0,ae[ne++]=0);else throw new Error("Unknown type: "+w)},x=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let w;if(this.skipValues){w=[];for(let P in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(P))&&!this.skipValues.includes(O[P])&&w.push(P)}else w=Object.keys(O);let C=w.length;C<16?ae[ne++]=128|C:C<65536?(ae[ne++]=222,ae[ne++]=C>>8,ae[ne++]=C&255):(ae[ne++]=223,_t.setUint32(ne,C),ne+=4);let W;if(this.coercibleKeyAsNumber)for(let P=0;P<C;P++){W=w[P];let V=Number(W);S(isNaN(V)?W:V),S(O[W])}else for(let P=0;P<C;P++)S(W=w[P]),S(O[W])}:O=>{ae[ne++]=222;let w=ne-r;ne+=2;let C=0;for(let W in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(W))&&(S(W),S(O[W]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');ae[w+++r]=C>>8,ae[w+r]=C&255},B=this.useRecords===!1?x:e.progressiveRecords&&!d?O=>{let w,C=i.transitions||(i.transitions=Object.create(null)),W=ne++-r,P;for(let V in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(V)){if(w=C[V],w)C=w;else{let J=Object.keys(O),N=C;C=i.transitions;let L=0;for(let F=0,Y=J.length;F<Y;F++){let K=J[F];w=C[K],w||(w=C[K]=Object.create(null),L++),C=w}W+r+1==ne?(ne--,j(C,J,L)):q(C,J,W,L),P=!0,C=N[V]}S(O[V])}if(!P){let V=C[ho];V?ae[W+r]=V:q(C,Object.keys(O),W,0)}}:O=>{let w,C=i.transitions||(i.transitions=Object.create(null)),W=0;for(let V in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(V))&&(w=C[V],w||(w=C[V]=Object.create(null),W++),C=w);let P=C[ho];P?P>=96&&d?(ae[ne++]=((P-=96)&31)+96,ae[ne++]=P>>5):ae[ne++]=P:j(C,C.__keys__||Object.keys(O),W);for(let V in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(V))&&S(O[V])},I=typeof this.useRecords=="function"&&this.useRecords,U=I?O=>{I(O)?B(O):x(O)}:B,$=O=>{let w;if(O>16777216){if(O-r>i_)throw new Error("Packed buffer would be larger than maximum buffer size");w=Math.min(i_,Math.round(Math.max((O-r)*(O>67108864?1.25:2),4194304)/4096)*4096)}else w=(Math.max(O-r<<2,ae.length-1)>>12)+1<<12;let C=new rl(w);return _t=C.dataView||(C.dataView=new DataView(C.buffer,0,w)),O=Math.min(O,ae.length),ae.copy?ae.copy(C,0,r,O):C.set(ae.slice(r,O)),ne-=r,r=0,kr=C.length-10,ae=C},j=(O,w,C)=>{let W=i.nextId;W||(W=64),W<f&&this.shouldShareStructure&&!this.shouldShareStructure(w)?(W=i.nextOwnId,W<m||(W=f),i.nextOwnId=W+1):(W>=m&&(W=f),i.nextId=W+1);let P=w.highByte=W>=96&&d?W-96>>5:-1;O[ho]=W,O.__keys__=w,i[W-64]=w,W<f?(w.isShared=!0,i.sharedLength=W-63,n=!0,P>=0?(ae[ne++]=(W&31)+96,ae[ne++]=P):ae[ne++]=W):(P>=0?(ae[ne++]=213,ae[ne++]=114,ae[ne++]=(W&31)+96,ae[ne++]=P):(ae[ne++]=212,ae[ne++]=114,ae[ne++]=W),C&&(g+=y*C),p.length>=h&&(p.shift()[ho]=0),p.push(O),S(w))},q=(O,w,C,W)=>{let P=ae,V=ne,J=kr,N=r;ae=ga,ne=0,r=0,ae||(ga=ae=new rl(8192)),kr=ae.length-10,j(O,w,W),ga=ae;let L=ne;if(ae=P,ne=V,kr=J,r=N,L>1){let F=ne+L-1;F>kr&&$(F);let Y=C+r;ae.copyWithin(Y+L,Y+1,ne),ae.set(ga.slice(0,L),Y),ne=F}else ae[C+r]=ga[0]},R=O=>{let w=dN(O,ae,r,ne,i,$,(C,W,P)=>{if(P)return n=!0;ne=W;let V=ae;return S(C),b(),V!==ae?{position:ne,targetView:_t,target:ae}:ne},this);if(w===0)return U(O);ne=w}}useBuffer(e){ae=e,ae.dataView||(ae.dataView=new DataView(ae.buffer,ae.byteOffset,ae.byteLength)),_t=ae.dataView,ne=0}set position(e){ne=e}get position(){return ne}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}r_=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,$y],xh=[{pack(t,e,r){let n=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,n)}else if(n>0&&n<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return e(0),r(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(t,e,r){if(this.setAsEmptyObject)return e(0),r({});let n=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([t.name,t.message,t.cause])}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([t.source,t.flags])}},{pack(t,e){this.moreTypes?Ah(t,16,e):Th(fo?Vt.from(t):new Uint8Array(t),e)}},{pack(t,e){let r=t.constructor;r!==n_&&this.moreTypes?Ah(t,e_.indexOf(r.name),e):Th(t,e)}},{pack(t,e){this.moreTypes?Ah(t,17,e):Th(fo?Vt.from(t):new Uint8Array(t),e)}},{pack(t,e){let{target:r,position:n}=e(1);r[n]=193}}];function Ah(t,e,r,n){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=r(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=r(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=r(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Th(t,e){let r=t.byteLength;var n,i;if(r<256){var{target:n,position:i}=e(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=e(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:s}=e(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(t,i)}function s_(t,e,r,n){let i=t.length;switch(i){case 1:e[r++]=212;break;case 2:e[r++]=213;break;case 4:e[r++]=214;break;case 8:e[r++]=215;break;case 16:e[r++]=216;break;default:i<256?(e[r++]=199,e[r++]=i):i<65536?(e[r++]=200,e[r++]=i>>8,e[r++]=i&255):(e[r++]=201,e[r++]=i>>24,e[r++]=i>>16&255,e[r++]=i>>8&255,e[r++]=i&255)}return e[r++]=n,e.set(t,r),r+=i,r}function yN(t,e){let r,n=e.length*6,i=t.length-n;for(;r=e.pop();){let s=r.offset,o=r.id;t.copyWithin(s+n,s,i),n-=6;let a=s+n;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function o_(t,e,r){if(Ot.length>0){_t.setUint32(Ot.position+t,ne+r-Ot.position-t),Ot.stringsPosition=ne-t;let n=Ot;Ot=null,e(n[0]),e(n[1])}}function _N(t,e){return t.isCompatible=r=>{let n=!r||(e.lastNamedStructuresLength||0)===r.length;return n||e._mergeStructures(r),n},t}let a_=new gN({useRecords:!1});const bN=a_.pack;a_.pack;const wN=512,vN=1024,EN=2048;function Tt(){return null}function po(t,e,r={}){if(!v(t))return;const n=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=r[o];v(c)&&(a=c(a));const l=e[o];v(l)&&(o=l),a!==null&&n.push(o,a)}return n}function ya(t,e,r={}){if(v(t))try{const n={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];v(a)&&(s=a);const c=r[s];v(c)&&(o=c(o)),n[s]=o}return n}catch(n){mt(le,"","format",n.message)}}function kN(t){try{return bN(t)}catch(e){mt(le,"","format",e.message)}}function Sh(t){if(be(t)){try{return JSON.parse(t)}catch(e){mt(le,"","format",e.message)}return}try{return fN(t)}catch(e){mt(le,"","format",e.message)}}function c_(){return{id:Ft()}}var nl=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.breakable=16]="breakable",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t[t.lightdir=31]="lightdir",t[t.item=32]="item",t[t.p4=33]="p4",t[t.p5=34]="p5",t[t.p6=35]="p6",t[t.displaychar=36]="displaychar",t[t.displaycolor=37]="displaycolor",t[t.displaybg=38]="displaybg",t[t.shootx=39]="shootx",t[t.shooty=40]="shooty",t[t.p7=41]="p7",t[t.p8=42]="p8",t[t.p9=43]="p9",t[t.p10=44]="p10",t))(nl||{});function il(t){return v(t?.id)?po(t,nl,{category:Tt,kinddata:Tt,stopped:Tt,removed:Tt,bucket:Tt}):po(t,nl,{id:Tt,x:Tt,y:Tt,lx:Tt,ly:Tt,code:Tt,category:Tt,kinddata:Tt,stopped:Tt,removed:Tt,bucket:Tt})}function sl(t){return ya(t,nl)}function jt(t){return t?.category===Ur.ISOBJECT}function _a(t,e){if(!v(t)||!Tr(e))return;const{color:r,bg:n}=Ly(e);v(r)&&(t.color=r),v(n)&&(t.bg=n)}function l_(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}function u_(t){const e=Math.floor(t.length/Vc);if(e*Vc!==t.length)return;const r=l_(3,e);for(let n=0;n<r.bits.length;++n)r.bits[n]=t[n];return r}function xN(t,e){return t&1<<e?255:0}function Rh(t){const e=Math.floor(t.length/mh);if(e*mh!==t.length)return;const r=Math.ceil(e/Xc),n=ps*Xc,i=l_(n,ms*r);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*ms+a,u=t[c];for(let h=0;h<ps;++h){const d=s*ps+h;i.bits[d+l*n]=xN(u,7-h)}++a,a===ms&&(a=0,++s,s===Xc&&(s=0,++o))}return i}const AN=gc("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),TN=gc("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var f_=typeof Gs=="object"&&Gs&&Gs.Object===Object&&Gs,SN=typeof self=="object"&&self&&self.Object===Object&&self,Qn=f_||SN||Function("return this")(),pn=Qn.Symbol,h_=Object.prototype,RN=h_.hasOwnProperty,ON=h_.toString,ba=pn?pn.toStringTag:void 0;function IN(t){var e=RN.call(t,ba),r=t[ba];try{t[ba]=void 0;var n=!0}catch{}var i=ON.call(t);return n&&(e?t[ba]=r:delete t[ba]),i}var NN=Object.prototype,CN=NN.toString;function LN(t){return CN.call(t)}var MN="[object Null]",UN="[object Undefined]",d_=pn?pn.toStringTag:void 0;function Wi(t){return t==null?t===void 0?UN:MN:d_&&d_ in Object(t)?IN(t):LN(t)}function Nn(t){return t!=null&&typeof t=="object"}var FN="[object Symbol]";function ol(t){return typeof t=="symbol"||Nn(t)&&Wi(t)==FN}function al(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var lt=Array.isArray,p_=pn?pn.prototype:void 0,m_=p_?p_.toString:void 0;function g_(t){if(typeof t=="string")return t;if(lt(t))return al(t,g_)+"";if(ol(t))return m_?m_.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var PN=/\s/;function BN(t){for(var e=t.length;e--&&PN.test(t.charAt(e)););return e}var $N=/^\s+/;function DN(t){return t&&t.slice(0,BN(t)+1).replace($N,"")}function mn(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var y_=NaN,jN=/^[-+]0x[0-9a-f]+$/i,zN=/^0b[01]+$/i,WN=/^0o[0-7]+$/i,HN=parseInt;function GN(t){if(typeof t=="number")return t;if(ol(t))return y_;if(mn(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=mn(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=DN(t);var r=zN.test(t);return r||WN.test(t)?HN(t.slice(2),r?2:8):jN.test(t)?y_:+t}var __=1/0,KN=17976931348623157e292;function qN(t){if(!t)return t===0?t:0;if(t=GN(t),t===__||t===-__){var e=t<0?-1:1;return e*KN}return t===t?t:0}function cl(t){var e=qN(t),r=e%1;return e===e?r?e-r:e:0}function mo(t){return t}var YN="[object AsyncFunction]",VN="[object Function]",XN="[object GeneratorFunction]",ZN="[object Proxy]";function bi(t){if(!mn(t))return!1;var e=Wi(t);return e==VN||e==XN||e==YN||e==ZN}var Oh=Qn["__core-js_shared__"],b_=(function(){var t=/[^.]+$/.exec(Oh&&Oh.keys&&Oh.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function JN(t){return!!b_&&b_ in t}var QN=Function.prototype,eC=QN.toString;function _s(t){if(t!=null){try{return eC.call(t)}catch{}try{return t+""}catch{}}return""}var tC=/[\\^$.*+?()[\]{}|]/g,rC=/^\[object .+?Constructor\]$/,nC=Function.prototype,iC=Object.prototype,sC=nC.toString,oC=iC.hasOwnProperty,aC=RegExp("^"+sC.call(oC).replace(tC,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function cC(t){if(!mn(t)||JN(t))return!1;var e=bi(t)?aC:rC;return e.test(_s(t))}function lC(t,e){return t?.[e]}function bs(t,e){var r=lC(t,e);return cC(r)?r:void 0}var Ih=bs(Qn,"WeakMap"),w_=Object.create,uC=(function(){function t(){}return function(e){if(!mn(e))return{};if(w_)return w_(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})();function fC(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function Jt(){}function hC(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var dC=800,pC=16,mC=Date.now;function gC(t){var e=0,r=0;return function(){var n=mC(),i=pC-(n-r);if(r=n,i>0){if(++e>=dC)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function yC(t){return function(){return t}}var ll=(function(){try{var t=bs(Object,"defineProperty");return t({},"",{}),t}catch{}})(),_C=ll?function(t,e){return ll(t,"toString",{configurable:!0,enumerable:!1,value:yC(e),writable:!0})}:mo,bC=gC(_C);function v_(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}function E_(t,e,r,n){for(var i=t.length,s=r+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function wC(t){return t!==t}function vC(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}function Nh(t,e,r){return e===e?vC(t,e,r):E_(t,wC,r)}function k_(t,e){var r=t==null?0:t.length;return!!r&&Nh(t,e,0)>-1}var EC=9007199254740991,kC=/^(?:0|[1-9]\d*)$/;function ul(t,e){var r=typeof t;return e=e??EC,!!e&&(r=="number"||r!="symbol"&&kC.test(t))&&t>-1&&t%1==0&&t<e}function Ch(t,e,r){e=="__proto__"&&ll?ll(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function wa(t,e){return t===e||t!==t&&e!==e}var xC=Object.prototype,AC=xC.hasOwnProperty;function fl(t,e,r){var n=t[e];(!(AC.call(t,e)&&wa(n,r))||r===void 0&&!(e in t))&&Ch(t,e,r)}function va(t,e,r,n){var i=!r;r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Ch(r,a,c):fl(r,a,c)}return r}var x_=Math.max;function TC(t,e,r){return e=x_(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=x_(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),fC(t,this,a)}}function Lh(t,e){return bC(TC(t,e,mo),t+"")}var SC=9007199254740991;function Mh(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=SC}function ei(t){return t!=null&&Mh(t.length)&&!bi(t)}function A_(t,e,r){if(!mn(r))return!1;var n=typeof e;return(n=="number"?ei(r)&&ul(e,r.length):n=="string"&&e in r)?wa(r[e],t):!1}function RC(t){return Lh(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&A_(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,s)}return e})}var OC=Object.prototype;function Ea(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||OC;return t===r}function IC(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var NC="[object Arguments]";function T_(t){return Nn(t)&&Wi(t)==NC}var S_=Object.prototype,CC=S_.hasOwnProperty,LC=S_.propertyIsEnumerable,hl=T_((function(){return arguments})())?T_:function(t){return Nn(t)&&CC.call(t,"callee")&&!LC.call(t,"callee")};function MC(){return!1}var R_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,O_=R_&&typeof module=="object"&&module&&!module.nodeType&&module,UC=O_&&O_.exports===R_,I_=UC?Qn.Buffer:void 0,FC=I_?I_.isBuffer:void 0,ka=FC||MC,PC="[object Arguments]",BC="[object Array]",$C="[object Boolean]",DC="[object Date]",jC="[object Error]",zC="[object Function]",WC="[object Map]",HC="[object Number]",GC="[object Object]",KC="[object RegExp]",qC="[object Set]",YC="[object String]",VC="[object WeakMap]",XC="[object ArrayBuffer]",ZC="[object DataView]",JC="[object Float32Array]",QC="[object Float64Array]",eL="[object Int8Array]",tL="[object Int16Array]",rL="[object Int32Array]",nL="[object Uint8Array]",iL="[object Uint8ClampedArray]",sL="[object Uint16Array]",oL="[object Uint32Array]",xt={};xt[JC]=xt[QC]=xt[eL]=xt[tL]=xt[rL]=xt[nL]=xt[iL]=xt[sL]=xt[oL]=!0,xt[PC]=xt[BC]=xt[XC]=xt[$C]=xt[ZC]=xt[DC]=xt[jC]=xt[zC]=xt[WC]=xt[HC]=xt[GC]=xt[KC]=xt[qC]=xt[YC]=xt[VC]=!1;function aL(t){return Nn(t)&&Mh(t.length)&&!!xt[Wi(t)]}function dl(t){return function(e){return t(e)}}var N_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,xa=N_&&typeof module=="object"&&module&&!module.nodeType&&module,cL=xa&&xa.exports===N_,Uh=cL&&f_.process,Hi=(function(){try{var t=xa&&xa.require&&xa.require("util").types;return t||Uh&&Uh.binding&&Uh.binding("util")}catch{}})(),C_=Hi&&Hi.isTypedArray,Fh=C_?dl(C_):aL,lL=Object.prototype,uL=lL.hasOwnProperty;function L_(t,e){var r=lt(t),n=!r&&hl(t),i=!r&&!n&&ka(t),s=!r&&!n&&!i&&Fh(t),o=r||n||i||s,a=o?IC(t.length,String):[],c=a.length;for(var l in t)(e||uL.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ul(l,c)))&&a.push(l);return a}function M_(t,e){return function(r){return t(e(r))}}var fL=M_(Object.keys,Object),hL=Object.prototype,dL=hL.hasOwnProperty;function U_(t){if(!Ea(t))return fL(t);var e=[];for(var r in Object(t))dL.call(t,r)&&r!="constructor"&&e.push(r);return e}function gn(t){return ei(t)?L_(t):U_(t)}var pL=Object.prototype,mL=pL.hasOwnProperty,Dr=RC(function(t,e){if(Ea(e)||ei(e)){va(e,gn(e),t);return}for(var r in e)mL.call(e,r)&&fl(t,r,e[r])});function gL(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var yL=Object.prototype,_L=yL.hasOwnProperty;function bL(t){if(!mn(t))return gL(t);var e=Ea(t),r=[];for(var n in t)n=="constructor"&&(e||!_L.call(t,n))||r.push(n);return r}function Ph(t){return ei(t)?L_(t,!0):bL(t)}var wL=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,vL=/^\w*$/;function Bh(t,e){if(lt(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||ol(t)?!0:vL.test(t)||!wL.test(t)||e!=null&&t in Object(e)}var Aa=bs(Object,"create");function EL(){this.__data__=Aa?Aa(null):{},this.size=0}function kL(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var xL="__lodash_hash_undefined__",AL=Object.prototype,TL=AL.hasOwnProperty;function SL(t){var e=this.__data__;if(Aa){var r=e[t];return r===xL?void 0:r}return TL.call(e,t)?e[t]:void 0}var RL=Object.prototype,OL=RL.hasOwnProperty;function IL(t){var e=this.__data__;return Aa?e[t]!==void 0:OL.call(e,t)}var NL="__lodash_hash_undefined__";function CL(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Aa&&e===void 0?NL:e,this}function ws(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ws.prototype.clear=EL,ws.prototype.delete=kL,ws.prototype.get=SL,ws.prototype.has=IL,ws.prototype.set=CL;function LL(){this.__data__=[],this.size=0}function pl(t,e){for(var r=t.length;r--;)if(wa(t[r][0],e))return r;return-1}var ML=Array.prototype,UL=ML.splice;function FL(t){var e=this.__data__,r=pl(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():UL.call(e,r,1),--this.size,!0}function PL(t){var e=this.__data__,r=pl(e,t);return r<0?void 0:e[r][1]}function BL(t){return pl(this.__data__,t)>-1}function $L(t,e){var r=this.__data__,n=pl(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function wi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}wi.prototype.clear=LL,wi.prototype.delete=FL,wi.prototype.get=PL,wi.prototype.has=BL,wi.prototype.set=$L;var Ta=bs(Qn,"Map");function DL(){this.size=0,this.__data__={hash:new ws,map:new(Ta||wi),string:new ws}}function jL(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ml(t,e){var r=t.__data__;return jL(e)?r[typeof e=="string"?"string":"hash"]:r.map}function zL(t){var e=ml(this,t).delete(t);return this.size-=e?1:0,e}function WL(t){return ml(this,t).get(t)}function HL(t){return ml(this,t).has(t)}function GL(t,e){var r=ml(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function vi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}vi.prototype.clear=DL,vi.prototype.delete=zL,vi.prototype.get=WL,vi.prototype.has=HL,vi.prototype.set=GL;var KL="Expected a function";function $h(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(KL);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new($h.Cache||vi),r}$h.Cache=vi;var qL=500;function YL(t){var e=$h(t,function(n){return r.size===qL&&r.clear(),n}),r=e.cache;return e}var VL=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,XL=/\\(\\)?/g,ZL=YL(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(VL,function(r,n,i,s){e.push(i?s.replace(XL,"$1"):n||r)}),e});function F_(t){return t==null?"":g_(t)}function gl(t,e){return lt(t)?t:Bh(t,e)?[t]:ZL(F_(t))}function Sa(t){if(typeof t=="string"||ol(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Dh(t,e){e=gl(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Sa(e[r++])];return r&&r==n?t:void 0}function JL(t,e,r){var n=t==null?void 0:Dh(t,e);return n===void 0?r:n}function jh(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var P_=pn?pn.isConcatSpreadable:void 0;function QL(t){return lt(t)||hl(t)||!!(P_&&t&&t[P_])}function zh(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=QL),i||(i=[]);++s<o;){var a=t[s];r(a)?jh(i,a):n||(i[i.length]=a)}return i}function tn(t){var e=t==null?0:t.length;return e?zh(t):[]}var B_=M_(Object.getPrototypeOf,Object);function Wh(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s}function e6(t,e,r){var n=t.length;return r=r===void 0?n:r,!e&&r>=n?t:Wh(t,e,r)}var t6="\\ud800-\\udfff",r6="\\u0300-\\u036f",n6="\\ufe20-\\ufe2f",i6="\\u20d0-\\u20ff",s6=r6+n6+i6,o6="\\ufe0e\\ufe0f",a6="\\u200d",c6=RegExp("["+a6+t6+s6+o6+"]");function $_(t){return c6.test(t)}function l6(t){return t.split("")}var D_="\\ud800-\\udfff",u6="\\u0300-\\u036f",f6="\\ufe20-\\ufe2f",h6="\\u20d0-\\u20ff",d6=u6+f6+h6,p6="\\ufe0e\\ufe0f",m6="["+D_+"]",Hh="["+d6+"]",Gh="\\ud83c[\\udffb-\\udfff]",g6="(?:"+Hh+"|"+Gh+")",j_="[^"+D_+"]",z_="(?:\\ud83c[\\udde6-\\uddff]){2}",W_="[\\ud800-\\udbff][\\udc00-\\udfff]",y6="\\u200d",H_=g6+"?",G_="["+p6+"]?",_6="(?:"+y6+"(?:"+[j_,z_,W_].join("|")+")"+G_+H_+")*",b6=G_+H_+_6,w6="(?:"+[j_+Hh+"?",Hh,z_,W_,m6].join("|")+")",v6=RegExp(Gh+"(?="+Gh+")|"+w6+b6,"g");function E6(t){return t.match(v6)||[]}function k6(t){return $_(t)?E6(t):l6(t)}function x6(t){return function(e){e=F_(e);var r=$_(e)?k6(e):void 0,n=r?r[0]:e.charAt(0),i=r?e6(r,1).join(""):e.slice(1);return n[t]()+i}}var K_=x6("toUpperCase");function A6(t,e,r,n){var i=-1,s=t==null?0:t.length;for(n&&s&&(r=t[++i]);++i<s;)r=e(r,t[i],i,t);return r}function T6(){this.__data__=new wi,this.size=0}function S6(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function R6(t){return this.__data__.get(t)}function O6(t){return this.__data__.has(t)}var I6=200;function N6(t,e){var r=this.__data__;if(r instanceof wi){var n=r.__data__;if(!Ta||n.length<I6-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new vi(n)}return r.set(t,e),this.size=r.size,this}function ti(t){var e=this.__data__=new wi(t);this.size=e.size}ti.prototype.clear=T6,ti.prototype.delete=S6,ti.prototype.get=R6,ti.prototype.has=O6,ti.prototype.set=N6;function C6(t,e){return t&&va(e,gn(e),t)}function L6(t,e){return t&&va(e,Ph(e),t)}var q_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Y_=q_&&typeof module=="object"&&module&&!module.nodeType&&module,M6=Y_&&Y_.exports===q_,V_=M6?Qn.Buffer:void 0,X_=V_?V_.allocUnsafe:void 0;function U6(t,e){var r=t.length,n=X_?X_(r):new t.constructor(r);return t.copy(n),n}function Kh(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}function Z_(){return[]}var F6=Object.prototype,P6=F6.propertyIsEnumerable,J_=Object.getOwnPropertySymbols,qh=J_?function(t){return t==null?[]:(t=Object(t),Kh(J_(t),function(e){return P6.call(t,e)}))}:Z_;function B6(t,e){return va(t,qh(t),e)}var $6=Object.getOwnPropertySymbols,Q_=$6?function(t){for(var e=[];t;)jh(e,qh(t)),t=B_(t);return e}:Z_;function D6(t,e){return va(t,Q_(t),e)}function eb(t,e,r){var n=e(t);return lt(t)?n:jh(n,r(t))}function Yh(t){return eb(t,gn,qh)}function j6(t){return eb(t,Ph,Q_)}var Vh=bs(Qn,"DataView"),Xh=bs(Qn,"Promise"),go=bs(Qn,"Set"),tb="[object Map]",z6="[object Object]",rb="[object Promise]",nb="[object Set]",ib="[object WeakMap]",sb="[object DataView]",W6=_s(Vh),H6=_s(Ta),G6=_s(Xh),K6=_s(go),q6=_s(Ih),yn=Wi;(Vh&&yn(new Vh(new ArrayBuffer(1)))!=sb||Ta&&yn(new Ta)!=tb||Xh&&yn(Xh.resolve())!=rb||go&&yn(new go)!=nb||Ih&&yn(new Ih)!=ib)&&(yn=function(t){var e=Wi(t),r=e==z6?t.constructor:void 0,n=r?_s(r):"";if(n)switch(n){case W6:return sb;case H6:return tb;case G6:return rb;case K6:return nb;case q6:return ib}return e});var Y6=Object.prototype,V6=Y6.hasOwnProperty;function X6(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&V6.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var yl=Qn.Uint8Array;function Z6(t){var e=new t.constructor(t.byteLength);return new yl(e).set(new yl(t)),e}function J6(t,e){var r=t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var Q6=/\w*$/;function eM(t){var e=new t.constructor(t.source,Q6.exec(t));return e.lastIndex=t.lastIndex,e}var ob=pn?pn.prototype:void 0,ab=ob?ob.valueOf:void 0;function tM(t){return ab?Object(ab.call(t)):{}}function rM(t,e){var r=t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var nM="[object Boolean]",iM="[object Date]",sM="[object Map]",oM="[object Number]",aM="[object RegExp]",cM="[object Set]",lM="[object String]",uM="[object Symbol]",fM="[object ArrayBuffer]",hM="[object DataView]",dM="[object Float32Array]",pM="[object Float64Array]",mM="[object Int8Array]",gM="[object Int16Array]",yM="[object Int32Array]",_M="[object Uint8Array]",bM="[object Uint8ClampedArray]",wM="[object Uint16Array]",vM="[object Uint32Array]";function EM(t,e,r){var n=t.constructor;switch(e){case fM:return Z6(t);case nM:case iM:return new n(+t);case hM:return J6(t);case dM:case pM:case mM:case gM:case yM:case _M:case bM:case wM:case vM:return rM(t);case sM:return new n;case oM:case lM:return new n(t);case aM:return eM(t);case cM:return new n;case uM:return tM(t)}}function kM(t){return typeof t.constructor=="function"&&!Ea(t)?uC(B_(t)):{}}var xM="[object Map]";function AM(t){return Nn(t)&&yn(t)==xM}var cb=Hi&&Hi.isMap,TM=cb?dl(cb):AM,SM="[object Set]";function RM(t){return Nn(t)&&yn(t)==SM}var lb=Hi&&Hi.isSet,OM=lb?dl(lb):RM,IM=2,ub="[object Arguments]",NM="[object Array]",CM="[object Boolean]",LM="[object Date]",MM="[object Error]",fb="[object Function]",UM="[object GeneratorFunction]",FM="[object Map]",PM="[object Number]",hb="[object Object]",BM="[object RegExp]",$M="[object Set]",DM="[object String]",jM="[object Symbol]",zM="[object WeakMap]",WM="[object ArrayBuffer]",HM="[object DataView]",GM="[object Float32Array]",KM="[object Float64Array]",qM="[object Int8Array]",YM="[object Int16Array]",VM="[object Int32Array]",XM="[object Uint8Array]",ZM="[object Uint8ClampedArray]",JM="[object Uint16Array]",QM="[object Uint32Array]",vt={};vt[ub]=vt[NM]=vt[WM]=vt[HM]=vt[CM]=vt[LM]=vt[GM]=vt[KM]=vt[qM]=vt[YM]=vt[VM]=vt[FM]=vt[PM]=vt[hb]=vt[BM]=vt[$M]=vt[DM]=vt[jM]=vt[XM]=vt[ZM]=vt[JM]=vt[QM]=!0,vt[MM]=vt[fb]=vt[zM]=!1;function _l(t,e,r,n,i,s){var o,a=e&IM;if(o!==void 0)return o;if(!mn(t))return t;var c=lt(t);if(c)return o=X6(t),hC(t,o);var l=yn(t),u=l==fb||l==UM;if(ka(t))return U6(t);if(l==hb||l==ub||u&&!i)return o=u?{}:kM(t),a?D6(t,L6(o,t)):B6(t,C6(o,t));if(!vt[l])return i?t:{};o=EM(t,l),s||(s=new ti);var h=s.get(t);if(h)return h;s.set(t,o),OM(t)?t.forEach(function(m){o.add(_l(m,e,r,m,t,s))}):TM(t)&&t.forEach(function(m,p){o.set(p,_l(m,e,r,p,t,s))});var d=Yh,f=c?void 0:d(t);return v_(f||t,function(m,p){f&&(p=m,m=t[p]),fl(o,p,_l(m,e,r,p,t,s))}),o}var eU=4;function _r(t){return _l(t,eU)}function Ra(t){for(var e=-1,r=t==null?0:t.length,n=0,i=[];++e<r;){var s=t[e];s&&(i[n++]=s)}return i}var tU="__lodash_hash_undefined__";function rU(t){return this.__data__.set(t,tU),this}function nU(t){return this.__data__.has(t)}function yo(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new vi;++e<r;)this.add(t[e])}yo.prototype.add=yo.prototype.push=rU,yo.prototype.has=nU;function db(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function Zh(t,e){return t.has(e)}var iU=1,sU=2;function pb(t,e,r,n,i,s){var o=r&iU,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,f=r&sU?new yo:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var m=t[h],p=e[h];if(n)var g=o?n(p,m,h,e,t,s):n(m,p,h,t,e,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!db(e,function(y,b){if(!Zh(f,b)&&(m===y||i(m,y,r,n,s)))return f.push(b)})){d=!1;break}}else if(!(m===p||i(m,p,r,n,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function oU(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}function Jh(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var aU=1,cU=2,lU="[object Boolean]",uU="[object Date]",fU="[object Error]",hU="[object Map]",dU="[object Number]",pU="[object RegExp]",mU="[object Set]",gU="[object String]",yU="[object Symbol]",_U="[object ArrayBuffer]",bU="[object DataView]",mb=pn?pn.prototype:void 0,Qh=mb?mb.valueOf:void 0;function wU(t,e,r,n,i,s,o){switch(r){case bU:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case _U:return!(t.byteLength!=e.byteLength||!s(new yl(t),new yl(e)));case lU:case uU:case dU:return wa(+t,+e);case fU:return t.name==e.name&&t.message==e.message;case pU:case gU:return t==e+"";case hU:var a=oU;case mU:var c=n&aU;if(a||(a=Jh),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;n|=cU,o.set(t,e);var u=pb(a(t),a(e),n,i,s,o);return o.delete(t),u;case yU:if(Qh)return Qh.call(t)==Qh.call(e)}return!1}var vU=1,EU=Object.prototype,kU=EU.hasOwnProperty;function xU(t,e,r,n,i,s){var o=r&vU,a=Yh(t),c=a.length,l=Yh(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:kU.call(e,d)))return!1}var f=s.get(t),m=s.get(e);if(f&&m)return f==e&&m==t;var p=!0;s.set(t,e),s.set(e,t);for(var g=o;++h<c;){d=a[h];var y=t[d],b=e[d];if(n)var A=o?n(b,y,d,e,t,s):n(y,b,d,t,e,s);if(!(A===void 0?y===b||i(y,b,r,n,s):A)){p=!1;break}g||(g=d=="constructor")}if(p&&!g){var S=t.constructor,x=e.constructor;S!=x&&"constructor"in t&&"constructor"in e&&!(typeof S=="function"&&S instanceof S&&typeof x=="function"&&x instanceof x)&&(p=!1)}return s.delete(t),s.delete(e),p}var AU=1,gb="[object Arguments]",yb="[object Array]",bl="[object Object]",TU=Object.prototype,_b=TU.hasOwnProperty;function SU(t,e,r,n,i,s){var o=lt(t),a=lt(e),c=o?yb:yn(t),l=a?yb:yn(e);c=c==gb?bl:c,l=l==gb?bl:l;var u=c==bl,h=l==bl,d=c==l;if(d&&ka(t)){if(!ka(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ti),o||Fh(t)?pb(t,e,r,n,i,s):wU(t,e,c,r,n,i,s);if(!(r&AU)){var f=u&&_b.call(t,"__wrapped__"),m=h&&_b.call(e,"__wrapped__");if(f||m){var p=f?t.value():t,g=m?e.value():e;return s||(s=new ti),i(p,g,r,n,s)}}return d?(s||(s=new ti),xU(t,e,r,n,i,s)):!1}function ed(t,e,r,n,i){return t===e?!0:t==null||e==null||!Nn(t)&&!Nn(e)?t!==t&&e!==e:SU(t,e,r,n,ed,i)}var RU=1,OU=2;function IU(t,e,r,n){var i=r.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=r[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=r[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new ti,h;if(!(h===void 0?ed(l,c,RU|OU,n,u):h))return!1}}return!0}function bb(t){return t===t&&!mn(t)}function NU(t){for(var e=gn(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,bb(i)]}return e}function wb(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}function CU(t){var e=NU(t);return e.length==1&&e[0][2]?wb(e[0][0],e[0][1]):function(r){return r===t||IU(r,t,e)}}function LU(t,e){return t!=null&&e in Object(t)}function vb(t,e,r){e=gl(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=Sa(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&Mh(i)&&ul(o,i)&&(lt(t)||hl(t)))}function MU(t,e){return t!=null&&vb(t,e,LU)}var UU=1,FU=2;function PU(t,e){return Bh(t)&&bb(e)?wb(Sa(t),e):function(r){var n=JL(r,t);return n===void 0&&n===e?MU(r,t):ed(e,n,UU|FU)}}function BU(t){return function(e){return e?.[t]}}function $U(t){return function(e){return Dh(e,t)}}function DU(t){return Bh(t)?BU(Sa(t)):$U(t)}function ri(t){return typeof t=="function"?t:t==null?mo:typeof t=="object"?lt(t)?PU(t[0],t[1]):CU(t):DU(t)}function jU(t,e,r,n){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(n,o,r(o),t)}return n}function zU(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var c=o[++i];if(r(s[c],c,s)===!1)break}return e}}var WU=zU();function HU(t,e){return t&&WU(t,e,gn)}function GU(t,e){return function(r,n){if(r==null)return r;if(!ei(r))return t(r,n);for(var i=r.length,s=-1,o=Object(r);++s<i&&n(o[s],s,o)!==!1;);return r}}var vs=GU(HU);function KU(t,e,r,n){return vs(t,function(i,s,o){e(n,i,r(i),o)}),n}function qU(t,e){return function(r,n){var i=lt(r)?jU:KU,s=e?e():{};return i(r,t,ri(n),s)}}var Eb=Object.prototype,YU=Eb.hasOwnProperty,td=Lh(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&A_(e[0],e[1],i)&&(n=1);++r<n;)for(var s=e[r],o=Ph(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||wa(u,Eb[l])&&!YU.call(t,l))&&(t[l]=s[l])}return t});function kb(t){return Nn(t)&&ei(t)}var VU=200;function XU(t,e,r,n){var i=-1,s=k_,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=VU&&(s=Zh,o=!1,e=new yo(e));e:for(;++i<a;){var u=t[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else s(e,h,n)||c.push(u)}return c}var wl=Lh(function(t,e){return kb(t)?XU(t,zh(e,1,kb,!0)):[]});function _o(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function br(t,e,r){var n=t==null?0:t.length;return n?(e=e===void 0?1:cl(e),Wh(t,e<0?0:e,n)):[]}function Oa(t,e,r){var n=t==null?0:t.length;return n?(e=e===void 0?1:cl(e),e=n-e,Wh(t,0,e<0?0:e)):[]}function ZU(t){return typeof t=="function"?t:mo}function Ve(t,e){var r=lt(t)?v_:vs;return r(t,ZU(e))}function JU(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}function QU(t,e){var r=!0;return vs(t,function(n,i,s){return r=!!e(n,i,s),r}),r}function Cn(t,e,r){var n=lt(t)?JU:QU;return n(t,ri(e))}function xb(t,e){var r=[];return vs(t,function(n,i,s){e(n,i,s)&&r.push(n)}),r}function _n(t,e){var r=lt(t)?Kh:xb;return r(t,ri(e))}function e8(t){return function(e,r,n){var i=Object(e);if(!ei(e)){var s=ri(r);e=gn(e),r=function(a){return s(i[a],a,i)}}var o=t(e,r,n);return o>-1?i[s?e[o]:o]:void 0}}var t8=Math.max;function r8(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:cl(r);return i<0&&(i=t8(n+i,0)),E_(t,ri(e),i)}var bo=e8(r8);function Ln(t){return t&&t.length?t[0]:void 0}function n8(t,e){var r=-1,n=ei(t)?Array(t.length):[];return vs(t,function(i,s,o){n[++r]=e(i,s,o)}),n}function Ue(t,e){var r=lt(t)?al:n8;return r(t,ri(e))}function bn(t,e){return zh(Ue(t,e))}var i8=Object.prototype,s8=i8.hasOwnProperty,Ab=qU(function(t,e,r){s8.call(t,r)?t[r].push(e):Ch(t,r,[e])}),o8=Object.prototype,a8=o8.hasOwnProperty;function c8(t,e){return t!=null&&a8.call(t,e)}function qe(t,e){return t!=null&&vb(t,e,c8)}var l8="[object String]";function jr(t){return typeof t=="string"||!lt(t)&&Nn(t)&&Wi(t)==l8}function u8(t,e){return al(e,function(r){return t[r]})}function Kt(t){return t==null?[]:u8(t,gn(t))}var f8=Math.max;function Rr(t,e,r,n){t=ei(t)?t:Kt(t),r=r?cl(r):0;var i=t.length;return r<0&&(r=f8(i+r,0)),jr(t)?r<=i&&t.indexOf(e,r)>-1:!!i&&Nh(t,e,r)>-1}function Tb(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=0;return Nh(t,e,i)}var h8="[object Map]",d8="[object Set]",p8=Object.prototype,m8=p8.hasOwnProperty;function Et(t){if(t==null)return!0;if(ei(t)&&(lt(t)||typeof t=="string"||typeof t.splice=="function"||ka(t)||Fh(t)||hl(t)))return!t.length;var e=yn(t);if(e==h8||e==d8)return!t.size;if(Ea(t))return!U_(t).length;for(var r in t)if(m8.call(t,r))return!1;return!0}var g8="[object RegExp]";function y8(t){return Nn(t)&&Wi(t)==g8}var Sb=Hi&&Hi.isRegExp,Ei=Sb?dl(Sb):y8;function ki(t){return t===void 0}var _8="Expected a function";function b8(t){if(typeof t!="function")throw new TypeError(_8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function w8(t,e,r,n){if(!mn(t))return t;e=gl(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=Sa(e[i]),l=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=mn(u)?u:ul(e[i+1])?[]:{})}fl(a,c,l),a=a[c]}return t}function v8(t,e,r){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=Dh(t,o);r(a,o)&&w8(s,gl(o,t),a)}return s}function Mn(t,e){if(t==null)return{};var r=al(j6(t),function(n){return[n]});return e=ri(e),v8(t,r,function(n,i){return e(n,i[0])})}function E8(t,e,r,n,i){return i(t,function(s,o,a){r=n?(n=!1,s):e(r,s,o,a)}),r}function zr(t,e,r){var n=lt(t)?A6:E8,i=arguments.length<3;return n(t,ri(e),r,i,vs)}function vl(t,e){var r=lt(t)?Kh:xb;return r(t,b8(ri(e)))}function k8(t,e){var r;return vs(t,function(n,i,s){return r=e(n,i,s),!r}),!!r}function rd(t,e,r){var n=lt(t)?db:k8;return n(t,ri(e))}var x8=1/0,A8=go&&1/Jh(new go([,-0]))[1]==x8?function(t){return new go(t)}:Jt,T8=200;function S8(t,e,r){var n=-1,i=k_,s=t.length,o=!0,a=[],c=a;if(s>=T8){var l=A8(t);if(l)return Jh(l);o=!1,i=Zh,c=new yo}else c=a;e:for(;++n<s;){var u=t[n],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(u)}else i(c,h,r)||(c!==a&&c.push(h),a.push(u))}return a}function El(t){return t&&t.length?S8(t):[]}function nd(t){console&&console.error&&console.error(`Error: ${t}`)}function Rb(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function Ob(t){const e=new Date().getTime(),r=t();return{time:new Date().getTime()-e,value:r}}function Ib(t){function e(){}e.prototype=t;const r=new e;function n(){return typeof r.bar}return n(),n(),t}function R8(t){return O8(t)?t.LABEL:t.name}function O8(t){return jr(t.LABEL)&&t.LABEL!==""}class ni{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Ve(this.definition,r=>{r.accept(e)})}}class Wr extends ni{constructor(e){super([]),this.idx=1,Dr(this,Mn(e,r=>r!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class wo extends ni{constructor(e){super(e.definition),this.orgText="",Dr(this,Mn(e,r=>r!==void 0))}}class Hr extends ni{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Dr(this,Mn(e,r=>r!==void 0))}}class Gr extends ni{constructor(e){super(e.definition),this.idx=1,Dr(this,Mn(e,r=>r!==void 0))}}class ii extends ni{constructor(e){super(e.definition),this.idx=1,Dr(this,Mn(e,r=>r!==void 0))}}class si extends ni{constructor(e){super(e.definition),this.idx=1,Dr(this,Mn(e,r=>r!==void 0))}}class Qt extends ni{constructor(e){super(e.definition),this.idx=1,Dr(this,Mn(e,r=>r!==void 0))}}class Un extends ni{constructor(e){super(e.definition),this.idx=1,Dr(this,Mn(e,r=>r!==void 0))}}class Fn extends ni{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Dr(this,Mn(e,r=>r!==void 0))}}class It{constructor(e){this.idx=1,Dr(this,Mn(e,r=>r!==void 0))}accept(e){e.visit(this)}}function I8(t){return Ue(t,kl)}function kl(t){function e(r){return Ue(r,kl)}if(t instanceof Wr){const r={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return jr(t.label)&&(r.label=t.label),r}else{if(t instanceof Hr)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Gr)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof ii)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof si)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:kl(new It({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Un)return{type:"RepetitionWithSeparator",idx:t.idx,separator:kl(new It({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Qt)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Fn)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof It){const r={type:"Terminal",name:t.terminalType.name,label:R8(t.terminalType),idx:t.idx};jr(t.label)&&(r.terminalLabel=t.label);const n=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(r.pattern=Ei(n)?n.source:n),r}else{if(t instanceof wo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Es{visit(e){const r=e;switch(r.constructor){case Wr:return this.visitNonTerminal(r);case Hr:return this.visitAlternative(r);case Gr:return this.visitOption(r);case ii:return this.visitRepetitionMandatory(r);case si:return this.visitRepetitionMandatoryWithSeparator(r);case Un:return this.visitRepetitionWithSeparator(r);case Qt:return this.visitRepetition(r);case Fn:return this.visitAlternation(r);case It:return this.visitTerminal(r);case wo:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function N8(t){return t instanceof Hr||t instanceof Gr||t instanceof Qt||t instanceof ii||t instanceof si||t instanceof Un||t instanceof It||t instanceof wo}function xl(t,e=[]){return t instanceof Gr||t instanceof Qt||t instanceof Un?!0:t instanceof Fn?rd(t.definition,n=>xl(n,e)):t instanceof Wr&&Rr(e,t)?!1:t instanceof ni?(t instanceof Wr&&e.push(t),Cn(t.definition,n=>xl(n,e))):!1}function C8(t){return t instanceof Fn}function oi(t){if(t instanceof Wr)return"SUBRULE";if(t instanceof Gr)return"OPTION";if(t instanceof Fn)return"OR";if(t instanceof ii)return"AT_LEAST_ONE";if(t instanceof si)return"AT_LEAST_ONE_SEP";if(t instanceof Un)return"MANY_SEP";if(t instanceof Qt)return"MANY";if(t instanceof It)return"CONSUME";throw Error("non exhaustive match")}class Al{walk(e,r=[]){Ve(e.definition,(n,i)=>{const s=br(e.definition,i+1);if(n instanceof Wr)this.walkProdRef(n,s,r);else if(n instanceof It)this.walkTerminal(n,s,r);else if(n instanceof Hr)this.walkFlat(n,s,r);else if(n instanceof Gr)this.walkOption(n,s,r);else if(n instanceof ii)this.walkAtLeastOne(n,s,r);else if(n instanceof si)this.walkAtLeastOneSep(n,s,r);else if(n instanceof Un)this.walkManySep(n,s,r);else if(n instanceof Qt)this.walkMany(n,s,r);else if(n instanceof Fn)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(e,r,n){}walkProdRef(e,r,n){}walkFlat(e,r,n){const i=r.concat(n);this.walk(e,i)}walkOption(e,r,n){const i=r.concat(n);this.walk(e,i)}walkAtLeastOne(e,r,n){const i=[new Gr({definition:e.definition})].concat(r,n);this.walk(e,i)}walkAtLeastOneSep(e,r,n){const i=Nb(e,r,n);this.walk(e,i)}walkMany(e,r,n){const i=[new Gr({definition:e.definition})].concat(r,n);this.walk(e,i)}walkManySep(e,r,n){const i=Nb(e,r,n);this.walk(e,i)}walkOr(e,r,n){const i=r.concat(n);Ve(e.definition,s=>{const o=new Hr({definition:[s]});this.walk(o,i)})}}function Nb(t,e,r){return[new Gr({definition:[new It({terminalType:t.separator})].concat(t.definition)})].concat(e,r)}function Ia(t){if(t instanceof Wr)return Ia(t.referencedRule);if(t instanceof It)return U8(t);if(N8(t))return L8(t);if(C8(t))return M8(t);throw Error("non exhaustive match")}function L8(t){let e=[];const r=t.definition;let n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=xl(s),e=e.concat(Ia(s)),n=n+1,i=r.length>n;return El(e)}function M8(t){const e=Ue(t.definition,r=>Ia(r));return El(tn(e))}function U8(t){return[t.terminalType]}const Cb="_~IN~_";class F8 extends Al{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,r,n){}walkProdRef(e,r,n){const i=B8(e.referencedRule,e.idx)+this.topProd.name,s=r.concat(n),o=new Hr({definition:s}),a=Ia(o);this.follows[i]=a}}function P8(t){const e={};return Ve(t,r=>{const n=new F8(r).startWalking();Dr(e,n)}),e}function B8(t,e){return t.name+e+Cb}function Xe(t){return t.charCodeAt(0)}function id(t,e){Array.isArray(t)?t.forEach(function(r){e.push(r)}):e.push(t)}function Na(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function vo(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function $8(){throw Error("Internal Error - Should never get here!")}function Lb(t){return t.type==="Character"}const Tl=[];for(let t=Xe("0");t<=Xe("9");t++)Tl.push(t);const Sl=[Xe("_")].concat(Tl);for(let t=Xe("a");t<=Xe("z");t++)Sl.push(t);for(let t=Xe("A");t<=Xe("Z");t++)Sl.push(t);const Mb=[Xe(" "),Xe("\f"),Xe(`
`),Xe("\r"),Xe("	"),Xe("\v"),Xe("	"),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe(" "),Xe("\u2028"),Xe("\u2029"),Xe(" "),Xe(" "),Xe("　"),Xe("\uFEFF")],D8=/[0-9a-fA-F]/,Rl=/[0-9]/,j8=/[1-9]/;class z8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const r=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Na(n,"global");break;case"i":Na(n,"ignoreCase");break;case"m":Na(n,"multiLine");break;case"u":Na(n,"unicode");break;case"y":Na(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){const e=[],r=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(r)}}alternative(){const e=[],r=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}vo(r);const n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(e)}}return $8()}quantifier(e=!1){let r;const n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&r===void 0)return;vo(r);break}if(!(e===!0&&r===void 0)&&vo(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let e;const r=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),vo(e))return e.loc=this.loc(r),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Xe(`
`),Xe("\r"),Xe("\u2028"),Xe("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,r=!1;switch(this.popChar()){case"d":e=Tl;break;case"D":e=Tl,r=!0;break;case"s":e=Mb;break;case"S":e=Mb,r=!0;break;case"w":e=Sl;break;case"W":e=Sl,r=!0;break}if(vo(e))return{type:"Set",value:e,complement:r}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Xe("\f");break;case"n":e=Xe(`
`);break;case"r":e=Xe("\r");break;case"t":e=Xe("	");break;case"v":e=Xe("\v");break}if(vo(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Xe("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Xe(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Xe(e)}}}characterClass(){const e=[];let r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){const n=this.classAtom();if(n.type,Lb(n)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,Lb(i)){if(i.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:i.value})}else id(n.value,e),e.push(Xe("-")),id(i.value,e)}else id(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:r,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Xe("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const r=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:e,value:r};return e&&(n.idx=this.groupIdx),n}positiveInteger(){let e=this.popChar();if(j8.test(e)===!1)throw Error("Expecting a positive integer");for(;Rl.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Rl.test(e)===!1)throw Error("Expecting an integer");for(;Rl.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Xe(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Rl.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let r="";for(let i=0;i<e;i++){const s=this.popChar();if(D8.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class sd{visitChildren(e){for(const r in e){const n=e[r];e.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let Ol={};const W8=new z8;function Il(t){const e=t.toString();if(Ol.hasOwnProperty(e))return Ol[e];{const r=W8.pattern(e);return Ol[e]=r,r}}function H8(){Ol={}}const Ub="Complement Sets are not supported for first char optimization",Nl=`Unable to use "first char" lexer optimizations:
`;function G8(t,e=!1){try{const r=Il(t);return od(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===Ub)e&&Rb(`${Nl}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),nd(`${Nl}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function od(t,e,r){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)od(t.value[i],e,r);break;case"Alternative":const n=t.value;for(let i=0;i<n.length;i++){const s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Cl(o.value,e,r);break;case"Set":if(o.complement===!0)throw Error(Ub);Ve(o.value,c=>{if(typeof c=="number")Cl(c,e,r);else{const l=c;if(r===!0)for(let u=l.from;u<=l.to;u++)Cl(u,e,r);else{for(let u=l.from;u<=l.to&&u<La;u++)Cl(u,e,r);if(l.to>=La){const u=l.from>=La?l.from:La,h=l.to,d=Gi(u),f=Gi(h);for(let m=d;m<=f;m++)e[m]=m}}}});break;case"Group":od(o.value,e,r);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&ad(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Kt(e)}function Cl(t,e,r){const n=Gi(t);e[n]=n,r===!0&&K8(t,e)}function K8(t,e){const r=String.fromCharCode(t),n=r.toUpperCase();if(n!==r){const i=Gi(n.charCodeAt(0));e[i]=i}else{const i=r.toLowerCase();if(i!==r){const s=Gi(i.charCodeAt(0));e[s]=s}}}function Fb(t,e){return bo(t.value,r=>{if(typeof r=="number")return Rr(e,r);{const n=r;return bo(e,i=>n.from<=i&&i<=n.to)!==void 0}})}function ad(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?lt(t.value)?Cn(t.value,ad):ad(t.value):!1}class q8 extends sd{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Rr(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Fb(e,this.targetCharCodes)===void 0&&(this.found=!0):Fb(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function cd(t,e){if(e instanceof RegExp){const r=Il(e),n=new q8(t);return n.visit(r),n.found}else return bo(e,r=>Rr(t,r.charCodeAt(0)))!==void 0}const ks="PATTERN",Ca="defaultMode",Ll="modes";let Pb=typeof new RegExp("(?:)").sticky=="boolean";function Y8(t,e){e=td(e,{useSticky:Pb,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(b,A)=>A()});const r=e.tracer;r("initCharCodeToOptimizedIndexMap",()=>{y2()});let n;r("Reject Lexer.NA",()=>{n=vl(t,b=>b[ks]===or.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=Ue(n,b=>{const A=b[ks];if(Ei(A)){const S=A.source;return S.length===1&&S!=="^"&&S!=="$"&&S!=="."&&!A.ignoreCase?S:S.length===2&&S[0]==="\\"&&!Rr(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],S[1])?S[1]:e.useSticky?$b(A):Bb(A)}else{if(bi(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const S=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),x=new RegExp(S);return e.useSticky?$b(x):Bb(x)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;r("misc mapping",()=>{o=Ue(n,b=>b.tokenTypeIdx),a=Ue(n,b=>{const A=b.GROUP;if(A!==or.SKIPPED){if(jr(A))return A;if(ki(A))return!1;throw Error("non exhaustive match")}}),c=Ue(n,b=>{const A=b.LONGER_ALT;if(A)return lt(A)?Ue(A,x=>Tb(n,x)):[Tb(n,A)]}),l=Ue(n,b=>b.PUSH_MODE),u=Ue(n,b=>qe(b,"POP_MODE"))});let h;r("Line Terminator Handling",()=>{const b=zb(e.lineTerminatorCharacters);h=Ue(n,A=>!1),e.positionTracking!=="onlyOffset"&&(h=Ue(n,A=>qe(A,"LINE_BREAKS")?!!A.LINE_BREAKS:jb(A,b)===!1&&cd(b,A.PATTERN)))});let d,f,m,p;r("Misc Mapping #2",()=>{d=Ue(n,Db),f=Ue(s,p2),m=zr(n,(b,A)=>{const S=A.GROUP;return jr(S)&&S!==or.SKIPPED&&(b[S]=[]),b},{}),p=Ue(s,(b,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:d[A],short:f[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:n[A]}))});let g=!0,y=[];return e.safeMode||r("First Char Optimization",()=>{y=zr(n,(b,A,S)=>{if(typeof A.PATTERN=="string"){const x=A.PATTERN.charCodeAt(0),B=Gi(x);ld(b,B,p[S])}else if(lt(A.START_CHARS_HINT)){let x;Ve(A.START_CHARS_HINT,B=>{const I=typeof B=="string"?B.charCodeAt(0):B,U=Gi(I);x!==U&&(x=U,ld(b,U,p[S]))})}else if(Ei(A.PATTERN))if(A.PATTERN.unicode)g=!1,e.ensureOptimizations&&nd(`${Nl}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const x=G8(A.PATTERN,e.ensureOptimizations);Et(x)&&(g=!1),Ve(x,B=>{ld(b,B,p[S])})}else e.ensureOptimizations&&nd(`${Nl}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return b},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:g}}function V8(t,e){let r=[];const n=Z8(t);r=r.concat(n.errors);const i=J8(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(X8(s)),r=r.concat(o2(s)),r=r.concat(a2(s,e)),r=r.concat(c2(s)),r}function X8(t){let e=[];const r=_n(t,n=>Ei(n[ks]));return e=e.concat(e2(r)),e=e.concat(n2(r)),e=e.concat(i2(r)),e=e.concat(s2(r)),e=e.concat(t2(r)),e}function Z8(t){const e=_n(t,i=>!qe(i,ks)),r=Ue(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Lt.MISSING_PATTERN,tokenTypes:[i]})),n=wl(t,e);return{errors:r,valid:n}}function J8(t){const e=_n(t,i=>{const s=i[ks];return!Ei(s)&&!bi(s)&&!qe(s,"exec")&&!jr(s)}),r=Ue(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Lt.INVALID_PATTERN,tokenTypes:[i]})),n=wl(t,e);return{errors:r,valid:n}}const Q8=/[^\\][$]/;function e2(t){class e extends sd{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const r=_n(t,i=>{const s=i.PATTERN;try{const o=Il(s),a=new e;return a.visit(o),a.found}catch{return Q8.test(s.source)}});return Ue(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Lt.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function t2(t){const e=_n(t,n=>n.PATTERN.test(""));return Ue(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:Lt.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}const r2=/[^\\[][\^]|^\^/;function n2(t){class e extends sd{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const r=_n(t,i=>{const s=i.PATTERN;try{const o=Il(s),a=new e;return a.visit(o),a.found}catch{return r2.test(s.source)}});return Ue(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Lt.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function i2(t){const e=_n(t,n=>{const i=n[ks];return i instanceof RegExp&&(i.multiline||i.global)});return Ue(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Lt.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function s2(t){const e=[];let r=Ue(t,s=>zr(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Rr(e,a)&&a.PATTERN!==or.NA&&(e.push(a),o.push(a)),o),[]));r=Ra(r);const n=_n(r,s=>s.length>1);return Ue(n,s=>{const o=Ue(s,c=>c.name);return{message:`The same RegExp pattern ->${Ln(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Lt.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function o2(t){const e=_n(t,n=>{if(!qe(n,"GROUP"))return!1;const i=n.GROUP;return i!==or.SKIPPED&&i!==or.NA&&!jr(i)});return Ue(e,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Lt.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function a2(t,e){const r=_n(t,i=>i.PUSH_MODE!==void 0&&!Rr(e,i.PUSH_MODE));return Ue(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Lt.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function c2(t){const e=[],r=zr(t,(n,i,s)=>{const o=i.PATTERN;return o===or.NA||(jr(o)?n.push({str:o,idx:s,tokenType:i}):Ei(o)&&u2(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return Ve(t,(n,i)=>{Ve(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&l2(s,n.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Lt.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),e}function l2(t,e){if(Ei(e)){const r=e.exec(t);return r!==null&&r.index===0}else{if(bi(e))return e(t,0,[],{});if(qe(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function u2(t){return bo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>t.source.indexOf(r)!==-1)===void 0}function Bb(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function $b(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function f2(t,e,r){const n=[];return qe(t,Ca)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ca+`> property in its definition
`,type:Lt.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),qe(t,Ll)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ll+`> property in its definition
`,type:Lt.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),qe(t,Ll)&&qe(t,Ca)&&!qe(t.modes,t.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${Ca}: <${t.defaultMode}>which does not exist
`,type:Lt.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),qe(t,Ll)&&Ve(t.modes,(i,s)=>{Ve(i,(o,a)=>{if(ki(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Lt.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(qe(o,"LONGER_ALT")){const c=lt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ve(c,l=>{!ki(l)&&!Rr(i,l)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Lt.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function h2(t,e,r){const n=[];let i=!1;const s=Ra(tn(Kt(t.modes))),o=vl(s,c=>c[ks]===or.NA),a=zb(r);return e&&Ve(o,c=>{const l=jb(c,a);if(l!==!1){const h={message:g2(c,l),type:l.issue,tokenType:c};n.push(h)}else qe(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):cd(a,c.PATTERN)&&(i=!0)}),e&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Lt.NO_LINE_BREAKS_FLAGS}),n}function d2(t){const e={},r=gn(t);return Ve(r,n=>{const i=t[n];if(lt(i))e[n]=[];else throw Error("non exhaustive match")}),e}function Db(t){const e=t.PATTERN;if(Ei(e))return!1;if(bi(e))return!0;if(qe(e,"exec"))return!0;if(jr(e))return!1;throw Error("non exhaustive match")}function p2(t){return jr(t)&&t.length===1?t.charCodeAt(0):!1}const m2={test:function(t){const e=t.length;for(let r=this.lastIndex;r<e;r++){const n=t.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return t.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function jb(t,e){if(qe(t,"LINE_BREAKS"))return!1;if(Ei(t.PATTERN)){try{cd(e,t.PATTERN)}catch(r){return{issue:Lt.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(jr(t.PATTERN))return!1;if(Db(t))return{issue:Lt.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function g2(t,e){if(e.issue===Lt.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Lt.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function zb(t){return Ue(t,r=>jr(r)?r.charCodeAt(0):r)}function ld(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}const La=256;let Ml=[];function Gi(t){return t<La?t:Ml[t]}function y2(){if(Et(Ml)){Ml=new Array(65536);for(let t=0;t<65536;t++)Ml[t]=t>255?255+~~(t/255):t}}function Ma(t,e){const r=t.tokenTypeIdx;return r===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[r]===!0}function Ul(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let Wb=1;const Hb={};function Ua(t){const e=_2(t);b2(e),v2(e),w2(e),Ve(e,r=>{r.isParent=r.categoryMatches.length>0})}function _2(t){let e=_r(t),r=t,n=!0;for(;n;){r=Ra(tn(Ue(r,s=>s.CATEGORIES)));const i=wl(r,e);e=e.concat(i),Et(i)?n=!1:r=i}return e}function b2(t){Ve(t,e=>{Kb(e)||(Hb[Wb]=e,e.tokenTypeIdx=Wb++),qb(e)&&!lt(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),qb(e)||(e.CATEGORIES=[]),E2(e)||(e.categoryMatches=[]),k2(e)||(e.categoryMatchesMap={})})}function w2(t){Ve(t,e=>{e.categoryMatches=[],Ve(e.categoryMatchesMap,(r,n)=>{e.categoryMatches.push(Hb[n].tokenTypeIdx)})})}function v2(t){Ve(t,e=>{Gb([],e)})}function Gb(t,e){Ve(t,r=>{e.categoryMatchesMap[r.tokenTypeIdx]=!0}),Ve(e.CATEGORIES,r=>{const n=t.concat(e);Rr(n,r)||Gb(n,r)})}function Kb(t){return qe(t,"tokenTypeIdx")}function qb(t){return qe(t,"CATEGORIES")}function E2(t){return qe(t,"categoryMatches")}function k2(t){return qe(t,"categoryMatchesMap")}function x2(t){return qe(t,"tokenTypeIdx")}const A2={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,r,n,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${r} characters.`}};var Lt;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Lt||(Lt={}));const Fa={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:A2,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Fa);let or=class{constructor(e,r=Fa){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Ob(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Dr({},Fa,r);const n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Fa.lineTerminatorsPattern)this.config.lineTerminatorsPattern=m2;else if(this.config.lineTerminatorCharacters===Fa.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),lt(e)?i={modes:{defaultMode:_r(e)},defaultMode:Ca}:(s=!1,i=_r(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(f2(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(h2(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ve(i.modes,(a,c)=>{i.modes[c]=vl(a,l=>ki(l))});const o=gn(i.modes);if(Ve(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(V8(a,o))}),Et(this.lexerDefinitionErrors)){Ua(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=Y8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Dr({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Et(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Ue(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ve(this.lexerDefinitionWarning,a=>{Rb(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Pb?(this.chopInput=mo,this.match=this.matchWithTest):(this.updateLastIndex=Jt,this.match=this.matchWithExec),s&&(this.handleModes=Jt),this.trackStartLines===!1&&(this.computeNewColumn=mo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Jt),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=zr(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(r.ensureOptimizations&&!Et(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{H8()}),this.TRACE_INIT("toFastProperties",()=>{Ib(this)})})}tokenize(e,r=this.defaultMode){if(!Et(this.lexerDefinitionErrors)){const i=Ue(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,r)}tokenizeInternal(e,r){let n,i,s,o,a,c,l,u,h,d,f,m,p,g,y;const b=e,A=b.length;let S=0,x=0;const B=this.hasCustom?0:Math.floor(e.length/10),I=new Array(B),U=[];let $=this.trackStartLines?1:void 0,j=this.trackStartLines?1:void 0;const q=d2(this.emptyGroups),R=this.trackStartLines,O=this.config.lineTerminatorsPattern;let w=0,C=[],W=[];const P=[],V=[];Object.freeze(V);let J;function N(){return C}function L(he){const xe=Gi(he),ve=W[xe];return ve===void 0?V:ve}const F=he=>{if(P.length===1&&he.tokenType.PUSH_MODE===void 0){const xe=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(he);U.push({offset:he.startOffset,line:he.startLine,column:he.startColumn,length:he.image.length,message:xe})}else{P.pop();const xe=_o(P);C=this.patternIdxToConfig[xe],W=this.charCodeToPatternIdxToConfig[xe],w=C.length;const ve=this.canModeBeOptimized[xe]&&this.config.safeMode===!1;W&&ve?J=L:J=N}};function Y(he){P.push(he),W=this.charCodeToPatternIdxToConfig[he],C=this.patternIdxToConfig[he],w=C.length,w=C.length;const xe=this.canModeBeOptimized[he]&&this.config.safeMode===!1;W&&xe?J=L:J=N}Y.call(this,r);let K;const Q=this.config.recoveryEnabled;for(;S<A;){c=null;const he=b.charCodeAt(S),xe=J(he),ve=xe.length;for(n=0;n<ve;n++){K=xe[n];const ke=K.pattern;l=null;const Ae=K.short;if(Ae!==!1?he===Ae&&(c=ke):K.isCustom===!0?(y=ke.exec(b,S,I,q),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(ke,S),c=this.match(ke,e,S)),c!==null){if(a=K.longerAlt,a!==void 0){const Se=a.length;for(s=0;s<Se;s++){const Me=C[a[s]],je=Me.pattern;if(u=null,Me.isCustom===!0?(y=je.exec(b,S,I,q),y!==null?(o=y[0],y.payload!==void 0&&(u=y.payload)):o=null):(this.updateLastIndex(je,S),o=this.match(je,e,S)),o&&o.length>c.length){c=o,l=u,K=Me;break}}}break}}if(c!==null){if(h=c.length,d=K.group,d!==void 0&&(f=K.tokenTypeIdx,m=this.createTokenInstance(c,S,f,K.tokenType,$,j,h),this.handlePayload(m,l),d===!1?x=this.addToken(I,x,m):q[d].push(m)),e=this.chopInput(e,h),S=S+h,j=this.computeNewColumn(j,h),R===!0&&K.canLineTerminator===!0){let ke=0,Ae,Se;O.lastIndex=0;do Ae=O.test(c),Ae===!0&&(Se=O.lastIndex-1,ke++);while(Ae===!0);ke!==0&&($=$+ke,j=h-Se,this.updateTokenEndLineColumnLocation(m,d,Se,ke,$,j,h))}this.handleModes(K,F,Y,m)}else{const ke=S,Ae=$,Se=j;let Me=Q===!1;for(;Me===!1&&S<A;)for(e=this.chopInput(e,1),S++,i=0;i<w;i++){const je=C[i],T=je.pattern,ue=je.short;if(ue!==!1?b.charCodeAt(S)===ue&&(Me=!0):je.isCustom===!0?Me=T.exec(b,S,I,q)!==null:(this.updateLastIndex(T,S),Me=T.exec(e)!==null),Me===!0)break}if(p=S-ke,j=this.computeNewColumn(j,p),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,ke,p,Ae,Se),U.push({offset:ke,line:Ae,column:Se,length:p,message:g}),Q===!1)break}}return this.hasCustom||(I.length=x),{tokens:I,groups:q,errors:U}}handleModes(e,r,n,i){if(e.pop===!0){const s=e.push;r(i),s!==void 0&&n.call(this,s)}else e.push!==void 0&&n.call(this,e.push)}chopInput(e,r){return e.substring(r)}updateLastIndex(e,r){e.lastIndex=r}updateTokenEndLineColumnLocation(e,r,n,i,s,o,a){let c,l;r!==void 0&&(c=n===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,r){return e+r}createOffsetOnlyToken(e,r,n,i){return{image:e,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(e,r,n,i,s,o){return{image:e,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(e,r,n){return e.push(n),r}addTokenUsingMemberAccess(e,r,n){return e[r]=n,r++,r}handlePayloadNoCustom(e,r){}handlePayloadWithCustom(e,r){r!==null&&(e.payload=r)}matchWithTest(e,r,n){return e.test(r)===!0?r.substring(n,e.lastIndex):null}matchWithExec(e,r){const n=e.exec(r);return n!==null?n[0]:null}};or.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",or.NA=/NOT_APPLICABLE/;function Pa(t){return Yb(t)?t.LABEL:t.name}function Yb(t){return jr(t.LABEL)&&t.LABEL!==""}const T2="parent",Vb="categories",Xb="label",Zb="group",Jb="push_mode",Qb="pop_mode",e1="longer_alt",t1="line_breaks",r1="start_chars_hint";function rn(t){return S2(t)}function S2(t){const e=t.pattern,r={};if(r.name=t.name,ki(e)||(r.PATTERN=e),qe(t,T2))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return qe(t,Vb)&&(r.CATEGORIES=t[Vb]),Ua([r]),qe(t,Xb)&&(r.LABEL=t[Xb]),qe(t,Zb)&&(r.GROUP=t[Zb]),qe(t,Qb)&&(r.POP_MODE=t[Qb]),qe(t,Jb)&&(r.PUSH_MODE=t[Jb]),qe(t,e1)&&(r.LONGER_ALT=t[e1]),qe(t,t1)&&(r.LINE_BREAKS=t[t1]),qe(t,r1)&&(r.START_CHARS_HINT=t[r1]),r}const xs=rn({name:"EOF",pattern:or.NA});Ua([xs]);function Fl(t,e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function R2(t,e){return Ma(t,e)}const n1={buildMismatchTokenMessage({expected:t,actual:e,previous:r,ruleName:n}){return`Expecting ${Yb(t)?`--> ${Pa(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:r,customUserDescription:n,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Ln(e).image+"'";if(n)return s+n+a;{const c=zr(t,(d,f)=>d.concat(f),[]),l=Ue(c,d=>`[${Ue(d,f=>Pa(f)).join(", ")}]`),h=`one of these possible Token sequences:
${Ue(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:r,ruleName:n}){const i="Expecting: ",o=`
but found: '`+Ln(e).image+"'";if(r)return i+r+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Ue(t,l=>`[${Ue(l,u=>Pa(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(n1);const O2={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},As={buildDuplicateFoundError(t,e){function r(u){return u instanceof It?u.terminalType.name:u instanceof Wr?u.nonTerminalName:""}const n=t.name,i=Ln(e),s=i.idx,o=oi(i),a=r(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=Ue(t.prefixPath,i=>Pa(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=Ue(t.prefixPath,i=>Pa(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx;let n=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(t){let e=oi(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,r=Ue(t.leftRecursionPath,s=>s.name),n=`${e} --> ${r.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof wo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function I2(t,e){const r=new N2(t,e);return r.resolveRefs(),r.errors}class N2 extends Es{constructor(e,r){super(),this.nameToTopRule=e,this.errMsgProvider=r,this.errors=[]}resolveRefs(){Ve(Kt(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const r=this.nameToTopRule[e.nonTerminalName];if(r)e.referencedRule=r;else{const n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:Or.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class C2 extends Al{constructor(e,r){super(),this.topProd=e,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=_r(this.path.ruleStack).reverse(),this.occurrenceStack=_r(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,r=[]){this.found||super.walk(e,r)}walkProdRef(e,r,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=r.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Et(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class L2 extends C2{constructor(e,r){super(e,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,r,n){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=r.concat(n),s=new Hr({definition:i});this.possibleTokTypes=Ia(s),this.found=!0}}}class Pl extends Al{constructor(e,r){super(),this.topRule=e,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class M2 extends Pl{walkMany(e,r,n){if(e.idx===this.occurrence){const i=Ln(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof It&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,r,n)}}class i1 extends Pl{walkManySep(e,r,n){if(e.idx===this.occurrence){const i=Ln(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof It&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,r,n)}}class U2 extends Pl{walkAtLeastOne(e,r,n){if(e.idx===this.occurrence){const i=Ln(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof It&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,r,n)}}class s1 extends Pl{walkAtLeastOneSep(e,r,n){if(e.idx===this.occurrence){const i=Ln(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof It&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,r,n)}}function ud(t,e,r=[]){r=_r(r);let n=[],i=0;function s(a){return a.concat(br(t,i+1))}function o(a){const c=ud(s(a),e,r);return n.concat(c)}for(;r.length<e&&i<t.length;){const a=t[i];if(a instanceof Hr)return o(a.definition);if(a instanceof Wr)return o(a.definition);if(a instanceof Gr)n=o(a.definition);else if(a instanceof ii){const c=a.definition.concat([new Qt({definition:a.definition})]);return o(c)}else if(a instanceof si){const c=[new Hr({definition:a.definition}),new Qt({definition:[new It({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Un){const c=a.definition.concat([new Qt({definition:[new It({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof Qt){const c=a.definition.concat([new Qt({definition:a.definition})]);n=o(c)}else{if(a instanceof Fn)return Ve(a.definition,c=>{Et(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof It)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:br(t,i)}),n}function o1(t,e,r,n){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-n-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Et(h);){const d=h.pop();if(d===o){a&&_o(h).idx<=l&&h.pop();continue}const f=d.def,m=d.idx,p=d.ruleStack,g=d.occurrenceStack;if(Et(f))continue;const y=f[0];if(y===i){const b={idx:m,def:br(f),ruleStack:Oa(p),occurrenceStack:Oa(g)};h.push(b)}else if(y instanceof It)if(m<c-1){const b=m+1,A=e[b];if(r(A,y.terminalType)){const S={idx:b,def:br(f),ruleStack:p,occurrenceStack:g};h.push(S)}}else if(m===c-1)u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:p,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(y instanceof Wr){const b=_r(p);b.push(y.nonTerminalName);const A=_r(g);A.push(y.idx);const S={idx:m,def:y.definition.concat(s,br(f)),ruleStack:b,occurrenceStack:A};h.push(S)}else if(y instanceof Gr){const b={idx:m,def:br(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const A={idx:m,def:y.definition.concat(br(f)),ruleStack:p,occurrenceStack:g};h.push(A)}else if(y instanceof ii){const b=new Qt({definition:y.definition,idx:y.idx}),A=y.definition.concat([b],br(f)),S={idx:m,def:A,ruleStack:p,occurrenceStack:g};h.push(S)}else if(y instanceof si){const b=new It({terminalType:y.separator}),A=new Qt({definition:[b].concat(y.definition),idx:y.idx}),S=y.definition.concat([A],br(f)),x={idx:m,def:S,ruleStack:p,occurrenceStack:g};h.push(x)}else if(y instanceof Un){const b={idx:m,def:br(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const A=new It({terminalType:y.separator}),S=new Qt({definition:[A].concat(y.definition),idx:y.idx}),x=y.definition.concat([S],br(f)),B={idx:m,def:x,ruleStack:p,occurrenceStack:g};h.push(B)}else if(y instanceof Qt){const b={idx:m,def:br(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const A=new Qt({definition:y.definition,idx:y.idx}),S=y.definition.concat([A],br(f)),x={idx:m,def:S,ruleStack:p,occurrenceStack:g};h.push(x)}else if(y instanceof Fn)for(let b=y.definition.length-1;b>=0;b--){const A=y.definition[b],S={idx:m,def:A.definition.concat(br(f)),ruleStack:p,occurrenceStack:g};h.push(S),h.push(o)}else if(y instanceof Hr)h.push({idx:m,def:y.definition.concat(br(f)),ruleStack:p,occurrenceStack:g});else if(y instanceof wo)h.push(F2(y,m,p,g));else throw Error("non exhaustive match")}return u}function F2(t,e,r,n){const i=_r(r);i.push(t.name);const s=_r(n);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Mt;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Mt||(Mt={}));function a1(t){if(t instanceof Gr||t==="Option")return Mt.OPTION;if(t instanceof Qt||t==="Repetition")return Mt.REPETITION;if(t instanceof ii||t==="RepetitionMandatory")return Mt.REPETITION_MANDATORY;if(t instanceof si||t==="RepetitionMandatoryWithSeparator")return Mt.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Un||t==="RepetitionWithSeparator")return Mt.REPETITION_WITH_SEPARATOR;if(t instanceof Fn||t==="Alternation")return Mt.ALTERNATION;throw Error("non exhaustive match")}function P2(t,e,r,n,i,s){const o=hd(t,e,r),a=f1(o)?Ul:Ma;return s(o,n,a,i)}function B2(t,e,r,n,i,s){const o=dd(t,e,i,r),a=f1(o)?Ul:Ma;return s(o[0],a,n)}function $2(t,e,r,n){const i=t.length,s=Cn(t,o=>Cn(o,a=>a.length===1));if(e)return function(o){const a=Ue(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const f=l[d],m=f.length;for(let p=0;p<m;p++){const g=this.LA(p+1);if(r(g,f[p])===!1)continue e}return c}}};if(s&&!n){const o=Ue(t,c=>tn(c)),a=zr(o,(c,l,u)=>(Ve(l,h=>{qe(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Ve(h.categoryMatches,d=>{qe(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(r(f,u[d])===!1)continue e}return o}}}}function D2(t,e,r){const n=Cn(t,s=>s.length===1),i=t.length;if(n&&!r){const s=tn(t);if(s.length===1&&Et(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=zr(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ve(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class j2 extends Al{constructor(e,r,n){super(),this.topProd=e,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,r,n,i){return e.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(e,r,n){this.checkIsTarget(e,Mt.OPTION,r,n)||super.walkOption(e,r,n)}walkAtLeastOne(e,r,n){this.checkIsTarget(e,Mt.REPETITION_MANDATORY,r,n)||super.walkOption(e,r,n)}walkAtLeastOneSep(e,r,n){this.checkIsTarget(e,Mt.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}walkMany(e,r,n){this.checkIsTarget(e,Mt.REPETITION,r,n)||super.walkOption(e,r,n)}walkManySep(e,r,n){this.checkIsTarget(e,Mt.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}}class c1 extends Es{constructor(e,r,n){super(),this.targetOccurrence=e,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(e,r){e.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Mt.OPTION)}visitRepetition(e){this.checkIsTarget(e,Mt.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Mt.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Mt.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Mt.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Mt.ALTERNATION)}}function l1(t){const e=new Array(t);for(let r=0;r<t;r++)e[r]=[];return e}function fd(t){let e=[""];for(let r=0;r<t.length;r++){const n=t[r],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){const c="_"+n.categoryMatches[a];i.push(o+c)}}e=i}return e}function z2(t,e,r){for(let n=0;n<t.length;n++){if(n===r)continue;const i=t[n];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function u1(t,e){const r=Ue(t,o=>ud([o],1)),n=l1(r.length),i=Ue(r,o=>{const a={};return Ve(o,c=>{const l=fd(c.partialPath);Ve(l,u=>{a[u]=!0})}),a});let s=r;for(let o=1;o<=e;o++){const a=s;s=l1(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=fd(h);if(z2(i,f,c)||Et(d)||h.length===e){const p=n[c];if(pd(p,h)===!1){p.push(h);for(let g=0;g<f.length;g++){const y=f[g];i[c][y]=!0}}}else{const p=ud(d,o+1,h);s[c]=s[c].concat(p),Ve(p,g=>{const y=fd(g.partialPath);Ve(y,b=>{i[c][b]=!0})})}}}}return n}function hd(t,e,r,n){const i=new c1(t,Mt.ALTERNATION,n);return e.accept(i),u1(i.result,r)}function dd(t,e,r,n){const i=new c1(t,r);e.accept(i);const s=i.result,a=new j2(e,t,r).startWalking(),c=new Hr({definition:s}),l=new Hr({definition:a});return u1([c,l],n)}function pd(t,e){e:for(let r=0;r<t.length;r++){const n=t[r];if(n.length===e.length){for(let i=0;i<n.length;i++){const s=e[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function W2(t,e){return t.length<e.length&&Cn(t,(r,n)=>{const i=e[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function f1(t){return Cn(t,e=>Cn(e,r=>Cn(r,n=>Et(n.categoryMatches))))}function H2(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return Ue(e,r=>Object.assign({type:Or.CUSTOM_LOOKAHEAD_VALIDATION},r))}function G2(t,e,r,n){const i=bn(t,c=>K2(c,r)),s=i3(t,e,r),o=bn(t,c=>e3(c,r)),a=bn(t,c=>V2(c,t,n,r));return i.concat(s,o,a)}function K2(t,e){const r=new Y2;t.accept(r);const n=r.allProductions,i=Ab(n,q2),s=Mn(i,a=>a.length>1);return Ue(Kt(s),a=>{const c=Ln(a),l=e.buildDuplicateFoundError(t,a),u=oi(c),h={message:l,type:Or.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=h1(c);return d&&(h.parameter=d),h})}function q2(t){return`${oi(t)}_#_${t.idx}_#_${h1(t)}`}function h1(t){return t instanceof It?t.terminalType.name:t instanceof Wr?t.nonTerminalName:""}class Y2 extends Es{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function V2(t,e,r,n){const i=[];if(zr(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=n.buildDuplicateRuleNameError({topLevelRule:t,grammarName:r});i.push({message:o,type:Or.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function X2(t,e,r){const n=[];let i;return Rr(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:Or.INVALID_RULE_OVERRIDE,ruleName:t})),n}function d1(t,e,r,n=[]){const i=[],s=Bl(e.definition);if(Et(s))return[];{const o=t.name;Rr(s,t)&&i.push({message:r.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:n}),type:Or.LEFT_RECURSION,ruleName:o});const c=wl(s,n.concat([t])),l=bn(c,u=>{const h=_r(n);return h.push(u),d1(t,u,r,h)});return i.concat(l)}}function Bl(t){let e=[];if(Et(t))return e;const r=Ln(t);if(r instanceof Wr)e.push(r.referencedRule);else if(r instanceof Hr||r instanceof Gr||r instanceof ii||r instanceof si||r instanceof Un||r instanceof Qt)e=e.concat(Bl(r.definition));else if(r instanceof Fn)e=tn(Ue(r.definition,s=>Bl(s.definition)));else if(!(r instanceof It))throw Error("non exhaustive match");const n=xl(r),i=t.length>1;if(n&&i){const s=br(t);return e.concat(Bl(s))}else return e}class md extends Es{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function Z2(t,e){const r=new md;t.accept(r);const n=r.alternations;return bn(n,s=>{const o=Oa(s.definition);return bn(o,(a,c)=>{const l=o1([a],[],Ma,1);return Et(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Or.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function J2(t,e,r){const n=new md;t.accept(n);let i=n.alternations;return i=vl(i,o=>o.ignoreAmbiguities===!0),bn(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=hd(a,t,c,o),u=r3(l,o,t,r),h=n3(l,o,t,r);return u.concat(h)})}class Q2 extends Es{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function e3(t,e){const r=new md;t.accept(r);const n=r.alternations;return bn(n,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Or.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function t3(t,e,r){const n=[];return Ve(t,i=>{const s=new Q2;i.accept(s);const o=s.allProductions;Ve(o,a=>{const c=a1(a),l=a.maxLookahead||e,u=a.idx,d=dd(u,i,c,l)[0];if(Et(tn(d))){const f=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:f,type:Or.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function r3(t,e,r,n){const i=[],s=zr(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Ve(c,u=>{const h=[l];Ve(t,(d,f)=>{l!==f&&pd(d,u)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!pd(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return Ue(s,a=>{const c=Ue(a.alts,u=>u+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Or.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:e.idx,alternatives:a.alts}})}function n3(t,e,r,n){const i=zr(t,(o,a,c)=>{const l=Ue(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Ra(bn(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=_n(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&W2(d.path,l));return Ue(u,d=>{const f=[d.idx+1,c+1],m=e.idx===0?"":e.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:Or.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:m,alternatives:f}})}))}function i3(t,e,r){const n=[],i=Ue(e,s=>s.name);return Ve(t,s=>{const o=s.name;if(Rr(i,o)){const a=r.buildNamespaceConflictError(s);n.push({message:a,type:Or.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function s3(t){const e=td(t,{errMsgProvider:O2}),r={};return Ve(t.rules,n=>{r[n.name]=n}),I2(r,e.errMsgProvider)}function o3(t){return t=td(t,{errMsgProvider:As}),G2(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const p1="MismatchedTokenException",m1="NoViableAltException",g1="EarlyExitException",y1="NotAllInputParsedException",_1=[p1,m1,g1,y1];Object.freeze(_1);function $l(t){return Rr(_1,t.name)}class Dl extends Error{constructor(e,r){super(e),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class b1 extends Dl{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=p1}}class a3 extends Dl{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=m1}}class c3 extends Dl{constructor(e,r){super(e,r),this.name=y1}}class l3 extends Dl{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=g1}}const gd={},w1="InRuleRecoveryException";class u3 extends Error{constructor(e){super(e),this.name=w1}}class f3{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=qe(e,"recoveryEnabled")?e.recoveryEnabled:xi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=h3)}getTokenToInsert(e){const r=Fl(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,r,n,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new b1(f,l,this.LA(0));m.resyncedTokens=Oa(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(n.call(this)){h(),e.apply(this,r);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,r)))}getFollowsForInRuleRecovery(e,r){const n=this.getCurrentGrammarPath(e,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(e,r){if(this.canRecoverWithSingleTokenInsertion(e,r))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new u3("sad sad panda")}canPerformInRuleRecovery(e,r){return this.canRecoverWithSingleTokenInsertion(e,r)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,r){if(!this.canTokenTypeBeInsertedInRecovery(e)||Et(r))return!1;const n=this.LA(1);return bo(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Rr(n,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let r=this.LA(1),n=2;for(;;){const i=bo(e,s=>R2(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return gd;const e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return Ue(e,(n,i)=>i===0?gd:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Ue(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return tn(e)}getFollowSetFromFollowKey(e){if(e===gd)return[xs];const r=e.ruleName+e.idxInCallingRule+Cb+e.inRule;return this.resyncFollows[r]}addToResyncTokens(e,r){return this.tokenMatcher(e,xs)||r.push(e),r}reSyncTo(e){const r=[];let n=this.LA(1);for(;this.tokenMatcher(n,e)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return Oa(r)}attemptInRepetitionRecovery(e,r,n,i,s,o,a){}getCurrentGrammarPath(e,r){const n=this.getHumanReadableRuleStack(),i=_r(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:e,lastTokOccurrence:r}}getHumanReadableRuleStack(){return Ue(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function h3(t,e,r,n,i,s,o){const a=this.getKeyForAutomaticLookahead(n,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=xs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,r,l)}const d3=4,Ki=8,v1=1<<Ki,E1=2<<Ki,yd=3<<Ki,_d=4<<Ki,bd=5<<Ki,jl=6<<Ki;function wd(t,e,r){return r|e|t}class p3{constructor(e){var r;this.maxLookahead=(r=e?.maxLookahead)!==null&&r!==void 0?r:xi.maxLookahead}validate(e){const r=this.validateNoLeftRecursion(e.rules);if(Et(r)){const n=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(e){return bn(e,r=>d1(r,r,As))}validateEmptyOrAlternatives(e){return bn(e,r=>Z2(r,As))}validateAmbiguousAlternationAlternatives(e,r){return bn(e,n=>J2(n,r,As))}validateSomeNonEmptyLookaheadPath(e,r){return t3(e,r,As)}buildLookaheadForAlternation(e){return P2(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,$2)}buildLookaheadForOptional(e){return B2(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,a1(e.prodType),D2)}}class m3{initLooksAhead(e){this.dynamicTokensEnabled=qe(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:xi.dynamicTokensEnabled,this.maxLookahead=qe(e,"maxLookahead")?e.maxLookahead:xi.maxLookahead,this.lookaheadStrategy=qe(e,"lookaheadStrategy")?e.lookaheadStrategy:new p3({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Ve(e,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{const{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=y3(r);Ve(n,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${oi(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:r,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=wd(this.fullRuleNameToShort[r.name],v1,l.idx);this.setLaFuncCache(d,h)})}),Ve(i,l=>{this.computeLookaheadFunc(r,l.idx,yd,"Repetition",l.maxLookahead,oi(l))}),Ve(s,l=>{this.computeLookaheadFunc(r,l.idx,E1,"Option",l.maxLookahead,oi(l))}),Ve(o,l=>{this.computeLookaheadFunc(r,l.idx,_d,"RepetitionMandatory",l.maxLookahead,oi(l))}),Ve(a,l=>{this.computeLookaheadFunc(r,l.idx,jl,"RepetitionMandatoryWithSeparator",l.maxLookahead,oi(l))}),Ve(c,l=>{this.computeLookaheadFunc(r,l.idx,bd,"RepetitionWithSeparator",l.maxLookahead,oi(l))})})})}computeLookaheadFunc(e,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=wd(this.fullRuleNameToShort[e.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,r){const n=this.getLastExplicitRuleShortName();return wd(n,e,r)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,r){this.lookAheadFuncsCache.set(e,r)}}class g3 extends Es{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const zl=new g3;function y3(t){zl.reset(),t.accept(zl);const e=zl.dslMethods;return zl.reset(),e}function k1(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function x1(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function _3(t,e,r){t.children[r]===void 0?t.children[r]=[e]:t.children[r].push(e)}function b3(t,e,r){t.children[e]===void 0?t.children[e]=[r]:t.children[e].push(r)}const w3="name";function A1(t,e){Object.defineProperty(t,w3,{enumerable:!1,configurable:!0,writable:!1,value:e})}function v3(t,e){const r=gn(t),n=r.length;for(let i=0;i<n;i++){const s=r[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function E3(t,e){const r=function(){};A1(r,t+"BaseSemantics");const n={visit:function(i,s){if(lt(i)&&(i=i[0]),!ki(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=x3(this,e);if(!Et(i)){const s=Ue(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=e,r}function k3(t,e,r){const n=function(){};A1(n,t+"BaseSemanticsWithDefaults");const i=Object.create(r.prototype);return Ve(e,s=>{i[s]=v3}),n.prototype=i,n.prototype.constructor=n,n}var vd;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(vd||(vd={}));function x3(t,e){return A3(t,e)}function A3(t,e){const r=_n(e,i=>bi(t[i])===!1),n=Ue(r,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:vd.MISSING_METHOD,methodName:i}));return Ra(n)}class T3{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=qe(e,"nodeLocationTracking")?e.nodeLocationTracking:xi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Jt,this.cstFinallyStateUpdate=Jt,this.cstPostTerminal=Jt,this.cstPostNonTerminal=Jt,this.cstPostRule=Jt;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=x1,this.setNodeLocationFromNode=x1,this.cstPostRule=Jt,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Jt,this.setNodeLocationFromNode=Jt,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=k1,this.setNodeLocationFromNode=k1,this.cstPostRule=Jt,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Jt,this.setNodeLocationFromNode=Jt,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Jt,this.setNodeLocationFromNode=Jt,this.cstPostRule=Jt,this.setInitialNodeLocation=Jt;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const r=this.LA(1);e.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const r={name:e,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(e){const r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(e,r){const n=this.CST_STACK[this.CST_STACK.length-1];_3(n,r,e),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(e,r){const n=this.CST_STACK[this.CST_STACK.length-1];b3(n,r,e),this.setNodeLocationFromNode(n.location,e.location)}getBaseCstVisitorConstructor(){if(ki(this.baseCstVisitorConstructor)){const e=E3(this.className,gn(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ki(this.baseCstVisitorWithDefaultsConstructor)){const e=k3(this.className,gn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class S3{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Gl}LA(e){const r=this.currIdx+e;return r<0||this.tokVectorLength<=r?Gl:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class R3{ACTION(e){return e.call(this)}consume(e,r,n){return this.consumeInternal(r,e,n)}subrule(e,r,n){return this.subruleInternal(r,e,n)}option(e,r){return this.optionInternal(r,e)}or(e,r){return this.orInternal(r,e)}many(e,r){return this.manyInternal(e,r)}atLeastOne(e,r){return this.atLeastOneInternal(e,r)}CONSUME(e,r){return this.consumeInternal(e,0,r)}CONSUME1(e,r){return this.consumeInternal(e,1,r)}CONSUME2(e,r){return this.consumeInternal(e,2,r)}CONSUME3(e,r){return this.consumeInternal(e,3,r)}CONSUME4(e,r){return this.consumeInternal(e,4,r)}CONSUME5(e,r){return this.consumeInternal(e,5,r)}CONSUME6(e,r){return this.consumeInternal(e,6,r)}CONSUME7(e,r){return this.consumeInternal(e,7,r)}CONSUME8(e,r){return this.consumeInternal(e,8,r)}CONSUME9(e,r){return this.consumeInternal(e,9,r)}SUBRULE(e,r){return this.subruleInternal(e,0,r)}SUBRULE1(e,r){return this.subruleInternal(e,1,r)}SUBRULE2(e,r){return this.subruleInternal(e,2,r)}SUBRULE3(e,r){return this.subruleInternal(e,3,r)}SUBRULE4(e,r){return this.subruleInternal(e,4,r)}SUBRULE5(e,r){return this.subruleInternal(e,5,r)}SUBRULE6(e,r){return this.subruleInternal(e,6,r)}SUBRULE7(e,r){return this.subruleInternal(e,7,r)}SUBRULE8(e,r){return this.subruleInternal(e,8,r)}SUBRULE9(e,r){return this.subruleInternal(e,9,r)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,r,n=Kl){if(Rr(this.definedRulesNames,e)){const o={message:As.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Or.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,r,n);return this[e]=i,i}OVERRIDE_RULE(e,r,n=Kl){const i=X2(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,r,n);return this[e]=s,s}BACKTRACK(e,r){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return e.apply(this,r),!0}catch(i){if($l(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return I8(Kt(this.gastProductionsCache))}}class O3{initRecognizerEngine(e,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Ul,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},qe(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(lt(e)){if(Et(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(lt(e))this.tokensMap=zr(e,(s,o)=>(s[o.name]=o,s),{});else if(qe(e,"modes")&&Cn(tn(Kt(e.modes)),x2)){const s=tn(Kt(e.modes)),o=El(s);this.tokensMap=zr(o,(a,c)=>(a[c.name]=c,a),{})}else if(mn(e))this.tokensMap=_r(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=xs;const n=qe(e,"modes")?tn(Kt(e.modes)):Kt(e),i=Cn(n,s=>Et(s.categoryMatches));this.tokenMatcher=i?Ul:Ma,Ua(Kt(this.tokensMap))}defineRule(e,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=qe(n,"resyncEnabled")?n.resyncEnabled:Kl.resyncEnabled,s=qe(n,"recoveryValueFunc")?n.recoveryValueFunc:Kl.recoveryValueFunc,o=this.ruleShortNameIdx<<d3+Ki;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:r})}invokeRuleCatch(e,r,n){const i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if($l(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(e);throw o}}else throw e}optionInternal(e,r){const n=this.getKeyForAutomaticLookahead(E1,r);return this.optionInternalLogic(e,r,n)}optionInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,r){const n=this.getKeyForAutomaticLookahead(_d,e);return this.atLeastOneInternalLogic(e,r,n)}atLeastOneInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const o=r.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Mt.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,r],i,_d,e,U2)}atLeastOneSepFirstInternal(e,r){const n=this.getKeyForAutomaticLookahead(jl,e);this.atLeastOneSepFirstInternalLogic(e,r,n)}atLeastOneSepFirstInternalLogic(e,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,s1],a,jl,e,s1)}else throw this.raiseEarlyExitException(e,Mt.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(e,r){const n=this.getKeyForAutomaticLookahead(yd,e);return this.manyInternalLogic(e,r,n)}manyInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const a=r.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,r],i,yd,e,M2,o)}manySepFirstInternal(e,r){const n=this.getKeyForAutomaticLookahead(bd,e);this.manySepFirstInternalLogic(e,r,n)}manySepFirstInternalLogic(e,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,i1],a,bd,e,i1)}}repetitionSepSecondInternal(e,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,r,n,i,s],n,jl,e,s)}doSingleRepetition(e){const r=this.getLexerPosition();return e.call(this),this.getLexerPosition()>r}orInternal(e,r){const n=this.getKeyForAutomaticLookahead(v1,r),i=lt(e)?e:e.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new c3(r,e))}}subruleInternal(e,r,n){let i;try{const s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=e.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,n,e.ruleName)}}subruleInternalError(e,r,n){throw $l(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete e.partialCstResult),e}consumeInternal(e,r,n){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,n)}catch(s){i=this.consumeInternalRecovery(e,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:e.name,i),i}consumeInternalError(e,r,n){let i;const s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new b1(i,r,s))}consumeInternalRecovery(e,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,r);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===w1?n:s}}else throw n}saveRecogState(){const e=this.errors,r=_r(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),xs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class I3{initErrorHandler(e){this._errors=[],this.errorMessageProvider=qe(e,"errorMessageProvider")?e.errorMessageProvider:xi.errorMessageProvider}SAVE_ERROR(e){if($l(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:_r(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return _r(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,r,n){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=dd(e,s,r,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new l3(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,r){const n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=hd(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new a3(c,this.LA(1),a))}}class N3{initContentAssist(){}computeContentAssist(e,r){const n=this.gastProductionsCache[e];if(ki(n))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return o1([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const r=Ln(e.ruleStack),i=this.getGAstProductions()[r];return new L2(i,e).startWalking()}}const Wl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Wl);const T1=!0,S1=Math.pow(2,Ki)-1,R1=rn({name:"RECORDING_PHASE_TOKEN",pattern:or.NA});Ua([R1]);const O1=Fl(R1,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(O1);const C3={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class L3{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const r=e>0?e:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,e,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,e,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,e)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,e)},this[`MANY${r}`]=function(n){this.manyInternalRecord(e,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(e,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(e,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(e,n)}}this.consume=function(e,r,n){return this.consumeInternalRecord(r,e,n)},this.subrule=function(e,r,n){return this.subruleInternalRecord(r,e,n)},this.option=function(e,r){return this.optionInternalRecord(r,e)},this.or=function(e,r){return this.orInternalRecord(r,e)},this.many=function(e,r){this.manyInternalRecord(e,r)},this.atLeastOne=function(e,r){this.atLeastOneInternalRecord(e,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let r=0;r<10;r++){const n=r>0?r:"";delete e[`CONSUME${n}`],delete e[`SUBRULE${n}`],delete e[`OPTION${n}`],delete e[`OR${n}`],delete e[`MANY${n}`],delete e[`MANY_SEP${n}`],delete e[`AT_LEAST_ONE${n}`],delete e[`AT_LEAST_ONE_SEP${n}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,r){return()=>!0}LA_RECORD(e){return Gl}topLevelRuleRecord(e,r){try{const n=new wo({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(e,r){return Ba.call(this,Gr,e,r)}atLeastOneInternalRecord(e,r){Ba.call(this,ii,r,e)}atLeastOneSepFirstInternalRecord(e,r){Ba.call(this,si,r,e,T1)}manyInternalRecord(e,r){Ba.call(this,Qt,r,e)}manySepFirstInternalRecord(e,r){Ba.call(this,Un,r,e,T1)}orInternalRecord(e,r){return M3.call(this,e,r)}subruleInternalRecord(e,r,n){if(Hl(r),!e||qe(e,"ruleName")===!1){const a=new Error(`<SUBRULE${I1(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=_o(this.recordingProdStack),s=e.ruleName,o=new Wr({idx:r,nonTerminalName:s,label:n?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?C3:Wl}consumeInternalRecord(e,r,n){if(Hl(r),!Kb(e)){const o=new Error(`<CONSUME${I1(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=_o(this.recordingProdStack),s=new It({idx:r,terminalType:e,label:n?.LABEL});return i.definition.push(s),O1}}function Ba(t,e,r,n=!1){Hl(r);const i=_o(this.recordingProdStack),s=bi(e)?e:e.DEF,o=new t({definition:[],idx:r});return n&&(o.separator=e.SEP),qe(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Wl}function M3(t,e){Hl(e);const r=_o(this.recordingProdStack),n=lt(t)===!1,i=n===!1?t:t.DEF,s=new Fn({definition:[],idx:e,ignoreAmbiguities:n&&t.IGNORE_AMBIGUITIES===!0});qe(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=rd(i,a=>bi(a.GATE));return s.hasPredicates=o,r.definition.push(s),Ve(i,a=>{const c=new Hr({definition:[]});s.definition.push(c),qe(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:qe(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Wl}function I1(t){return t===0?"":`${t}`}function Hl(t){if(t<0||t>S1){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${S1+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class U3{initPerformanceTracer(e){if(qe(e,"traceInitPerf")){const r=e.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=xi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,r){if(this.traceInitPerf===!0){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${e}>`);const{time:i,value:s}=Ob(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}}function F3(t,e){e.forEach(r=>{const n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=r.prototype[i]})})}const Gl=Fl(xs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Gl);const xi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:n1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Kl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Or;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Or||(Or={}));let Ed=class aT{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const r=this.className;this.TRACE_INIT("toFastProps",()=>{Ib(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ve(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=s3({rules:Kt(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(Et(n)&&this.skipValidations===!1){const i=o3({rules:Kt(this.gastProductionsCache),tokenTypes:Kt(this.tokensMap),errMsgProvider:As,grammarName:r}),s=H2({lookaheadStrategy:this.lookaheadStrategy,rules:Kt(this.gastProductionsCache),tokenTypes:Kt(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Et(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=P8(Kt(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Kt(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Kt(this.gastProductionsCache))})),!aT.DEFER_DEFINITION_ERRORS_HANDLING&&!Et(this.definitionErrors))throw e=Ue(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,r){this.definitionErrors=[],this.selfAnalysisDone=!1;const n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(e,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),qe(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=qe(r,"skipValidations")?r.skipValidations:xi.skipValidations}};Ed.DEFER_DEFINITION_ERRORS_HANDLING=!1,F3(Ed,[f3,m3,T3,S3,O3,R3,I3,N3,L3,U3]);class P3 extends Ed{constructor(e,r=xi){const n=_r(r);n.outputCst=!0,super(e,n)}}function B3(t){const e=new $3,r=Kt(t);return Ue(r,n=>e.visitRule(n))}class $3 extends Es{visitRule(e){const r=this.visitEach(e.definition),n=Ab(r,s=>s.propertyName),i=Ue(n,(s,o)=>{const a=!rd(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Ue(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:ql(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:ql(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:ql(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:ql(e)}]}visitEachAndOverrideWith(e,r){return Ue(this.visitEach(e),n=>Dr({},n,r))}visitEach(e){return tn(Ue(e,r=>this.visit(r)))}}function ql(t){return t instanceof Wr?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function D3(t,e){let r=[];return r=r.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),r=r.concat(tn(Ue(t,n=>j3(n)))),e.includeVisitorInterface&&(r=r.concat(G3(e.visitorInterfaceName,t))),r.join(`

`)+`
`}function j3(t){const e=z3(t),r=W3(t);return[e,r]}function z3(t){const e=C1(t.name),r=kd(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${r};
}`}function W3(t){return`export type ${kd(t.name)} = {
  ${Ue(t.properties,r=>H3(r)).join(`
  `)}
};`}function H3(t){const e=q3(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function G3(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Ue(e,r=>K3(r)).join(`
  `)}
}`}function K3(t){const e=kd(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function q3(t){if(lt(t)){const e=El(Ue(t,n=>N1(n)));return"("+zr(e,(n,i)=>n+" | "+i)+")"}else return N1(t)}function N1(t){return t.kind==="token"?"IToken":C1(t.name)}function C1(t){return K_(t)+"CstNode"}function kd(t){return K_(t)+"CstChildren"}const Y3={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function V3(t,e){const r=Object.assign(Object.assign({},Y3),e),n=B3(t);return D3(n,r)}const $a=Ty(32,126).map(t=>String.fromCharCode(t));function tt(t){return rn({...t,name:`token_${t.name}`})}function de(t){return tt({name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt})}const Yl=tt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),X3=tt({name:"whitespace",pattern:/ +/,group:or.SKIPPED}),Z3=tt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:or.SKIPPED}),xd=tt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Eo=tt({name:"command",pattern:/#/,start_chars_hint:["#"]});let L1=!1;const J3="@#/?':!",Q3=/[#\d]+/i,eF=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function tF(t,e){if(!L1)return null;let r=e;const n=t[r-1]??"";if(r>0&&n!==" "&&n!==`
`)return null;if(t[r]===" "){for(;t[r]===" ";)r++;if(J3.includes(t[r]))return null}for(;r>0&&`$"@#':!/?
`.includes(t[r])===!1;)r--;switch(t[r]){case"?":case"/":{const o=t.substring(r+1,e+1).toLowerCase();if(o.indexOf(" ")<1||eF.test(o))return null;break}case"#":{const o=t.substring(r+1,r+4).toLowerCase();if(Q3.test(o)===!1)return null;break}case'"':{for(r--;r>0&&t[r]===" ";)r--;if(!(r<1||t[r]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=e;for(t[i]==='"'&&++i;i<t.length&&t[i]!==`
`;)i++;const s=t.substring(e,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const M1=tt({name:"text",pattern:tF,line_breaks:!1,start_chars_hint:$a}),U1=tt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Ad=tt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),F1=tt({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),P1=tt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),zt=tt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:$a}),Vl=tt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Td=tt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),B1=de("isterrain"),$1=de("isobject"),D1=de("issolid"),j1=de("iswalk"),z1=de("isswim"),W1=de("isbullet"),H1=de("isghost"),G1=de("iswalking"),K1=de("iswalkable"),q1=de("isswimming"),Y1=de("isswimmable"),V1=de("black"),X1=de("dkblue"),Z1=de("dkgreen"),J1=de("dkcyan"),Q1=de("dkred"),ew=de("dkpurple"),tw=de("dkyellow"),rw=de("ltgray"),nw=de("dkgray"),iw=de("blue"),sw=de("green"),ow=de("cyan"),aw=de("red"),cw=de("purple"),lw=de("yellow"),uw=de("white"),fw=de("brown"),hw=de("dkwhite"),dw=de("ltgrey"),pw=de("gray"),mw=de("grey"),gw=de("dkgrey"),yw=de("ltblack"),_w=de("onblack"),bw=de("ondkblue"),ww=de("ondkgreen"),vw=de("ondkcyan"),Ew=de("ondkred"),kw=de("ondkpurple"),xw=de("ondkyellow"),Aw=de("onltgray"),Tw=de("ondkgray"),Sw=de("onblue"),Rw=de("ongreen"),Ow=de("oncyan"),Iw=de("onred"),Nw=de("onpurple"),Cw=de("onyellow"),Lw=de("onwhite"),Mw=de("onbrown"),Uw=de("ondkwhite"),Fw=de("onltgrey"),Pw=de("ongray"),Bw=de("ongrey"),$w=de("ondkgrey"),Dw=de("onltblack"),jw=de("onclear"),zw=de("idle"),Ww=de("up"),Hw=de("down"),Gw=de("left"),Kw=de("right"),qw=de("by"),Yw=de("at"),Vw=de("flow"),Xw=de("seek"),Zw=de("rndns"),Jw=de("rndne"),Qw=de("rnd"),ev=de("cw"),tv=de("ccw"),rv=de("opp"),nv=de("rndp"),iv=de("away"),sv=de("toward"),ov=de("find"),av=de("flee"),cv=de("to"),lv=de("i"),uv=de("u"),fv=de("north"),hv=de("n"),dv=de("d"),pv=de("south"),mv=de("s"),gv=de("l"),yv=de("west"),_v=de("w"),bv=de("r"),wv=de("east"),vv=de("e"),Ev=de("over"),kv=de("under"),xv=de("within"),Av=de("awayby"),Tv=tt({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:zt}),Sv=de("contact"),Rv=de("blocked"),Ov=de("any"),Iv=de("countof"),Nv=de("abs"),Cv=de("intceil"),Lv=de("intfloor"),Mv=de("intround"),Uv=de("clamp"),Fv=de("min"),Pv=de("max"),Bv=de("pick"),$v=de("pickwith"),Dv=de("random"),jv=de("randomwith"),zv=de("run"),Wv=de("runwith"),Hv=tt({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),Gv=tt({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:zt}),Kv=tt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:zt}),qv=tt({name:"islessthan",pattern:/<|below/i,longer_alt:zt}),Yv=tt({name:"isgreaterthan",pattern:/>|above/i,longer_alt:zt}),Vv=tt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:zt}),Xv=tt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:zt}),Sd=tt({name:"or",pattern:/or/i,longer_alt:zt}),Rd=tt({name:"not",pattern:/not/i,longer_alt:zt}),Od=tt({name:"and",pattern:/and/i,longer_alt:zt}),Id=tt({name:"plus",pattern:/\+/}),Nd=tt({name:"minus",pattern:/-/}),Zv=tt({name:"power",pattern:/\*\*/}),Jv=tt({name:"multiply",pattern:/\*/}),Cd=tt({name:"divide",pattern:/\//}),Qv=tt({name:"moddivide",pattern:/%/}),eE=tt({name:"floordivide",pattern:/%%/}),tE=tt({name:"query",pattern:/\?/}),rE=tt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),nE=tt({name:"rparen",pattern:/\)/,pop_mode:!0}),iE=tt({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:$a,longer_alt:zt}),sE=tt({name:"command_toast",pattern:/toast .*/i,start_chars_hint:$a,longer_alt:zt}),oE=tt({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:$a,longer_alt:zt}),Ld=tt({name:"if",pattern:/if|try|take|give|duplicate/i,longer_alt:zt}),Xl=tt({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:zt}),Md=de("done"),Ud=de("else"),aE=de("while"),cE=de("repeat"),lE=de("waitfor"),uE=tt({name:"foreach",pattern:/foreach|for/i,longer_alt:zt}),fE=de("break"),hE=de("continue");function dE(t,e){return[...t,Hw,...e,Td,B1,$1,D1,K1,G1,j1,Y1,q1,z1,W1,H1,V1,X1,Z1,J1,Q1,ew,tw,rw,nw,iw,sw,ow,aw,cw,lw,uw,fw,hw,dw,pw,mw,gw,yw,_w,bw,ww,vw,Ew,kw,xw,Aw,Tw,Sw,Rw,Ow,Iw,Nw,Cw,Lw,Mw,Uw,Fw,Pw,Bw,$w,Dw,jw,zw,Ww,Gw,Kw,qw,Yw,Vw,Xw,nv,Zw,Jw,Qw,ev,tv,rv,xv,Av,iv,sv,ov,av,cv,fv,pv,yv,wv,Ev,kv,Tv,Sv,Rv,Ov,Iv,Nv,Cv,Lv,Mv,Uv,Fv,Pv,$v,Bv,jv,Dv,Wv,zv,Hv,Gv,Kv,Vv,qv,Xv,Yv,Sd,Rd,Od,Id,Nd,Zv,Jv,Cd,eE,Qv,tE,rE,nE,lv,uv,hv,dv,mv,gv,_v,bv,vv,Vl,zt]}const pE=dE([M1,xd,iE,sE,oE,Eo,U1,Ad,F1,P1,Yl,X3],[fE,hE,Md,Xl,Ud,uE,Ld,cE,lE,aE]),rF=new or({defaultMode:"use_newlines",modes:{use_newlines:pE,ignore_newlines:dE([Z3],[])}},{skipValidations:!Xn,ensureOptimizations:Xn,positionTracking:"full"});function mE(t){L1=!0;const e=rF.tokenize(t||` 
`),[r]=(ut(e.tokens)?e.tokens:[]).slice(-1);return r&&r.tokenType.name!=="Newline"&&e.tokens.push(Fl(Yl,`
`,r.startOffset,r.endOffset??NaN,r.startLine??NaN,r.endLine??NaN,r.startColumn??NaN,r.endColumn??NaN)),e}function nF(t,e,r=!0){if(r){const[n,...i]=e;switch($e(n??"")){default:return{type:Fe.OBJECT,values:e};case"loader":return{type:Fe.LOADER,values:i};case"board":return{type:Fe.BOARD,values:i};case"object":return{type:Fe.OBJECT,values:i};case"terrain":return{type:Fe.TERRAIN,values:i};case"charset":return{type:Fe.CHARSET,values:i};case"palette":return{type:Fe.PALETTE,values:i}}}else{const[n,i,...s]=e,o=$e(i??""),a=[n,t,...s];switch(o){default:return{type:Fe.CONST,values:e};case"rn":case"range":return{type:Fe.RANGE,values:a};case"sl":case"select":return{type:Fe.SELECT,values:a};case"nm":case"number":return{type:Fe.NUMBER,values:a};case"tx":case"text":return{type:Fe.TEXT,values:a};case"hk":case"hotkey":return{type:Fe.HOTKEY,values:a};case"copyit":return{type:Fe.COPYIT,values:a};case"openit":return{type:Fe.OPENIT,values:a};case"zssedit":return{type:Fe.ZSSEDIT,values:a};case"charedit":return{type:Fe.CHAREDIT,values:a};case"coloredit":return{type:Fe.COLOREDIT,values:a}}}}function nn(t){switch(t){case Fe.LOADER:return"loader";case Fe.BOARD:return"board";case Fe.OBJECT:return"object";case Fe.TERRAIN:return"terrain";case Fe.CHARSET:return"charset";case Fe.PALETTE:return"palette";case Fe.CONST:return"const";case Fe.RANGE:return"range";case Fe.SELECT:return"select";case Fe.NUMBER:return"number";case Fe.TEXT:return"text";case Fe.HOTKEY:return"hotkey";case Fe.COPYIT:return"copyit";case Fe.OPENIT:return"openit";case Fe.VIEWIT:return"viewit";case Fe.ZSSEDIT:return"zssedit";case Fe.CHAREDIT:return"charedit";case Fe.COLOREDIT:return"coloredit"}}var Fd=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(Fd||{});function gE(t){return po(t,Fd,{bits:e=>Array.from(e)})}function yE(t){return ya(t,Fd,{bits:e=>new Uint8Array(e)})}function Da(t,e){return{id:Ft(),code:t,...e}}var Pd=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(Pd||{});function iF(t){return po(t,Pd,{board:gz,object:il,terrain:il,charset:gE,palette:gE,stats:Tt})}function sF(t){return ya(t,Pd,{board:yz,object:sl,terrain:sl,charset:yE,palette:yE})}function ja(t){const e={...Ts(t)};return Object.keys(e).forEach(r=>{switch(r){case"type":case"name":delete e[r];break}}),e}function oF(t){return v(t)?(t.stats=void 0,Ts(t)):{}}function Zl(t){const e=mE(t),r={};let n=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===xd){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=nF(be(c)?c:"",l,n),h=u.values.join(" ");switch(n=!1,u.type){case Fe.LOADER:r.type=Re.LOADER,r.name=h;break;case Fe.BOARD:r.type=Re.BOARD,r.name=h;break;case Fe.OBJECT:r.type=Re.OBJECT,r.name=h||"object";break;case Fe.TERRAIN:r.type=Re.TERRAIN,r.name=h;break;case Fe.CHARSET:r.type=Re.CHARSET,r.name=h;break;case Fe.PALETTE:r.type=Re.PALETTE,r.name=h;break;case Fe.CONST:{const[d,...f]=u.values;if(be(d)){const m=$e(d),p=f.join(" ");if(be(p)){const g=parseFloat(p);r[m]=Te(g)?g:p}else r[m]=1}break}case Fe.RANGE:case Fe.SELECT:case Fe.NUMBER:case Fe.TEXT:case Fe.HOTKEY:case Fe.ZSSEDIT:case Fe.CHAREDIT:case Fe.COLOREDIT:{const[d,...f]=u.values;if(be(d)){const m=$e(d);r[m]=[nn(u.type),...f]}break}}}}return r}function Ts(t){return v(t)?(v(t.stats?.type)||(t.stats=Zl(t.code),v(t.stats.type)||(t.stats.type=Re.OBJECT)),t.stats):{}}function _E(t){switch(t){default:case Re.ERROR:return"error";case Re.LOADER:return nn(Fe.LOADER);case Re.BOARD:return nn(Fe.BOARD);case Re.OBJECT:return nn(Fe.OBJECT);case Re.TERRAIN:return nn(Fe.TERRAIN);case Re.CHARSET:return nn(Fe.CHARSET);case Re.PALETTE:return nn(Fe.PALETTE)}}function ai(t){return Ts(t).type??Re.ERROR}function Ai(t){return _E(ai(t))}function gt(t){return Ts(t).name??""}function aF(t,e){return Ts(t)[e]}const Jl=new uh;function cF(t){if(!be(t))return;const e=ha(t);if(v(e)&&v(Ke[e]))return Ke[e];const r=$e(t),n=Ee[r];if(v(n))return n}function Ql(t,e){const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n],s=t[i];if(ut(s)){const[o,...a]=s;switch(o){case"text":v(e[i])||(e[i]="");break;case"range":v(e[i])||(e[i]=4);break;case"number":v(e[i])||(e[i]=0);break;case"select":if(!v(e[i])){const[,c]=a;e[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":e[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":e[i]=cF(s)??s;break;case"isitem":e.item=1;break;case"notitem":e.item=0;break;case"ispushable":e.pushable=s===""?1:s;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=We.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=We.ISSWIM;break;case"issolid":e.collision=We.ISSOLID;break;case"isbullet":e.collision=We.ISBULLET;break;case"isghost":e.collision=We.ISGHOST;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function At(t){if(v(t))switch(ai(t)){default:return;case Re.ERROR:return t.code??"";case Re.LOADER:return t.code??"";case Re.BOARD:{v(t.board)||(t.board=Ru()),t.board.id=t.id;const e=ja(t);return e.isdark&&(t.board.isdark=1),e.notdark&&(t.board.isdark=0),Te(e.startx)&&(t.board.startx=e.startx),Te(e.starty)&&(t.board.starty=e.starty),be(e.over)&&($e(e.over)==="empty"?t.board.over=void 0:t.board.over=e.over,t.board.overboard=void 0),be(e.under)&&($e(e.under)==="empty"?t.board.under=void 0:t.board.under=e.under,t.board.underboard=void 0),be(e.camera)&&($e(e.camera)==="empty"?t.board.camera=void 0:t.board.camera=e.camera),be(e.graphics)&&($e(e.graphics)==="empty"?t.board.graphics=void 0:t.board.graphics=e.graphics),Te(e.facing)&&(t.board.facing=e.facing),be(e.facing)&&$e(e.facing)==="empty"&&(t.board.facing=void 0),be(e.exitnorth)&&(t.board.exitnorth=e.exitnorth),be(e.exitsouth)&&(t.board.exitsouth=e.exitsouth),be(e.exitwest)&&(t.board.exitwest=e.exitwest),be(e.exiteast)&&(t.board.exiteast=e.exiteast),Te(e.timelimit)&&(t.board.timelimit=e.timelimit),e.restartonzap&&(t.board.restartonzap=1),e.norestartonzap&&(t.board.restartonzap=0),Te(e.maxplayershots)&&(t.board.maxplayershots=e.maxplayershots),t.board}case Re.OBJECT:return v(t.object)||(t.object=c_()),t.object.id=t.id,t.object.code=t.code,t.object.name=gt(t),t.object.category=Ur.ISOBJECT,Ql(ja(t),t.object),t.object;case Re.TERRAIN:return v(t.terrain)||(t.terrain=c_()),t.terrain.id=t.id,t.terrain.name=gt(t),t.terrain.category=Ur.ISTERRAIN,Ql(ja(t),t.terrain),t.terrain;case Re.PALETTE:{if(v(t.palette)||(t.palette=u_(TN)),v(t.palette?.bits)){const e=ja(t),r=Mr(e);for(let n=0;n<r.length;++n){const i=r[n].toLowerCase(),s=e[i];if(i.startsWith("color")&&be(s)){const o=parseFloat(i.replace("color",""));if(o>=0&&o<=15){Jl.set(s);const a=o*Vc,c=Jl.r*63,l=Jl.g*63,u=Jl.b*63;t.palette.bits[a+0]=$t(c,0,63),t.palette.bits[a+1]=$t(l,0,63),t.palette.bits[a+2]=$t(u,0,63)}}}}return t.palette}case Re.CHARSET:return v(t.charset)||(t.charset=Rh(AN)),t.charset}}function Bd(t){return{id:Ft(),name:ET(),timestamp:0,activelist:[],pages:t,flags:{}}}var $d=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))($d||{});function lF(t){return po(t,$d,{pages:e=>e.map(iF),flags:e=>{const r=Object.keys(e);for(let n=0;n<r.length;++n){const i=r[n];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function Dd(t){return ya(t,$d,{pages:e=>e.map(sF)})}function bE(t){v(t)&&(t.token=`${kT()}${fn(1111,9999)}`)}function Ss(t,e){if(!v(t))return;const r=$e(e);return t.pages.find(i=>i.id===e||r===gt(i))}function Ir(t,e,r){if(!v(t))return;const n=$e(r);return t.pages.find(s=>ai(s)===e&&(s.id===r||n===gt(s)))}function jd(t,e,r){let n=Ir(t,e,r);if(!v(n)){const i=_E(e);return n=Da(i==="object"?`@${r||"object"}
`:`@${i} ${r}
`,{}),ko(t,n),[n,!0]}return[n,!1]}function Rs(t,e){return v(t)?t.pages.filter(r=>ai(r)===e):[]}function wE(t,e,r){if(!v(t))return[];const n=$e(r);return t.pages.filter(s=>ai(s)===e).filter(s=>{const o=Ts(s),a=$e(gt(s));return s.id===r||n===a||v(o[r])})}function za(t){return v(t)?xn(t.pages).sort((r,n)=>{const i=ai(r),s=ai(n);return i===s?gt(r).localeCompare(gt(n)):s-i}):[]}function vE(t,e){if(v(e)){const r=Ir(t,Re.TERRAIN,e.kind??"");if(v(r))return r;const n=Ir(t,Re.OBJECT,e.kind??"");if(v(n))return n}}function ko(t,e){if(!v(t)||!v(e))return!1;const r=Ss(t,e.id);return v(r)?!1:(t.pages.push(e),bE(t),!0)}function EE(t,e){const r=Ss(t,e);if(v(t)&&v(r)){const n=$e(e);return t.pages=t.pages.filter(i=>i.id!==e&&n!==gt(i)),bE(t),r}}function ar(t,e=1,r=Ke.WHITE,n=Ke.BLACK){const i=t?.kinddata;return{name:$e(t?.name??i?.name),char:t?.displaychar??i?.displaychar??t?.char??i?.char??e,color:t?.displaycolor??i?.displaycolor??t?.color??i?.color??r,bg:t?.displaybg??i?.displaybg??t?.bg??i?.bg??n,light:t?.light??i?.light??0}}function uF(t,e){return!!t?.flags[e]}function Ti(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function kE(t,e){t&&delete t.flags[e]}function xE(t,e,r){return Ti(t,e)?.[r]}function fF(t,e,r,n){const i=Ti(t,e);return i&&(i[r]=n),n}function cr(t){if(!v(t)||v(t.lookup)&&v(t.named))return;const e=new Array(Ce*et).fill(void 0),r={},n=Object.values(t.objects);for(let o=0;o<n.length;++o){const a=n[o];if(v(a.x)&&v(a.y)&&v(a.id)&&!v(a.removed)&&He(a,"collision")!==We.ISGHOST){a.category=Ur.ISOBJECT,e[a.x+a.y*Ce]=a.id,be(a.code)&&!v(a.name)&&Ql(Zl(a.code),a);const c=ar(a);r[c.name]||(r[c.name]=new Set),r[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];if(v(a)){a.x=i,a.y=s,a.category=Ur.ISTERRAIN;const c=ar(vn(a));r[c.name]||(r[c.name]=new Set),r[c.name].add(o)}++i,i>=Ce&&(i=0,++s)}t.lookup=e,t.named=r}function Wa(t){v(t)&&(delete t.named,delete t.lookup,cr(t))}function zd(t,e,r){if(!v(t)||!v(t.named)||!v(e))return;const n=$e(e.name??e.kinddata?.name??"");t.named[n]||(t.named[n]=new Set),t.named[n].add(e?.id??r??"")}function AE(t,e){if(!(!v(t)||!v(t.lookup)||!v(e?.id))&&!v(e.removed)&&He(e,"collision")!==We.ISGHOST){const r=e.x??0,n=e.y??0;t.lookup[r+n*Ce]=e.id}}function hF(t,e){if(v(t)&&v(e?.x)&&v(e.y)){const r=ar(e),n=Ni(t,e);v(t.named?.[r.name])&&t.named[r.name].delete(n)}}function eu(t,e){if(v(t)&&v(e?.id)){if(v(t.lookup)&&v(e.x)&&v(e.y)){const n=e.x+e.y*Ce;t.lookup[n]===e.id&&(t.lookup[n]=void 0)}const r=ar(e);v(t.named?.[r.name])&&v(e.id)&&t.named[r.name].delete(e.id)}}function tu(t,e,r,n=!1){if(!v(t)||!v(t.lookup)||r.x<0||r.x>=Ce||r.y<0||r.y>=et)return;const i=r.x+r.y*Ce,s=hr(t,t.lookup[i]??"404");if(v(s))return n&&gr(s.id)?void 0:s;const o=t.terrain[i];if(v(o)&&Qa(e,He(o,"collision")))return o}function dF(t,e,r){const n=hr(t,e?.id??""),i=n?.x??-1,s=n?.y??-1;if(i-r.x===0&&s-r.y===0)return!0;const o=He(n,"collision");return v(tu(t,o,r))}function TE(t,e,r){const n=hr(t,e?.id??"");if(!v(t)||!v(n)||!v(n.x)||!v(n.y)||!v(t.lookup)||r.x<0||r.x>=Ce||r.y<0||r.y>=et)return{name:"edge",kind:"edge",collision:We.ISSOLID,x:r.x,y:r.y};if(n.x-r.x===0&&n.y-r.y===0)return;const i=Ni(t,n),s=Ni(t,r),o=He(n,"collision");if(o===We.ISGHOST)return;const a=gr(n?.id),c=hr(t,t.lookup[s]??"");if(He(c,"collision")===We.ISGHOST)return;const l=gr(c?.id??"");if(v(c)&&(!a||!l))return{...c};const u=t.terrain[s],h=u?.collision??u?.kinddata?.collision??We.ISWALK;if(Qa(o,h))return{...u,x:r.x,y:r.y};n.x=r.x,n.y=r.y,v(n.removed)||(t.lookup[i]=void 0,t.lookup[s]=n.id??"")}function pF(t,e){const r=[];if(!v(t))return r;const n=Object.values(t.objects);for(let i=0;i<n.length;++i){const s=n[i];v(s.id)&&v(s.removed)&&e-s.removed>fc*5&&(r.push(s.id),mA(t,s.id))}return r}function mF(t,e){const r=[];if(!v(t))return r;t.lookup=void 0,cr(t);const n=Object.values(t.objects);for(let s=0;s<n.length;++s){const o=n[s];if(!v(o.id))continue;o.lx=o.x,o.ly=o.y;const c=`${vn(o)?.code??""}
${o.code??""}`;if(c){if(o.removed){const l=e-o.removed,u=He(o,"cycle");if(l>u)continue}r.push({id:o.id,type:Re.OBJECT,code:c,object:o,terrain:void 0})}}const i=pF(t,e);for(let s=0;s<i.length;++s)r.push({id:i[s],type:Re.ERROR,code:"",object:void 0,terrain:void 0});return r}function SE(t,e,r){const n=[],i=[];if(!v(t))return{objectelements:n,terrainelements:i};function s(a,c){switch(r){case"all":return!0;case"self":return a?.id===e;case"others":return a?.id!==e;case"terrain":return c===!0;case"object":return c===!1}const l=He(a,r);return v(l)||ar(a).name===r||He(a,"group")===r}const o=Object.values(t.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&n.push(c)}for(let a=0;a<ph;++a){const c=t.terrain[a];v(c)&&s(c,!0)&&i.push(c)}return{objectelements:n,terrainelements:i}}function RE(t,e,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=it(e,{x:s,y:i});jt(o)&&dr(e,o,t.timestamp),St(e,{x:s,y:i})}}function gF(t,e,r){for(let n=e.y;n<=r.y;++n)for(let i=e.x;i<=r.x;++i)St(t,{x:i,y:n})}function OE(t,e,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=it(e,{x:s,y:i});jt(o)&&dr(e,o,t.timestamp),St(e,{x:s,y:i})}}function Os(t,e){v(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.displaychar=e.displaychar,t.displaycolor=e.displaycolor,t.displaybg=e.displaybg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.p4=e.p4,t.p5=e.p5,t.p6=e.p6,t.code=e.code,t.item=e.item,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.lightdir=e.lightdir,t.stepx=e.stepx,t.stepy=e.stepy,t.shootx=e.shootx,t.shooty=e.shooty,t.pushable=e.pushable,t.collision=e.collision,t.breakable=e.breakable,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function ru(t,e,r,n,i){switch(i){case"all":case"object":case"terrain":break;default:return yF(t,e,r,"",i)}if(!v(k.book))return;const s=k.book,o=Ir(s,Re.BOARD,t),a=At(o);if(!v(a))return;const c=Ir(s,Re.BOARD,e),l=At(c);if(!v(l))return;cr(a),cr(l);let u=!1;if(v(a)&&v(l)){switch(i){case"all":RE(s,l,r,n);break;case"object":OE(s,l,r,n);break;case"terrain":gF(l,r,n);break;default:u=!0;break}for(let h=r.y;h<=n.y;++h)for(let d=r.x;d<=n.x;++d){let f=!1,m=!1;switch(i){case"all":f=!0,m=!0;break;case"object":f=!0;break;case"terrain":m=!0;break}const p={x:d,y:h};let g,y=it(a,p);if(jt(y)?(g=Zi(a,d,h),gr(y?.id)&&(y=void 0)):(g=y,y=void 0),v(g)&&(m||u&&He(g,"group")===i)){u&&RE(s,l,p,p);const b=on(l,[g.kind??""],p);Os(b,g)}if(v(y)&&(f||u&&He(y,"group")===i)){u&&OE(s,l,p,p);const b=on(l,[y.kind??""],p);Os(b,y)}}Wa(l)}}function yF(t,e,r,n,i){if(!v(k.book))return;const s=k.book,o=Ir(s,Re.BOARD,t),a=At(o);if(!v(a))return;const c=Ir(s,Re.BOARD,e),l=At(c);if(v(l)&&(cr(a),cr(l),v(a)&&v(l))){const{terrainelements:u,objectelements:h}=SE(a,n,i);if(u.length===0&&h.length===0)return;const d={x:Ce,y:et};for(let f=0;f<u.length;++f){const m=u[f];Te(m.x)&&(d.x=Math.min(d.x,m.x)),Te(m.y)&&(d.y=Math.min(d.y,m.y))}for(let f=0;f<h.length;++f){const m=h[f];Te(m.x)&&(d.x=Math.min(d.x,m.x)),Te(m.y)&&(d.y=Math.min(d.y,m.y))}for(let f=0;f<u.length;++f){const m=u[f],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},g=it(l,p);v(g)&&(jt(g)&&dr(l,g,s.timestamp),St(l,p));const y=on(l,[m.kind??""],p);Os(y,m)}for(let f=0;f<h.length;++f){const m=h[f],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},g=on(l,[m.kind??""],p);Os(g,m)}Wa(l)}}function Ut(t){return`${t??""}`}function Ha(t,e){const r=parseFloat(Ut(t));return isNaN(r)?e:r}function _F(t,e){return t?.activelist.includes(e)??!1}function nu(t,e,r){if(!v(t))return;fF(t,e,"board",r);const n=fr(r);v(n)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function xo(t,e,r,n,i=!1){const s=Ht(e);if(!v(t)||!v(s))return;const o=hr(s,e);if(!jt(o)||!o?.id)return;const a=fr(r);if(!v(a))return;cr(a);const c=tu(a,We.ISWALK,n,!0);if(i===!1&&v(c))if(He(c,"item"))Gt(e,o,c,"touch");else return;eu(s,o),delete s.objects[o.id],o.x=n.x,o.y=n.y,a.objects[o.id]=o,zd(a,o),AE(a,o),nu(t,e,a.id)}function bF(t){const r=(t?.activelist??[]).map(n=>{const i=xE(t,n,"board");return be(i)?i:""});return MI(r)}function Ao(t){const e=bF(t),r=new Set,n=[];for(let i=0;i<e.length;++i){const s=fr(e[i]);if(v(s)&&!r.has(s.id)){if(be(s.over))if(be(s.overboard)){const o=fr(s.overboard);v(o)?r.has(o.id)||n.push(o):delete s.overboard}else{const o=fr(s.over);v(o)&&(s.overboard=o.id)}else be(s.overboard)&&delete s.overboard;if(n.push(s),be(s.under))if(be(s.underboard)){const o=fr(s.underboard);v(o)||delete s.underboard}else{const o=fr(s.under);v(o)&&(s.underboard=o.id)}else be(s.underboard)&&delete s.underboard}}return n}const wF=Ty(32,126).map(t=>String.fromCharCode(t)),vF=rn({name:"Whitespace",pattern:/ +/}),EF=rn({name:"WhitespaceSkipped",pattern:/ +/,group:or.SKIPPED}),Wd=rn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),IE=rn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:wF}),Hd=rn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Gd=rn({name:"EscapedDollar",pattern:"$$"}),Kd=rn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),qd=rn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),NE=rn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function kF(t,e=""){return rn({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const CE=Object.keys(fa).map(t=>kF(`\\$(${t})`,t)),xF=[vF,Wd,...CE,Hd,IE,qd,Gd,NE,Kd],AF=new or(xF,{skipValidations:!Xn,ensureOptimizations:Xn}),TF=new or([EF,Wd,...CE,Hd,IE,qd,Gd,NE,Kd],{skipValidations:!Xn,ensureOptimizations:Xn}),LE=/\$CENTER/i;function SF(t){if(LE.test(t))return t.replace(LE,"")}function Yd(t,e=!1){return e?TF.tokenize(t):AF.tokenize(t)}function Vd(t,e,r,n,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function ME(t){t.active={...t.reset}}function UE(t,e){const r=e.y;function n(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}n()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Gd:s("$");break;case qd:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}n();break;case Hd:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Wd:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=fa[l],h=FI(Ke[u]),d=dh(Ke[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):v(h)?e.active.color=h:v(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(v(e.writefullwidth)&&(e.x>o||e.y===r)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){ME(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;OF(u,u+l.length,e.active.color,e.active.bg,e),RF(u,l,e)}}}function FE(t,e,r){const n=Yd(t);n.tokens&&(UE(n.tokens,e),r&&ME(e),e.changed())}function PE(t,e,r){const n=Yd(t);if(!n.tokens)return;const i=Vd(e,r,Ke.WHITE,Ke.BLACK);return i.measureonly=!0,UE(n.tokens,i),i.x>0&&++i.y,i}function RF(t,e,r){let n=0;const i=t+e.length;for(let s=t;s<i;++s)r.char[s]=e.charCodeAt(n++);r.changed()}function OF(t,e,r,n,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=r,i.bg[a]=n;i.changed()}function iu(t,e,r){if(!v(k.element?.x)||!v(k.element.y))return 0;const[n,i]=fe(e,0,[Z.DIR,Z.MAYBE_KIND]);k.element.shootx=$t(n.destpt.x-n.startpt.x,-1,1),k.element.shooty=$t(n.destpt.y-n.startpt.y,-1,1);const s=i??["bullet"],o=Jj(k.board,s,{x:k.element.x,y:k.element.y});if(v(o)){v(r)&&(o.arg=r),o.cycle=1,o.party=k.elementid,o.collision=We.ISBULLET,o.breakable=1,o.stepx=n.destpt.x-k.element.x,o.stepy=n.destpt.y-k.element.y,o.bg=Ke.ONCLEAR;const a=vn(o),c=o.code??a?.code??"";sA(k.book,k.board,o,c)}return t.yield(),0}function Ga(t,e,r){if(!ds(k.element)||!v(k.book)||!v(k.board)||!v(k.element))return 0;const[n,i]=fe(t,0,[Z.DIR,Z.KIND]);if(n.targets.length){for(let d=0;d<n.targets.length;++d){const f=n.targets[d];Ga(["at",f.x,f.y,...i],e,r)}return 0}const{destpt:s}=n;if(s.x<0||s.x>=Ce||s.y<0||s.y>=et)return 0;const[o]=i,a={x:k.element?.x??0,y:k.element?.y??0},c=vn({kind:o}),l=He(c,"collision");if(l===We.ISGHOST)return on(k.board,i,n.destpt,e),0;let u=it(k.board,n.destpt);if(He(u,"pushable")){const d=xn(n.destpt),f=Ct(d,In(a,d));$n(k.book,k.board,u,f),u=it(k.board,n.destpt)}if(o==="empty")return dr(k.board,u,k.timestamp),0;if(jt(u)&&dr(k.board,u,k.timestamp),jt(c)||on(k.board,i,n.destpt,e),jt(c)){const d=tu(k.board,l,n.destpt);if(!v(d)){const f=on(k.board,i,n.destpt,e);v(f)&&v(r)&&(f.arg=r)}}return 0}function IF(t,e,r){if(!v(k.book)||!v(k.board))return 1;const[n,i]=fe(e,0,[Z.DIR,Z.DIR]),s=it(k.board,n.destpt);if(v(s)&&v(s.kind)){const o=He(s,"collision"),a=tu(k.board,o,i.destpt);if(v(a))return 1;const c=on(k.board,[s.kind],i.destpt);if(!v(c))return 1;Os(c,s)}else return 1;return 0}const NF={x:0,y:0},CF={x:Ce-1,y:et-1},LF="all",MF=yi().command("build",(t,e)=>{if(!v(k.book)||!v(k.board)||!v(k.element))return 0;const[r,n]=fe(e,0,[Z.NAME,Z.MAYBE_STRING]),i=Ru();if(v(i)){if(be(n)){const s=fr(n);v(s)&&ru(s.id,i.id,NF,CF,LF)}t.set(r,i.id)}return 0}).command("goto",(t,e)=>{if(!v(k.book)||!v(k.board))return 0;const[r,n]=fe(e,0,[Z.STRING]),[i,s]=fe(e,n,[Z.MAYBE_NUMBER,Z.MAYBE_NUMBER]),o=fr(r);if(!v(o))return 0;const a={x:i??o.startx??Math.round(Ce*.5),y:s??o.starty??Math.round(et*.5)},c=ar(k.element);if(c.name!=="player"){const l=He(k.element,"color"),u=He(k.element,"bg"),h=uo(l,u),d=Su(o,[c.name,h]),[f]=d.sort((m,p)=>{const g=m.y??1e4,y=p.y??1e4,b=g-y;if(b!==0)return b;const A=m.x??1e4,S=p.x??1e4;return A-S});v(f)&&Te(f.x)&&Te(f.y)&&(a.x=f.x,a.y=f.y)}return xo(k.book,k.elementfocus,o.id,a,!0),0}).command("transport",(t,e)=>{if(!v(k.book)||!v(k.board)||!v(k.element))return 0;const[r]=fe(e,0,[Z.STRING]),n=hr(k.board,r);if(v(k.element?.x)&&v(k.element.y)&&v(n?.x)&&v(n.y)){let i=!0;const s={x:k.element.x,y:k.element.y},o=s.x-n.x,a=s.y-n.y;if(He(k.element,"shootx")!==o||He(k.element,"shooty")!==a)return 0;for(;i&&(s.x+=o,s.y+=a,!(s.x<0&&s.x>=Ce&&s.y<0&&s.y>=et));){const c=it(k.board,s);c?.kind===k.element.kind&&He(c,"shootx")===-o&&He(c,"shooty")===-a&&$n(k.book,k.board,n,{x:s.x+o,y:s.y+a})&&(i=!1)}}return 0}).command("shove",(t,e)=>{if(!v(k.book)||!v(k.board))return 0;const[r,n]=fe(e,0,[Z.DIR,Z.DIR]),i=it(k.board,r.destpt);if(jt(i)&&He(i,"pushable")){const s=r.destpt.x+(n.destpt.x-n.startpt.x),o=r.destpt.y+(n.destpt.y-n.startpt.y);$n(k.book,k.board,i,{x:s,y:o})}return 0}).command("duplicate",IF).command("write",(t,e)=>{if(!v(k.book)||!v(k.board))return 0;const[r,n,i]=fe(e,0,[Z.DIR,Z.COLOR]),s=e.slice(i).map(Ut).join(" "),{color:o,bg:a}=Ly(n),c=PE(s,256,1)?.measuredwidth??1,l=Vd(256,1,o??Ke.WHITE,a??Ke.BLACK);FE(s,l,!1);const u=c-1;switch(In(r.startpt,r.destpt)){case Ee.EAST:for(let d=0;d<c;++d)St(k.board,{x:r.destpt.x+d,y:r.destpt.y,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case Ee.WEST:for(let d=0;d<c;++d)St(k.board,{x:r.destpt.x+d-u,y:r.destpt.y,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case Ee.NORTH:for(let d=0;d<c;++d)St(k.board,{x:r.destpt.x,y:r.destpt.y+d-u,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case Ee.SOUTH:for(let d=0;d<c;++d)St(k.board,{x:r.destpt.x,y:r.destpt.y+d,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break}return 0}).command("change",(t,e)=>{if(!v(k.book)||!v(k.board))return 0;const[r,n]=fe(e,0,[Z.KIND,Z.KIND]);(Ja(r)??"")==="empty"&&dz(k.board).forEach(c=>{on(k.board,n,c)});const s=Ja(n),o=Tu(n),a=aA(n);return Su(k.board,r).forEach(c=>{if(v(o)&&(c.color=o),v(a)&&(c.bg=a),ar(c).name!==s){const u=He(c,"color"),h=He(c,"bg");if(dr(k.board,c,k.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},f=on(k.board,n,d);v(f)&&(f.color=u,f.bg=h)}}}),0}).command("put",(t,e)=>Ga(e)).command("putwith",(t,e)=>{const[r,n]=fe(e,0,[Z.ANY]);return Ga(e.slice(n),void 0,r)}).command("oneof",(t,e)=>{const[r,n]=fe(e,0,[Z.ANY]);return v(k.board)&&hr(k.board,r)?0:Ga(e.slice(n),r)}).command("oneofwith",(t,e)=>{const[r,n,i]=fe(e,0,[Z.ANY,Z.ANY]);return v(k.board)&&hr(k.board,n)?0:Ga(e.slice(i),n,r)}).command("shoot",iu).command("shootwith",(t,e)=>{const[r,n]=fe(e,0,[Z.ANY]);return iu(t,e.slice(n),r)}).command("throwstar",(t,e)=>iu(t,[...e,"star"])).command("throwstarwith",(t,e)=>{const[r,n]=fe(e,0,[Z.ANY]);return iu(t,[...e.slice(n),"star"],r)});var Is=(t=>(t[t.Border=-1]="Border",t[t.Data=0]="Data",t[t.Function=1]="Function",t[t.Position=2]="Position",t[t.Timing=3]="Timing",t[t.Alignment=4]="Alignment",t))(Is||{}),UF=Object.defineProperty,FF=(t,e,r)=>e in t?UF(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,su=(t,e,r)=>(FF(t,typeof e!="symbol"?e+"":e,r),r);const PF=[0,1],BE=[1,0],$E=[2,3],DE=[3,2],BF={L:PF,M:BE,Q:$E,H:DE},$F=/^[0-9]*$/,DF=/^[A-Z0-9 $%*+.\/:-]*$/,Xd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Zd=1,Jd=40,jE=3,jF=3,ou=40,zF=10,zE=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],WE=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class WF{constructor(e,r,n,i){if(this.version=e,this.ecc=r,su(this,"size"),su(this,"mask"),su(this,"modules",[]),su(this,"types",[]),e<Zd||e>Jd)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(n);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,r){return e>=0&&e<this.size&&r>=0&&r<this.size&&this.modules[r][e]}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2===0,Is.Timing),this.setFunctionModule(n,6,n%2===0,Is.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),r=e.length;for(let n=0;n<r;n++)for(let i=0;i<r;i++)n===0&&i===0||n===0&&i===r-1||n===r-1&&i===0||this.drawAlignmentPattern(e[n],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const r=this.ecc[1]<<3|e;let n=r;for(let s=0;s<10;s++)n=n<<1^(n>>>9)*1335;const i=(r<<10|n)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Ri(i,s));this.setFunctionModule(8,7,Ri(i,6)),this.setFunctionModule(8,8,Ri(i,7)),this.setFunctionModule(7,8,Ri(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Ri(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Ri(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Ri(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let n=0;n<12;n++)e=e<<1^(e>>>11)*7973;const r=this.version<<12|e;for(let n=0;n<18;n++){const i=Ri(r,n),s=this.size-11+n%3,o=Math.floor(n/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,r){for(let n=-4;n<=4;n++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(n)),o=e+i,a=r+n;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,Is.Position)}}drawAlignmentPattern(e,r){for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,r+n,Math.max(Math.abs(i),Math.abs(n))!==1,Is.Alignment)}setFunctionModule(e,r,n,i=Is.Function){this.modules[r][e]=n,this.types[r][e]=i}addEccAndInterleave(e){const r=this.version,n=this.ecc;if(e.length!==au(r,n))throw new RangeError("Invalid argument");const i=WE[n[0]][r],s=zE[n[0]][r],o=Math.floor(ep(r)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=JF(s);for(let d=0,f=0;d<i;d++){const m=e.slice(f,f+c-s+(d<a?0:1));f+=m.length;const p=QF(m,u);d<a&&m.push(0),l.push(m.concat(p))}const h=[];for(let d=0;d<l[0].length;d++)l.forEach((f,m)=>{(d!==c-s||m>=a)&&h.push(f[d])});return h}drawCodewords(e){if(e.length!==Math.floor(ep(this.version)/8))throw new RangeError("Invalid argument");let r=0;for(let n=this.size-1;n>=1;n-=2){n===6&&(n=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=n-s,c=(n+1&2)===0?this.size-1-i:i;!this.types[c][o]&&r<e.length*8&&(this.modules[c][o]=Ri(e[r>>>3],7-(r&7)),r++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let r=0;r<this.size;r++)for(let n=0;n<this.size;n++){let i;switch(e){case 0:i=(n+r)%2===0;break;case 1:i=r%2===0;break;case 2:i=n%3===0;break;case 3:i=(n+r)%3===0;break;case 4:i=(Math.floor(n/3)+Math.floor(r/2))%2===0;break;case 5:i=n*r%2+n*r%3===0;break;case 6:i=(n*r%2+n*r%3)%2===0;break;case 7:i=((n+r)%2+n*r%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[r][n]&&i&&(this.modules[r][n]=!this.modules[r][n])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=jE:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*ou),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*ou}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=jE:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*ou),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*ou}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=jF)}let r=0;for(const s of this.modules)r=s.reduce((o,a)=>o+(a?1:0),r);const n=this.size*this.size,i=Math.ceil(Math.abs(r*20-n*10)/n)-1;return e+=i*zF,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,r=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,n=[6];for(let i=this.size-7;n.length<e;i-=r)n.splice(1,0,i);return n}}finderPenaltyCountPatterns(e){const r=e[1],n=r>0&&e[2]===r&&e[3]===r*3&&e[4]===r&&e[5]===r;return(n&&e[0]>=r*4&&e[6]>=r?1:0)+(n&&e[6]>=r*4&&e[0]>=r?1:0)}finderPenaltyTerminateAndCount(e,r,n){return e&&(this.finderPenaltyAddHistory(r,n),r=0),r+=this.size,this.finderPenaltyAddHistory(r,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(e,r){r[0]===0&&(e+=this.size),r.pop(),r.unshift(e)}}function Si(t,e,r){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let n=e-1;n>=0;n--)r.push(t>>>n&1)}function Ri(t,e){return(t>>>e&1)!==0}class Qd{constructor(e,r,n){if(this.mode=e,this.numChars=r,this.bitData=n,r<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}getData(){return this.bitData.slice()}}const HF=[1,10,12,14],GF=[2,9,11,13],KF=[4,8,16,16];function HE(t,e){return t[Math.floor((e+7)/17)+1]}function GE(t){const e=[];for(const r of t)Si(r,8,e);return new Qd(KF,t.length,e)}function qF(t){if(!KE(t))throw new RangeError("String contains non-numeric characters");const e=[];for(let r=0;r<t.length;){const n=Math.min(t.length-r,3);Si(Number.parseInt(t.substring(r,r+n),10),n*3+1,e),r+=n}return new Qd(HF,t.length,e)}function YF(t){if(!qE(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let r;for(r=0;r+2<=t.length;r+=2){let n=Xd.indexOf(t.charAt(r))*45;n+=Xd.indexOf(t.charAt(r+1)),Si(n,11,e)}return r<t.length&&Si(Xd.indexOf(t.charAt(r)),6,e),new Qd(GF,t.length,e)}function VF(t){return t===""?[]:KE(t)?[qF(t)]:qE(t)?[YF(t)]:[GE(ZF(t))]}function KE(t){return $F.test(t)}function qE(t){return DF.test(t)}function XF(t,e){let r=0;for(const n of t){const i=HE(n.mode,e);if(n.numChars>=1<<i)return Number.POSITIVE_INFINITY;r+=4+i+n.bitData.length}return r}function ZF(t){t=encodeURI(t);const e=[];for(let r=0;r<t.length;r++)t.charAt(r)!=="%"?e.push(t.charCodeAt(r)):(e.push(Number.parseInt(t.substring(r+1,r+3),16)),r+=2);return e}function ep(t){if(t<Zd||t>Jd)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const r=Math.floor(t/7)+2;e-=(25*r-10)*r-55,t>=7&&(e-=36)}return e}function au(t,e){return Math.floor(ep(t)/8)-zE[e[0]][t]*WE[e[0]][t]}function JF(t){if(t<1||t>255)throw new RangeError("Degree out of range");const e=[];for(let n=0;n<t-1;n++)e.push(0);e.push(1);let r=1;for(let n=0;n<t;n++){for(let i=0;i<e.length;i++)e[i]=tp(e[i],r),i+1<e.length&&(e[i]^=e[i+1]);r=tp(r,2)}return e}function QF(t,e){const r=e.map(n=>0);for(const n of t){const i=n^r.shift();r.push(0),e.forEach((s,o)=>r[o]^=tp(s,i))}return r}function tp(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let r=0;for(let n=7;n>=0;n--)r=r<<1^(r>>>7)*285,r^=(e>>>n&1)*t;return r}function eP(t,e,r=1,n=40,i=-1,s=!0){if(!(Zd<=r&&r<=n&&n<=Jd)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=r;;o++){const h=au(o,e)*8,d=XF(t,o);if(d<=h){a=d;break}if(o>=n)throw new RangeError("Data too long")}for(const h of[BE,$E,DE])s&&a<=au(o,h)*8&&(e=h);const c=[];for(const h of t){Si(h.mode[0],4,c),Si(h.numChars,HE(h.mode,o),c);for(const d of h.getData())c.push(d)}const l=au(o,e)*8;Si(0,Math.min(4,l-c.length),c),Si(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)Si(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,d)=>u[d>>>3]|=h<<7-(d&7)),new WF(o,e,u,i)}function tP(t,e){const{ecc:r="L",boostEcc:n=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof t=="string"?VF(t):Array.isArray(t)?[GE(t)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof t}`);const l=eP(c,BF[r],i,s,o,n),u=rP({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e?.invert&&(u.data=u.data.map(h=>h.map(d=>!d))),e?.onEncoded?.(u),u}function rP(t,e=1){if(!e)return t;const{size:r}=t,n=r+e*2;t.size=n,t.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)t.data.unshift(Array.from({length:n},o=>!1)),t.data.push(Array.from({length:n},o=>!1));const i=Is.Border;t.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)t.types.unshift(Array.from({length:n},o=>i)),t.types.push(Array.from({length:n},o=>i));return t}function nP(t,e,r,n=!1){return e<0||r<0||e>=t.length||r>=t.length?n:t[r][e]}function iP(t,e={}){const r={WHITE_ALL:"█",WHITE_BLACK:"▀",BLACK_WHITE:"▄",BLACK_ALL:" "},n=tP(t,e),i=!1,s=!0,o=(l,u)=>nP(n.data,l,u,!0),a=[];let c="";for(let l=0;l<n.size;l+=2){for(let u=0;u<n.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=r.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=r.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=r.BLACK_WHITE:c+=r.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const qi="$dkpurple",sP="$196",oP="$205",qt="$yellow$205$205$205$196";function yt(t,e,r){HT(t,e,r)}function aP(t,e,r){const n=sP.repeat(r);yt(t,e,`${qi}${n}`)}function rp(t,e,r){const n=oP.repeat(r);yt(t,e,`${qi}${n}`)}function np(t,e,r){yt(t,e,`${qi} ${" ".repeat(r.length)} `),aP(t,e,r.length+2),yt(t,e,`${qi} $white${r} `),rp(t,e,r.length+2)}function Ns(t,e,r){yt(t,e,`${qi} ${" ".repeat(r.length)} `),yt(t,e,`${qi} $gray${r} `),rp(t,e,r.length+2)}function Cs(t,e,r,n){yt(t,e,`${qi} $white${r} $blue${n}`)}function To(t,e,r){yt(t,e,`${qi}$blue${r}`)}function cP(t,e,r,n){yt(t,e,`!${r};${n}`)}function lP(t,e,r,n,i=!0){if(i){const s=iP(r).split(`
`),o={32:32,9600:223,9604:220,9608:219};for(let a=0;a<s.length;a++){const c=[...s[a]].map(l=>`$${o[l.charCodeAt(0)]}`).join("");yt(t,e,c)}}yt(t,e,`!copyit ${r};${n}`),xS(t,e)}var uP=`desc;$DKGRAYname and type of codepage
`,fP=Object.freeze({__proto__:null,default:uP}),hP="desc;changes object into specified element",dP=Object.freeze({__proto__:null,default:hP}),pP="desc;like #play but for sound effects",mP=Object.freeze({__proto__:null,default:pP}),gP="",yP=Object.freeze({__proto__:null,default:gP}),_P="",bP=Object.freeze({__proto__:null,default:_P}),wP="",vP=Object.freeze({__proto__:null,default:wP}),EP="",kP=Object.freeze({__proto__:null,default:EP}),xP="",AP=Object.freeze({__proto__:null,default:xP}),TP="",SP=Object.freeze({__proto__:null,default:TP}),RP="",OP=Object.freeze({__proto__:null,default:RP}),IP="",NP=Object.freeze({__proto__:null,default:IP}),CP="",LP=Object.freeze({__proto__:null,default:CP}),MP="",UP=Object.freeze({__proto__:null,default:MP}),FP="",PP=Object.freeze({__proto__:null,default:FP}),BP="",$P=Object.freeze({__proto__:null,default:BP}),DP="",jP=Object.freeze({__proto__:null,default:DP}),zP="",WP=Object.freeze({__proto__:null,default:zP}),HP="",GP=Object.freeze({__proto__:null,default:HP}),KP=`desc;$DKGRAYstarts a section of an if-do-done block
`,qP=Object.freeze({__proto__:null,default:KP}),YP=`desc;$DKGRAYcompletes an if-do-done block
`,VP=Object.freeze({__proto__:null,default:YP}),XP="",ZP=Object.freeze({__proto__:null,default:XP}),JP="",QP=Object.freeze({__proto__:null,default:JP}),eB="",tB=Object.freeze({__proto__:null,default:eB}),rB=`desc;$DKGRAYelse logic in an if-do-done block
`,nB=Object.freeze({__proto__:null,default:rB}),iB=`desc;$DKGRAYconditional else logic in an if-do-done block
`,sB=Object.freeze({__proto__:null,default:iB}),oB="",aB=Object.freeze({__proto__:null,default:oB}),cB="",lB=Object.freeze({__proto__:null,default:cB}),uB="",fB=Object.freeze({__proto__:null,default:uB}),hB="",dB=Object.freeze({__proto__:null,default:hB}),pB="",mB=Object.freeze({__proto__:null,default:pB}),gB="",yB=Object.freeze({__proto__:null,default:gB}),_B="",bB=Object.freeze({__proto__:null,default:_B}),wB="",vB=Object.freeze({__proto__:null,default:wB}),EB=`desc;$DKGRAYhalt until the next cycle
`,kB=Object.freeze({__proto__:null,default:EB}),xB=`desc;$DKGRAYevals condition for true or false
`,AB=Object.freeze({__proto__:null,default:xB}),TB="",SB=Object.freeze({__proto__:null,default:TB}),RB="",OB=Object.freeze({__proto__:null,default:RB}),IB="",NB=Object.freeze({__proto__:null,default:IB}),CB="",LB=Object.freeze({__proto__:null,default:CB}),MB="",UB=Object.freeze({__proto__:null,default:MB}),FB="",PB=Object.freeze({__proto__:null,default:FB}),BB="",$B=Object.freeze({__proto__:null,default:BB}),DB="",jB=Object.freeze({__proto__:null,default:DB}),zB="",WB=Object.freeze({__proto__:null,default:zB}),HB="",GB=Object.freeze({__proto__:null,default:HB}),KB="",qB=Object.freeze({__proto__:null,default:KB}),YB="",VB=Object.freeze({__proto__:null,default:YB}),XB="",ZB=Object.freeze({__proto__:null,default:XB}),JB="",QB=Object.freeze({__proto__:null,default:JB}),e$="",t$=Object.freeze({__proto__:null,default:e$}),r$="",n$=Object.freeze({__proto__:null,default:r$}),i$="",s$=Object.freeze({__proto__:null,default:i$}),o$="",a$=Object.freeze({__proto__:null,default:o$}),c$="",l$=Object.freeze({__proto__:null,default:c$}),u$="",f$=Object.freeze({__proto__:null,default:u$}),h$="",d$=Object.freeze({__proto__:null,default:h$}),p$=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,m$=Object.freeze({__proto__:null,default:p$}),g$="",y$=Object.freeze({__proto__:null,default:g$}),_$="",b$=Object.freeze({__proto__:null,default:_$}),w$="",v$=Object.freeze({__proto__:null,default:w$}),E$="",k$=Object.freeze({__proto__:null,default:E$}),x$="",A$=Object.freeze({__proto__:null,default:x$}),T$="",S$=Object.freeze({__proto__:null,default:T$}),R$="",O$=Object.freeze({__proto__:null,default:R$}),I$="",N$=Object.freeze({__proto__:null,default:I$}),C$="",L$=Object.freeze({__proto__:null,default:C$}),M$="",U$=Object.freeze({__proto__:null,default:M$}),F$="",P$=Object.freeze({__proto__:null,default:F$}),B$="",$$=Object.freeze({__proto__:null,default:B$}),D$="",j$=Object.freeze({__proto__:null,default:D$}),z$="",W$=Object.freeze({__proto__:null,default:z$}),H$="",G$=Object.freeze({__proto__:null,default:H$}),K$="",q$=Object.freeze({__proto__:null,default:K$}),Y$="",V$=Object.freeze({__proto__:null,default:Y$}),X$="",Z$=Object.freeze({__proto__:null,default:X$}),J$="",Q$=Object.freeze({__proto__:null,default:J$}),eD=`desc;$DKGRAYdesignates an inactive label or comment
`,tD=Object.freeze({__proto__:null,default:eD}),rD=`desc;$DKGRAYadds hyperlink text

`,nD=Object.freeze({__proto__:null,default:rD}),iD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,sD=Object.freeze({__proto__:null,default:iD}),oD=`desc;$DKGRAYread number input into given stat/flag
`,aD=Object.freeze({__proto__:null,default:oD}),cD=`desc;$DKGRAYa slider input from 1 to 9 

`,lD=Object.freeze({__proto__:null,default:cD}),uD=`desc;$DKGRAYlist with label value pairs to pick from
`,fD=Object.freeze({__proto__:null,default:uD}),hD=`desc;$DKGRAYread text input into given stat/flag
`,dD=Object.freeze({__proto__:null,default:hD}),pD=`desc;$DKGRAYdesignates a starting point for running code
`,mD=Object.freeze({__proto__:null,default:pD}),gD=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,yD=Object.freeze({__proto__:null,default:gD}),_D=`desc;$DKGRAYwill move the object in the given direction
`,bD=Object.freeze({__proto__:null,default:_D}),wD=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,vD=Object.freeze({__proto__:null,default:wD}),ED=`desc;$DKGRAYcustom 8x14 charset
`,kD=Object.freeze({__proto__:null,default:ED}),xD=`desc;$DKGRAYsets stat to given value

`,AD=Object.freeze({__proto__:null,default:xD}),TD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,SD=Object.freeze({__proto__:null,default:TD}),RD=`desc;$DKGRAYread external content and/or handle events
`,OD=Object.freeze({__proto__:null,default:RD}),ID=`desc;$DKGRAYread number input into given stat/flag
`,ND=Object.freeze({__proto__:null,default:ID}),CD=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,LD=Object.freeze({__proto__:null,default:CD}),MD=`desc;$DKGRAYcustom palette colors
`,UD=Object.freeze({__proto__:null,default:MD}),FD=`desc;$DKGRAYa slider input from 1 to 9 

`,PD=Object.freeze({__proto__:null,default:FD}),BD=`desc;$DKGRAYlist with label value pairs to pick from
`,$D=Object.freeze({__proto__:null,default:BD}),DD=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,jD=Object.freeze({__proto__:null,default:DD}),zD=`desc;$DKGRAYread text input into given stat/flag
`,WD=Object.freeze({__proto__:null,default:zD}),HD=`desc;$DKGRAYadds text
`,GD=Object.freeze({__proto__:null,default:HD}),KD=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,qD=Object.freeze({__proto__:null,default:KD}),YD=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,VD=Object.freeze({__proto__:null,default:YD}),XD=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,ZD=Object.freeze({__proto__:null,default:XD}),JD=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,QD=Object.freeze({__proto__:null,default:JD}),e4=`header;player settings
#set user "name goes here"
`,t4=Object.freeze({__proto__:null,default:e4}),r4=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,n4=Object.freeze({__proto__:null,default:r4}),i4=`section;#autowah on
#autowah <number>
$white 0-100, 0 is off, 100 is full volume
#autowah basefrequency <frequency>
$white The frequency the filter is set to at the
$white low point of the wah.
#autowah octaves <number>
$white The number of octaves above the baseFrequency 
$white the filter will sweep to when fully open.
#autowah sensitivity <number>
$white The decibel threshold sensitivity for 
$white the incoming signal.
$white Normal range of -40 to 0.
#autowah gain <number>
$white Controls the loudness of the effect.
#autowah follower <seconds>
$white Sets the smoothing time for the effect.`,s4=Object.freeze({__proto__:null,default:i4}),o4=`section;#distort on
#distort <number>
$white 0-100, 0 is off, 100 is full volume
#distort distortion <number>
$white 0 or higher, controls strength of effect.
#distort oversample <2x|4x|none>
$white oversample improves quality.`,a4=Object.freeze({__proto__:null,default:o4}),c4=`section;#echo on
#echo <number>
$white 0-100, 0 is off, 100 is full volume
#echo delaytime <seconds>
$white duration between echos.
#echo feedback <number>
$white A number that is between [0, 1]
$white 1 is forever feedback and 0 is none.`,l4=Object.freeze({__proto__:null,default:c4}),u4=`!fcrushscroll hk f F next;#fcrush on
!echoscroll hk e E next;#echo on
!reverbscroll hk r R next;#reverb on
!phaserscroll hk p P next;#phaser on
!distortscroll hk d D next;#distort on
!vibratoscroll hk v V next;#vibrato on
!autowahscroll hk a A next;#autowah on`,f4=Object.freeze({__proto__:null,default:u4}),h4=`section;#fcrush on
#fcrush <number>
$white 0-100, 0 is off, 100 is full volume
#fcrush rate <number>
$white 1 or higher, more rate, more crush`,d4=Object.freeze({__proto__:null,default:h4}),p4=`helper scrolls
!charscroll hk a A next;char
!colorscroll hk c C next;color
!notesscroll hk n N next;notes
!synthscroll hk s S next;synth
!effectsscroll hk e E next;effects
!voicescroll hk v V next;tts voices`,m4=Object.freeze({__proto__:null,default:p4}),g4=`"duration             cdefgab - notes 
"y - 64th note        x - rest
"t - 32nd note        
"s - 16th note.       drums
"i - eight note.      0 - hihat
"q - quarter note     1 - open hihat
"h - half note        2 - cowbell
"w - whole note       p - clap
"                     4 - high snare
"mods                 5 - high woodblock
"3 - triplet          6 - low snare
". - time and a half  7 - low tom
"# - sharp            8 - low woodblock
"! - flat             9 - bass drum`,y4=Object.freeze({__proto__:null,default:g4}),_4=`section;sine, square, triangle, sawtooth
#synth phase <degrees>
$white The phase is the starting position within 
$white the oscillator's cycle. For example a phase 
$white of 180 would start halfway through the
$white oscillator's cycle.
section;amsine, amsquare, amtriangle, amsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
section;fmsine, fmsquare, fmtriangle, fmsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
#synth modindex <degrees>
$white The modulation index which is in essence
$white the depth or amount of the modulation.
$white In other terms it is the ratio of the 
$white frequency of the modulating signal (mf) 
$white to the amplitude of the modulating signal 
$white (ma) -- as in ma/mf
#synth modenv <a> <d> <s> <r> - in seconds
section;fatsine, fatsquare, fattriangle, fatsawtooth
#synth phase <degrees>
#synth count <number>
$white This sets the number of oscillators to 
$white spread along the given range.
#synth spread <cents>
$white This signals the number of cents between
$white oscillators.`,b4=Object.freeze({__proto__:null,default:_4}),w4=`section;#phaser on
#phaser <number>
$white 0-100, 0 is off, 100 is full volume
#phaser frequency <frequency>
$white The rate of oscilation of the effect.
#phaser octaves <number>
$white Controls the range of the effect.
#phaser basefrequency <frequency>
$white The base frequency of the filters.
`,v4=Object.freeze({__proto__:null,default:w4}),E4=`section;pulse
#synth width <range>
$white A number that is between [-1, 1] altering
$white this value changes the shape of the square
$white wave`,k4=Object.freeze({__proto__:null,default:E4}),x4=`section;pwm
#synth modfreq <frequency>
$white This sets the frequency of change for the 
$white pulse width of this oscillator.`,A4=Object.freeze({__proto__:null,default:x4}),T4=`section;#reverb on
#reverb <number>
$white 0-100, 0 is off, 100 is full volume
#reverb predelay <seconds>
$white The amount of time before the reverb
$white is fully ramped in.
#reverb decay <seconds>
$white The duration of the reverb.
`,S4=Object.freeze({__proto__:null,default:T4}),R4=`switching voices
#synth <sine, square, triangle, sawtooth> 
#synth <pwm, pulse, bells, doot>
#synth <retro, buzz, clang, metallic>

voice settings
#synth restart - resets voice to default
#synth vol <db> - control volume
#synth port <seconds>
#synth env <attack> <delay> <sustain> <release>

voice specific 
!oscscroll hk o O next;sine, square, triangle, sawtooth
!pwmscroll hk m M next;pwm
!pulsescroll hk p P next;pulse`,O4=Object.freeze({__proto__:null,default:R4}),I4=`section;#vibrato on
#vibrato <number>
$white 0-100, 0 is off, 100 is full volume
#vibrato maxdelay <seconds>
$white longer delay increases the vibrato`,N4=Object.freeze({__proto__:null,default:I4}),C4=`!copyit "ar-SA-HamedNeural";ar-SA-HamedNeural
!copyit "ar-SA-ZariyahNeural";ar-SA-ZariyahNeural
!copyit "de-DE-AmalaNeural";de-DE-AmalaNeural
!copyit "de-DE-ConradNeural";de-DE-ConradNeural
!copyit "de-DE-KatjaNeural";de-DE-KatjaNeural
!copyit "de-DE-KillianNeural";de-DE-KillianNeural
!copyit "en-US-AnaNeural";en-US-AnaNeural
!copyit "en-US-AndrewNeural";en-US-AndrewNeural
!copyit "en-US-AriaNeural";en-US-AriaNeural
!copyit "en-US-ChristopherNeural";en-US-ChristopherNeural
!copyit "en-US-EricNeural";en-US-EricNeural
!copyit "en-US-GuyNeural";en-US-GuyNeural
!copyit "en-US-JennyNeural";en-US-JennyNeural
!copyit "en-US-MichelleNeural";en-US-MichelleNeural
!copyit "en-US-RogerNeural";en-US-RogerNeural
!copyit "en-US-SteffanNeural";en-US-SteffanNeural
!copyit "es-ES-AlvaroNeural";es-ES-AlvaroNeural
!copyit "es-ES-ElviraNeural";es-ES-ElviraNeural
!copyit "fr-FR-DeniseNeural";fr-FR-DeniseNeural
!copyit "fr-FR-EloiseNeural";fr-FR-EloiseNeural
!copyit "fr-FR-HenriNeural";fr-FR-HenriNeural`,L4=Object.freeze({__proto__:null,default:C4});const YE=Object.assign({"./editor/codepagename.txt":fP,"./editor/command/become.txt":dP,"./editor/command/bgplay.txt":mP,"./editor/command/bgvol.txt":yP,"./editor/command/bind.txt":bP,"./editor/command/board.txt":vP,"./editor/command/bpm.txt":kP,"./editor/command/break.txt":AP,"./editor/command/change.txt":SP,"./editor/command/char.txt":OP,"./editor/command/charset.txt":NP,"./editor/command/clear.txt":LP,"./editor/command/color.txt":UP,"./editor/command/continue.txt":PP,"./editor/command/copy.txt":$P,"./editor/command/cycle.txt":jP,"./editor/command/die.txt":WP,"./editor/command/distort.txt":GP,"./editor/command/do.txt":qP,"./editor/command/done.txt":VP,"./editor/command/duplicate.txt":ZP,"./editor/command/echo.txt":QP,"./editor/command/edge.txt":tB,"./editor/command/else.txt":nB,"./editor/command/elseif.txt":sB,"./editor/command/end.txt":aB,"./editor/command/endgame.txt":lB,"./editor/command/endwith.txt":fB,"./editor/command/fcrush.txt":dB,"./editor/command/fetch.txt":mB,"./editor/command/fetchwith.txt":yB,"./editor/command/foreach.txt":bB,"./editor/command/go.txt":vB,"./editor/command/idle.txt":kB,"./editor/command/if.txt":AB,"./editor/command/lock.txt":SB,"./editor/command/oneof.txt":OB,"./editor/command/oneofwith.txt":NB,"./editor/command/palette.txt":LB,"./editor/command/phaser.txt":UB,"./editor/command/pivot.txt":PB,"./editor/command/play.txt":$B,"./editor/command/put.txt":jB,"./editor/command/putwith.txt":WB,"./editor/command/readbin.txt":GB,"./editor/command/readjson.txt":qB,"./editor/command/readline.txt":VB,"./editor/command/readrexpaint.txt":ZB,"./editor/command/remix.txt":QB,"./editor/command/repeat.txt":t$,"./editor/command/restore.txt":n$,"./editor/command/reverb.txt":s$,"./editor/command/revert.txt":a$,"./editor/command/run.txt":l$,"./editor/command/runwith.txt":f$,"./editor/command/set.txt":d$,"./editor/command/shoot.txt":m$,"./editor/command/shootwith.txt":y$,"./editor/command/shove.txt":b$,"./editor/command/snapshot.txt":v$,"./editor/command/synth.txt":k$,"./editor/command/toast.txt":A$,"./editor/command/tts.txt":S$,"./editor/command/ttsvol.txt":O$,"./editor/command/twitchbroadcast.txt":N$,"./editor/command/twitchchat.txt":L$,"./editor/command/unlock.txt":U$,"./editor/command/vibrato.txt":P$,"./editor/command/vol.txt":$$,"./editor/command/waitfor.txt":j$,"./editor/command/walk.txt":W$,"./editor/command/weave.txt":G$,"./editor/command/while.txt":q$,"./editor/command/with.txt":V$,"./editor/command/write.txt":Z$,"./editor/command/zap.txt":Q$,"./editor/comment.txt":tD,"./editor/hyperlink.txt":nD,"./editor/hyperlink/hotkey.txt":sD,"./editor/hyperlink/number.txt":aD,"./editor/hyperlink/range.txt":lD,"./editor/hyperlink/select.txt":fD,"./editor/hyperlink/text.txt":dD,"./editor/label.txt":mD,"./editor/shortgo.txt":yD,"./editor/shorttry.txt":bD,"./editor/stat/board.txt":vD,"./editor/stat/charset.txt":kD,"./editor/stat/const.txt":AD,"./editor/stat/hotkey.txt":SD,"./editor/stat/loader.txt":OD,"./editor/stat/number.txt":ND,"./editor/stat/object.txt":LD,"./editor/stat/palette.txt":UD,"./editor/stat/range.txt":PD,"./editor/stat/select.txt":$D,"./editor/stat/terrain.txt":jD,"./editor/stat/text.txt":WD,"./editor/text.txt":GD,"./help/controls.txt":qD,"./help/developer.txt":VD,"./help/menu.txt":ZD,"./help/nopages.txt":QD,"./help/player.txt":t4,"./help/text.txt":n4,"./refscroll/autowahscroll.txt":s4,"./refscroll/distortscroll.txt":a4,"./refscroll/echoscroll.txt":l4,"./refscroll/effectsscroll.txt":f4,"./refscroll/fcrushscroll.txt":d4,"./refscroll/menu.txt":m4,"./refscroll/notesscroll.txt":y4,"./refscroll/oscscroll.txt":b4,"./refscroll/phaserscroll.txt":v4,"./refscroll/pulsescroll.txt":k4,"./refscroll/pwmscroll.txt":A4,"./refscroll/reverbscroll.txt":S4,"./refscroll/synthscroll.txt":O4,"./refscroll/vibratoscroll.txt":N4,"./refscroll/voicescroll.txt":L4}),VE={};Mr(YE).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");VE[e]=YE[t].default});function ip(t){const e=$e(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),r=VE[e];if(v(r))return r;const{target:n,path:i}=Fr(e);switch(n){case"editor":{const s=Fr(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function sp(t,e){const r=(t??"").split(`
`);for(let n=0;n<r.length;++n)e(r[n].split(";"))}function M4(t,e){const[r,...n]=e,i=n[0]??"",s=n[1]??"";switch($e(r.trim())){case"header":np(le,t,i);break;case"section":Ns(le,t,i);break;case"option":Cs(le,t,i,s);break;default:r.trimStart().startsWith("!")?cP(le,t,r.trimStart().slice(1),i):yt(le,t,r);break}}const Ls="$dkpurple",U4="$196",F4="$205";function P4(t,e){const r=U4.repeat(e);Pe(t,`${Ls}${r}`)}function XE(t,e){const r=F4.repeat(e);Pe(t,`${Ls}${r}`)}function B4(t,e){Pe(t,`${Ls} ${" ".repeat(e.length)} `),P4(t,e.length+2),Pe(t,`${Ls} $white${e} `),XE(t,e.length+2)}function $4(t,e){Pe(t,`${Ls} ${" ".repeat(e.length)} `),Pe(t,`${Ls} $gray${e} `),XE(t,e.length+2)}function D4(t,e,r){Pe(t,`${Ls} $white${e} $blue${r}`)}function ZE(t,e){const[r,...n]=e,i=n[0]??"",s=n[1]??"";switch($e(r.trim())){case"header":B4(t,i);break;case"section":$4(t,i);break;case"option":D4(t,i,s);break;default:if(r.trimStart().startsWith("!")){const o=r.trimStart().slice(1).split(" ");switch($e(o[0]??"")){case"copyit":De(t,"refscroll",i,["",o[0]??"",o[1]??""]);break;default:{switch($e(o[1]??"")){case"hk":case"hotkey":De(t,"refscroll",i,[o[0]??"",o[1]??"",o[2]??"",` ${o[3]??""} `,o[4]??""]);break;default:De(t,"refscroll",i,[o[0]??""]);break}break}}}else r.trimStart().startsWith('"')?Pe(t,r.trimStart().slice(1)):Pe(t,r);break}}function Oi(t,e=!1){const[r]=fe(t,0,[Z.ANY]);if(e&&en(r)){const[n,i,s]=fe(t,0,[Z.DIR,Z.MAYBE_NAME]);return be(i)&&i.startsWith(":")?{targetdir:n,label:[i.substring(1).trim(),...t.slice(s)].join(" ")}:{targetdir:n,label:t.slice(s-1).join(" ")}}else if(be(r)){const[n,i,s]=fe(t,0,[Z.NAME,Z.MAYBE_NAME]);if(be(i)&&i.startsWith(":")){const a=[i.substring(1).trim(),...t.slice(s)];return{targetname:n,label:a.join(" ")}}return{targetname:"self",label:[n,...t.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Ms(){Tm(le,wr())}function So(t){sp(ip(`help:${t}`),e=>M4(k.elementfocus,e))}function JE(t){switch(t.label){case"helpmenu":So("menu");break;case"helpcontrols":So("controls");break;case"helptext":So("text");break;case"helpdeveloper":So("developer");break;case"helpplayer":So("player");break;default:{const e=dt(Ze.MAIN),r=Ao(e);v(t.targetname)?Uo(t.targetname,t.label,void 0,r):v(t.targetdir)&&Uo(t.targetdir.destpt,t.label,void 0,r);break}}}const j4=yi().command("shortsend",(t,e)=>{const r=Oi(e);return JE(r),0}).command("send",(t,e)=>{const r=Oi(e,!0);return JE(r),0}).command("stat",(t,e)=>{const[r,...n]=e.map(Ut),i=n.join(" ");function s(o,a){if(v(o)&&(t.command("pageopen",o.id),a)){const c=gt(o),l=Ai(o);yt(le,k.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch($e(r)){case nn(Fe.LOADER):{const[o,a]=Xi(Ze.MAIN,i,Re.LOADER);s(o,a);break}default:{const[o,a]=Xi(Ze.MAIN,[r,...n].join(" "),Re.OBJECT);s(o,a);break}case nn(Fe.BOARD):{const[o,a]=Xi(Ze.MAIN,i,Re.BOARD);s(o,a);break}case nn(Fe.OBJECT):{const[o,a]=Xi(Ze.MAIN,i,Re.OBJECT);s(o,a);break}case nn(Fe.TERRAIN):{const[o,a]=Xi(Ze.MAIN,i,Re.TERRAIN);s(o,a);break}case nn(Fe.CHARSET):{const[o,a]=Xi(Ze.MAIN,i,Re.CHARSET);s(o,a);break}case nn(Fe.PALETTE):{const[o,a]=Xi(Ze.MAIN,i,Re.PALETTE);s(o,a);break}}return 0}).command("text",(t,e)=>{const r=e.map(Ut).join(" ");if(v(k.element)&&k.elementisplayer){const{user:n}=qr(k.elementid),i=be(n)?n:"player";k.element.tickertext=`${i}: ${r}`,k.element.tickertime=k.timestamp;const s=ar(k.element);GT(le,k.elementid,`$${Ke[s.color]}$ON${Ke[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${r}`),df(le,k.elementid,void 0,"text","chat:message:game",`${i}:${r}`)}return 0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Ut(r),s=Oi(n);if(v(s.targetname)){const{user:o}=qr(k.elementid),a=be(o)?o:"player",c=ar(k.element),l=`$${Ke[c.color]}$ON${Ke[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;Pt(le,k.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(t,e)=>{const[r,n]=fe(e,0,[Z.MAYBE_NAME,Z.MAYBE_STRING]);return be(r)&&be(n)?km(le,k.elementfocus,r,n):ES(le,k.elementfocus),0}).command("bookcreate",(t,e)=>{const[r]=fe(e,0,[Z.MAYBE_NAME]),n=eA(r);return v(n)&&t.command("bookopen",n.id),0}).command("bookopen",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),n=Bn(r);return v(n)?(km(le,k.elementfocus,"selected",n.id),Ms()):mt(le,k.elementfocus,"bookopen",`book ${r} not found`),0}).command("booktrash",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),n=dt(Ze.MAIN),i=Bn(r);return v(i)&&(n===i&&Qx(Ze.MAIN,""),tz(r),Pt(le,k.elementfocus,`trashed [book] ${i.name}`),Ms(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),n=fr(r);return v(n)&&xo(k.book,k.elementfocus,n.id,{x:fn(0,Ce-1),y:fn(0,et-1)},!0),0}).command("pageopen",(t,e)=>{const[r,n]=fe(e,0,[Z.NAME,Z.MAYBE_NAME]);let i,s;const o=wn();for(let a=0;a<o.length&&(s=o[a],i=Ss(s,r),!v(i));++a);if(v(i)&&v(s)){const a=gt(i),c=[i.id,n];ih(uc(s.id,c),i.code);const l=Ai(i);xm(le,k.elementfocus,s.id,c,l,`${a} - ${s.name}`)}else mt(le,"pageopen",`page ${r} not found`,k.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),n=lr(Ze.MAIN),i=EE(n,r);if(v(r)){const s=gt(i),o=Ai(i);Pt(le,k.elementfocus,`trashed [${o}] ${s}`),Ms(),t.command("pages")}return 0}).command("help",(t,e)=>{const r=e.map(Ut).join(" ")||"menu";return t.command(`help${r}`),0}).command("books",()=>{Ns(le,k.elementfocus,"books");const t=dt(Ze.MAIN);Cs(le,k.elementfocus,"main",`${t?.name??"empty"} $GREEN${t?.id??""}`);const e=dt(Ze.MAIN);Cs(le,k.elementfocus,"content",`${e?.name??"empty"} ${e?.id??""}`),rp(le,k.elementfocus,7);const r=wn();return r.length?r.forEach(n=>{yt(le,k.elementfocus,`!bookopen ${n.id};${n.name}`)}):To(le,k.elementfocus,"no books found"),yt(le,k.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=lr(Ze.MAIN);if(!v(t))return 0;Ns(le,k.elementfocus,"pages"),Cs(le,k.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?za(t).forEach(n=>{const i=gt(n),s=Ai(n);yt(le,k.elementfocus,`!pageopen ${n.id};$blue[${s}]$white ${i}`)}):(yt(le,k.elementfocus,""),So("nopages"));const e=wn();for(let r=0;r<e.length;++r){const n=e[r];n.id!==t.id&&(Cs(le,k.elementfocus,"content",`${n.name} $GREEN${n.id}`),za(n).forEach(s=>{const o=gt(s),a=Ai(s);yt(le,k.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Ns(le,k.elementfocus,"boards");const t=lr(Ze.MAIN);if(v(t)){Cs(le,k.elementfocus,"main",`${t.name} $GREEN${t.id}`);const r=za(t);r.filter(n=>ai(n)===Re.BOARD).forEach(n=>{const i=gt(n);yt(le,k.elementfocus,`!boardopen ${n.id};$blue[#goto]$white ${i}`)}),r.length===0&&(yt(le,k.elementfocus,""),To(le,k.elementfocus,"$white no boards found"),To(le,k.elementfocus,"$white use @ to create a board"),To(le,k.elementfocus,"$white @board name of board"))}const e=wn();for(let r=0;r<e.length;++r){const n=e[r];n.id!==t.id&&(Cs(le,k.elementfocus,"content",`${n.name} $GREEN${n.id}`),za(n).filter(s=>ai(s)===Re.BOARD).forEach(s=>{const o=gt(s);yt(le,k.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{Ns(le,k.elementfocus,"$REDTRASH"),To(le,k.elementfocus,"books");const t=wn();t.length&&(t.forEach(r=>{yt(le,k.elementfocus,`!booktrash ${r.id};$REDTRASH ${r.name}`)}),yt(le,k.elementfocus,""));const e=dt(Ze.MAIN);return v(e)&&(To(le,k.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(r=>{const n=gt(r);yt(le,k.elementfocus,`!pagetrash ${r.id};$REDTRASH ${n}`)}),yt(le,k.elementfocus,"")),0}).command("dev",()=>(Ms(),cS(le,k.elementfocus),0)).command("share",()=>(Ms(),lS(le,k.elementfocus),0)).command("save",()=>(Ms(),0)).command("fork",()=>(NS(le,k.elementfocus),0)).command("itchiopublish",()=>(CS(le,k.elementfocus),0)).command("nuke",()=>(uS(le,k.elementfocus),0)).command("restart",()=>(IS(le,k.elementfocus),Ms(),0)).command("export",()=>{np(le,k.elementfocus,"E X P O R T"),Ns(le,k.elementfocus,"books");const t=wn();return t.length&&t.forEach(e=>yt(le,k.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),n=Bn(r);return v(n)&&(np(le,k.elementfocus,"E X P O R T"),Ns(le,k.elementfocus,"pages"),setTimeout(()=>{if(n.pages.length){const i=za(n);yt(le,k.elementfocus,`!bookallexport ${r};$blue[all]$white export book`),i.forEach(s=>{const o=gt(s),a=Ai(s);yt(le,k.elementfocus,`!pageexport ${r}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),n=Bn(r);return v(n)&&vm(le,k.elementfocus,xn(n),`${n.name}.book.json`),0}).command("pageexport",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),{target:n,path:i}=Fr(r),s=Bn(n),o=Ss(s,i);return v(o)&&vm(le,k.elementfocus,xn(o),`${gt(o)}.${Ai(o)}.json`),0}).command("gadget",()=>(kS(le,k.elementfocus),0)).command("zztsearch",(t,e)=>{const[r,n]=fe(e,0,[Z.NAME,Z.MAYBE_NAME]),i=v(n)?r:"title",s=v(n)?n:r;return AS(le,k.elementfocus,i,s),0}).command("zztrandom",()=>(TS(le,k.elementfocus),0)).command("joincode",(t,e)=>{const[r]=fe(e,0,[Z.MAYBE_NAME]);return ZT(le,k.elementfocus,!!r),0}).command("jointab",(t,e)=>{const[r]=fe(e,0,[Z.MAYBE_NAME]);return JT(le,k.elementfocus,!!r),0}).command("startlookingglass",()=>(fS(le,k.elementfocus),0)),z4=yi().command("toast",(t,e)=>{const r=e.map(Ut).join("");return Yo(le,k.elementfocus,r),0}).command("ticker",(t,e)=>{const r=e.map(Ut).join("");return v(k.element)&&(k.element.tickertext=r,k.element.tickertime=k.timestamp),0}).command("palette",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),n=rA(),i=ur(Re.PALETTE,r);return v(i)?(n.palette=i.id,Pt(le,k.elementfocus,`loaded palette ${r}`)):mt(le,k.elementfocus,"not-found",`unabled to find palette ${r}`),0}).command("charset",(t,e)=>{const[r]=fe(e,0,[Z.NAME]),n=rA(),i=ur(Re.CHARSET,r);return v(i)?(n.charset=i.id,Pt(le,k.elementfocus,`loaded charset ${r}`)):mt(le,k.elementfocus,"not-found",`unabled to find charset ${r}`),0}),op={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};We.ISSOLID,We.ISWALK,We.ISSWIM,We.ISBULLET,We.ISGHOST,We.ISWALK,We.ISSWIM;function cu(t){return ut(t)&&ap(t[0])}function ap(t){return v(We[t])&&be(t)}function W4(t){if(be(t))return op[$e(t)]}function H4(t){const e=k.words[t];if(cu(e))return[e,t+1];if(ap(e))return[[e],t+1];const[r,n]=Nr(t);return cu(r)?[r,n]:ap(r)?[[r],n]:[void 0,t]}function Ro(t,e=0){const r=[];let n=t;for(;n<k.words.length;){const[i,s]=Nr(n);if(ut(i)&&!en(i)&&!Ka(i)&&!cu(i)&&!Tr(i)&&r.push(...i),i==="|")return[r,s];if(n=s,r.push(i),e>0&&r.length>=e)return[r,n]}return[r,n]}function Nr(t){const e=k.words[t],r=t+1;if(ek(e)){const[n,i]=G4(t);if(v(n))return[n,i]}if(W4(e)){const[n,i]=H4(t);if(v(n))return[n,i]}if(ha(e)){const[n,i]=Kc(t);if(v(n))return[n,i]}if(be(e)&&$e(e)==="rnd"){const[n,i]=Nr(r),[s,o]=Nr(i);return Te(n)&&Te(s)?[fn(n,s),o]:Te(n)?[fn(0,n),i]:[fn(0,1),r]}if(Wc(e)){const[n,i]=Iy(t);if(v(n))return[n,i]}if(!v(e))return[void 0,t];if(Te(e)||ut(e))return[e,r];if(be(e)){const n=$e(e),i=k.get?.(e);if(v(i))return[i,r];switch(n){case"aligned":case"alligned":{const s=ec(k.board,{x:k.element?.x??-1,y:k.element?.y??-1},k.elementfocus);return!v(k.element)||!v(s)?[0,r]:[k.element.x===s.x||k.element.y===s.y?1:0,r]}case"contact":{const s=ec(k.board,{x:k.element?.x??-1,y:k.element?.y??-1},k.elementfocus);if(!v(k.element)||!v(s))return[0,r];const o=(s.x??0)-(k.element?.x??0),a=(s.y??0)-(k.element?.y??0);return[o===0&&Math.abs(a)<2||a===0&&Math.abs(o)<2?1:0,r]}case"blocked":{const[s,o]=fe(k.words,r,[Z.DIR]);return[dF(k.board,k.element,s.destpt)?1:0,o]}case"any":{const[s]=fe(k.words,r,[Z.ANY]);if(en(s)){const[l,u,h]=fe(k.words,r,[Z.DIR,Z.COLOR_OR_KIND]);if(l.targets.length){const f=[];for(let m=0;m<l.targets.length;++m){const p=l.targets[m],g=["any","at",p.x,p.y,...u],[y]=fe(g,0,[Z.ANY]);ut(y)&&y.length&&f.push(...y)}return[f,h]}const d=l.layer===Ee.MID?it(k.board,l.destpt):Zi(k.board,l.destpt.x,l.destpt.y);if(v(d)){const f=ar(d);if(Tr(u))return[Hc(u)===f.color||Gc(u)===f.bg?[d]:[],h];const m=$e(Ja(u)),p=Tu(u);if((m.length&&m!==f.name||v(p)&&p!==f.color)===!1)return[[d],h]}return[[],h]}const[o,a]=fe(k.words,r,[Z.COLOR_OR_KIND]);return Tr(o)?[cA(k.board,o),a]:[Su(k.board,o),a]}case"countof":{const[s]=fe(k.words,r,[Z.ANY]);if(en(s)){const[l,u,h]=fe(k.words,r,[Z.DIR,Z.COLOR_OR_KIND]);if(l.targets.length){let f=0;for(let m=0;m<l.targets.length;++m){const p=l.targets[m],g=["countof","at",p.x,p.y,...u],[y]=fe(g,0,[Z.ANY]);Te(y)&&(f+=y)}return[f,h]}const d=l.layer===Ee.MID?it(k.board,l.destpt):Zi(k.board,l.destpt.x,l.destpt.y);if(v(d)){const f=ar(d);if(Tr(u))return[Hc(u)===f.color||Gc(u)===f.bg?1:0,h];const m=$e(Ja(u)),p=Tu(u),g=m.length?m===f.name:!0,y=v(p)?p===f.color:!0;if(g&&y)return[1,h]}return[0,h]}const[o,a]=fe(k.words,r,[Z.COLOR_OR_KIND]);return Tr(o)?[cA(k.board,o).length,a]:[Su(k.board,o).length,a]}case"rnd":return[fn(0,1),r];case"abs":{const[s,o]=fe(k.words,r,[Z.NUMBER]);return[Math.abs(s),o]}case"intceil":{const[s,o]=fe(k.words,r,[Z.NUMBER]);return[Math.ceil(s),o]}case"intfloor":{const[s,o]=fe(k.words,r,[Z.NUMBER]);return[Math.floor(s),o]}case"intround":{const[s,o]=fe(k.words,r,[Z.NUMBER]);return[Math.round(s),o]}case"clamp":{const[s,o,a,c]=fe(k.words,r,[Z.NUMBER,Z.NUMBER,Z.NUMBER]);return[$t(s,o,a),c]}case"min":{const[s,o]=Ro(r);return[Math.min(...s),o]}case"max":{const[s,o]=Ro(r);return[Math.max(...s),o]}case"pick":{const[s,o]=Ro(r);return[hn(s),o]}case"pickwith":{const[s,o]=fe(k.words,r,[Z.NUMBER_OR_STRING]),[a,c]=Ro(o);return[LI(`${s}`,a),c]}case"random":{const[s,o]=Ro(r,2),[a,c]=s;return[fn(a,c??0),o]}case"randomwith":{const[s,o]=fe(k.words,r,[Z.NUMBER_OR_STRING]),[a,c]=Ro(o,2),[l,u]=a;return[Ay(`${s}`,l,u??0),c]}case"run":{const[s,o]=fe(k.words,r,[Z.NAME]);return Au(s),[k.get?.("arg"),o]}case"runwith":{const[s,o,a]=fe(k.words,r,[Z.ANY,Z.NAME]);return v(k.element)&&(k.element.arg=s),Au(o),[k.get?.("arg"),a]}}}return[e,r]}const cp={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ka(t){return ut(t)&&QE(t[0])}function QE(t){return v(Ur[t])&&be(t)}function ek(t){if(be(t))return cp[$e(t)]}function tk(t){if(Ka(t))return t;if(QE(t))return[t];const e=ek(t);if(v(e))return[e]}function G4(t){const e=k.words[t],r=tk(e);if(Ka(r))return[r,t+1];const[n,i]=Nr(t),s=tk(n);return Ka(s)?[s,i]:[void 0,t]}const K4=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),rk=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"]),q4=["NORTH","SOUTH","WEST","EAST"];function Y4(t){const e=qr(t);if(Te(e.inputcurrent)||(e.inputcurrent=0),ut(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[r]=e.inputqueue,[n=Sr.NONE,i=0]=r??[Sr.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&QI?1:0,e.inputctrl=i&eN?1:0,e.inputshift=i&tN?1:0,n){case Sr.MOVE_UP:case Sr.MOVE_DOWN:case Sr.MOVE_LEFT:case Sr.MOVE_RIGHT:e.inputmove=[q4[n-Sr.MOVE_UP]];break;case Sr.OK_BUTTON:e.inputok=1;break;case Sr.CANCEL_BUTTON:e.inputcancel=1;break;case Sr.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=n,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Sr.NONE&&o!==n}),e}function V4(t){const e=cp[t];if(v(e))return e;const r=op[t];if(v(r))return r;const n=fa[t];if(v(n))return n;const i=hh[t];if(v(i))return i}function nk(){if(dr(k.board,k.element,k.timestamp),!!He(k.element,"item")){const e={x:k.element?.x??-1,y:k.element?.y??-1},r=ec(k.board,e,k.elementfocus);v(r)&&(r.x=e.x,r.y=e.y)}}const X4=yi({get(t,e){const r=V4(e);if(v(r))return[!0,r];if(k.elementisplayer&&K4.has(e)){const l=Y4(k.elementid)[e];return[v(l),l]}const n=ec(k.board,{x:k.element?.x??-1,y:k.element?.y??-1},k.elementfocus),i=n?.id??k.elementfocus??wr(),s=k.element?.sender,o=dA(k.board,be(s)?s:""),a=o?.id??"";switch(e){case"camera":case"graphics":case"facing":if(v(k.board?.[e]))return[!0,k.board?.[e]];break;case"isdark":return[!0,k.board?.isdark?1:0];case"startx":return[!0,k.board?.startx??0];case"starty":return[!0,k.board?.starty??0];case"over":return[!0,k.board?.over??""];case"under":return[!0,k.board?.under??""];case"exitnorth":return[!0,k.board?.exitnorth??""];case"exitsouth":return[!0,k.board?.exitsouth??""];case"exitwest":return[!0,k.board?.exitwest??""];case"exiteast":return[!0,k.board?.exiteast??""];case"timelimit":return[!0,k.board?.timelimit??0];case"restartonzap":return[!0,k.board?.restartonzap??0];case"maxplayershots":return[!0,k.board?.maxplayershots??0];case"currenttick":return[!0,k.timestamp];case"boardid":return[!0,k.board?.id??""];case"playerid":return[!0,i];case"playerx":return[!0,n?.x??-1];case"playery":return[!0,n?.y??-1];case"thisid":return[!0,k.element?.id??""];case"thisx":return[!0,k.element?.x??-1];case"thisy":return[!0,k.element?.y??-1];case"senderid":return[!0,a];case"senderx":return[!0,o?.x??-1];case"sendery":return[!0,o?.y??-1];default:{if(rk.has(e))return[!0,He(k.element,e)??0];break}}const c=qr(i)[e];return[v(c),c]},set(t,e,r){const i=ec(k.board,{x:k.element?.x??-1,y:k.element?.y??-1},k.elementfocus)?.id??k.elementfocus;switch(e){case"camera":case"graphics":case"facing":break;case"isdark":if(v(k.board))return k.board.isdark=r?1:0,[!0,k.board.isdark];break;case"startx":if(v(k.board))return k.board.startx=Ha(r,0),[!0,k.board.startx];break;case"starty":if(v(k.board))return k.board.starty=Ha(r,0),[!0,k.board.starty];break;case"over":if(v(k.board))return k.board.over=Ut(r),[!0,k.board.over];break;case"under":if(v(k.board))return[!0,k.board.under=Ut(r)];break;case"exitnorth":if(v(k.board))return[!0,k.board.exitnorth=Ut(r)];break;case"exitsouth":if(v(k.board))return[!0,k.board.exitsouth=Ut(r)];break;case"exitwest":if(v(k.board))return[!0,k.board.exitwest=Ut(r)];break;case"exiteast":if(v(k.board))return[!0,k.board.exiteast=Ut(r)];break;case"timelimit":if(v(k.board))return[!0,k.board.timelimit=Ha(r,0)];break;case"restartonzap":if(v(k.board))return[!0,k.board.restartonzap=r?1:0];break;case"maxplayershots":if(v(k.board))return[!0,k.board.maxplayershots=Ha(r,0)];break;case"currenttick":return[!1,r];case"boardid":return[!1,r];case"playerid":return[!1,r];case"playerx":return[!1,r];case"playery":return[!1,r];case"thisid":return[!1,r];case"thisx":return[!1,r];case"thisy":return[!1,r];case"senderid":return[!1,r];case"senderx":return[!1,r];case"sendery":return[!1,r];default:{if(rk.has(e))return v(k.element)&&(k.element[e]=r),[!0,r];break}}const s=qr(i);return v(s)?(s[e]=r,[!0,r]):[!1,r]},everytick(){!k.element?.removed&&v(k.element?.x)&&v(k.element.y)&&v(k.element.stepx)&&v(k.element.stepy)&&(k.element.stepx||k.element.stepy)&&$n(k.book,k.board,k.element,{x:k.element.x+k.element.stepx,y:k.element.y+k.element.stepy})}}).command("clear",(t,e)=>{for(let r=0;r<e.length;++r)t.set(Ut(e[r]),0);return 0}).command("set",(t,e)=>{const[r,n]=fe(e,0,[Z.NAME,Z.ANY]);return t.set(r,n??1),0}).command("become",(t,e)=>{const[r]=fe(e,0,[Z.KIND]);cr(k.board);const n=ar(k.element),[i,s]=r,o=[...uo(n.color,n.bg),...s??[]],a=[i,o];if(eu(k.board,k.element),dr(k.board,k.element,k.timestamp)){const c={x:k.element?.x??0,y:k.element?.y??0};on(k.board,a,c)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[r]=fe(e,0,[Z.ANY]);if(en(r)){const[n,i]=fe(e,0,[Z.DIR,Z.NUMBER]),s=it(k.board,n.destpt);v(s)&&(s.char=i)}else v(k.element)&&Te(r)&&(k.element.char=r);return 0}).command("color",(t,e)=>{const[r]=fe(e,0,[Z.ANY]);if(en(r)){const[n,i]=fe(e,0,[Z.DIR,Z.COLOR]),s=it(k.board,n.destpt);v(s)&&_a(k.element,i)}else{const[n]=fe(e,0,[Z.COLOR]);v(k.element)&&v(n)&&_a(k.element,n)}return 0}).command("go",(t,e)=>{if(v(k.element)){const[r]=fe(e,0,[Z.DIR]);if($n(k.book,k.board,k.element,r.destpt),t.yield(),k.element.x===r.destpt.x&&k.element.y===r.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!v(k.element))return 0;const[r]=fe(e,0,[Z.DIR]),n=k.element.x??0,i=k.element.y??0;return k.element.stepx=r.destpt.x-n,k.element.stepy=r.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[r]=fe(e,0,[Z.ANY]);return t.set("arg",r),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Ut(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Ut(e[0])),0)).command("cycle",(t,e)=>{if(v(k.element)){const[r]=fe(e,0,[Z.NUMBER]);k.element.cycle=$t(Math.round(r),1,255)}return 0}).command("die",t=>(nk(),t.endofprogram(),0)).command("dieonend",()=>(nk(),0)).command("endgame",()=>(hf(le,k.elementfocus),0)).command("run",(t,e)=>{const[r]=fe(e,0,[Z.NAME]);return Au(r),0}).command("runwith",(t,e)=>{const[r,n]=fe(e,0,[Z.ANY,Z.NAME]);return t.set("arg",r),Au(n),0}),lu={};function Z4(t){return lu[t]?.arg}function ik(t){return lu[t]?.format}function Oo(t){return lu[t]?.content}function sk(t,e,r,n,i){const s=dt(Ze.MAIN);if(!v(s))return;const o=Rs(s,Re.LOADER).filter(a=>{const c=Ts(a),l=c.format,u=be(l)?new RegExp(l).test(e):!1,h=c.event,d=be(h)?new RegExp(h).test(r):!1;return be(l)&&be(h)?u&&d:be(l)?u:be(h)?d:!1});for(let a=0;a<o.length;++a){const c=`${Ft()}_loader`;lu[c]={arg:t,format:e,content:n,player:i},oz(c,o[a].code)}}function ok(t,e){if(!v(t))return;const r=$e(e),n=r.endsWith("le");switch(r){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,n);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,n);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,n);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,n);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,n);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,n);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,n);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,n);return t.cursor+=8,i}}}const J4=(t,e)=>{const r=Oo(t.id());if(!v(r))return 0;const[n,i]=fe(e,0,[Z.NAME]),s=$e(n);switch(s){case"seek":{const[o]=fe(e,i,[Z.NUMBER]);r.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=fe(e,i,[Z.NAME]);t.set(o,ok(r,s));break}case"text":{const[o,a]=fe(e,i,[Z.NAME,Z.NAME]),c=ok(r,o);if(Te(c)&&be(a)){const l=new Uint8Array(r.bytes.buffer,r.cursor,c),h=new TextDecoder("utf-8").decode(l);t.set(a,h),r.cursor+=c}break}case"palette":{const[o]=fe(e,i,[Z.NAME]),[a]=jd(k.book,Re.PALETTE,o),c=At(a);if(v(c)){const l=KI*Vc,u=u_(new Uint8Array(r.bytes.buffer,r.cursor,l));v(u)&&(c.bits=u.bits),r.cursor+=l}break}case"charset":{const[o]=fe(e,i,[Z.NAME]),[a]=jd(k.book,Re.CHARSET,o),c=At(a);if(v(c)){const l=Xc*GI*mh,u=Rh(new Uint8Array(r.bytes.buffer,r.cursor,l));v(u)&&(c.bits=u.bits),r.cursor+=l}break}}return 0},Io=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",uu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r+=1)if(!uu(t[r],e[r]))return!1;return!0}if(Io(t)&&Io(e)){const r=Object.entries(t),n=new Set(Object.keys(e));if(r.length!==n.size)return!1;for(const[i,s]of r){if(!uu(s,e[i]))return!1;n.delete(i)}return n.size===0}return!1},fu=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(Io(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},Q4=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",ak=t=>t>="0"&&t<="9"||t==="-",e5=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var oe;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(oe||(oe={}));const ck={"(":oe.TOK_LPAREN,")":oe.TOK_RPAREN,"*":oe.TOK_STAR,",":oe.TOK_COMMA,".":oe.TOK_DOT,":":oe.TOK_COLON,"@":oe.TOK_CURRENT,$:oe.TOK_ROOT,"]":oe.TOK_RBRACKET,"{":oe.TOK_LBRACE,"}":oe.TOK_RBRACE},t5={"!":!0,"<":!0,"=":!0,">":!0},r5={"	":!0,"\n":!0,"\r":!0," ":!0};class n5{constructor(){this._current=0}tokenize(e){const r=[];this._current=0;let n,i,s;for(;this._current<e.length;)if(Q4(e[this._current]))n=this._current,i=this.consumeUnquotedIdentifier(e),r.push({start:n,type:oe.TOK_UNQUOTEDIDENTIFIER,value:i});else if(ck[e[this._current]]!==void 0)r.push({start:this._current,type:ck[e[this._current]],value:e[this._current]}),this._current+=1;else if(ak(e[this._current]))s=this.consumeNumber(e),r.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),r.push(s);else if(e[this._current]==='"')n=this._current,i=this.consumeQuotedIdentifier(e),r.push({start:n,type:oe.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")n=this._current,i=this.consumeRawStringLiteral(e),r.push({start:n,type:oe.TOK_LITERAL,value:i});else if(e[this._current]==="`"){n=this._current;const o=this.consumeLiteral(e);r.push({start:n,type:oe.TOK_LITERAL,value:o})}else if(t5[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&r.push(s);else if(r5[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")n=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,r.push({start:n,type:oe.TOK_AND,value:"&&"})):r.push({start:n,type:oe.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")n=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,r.push({start:n,type:oe.TOK_OR,value:"||"})):r.push({start:n,type:oe.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return r}consumeUnquotedIdentifier(e){const r=this._current;for(this._current+=1;this._current<e.length&&e5(e[this._current]);)this._current+=1;return e.slice(r,this._current)}consumeQuotedIdentifier(e){const r=this._current;this._current+=1;const n=e.length;for(;e[this._current]!=='"'&&this._current<n;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(r,this._current))}consumeRawStringLiteral(e){const r=this._current;this._current+=1;const n=e.length;for(;e[this._current]!=="'"&&this._current<n;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(r+1,this._current-1).replace("\\'","'")}consumeNumber(e){const r=this._current;this._current+=1;const n=e.length;for(;ak(e[this._current])&&this._current<n;)this._current+=1;const i=parseInt(e.slice(r,this._current),10);return{start:r,value:i,type:oe.TOK_NUMBER}}consumeLBracket(e){const r=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:r,type:oe.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:r,type:oe.TOK_FLATTEN,value:"[]"}):{start:r,type:oe.TOK_LBRACKET,value:"["}}consumeOperator(e){const r=this._current,n=e[r];if(this._current+=1,n==="!")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_NE,value:"!="}):{start:r,type:oe.TOK_NOT,value:"!"};if(n==="<")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_LTE,value:"<="}):{start:r,type:oe.TOK_LT,value:"<"};if(n===">")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_GTE,value:">="}):{start:r,type:oe.TOK_GT,value:">"};if(n==="="&&e[this._current]==="=")return this._current+=1,{start:r,type:oe.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const r=this._current,n=e.length;for(;e[this._current]!=="`"&&this._current<n;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(r,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n=["true","false","null"],i="-0123456789";if(e==="")return!1;if('[{"'.includes(e[0])||n.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const i5=new n5,xr={[oe.TOK_EOF]:0,[oe.TOK_UNQUOTEDIDENTIFIER]:0,[oe.TOK_QUOTEDIDENTIFIER]:0,[oe.TOK_RBRACKET]:0,[oe.TOK_RPAREN]:0,[oe.TOK_COMMA]:0,[oe.TOK_RBRACE]:0,[oe.TOK_NUMBER]:0,[oe.TOK_CURRENT]:0,[oe.TOK_EXPREF]:0,[oe.TOK_ROOT]:0,[oe.TOK_PIPE]:1,[oe.TOK_OR]:2,[oe.TOK_AND]:3,[oe.TOK_EQ]:5,[oe.TOK_GT]:5,[oe.TOK_LT]:5,[oe.TOK_GTE]:5,[oe.TOK_LTE]:5,[oe.TOK_NE]:5,[oe.TOK_FLATTEN]:9,[oe.TOK_STAR]:20,[oe.TOK_FILTER]:21,[oe.TOK_DOT]:40,[oe.TOK_NOT]:45,[oe.TOK_LBRACE]:50,[oe.TOK_LBRACKET]:55,[oe.TOK_LPAREN]:60};class s5{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const r=this.expression(0);if(this.lookahead(0)!==oe.TOK_EOF){const n=this.lookaheadToken(0);this.errorToken(n,`Unexpected token type: ${n.type}, value: ${n.value}`)}return r}loadTokens(e){this.tokens=[...i5.tokenize(e),{type:oe.TOK_EOF,value:"",start:e.length}]}expression(e){const r=this.lookaheadToken(0);this.advance();let n=this.nud(r),i=this.lookahead(0);for(;e<xr[i];)this.advance(),n=this.led(i,n),i=this.lookahead(0);return n}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let r,n,i;switch(e.type){case oe.TOK_LITERAL:return{type:"Literal",value:e.value};case oe.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case oe.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===oe.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case oe.TOK_NOT:return n=this.expression(xr.Not),{type:"NotExpression",children:[n]};case oe.TOK_STAR:return r={type:"Identity"},n=this.lookahead(0)===oe.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(xr.Star),{type:"ValueProjection",children:[r,n]};case oe.TOK_FILTER:return this.led(e.type,{type:"Identity"});case oe.TOK_LBRACE:return this.parseMultiselectHash();case oe.TOK_FLATTEN:return r={type:oe.TOK_FLATTEN,children:[{type:"Identity"}]},n=this.parseProjectionRHS(xr.Flatten),{type:"Projection",children:[r,n]};case oe.TOK_LBRACKET:return this.lookahead(0)===oe.TOK_NUMBER||this.lookahead(0)===oe.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},n)):this.lookahead(0)===oe.TOK_STAR&&this.lookahead(1)===oe.TOK_RBRACKET?(this.advance(),this.advance(),n=this.parseProjectionRHS(xr.Star),{children:[{type:"Identity"},n],type:"Projection"}):this.parseMultiselectList();case oe.TOK_CURRENT:return{type:oe.TOK_CURRENT};case oe.TOK_ROOT:return{type:oe.TOK_ROOT};case oe.TOK_EXPREF:return i=this.expression(xr.Expref),{type:"ExpressionReference",children:[i]};case oe.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==oe.TOK_RPAREN;)this.lookahead(0)===oe.TOK_CURRENT?(i={type:oe.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(oe.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,r){let n;switch(e){case oe.TOK_DOT:const i=xr.Dot;return this.lookahead(0)!==oe.TOK_STAR?(n=this.parseDotRHS(i),{type:"Subexpression",children:[r,n]}):(this.advance(),n=this.parseProjectionRHS(i),{type:"ValueProjection",children:[r,n]});case oe.TOK_PIPE:return n=this.expression(xr.Pipe),{type:oe.TOK_PIPE,children:[r,n]};case oe.TOK_OR:return n=this.expression(xr.Or),{type:"OrExpression",children:[r,n]};case oe.TOK_AND:return n=this.expression(xr.And),{type:"AndExpression",children:[r,n]};case oe.TOK_LPAREN:const s=r.name,o=[];let a;for(;this.lookahead(0)!==oe.TOK_RPAREN;)this.lookahead(0)===oe.TOK_CURRENT?(a={type:oe.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===oe.TOK_COMMA&&this.match(oe.TOK_COMMA),o.push(a);return this.match(oe.TOK_RPAREN),{name:s,type:"Function",children:o};case oe.TOK_FILTER:const l=this.expression(0);return this.match(oe.TOK_RBRACKET),n=this.lookahead(0)===oe.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(xr.Filter),{type:"FilterProjection",children:[r,n,l]};case oe.TOK_FLATTEN:const u={type:oe.TOK_FLATTEN,children:[r]},h=this.parseProjectionRHS(xr.Flatten);return{type:"Projection",children:[u,h]};case oe.TOK_EQ:case oe.TOK_NE:case oe.TOK_GT:case oe.TOK_GTE:case oe.TOK_LT:case oe.TOK_LTE:return this.parseComparator(r,e);case oe.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===oe.TOK_NUMBER||d.type===oe.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice(r,n)):(this.match(oe.TOK_STAR),this.match(oe.TOK_RBRACKET),n=this.parseProjectionRHS(xr.Star),{type:"Projection",children:[r,n]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const r=this.lookaheadToken(0);this.errorToken(r,`Expected ${e}, got: ${r.type}`)}}errorToken(e,r=""){const n=new Error(r||`Invalid token (${e.type}): "${e.value}"`);throw n.name="ParserError",n}parseIndexExpression(){if(this.lookahead(0)===oe.TOK_COLON||this.lookahead(1)===oe.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(oe.TOK_RBRACKET),e}projectIfSlice(e,r){const n={type:"IndexExpression",children:[e,r]};return r.type==="Slice"?{children:[n,this.parseProjectionRHS(xr.Star)],type:"Projection"}:n}parseSliceExpression(){const e=[null,null,null];let r=0,n=this.lookahead(0);for(;n!==oe.TOK_RBRACKET&&r<3;){if(n===oe.TOK_COLON)r+=1,this.advance();else if(n===oe.TOK_NUMBER)e[r]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}n=this.lookahead(0)}return this.match(oe.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,r){const n=this.expression(xr[r]);return{type:"Comparator",name:r,children:[e,n]}}parseDotRHS(e){const r=this.lookahead(0);if([oe.TOK_UNQUOTEDIDENTIFIER,oe.TOK_QUOTEDIDENTIFIER,oe.TOK_STAR].includes(r))return this.expression(e);if(r===oe.TOK_LBRACKET)return this.match(oe.TOK_LBRACKET),this.parseMultiselectList();if(r===oe.TOK_LBRACE)return this.match(oe.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(xr[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===oe.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===oe.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===oe.TOK_DOT)return this.match(oe.TOK_DOT),this.parseDotRHS(e);const r=this.lookaheadToken(0);this.errorToken(r,`Syntax error, unexpected token: ${r.value}(${r.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==oe.TOK_RBRACKET;){const r=this.expression(0);if(e.push(r),this.lookahead(0)===oe.TOK_COMMA&&(this.match(oe.TOK_COMMA),this.lookahead(0)===oe.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(oe.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],r=[oe.TOK_UNQUOTEDIDENTIFIER,oe.TOK_QUOTEDIDENTIFIER];let n,i,s;for(;;){if(n=this.lookaheadToken(0),!r.includes(n.type))throw new Error(`Expecting an identifier token, got: ${n.type}`);if(i=n.value,this.advance(),this.match(oe.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===oe.TOK_COMMA)this.match(oe.TOK_COMMA);else if(this.lookahead(0)===oe.TOK_RBRACE){this.match(oe.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const o5=new s5;var ge;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ge||(ge={}));class a5{constructor(e){this.TYPE_NAME_TABLE={[ge.TYPE_NUMBER]:"number",[ge.TYPE_ANY]:"any",[ge.TYPE_STRING]:"string",[ge.TYPE_ARRAY]:"array",[ge.TYPE_OBJECT]:"object",[ge.TYPE_BOOLEAN]:"boolean",[ge.TYPE_EXPREF]:"expression",[ge.TYPE_NULL]:"null",[ge.TYPE_ARRAY_NUMBER]:"Array<number>",[ge.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([r])=>Math.abs(r),this.functionAvg=([r])=>{let n=0;for(let i=0;i<r.length;i+=1)n+=r[i];return n/r.length},this.functionCeil=([r])=>Math.ceil(r),this.functionContains=r=>{const[n,i]=r;return n.includes(i)},this.functionEndsWith=r=>{const[n,i]=r;return n.includes(i,n.length-i.length)},this.functionFloor=([r])=>Math.floor(r),this.functionJoin=r=>{const[n,i]=r;return i.join(n)},this.functionKeys=([r])=>Object.keys(r),this.functionLength=([r])=>Io(r)?Object.keys(r).length:r.length,this.functionMap=r=>{if(!this._interpreter)return[];const n=[],i=this._interpreter,s=r[0],o=r[1];for(let a=0;a<o.length;a+=1)n.push(i.visit(s,o[a]));return n},this.functionMax=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===ge.TYPE_NUMBER)return Math.max(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[ge.TYPE_NUMBER,ge.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=r=>{let n={};for(let i=0;i<r.length;i+=1){const s=r[i];n=Object.assign(n,s)}return n},this.functionMin=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===ge.TYPE_NUMBER)return Math.min(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[ge.TYPE_NUMBER,ge.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=r=>{for(let n=0;n<r.length;n+=1)if(this.getTypeName(r[n])!==ge.TYPE_NULL)return r[n];return null},this.functionReverse=([r])=>{if(this.getTypeName(r)===ge.TYPE_STRING){const s=r;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=r.slice(0);return i.reverse(),i},this.functionSort=([r])=>[...r].sort(),this.functionSortBy=r=>{if(!this._interpreter)return[];const n=r[0].slice(0);if(n.length===0)return n;const i=this._interpreter,s=r[1],o=this.getTypeName(i.visit(s,n[0]));if(o!==void 0&&![ge.TYPE_NUMBER,ge.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<n.length;c+=1)a.push([c,n[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)n[c]=a[c][1];return n},this.functionStartsWith=([r,n])=>r.startsWith(n),this.functionSum=([r])=>r.reduce((n,i)=>n+i,0),this.functionToArray=([r])=>this.getTypeName(r)===ge.TYPE_ARRAY?r:[r],this.functionToNumber=([r])=>{const n=this.getTypeName(r);let i;return n===ge.TYPE_NUMBER?r:n===ge.TYPE_STRING&&(i=+r,!isNaN(i))?i:null},this.functionToString=([r])=>this.getTypeName(r)===ge.TYPE_STRING?r:JSON.stringify(r),this.functionType=([r])=>{switch(this.getTypeName(r)){case ge.TYPE_NUMBER:return"number";case ge.TYPE_STRING:return"string";case ge.TYPE_ARRAY:return"array";case ge.TYPE_OBJECT:return"object";case ge.TYPE_BOOLEAN:return"boolean";case ge.TYPE_EXPREF:return"expref";case ge.TYPE_NULL:return"null";default:return}},this.functionValues=([r])=>Object.values(r),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ge.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ge.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ge.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY]},{types:[ge.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ge.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ge.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY,ge.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ge.TYPE_EXPREF]},{types:[ge.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ge.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ge.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ge.TYPE_ARRAY_STRING,ge.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ge.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ge.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ge.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ge.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ge.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ge.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,r,n){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:r.bind(this),_signature:n}}callFunction(e,r){const n=this.functionTable[e];if(n===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,r,n._signature),n._func.call(this,r)}validateInputSignatures(e,r){for(let n=0;n<r.length;n+=1)if("variadic"in r[n]&&n!==r.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${n+1} must occur last`)}validateArgs(e,r,n){var i,s;let o;this.validateInputSignatures(e,n);const a=n.filter(p=>{var g;return(g=!p.optional)!==null&&g!==void 0?g:!1}).length,c=(s=(i=n[n.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=r.length<a,u=r.length>n.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=n.length>1,new Error(`ArgumentError: ${e}() takes ${h}${a} argument${o&&"s"||""} but received ${r.length}`);let d,f,m;for(let p=0;p<n.length;p+=1){m=!1,d=n[p].types,f=this.getTypeName(r[p]);let g;for(g=0;g<d.length;g+=1)if(f!==void 0&&this.typeMatches(f,d[g],r[p])){m=!0;break}if(!m&&f!==void 0){const y=d.map(b=>this.TYPE_NAME_TABLE[b]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${p+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(e,r,n){if(r===ge.TYPE_ANY)return!0;if(r===ge.TYPE_ARRAY_STRING||r===ge.TYPE_ARRAY_NUMBER||r===ge.TYPE_ARRAY){if(r===ge.TYPE_ARRAY)return e===ge.TYPE_ARRAY;if(e===ge.TYPE_ARRAY){let i;r===ge.TYPE_ARRAY_NUMBER?i=ge.TYPE_NUMBER:r===ge.TYPE_ARRAY_STRING&&(i=ge.TYPE_STRING);for(let s=0;s<n.length;s+=1){const o=this.getTypeName(n[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,n[s]))return!1}return!0}}else return e===r;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ge.TYPE_STRING;case"[object Number]":return ge.TYPE_NUMBER;case"[object Array]":return ge.TYPE_ARRAY;case"[object Boolean]":return ge.TYPE_BOOLEAN;case"[object Null]":return ge.TYPE_NULL;case"[object Object]":return e.jmespathType===oe.TOK_EXPREF?ge.TYPE_EXPREF:ge.TYPE_OBJECT;default:return}}createKeyFunction(e,r){if(!this._interpreter)return;const n=this._interpreter;return s=>{const o=n.visit(e,s);if(!r.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${r.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class c5{constructor(){this._rootValue=null,this.runtime=new a5(this)}search(e,r){return this._rootValue=r,this.visit(e,r)}visit(e,r){let n,i,s,o,a,c,l,u,h,d,f;switch(e.type){case"Field":return r===null?null:Io(r)?(c=r[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],r),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],r),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(r))return null;let m=e.value;return m<0&&(m=r.length+m),s=r[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(r))return null;const p=[...e.children],g=this.computeSliceParams(r.length,p),[y,b,A]=g;if(s=[],A>0)for(d=y;d<b;d+=A)s.push(r[d]);else for(d=y;d>b;d+=A)s.push(r[d]);return s;case"Projection":if(f=this.visit(e.children[0],r),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(e.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(e.children[0],r),!Io(f))return null;h=[];const S=Object.values(f);for(d=0;d<S.length;d+=1)i=this.visit(e.children[1],S[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(e.children[0],r),!Array.isArray(f))return null;const x=[],B=[];for(d=0;d<f.length;d+=1)n=this.visit(e.children[2],f[d]),fu(n)||x.push(f[d]);for(let R=0;R<x.length;R+=1)i=this.visit(e.children[1],x[R]),i!==null&&B.push(i);return B;case"Comparator":switch(o=this.visit(e.children[0],r),a=this.visit(e.children[1],r),e.name){case oe.TOK_EQ:s=uu(o,a);break;case oe.TOK_NE:s=!uu(o,a);break;case oe.TOK_GT:s=o>a;break;case oe.TOK_GTE:s=o>=a;break;case oe.TOK_LT:s=o<a;break;case oe.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case oe.TOK_FLATTEN:const I=this.visit(e.children[0],r);if(!Array.isArray(I))return null;let U=[];for(d=0;d<I.length;d+=1)i=I[d],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return r;case"MultiSelectList":if(r===null)return null;for(h=[],d=0;d<e.children.length;d+=1)h.push(this.visit(e.children[d],r));return h;case"MultiSelectHash":if(r===null)return null;h={};let $;for(d=0;d<e.children.length;d+=1)$=e.children[d],h[$.name]=this.visit($.value,r);return h;case"OrExpression":return n=this.visit(e.children[0],r),fu(n)&&(n=this.visit(e.children[1],r)),n;case"AndExpression":return o=this.visit(e.children[0],r),fu(o)?o:this.visit(e.children[1],r);case"NotExpression":return o=this.visit(e.children[0],r),fu(o);case"Literal":return e.value;case oe.TOK_PIPE:return l=this.visit(e.children[0],r),this.visit(e.children[1],l);case oe.TOK_CURRENT:return r;case oe.TOK_ROOT:return this._rootValue;case"Function":const j=[];for(let R=0;R<e.children.length;R+=1)j.push(this.visit(e.children[R],r));return this.runtime.callFunction(e.name,j);case"ExpressionReference":const q=e.children[0];return q.jmespathType=oe.TOK_EXPREF,q;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,r){let[n,i,s]=r;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return n=n===null?o?e-1:0:this.capSliceRange(e,n,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[n,i,s]}capSliceRange(e,r,n){let i=r;return i<0?(i+=e,i<0&&(i=n<0?-1:0)):i>=e&&(i=n<0?e-1:e),i}}const l5=new c5;ge.TYPE_ANY,ge.TYPE_ARRAY,ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING,ge.TYPE_BOOLEAN,ge.TYPE_EXPREF,ge.TYPE_NULL,ge.TYPE_NUMBER,ge.TYPE_OBJECT,ge.TYPE_STRING;function u5(t,e){const r=o5.parse(e);return l5.search(r,t)}const f5=(t,e)=>{const r=Oo(t.id());if(!v(r))return 0;const[n,i]=fe(e,0,[Z.NAME,Z.NAME]),s=u5(r.json,n);return t.set(i,s),0},h5=(t,e)=>{const r=Oo(t.id());if(!v(r))return 0;const[n,i]=fe(e,0,[Z.NAME]);switch($e(n)){case"seek":{const[o]=fe(e,i,[Z.NUMBER]);r.cursor=$t(o,0,r.lines.length-1);break}case"line":r.cursor=$t(r.cursor+1,0,r.lines.length-1);break;default:{const o=r.lines[r.cursor]??"",c=new RegExp(n,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[h,d]=fe(e,u,[Z.NAME]);t.set(h,c[l]??0),++l,u=d}break}}return 0};function lk(t){const e=dt(Ze.MAIN),r=Ao(e);v(t.targetdir)?Uo(t.targetdir.destpt,t.label,void 0,r):v(t.targetname)&&Uo(t.targetname,t.label,void 0,r)}const d5=yi({get(t,e){const r=ik(t.id());if(e==="format")return[!0,r];switch(r){case"text":{const s=Oo(t.id());switch(e){case"filename":return[!0,s.filename];case"cursor":return[!0,s.cursor];case"lines":return[!0,s.lines.length]}break}case"json":{const s=Oo(t.id());switch(e){case"filename":return[!0,s.filename]}break}case"binary":{const s=Oo(t.id());switch(e){case"filename":return[!0,s.filename];case"cursor":return[!0,s.cursor];case"bytes":return[!0,s.bytes.length]}break}}const n=wr(),i=qr(n)[e];return[v(i),i]},set(t,e,r){const n=ik(t.id());if(e==="format")return[!1,void 0];switch(n){case"text":switch(e){case"filename":case"cursor":case"lines":return[!1,void 0]}break;case"json":switch(e){case"filename":return[!1,void 0]}break;case"binary":switch(e){case"filename":case"cursor":case"bytes":return[!1,void 0]}break}const i=wr(),s=qr(i);return v(s)?(s[e]=r,[!0,r]):[!1,void 0]}}).command("shortsend",(t,e)=>{const r=Oi(e);return lk(r),0}).command("send",(t,e)=>{const r=Oi(e,!0);return lk(r),0}).command("stat",()=>0).command("text",(t,e)=>{const r=e.map(Ut).join(" ");return Pt(le,k.elementfocus,"$175",r),0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Ut(r),s=Oi(n);return v(s.targetname)&&Pt(le,k.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",h5).command("readjson",f5).command("readbin",J4).command("withboard",(t,e)=>{const[r]=fe(e,0,[Z.STRING]),n=fr(r);return v(n)&&(k.board=n,k.element={x:-1,y:-1}),0});function uk(t,e,r,n,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=fe(i,a,[Z.ANY]);ut(c)&&!en(c)&&!Ka(c)&&!cu(c)&&!Tr(c)?o.push(...c):o.push(c),a=l}switch($e(n)){case"get":case"post:json":XT(le,k.elementfocus,t,e,r,n,o);break}return 0}const p5=yi().command("fetch",(t,e)=>{const[r,n,i="get",s]=fe(e,0,[Z.NAME,Z.NAME,Z.MAYBE_STRING]);return uk(void 0,r,n,i,e,s),0}).command("fetchwith",(t,e)=>{const[r,n,i,s="get",o]=fe(e,0,[Z.ANY,Z.NAME,Z.NAME,Z.MAYBE_STRING]);return uk(r,n,i,s,e,o),0}).command("chat",(t,e)=>{const[r]=fe(e,0,[Z.MAYBE_NAME]);return r?YT(le,k.elementfocus,r):VT(le,k.elementfocus),0}).command("broadcast",(t,e)=>{const[r]=fe(e,0,[Z.MAYBE_NAME]);return r?KT(le,k.elementfocus,r):qT(le,k.elementfocus),0});function qa(t,e,r){if(v(k.board)){switch(r){case"shot":case"bombed":He(e,"breakable")&&dr(k.board,e,k.timestamp);break}v(e?.id)&&t.send(k.elementfocus,e.id,r)}}function fk(t,e){if(v(e.targetname)){const r=Object.keys(k.board?.objects??{});switch(e.targetname){case"all":for(let n=0;n<r.length;++n){const i=r[n],s=hr(k.board,i);v(s)&&qa(t,s,e.label)}break;case"others":for(let n=0;n<r.length;++n){const i=r[n],s=hr(k.board,i);i!==t.id()&&v(s)&&qa(t,s,e.label)}break;case"self":k.elementid!==t.id()?t.send(k.elementfocus,k.elementid,e.label):t.message({session:le.session(),player:k.elementfocus,id:Ft(),sender:k.elementid,target:e.label});break;default:{const n=lA(k.board,[e.targetname]);for(let i=0;i<n.length;++i){const s=n[i];v(s)&&qa(t,s,e.label)}break}}}else if(v(e.targetdir))if(e.targetdir.targets.length)for(let r=0;r<e.targetdir.targets.length;++r){const n=it(k.board,e.targetdir.targets[r]);v(n)&&qa(t,n,e.label)}else{const r=it(k.board,e.targetdir.destpt);v(r)&&qa(t,r,e.label)}}const m5=yi({set(t,e,r){return Az(t,e,r),[!1,void 0]},aftertick(){const t=tr(k.elementid),[e]=t;if(t.length===1&&be(e)){if(v(k.element))if(e.trim().length===0){const r=Rt(k.elementid);r.sidebar=[]}else k.element.tickertext=e,k.element.tickertime=k.timestamp}else if(t.length>1)if(k.elementisplayer){const r=Rt(k.elementid);r.sidebar=bA(t)}else{const r=Rt(k.elementfocus);r.scrollname=k.element?.name??k.element?.kinddata?.name??"",r.scroll=bA(t)}}}).command("shortsend",(t,e)=>{const r=Oi(e);return fk(t,r),0}).command("send",(t,e)=>{const r=Oi(e,!0);return fk(t,r),0}).command("stat",()=>0).command("text",(t,e)=>{const r=e.map(Ut).join("");return Pe(k.elementid,r),0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Ut(r),s=Oi(n);return v(s.targetname)&&De(k.elementid,t.id(),i,`${s.targetname}:${s.label}`.split(" "),t.get,t.set),0});function g5(t,e,r,n,i){if(!v(k.book))return;const s=k.book,o=Ir(s,Re.BOARD,t),a=At(o);if(!v(a))return;const c=Ru(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";cr(a),cr(c);const h=-Math.tan(e*.5),d=Math.sin(e),f=Math.round(12.5*h),m=Math.round(12.5*d),p=new Array(et).fill(0);gy(f,0,-f,et-1).forEach(S=>{S.x<0?p[S.y]=Math.min(p[S.y],S.x):p[S.y]=Math.max(p[S.y],S.x)});const y=new Array(Ce).fill(0);gy(0,m,Ce-1,-m).forEach(S=>{S.y<0?y[S.x]=Math.min(y[S.x],S.y):y[S.x]=Math.max(y[S.x],S.y)});const A=[p,y,p];for(let S=0;S<A.length;++S){const x=A[S];if(S!==1){for(let B=0;B<et;++B){const I=x[B],U=B*Ce;for(let $=0;$<Ce;$++){const j=($+I+Ce)%Ce;u&&(c.terrain[j+U]=a.terrain[$+U])}}if(l){const B=Object.keys(a.objects);for(let I=0;I<B.length;++I){const U=B[I],{x:$,y:j}=a.objects[U];if(v($)&&v(j)){const q=x[j];a.objects[U].x=($+q+Ce)%Ce,a.objects[U].lx=a.objects[U].x}}}}if(S===1){for(let B=0;B<Ce;++B){const I=x[B];for(let U=0;U<et;++U){const $=(U+I+et)%et;u&&(c.terrain[B+$*Ce]=a.terrain[B+U*Ce])}}if(l){const B=Object.keys(a.objects);for(let I=0;I<B.length;++I){const U=B[I],{x:$,y:j}=a.objects[U];if(v($)&&v(j)){const q=x[$];a.objects[U].y=(j+q+et)%et,a.objects[U].ly=a.objects[U].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,cr(c),cr(a)}}var lp,hk;function y5(){if(hk)return lp;hk=1;function t(e,r){let n=0,i=0,s=0;for(;s<e.length;s++)n+=e[s];for(s=0,r*=n;r&&s<e.length;){if(i+=e[s],r<=i)return s;s++}return 0}return lp=t,lp}var up,dk;function pk(){if(dk)return up;dk=1;const t=y5(),e=function(){};return e.prototype.FMX=0,e.prototype.FMY=0,e.prototype.FMXxFMY=0,e.prototype.T=0,e.prototype.N=0,e.prototype.initiliazedField=!1,e.prototype.generationComplete=!1,e.prototype.wave=null,e.prototype.compatible=null,e.prototype.weightLogWeights=null,e.prototype.sumOfWeights=0,e.prototype.sumOfWeightLogWeights=0,e.prototype.startingEntropy=0,e.prototype.sumsOfOnes=null,e.prototype.sumsOfWeights=null,e.prototype.sumsOfWeightLogWeights=null,e.prototype.entropies=null,e.prototype.propagator=null,e.prototype.observed=null,e.prototype.distribution=null,e.prototype.stack=null,e.prototype.stackSize=0,e.prototype.DX=[-1,0,1,0],e.prototype.DY=[0,1,0,-1],e.prototype.opposite=[2,3,0,1],e.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let r=0;r<this.FMXxFMY;r++){this.wave[r]=new Array(this.T),this.compatible[r]=new Array(this.T);for(let n=0;n<this.T;n++)this.compatible[r][n]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let r=0;r<this.T;r++)this.weightLogWeights[r]=this.weights[r]*Math.log(this.weights[r]),this.sumOfWeights+=this.weights[r],this.sumOfWeightLogWeights+=this.weightLogWeights[r];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},e.prototype.observe=function(r){let n=1e3,i=-1;for(let a=0;a<this.FMXxFMY;a++){if(this.onBoundary(a%this.FMX,a/this.FMX|0))continue;const c=this.sumsOfOnes[a];if(c===0)return!1;const l=this.entropies[a];if(c>1&&l<=n){const u=1e-6*r();l+u<n&&(n=l+u,i=a)}}if(i===-1){this.observed=new Array(this.FMXxFMY);for(let a=0;a<this.FMXxFMY;a++)for(let c=0;c<this.T;c++)if(this.wave[a][c]){this.observed[a]=c;break}return!0}for(let a=0;a<this.T;a++)this.distribution[a]=this.wave[i][a]?this.weights[a]:0;const s=t(this.distribution,r()),o=this.wave[i];for(let a=0;a<this.T;a++)o[a]!==(a===s)&&this.ban(i,a);return null},e.prototype.propagate=function(){for(;this.stackSize>0;){const r=this.stack[this.stackSize-1];this.stackSize--;const n=r[0],i=n%this.FMX,s=n/this.FMX|0;for(let o=0;o<4;o++){const a=this.DX[o],c=this.DY[o];let l=i+a,u=s+c;if(this.onBoundary(l,u))continue;l<0?l+=this.FMX:l>=this.FMX&&(l-=this.FMX),u<0?u+=this.FMY:u>=this.FMY&&(u-=this.FMY);const h=l+u*this.FMX,d=this.propagator[o][r[1]],f=this.compatible[h];for(let m=0;m<d.length;m++){const p=d[m],g=f[p];g[o]--,g[o]==0&&this.ban(h,p)}}}},e.prototype.singleIteration=function(r){const n=this.observe(r);return n!==null?(this.generationComplete=n,!!n):(this.propagate(),null)},e.prototype.iterate=function(r,n){this.wave||this.initialize(),this.initiliazedField||this.clear(),r=r||0,n=n||Math.random;for(let i=0;i<r||r===0;i++){const s=this.singleIteration(n);if(s!==null)return!!s}return!0},e.prototype.generate=function(r){for(r=r||Math.random,this.wave||this.initialize(),this.clear();;){const n=this.singleIteration(r);if(n!==null)return!!n}},e.prototype.isGenerationComplete=function(){return this.generationComplete},e.prototype.ban=function(r,n){const i=this.compatible[r][n];for(let o=0;o<4;o++)i[o]=0;this.wave[r][n]=!1,this.stack[this.stackSize]=[r,n],this.stackSize++,this.sumsOfOnes[r]-=1,this.sumsOfWeights[r]-=this.weights[n],this.sumsOfWeightLogWeights[r]-=this.weightLogWeights[n];const s=this.sumsOfWeights[r];this.entropies[r]=Math.log(s)-this.sumsOfWeightLogWeights[r]/s},e.prototype.clear=function(){for(let r=0;r<this.FMXxFMY;r++){for(let n=0;n<this.T;n++){this.wave[r][n]=!0;for(let i=0;i<4;i++)this.compatible[r][n][i]=this.propagator[this.opposite[i]][n].length}this.sumsOfOnes[r]=this.weights.length,this.sumsOfWeights[r]=this.sumOfWeights,this.sumsOfWeightLogWeights[r]=this.sumOfWeightLogWeights,this.entropies[r]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1},up=e,up}var fp,mk;function _5(){if(mk)return fp;mk=1;const t=pk(),e=function(n,i,s,o,a,c,l,u,h,d){d=d||0,this.N=o,this.FMX=a,this.FMY=c,this.FMXxFMY=a*c,this.periodic=u;const f=i,m=new Array(f);for(let q=0;q<f;q++)m[q]=new Array(s);this.colors=[];const p={};for(let q=0;q<s;q++)for(let R=0;R<i;R++){const O=(q*i+R)*4,w=[n[O],n[O+1],n[O+2],n[O+3]],C=w.join("-");p.hasOwnProperty(C)||(p[C]=this.colors.length,this.colors.push(w)),m[R][q]=p[C]}const g=this.colors.length,y=Math.pow(g,o*o),b=function(R){let O=new Array(o*o);for(let w=0;w<o;w++)for(let C=0;C<o;C++)O[C+w*o]=R(C,w);return O},A=function(R,O){return b(function(w,C){return m[(R+w)%i][(O+C)%s]})},S=function(R){return b(function(O,w){return R[o-1-w+O*o]})},x=function(R){return b(function(O,w){return R[o-1-O+w*o]})},B=function(R){let O=0,w=1;for(let C=0;C<R.length;C++)O+=R[R.length-1-C]*w,w*=g;return O},I=function(R){let O=R,w=y;const C=new Array(o*o);for(let W=0;W<C.length;W++){w/=g;let P=0;for(;O>=w;)O-=w,P++;C[W]=P}return C},U={},$=[];for(let q=0;q<(l?s:s-o+1);q++)for(let R=0;R<(l?i:i-o+1);R++){const O=new Array(8);O[0]=A(R,q),O[1]=x(O[0]),O[2]=S(O[0]),O[3]=x(O[2]),O[4]=S(O[2]),O[5]=x(O[4]),O[6]=S(O[4]),O[7]=x(O[6]);for(let w=0;w<h;w++){const C=B(O[w]);U[C]?U[C]++:($.push(C),U[C]=1)}}this.T=$.length,this.ground=(d+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let q=0;q<this.T;q++){const R=parseInt($[q],10);this.patterns[q]=I(R),this.weights[q]=U[R]}const j=function(R,O,w,C){const W=w<0?0:w,P=w<0?w+o:o,V=C<0?0:C,J=C<0?C+o:o;for(let N=V;N<J;N++)for(let L=W;L<P;L++)if(R[L+o*N]!=O[L-w+o*(N-C)])return!1;return!0};this.propagator=new Array(4);for(let q=0;q<4;q++){this.propagator[q]=new Array(this.T);for(let R=0;R<this.T;R++){const O=[];for(let w=0;w<this.T;w++)j(this.patterns[R],this.patterns[w],this.DX[q],this.DY[q])&&O.push(w);this.propagator[q][R]=O}}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(r,n){return!this.periodic&&(r+this.N>this.FMX||n+this.N>this.FMY||r<0||n<0)},e.prototype.clear=function(){if(t.prototype.clear.call(this),this.ground!==0){for(let r=0;r<this.FMX;r++){for(let n=0;n<this.T;n++)n!==this.ground&&this.ban(r+(this.FMY-1)*this.FMX,n);for(let n=0;n<this.FMY-1;n++)this.ban(r+n*this.FMX,this.ground)}this.propagate()}},e.prototype.graphics=function(r){return r=r||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(r):this.graphicsIncomplete(r),r},e.prototype.graphicsComplete=function(r){for(let n=0;n<this.FMY;n++){const i=n<this.FMY-this.N+1?0:this.N-1;for(let s=0;s<this.FMX;s++){const o=s<this.FMX-this.N+1?0:this.N-1,a=(n*this.FMX+s)*4,c=this.colors[this.patterns[this.observed[s-o+(n-i)*this.FMX]][o+i*this.N]];r[a]=c[0],r[a+1]=c[1],r[a+2]=c[2],r[a+3]=c[3]}}},e.prototype.graphicsIncomplete=function(r){for(let n=0;n<this.FMXxFMY;n++){const i=n%this.FMX,s=n/this.FMX|0;let o=0,a=0,c=0,l=0,u=0;for(let d=0;d<this.N;d++)for(let f=0;f<this.N;f++){let m=i-f;m<0&&(m+=this.FMX);let p=s-d;if(p<0&&(p+=this.FMY),this.onBoundary(m,p))continue;const g=m+p*this.FMX;for(let y=0;y<this.T;y++)if(this.wave[g][y]){o++;const b=this.colors[this.patterns[y][f+d*this.N]];a+=b[0],c+=b[1],l+=b[2],u+=b[3]}}const h=n*4;r[h]=a/o,r[h+1]=c/o,r[h+2]=l/o,r[h+3]=u/o}},fp=e,fp}var hp,gk;function b5(){if(gk)return hp;gk=1;const t=pk(),e=function(n,i,s,o,a){const c=n.tilesize||16;this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=a,this.tilesize=c;const l=!!n.unique;let u=null;i&&n.subsets&&n.subsets[i]&&(u=n.subsets[i]);const h=function(B){const I=new Array(c*c);for(let U=0;U<c;U++)for(let $=0;$<c;$++)I[$+U*c]=B($,U);return I},d=function(B){return h(function(I,U){return B[c-1-U+I*c]})},f=function(B){return h(function(I,U){return B[c-1-I+U*c]})};this.tiles=[];const m=[],p=[],g={};let y,b,A;for(let x=0;x<n.tiles.length;x++){const B=n.tiles[x];if(u!==null&&u.indexOf(B.name)===-1)continue;switch(B.symmetry){case"L":A=4,y=function(U){return(U+1)%4},b=function(U){return U%2===0?U+1:U-1};break;case"T":A=4,y=function(U){return(U+1)%4},b=function(U){return U%2===0?U:4-U};break;case"I":A=2,y=function(U){return 1-U},b=function(U){return U};break;case"\\":A=2,y=function(U){return 1-U},b=function(U){return 1-U};break;case"F":A=8,y=function(U){return U<4?(U+1)%4:4+(U-1)%4},b=function(U){return U<4?U+4:U-4};break;default:A=1,y=function(U){return U},b=function(U){return U};break}this.T=p.length,g[B.name]=this.T;for(let U=0;U<A;U++)p.push([this.T+U,this.T+y(U),this.T+y(y(U)),this.T+y(y(y(U))),this.T+b(U),this.T+b(y(U)),this.T+b(y(y(U))),this.T+b(y(y(y(U))))]);let I;if(l)for(let U=0;U<A;U++)I=B.bitmap[U],this.tiles.push(h(function($,j){return[I[(c*j+$)*4],I[(c*j+$)*4+1],I[(c*j+$)*4+2],I[(c*j+$)*4+3]]}));else{I=B.bitmap,this.tiles.push(h(function(U,$){return[I[(c*$+U)*4],I[(c*$+U)*4+1],I[(c*$+U)*4+2],I[(c*$+U)*4+3]]}));for(let U=1;U<A;U++)this.tiles.push(U<4?d(this.tiles[this.T+U-1]):f(this.tiles[this.T+U-4]))}for(let U=0;U<A;U++)m.push(B.weight||1)}this.T=p.length,this.weights=m,this.propagator=new Array(4);const S=new Array(4);for(let x=0;x<4;x++){this.propagator[x]=new Array(this.T),S[x]=new Array(this.T);for(let B=0;B<this.T;B++){S[x][B]=new Array(this.T);for(let I=0;I<this.T;I++)S[x][B][I]=!1}}for(let x=0;x<n.neighbors.length;x++){const B=n.neighbors[x],I=B.left.split(" ").filter(function(O){return O.length}),U=B.right.split(" ").filter(function(O){return O.length});if(u!==null&&(u.indexOf(I[0])===-1||u.indexOf(U[0])===-1))continue;const $=p[g[I[0]]][I.length==1?0:parseInt(I[1],10)],j=p[$][1],q=p[g[U[0]]][U.length==1?0:parseInt(U[1],10)],R=p[q][1];S[0][q][$]=!0,S[0][p[q][6]][p[$][6]]=!0,S[0][p[$][4]][p[q][4]]=!0,S[0][p[$][2]][p[q][2]]=!0,S[1][R][j]=!0,S[1][p[j][6]][p[R][6]]=!0,S[1][p[R][4]][p[j][4]]=!0,S[1][p[j][2]][p[R][2]]=!0}for(let x=0;x<this.T;x++)for(let B=0;B<this.T;B++)S[2][x][B]=S[0][B][x],S[3][x][B]=S[1][B][x];for(let x=0;x<4;x++)for(let B=0;B<this.T;B++){const I=[],U=S[x][B];for(let $=0;$<this.T;$++)U[$]&&I.push($);this.propagator[x][B]=I}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(r,n){return!this.periodic&&(r<0||n<0||r>=this.FMX||n>=this.FMY)},e.prototype.graphics=function(r,n){return r=r||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(r):this.graphicsIncomplete(r,n),r},e.prototype.graphicsComplete=function(r){for(let n=0;n<this.FMX;n++)for(let i=0;i<this.FMY;i++){const s=this.tiles[this.observed[n+i*this.FMX]];for(let o=0;o<this.tilesize;o++)for(let a=0;a<this.tilesize;a++){const c=(n*this.tilesize+a+(i*this.tilesize+o)*this.FMX*this.tilesize)*4,l=s[a+o*this.tilesize];r[c]=l[0],r[c+1]=l[1],r[c+2]=l[2],r[c+3]=l[3]}}},e.prototype.graphicsIncomplete=function(r,n){(!n||n.length!==4)&&(n=!1);for(let i=0;i<this.FMX;i++)for(let s=0;s<this.FMY;s++){const o=this.wave[i+s*this.FMX];let a=0,c=0;for(let u=0;u<this.T;u++)o[u]&&(a++,c+=this.weights[u]);const l=1/c;for(let u=0;u<this.tilesize;u++)for(let h=0;h<this.tilesize;h++){const d=(i*this.tilesize+h+(s*this.tilesize+u)*this.FMX*this.tilesize)*4;if(n&&a===this.T)r[d]=n[0],r[d+1]=n[1],r[d+2]=n[2],r[d+3]=n[3];else{let f=0,m=0,p=0,g=0;for(let y=0;y<this.T;y++)if(o[y]){const b=this.tiles[y][h+u*this.tilesize],A=this.weights[y]*l;f+=b[0]*A,m+=b[1]*A,p+=b[2]*A,g+=b[3]*A}r[d]=f,r[d+1]=m,r[d+2]=p,r[d+3]=g}}}},hp=e,hp}var dp,yk;function w5(){return yk||(yk=1,dp={OverlappingModel:_5(),SimpleTiledModel:b5()}),dp}var v5=w5(),E5=js(v5);const _k=5;function bk(t,e,r,n,i,s,o){if(!v(k.book))return!1;const a=k.book,c=Ir(a,Re.BOARD,t),l=Ir(a,Re.BOARD,e),u=At(c),h=At(l);if(!v(u)||!v(h))return!1;cr(u),cr(h);let d=0;const f=new Map,m=new Map;let p=0;const g=32,y=new Uint8Array(ph*4);for(let I=0;I<et;++I)for(let U=0;U<Ce;++U){const $=it(h,{x:U,y:I}),j=$?.char??0,q=$?.color??g,R=$?.bg??g;y[p++]=j,y[p++]=q,y[p++]=R;const O=vn($),w=$e(O?.name??"empty"),C=f.get(w);Te(C)?y[p++]=C:(f.set(w,d),m.set(d,w),y[p++]=d++)}const b=s.x-i.x+1,A=s.y-i.y+1,S=new E5.OverlappingModel(y,Ce,et,r,b,A,!1,!1,n,0);let x=0;for(;x<_k&&!S.generate();++x);if(x===_k)return!1;p=0;const B=S.graphics();for(let I=i.y;I<=s.y;++I)for(let U=i.x;U<=s.x;++U){const $={x:U,y:I},j=B[p++],q=B[p++],R=B[p++];switch(d=B[p++],o){case"all":{const W=it(u,{x:U,y:I});jt(W)&&dr(u,W,a.timestamp),St(u,{x:U,y:I});break}case"object":{const W=it(u,{x:U,y:I});jt(W)&&dr(u,W,a.timestamp);break}case"terrain":St(u,{x:U,y:I});break}let O=m.get(d)??"";const w=vn({kind:O});switch(o){case"all":break;case"object":jt(w)||(O="");break;case"terrain":jt(w)&&(O="");break;default:if(He(w,"group")!==o&&(O=""),O){const W=it(u,{x:U,y:I});jt(W)&&dr(u,W,a.timestamp),St(u,{x:U,y:I})}break}const C=O?on(u,[O],$):void 0;if(!(!v(C)||!v(w))&&(Os(C,w),j>0&&(C.char=j),q<g&&(C.color=q),R<g&&(C.bg=R),jt(C))){const W=hn(tc(h,O));v(W)&&(St(u,{...Zi(h,W.x??0,W.y??0),x:U,y:I}),Os(C,W))}}return!0}function wk(t){return`zss_snapshot_${t}`}const vk={x:0,y:0},Ek={x:Ce-1,y:et-1},kk="all";function k5(t){const e=Ir(k.book,Re.BOARD,t),r=At(e);if(!v(r))return;const n=wk(r.id);EE(k.book,n);const[i]=Xi(Ze.MAIN,n,Re.BOARD),s=At(i);if(v(s))return ru(t,s.id,vk,Ek,kk),s}function x5(t){const e=Ir(k.book,Re.BOARD,t),r=At(e);if(!v(r))return;const n=wk(r.id),i=Ir(k.book,Re.BOARD,n),s=At(i);if(v(s))return ru(s.id,t,vk,Ek,kk),s}function A5(t,e,r,n,i,s){switch(s){case"all":case"object":case"terrain":break;default:return T5(t,e,i,s)}if(!v(k.book))return;const o=k.book,a=Ir(o,Re.BOARD,t),c=At(a);if(!v(c))return;const l=Ru();cr(c);for(let u=r.y;u<=n.y;++u)for(let h=r.x;h<=n.x;++h){let d=!1,f=!1;switch(s){case"all":d=!0,f=!0;break;case"object":d=!0;break;case"terrain":f=!0;break}const m=(h+e.x+Ce)%Ce,p=(u+e.y+et)%et;if(d){const g=it(c,{x:h,y:u});jt(g)&&v(g?.x)&&v(g?.y)&&(g.x=m,g.lx=m,g.y=p,g.ly=p)}f&&(l.terrain[m+p*Ce]=c.terrain[h+u*Ce])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),Wa(c)}function T5(t,e,r,n){if(!v(k.book))return;const i=k.book,s=Ir(i,Re.BOARD,t),o=At(s);if(!v(o))return;cr(o);const{terrainelements:a,objectelements:c}=SE(o,r,n);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>Pr({x:p.x??0,y:p.y??0},Ce)),h=[],d=[];for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b=it(o,y);v(b)&&jt(b)&&(h.push(b.id??""),h.push(b.id??""),d.push(Pr({x:b.x??0,y:b.y??0},Ce)))}let f=!1;for(let p=0;p<a.length;++p){const g=a[p],y=He(g,"collision"),b={x:g.x??-1,y:g.y??-1},A=Pr(b,Ce),S={x:b.x+e.x,y:b.y+e.y};if(Fo(S)){const x=it(o,S),B=x?.id??"",I=Pr({x:x?.x??0,y:x?.y??0},Ce),U=He(x,"collision");if(v(x)&&jt(x)&&h.includes(B)!==!0&&l.includes(B)!==!0){let $=!1;const j=d.includes(A),q=j?it(o,b):void 0,R=j?He(q,"pushable"):!1,O=j&&R;if(A0(g,x)&&(y!==We.ISWALK||j)){let w=j;v(q)&&R&&(f=$n(i,o,q,{x:(q.x??0)-e.x,y:(q.y??0)-e.y})!==!0,f||(w=!1)),(w||y!==We.ISWALK)&&(f=$n(i,o,x,{x:(x.x??0)+e.x,y:(x.y??0)+e.y})!==!0,f&&($=O))}else(y!==We.ISWALK||O)&&(f=!0,$=O);$&&v(q)&&(f=$n(i,o,q,{x:(q.x??0)-e.x,y:(q.y??0)-e.y})!==!0)}else U===We.ISSOLID&&u.includes(I)===!1&&(f=!0)}else f=!0}if(f)return;for(let p=0;p<c.length;++p){const g=c[p],y=He(g,"collision"),b={x:g.x??0,y:g.y??0},A={x:b.x+e.x,y:b.y+e.y};if(Fo(A)){const S=it(o,A),x=S?.id??"",B=He(S,"collision"),I=He(S,"group");v(S)&&jt(S)&&h.includes(x)&&l.includes(x)!==!0?A0(g,S)?f=$n(i,o,S,A)!==!0:f=!0:Qa(y,B)&&n!==I&&(f=!0)}else f=!0}if(f)return;(e.x>0||e.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+e.x,y:y.y+e.y},A=Zi(o,b.x,b.y);if(v(g)&&v(A)){St(o,{...g,x:b.x,y:b.y}),St(o,{...A,x:y.x,y:y.y});const S=it(o,y);jt(S)&&v(S)&&(S.x=(S.x??0)+e.x,S.y=(S.y??0)+e.y,S.lx=(S.lx??0)+e.x,S.ly=(S.ly??0)+e.y)}}Wa(o);for(let p=0;p<c.length;++p){const g=c[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+e.x,y:y.y+e.y};if(!$n(i,o,g,b))break}Wa(o)}function hu(t,e){let r="all";const n={x:0,y:0},i={x:Ce-1,y:et-1};for(let s=e;s<t.length;){const[o,a]=fe(t,s,[Z.MAYBE_NUMBER_OR_STRING]);if(be(o))r=$e(o),s=a;else if(Te(o)){const[c,l,u,h]=fe(t,a,[Z.NUMBER,Z.MAYBE_NUMBER,Z.MAYBE_NUMBER]);n.x=Math.min(o,l??o),n.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=h}else break}return{targetset:r,pt1:n,pt2:i}}const S5=yi().command("snapshot",()=>(!v(k.book)||!v(k.board)||k5(k.board.id),0)).command("revert",()=>(!v(k.book)||!v(k.board)||x5(k.board.id),0)).command("copy",(t,e)=>{if(!v(k.book)||!v(k.board))return 0;const[r,n]=fe(e,0,[Z.STRING]),i=bookreadcodepagesbytypeandstat(k.book,Re.BOARD,r),s=hn(...i);if(v(s)){const o=hu(e,n);ru(s.id,k.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!v(k.book)||!v(k.board))return 0;const[r,n,i,s]=fe(e,0,[Z.STRING,Z.NUMBER,Z.NUMBER]),o=bookreadcodepagesbytypeandstat(k.book,Re.BOARD,r),a=hn(...o);if(v(a)){const c=hu(e,s);bk(k.board.id,a.id,n,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{if(!v(k.book)||!v(k.board))return 0;const[r,n]=fe(e,0,[Z.DIR]),i={x:r.destpt.x-(k.element?.x??0),y:r.destpt.y-(k.element?.y??0)},s=hu(e,n);return A5(k.board.id,i,s.pt1,s.pt2,k.elementid,s.targetset),0}).command("pivot",(t,e)=>{if(!v(k.book)||!v(k.board))return 0;const[r,n]=fe(e,0,[Z.NUMBER]),i=hu(e,n);return g5(k.board.id,ky(r),i.pt1,i.pt2,i.targetset),0});var Yi=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(Yi||{});const R5={audio:Jc,board:MF,cli:j4,display:z4,element:X4,runtime:m5,loader:d5,network:p5,transform:S5},pp=["audio","board","display","network","transform","element"],O5={0:[],1:["cli",...pp],2:["loader",...pp],3:["runtime",...pp]},I5={0:new Map,1:new Map,2:new Map,3:new Map};function No(t){return(O5[t]??[]).map(r=>R5[r]).filter(v)}function mp(t){const e=[],r=No(t);for(let n=0;n<r.length;++n)e.push(...r[n].listcommands());return e}function N5(t,e){const r=I5[t];if(!r.has(e)){let n;const i=No(t);for(let s=0;s<i.length&&(n=i[s].getcommand(e),!v(n));++s);r.set(e,n)}return r.get(e)}function C5(t,e,r){const n=No(t);for(let i=0;i<n.length;++i){const s=n[i];if(s.get!==void 0){const[o,a]=s.get(e,r);if(o)return[o,a]}}return[!1,void 0]}function L5(t,e,r,n){const i=No(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,r,n);if(a)return[a,n]}}return[!1,void 0]}function M5(t,e){const r=No(t);for(let n=0;n<r.length;++n)r[n].everytick(e)}function U5(t,e){const r=No(t);for(let n=0;n<r.length;++n)r[n].aftertick(e)}var Ya={},gp={},yp={},_p={},xk;function F5(){if(xk)return _p;xk=1;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return _p.encode=function(e){if(0<=e&&e<t.length)return t[e];throw new TypeError("Must be between 0 and 63: "+e)},_p}var Ak;function Tk(){if(Ak)return yp;Ak=1;const t=F5(),e=5,r=1<<e,n=r-1,i=r;function s(o){return o<0?(-o<<1)+1:(o<<1)+0}return yp.encode=function(a){let c="",l,u=s(a);do l=u&n,u>>>=e,u>0&&(l|=i),c+=t.encode(l);while(u>0);return c},yp}var Pn={},Us={},Va={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var P5=Va.exports,Sk;function B5(){return Sk||(Sk=1,(function(t,e){(function(r){var n=e&&!e.nodeType&&e,i=t&&!t.nodeType&&t,s=typeof Ci=="object"&&Ci;(s.global===s||s.window===s||s.self===s)&&(r=s);var o,a=2147483647,c=36,l=1,u=26,h=38,d=700,f=72,m=128,p="-",g=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=c-l,x=Math.floor,B=String.fromCharCode,I;function U(N){throw new RangeError(A[N])}function $(N,L){for(var F=N.length,Y=[];F--;)Y[F]=L(N[F]);return Y}function j(N,L){var F=N.split("@"),Y="";F.length>1&&(Y=F[0]+"@",N=F[1]),N=N.replace(b,".");var K=N.split("."),Q=$(K,L).join(".");return Y+Q}function q(N){for(var L=[],F=0,Y=N.length,K,Q;F<Y;)K=N.charCodeAt(F++),K>=55296&&K<=56319&&F<Y?(Q=N.charCodeAt(F++),(Q&64512)==56320?L.push(((K&1023)<<10)+(Q&1023)+65536):(L.push(K),F--)):L.push(K);return L}function R(N){return $(N,function(L){var F="";return L>65535&&(L-=65536,F+=B(L>>>10&1023|55296),L=56320|L&1023),F+=B(L),F}).join("")}function O(N){return N-48<10?N-22:N-65<26?N-65:N-97<26?N-97:c}function w(N,L){return N+22+75*(N<26)-((L!=0)<<5)}function C(N,L,F){var Y=0;for(N=F?x(N/d):N>>1,N+=x(N/L);N>S*u>>1;Y+=c)N=x(N/S);return x(Y+(S+1)*N/(N+h))}function W(N){var L=[],F=N.length,Y,K=0,Q=m,he=f,xe,ve,ke,Ae,Se,Me,je,T,ue;for(xe=N.lastIndexOf(p),xe<0&&(xe=0),ve=0;ve<xe;++ve)N.charCodeAt(ve)>=128&&U("not-basic"),L.push(N.charCodeAt(ve));for(ke=xe>0?xe+1:0;ke<F;){for(Ae=K,Se=1,Me=c;ke>=F&&U("invalid-input"),je=O(N.charCodeAt(ke++)),(je>=c||je>x((a-K)/Se))&&U("overflow"),K+=je*Se,T=Me<=he?l:Me>=he+u?u:Me-he,!(je<T);Me+=c)ue=c-T,Se>x(a/ue)&&U("overflow"),Se*=ue;Y=L.length+1,he=C(K-Ae,Y,Ae==0),x(K/Y)>a-Q&&U("overflow"),Q+=x(K/Y),K%=Y,L.splice(K++,0,Q)}return R(L)}function P(N){var L,F,Y,K,Q,he,xe,ve,ke,Ae,Se,Me=[],je,T,ue,ie;for(N=q(N),je=N.length,L=m,F=0,Q=f,he=0;he<je;++he)Se=N[he],Se<128&&Me.push(B(Se));for(Y=K=Me.length,K&&Me.push(p);Y<je;){for(xe=a,he=0;he<je;++he)Se=N[he],Se>=L&&Se<xe&&(xe=Se);for(T=Y+1,xe-L>x((a-F)/T)&&U("overflow"),F+=(xe-L)*T,L=xe,he=0;he<je;++he)if(Se=N[he],Se<L&&++F>a&&U("overflow"),Se==L){for(ve=F,ke=c;Ae=ke<=Q?l:ke>=Q+u?u:ke-Q,!(ve<Ae);ke+=c)ie=ve-Ae,ue=c-Ae,Me.push(B(w(Ae+ie%ue,0))),ve=x(ie/ue);Me.push(B(w(ve,0))),Q=C(F,T,Y==K),F=0,++Y}++F,++L}return Me.join("")}function V(N){return j(N,function(L){return g.test(L)?W(L.slice(4).toLowerCase()):L})}function J(N){return j(N,function(L){return y.test(L)?"xn--"+P(L):L})}if(o={version:"1.4.1",ucs2:{decode:q,encode:R},decode:W,encode:P,toASCII:J,toUnicode:V},n&&i)if(t.exports==n)i.exports=o;else for(I in o)o.hasOwnProperty(I)&&(n[I]=o[I]);else r.punycode=o})(P5)})(Va,Va.exports)),Va.exports}var bp,Rk;function Co(){return Rk||(Rk=1,bp=TypeError),bp}var $5={},D5=Object.freeze({__proto__:null,default:$5}),j5=cT(D5),wp,Ok;function du(){if(Ok)return wp;Ok=1;var t=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=t&&e&&typeof e.get=="function"?e.get:null,n=t&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,h=u?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,f=d?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,p=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,b=String.prototype.slice,A=String.prototype.replace,S=String.prototype.toUpperCase,x=String.prototype.toLowerCase,B=RegExp.prototype.test,I=Array.prototype.concat,U=Array.prototype.join,$=Array.prototype.slice,j=Math.floor,q=typeof BigInt=="function"?BigInt.prototype.valueOf:null,R=Object.getOwnPropertySymbols,O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,w=typeof Symbol=="function"&&typeof Symbol.iterator=="object",C=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===w||!0)?Symbol.toStringTag:null,W=Object.prototype.propertyIsEnumerable,P=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(H){return H.__proto__}:null);function V(H,re){if(H===1/0||H===-1/0||H!==H||H&&H>-1e3&&H<1e3||B.call(/e/,re))return re;var ze=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof H=="number"){var Ge=H<0?-j(-H):j(H);if(Ge!==H){var Ye=String(Ge),Le=b.call(re,Ye.length+1);return A.call(Ye,ze,"$&_")+"."+A.call(A.call(Le,/([0-9]{3})/g,"$&_"),/_$/,"")}}return A.call(re,ze,"$&_")}var J=j5,N=J.custom,L=T(N)?N:null,F={__proto__:null,double:'"',single:"'"},Y={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};wp=function H(re,ze,Ge,Ye){var Le=ze||{};if(G(Le,"quoteStyle")&&!G(F,Le.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(G(Le,"maxStringLength")&&(typeof Le.maxStringLength=="number"?Le.maxStringLength<0&&Le.maxStringLength!==1/0:Le.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Vr=G(Le,"customInspect")?Le.customInspect:!0;if(typeof Vr!="boolean"&&Vr!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(G(Le,"indent")&&Le.indent!==null&&Le.indent!=="	"&&!(parseInt(Le.indent,10)===Le.indent&&Le.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(G(Le,"numericSeparator")&&typeof Le.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var kn=Le.numericSeparator;if(typeof re>"u")return"undefined";if(re===null)return"null";if(typeof re=="boolean")return re?"true":"false";if(typeof re=="string")return pt(re,Le);if(typeof re=="number"){if(re===0)return 1/0/re>0?"0":"-0";var an=String(re);return kn?V(re,an):an}if(typeof re=="bigint"){var ts=String(re)+"n";return kn?V(re,ts):ts}var K0=typeof Le.depth>"u"?5:Le.depth;if(typeof Ge>"u"&&(Ge=0),Ge>=K0&&K0>0&&typeof re=="object")return xe(re)?"[Array]":"[Object]";var Wo=D(Le,Ge);if(typeof Ye>"u")Ye=[];else if(pe(Ye,re)>=0)return"[Circular]";function Dn(Ho,zu,lW){if(zu&&(Ye=$.call(Ye),Ye.push(zu)),lW){var oT={depth:Le.depth};return G(Le,"quoteStyle")&&(oT.quoteStyle=Le.quoteStyle),H(Ho,oT,Ge+1,Ye)}return H(Ho,Le,Ge+1,Ye)}if(typeof re=="function"&&!ke(re)){var QA=ee(re),eT=ce(re,Dn);return"[Function"+(QA?": "+QA:" (anonymous)")+"]"+(eT.length>0?" { "+U.call(eT,", ")+" }":"")}if(T(re)){var tT=w?A.call(String(re),/^(Symbol\(.*\))_[^)]*$/,"$1"):O.call(re);return typeof re=="object"&&!w?Yt(tT):tT}if(Be(re)){for(var oc="<"+x.call(String(re.nodeName)),q0=re.attributes||[],ju=0;ju<q0.length;ju++)oc+=" "+q0[ju].name+"="+K(Q(q0[ju].value),"double",Le);return oc+=">",re.childNodes&&re.childNodes.length&&(oc+="..."),oc+="</"+x.call(String(re.nodeName))+">",oc}if(xe(re)){if(re.length===0)return"[]";var Y0=ce(re,Dn);return Wo&&!E(Y0)?"["+X(Y0,Wo)+"]":"[ "+U.call(Y0,", ")+" ]"}if(Ae(re)){var V0=ce(re,Dn);return!("cause"in Error.prototype)&&"cause"in re&&!W.call(re,"cause")?"{ ["+String(re)+"] "+U.call(I.call("[cause]: "+Dn(re.cause),V0),", ")+" }":V0.length===0?"["+String(re)+"]":"{ ["+String(re)+"] "+U.call(V0,", ")+" }"}if(typeof re=="object"&&Vr){if(L&&typeof re[L]=="function"&&J)return J(re,{depth:K0-Ge});if(Vr!=="symbol"&&typeof re.inspect=="function")return re.inspect()}if(me(re)){var rT=[];return n&&n.call(re,function(Ho,zu){rT.push(Dn(zu,re,!0)+" => "+Dn(Ho,re))}),_("Map",r.call(re),rT,Wo)}if(Oe(re)){var nT=[];return a&&a.call(re,function(Ho){nT.push(Dn(Ho,re))}),_("Set",o.call(re),nT,Wo)}if(se(re))return M("WeakMap");if(_e(re))return M("WeakSet");if(ye(re))return M("WeakRef");if(Me(re))return Yt(Dn(Number(re)));if(ue(re))return Yt(Dn(q.call(re)));if(je(re))return Yt(m.call(re));if(Se(re))return Yt(Dn(String(re)));if(typeof window<"u"&&re===window)return"{ [object Window] }";if(typeof globalThis<"u"&&re===globalThis||typeof Ci<"u"&&re===Ci)return"{ [object globalThis] }";if(!ve(re)&&!ke(re)){var X0=ce(re,Dn),iT=P?P(re)===Object.prototype:re instanceof Object||re.constructor===Object,Z0=re instanceof Object?"":"null prototype",sT=!iT&&C&&Object(re)===re&&C in re?b.call(z(re),8,-1):Z0?"Object":"",cW=iT||typeof re.constructor!="function"?"":re.constructor.name?re.constructor.name+" ":"",J0=cW+(sT||Z0?"["+U.call(I.call([],sT||[],Z0||[]),": ")+"] ":"");return X0.length===0?J0+"{}":Wo?J0+"{"+X(X0,Wo)+"}":J0+"{ "+U.call(X0,", ")+" }"}return String(re)};function K(H,re,ze){var Ge=ze.quoteStyle||re,Ye=F[Ge];return Ye+H+Ye}function Q(H){return A.call(String(H),/"/g,"&quot;")}function he(H){return!C||!(typeof H=="object"&&(C in H||typeof H[C]<"u"))}function xe(H){return z(H)==="[object Array]"&&he(H)}function ve(H){return z(H)==="[object Date]"&&he(H)}function ke(H){return z(H)==="[object RegExp]"&&he(H)}function Ae(H){return z(H)==="[object Error]"&&he(H)}function Se(H){return z(H)==="[object String]"&&he(H)}function Me(H){return z(H)==="[object Number]"&&he(H)}function je(H){return z(H)==="[object Boolean]"&&he(H)}function T(H){if(w)return H&&typeof H=="object"&&H instanceof Symbol;if(typeof H=="symbol")return!0;if(!H||typeof H!="object"||!O)return!1;try{return O.call(H),!0}catch{}return!1}function ue(H){if(!H||typeof H!="object"||!q)return!1;try{return q.call(H),!0}catch{}return!1}var ie=Object.prototype.hasOwnProperty||function(H){return H in this};function G(H,re){return ie.call(H,re)}function z(H){return p.call(H)}function ee(H){if(H.name)return H.name;var re=y.call(g.call(H),/^function\s*([\w$]+)/);return re?re[1]:null}function pe(H,re){if(H.indexOf)return H.indexOf(re);for(var ze=0,Ge=H.length;ze<Ge;ze++)if(H[ze]===re)return ze;return-1}function me(H){if(!r||!H||typeof H!="object")return!1;try{r.call(H);try{o.call(H)}catch{return!0}return H instanceof Map}catch{}return!1}function se(H){if(!l||!H||typeof H!="object")return!1;try{l.call(H,l);try{h.call(H,h)}catch{return!0}return H instanceof WeakMap}catch{}return!1}function ye(H){if(!f||!H||typeof H!="object")return!1;try{return f.call(H),!0}catch{}return!1}function Oe(H){if(!o||!H||typeof H!="object")return!1;try{o.call(H);try{r.call(H)}catch{return!0}return H instanceof Set}catch{}return!1}function _e(H){if(!h||!H||typeof H!="object")return!1;try{h.call(H,h);try{l.call(H,l)}catch{return!0}return H instanceof WeakSet}catch{}return!1}function Be(H){return!H||typeof H!="object"?!1:typeof HTMLElement<"u"&&H instanceof HTMLElement?!0:typeof H.nodeName=="string"&&typeof H.getAttribute=="function"}function pt(H,re){if(H.length>re.maxStringLength){var ze=H.length-re.maxStringLength,Ge="... "+ze+" more character"+(ze>1?"s":"");return pt(b.call(H,0,re.maxStringLength),re)+Ge}var Ye=Y[re.quoteStyle||"single"];Ye.lastIndex=0;var Le=A.call(A.call(H,Ye,"\\$1"),/[\x00-\x1f]/g,Je);return K(Le,"single",re)}function Je(H){var re=H.charCodeAt(0),ze={8:"b",9:"t",10:"n",12:"f",13:"r"}[re];return ze?"\\"+ze:"\\x"+(re<16?"0":"")+S.call(re.toString(16))}function Yt(H){return"Object("+H+")"}function M(H){return H+" { ? }"}function _(H,re,ze,Ge){var Ye=Ge?X(ze,Ge):U.call(ze,", ");return H+" ("+re+") {"+Ye+"}"}function E(H){for(var re=0;re<H.length;re++)if(pe(H[re],`
`)>=0)return!1;return!0}function D(H,re){var ze;if(H.indent==="	")ze="	";else if(typeof H.indent=="number"&&H.indent>0)ze=U.call(Array(H.indent+1)," ");else return null;return{base:ze,prev:U.call(Array(re+1),ze)}}function X(H,re){if(H.length===0)return"";var ze=`
`+re.prev+re.base;return ze+U.call(H,","+ze)+`
`+re.prev}function ce(H,re){var ze=xe(H),Ge=[];if(ze){Ge.length=H.length;for(var Ye=0;Ye<H.length;Ye++)Ge[Ye]=G(H,Ye)?re(H[Ye],H):""}var Le=typeof R=="function"?R(H):[],Vr;if(w){Vr={};for(var kn=0;kn<Le.length;kn++)Vr["$"+Le[kn]]=Le[kn]}for(var an in H)G(H,an)&&(ze&&String(Number(an))===an&&an<H.length||w&&Vr["$"+an]instanceof Symbol||(B.call(/[^\w$]/,an)?Ge.push(re(an,H)+": "+re(H[an],H)):Ge.push(an+": "+re(H[an],H))));if(typeof R=="function")for(var ts=0;ts<Le.length;ts++)W.call(H,Le[ts])&&Ge.push("["+re(Le[ts])+"]: "+re(H[Le[ts]],H));return Ge}return wp}var vp,Ik;function z5(){if(Ik)return vp;Ik=1;var t=du(),e=Co(),r=function(a,c,l){for(var u=a,h;(h=u.next)!=null;u=h)if(h.key===c)return u.next=h.next,l||(h.next=a.next,a.next=h),h},n=function(a,c){if(a){var l=r(a,c);return l&&l.value}},i=function(a,c,l){var u=r(a,c);u?u.value=l:a.next={key:c,next:a.next,value:l}},s=function(a,c){return a?!!r(a,c):!1},o=function(a,c){if(a)return r(a,c,!0)};return vp=function(){var c,l={assert:function(u){if(!l.has(u))throw new e("Side channel does not contain "+t(u))},delete:function(u){var h=c&&c.next,d=o(c,u);return d&&h&&h===d&&(c=void 0),!!d},get:function(u){return n(c,u)},has:function(u){return s(c,u)},set:function(u,h){c||(c={next:void 0}),i(c,u,h)}};return l},vp}var Ep,Nk;function Ck(){return Nk||(Nk=1,Ep=Object),Ep}var kp,Lk;function W5(){return Lk||(Lk=1,kp=Error),kp}var xp,Mk;function H5(){return Mk||(Mk=1,xp=EvalError),xp}var Ap,Uk;function G5(){return Uk||(Uk=1,Ap=RangeError),Ap}var Tp,Fk;function K5(){return Fk||(Fk=1,Tp=ReferenceError),Tp}var Sp,Pk;function q5(){return Pk||(Pk=1,Sp=SyntaxError),Sp}var Rp,Bk;function Y5(){return Bk||(Bk=1,Rp=URIError),Rp}var Op,$k;function V5(){return $k||($k=1,Op=Math.abs),Op}var Ip,Dk;function X5(){return Dk||(Dk=1,Ip=Math.floor),Ip}var Np,jk;function Z5(){return jk||(jk=1,Np=Math.max),Np}var Cp,zk;function J5(){return zk||(zk=1,Cp=Math.min),Cp}var Lp,Wk;function Q5(){return Wk||(Wk=1,Lp=Math.pow),Lp}var Mp,Hk;function ej(){return Hk||(Hk=1,Mp=Math.round),Mp}var Up,Gk;function tj(){return Gk||(Gk=1,Up=Number.isNaN||function(e){return e!==e}),Up}var Fp,Kk;function rj(){if(Kk)return Fp;Kk=1;var t=tj();return Fp=function(r){return t(r)||r===0?r:r<0?-1:1},Fp}var Pp,qk;function nj(){return qk||(qk=1,Pp=Object.getOwnPropertyDescriptor),Pp}var Bp,Yk;function Vk(){if(Yk)return Bp;Yk=1;var t=nj();if(t)try{t([],"length")}catch{t=null}return Bp=t,Bp}var $p,Xk;function ij(){if(Xk)return $p;Xk=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return $p=t,$p}var Dp,Zk;function sj(){return Zk||(Zk=1,Dp=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[r]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Dp}var jp,Jk;function oj(){if(Jk)return jp;Jk=1;var t=typeof Symbol<"u"&&Symbol,e=sj();return jp=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},jp}var zp,Qk;function ex(){return Qk||(Qk=1,zp=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),zp}var Wp,tx;function rx(){if(tx)return Wp;tx=1;var t=Ck();return Wp=t.getPrototypeOf||null,Wp}var Hp,nx;function aj(){if(nx)return Hp;nx=1;var t="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,r=Math.max,n="[object Function]",i=function(c,l){for(var u=[],h=0;h<c.length;h+=1)u[h]=c[h];for(var d=0;d<l.length;d+=1)u[d+c.length]=l[d];return u},s=function(c,l){for(var u=[],h=l,d=0;h<c.length;h+=1,d+=1)u[d]=c[h];return u},o=function(a,c){for(var l="",u=0;u<a.length;u+=1)l+=a[u],u+1<a.length&&(l+=c);return l};return Hp=function(c){var l=this;if(typeof l!="function"||e.apply(l)!==n)throw new TypeError(t+l);for(var u=s(arguments,1),h,d=function(){if(this instanceof h){var y=l.apply(this,i(u,arguments));return Object(y)===y?y:this}return l.apply(c,i(u,arguments))},f=r(0,l.length-u.length),m=[],p=0;p<f;p++)m[p]="$"+p;if(h=Function("binder","return function ("+o(m,",")+"){ return binder.apply(this,arguments); }")(d),l.prototype){var g=function(){};g.prototype=l.prototype,h.prototype=new g,g.prototype=null}return h},Hp}var Gp,ix;function pu(){if(ix)return Gp;ix=1;var t=aj();return Gp=Function.prototype.bind||t,Gp}var Kp,sx;function qp(){return sx||(sx=1,Kp=Function.prototype.call),Kp}var Yp,ox;function ax(){return ox||(ox=1,Yp=Function.prototype.apply),Yp}var Vp,cx;function cj(){return cx||(cx=1,Vp=typeof Reflect<"u"&&Reflect&&Reflect.apply),Vp}var Xp,lx;function lj(){if(lx)return Xp;lx=1;var t=pu(),e=ax(),r=qp(),n=cj();return Xp=n||t.call(r,e),Xp}var Zp,ux;function fx(){if(ux)return Zp;ux=1;var t=pu(),e=Co(),r=qp(),n=lj();return Zp=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return n(t,r,s)},Zp}var Jp,hx;function uj(){if(hx)return Jp;hx=1;var t=fx(),e=Vk(),r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var n=!!r&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return Jp=n&&typeof n.get=="function"?t([n.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,Jp}var Qp,dx;function fj(){if(dx)return Qp;dx=1;var t=ex(),e=rx(),r=uj();return Qp=t?function(i){return t(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:r?function(i){return r(i)}:null,Qp}var e0,px;function hj(){if(px)return e0;px=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,r=pu();return e0=r.call(t,e),e0}var t0,mx;function r0(){if(mx)return t0;mx=1;var t,e=Ck(),r=W5(),n=H5(),i=G5(),s=K5(),o=q5(),a=Co(),c=Y5(),l=V5(),u=X5(),h=Z5(),d=J5(),f=Q5(),m=ej(),p=rj(),g=Function,y=function(ke){try{return g('"use strict"; return ('+ke+").constructor;")()}catch{}},b=Vk(),A=ij(),S=function(){throw new a},x=b?(function(){try{return arguments.callee,S}catch{try{return b(arguments,"callee").get}catch{return S}}})():S,B=oj()(),I=fj(),U=rx(),$=ex(),j=ax(),q=qp(),R={},O=typeof Uint8Array>"u"||!I?t:I(Uint8Array),w={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":B&&I?I([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":R,"%AsyncGenerator%":R,"%AsyncGeneratorFunction%":R,"%AsyncIteratorPrototype%":R,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":n,"%Float16Array%":typeof Float16Array>"u"?t:Float16Array,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":R,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":B&&I?I(I([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!B||!I?t:I(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":b,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!B||!I?t:I(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":B&&I?I(""[Symbol.iterator]()):t,"%Symbol%":B?Symbol:t,"%SyntaxError%":o,"%ThrowTypeError%":x,"%TypedArray%":O,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet,"%Function.prototype.call%":q,"%Function.prototype.apply%":j,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":U,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":h,"%Math.min%":d,"%Math.pow%":f,"%Math.round%":m,"%Math.sign%":p,"%Reflect.getPrototypeOf%":$};if(I)try{null.error}catch(ke){var C=I(I(ke));w["%Error.prototype%"]=C}var W=function ke(Ae){var Se;if(Ae==="%AsyncFunction%")Se=y("async function () {}");else if(Ae==="%GeneratorFunction%")Se=y("function* () {}");else if(Ae==="%AsyncGeneratorFunction%")Se=y("async function* () {}");else if(Ae==="%AsyncGenerator%"){var Me=ke("%AsyncGeneratorFunction%");Me&&(Se=Me.prototype)}else if(Ae==="%AsyncIteratorPrototype%"){var je=ke("%AsyncGenerator%");je&&I&&(Se=I(je.prototype))}return w[Ae]=Se,Se},P={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},V=pu(),J=hj(),N=V.call(q,Array.prototype.concat),L=V.call(j,Array.prototype.splice),F=V.call(q,String.prototype.replace),Y=V.call(q,String.prototype.slice),K=V.call(q,RegExp.prototype.exec),Q=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,he=/\\(\\)?/g,xe=function(Ae){var Se=Y(Ae,0,1),Me=Y(Ae,-1);if(Se==="%"&&Me!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(Me==="%"&&Se!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var je=[];return F(Ae,Q,function(T,ue,ie,G){je[je.length]=ie?F(G,he,"$1"):ue||T}),je},ve=function(Ae,Se){var Me=Ae,je;if(J(P,Me)&&(je=P[Me],Me="%"+je[0]+"%"),J(w,Me)){var T=w[Me];if(T===R&&(T=W(Me)),typeof T>"u"&&!Se)throw new a("intrinsic "+Ae+" exists, but is not available. Please file an issue!");return{alias:je,name:Me,value:T}}throw new o("intrinsic "+Ae+" does not exist!")};return t0=function(Ae,Se){if(typeof Ae!="string"||Ae.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Se!="boolean")throw new a('"allowMissing" argument must be a boolean');if(K(/^%?[^%]*%?$/,Ae)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Me=xe(Ae),je=Me.length>0?Me[0]:"",T=ve("%"+je+"%",Se),ue=T.name,ie=T.value,G=!1,z=T.alias;z&&(je=z[0],L(Me,N([0,1],z)));for(var ee=1,pe=!0;ee<Me.length;ee+=1){var me=Me[ee],se=Y(me,0,1),ye=Y(me,-1);if((se==='"'||se==="'"||se==="`"||ye==='"'||ye==="'"||ye==="`")&&se!==ye)throw new o("property names with quotes must have matching quotes");if((me==="constructor"||!pe)&&(G=!0),je+="."+me,ue="%"+je+"%",J(w,ue))ie=w[ue];else if(ie!=null){if(!(me in ie)){if(!Se)throw new a("base intrinsic for "+Ae+" exists, but the property is not available.");return}if(b&&ee+1>=Me.length){var Oe=b(ie,me);pe=!!Oe,pe&&"get"in Oe&&!("originalValue"in Oe.get)?ie=Oe.get:ie=ie[me]}else pe=J(ie,me),ie=ie[me];pe&&!G&&(w[ue]=ie)}}return ie},t0}var n0,gx;function yx(){if(gx)return n0;gx=1;var t=r0(),e=fx(),r=e([t("%String.prototype.indexOf%")]);return n0=function(i,s){var o=t(i,!!s);return typeof o=="function"&&r(i,".prototype.")>-1?e([o]):o},n0}var i0,_x;function bx(){if(_x)return i0;_x=1;var t=r0(),e=yx(),r=du(),n=Co(),i=t("%Map%",!0),s=e("Map.prototype.get",!0),o=e("Map.prototype.set",!0),a=e("Map.prototype.has",!0),c=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return i0=!!i&&function(){var h,d={assert:function(f){if(!d.has(f))throw new n("Side channel does not contain "+r(f))},delete:function(f){if(h){var m=c(h,f);return l(h)===0&&(h=void 0),m}return!1},get:function(f){if(h)return s(h,f)},has:function(f){return h?a(h,f):!1},set:function(f,m){h||(h=new i),o(h,f,m)}};return d},i0}var s0,wx;function dj(){if(wx)return s0;wx=1;var t=r0(),e=yx(),r=du(),n=bx(),i=Co(),s=t("%WeakMap%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),c=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return s0=s?function(){var h,d,f={assert:function(m){if(!f.has(m))throw new i("Side channel does not contain "+r(m))},delete:function(m){if(s&&m&&(typeof m=="object"||typeof m=="function")){if(h)return l(h,m)}else if(n&&d)return d.delete(m);return!1},get:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&h?o(h,m):d&&d.get(m)},has:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&h?c(h,m):!!d&&d.has(m)},set:function(m,p){s&&m&&(typeof m=="object"||typeof m=="function")?(h||(h=new s),a(h,m,p)):n&&(d||(d=n()),d.set(m,p))}};return f}:n,s0}var o0,vx;function pj(){if(vx)return o0;vx=1;var t=Co(),e=du(),r=z5(),n=bx(),i=dj(),s=i||n||r;return o0=function(){var a,c={assert:function(l){if(!c.has(l))throw new t("Side channel does not contain "+e(l))},delete:function(l){return!!a&&a.delete(l)},get:function(l){return a&&a.get(l)},has:function(l){return!!a&&a.has(l)},set:function(l,u){a||(a=s()),a.set(l,u)}};return c},o0}var a0,Ex;function c0(){if(Ex)return a0;Ex=1;var t=String.prototype.replace,e=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return a0={default:r.RFC3986,formatters:{RFC1738:function(n){return t.call(n,e,"+")},RFC3986:function(n){return String(n)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986},a0}var l0,kx;function xx(){if(kx)return l0;kx=1;var t=c0(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n=(function(){for(var g=[],y=0;y<256;++y)g.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return g})(),i=function(y){for(;y.length>1;){var b=y.pop(),A=b.obj[b.prop];if(r(A)){for(var S=[],x=0;x<A.length;++x)typeof A[x]<"u"&&S.push(A[x]);b.obj[b.prop]=S}}},s=function(y,b){for(var A=b&&b.plainObjects?{__proto__:null}:{},S=0;S<y.length;++S)typeof y[S]<"u"&&(A[S]=y[S]);return A},o=function g(y,b,A){if(!b)return y;if(typeof b!="object"&&typeof b!="function"){if(r(y))y.push(b);else if(y&&typeof y=="object")(A&&(A.plainObjects||A.allowPrototypes)||!e.call(Object.prototype,b))&&(y[b]=!0);else return[y,b];return y}if(!y||typeof y!="object")return[y].concat(b);var S=y;return r(y)&&!r(b)&&(S=s(y,A)),r(y)&&r(b)?(b.forEach(function(x,B){if(e.call(y,B)){var I=y[B];I&&typeof I=="object"&&x&&typeof x=="object"?y[B]=g(I,x,A):y.push(x)}else y[B]=x}),y):Object.keys(b).reduce(function(x,B){var I=b[B];return e.call(x,B)?x[B]=g(x[B],I,A):x[B]=I,x},S)},a=function(y,b){return Object.keys(b).reduce(function(A,S){return A[S]=b[S],A},y)},c=function(g,y,b){var A=g.replace(/\+/g," ");if(b==="iso-8859-1")return A.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(A)}catch{return A}},l=1024,u=function(y,b,A,S,x){if(y.length===0)return y;var B=y;if(typeof y=="symbol"?B=Symbol.prototype.toString.call(y):typeof y!="string"&&(B=String(y)),A==="iso-8859-1")return escape(B).replace(/%u[0-9a-f]{4}/gi,function(O){return"%26%23"+parseInt(O.slice(2),16)+"%3B"});for(var I="",U=0;U<B.length;U+=l){for(var $=B.length>=l?B.slice(U,U+l):B,j=[],q=0;q<$.length;++q){var R=$.charCodeAt(q);if(R===45||R===46||R===95||R===126||R>=48&&R<=57||R>=65&&R<=90||R>=97&&R<=122||x===t.RFC1738&&(R===40||R===41)){j[j.length]=$.charAt(q);continue}if(R<128){j[j.length]=n[R];continue}if(R<2048){j[j.length]=n[192|R>>6]+n[128|R&63];continue}if(R<55296||R>=57344){j[j.length]=n[224|R>>12]+n[128|R>>6&63]+n[128|R&63];continue}q+=1,R=65536+((R&1023)<<10|$.charCodeAt(q)&1023),j[j.length]=n[240|R>>18]+n[128|R>>12&63]+n[128|R>>6&63]+n[128|R&63]}I+=j.join("")}return I},h=function(y){for(var b=[{obj:{o:y},prop:"o"}],A=[],S=0;S<b.length;++S)for(var x=b[S],B=x.obj[x.prop],I=Object.keys(B),U=0;U<I.length;++U){var $=I[U],j=B[$];typeof j=="object"&&j!==null&&A.indexOf(j)===-1&&(b.push({obj:B,prop:$}),A.push(j))}return i(b),y},d=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},f=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},m=function(y,b){return[].concat(y,b)},p=function(y,b){if(r(y)){for(var A=[],S=0;S<y.length;S+=1)A.push(b(y[S]));return A}return b(y)};return l0={arrayToObject:s,assign:a,combine:m,compact:h,decode:c,encode:u,isBuffer:f,isRegExp:d,maybeMap:p,merge:o},l0}var u0,Ax;function mj(){if(Ax)return u0;Ax=1;var t=pj(),e=xx(),r=c0(),n=Object.prototype.hasOwnProperty,i={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,y){return g+"["+y+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(p,g){o.apply(p,s(g)?g:[g])},c=Date.prototype.toISOString,l=r.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:r.formatters[l],indices:!1,serializeDate:function(g){return c.call(g)},skipNulls:!1,strictNullHandling:!1},h=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},d={},f=function p(g,y,b,A,S,x,B,I,U,$,j,q,R,O,w,C,W,P){for(var V=g,J=P,N=0,L=!1;(J=J.get(d))!==void 0&&!L;){var F=J.get(g);if(N+=1,typeof F<"u"){if(F===N)throw new RangeError("Cyclic object value");L=!0}typeof J.get(d)>"u"&&(N=0)}if(typeof $=="function"?V=$(y,V):V instanceof Date?V=R(V):b==="comma"&&s(V)&&(V=e.maybeMap(V,function(ue){return ue instanceof Date?R(ue):ue})),V===null){if(x)return U&&!C?U(y,u.encoder,W,"key",O):y;V=""}if(h(V)||e.isBuffer(V)){if(U){var Y=C?y:U(y,u.encoder,W,"key",O);return[w(Y)+"="+w(U(V,u.encoder,W,"value",O))]}return[w(y)+"="+w(String(V))]}var K=[];if(typeof V>"u")return K;var Q;if(b==="comma"&&s(V))C&&U&&(V=e.maybeMap(V,U)),Q=[{value:V.length>0?V.join(",")||null:void 0}];else if(s($))Q=$;else{var he=Object.keys(V);Q=j?he.sort(j):he}var xe=I?String(y).replace(/\./g,"%2E"):String(y),ve=A&&s(V)&&V.length===1?xe+"[]":xe;if(S&&s(V)&&V.length===0)return ve+"[]";for(var ke=0;ke<Q.length;++ke){var Ae=Q[ke],Se=typeof Ae=="object"&&Ae&&typeof Ae.value<"u"?Ae.value:V[Ae];if(!(B&&Se===null)){var Me=q&&I?String(Ae).replace(/\./g,"%2E"):String(Ae),je=s(V)?typeof b=="function"?b(ve,Me):ve:ve+(q?"."+Me:"["+Me+"]");P.set(g,N);var T=t();T.set(d,P),a(K,p(Se,je,b,A,S,x,B,I,b==="comma"&&C&&s(V)?null:U,$,j,q,R,O,w,C,W,T))}}return K},m=function(g){if(!g)return u;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=g.charset||u.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=r.default;if(typeof g.format<"u"){if(!n.call(r.formatters,g.format))throw new TypeError("Unknown format option provided.");b=g.format}var A=r.formatters[b],S=u.filter;(typeof g.filter=="function"||s(g.filter))&&(S=g.filter);var x;if(g.arrayFormat in i?x=g.arrayFormat:"indices"in g?x=g.indices?"indices":"repeat":x=u.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var B=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:u.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:u.addQueryPrefix,allowDots:B,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:x,charset:y,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?u.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:u.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:u.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:u.encodeValuesOnly,filter:S,format:b,formatter:A,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:u.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:u.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:u.strictNullHandling}};return u0=function(p,g){var y=p,b=m(g),A,S;typeof b.filter=="function"?(S=b.filter,y=S("",y)):s(b.filter)&&(S=b.filter,A=S);var x=[];if(typeof y!="object"||y===null)return"";var B=i[b.arrayFormat],I=B==="comma"&&b.commaRoundTrip;A||(A=Object.keys(y)),b.sort&&A.sort(b.sort);for(var U=t(),$=0;$<A.length;++$){var j=A[$],q=y[j];b.skipNulls&&q===null||a(x,f(q,j,B,I,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,U))}var R=x.join(b.delimiter),O=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?O+="utf8=%26%2310003%3B&":O+="utf8=%E2%9C%93&"),R.length>0?O+R:""},u0}var f0,Tx;function gj(){if(Tx)return f0;Tx=1;var t=xx(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:t.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(d){return d.replace(/&#(\d+);/g,function(f,m){return String.fromCharCode(parseInt(m,10))})},s=function(d,f,m){if(d&&typeof d=="string"&&f.comma&&d.indexOf(",")>-1)return d.split(",");if(f.throwOnLimitExceeded&&m>=f.arrayLimit)throw new RangeError("Array limit exceeded. Only "+f.arrayLimit+" element"+(f.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(f,m){var p={__proto__:null},g=m.ignoreQueryPrefix?f.replace(/^\?/,""):f;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=m.parameterLimit===1/0?void 0:m.parameterLimit,b=g.split(m.delimiter,m.throwOnLimitExceeded?y+1:y);if(m.throwOnLimitExceeded&&b.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var A=-1,S,x=m.charset;if(m.charsetSentinel)for(S=0;S<b.length;++S)b[S].indexOf("utf8=")===0&&(b[S]===a?x="utf-8":b[S]===o&&(x="iso-8859-1"),A=S,S=b.length);for(S=0;S<b.length;++S)if(S!==A){var B=b[S],I=B.indexOf("]="),U=I===-1?B.indexOf("="):I+1,$,j;U===-1?($=m.decoder(B,n.decoder,x,"key"),j=m.strictNullHandling?null:""):($=m.decoder(B.slice(0,U),n.decoder,x,"key"),j=t.maybeMap(s(B.slice(U+1),m,r(p[$])?p[$].length:0),function(R){return m.decoder(R,n.decoder,x,"value")})),j&&m.interpretNumericEntities&&x==="iso-8859-1"&&(j=i(String(j))),B.indexOf("[]=")>-1&&(j=r(j)?[j]:j);var q=e.call(p,$);q&&m.duplicates==="combine"?p[$]=t.combine(p[$],j):(!q||m.duplicates==="last")&&(p[$]=j)}return p},l=function(d,f,m,p){var g=0;if(d.length>0&&d[d.length-1]==="[]"){var y=d.slice(0,-1).join("");g=Array.isArray(f)&&f[y]?f[y].length:0}for(var b=p?f:s(f,m,g),A=d.length-1;A>=0;--A){var S,x=d[A];if(x==="[]"&&m.parseArrays)S=m.allowEmptyArrays&&(b===""||m.strictNullHandling&&b===null)?[]:t.combine([],b);else{S=m.plainObjects?{__proto__:null}:{};var B=x.charAt(0)==="["&&x.charAt(x.length-1)==="]"?x.slice(1,-1):x,I=m.decodeDotInKeys?B.replace(/%2E/g,"."):B,U=parseInt(I,10);!m.parseArrays&&I===""?S={0:b}:!isNaN(U)&&x!==I&&String(U)===I&&U>=0&&m.parseArrays&&U<=m.arrayLimit?(S=[],S[U]=b):I!=="__proto__"&&(S[I]=b)}b=S}return b},u=function(f,m,p,g){if(f){var y=p.allowDots?f.replace(/\.([^.[]+)/g,"[$1]"):f,b=/(\[[^[\]]*])/,A=/(\[[^[\]]*])/g,S=p.depth>0&&b.exec(y),x=S?y.slice(0,S.index):y,B=[];if(x){if(!p.plainObjects&&e.call(Object.prototype,x)&&!p.allowPrototypes)return;B.push(x)}for(var I=0;p.depth>0&&(S=A.exec(y))!==null&&I<p.depth;){if(I+=1,!p.plainObjects&&e.call(Object.prototype,S[1].slice(1,-1))&&!p.allowPrototypes)return;B.push(S[1])}if(S){if(p.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+p.depth+" and strictDepth is true");B.push("["+y.slice(S.index)+"]")}return l(B,m,p,g)}},h=function(f){if(!f)return n;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.decodeDotInKeys<"u"&&typeof f.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(f.decoder!==null&&typeof f.decoder<"u"&&typeof f.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof f.throwOnLimitExceeded<"u"&&typeof f.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var m=typeof f.charset>"u"?n.charset:f.charset,p=typeof f.duplicates>"u"?n.duplicates:f.duplicates;if(p!=="combine"&&p!=="first"&&p!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof f.allowDots>"u"?f.decodeDotInKeys===!0?!0:n.allowDots:!!f.allowDots;return{allowDots:g,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:typeof f.allowPrototypes=="boolean"?f.allowPrototypes:n.allowPrototypes,allowSparse:typeof f.allowSparse=="boolean"?f.allowSparse:n.allowSparse,arrayLimit:typeof f.arrayLimit=="number"?f.arrayLimit:n.arrayLimit,charset:m,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:n.charsetSentinel,comma:typeof f.comma=="boolean"?f.comma:n.comma,decodeDotInKeys:typeof f.decodeDotInKeys=="boolean"?f.decodeDotInKeys:n.decodeDotInKeys,decoder:typeof f.decoder=="function"?f.decoder:n.decoder,delimiter:typeof f.delimiter=="string"||t.isRegExp(f.delimiter)?f.delimiter:n.delimiter,depth:typeof f.depth=="number"||f.depth===!1?+f.depth:n.depth,duplicates:p,ignoreQueryPrefix:f.ignoreQueryPrefix===!0,interpretNumericEntities:typeof f.interpretNumericEntities=="boolean"?f.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:typeof f.parameterLimit=="number"?f.parameterLimit:n.parameterLimit,parseArrays:f.parseArrays!==!1,plainObjects:typeof f.plainObjects=="boolean"?f.plainObjects:n.plainObjects,strictDepth:typeof f.strictDepth=="boolean"?!!f.strictDepth:n.strictDepth,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:n.strictNullHandling,throwOnLimitExceeded:typeof f.throwOnLimitExceeded=="boolean"?f.throwOnLimitExceeded:!1}};return f0=function(d,f){var m=h(f);if(d===""||d===null||typeof d>"u")return m.plainObjects?{__proto__:null}:{};for(var p=typeof d=="string"?c(d,m):d,g=m.plainObjects?{__proto__:null}:{},y=Object.keys(p),b=0;b<y.length;++b){var A=y[b],S=u(A,p[A],m,typeof d=="string");g=t.merge(g,S,m)}return m.allowSparse===!0?g:t.compact(g)},f0}var h0,Sx;function yj(){if(Sx)return h0;Sx=1;var t=mj(),e=gj(),r=c0();return h0={formats:r,parse:e,stringify:t},h0}var Rx;function _j(){if(Rx)return Us;Rx=1;var t=B5();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},p={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=yj();function y(x,B,I){if(x&&typeof x=="object"&&x instanceof e)return x;var U=new e;return U.parse(x,B,I),U}e.prototype.parse=function(x,B,I){if(typeof x!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof x);var U=x.indexOf("?"),$=U!==-1&&U<x.indexOf("#")?"?":"#",j=x.split($),q=/\\/g;j[0]=j[0].replace(q,"/"),x=j.join($);var R=x;if(R=R.trim(),!I&&x.split("#").length===1){var O=i.exec(R);if(O)return this.path=R,this.href=R,this.pathname=O[1],O[2]?(this.search=O[2],B?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):B&&(this.search="",this.query={}),this}var w=r.exec(R);if(w){w=w[0];var C=w.toLowerCase();this.protocol=C,R=R.substr(w.length)}if(I||w||R.match(/^\/\/[^@/]+@[^@/]+/)){var W=R.substr(0,2)==="//";W&&!(w&&m[w])&&(R=R.substr(2),this.slashes=!0)}if(!m[w]&&(W||w&&!p[w])){for(var P=-1,V=0;V<l.length;V++){var J=R.indexOf(l[V]);J!==-1&&(P===-1||J<P)&&(P=J)}var N,L;P===-1?L=R.lastIndexOf("@"):L=R.lastIndexOf("@",P),L!==-1&&(N=R.slice(0,L),R=R.slice(L+1),this.auth=decodeURIComponent(N)),P=-1;for(var V=0;V<c.length;V++){var J=R.indexOf(c[V]);J!==-1&&(P===-1||J<P)&&(P=J)}P===-1&&(P=R.length),this.host=R.slice(0,P),R=R.slice(P),this.parseHost(),this.hostname=this.hostname||"";var F=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!F)for(var Y=this.hostname.split(/\./),V=0,K=Y.length;V<K;V++){var Q=Y[V];if(Q&&!Q.match(h)){for(var he="",xe=0,ve=Q.length;xe<ve;xe++)Q.charCodeAt(xe)>127?he+="x":he+=Q[xe];if(!he.match(h)){var ke=Y.slice(0,V),Ae=Y.slice(V+1),Se=Q.match(d);Se&&(ke.push(Se[1]),Ae.unshift(Se[2])),Ae.length&&(R="/"+Ae.join(".")+R),this.hostname=ke.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),F||(this.hostname=t.toASCII(this.hostname));var Me=this.port?":"+this.port:"",je=this.hostname||"";this.host=je+Me,this.href+=this.host,F&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),R[0]!=="/"&&(R="/"+R))}if(!f[C])for(var V=0,K=a.length;V<K;V++){var T=a[V];if(R.indexOf(T)!==-1){var ue=encodeURIComponent(T);ue===T&&(ue=escape(T)),R=R.split(T).join(ue)}}var ie=R.indexOf("#");ie!==-1&&(this.hash=R.substr(ie),R=R.slice(0,ie));var G=R.indexOf("?");if(G!==-1?(this.search=R.substr(G),this.query=R.substr(G+1),B&&(this.query=g.parse(this.query)),R=R.slice(0,G)):B&&(this.search="",this.query={}),R&&(this.pathname=R),p[C]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Me=this.pathname||"",z=this.search||"";this.path=Me+z}return this.href=this.format(),this};function b(x){return typeof x=="string"&&(x=y(x)),x instanceof e?x.format():e.prototype.format.call(x)}e.prototype.format=function(){var x=this.auth||"";x&&(x=encodeURIComponent(x),x=x.replace(/%3A/i,":"),x+="@");var B=this.protocol||"",I=this.pathname||"",U=this.hash||"",$=!1,j="";this.host?$=x+this.host:this.hostname&&($=x+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&($+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(j=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var q=this.search||j&&"?"+j||"";return B&&B.substr(-1)!==":"&&(B+=":"),this.slashes||(!B||p[B])&&$!==!1?($="//"+($||""),I&&I.charAt(0)!=="/"&&(I="/"+I)):$||($=""),U&&U.charAt(0)!=="#"&&(U="#"+U),q&&q.charAt(0)!=="?"&&(q="?"+q),I=I.replace(/[?#]/g,function(R){return encodeURIComponent(R)}),q=q.replace("#","%23"),B+$+I+q+U};function A(x,B){return y(x,!1,!0).resolve(B)}e.prototype.resolve=function(x){return this.resolveObject(y(x,!1,!0)).format()};function S(x,B){return x?y(x,!1,!0).resolveObject(B):B}return e.prototype.resolveObject=function(x){if(typeof x=="string"){var B=new e;B.parse(x,!1,!0),x=B}for(var I=new e,U=Object.keys(this),$=0;$<U.length;$++){var j=U[$];I[j]=this[j]}if(I.hash=x.hash,x.href==="")return I.href=I.format(),I;if(x.slashes&&!x.protocol){for(var q=Object.keys(x),R=0;R<q.length;R++){var O=q[R];O!=="protocol"&&(I[O]=x[O])}return p[I.protocol]&&I.hostname&&!I.pathname&&(I.pathname="/",I.path=I.pathname),I.href=I.format(),I}if(x.protocol&&x.protocol!==I.protocol){if(!p[x.protocol]){for(var w=Object.keys(x),C=0;C<w.length;C++){var W=w[C];I[W]=x[W]}return I.href=I.format(),I}if(I.protocol=x.protocol,!x.host&&!m[x.protocol]){for(var K=(x.pathname||"").split("/");K.length&&!(x.host=K.shift()););x.host||(x.host=""),x.hostname||(x.hostname=""),K[0]!==""&&K.unshift(""),K.length<2&&K.unshift(""),I.pathname=K.join("/")}else I.pathname=x.pathname;if(I.search=x.search,I.query=x.query,I.host=x.host||"",I.auth=x.auth,I.hostname=x.hostname||x.host,I.port=x.port,I.pathname||I.search){var P=I.pathname||"",V=I.search||"";I.path=P+V}return I.slashes=I.slashes||x.slashes,I.href=I.format(),I}var J=I.pathname&&I.pathname.charAt(0)==="/",N=x.host||x.pathname&&x.pathname.charAt(0)==="/",L=N||J||I.host&&x.pathname,F=L,Y=I.pathname&&I.pathname.split("/")||[],K=x.pathname&&x.pathname.split("/")||[],Q=I.protocol&&!p[I.protocol];if(Q&&(I.hostname="",I.port=null,I.host&&(Y[0]===""?Y[0]=I.host:Y.unshift(I.host)),I.host="",x.protocol&&(x.hostname=null,x.port=null,x.host&&(K[0]===""?K[0]=x.host:K.unshift(x.host)),x.host=null),L=L&&(K[0]===""||Y[0]==="")),N)I.host=x.host||x.host===""?x.host:I.host,I.hostname=x.hostname||x.hostname===""?x.hostname:I.hostname,I.search=x.search,I.query=x.query,Y=K;else if(K.length)Y||(Y=[]),Y.pop(),Y=Y.concat(K),I.search=x.search,I.query=x.query;else if(x.search!=null){if(Q){I.host=Y.shift(),I.hostname=I.host;var he=I.host&&I.host.indexOf("@")>0?I.host.split("@"):!1;he&&(I.auth=he.shift(),I.hostname=he.shift(),I.host=I.hostname)}return I.search=x.search,I.query=x.query,(I.pathname!==null||I.search!==null)&&(I.path=(I.pathname?I.pathname:"")+(I.search?I.search:"")),I.href=I.format(),I}if(!Y.length)return I.pathname=null,I.search?I.path="/"+I.search:I.path=null,I.href=I.format(),I;for(var xe=Y.slice(-1)[0],ve=(I.host||x.host||Y.length>1)&&(xe==="."||xe==="..")||xe==="",ke=0,Ae=Y.length;Ae>=0;Ae--)xe=Y[Ae],xe==="."?Y.splice(Ae,1):xe===".."?(Y.splice(Ae,1),ke++):ke&&(Y.splice(Ae,1),ke--);if(!L&&!F)for(;ke--;ke)Y.unshift("..");L&&Y[0]!==""&&(!Y[0]||Y[0].charAt(0)!=="/")&&Y.unshift(""),ve&&Y.join("/").substr(-1)!=="/"&&Y.push("");var Se=Y[0]===""||Y[0]&&Y[0].charAt(0)==="/";if(Q){I.hostname=Se?"":Y.length?Y.shift():"",I.host=I.hostname;var he=I.host&&I.host.indexOf("@")>0?I.host.split("@"):!1;he&&(I.auth=he.shift(),I.hostname=he.shift(),I.host=I.hostname)}return L=L||I.host&&Y.length,L&&!Se&&Y.unshift(""),Y.length>0?I.pathname=Y.join("/"):(I.pathname=null,I.path=null),(I.pathname!==null||I.search!==null)&&(I.path=(I.pathname?I.pathname:"")+(I.search?I.search:"")),I.auth=x.auth||I.auth,I.slashes=I.slashes||x.slashes,I.href=I.format(),I},e.prototype.parseHost=function(){var x=this.host,B=n.exec(x);B&&(B=B[0],B!==":"&&(this.port=B.substr(1)),x=x.substr(0,x.length-B.length)),x&&(this.hostname=x)},Us.parse=y,Us.resolve=A,Us.resolveObject=S,Us.format=b,Us.Url=e,Us}var d0,Ox;function bj(){return Ox||(Ox=1,d0=typeof URL=="function"?URL:_j().URL),d0}var Ix;function mu(){if(Ix)return Pn;Ix=1;const t=bj();function e(j,q,R){if(q in j)return j[q];if(arguments.length===3)return R;throw new Error('"'+q+'" is a required argument.')}Pn.getArg=e;const r=(function(){return!("__proto__"in Object.create(null))})();function n(j){return j}function i(j){return o(j)?"$"+j:j}Pn.toSetString=r?n:i;function s(j){return o(j)?j.slice(1):j}Pn.fromSetString=r?n:s;function o(j){if(!j)return!1;const q=j.length;if(q<9||j.charCodeAt(q-1)!==95||j.charCodeAt(q-2)!==95||j.charCodeAt(q-3)!==111||j.charCodeAt(q-4)!==116||j.charCodeAt(q-5)!==111||j.charCodeAt(q-6)!==114||j.charCodeAt(q-7)!==112||j.charCodeAt(q-8)!==95||j.charCodeAt(q-9)!==95)return!1;for(let R=q-10;R>=0;R--)if(j.charCodeAt(R)!==36)return!1;return!0}function a(j,q){return j===q?0:j===null?1:q===null?-1:j>q?1:-1}function c(j,q){let R=j.generatedLine-q.generatedLine;return R!==0||(R=j.generatedColumn-q.generatedColumn,R!==0)||(R=a(j.source,q.source),R!==0)||(R=j.originalLine-q.originalLine,R!==0)||(R=j.originalColumn-q.originalColumn,R!==0)?R:a(j.name,q.name)}Pn.compareByGeneratedPositionsInflated=c;function l(j){return JSON.parse(j.replace(/^\)]}'[^\n]*\n/,""))}Pn.parseSourceMapInput=l;const u="http:",h=`${u}//host`;function d(j){return q=>{const R=y(q),O=p(q),w=new t(q,O);j(w);const C=w.toString();return R==="absolute"?C:R==="scheme-relative"?C.slice(u.length):R==="path-absolute"?C.slice(h.length):b(O,C)}}function f(j,q){return new t(j,q).toString()}function m(j,q){let R=0;do{const O=j+R++;if(q.indexOf(O)===-1)return O}while(!0)}function p(j){const q=j.split("..").length-1,R=m("p",j);let O=`${h}/`;for(let w=0;w<q;w++)O+=`${R}/`;return O}const g=/^[A-Za-z0-9\+\-\.]+:/;function y(j){return j[0]==="/"?j[1]==="/"?"scheme-relative":"path-absolute":g.test(j)?"absolute":"path-relative"}function b(j,q){typeof j=="string"&&(j=new t(j)),typeof q=="string"&&(q=new t(q));const R=q.pathname.split("/"),O=j.pathname.split("/");for(O.length>0&&!O[O.length-1]&&O.pop();R.length>0&&O.length>0&&R[0]===O[0];)R.shift(),O.shift();return O.map(()=>"..").concat(R).join("/")+q.search+q.hash}const A=d(j=>{j.pathname=j.pathname.replace(/\/?$/,"/")}),S=d(j=>{j.href=new t(".",j.toString()).toString()}),x=d(j=>{});Pn.normalize=x;function B(j,q){const R=y(q),O=y(j);if(j=A(j),R==="absolute")return f(q,void 0);if(O==="absolute")return f(q,j);if(R==="scheme-relative")return x(q);if(O==="scheme-relative")return f(q,f(j,h)).slice(u.length);if(R==="path-absolute")return x(q);if(O==="path-absolute")return f(q,f(j,h)).slice(h.length);const w=p(q+j),C=f(q,f(j,w));return b(w,C)}Pn.join=B;function I(j,q){const R=U(j,q);return typeof R=="string"?R:x(q)}Pn.relative=I;function U(j,q){if(y(j)!==y(q))return null;const O=p(j+q),w=new t(j,O),C=new t(q,O);try{new t("",C.toString())}catch{return null}return C.protocol!==w.protocol||C.user!==w.user||C.password!==w.password||C.hostname!==w.hostname||C.port!==w.port?null:b(w,C)}function $(j,q,R){j&&y(q)==="path-absolute"&&(q=q.replace(/^\//,""));let O=x(q||"");return j&&(O=B(j,O)),R&&(O=B(S(R),O)),O}return Pn.computeSourceURL=$,Pn}var p0={},Nx;function Cx(){if(Nx)return p0;Nx=1;class t{constructor(){this._array=[],this._set=new Map}static fromArray(r,n){const i=new t;for(let s=0,o=r.length;s<o;s++)i.add(r[s],n);return i}size(){return this._set.size}add(r,n){const i=this.has(r),s=this._array.length;(!i||n)&&this._array.push(r),i||this._set.set(r,s)}has(r){return this._set.has(r)}indexOf(r){const n=this._set.get(r);if(n>=0)return n;throw new Error('"'+r+'" is not in the set.')}at(r){if(r>=0&&r<this._array.length)return this._array[r];throw new Error("No element indexed by "+r)}toArray(){return this._array.slice()}}return p0.ArraySet=t,p0}var m0={},Lx;function wj(){if(Lx)return m0;Lx=1;const t=mu();function e(n,i){const s=n.generatedLine,o=i.generatedLine,a=n.generatedColumn,c=i.generatedColumn;return o>s||o==s&&c>=a||t.compareByGeneratedPositionsInflated(n,i)<=0}class r{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(i,s){this._array.forEach(i,s)}add(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))}toArray(){return this._sorted||(this._array.sort(t.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}return m0.MappingList=r,m0}var Mx;function Ux(){if(Mx)return gp;Mx=1;const t=Tk(),e=mu(),r=Cx().ArraySet,n=wj().MappingList;class i{constructor(o){o||(o={}),this._file=e.getArg(o,"file",null),this._sourceRoot=e.getArg(o,"sourceRoot",null),this._skipValidation=e.getArg(o,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new n,this._sourcesContents=null}static fromSourceMap(o){const a=o.sourceRoot,c=new i({file:o.file,sourceRoot:a});return o.eachMapping(function(l){const u={generated:{line:l.generatedLine,column:l.generatedColumn}};l.source!=null&&(u.source=l.source,a!=null&&(u.source=e.relative(a,u.source)),u.original={line:l.originalLine,column:l.originalColumn},l.name!=null&&(u.name=l.name)),c.addMapping(u)}),o.sources.forEach(function(l){let u=l;a!=null&&(u=e.relative(a,l)),c._sources.has(u)||c._sources.add(u);const h=o.sourceContentFor(l);h!=null&&c.setSourceContent(l,h)}),c}addMapping(o){const a=e.getArg(o,"generated"),c=e.getArg(o,"original",null);let l=e.getArg(o,"source",null),u=e.getArg(o,"name",null);this._skipValidation||this._validateMapping(a,c,l,u),l!=null&&(l=String(l),this._sources.has(l)||this._sources.add(l)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:a.line,generatedColumn:a.column,originalLine:c&&c.line,originalColumn:c&&c.column,source:l,name:u})}setSourceContent(o,a){let c=o;this._sourceRoot!=null&&(c=e.relative(this._sourceRoot,c)),a!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(c)]=a):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(c)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(o,a,c){let l=a;if(a==null){if(o.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);l=o.file}const u=this._sourceRoot;u!=null&&(l=e.relative(u,l));const h=this._mappings.toArray().length>0?new r:this._sources,d=new r;this._mappings.unsortedForEach(function(f){if(f.source===l&&f.originalLine!=null){const g=o.originalPositionFor({line:f.originalLine,column:f.originalColumn});g.source!=null&&(f.source=g.source,c!=null&&(f.source=e.join(c,f.source)),u!=null&&(f.source=e.relative(u,f.source)),f.originalLine=g.line,f.originalColumn=g.column,g.name!=null&&(f.name=g.name))}const m=f.source;m!=null&&!h.has(m)&&h.add(m);const p=f.name;p!=null&&!d.has(p)&&d.add(p)},this),this._sources=h,this._names=d,o.sources.forEach(function(f){const m=o.sourceContentFor(f);m!=null&&(c!=null&&(f=e.join(c,f)),u!=null&&(f=e.relative(u,f)),this.setSourceContent(f,m))},this)}_validateMapping(o,a,c,l){if(a&&typeof a.line!="number"&&typeof a.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(o&&"line"in o&&"column"in o&&o.line>0&&o.column>=0&&!a&&!c&&!l)){if(!(o&&"line"in o&&"column"in o&&a&&"line"in a&&"column"in a&&o.line>0&&o.column>=0&&a.line>0&&a.column>=0&&c))throw new Error("Invalid mapping: "+JSON.stringify({generated:o,source:c,original:a,name:l}))}}_serializeMappings(){let o=0,a=1,c=0,l=0,u=0,h=0,d="",f,m,p,g;const y=this._mappings.toArray();for(let b=0,A=y.length;b<A;b++){if(m=y[b],f="",m.generatedLine!==a)for(o=0;m.generatedLine!==a;)f+=";",a++;else if(b>0){if(!e.compareByGeneratedPositionsInflated(m,y[b-1]))continue;f+=","}f+=t.encode(m.generatedColumn-o),o=m.generatedColumn,m.source!=null&&(g=this._sources.indexOf(m.source),f+=t.encode(g-h),h=g,f+=t.encode(m.originalLine-1-l),l=m.originalLine-1,f+=t.encode(m.originalColumn-c),c=m.originalColumn,m.name!=null&&(p=this._names.indexOf(m.name),f+=t.encode(p-u),u=p)),d+=f}return d}_generateSourcesContent(o,a){return o.map(function(c){if(!this._sourcesContents)return null;a!=null&&(c=e.relative(a,c));const l=e.toSetString(c);return Object.prototype.hasOwnProperty.call(this._sourcesContents,l)?this._sourcesContents[l]:null},this)}toJSON(){const o={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(o.file=this._file),this._sourceRoot!=null&&(o.sourceRoot=this._sourceRoot),this._sourcesContents&&(o.sourcesContent=this._generateSourcesContent(o.sources,o.sourceRoot)),o}toString(){return JSON.stringify(this.toJSON())}}return i.prototype._version=3,gp.SourceMapGenerator=i,gp}var Xa={},g0={},Fx;function vj(){return Fx||(Fx=1,(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(r,n,i,s,o,a){const c=Math.floor((n-r)/2)+r,l=o(i,s[c],!0);return l===0?c:l>0?n-c>1?e(c,n,i,s,o,a):a===t.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-r>1?e(r,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:r<0?-1:r}t.search=function(n,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,n,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(g0)),g0}var gu={exports:{}},Px;function Bx(){if(Px)return gu.exports;Px=1;let t=null;return gu.exports=function(){if(typeof t=="string")return fetch(t).then(r=>r.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},gu.exports.initialize=e=>{t=e},gu.exports}var y0,$x;function Ej(){if($x)return y0;$x=1;const t=Bx();function e(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let r=null;return y0=function(){if(r)return r;const i=[];return r=t().then(s=>WebAssembly.instantiate(s,{env:{mapping_callback(o,a,c,l,u,h,d,f,m,p){const g=new e;g.generatedLine=o+1,g.generatedColumn=a,c&&(g.lastGeneratedColumn=l-1),u&&(g.source=h,g.originalLine=d+1,g.originalColumn=f,m&&(g.name=p)),i[i.length-1](g)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(s=>({exports:s.instance.exports,withMappingCallback:(o,a)=>{i.push(o);try{a()}finally{i.pop()}}})).then(null,s=>{throw r=null,s}),r},y0}var Dx;function kj(){if(Dx)return Xa;Dx=1;const t=mu(),e=vj(),r=Cx().ArraySet;Tk();const n=Bx(),i=Ej(),s=Symbol("smcInternal");class o{constructor(d,f){return d==s?Promise.resolve(this):l(d,f)}static initialize(d){n.initialize(d["lib/mappings.wasm"])}static fromSourceMap(d,f){return u(d,f)}static async with(d,f,m){const p=await new o(d,f);try{return await m(p)}finally{p.destroy()}}eachMapping(d,f,m){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(d){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}o.prototype._version=3,o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,Xa.SourceMapConsumer=o;class a extends o{constructor(d,f){return super(s).then(m=>{let p=d;typeof d=="string"&&(p=t.parseSourceMapInput(d));const g=t.getArg(p,"version"),y=t.getArg(p,"sources").map(String),b=t.getArg(p,"names",[]),A=t.getArg(p,"sourceRoot",null),S=t.getArg(p,"sourcesContent",null),x=t.getArg(p,"mappings"),B=t.getArg(p,"file",null),I=t.getArg(p,"x_google_ignoreList",null);if(g!=m._version)throw new Error("Unsupported version: "+g);return m._sourceLookupCache=new Map,m._names=r.fromArray(b.map(String),!0),m._sources=r.fromArray(y,!0),m._absoluteSources=r.fromArray(m._sources.toArray().map(function(U){return t.computeSourceURL(A,U,f)}),!0),m.sourceRoot=A,m.sourcesContent=S,m._mappings=x,m._sourceMapURL=f,m.file=B,m.x_google_ignoreList=I,m._computedColumnSpans=!1,m._mappingsPtr=0,m._wasm=null,i().then(U=>(m._wasm=U,m))})}_findSourceIndex(d){const f=this._sourceLookupCache.get(d);if(typeof f=="number")return f;const m=t.computeSourceURL(null,d,this._sourceMapURL);if(this._absoluteSources.has(m)){const g=this._absoluteSources.indexOf(m);return this._sourceLookupCache.set(d,g),g}const p=t.computeSourceURL(this.sourceRoot,d,this._sourceMapURL);if(this._absoluteSources.has(p)){const g=this._absoluteSources.indexOf(p);return this._sourceLookupCache.set(d,g),g}return-1}static fromSourceMap(d,f){return new a(d.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const d=this._mappings,f=d.length,m=this._wasm.exports.allocate_mappings(f)>>>0,p=new Uint8Array(this._wasm.exports.memory.buffer,m,f);for(let y=0;y<f;y++)p[y]=d.charCodeAt(y);const g=this._wasm.exports.parse_mappings(m);if(!g){const y=this._wasm.exports.get_last_error();let b=`Error parsing mappings (code ${y}): `;switch(y){case 1:b+="the mappings contained a negative line, column, source index, or name index";break;case 2:b+="the mappings contained a number larger than 2**32";break;case 3:b+="reached EOF while in the middle of parsing a VLQ";break;case 4:b+="invalid base 64 character while parsing a VLQ";break;default:b+="unknown error code";break}throw new Error(b)}this._mappingsPtr=g}eachMapping(d,f,m){const p=f||null,g=m||o.GENERATED_ORDER;this._wasm.withMappingCallback(y=>{y.source!==null&&(y.source=this._absoluteSources.at(y.source),y.name!==null&&(y.name=this._names.at(y.name))),this._computedColumnSpans&&y.lastGeneratedColumn===null&&(y.lastGeneratedColumn=1/0),d.call(p,y)},()=>{switch(g){case o.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case o.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(d){let f=t.getArg(d,"source");const m=t.getArg(d,"line"),p=d.column||0;if(f=this._findSourceIndex(f),f<0)return[];if(m<1)throw new Error("Line numbers must be >= 1");if(p<0)throw new Error("Column numbers must be >= 0");const g=[];return this._wasm.withMappingCallback(y=>{let b=y.lastGeneratedColumn;this._computedColumnSpans&&b===null&&(b=1/0),g.push({line:y.generatedLine,column:y.generatedColumn,lastColumn:b})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),f,m-1,"column"in d,p)}),g}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(d){const f={generatedLine:t.getArg(d,"line"),generatedColumn:t.getArg(d,"column")};if(f.generatedLine<1)throw new Error("Line numbers must be >= 1");if(f.generatedColumn<0)throw new Error("Column numbers must be >= 0");let m=t.getArg(d,"bias",o.GREATEST_LOWER_BOUND);m==null&&(m=o.GREATEST_LOWER_BOUND);let p;if(this._wasm.withMappingCallback(g=>p=g,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),f.generatedLine-1,f.generatedColumn,m)}),p&&p.generatedLine===f.generatedLine){let g=t.getArg(p,"source",null);g!==null&&(g=this._absoluteSources.at(g));let y=t.getArg(p,"name",null);return y!==null&&(y=this._names.at(y)),{source:g,line:t.getArg(p,"originalLine",null),column:t.getArg(p,"originalColumn",null),name:y}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(d){return d==null}):!1}sourceContentFor(d,f){if(!this.sourcesContent)return null;const m=this._findSourceIndex(d);if(m>=0)return this.sourcesContent[m];if(f)return null;throw new Error('"'+d+'" is not in the SourceMap.')}generatedPositionFor(d){let f=t.getArg(d,"source");if(f=this._findSourceIndex(f),f<0)return{line:null,column:null,lastColumn:null};const m={source:f,originalLine:t.getArg(d,"line"),originalColumn:t.getArg(d,"column")};if(m.originalLine<1)throw new Error("Line numbers must be >= 1");if(m.originalColumn<0)throw new Error("Column numbers must be >= 0");let p=t.getArg(d,"bias",o.GREATEST_LOWER_BOUND);p==null&&(p=o.GREATEST_LOWER_BOUND);let g;if(this._wasm.withMappingCallback(y=>g=y,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),m.source,m.originalLine-1,m.originalColumn,p)}),g&&g.source===m.source){let y=g.lastGeneratedColumn;return this._computedColumnSpans&&y===null&&(y=1/0),{line:t.getArg(g,"generatedLine",null),column:t.getArg(g,"generatedColumn",null),lastColumn:y}}return{line:null,column:null,lastColumn:null}}}a.prototype.consumer=o,Xa.BasicSourceMapConsumer=a;class c extends o{constructor(d,f){return super(s).then(m=>{let p=d;typeof d=="string"&&(p=t.parseSourceMapInput(d));const g=t.getArg(p,"version"),y=t.getArg(p,"sections");if(g!=m._version)throw new Error("Unsupported version: "+g);let b={line:-1,column:0};return Promise.all(y.map(A=>{if(A.url)throw new Error("Support for url field in sections not implemented.");const S=t.getArg(A,"offset"),x=t.getArg(S,"line"),B=t.getArg(S,"column");if(x<b.line||x===b.line&&B<b.column)throw new Error("Section offsets must be ordered and non-overlapping.");return b=S,new o(t.getArg(A,"map"),f).then(U=>({generatedOffset:{generatedLine:x+1,generatedColumn:B+1},consumer:U}))})).then(A=>(m._sections=A,m))})}get sources(){const d=[];for(let f=0;f<this._sections.length;f++)for(let m=0;m<this._sections[f].consumer.sources.length;m++)d.push(this._sections[f].consumer.sources[m]);return d}originalPositionFor(d){const f={generatedLine:t.getArg(d,"line"),generatedColumn:t.getArg(d,"column")},m=e.search(f,this._sections,function(g,y){const b=g.generatedLine-y.generatedOffset.generatedLine;return b||g.generatedColumn-(y.generatedOffset.generatedColumn-1)}),p=this._sections[m];return p?p.consumer.originalPositionFor({line:f.generatedLine-(p.generatedOffset.generatedLine-1),column:f.generatedColumn-(p.generatedOffset.generatedLine===f.generatedLine?p.generatedOffset.generatedColumn-1:0),bias:d.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(d){return d.consumer.hasContentsOfAllSources()})}sourceContentFor(d,f){for(let m=0;m<this._sections.length;m++){const g=this._sections[m].consumer.sourceContentFor(d,!0);if(g)return g}if(f)return null;throw new Error('"'+d+'" is not in the SourceMap.')}_findSectionIndex(d){for(let f=0;f<this._sections.length;f++){const{consumer:m}=this._sections[f];if(m._findSourceIndex(d)!==-1)return f}return-1}generatedPositionFor(d){const f=this._findSectionIndex(t.getArg(d,"source")),m=f>=0?this._sections[f]:null,p=f>=0&&f+1<this._sections.length?this._sections[f+1]:null,g=m&&m.consumer.generatedPositionFor(d);if(g&&g.line!==null){const y=m.generatedOffset.generatedLine-1,b=m.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=b,typeof g.lastColumn=="number"&&(g.lastColumn+=b)),g.lastColumn===1/0&&p&&g.line===p.generatedOffset.generatedLine&&(g.lastColumn=p.generatedOffset.generatedColumn-2),g.line+=y,g}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(d){const f=this._findSectionIndex(t.getArg(d,"source")),m=f>=0?this._sections[f]:null,p=f>=0&&f+1<this._sections.length?this._sections[f+1]:null;return m?m.consumer.allGeneratedPositionsFor(d).map(g=>{const y=m.generatedOffset.generatedLine-1,b=m.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=b,typeof g.lastColumn=="number"&&(g.lastColumn+=b)),g.lastColumn===1/0&&p&&g.line===p.generatedOffset.generatedLine&&(g.lastColumn=p.generatedOffset.generatedColumn-2),g.line+=y,g}):[]}eachMapping(d,f,m){this._sections.forEach((p,g)=>{const y=g+1<this._sections.length?this._sections[g+1]:null,{generatedOffset:b}=p,A=b.generatedLine-1,S=b.generatedColumn-1;p.consumer.eachMapping(function(x){x.generatedLine===1&&(x.generatedColumn+=S,typeof x.lastGeneratedColumn=="number"&&(x.lastGeneratedColumn+=S)),x.lastGeneratedColumn===1/0&&y&&x.generatedLine===y.generatedOffset.generatedLine&&(x.lastGeneratedColumn=y.generatedOffset.generatedColumn-2),x.generatedLine+=A,d.call(this,x)},f,m)})}computeColumnSpans(){for(let d=0;d<this._sections.length;d++)this._sections[d].consumer.computeColumnSpans()}destroy(){for(let d=0;d<this._sections.length;d++)this._sections[d].consumer.destroy()}}Xa.IndexedSourceMapConsumer=c;function l(h,d){let f=h;typeof h=="string"&&(f=t.parseSourceMapInput(h));const m=f.sections!=null?new c(f,d):new a(f,d);return Promise.resolve(m)}function u(h,d){return a.fromSourceMap(h,d)}return Xa}var _0={},jx;function xj(){if(jx)return _0;jx=1;const t=Ux().SourceMapGenerator,e=mu(),r=/(\r?\n)/,n=10,i="$$$isSourceNode$$$";class s{constructor(a,c,l,u,h){this.children=[],this.sourceContents={},this.line=a??null,this.column=c??null,this.source=l??null,this.name=h??null,this[i]=!0,u!=null&&this.add(u)}static fromStringWithSourceMap(a,c,l){const u=new s,h=a.split(r);let d=0;const f=function(){const A=x(),S=x()||"";return A+S;function x(){return d<h.length?h[d++]:void 0}};let m=1,p=0,g=null,y;return c.eachMapping(function(A){if(g!==null)if(m<A.generatedLine)b(g,f()),m++,p=0;else{y=h[d]||"";const S=y.substr(0,A.generatedColumn-p);h[d]=y.substr(A.generatedColumn-p),p=A.generatedColumn,b(g,S),g=A;return}for(;m<A.generatedLine;)u.add(f()),m++;p<A.generatedColumn&&(y=h[d]||"",u.add(y.substr(0,A.generatedColumn)),h[d]=y.substr(A.generatedColumn),p=A.generatedColumn),g=A},this),d<h.length&&(g&&b(g,f()),u.add(h.splice(d).join(""))),c.sources.forEach(function(A){const S=c.sourceContentFor(A);S!=null&&(l!=null&&(A=e.join(l,A)),u.setSourceContent(A,S))}),u;function b(A,S){if(A===null||A.source===void 0)u.add(S);else{const x=l?e.join(l,A.source):A.source;u.add(new s(A.originalLine,A.originalColumn,x,S,A.name))}}}add(a){if(Array.isArray(a))a.forEach(function(c){this.add(c)},this);else if(a[i]||typeof a=="string")a&&this.children.push(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}prepend(a){if(Array.isArray(a))for(let c=a.length-1;c>=0;c--)this.prepend(a[c]);else if(a[i]||typeof a=="string")this.children.unshift(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}walk(a){let c;for(let l=0,u=this.children.length;l<u;l++)c=this.children[l],c[i]?c.walk(a):c!==""&&a(c,{source:this.source,line:this.line,column:this.column,name:this.name})}join(a){let c,l;const u=this.children.length;if(u>0){for(c=[],l=0;l<u-1;l++)c.push(this.children[l]),c.push(a);c.push(this.children[l]),this.children=c}return this}replaceRight(a,c){const l=this.children[this.children.length-1];return l[i]?l.replaceRight(a,c):typeof l=="string"?this.children[this.children.length-1]=l.replace(a,c):this.children.push("".replace(a,c)),this}setSourceContent(a,c){this.sourceContents[e.toSetString(a)]=c}walkSourceContents(a){for(let l=0,u=this.children.length;l<u;l++)this.children[l][i]&&this.children[l].walkSourceContents(a);const c=Object.keys(this.sourceContents);for(let l=0,u=c.length;l<u;l++)a(e.fromSetString(c[l]),this.sourceContents[c[l]])}toString(){let a="";return this.walk(function(c){a+=c}),a}toStringWithSourceMap(a){const c={code:"",line:1,column:0},l=new t(a);let u=!1,h=null,d=null,f=null,m=null;return this.walk(function(p,g){c.code+=p,g.source!==null&&g.line!==null&&g.column!==null?((h!==g.source||d!==g.line||f!==g.column||m!==g.name)&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name}),h=g.source,d=g.line,f=g.column,m=g.name,u=!0):u&&(l.addMapping({generated:{line:c.line,column:c.column}}),h=null,u=!1);for(let y=0,b=p.length;y<b;y++)p.charCodeAt(y)===n?(c.line++,c.column=0,y+1===b?(h=null,u=!1):u&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name})):c.column++}),this.walkSourceContents(function(p,g){l.setSourceContent(p,g)}),{code:c.code,map:l}}}return _0.SourceNode=s,_0}var zx;function Aj(){return zx||(zx=1,Ya.SourceMapGenerator=Ux().SourceMapGenerator,Ya.SourceMapConsumer=kj().SourceMapConsumer,Ya.SourceNode=xj().SourceNode),Ya}var Tj=Aj();let Wx=0;const Hx=Xn,Sj=["Command","lines"];class Rj extends P3{constructor(){super(pE,{traceInitPerf:Xn,skipValidations:!Xn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"}),this.performSelfAnalysis()}PEEK(e,r,...n){console.info(e,n.map(i=>[i.image,i.tokenType]),r)}RULED(e,r,n){const i=Sj.some(s=>e.includes(s));return this.RULE(e,()=>{const o=(Wx++).toString().padStart(3),a=i?"font-weight: bold;":"";if(Hx&&!this.RECORDING_PHASE){const c=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${o}%c> ${e} ${c.join(" ")}`,a)}r(),Hx&&!this.RECORDING_PHASE&&console.info(`${o}%c< ${e} `,a),Wx--},n)}program=this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))});line=this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Yl)}])});stmt=this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])});inline_go=this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))});inline_try=this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))});inline_command=this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))});inline=this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])});stmt_label=this.RULED("stmt_label",()=>{this.CONSUME(Ad)});stmt_stat=this.RULED("stmt_stat",()=>{this.CONSUME(xd)});stmt_text=this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(M1)}])});stmt_comment=this.RULED("stmt_comment",()=>{this.CONSUME(U1)});stmt_hyperlink=this.RULED("stmt_hyperlink",()=>{this.CONSUME(F1),this.CONSUME(P1)});stmt_command=this.RULED("stmt_command",()=>{this.CONSUME(Eo),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])});structured_cmd=this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])});short_go=this.RULED("short_go",()=>{this.CONSUME(Cd),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});short_try=this.RULED("short_try",()=>{this.CONSUME(tE),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});command_if=this.RULED("command_if",()=>{this.CONSUME(Ld),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))});command_if_block=this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Xl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Yl)),this.CONSUME4(Eo),this.CONSUME4(Md)}}])});command_block=this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Xl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Eo),this.CONSUME(Md)}}])});command_fork=this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Xl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])});command_else_if=this.RULED("command_else_if",()=>{this.CONSUME(Eo),this.CONSUME(Ud),this.CONSUME(Ld),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))});command_else=this.RULED("command_else",()=>{this.CONSUME(Eo),this.CONSUME(Ud),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))});command_while=this.RULED("command_while",()=>{this.CONSUME(aE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_repeat=this.RULED("command_repeat",()=>{this.CONSUME(cE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_waitfor=this.RULED("command_waitfor",()=>{this.CONSUME(lE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_foreach=this.RULED("command_foreach",()=>{this.CONSUME(uE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_break=this.RULED("command_break",()=>{this.CONSUME(fE)});command_continue=this.RULED("command_continue",()=>{this.CONSUME(hE)});command_play=this.RULED("command_play",()=>{this.CONSUME(iE)});command_toast=this.RULED("command_toast",()=>{this.CONSUME(sE)});command_ticker=this.RULED("command_ticker",()=>{this.CONSUME(oE)});expr=this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Sd),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})});and_test=this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Od),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})});not_test=this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Rd),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])});comparison=this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})});comp_op=this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Gv)},{ALT:()=>this.CONSUME(Kv)},{ALT:()=>this.CONSUME(qv)},{ALT:()=>this.CONSUME(Yv)},{ALT:()=>this.CONSUME(Vv)},{ALT:()=>this.CONSUME(Xv)}])});expr_value=this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Sd),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})});and_test_value=this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Od),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})});not_test_value=this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Rd),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])});arith_expr=this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])});arith_expr_item=this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Id)},{ALT:()=>this.CONSUME(Nd)}]),this.SUBRULE(this.term)});term=this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))});term_item=this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Jv)},{ALT:()=>this.CONSUME(Cd)},{ALT:()=>this.CONSUME(Qv)},{ALT:()=>this.CONSUME(eE)}]),this.SUBRULE(this.factor)});factor=this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Id)},{ALT:()=>this.CONSUME(Nd)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])});power=this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Zv),this.SUBRULE(this.factor)})});words=this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))});kind=this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)});category=this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(B1)},{ALT:()=>this.CONSUME($1)}])});collision=this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(D1)},{ALT:()=>this.CONSUME(j1)},{ALT:()=>this.CONSUME(z1)},{ALT:()=>this.CONSUME(W1)},{ALT:()=>this.CONSUME(H1)},{ALT:()=>this.CONSUME(G1)},{ALT:()=>this.CONSUME(K1)},{ALT:()=>this.CONSUME(q1)},{ALT:()=>this.CONSUME(Y1)}])});color=this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(V1)},{ALT:()=>this.CONSUME(X1)},{ALT:()=>this.CONSUME(Z1)},{ALT:()=>this.CONSUME(J1)},{ALT:()=>this.CONSUME(Q1)},{ALT:()=>this.CONSUME(ew)},{ALT:()=>this.CONSUME(tw)},{ALT:()=>this.CONSUME(rw)},{ALT:()=>this.CONSUME(nw)},{ALT:()=>this.CONSUME(iw)},{ALT:()=>this.CONSUME(sw)},{ALT:()=>this.CONSUME(ow)},{ALT:()=>this.CONSUME(aw)},{ALT:()=>this.CONSUME(cw)},{ALT:()=>this.CONSUME(lw)},{ALT:()=>this.CONSUME(uw)},{ALT:()=>this.CONSUME(fw)},{ALT:()=>this.CONSUME(hw)},{ALT:()=>this.CONSUME(dw)},{ALT:()=>this.CONSUME(pw)},{ALT:()=>this.CONSUME(mw)},{ALT:()=>this.CONSUME(gw)},{ALT:()=>this.CONSUME(yw)},{ALT:()=>this.CONSUME(_w)},{ALT:()=>this.CONSUME(bw)},{ALT:()=>this.CONSUME(ww)},{ALT:()=>this.CONSUME(vw)},{ALT:()=>this.CONSUME(Ew)},{ALT:()=>this.CONSUME(kw)},{ALT:()=>this.CONSUME(xw)},{ALT:()=>this.CONSUME(Aw)},{ALT:()=>this.CONSUME(Tw)},{ALT:()=>this.CONSUME(Sw)},{ALT:()=>this.CONSUME(Rw)},{ALT:()=>this.CONSUME(Ow)},{ALT:()=>this.CONSUME(Iw)},{ALT:()=>this.CONSUME(Nw)},{ALT:()=>this.CONSUME(Cw)},{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME(jw)}])});dir_mod=this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(ev)},{ALT:()=>this.CONSUME(tv)},{ALT:()=>this.CONSUME(rv)},{ALT:()=>this.CONSUME(nv)},{ALT:()=>this.CONSUME(Ev)},{ALT:()=>this.CONSUME(kv)},{ALT:()=>this.SUBRULE(this.dir_within)},{ALT:()=>this.SUBRULE(this.dir_awayby)}])});dir_by=this.RULED("dir_by",()=>{this.CONSUME(qw),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_at=this.RULED("dir_at",()=>{this.CONSUME(Yw),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_away=this.RULED("dir_away",()=>{this.CONSUME(iv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_toward=this.RULED("dir_toward",()=>{this.CONSUME(sv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_find=this.RULED("dir_find",()=>{this.CONSUME(ov),this.SUBRULE1(this.kind)});dir_flee=this.RULED("dir_flee",()=>{this.CONSUME(av),this.SUBRULE1(this.kind)});dir_to=this.RULED("dir_to",()=>{this.CONSUME(cv),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)});dir_within=this.RULED("dir_within",()=>{this.CONSUME(xv),this.SUBRULE1(this.simple_token)});dir_awayby=this.RULED("dir_awayby",()=>{this.CONSUME(Av),this.SUBRULE1(this.simple_token)});dir=this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Ww)},{ALT:()=>this.CONSUME(Hw)},{ALT:()=>this.CONSUME(Gw)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.SUBRULE(this.dir_by)},{ALT:()=>this.SUBRULE(this.dir_at)},{ALT:()=>this.SUBRULE(this.dir_away)},{ALT:()=>this.SUBRULE(this.dir_toward)},{ALT:()=>this.CONSUME(Vw)},{ALT:()=>this.CONSUME(Xw)},{ALT:()=>this.CONSUME(Zw)},{ALT:()=>this.CONSUME(Jw)},{ALT:()=>this.CONSUME(Qw)},{ALT:()=>this.SUBRULE(this.dir_find)},{ALT:()=>this.SUBRULE(this.dir_flee)},{ALT:()=>this.SUBRULE(this.dir_to)},{ALT:()=>this.CONSUME(lv)},{ALT:()=>this.CONSUME(uv)},{ALT:()=>this.CONSUME(fv)},{ALT:()=>this.CONSUME(hv)},{ALT:()=>this.CONSUME(dv)},{ALT:()=>this.CONSUME(pv)},{ALT:()=>this.CONSUME(mv)},{ALT:()=>this.CONSUME(gv)},{ALT:()=>this.CONSUME(yv)},{ALT:()=>this.CONSUME(_v)},{ALT:()=>this.CONSUME(bv)},{ALT:()=>this.CONSUME(wv)},{ALT:()=>this.CONSUME(vv)}])});expr_any=this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])});token_expr_any=this.RULED("token_expr_any",()=>{this.CONSUME(Ov),this.SUBRULE(this.expr_any)});token_expr_count=this.RULED("token_expr_count",()=>{this.CONSUME(Iv),this.SUBRULE(this.expr_any)});token_expr_blocked=this.RULED("token_expr_blocked",()=>{this.CONSUME(Rv),this.SUBRULE(this.dir)});token_expr_abs=this.RULED("token_expr_abs",()=>{this.CONSUME(Nv),this.SUBRULE(this.simple_token)});token_expr_intceil=this.RULED("token_expr_intceil",()=>{this.CONSUME(Cv),this.SUBRULE(this.simple_token)});token_expr_intfloor=this.RULED("token_expr_intfloor",()=>{this.CONSUME(Lv),this.SUBRULE(this.simple_token)});token_expr_intround=this.RULED("token_expr_intround",()=>{this.CONSUME(Mv),this.SUBRULE(this.simple_token)});token_expr_clamp=this.RULED("token_expr_clamp",()=>{this.CONSUME(Uv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)});token_expr_min=this.RULED("token_expr_min",()=>{this.CONSUME(Fv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_max=this.RULED("token_expr_max",()=>{this.CONSUME(Pv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pick=this.RULED("token_expr_pick",()=>{this.CONSUME(Bv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pickwith=this.RULED("token_expr_pickwith",()=>{this.CONSUME($v),this.SUBRULE1(this.simple_token),this.AT_LEAST_ONE(()=>this.SUBRULE2(this.simple_token))});token_expr_random=this.RULED("token_expr_random",()=>{this.CONSUME(Dv),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))});token_expr_randomwith=this.RULED("token_expr_randomwith",()=>{this.CONSUME(jv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))});token_expr_run=this.RULED("token_expr_run",()=>{this.CONSUME(zv),this.SUBRULE(this.string_token)});token_expr_runwith=this.RULED("token_expr_runwith",()=>{this.CONSUME(Wv),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)});token_expr=this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(Tv)},{ALT:()=>this.CONSUME(Sv)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])});string_token=this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(Vl)}])});simple_token=this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(Td)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(Vl)},{ALT:()=>this.SUBRULE(this.color)}])});token=this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(Ad)},{ALT:()=>this.CONSUME(Vl)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(Td)},{ALT:()=>this.CONSUME(Hv)},{ALT:()=>{this.CONSUME(rE),this.SUBRULE(this.expr),this.CONSUME(nE)}}])})}const Lo=new Rj;if(rN){const t=Lo.getGAstProductions(),e=V3(t);console.info(e)}const Oj=Lo.getBaseCstVisitorConstructor();var Ne=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(Ne||{}),Fs=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Fs||{}),ci=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(ci||{}),yu=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(yu||{});function Wt(t,e){const[r]=t??[];return(r?.image??e).trimStart().replaceAll(/^"|"$/g,"")}class Ij extends Oj{unique=0;constructor(){super(),Xn&&this.validateVisitor()}visit(e){if(ut(e)&&(e=e[0]),!!v(e))return this[e.name](e.children,e.location)}createcodenode(e,r){return[{...r,...e,lineindex:0}]}createstringnode(e,r){return this.createcodenode(e,{type:12,literal:1,value:r})}createtemplatenode(e,r){return this.createcodenode(e,{type:12,literal:2,value:r})}createmarknode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:3,id:r,comment:n}))}creategotonode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:4,id:r,comment:n}))}createlinenode(e,r){return this.createcodenode(e,{type:2,stmts:r})}createapinode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:1,words:n,method:r}))}createlogicnode(e,r,n,i){return this.createlinenode(e,this.createcodenode(e,{type:14,skip:n,words:i,method:r}))}createcountnode(e){return this.createcodenode(e,{type:5,index:this.unique++})}createexprnodeondemand(e,r){return e.length===1?e[0]:this.createcodenode(r,{type:31,words:e})[0]}go(e){return Array.isArray(e)?e.map(r=>this.visit(r)).flat():v(e)?[this.visit(e)].flat():[]}program(e,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(e.line)].flat()})}line(e){return e.stmt?this.go(e.stmt):[]}stmt(e){return e.stmt_label?this.go(e.stmt_label):e.stmt_stat?this.go(e.stmt_stat):e.stmt_text?this.go(e.stmt_text):e.stmt_comment?this.go(e.stmt_comment):e.stmt_hyperlink?this.go(e.stmt_hyperlink):e.stmt_command?this.go(e.stmt_command):e.short_go?this.go(e.short_go):e.short_try?this.go(e.short_try):[]}inline_go(e){const r=[];return e.short_go&&r.push(...this.go(e.short_go)),e.inline&&r.push(...this.go(e.inline)),r}inline_try(e){const r=[];return e.short_try&&r.push(...this.go(e.short_try)),e.inline&&r.push(...this.go(e.inline)),r}inline_command(e){const r=[];return e.stmt_command&&r.push(...this.go(e.stmt_command)),e.inline&&r.push(...this.go(e.inline)),r}inline(e){const r=[];return e.stmt_stat&&r.push(...this.go(e.stmt_stat)),e.stmt_text&&r.push(...this.go(e.stmt_text)),e.stmt_comment&&r.push(...this.go(e.stmt_comment)),e.stmt_hyperlink&&r.push(...this.go(e.stmt_hyperlink)),e.inline_go&&r.push(...this.go(e.inline_go)),e.inline_try&&r.push(...this.go(e.inline_try)),e.inline_command&&r.push(...this.go(e.inline_command)),e.structured_cmd&&r.push(...this.go(e.structured_cmd)),r}stmt_label(e,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Wt(e.token_label,":").slice(1).trim()}))}stmt_stat(e,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Wt(e.token_stat,"@").slice(1)}))}stmt_text(e,r){const n=Wt(e.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:n}))}stmt_comment(e,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Wt(e.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(e,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:Wt(e.token_hyperlink,"!").slice(1),text:Wt(e.token_hyperlinktext,";").slice(1)}))}stmt_command(e,r){return e.structured_cmd?this.go(e.structured_cmd):this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(e.words)}))}structured_cmd(e){return e.command_if?this.go(e.command_if):e.command_while?this.go(e.command_while):e.command_repeat?this.go(e.command_repeat):e.command_waitfor?this.go(e.command_waitfor):e.command_foreach?this.go(e.command_foreach):e.command_break?this.go(e.command_break):e.command_continue?this.go(e.command_continue):[]}short_go(e,r){return e.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}short_try(e,r){return e.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}command_if(e,r){const[n]=this.createlogicnode(r,Wt(e.token_if,"if").toLowerCase(),"",this.go(e.words)),[i]=this.go(e.command_if_block)??[];return this.createcodenode(r,{type:13,check:n,block:i})}command_if_block(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:15,skip:n,done:i,lines:[this.go(e.inline),this.go(e.line),this.creategotonode(r,i,"end of if"),this.createmarknode(r,n,"alt logic")].flat(),altlines:[this.go(e.command_else_if),this.go(e.command_else),this.createmarknode(r,i,"end of if")].flat()})}command_block(e){return[this.go(e.inline),this.go(e.line)].flat()}command_fork(e){return[this.go(e.inline),this.go(e.line)].flat()}command_else_if(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:16,done:i,lines:[this.createlogicnode(r,Wt(e.token_if,"if"),n,this.go(e.words)),this.go(e.command_fork),this.creategotonode(r,i,"end of if"),this.createmarknode(r,n,"skip")].flat()})}command_else(e,r){const n=[];return e.words&&n.push(...this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(e.words)}))),e.command_fork&&n.push(...this.go(e.command_fork)),this.createcodenode(r,{type:17,lines:n})}command_while(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:18,loop:n,done:i,lines:[this.createmarknode(r,n,"start of while"),this.createlogicnode(r,"if",i,this.go(e.words)),this.go(e.command_block),this.creategotonode(r,n,"loop of while"),this.createmarknode(r,i,"end of while")].flat()})}command_repeat(e,r){const n=Ft(),i=Ft(),o=[this.createcountnode(r),this.go(e.words)].flat();return this.createcodenode(r,{type:21,loop:n,done:i,lines:[this.createapinode(r,"repeatstart",o),this.createmarknode(r,n,"start of repeat"),this.createlogicnode(r,"repeat",i,o),this.go(e.command_block),this.creategotonode(r,n,"loop of repeat"),this.createmarknode(r,i,"end of repeat")].flat()})}command_foreach(e,r){const n=Ft(),i=Ft(),o=[this.createcountnode(r),this.go(e.words)].flat();return this.createcodenode(r,{type:23,loop:n,done:i,lines:[this.createapinode(r,"foreachstart",o),this.createmarknode(r,n,"start of foreach"),this.createlogicnode(r,"foreach",i,o),this.go(e.command_block),this.creategotonode(r,n,"loop of foreach"),this.createmarknode(r,i,"end of foreach")].flat()})}command_waitfor(e,r){const n=Ft();return this.createcodenode(r,{type:22,loop:n,lines:[this.createmarknode(r,n,"start of waitfor"),this.createlogicnode(r,"waitfor",n,this.go(e.words))].flat()})}command_break(e,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(e,r){return this.createcodenode(r,{type:20,goto:0})}command_play(e,r){const n=Wt(e.token_command_play,"").trim(),[i,...s]=n.split(" ");return[this.createstringnode(r,i),this.createstringnode(r,s.join(" "))].flat()}command_toast(e,r){const i=Wt(e.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(r,"toast"),this.createtemplatenode(r,i)].flat()}command_ticker(e,r){const i=Wt(e.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(r,"ticker"),this.createtemplatenode(r,i)].flat()}expr(e,r){return e.RHS?this.createcodenode(r,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}and_test(e,r){return e.RHS?this.createcodenode(r,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}not_test(e,r){return e.comparison?this.go(e.comparison):e.LHS?this.createcodenode(r,{type:26,items:this.go(e.LHS)}):[]}comparison(e,r){if(e.RHS){const[n]=this.go(e.comp_op);return this.createcodenode(r,{type:27,compare:n,lhs:this.createexprnodeondemand(this.go(e.LHS),r),rhs:this.createexprnodeondemand(this.go(e.RHS),r)})}return this.go(e.LHS)}comp_op(e,r){return e.token_iseq?this.createcodenode(r,{type:28,method:0}):e.token_isnoteq?this.createcodenode(r,{type:28,method:1}):e.token_islessthan?this.createcodenode(r,{type:28,method:2}):e.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):e.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):e.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(e,r){return e.RHS?this.createcodenode(r,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}and_test_value(e,r){return e.RHS?this.createcodenode(r,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}not_test_value(e,r){return e.arith_expr?this.go(e.arith_expr):e.LHS?this.createcodenode(r,{type:26,items:this.go(e.LHS)}):[]}arith_expr(e,r){if(e.LHS)return this.go(e.LHS);const n=this.go(e.term);return e.RHS?this.createcodenode(r,{type:29,lhs:n[0],items:this.go(e.RHS)}):n}arith_expr_item(e,r){return this.createcodenode(r,{type:30,operator:e.token_plus?1:2,rhs:this.go(e.term)[0]})}term(e,r){return e.term_item?this.createcodenode(r,{type:29,lhs:this.go(e.factor)[0],items:this.go(e.term_item)}):this.go(e.factor)}term_item(e,r){let n=0;return e.token_multiply&&(n=4),e.token_divide&&(n=5),e.token_moddivide&&(n=6),e.token_floordivide&&(n=7),this.createcodenode(r,{type:30,operator:n,rhs:this.go(e.factor)[0]})}factor(e,r){if(e.power)return this.go(e.power);let n=0;return e.token_plus&&(n=8),e.token_minus&&(n=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:n,rhs:this.go(e.LHS)[0]})})}power(e,r){const n=this.go(e.token);return e.factor?this.createcodenode(r,{type:29,lhs:n[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(e.factor)[0]})}):n}words(e){return this.go(e.expr)}kind(e){return[this.go(e.color),this.go(e.string_token)].flat()}category(e,r){return e.token_isterrain?this.createcodenode(r,{type:12,literal:1,value:"isterrain"}):e.token_isobject?this.createcodenode(r,{type:12,literal:1,value:"isobject"}):[]}collision(e,r){return e.token_iswalkable?this.createcodenode(r,{type:12,literal:1,value:"iswalkable"}):e.token_iswalking?this.createcodenode(r,{type:12,literal:1,value:"iswalking"}):e.token_iswalk?this.createcodenode(r,{type:12,literal:1,value:"iswalk"}):e.token_isswimmable?this.createcodenode(r,{type:12,literal:1,value:"isswimmable"}):e.token_isswimming?this.createcodenode(r,{type:12,literal:1,value:"isswimming"}):e.token_isswim?this.createcodenode(r,{type:12,literal:1,value:"isswim"}):e.token_issolid?this.createcodenode(r,{type:12,literal:1,value:"issolid"}):e.token_isbullet?this.createcodenode(r,{type:12,literal:1,value:"isbullet"}):e.token_isghost?this.createcodenode(r,{type:12,literal:1,value:"isghost"}):[]}color(e,r){let n="ERROR";return e.token_black&&(n="black"),e.token_dkblue&&(n="dkblue"),e.token_dkgreen&&(n="dkgreen"),e.token_dkcyan&&(n="dkcyan"),e.token_dkred&&(n="dkred"),e.token_dkpurple&&(n="dkpurple"),e.token_dkyellow&&(n="dkyellow"),e.token_ltgray&&(n="ltgray"),e.token_dkgray&&(n="dkgray"),e.token_blue&&(n="blue"),e.token_green&&(n="green"),e.token_cyan&&(n="cyan"),e.token_red&&(n="red"),e.token_purple&&(n="purple"),e.token_yellow&&(n="yellow"),e.token_white&&(n="white"),e.token_brown&&(n="brown"),e.token_dkwhite&&(n="dkwhite"),e.token_ltgrey&&(n="ltgrey"),e.token_gray&&(n="gray"),e.token_grey&&(n="grey"),e.token_dkgrey&&(n="dkgrey"),e.token_ltblack&&(n="ltblack"),e.token_onblack&&(n="onblack"),e.token_ondkblue&&(n="ondkblue"),e.token_ondkgreen&&(n="ondkgreen"),e.token_ondkcyan&&(n="ondkcyan"),e.token_ondkred&&(n="ondkred"),e.token_ondkpurple&&(n="ondkpurple"),e.token_ondkyellow&&(n="ondkyellow"),e.token_onltgray&&(n="onltgray"),e.token_ondkgray&&(n="ondkgray"),e.token_onblue&&(n="onblue"),e.token_ongreen&&(n="ongreen"),e.token_oncyan&&(n="oncyan"),e.token_onred&&(n="onred"),e.token_onpurple&&(n="onpurple"),e.token_onyellow&&(n="onyellow"),e.token_onwhite&&(n="onwhite"),e.token_onbrown&&(n="onbrown"),e.token_ondkwhite&&(n="ondkwhite"),e.token_onltgrey&&(n="onltgrey"),e.token_ongray&&(n="ongray"),e.token_ongrey&&(n="ongrey"),e.token_ondkgrey&&(n="ondkgrey"),e.token_onltblack&&(n="onltblack"),e.token_onclear&&(n="onclear"),this.createcodenode(r,{type:12,literal:1,value:n})}dir_mod(e,r){if(e.dir_within)return this.go(e.dir_within);if(e.dir_awayby)return this.go(e.dir_awayby);let n="ERROR";return e.token_cw&&(n="cw"),e.token_ccw&&(n="ccw"),e.token_opp&&(n="opp"),e.token_rndp&&(n="rndp"),e.token_over&&(n="over"),e.token_under&&(n="under"),this.createcodenode(r,{type:12,literal:1,value:n})}dir_by(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"by"}),...this.go(e.simple_token)]}dir_at(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"at"}),...this.go(e.simple_token)]}dir_away(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"away"}),...this.go(e.simple_token)]}dir_toward(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"toward"}),...this.go(e.simple_token)]}dir_find(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"find"}),...this.go(e.kind)]}dir_flee(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"flee"}),...this.go(e.kind)]}dir_to(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"to"}),...this.go(e.dir)]}dir_within(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"within"}),...this.go(e.simple_token)]}dir_awayby(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"awayby"}),...this.go(e.simple_token)]}dir(e,r){const n=this.go(e.dir_mod)??[];return e.token_i&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"i"})),e.token_idle&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"idle"})),e.token_n&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"n"})),e.token_u&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"u"})),e.token_north&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"north"})),e.token_up&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"up"})),e.token_s&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"s"})),e.token_d&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"d"})),e.token_south&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"south"})),e.token_down&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"down"})),e.token_w&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"w"})),e.token_l&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"l"})),e.token_west&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"west"})),e.token_left&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"left"})),e.token_e&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"e"})),e.token_r&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"r"})),e.token_east&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"east"})),e.token_right&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"right"})),e.token_rnd&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rnd"})),e.token_rndne&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rndne"})),e.token_rndns&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rndns"})),e.token_flow&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"flow"})),e.token_seek&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"seek"})),e.dir_by&&n.push(...this.go(e.dir_by)),e.dir_at&&n.push(...this.go(e.dir_at)),e.dir_away&&n.push(...this.go(e.dir_away)),e.dir_toward&&n.push(...this.go(e.dir_toward)),e.dir_find&&n.push(...this.go(e.dir_find)),e.dir_flee&&n.push(...this.go(e.dir_flee)),e.dir_to&&n.push(...this.go(e.dir_to)),n.flat()}expr_any(e){return[this.go(e.dir),this.go(e.kind),this.go(e.color)].flat()}token_expr_any(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"any"}),this.go(e.expr_any)].flat()}token_expr_count(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"countof"}),this.go(e.expr_any)].flat()}token_expr_blocked(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"blocked"}),this.go(e.dir)].flat()}token_expr_abs(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"abs"}),...this.go(e.simple_token)]}token_expr_intceil(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intceil"}),...this.go(e.simple_token)]}token_expr_intfloor(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intfloor"}),...this.go(e.simple_token)]}token_expr_intround(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intround"}),...this.go(e.simple_token)]}token_expr_clamp(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"clamp"}),...this.go(e.simple_token)]}token_expr_min(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"min"}),...this.go(e.simple_token)]}token_expr_max(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"max"}),...this.go(e.simple_token)]}token_expr_pick(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pick"}),...this.go(e.simple_token)]}token_expr_pickwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pickwith"}),...this.go(e.simple_token)]}token_expr_random(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"random"}),...this.go(e.simple_token)]}token_expr_randomwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"randomwith"}),...this.go(e.simple_token)]}token_expr_run(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"run"}),...this.go(e.string_token)]}token_expr_runwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"runwith"}),...this.go(e.simple_token),...this.go(e.string_token)]}token_expr(e,r){return e.token_expr_aligned?this.createcodenode(r,{type:12,literal:1,value:"aligned"}):e.token_contact?this.createcodenode(r,{type:12,literal:1,value:"contact"}):e.token_expr_any?this.go(e.token_expr_any):e.token_expr_count?this.go(e.token_expr_count):e.token_expr_blocked?this.go(e.token_expr_blocked):e.token_expr_abs?this.go(e.token_expr_abs):e.token_expr_intceil?this.go(e.token_expr_intceil):e.token_expr_intfloor?this.go(e.token_expr_intfloor):e.token_expr_intround?this.go(e.token_expr_intround):e.token_expr_clamp?this.go(e.token_expr_clamp):e.token_expr_min?this.go(e.token_expr_min):e.token_expr_max?this.go(e.token_expr_max):e.token_expr_pick?this.go(e.token_expr_pick):e.token_expr_pickwith?this.go(e.token_expr_pickwith):e.token_expr_random?this.go(e.token_expr_random):e.token_expr_randomwith?this.go(e.token_expr_randomwith):e.token_expr_run?this.go(e.token_expr_run):e.token_expr_runwith?this.go(e.token_expr_runwith):[]}string_token(e,r){if(e.token_stringliteraldouble){const n=Wt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Wt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}return[]}simple_token(e,r){if(e.token_stringliteraldouble){const n=Wt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Wt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_numberliteral){const n=parseFloat(Wt(e.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:n})}return e.color?this.go(e.color):[]}token(e,r){if(e.category)return this.go(e.category);if(e.collision)return this.go(e.collision);if(e.color)return this.go(e.color);if(e.dir)return this.go(e.dir);if(e.command_play)return this.go(e.command_play);if(e.command_toast)return this.go(e.command_toast);if(e.command_ticker)return this.go(e.command_ticker);if(e.token_label){const n=Wt(e.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_stringliteraldouble){const n=Wt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Wt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_numberliteral){const n=parseFloat(Wt(e.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:n})}if(e.token_lparen)return[this.createexprnodeondemand(this.go(e.expr),r)];if(e.token_stop){const n=Wt(e.token_stop,"");return this.createcodenode(r,{type:12,literal:1,value:n})}return[]}}const Nj=new Ij,Kr={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},_u="zss.js";function ct(t,e){return new Tj.SourceNode(t.startLine??1,t.startColumn??1,_u,e)}function b0(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function bu(t){return`'${b0(t)}'`}function w0(t){const e=Yd(t);return e.errors.length?t:`['${e.tokens.map(n=>{if(n.tokenType===Kd){const i=b0(n.image.substring(1));return $e(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return b0(n.image)}).join("")}'].join('')`}function Za(t){return t.filter(e=>e!==void 0).map(ht)}function Gx(t){return ct(t,"")}function Cj(t,e){const r=[];return t.forEach(n=>{r.push(n,e)}),r.pop(),r}function er(t,e,r){return ct(t,[`api.${e}(`,...Cj(r,", "),")"])}function Lj(t){if(t.type===Ne.COMPARE&&t.compare.type===Ne.COMPARE_ITEM)switch(t.compare.method){case Fs.IS_EQ:return er(t,"isEq",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_NOT_EQ:return er(t,"isNotEq",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_LESS_THAN:return er(t,"isLessThan",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_GREATER_THAN:return er(t,"isGreaterThan",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_LESS_THAN_OR_EQ:return er(t,"isLessThanOrEq",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_GREATER_THAN_OR_EQ:return er(t,"isGreaterThanOrEq",[ht(t.lhs),ht(t.rhs)])}return ct(t,"")}function Ps(t,e,r){return t.prepend(`api.${e}(`),t.add([", ",ht(r),")"])}function Kx(t,e,r){return t.prepend(`api.${e}(`),t.add([ht(r),")"])}function Mj(t,e){if(t.type===Ne.OPERATOR_ITEM)switch(t.operator){case ci.PLUS:return Ps(e,"opPlus",t.rhs);case ci.MINUS:return Ps(e,"opMinus",t.rhs);case ci.POWER:return Ps(e,"opPower",t.rhs);case ci.MULTIPLY:return Ps(e,"opMultiply",t.rhs);case ci.DIVIDE:return Ps(e,"opDivide",t.rhs);case ci.MOD_DIVIDE:return Ps(e,"opModDivide",t.rhs);case ci.FLOOR_DIVIDE:return Ps(e,"opFloorDivide",t.rhs);case ci.UNI_PLUS:return Kx(e,"opUniPlus",t.rhs);case ci.UNI_MINUS:return Kx(e,"opUniMinus",t.rhs)}return ct(t,"")}function Uj(t){if(t.type===Ne.OPERATOR){const e=t.lhs?ht(t.lhs):ct(t,"");return t.items.forEach(r=>Mj(r,e)),e}return ct(t,"")}function wu(t,e){return ct(t,[er(t,"jump",[`${e}`]),"; continue;"])}function Ii(t){return Kr.linelookup[t??""]??-1}function v0(t,e){Kr.linelookup[t]=e}function Mo(t,e,r){for(let n=0;n<t.length;++n){const i=t[n];switch(i.type){case Ne.WHILE:case Ne.REPEAT:case Ne.FOREACH:case Ne.ELSE_IF:i.type===e&&(i.done=r);break;case Ne.IF_BLOCK:case Ne.IF_CHECK:i.type===e&&(i.skip=r);break;case Ne.LINE:Mo(i.stmts,e,r);break}}}function qx(t,e,r){for(let n=0;n<t.length;++n){const i=t[n];switch(i.type){case Ne.WHILE:case Ne.REPEAT:case Ne.FOREACH:case Ne.ELSE_IF:i.type===e&&v0(i.done,r);break;case Ne.IF_BLOCK:case Ne.IF_CHECK:i.type===e&&v0(i.skip,r);break;case Ne.LINE:qx(i.stmts,e,r);break}}}function ht(t){switch(t.type){case Ne.PROGRAM:return ct(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(ht).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${_u}`]);case Ne.API:return ct(t,["  ",er(t,t.method,Za(t.words)),`;
`]);case Ne.LINE:return ct(t,[`case ${t.lineindex}:
`,...t.stmts.map(ht).flat(),`  break;
`]);case Ne.MARK:return ct(t,`  // ${t.comment}
`);case Ne.GOTO:{const e=Ii(t.id);return ct(t,["  ",wu(t,e),`
`])}case Ne.COUNT:return ct(t,`${t.index}`);case Ne.LITERAL:switch(t.literal){case yu.NUMBER:return ct(t,`${t.value}`);case yu.STRING:return ct(t,bu(t.value));case yu.TEMPLATE:return ct(t,w0(t.value))}return Gx(t);case Ne.TEXT:return ct(t,["  ",er(t,"text",[w0(t.value)]),`;
`]);case Ne.STAT:if(Kr.isfirststat){Kr.isfirststat=!1;const e=t.value.trim().split(" ").map(bu);return ct(t,["  ",er(t,"stat",e),`;
`])}return ct(t,`  // skipped ${t.value}
`);case Ne.LABEL:{const e=$e(t.name),r=t.active?"label":"comment";Kr.labels[e]||(Kr.labels[e]=[]);const n=(t.active?1:-1)*t.lineindex;return Kr.labels[e].push(n),ct(t,`  // ${n} '${e}' ${r}
`)}case Ne.HYPERLINK:return ct(t,["  ",er(t,"hyperlink",[w0(t.text),...t.link.split(" ").filter(e=>e.length>0).map(bu)]),`;
`]);case Ne.MOVE:{const e=er(t,"command",[bu("go"),Za(t.words)].flat());return t.wait?ct(t,["  if (",e,`) { continue; };
`]):ct(t,["  ",e,`;
`])}case Ne.COMMAND:return ct(t,["  if (",er(t,"command",Za(t.words)),`) { continue; };
`]);case Ne.IF:{const e=t.block?.type===Ne.IF_BLOCK?t.block:void 0;if(v(e)){Mo([t.check],Ne.IF_CHECK,e.skip);const r=ct(t,ht(t.check));return e.lines.forEach(n=>r.add(ht(n))),qx(e.altlines,Ne.ELSE_IF,Ii(e.done)),e.altlines.forEach(n=>r.add(ht(n))),r}return ct(t,ht(t.check))}case Ne.IF_CHECK:{const e=Ii(t.skip);return e===-1?ct(t,["  ",er(t,t.method,Za(t.words)),`;
`]):ct(t,["  if (!",er(t,t.method,Za(t.words)),") { ",wu(t,e),` }
`])}case Ne.ELSE_IF:case Ne.ELSE:{const e=ct(t,"");return t.lines.forEach(r=>e.add(ht(r))),e}case Ne.WHILE:{const e=Ii(t.loop),r=Ii(t.done),n=ct(t,"");return Mo(t.lines,Ne.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ne.BREAK:i.goto=r;break;case Ne.CONTINUE:i.goto=e;break}n.add(ht(i))}),n}case Ne.REPEAT:{const e=Ii(t.loop),r=Ii(t.done),n=ct(t,"");return Mo(t.lines,Ne.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ne.BREAK:i.goto=r;break;case Ne.CONTINUE:i.goto=e;break}n.add(ht(i))}),n}case Ne.WAITFOR:{const e=ct(t,"");return Mo(t.lines,Ne.IF_CHECK,t.loop),t.lines.forEach(r=>{e.add(ht(r))}),e}case Ne.FOREACH:{const e=Ii(t.loop),r=Ii(t.done),n=ct(t,"");return Mo(t.lines,Ne.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ne.BREAK:i.goto=r;break;case Ne.CONTINUE:i.goto=e;break}n.add(ht(i))}),n}case Ne.BREAK:return ct(t,["  ",wu(t,t.goto),`
`]);case Ne.CONTINUE:return ct(t,["  ",wu(t,t.goto),`
`]);case Ne.OR:return er(t,"or",t.items.map(ht));case Ne.AND:return er(t,"and",t.items.map(ht));case Ne.NOT:return er(t,"not",t.items.map(ht));case Ne.COMPARE:return Lj(t);case Ne.OPERATOR:return Uj(t);case Ne.EXPR:return er(t,"expr",t.words.map(ht));default:return console.error("<unsupported node>",t.type,t),Gx(t)}}function li(t){if(v(t))switch(t.type===Ne.LINE&&++Kr.lineindex,t.lineindex=Kr.lineindex,t.type){case Ne.PROGRAM:t.lines.forEach(li);break;case Ne.LINE:t.stmts.forEach(li);break;case Ne.MARK:v0(t.id,t.lineindex);break;case Ne.IF:li(t.check),li(t.block);break;case Ne.IF_BLOCK:t.lines.forEach(li),t.altlines.forEach(li);break;case Ne.ELSE_IF:t.lines.forEach(li);break;case Ne.ELSE:case Ne.WHILE:case Ne.REPEAT:case Ne.FOREACH:case Ne.WAITFOR:t.lines.forEach(li);break;case Ne.MOVE:case Ne.COMMAND:case Ne.IF_CHECK:t.words.forEach(li);break}}function Fj(t){Kr.labels={},Kr.internal=1,Kr.lineindex=0,Kr.isfirststat=!0,li(t)}function Pj(t){return Fj(t),{...ht(t).toStringWithSourceMap({file:`${_u}.map`}),...Kr}}function Yx(t){return ut(t)?t.length>0?1:0:t??0}function Bj(t){return`${t}_chip`}function Vx(t=""){return`vm:${t??""}`}function $j(t,e,r){const n=Bj(t),i=qr(n);let s;const o=xn(Object.entries(r.labels??{}));(!ut(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(r.errors?.length??0)!==0?1:0);function a(l,u){k.words=u;const h=N5(e,l);return v(h)?h(c,u):l!=="send"?a("shortsend",[l,...u]):0}const c={halt(){Qj(n)},id(){return t},set(l,u){const[h,d]=L5(e,c,l,u);if(h)return d},get(l){const[u,h]=C5(e,c,l);if(u)return h},tick(l){const u=Te(i.ps)?i.ps:0,h=u%l===0;if(i.ps=u+1,h===!1)return!1;M5(e,c);const d=c.shouldtick();if(d){i.lc=0,i.ys=0,k.get=c.get;try{s?.(c)||(i.es=1)}catch(f){mt(le,k.elementfocus,"crash",f.message),i.es=1}}return U5(e,c),d},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Te(i.lc)?++i.lc>gs.HALT_AT_COUNT:!0},haslabel(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const[h,d]=i.lb[u];if(h===l)return(d.find(m=>Te(m)&&m>0)??0)>0}return!1},hm(){if(ut(i.mg)&&ut(i.lb)){const[l]=i.mg;if(v(l))for(let u=0;u<i.lb.length;++u){const[h,d]=i.lb[u];if(h===l)return d.find(f=>Te(f)&&f>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.shouldhalt()},send(l,u,h,d){le.emit(l,`${Vx(u)}:${h}`,d)},lock(l){i.lk=l},unlock(){i.lk=""},message(l){i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l){const d=h[1].findIndex(f=>f>0);if(d>=0&&v(h[1])){h[1][d]*=-1;break}}}},restore(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l)for(let d=0;d<h[1].length;d++)h[1][d]=Math.abs(h[1][d])}},getcase(){i.ec=Te(i.ec)?i.ec:1;const l=c.hm();if(l&&ut(i.mg)){const[,u,h,d]=i.mg;c.set("sender",h),v(u)&&c.set("arg",u),d&&(c.set("player",d),k.elementfocus=d),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=Te(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const u=HI.parse(l),[h]=u.filter(d=>d.fileName===_u);return{line:h?.lineNumber??0,column:h?.columnNumber??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},command(...l){if(l.length===0)return 0;const[u,...h]=l;return a($e(Ut(u)),h)},if(...l){const[u,h]=fe(l,0,[Z.ANY]),d=Yx(u);return d&&h<l.length&&c.command(...l.slice(h)),d?1:0},try(...l){const[,u]=fe(l,0,[Z.DIR]),h=c.command("go",...l);return h&&u<l.length&&c.command(...l.slice(u)),h?1:0},take(...l){const[u,h,d]=fe(l,0,[Z.NAME,Z.ANY]),f=Te(h),m=f?d:1,p=c.get(u),g=f?h:1;if(!Te(p))return m<l.length&&c.command(...l.slice(m)),1;const y=p-g;return y<0?(m<l.length&&c.command(...l.slice(m)),1):(c.set(u,y),0)},give(...l){const[u,h,d]=fe(l,0,[Z.NAME,Z.ANY]),f=Te(h),m=f?d:1,p=c.get(u),g=f?h:1,y=p===void 0?1:0;return y&&m<l.length&&c.command(...l.slice(m)),c.set(u,Ha(p,0)+g),y},duplicate(...l){return c.command("duplicate",...l)},repeatstart(l,...u){const[h,d]=fe(u,0,[Z.NUMBER]),f=`repeatcount${l}`,m=`repeatwords${l}`;i[f]=h,i[m]=d<u.length?u.slice(d):void 0},repeat(l){const u=`repeatcount${l}`,h=`repeatwords${l}`;if(!Te(i[u]))return 0;const d=i[u];i[u]=d-1;const f=d>0,m=i[h];return f&&ut(m)&&c.command(...m),f?1:0},foreachstart(l,...u){const[h,d,f,m]=fe(u,0,[Z.NAME,Z.NUMBER,Z.NUMBER,Z.MAYBE_NUMBER]);let p=Math.min(d,f),g=Math.max(d,f);const y=(m??0)||1;if(y<0){const b=p;p=g,g=b}return c.set(h,p-y),0},foreach(l,...u){const[h,d,f,m,p]=fe(u,0,[Z.NAME,Z.NUMBER,Z.NUMBER,Z.MAYBE_NUMBER]);let g=Math.min(d,f),y=Math.max(d,f);const b=(m??0)||1;if(b<0){const x=g;g=y,y=x}let A=c.get(h);!Te(A)||A<g||A>y?A=g:A+=b;const S=A<=y?1:0;return S&&(c.set(h,A),p<u.length&&c.command(...u.slice(p))),S},waitfor(...l){const[u]=fe(l,0,[Z.ANY]),h=Yx(u);return h||c.yield(),h?1:0},or(...l){let u=0;for(let h=0;h<l.length;){const[d,f]=fe(l,h,[Z.ANY]);if(u=d,u)break;h=f}return u},and(...l){let u=0;for(let h=0;h<l.length;){const[d,f]=fe(l,h,[Z.ANY]);if(u=d,!u)break;h=f}return u},not(...l){const[u]=fe(l,0,[Z.ANY]);return u?0:1},expr(...l){const[u]=fe(l,0,[Z.ANY]);return u},isEq(l,u){const[h]=fe([l],0,[Z.ANY]),[d]=fe([u],0,[Z.ANY]);return typeof h=="object"||typeof d=="object"?DT(h,d)?1:0:h===d?1:0},isNotEq(l,u){return this.isEq(l,u)?0:1},isLessThan(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return h<d?1:0},isGreaterThan(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return h>d?1:0},isLessThanOrEq(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return h<=d?1:0},isGreaterThanOrEq(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return h>=d?1:0},opPlus(l,u){const[h]=fe([l],0,[Z.ANY]),[d]=fe([u],0,[Z.ANY]);return h+d},opMinus(l,u){const[h]=fe([l],0,[Z.ANY]),[d]=fe([u],0,[Z.ANY]);return h-d},opPower(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return Math.pow(h,d)},opMultiply(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return h*d},opDivide(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return h/d},opModDivide(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return h%d},opFloorDivide(l,u){const[h]=fe([l],0,[Z.NUMBER]),[d]=fe([u],0,[Z.NUMBER]);return Math.floor(h/d)},opUniPlus(l){const[u]=fe([l],0,[Z.NUMBER]);return+u},opUniMinus(l){const[u]=fe([l],0,[Z.NUMBER]);return-u}};return s=r.code,c}function E0(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(r=>{if(r!=="parent"){const n=t[r];ut(n)?n.forEach(i=>{e.push(E0(i))}):e.push(E0(n))}}),t.range={start:Math.min(...e.filter(r=>r).map(r=>r?.start??0)),end:Math.max(...e.filter(r=>r).map(r=>r?.end??0))},t.range}function Dj(t){const e=mE(`${t}
`);if(e.errors.length>0)return e;Lo.input=e.tokens;const r=Lo.program();if(Lo.errors.length>0)return{tokens:e.tokens,errors:Lo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[n]=Nj.go(r);return n?(E0(n),{tokens:e.tokens,cst:r,ast:n}):{tokens:e.tokens,cst:r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}function jj(t,e){const r=`compile-${t}`;console.time(r);const n=Dj(e);if(console.timeEnd(r),Py&&console.info(e,n.errors),n.errors&&n.errors.length>0)return console.info(e,n.tokens,n.errors),n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=Pj(n.ast);if(i.code){Py&&console.info(i.code);try{return{...n,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...n,...i,source:"",code:new Function("api"," ")}}function zj(){const t={},e={};function r(i,s){const o=t[s];if(o)return o;const a=jj(i,s);return t[s]=a,a}const n={ids(){return Object.keys(e)},isended(i){const s=e[i];return v(s)?s.isended():!0},halt(i){const s=e[i];return v(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=n.ids();for(let s=0;s<i.length;++s)n.isended(i[s])&&n.halt(i[s])},arg(i,s){const o=e[i];v(o)&&o.set("arg",s)},tick(i,s,o,a,c){let l=e[i];if(!v(e[i])){const u=r(a,c);if(l=e[i]=$j(i,s,u),u.errors?.length){const[h]=u.errors,d=(h?.line??2)-1,f=c.replaceAll(`\r
`,"").split(`
`).map((A,S)=>[A,S]),m=f.slice(d-2,d);for(let A=0;A<m.length;++A){const[S,x]=m[A];mt(le,wr(),"build",`$grey${x+1} $grey${S}`)}const[p,g]=f[d]??[];if(be(p)&&v(g)){const A=(h.column??1)-1,S=A+h.length,x=A<p.length?p:`${p}*`,B=x.substring(0,A),I=x.substring(A,S),U=x.substring(S);mt(le,wr(),"build",`$red${g+1} $grey${B}$red${I}$grey${U}`)}const y=f.slice(d+1,d+3);for(let A=0;A<y.length;++A){const[S,x]=y[A];mt(le,wr(),"build",`$grey${x+1} $grey${S}`)}const b=h.message.split(`
`).slice(0,4).join(" ");return mt(le,wr(),"build",b),!1}}return!!l?.tick(o)},once(i,s,o,a){const c=n.tick(i,s,1,o,a);return n.halt(i)&&c},message(i){const{target:s,path:o}=Fr(i.target),a=e[s];if(v(a)){const c={...i,target:o};a.message(c)}}};return n}const Ar=new la,Cr={},vu={};function Xx(t,e,r,n,i,s=0){const o=`tiles:${t}:${e}`;return v(Cr[o])||(Cr[o]=qI(t,e,r,n,i,s)),Cr[o]}function Zx(t,e,r,n){const i=`sprites:${t}:${e}:${r}`,s=`sprite:${t}:${e}:${n}`;return v(vu[s])||(vu[s]=YI(t,e,r)),vu[s].id=i,vu[s]}function Wj(t,e){const r=`sprites:${t}:${e}`;return v(Cr[r])||(Cr[r]=VI(t,e)),Cr[r]}function Hj(t,e,r,n,i=0){const s=`dither:${t}:${e}`;return v(Cr[s])||(Cr[s]=XI(t,e,r,n,i)),Cr[s]}function Eu(t,e,r,n){const i=`media:${t}:${e}`;v(Cr[i])||(Cr[i]=ZI(t,e,r,n));const s=Cr[i];return s.mime=r,s.media=n,s}function Gj(t,e){const r=`control:${t}:${e}`;return v(Cr[r])||(Cr[r]=JI(t,e)),Cr[r]}const Vi=3;function Jx(t,e){const r=[],n=(t.x+.5)*ps,i=(t.y+.5)*ms,s=e.x*ps,o=e.y*ms,a=s-n,c=o-i;Ar.x=a-Vi,Ar.y=c-Vi,r.push(Ar.angle()),Ar.x=a+ps+Vi,Ar.y=c-Vi,r.push(Ar.angle()),Ar.x=a-Vi,Ar.y=c+ms+Vi,r.push(Ar.angle()),Ar.x=a+ps+Vi,Ar.y=c+ms+Vi,r.push(Ar.angle());const l=r.map(f=>Math.round(xy(f))),u=Math.min(...l),h=Math.max(...l);if(h-u>180){const f=l.filter(y=>y<180),m=l.filter(y=>y>180),p=Math.max(...f);return[Math.min(...m),p]}return[u,h]}function ku(t,e,r,n,i,s,o,a,c){const l={x:a,y:c},u=Ni(t,l);if(u===-1)return;Ar.x=a-i.x,Ar.y=Math.round((c-i.y)*1.333);const h=Ar.length();if(h>s)return;const d=Math.round(xy(Ar.angle()));let f=0;for(let A=0;A<r.length;++A){const[S,x,B]=r[A];S>x?(d>=S||d<=x)&&(f=Math.max(f,B)):d>=S&&d<=x&&(f=Math.max(f,B))}const m=s*.5;e[u]=Math.min(e[u],f+(h<m?0:(h-m)*o)),e[u]=$t(e[u],0,1);const p=hr(t,t.lookup?.[u]??"");if(v(p)){const A=[...Jx(i,l),.25];n.push(A)}const g=t.terrain[u],y=vn(g),b=g?.collision??y?.collision;if(Qa(We.ISBULLET,b)){const A=[...Jx(i,l),1];n.push(A)}}function k0(t,e,r,n,i,s){if(!v(r)||!v(r.terrain)||!v(r.objects))return[];const o=[];let a=e;const c=Ce,l=et,u=s?Ke.BLACK:Ke.ONCLEAR,h=Xx(t,a++,"terrain",c,l,u);o.push(h);const d=a++,f=Wj(t,d);f.sprites=[],o.push(f);const m=r.isdark?1:0,p=Hj(t,a++,c,l,m);o.push(p),p.alphas.fill(m);const g=Xx(t,a++,"tickers",c,l,Ke.ONCLEAR);o.push(g),g.char.fill(0);const y={...Vd(Ce,et,n,Ke.ONCLEAR),...g},b=Gj(t,a++);if(i){o.push(b);const{graphics:U,camera:$,facing:j}=qr(t),q=r.graphics??U??"",R=r.camera??$??"",O=r.facing??j??"";if(be(q)){const w=$e(q);switch(w){case"fpv":case"iso":case"flat":case"mode7":b.graphics=w;break;default:b.graphics="flat";break}}if(be(R))switch($e(R)){default:case"mid":b.viewscale=Zc.MID;break;case"near":b.viewscale=Zc.NEAR;break;case"far":b.viewscale=Zc.FAR;break}Te(O)&&(b.facing=ky(O%360))}for(let U=0;U<r.terrain.length;++U){const $=r.terrain[U],j=ar($,0,Ke.WHITE,s?Ke.BLACK:Ke.ONCLEAR),q=He($,"collision");h.char[U]=j.char,h.color[U]=j.color,h.bg[U]=j.bg,h.wall[U]=q===We.ISSOLID?1:0}const A=Object.values(r.objects??{}),S=new Set;for(let U=0;U<A.length;++U){const $=A[U];gr($.id)&&Te($.x)&&Te($.y)&&S.add(Pr($,Ce))}for(let U=0;U<A.length;++U){const $=A[U],j=He($,"collision");if(v($.removed)||j===We.ISGHOST)continue;const q=$.id??"";if(gr(q)===!1&&Te($.x)&&Te($.y)&&S.has(Pr($,Ce))===!0)continue;const R=ar($),O=Zx(t,d,q,U);if(O.x=$.x??0,O.y=$.y??0,O.char=R.char,O.color=R.color,O.bg=R.bg,f.sprites.push(O),m){if(R.light>0){const w=Ni(r,O),C=$t(Math.round(R.light),1,et),W=1/(C*.5);if(p.alphas[w]=0,C>1){const P=[];for(let V=1;V<=C;++V){if(V===2){const L=He($,"lightdir");if(en(L)){const F=Po(r,$,"",L,O);switch(In(O,F.destpt)){case Ee.EAST:P.push([45,315,1]);break;case Ee.WEST:P.push([225,135,1]);break;case Ee.NORTH:P.push([315,225,1]);break;case Ee.SOUTH:P.push([135,45,1]);break}}}const J=[];for(let L=O.y-V;L<=O.y+V;++L)ku(r,p.alphas,P,J,O,C,W,O.x-V,L),ku(r,p.alphas,P,J,O,C,W,O.x+V,L);const N=V-1;for(let L=O.x-N;L<=O.x+N;++L)ku(r,p.alphas,P,J,O,C,W,L,O.y-V),ku(r,p.alphas,P,J,O,C,W,L,O.y+V);for(let L=0;L<J.length;++L){const F=J[L];let Y=0;for(Y=0;Y<P.length;++Y){const K=P[Y];if(K[1]>K[0]&&F[1]>=K[0]&&F[0]<=K[1]&&F[2]>=1&&K[2]>=1){P[Y]=[Math.min(F[0],K[0]),Math.max(F[1],K[1]),1];break}}Y===P.length&&P.push(F)}}}}else if(gr(q)){const w=Ni(r,O);p.alphas[w]=0}}q===t&&(b.focusx=O.x,b.focusy=O.y,b.focusid=q)}for(let U=0;U<A.length;++U){const $=A[U],j=He($,"collision");if(v($.removed)||j!==We.ISGHOST)continue;const q=$.id??"",R=ar($),O=Zx(t,d,q,U);O.x=$.x??0,O.y=$.y??0,O.char=R.char,O.color=R.color,O.bg=R.bg,f.sprites.push(O)}for(let U=0;U<A.length;++U){const $=A[U];if(be($.tickertext)&&Te($.tickertime)&&$.tickertext.length){const j=Ce,R=PE($.tickertext,j,et-1)?.measuredwidth??1,O=$.x??0,w=$.y??0,C=w<et*.5;y.x=O-Math.floor(R*.5),y.y=w+(C?2:-2),y.x+R>Ce&&(y.x=Ce-R),y.x<0&&(y.x=0);const W={x:y.x,y:y.y};FE($.tickertext,y,!0);for(let P=0;P<R;++P){const V=Pr({x:W.x+P,y:W.y},Ce);p.alphas[V]=Math.max(p.alphas[V],.666)}}}o.push(Eu(t,a++,"text/mood",m?"dark":"bright"));const x=dt(Ze.MAIN),B=Ti(x,Ze.MAIN);if(be(B.palette)){const U=ur(Re.PALETTE,B.palette),$=At(U);v($?.bits)&&o.push(Eu(t,a++,"image/palette",Array.from($.bits)))}if(be(B.charset)){const U=ur(Re.CHARSET,B.charset),$=At(U);v($?.bits)&&o.push(Eu(t,a++,"image/charset",Array.from($.bits)))}const I=Object.keys(r.objects).filter(gr);return o.push(Eu(t,a++,"text/players",I.join(","))),o}const sn=zj();var Ze=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Ze||{});const kt={halt:!1,session:Ft(),operator:"",software:{main:"",content:""},books:new Map,loaders:new Map};function Kj(){return kt.session}function wr(){return kt.operator}function qj(t){kt.operator=t}function Yj(t){kt.halt=t}function Vj(){return kt.halt}function wn(){return[...kt.books.values()]}function Xj(){const[t]=kt.books.values();return t}function x0(){const t=wn(),e=dt("main"),[r]=t.filter(n=>n.id!==e?.id);return r??e}function Bn(t){const e=$e(t);return kt.books.get(t)??wn().find(r=>r.name===e)}function Qx(t,e){v(Bn(e))&&(kt.software[t]=e)}function dt(t){return Bn(kt.software[t])}function eA(t){const e=Bd([]);return be(t)&&(e.name=t),xu(e),Pt(le,kt.operator,`created [book] ${e.name}`),e}function Zj(t){let e=Bn(t);return v(e)||(e=Bd([]),e.name=t),xu(e),Pt(le,kt.operator,`created [book] ${e.name}`),e}function lr(t,e){let r=v(e)?Zj(e):dt(t);return v(r)||(v(r)||(r=Xj()),v(r)||(r=eA(e)),v(r)&&Pt(le,kt.operator,`opened [book] ${r.name} for ${t}`)),Qx(t,r.id),r}function Xi(t,e,r){return jd(lr(t),r,e)}function ur(t,e){const r=dt("main"),n=hn(wE(r,t,e));if(v(n))return n;const i=wn();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==r?.id){const a=hn(wE(o,t,e));if(v(a))return a}}}function vn(t){if(v(t?.kinddata))return t.kinddata;if(!be(t?.kind)||!t.kind)return;const e=ur(Re.OBJECT,t.kind);if(v(e))return t.kinddata=At(e),t.kinddata;const r=ur(Re.TERRAIN,t.kind);if(v(r))return t.kinddata=At(r),t.kinddata}function He(t,e){const r=t?.kinddata,n=r?.id??"",i=t?.[e];if(v(i))return i;const s=r?.[e];if(v(s))return s;const o=ur(Re.OBJECT,n)??ur(Re.TERRAIN,n),a=aF(o,e);if(v(a))return a;switch(e){case"group":return"";case"cycle":return Sm;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return We.ISWALK;default:return}}function A0(t,e){const r={x:t?.x??-1,y:t?.y??-1},n={x:e?.x??-1,y:e?.y??-1},i=In(r,n),s=He(e,"pushable");return Te(s)?s!==0:be(s)?s.trim().split(" ").map(o=>Ry(Wc(o))).some(o=>o===i):!1}function on(t,e,r,n){if(!v(t)||!v(e))return;const[i,s]=e,o=ur(Re.OBJECT,i);if(v(o)){const c=I0(t,r,i,n);if(v(c))return _a(c,s),vn(c),He(c,"collision")!==We.ISGHOST&&(AE(t,c),zd(t,c)),c}const a=ur(Re.TERRAIN,i);if(v(a)){const c=_z(t,r,i);if(v(c)){_a(c,s),vn(c);const l=Pr(r,Ce);return zd(t,c,l),c}}}function Jj(t,e,r){if(!v(t)||!v(e))return;const[n,i]=e,s=ur(Re.OBJECT,n);if(v(s)){const o=I0(t,r,n);return _a(o,i),o}}function fr(t){const e=ur(Re.BOARD,t);return At(e)}function qr(t){const e=lr("main");return Ti(e,t)}function tA(t){const e=lr("main");return uF(e,t)}function rA(){const t=lr("main");return Ti(t,"main")}function Qj(t){const e=lr("main");return kE(e,t)}function ez(t,e){kt.books.clear(),t.forEach(n=>{kt.books.set(n.id,n),n.name==="main"&&(kt.software.main=n.id)});const r=Bn(e);if(v(r)&&(kt.software.main=r.id),!kt.software.main){const n=kt.books.values().next();n.value&&(kt.software.main=n.value.id)}}function xu(t){return kt.books.set(t.id,t),t.id}function tz(t){const e=Bn(t);e&&kt.books.delete(e.id)}function nA(t){if(!be(t)||!t)return mt(le,t,"login",`failed for playerid ==>${t}<==`);const e=dt("main");if(!v(e))return mt(le,t,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${t}<==`);let r=Ht(t);if(v(r?.objects[t]))return!0;if(!v(r)){const l=ur(Re.BOARD,"title");r=At(l)}if(!v(r))return mt(le,t,"login:title","login failed to find board with 'title' stat");const n=ur(Re.OBJECT,"player");if(!v(n))return mt(le,t,"login:player","login failed to find object type 'player'");const i=r.startx??0,s=r.starty??0,o=Te(i)?i:Math.round(Ce*.5),a=Te(s)?s:Math.round(et*.5),c=I0(r,{x:o,y:a},"player",t);return v(c?.id)?(c.player=t,nu(e,t,r.id),!0):!1}function rz(t){const e=dt("main");if(!v(e))return;const r=[];for(let i=0;i<e.activelist.length;++i){const s=e.activelist[i];s.startsWith(t)&&r.push(s)}const n=Ht(t);for(let i=0;i<r.length;++i){const s=r[i];nu(e,s,""),eu(n,hr(n,s)),mA(n,s),sn.halt(s),kE(e,s)}}function Ht(t){const e=dt("main"),r=xE(e,t,"board"),n=ur(Re.BOARD,r);return At(n)}function nz(t){const e=dt("main"),r=_F(e,t),n=Ht(t),i=hr(n,t);return r&&v(i)}function iz(t){const e=dt("main"),r=Ao(e);for(let n=0;n<r.length;++n){const i=r[n],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;gr(c)&&(nu(e,c,i.id),v(t[c])||(t[c]=0))}}}function iA(t){sn.message(t)}function Gt(t,e,r,n){if(be(r.id))if(be(e.id))Am(le,t,e.id,r.id,n);else{const i=`${Pr({x:e.x??0,y:e.y??0},Ce)}`;Am(le,t,i,r.id,n)}}function sz(t,e,r,n){const i=r.id??"";if(n.x<0){const s=fr(e?.exitwest??"");v(s)&&xo(t,i,s.id,{x:Ce-1,y:n.y})}else if(n.x>=Ce){const s=fr(e?.exiteast??"");v(s)&&xo(t,i,s.id,{x:0,y:n.y})}else if(n.y<0){const s=fr(e?.exitnorth??"");v(s)&&xo(t,i,s.id,{x:n.x,y:et-1})}else if(n.y>=et){const s=fr(e?.exitsouth??"");v(s)&&xo(t,i,s.id,{x:n.x,y:0})}}function $n(t,e,r,n){if(!v(r?.id))return!1;let i=TE(e,r,n);const s=He(r,"collision");if(v(i)&&s!==We.ISBULLET){const o=gr(r?.id),a=!!He(i,"item");if(A0(r,i)&&(!o||!a)){const l=In({x:r.x??0,y:r.y??0},n),u=Ct({x:i.x??0,y:i.y??0},l);$n(t,e,i,u)}i=TE(e,r,n)}if(v(i)){const o=gr(r.id),a=gr(r.party??r.id),c=He(r,"collision")===We.ISBULLET,l=r.kind??"";let u="";r.party&&a&&(u=r.party),o&&(u=r.id);const h=gr(i.id),d=gr(i.party??i.id),f=He(i,"collision")===We.ISBULLET,m=i.kind??"",p=a===d;let g="";if(i.party&&d&&(g=i.party),h&&(g=i.id??""),o&&m==="edge")sz(t,e,r,n);else if(o)h?(Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"bump")):f?(Gt(p?"":g,i,r,p?"partyshot":"shot"),Gt(u,r,i,"thud")):(Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"touch"));else if(c)if(h)Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,p?"partyshot":"shot");else if(f)Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"thud");else switch(Gt(p?"":g,i,r,"thud"),m){case"object":case"scroll":Gt(p?"":u,r,i,"shot");break;default:Gt(p?"":u,r,i,p?"partyshot":"shot");break}else if(h)Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"bump");else if(f){switch(l){case"object":case"scroll":Gt(p?"":u,r,i,"shot");break;default:Gt(p?"":u,r,i,p?"partyshot":"shot");break}Gt(p?"":u,r,i,"thud")}else Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"bump");if(c&&He(i,"breakable"))if(v(i?.id)){const y=it(e,{x:i.x??-1,y:i.y??-1});v(y)&&dr(k.board,y,k.timestamp)}else St(e,{x:n.x,y:n.y});return!1}return!0}function sA(t,e,r,n){if(!v(t)||!v(e)||!v(r))return;const i={...k};k.book=t,k.board=e,k.element=r,k.elementid=r.id??"",k.elementisplayer=gr(k.elementid);const s=k.element.player??kt.operator;k.elementfocus=k.elementisplayer?k.elementid:s;const o=He(r,"cycle"),a=r.id??"",c=$e(r.name??r.kinddata?.name??"");if(sn.tick(a,Yi.RUNTIME,o,c,n),Te(r?.tickertime)&&k.timestamp-r.tickertime>fc*5&&(r.tickertime=0,r.tickertext=""),k.elementisplayer){const l=qr(k.elementid);Te(l.inputcurrent)&&(l.inputcurrent=0)}Mr(i).forEach(l=>{k[l]=i[l]})}function oz(t,e){kt.loaders.set(t,e)}function az(t){sn.halt(t)}function cz(){const t=sn.ids();for(let r=0;r<t.length;++r)sn.halt(t[r]);const e=dt("main");v(e)&&(e.flags={})}function lz(t=!1){const e=dt("main");if(!v(e))return;const r=e.timestamp+1,n=gs.HALT_AT_COUNT;gs.HALT_AT_COUNT=n*2,kt.loaders.forEach((s,o)=>{const a={...k};k.timestamp=e.timestamp,k.book=e,k.board=void 0,k.element=void 0,k.elementid=o,k.elementisplayer=!1,k.elementfocus=wr();const c=Z4(o);v(c)&&sn.arg(o,c),sn.tick(o,Yi.LOADER,1,"loader",s),sn.isended(o)&&(sn.halt(o),kt.loaders.delete(o)),Mr(a).forEach(l=>{k[l]=a[l]})}),gs.HALT_AT_COUNT=n,e.timestamp=r,k.timestamp=r;const i=Ao(e);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)vn(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];vn(o.objects[u])}const c=mF(o,r);for(let l=0;l<c.length;++l){const{id:u,type:h,code:d,object:f}=c[l];h===Re.ERROR?sn.halt(u):(!t||gr(f?.id??""))&&sA(e,o,f,d)}}}function Uo(t,e,r,n){const i=dt("main");if(!v(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(v(c.id)){const l=`${Vx(c.id)}:${e}`;le.emit("",l,r)}}}if(ds(t)){for(let o=0;o<n.length;++o){const a=n[o],c=it(a,t);v(c)&&s([c])}return}for(let o=0;o<n.length;++o){const a=n[o];switch($e(t)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(lA(a,[t]));break}}}}function uz(t){const e=qr(t),r=e.playbuffer=be(e.playbuffer)?e.playbuffer:"";r&&oA(t,r,!1)}function oA(t,e,r=!0){const n=lr("main");if(!v(n))return;const i=`${t}_cli`;k.timestamp=n.timestamp,k.book=n,k.board=Ht(t),k.element=hr(k.board,t),k.elementid=k.element?.id??"",k.elementisplayer=!0,k.elementfocus=k.elementid||t;const s=gs.HALT_AT_COUNT;if(gs.HALT_AT_COUNT=s*8,sn.once(i,Yi.CLI,"cli",e),r){const o=qr(t);o.playbuffer=e}gs.HALT_AT_COUNT=s}function Au(t){const e=lr("main"),r=Ss(e,t);if(!v(e)||!v(r)||!v(k.element))return;const n={...k},i=`${t}_run`,s=$e(k.element.name??k.element.kinddata?.name??""),o=r?.code??"";sn.once(i,Yi.RUNTIME,s,o),Mr(n).forEach(a=>{k[a]=n[a]})}function fz(t,e){const r=dt("main"),n=Ht(t),i=[],s=[],o=[];if(!v(r)||!v(n))return{board:"",over:i,under:s,layers:o};const a=n.graphics??"flat",c=fr(n.overboard??""),l=fr(n.underboard??"");return s.push(...k0(t,0,l,e,!1,!0)),o.push(...k0(t,s.length,n,e,!0,a!=="flat")),i.push(...k0(t,s.length+o.length,c,e,!1,!1)),{board:n.id,over:i,under:s,layers:o}}function Bs(t){return ut(t)&&typeof t[0]=="string"}function hz(t){const e=k.words[t];return be(e)?[e,t+1]:[void 0,t]}function T0(t){const e=k.words[t];if(Bs(e))return[e,t+1];const[r,n]=Kc(t),[i,s]=hz(n);return be(i)&&(i==="empty"||vn({kind:i}))?[[i,r],s]:[void 0,t]}function Ja(t){if(!Bs(t))return;const[e]=t;return e}function Tu(t){if(!Bs(t))return;const[,e]=t,r=v(e)?Hc(e):void 0;return v(r)?r:void 0}function aA(t){if(!Bs(t))return;const[,e]=t,r=v(e)?Gc(e):void 0;return v(r)?dh(r):void 0}function Qa(t,e){const r=t??We.ISWALK,n=e??We.ISWALK;if(r===We.ISGHOST||n===We.ISGHOST)return!1;switch(r){case We.ISWALK:return n!==We.ISWALK;case We.ISSWIM:return n!==We.ISSWIM;case We.ISSOLID:return!0;case We.ISBULLET:return n!==We.ISWALK&&n!==We.ISSWIM}}function ec(t,e,r){const n=t?.objects[r];if(v(n))return n;const i=tc(t,"player");return v(e)?(e.x<0&&(e.x=fn(0,Ce-1)),e.y<0&&(e.y=fn(0,et-1)),uA(e,i)):hn(...i)}function tc(t,e){const r=t?.named?.[e];return v(r)?[...r.values()].map(i=>typeof i=="string"?t?.objects[i]:t?.terrain[i]).filter(v):[]}function dz(t){const e=[];for(let r=0;r<et;++r)for(let n=0;n<Ce;++n){const i={x:n,y:r},s=it(t,i);!s?.name&&!s?.kind&&e.push(i)}return e}function S0(t,e,r,n){if(!v(t))return!1;const i=ar(t);return!(v(e)&&e!==i.name||v(r)&&r!==i.color||v(n)&&n!==i.bg)}function Su(t,e){const r=Ja(e),n=Tu(e),i=aA(e);return tc(t,r??"").filter(s=>S0(s,r,n,i))}function cA(t,e){const r=v(e)?Hc(e):void 0,n=v(e)?Gc(e):void 0,i=[];if(v(t)){for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];v(a)&&S0(a,void 0,r,n)&&i.push(a)}const s=Object.values(t.objects);for(let o=0;o<s.length;++o){const a=s[o];S0(a,void 0,r,n)&&i.push(a)}}return i}function lA(t,e){return v(t)?e.map(r=>{if(typeof r=="string"){const n=t.objects[r];if(v(n))return n;const i=tc(t,$e(r));if(i.length)return i}else if(ds(r)&&r.x>=0&&r.x<Ce&&r.y>=0&&r.y<et){const n=r.x+r.y*Ce,i=t.lookup?.[n];return v(i)?t.objects[i]:t.terrain[n]}}).flat().filter(v):[]}function uA(t,e){let r=0,n;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(n===void 0||c<r)&&(r=c,n=s)}}return n}function pz(t,e,r,n){if(!v(t))return;v(t.distmaps)||(t.distmaps={});const i=`${e}.${r.x}.${r.y}.${n.x}.${n.y}`;let s=t.distmaps[i];if(!v(s)){s=new Array(ph).fill(-2);const o=[{...n}];let a=0;for(;o.length;){const c=o.shift();if(v(c)&&Fo(c)){const l=Pr(c,Ce);if(s[l]===-2){const u=Zi(t,c.x,c.y);Qa(e,He(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}t.distmaps[i]=s}return s}function fA(t,e){return Fo(t)?e[Pr(t,Ce)]:-1}function hA(t,e,r,n,i){if(!v(t))return;const s=pz(t,e,r,n);if(!v(s))return;const o=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=fA(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=fA(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function mz(){return new Array(Ce*et).map(()=>{})}function Ru(t=cf){const e={terrain:mz(),objects:{},id:""};return t(e)}var R0=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(R0||{});function gz(t){return po(t,R0,{terrain:e=>e.map(il),objects:e=>Object.values(e).filter(r=>!r.removed).map(il),id:Tt,named:Tt,lookup:Tt,codepage:Tt,distmaps:Tt,overboard:Tt,underboard:Tt})}function yz(t){return ya(t,R0,{terrain:e=>e.map(sl),objects:e=>{const r={};for(let n=0;n<e.length;++n){const i=sl(e[n]);v(i?.id)&&(r[i.id]=i)}return r}})}function Fo(t){return sh(t.x,t.y,0,Ce-1,et-1,0)}function Ni(t,e){return!v(t)||!v(e?.x)||!v(e?.y)||e.x<0||e.x>=Ce||e.y<0||e.y>=et?-1:e.x+e.y*Ce}function it(t,e){const r=Ni(t,e);if(r<0||!v(t?.lookup))return;const n=hr(t,t.lookup[r]??"");return v(n)?n:t.terrain[r]}function dA(t,e){const r=hr(t,e);if(v(r))return r;const n=parseFloat(e),i=xI(isNaN(n)?-1:n,Ce);return Zi(t,i.x,i.y)}function Zi(t,e,r){return(e>=0&&e<Ce)??(r>=0&&r<et)?t?.terrain[e+r*Ce]:void 0}function St(t,e){if(!v(t)||!v(e)||!v(e.x)||!v(e.y)||e.x<0||e.x>=Ce||e.y<0||e.y>=et)return;const r=xn(e),n=e.x+e.y*Ce;return t.terrain[n]=r,delete t.distmaps,t.terrain[n]}function O0(t,e){if(!v(t)||!v(e))return;const r=xn(e);return r.id=r.id??Ft(),t.objects[r.id]=r,t.objects[r.id]}function _z(t,e,r){return St(t,{...e,kind:r})}function I0(t,e,r,n){return O0(t,{...e,kind:r,id:n})}function hr(t,e){if(t)return t.objects[e]}function pA(t,e){const r=Ni(t,e);if(r<0||!v(t?.lookup))return;const n=hr(t,t.lookup[r]??"");if(v(n))return n}function dr(t,e,r){return!v(e)||ar(e).name==="player"?!1:(e.id?(e.removed=r,eu(t,e)):(St(t,{x:e?.x??0,y:e?.y??0}),hF(t,e)),!0)}function mA(t,e){return v(t?.objects[e])?(delete t.objects[e],!0):!1}function bz(t,e,r){if(!v(t)||!v(e))return;const n=t.objects[r];if(v(n))return n;if(ds(e))return uA(e,tc(t,"player"))}function Po(t,e,r,n,i){const s=Ee.MID;if(!v(t)||!v(e))return{dir:n,startpt:i,destpt:i,layer:s,targets:[]};const o={x:e.x??0,y:e.y??0},a={x:o.x+(e.stepx??0),y:o.y+(e.stepy??0)},c=In(o,a),l=Ce-1,u=et-1;for(let h=0;h<n.length;++h){const d=Ry(n[h]);switch(d){case Ee.IDLE:break;case Ee.NORTH:case Ee.SOUTH:case Ee.WEST:case Ee.EAST:Ct(o,d);break;case Ee.BY:{const[f,m]=n.slice(h+1);Te(f)&&Te(m)&&(o.x=$t(o.x+f,0,l),o.y=$t(o.y+m,0,u)),h+=2;break}case Ee.TO:{const[f,m]=n.slice(h+1);Te(f)&&Te(m)&&(o.x=$t(f,0,l),o.y=$t(m,0,u)),h+=2;break}case Ee.AT:{const[f,m]=n.slice(h+1);Te(f)&&Te(m)&&(o.x=$t(f,0,l),o.y=$t(m,0,u)),h+=2;break}case Ee.FLOW:Ct(o,c);break;case Ee.SEEK:{const f=bz(t,e,r);ds(f)&&Ct(o,In(i,f));break}case Ee.RNDNS:Ct(o,hn(Ee.NORTH,Ee.SOUTH));break;case Ee.RNDNE:Ct(o,hn(Ee.NORTH,Ee.EAST));break;case Ee.RND:Ct(o,hn(Ee.NORTH,Ee.SOUTH,Ee.WEST,Ee.EAST));break;case Ee.CW:case Ee.CCW:case Ee.OPP:case Ee.RNDP:{const f=Po(t,e,r,n.slice(h+1),i);switch(o.x=i.x,o.y=i.y,d){case Ee.CW:switch(In(i,f.destpt)){case Ee.NORTH:Ct(o,Ee.EAST);break;case Ee.SOUTH:Ct(o,Ee.WEST);break;case Ee.EAST:Ct(o,Ee.SOUTH);break;case Ee.WEST:Ct(o,Ee.NORTH);break}break;case Ee.CCW:switch(In(i,f.destpt)){case Ee.NORTH:Ct(o,Ee.WEST);break;case Ee.SOUTH:Ct(o,Ee.EAST);break;case Ee.EAST:Ct(o,Ee.NORTH);break;case Ee.WEST:Ct(o,Ee.SOUTH);break}break;case Ee.OPP:switch(In(i,f.destpt)){case Ee.NORTH:Ct(o,Ee.SOUTH);break;case Ee.SOUTH:Ct(o,Ee.NORTH);break;case Ee.EAST:Ct(o,Ee.WEST);break;case Ee.WEST:Ct(o,Ee.EAST);break}break;case Ee.RNDP:switch(In(i,f.destpt)){case Ee.NORTH:case Ee.SOUTH:o.x+=hn(-1,1);break;case Ee.WEST:case Ee.EAST:o.y+=hn(-1,1);break}break}return{dir:n,startpt:i,destpt:o,layer:s,targets:[]}}case Ee.FLEE:break;case Ee.AWAY:{const[f,m]=n.slice(h+1);if(Te(f)&&Te(m)){const p={x:$t(f,0,l),y:$t(m,0,u)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=He(e,"collision"),A=hA(t,b,o,p,!0);v(A)&&A.x!==f&&A.y!==m&&!pA(t,A)&&(o.x=A.x,o.y=A.y)}else{const b=fh(-g,-y);Ct(o,b)}}h+=2;break}case Ee.FIND:break;case Ee.TOWARD:{const[f,m]=n.slice(h+1);if(Te(f)&&Te(m)){const p={x:$t(f,0,l),y:$t(m,0,u)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=He(e,"collision"),A=hA(t,b,o,p,!1);v(A)&&A.x!==f&&A.y!==m&&!pA(t,A)&&(o.x=A.x,o.y=A.y)}else{const b=fh(g,y);Ct(o,b)}}h+=2;break}case Ee.OVER:case Ee.UNDER:{const f=Po(t,e,r,n.slice(h+1),i);return f.layer=d,f}case Ee.WITHIN:{const[f]=n.slice(h+1),m=Po(t,e,r,n.slice(h+2),i);if(m.targets.length===0&&Te(f)&&f>0)for(let p=-f;p<=f;++p)for(let g=-f;g<=f;++g){const y={x:m.destpt.x+g,y:m.destpt.y+p};Fo(y)&&m.targets.push(y)}return Te(f)&&f>0?{...m,targets:m.targets.filter(p=>ds(p)?py(p,m.destpt)<=f:!1)}:m}case Ee.AWAYBY:{const[f]=n.slice(h+1),m=Po(t,e,r,n.slice(h+2),i);if(m.targets.length===0)for(let p=-Ce;p<=Ce;++p)for(let g=-Ce;g<=Ce;++g){const y={x:m.destpt.x+g,y:m.destpt.y+p};Fo(y)&&m.targets.push(y)}return Te(f)&&f>0?{...m,targets:m.targets.filter(p=>ds(p)?py(p,m.destpt)>=f:!1)}:m}}}return{dir:n,startpt:i,destpt:o,layer:s,targets:[]}}const k={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var Z=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.COLOR_OR_KIND=7]="COLOR_OR_KIND",t[t.MAYBE_KIND=8]="MAYBE_KIND",t[t.MAYBE_NAME=9]="MAYBE_NAME",t[t.MAYBE_NUMBER=10]="MAYBE_NUMBER",t[t.MAYBE_STRING=11]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",t[t.ANY=13]="ANY",t))(Z||{});function pr(t,e,r){throw console.info(r,k.element,k.elementid,k.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function gA(t){const e={x:k.element?.x??0,y:k.element?.y??0};return Po(k.board,k.element,k.elementfocus,t,e)}function fe(t,e,r){const n=k.words;k.words=t;const i=[];let s=e;for(let o=0;o<r.length;++o)switch(r[o]){case 1:{const[a,c]=T0(s);Bs(a)?(s=c,i.push(a)):pr("kind",a,t);break}case 0:{if(ha(t[s])===void 0){const[a,c]=Nr(s);Tr(a)?(s=c,i.push(a)):Te(a)?(s=c,i.push(uo(a,void 0))):pr("color",a,t)}else{const[a,c]=Kc(s);Tr(a)?(s=c,i.push(a)):pr("color",a,t)}break}case 2:{if(Wc(t[s])===void 0){const[a,c]=Nr(s);en(a)?(s=c,i.push(gA(a))):pr("direction",a,t)}else{const[a,c]=Iy(s);en(a)?(s=c,i.push(gA(a))):pr("direction",a,t)}break}case 3:{const a=k.words[s];be(a)||pr("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Nr(s);if(be(a)){const l=parseFloat(a);Te(l)?i.push(l):pr("number",a,t)}else Te(a)?i.push(a):pr("number",a,t);s=c;break}case 5:{const[a,c]=Nr(s);be(a)||pr("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Nr(s);let l=a;if(be(l)){const u=parseFloat(l);Te(u)&&(l=u)}else Te(l)||pr("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=T0(s);if(Bs(a))s=c,i.push(a);else if(ha(t[s])===void 0){const[l,u]=Nr(s);Tr(l)?(s=u,i.push(l)):pr("color",l,t)}else{const[l,u]=Kc(s);Tr(l)?(s=u,i.push(l)):pr("color or kind",l,t)}break}case 8:{const[a,c]=T0(s);a!==void 0&&!Bs(a)&&pr("optional kind",a,t),s=c,i.push(a);break}case 9:{const a=k.words[s];a!==void 0&&!be(a)&&pr("optional string",a,t),++s,i.push(a);break}case 10:{const[a,c]=Nr(s);if(be(a)){const l=parseFloat(a);Te(l)?i.push(l):pr("optional number",a,t)}else Te(a)||a===void 0?i.push(a):pr("optional number",a,t);s=c;break}case 11:{const[a,c]=Nr(s);a!==void 0&&!be(a)&&pr("optional string",a,t),s=c,i.push(a);break}case 12:{const[a,c]=Nr(s);let l=a;if(be(l)){const u=parseFloat(l);Te(u)&&(l=u)}else l!==void 0&&!Te(l)&&pr("number or string",l,t);s=c,i.push(l);break}case 13:{const[a,c]=Nr(s);s=c,i.push(a);break}}return k.words=n,[...i,s]}const Ou={},Bo={};function N0(){return{id:Ft(),board:"",layers:[],scroll:[],sidebar:[]}}const wz=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),vz=new Set(["tx","text"]),Ez={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},yA={};let _A=t=>{let e=yA[t];return v(e)||(yA[t]=e=N0()),e};function kz(t){_A=t}function Rt(t){return _A(t)}function C0(t){return v(Ou[t])||(Ou[t]=[]),Ou[t]}function xz(t){const e=Rt(t);e.scrollname="",e.scroll=[]}function Az(t,e,r){Object.values(Bo).forEach(n=>{if(n[e]!==void 0){const i=Fy(t.id(),e);Te(r)&&vI(i,r),be(r)&&EI(i,r)}})}function tr(t){const e=C0(t);return Ou[t]=[],e}function bA(t){const e=[];let r;for(let n=0;n<t.length;++n){const i=t[n],s=be(i)&&v(SF(i));v(r)&&r!==s&&e.push(" "),e.push(i),r=s}return e}function Pe(t,e){C0(t).push(e)}function De(t,e,r,n,i=()=>0,s=cf){const o=[e,r,...n],a=$e(`${o[3]}`),c={...k};function l(u,h){v(h)&&h!==i(u)&&(k.board=c.board,k.element=c.element,k.elementfocus=c.elementfocus,s(u,h))}if(wz.has(a)){const u=`${o[2]}`;Bo[e]=Bo[e]??{};const h=i(u)??Ez[a];if(Bo[e][u]===void 0){const d=Fy(e,u);Te(h)&&wI(d,h),be(h)&&ih(d,h),vz.has(a)?Bo[e][u]=uy(d,f=>{l(u,f)}):Bo[e][u]=kI(d,f=>{l(u,f)})}}C0(t).push(o)}kz(t=>{if(gr(t)){const e=dt(Ze.MAIN),r=Ti(e,Ze.GADGETSTORE);let n=r[t];return v(n)||(r[t]=n=N0()),n}return N0()});let wA=0;function Tz(){switch(wA++){case 0:return Ke.BLUE;case 1:return Ke.BLACK;case 2:return Ke.GREEN;case 3:return Ke.BLACK;case 4:return Ke.CYAN;case 5:return Ke.BLACK;case 6:return Ke.RED;case 7:return Ke.BLACK;case 8:return Ke.PURPLE;case 9:return Ke.BLACK;case 10:return Ke.YELLOW;case 11:return Ke.BLACK;case 12:return Ke.WHITE;default:return wA=0,Ke.BLACK}}const L0=Ws("gadgetserver",["tock"],t=>{if(!L0.session(t))return;const e=dt(Ze.MAIN),r=[...e?.activelist??[],wr()],n=[...new Set(r.values())],i=Ti(e,Ze.GADGETSYNC);switch(t.target){case"tock":{const s=Tz();for(let o=0;o<n.length;++o){const a=n[o],{board:c,over:l,under:u,layers:h}=fz(a,s),d=Rt(a);d.board=c,d.over=l,d.under=u,d.layers=h;const f=i[a]??{},m=_m(f,d);m.length&&(i[a]=xn(d),eS(L0,a,m))}break}case"desync":QT(L0,t.player,Rt(t.player));break;case"clearscroll":xz(t.player);break;case"clearplayer":{const s=Ti(e,Ze.GADGETSTORE);delete s[t.player];const o=Ti(e,Ze.GADGETSYNC);delete o[t.player];break}}});function Iu(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var M0={exports:{}},vA;function Sz(){return vA||(vA=1,(function(t,e){(function(r){t.exports=r()})(function(){return(function r(n,i,s){function o(l,u){if(!i[l]){if(!n[l]){var h=typeof Iu=="function"&&Iu;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};n[l][0].call(f.exports,function(m){var p=n[l][1][m];return o(p||m)},f,f.exports,r,n,i,s)}return i[l].exports}for(var a=typeof Iu=="function"&&Iu,c=0;c<s.length;c++)o(s[c]);return o})({1:[function(r,n,i){var s=r("./utils"),o=r("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,f,m,p,g=[],y=0,b=c.length,A=b,S=s.getTypeOf(c)!=="string";y<c.length;)A=b-y,h=S?(l=c[y++],u=y<b?c[y++]:0,y<b?c[y++]:0):(l=c.charCodeAt(y++),u=y<b?c.charCodeAt(y++):0,y<b?c.charCodeAt(y++):0),d=l>>2,f=(3&l)<<4|u>>4,m=1<A?(15&u)<<2|h>>6:64,p=2<A?63&h:64,g.push(a.charAt(d)+a.charAt(f)+a.charAt(m)+a.charAt(p));return g.join("")},i.decode=function(c){var l,u,h,d,f,m,p=0,g=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|A):new Array(0|A);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(f=a.indexOf(c.charAt(p++)))>>2,h=(3&f)<<6|(m=a.indexOf(c.charAt(p++))),b[g++]=l,f!==64&&(b[g++]=u),m!==64&&(b[g++]=h);return b}},{"./support":30,"./utils":32}],2:[function(r,n,i){var s=r("./external"),o=r("./stream/DataWorker"),a=r("./stream/Crc32Probe"),c=r("./stream/DataLengthProbe");function l(u,h,d,f,m){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},n.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,i){var s=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,i){var s=r("./utils"),o=(function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c})();n.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(l,u,h,d){var f=o,m=d+h;l^=-1;for(var p=d;p<m;p++)l=l>>>8^f[255&(l^u[p])];return-1^l})(0|c,a,a.length,0):(function(l,u,h,d){var f=o,m=d+h;l^=-1;for(var p=d;p<m;p++)l=l>>>8^f[255&(l^u.charCodeAt(p))];return-1^l})(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(r,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,n,i){var s=null;s=typeof Promise<"u"?Promise:r("lie"),n.exports={Promise:s}},{lie:37}],7:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),a=r("./utils"),c=r("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,i){function s(f,m){var p,g="";for(p=0;p<m;p++)g+=String.fromCharCode(255&f),f>>>=8;return g}function o(f,m,p,g,y,b){var A,S,x=f.file,B=f.compression,I=b!==l.utf8encode,U=a.transformTo("string",b(x.name)),$=a.transformTo("string",l.utf8encode(x.name)),j=x.comment,q=a.transformTo("string",b(j)),R=a.transformTo("string",l.utf8encode(j)),O=$.length!==x.name.length,w=R.length!==j.length,C="",W="",P="",V=x.dir,J=x.date,N={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(N.crc32=f.crc32,N.compressedSize=f.compressedSize,N.uncompressedSize=f.uncompressedSize);var L=0;m&&(L|=8),I||!O&&!w||(L|=2048);var F=0,Y=0;V&&(F|=16),y==="UNIX"?(Y=798,F|=(function(Q,he){var xe=Q;return Q||(xe=he?16893:33204),(65535&xe)<<16})(x.unixPermissions,V)):(Y=20,F|=(function(Q){return 63&(Q||0)})(x.dosPermissions)),A=J.getUTCHours(),A<<=6,A|=J.getUTCMinutes(),A<<=5,A|=J.getUTCSeconds()/2,S=J.getUTCFullYear()-1980,S<<=4,S|=J.getUTCMonth()+1,S<<=5,S|=J.getUTCDate(),O&&(W=s(1,1)+s(u(U),4)+$,C+="up"+s(W.length,2)+W),w&&(P=s(1,1)+s(u(q),4)+R,C+="uc"+s(P.length,2)+P);var K="";return K+=`
\0`,K+=s(L,2),K+=B.magic,K+=s(A,2),K+=s(S,2),K+=s(N.crc32,4),K+=s(N.compressedSize,4),K+=s(N.uncompressedSize,4),K+=s(U.length,2),K+=s(C.length,2),{fileRecord:h.LOCAL_FILE_HEADER+K+U+C,dirRecord:h.CENTRAL_FILE_HEADER+s(Y,2)+K+s(q.length,2)+"\0\0\0\0"+s(F,4)+s(g,4)+U+C+q}}var a=r("../utils"),c=r("../stream/GenericWorker"),l=r("../utf8"),u=r("../crc32"),h=r("../signature");function d(f,m,p,g){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var m=f.meta.percent||0,p=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-g-1))/p:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var p=o(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,p=o(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:(function(g){return h.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)})(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-f,g=(function(y,b,A,S,x){var B=a.transformTo("string",x(S));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(b,4)+s(A,4)+s(B.length,2)+B})(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(p){m.processChunk(p)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var m=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var p=0;p<m.length;p++)try{m[p].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},n.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,i){var s=r("../compressions"),o=r("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var m=(function(b,A){var S=b||A,x=s[S];if(!x)throw new Error(S+" is not a valid compression method !");return x})(f.options.compression,c.compression),p=f.options.compressionOptions||c.compressionOptions||{},g=f.dir,y=f.date;f._compressWorker(m,p).withStreamInfo("file",{name:d,dir:g,date:y,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=r("./object")).loadAsync=r("./load"),s.support=r("./support"),s.defaults=r("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=r("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,i){var s=r("./utils"),o=r("./external"),a=r("./utf8"),c=r("./zipEntries"),l=r("./stream/Crc32Probe"),u=r("./nodejsUtils");function h(d){return new o.Promise(function(f,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(g){m(g)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(d,f){var m=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(p){var g=new c(f);return g.load(p),g}).then(function(p){var g=[o.Promise.resolve(p)],y=p.files;if(f.checkCRC32)for(var b=0;b<y.length;b++)g.push(h(y[b]));return o.Promise.all(g)}).then(function(p){for(var g=p.shift(),y=g.files,b=0;b<y.length;b++){var A=y[b],S=A.fileNameStr,x=s.resolve(A.fileNameStr);m.file(x,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:f.createFolders}),A.dir||(m.file(x).unsafeOriginalName=S)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,i){var s=r("../utils"),o=r("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,i){var s=r("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}r("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,i){n.exports={isNode:typeof Vt<"u",newBufferFrom:function(s,o){if(Vt.from&&Vt.from!==Uint8Array.from)return Vt.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Vt(s,o)},allocBuffer:function(s){if(Vt.alloc)return Vt.alloc(s);var o=new Vt(s);return o.fill(0),o},isBuffer:function(s){return Vt.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(r,n,i){function s(x,B,I){var U,$=a.getTypeOf(B),j=a.extend(I||{},u);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(x=y(x)),j.createFolders&&(U=g(x))&&b.call(this,U,!0);var q=$==="string"&&j.binary===!1&&j.base64===!1;I&&I.binary!==void 0||(j.binary=!q),(B instanceof h&&B.uncompressedSize===0||j.dir||!B||B.length===0)&&(j.base64=!1,j.binary=!0,B="",j.compression="STORE",$="string");var R=null;R=B instanceof h||B instanceof c?B:m.isNode&&m.isStream(B)?new p(x,B):a.prepareContent(x,B,j.binary,j.optimizedBinaryString,j.base64);var O=new d(x,R,j);this.files[x]=O}var o=r("./utf8"),a=r("./utils"),c=r("./stream/GenericWorker"),l=r("./stream/StreamHelper"),u=r("./defaults"),h=r("./compressedObject"),d=r("./zipObject"),f=r("./generate"),m=r("./nodejsUtils"),p=r("./nodejs/NodejsStreamInputAdapter"),g=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var B=x.lastIndexOf("/");return 0<B?x.substring(0,B):""},y=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},b=function(x,B){return B=B!==void 0?B:u.createFolders,x=y(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:B}),this.files[x]};function A(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var B,I,U;for(B in this.files)U=this.files[B],(I=B.slice(this.root.length,B.length))&&B.slice(0,this.root.length)===this.root&&x(I,U)},filter:function(x){var B=[];return this.forEach(function(I,U){x(I,U)&&B.push(U)}),B},file:function(x,B,I){if(arguments.length!==1)return x=this.root+x,s.call(this,x,B,I),this;if(A(x)){var U=x;return this.filter(function(j,q){return!q.dir&&U.test(j)})}var $=this.files[this.root+x];return $&&!$.dir?$:null},folder:function(x){if(!x)return this;if(A(x))return this.filter(function($,j){return j.dir&&x.test($)});var B=this.root+x,I=b.call(this,B),U=this.clone();return U.root=I.name,U},remove:function(x){x=this.root+x;var B=this.files[x];if(B||(x.slice(-1)!=="/"&&(x+="/"),B=this.files[x]),B&&!B.dir)delete this.files[x];else for(var I=this.filter(function($,j){return j.name.slice(0,x.length)===x}),U=0;U<I.length;U++)delete this.files[I[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var B,I={};try{if((I=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");a.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var U=I.comment||this.comment||"";B=f.generateWorker(this,I,U)}catch($){(B=new c("error")).error($)}return new l(B,I.type||"string",I.mimeType)},generateAsync:function(x,B){return this.generateInternalStream(x).accumulate(B)},generateNodeStream:function(x,B){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(B)}};n.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,i){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,i){var s=r("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(r,n,i){var s=r("./Uint8ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,i){var s=r("./ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,i){var s=r("../utils"),o=r("../support"),a=r("./ArrayReader"),c=r("./StringReader"),l=r("./NodeBufferReader"),u=r("./Uint8ArrayReader");n.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,i){var s=r("./GenericWorker"),o=r("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,i){var s=r("./GenericWorker"),o=r("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(r,n,i){var s=r("../utils"),o=r("./ConvertWorker"),a=r("./GenericWorker"),c=r("../base64"),l=r("../support"),u=r("../external"),h=null;if(l.nodestream)try{h=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(g,y){var b=[],A=m._internalType,S=m._outputType,x=m._mimeType;m.on("data",function(B,I){b.push(B),p&&p(I)}).on("error",function(B){b=[],y(B)}).on("end",function(){try{var B=(function(I,U,$){switch(I){case"blob":return s.newBlob(s.transformTo("arraybuffer",U),$);case"base64":return c.encode(U);default:return s.transformTo(I,U)}})(S,(function(I,U){var $,j=0,q=null,R=0;for($=0;$<U.length;$++)R+=U[$].length;switch(I){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(q=new Uint8Array(R),$=0;$<U.length;$++)q.set(U[$],j),j+=U[$].length;return q;case"nodebuffer":return Vt.concat(U);default:throw new Error("concat : unsupported type '"+I+"'")}})(A,b),x);g(B)}catch(I){y(I)}b=[]}).resume()})}function f(m,p,g){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=g,s.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}f.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var g=this;return m==="data"?this._worker.on(m,function(y){p.call(g,y.data,y.meta)}):this._worker.on(m,function(){s.delay(p,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Vt<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,i){for(var s=r("./utils"),o=r("./support"),a=r("./nodejsUtils"),c=r("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):(function(m){var p,g,y,b,A,S=m.length,x=0;for(b=0;b<S;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<S&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),x+=g<128?1:g<2048?2:g<65536?3:4;for(p=o.uint8array?new Uint8Array(x):new Array(x),b=A=0;A<x;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<S&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),g<128?p[A++]=g:(g<2048?p[A++]=192|g>>>6:(g<65536?p[A++]=224|g>>>12:(p[A++]=240|g>>>18,p[A++]=128|g>>>12&63),p[A++]=128|g>>>6&63),p[A++]=128|63&g);return p})(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):(function(m){var p,g,y,b,A=m.length,S=new Array(2*A);for(p=g=0;p<A;)if((y=m[p++])<128)S[g++]=y;else if(4<(b=l[y]))S[g++]=65533,p+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&p<A;)y=y<<6|63&m[p++],b--;1<b?S[g++]=65533:y<65536?S[g++]=y:(y-=65536,S[g++]=55296|y>>10&1023,S[g++]=56320|1023&y)}return S.length!==g&&(S.subarray?S=S.subarray(0,g):S.length=g),s.applyFromCharCode(S)})(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var m=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=(function(b,A){var S;for((A=A||b.length)>b.length&&(A=b.length),S=A-1;0<=S&&(192&b[S])==128;)S--;return S<0||S===0?A:S+l[b[S]]>A?S:A})(m),y=m;g!==m.length&&(o.uint8array?(y=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(y=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:i.utf8decode(y),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,i){var s=r("./support"),o=r("./base64"),a=r("./nodejsUtils"),c=r("./external");function l(p){return p}function u(p,g){for(var y=0;y<p.length;++y)g[y]=255&p.charCodeAt(y);return g}r("setimmediate"),i.newBlob=function(p,g){i.checkSupport("blob");try{return new Blob([p],{type:g})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(p,g,y){var b=[],A=0,S=p.length;if(S<=y)return String.fromCharCode.apply(null,p);for(;A<S;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(A,Math.min(A+y,S)))):b.push(String.fromCharCode.apply(null,p.subarray(A,Math.min(A+y,S)))),A+=y;return b.join("")},stringifyByChar:function(p){for(var g="",y=0;y<p.length;y++)g+=String.fromCharCode(p[y]);return g},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function d(p){var g=65536,y=i.getTypeOf(p),b=!0;if(y==="uint8array"?b=h.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return h.stringifyByChunk(p,y,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(p)}function f(p,g){for(var y=0;y<p.length;y++)g[y]=p[y];return g}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,g){if(g=g||"",!p)return g;i.checkSupport(p);var y=i.getTypeOf(g);return m[y][p](g)},i.resolve=function(p){for(var g=p.split("/"),y=[],b=0;b<g.length;b++){var A=g[b];A==="."||A===""&&b!==0&&b!==g.length-1||(A===".."?y.pop():y.push(A))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var g,y,b="";for(y=0;y<(p||"").length;y++)b+="\\x"+((g=p.charCodeAt(y))<16?"0":"")+g.toString(16).toUpperCase();return b},i.delay=function(p,g,y){setImmediate(function(){p.apply(y||null,g||[])})},i.inherits=function(p,g){function y(){}y.prototype=g.prototype,p.prototype=new y},i.extend=function(){var p,g,y={};for(p=0;p<arguments.length;p++)for(g in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],g)&&y[g]===void 0&&(y[g]=arguments[p][g]);return y},i.prepareContent=function(p,g,y,b,A){return c.Promise.resolve(g).then(function(S){return s.blob&&(S instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(S))!==-1)&&typeof FileReader<"u"?new c.Promise(function(x,B){var I=new FileReader;I.onload=function(U){x(U.target.result)},I.onerror=function(U){B(U.target.error)},I.readAsArrayBuffer(S)}):S}).then(function(S){var x=i.getTypeOf(S);return x?(x==="arraybuffer"?S=i.transformTo("uint8array",S):x==="string"&&(A?S=o.decode(S):y&&b!==!0&&(S=(function(B){return u(B,s.uint8array?new Uint8Array(B.length):new Array(B.length))})(S))),S):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./signature"),c=r("./zipEntry"),l=r("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===d;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=d-f;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./compressedObject"),c=r("./crc32"),l=r("./utf8"),u=r("./compressions"),h=r("./support");function d(f,m){this.options=f,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=(function(g){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===g)return u[y];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,p,g,y=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<y;)m=f.readInt(2),p=f.readInt(2),g=f.readData(p),this.extraFields[m]={id:m,length:p,value:g};f.setIndex(y)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var y=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(f.length-5))}return null}},n.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,i){function s(m,p,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=p,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=r("./stream/StreamHelper"),a=r("./stream/DataWorker"),c=r("./utf8"),l=r("./compressedObject"),u=r("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,g="string";try{if(!m)throw new Error("No output type specified.");var y=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(p=p.pipe(new c.Utf8EncodeWorker)),!b&&y&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(A){(p=new u("error")).error(A)}return new o(p,g,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(g,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var f=[];function m(){var p,g;a=!0;for(var y=f.length;y;){for(g=f,f=[],p=-1;++p<y;)g[p]();y=f.length}a=!1}n.exports=function(p){f.push(p)!==1||a||o()}}).call(this,typeof Ci<"u"?Ci:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,n,i){var s=r("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function d(y,b,A){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function f(y,b,A){s(function(){var S;try{S=b(A)}catch(x){return a.reject(y,x)}S===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,S)})}function m(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}function p(y,b){var A=!1;function S(I){A||(A=!0,a.reject(y,I))}function x(I){A||(A=!0,a.resolve(y,I))}var B=g(function(){b(x,S)});B.status==="error"&&S(B.value)}function g(y,b){var A={};try{A.value=y(b),A.status="success"}catch(S){A.status="error",A.value=S}return A}(n.exports=h).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(A){return b.resolve(y()).then(function(){return A})},function(A){return b.resolve(y()).then(function(){throw A})})},h.prototype.catch=function(y){return this.then(null,y)},h.prototype.then=function(y,b){if(typeof y!="function"&&this.state===l||typeof b!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?f(A,this.state===l?y:b,this.outcome):this.queue.push(new d(A,y,b)),A},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){f(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){f(this.promise,this.onRejected,y)},a.resolve=function(y,b){var A=g(m,b);if(A.status==="error")return a.reject(y,A.value);var S=A.value;if(S)p(y,S);else{y.state=l,y.outcome=b;for(var x=-1,B=y.queue.length;++x<B;)y.queue[x].callFulfilled(b)}return y},a.reject=function(y,b){y.state=c,y.outcome=b;for(var A=-1,S=y.queue.length;++A<S;)y.queue[A].callRejected(b);return y},h.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},h.reject=function(y){var b=new this(o);return a.reject(b,y)},h.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,S=!1;if(!A)return this.resolve([]);for(var x=new Array(A),B=0,I=-1,U=new this(o);++I<A;)$(y[I],I);return U;function $(j,q){b.resolve(j).then(function(R){x[q]=R,++B!==A||S||(S=!0,a.resolve(U,x))},function(R){S||(S=!0,a.reject(U,R))})}},h.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,S=!1;if(!A)return this.resolve([]);for(var x=-1,B=new this(o);++x<A;)I=y[x],b.resolve(I).then(function(U){S||(S=!0,a.resolve(B,U))},function(U){S||(S=!0,a.reject(B,U))});var I;return B}},{immediate:36}],38:[function(r,n,i){var s={};(0,r("./lib/utils/common").assign)(s,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,i){var s=r("./zlib/deflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/messages"),l=r("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(A!==h)throw new Error(c[A]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var S;if(S=typeof b.dictionary=="string"?a.string2buf(b.dictionary):u.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(A=s.deflateSetDictionary(this.strm,S))!==h)throw new Error(c[A]);this._dict_set=!0}}function g(y,b){var A=new p(b);if(A.push(y,!0),A.err)throw A.msg||c[A.err];return A.result}p.prototype.push=function(y,b){var A,S,x=this.strm,B=this.options.chunkSize;if(this.ended)return!1;S=b===~~b?b:b===!0?4:0,typeof y=="string"?x.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?x.input=new Uint8Array(y):x.input=y,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(B),x.next_out=0,x.avail_out=B),(A=s.deflate(x,S))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&A!==1);return S===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):S!==2||(this.onEnd(h),!(x.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=g,i.deflateRaw=function(y,b){return(b=b||{}).raw=!0,g(y,b)},i.gzip=function(y,b){return(b=b||{}).gzip=!0,g(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,i){var s=r("./zlib/inflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/constants"),l=r("./zlib/messages"),u=r("./zlib/zstream"),h=r("./zlib/gzheader"),d=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&(15&g.windowBits)==0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,g.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function m(p,g){var y=new f(g);if(y.push(p,!0),y.err)throw y.msg||l[y.err];return y.result}f.prototype.push=function(p,g){var y,b,A,S,x,B,I=this.strm,U=this.options.chunkSize,$=this.options.dictionary,j=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?I.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?I.input=new Uint8Array(p):I.input=p,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8(U),I.next_out=0,I.avail_out=U),(y=s.inflate(I,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&$&&(B=typeof $=="string"?a.string2buf($):d.call($)==="[object ArrayBuffer]"?new Uint8Array($):$,y=s.inflateSetDictionary(this.strm,B)),y===c.Z_BUF_ERROR&&j===!0&&(y=c.Z_OK,j=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&y!==c.Z_STREAM_END&&(I.avail_in!==0||b!==c.Z_FINISH&&b!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(I.output,I.next_out),S=I.next_out-A,x=a.buf2string(I.output,A),I.next_out=S,I.avail_out=U-S,S&&o.arraySet(I.output,I.output,A,S,0),this.onData(x)):this.onData(o.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(j=!0)}while((0<I.avail_in||I.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(b=c.Z_FINISH),b===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):b!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(I.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=m,i.inflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){var l,u,h,d,f,m;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(m=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)f=c[l],m.set(f,d),d+=f.length;return m}},a={arraySet:function(c,l,u,h,d){for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(r,n,i){var s=r("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",m=0;m<d;m++)f+=String.fromCharCode(h[m]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,m,p,g,y=h.length,b=0;for(p=0;p<y;p++)(64512&(f=h.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=h.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),b+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(b),p=g=0;g<b;p++)(64512&(f=h.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=h.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),f<128?d[g++]=f:(f<2048?d[g++]=192|f>>>6:(f<65536?d[g++]=224|f>>>12:(d[g++]=240|f>>>18,d[g++]=128|f>>>12&63),d[g++]=128|f>>>6&63),d[g++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,m=d.length;f<m;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,m,p,g,y=d||h.length,b=new Array(2*y);for(f=m=0;f<y;)if((p=h[f++])<128)b[m++]=p;else if(4<(g=c[p]))b[m++]=65533,f+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&f<y;)p=p<<6|63&h[f++],g--;1<g?b[m++]=65533:p<65536?b[m++]=p:(p-=65536,b[m++]=55296|p>>10&1023,b[m++]=56320|1023&p)}return u(b,m)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(r,n,i){n.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(r,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,i){var s=(function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a})();n.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(r,n,i){var s,o=r("../utils/common"),a=r("./trees"),c=r("./adler32"),l=r("./crc32"),u=r("./messages"),h=0,d=4,f=0,m=-2,p=-1,g=4,y=2,b=8,A=9,S=286,x=30,B=19,I=2*S+1,U=15,$=3,j=258,q=j+$+1,R=42,O=113,w=1,C=2,W=3,P=4;function V(T,ue){return T.msg=u[ue],ue}function J(T){return(T<<1)-(4<T?9:0)}function N(T){for(var ue=T.length;0<=--ue;)T[ue]=0}function L(T){var ue=T.state,ie=ue.pending;ie>T.avail_out&&(ie=T.avail_out),ie!==0&&(o.arraySet(T.output,ue.pending_buf,ue.pending_out,ie,T.next_out),T.next_out+=ie,ue.pending_out+=ie,T.total_out+=ie,T.avail_out-=ie,ue.pending-=ie,ue.pending===0&&(ue.pending_out=0))}function F(T,ue){a._tr_flush_block(T,0<=T.block_start?T.block_start:-1,T.strstart-T.block_start,ue),T.block_start=T.strstart,L(T.strm)}function Y(T,ue){T.pending_buf[T.pending++]=ue}function K(T,ue){T.pending_buf[T.pending++]=ue>>>8&255,T.pending_buf[T.pending++]=255&ue}function Q(T,ue){var ie,G,z=T.max_chain_length,ee=T.strstart,pe=T.prev_length,me=T.nice_match,se=T.strstart>T.w_size-q?T.strstart-(T.w_size-q):0,ye=T.window,Oe=T.w_mask,_e=T.prev,Be=T.strstart+j,pt=ye[ee+pe-1],Je=ye[ee+pe];T.prev_length>=T.good_match&&(z>>=2),me>T.lookahead&&(me=T.lookahead);do if(ye[(ie=ue)+pe]===Je&&ye[ie+pe-1]===pt&&ye[ie]===ye[ee]&&ye[++ie]===ye[ee+1]){ee+=2,ie++;do;while(ye[++ee]===ye[++ie]&&ye[++ee]===ye[++ie]&&ye[++ee]===ye[++ie]&&ye[++ee]===ye[++ie]&&ye[++ee]===ye[++ie]&&ye[++ee]===ye[++ie]&&ye[++ee]===ye[++ie]&&ye[++ee]===ye[++ie]&&ee<Be);if(G=j-(Be-ee),ee=Be-j,pe<G){if(T.match_start=ue,me<=(pe=G))break;pt=ye[ee+pe-1],Je=ye[ee+pe]}}while((ue=_e[ue&Oe])>se&&--z!=0);return pe<=T.lookahead?pe:T.lookahead}function he(T){var ue,ie,G,z,ee,pe,me,se,ye,Oe,_e=T.w_size;do{if(z=T.window_size-T.lookahead-T.strstart,T.strstart>=_e+(_e-q)){for(o.arraySet(T.window,T.window,_e,_e,0),T.match_start-=_e,T.strstart-=_e,T.block_start-=_e,ue=ie=T.hash_size;G=T.head[--ue],T.head[ue]=_e<=G?G-_e:0,--ie;);for(ue=ie=_e;G=T.prev[--ue],T.prev[ue]=_e<=G?G-_e:0,--ie;);z+=_e}if(T.strm.avail_in===0)break;if(pe=T.strm,me=T.window,se=T.strstart+T.lookahead,ye=z,Oe=void 0,Oe=pe.avail_in,ye<Oe&&(Oe=ye),ie=Oe===0?0:(pe.avail_in-=Oe,o.arraySet(me,pe.input,pe.next_in,Oe,se),pe.state.wrap===1?pe.adler=c(pe.adler,me,Oe,se):pe.state.wrap===2&&(pe.adler=l(pe.adler,me,Oe,se)),pe.next_in+=Oe,pe.total_in+=Oe,Oe),T.lookahead+=ie,T.lookahead+T.insert>=$)for(ee=T.strstart-T.insert,T.ins_h=T.window[ee],T.ins_h=(T.ins_h<<T.hash_shift^T.window[ee+1])&T.hash_mask;T.insert&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[ee+$-1])&T.hash_mask,T.prev[ee&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=ee,ee++,T.insert--,!(T.lookahead+T.insert<$)););}while(T.lookahead<q&&T.strm.avail_in!==0)}function xe(T,ue){for(var ie,G;;){if(T.lookahead<q){if(he(T),T.lookahead<q&&ue===h)return w;if(T.lookahead===0)break}if(ie=0,T.lookahead>=$&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+$-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),ie!==0&&T.strstart-ie<=T.w_size-q&&(T.match_length=Q(T,ie)),T.match_length>=$)if(G=a._tr_tally(T,T.strstart-T.match_start,T.match_length-$),T.lookahead-=T.match_length,T.match_length<=T.max_lazy_match&&T.lookahead>=$){for(T.match_length--;T.strstart++,T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+$-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart,--T.match_length!=0;);T.strstart++}else T.strstart+=T.match_length,T.match_length=0,T.ins_h=T.window[T.strstart],T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+1])&T.hash_mask;else G=a._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++;if(G&&(F(T,!1),T.strm.avail_out===0))return w}return T.insert=T.strstart<$-1?T.strstart:$-1,ue===d?(F(T,!0),T.strm.avail_out===0?W:P):T.last_lit&&(F(T,!1),T.strm.avail_out===0)?w:C}function ve(T,ue){for(var ie,G,z;;){if(T.lookahead<q){if(he(T),T.lookahead<q&&ue===h)return w;if(T.lookahead===0)break}if(ie=0,T.lookahead>=$&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+$-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),T.prev_length=T.match_length,T.prev_match=T.match_start,T.match_length=$-1,ie!==0&&T.prev_length<T.max_lazy_match&&T.strstart-ie<=T.w_size-q&&(T.match_length=Q(T,ie),T.match_length<=5&&(T.strategy===1||T.match_length===$&&4096<T.strstart-T.match_start)&&(T.match_length=$-1)),T.prev_length>=$&&T.match_length<=T.prev_length){for(z=T.strstart+T.lookahead-$,G=a._tr_tally(T,T.strstart-1-T.prev_match,T.prev_length-$),T.lookahead-=T.prev_length-1,T.prev_length-=2;++T.strstart<=z&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+$-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),--T.prev_length!=0;);if(T.match_available=0,T.match_length=$-1,T.strstart++,G&&(F(T,!1),T.strm.avail_out===0))return w}else if(T.match_available){if((G=a._tr_tally(T,0,T.window[T.strstart-1]))&&F(T,!1),T.strstart++,T.lookahead--,T.strm.avail_out===0)return w}else T.match_available=1,T.strstart++,T.lookahead--}return T.match_available&&(G=a._tr_tally(T,0,T.window[T.strstart-1]),T.match_available=0),T.insert=T.strstart<$-1?T.strstart:$-1,ue===d?(F(T,!0),T.strm.avail_out===0?W:P):T.last_lit&&(F(T,!1),T.strm.avail_out===0)?w:C}function ke(T,ue,ie,G,z){this.good_length=T,this.max_lazy=ue,this.nice_length=ie,this.max_chain=G,this.func=z}function Ae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*I),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*B+1)),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(U+1),this.heap=new o.Buf16(2*S+1),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*S+1),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Se(T){var ue;return T&&T.state?(T.total_in=T.total_out=0,T.data_type=y,(ue=T.state).pending=0,ue.pending_out=0,ue.wrap<0&&(ue.wrap=-ue.wrap),ue.status=ue.wrap?R:O,T.adler=ue.wrap===2?0:1,ue.last_flush=h,a._tr_init(ue),f):V(T,m)}function Me(T){var ue=Se(T);return ue===f&&(function(ie){ie.window_size=2*ie.w_size,N(ie.head),ie.max_lazy_match=s[ie.level].max_lazy,ie.good_match=s[ie.level].good_length,ie.nice_match=s[ie.level].nice_length,ie.max_chain_length=s[ie.level].max_chain,ie.strstart=0,ie.block_start=0,ie.lookahead=0,ie.insert=0,ie.match_length=ie.prev_length=$-1,ie.match_available=0,ie.ins_h=0})(T.state),ue}function je(T,ue,ie,G,z,ee){if(!T)return m;var pe=1;if(ue===p&&(ue=6),G<0?(pe=0,G=-G):15<G&&(pe=2,G-=16),z<1||A<z||ie!==b||G<8||15<G||ue<0||9<ue||ee<0||g<ee)return V(T,m);G===8&&(G=9);var me=new Ae;return(T.state=me).strm=T,me.wrap=pe,me.gzhead=null,me.w_bits=G,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=z+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+$-1)/$),me.window=new o.Buf8(2*me.w_size),me.head=new o.Buf16(me.hash_size),me.prev=new o.Buf16(me.w_size),me.lit_bufsize=1<<z+6,me.pending_buf_size=4*me.lit_bufsize,me.pending_buf=new o.Buf8(me.pending_buf_size),me.d_buf=1*me.lit_bufsize,me.l_buf=3*me.lit_bufsize,me.level=ue,me.strategy=ee,me.method=ie,Me(T)}s=[new ke(0,0,0,0,function(T,ue){var ie=65535;for(ie>T.pending_buf_size-5&&(ie=T.pending_buf_size-5);;){if(T.lookahead<=1){if(he(T),T.lookahead===0&&ue===h)return w;if(T.lookahead===0)break}T.strstart+=T.lookahead,T.lookahead=0;var G=T.block_start+ie;if((T.strstart===0||T.strstart>=G)&&(T.lookahead=T.strstart-G,T.strstart=G,F(T,!1),T.strm.avail_out===0)||T.strstart-T.block_start>=T.w_size-q&&(F(T,!1),T.strm.avail_out===0))return w}return T.insert=0,ue===d?(F(T,!0),T.strm.avail_out===0?W:P):(T.strstart>T.block_start&&(F(T,!1),T.strm.avail_out),w)}),new ke(4,4,8,4,xe),new ke(4,5,16,8,xe),new ke(4,6,32,32,xe),new ke(4,4,16,16,ve),new ke(8,16,32,32,ve),new ke(8,16,128,128,ve),new ke(8,32,128,256,ve),new ke(32,128,258,1024,ve),new ke(32,258,258,4096,ve)],i.deflateInit=function(T,ue){return je(T,ue,b,15,8,0)},i.deflateInit2=je,i.deflateReset=Me,i.deflateResetKeep=Se,i.deflateSetHeader=function(T,ue){return T&&T.state?T.state.wrap!==2?m:(T.state.gzhead=ue,f):m},i.deflate=function(T,ue){var ie,G,z,ee;if(!T||!T.state||5<ue||ue<0)return T?V(T,m):m;if(G=T.state,!T.output||!T.input&&T.avail_in!==0||G.status===666&&ue!==d)return V(T,T.avail_out===0?-5:m);if(G.strm=T,ie=G.last_flush,G.last_flush=ue,G.status===R)if(G.wrap===2)T.adler=0,Y(G,31),Y(G,139),Y(G,8),G.gzhead?(Y(G,(G.gzhead.text?1:0)+(G.gzhead.hcrc?2:0)+(G.gzhead.extra?4:0)+(G.gzhead.name?8:0)+(G.gzhead.comment?16:0)),Y(G,255&G.gzhead.time),Y(G,G.gzhead.time>>8&255),Y(G,G.gzhead.time>>16&255),Y(G,G.gzhead.time>>24&255),Y(G,G.level===9?2:2<=G.strategy||G.level<2?4:0),Y(G,255&G.gzhead.os),G.gzhead.extra&&G.gzhead.extra.length&&(Y(G,255&G.gzhead.extra.length),Y(G,G.gzhead.extra.length>>8&255)),G.gzhead.hcrc&&(T.adler=l(T.adler,G.pending_buf,G.pending,0)),G.gzindex=0,G.status=69):(Y(G,0),Y(G,0),Y(G,0),Y(G,0),Y(G,0),Y(G,G.level===9?2:2<=G.strategy||G.level<2?4:0),Y(G,3),G.status=O);else{var pe=b+(G.w_bits-8<<4)<<8;pe|=(2<=G.strategy||G.level<2?0:G.level<6?1:G.level===6?2:3)<<6,G.strstart!==0&&(pe|=32),pe+=31-pe%31,G.status=O,K(G,pe),G.strstart!==0&&(K(G,T.adler>>>16),K(G,65535&T.adler)),T.adler=1}if(G.status===69)if(G.gzhead.extra){for(z=G.pending;G.gzindex<(65535&G.gzhead.extra.length)&&(G.pending!==G.pending_buf_size||(G.gzhead.hcrc&&G.pending>z&&(T.adler=l(T.adler,G.pending_buf,G.pending-z,z)),L(T),z=G.pending,G.pending!==G.pending_buf_size));)Y(G,255&G.gzhead.extra[G.gzindex]),G.gzindex++;G.gzhead.hcrc&&G.pending>z&&(T.adler=l(T.adler,G.pending_buf,G.pending-z,z)),G.gzindex===G.gzhead.extra.length&&(G.gzindex=0,G.status=73)}else G.status=73;if(G.status===73)if(G.gzhead.name){z=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>z&&(T.adler=l(T.adler,G.pending_buf,G.pending-z,z)),L(T),z=G.pending,G.pending===G.pending_buf_size)){ee=1;break}ee=G.gzindex<G.gzhead.name.length?255&G.gzhead.name.charCodeAt(G.gzindex++):0,Y(G,ee)}while(ee!==0);G.gzhead.hcrc&&G.pending>z&&(T.adler=l(T.adler,G.pending_buf,G.pending-z,z)),ee===0&&(G.gzindex=0,G.status=91)}else G.status=91;if(G.status===91)if(G.gzhead.comment){z=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>z&&(T.adler=l(T.adler,G.pending_buf,G.pending-z,z)),L(T),z=G.pending,G.pending===G.pending_buf_size)){ee=1;break}ee=G.gzindex<G.gzhead.comment.length?255&G.gzhead.comment.charCodeAt(G.gzindex++):0,Y(G,ee)}while(ee!==0);G.gzhead.hcrc&&G.pending>z&&(T.adler=l(T.adler,G.pending_buf,G.pending-z,z)),ee===0&&(G.status=103)}else G.status=103;if(G.status===103&&(G.gzhead.hcrc?(G.pending+2>G.pending_buf_size&&L(T),G.pending+2<=G.pending_buf_size&&(Y(G,255&T.adler),Y(G,T.adler>>8&255),T.adler=0,G.status=O)):G.status=O),G.pending!==0){if(L(T),T.avail_out===0)return G.last_flush=-1,f}else if(T.avail_in===0&&J(ue)<=J(ie)&&ue!==d)return V(T,-5);if(G.status===666&&T.avail_in!==0)return V(T,-5);if(T.avail_in!==0||G.lookahead!==0||ue!==h&&G.status!==666){var me=G.strategy===2?(function(se,ye){for(var Oe;;){if(se.lookahead===0&&(he(se),se.lookahead===0)){if(ye===h)return w;break}if(se.match_length=0,Oe=a._tr_tally(se,0,se.window[se.strstart]),se.lookahead--,se.strstart++,Oe&&(F(se,!1),se.strm.avail_out===0))return w}return se.insert=0,ye===d?(F(se,!0),se.strm.avail_out===0?W:P):se.last_lit&&(F(se,!1),se.strm.avail_out===0)?w:C})(G,ue):G.strategy===3?(function(se,ye){for(var Oe,_e,Be,pt,Je=se.window;;){if(se.lookahead<=j){if(he(se),se.lookahead<=j&&ye===h)return w;if(se.lookahead===0)break}if(se.match_length=0,se.lookahead>=$&&0<se.strstart&&(_e=Je[Be=se.strstart-1])===Je[++Be]&&_e===Je[++Be]&&_e===Je[++Be]){pt=se.strstart+j;do;while(_e===Je[++Be]&&_e===Je[++Be]&&_e===Je[++Be]&&_e===Je[++Be]&&_e===Je[++Be]&&_e===Je[++Be]&&_e===Je[++Be]&&_e===Je[++Be]&&Be<pt);se.match_length=j-(pt-Be),se.match_length>se.lookahead&&(se.match_length=se.lookahead)}if(se.match_length>=$?(Oe=a._tr_tally(se,1,se.match_length-$),se.lookahead-=se.match_length,se.strstart+=se.match_length,se.match_length=0):(Oe=a._tr_tally(se,0,se.window[se.strstart]),se.lookahead--,se.strstart++),Oe&&(F(se,!1),se.strm.avail_out===0))return w}return se.insert=0,ye===d?(F(se,!0),se.strm.avail_out===0?W:P):se.last_lit&&(F(se,!1),se.strm.avail_out===0)?w:C})(G,ue):s[G.level].func(G,ue);if(me!==W&&me!==P||(G.status=666),me===w||me===W)return T.avail_out===0&&(G.last_flush=-1),f;if(me===C&&(ue===1?a._tr_align(G):ue!==5&&(a._tr_stored_block(G,0,0,!1),ue===3&&(N(G.head),G.lookahead===0&&(G.strstart=0,G.block_start=0,G.insert=0))),L(T),T.avail_out===0))return G.last_flush=-1,f}return ue!==d?f:G.wrap<=0?1:(G.wrap===2?(Y(G,255&T.adler),Y(G,T.adler>>8&255),Y(G,T.adler>>16&255),Y(G,T.adler>>24&255),Y(G,255&T.total_in),Y(G,T.total_in>>8&255),Y(G,T.total_in>>16&255),Y(G,T.total_in>>24&255)):(K(G,T.adler>>>16),K(G,65535&T.adler)),L(T),0<G.wrap&&(G.wrap=-G.wrap),G.pending!==0?f:1)},i.deflateEnd=function(T){var ue;return T&&T.state?(ue=T.state.status)!==R&&ue!==69&&ue!==73&&ue!==91&&ue!==103&&ue!==O&&ue!==666?V(T,m):(T.state=null,ue===O?V(T,-3):f):m},i.deflateSetDictionary=function(T,ue){var ie,G,z,ee,pe,me,se,ye,Oe=ue.length;if(!T||!T.state||(ee=(ie=T.state).wrap)===2||ee===1&&ie.status!==R||ie.lookahead)return m;for(ee===1&&(T.adler=c(T.adler,ue,Oe,0)),ie.wrap=0,Oe>=ie.w_size&&(ee===0&&(N(ie.head),ie.strstart=0,ie.block_start=0,ie.insert=0),ye=new o.Buf8(ie.w_size),o.arraySet(ye,ue,Oe-ie.w_size,ie.w_size,0),ue=ye,Oe=ie.w_size),pe=T.avail_in,me=T.next_in,se=T.input,T.avail_in=Oe,T.next_in=0,T.input=ue,he(ie);ie.lookahead>=$;){for(G=ie.strstart,z=ie.lookahead-($-1);ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[G+$-1])&ie.hash_mask,ie.prev[G&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=G,G++,--z;);ie.strstart=G,ie.lookahead=$-1,he(ie)}return ie.strstart+=ie.lookahead,ie.block_start=ie.strstart,ie.insert=ie.lookahead,ie.lookahead=0,ie.match_length=ie.prev_length=$-1,ie.match_available=0,T.next_in=me,T.input=se,T.avail_in=pe,ie.wrap=ee,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,n,i){n.exports=function(s,o){var a,c,l,u,h,d,f,m,p,g,y,b,A,S,x,B,I,U,$,j,q,R,O,w,C;a=s.state,c=s.next_in,w=s.input,l=c+(s.avail_in-5),u=s.next_out,C=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),f=a.dmax,m=a.wsize,p=a.whave,g=a.wnext,y=a.window,b=a.hold,A=a.bits,S=a.lencode,x=a.distcode,B=(1<<a.lenbits)-1,I=(1<<a.distbits)-1;e:do{A<15&&(b+=w[c++]<<A,A+=8,b+=w[c++]<<A,A+=8),U=S[b&B];t:for(;;){if(b>>>=$=U>>>24,A-=$,($=U>>>16&255)===0)C[u++]=65535&U;else{if(!(16&$)){if((64&$)==0){U=S[(65535&U)+(b&(1<<$)-1)];continue t}if(32&$){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}j=65535&U,($&=15)&&(A<$&&(b+=w[c++]<<A,A+=8),j+=b&(1<<$)-1,b>>>=$,A-=$),A<15&&(b+=w[c++]<<A,A+=8,b+=w[c++]<<A,A+=8),U=x[b&I];r:for(;;){if(b>>>=$=U>>>24,A-=$,!(16&($=U>>>16&255))){if((64&$)==0){U=x[(65535&U)+(b&(1<<$)-1)];continue r}s.msg="invalid distance code",a.mode=30;break e}if(q=65535&U,A<($&=15)&&(b+=w[c++]<<A,(A+=8)<$&&(b+=w[c++]<<A,A+=8)),f<(q+=b&(1<<$)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(b>>>=$,A-=$,($=u-h)<q){if(p<($=q-$)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(O=y,(R=0)===g){if(R+=m-$,$<j){for(j-=$;C[u++]=y[R++],--$;);R=u-q,O=C}}else if(g<$){if(R+=m+g-$,($-=g)<j){for(j-=$;C[u++]=y[R++],--$;);if(R=0,g<j){for(j-=$=g;C[u++]=y[R++],--$;);R=u-q,O=C}}}else if(R+=g-$,$<j){for(j-=$;C[u++]=y[R++],--$;);R=u-q,O=C}for(;2<j;)C[u++]=O[R++],C[u++]=O[R++],C[u++]=O[R++],j-=3;j&&(C[u++]=O[R++],1<j&&(C[u++]=O[R++]))}else{for(R=u-q;C[u++]=C[R++],C[u++]=C[R++],C[u++]=C[R++],2<(j-=3););j&&(C[u++]=C[R++],1<j&&(C[u++]=C[R++]))}break}}break}}while(c<l&&u<d);c-=j=A>>3,b&=(1<<(A-=j<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=b,a.bits=A}},{}],49:[function(r,n,i){var s=r("../utils/common"),o=r("./adler32"),a=r("./crc32"),c=r("./inffast"),l=r("./inftrees"),u=1,h=2,d=0,f=-2,m=1,p=852,g=592;function y(R){return(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(R){var O;return R&&R.state?(O=R.state,R.total_in=R.total_out=O.total=0,R.msg="",O.wrap&&(R.adler=1&O.wrap),O.mode=m,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(p),O.distcode=O.distdyn=new s.Buf32(g),O.sane=1,O.back=-1,d):f}function S(R){var O;return R&&R.state?((O=R.state).wsize=0,O.whave=0,O.wnext=0,A(R)):f}function x(R,O){var w,C;return R&&R.state?(C=R.state,O<0?(w=0,O=-O):(w=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?f:(C.window!==null&&C.wbits!==O&&(C.window=null),C.wrap=w,C.wbits=O,S(R))):f}function B(R,O){var w,C;return R?(C=new b,(R.state=C).window=null,(w=x(R,O))!==d&&(R.state=null),w):f}var I,U,$=!0;function j(R){if($){var O;for(I=new s.Buf32(512),U=new s.Buf32(32),O=0;O<144;)R.lens[O++]=8;for(;O<256;)R.lens[O++]=9;for(;O<280;)R.lens[O++]=7;for(;O<288;)R.lens[O++]=8;for(l(u,R.lens,0,288,I,0,R.work,{bits:9}),O=0;O<32;)R.lens[O++]=5;l(h,R.lens,0,32,U,0,R.work,{bits:5}),$=!1}R.lencode=I,R.lenbits=9,R.distcode=U,R.distbits=5}function q(R,O,w,C){var W,P=R.state;return P.window===null&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new s.Buf8(P.wsize)),C>=P.wsize?(s.arraySet(P.window,O,w-P.wsize,P.wsize,0),P.wnext=0,P.whave=P.wsize):(C<(W=P.wsize-P.wnext)&&(W=C),s.arraySet(P.window,O,w-C,W,P.wnext),(C-=W)?(s.arraySet(P.window,O,w-C,C,0),P.wnext=C,P.whave=P.wsize):(P.wnext+=W,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=W))),0}i.inflateReset=S,i.inflateReset2=x,i.inflateResetKeep=A,i.inflateInit=function(R){return B(R,15)},i.inflateInit2=B,i.inflate=function(R,O){var w,C,W,P,V,J,N,L,F,Y,K,Q,he,xe,ve,ke,Ae,Se,Me,je,T,ue,ie,G,z=0,ee=new s.Buf8(4),pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!R||!R.state||!R.output||!R.input&&R.avail_in!==0)return f;(w=R.state).mode===12&&(w.mode=13),V=R.next_out,W=R.output,N=R.avail_out,P=R.next_in,C=R.input,J=R.avail_in,L=w.hold,F=w.bits,Y=J,K=N,ue=d;e:for(;;)switch(w.mode){case m:if(w.wrap===0){w.mode=13;break}for(;F<16;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if(2&w.wrap&&L===35615){ee[w.check=0]=255&L,ee[1]=L>>>8&255,w.check=a(w.check,ee,2,0),F=L=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&L)<<8)+(L>>8))%31){R.msg="incorrect header check",w.mode=30;break}if((15&L)!=8){R.msg="unknown compression method",w.mode=30;break}if(F-=4,T=8+(15&(L>>>=4)),w.wbits===0)w.wbits=T;else if(T>w.wbits){R.msg="invalid window size",w.mode=30;break}w.dmax=1<<T,R.adler=w.check=1,w.mode=512&L?10:12,F=L=0;break;case 2:for(;F<16;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if(w.flags=L,(255&w.flags)!=8){R.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){R.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=L>>8&1),512&w.flags&&(ee[0]=255&L,ee[1]=L>>>8&255,w.check=a(w.check,ee,2,0)),F=L=0,w.mode=3;case 3:for(;F<32;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}w.head&&(w.head.time=L),512&w.flags&&(ee[0]=255&L,ee[1]=L>>>8&255,ee[2]=L>>>16&255,ee[3]=L>>>24&255,w.check=a(w.check,ee,4,0)),F=L=0,w.mode=4;case 4:for(;F<16;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}w.head&&(w.head.xflags=255&L,w.head.os=L>>8),512&w.flags&&(ee[0]=255&L,ee[1]=L>>>8&255,w.check=a(w.check,ee,2,0)),F=L=0,w.mode=5;case 5:if(1024&w.flags){for(;F<16;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}w.length=L,w.head&&(w.head.extra_len=L),512&w.flags&&(ee[0]=255&L,ee[1]=L>>>8&255,w.check=a(w.check,ee,2,0)),F=L=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(J<(Q=w.length)&&(Q=J),Q&&(w.head&&(T=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),s.arraySet(w.head.extra,C,P,Q,T)),512&w.flags&&(w.check=a(w.check,C,Q,P)),J-=Q,P+=Q,w.length-=Q),w.length))break e;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(J===0)break e;for(Q=0;T=C[P+Q++],w.head&&T&&w.length<65536&&(w.head.name+=String.fromCharCode(T)),T&&Q<J;);if(512&w.flags&&(w.check=a(w.check,C,Q,P)),J-=Q,P+=Q,T)break e}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(J===0)break e;for(Q=0;T=C[P+Q++],w.head&&T&&w.length<65536&&(w.head.comment+=String.fromCharCode(T)),T&&Q<J;);if(512&w.flags&&(w.check=a(w.check,C,Q,P)),J-=Q,P+=Q,T)break e}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;F<16;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if(L!==(65535&w.check)){R.msg="header crc mismatch",w.mode=30;break}F=L=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),R.adler=w.check=0,w.mode=12;break;case 10:for(;F<32;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}R.adler=w.check=y(L),F=L=0,w.mode=11;case 11:if(w.havedict===0)return R.next_out=V,R.avail_out=N,R.next_in=P,R.avail_in=J,w.hold=L,w.bits=F,2;R.adler=w.check=1,w.mode=12;case 12:if(O===5||O===6)break e;case 13:if(w.last){L>>>=7&F,F-=7&F,w.mode=27;break}for(;F<3;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}switch(w.last=1&L,F-=1,3&(L>>>=1)){case 0:w.mode=14;break;case 1:if(j(w),w.mode=20,O!==6)break;L>>>=2,F-=2;break e;case 2:w.mode=17;break;case 3:R.msg="invalid block type",w.mode=30}L>>>=2,F-=2;break;case 14:for(L>>>=7&F,F-=7&F;F<32;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if((65535&L)!=(L>>>16^65535)){R.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&L,F=L=0,w.mode=15,O===6)break e;case 15:w.mode=16;case 16:if(Q=w.length){if(J<Q&&(Q=J),N<Q&&(Q=N),Q===0)break e;s.arraySet(W,C,P,Q,V),J-=Q,P+=Q,N-=Q,V+=Q,w.length-=Q;break}w.mode=12;break;case 17:for(;F<14;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if(w.nlen=257+(31&L),L>>>=5,F-=5,w.ndist=1+(31&L),L>>>=5,F-=5,w.ncode=4+(15&L),L>>>=4,F-=4,286<w.nlen||30<w.ndist){R.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;F<3;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}w.lens[pe[w.have++]]=7&L,L>>>=3,F-=3}for(;w.have<19;)w.lens[pe[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,ie={bits:w.lenbits},ue=l(0,w.lens,0,19,w.lencode,0,w.work,ie),w.lenbits=ie.bits,ue){R.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;ke=(z=w.lencode[L&(1<<w.lenbits)-1])>>>16&255,Ae=65535&z,!((ve=z>>>24)<=F);){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if(Ae<16)L>>>=ve,F-=ve,w.lens[w.have++]=Ae;else{if(Ae===16){for(G=ve+2;F<G;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if(L>>>=ve,F-=ve,w.have===0){R.msg="invalid bit length repeat",w.mode=30;break}T=w.lens[w.have-1],Q=3+(3&L),L>>>=2,F-=2}else if(Ae===17){for(G=ve+3;F<G;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}F-=ve,T=0,Q=3+(7&(L>>>=ve)),L>>>=3,F-=3}else{for(G=ve+7;F<G;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}F-=ve,T=0,Q=11+(127&(L>>>=ve)),L>>>=7,F-=7}if(w.have+Q>w.nlen+w.ndist){R.msg="invalid bit length repeat",w.mode=30;break}for(;Q--;)w.lens[w.have++]=T}}if(w.mode===30)break;if(w.lens[256]===0){R.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,ie={bits:w.lenbits},ue=l(u,w.lens,0,w.nlen,w.lencode,0,w.work,ie),w.lenbits=ie.bits,ue){R.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,ie={bits:w.distbits},ue=l(h,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,ie),w.distbits=ie.bits,ue){R.msg="invalid distances set",w.mode=30;break}if(w.mode=20,O===6)break e;case 20:w.mode=21;case 21:if(6<=J&&258<=N){R.next_out=V,R.avail_out=N,R.next_in=P,R.avail_in=J,w.hold=L,w.bits=F,c(R,K),V=R.next_out,W=R.output,N=R.avail_out,P=R.next_in,C=R.input,J=R.avail_in,L=w.hold,F=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;ke=(z=w.lencode[L&(1<<w.lenbits)-1])>>>16&255,Ae=65535&z,!((ve=z>>>24)<=F);){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if(ke&&(240&ke)==0){for(Se=ve,Me=ke,je=Ae;ke=(z=w.lencode[je+((L&(1<<Se+Me)-1)>>Se)])>>>16&255,Ae=65535&z,!(Se+(ve=z>>>24)<=F);){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}L>>>=Se,F-=Se,w.back+=Se}if(L>>>=ve,F-=ve,w.back+=ve,w.length=Ae,ke===0){w.mode=26;break}if(32&ke){w.back=-1,w.mode=12;break}if(64&ke){R.msg="invalid literal/length code",w.mode=30;break}w.extra=15&ke,w.mode=22;case 22:if(w.extra){for(G=w.extra;F<G;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}w.length+=L&(1<<w.extra)-1,L>>>=w.extra,F-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;ke=(z=w.distcode[L&(1<<w.distbits)-1])>>>16&255,Ae=65535&z,!((ve=z>>>24)<=F);){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if((240&ke)==0){for(Se=ve,Me=ke,je=Ae;ke=(z=w.distcode[je+((L&(1<<Se+Me)-1)>>Se)])>>>16&255,Ae=65535&z,!(Se+(ve=z>>>24)<=F);){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}L>>>=Se,F-=Se,w.back+=Se}if(L>>>=ve,F-=ve,w.back+=ve,64&ke){R.msg="invalid distance code",w.mode=30;break}w.offset=Ae,w.extra=15&ke,w.mode=24;case 24:if(w.extra){for(G=w.extra;F<G;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}w.offset+=L&(1<<w.extra)-1,L>>>=w.extra,F-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){R.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(N===0)break e;if(Q=K-N,w.offset>Q){if((Q=w.offset-Q)>w.whave&&w.sane){R.msg="invalid distance too far back",w.mode=30;break}he=Q>w.wnext?(Q-=w.wnext,w.wsize-Q):w.wnext-Q,Q>w.length&&(Q=w.length),xe=w.window}else xe=W,he=V-w.offset,Q=w.length;for(N<Q&&(Q=N),N-=Q,w.length-=Q;W[V++]=xe[he++],--Q;);w.length===0&&(w.mode=21);break;case 26:if(N===0)break e;W[V++]=w.length,N--,w.mode=21;break;case 27:if(w.wrap){for(;F<32;){if(J===0)break e;J--,L|=C[P++]<<F,F+=8}if(K-=N,R.total_out+=K,w.total+=K,K&&(R.adler=w.check=w.flags?a(w.check,W,K,V-K):o(w.check,W,K,V-K)),K=N,(w.flags?L:y(L))!==w.check){R.msg="incorrect data check",w.mode=30;break}F=L=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;F<32;){if(J===0)break e;J--,L+=C[P++]<<F,F+=8}if(L!==(4294967295&w.total)){R.msg="incorrect length check",w.mode=30;break}F=L=0}w.mode=29;case 29:ue=1;break e;case 30:ue=-3;break e;case 31:return-4;case 32:default:return f}return R.next_out=V,R.avail_out=N,R.next_in=P,R.avail_in=J,w.hold=L,w.bits=F,(w.wsize||K!==R.avail_out&&w.mode<30&&(w.mode<27||O!==4))&&q(R,R.output,R.next_out,K-R.avail_out)?(w.mode=31,-4):(Y-=R.avail_in,K-=R.avail_out,R.total_in+=Y,R.total_out+=K,w.total+=K,w.wrap&&K&&(R.adler=w.check=w.flags?a(w.check,W,K,R.next_out-K):o(w.check,W,K,R.next_out-K)),R.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(Y==0&&K===0||O===4)&&ue===d&&(ue=-5),ue)},i.inflateEnd=function(R){if(!R||!R.state)return f;var O=R.state;return O.window&&(O.window=null),R.state=null,d},i.inflateGetHeader=function(R,O){var w;return R&&R.state?(2&(w=R.state).wrap)==0?f:((w.head=O).done=!1,d):f},i.inflateSetDictionary=function(R,O){var w,C=O.length;return R&&R.state?(w=R.state).wrap!==0&&w.mode!==11?f:w.mode===11&&o(1,O,C,0)!==w.check?-3:q(R,O,C,C)?(w.mode=31,-4):(w.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,i){var s=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,h,d,f,m,p,g,y){var b,A,S,x,B,I,U,$,j,q=y.bits,R=0,O=0,w=0,C=0,W=0,P=0,V=0,J=0,N=0,L=0,F=null,Y=0,K=new s.Buf16(16),Q=new s.Buf16(16),he=null,xe=0;for(R=0;R<=15;R++)K[R]=0;for(O=0;O<f;O++)K[h[d+O]]++;for(W=q,C=15;1<=C&&K[C]===0;C--);if(C<W&&(W=C),C===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(w=1;w<C&&K[w]===0;w++);for(W<w&&(W=w),R=J=1;R<=15;R++)if(J<<=1,(J-=K[R])<0)return-1;if(0<J&&(u===0||C!==1))return-1;for(Q[1]=0,R=1;R<15;R++)Q[R+1]=Q[R]+K[R];for(O=0;O<f;O++)h[d+O]!==0&&(g[Q[h[d+O]]++]=O);if(I=u===0?(F=he=g,19):u===1?(F=o,Y-=257,he=a,xe-=257,256):(F=c,he=l,-1),R=w,B=p,V=O=L=0,S=-1,x=(N=1<<(P=W))-1,u===1&&852<N||u===2&&592<N)return 1;for(;;){for(U=R-V,j=g[O]<I?($=0,g[O]):g[O]>I?($=he[xe+g[O]],F[Y+g[O]]):($=96,0),b=1<<R-V,w=A=1<<P;m[B+(L>>V)+(A-=b)]=U<<24|$<<16|j|0,A!==0;);for(b=1<<R-1;L&b;)b>>=1;if(b!==0?(L&=b-1,L+=b):L=0,O++,--K[R]==0){if(R===C)break;R=h[d+g[O]]}if(W<R&&(L&x)!==S){for(V===0&&(V=W),B+=w,J=1<<(P=R-V);P+V<C&&!((J-=K[P+V])<=0);)P++,J<<=1;if(N+=1<<P,u===1&&852<N||u===2&&592<N)return 1;m[S=L&x]=W<<24|P<<16|B-p|0}}return L!==0&&(m[B+L]=R-V<<24|64<<16|0),y.bits=W,0}},{"../utils/common":41}],51:[function(r,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,i){var s=r("../utils/common"),o=0,a=1;function c(z){for(var ee=z.length;0<=--ee;)z[ee]=0}var l=0,u=29,h=256,d=h+1+u,f=30,m=19,p=2*d+1,g=15,y=16,b=7,A=256,S=16,x=17,B=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(d+2));c(q);var R=new Array(2*f);c(R);var O=new Array(512);c(O);var w=new Array(256);c(w);var C=new Array(u);c(C);var W,P,V,J=new Array(f);function N(z,ee,pe,me,se){this.static_tree=z,this.extra_bits=ee,this.extra_base=pe,this.elems=me,this.max_length=se,this.has_stree=z&&z.length}function L(z,ee){this.dyn_tree=z,this.max_code=0,this.stat_desc=ee}function F(z){return z<256?O[z]:O[256+(z>>>7)]}function Y(z,ee){z.pending_buf[z.pending++]=255&ee,z.pending_buf[z.pending++]=ee>>>8&255}function K(z,ee,pe){z.bi_valid>y-pe?(z.bi_buf|=ee<<z.bi_valid&65535,Y(z,z.bi_buf),z.bi_buf=ee>>y-z.bi_valid,z.bi_valid+=pe-y):(z.bi_buf|=ee<<z.bi_valid&65535,z.bi_valid+=pe)}function Q(z,ee,pe){K(z,pe[2*ee],pe[2*ee+1])}function he(z,ee){for(var pe=0;pe|=1&z,z>>>=1,pe<<=1,0<--ee;);return pe>>>1}function xe(z,ee,pe){var me,se,ye=new Array(g+1),Oe=0;for(me=1;me<=g;me++)ye[me]=Oe=Oe+pe[me-1]<<1;for(se=0;se<=ee;se++){var _e=z[2*se+1];_e!==0&&(z[2*se]=he(ye[_e]++,_e))}}function ve(z){var ee;for(ee=0;ee<d;ee++)z.dyn_ltree[2*ee]=0;for(ee=0;ee<f;ee++)z.dyn_dtree[2*ee]=0;for(ee=0;ee<m;ee++)z.bl_tree[2*ee]=0;z.dyn_ltree[2*A]=1,z.opt_len=z.static_len=0,z.last_lit=z.matches=0}function ke(z){8<z.bi_valid?Y(z,z.bi_buf):0<z.bi_valid&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0}function Ae(z,ee,pe,me){var se=2*ee,ye=2*pe;return z[se]<z[ye]||z[se]===z[ye]&&me[ee]<=me[pe]}function Se(z,ee,pe){for(var me=z.heap[pe],se=pe<<1;se<=z.heap_len&&(se<z.heap_len&&Ae(ee,z.heap[se+1],z.heap[se],z.depth)&&se++,!Ae(ee,me,z.heap[se],z.depth));)z.heap[pe]=z.heap[se],pe=se,se<<=1;z.heap[pe]=me}function Me(z,ee,pe){var me,se,ye,Oe,_e=0;if(z.last_lit!==0)for(;me=z.pending_buf[z.d_buf+2*_e]<<8|z.pending_buf[z.d_buf+2*_e+1],se=z.pending_buf[z.l_buf+_e],_e++,me===0?Q(z,se,ee):(Q(z,(ye=w[se])+h+1,ee),(Oe=I[ye])!==0&&K(z,se-=C[ye],Oe),Q(z,ye=F(--me),pe),(Oe=U[ye])!==0&&K(z,me-=J[ye],Oe)),_e<z.last_lit;);Q(z,A,ee)}function je(z,ee){var pe,me,se,ye=ee.dyn_tree,Oe=ee.stat_desc.static_tree,_e=ee.stat_desc.has_stree,Be=ee.stat_desc.elems,pt=-1;for(z.heap_len=0,z.heap_max=p,pe=0;pe<Be;pe++)ye[2*pe]!==0?(z.heap[++z.heap_len]=pt=pe,z.depth[pe]=0):ye[2*pe+1]=0;for(;z.heap_len<2;)ye[2*(se=z.heap[++z.heap_len]=pt<2?++pt:0)]=1,z.depth[se]=0,z.opt_len--,_e&&(z.static_len-=Oe[2*se+1]);for(ee.max_code=pt,pe=z.heap_len>>1;1<=pe;pe--)Se(z,ye,pe);for(se=Be;pe=z.heap[1],z.heap[1]=z.heap[z.heap_len--],Se(z,ye,1),me=z.heap[1],z.heap[--z.heap_max]=pe,z.heap[--z.heap_max]=me,ye[2*se]=ye[2*pe]+ye[2*me],z.depth[se]=(z.depth[pe]>=z.depth[me]?z.depth[pe]:z.depth[me])+1,ye[2*pe+1]=ye[2*me+1]=se,z.heap[1]=se++,Se(z,ye,1),2<=z.heap_len;);z.heap[--z.heap_max]=z.heap[1],(function(Je,Yt){var M,_,E,D,X,ce,H=Yt.dyn_tree,re=Yt.max_code,ze=Yt.stat_desc.static_tree,Ge=Yt.stat_desc.has_stree,Ye=Yt.stat_desc.extra_bits,Le=Yt.stat_desc.extra_base,Vr=Yt.stat_desc.max_length,kn=0;for(D=0;D<=g;D++)Je.bl_count[D]=0;for(H[2*Je.heap[Je.heap_max]+1]=0,M=Je.heap_max+1;M<p;M++)Vr<(D=H[2*H[2*(_=Je.heap[M])+1]+1]+1)&&(D=Vr,kn++),H[2*_+1]=D,re<_||(Je.bl_count[D]++,X=0,Le<=_&&(X=Ye[_-Le]),ce=H[2*_],Je.opt_len+=ce*(D+X),Ge&&(Je.static_len+=ce*(ze[2*_+1]+X)));if(kn!==0){do{for(D=Vr-1;Je.bl_count[D]===0;)D--;Je.bl_count[D]--,Je.bl_count[D+1]+=2,Je.bl_count[Vr]--,kn-=2}while(0<kn);for(D=Vr;D!==0;D--)for(_=Je.bl_count[D];_!==0;)re<(E=Je.heap[--M])||(H[2*E+1]!==D&&(Je.opt_len+=(D-H[2*E+1])*H[2*E],H[2*E+1]=D),_--)}})(z,ee),xe(ye,pt,z.bl_count)}function T(z,ee,pe){var me,se,ye=-1,Oe=ee[1],_e=0,Be=7,pt=4;for(Oe===0&&(Be=138,pt=3),ee[2*(pe+1)+1]=65535,me=0;me<=pe;me++)se=Oe,Oe=ee[2*(me+1)+1],++_e<Be&&se===Oe||(_e<pt?z.bl_tree[2*se]+=_e:se!==0?(se!==ye&&z.bl_tree[2*se]++,z.bl_tree[2*S]++):_e<=10?z.bl_tree[2*x]++:z.bl_tree[2*B]++,ye=se,pt=(_e=0)===Oe?(Be=138,3):se===Oe?(Be=6,3):(Be=7,4))}function ue(z,ee,pe){var me,se,ye=-1,Oe=ee[1],_e=0,Be=7,pt=4;for(Oe===0&&(Be=138,pt=3),me=0;me<=pe;me++)if(se=Oe,Oe=ee[2*(me+1)+1],!(++_e<Be&&se===Oe)){if(_e<pt)for(;Q(z,se,z.bl_tree),--_e!=0;);else se!==0?(se!==ye&&(Q(z,se,z.bl_tree),_e--),Q(z,S,z.bl_tree),K(z,_e-3,2)):_e<=10?(Q(z,x,z.bl_tree),K(z,_e-3,3)):(Q(z,B,z.bl_tree),K(z,_e-11,7));ye=se,pt=(_e=0)===Oe?(Be=138,3):se===Oe?(Be=6,3):(Be=7,4)}}c(J);var ie=!1;function G(z,ee,pe,me){K(z,(l<<1)+(me?1:0),3),(function(se,ye,Oe,_e){ke(se),Y(se,Oe),Y(se,~Oe),s.arraySet(se.pending_buf,se.window,ye,Oe,se.pending),se.pending+=Oe})(z,ee,pe)}i._tr_init=function(z){ie||((function(){var ee,pe,me,se,ye,Oe=new Array(g+1);for(se=me=0;se<u-1;se++)for(C[se]=me,ee=0;ee<1<<I[se];ee++)w[me++]=se;for(w[me-1]=se,se=ye=0;se<16;se++)for(J[se]=ye,ee=0;ee<1<<U[se];ee++)O[ye++]=se;for(ye>>=7;se<f;se++)for(J[se]=ye<<7,ee=0;ee<1<<U[se]-7;ee++)O[256+ye++]=se;for(pe=0;pe<=g;pe++)Oe[pe]=0;for(ee=0;ee<=143;)q[2*ee+1]=8,ee++,Oe[8]++;for(;ee<=255;)q[2*ee+1]=9,ee++,Oe[9]++;for(;ee<=279;)q[2*ee+1]=7,ee++,Oe[7]++;for(;ee<=287;)q[2*ee+1]=8,ee++,Oe[8]++;for(xe(q,d+1,Oe),ee=0;ee<f;ee++)R[2*ee+1]=5,R[2*ee]=he(ee,5);W=new N(q,I,h+1,d,g),P=new N(R,U,0,f,g),V=new N(new Array(0),$,0,m,b)})(),ie=!0),z.l_desc=new L(z.dyn_ltree,W),z.d_desc=new L(z.dyn_dtree,P),z.bl_desc=new L(z.bl_tree,V),z.bi_buf=0,z.bi_valid=0,ve(z)},i._tr_stored_block=G,i._tr_flush_block=function(z,ee,pe,me){var se,ye,Oe=0;0<z.level?(z.strm.data_type===2&&(z.strm.data_type=(function(_e){var Be,pt=4093624447;for(Be=0;Be<=31;Be++,pt>>>=1)if(1&pt&&_e.dyn_ltree[2*Be]!==0)return o;if(_e.dyn_ltree[18]!==0||_e.dyn_ltree[20]!==0||_e.dyn_ltree[26]!==0)return a;for(Be=32;Be<h;Be++)if(_e.dyn_ltree[2*Be]!==0)return a;return o})(z)),je(z,z.l_desc),je(z,z.d_desc),Oe=(function(_e){var Be;for(T(_e,_e.dyn_ltree,_e.l_desc.max_code),T(_e,_e.dyn_dtree,_e.d_desc.max_code),je(_e,_e.bl_desc),Be=m-1;3<=Be&&_e.bl_tree[2*j[Be]+1]===0;Be--);return _e.opt_len+=3*(Be+1)+5+5+4,Be})(z),se=z.opt_len+3+7>>>3,(ye=z.static_len+3+7>>>3)<=se&&(se=ye)):se=ye=pe+5,pe+4<=se&&ee!==-1?G(z,ee,pe,me):z.strategy===4||ye===se?(K(z,2+(me?1:0),3),Me(z,q,R)):(K(z,4+(me?1:0),3),(function(_e,Be,pt,Je){var Yt;for(K(_e,Be-257,5),K(_e,pt-1,5),K(_e,Je-4,4),Yt=0;Yt<Je;Yt++)K(_e,_e.bl_tree[2*j[Yt]+1],3);ue(_e,_e.dyn_ltree,Be-1),ue(_e,_e.dyn_dtree,pt-1)})(z,z.l_desc.max_code+1,z.d_desc.max_code+1,Oe+1),Me(z,z.dyn_ltree,z.dyn_dtree)),ve(z),me&&ke(z)},i._tr_tally=function(z,ee,pe){return z.pending_buf[z.d_buf+2*z.last_lit]=ee>>>8&255,z.pending_buf[z.d_buf+2*z.last_lit+1]=255&ee,z.pending_buf[z.l_buf+z.last_lit]=255&pe,z.last_lit++,ee===0?z.dyn_ltree[2*pe]++:(z.matches++,ee--,z.dyn_ltree[2*(w[pe]+h+1)]++,z.dyn_dtree[2*F(ee)]++),z.last_lit===z.lit_bufsize-1},i._tr_align=function(z){K(z,2,3),Q(z,A,q),(function(ee){ee.bi_valid===16?(Y(ee,ee.bi_buf),ee.bi_buf=0,ee.bi_valid=0):8<=ee.bi_valid&&(ee.pending_buf[ee.pending++]=255&ee.bi_buf,ee.bi_buf>>=8,ee.bi_valid-=8)})(z)}},{"../utils/common":41}],53:[function(r,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,n,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,f={},m=!1,p=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,c={}.toString.call(o.process)==="[object process]"?function(S){An.nextTick(function(){b(S)})}:(function(){if(o.postMessage&&!o.importScripts){var S=!0,x=o.onmessage;return o.onmessage=function(){S=!1},o.postMessage("","*"),o.onmessage=x,S}})()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(S){o.postMessage(h+S,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(S){b(S.data)},function(S){u.port2.postMessage(S)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(S){var x=p.createElement("script");x.onreadystatechange=function(){b(S),x.onreadystatechange=null,l.removeChild(x),x=null},l.appendChild(x)}):function(S){setTimeout(b,0,S)},g.setImmediate=function(S){typeof S!="function"&&(S=new Function(""+S));for(var x=new Array(arguments.length-1),B=0;B<x.length;B++)x[B]=arguments[B+1];var I={callback:S,args:x};return f[d]=I,c(d),d++},g.clearImmediate=y}function y(S){delete f[S]}function b(S){if(m)setTimeout(b,0,S);else{var x=f[S];if(x){m=!0;try{(function(B){var I=B.callback,U=B.args;switch(U.length){case 0:I();break;case 1:I(U[0]);break;case 2:I(U[0],U[1]);break;case 3:I(U[0],U[1],U[2]);break;default:I.apply(a,U)}})(x)}finally{y(S),m=!1}}}}function A(S){S.source===o&&typeof S.data=="string"&&S.data.indexOf(h)===0&&b(+S.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Ci<"u"?Ci:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(M0)),M0.exports}var Rz=Sz(),U0=js(Rz);const EA={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(EA);var En=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},$o,rc,$s;class Oz{constructor(...e){$o.set(this,new Map),rc.set(this,new Map),$s.set(this,new Map);for(const r of e)this.define(r)}define(e,r=!1){for(let[n,i]of Object.entries(e)){n=n.toLowerCase(),i=i.map(a=>a.toLowerCase()),En(this,$s,"f").has(n)||En(this,$s,"f").set(n,new Set);const s=En(this,$s,"f").get(n);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s?.add(a),o&&En(this,rc,"f").set(n,a),o=!1,c)continue;const l=En(this,$o,"f").get(a);if(l&&l!=n&&!r)throw new Error(`"${n} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);En(this,$o,"f").set(a,n)}}return this}getType(e){if(typeof e!="string")return null;const r=e.replace(/^.*[/\\]/s,"").toLowerCase(),n=r.replace(/^.*\./s,"").toLowerCase(),i=r.length<e.length;return!(n.length<r.length-1)&&i?null:En(this,$o,"f").get(n)??null}getExtension(e){return typeof e!="string"?null:(e=e?.split?.(";")[0],(e&&En(this,rc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:En(this,$s,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of En(this,$s,"f").values())Object.freeze(e);return this}_getTestState(){return{types:En(this,$o,"f"),extensions:En(this,rc,"f")}}}$o=new WeakMap,rc=new WeakMap,$s=new WeakMap;var Iz=new Oz(EA)._freeze();function Nz(t,e,r){const n=x0();if(!v(n))return;const i=`@charset ${e.toLowerCase().replace(".chr","")}`,s=Da(i,{}),o=gt(s),a=Rh(r),c=At(s);v(a)&&v(c)&&(Object.assign(c,a),ko(n,s),Yo(le,t,`imported chr file ${o} into ${n.name} book`))}function Cz(t,e){console.info(e)}const Lz=/; \$(\w+) ?(.*)/,Mz=/title (.+?) (.*)/i;function F0(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Uz(t,e){const r=x0();if(!v(r))return;const n=e.split(/\r?\n/),i={title:"",gendate:"",gentime:"",songs:[]};function s(m){return i.songs.find(p=>p.order===m)}function o(m,p){return{order:m,title:p,lines:[]}}for(let m=0;m<n.length;++m){const p=n[m],g=Lz.exec(p);if(v(g)){const y=g[1].toLowerCase(),b=g[2];switch(y){case"title":i.title=b;break;case"gendate":i.gendate=b;break;case"gentime":i.gentime=b;break;case"song":{const A=Mz.exec(b);if(v(A)){const S=parseFloat(A[1]),x=A[2],B=s(S);v(B)?B.title=x:i.songs.push(o(S,x))}else{const S=parseFloat(b);if(Te(S)){const x=s(S);v(x)||i.songs.push(o(S,""))}}break}}}else{const y=i.songs[i.songs.length-1];v(y)&&p.trim().length&&y.lines.push(p)}}i.songs.sort((m,p)=>m.order-p.order);const a=i.songs.map(m=>m.title),c=`@play_${$e(i.title).replace(/\W/g,"")}
@cycle 1
@char 14
#end

:touch
"ALBUM: ${F0(i.title)}"
"$purple  ${F0(i.gendate)}"
"$purple  ${F0(i.gentime)}"
${a.map((m,p)=>`!song_${p};${p+1} ${m||"untitled"}`).join(`
`)}
#end

${i.songs.map((m,p)=>`:song_${p}
${m.lines.map(g=>`#play ${g}`).join(`
`)}
#end
`).join(`
`)}
`,l=Da(c,{}),u=gt(l);ko(r,l),Yo(le,t,`imported zzt zzm file ${u} into ${r.name} book`);const h=gt(l),d=Ai(l);yt(le,t,`!pageopen ${l.id};$blue[${d}]$white ${h}`);const f=`#put n ${u}`;lP(le,t,f,f,!1)}const Nu=60,Fz=Nu*25;function Pz(t,e){let r=0;const n=new DataView(e.buffer);function i(){const C=n.getUint8(r);return r++,C}function s(){const C=n.getInt16(r,!0);return r+=2,C}function o(){const C=n.getInt32(r,!0);return r+=4,C}function a(C){let W="";const P=e.subarray(r,r+C);for(let V=0;V<P.length;++V)W+=String.fromCharCode(P[V]);return r+=C,W.replace("\r",`
`)}function c(C,W,P,V){const J=on(C,W,P);if(v(J)&&v(V)){const N=Mr(V);for(let L=0;L<N.length;++L){const F=N[L];J[F]=V[F]}}}function l(C){let W="";for(let P=0;P<C.length;++P){const V=C.charCodeAt(P);V<32||V>127?W+=`$${V}`:W+=C[P]}return W}function u(C){return C.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(W=>W.replace("$","$CENTER ")).map(l).join(`
`)}function h(C,W,P,V,J){const N=V.color%16,L=Math.floor(V.color/16)%8,F=uo(N,L),Y=uo((L+8)%16,N),K={},Q=J.find(he=>he.x===W&&he.y===P);switch(v(Q)&&(Te(Q.cycle)&&Q.cycle>0&&(K.cycle=Q.cycle),v(Q.p1)&&(K.p1=Q.p1),v(Q.p2)&&(K.p2=Q.p2),v(Q.p3)&&(K.p3=Q.p3),v(Q.code)&&Q.code&&(K.code=u(Q.code)),v(Q.stepx)&&(K.stepx=Q.stepx),v(Q.stepy)&&(K.stepy=Q.stepy)),V.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(C,["ammo",F],{x:W,y:P},K);break;case 6:c(C,["torch",F],{x:W,y:P},K);break;case 7:c(C,["gem",F],{x:W,y:P},K);break;case 8:c(C,["key",F],{x:W,y:P},K);break;case 9:c(C,["door",Y],{x:W,y:P},K);break;case 10:c(C,["scroll",F],{x:W,y:P},K);break;case 11:{K.p3=d(Q?.p3)??"",c(C,["passage",F],{x:W,y:P},K);break}case 12:c(C,["duplicator",F],{x:W,y:P},{...K,stepx:0,stepy:0,shootx:K.stepx??0,shooty:K.stepy??0});break;case 13:c(C,["bomb",F],{x:W,y:P},K);break;case 14:c(C,["energize",F],{x:W,y:P},K);break;case 15:c(C,["star",F],{x:W,y:P},K);break;case 16:c(C,["clockwise",F],{x:W,y:P},K);break;case 17:c(C,["counter",F],{x:W,y:P},K);break;case 18:c(C,["bullet",F],{x:W,y:P},K);break;case 19:c(C,["water",F],{x:W,y:P},K);break;case 20:c(C,["forest",F],{x:W,y:P},K);break;case 21:c(C,["solid",F],{x:W,y:P},K);break;case 22:c(C,["normal",F],{x:W,y:P},K);break;case 23:c(C,["breakable",F],{x:W,y:P},K);break;case 24:c(C,["boulder",F],{x:W,y:P},K);break;case 25:c(C,["sliderns",F],{x:W,y:P},K);break;case 26:c(C,["sliderew",F],{x:W,y:P},K);break;case 27:c(C,["fake",F],{x:W,y:P},K);break;case 28:c(C,["invisible",F],{x:W,y:P},K);break;case 29:c(C,["blinkwall",F],{x:W,y:P},{...K,stepx:0,stepy:0,shootx:K.stepx??0,shooty:K.stepy??0});break;case 30:c(C,["transporter",F],{x:W,y:P},{...K,stepx:0,stepy:0,shootx:K.stepx??0,shooty:K.stepy??0});break;case 31:c(C,["line",F],{x:W,y:P},K);break;case 32:c(C,["ricochet",F],{x:W,y:P},K);break;case 33:c(C,["blinkns",F],{x:W,y:P},K);break;case 34:c(C,["bear",F],{x:W,y:P},K);break;case 35:c(C,["ruffian",F],{x:W,y:P},K);break;case 36:c(C,["object",F],{x:W,y:P},{...K,char:Q?.p1??1});break;case 37:c(C,["slime",F],{x:W,y:P},K);break;case 38:c(C,["shark",F],{x:W,y:P},K);break;case 39:c(C,["spinninggun",F],{x:W,y:P},K);break;case 40:c(C,["pusher",F],{x:W,y:P},K);break;case 41:c(C,["lion",F],{x:W,y:P},K);break;case 42:c(C,["tiger",F],{x:W,y:P},K);break;case 43:c(C,["blinkns",F],{x:W,y:P},K);break;case 44:c(C,["head",F],{x:W,y:P},K);break;case 45:c(C,["segment",F],{x:W,y:P},K);break;case 46:break;case 47:c(C,["text",["WHITE","ONDKBLUE"]],{x:W,y:P},{...K,char:V.color});break;case 48:c(C,["text",["WHITE","ONDKGREEN"]],{x:W,y:P},{...K,char:V.color});break;case 49:c(C,["text",["WHITE","ONDKCYAN"]],{x:W,y:P},{...K,char:V.color});break;case 50:c(C,["text",["WHITE","ONDKRED"]],{x:W,y:P},{...K,char:V.color});break;case 51:c(C,["text",["WHITE","ONDKPURPLE"]],{x:W,y:P},{...K,char:V.color});break;case 52:c(C,["text",["WHITE","ONDKYELLOW"]],{x:W,y:P},{...K,char:V.color});break;case 53:c(C,["text",["WHITE","ONBLACK"]],{x:W,y:P},{...K,char:V.color});break}}function d(C){if(Te(C)&&C>0)return`zztboard${C}`}if(s()!=-1)return;const m=s(),p=s(),g=s(),y=a(7),b=s(),A=s(),S=s(),x=s(),B=s();s();const I=s(),U=i(),$=a(20).slice(0,U);for(let C=0;C<9;C++){const W=i();a(20).slice(0,W)}const j=s(),q=s(),R=i();console.info(p,g,y,b,A,S,x,B,I,j,q,R),r=512;const O=[];for(let C=0;C<=m;++C){const W=s(),P=r,V=i(),N={boardname:a(50).slice(0,V),elements:[],stats:[]};for(;N.elements.length<Fz;){let F=i();F===0&&(F=255);const Y=i(),K=i();for(let Q=0;Q<F;++Q)N.elements.push({element:Y,color:K})}N.maxplayershots=i(),N.isdark=i(),N.exitnorth=i(),N.exitsouth=i(),N.exitwest=i(),N.exiteast=i(),N.restartonzap=i(),N.messagelength=i(),N.message=a(58).slice(0,N.messagelength),N.playerenterx=i(),N.playerentery=i(),N.timelimit=s(),r+=16;const L=s()+1;for(;N.stats.length<L;){const F={};F.x=i()-1,F.y=i()-1,F.stepx=s(),F.stepy=s(),F.cycle=s(),F.p1=i(),F.p2=i(),F.p3=i(),F.follower=s(),F.leader=s(),F.underelement=i(),F.undercolor=i(),F.pointer=o(),F.currentinstruction=s();const Y=s();r+=8,Y<0?F.bind=Math.abs(Y):F.code=a(Y),N.stats.push(F)}O.push(N),r=P+W}const w=Bd([]);w.name=$;for(let C=0;C<O.length;++C){const W=O[C],P=[`@zztboard${C}`,""];C===0?P.push("@title"):C===A&&P.push("@zztstartboard");for(let xe=0;xe<W.elements.length;++xe)W.elements[xe].element===4&&(P.push(`@startx ${hy(xe,Nu)}`),P.push(`@starty ${dy(xe,Nu)}`));Te(W.maxplayershots)&&P.push(`@maxplayershots ${W.maxplayershots}`),Te(W.isdark)&&P.push(`@isdark ${W.isdark}`),Te(W.restartonzap)&&P.push(`@restartonzap ${W.restartonzap}`),Te(W.timelimit)&&P.push(`@timelimit ${W.timelimit}`);const V=d(W.exitnorth);be(V)&&P.push(`@exitnorth ${V}`);const J=d(W.exitsouth);be(J)&&P.push(`@exitsouth ${J}`);const N=d(W.exitwest);be(N)&&P.push(`@exitwest ${N}`);const L=d(W.exiteast);be(L)&&P.push(`@exiteast ${L}`);const F=`@board ${String(C).padStart(3,"0")}. ${W.boardname}
${P.join(`
`)}`,Y=Da(F,{});ko(w,Y);const K=At(Y);if(!v(K))continue;let Q=0,he=0;for(let xe=0;xe<W.elements.length;++xe){const ve=W.elements[xe];h(K,Q,he,ve,W.stats),++Q,Q===Nu&&(Q=0,++he)}cr(K)}xu(w),Yo(le,t,`imported zzt file into ${w.name} book`)}function Bz(t,e,r){const n=x0();if(!v(n))return;const s=Zl(r).name?r:`@${e.toLowerCase().replace(".obj","")}
${r}`,o=Da(s,{}),a=gt(o);ko(n,o),Yo(le,t,`imported zzt obj file ${a} into ${n.name} book`)}function kA(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return Iz.getType(t)??"application/octet-stream"}function xA(t,e){if(!v(e))return"";switch(t){case"model/obj":return"obj";case"text/plain":return"txt";case"application/json":return"json";case"application/zip":return"zip";case"application/octet-stream":if(/.zzt$/i.test(e.name))return"zzt";if(/.brd$/i.test(e.name))return"brd";if(/.chr$/i.test(e.name))return"chr";if(/.zzl$/i.test(e.name))return"zzl";if(/.zzm$/i.test(e.name))return"zzm";break}return""}let Do=[],Cu={};async function $z(t,e){try{Pt(le,t,"parsezipfile",e.name);const r=await e.arrayBuffer(),i=await new U0().loadAsync(r);Do=[],Cu={};const s=[];i.forEach((o,a)=>s.push([o,a]));for(let o=0;o<s.length;++o){const[a,c]=s[o],l=await c.async("uint8array"),u=kA(a,l),h=new File([l],c.name,{type:u});Do.push(h)}RS(le,t)}catch(r){mt(le,t,"crash",r.message)}}function Dz(){const t=[];for(let e=0;e<Do.length;++e){const r=Do[e];t.push([xA(r.type,r),r.name])}return t}function jz(t,e){Cu[t.toLowerCase()]=e}function zz(t){return Cu[t.toLowerCase()]}async function Wz(t){for(let e=0;e<Do.length;++e){const r=Do[e];Cu[r.name.toLowerCase()]&&(P0(t,r),await hc(2e3))}await hc(2e3),hf(le,t)}function AA(t,e,r){if(!v(r))return;switch(xA(e,r)){case"obj":r.text().then(i=>Bz(t,r.name,i)).catch(i=>mt(le,t,"crash",i.message));break;case"txt":r.text().then(i=>df(le,t,void 0,"text",`file:${r.name}`,i)).catch(i=>mt(le,t,"crash",i.message));break;case"json":r.text().then(i=>df(le,t,void 0,"json",`file:${r.name}`,i)).catch(i=>mt(le,t,"crash",i.message));break;case"zip":$z(t,r).catch(i=>mt(le,t,"crash",i.message));break;case"zzt":r.arrayBuffer().then(i=>{Pz(t,new Uint8Array(i))}).catch(i=>mt(le,t,"crash",i.message));break;case"brd":r.arrayBuffer().then(i=>{}).catch(i=>mt(le,t,"crash",i.message));break;case"chr":r.arrayBuffer().then(i=>{Nz(t,r.name,new Uint8Array(i))}).catch(i=>mt(le,t,"crash",i.message));break;case"zzl":r.text().then(i=>{Cz(t,i)}).catch(i=>mt(le,t,"crash",i.message));break;case"zzm":r.text().then(i=>{Uz(t,i)}).catch(i=>mt(le,t,"crash",i.message));break;default:e||r.arrayBuffer().then(i=>{const s=kA(r.name,new Uint8Array(i));if(s)AA(t,s,r);else return mt(le,t,"parsewebfile",`unsupported file ${r.name}`)}).catch(i=>mt(le,t,"crash",i.message));return}}function P0(t,e){AA(t,e?.type??"",e)}const Lu="https://bridge.zed.cafe";async function Hz(t,e,r){const n=`offset=${r}&${t}=${e}`,i=new Request(`${Lu}/api/v1/search/files/?${n}`);return(await(await fetch(i)).json()).data.results}async function Gz(){const t=new Request(`${Lu}/api/v1/get/random-file/`);return[(await(await fetch(t)).json()).data]}function Kz(t){return`${Lu}/static/${t}`}async function qz(t,e){const n=await(await fetch(`${Lu}/zgames/${e}`)).arrayBuffer(),i=new File([n],e);P0(t,i)}function Yr(t,e,r){r().catch(n=>{console.error(n),mt(t,e,"crash",n?.message)})}function Yz(t){const[e,r]=t.split(":"),n=v(r);return[n?e:"self",n?r:t]}var we=typeof we<"u"?we:{},nc={},Ji;for(Ji in we)we.hasOwnProperty(Ji)&&(nc[Ji]=we[Ji]);var jo=we.printErr||console.warn.bind(console);for(Ji in nc)nc.hasOwnProperty(Ji)&&(we[Ji]=nc[Ji]);var B0=(t,e)=>{throw e};nc=null,we.arguments&&we.arguments,we.thisProgram&&(thisProgram=we.thisProgram),we.quit&&(B0=we.quit),typeof WebAssembly!="object"&&$0("no native wasm support detected");var Mu,Uu=!1,Fu,TA;function SA(){var t=Mu.buffer;we.HEAP8=new Int8Array(t),we.HEAPU8=TA=new Uint8Array(t)}var RA=[],OA=[],IA=[];function Vz(){if(we.preRun)for(typeof we.preRun=="function"&&(we.preRun=[we.preRun]);we.preRun.length;)Jz(we.preRun.shift());D0(RA)}function Xz(){D0(OA)}function Zz(){if(we.postRun)for(typeof we.postRun=="function"&&(we.postRun=[we.postRun]);we.postRun.length;)e7(we.postRun.shift());D0(IA)}function Jz(t){RA.unshift(t)}function Qz(t){OA.unshift(t)}function e7(t){IA.unshift(t)}var Ds=0,ic=null;function t7(t){var e;Ds++,(e=we.monitorRunDependencies)===null||e===void 0||e.call(we,Ds)}function r7(t){var e;if(Ds--,(e=we.monitorRunDependencies)===null||e===void 0||e.call(we,Ds),Ds==0&&ic){var r=ic;ic=null,r()}}function $0(t){var e;(e=we.onAbort)===null||e===void 0||e.call(we,t),t="Aborted("+t+")",jo(t),Uu=!0,t+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(t);throw r}function n7(){return{a:_7}}function i7(t){return fetch(t,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})}function s7(t){var e=n7();function r(a,c){return mr=a.exports,Mu=mr.f,SA(),Qz(mr.g),r7(),mr}t7();function n(a){r(a.instance)}function i(a){return i7(t).then(function(c){var l=WebAssembly.instantiate(c,e);return l}).then(a,function(c){jo("failed to asynchronously prepare wasm: "+c),$0(c)})}function s(){return t&&t.byteLength>0?WebAssembly.instantiate(t,e).then(n,function(a){jo("wasm compile failed: "+a)}):typeof WebAssembly.instantiateStreaming=="function"&&typeof t=="string"&&typeof fetch=="function"?fetch(t,{credentials:"same-origin"}).then(function(a){var c=WebAssembly.instantiateStreaming(a,e);return c.then(n,function(l){return jo("wasm streaming compile failed: "+l),jo("falling back to ArrayBuffer instantiation"),i(n)})}):i(n)}if(we.instantiateWasm)try{var o=we.instantiateWasm(e,r);return o}catch(a){return jo("Module.instantiateWasm callback failed with error: "+a),!1}return s(),{}}class NA{constructor(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}}var D0=t=>{for(;t.length>0;)t.shift()(we)},CA=we.noExitRuntime||!0,o7=()=>$0(""),LA=0,a7=()=>{CA=!1,LA=0},sc={},MA=t=>{if(t instanceof NA||t=="unwind")return Fu;B0(1,t)},UA=()=>CA||LA>0,FA=t=>{var e;Fu=t,UA()||((e=we.onExit)===null||e===void 0||e.call(we,t),Uu=!0),B0(t,new NA(t))},c7=(t,e)=>{Fu=t,FA(t)},l7=c7,u7=()=>{if(!UA())try{l7(Fu)}catch(t){MA(t)}},f7=t=>{if(!Uu)try{t(),u7()}catch(e){MA(e)}},h7=()=>performance.now(),d7=(t,e)=>{if(sc[t]&&(clearTimeout(sc[t].id),delete sc[t]),!e)return 0;var r=setTimeout(()=>{delete sc[t],f7(()=>PA(t,h7()))},e);return sc[t]={id:r,timeout_ms:e},0},p7=()=>2147483648,m7=(t,e)=>Math.ceil(t/e)*e,g7=t=>{var e=Mu.buffer,r=(t-e.byteLength+65535)/65536|0;try{return Mu.grow(r),SA(),1}catch{}},y7=t=>{var e=TA.length;t>>>=0;var r=p7();if(t>r)return!1;for(var n=1;n<=4;n*=2){var i=e*(1+.2/n);i=Math.min(i,t+100663296);var s=Math.min(r,m7(Math.max(t,i),65536)),o=g7(s);if(o)return!0}return!1},_7={c:o7,b:a7,d:d7,e:y7,a:FA},mr;we._ZSTD_isError=t=>(we._ZSTD_isError=mr.h)(t),we._ZSTD_compressBound=t=>(we._ZSTD_compressBound=mr.i)(t),we._ZSTD_createCCtx=()=>(we._ZSTD_createCCtx=mr.j)(),we._ZSTD_freeCCtx=t=>(we._ZSTD_freeCCtx=mr.k)(t),we._ZSTD_compress_usingDict=(t,e,r,n,i,s,o,a)=>(we._ZSTD_compress_usingDict=mr.l)(t,e,r,n,i,s,o,a),we._ZSTD_compress=(t,e,r,n,i)=>(we._ZSTD_compress=mr.m)(t,e,r,n,i),we._ZSTD_createDCtx=()=>(we._ZSTD_createDCtx=mr.n)(),we._ZSTD_freeDCtx=t=>(we._ZSTD_freeDCtx=mr.o)(t),we._ZSTD_getFrameContentSize=(t,e)=>(we._ZSTD_getFrameContentSize=mr.p)(t,e),we._ZSTD_decompress_usingDict=(t,e,r,n,i,s,o)=>(we._ZSTD_decompress_usingDict=mr.q)(t,e,r,n,i,s,o),we._ZSTD_decompress=(t,e,r,n)=>(we._ZSTD_decompress=mr.r)(t,e,r,n),we._malloc=t=>(we._malloc=mr.s)(t),we._free=t=>(we._free=mr.t)(t);var PA=(t,e)=>(PA=mr.v)(t,e),Pu;ic=function t(){Pu||BA(),Pu||(ic=t)};function BA(){if(Ds>0||(Vz(),Ds>0))return;function t(){var e;Pu||(Pu=!0,we.calledRun=!0,!Uu&&(Xz(),(e=we.onRuntimeInitialized)===null||e===void 0||e.call(we),Zz()))}we.setStatus?(we.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>we.setStatus(""),1),t()},1)):t()}if(we.run=BA,we.preInit)for(typeof we.preInit=="function"&&(we.preInit=[we.preInit]);we.preInit.length>0;)we.preInit.pop()();we.init=s7;var b7=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const w7=new Promise(t=>{we.onRuntimeInitialized=t}),v7=()=>b7(void 0,void 0,void 0,function*(){yield w7}),$A=t=>{const e=we._ZSTD_isError;return e(t)},E7=(t,e)=>{const r=we._ZSTD_getFrameContentSize;return r(t,e)},k7=(t,e={defaultHeapSize:1024*1024})=>{const r=we._malloc,n=r(t.byteLength);we.HEAP8.set(t,n);const i=E7(n,t.byteLength),s=i===-1?e.defaultHeapSize:i,o=we._free,a=r(s);try{const c=we._ZSTD_decompress,l=c(a,s,n,t.byteLength);if($A(l))throw new Error(`Failed to compress with code ${l}`);const u=new Uint8Array(we.HEAPU8.buffer,a,l).slice();return o(a,s),o(n,t.byteLength),u}catch(c){throw o(a,s),o(n,t.byteLength),c}},x7=t=>{const e=we._ZSTD_compressBound;return e(t)},A7=(t,e)=>{const r=x7(t.byteLength),n=we._malloc,i=n(r),s=n(t.byteLength);we.HEAP8.set(t,s);const o=we._free;try{const a=we._ZSTD_compress,c=a(i,r,s,t.byteLength,e??3);if($A(c))throw new Error(`Failed to compress with code ${c}`);const l=new Uint8Array(we.HEAPU8.buffer,i,c).slice();return o(i,r),o(s,t.byteLength),l}catch(a){throw o(i,r),o(s,t.byteLength),a}};var T7=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const S7=t=>T7(void 0,void 0,void 0,function*(){const e=new URL("/assets/zstd-CV7N7xSg.wasm",self.location.href).href;we.init(e),yield v7()});let DA=!1;async function jA(){DA||(await S7(),DA=!0)}function R7(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-e.length%4)%4);return e+r}function O7(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const I7=new Date("1980/09/02");async function j0(t){await jA(),console.info("saved",t);const e=new U0;for(let n=0;n<t.length;++n){const i=t[n],s=lF(i);if(s){const o=kN(s);if(v(o)){const a=A7(o,15);e.file(i.id,a,{date:I7})}}}const r=await e.generateAsync({type:"base64",compression:"STORE"});return O7(r)}async function N7(t){await jA();const e=R7(t),r=await U0.loadAsync(e,{base64:!0}),n=[],i=[];r.forEach((s,o)=>i.push(o));for(let s=0;s<i.length;++s){const o=i[s],a=await o.async("uint8array");if(v(a))try{const c=k7(a),l=Sh(c);if(v(l)){const u=Dd(l);v(u)&&n.push(u)}}catch{const l=Sh(a);if(v(l)){const u=Dd(l);v(u)&&n.push(u)}}else{const c=await o.async("string"),l=Sh(c);if(v(l)){const u=Dd(l);v(u)&&n.push(u)}}}return n}function C7(t,e,r,n){const i=Ht(t);if(!v(i))return;let s=0;function o(){return s}function a(l,u){Te(u)&&(s=u,my(e.x,e.y,r.x,r.y).forEach(h=>{const d=it(i,h);v(d)&&(d[l]=u)}))}Pe(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,`batch:${ao(e,r)}`,"char",[n,"charedit"],o,a);const c=Rt(t);c.scrollname="bulk set char",c.scroll=tr(t)}function L7(t,e,r,n){const i=Ht(t);if(!v(i))return;let s=0;function o(){return s}function a(l,u){if(Te(u)){s=u;for(let h=e.y;h<=r.y;++h)for(let d=e.x;d<=r.x;++d){const f=it(i,{x:d,y:h});v(f)&&(f[l]=u)}}}Pe(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,`batch:${ao(e,r)}`,"color",[n,"coloredit"],o,a);const c=Rt(t);c.scrollname="bulk set color",c.scroll=tr(t)}function M7(t,e,r,n){const i=Ht(t);if(!v(i))return;let s=0;function o(){return s}function a(l,u){Te(u)&&(s=u,my(e.x,e.y,r.x,r.y).forEach(h=>{const d=it(i,h);v(d)&&(d[l]=u)}))}Pe(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,`batch:${ao(e,r)}`,"color",[n,"coloredit"],o,a);const c=Rt(t);c.scrollname="bulk set bg",c.scroll=tr(t)}function U7(t,e,r,n){const i=lr(Ze.MAIN);if(!v(i))return;const s=Ht(t);if(!v(s))return;const o=ao(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),De(t,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),n&&De(t,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),De(t,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),De(t,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Pe(t,qt),De(t,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),De(t,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),De(t,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Pe(t,qt),De(t,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Pe(t,qt),Pe(t,"codepages:");const a=Math.min(e.x,r.x),c=Math.min(e.y,r.y),l=Math.max(e.x,r.x),u=Math.max(e.y,r.y),h=new Set;for(let f=c;f<=u;++f)for(let m=a;m<=l;++m){const p=it(s,{x:m,y:f}),g=vE(i,p);v(g)&&!h.has(g.id)&&(h.add(g.id),De(t,"batch",`edit @${gt(g)}`,[`pageopen:${g.id}`]))}const d=ur(Re.BOARD,s.id);Pe(t,gt(d)),De(t,"batch",`id ${s.id}`,["","copyit",s.id]),De(t,"batch","edit @board codepage",[`pageopen:${s.id}`])}function z0(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function F7(t,e){let r;const n=()=>{if(r)return r;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),r=z0(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(e,i).objectStore(e)))}let W0;function zA(){return W0||(W0=F7("keyval-store","keyval")),W0}function WA(t,e=zA()){return e("readonly",r=>z0(r.get(t)))}function HA(t,e,r=zA()){return r("readwrite",n=>new Promise((i,s)=>{n.get(t).onsuccess=function(){try{n.put(e(this.result),t),i(z0(n.transaction))}catch(o){s(o)}}}))}function H0(t,e){return`${t.x},${t.y},${e.x},${e.y}`}async function GA(){return WA("secretheap")}async function KA(t){return HA("secretheap",t)}async function P7(){return!!await GA()}function qA(t,e,r){const n=Math.min(e.x,r.x),i=Math.min(e.y,r.y),s=Math.max(e.x,r.x),o=Math.max(e.y,r.y),a=s-n+1,c=o-i+1,l=[],u=[];for(let h=i;h<=o;++h)for(let d=n;d<=s;++d){const f={x:d-n,y:h-i},m=it(t,{x:d,y:h});m?.category===Ur.ISOBJECT?(l.push(xn(Zi(t,d,h))),ar(m).name!=="player"&&u.push({...xn(m),...f,id:"blank"})):l.push({...xn(m),...f})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}async function B7(t,e,r,n){const i=Ht(t);if(!v(i))return;const s=qA(i,e,r);switch(n){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await KA(()=>s)}function $7(t,e,r){const n=H0(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","copy terrain & objects",[`copyall:${n}`,"hk","1"]),De(t,"batch","copy objects",[`copyobjects:${n}`,"hk","2"]),De(t,"batch","copy terrain",[`copyterrain:${n}`,"hk","3"]);const i=Rt(t);i.scrollname="copy",i.scroll=tr(t)}async function D7(t,e,r,n){const i=lr(Ze.MAIN);if(!v(i))return;const s=Ht(t);if(!v(s))return;const o=qA(s,e,r);switch(n){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(n){case"cutall":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c){const l=it(s,{x:c,y:a});l?.category===Ur.ISOBJECT&&dr(s,l,i.timestamp),St(s,{x:c,y:a})}break}case"cutobjects":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c){const l=it(s,{x:c,y:a});l?.category===Ur.ISOBJECT&&dr(s,l,i.timestamp)}break}case"cutterrain":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c)St(s,{x:c,y:a});break}}await KA(()=>o)}function j7(t,e,r){const n=H0(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","cut terrain & objects",[`cutall:${n}`,"hk","1"]),De(t,"batch","cut objects",[`cutobjects:${n}`,"hk","2"]),De(t,"batch","cut terrain",[`cutterrain:${n}`,"hk","3"]);const i=Rt(t);i.scrollname="cut",i.scroll=tr(t)}async function z7(t,e,r,n){const i=Ht(t),s=await GA();if(!v(i)||!v(s))return;const o=Math.min(e.x,r.x),a=Math.min(e.y,r.y),c=Math.max(e.x,r.x),l=Math.max(e.y,r.y),u=c-o+1,h=l-a+1,d=Math.min(s.width,u),f=Math.min(s.height,h);switch(n){case"pasteall":{for(let m=0;m<f;++m)for(let p=0;p<d;++p){const g=Pr({x:p,y:m},s.width);St(i,{...s.terrain[g],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];v(p.x)&&v(p.y)&&sh(p.x,p.y,0,u-1,h-1,0)&&O0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];v(p.x)&&v(p.y)&&sh(p.x,p.y,0,u-1,h-1,0)&&O0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<f;++m)for(let p=0;p<d;++p){const g=Pr({x:p,y:m},s.width);St(i,{...s.terrain[g],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const g=(p-o)%s.width,y=(m-a)%s.height,b=Pr({x:g,y},s.width);St(i,{...s.terrain[b],x:p,y:m})}break}}function W7(t,e,r){const n=H0(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","paste terrain & objects",[`pasteall:${n}`,"hk","1"]),De(t,"batch","paste objects",[`pasteobjects:${n}`,"hk","2"]),De(t,"batch","paste terrain",[`pasteterrain:${n}`,"hk","3"]),De(t,"batch","paste terrain tiled",[`pasteterraintiled:${n}`,"hk","4"]);const i=Rt(t);i.scrollname="paste",i.scroll=tr(t)}function G0(t,e){return`inspect:${e?.id?e.id:Ni(t,e)}`}function H7(t,e,r){const n=lr(Ze.MAIN);if(!v(n))return;const i=Ht(t);if(!v(i))return;function s(d){return e?.[d]??e?.kinddata?.[d]??0}function o(d,f){v(e)&&(e[d]=f)}const a=e.category===Ur.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=G0(i,e);Pe(t,`${a}: ${c} ${l}`),Pe(t,qt),De(t,u,"color",[r,"coloredit"],s,o);const h=Rt(t);h.scrollname="color",h.scroll=tr(t)}function G7(t,e,r){const n=lr(Ze.MAIN);if(!v(n))return;const i=Ht(t);if(!v(i))return;function s(d){return e?.[d]??e?.kinddata?.[d]??0}function o(d,f){v(e)&&(e[d]=f)}const a=e.category===Ur.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=G0(i,e);Pe(t,`${a}: ${c} ${l}`),Pe(t,qt),De(t,u,"char",[r,"charedit"],s,o);const h=Rt(t);h.scrollname="char",h.scroll=tr(t)}function K7(t,e,r,n,i,s){const o=lr(Ze.MAIN);if(!v(o))return;function a(m){const p=n?.[m]??n?.kinddata?.[m];if(!v(p))switch(m){case"color":return 15;case"bg":return 0;case"cycle":return Sm;case"collision":return We.ISWALK;case"pushable":return 0;case"breakable":return 0}return p}function c(m,p){v(n)&&(n[m]=p)}s?Pe(t,`object: ${n.name??n.kind??"ERR"} ${i.x}, ${i.y}`):Pe(t,`terrain: ${n.kind??"ERR"} ${i.x}, ${i.y}`);const l=G0(e,n);switch(s&&Pe(t,`cycle: ${He(n,"cycle")}`),He(n,"collision")){case We.ISWALK:Pe(t,"collision: iswalk");break;case We.ISSWIM:Pe(t,"collision: isswim");break;case We.ISSOLID:Pe(t,"collision: issolid");break;case We.ISBULLET:Pe(t,"collision: isbullet");break;case We.ISGHOST:Pe(t,"collision: isghost");break}s&&Pe(t,`ispushable: ${He(n,"pushable")?"yes":"no"}`),Pe(t,`isbreakable: ${He(n,"breakable")?"yes":"no"}`),Pe(t,qt);const h=ja(r),d=Mr(h);for(let m=0;m<d.length;++m){const p=d[m];switch(p){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ut(h[p])){const[g,y,...b]=h[p];be(y)&&De(t,l,y||p,[p,g,...b],a,c)}break}}De(t,l,"copy coords",["copycoords","hk","5"," 5 "]),Pe(t,qt),De(t,l,`char: ${n.char??n.kinddata?.char??1}`,["char","hk","a"," A ","next"],a,c),De(t,l,`color: ${n.color??n.kinddata?.color??15}`,["color","hk","c"," C ","next"],a,c),De(t,l,`bg: ${n.bg??n.kinddata?.bg??0}`,["bg","hk","b"," B ","next"],a,c),Pe(t,qt),De(t,l,"make empty",["empty","hk","0"],a,c),Pe(t,qt),De(t,"batch",`edit @${gt(r)}`,[`pageopen:${r.id}`]);const f=ur(Re.BOARD,e.id);Pe(t,gt(f)),De(t,"batch",`id ${e.id}`,["","copyit",e.id]),De(t,"batch","edit @board codepage",[`pageopen:${e.id}`])}function q7(t,e,r,n){const i=lr(Ze.MAIN);if(!v(i))return;const s=Ht(t);if(v(s))switch(n){case"emptyall":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a){const c=it(s,{x:a,y:o});c?.category===Ur.ISOBJECT&&dr(s,c,i.timestamp),St(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a){const c=it(s,{x:a,y:o});c?.category===Ur.ISOBJECT&&dr(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a)St(s,{x:a,y:o});break}}}function Y7(t,e,r){const n=lr(Ze.MAIN);if(!v(n))return;const i=Ht(t);if(!v(i))return;const s=ao(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),De(t,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),De(t,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Rt(t);o.scrollname="empty",o.scroll=tr(t)}async function V7(t,e,r){const n=lr(Ze.MAIN),i=await P7();if(!v(n))return;const s=Ht(t);if(!v(s))return;if(cr(s),e.x===r.x&&e.y===r.y){const a=it(s,e),c=vE(n,a);if(v(a)&&v(c)&&K7(t,s,c,a,e,jt(a)),!a?.kind){Pe(t,`empty: ${e.x}, ${e.y}`),Pe(t,qt),De(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]);const l=ur(Re.BOARD,s.id);Pe(t,gt(l)),De(t,"batch",`id ${s.id}`,["","copyit",s.id]),De(t,"batch","edit @board codepage",[`pageopen:${s.id}`])}}else U7(t,e,r,i);const o=Rt(t);o.scrollname="inspect",o.scroll=tr(t)}function X7(t,e){const r=dt(Ze.MAIN);if(!v(r))return;const n=Ht(e);if(!v(n))return;const i=Fr(t),s=dA(n,i.target);if(v(s))switch(i.path){case"copycoords":uf(le,wr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":H7(e,s,i.path);break;case"char":G7(e,s,i.path);break;case"empty":dr(n,s,r.timestamp);break;case"code":Yr(le,e,async()=>{const o="object",a=[n.id,s.id];ih(uc(r.id,a),s.code??""),tS(le,e),await hc(800),xm(le,e,r.id,a,o,`${name} - ${r.name}`)});break;default:console.info("unknown inspect",i);break}}async function Z7(t,e){const r=Ht(e);if(!v(r))return;const n=Fr(t),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"copy":$7(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await B7(e,c,l,n.target);break;case"cut":j7(e,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await D7(e,c,l,n.target);break;case"paste":W7(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await z7(e,c,l,n.target);break;case"empty":Y7(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":q7(e,c,l,n.target);break;case"chars":C7(e,c,l,"char");break;case"colors":L7(e,c,l,"color");break;case"bgs":M7(e,c,l,"bg");break;case"copycoords":uf(le,e,[i,s,o,a].join(" "));break;case"pageopen":Yr(le,e,async()=>{await hc(800),OS(le,e,`#pageopen ${n.path}`)});break;default:console.info("unknown batch",n);break}}async function J7(){return WA("remixconfig")}async function Q7(t){return HA("remixconfig",t)}let Qi={stat:"",patternsize:2,mirror:1};async function eW(t,e){const r=Ht(e);if(!v(r))return;const n=Fr(t),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"remix":{await tW(e,c,l);break}case"remixrun":{const u=fr(Qi.stat);v(u)&&bk(r.id,u.id,Qi.patternsize,Qi.mirror,c,l,"all"),await Q7(()=>Qi);break}default:console.info("unknown remix",n);break}}async function tW(t,e,r){const n=await J7();Qi={...Qi,...n};const i=ao(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt);function s(c){const{target:l}=Fr(c);return Qi[l]}function o(c,l){if(Te(l)||be(l)){const{target:u}=Fr(c);Qi[u]=l}}De(t,"remix","source board",[`stat:${i}`,"text"],s,o),De(t,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),De(t,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Pe(t,qt),De(t,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Rt(t);a.scrollname="remix",a.scroll=tr(t)}const rW=16,es={},Bu={},nW=60;let YA=0;const zo={},$u={};async function VA(t){const e=wn(),r=dt(Ze.MAIN);if(e.length&&v(r)){const n=await j0(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${r.name} ${n.length} chars`;iS(rt,wr(),i,n)}}async function iW(){const t=wn(),e=dt(Ze.MAIN);if(t.length&&v(e)){const r=await j0(t);sS(rt,wr(),r)}}async function sW(){const t=wn(),e=dt(Ze.MAIN);return t.length&&v(e)?j0(t):""}const XA="$176$176$177$177$178 ZZT BRIDGE $178$177$177$176$176";function ZA(t){Pe(t,`Searching ${"$6".repeat(fn(1,6))}`);const e=Rt(t);e.scrollname=XA,e.scroll=tr(t)}function JA(t,e){for(let n=0;n<t.length;++n){const i=t[n],s=`pub: ${new Date(i.publish_date).toLocaleDateString()}`;Pe(e,`$white${i.title}`),Pe(e,`$yellow  ${i.author.join(", ")}`),Pe(e,`$dkgreen  ${i.genres.join(", ")}`),Pe(e,`$purple  ${s}`),i.screenshot&&De(e,"zztbridge",i.screenshot,["screenshot","viewit",Kz(i.screenshot)]),De(e,"zztbridge",i.filename,["zztimport","hyperlink",`${i.letter}/${i.filename}`]),Pe(e," ")}const r=Rt(e);r.scrollname=XA,r.scroll=tr(e)}const Du={},rt=Ws("vm",["tick","second"],t=>{if(!rt.session(t))return;const e=wr();switch(t.target){case"operator":qj(t.player),Pt(rt,t.player,`operator set to ${t.player}`),rt.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=dt(Ze.MAIN);rt.replynext(t,"ackzsswords",{cli:mp(Yi.CLI),loader:mp(Yi.LOADER),runtime:mp(Yi.RUNTIME),flags:[...Mr(qr(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","playerid","playerx","playery","thisid","thisx","thisy","senderid","senderx","sendery","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isghost","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"],kinds:[...Rs(r,Re.OBJECT).map(n=>gt(n)),...Mr(cp)],altkinds:[...Rs(r,Re.TERRAIN),...Rs(r,Re.BOARD),...Rs(r,Re.PALETTE),...Rs(r,Re.CHARSET),...Rs(r,Re.LOADER)].map(n=>gt(n)),colors:[...Mr(fa)],dirs:[...Mr(hh).filter(n=>["cw","ccw","oop","rndp"].includes(n)===!1)],dirmods:["cw","ccw","oop","rndp",...Mr(op)],exprs:["aligned","alligned","contact","blocked","any","countof","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":t.player===e&&Yr(rt,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data,i=await N7(r),s=i.map(o=>o.name);ez(i,n),Pt(rt,t.player,`loading ${s.join(", ")}`),lf(rt,t.player)}});break;case"search":nz(t.player)||lf(rt,t.player);break;case"logout":rz(t.player),delete es[t.player],Pt(rt,e,`player ${t.player} logout`),lf(rt,t.player);break;case"login":nA(t.player)?(rS(rt,t.player),es[t.player]=0,Pt(rt,wr(),`login from ${t.player}`),rt.replynext(t,"acklogin",!0)):wm(rt,t.player);break;case"local":nA(t.player)?(es[t.player]=0,Pt(rt,wr(),`login from ${t.player}`)):wm(rt,t.player);break;case"doot":es[t.player]=0,Bu[t.player]=Bu[t.player]??0,Bu[t.player]%32===0&&Pt(rt,t.player,`$whiteactive $blue${t.player}`),++Bu[t.player];break;case"input":{if(t.player.includes("local")&&!tA(t.player)&&SS(rt,t.player),!t.player.includes("local")||tA(t.player)){const r=qr(t.player),[n=Sr.NONE,i=0]=t.data??[Sr.NONE,0];ut(r.inputqueue)||(r.inputqueue=[]),n!==Sr.NONE&&r.inputqueue.push([n,i])}break}case"codewatch":if(ut(t.data)){const[r,n]=t.data,i=uc(r,n);v($u[i])||($u[i]=uy(i,s=>{const[o,a]=n,c=Bn(r),l=Ss(c,o);if(v(l))if(ai(l)===Re.BOARD&&v(a)){const u=At(l),h=hr(u,a);v(h)&&(h.code=s,Ql(Zl(s),h))}else l.code=s,oF(l)})),zo[i]=zo[i]??new Set,zo[i].add(t.player)}break;case"coderelease":if(ut(t.data)){const[r,n]=t.data,[,i]=n,s=uc(r,n);v(zo[s])&&(zo[s].delete(t.player),zo[s].size===0&&($u[s]?.(),$u[s]=void 0,be(i)&&az(i)))}break;case"halt":t.player===e&&jT(t.data)&&Yj(t.data);break;case"tick":{lz(Vj());const r=Mr(Du);for(let n=0;n<r.length;++n){const i=r[n];--Du[i]}break}case"synthsend":if(be(t.data)){const r=t.data,[n,i]=Yz(r),s=Du[r];if(!v(s)||s<=0){Du[r]=2;const o=dt(Ze.MAIN);Uo(n,i,void 0,Ao(o))}}break;case"second":{iz(es);const r=Object.keys(es);for(let n=0;n<r.length;++n)++es[r[n]];for(let n=0;n<r.length;++n){const i=r[n];es[i]>=rW&&hf(rt,i)}++YA>=nW&&(YA=0,Yr(rt,t.player,async()=>{await VA(!0)}));break}case"copyjsonfile":if(t.player===e){const r=dt(Ze.MAIN);if(v(r)&&ut(t.data)){const[n]=t.data,i=Ss(r,n);v(i)&&aS(rt,e,i,`${gt(i)}.${Ai(i)}.json`)}}break;case"refscroll":{sp(ip("refscroll:menu"),n=>ZE(t.player,n));const r=Rt(t.player);r.scrollname="refscroll",r.scroll=tr(t.player);break}case"readzipfilelist":{const r=Dz();Pe(t.player,"$CENTER Select Files"),De(t.player,"zipfilelist","import selected",["importfiles"]);for(let i=0;i<r.length;++i){const[s,o]=r[i];s&&(Pe(t.player,o),De(t.player,"zipfilelist",`[${s}]`,[$e(o),"select","NO","0","YES","1"],a=>zz(a)?1:0,(a,c)=>{jz(a,!!c)}))}const n=Rt(t.player);n.scrollname="zipfilelist",n.scroll=tr(t.player);break}case"fork":t.player===e&&Yr(rt,t.player,async()=>{await iW()});break;case"zztsearch":Yr(rt,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data;let i=0;const s=[];for(;s.length<256;){ZA(t.player);const o=await Hz(r,n,i);if(i+=o.length,s.push(...o),o.length<25)break}JA(s,t.player)}});break;case"zztrandom":Yr(rt,t.player,async()=>{ZA(t.player);const r=await Gz();JA(r,t.player)});break;case"itchiopublish":Yr(rt,t.player,async()=>{if(t.player===e){const r=dt(Ze.MAIN);if(v(r)){const n=await sW();oS(rt,t.player,r.name,n)}}});break;case"flush":t.player===e&&Yr(rt,t.player,async()=>{await VA()});break;case"cli":oA(t.player,t.data);break;case"clirepeatlast":uz(t.player);break;case"restart":t.player===e&&(cz(),Tm(rt,t.player));break;case"inspect":Yr(rt,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data;await V7(t.player,r,n)}});break;case"loader":if(ut(t.data)){const[r,n,i,s]=t.data;switch(n){case"file":P0(t.player,s);break;case"json":if(/file:.*\.book.json/.test(i)){Pt(rt,t.player,`loading ${i}`);const o=JSON.parse(s.json);v(o.data)&&be(o.exported)&&(xu(o.data),Pt(rt,t.player,`loaded ${o.exported}`))}else if(/file:.*\..*\.codepage.json/.test(i)){Pt(rt,t.player,`loading ${i}`);const o=JSON.parse(s.json),a=dt(Ze.MAIN);v(a)&&v(o.data)&&be(o.exported)&&(ko(a,o.data),Pt(rt,t.player,`loaded ${o.exported}`))}else sk(r,n,i,s,t.player);break;default:sk(r,n,i,s,t.player);break}}break;default:{const{target:r,path:n}=Fr(t.target);switch($e(r)){case"refscroll":switch(n){case"charscroll":{De(t.player,"refscroll","char",["char","charedit"]);const i=Rt(t.player);i.scrollname="chars",i.scroll=tr(t.player);break}case"colorscroll":{De(t.player,"refscroll","color",["color","coloredit"]);const i=Rt(t.player);i.scrollname="colors",i.scroll=tr(t.player);break}default:{sp(ip(`refscroll:${n}`),s=>ZE(t.player,s));const i=Rt(t.player);i.scrollname=n,i.scroll=tr(t.player);break}}break;case"batch":Yr(rt,t.player,async()=>{await Z7(n,t.player)});break;case"remix":Yr(rt,t.player,async()=>{await eW(n,t.player)});break;case"empty":{const i=Fr(n);switch(i.target){case"copycoords":uf(rt,wr(),i.path.split(",").join(" "));break}break}case"inspect":X7(n,t.player);break;case"touched":if(ut(t.data)){const[i,s,o]=t.data;iA({...t,target:`${s}:${o}`,data:void 0,sender:i})}break;case"zztbridge":Yr(rt,t.player,async()=>{be(t.data)&&await qz(t.player,t.data)});break;case"zipfilelist":Yr(rt,t.player,async()=>{await Wz(t.player)});break;default:{const i=Fr(n);if($e(i.target)==="self"||!i.path)t.target=t.target.replace("self:",""),iA(t);else{const s=dt(Ze.MAIN);Uo(i.target,i.path,void 0,Ao(s))}break}}break}}},Kj());function oW(){nS(rt)}const{forward:aW}=FS(t=>{PS(t)&&postMessage(t)});onmessage=function(e){aW(e.data)},setTimeout(oW,100)})();

var Koe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var tYe=Koe((nf,rf)=>{function Xoe(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var qf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _u(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function VW(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var e3={exports:{}},$x={};var gB;function Joe(){if(gB)return $x;gB=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return $x.Fragment=e,$x.jsx=n,$x.jsxs=n,$x}var _B;function Zoe(){return _B||(_B=1,e3.exports=Joe()),e3.exports}var Ee=Zoe();function Qoe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var HW={exports:{}},Na=HW.exports={},hm,fm;function hD(){throw new Error("setTimeout has not been defined")}function fD(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?hm=setTimeout:hm=hD}catch{hm=hD}try{typeof clearTimeout=="function"?fm=clearTimeout:fm=fD}catch{fm=fD}})();function $W(t){if(hm===setTimeout)return setTimeout(t,0);if((hm===hD||!hm)&&setTimeout)return hm=setTimeout,setTimeout(t,0);try{return hm(t,0)}catch{try{return hm.call(null,t,0)}catch{return hm.call(this,t,0)}}}function eae(t){if(fm===clearTimeout)return clearTimeout(t);if((fm===fD||!fm)&&clearTimeout)return fm=clearTimeout,clearTimeout(t);try{return fm(t)}catch{try{return fm.call(null,t)}catch{return fm.call(this,t)}}}var _g=[],lE=!1,r1,rk=-1;function tae(){!lE||!r1||(lE=!1,r1.length?_g=r1.concat(_g):rk=-1,_g.length&&GW())}function GW(){if(!lE){var t=$W(tae);lE=!0;for(var e=_g.length;e;){for(r1=_g,_g=[];++rk<e;)r1&&r1[rk].run();rk=-1,e=_g.length}r1=null,lE=!1,eae(t)}}Na.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];_g.push(new WW(t,e)),_g.length===1&&!lE&&$W(GW)};function WW(t,e){this.fun=t,this.array=e}WW.prototype.run=function(){this.fun.apply(null,this.array)};Na.title="browser";Na.browser=!0;Na.env={};Na.argv=[];Na.version="";Na.versions={};function Ng(){}Na.on=Ng;Na.addListener=Ng;Na.once=Ng;Na.off=Ng;Na.removeListener=Ng;Na.removeAllListeners=Ng;Na.emit=Ng;Na.prependListener=Ng;Na.prependOnceListener=Ng;Na.listeners=function(t){return[]};Na.binding=function(t){throw new Error("process.binding is not supported")};Na.cwd=function(){return"/"};Na.chdir=function(t){throw new Error("process.chdir is not supported")};Na.umask=function(){return 0};var nae=HW.exports;const sf=Qoe(nae);var t3={exports:{}},ni={},vB;function rae(){if(vB)return ni;vB=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.for("react.activity"),f=Symbol.iterator;function d(H){return H===null||typeof H!="object"?null:(H=f&&H[f]||H["@@iterator"],typeof H=="function"?H:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(H,Y,Z){this.props=H,this.context=Y,this.refs=g,this.updater=Z||p}_.prototype.isReactComponent={},_.prototype.setState=function(H,Y){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,Y,"setState")},_.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function y(){}y.prototype=_.prototype;function v(H,Y,Z){this.props=H,this.context=Y,this.refs=g,this.updater=Z||p}var E=v.prototype=new y;E.constructor=v,m(E,_.prototype),E.isPureReactComponent=!0;var x=Array.isArray;function A(){}var T={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function L(H,Y,Z){var Q=Z.ref;return{$$typeof:t,type:H,key:Y,ref:Q!==void 0?Q:null,props:Z}}function I(H,Y){return L(H.type,Y,H.props)}function F(H){return typeof H=="object"&&H!==null&&H.$$typeof===t}function M(H){var Y={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(Z){return Y[Z]})}var D=/\/+/g;function O(H,Y){return typeof H=="object"&&H!==null&&H.key!=null?M(""+H.key):Y.toString(36)}function z(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(A,A):(H.status="pending",H.then(function(Y){H.status==="pending"&&(H.status="fulfilled",H.value=Y)},function(Y){H.status==="pending"&&(H.status="rejected",H.reason=Y)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function q(H,Y,Z,Q,ie){var ge=typeof H;(ge==="undefined"||ge==="boolean")&&(H=null);var Te=!1;if(H===null)Te=!0;else switch(ge){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(H.$$typeof){case t:case e:Te=!0;break;case u:return Te=H._init,q(Te(H._payload),Y,Z,Q,ie)}}if(Te)return ie=ie(H),Te=Q===""?"."+O(H,0):Q,x(ie)?(Z="",Te!=null&&(Z=Te.replace(D,"$&/")+"/"),q(ie,Y,Z,"",function(Ge){return Ge})):ie!=null&&(F(ie)&&(ie=I(ie,Z+(ie.key==null||H&&H.key===ie.key?"":(""+ie.key).replace(D,"$&/")+"/")+Te)),Y.push(ie)),1;Te=0;var be=Q===""?".":Q+":";if(x(H))for(var Pe=0;Pe<H.length;Pe++)Q=H[Pe],ge=be+O(Q,Pe),Te+=q(Q,Y,Z,ge,ie);else if(Pe=d(H),typeof Pe=="function")for(H=Pe.call(H),Pe=0;!(Q=H.next()).done;)Q=Q.value,ge=be+O(Q,Pe++),Te+=q(Q,Y,Z,ge,ie);else if(ge==="object"){if(typeof H.then=="function")return q(z(H),Y,Z,Q,ie);throw Y=String(H),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return Te}function G(H,Y,Z){if(H==null)return H;var Q=[],ie=0;return q(H,Q,"","",function(ge){return Y.call(Z,ge,ie++)}),Q}function K(H){if(H._status===-1){var Y=H._result;Y=Y(),Y.then(function(Z){(H._status===0||H._status===-1)&&(H._status=1,H._result=Z)},function(Z){(H._status===0||H._status===-1)&&(H._status=2,H._result=Z)}),H._status===-1&&(H._status=0,H._result=Y)}if(H._status===1)return H._result.default;throw H._result}var te=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(Y))return}else if(typeof sf=="object"&&typeof sf.emit=="function"){sf.emit("uncaughtException",H);return}console.error(H)},re={map:G,forEach:function(H,Y,Z){G(H,function(){Y.apply(this,arguments)},Z)},count:function(H){var Y=0;return G(H,function(){Y++}),Y},toArray:function(H){return G(H,function(Y){return Y})||[]},only:function(H){if(!F(H))throw Error("React.Children.only expected to receive a single React element child.");return H}};return ni.Activity=h,ni.Children=re,ni.Component=_,ni.Fragment=n,ni.Profiler=i,ni.PureComponent=v,ni.StrictMode=r,ni.Suspense=c,ni.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,ni.__COMPILER_RUNTIME={__proto__:null,c:function(H){return T.H.useMemoCache(H)}},ni.cache=function(H){return function(){return H.apply(null,arguments)}},ni.cacheSignal=function(){return null},ni.cloneElement=function(H,Y,Z){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var Q=m({},H.props),ie=H.key;if(Y!=null)for(ge in Y.key!==void 0&&(ie=""+Y.key),Y)!k.call(Y,ge)||ge==="key"||ge==="__self"||ge==="__source"||ge==="ref"&&Y.ref===void 0||(Q[ge]=Y[ge]);var ge=arguments.length-2;if(ge===1)Q.children=Z;else if(1<ge){for(var Te=Array(ge),be=0;be<ge;be++)Te[be]=arguments[be+2];Q.children=Te}return L(H.type,ie,Q)},ni.createContext=function(H){return H={$$typeof:o,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:s,_context:H},H},ni.createElement=function(H,Y,Z){var Q,ie={},ge=null;if(Y!=null)for(Q in Y.key!==void 0&&(ge=""+Y.key),Y)k.call(Y,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(ie[Q]=Y[Q]);var Te=arguments.length-2;if(Te===1)ie.children=Z;else if(1<Te){for(var be=Array(Te),Pe=0;Pe<Te;Pe++)be[Pe]=arguments[Pe+2];ie.children=be}if(H&&H.defaultProps)for(Q in Te=H.defaultProps,Te)ie[Q]===void 0&&(ie[Q]=Te[Q]);return L(H,ge,ie)},ni.createRef=function(){return{current:null}},ni.forwardRef=function(H){return{$$typeof:a,render:H}},ni.isValidElement=F,ni.lazy=function(H){return{$$typeof:u,_payload:{_status:-1,_result:H},_init:K}},ni.memo=function(H,Y){return{$$typeof:l,type:H,compare:Y===void 0?null:Y}},ni.startTransition=function(H){var Y=T.T,Z={};T.T=Z;try{var Q=H(),ie=T.S;ie!==null&&ie(Z,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(A,te)}catch(ge){te(ge)}finally{Y!==null&&Z.types!==null&&(Y.types=Z.types),T.T=Y}},ni.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},ni.use=function(H){return T.H.use(H)},ni.useActionState=function(H,Y,Z){return T.H.useActionState(H,Y,Z)},ni.useCallback=function(H,Y){return T.H.useCallback(H,Y)},ni.useContext=function(H){return T.H.useContext(H)},ni.useDebugValue=function(){},ni.useDeferredValue=function(H,Y){return T.H.useDeferredValue(H,Y)},ni.useEffect=function(H,Y){return T.H.useEffect(H,Y)},ni.useEffectEvent=function(H){return T.H.useEffectEvent(H)},ni.useId=function(){return T.H.useId()},ni.useImperativeHandle=function(H,Y,Z){return T.H.useImperativeHandle(H,Y,Z)},ni.useInsertionEffect=function(H,Y){return T.H.useInsertionEffect(H,Y)},ni.useLayoutEffect=function(H,Y){return T.H.useLayoutEffect(H,Y)},ni.useMemo=function(H,Y){return T.H.useMemo(H,Y)},ni.useOptimistic=function(H,Y){return T.H.useOptimistic(H,Y)},ni.useReducer=function(H,Y,Z){return T.H.useReducer(H,Y,Z)},ni.useRef=function(H){return T.H.useRef(H)},ni.useState=function(H){return T.H.useState(H)},ni.useSyncExternalStore=function(H,Y,Z){return T.H.useSyncExternalStore(H,Y,Z)},ni.useTransition=function(){return T.H.useTransition()},ni.version="19.2.4",ni}var yB;function z4(){return yB||(yB=1,t3.exports=rae()),t3.exports}var Ye=z4();const ch=_u(Ye);const UA="176",iae=0,bB=1,sae=2,oae=0,V4=1,ik=2,lm=3,Ag=0,Ic=1,Oa=2,rl=0,uE=1,SB=2,EB=3,xB=4,aae=5,Zy=100,cae=101,lae=102,uae=103,hae=104,fae=200,dae=201,pae=202,mae=203,dD=204,pD=205,gae=206,_ae=207,vae=208,yae=209,bae=210,Sae=211,Eae=212,xae=213,wae=214,mD=0,qk=1,gD=2,vE=3,_D=4,vD=5,yD=6,bD=7,qW=0,Tae=1,Aae=2,yg=0,Cae=1,Rae=2,kae=3,YW=4,Mae=5,Oae=6,Iae=7,KW=300,yE=301,bE=302,SD=303,ED=304,vO=306,Yk=1e3,i1=1001,xD=1002,Il=1003,Nae=1004,LC=1005,Ml=1006,n3=1007,s1=1008,ko=1009,XW=1010,JW=1011,qT=1012,H4=1013,pv=1014,tp=1015,Av=1016,$4=1017,G4=1018,SE=1020,ZW=35902,QW=1021,eq=1022,lu=1023,YT=1026,EE=1027,BA=1028,W4=1029,q4=1030,Y4=1031,yO=1033,sk=33776,ok=33777,ak=33778,ck=33779,wD=35840,TD=35841,AD=35842,CD=35843,RD=36196,kD=37492,MD=37496,OD=37808,ID=37809,ND=37810,PD=37811,DD=37812,LD=37813,UD=37814,BD=37815,FD=37816,jD=37817,zD=37818,VD=37819,HD=37820,$D=37821,lk=36492,GD=36494,WD=36495,tq=36283,qD=36284,YD=36285,KD=36286,$1=3200,Pae=3201,Dae=0,Lae=1,bm="",Bi="srgb",Cg="srgb-linear",Kk="linear",Bs="srgb",rS=7680,wB=519,Uae=512,Bae=513,Fae=514,nq=515,jae=516,zae=517,Vae=518,Hae=519,TB=35044,pg=35048,AB="300 es",vg=2e3,Xk=2001;class Pg{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const r=n[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const xl=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let CB=1234567;const IT=Math.PI/180,KT=180/Math.PI;function JE(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(xl[t&255]+xl[t>>8&255]+xl[t>>16&255]+xl[t>>24&255]+"-"+xl[e&255]+xl[e>>8&255]+"-"+xl[e>>16&15|64]+xl[e>>24&255]+"-"+xl[n&63|128]+xl[n>>8&255]+"-"+xl[n>>16&255]+xl[n>>24&255]+xl[r&255]+xl[r>>8&255]+xl[r>>16&255]+xl[r>>24&255]).toLowerCase()}function Ni(t,e,n){return Math.max(e,Math.min(n,t))}function K4(t,e){return(t%e+e)%e}function $ae(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function Gae(t,e,n){return t!==e?(n-t)/(e-t):0}function NT(t,e,n){return(1-n)*t+n*e}function Wae(t,e,n,r){return NT(t,e,1-Math.exp(-n*r))}function qae(t,e=1){return e-Math.abs(K4(t,e*2)-e)}function Yae(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function Kae(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function Xae(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Jae(t,e){return t+Math.random()*(e-t)}function Zae(t){return t*(.5-Math.random())}function Qae(t){t!==void 0&&(CB=t);let e=CB+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function ece(t){return t*IT}function tce(t){return t*KT}function nce(t){return(t&t-1)===0&&t!==0}function rce(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ice(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function sce(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),c=o(n/2),l=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),f=o((e-r)/2),d=s((r-e)/2),p=o((r-e)/2);switch(i){case"XYX":t.set(a*u,c*h,c*f,a*l);break;case"YZY":t.set(c*f,a*u,c*h,a*l);break;case"ZXZ":t.set(c*h,c*f,a*u,a*l);break;case"XZX":t.set(a*u,c*p,c*d,a*l);break;case"YXY":t.set(c*d,a*u,c*p,a*l);break;case"ZYZ":t.set(c*p,c*d,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function jS(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function eu(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const rq={DEG2RAD:IT,RAD2DEG:KT,generateUUID:JE,clamp:Ni,euclideanModulo:K4,mapLinear:$ae,inverseLerp:Gae,lerp:NT,damp:Wae,pingpong:qae,smoothstep:Yae,smootherstep:Kae,randInt:Xae,randFloat:Jae,randFloatSpread:Zae,seededRandom:Qae,degToRad:ece,radToDeg:tce,isPowerOfTwo:nce,ceilPowerOfTwo:rce,floorPowerOfTwo:ice,setQuaternionFromProperEuler:sce,normalize:eu,denormalize:jS};class zn{constructor(e=0,n=0){zn.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Ni(this.x,e.x,n.x),this.y=Ni(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Ni(this.x,e,n),this.y=Ni(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ni(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Ni(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pi{constructor(e,n,r,i,s,o,a,c,l){pi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],f=r[2],d=r[5],p=r[8],m=i[0],g=i[3],_=i[6],y=i[1],v=i[4],E=i[7],x=i[2],A=i[5],T=i[8];return s[0]=o*m+a*y+c*x,s[3]=o*g+a*v+c*A,s[6]=o*_+a*E+c*T,s[1]=l*m+u*y+h*x,s[4]=l*g+u*v+h*A,s[7]=l*_+u*E+h*T,s[2]=f*m+d*y+p*x,s[5]=f*g+d*v+p*A,s[8]=f*_+d*E+p*T,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,f=a*c-u*s,d=l*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=f*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=d*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(r3.makeScale(e,n)),this}rotate(e){return this.premultiply(r3.makeRotation(-e)),this}translate(e,n){return this.premultiply(r3.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const r3=new pi;function iq(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function XT(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function oce(){const t=XT("canvas");return t.style.display="block",t}const RB={};function uk(t){t in RB||(RB[t]=!0,console.warn(t))}function ace(t,e,n){return new Promise(function(r,i){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:i();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:r()}}setTimeout(s,n)})}function cce(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function lce(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const kB=new pi().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),MB=new pi().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function uce(){const t={enabled:!0,workingColorSpace:Cg,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Bs&&(i.r=bg(i.r),i.g=bg(i.g),i.b=bg(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Bs&&(i.r=hE(i.r),i.g=hE(i.g),i.b=hE(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===bm?Kk:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[Cg]:{primaries:e,whitePoint:r,transfer:Kk,toXYZ:kB,fromXYZ:MB,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Bi},outputColorSpaceConfig:{drawingBufferColorSpace:Bi}},[Bi]:{primaries:e,whitePoint:r,transfer:Bs,toXYZ:kB,fromXYZ:MB,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Bi}}}),t}const Xi=uce();function bg(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function hE(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let iS;class hce{static getDataURL(e,n="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{iS===void 0&&(iS=XT("canvas")),iS.width=e.width,iS.height=e.height;const i=iS.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=iS}return r.toDataURL(n)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=XT("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=bg(s[o]/255)*255;return r.putImageData(i,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(bg(n[r]/255)*255):n[r]=bg(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let fce=0,X4=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:fce++}),this.uuid=JE(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(i3(i[o].image)):s.push(i3(i[o]))}else s=i3(i);r.url=s}return n||(e.images[this.uuid]=r),r}};function i3(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?hce.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let dce=0;class hc extends Pg{constructor(e=hc.DEFAULT_IMAGE,n=hc.DEFAULT_MAPPING,r=i1,i=i1,s=Ml,o=s1,a=lu,c=ko,l=hc.DEFAULT_ANISOTROPY,u=bm){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:dce++}),this.uuid=JE(),this.name="",this.source=new X4(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new zn(0,0),this.repeat=new zn(1,1),this.center=new zn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isTextureArray=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isTextureArray=e.isTextureArray,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==KW)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Yk:e.x=e.x-Math.floor(e.x);break;case i1:e.x=e.x<0?0:1;break;case xD:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Yk:e.y=e.y-Math.floor(e.y);break;case i1:e.y=e.y<0?0:1;break;case xD:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}hc.DEFAULT_IMAGE=null;hc.DEFAULT_MAPPING=KW;hc.DEFAULT_ANISOTROPY=1;class qo{constructor(e=0,n=0,r=0,i=1){qo.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,i){return this.x=e,this.y=n,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*n+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*n+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*n+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*n+o[7]*r+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,i,s;const c=e.elements,l=c[0],u=c[4],h=c[8],f=c[1],d=c[5],p=c[9],m=c[2],g=c[6],_=c[10];if(Math.abs(u-f)<.01&&Math.abs(h-m)<.01&&Math.abs(p-g)<.01){if(Math.abs(u+f)<.1&&Math.abs(h+m)<.1&&Math.abs(p+g)<.1&&Math.abs(l+d+_-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const v=(l+1)/2,E=(d+1)/2,x=(_+1)/2,A=(u+f)/4,T=(h+m)/4,k=(p+g)/4;return v>E&&v>x?v<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(v),i=A/r,s=T/r):E>x?E<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(E),r=A/i,s=k/i):x<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(x),r=T/s,i=k/s),this.set(r,i,s,n),this}let y=Math.sqrt((g-p)*(g-p)+(h-m)*(h-m)+(f-u)*(f-u));return Math.abs(y)<.001&&(y=1),this.x=(g-p)/y,this.y=(h-m)/y,this.z=(f-u)/y,this.w=Math.acos((l+d+_-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Ni(this.x,e.x,n.x),this.y=Ni(this.y,e.y,n.y),this.z=Ni(this.z,e.z,n.z),this.w=Ni(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=Ni(this.x,e,n),this.y=Ni(this.y,e,n),this.z=Ni(this.z,e,n),this.w=Ni(this.w,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ni(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class pce extends Pg{constructor(e=1,n=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=r.depth?r.depth:1,this.scissor=new qo(0,0,e,n),this.scissorTest=!1,this.viewport=new qo(0,0,e,n);const i={width:e,height:n,depth:this.depth};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ml,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,multiview:!1},r);const s=new hc(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=n,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,r=e.textures.length;n<r;n++){this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const i=Object.assign({},e.textures[n].image);this.textures[n].source=new X4(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class il extends pce{constructor(e=1,n=1,r={}){super(e,n,r),this.isWebGLRenderTarget=!0}}class sq extends hc{constructor(e=null,n=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=Il,this.minFilter=Il,this.wrapR=i1,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class mce extends hc{constructor(e=null,n=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=Il,this.minFilter=Il,this.wrapR=i1,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class FA{constructor(e=0,n=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=i}static slerpFlat(e,n,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],h=r[i+3];const f=s[o+0],d=s[o+1],p=s[o+2],m=s[o+3];if(a===0){e[n+0]=c,e[n+1]=l,e[n+2]=u,e[n+3]=h;return}if(a===1){e[n+0]=f,e[n+1]=d,e[n+2]=p,e[n+3]=m;return}if(h!==m||c!==f||l!==d||u!==p){let g=1-a;const _=c*f+l*d+u*p+h*m,y=_>=0?1:-1,v=1-_*_;if(v>Number.EPSILON){const x=Math.sqrt(v),A=Math.atan2(x,_*y);g=Math.sin(g*A)/x,a=Math.sin(a*A)/x}const E=a*y;if(c=c*g+f*E,l=l*g+d*E,u=u*g+p*E,h=h*g+m*E,g===1-a){const x=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=x,l*=x,u*=x,h*=x}}e[n]=c,e[n+1]=l,e[n+2]=u,e[n+3]=h}static multiplyQuaternionsFlat(e,n,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],h=s[o],f=s[o+1],d=s[o+2],p=s[o+3];return e[n]=a*p+u*h+c*d-l*f,e[n+1]=c*p+u*f+l*h-a*d,e[n+2]=l*p+u*d+a*f-c*h,e[n+3]=u*p-a*h-c*f-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,i){return this._x=e,this._y=n,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),h=a(s/2),f=c(r/2),d=c(i/2),p=c(s/2);switch(o){case"XYZ":this._x=f*u*h+l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h-f*d*p;break;case"YXZ":this._x=f*u*h+l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h+f*d*p;break;case"ZXY":this._x=f*u*h-l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h-f*d*p;break;case"ZYX":this._x=f*u*h-l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h+f*d*p;break;case"YZX":this._x=f*u*h+l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h-f*d*p;break;case"XZY":this._x=f*u*h-l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h+f*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],i=n[4],s=n[8],o=n[1],a=n[5],c=n[9],l=n[2],u=n[6],h=n[10],f=r+a+h;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(u-c)*d,this._y=(s-l)*d,this._z=(o-i)*d}else if(r>a&&r>h){const d=2*Math.sqrt(1+r-a-h);this._w=(u-c)/d,this._x=.25*d,this._y=(i+o)/d,this._z=(s+l)/d}else if(a>h){const d=2*Math.sqrt(1+a-r-h);this._w=(s-l)/d,this._x=(i+o)/d,this._y=.25*d,this._z=(c+u)/d}else{const d=2*Math.sqrt(1+h-r-a);this._w=(o-i)/d,this._x=(s+l)/d,this._y=(c+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ni(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,n/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,i=e._y,s=e._z,o=e._w,a=n._x,c=n._y,l=n._z,u=n._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const d=1-n;return this._w=d*o+n*this._w,this._x=d*r+n*this._x,this._y=d*i+n*this._y,this._z=d*s+n*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),h=Math.sin((1-n)*u)/l,f=Math.sin(n*u)/l;return this._w=o*h+this._w*f,this._x=r*h+this._x*f,this._y=i*h+this._y*f,this._z=s*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(n),s*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class zt{constructor(e=0,n=0,r=0){zt.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(OB.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(OB.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[3]*r+s[6]*i,this.y=s[1]*n+s[4]*r+s[7]*i,this.z=s[2]*n+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*n+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*n+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*n+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*n+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const n=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*i-a*r),u=2*(a*n-s*i),h=2*(s*r-o*n);return this.x=n+c*l+o*h-a*u,this.y=r+c*u+a*l-s*h,this.z=i+c*h+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[4]*r+s[8]*i,this.y=s[1]*n+s[5]*r+s[9]*i,this.z=s[2]*n+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Ni(this.x,e.x,n.x),this.y=Ni(this.y,e.y,n.y),this.z=Ni(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=Ni(this.x,e,n),this.y=Ni(this.y,e,n),this.z=Ni(this.z,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ni(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,i=e.y,s=e.z,o=n.x,a=n.y,c=n.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return s3.copy(this).projectOnVector(e),this.sub(s3)}reflect(e){return this.sub(s3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Ni(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return n*n+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const i=Math.sin(n)*e;return this.x=i*Math.sin(r),this.y=Math.cos(n)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=i,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const s3=new zt,OB=new FA;class G1{constructor(e=new zt(1/0,1/0,1/0),n=new zt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(Ud.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(Ud.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=Ud.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(n===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Ud):Ud.fromBufferAttribute(s,o),Ud.applyMatrix4(e.matrixWorld),this.expandByPoint(Ud);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),UC.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),UC.copy(r.boundingBox)),UC.applyMatrix4(e.matrixWorld),this.union(UC)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Ud),Ud.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Gx),BC.subVectors(this.max,Gx),sS.subVectors(e.a,Gx),oS.subVectors(e.b,Gx),aS.subVectors(e.c,Gx),L_.subVectors(oS,sS),U_.subVectors(aS,oS),yy.subVectors(sS,aS);let n=[0,-L_.z,L_.y,0,-U_.z,U_.y,0,-yy.z,yy.y,L_.z,0,-L_.x,U_.z,0,-U_.x,yy.z,0,-yy.x,-L_.y,L_.x,0,-U_.y,U_.x,0,-yy.y,yy.x,0];return!o3(n,sS,oS,aS,BC)||(n=[1,0,0,0,1,0,0,0,1],!o3(n,sS,oS,aS,BC))?!1:(FC.crossVectors(L_,U_),n=[FC.x,FC.y,FC.z],o3(n,sS,oS,aS,BC))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ud).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ud).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Q0[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Q0[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Q0[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Q0[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Q0[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Q0[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Q0[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Q0[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Q0),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Q0=[new zt,new zt,new zt,new zt,new zt,new zt,new zt,new zt],Ud=new zt,UC=new G1,sS=new zt,oS=new zt,aS=new zt,L_=new zt,U_=new zt,yy=new zt,Gx=new zt,BC=new zt,FC=new zt,by=new zt;function o3(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){by.fromArray(t,s);const a=i.x*Math.abs(by.x)+i.y*Math.abs(by.y)+i.z*Math.abs(by.z),c=e.dot(by),l=n.dot(by),u=r.dot(by);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const gce=new G1,Wx=new zt,a3=new zt;class ZE{constructor(e=new zt,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):gce.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Wx.subVectors(e,this.center);const n=Wx.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),i=(r-this.radius)*.5;this.center.addScaledVector(Wx,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(a3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Wx.copy(e.center).add(a3)),this.expandByPoint(Wx.copy(e.center).sub(a3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const eg=new zt,c3=new zt,jC=new zt,B_=new zt,l3=new zt,zC=new zt,u3=new zt;class J4{constructor(e=new zt,n=new zt(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,eg)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=eg.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(eg.copy(this.origin).addScaledVector(this.direction,n),eg.distanceToSquared(e))}distanceSqToSegment(e,n,r,i){c3.copy(e).add(n).multiplyScalar(.5),jC.copy(n).sub(e).normalize(),B_.copy(this.origin).sub(c3);const s=e.distanceTo(n)*.5,o=-this.direction.dot(jC),a=B_.dot(this.direction),c=-B_.dot(jC),l=B_.lengthSq(),u=Math.abs(1-o*o);let h,f,d,p;if(u>0)if(h=o*c-a,f=o*a-c,p=s*u,h>=0)if(f>=-p)if(f<=p){const m=1/u;h*=m,f*=m,d=h*(h+o*f+2*a)+f*(o*h+f+2*c)+l}else f=s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;else f=-s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;else f<=-p?(h=Math.max(0,-(-o*s+a)),f=h>0?-s:Math.min(Math.max(-s,-c),s),d=-h*h+f*(f+2*c)+l):f<=p?(h=0,f=Math.min(Math.max(-s,-c),s),d=f*(f+2*c)+l):(h=Math.max(0,-(o*s+a)),f=h>0?s:Math.min(Math.max(-s,-c),s),d=-h*h+f*(f+2*c)+l);else f=o>0?-s:s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(c3).addScaledVector(jC,f),d}intersectSphere(e,n){eg.subVectors(e.center,this.origin);const r=eg.dot(this.direction),i=eg.dot(eg)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:a<0?this.at(c,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,f=this.origin;return l>=0?(r=(e.min.x-f.x)*l,i=(e.max.x-f.x)*l):(r=(e.max.x-f.x)*l,i=(e.min.x-f.x)*l),u>=0?(s=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(s=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),h>=0?(a=(e.min.z-f.z)*h,c=(e.max.z-f.z)*h):(a=(e.max.z-f.z)*h,c=(e.min.z-f.z)*h),r>c||a>i)||((a>r||r!==r)&&(r=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,n)}intersectsBox(e){return this.intersectBox(e,eg)!==null}intersectTriangle(e,n,r,i,s){l3.subVectors(n,e),zC.subVectors(r,e),u3.crossVectors(l3,zC);let o=this.direction.dot(u3),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;B_.subVectors(this.origin,e);const c=a*this.direction.dot(zC.crossVectors(B_,zC));if(c<0)return null;const l=a*this.direction.dot(l3.cross(B_));if(l<0||c+l>o)return null;const u=-a*B_.dot(u3);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class So{constructor(e,n,r,i,s,o,a,c,l,u,h,f,d,p,m,g){So.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l,u,h,f,d,p,m,g)}set(e,n,r,i,s,o,a,c,l,u,h,f,d,p,m,g){const _=this.elements;return _[0]=e,_[4]=n,_[8]=r,_[12]=i,_[1]=s,_[5]=o,_[9]=a,_[13]=c,_[2]=l,_[6]=u,_[10]=h,_[14]=f,_[3]=d,_[7]=p,_[11]=m,_[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new So().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,i=1/cS.setFromMatrixColumn(e,0).length(),s=1/cS.setFromMatrixColumn(e,1).length(),o=1/cS.setFromMatrixColumn(e,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const f=o*u,d=o*h,p=a*u,m=a*h;n[0]=c*u,n[4]=-c*h,n[8]=l,n[1]=d+p*l,n[5]=f-m*l,n[9]=-a*c,n[2]=m-f*l,n[6]=p+d*l,n[10]=o*c}else if(e.order==="YXZ"){const f=c*u,d=c*h,p=l*u,m=l*h;n[0]=f+m*a,n[4]=p*a-d,n[8]=o*l,n[1]=o*h,n[5]=o*u,n[9]=-a,n[2]=d*a-p,n[6]=m+f*a,n[10]=o*c}else if(e.order==="ZXY"){const f=c*u,d=c*h,p=l*u,m=l*h;n[0]=f-m*a,n[4]=-o*h,n[8]=p+d*a,n[1]=d+p*a,n[5]=o*u,n[9]=m-f*a,n[2]=-o*l,n[6]=a,n[10]=o*c}else if(e.order==="ZYX"){const f=o*u,d=o*h,p=a*u,m=a*h;n[0]=c*u,n[4]=p*l-d,n[8]=f*l+m,n[1]=c*h,n[5]=m*l+f,n[9]=d*l-p,n[2]=-l,n[6]=a*c,n[10]=o*c}else if(e.order==="YZX"){const f=o*c,d=o*l,p=a*c,m=a*l;n[0]=c*u,n[4]=m-f*h,n[8]=p*h+d,n[1]=h,n[5]=o*u,n[9]=-a*u,n[2]=-l*u,n[6]=d*h+p,n[10]=f-m*h}else if(e.order==="XZY"){const f=o*c,d=o*l,p=a*c,m=a*l;n[0]=c*u,n[4]=-h,n[8]=l*u,n[1]=f*h+m,n[5]=o*u,n[9]=d*h-p,n[2]=p*h-d,n[6]=a*u,n[10]=m*h+f}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_ce,e,vce)}lookAt(e,n,r){const i=this.elements;return Wh.subVectors(e,n),Wh.lengthSq()===0&&(Wh.z=1),Wh.normalize(),F_.crossVectors(r,Wh),F_.lengthSq()===0&&(Math.abs(r.z)===1?Wh.x+=1e-4:Wh.z+=1e-4,Wh.normalize(),F_.crossVectors(r,Wh)),F_.normalize(),VC.crossVectors(Wh,F_),i[0]=F_.x,i[4]=VC.x,i[8]=Wh.x,i[1]=F_.y,i[5]=VC.y,i[9]=Wh.y,i[2]=F_.z,i[6]=VC.z,i[10]=Wh.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],h=r[5],f=r[9],d=r[13],p=r[2],m=r[6],g=r[10],_=r[14],y=r[3],v=r[7],E=r[11],x=r[15],A=i[0],T=i[4],k=i[8],L=i[12],I=i[1],F=i[5],M=i[9],D=i[13],O=i[2],z=i[6],q=i[10],G=i[14],K=i[3],te=i[7],re=i[11],H=i[15];return s[0]=o*A+a*I+c*O+l*K,s[4]=o*T+a*F+c*z+l*te,s[8]=o*k+a*M+c*q+l*re,s[12]=o*L+a*D+c*G+l*H,s[1]=u*A+h*I+f*O+d*K,s[5]=u*T+h*F+f*z+d*te,s[9]=u*k+h*M+f*q+d*re,s[13]=u*L+h*D+f*G+d*H,s[2]=p*A+m*I+g*O+_*K,s[6]=p*T+m*F+g*z+_*te,s[10]=p*k+m*M+g*q+_*re,s[14]=p*L+m*D+g*G+_*H,s[3]=y*A+v*I+E*O+x*K,s[7]=y*T+v*F+E*z+x*te,s[11]=y*k+v*M+E*q+x*re,s[15]=y*L+v*D+E*G+x*H,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],f=e[10],d=e[14],p=e[3],m=e[7],g=e[11],_=e[15];return p*(+s*c*h-i*l*h-s*a*f+r*l*f+i*a*d-r*c*d)+m*(+n*c*d-n*l*f+s*o*f-i*o*d+i*l*u-s*c*u)+g*(+n*l*h-n*a*d-s*o*h+r*o*d+s*a*u-r*l*u)+_*(-i*a*u-n*c*h+n*a*f+i*o*h-r*o*f+r*c*u)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=n,i[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],_=e[15],y=h*g*l-m*f*l+m*c*d-a*g*d-h*c*_+a*f*_,v=p*f*l-u*g*l-p*c*d+o*g*d+u*c*_-o*f*_,E=u*m*l-p*h*l+p*a*d-o*m*d-u*a*_+o*h*_,x=p*h*c-u*m*c-p*a*f+o*m*f+u*a*g-o*h*g,A=n*y+r*v+i*E+s*x;if(A===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/A;return e[0]=y*T,e[1]=(m*f*s-h*g*s-m*i*d+r*g*d+h*i*_-r*f*_)*T,e[2]=(a*g*s-m*c*s+m*i*l-r*g*l-a*i*_+r*c*_)*T,e[3]=(h*c*s-a*f*s-h*i*l+r*f*l+a*i*d-r*c*d)*T,e[4]=v*T,e[5]=(u*g*s-p*f*s+p*i*d-n*g*d-u*i*_+n*f*_)*T,e[6]=(p*c*s-o*g*s-p*i*l+n*g*l+o*i*_-n*c*_)*T,e[7]=(o*f*s-u*c*s+u*i*l-n*f*l-o*i*d+n*c*d)*T,e[8]=E*T,e[9]=(p*h*s-u*m*s-p*r*d+n*m*d+u*r*_-n*h*_)*T,e[10]=(o*m*s-p*a*s+p*r*l-n*m*l-o*r*_+n*a*_)*T,e[11]=(u*a*s-o*h*s-u*r*l+n*h*l+o*r*d-n*a*d)*T,e[12]=x*T,e[13]=(u*m*i-p*h*i+p*r*f-n*m*f-u*r*g+n*h*g)*T,e[14]=(p*a*i-o*m*i-p*r*c+n*m*c+o*r*g-n*a*g)*T,e[15]=(o*h*i-u*a*i+u*r*c-n*h*c-o*r*f+n*a*f)*T,this}scale(e){const n=this.elements,r=e.x,i=e.y,s=e.z;return n[0]*=r,n[4]*=i,n[8]*=s,n[1]*=r,n[5]*=i,n[9]*=s,n[2]*=r,n[6]*=i,n[10]*=s,n[3]*=r,n[7]*=i,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,i))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),i=Math.sin(n),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,n,i,1,0,0,0,0,1),this}compose(e,n,r){const i=this.elements,s=n._x,o=n._y,a=n._z,c=n._w,l=s+s,u=o+o,h=a+a,f=s*l,d=s*u,p=s*h,m=o*u,g=o*h,_=a*h,y=c*l,v=c*u,E=c*h,x=r.x,A=r.y,T=r.z;return i[0]=(1-(m+_))*x,i[1]=(d+E)*x,i[2]=(p-v)*x,i[3]=0,i[4]=(d-E)*A,i[5]=(1-(f+_))*A,i[6]=(g+y)*A,i[7]=0,i[8]=(p+v)*T,i[9]=(g-y)*T,i[10]=(1-(f+m))*T,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,n,r){const i=this.elements;let s=cS.set(i[0],i[1],i[2]).length();const o=cS.set(i[4],i[5],i[6]).length(),a=cS.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Bd.copy(this);const l=1/s,u=1/o,h=1/a;return Bd.elements[0]*=l,Bd.elements[1]*=l,Bd.elements[2]*=l,Bd.elements[4]*=u,Bd.elements[5]*=u,Bd.elements[6]*=u,Bd.elements[8]*=h,Bd.elements[9]*=h,Bd.elements[10]*=h,n.setFromRotationMatrix(Bd),r.x=s,r.y=o,r.z=a,this}makePerspective(e,n,r,i,s,o,a=vg){const c=this.elements,l=2*s/(n-e),u=2*s/(r-i),h=(n+e)/(n-e),f=(r+i)/(r-i);let d,p;if(a===vg)d=-(o+s)/(o-s),p=-2*o*s/(o-s);else if(a===Xk)d=-o/(o-s),p=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=u,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=d,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,n,r,i,s,o,a=vg){const c=this.elements,l=1/(n-e),u=1/(r-i),h=1/(o-s),f=(n+e)*l,d=(r+i)*u;let p,m;if(a===vg)p=(o+s)*h,m=-2*h;else if(a===Xk)p=s*h,m=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-d,c[2]=0,c[6]=0,c[10]=m,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<16;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const cS=new zt,Bd=new So,_ce=new zt(0,0,0),vce=new zt(1,1,1),F_=new zt,VC=new zt,Wh=new zt,IB=new So,NB=new FA;class Pm{constructor(e=0,n=0,r=0,i=Pm.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,i=this._order){return this._x=e,this._y=n,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],f=i[6],d=i[10];switch(n){case"XYZ":this._y=Math.asin(Ni(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ni(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ni(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Ni(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Ni(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Ni(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return IB.makeRotationFromQuaternion(e),this.setFromRotationMatrix(IB,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return NB.setFromEuler(this),this.setFromQuaternion(NB,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Pm.DEFAULT_ORDER="XYZ";class JT{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let yce=0;const PB=new zt,lS=new FA,tg=new So,HC=new zt,qx=new zt,bce=new zt,Sce=new FA,DB=new zt(1,0,0),LB=new zt(0,1,0),UB=new zt(0,0,1),BB={type:"added"},Ece={type:"removed"},uS={type:"childadded",child:null},h3={type:"childremoved",child:null};class Pc extends Pg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:yce++}),this.uuid=JE(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pc.DEFAULT_UP.clone();const e=new zt,n=new Pm,r=new FA,i=new zt(1,1,1);function s(){r.setFromEuler(n,!1)}function o(){n.setFromQuaternion(r,void 0,!1)}n._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new So},normalMatrix:{value:new pi}}),this.matrix=new So,this.matrixWorld=new So,this.matrixAutoUpdate=Pc.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Pc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new JT,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return lS.setFromAxisAngle(e,n),this.quaternion.multiply(lS),this}rotateOnWorldAxis(e,n){return lS.setFromAxisAngle(e,n),this.quaternion.premultiply(lS),this}rotateX(e){return this.rotateOnAxis(DB,e)}rotateY(e){return this.rotateOnAxis(LB,e)}rotateZ(e){return this.rotateOnAxis(UB,e)}translateOnAxis(e,n){return PB.copy(e).applyQuaternion(this.quaternion),this.position.add(PB.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(DB,e)}translateY(e){return this.translateOnAxis(LB,e)}translateZ(e){return this.translateOnAxis(UB,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(tg.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?HC.copy(e):HC.set(e,n,r);const i=this.parent;this.updateWorldMatrix(!0,!1),qx.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?tg.lookAt(qx,HC,this.up):tg.lookAt(HC,qx,this.up),this.quaternion.setFromRotationMatrix(tg),i&&(tg.extractRotation(i.matrixWorld),lS.setFromRotationMatrix(tg),this.quaternion.premultiply(lS.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(BB),uS.child=e,this.dispatchEvent(uS),uS.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Ece),h3.child=e,this.dispatchEvent(h3),h3.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),tg.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),tg.multiply(e.parent.matrixWorld)),e.applyMatrix4(tg),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(BB),uS.child=e,this.dispatchEvent(uS),uS.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,n);if(o!==void 0)return o}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qx,e,bce),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qx,Sce,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].updateMatrixWorld(e)}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?{min:a.boundingBox.min.toArray(),max:a.boundingBox.max.toArray()}:void 0,boundingSphere:a.boundingSphere?{radius:a.boundingSphere.radius,center:a.boundingSphere.center.toArray()}:void 0})),i.instanceInfo=this._instanceInfo.map(a=>({...a})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const h=c[l];s(e.shapes,h)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(e.materials,this.material[c]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(e.animations,c))}}if(n){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),h=o(e.shapes),f=o(e.skeletons),d=o(e.animations),p=o(e.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),d.length>0&&(r.animations=d),p.length>0&&(r.nodes=p)}return r.object=i,r;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}Pc.DEFAULT_UP=new zt(0,1,0);Pc.DEFAULT_MATRIX_AUTO_UPDATE=!0;Pc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Fd=new zt,ng=new zt,f3=new zt,rg=new zt,hS=new zt,fS=new zt,FB=new zt,d3=new zt,p3=new zt,m3=new zt,g3=new qo,_3=new qo,v3=new qo;class ep{constructor(e=new zt,n=new zt,r=new zt){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,i){i.subVectors(r,n),Fd.subVectors(e,n),i.cross(Fd);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,n,r,i,s){Fd.subVectors(i,n),ng.subVectors(r,n),f3.subVectors(e,n);const o=Fd.dot(Fd),a=Fd.dot(ng),c=Fd.dot(f3),l=ng.dot(ng),u=ng.dot(f3),h=o*l-a*a;if(h===0)return s.set(0,0,0),null;const f=1/h,d=(l*c-a*u)*f,p=(o*u-a*c)*f;return s.set(1-d-p,p,d)}static containsPoint(e,n,r,i){return this.getBarycoord(e,n,r,i,rg)===null?!1:rg.x>=0&&rg.y>=0&&rg.x+rg.y<=1}static getInterpolation(e,n,r,i,s,o,a,c){return this.getBarycoord(e,n,r,i,rg)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,rg.x),c.addScaledVector(o,rg.y),c.addScaledVector(a,rg.z),c)}static getInterpolatedAttribute(e,n,r,i,s,o){return g3.setScalar(0),_3.setScalar(0),v3.setScalar(0),g3.fromBufferAttribute(e,n),_3.fromBufferAttribute(e,r),v3.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(g3,s.x),o.addScaledVector(_3,s.y),o.addScaledVector(v3,s.z),o}static isFrontFacing(e,n,r,i){return Fd.subVectors(r,n),ng.subVectors(e,n),Fd.cross(ng).dot(i)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,i){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,n,r,i){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fd.subVectors(this.c,this.b),ng.subVectors(this.a,this.b),Fd.cross(ng).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ep.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return ep.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,s){return ep.getInterpolation(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return ep.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ep.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,i=this.b,s=this.c;let o,a;hS.subVectors(i,r),fS.subVectors(s,r),d3.subVectors(e,r);const c=hS.dot(d3),l=fS.dot(d3);if(c<=0&&l<=0)return n.copy(r);p3.subVectors(e,i);const u=hS.dot(p3),h=fS.dot(p3);if(u>=0&&h<=u)return n.copy(i);const f=c*h-u*l;if(f<=0&&c>=0&&u<=0)return o=c/(c-u),n.copy(r).addScaledVector(hS,o);m3.subVectors(e,s);const d=hS.dot(m3),p=fS.dot(m3);if(p>=0&&d<=p)return n.copy(s);const m=d*l-c*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),n.copy(r).addScaledVector(fS,a);const g=u*p-d*h;if(g<=0&&h-u>=0&&d-p>=0)return FB.subVectors(s,i),a=(h-u)/(h-u+(d-p)),n.copy(i).addScaledVector(FB,a);const _=1/(g+m+f);return o=m*_,a=f*_,n.copy(r).addScaledVector(hS,o).addScaledVector(fS,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const oq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},j_={h:0,s:0,l:0},$C={h:0,s:0,l:0};function y3(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class wi{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Bi){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Xi.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Xi.workingColorSpace){return this.r=e,this.g=n,this.b=r,Xi.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Xi.workingColorSpace){if(e=K4(e,1),n=Ni(n,0,1),r=Ni(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=y3(o,s,e+1/3),this.g=y3(o,s,e),this.b=y3(o,s,e-1/3)}return Xi.toWorkingColorSpace(this,i),this}setStyle(e,n=Bi){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Bi){const r=oq[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=bg(e.r),this.g=bg(e.g),this.b=bg(e.b),this}copyLinearToSRGB(e){return this.r=hE(e.r),this.g=hE(e.g),this.b=hE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Bi){return Xi.fromWorkingColorSpace(wl.copy(this),e),Math.round(Ni(wl.r*255,0,255))*65536+Math.round(Ni(wl.g*255,0,255))*256+Math.round(Ni(wl.b*255,0,255))}getHexString(e=Bi){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Xi.workingColorSpace){Xi.fromWorkingColorSpace(wl.copy(this),n);const r=wl.r,i=wl.g,s=wl.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Xi.workingColorSpace){return Xi.fromWorkingColorSpace(wl.copy(this),n),e.r=wl.r,e.g=wl.g,e.b=wl.b,e}getStyle(e=Bi){Xi.fromWorkingColorSpace(wl.copy(this),e);const n=wl.r,r=wl.g,i=wl.b;return e!==Bi?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(j_),this.setHSL(j_.h+e,j_.s+n,j_.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(j_),e.getHSL($C);const r=NT(j_.h,$C.h,n),i=NT(j_.s,$C.s,n),s=NT(j_.l,$C.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const wl=new wi;wi.NAMES=oq;let xce=0;class W1 extends Pg{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:xce++}),this.uuid=JE(),this.name="",this.type="Material",this.blending=uE,this.side=Ag,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=dD,this.blendDst=pD,this.blendEquation=Zy,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new wi(0,0,0),this.blendAlpha=0,this.depthFunc=vE,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=wB,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=rS,this.stencilZFail=rS,this.stencilZPass=rS,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const i=this[n];if(i===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==uE&&(r.blending=this.blending),this.side!==Ag&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==dD&&(r.blendSrc=this.blendSrc),this.blendDst!==pD&&(r.blendDst=this.blendDst),this.blendEquation!==Zy&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==vE&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==wB&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==rS&&(r.stencilFail=this.stencilFail),this.stencilZFail!==rS&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==rS&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(n){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const i=n.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=n[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Z4 extends W1{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new wi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Pm,this.combine=qW,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Fa=new zt,GC=new zn;let wce=0;class hh{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:wce++}),this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=TB,this.updateRanges=[],this.gpuType=tp,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=n.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)GC.fromBufferAttribute(this,n),GC.applyMatrix3(e),this.setXY(n,GC.x,GC.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)Fa.fromBufferAttribute(this,n),Fa.applyMatrix3(e),this.setXYZ(n,Fa.x,Fa.y,Fa.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)Fa.fromBufferAttribute(this,n),Fa.applyMatrix4(e),this.setXYZ(n,Fa.x,Fa.y,Fa.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)Fa.fromBufferAttribute(this,n),Fa.applyNormalMatrix(e),this.setXYZ(n,Fa.x,Fa.y,Fa.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)Fa.fromBufferAttribute(this,n),Fa.transformDirection(e),this.setXYZ(n,Fa.x,Fa.y,Fa.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=jS(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=eu(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=jS(n,this.array)),n}setX(e,n){return this.normalized&&(n=eu(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=jS(n,this.array)),n}setY(e,n){return this.normalized&&(n=eu(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=jS(n,this.array)),n}setZ(e,n){return this.normalized&&(n=eu(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=jS(n,this.array)),n}setW(e,n){return this.normalized&&(n=eu(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=eu(n,this.array),r=eu(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,i){return e*=this.itemSize,this.normalized&&(n=eu(n,this.array),r=eu(r,this.array),i=eu(i,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,n,r,i,s){return e*=this.itemSize,this.normalized&&(n=eu(n,this.array),r=eu(r,this.array),i=eu(i,this.array),s=eu(s,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==TB&&(e.usage=this.usage),e}}class aq extends hh{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class cq extends hh{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class d1 extends hh{constructor(e,n,r){super(new Float32Array(e),n,r)}}let Tce=0;const Df=new So,b3=new Pc,dS=new zt,qh=new G1,Yx=new G1,Ac=new zt;class jm extends Pg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Tce++}),this.uuid=JE(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(iq(e)?cq:aq)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new pi().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Df.makeRotationFromQuaternion(e),this.applyMatrix4(Df),this}rotateX(e){return Df.makeRotationX(e),this.applyMatrix4(Df),this}rotateY(e){return Df.makeRotationY(e),this.applyMatrix4(Df),this}rotateZ(e){return Df.makeRotationZ(e),this.applyMatrix4(Df),this}translate(e,n,r){return Df.makeTranslation(e,n,r),this.applyMatrix4(Df),this}scale(e,n,r){return Df.makeScale(e,n,r),this.applyMatrix4(Df),this}lookAt(e){return b3.lookAt(e),b3.updateMatrix(),this.applyMatrix4(b3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(dS).negate(),this.translate(dS.x,dS.y,dS.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];r.push(o.x,o.y,o.z||0)}this.setAttribute("position",new d1(r,3))}else{const r=Math.min(e.length,n.count);for(let i=0;i<r;i++){const s=e[i];n.setXYZ(i,s.x,s.y,s.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new G1);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new zt(-1/0,-1/0,-1/0),new zt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,i=n.length;r<i;r++){const s=n[r];qh.setFromBufferAttribute(s),this.morphTargetsRelative?(Ac.addVectors(this.boundingBox.min,qh.min),this.boundingBox.expandByPoint(Ac),Ac.addVectors(this.boundingBox.max,qh.max),this.boundingBox.expandByPoint(Ac)):(this.boundingBox.expandByPoint(qh.min),this.boundingBox.expandByPoint(qh.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ZE);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new zt,1/0);return}if(e){const r=this.boundingSphere.center;if(qh.setFromBufferAttribute(e),n)for(let s=0,o=n.length;s<o;s++){const a=n[s];Yx.setFromBufferAttribute(a),this.morphTargetsRelative?(Ac.addVectors(qh.min,Yx.min),qh.expandByPoint(Ac),Ac.addVectors(qh.max,Yx.max),qh.expandByPoint(Ac)):(qh.expandByPoint(Yx.min),qh.expandByPoint(Yx.max))}qh.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)Ac.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Ac));if(n)for(let s=0,o=n.length;s<o;s++){const a=n[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Ac.fromBufferAttribute(a,l),c&&(dS.fromBufferAttribute(e,l),Ac.add(dS)),i=Math.max(i,r.distanceToSquared(Ac))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,i=n.normal,s=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new hh(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let k=0;k<r.count;k++)a[k]=new zt,c[k]=new zt;const l=new zt,u=new zt,h=new zt,f=new zn,d=new zn,p=new zn,m=new zt,g=new zt;function _(k,L,I){l.fromBufferAttribute(r,k),u.fromBufferAttribute(r,L),h.fromBufferAttribute(r,I),f.fromBufferAttribute(s,k),d.fromBufferAttribute(s,L),p.fromBufferAttribute(s,I),u.sub(l),h.sub(l),d.sub(f),p.sub(f);const F=1/(d.x*p.y-p.x*d.y);isFinite(F)&&(m.copy(u).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(F),g.copy(h).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(F),a[k].add(m),a[L].add(m),a[I].add(m),c[k].add(g),c[L].add(g),c[I].add(g))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let k=0,L=y.length;k<L;++k){const I=y[k],F=I.start,M=I.count;for(let D=F,O=F+M;D<O;D+=3)_(e.getX(D+0),e.getX(D+1),e.getX(D+2))}const v=new zt,E=new zt,x=new zt,A=new zt;function T(k){x.fromBufferAttribute(i,k),A.copy(x);const L=a[k];v.copy(L),v.sub(x.multiplyScalar(x.dot(L))).normalize(),E.crossVectors(A,L);const F=E.dot(c[k])<0?-1:1;o.setXYZW(k,v.x,v.y,v.z,F)}for(let k=0,L=y.length;k<L;++k){const I=y[k],F=I.start,M=I.count;for(let D=F,O=F+M;D<O;D+=3)T(e.getX(D+0)),T(e.getX(D+1)),T(e.getX(D+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new hh(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let f=0,d=r.count;f<d;f++)r.setXYZ(f,0,0,0);const i=new zt,s=new zt,o=new zt,a=new zt,c=new zt,l=new zt,u=new zt,h=new zt;if(e)for(let f=0,d=e.count;f<d;f+=3){const p=e.getX(f+0),m=e.getX(f+1),g=e.getX(f+2);i.fromBufferAttribute(n,p),s.fromBufferAttribute(n,m),o.fromBufferAttribute(n,g),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),a.fromBufferAttribute(r,p),c.fromBufferAttribute(r,m),l.fromBufferAttribute(r,g),a.add(u),c.add(u),l.add(u),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(m,c.x,c.y,c.z),r.setXYZ(g,l.x,l.y,l.z)}else for(let f=0,d=n.count;f<d;f+=3)i.fromBufferAttribute(n,f+0),s.fromBufferAttribute(n,f+1),o.fromBufferAttribute(n,f+2),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)Ac.fromBufferAttribute(e,n),Ac.normalize(),e.setXYZ(n,Ac.x,Ac.y,Ac.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,h=a.normalized,f=new l.constructor(c.length*u);let d=0,p=0;for(let m=0,g=c.length;m<g;m++){a.isInterleavedBufferAttribute?d=c[m]*a.data.stride+a.offset:d=c[m]*u;for(let _=0;_<u;_++)f[p++]=l[d++]}return new hh(f,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new jm,r=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=e(c,r);n.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,h=l.length;u<h;u++){const f=l[u],d=e(f,r);c.push(d)}n.morphAttributes[a]=c}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];n.addGroup(l.start,l.count,l.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const c in r){const l=r[c];e.data.attributes[c]=l.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let h=0,f=l.length;h<f;h++){const d=l[h];u.push(d.toJSON(e.data))}u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(n))}const s=e.morphAttributes;for(const l in s){const u=[],h=s[l];for(let f=0,d=h.length;f<d;f++)u.push(h[f].clone(n));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const jB=new So,Sy=new J4,WC=new ZE,zB=new zt,qC=new zt,YC=new zt,KC=new zt,S3=new zt,XC=new zt,VB=new zt,JC=new zt;class ef extends Pc{constructor(e=new jm,n=new Z4){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,n){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,o=r.morphTargetsRelative;n.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){XC.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c],h=s[c];u!==0&&(S3.fromBufferAttribute(h,e),o?XC.addScaledVector(S3,u):XC.addScaledVector(S3.sub(n),u))}n.add(XC)}return n}raycast(e,n){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),WC.copy(r.boundingSphere),WC.applyMatrix4(s),Sy.copy(e.ray).recast(e.near),!(WC.containsPoint(Sy.origin)===!1&&(Sy.intersectSphere(WC,zB)===null||Sy.origin.distanceToSquared(zB)>(e.far-e.near)**2))&&(jB.copy(s).invert(),Sy.copy(e.ray).applyMatrix4(jB),!(r.boundingBox!==null&&Sy.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,Sy)))}_computeIntersections(e,n,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,f=s.groups,d=s.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,m=f.length;p<m;p++){const g=f[p],_=o[g.materialIndex],y=Math.max(g.start,d.start),v=Math.min(a.count,Math.min(g.start+g.count,d.start+d.count));for(let E=y,x=v;E<x;E+=3){const A=a.getX(E),T=a.getX(E+1),k=a.getX(E+2);i=ZC(this,_,e,r,l,u,h,A,T,k),i&&(i.faceIndex=Math.floor(E/3),i.face.materialIndex=g.materialIndex,n.push(i))}}else{const p=Math.max(0,d.start),m=Math.min(a.count,d.start+d.count);for(let g=p,_=m;g<_;g+=3){const y=a.getX(g),v=a.getX(g+1),E=a.getX(g+2);i=ZC(this,o,e,r,l,u,h,y,v,E),i&&(i.faceIndex=Math.floor(g/3),n.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let p=0,m=f.length;p<m;p++){const g=f[p],_=o[g.materialIndex],y=Math.max(g.start,d.start),v=Math.min(c.count,Math.min(g.start+g.count,d.start+d.count));for(let E=y,x=v;E<x;E+=3){const A=E,T=E+1,k=E+2;i=ZC(this,_,e,r,l,u,h,A,T,k),i&&(i.faceIndex=Math.floor(E/3),i.face.materialIndex=g.materialIndex,n.push(i))}}else{const p=Math.max(0,d.start),m=Math.min(c.count,d.start+d.count);for(let g=p,_=m;g<_;g+=3){const y=g,v=g+1,E=g+2;i=ZC(this,o,e,r,l,u,h,y,v,E),i&&(i.faceIndex=Math.floor(g/3),n.push(i))}}}}function Ace(t,e,n,r,i,s,o,a){let c;if(e.side===Ic?c=r.intersectTriangle(o,s,i,!0,a):c=r.intersectTriangle(i,s,o,e.side===Ag,a),c===null)return null;JC.copy(a),JC.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(JC);return l<n.near||l>n.far?null:{distance:l,point:JC.clone(),object:t}}function ZC(t,e,n,r,i,s,o,a,c,l){t.getVertexPosition(a,qC),t.getVertexPosition(c,YC),t.getVertexPosition(l,KC);const u=Ace(t,e,n,r,qC,YC,KC,VB);if(u){const h=new zt;ep.getBarycoord(VB,qC,YC,KC,h),i&&(u.uv=ep.getInterpolatedAttribute(i,a,c,l,h,new zn)),s&&(u.uv1=ep.getInterpolatedAttribute(s,a,c,l,h,new zn)),o&&(u.normal=ep.getInterpolatedAttribute(o,a,c,l,h,new zt),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const f={a,b:c,c:l,normal:new zt,materialIndex:0};ep.getNormal(qC,YC,KC,f.normal),u.face=f,u.barycoord=h}return u}class QE extends jm{constructor(e=1,n=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],h=[];let f=0,d=0;p("z","y","x",-1,-1,r,n,e,o,s,0),p("z","y","x",1,-1,r,n,-e,o,s,1),p("x","z","y",1,1,e,r,n,i,o,2),p("x","z","y",1,-1,e,r,-n,i,o,3),p("x","y","z",1,-1,e,n,r,i,s,4),p("x","y","z",-1,-1,e,n,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new d1(l,3)),this.setAttribute("normal",new d1(u,3)),this.setAttribute("uv",new d1(h,2));function p(m,g,_,y,v,E,x,A,T,k,L){const I=E/T,F=x/k,M=E/2,D=x/2,O=A/2,z=T+1,q=k+1;let G=0,K=0;const te=new zt;for(let re=0;re<q;re++){const H=re*F-D;for(let Y=0;Y<z;Y++){const Z=Y*I-M;te[m]=Z*y,te[g]=H*v,te[_]=O,l.push(te.x,te.y,te.z),te[m]=0,te[g]=0,te[_]=A>0?1:-1,u.push(te.x,te.y,te.z),h.push(Y/T),h.push(1-re/k),G+=1}}for(let re=0;re<k;re++)for(let H=0;H<T;H++){const Y=f+H+z*re,Z=f+H+z*(re+1),Q=f+(H+1)+z*(re+1),ie=f+(H+1)+z*re;c.push(Y,Z,ie),c.push(Z,Q,ie),K+=6}a.addGroup(d,K,L),d+=K,f+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new QE(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function xE(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function tu(t){const e={};for(let n=0;n<t.length;n++){const r=xE(t[n]);for(const i in r)e[i]=r[i]}return e}function Cce(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function lq(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Xi.workingColorSpace}const Rce={clone:xE,merge:tu};var kce=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Mce=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ao extends W1{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=kce,this.fragmentShader=Mce,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=xE(e.uniforms),this.uniformsGroups=Cce(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?n.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?n.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?n.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?n.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?n.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?n.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?n.uniforms[i]={type:"m4",value:o.toArray()}:n.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}class uq extends Pc{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new So,this.projectionMatrix=new So,this.projectionMatrixInverse=new So,this.coordinateSystem=vg}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const z_=new zt,HB=new zn,$B=new zn;class su extends uq{constructor(e=50,n=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=KT*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(IT*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return KT*2*Math.atan(Math.tan(IT*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){z_.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(z_.x,z_.y).multiplyScalar(-e/z_.z),z_.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(z_.x,z_.y).multiplyScalar(-e/z_.z)}getViewSize(e,n){return this.getViewBounds(e,HB,$B),n.subVectors($B,HB)}setViewOffset(e,n,r,i,s,o){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(IT*.5*this.fov)/this.zoom,r=2*n,i=this.aspect*r,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,n-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const pS=-90,mS=1;class Oce extends Pc{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new su(pS,mS,e,n);i.layers=this.layers,this.add(i);const s=new su(pS,mS,e,n);s.layers=this.layers,this.add(s);const o=new su(pS,mS,e,n);o.layers=this.layers,this.add(o);const a=new su(pS,mS,e,n);a.layers=this.layers,this.add(a);const c=new su(pS,mS,e,n);c.layers=this.layers,this.add(c);const l=new su(pS,mS,e,n);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,i,s,o,a,c]=n;for(const l of n)this.remove(l);if(e===vg)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===Xk)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of n)this.add(l),l.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const m=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(n,s),e.setRenderTarget(r,1,i),e.render(n,o),e.setRenderTarget(r,2,i),e.render(n,a),e.setRenderTarget(r,3,i),e.render(n,c),e.setRenderTarget(r,4,i),e.render(n,l),r.texture.generateMipmaps=m,e.setRenderTarget(r,5,i),e.render(n,u),e.setRenderTarget(h,f,d),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class hq extends hc{constructor(e=[],n=yE,r,i,s,o,a,c,l,u){super(e,n,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Ice extends il{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new hq(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Ml}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new QE(5,5,5),s=new ao({name:"CubemapFromEquirect",uniforms:xE(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Ic,blending:rl});s.uniforms.tEquirect.value=n;const o=new ef(i,s),a=n.minFilter;return n.minFilter===s1&&(n.minFilter=Ml),new Oce(1,10,this).update(e,o),n.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,n=!0,r=!0,i=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(n,r,i);e.setRenderTarget(s)}}class bT extends Pc{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Nce={type:"move"};class E3{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new bT,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new bT,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new zt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new zt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new bT,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new zt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new zt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const m of e.hand.values()){const g=n.getJointPose(m,r),_=this._getHandJoint(l,m);g!==null&&(_.matrix.fromArray(g.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,_.jointRadius=g.radius),_.visible=g!==null}const u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],f=u.position.distanceTo(h.position),d=.02,p=.005;l.inputState.pinching&&f>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,r),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=n.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Nce)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new bT;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}class Jk extends Pc{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Pm,this.environmentIntensity=1,this.environmentRotation=new Pm,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class bO extends hc{constructor(e=null,n=1,r=1,i,s,o,a,c,l=Il,u=Il,h,f){super(null,o,a,c,l,u,i,s,h,f),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class XD extends hh{constructor(e,n,r,i=1){super(e,n,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const gS=new So,GB=new So,QC=[],WB=new G1,Pce=new So,Kx=new ef,Xx=new ZE;class Dce extends ef{constructor(e,n,r){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new XD(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,Pce)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new G1),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,gS),WB.copy(e.boundingBox).applyMatrix4(gS),this.boundingBox.union(WB)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new ZE),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,gS),Xx.copy(e.boundingSphere).applyMatrix4(gS),this.boundingSphere.union(Xx)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const r=n.morphTargetInfluences,i=this.morphTexture.source.data.data,s=r.length+1,o=e*s+1;for(let a=0;a<r.length;a++)r[a]=i[o+a]}raycast(e,n){const r=this.matrixWorld,i=this.count;if(Kx.geometry=this.geometry,Kx.material=this.material,Kx.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Xx.copy(this.boundingSphere),Xx.applyMatrix4(r),e.ray.intersectsSphere(Xx)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,gS),GB.multiplyMatrices(r,gS),Kx.matrixWorld=GB,Kx.raycast(e,QC);for(let o=0,a=QC.length;o<a;o++){const c=QC[o];c.instanceId=s,c.object=this,n.push(c)}QC.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new XD(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const r=n.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new bO(new Float32Array(i*this.count),i,this.count,BA,tp));const s=this.morphTexture.source.data.data;let o=0;for(let l=0;l<r.length;l++)o+=r[l];const a=this.geometry.morphTargetsRelative?1:1-o,c=i*e;s[c]=a,s.set(r,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const x3=new zt,Lce=new zt,Uce=new pi;let Wy=class{constructor(e=new zt(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,i){return this.normal.set(e,n,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const i=x3.subVectors(r,n).cross(Lce.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(x3),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:n.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||Uce.getNormalMatrix(e),i=this.coplanarPoint(x3).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Ey=new ZE,eR=new zt;class fq{constructor(e=new Wy,n=new Wy,r=new Wy,i=new Wy,s=new Wy,o=new Wy){this.planes=[e,n,r,i,s,o]}set(e,n,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=vg){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],h=i[6],f=i[7],d=i[8],p=i[9],m=i[10],g=i[11],_=i[12],y=i[13],v=i[14],E=i[15];if(r[0].setComponents(c-s,f-l,g-d,E-_).normalize(),r[1].setComponents(c+s,f+l,g+d,E+_).normalize(),r[2].setComponents(c+o,f+u,g+p,E+y).normalize(),r[3].setComponents(c-o,f-u,g-p,E-y).normalize(),r[4].setComponents(c-a,f-h,g-m,E-v).normalize(),n===vg)r[5].setComponents(c+a,f+h,g+m,E+v).normalize();else if(n===Xk)r[5].setComponents(a,h,m,v).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Ey.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Ey.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Ey)}intersectsSprite(e){return Ey.center.set(0,0,0),Ey.radius=.7071067811865476,Ey.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ey)}intersectsSphere(e){const n=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const i=n[r];if(eR.x=i.normal.x>0?e.max.x:e.min.x,eR.y=i.normal.y>0?e.max.y:e.min.y,eR.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(eR)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Bce extends W1{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new wi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const qB=new So,JD=new J4,tR=new ZE,nR=new zt;class Fce extends Pc{constructor(e=new jm,n=new Bce){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),tR.copy(r.boundingSphere),tR.applyMatrix4(i),tR.radius+=s,e.ray.intersectsSphere(tR)===!1)return;qB.copy(i).invert(),JD.copy(e.ray).applyMatrix4(qB);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,h=r.attributes.position;if(l!==null){const f=Math.max(0,o.start),d=Math.min(l.count,o.start+o.count);for(let p=f,m=d;p<m;p++){const g=l.getX(p);nR.fromBufferAttribute(h,g),YB(nR,g,c,i,e,n,this)}}else{const f=Math.max(0,o.start),d=Math.min(h.count,o.start+o.count);for(let p=f,m=d;p<m;p++)nR.fromBufferAttribute(h,p),YB(nR,p,c,i,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function YB(t,e,n,r,i,s,o){const a=JD.distanceSqToPoint(t);if(a<n){const c=new zt;JD.closestPointToPoint(t,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class jce extends hc{constructor(e,n,r,i,s,o,a,c,l){super(e,n,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class SO extends hc{constructor(e,n,r=pv,i,s,o,a=Il,c=Il,l,u=YT){if(u!==YT&&u!==EE)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:n},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new X4(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class jA extends jm{constructor(e=1,n=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:i};const s=e/2,o=n/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,h=e/a,f=n/c,d=[],p=[],m=[],g=[];for(let _=0;_<u;_++){const y=_*f-o;for(let v=0;v<l;v++){const E=v*h-s;p.push(E,-y,0),m.push(0,0,1),g.push(v/a),g.push(1-_/c)}}for(let _=0;_<c;_++)for(let y=0;y<a;y++){const v=y+l*_,E=y+l*(_+1),x=y+1+l*(_+1),A=y+1+l*_;d.push(v,E,A),d.push(E,x,A)}this.setIndex(d),this.setAttribute("position",new d1(p,3)),this.setAttribute("normal",new d1(m,3)),this.setAttribute("uv",new d1(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jA(e.width,e.height,e.widthSegments,e.heightSegments)}}class zce extends W1{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=$1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Vce extends W1{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const KB={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Hce{constructor(e,n,r){const i=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(u){a++,s===!1&&i.onStart!==void 0&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){const h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,f=l.length;h<f;h+=2){const d=l[h],p=l[h+1];if(d.global&&(d.lastIndex=0),d.test(u))return p}return null}}}const $ce=new Hce;class Q4{constructor(e){this.manager=e!==void 0?e:$ce,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(i,s){r.load(e,i,n,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Q4.DEFAULT_MATERIAL_NAME="__DEFAULT";class Gce extends Q4{constructor(e){super(e)}load(e,n,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=KB.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o;const a=XT("img");function c(){u(),KB.add(e,this),n&&n(this),s.manager.itemEnd(e)}function l(h){u(),i&&i(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class Wce extends Q4{constructor(e){super(e)}load(e,n,r,i){const s=new hc,o=new Gce(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,n!==void 0&&n(s)},r,i),s}}let EO=class extends uq{constructor(e=-1,n=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+n,c=i-n;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}};class qce extends su{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}let Yce=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=XB(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=XB();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}};function XB(){return performance.now()}class un{constructor(e){this.value=e}clone(){return new un(this.value.clone===void 0?this.value:this.value.clone())}}const JB=new So;class dq{constructor(e,n,r=0,i=1/0){this.ray=new J4(e,n),this.near=r,this.far=i,this.camera=null,this.layers=new JT,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return JB.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(JB),this}intersectObject(e,n=!0,r=[]){return ZD(e,this,r,n),r.sort(ZB),r}intersectObjects(e,n=!0,r=[]){for(let i=0,s=e.length;i<s;i++)ZD(e[i],this,r,n);return r.sort(ZB),r}}function ZB(t,e){return t.distance-e.distance}function ZD(t,e,n,r){let i=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(i=!1),i===!0&&r===!0){const s=t.children;for(let o=0,a=s.length;o<a;o++)ZD(s[o],e,n,!0)}}const QB=new zn;class Kce{constructor(e=new zn(1/0,1/0),n=new zn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=QB.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,QB).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function eF(t,e,n,r){const i=Xce(r);switch(n){case QW:return t*e;case BA:return t*e/i.components*i.byteLength;case W4:return t*e/i.components*i.byteLength;case q4:return t*e*2/i.components*i.byteLength;case Y4:return t*e*2/i.components*i.byteLength;case eq:return t*e*3/i.components*i.byteLength;case lu:return t*e*4/i.components*i.byteLength;case yO:return t*e*4/i.components*i.byteLength;case sk:case ok:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case ak:case ck:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case TD:case CD:return Math.max(t,16)*Math.max(e,8)/4;case wD:case AD:return Math.max(t,8)*Math.max(e,8)/2;case RD:case kD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case MD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case OD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case ID:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case ND:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case PD:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case DD:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case LD:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case UD:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case BD:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case FD:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case jD:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case zD:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case VD:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case HD:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case $D:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case lk:case GD:case WD:return Math.ceil(t/4)*Math.ceil(e/4)*16;case tq:case qD:return Math.ceil(t/4)*Math.ceil(e/4)*8;case YD:case KD:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function Xce(t){switch(t){case ko:case XW:return{byteLength:1,components:1};case qT:case JW:case Av:return{byteLength:2,components:1};case $4:case G4:return{byteLength:2,components:4};case pv:case H4:case tp:return{byteLength:4,components:1};case ZW:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:UA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=UA);function pq(){let t=null,e=!1,n=null,r=null;function i(s,o){n(s,o),r=t.requestAnimationFrame(i)}return{start:function(){e!==!0&&n!==null&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function Jce(t){const e=new WeakMap;function n(a,c){const l=a.array,u=a.usage,h=l.byteLength,f=t.createBuffer();t.bindBuffer(c,f),t.bufferData(c,l,u),a.onUploadCallback();let d;if(l instanceof Float32Array)d=t.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?d=t.HALF_FLOAT:d=t.UNSIGNED_SHORT;else if(l instanceof Int16Array)d=t.SHORT;else if(l instanceof Uint32Array)d=t.UNSIGNED_INT;else if(l instanceof Int32Array)d=t.INT;else if(l instanceof Int8Array)d=t.BYTE;else if(l instanceof Uint8Array)d=t.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)d=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:f,type:d,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:h}}function r(a,c,l){const u=c.array,h=c.updateRanges;if(t.bindBuffer(l,a),h.length===0)t.bufferSubData(l,0,u);else{h.sort((d,p)=>d.start-p.start);let f=0;for(let d=1;d<h.length;d++){const p=h[f],m=h[d];m.start<=p.start+p.count+1?p.count=Math.max(p.count,m.start+m.count-p.start):(++f,h[f]=m)}h.length=f+1;for(let d=0,p=h.length;d<p;d++){const m=h[d];t.bufferSubData(l,m.start*u.BYTES_PER_ELEMENT,u,m.start,m.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(t.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=e.get(a);if(l===void 0)e.set(a,n(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}var Zce=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Qce=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,ele=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,tle=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,nle=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,rle=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ile=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,sle=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ole=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,ale=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,cle=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,lle=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ule=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,hle=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,fle=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,dle=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,ple=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,mle=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,gle=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,_le=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,vle=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,yle=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,ble=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Sle=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Ele=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,xle=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,wle=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Tle=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Ale=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Cle=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Rle="gl_FragColor = linearToOutputTexel( gl_FragColor );",kle=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Mle=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Ole=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Ile=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Nle=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Ple=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Dle=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Lle=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ule=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Ble=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Fle=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,jle=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,zle=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Vle=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Hle=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,$le=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Gle=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Wle=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,qle=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Yle=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Kle=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Xle=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Jle=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Zle=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Qle=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,eue=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,tue=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,nue=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,rue=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,iue=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,sue=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,oue=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,aue=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,cue=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,lue=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,uue=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,hue=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,fue=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,due=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,pue=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,mue=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,gue=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,_ue=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,vue=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,yue=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,bue=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Sue=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Eue=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,xue=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,wue=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Tue=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Aue=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Cue=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Rue=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,kue=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Mue=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Oue=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Iue=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Nue=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Pue=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Due=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Lue=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Uue=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Bue=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Fue=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,jue=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,zue=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Vue=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Hue=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,$ue=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Gue=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Wue=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,que=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Yue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Kue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Xue=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Jue=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Zue=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Que=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ehe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,the=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,nhe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,rhe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,ihe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,she=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,ohe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,ahe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,che=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lhe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,uhe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,hhe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fhe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dhe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,phe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mhe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ghe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_he=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,vhe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,yhe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bhe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,She=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Ehe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xhe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,whe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,The=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Ahe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Che=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Rhe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,khe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Mhe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vi={alphahash_fragment:Zce,alphahash_pars_fragment:Qce,alphamap_fragment:ele,alphamap_pars_fragment:tle,alphatest_fragment:nle,alphatest_pars_fragment:rle,aomap_fragment:ile,aomap_pars_fragment:sle,batching_pars_vertex:ole,batching_vertex:ale,begin_vertex:cle,beginnormal_vertex:lle,bsdfs:ule,iridescence_fragment:hle,bumpmap_pars_fragment:fle,clipping_planes_fragment:dle,clipping_planes_pars_fragment:ple,clipping_planes_pars_vertex:mle,clipping_planes_vertex:gle,color_fragment:_le,color_pars_fragment:vle,color_pars_vertex:yle,color_vertex:ble,common:Sle,cube_uv_reflection_fragment:Ele,defaultnormal_vertex:xle,displacementmap_pars_vertex:wle,displacementmap_vertex:Tle,emissivemap_fragment:Ale,emissivemap_pars_fragment:Cle,colorspace_fragment:Rle,colorspace_pars_fragment:kle,envmap_fragment:Mle,envmap_common_pars_fragment:Ole,envmap_pars_fragment:Ile,envmap_pars_vertex:Nle,envmap_physical_pars_fragment:$le,envmap_vertex:Ple,fog_vertex:Dle,fog_pars_vertex:Lle,fog_fragment:Ule,fog_pars_fragment:Ble,gradientmap_pars_fragment:Fle,lightmap_pars_fragment:jle,lights_lambert_fragment:zle,lights_lambert_pars_fragment:Vle,lights_pars_begin:Hle,lights_toon_fragment:Gle,lights_toon_pars_fragment:Wle,lights_phong_fragment:qle,lights_phong_pars_fragment:Yle,lights_physical_fragment:Kle,lights_physical_pars_fragment:Xle,lights_fragment_begin:Jle,lights_fragment_maps:Zle,lights_fragment_end:Qle,logdepthbuf_fragment:eue,logdepthbuf_pars_fragment:tue,logdepthbuf_pars_vertex:nue,logdepthbuf_vertex:rue,map_fragment:iue,map_pars_fragment:sue,map_particle_fragment:oue,map_particle_pars_fragment:aue,metalnessmap_fragment:cue,metalnessmap_pars_fragment:lue,morphinstance_vertex:uue,morphcolor_vertex:hue,morphnormal_vertex:fue,morphtarget_pars_vertex:due,morphtarget_vertex:pue,normal_fragment_begin:mue,normal_fragment_maps:gue,normal_pars_fragment:_ue,normal_pars_vertex:vue,normal_vertex:yue,normalmap_pars_fragment:bue,clearcoat_normal_fragment_begin:Sue,clearcoat_normal_fragment_maps:Eue,clearcoat_pars_fragment:xue,iridescence_pars_fragment:wue,opaque_fragment:Tue,packing:Aue,premultiplied_alpha_fragment:Cue,project_vertex:Rue,dithering_fragment:kue,dithering_pars_fragment:Mue,roughnessmap_fragment:Oue,roughnessmap_pars_fragment:Iue,shadowmap_pars_fragment:Nue,shadowmap_pars_vertex:Pue,shadowmap_vertex:Due,shadowmask_pars_fragment:Lue,skinbase_vertex:Uue,skinning_pars_vertex:Bue,skinning_vertex:Fue,skinnormal_vertex:jue,specularmap_fragment:zue,specularmap_pars_fragment:Vue,tonemapping_fragment:Hue,tonemapping_pars_fragment:$ue,transmission_fragment:Gue,transmission_pars_fragment:Wue,uv_pars_fragment:que,uv_pars_vertex:Yue,uv_vertex:Kue,worldpos_vertex:Xue,background_vert:Jue,background_frag:Zue,backgroundCube_vert:Que,backgroundCube_frag:ehe,cube_vert:the,cube_frag:nhe,depth_vert:rhe,depth_frag:ihe,distanceRGBA_vert:she,distanceRGBA_frag:ohe,equirect_vert:ahe,equirect_frag:che,linedashed_vert:lhe,linedashed_frag:uhe,meshbasic_vert:hhe,meshbasic_frag:fhe,meshlambert_vert:dhe,meshlambert_frag:phe,meshmatcap_vert:mhe,meshmatcap_frag:ghe,meshnormal_vert:_he,meshnormal_frag:vhe,meshphong_vert:yhe,meshphong_frag:bhe,meshphysical_vert:She,meshphysical_frag:Ehe,meshtoon_vert:xhe,meshtoon_frag:whe,points_vert:The,points_frag:Ahe,shadow_vert:Che,shadow_frag:Rhe,sprite_vert:khe,sprite_frag:Mhe},qn={common:{diffuse:{value:new wi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new pi},alphaMap:{value:null},alphaMapTransform:{value:new pi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new pi}},envmap:{envMap:{value:null},envMapRotation:{value:new pi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new pi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new pi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new pi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new pi},normalScale:{value:new zn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new pi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new pi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new pi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new pi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new wi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new wi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new pi},alphaTest:{value:0},uvTransform:{value:new pi}},sprite:{diffuse:{value:new wi(16777215)},opacity:{value:1},center:{value:new zn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new pi},alphaMap:{value:null},alphaMapTransform:{value:new pi},alphaTest:{value:0}}},pm={basic:{uniforms:tu([qn.common,qn.specularmap,qn.envmap,qn.aomap,qn.lightmap,qn.fog]),vertexShader:vi.meshbasic_vert,fragmentShader:vi.meshbasic_frag},lambert:{uniforms:tu([qn.common,qn.specularmap,qn.envmap,qn.aomap,qn.lightmap,qn.emissivemap,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.fog,qn.lights,{emissive:{value:new wi(0)}}]),vertexShader:vi.meshlambert_vert,fragmentShader:vi.meshlambert_frag},phong:{uniforms:tu([qn.common,qn.specularmap,qn.envmap,qn.aomap,qn.lightmap,qn.emissivemap,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.fog,qn.lights,{emissive:{value:new wi(0)},specular:{value:new wi(1118481)},shininess:{value:30}}]),vertexShader:vi.meshphong_vert,fragmentShader:vi.meshphong_frag},standard:{uniforms:tu([qn.common,qn.envmap,qn.aomap,qn.lightmap,qn.emissivemap,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.roughnessmap,qn.metalnessmap,qn.fog,qn.lights,{emissive:{value:new wi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:vi.meshphysical_vert,fragmentShader:vi.meshphysical_frag},toon:{uniforms:tu([qn.common,qn.aomap,qn.lightmap,qn.emissivemap,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.gradientmap,qn.fog,qn.lights,{emissive:{value:new wi(0)}}]),vertexShader:vi.meshtoon_vert,fragmentShader:vi.meshtoon_frag},matcap:{uniforms:tu([qn.common,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.fog,{matcap:{value:null}}]),vertexShader:vi.meshmatcap_vert,fragmentShader:vi.meshmatcap_frag},points:{uniforms:tu([qn.points,qn.fog]),vertexShader:vi.points_vert,fragmentShader:vi.points_frag},dashed:{uniforms:tu([qn.common,qn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vi.linedashed_vert,fragmentShader:vi.linedashed_frag},depth:{uniforms:tu([qn.common,qn.displacementmap]),vertexShader:vi.depth_vert,fragmentShader:vi.depth_frag},normal:{uniforms:tu([qn.common,qn.bumpmap,qn.normalmap,qn.displacementmap,{opacity:{value:1}}]),vertexShader:vi.meshnormal_vert,fragmentShader:vi.meshnormal_frag},sprite:{uniforms:tu([qn.sprite,qn.fog]),vertexShader:vi.sprite_vert,fragmentShader:vi.sprite_frag},background:{uniforms:{uvTransform:{value:new pi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:vi.background_vert,fragmentShader:vi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new pi}},vertexShader:vi.backgroundCube_vert,fragmentShader:vi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:vi.cube_vert,fragmentShader:vi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vi.equirect_vert,fragmentShader:vi.equirect_frag},distanceRGBA:{uniforms:tu([qn.common,qn.displacementmap,{referencePosition:{value:new zt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vi.distanceRGBA_vert,fragmentShader:vi.distanceRGBA_frag},shadow:{uniforms:tu([qn.lights,qn.fog,{color:{value:new wi(0)},opacity:{value:1}}]),vertexShader:vi.shadow_vert,fragmentShader:vi.shadow_frag}};pm.physical={uniforms:tu([pm.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new pi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new pi},clearcoatNormalScale:{value:new zn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new pi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new pi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new pi},sheen:{value:0},sheenColor:{value:new wi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new pi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new pi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new pi},transmissionSamplerSize:{value:new zn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new pi},attenuationDistance:{value:0},attenuationColor:{value:new wi(0)},specularColor:{value:new wi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new pi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new pi},anisotropyVector:{value:new zn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new pi}}]),vertexShader:vi.meshphysical_vert,fragmentShader:vi.meshphysical_frag};const rR={r:0,b:0,g:0},xy=new Pm,Ohe=new So;function Ihe(t,e,n,r,i,s,o){const a=new wi(0);let c=s===!0?0:1,l,u,h=null,f=0,d=null;function p(v){let E=v.isScene===!0?v.background:null;return E&&E.isTexture&&(E=(v.backgroundBlurriness>0?n:e).get(E)),E}function m(v){let E=!1;const x=p(v);x===null?_(a,c):x&&x.isColor&&(_(x,1),E=!0);const A=t.xr.getEnvironmentBlendMode();A==="additive"?r.buffers.color.setClear(0,0,0,1,o):A==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,o),(t.autoClear||E)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function g(v,E){const x=p(E);x&&(x.isCubeTexture||x.mapping===vO)?(u===void 0&&(u=new ef(new QE(1,1,1),new ao({name:"BackgroundCubeMaterial",uniforms:xE(pm.backgroundCube.uniforms),vertexShader:pm.backgroundCube.vertexShader,fragmentShader:pm.backgroundCube.fragmentShader,side:Ic,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,T,k){this.matrixWorld.copyPosition(k.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),xy.copy(E.backgroundRotation),xy.x*=-1,xy.y*=-1,xy.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(xy.y*=-1,xy.z*=-1),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Ohe.makeRotationFromEuler(xy)),u.material.toneMapped=Xi.getTransfer(x.colorSpace)!==Bs,(h!==x||f!==x.version||d!==t.toneMapping)&&(u.material.needsUpdate=!0,h=x,f=x.version,d=t.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(l===void 0&&(l=new ef(new jA(2,2),new ao({name:"BackgroundMaterial",uniforms:xE(pm.background.uniforms),vertexShader:pm.background.vertexShader,fragmentShader:pm.background.fragmentShader,side:Ag,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=x,l.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,l.material.toneMapped=Xi.getTransfer(x.colorSpace)!==Bs,x.matrixAutoUpdate===!0&&x.updateMatrix(),l.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||f!==x.version||d!==t.toneMapping)&&(l.material.needsUpdate=!0,h=x,f=x.version,d=t.toneMapping),l.layers.enableAll(),v.unshift(l,l.geometry,l.material,0,0,null))}function _(v,E){v.getRGB(rR,lq(t)),r.buffers.color.setClear(rR.r,rR.g,rR.b,E,o)}function y(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),l!==void 0&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}return{getClearColor:function(){return a},setClearColor:function(v,E=1){a.set(v),c=E,_(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(v){c=v,_(a,c)},render:m,addToRenderList:g,dispose:y}}function Nhe(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=f(null);let s=i,o=!1;function a(I,F,M,D,O){let z=!1;const q=h(D,M,F);s!==q&&(s=q,l(s.object)),z=d(I,D,M,O),z&&p(I,D,M,O),O!==null&&e.update(O,t.ELEMENT_ARRAY_BUFFER),(z||o)&&(o=!1,E(I,F,M,D),O!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(O).buffer))}function c(){return t.createVertexArray()}function l(I){return t.bindVertexArray(I)}function u(I){return t.deleteVertexArray(I)}function h(I,F,M){const D=M.wireframe===!0;let O=r[I.id];O===void 0&&(O={},r[I.id]=O);let z=O[F.id];z===void 0&&(z={},O[F.id]=z);let q=z[D];return q===void 0&&(q=f(c()),z[D]=q),q}function f(I){const F=[],M=[],D=[];for(let O=0;O<n;O++)F[O]=0,M[O]=0,D[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:M,attributeDivisors:D,object:I,attributes:{},index:null}}function d(I,F,M,D){const O=s.attributes,z=F.attributes;let q=0;const G=M.getAttributes();for(const K in G)if(G[K].location>=0){const re=O[K];let H=z[K];if(H===void 0&&(K==="instanceMatrix"&&I.instanceMatrix&&(H=I.instanceMatrix),K==="instanceColor"&&I.instanceColor&&(H=I.instanceColor)),re===void 0||re.attribute!==H||H&&re.data!==H.data)return!0;q++}return s.attributesNum!==q||s.index!==D}function p(I,F,M,D){const O={},z=F.attributes;let q=0;const G=M.getAttributes();for(const K in G)if(G[K].location>=0){let re=z[K];re===void 0&&(K==="instanceMatrix"&&I.instanceMatrix&&(re=I.instanceMatrix),K==="instanceColor"&&I.instanceColor&&(re=I.instanceColor));const H={};H.attribute=re,re&&re.data&&(H.data=re.data),O[K]=H,q++}s.attributes=O,s.attributesNum=q,s.index=D}function m(){const I=s.newAttributes;for(let F=0,M=I.length;F<M;F++)I[F]=0}function g(I){_(I,0)}function _(I,F){const M=s.newAttributes,D=s.enabledAttributes,O=s.attributeDivisors;M[I]=1,D[I]===0&&(t.enableVertexAttribArray(I),D[I]=1),O[I]!==F&&(t.vertexAttribDivisor(I,F),O[I]=F)}function y(){const I=s.newAttributes,F=s.enabledAttributes;for(let M=0,D=F.length;M<D;M++)F[M]!==I[M]&&(t.disableVertexAttribArray(M),F[M]=0)}function v(I,F,M,D,O,z,q){q===!0?t.vertexAttribIPointer(I,F,M,O,z):t.vertexAttribPointer(I,F,M,D,O,z)}function E(I,F,M,D){m();const O=D.attributes,z=M.getAttributes(),q=F.defaultAttributeValues;for(const G in z){const K=z[G];if(K.location>=0){let te=O[G];if(te===void 0&&(G==="instanceMatrix"&&I.instanceMatrix&&(te=I.instanceMatrix),G==="instanceColor"&&I.instanceColor&&(te=I.instanceColor)),te!==void 0){const re=te.normalized,H=te.itemSize,Y=e.get(te);if(Y===void 0)continue;const Z=Y.buffer,Q=Y.type,ie=Y.bytesPerElement,ge=Q===t.INT||Q===t.UNSIGNED_INT||te.gpuType===H4;if(te.isInterleavedBufferAttribute){const Te=te.data,be=Te.stride,Pe=te.offset;if(Te.isInstancedInterleavedBuffer){for(let Ge=0;Ge<K.locationSize;Ge++)_(K.location+Ge,Te.meshPerAttribute);I.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=Te.meshPerAttribute*Te.count)}else for(let Ge=0;Ge<K.locationSize;Ge++)g(K.location+Ge);t.bindBuffer(t.ARRAY_BUFFER,Z);for(let Ge=0;Ge<K.locationSize;Ge++)v(K.location+Ge,H/K.locationSize,Q,re,be*ie,(Pe+H/K.locationSize*Ge)*ie,ge)}else{if(te.isInstancedBufferAttribute){for(let Te=0;Te<K.locationSize;Te++)_(K.location+Te,te.meshPerAttribute);I.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let Te=0;Te<K.locationSize;Te++)g(K.location+Te);t.bindBuffer(t.ARRAY_BUFFER,Z);for(let Te=0;Te<K.locationSize;Te++)v(K.location+Te,H/K.locationSize,Q,re,H*ie,H/K.locationSize*Te*ie,ge)}}else if(q!==void 0){const re=q[G];if(re!==void 0)switch(re.length){case 2:t.vertexAttrib2fv(K.location,re);break;case 3:t.vertexAttrib3fv(K.location,re);break;case 4:t.vertexAttrib4fv(K.location,re);break;default:t.vertexAttrib1fv(K.location,re)}}}}y()}function x(){k();for(const I in r){const F=r[I];for(const M in F){const D=F[M];for(const O in D)u(D[O].object),delete D[O];delete F[M]}delete r[I]}}function A(I){if(r[I.id]===void 0)return;const F=r[I.id];for(const M in F){const D=F[M];for(const O in D)u(D[O].object),delete D[O];delete F[M]}delete r[I.id]}function T(I){for(const F in r){const M=r[F];if(M[I.id]===void 0)continue;const D=M[I.id];for(const O in D)u(D[O].object),delete D[O];delete M[I.id]}}function k(){L(),o=!0,s!==i&&(s=i,l(s.object))}function L(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:k,resetDefaultState:L,dispose:x,releaseStatesOfGeometry:A,releaseStatesOfProgram:T,initAttributes:m,enableAttribute:g,disableUnusedAttributes:y}}function Phe(t,e,n){let r;function i(l){r=l}function s(l,u){t.drawArrays(r,l,u),n.update(u,r,1)}function o(l,u,h){h!==0&&(t.drawArraysInstanced(r,l,u,h),n.update(u,r,h))}function a(l,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,u,0,h);let d=0;for(let p=0;p<h;p++)d+=u[p];n.update(d,r,1)}function c(l,u,h,f){if(h===0)return;const d=e.get("WEBGL_multi_draw");if(d===null)for(let p=0;p<l.length;p++)o(l[p],u[p],f[p]);else{d.multiDrawArraysInstancedWEBGL(r,l,0,u,0,f,0,h);let p=0;for(let m=0;m<h;m++)p+=u[m]*f[m];n.update(p,r,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function Dhe(t,e,n,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const T=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(T){return!(T!==lu&&r.convert(T)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(T){const k=T===Av&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(T!==ko&&r.convert(T)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&T!==tp&&!k)}function c(T){if(T==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return T==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=n.precision!==void 0?n.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const h=n.logarithmicDepthBuffer===!0,f=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),d=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),p=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=t.getParameter(t.MAX_TEXTURE_SIZE),g=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),_=t.getParameter(t.MAX_VERTEX_ATTRIBS),y=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),v=t.getParameter(t.MAX_VARYING_VECTORS),E=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),x=p>0,A=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:h,reverseDepthBuffer:f,maxTextures:d,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:g,maxAttributes:_,maxVertexUniforms:y,maxVaryings:v,maxFragmentUniforms:E,vertexTextures:x,maxSamples:A}}function Lhe(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new Wy,a=new pi,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const d=h.length!==0||f||r!==0||i;return i=f,r=h.length,d},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,f){n=u(h,f,0)},this.setState=function(h,f,d){const p=h.clippingPlanes,m=h.clipIntersection,g=h.clipShadows,_=t.get(h);if(!i||p===null||p.length===0||s&&!g)s?u(null):l();else{const y=s?0:r,v=y*4;let E=_.clippingState||null;c.value=E,E=u(p,f,v,d);for(let x=0;x!==v;++x)E[x]=n[x];_.clippingState=E,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,f,d,p){const m=h!==null?h.length:0;let g=null;if(m!==0){if(g=c.value,p!==!0||g===null){const _=d+m*4,y=f.matrixWorldInverse;a.getNormalMatrix(y),(g===null||g.length<_)&&(g=new Float32Array(_));for(let v=0,E=d;v!==m;++v,E+=4)o.copy(h[v]).applyMatrix4(y,a),o.normal.toArray(g,E),g[E+3]=o.constant}c.value=g,c.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,g}}function Uhe(t){let e=new WeakMap;function n(o,a){return a===SD?o.mapping=yE:a===ED&&(o.mapping=bE),o}function r(o){if(o&&o.isTexture){const a=o.mapping;if(a===SD||a===ED)if(e.has(o)){const c=e.get(o).texture;return n(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new Ice(c.height);return l.fromEquirectangularTexture(t,o),e.set(o,l),o.addEventListener("dispose",i),n(l.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const XS=4,tF=[.125,.215,.35,.446,.526,.582],Qy=20,w3=new EO,nF=new wi;let T3=null,A3=0,C3=0,R3=!1;const qy=(1+Math.sqrt(5))/2,_S=1/qy,rF=[new zt(-qy,_S,0),new zt(qy,_S,0),new zt(-_S,0,qy),new zt(_S,0,qy),new zt(0,qy,-_S),new zt(0,qy,_S),new zt(-1,1,-1),new zt(1,1,-1),new zt(-1,1,1),new zt(1,1,1)],Bhe=new zt;class iF{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,r=.1,i=100,s={}){const{size:o=256,position:a=Bhe}=s;T3=this._renderer.getRenderTarget(),A3=this._renderer.getActiveCubeFace(),C3=this._renderer.getActiveMipmapLevel(),R3=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,r,i,c,a),n>0&&this._blur(c,0,0,n),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=aF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=oF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(T3,A3,C3),this._renderer.xr.enabled=R3,e.scissorTest=!1,iR(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===yE||e.mapping===bE?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),T3=this._renderer.getRenderTarget(),A3=this._renderer.getActiveCubeFace(),C3=this._renderer.getActiveMipmapLevel(),R3=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:Ml,minFilter:Ml,generateMipmaps:!1,type:Av,format:lu,colorSpace:Cg,depthBuffer:!1},i=sF(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=sF(e,n,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Fhe(s)),this._blurMaterial=jhe(s,e,n)}return i}_compileMaterial(e){const n=new ef(this._lodPlanes[0],e);this._renderer.compile(n,w3)}_sceneToCubeUV(e,n,r,i,s){const c=new su(90,1,n,r),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,d=h.toneMapping;h.getClearColor(nF),h.toneMapping=yg,h.autoClear=!1;const p=new Z4({name:"PMREM.Background",side:Ic,depthWrite:!1,depthTest:!1}),m=new ef(new QE,p);let g=!1;const _=e.background;_?_.isColor&&(p.color.copy(_),e.background=null,g=!0):(p.color.copy(nF),g=!0);for(let y=0;y<6;y++){const v=y%3;v===0?(c.up.set(0,l[y],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+u[y],s.y,s.z)):v===1?(c.up.set(0,0,l[y]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+u[y],s.z)):(c.up.set(0,l[y],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+u[y]));const E=this._cubeSize;iR(i,v*E,y>2?E:0,E,E),h.setRenderTarget(i),g&&h.render(m,c),h.render(e,c)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=d,h.autoClear=f,e.background=_}_textureToCubeUV(e,n){const r=this._renderer,i=e.mapping===yE||e.mapping===bE;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=aF()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=oF());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new ef(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;iR(n,0,0,3*c,2*c),r.setRenderTarget(n),r.render(o,w3)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=rF[(i-s-1)%rF.length];this._blur(e,s-1,s,o,a)}n.autoClear=r}_blur(e,n,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,n,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,n,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new ef(this._lodPlanes[i],l),f=l.uniforms,d=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*d):2*Math.PI/(2*Qy-1),m=s/p,g=isFinite(s)?1+Math.floor(u*m):Qy;g>Qy&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Qy}`);const _=[];let y=0;for(let T=0;T<Qy;++T){const k=T/m,L=Math.exp(-k*k/2);_.push(L),T===0?y+=L:T<g&&(y+=2*L)}for(let T=0;T<_.length;T++)_[T]=_[T]/y;f.envMap.value=e.texture,f.samples.value=g,f.weights.value=_,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:v}=this;f.dTheta.value=p,f.mipInt.value=v-r;const E=this._sizeLods[i],x=3*E*(i>v-XS?i-v+XS:0),A=4*(this._cubeSize-E);iR(n,x,A,3*E,2*E),c.setRenderTarget(n),c.render(h,w3)}}function Fhe(t){const e=[],n=[],r=[];let i=t;const s=t-XS+1+tF.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);n.push(a);let c=1/a;o>t-XS?c=tF[o-t+XS-1]:o===0&&(c=0),r.push(c);const l=1/(a-2),u=-l,h=1+l,f=[u,u,h,u,h,h,u,u,h,h,u,h],d=6,p=6,m=3,g=2,_=1,y=new Float32Array(m*p*d),v=new Float32Array(g*p*d),E=new Float32Array(_*p*d);for(let A=0;A<d;A++){const T=A%3*2/3-1,k=A>2?0:-1,L=[T,k,0,T+2/3,k,0,T+2/3,k+1,0,T,k,0,T+2/3,k+1,0,T,k+1,0];y.set(L,m*p*A),v.set(f,g*p*A);const I=[A,A,A,A,A,A];E.set(I,_*p*A)}const x=new jm;x.setAttribute("position",new hh(y,m)),x.setAttribute("uv",new hh(v,g)),x.setAttribute("faceIndex",new hh(E,_)),e.push(x),i>XS&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}function sF(t,e,n){const r=new il(t,e,n);return r.texture.mapping=vO,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function iR(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function jhe(t,e,n){const r=new Float32Array(Qy),i=new zt(0,1,0);return new ao({name:"SphericalGaussianBlur",defines:{n:Qy,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:e5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:rl,depthTest:!1,depthWrite:!1})}function oF(){return new ao({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:e5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:rl,depthTest:!1,depthWrite:!1})}function aF(){return new ao({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:e5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:rl,depthTest:!1,depthWrite:!1})}function e5(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function zhe(t){let e=new WeakMap,n=null;function r(a){if(a&&a.isTexture){const c=a.mapping,l=c===SD||c===ED,u=c===yE||c===bE;if(l||u){let h=e.get(a);const f=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==f)return n===null&&(n=new iF(t)),h=l?n.fromEquirectangular(a,h):n.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const d=a.image;return l&&d&&d.height>0||u&&d&&i(d)?(n===null&&(n=new iF(t)),h=l?n.fromEquirectangular(a):n.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function i(a){let c=0;const l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:o}}function Vhe(t){const e={};function n(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(r)}return e[r]=i,i}return{has:function(r){return n(r)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(r){const i=n(r);return i===null&&uk("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Hhe(t,e,n,r){const i={},s=new WeakMap;function o(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const p in f.attributes)e.remove(f.attributes[p]);f.removeEventListener("dispose",o),delete i[f.id];const d=s.get(f);d&&(e.remove(d),s.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,n.memory.geometries--}function a(h,f){return i[f.id]===!0||(f.addEventListener("dispose",o),i[f.id]=!0,n.memory.geometries++),f}function c(h){const f=h.attributes;for(const d in f)e.update(f[d],t.ARRAY_BUFFER)}function l(h){const f=[],d=h.index,p=h.attributes.position;let m=0;if(d!==null){const y=d.array;m=d.version;for(let v=0,E=y.length;v<E;v+=3){const x=y[v+0],A=y[v+1],T=y[v+2];f.push(x,A,A,T,T,x)}}else if(p!==void 0){const y=p.array;m=p.version;for(let v=0,E=y.length/3-1;v<E;v+=3){const x=v+0,A=v+1,T=v+2;f.push(x,A,A,T,T,x)}}else return;const g=new(iq(f)?cq:aq)(f,1);g.version=m;const _=s.get(h);_&&e.remove(_),s.set(h,g)}function u(h){const f=s.get(h);if(f){const d=h.index;d!==null&&f.version<d.version&&l(h)}else l(h);return s.get(h)}return{get:a,update:c,getWireframeAttribute:u}}function $he(t,e,n){let r;function i(f){r=f}let s,o;function a(f){s=f.type,o=f.bytesPerElement}function c(f,d){t.drawElements(r,d,s,f*o),n.update(d,r,1)}function l(f,d,p){p!==0&&(t.drawElementsInstanced(r,d,s,f*o,p),n.update(d,r,p))}function u(f,d,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,d,0,s,f,0,p);let g=0;for(let _=0;_<p;_++)g+=d[_];n.update(g,r,1)}function h(f,d,p,m){if(p===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let _=0;_<f.length;_++)l(f[_]/o,d[_],m[_]);else{g.multiDrawElementsInstancedWEBGL(r,d,0,s,f,0,m,0,p);let _=0;for(let y=0;y<p;y++)_+=d[y]*m[y];n.update(_,r,1)}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function Ghe(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(n.calls++,o){case t.TRIANGLES:n.triangles+=a*(s/3);break;case t.LINES:n.lines+=a*(s/2);break;case t.LINE_STRIP:n.lines+=a*(s-1);break;case t.LINE_LOOP:n.lines+=a*s;break;case t.POINTS:n.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:i,update:r}}function Whe(t,e,n){const r=new WeakMap,i=new qo;function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let f=r.get(a);if(f===void 0||f.count!==h){let I=function(){k.dispose(),r.delete(a),a.removeEventListener("dispose",I)};var d=I;f!==void 0&&f.texture.dispose();const p=a.morphAttributes.position!==void 0,m=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,_=a.morphAttributes.position||[],y=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let E=0;p===!0&&(E=1),m===!0&&(E=2),g===!0&&(E=3);let x=a.attributes.position.count*E,A=1;x>e.maxTextureSize&&(A=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const T=new Float32Array(x*A*4*h),k=new sq(T,x,A,h);k.type=tp,k.needsUpdate=!0;const L=E*4;for(let F=0;F<h;F++){const M=_[F],D=y[F],O=v[F],z=x*A*4*F;for(let q=0;q<M.count;q++){const G=q*L;p===!0&&(i.fromBufferAttribute(M,q),T[z+G+0]=i.x,T[z+G+1]=i.y,T[z+G+2]=i.z,T[z+G+3]=0),m===!0&&(i.fromBufferAttribute(D,q),T[z+G+4]=i.x,T[z+G+5]=i.y,T[z+G+6]=i.z,T[z+G+7]=0),g===!0&&(i.fromBufferAttribute(O,q),T[z+G+8]=i.x,T[z+G+9]=i.y,T[z+G+10]=i.z,T[z+G+11]=O.itemSize===4?i.w:1)}}f={count:h,texture:k,size:new zn(x,A)},r.set(a,f),a.addEventListener("dispose",I)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(t,"morphTexture",o.morphTexture,n);else{let p=0;for(let g=0;g<l.length;g++)p+=l[g];const m=a.morphTargetsRelative?1:1-p;c.getUniforms().setValue(t,"morphTargetBaseInfluence",m),c.getUniforms().setValue(t,"morphTargetInfluences",l)}c.getUniforms().setValue(t,"morphTargetsTexture",f.texture,n),c.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}return{update:s}}function qhe(t,e,n,r){let i=new WeakMap;function s(c){const l=r.render.frame,u=c.geometry,h=e.get(c,u);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(n.update(c.instanceMatrix,t.ARRAY_BUFFER),c.instanceColor!==null&&n.update(c.instanceColor,t.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const f=c.skeleton;i.get(f)!==l&&(f.update(),i.set(f,l))}return h}function o(){i=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),n.remove(l.instanceMatrix),l.instanceColor!==null&&n.remove(l.instanceColor)}return{update:s,dispose:o}}const mq=new hc,cF=new SO(1,1),gq=new sq,_q=new mce,vq=new hq,lF=[],uF=[],hF=new Float32Array(16),fF=new Float32Array(9),dF=new Float32Array(4);function ex(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=lF[i];if(s===void 0&&(s=new Float32Array(i),lF[i]=s),e!==0){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=n,t[o].toArray(s,a)}return s}function dc(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function pc(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function xO(t,e){let n=uF[e];n===void 0&&(n=new Int32Array(e),uF[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Yhe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Khe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(dc(n,e))return;t.uniform2fv(this.addr,e),pc(n,e)}}function Xhe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(dc(n,e))return;t.uniform3fv(this.addr,e),pc(n,e)}}function Jhe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(dc(n,e))return;t.uniform4fv(this.addr,e),pc(n,e)}}function Zhe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(dc(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),pc(n,e)}else{if(dc(n,r))return;dF.set(r),t.uniformMatrix2fv(this.addr,!1,dF),pc(n,r)}}function Qhe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(dc(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),pc(n,e)}else{if(dc(n,r))return;fF.set(r),t.uniformMatrix3fv(this.addr,!1,fF),pc(n,r)}}function efe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(dc(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),pc(n,e)}else{if(dc(n,r))return;hF.set(r),t.uniformMatrix4fv(this.addr,!1,hF),pc(n,r)}}function tfe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function nfe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(dc(n,e))return;t.uniform2iv(this.addr,e),pc(n,e)}}function rfe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(dc(n,e))return;t.uniform3iv(this.addr,e),pc(n,e)}}function ife(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(dc(n,e))return;t.uniform4iv(this.addr,e),pc(n,e)}}function sfe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function ofe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(dc(n,e))return;t.uniform2uiv(this.addr,e),pc(n,e)}}function afe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(dc(n,e))return;t.uniform3uiv(this.addr,e),pc(n,e)}}function cfe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(dc(n,e))return;t.uniform4uiv(this.addr,e),pc(n,e)}}function lfe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i);let s;this.type===t.SAMPLER_2D_SHADOW?(cF.compareFunction=nq,s=cF):s=mq,n.setTexture2D(e||s,i)}function ufe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||_q,i)}function hfe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||vq,i)}function ffe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||gq,i)}function dfe(t){switch(t){case 5126:return Yhe;case 35664:return Khe;case 35665:return Xhe;case 35666:return Jhe;case 35674:return Zhe;case 35675:return Qhe;case 35676:return efe;case 5124:case 35670:return tfe;case 35667:case 35671:return nfe;case 35668:case 35672:return rfe;case 35669:case 35673:return ife;case 5125:return sfe;case 36294:return ofe;case 36295:return afe;case 36296:return cfe;case 35678:case 36198:case 36298:case 36306:case 35682:return lfe;case 35679:case 36299:case 36307:return ufe;case 35680:case 36300:case 36308:case 36293:return hfe;case 36289:case 36303:case 36311:case 36292:return ffe}}function pfe(t,e){t.uniform1fv(this.addr,e)}function mfe(t,e){const n=ex(e,this.size,2);t.uniform2fv(this.addr,n)}function gfe(t,e){const n=ex(e,this.size,3);t.uniform3fv(this.addr,n)}function _fe(t,e){const n=ex(e,this.size,4);t.uniform4fv(this.addr,n)}function vfe(t,e){const n=ex(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function yfe(t,e){const n=ex(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function bfe(t,e){const n=ex(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Sfe(t,e){t.uniform1iv(this.addr,e)}function Efe(t,e){t.uniform2iv(this.addr,e)}function xfe(t,e){t.uniform3iv(this.addr,e)}function wfe(t,e){t.uniform4iv(this.addr,e)}function Tfe(t,e){t.uniform1uiv(this.addr,e)}function Afe(t,e){t.uniform2uiv(this.addr,e)}function Cfe(t,e){t.uniform3uiv(this.addr,e)}function Rfe(t,e){t.uniform4uiv(this.addr,e)}function kfe(t,e,n){const r=this.cache,i=e.length,s=xO(n,i);dc(r,s)||(t.uniform1iv(this.addr,s),pc(r,s));for(let o=0;o!==i;++o)n.setTexture2D(e[o]||mq,s[o])}function Mfe(t,e,n){const r=this.cache,i=e.length,s=xO(n,i);dc(r,s)||(t.uniform1iv(this.addr,s),pc(r,s));for(let o=0;o!==i;++o)n.setTexture3D(e[o]||_q,s[o])}function Ofe(t,e,n){const r=this.cache,i=e.length,s=xO(n,i);dc(r,s)||(t.uniform1iv(this.addr,s),pc(r,s));for(let o=0;o!==i;++o)n.setTextureCube(e[o]||vq,s[o])}function Ife(t,e,n){const r=this.cache,i=e.length,s=xO(n,i);dc(r,s)||(t.uniform1iv(this.addr,s),pc(r,s));for(let o=0;o!==i;++o)n.setTexture2DArray(e[o]||gq,s[o])}function Nfe(t){switch(t){case 5126:return pfe;case 35664:return mfe;case 35665:return gfe;case 35666:return _fe;case 35674:return vfe;case 35675:return yfe;case 35676:return bfe;case 5124:case 35670:return Sfe;case 35667:case 35671:return Efe;case 35668:case 35672:return xfe;case 35669:case 35673:return wfe;case 5125:return Tfe;case 36294:return Afe;case 36295:return Cfe;case 36296:return Rfe;case 35678:case 36198:case 36298:case 36306:case 35682:return kfe;case 35679:case 36299:case 36307:return Mfe;case 35680:case 36300:case 36308:case 36293:return Ofe;case 36289:case 36303:case 36311:case 36292:return Ife}}class Pfe{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.setValue=dfe(n.type)}}class Dfe{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=Nfe(n.type)}}class Lfe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,n[a.id],r)}}}const k3=/(\w+)(\])?(\[|\.)?/g;function pF(t,e){t.seq.push(e),t.map[e.id]=e}function Ufe(t,e,n){const r=t.name,i=r.length;for(k3.lastIndex=0;;){const s=k3.exec(r),o=k3.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){pF(n,l===void 0?new Pfe(a,t,e):new Dfe(a,t,e));break}else{let h=n.map[a];h===void 0&&(h=new Lfe(a),pF(n,h)),n=h}}}class hk{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(n,i),o=e.getUniformLocation(n,s.name);Ufe(s,o,this)}}setValue(e,n,r,i){const s=this.map[n];s!==void 0&&s.setValue(e,r,i)}setOptional(e,n,r){const i=n[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,n,r,i){for(let s=0,o=n.length;s!==o;++s){const a=n[s],c=r[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,i)}}static seqWithValue(e,n){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in n&&r.push(o)}return r}}function mF(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}const Bfe=37297;let Ffe=0;function jfe(t,e){const n=t.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${n[o]}`)}return r.join(`
`)}const gF=new pi;function zfe(t){Xi._getMatrix(gF,Xi.workingColorSpace,t);const e=`mat3( ${gF.elements.map(n=>n.toFixed(4))} )`;switch(Xi.getTransfer(t)){case Kk:return[e,"LinearTransferOETF"];case Bs:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function _F(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+i+`

`+jfe(t.getShaderSource(e),o)}else return i}function Vfe(t,e){const n=zfe(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function Hfe(t,e){let n;switch(e){case Cae:n="Linear";break;case Rae:n="Reinhard";break;case kae:n="Cineon";break;case YW:n="ACESFilmic";break;case Oae:n="AgX";break;case Iae:n="Neutral";break;case Mae:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const sR=new zt;function $fe(){Xi.getLuminanceCoefficients(sR);const t=sR.x.toFixed(4),e=sR.y.toFixed(4),n=sR.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Gfe(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ST).join(`
`)}function Wfe(t){const e=[];for(const n in t){const r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function qfe(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i),o=s.name;let a=1;s.type===t.FLOAT_MAT2&&(a=2),s.type===t.FLOAT_MAT3&&(a=3),s.type===t.FLOAT_MAT4&&(a=4),n[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}function ST(t){return t!==""}function vF(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function yF(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Yfe=/^[ \t]*#include +<([\w\d./]+)>/gm;function QD(t){return t.replace(Yfe,Xfe)}const Kfe=new Map;function Xfe(t,e){let n=vi[e];if(n===void 0){const r=Kfe.get(e);if(r!==void 0)n=vi[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return QD(n)}const Jfe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function bF(t){return t.replace(Jfe,Zfe)}function Zfe(t,e,n,r){let i="";for(let s=parseInt(e);s<parseInt(n);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function SF(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Qfe(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===V4?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===ik?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===lm&&(e="SHADOWMAP_TYPE_VSM"),e}function ede(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case yE:case bE:e="ENVMAP_TYPE_CUBE";break;case vO:e="ENVMAP_TYPE_CUBE_UV";break}return e}function tde(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===bE&&(e="ENVMAP_MODE_REFRACTION"),e}function nde(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case qW:e="ENVMAP_BLENDING_MULTIPLY";break;case Tae:e="ENVMAP_BLENDING_MIX";break;case Aae:e="ENVMAP_BLENDING_ADD";break}return e}function rde(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}function ide(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const c=Qfe(n),l=ede(n),u=tde(n),h=nde(n),f=rde(n),d=Gfe(n),p=Wfe(s),m=i.createProgram();let g,_,y=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(ST).join(`
`),g.length>0&&(g+=`
`),_=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(ST).join(`
`),_.length>0&&(_+=`
`)):(g=[SF(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ST).join(`
`),_=[SF(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==yg?"#define TONE_MAPPING":"",n.toneMapping!==yg?vi.tonemapping_pars_fragment:"",n.toneMapping!==yg?Hfe("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",vi.colorspace_pars_fragment,Vfe("linearToOutputTexel",n.outputColorSpace),$fe(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(ST).join(`
`)),o=QD(o),o=vF(o,n),o=yF(o,n),a=QD(a),a=vF(a,n),a=yF(a,n),o=bF(o),a=bF(a),n.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=[d,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,_=["#define varying in",n.glslVersion===AB?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===AB?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const v=y+g+o,E=y+_+a,x=mF(i,i.VERTEX_SHADER,v),A=mF(i,i.FRAGMENT_SHADER,E);i.attachShader(m,x),i.attachShader(m,A),n.index0AttributeName!==void 0?i.bindAttribLocation(m,0,n.index0AttributeName):n.morphTargets===!0&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m);function T(F){if(t.debug.checkShaderErrors){const M=i.getProgramInfoLog(m).trim(),D=i.getShaderInfoLog(x).trim(),O=i.getShaderInfoLog(A).trim();let z=!0,q=!0;if(i.getProgramParameter(m,i.LINK_STATUS)===!1)if(z=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(i,m,x,A);else{const G=_F(i,x,"vertex"),K=_F(i,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+`

Material Name: `+F.name+`
Material Type: `+F.type+`

Program Info Log: `+M+`
`+G+`
`+K)}else M!==""?console.warn("THREE.WebGLProgram: Program Info Log:",M):(D===""||O==="")&&(q=!1);q&&(F.diagnostics={runnable:z,programLog:M,vertexShader:{log:D,prefix:g},fragmentShader:{log:O,prefix:_}})}i.deleteShader(x),i.deleteShader(A),k=new hk(i,m),L=qfe(i,m)}let k;this.getUniforms=function(){return k===void 0&&T(this),k};let L;this.getAttributes=function(){return L===void 0&&T(this),L};let I=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=i.getProgramParameter(m,Bfe)),I},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Ffe++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=A,this}let sde=0;class ode{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(n),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new ade(e),n.set(e,r)),r}}class ade{constructor(e){this.id=sde++,this.code=e,this.usedTimes=0}}function cde(t,e,n,r,i,s,o){const a=new JT,c=new ode,l=new Set,u=[],h=i.logarithmicDepthBuffer,f=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(L){return l.add(L),L===0?"uv":`uv${L}`}function g(L,I,F,M,D){const O=M.fog,z=D.geometry,q=L.isMeshStandardMaterial?M.environment:null,G=(L.isMeshStandardMaterial?n:e).get(L.envMap||q),K=G&&G.mapping===vO?G.image.height:null,te=p[L.type];L.precision!==null&&(d=i.getMaxPrecision(L.precision),d!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",d,"instead."));const re=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,H=re!==void 0?re.length:0;let Y=0;z.morphAttributes.position!==void 0&&(Y=1),z.morphAttributes.normal!==void 0&&(Y=2),z.morphAttributes.color!==void 0&&(Y=3);let Z,Q,ie,ge;if(te){const ot=pm[te];Z=ot.vertexShader,Q=ot.fragmentShader}else Z=L.vertexShader,Q=L.fragmentShader,c.update(L),ie=c.getVertexShaderID(L),ge=c.getFragmentShaderID(L);const Te=t.getRenderTarget(),be=t.state.buffers.depth.getReversed(),Pe=D.isInstancedMesh===!0,Ge=D.isBatchedMesh===!0,Ze=!!L.map,lt=!!L.matcap,pt=!!G,ne=!!L.aoMap,Le=!!L.lightMap,Ve=!!L.bumpMap,De=!!L.normalMap,Ie=!!L.displacementMap,ae=!!L.emissiveMap,ve=!!L.metalnessMap,we=!!L.roughnessMap,pe=L.anisotropy>0,ze=L.clearcoat>0,Je=L.dispersion>0,Xe=L.iridescence>0,tt=L.sheen>0,Nt=L.transmission>0,gt=pe&&!!L.anisotropyMap,wt=ze&&!!L.clearcoatMap,Re=ze&&!!L.clearcoatNormalMap,se=ze&&!!L.clearcoatRoughnessMap,W=Xe&&!!L.iridescenceMap,oe=Xe&&!!L.iridescenceThicknessMap,xe=tt&&!!L.sheenColorMap,Ce=tt&&!!L.sheenRoughnessMap,Se=!!L.specularMap,ye=!!L.specularColorMap,Ke=!!L.specularIntensityMap,ke=Nt&&!!L.transmissionMap,He=Nt&&!!L.thicknessMap,Fe=!!L.gradientMap,We=!!L.alphaMap,at=L.alphaTest>0,Be=!!L.alphaHash,nt=!!L.extensions;let it=yg;L.toneMapped&&(Te===null||Te.isXRRenderTarget===!0)&&(it=t.toneMapping);const xt={shaderID:te,shaderType:L.type,shaderName:L.name,vertexShader:Z,fragmentShader:Q,defines:L.defines,customVertexShaderID:ie,customFragmentShaderID:ge,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:d,batching:Ge,batchingColor:Ge&&D._colorsTexture!==null,instancing:Pe,instancingColor:Pe&&D.instanceColor!==null,instancingMorph:Pe&&D.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:Te===null?t.outputColorSpace:Te.isXRRenderTarget===!0?Te.texture.colorSpace:Cg,alphaToCoverage:!!L.alphaToCoverage,map:Ze,matcap:lt,envMap:pt,envMapMode:pt&&G.mapping,envMapCubeUVHeight:K,aoMap:ne,lightMap:Le,bumpMap:Ve,normalMap:De,displacementMap:f&&Ie,emissiveMap:ae,normalMapObjectSpace:De&&L.normalMapType===Lae,normalMapTangentSpace:De&&L.normalMapType===Dae,metalnessMap:ve,roughnessMap:we,anisotropy:pe,anisotropyMap:gt,clearcoat:ze,clearcoatMap:wt,clearcoatNormalMap:Re,clearcoatRoughnessMap:se,dispersion:Je,iridescence:Xe,iridescenceMap:W,iridescenceThicknessMap:oe,sheen:tt,sheenColorMap:xe,sheenRoughnessMap:Ce,specularMap:Se,specularColorMap:ye,specularIntensityMap:Ke,transmission:Nt,transmissionMap:ke,thicknessMap:He,gradientMap:Fe,opaque:L.transparent===!1&&L.blending===uE&&L.alphaToCoverage===!1,alphaMap:We,alphaTest:at,alphaHash:Be,combine:L.combine,mapUv:Ze&&m(L.map.channel),aoMapUv:ne&&m(L.aoMap.channel),lightMapUv:Le&&m(L.lightMap.channel),bumpMapUv:Ve&&m(L.bumpMap.channel),normalMapUv:De&&m(L.normalMap.channel),displacementMapUv:Ie&&m(L.displacementMap.channel),emissiveMapUv:ae&&m(L.emissiveMap.channel),metalnessMapUv:ve&&m(L.metalnessMap.channel),roughnessMapUv:we&&m(L.roughnessMap.channel),anisotropyMapUv:gt&&m(L.anisotropyMap.channel),clearcoatMapUv:wt&&m(L.clearcoatMap.channel),clearcoatNormalMapUv:Re&&m(L.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:se&&m(L.clearcoatRoughnessMap.channel),iridescenceMapUv:W&&m(L.iridescenceMap.channel),iridescenceThicknessMapUv:oe&&m(L.iridescenceThicknessMap.channel),sheenColorMapUv:xe&&m(L.sheenColorMap.channel),sheenRoughnessMapUv:Ce&&m(L.sheenRoughnessMap.channel),specularMapUv:Se&&m(L.specularMap.channel),specularColorMapUv:ye&&m(L.specularColorMap.channel),specularIntensityMapUv:Ke&&m(L.specularIntensityMap.channel),transmissionMapUv:ke&&m(L.transmissionMap.channel),thicknessMapUv:He&&m(L.thicknessMap.channel),alphaMapUv:We&&m(L.alphaMap.channel),vertexTangents:!!z.attributes.tangent&&(De||pe),vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,pointsUvs:D.isPoints===!0&&!!z.attributes.uv&&(Ze||We),fog:!!O,useFog:L.fog===!0,fogExp2:!!O&&O.isFogExp2,flatShading:L.flatShading===!0,sizeAttenuation:L.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:be,skinning:D.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:H,morphTextureStride:Y,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:L.dithering,shadowMapEnabled:t.shadowMap.enabled&&F.length>0,shadowMapType:t.shadowMap.type,toneMapping:it,decodeVideoTexture:Ze&&L.map.isVideoTexture===!0&&Xi.getTransfer(L.map.colorSpace)===Bs,decodeVideoTextureEmissive:ae&&L.emissiveMap.isVideoTexture===!0&&Xi.getTransfer(L.emissiveMap.colorSpace)===Bs,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===Oa,flipSided:L.side===Ic,useDepthPacking:L.depthPacking>=0,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionClipCullDistance:nt&&L.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(nt&&L.extensions.multiDraw===!0||Ge)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:L.customProgramCacheKey()};return xt.vertexUv1s=l.has(1),xt.vertexUv2s=l.has(2),xt.vertexUv3s=l.has(3),l.clear(),xt}function _(L){const I=[];if(L.shaderID?I.push(L.shaderID):(I.push(L.customVertexShaderID),I.push(L.customFragmentShaderID)),L.defines!==void 0)for(const F in L.defines)I.push(F),I.push(L.defines[F]);return L.isRawShaderMaterial===!1&&(y(I,L),v(I,L),I.push(t.outputColorSpace)),I.push(L.customProgramCacheKey),I.join()}function y(L,I){L.push(I.precision),L.push(I.outputColorSpace),L.push(I.envMapMode),L.push(I.envMapCubeUVHeight),L.push(I.mapUv),L.push(I.alphaMapUv),L.push(I.lightMapUv),L.push(I.aoMapUv),L.push(I.bumpMapUv),L.push(I.normalMapUv),L.push(I.displacementMapUv),L.push(I.emissiveMapUv),L.push(I.metalnessMapUv),L.push(I.roughnessMapUv),L.push(I.anisotropyMapUv),L.push(I.clearcoatMapUv),L.push(I.clearcoatNormalMapUv),L.push(I.clearcoatRoughnessMapUv),L.push(I.iridescenceMapUv),L.push(I.iridescenceThicknessMapUv),L.push(I.sheenColorMapUv),L.push(I.sheenRoughnessMapUv),L.push(I.specularMapUv),L.push(I.specularColorMapUv),L.push(I.specularIntensityMapUv),L.push(I.transmissionMapUv),L.push(I.thicknessMapUv),L.push(I.combine),L.push(I.fogExp2),L.push(I.sizeAttenuation),L.push(I.morphTargetsCount),L.push(I.morphAttributeCount),L.push(I.numDirLights),L.push(I.numPointLights),L.push(I.numSpotLights),L.push(I.numSpotLightMaps),L.push(I.numHemiLights),L.push(I.numRectAreaLights),L.push(I.numDirLightShadows),L.push(I.numPointLightShadows),L.push(I.numSpotLightShadows),L.push(I.numSpotLightShadowsWithMaps),L.push(I.numLightProbes),L.push(I.shadowMapType),L.push(I.toneMapping),L.push(I.numClippingPlanes),L.push(I.numClipIntersection),L.push(I.depthPacking)}function v(L,I){a.disableAll(),I.supportsVertexTextures&&a.enable(0),I.instancing&&a.enable(1),I.instancingColor&&a.enable(2),I.instancingMorph&&a.enable(3),I.matcap&&a.enable(4),I.envMap&&a.enable(5),I.normalMapObjectSpace&&a.enable(6),I.normalMapTangentSpace&&a.enable(7),I.clearcoat&&a.enable(8),I.iridescence&&a.enable(9),I.alphaTest&&a.enable(10),I.vertexColors&&a.enable(11),I.vertexAlphas&&a.enable(12),I.vertexUv1s&&a.enable(13),I.vertexUv2s&&a.enable(14),I.vertexUv3s&&a.enable(15),I.vertexTangents&&a.enable(16),I.anisotropy&&a.enable(17),I.alphaHash&&a.enable(18),I.batching&&a.enable(19),I.dispersion&&a.enable(20),I.batchingColor&&a.enable(21),L.push(a.mask),a.disableAll(),I.fog&&a.enable(0),I.useFog&&a.enable(1),I.flatShading&&a.enable(2),I.logarithmicDepthBuffer&&a.enable(3),I.reverseDepthBuffer&&a.enable(4),I.skinning&&a.enable(5),I.morphTargets&&a.enable(6),I.morphNormals&&a.enable(7),I.morphColors&&a.enable(8),I.premultipliedAlpha&&a.enable(9),I.shadowMapEnabled&&a.enable(10),I.doubleSided&&a.enable(11),I.flipSided&&a.enable(12),I.useDepthPacking&&a.enable(13),I.dithering&&a.enable(14),I.transmission&&a.enable(15),I.sheen&&a.enable(16),I.opaque&&a.enable(17),I.pointsUvs&&a.enable(18),I.decodeVideoTexture&&a.enable(19),I.decodeVideoTextureEmissive&&a.enable(20),I.alphaToCoverage&&a.enable(21),L.push(a.mask)}function E(L){const I=p[L.type];let F;if(I){const M=pm[I];F=Rce.clone(M.uniforms)}else F=L.uniforms;return F}function x(L,I){let F;for(let M=0,D=u.length;M<D;M++){const O=u[M];if(O.cacheKey===I){F=O,++F.usedTimes;break}}return F===void 0&&(F=new ide(t,I,L,s),u.push(F)),F}function A(L){if(--L.usedTimes===0){const I=u.indexOf(L);u[I]=u[u.length-1],u.pop(),L.destroy()}}function T(L){c.remove(L)}function k(){c.dispose()}return{getParameters:g,getProgramCacheKey:_,getUniforms:E,acquireProgram:x,releaseProgram:A,releaseShaderCache:T,programs:u,dispose:k}}function lde(){let t=new WeakMap;function e(o){return t.has(o)}function n(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function r(o){t.delete(o)}function i(o,a,c){t.get(o)[a]=c}function s(){t=new WeakMap}return{has:e,get:n,remove:r,update:i,dispose:s}}function ude(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function EF(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function xF(){const t=[];let e=0;const n=[],r=[],i=[];function s(){e=0,n.length=0,r.length=0,i.length=0}function o(h,f,d,p,m,g){let _=t[e];return _===void 0?(_={id:h.id,object:h,geometry:f,material:d,groupOrder:p,renderOrder:h.renderOrder,z:m,group:g},t[e]=_):(_.id=h.id,_.object=h,_.geometry=f,_.material=d,_.groupOrder=p,_.renderOrder=h.renderOrder,_.z=m,_.group=g),e++,_}function a(h,f,d,p,m,g){const _=o(h,f,d,p,m,g);d.transmission>0?r.push(_):d.transparent===!0?i.push(_):n.push(_)}function c(h,f,d,p,m,g){const _=o(h,f,d,p,m,g);d.transmission>0?r.unshift(_):d.transparent===!0?i.unshift(_):n.unshift(_)}function l(h,f){n.length>1&&n.sort(h||ude),r.length>1&&r.sort(f||EF),i.length>1&&i.sort(f||EF)}function u(){for(let h=e,f=t.length;h<f;h++){const d=t[h];if(d.id===null)break;d.id=null,d.object=null,d.geometry=null,d.material=null,d.group=null}}return{opaque:n,transmissive:r,transparent:i,init:s,push:a,unshift:c,finish:u,sort:l}}function hde(){let t=new WeakMap;function e(r,i){const s=t.get(r);let o;return s===void 0?(o=new xF,t.set(r,[o])):i>=s.length?(o=new xF,s.push(o)):o=s[i],o}function n(){t=new WeakMap}return{get:e,dispose:n}}function fde(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new zt,color:new wi};break;case"SpotLight":n={position:new zt,direction:new zt,color:new wi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new zt,color:new wi,distance:0,decay:0};break;case"HemisphereLight":n={direction:new zt,skyColor:new wi,groundColor:new wi};break;case"RectAreaLight":n={color:new wi,position:new zt,halfWidth:new zt,halfHeight:new zt};break}return t[e.id]=n,n}}}function dde(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zn};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zn};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zn,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let pde=0;function mde(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function gde(t){const e=new fde,n=dde(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new zt);const i=new zt,s=new So,o=new So;function a(l){let u=0,h=0,f=0;for(let L=0;L<9;L++)r.probe[L].set(0,0,0);let d=0,p=0,m=0,g=0,_=0,y=0,v=0,E=0,x=0,A=0,T=0;l.sort(mde);for(let L=0,I=l.length;L<I;L++){const F=l[L],M=F.color,D=F.intensity,O=F.distance,z=F.shadow&&F.shadow.map?F.shadow.map.texture:null;if(F.isAmbientLight)u+=M.r*D,h+=M.g*D,f+=M.b*D;else if(F.isLightProbe){for(let q=0;q<9;q++)r.probe[q].addScaledVector(F.sh.coefficients[q],D);T++}else if(F.isDirectionalLight){const q=e.get(F);if(q.color.copy(F.color).multiplyScalar(F.intensity),F.castShadow){const G=F.shadow,K=n.get(F);K.shadowIntensity=G.intensity,K.shadowBias=G.bias,K.shadowNormalBias=G.normalBias,K.shadowRadius=G.radius,K.shadowMapSize=G.mapSize,r.directionalShadow[d]=K,r.directionalShadowMap[d]=z,r.directionalShadowMatrix[d]=F.shadow.matrix,y++}r.directional[d]=q,d++}else if(F.isSpotLight){const q=e.get(F);q.position.setFromMatrixPosition(F.matrixWorld),q.color.copy(M).multiplyScalar(D),q.distance=O,q.coneCos=Math.cos(F.angle),q.penumbraCos=Math.cos(F.angle*(1-F.penumbra)),q.decay=F.decay,r.spot[m]=q;const G=F.shadow;if(F.map&&(r.spotLightMap[x]=F.map,x++,G.updateMatrices(F),F.castShadow&&A++),r.spotLightMatrix[m]=G.matrix,F.castShadow){const K=n.get(F);K.shadowIntensity=G.intensity,K.shadowBias=G.bias,K.shadowNormalBias=G.normalBias,K.shadowRadius=G.radius,K.shadowMapSize=G.mapSize,r.spotShadow[m]=K,r.spotShadowMap[m]=z,E++}m++}else if(F.isRectAreaLight){const q=e.get(F);q.color.copy(M).multiplyScalar(D),q.halfWidth.set(F.width*.5,0,0),q.halfHeight.set(0,F.height*.5,0),r.rectArea[g]=q,g++}else if(F.isPointLight){const q=e.get(F);if(q.color.copy(F.color).multiplyScalar(F.intensity),q.distance=F.distance,q.decay=F.decay,F.castShadow){const G=F.shadow,K=n.get(F);K.shadowIntensity=G.intensity,K.shadowBias=G.bias,K.shadowNormalBias=G.normalBias,K.shadowRadius=G.radius,K.shadowMapSize=G.mapSize,K.shadowCameraNear=G.camera.near,K.shadowCameraFar=G.camera.far,r.pointShadow[p]=K,r.pointShadowMap[p]=z,r.pointShadowMatrix[p]=F.shadow.matrix,v++}r.point[p]=q,p++}else if(F.isHemisphereLight){const q=e.get(F);q.skyColor.copy(F.color).multiplyScalar(D),q.groundColor.copy(F.groundColor).multiplyScalar(D),r.hemi[_]=q,_++}}g>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=qn.LTC_FLOAT_1,r.rectAreaLTC2=qn.LTC_FLOAT_2):(r.rectAreaLTC1=qn.LTC_HALF_1,r.rectAreaLTC2=qn.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=f;const k=r.hash;(k.directionalLength!==d||k.pointLength!==p||k.spotLength!==m||k.rectAreaLength!==g||k.hemiLength!==_||k.numDirectionalShadows!==y||k.numPointShadows!==v||k.numSpotShadows!==E||k.numSpotMaps!==x||k.numLightProbes!==T)&&(r.directional.length=d,r.spot.length=m,r.rectArea.length=g,r.point.length=p,r.hemi.length=_,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=v,r.pointShadowMap.length=v,r.spotShadow.length=E,r.spotShadowMap.length=E,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=v,r.spotLightMatrix.length=E+x-A,r.spotLightMap.length=x,r.numSpotLightShadowsWithMaps=A,r.numLightProbes=T,k.directionalLength=d,k.pointLength=p,k.spotLength=m,k.rectAreaLength=g,k.hemiLength=_,k.numDirectionalShadows=y,k.numPointShadows=v,k.numSpotShadows=E,k.numSpotMaps=x,k.numLightProbes=T,r.version=pde++)}function c(l,u){let h=0,f=0,d=0,p=0,m=0;const g=u.matrixWorldInverse;for(let _=0,y=l.length;_<y;_++){const v=l[_];if(v.isDirectionalLight){const E=r.directional[h];E.direction.setFromMatrixPosition(v.matrixWorld),i.setFromMatrixPosition(v.target.matrixWorld),E.direction.sub(i),E.direction.transformDirection(g),h++}else if(v.isSpotLight){const E=r.spot[d];E.position.setFromMatrixPosition(v.matrixWorld),E.position.applyMatrix4(g),E.direction.setFromMatrixPosition(v.matrixWorld),i.setFromMatrixPosition(v.target.matrixWorld),E.direction.sub(i),E.direction.transformDirection(g),d++}else if(v.isRectAreaLight){const E=r.rectArea[p];E.position.setFromMatrixPosition(v.matrixWorld),E.position.applyMatrix4(g),o.identity(),s.copy(v.matrixWorld),s.premultiply(g),o.extractRotation(s),E.halfWidth.set(v.width*.5,0,0),E.halfHeight.set(0,v.height*.5,0),E.halfWidth.applyMatrix4(o),E.halfHeight.applyMatrix4(o),p++}else if(v.isPointLight){const E=r.point[f];E.position.setFromMatrixPosition(v.matrixWorld),E.position.applyMatrix4(g),f++}else if(v.isHemisphereLight){const E=r.hemi[m];E.direction.setFromMatrixPosition(v.matrixWorld),E.direction.transformDirection(g),m++}}}return{setup:a,setupView:c,state:r}}function wF(t){const e=new gde(t),n=[],r=[];function i(u){l.camera=u,n.length=0,r.length=0}function s(u){n.push(u)}function o(u){r.push(u)}function a(){e.setup(n)}function c(u){e.setupView(n,u)}const l={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function _de(t){let e=new WeakMap;function n(i,s=0){const o=e.get(i);let a;return o===void 0?(a=new wF(t),e.set(i,[a])):s>=o.length?(a=new wF(t),o.push(a)):a=o[s],a}function r(){e=new WeakMap}return{get:n,dispose:r}}const vde=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,yde=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function bde(t,e,n){let r=new fq;const i=new zn,s=new zn,o=new qo,a=new zce({depthPacking:Pae}),c=new Vce,l={},u=n.maxTextureSize,h={[Ag]:Ic,[Ic]:Ag,[Oa]:Oa},f=new ao({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new zn},radius:{value:4}},vertexShader:vde,fragmentShader:yde}),d=f.clone();d.defines.HORIZONTAL_PASS=1;const p=new jm;p.setAttribute("position",new hh(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new ef(p,f),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=V4;let _=this.type;this.render=function(A,T,k){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||A.length===0)return;const L=t.getRenderTarget(),I=t.getActiveCubeFace(),F=t.getActiveMipmapLevel(),M=t.state;M.setBlending(rl),M.buffers.color.setClear(1,1,1,1),M.buffers.depth.setTest(!0),M.setScissorTest(!1);const D=_!==lm&&this.type===lm,O=_===lm&&this.type!==lm;for(let z=0,q=A.length;z<q;z++){const G=A[z],K=G.shadow;if(K===void 0){console.warn("THREE.WebGLShadowMap:",G,"has no shadow.");continue}if(K.autoUpdate===!1&&K.needsUpdate===!1)continue;i.copy(K.mapSize);const te=K.getFrameExtents();if(i.multiply(te),s.copy(K.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/te.x),i.x=s.x*te.x,K.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/te.y),i.y=s.y*te.y,K.mapSize.y=s.y)),K.map===null||D===!0||O===!0){const H=this.type!==lm?{minFilter:Il,magFilter:Il}:{};K.map!==null&&K.map.dispose(),K.map=new il(i.x,i.y,H),K.map.texture.name=G.name+".shadowMap",K.camera.updateProjectionMatrix()}t.setRenderTarget(K.map),t.clear();const re=K.getViewportCount();for(let H=0;H<re;H++){const Y=K.getViewport(H);o.set(s.x*Y.x,s.y*Y.y,s.x*Y.z,s.y*Y.w),M.viewport(o),K.updateMatrices(G,H),r=K.getFrustum(),E(T,k,K.camera,G,this.type)}K.isPointLightShadow!==!0&&this.type===lm&&y(K,k),K.needsUpdate=!1}_=this.type,g.needsUpdate=!1,t.setRenderTarget(L,I,F)};function y(A,T){const k=e.update(m);f.defines.VSM_SAMPLES!==A.blurSamples&&(f.defines.VSM_SAMPLES=A.blurSamples,d.defines.VSM_SAMPLES=A.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new il(i.x,i.y)),f.uniforms.shadow_pass.value=A.map.texture,f.uniforms.resolution.value=A.mapSize,f.uniforms.radius.value=A.radius,t.setRenderTarget(A.mapPass),t.clear(),t.renderBufferDirect(T,null,k,f,m,null),d.uniforms.shadow_pass.value=A.mapPass.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,t.setRenderTarget(A.map),t.clear(),t.renderBufferDirect(T,null,k,d,m,null)}function v(A,T,k,L){let I=null;const F=k.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(F!==void 0)I=F;else if(I=k.isPointLight===!0?c:a,t.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0||T.alphaToCoverage===!0){const M=I.uuid,D=T.uuid;let O=l[M];O===void 0&&(O={},l[M]=O);let z=O[D];z===void 0&&(z=I.clone(),O[D]=z,T.addEventListener("dispose",x)),I=z}if(I.visible=T.visible,I.wireframe=T.wireframe,L===lm?I.side=T.shadowSide!==null?T.shadowSide:T.side:I.side=T.shadowSide!==null?T.shadowSide:h[T.side],I.alphaMap=T.alphaMap,I.alphaTest=T.alphaToCoverage===!0?.5:T.alphaTest,I.map=T.map,I.clipShadows=T.clipShadows,I.clippingPlanes=T.clippingPlanes,I.clipIntersection=T.clipIntersection,I.displacementMap=T.displacementMap,I.displacementScale=T.displacementScale,I.displacementBias=T.displacementBias,I.wireframeLinewidth=T.wireframeLinewidth,I.linewidth=T.linewidth,k.isPointLight===!0&&I.isMeshDistanceMaterial===!0){const M=t.properties.get(I);M.light=k}return I}function E(A,T,k,L,I){if(A.visible===!1)return;if(A.layers.test(T.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&I===lm)&&(!A.frustumCulled||r.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,A.matrixWorld);const D=e.update(A),O=A.material;if(Array.isArray(O)){const z=D.groups;for(let q=0,G=z.length;q<G;q++){const K=z[q],te=O[K.materialIndex];if(te&&te.visible){const re=v(A,te,L,I);A.onBeforeShadow(t,A,T,k,D,re,K),t.renderBufferDirect(k,null,D,re,A,K),A.onAfterShadow(t,A,T,k,D,re,K)}}}else if(O.visible){const z=v(A,O,L,I);A.onBeforeShadow(t,A,T,k,D,z,null),t.renderBufferDirect(k,null,D,z,A,null),A.onAfterShadow(t,A,T,k,D,z,null)}}const M=A.children;for(let D=0,O=M.length;D<O;D++)E(M[D],T,k,L,I)}function x(A){A.target.removeEventListener("dispose",x);for(const k in l){const L=l[k],I=A.target.uuid;I in L&&(L[I].dispose(),delete L[I])}}}const Sde={[mD]:qk,[gD]:yD,[_D]:bD,[vE]:vD,[qk]:mD,[yD]:gD,[bD]:_D,[vD]:vE};function Ede(t,e){function n(){let ke=!1;const He=new qo;let Fe=null;const We=new qo(0,0,0,0);return{setMask:function(at){Fe!==at&&!ke&&(t.colorMask(at,at,at,at),Fe=at)},setLocked:function(at){ke=at},setClear:function(at,Be,nt,it,xt){xt===!0&&(at*=it,Be*=it,nt*=it),He.set(at,Be,nt,it),We.equals(He)===!1&&(t.clearColor(at,Be,nt,it),We.copy(He))},reset:function(){ke=!1,Fe=null,We.set(-1,0,0,0)}}}function r(){let ke=!1,He=!1,Fe=null,We=null,at=null;return{setReversed:function(Be){if(He!==Be){const nt=e.get("EXT_clip_control");Be?nt.clipControlEXT(nt.LOWER_LEFT_EXT,nt.ZERO_TO_ONE_EXT):nt.clipControlEXT(nt.LOWER_LEFT_EXT,nt.NEGATIVE_ONE_TO_ONE_EXT),He=Be;const it=at;at=null,this.setClear(it)}},getReversed:function(){return He},setTest:function(Be){Be?Te(t.DEPTH_TEST):be(t.DEPTH_TEST)},setMask:function(Be){Fe!==Be&&!ke&&(t.depthMask(Be),Fe=Be)},setFunc:function(Be){if(He&&(Be=Sde[Be]),We!==Be){switch(Be){case mD:t.depthFunc(t.NEVER);break;case qk:t.depthFunc(t.ALWAYS);break;case gD:t.depthFunc(t.LESS);break;case vE:t.depthFunc(t.LEQUAL);break;case _D:t.depthFunc(t.EQUAL);break;case vD:t.depthFunc(t.GEQUAL);break;case yD:t.depthFunc(t.GREATER);break;case bD:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}We=Be}},setLocked:function(Be){ke=Be},setClear:function(Be){at!==Be&&(He&&(Be=1-Be),t.clearDepth(Be),at=Be)},reset:function(){ke=!1,Fe=null,We=null,at=null,He=!1}}}function i(){let ke=!1,He=null,Fe=null,We=null,at=null,Be=null,nt=null,it=null,xt=null;return{setTest:function(ot){ke||(ot?Te(t.STENCIL_TEST):be(t.STENCIL_TEST))},setMask:function(ot){He!==ot&&!ke&&(t.stencilMask(ot),He=ot)},setFunc:function(ot,tn,ln){(Fe!==ot||We!==tn||at!==ln)&&(t.stencilFunc(ot,tn,ln),Fe=ot,We=tn,at=ln)},setOp:function(ot,tn,ln){(Be!==ot||nt!==tn||it!==ln)&&(t.stencilOp(ot,tn,ln),Be=ot,nt=tn,it=ln)},setLocked:function(ot){ke=ot},setClear:function(ot){xt!==ot&&(t.clearStencil(ot),xt=ot)},reset:function(){ke=!1,He=null,Fe=null,We=null,at=null,Be=null,nt=null,it=null,xt=null}}}const s=new n,o=new r,a=new i,c=new WeakMap,l=new WeakMap;let u={},h={},f=new WeakMap,d=[],p=null,m=!1,g=null,_=null,y=null,v=null,E=null,x=null,A=null,T=new wi(0,0,0),k=0,L=!1,I=null,F=null,M=null,D=null,O=null;const z=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let q=!1,G=0;const K=t.getParameter(t.VERSION);K.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(K)[1]),q=G>=1):K.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(K)[1]),q=G>=2);let te=null,re={};const H=t.getParameter(t.SCISSOR_BOX),Y=t.getParameter(t.VIEWPORT),Z=new qo().fromArray(H),Q=new qo().fromArray(Y);function ie(ke,He,Fe,We){const at=new Uint8Array(4),Be=t.createTexture();t.bindTexture(ke,Be),t.texParameteri(ke,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(ke,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let nt=0;nt<Fe;nt++)ke===t.TEXTURE_3D||ke===t.TEXTURE_2D_ARRAY?t.texImage3D(He,0,t.RGBA,1,1,We,0,t.RGBA,t.UNSIGNED_BYTE,at):t.texImage2D(He+nt,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,at);return Be}const ge={};ge[t.TEXTURE_2D]=ie(t.TEXTURE_2D,t.TEXTURE_2D,1),ge[t.TEXTURE_CUBE_MAP]=ie(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),ge[t.TEXTURE_2D_ARRAY]=ie(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),ge[t.TEXTURE_3D]=ie(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Te(t.DEPTH_TEST),o.setFunc(vE),Ve(!1),De(bB),Te(t.CULL_FACE),ne(rl);function Te(ke){u[ke]!==!0&&(t.enable(ke),u[ke]=!0)}function be(ke){u[ke]!==!1&&(t.disable(ke),u[ke]=!1)}function Pe(ke,He){return h[ke]!==He?(t.bindFramebuffer(ke,He),h[ke]=He,ke===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=He),ke===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=He),!0):!1}function Ge(ke,He){let Fe=d,We=!1;if(ke){Fe=f.get(He),Fe===void 0&&(Fe=[],f.set(He,Fe));const at=ke.textures;if(Fe.length!==at.length||Fe[0]!==t.COLOR_ATTACHMENT0){for(let Be=0,nt=at.length;Be<nt;Be++)Fe[Be]=t.COLOR_ATTACHMENT0+Be;Fe.length=at.length,We=!0}}else Fe[0]!==t.BACK&&(Fe[0]=t.BACK,We=!0);We&&t.drawBuffers(Fe)}function Ze(ke){return p!==ke?(t.useProgram(ke),p=ke,!0):!1}const lt={[Zy]:t.FUNC_ADD,[cae]:t.FUNC_SUBTRACT,[lae]:t.FUNC_REVERSE_SUBTRACT};lt[uae]=t.MIN,lt[hae]=t.MAX;const pt={[fae]:t.ZERO,[dae]:t.ONE,[pae]:t.SRC_COLOR,[dD]:t.SRC_ALPHA,[bae]:t.SRC_ALPHA_SATURATE,[vae]:t.DST_COLOR,[gae]:t.DST_ALPHA,[mae]:t.ONE_MINUS_SRC_COLOR,[pD]:t.ONE_MINUS_SRC_ALPHA,[yae]:t.ONE_MINUS_DST_COLOR,[_ae]:t.ONE_MINUS_DST_ALPHA,[Sae]:t.CONSTANT_COLOR,[Eae]:t.ONE_MINUS_CONSTANT_COLOR,[xae]:t.CONSTANT_ALPHA,[wae]:t.ONE_MINUS_CONSTANT_ALPHA};function ne(ke,He,Fe,We,at,Be,nt,it,xt,ot){if(ke===rl){m===!0&&(be(t.BLEND),m=!1);return}if(m===!1&&(Te(t.BLEND),m=!0),ke!==aae){if(ke!==g||ot!==L){if((_!==Zy||E!==Zy)&&(t.blendEquation(t.FUNC_ADD),_=Zy,E=Zy),ot)switch(ke){case uE:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case SB:t.blendFunc(t.ONE,t.ONE);break;case EB:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case xB:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ke);break}else switch(ke){case uE:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case SB:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case EB:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case xB:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ke);break}y=null,v=null,x=null,A=null,T.set(0,0,0),k=0,g=ke,L=ot}return}at=at||He,Be=Be||Fe,nt=nt||We,(He!==_||at!==E)&&(t.blendEquationSeparate(lt[He],lt[at]),_=He,E=at),(Fe!==y||We!==v||Be!==x||nt!==A)&&(t.blendFuncSeparate(pt[Fe],pt[We],pt[Be],pt[nt]),y=Fe,v=We,x=Be,A=nt),(it.equals(T)===!1||xt!==k)&&(t.blendColor(it.r,it.g,it.b,xt),T.copy(it),k=xt),g=ke,L=!1}function Le(ke,He){ke.side===Oa?be(t.CULL_FACE):Te(t.CULL_FACE);let Fe=ke.side===Ic;He&&(Fe=!Fe),Ve(Fe),ke.blending===uE&&ke.transparent===!1?ne(rl):ne(ke.blending,ke.blendEquation,ke.blendSrc,ke.blendDst,ke.blendEquationAlpha,ke.blendSrcAlpha,ke.blendDstAlpha,ke.blendColor,ke.blendAlpha,ke.premultipliedAlpha),o.setFunc(ke.depthFunc),o.setTest(ke.depthTest),o.setMask(ke.depthWrite),s.setMask(ke.colorWrite);const We=ke.stencilWrite;a.setTest(We),We&&(a.setMask(ke.stencilWriteMask),a.setFunc(ke.stencilFunc,ke.stencilRef,ke.stencilFuncMask),a.setOp(ke.stencilFail,ke.stencilZFail,ke.stencilZPass)),ae(ke.polygonOffset,ke.polygonOffsetFactor,ke.polygonOffsetUnits),ke.alphaToCoverage===!0?Te(t.SAMPLE_ALPHA_TO_COVERAGE):be(t.SAMPLE_ALPHA_TO_COVERAGE)}function Ve(ke){I!==ke&&(ke?t.frontFace(t.CW):t.frontFace(t.CCW),I=ke)}function De(ke){ke!==iae?(Te(t.CULL_FACE),ke!==F&&(ke===bB?t.cullFace(t.BACK):ke===sae?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):be(t.CULL_FACE),F=ke}function Ie(ke){ke!==M&&(q&&t.lineWidth(ke),M=ke)}function ae(ke,He,Fe){ke?(Te(t.POLYGON_OFFSET_FILL),(D!==He||O!==Fe)&&(t.polygonOffset(He,Fe),D=He,O=Fe)):be(t.POLYGON_OFFSET_FILL)}function ve(ke){ke?Te(t.SCISSOR_TEST):be(t.SCISSOR_TEST)}function we(ke){ke===void 0&&(ke=t.TEXTURE0+z-1),te!==ke&&(t.activeTexture(ke),te=ke)}function pe(ke,He,Fe){Fe===void 0&&(te===null?Fe=t.TEXTURE0+z-1:Fe=te);let We=re[Fe];We===void 0&&(We={type:void 0,texture:void 0},re[Fe]=We),(We.type!==ke||We.texture!==He)&&(te!==Fe&&(t.activeTexture(Fe),te=Fe),t.bindTexture(ke,He||ge[ke]),We.type=ke,We.texture=He)}function ze(){const ke=re[te];ke!==void 0&&ke.type!==void 0&&(t.bindTexture(ke.type,null),ke.type=void 0,ke.texture=void 0)}function Je(){try{t.compressedTexImage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function Xe(){try{t.compressedTexImage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function tt(){try{t.texSubImage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function Nt(){try{t.texSubImage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function gt(){try{t.compressedTexSubImage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function wt(){try{t.compressedTexSubImage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function Re(){try{t.texStorage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function se(){try{t.texStorage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function W(){try{t.texImage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function oe(){try{t.texImage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function xe(ke){Z.equals(ke)===!1&&(t.scissor(ke.x,ke.y,ke.z,ke.w),Z.copy(ke))}function Ce(ke){Q.equals(ke)===!1&&(t.viewport(ke.x,ke.y,ke.z,ke.w),Q.copy(ke))}function Se(ke,He){let Fe=l.get(He);Fe===void 0&&(Fe=new WeakMap,l.set(He,Fe));let We=Fe.get(ke);We===void 0&&(We=t.getUniformBlockIndex(He,ke.name),Fe.set(ke,We))}function ye(ke,He){const We=l.get(He).get(ke);c.get(He)!==We&&(t.uniformBlockBinding(He,We,ke.__bindingPointIndex),c.set(He,We))}function Ke(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),o.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},te=null,re={},h={},f=new WeakMap,d=[],p=null,m=!1,g=null,_=null,y=null,v=null,E=null,x=null,A=null,T=new wi(0,0,0),k=0,L=!1,I=null,F=null,M=null,D=null,O=null,Z.set(0,0,t.canvas.width,t.canvas.height),Q.set(0,0,t.canvas.width,t.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Te,disable:be,bindFramebuffer:Pe,drawBuffers:Ge,useProgram:Ze,setBlending:ne,setMaterial:Le,setFlipSided:Ve,setCullFace:De,setLineWidth:Ie,setPolygonOffset:ae,setScissorTest:ve,activeTexture:we,bindTexture:pe,unbindTexture:ze,compressedTexImage2D:Je,compressedTexImage3D:Xe,texImage2D:W,texImage3D:oe,updateUBOMapping:Se,uniformBlockBinding:ye,texStorage2D:Re,texStorage3D:se,texSubImage2D:tt,texSubImage3D:Nt,compressedTexSubImage2D:gt,compressedTexSubImage3D:wt,scissor:xe,viewport:Ce,reset:Ke}}function xde(t,e,n,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new zn,u=new WeakMap;let h;const f=new WeakMap;let d=!1;try{d=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(we,pe){return d?new OffscreenCanvas(we,pe):XT("canvas")}function m(we,pe,ze){let Je=1;const Xe=ve(we);if((Xe.width>ze||Xe.height>ze)&&(Je=ze/Math.max(Xe.width,Xe.height)),Je<1)if(typeof HTMLImageElement<"u"&&we instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&we instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&we instanceof ImageBitmap||typeof VideoFrame<"u"&&we instanceof VideoFrame){const tt=Math.floor(Je*Xe.width),Nt=Math.floor(Je*Xe.height);h===void 0&&(h=p(tt,Nt));const gt=pe?p(tt,Nt):h;return gt.width=tt,gt.height=Nt,gt.getContext("2d").drawImage(we,0,0,tt,Nt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Xe.width+"x"+Xe.height+") to ("+tt+"x"+Nt+")."),gt}else return"data"in we&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Xe.width+"x"+Xe.height+")."),we;return we}function g(we){return we.generateMipmaps}function _(we){t.generateMipmap(we)}function y(we){return we.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:we.isWebGL3DRenderTarget?t.TEXTURE_3D:we.isWebGLArrayRenderTarget||we.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function v(we,pe,ze,Je,Xe=!1){if(we!==null){if(t[we]!==void 0)return t[we];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+we+"'")}let tt=pe;if(pe===t.RED&&(ze===t.FLOAT&&(tt=t.R32F),ze===t.HALF_FLOAT&&(tt=t.R16F),ze===t.UNSIGNED_BYTE&&(tt=t.R8)),pe===t.RED_INTEGER&&(ze===t.UNSIGNED_BYTE&&(tt=t.R8UI),ze===t.UNSIGNED_SHORT&&(tt=t.R16UI),ze===t.UNSIGNED_INT&&(tt=t.R32UI),ze===t.BYTE&&(tt=t.R8I),ze===t.SHORT&&(tt=t.R16I),ze===t.INT&&(tt=t.R32I)),pe===t.RG&&(ze===t.FLOAT&&(tt=t.RG32F),ze===t.HALF_FLOAT&&(tt=t.RG16F),ze===t.UNSIGNED_BYTE&&(tt=t.RG8)),pe===t.RG_INTEGER&&(ze===t.UNSIGNED_BYTE&&(tt=t.RG8UI),ze===t.UNSIGNED_SHORT&&(tt=t.RG16UI),ze===t.UNSIGNED_INT&&(tt=t.RG32UI),ze===t.BYTE&&(tt=t.RG8I),ze===t.SHORT&&(tt=t.RG16I),ze===t.INT&&(tt=t.RG32I)),pe===t.RGB_INTEGER&&(ze===t.UNSIGNED_BYTE&&(tt=t.RGB8UI),ze===t.UNSIGNED_SHORT&&(tt=t.RGB16UI),ze===t.UNSIGNED_INT&&(tt=t.RGB32UI),ze===t.BYTE&&(tt=t.RGB8I),ze===t.SHORT&&(tt=t.RGB16I),ze===t.INT&&(tt=t.RGB32I)),pe===t.RGBA_INTEGER&&(ze===t.UNSIGNED_BYTE&&(tt=t.RGBA8UI),ze===t.UNSIGNED_SHORT&&(tt=t.RGBA16UI),ze===t.UNSIGNED_INT&&(tt=t.RGBA32UI),ze===t.BYTE&&(tt=t.RGBA8I),ze===t.SHORT&&(tt=t.RGBA16I),ze===t.INT&&(tt=t.RGBA32I)),pe===t.RGB&&ze===t.UNSIGNED_INT_5_9_9_9_REV&&(tt=t.RGB9_E5),pe===t.RGBA){const Nt=Xe?Kk:Xi.getTransfer(Je);ze===t.FLOAT&&(tt=t.RGBA32F),ze===t.HALF_FLOAT&&(tt=t.RGBA16F),ze===t.UNSIGNED_BYTE&&(tt=Nt===Bs?t.SRGB8_ALPHA8:t.RGBA8),ze===t.UNSIGNED_SHORT_4_4_4_4&&(tt=t.RGBA4),ze===t.UNSIGNED_SHORT_5_5_5_1&&(tt=t.RGB5_A1)}return(tt===t.R16F||tt===t.R32F||tt===t.RG16F||tt===t.RG32F||tt===t.RGBA16F||tt===t.RGBA32F)&&e.get("EXT_color_buffer_float"),tt}function E(we,pe){let ze;return we?pe===null||pe===pv||pe===SE?ze=t.DEPTH24_STENCIL8:pe===tp?ze=t.DEPTH32F_STENCIL8:pe===qT&&(ze=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):pe===null||pe===pv||pe===SE?ze=t.DEPTH_COMPONENT24:pe===tp?ze=t.DEPTH_COMPONENT32F:pe===qT&&(ze=t.DEPTH_COMPONENT16),ze}function x(we,pe){return g(we)===!0||we.isFramebufferTexture&&we.minFilter!==Il&&we.minFilter!==Ml?Math.log2(Math.max(pe.width,pe.height))+1:we.mipmaps!==void 0&&we.mipmaps.length>0?we.mipmaps.length:we.isCompressedTexture&&Array.isArray(we.image)?pe.mipmaps.length:1}function A(we){const pe=we.target;pe.removeEventListener("dispose",A),k(pe),pe.isVideoTexture&&u.delete(pe)}function T(we){const pe=we.target;pe.removeEventListener("dispose",T),I(pe)}function k(we){const pe=r.get(we);if(pe.__webglInit===void 0)return;const ze=we.source,Je=f.get(ze);if(Je){const Xe=Je[pe.__cacheKey];Xe.usedTimes--,Xe.usedTimes===0&&L(we),Object.keys(Je).length===0&&f.delete(ze)}r.remove(we)}function L(we){const pe=r.get(we);t.deleteTexture(pe.__webglTexture);const ze=we.source,Je=f.get(ze);delete Je[pe.__cacheKey],o.memory.textures--}function I(we){const pe=r.get(we);if(we.depthTexture&&(we.depthTexture.dispose(),r.remove(we.depthTexture)),we.isWebGLCubeRenderTarget)for(let Je=0;Je<6;Je++){if(Array.isArray(pe.__webglFramebuffer[Je]))for(let Xe=0;Xe<pe.__webglFramebuffer[Je].length;Xe++)t.deleteFramebuffer(pe.__webglFramebuffer[Je][Xe]);else t.deleteFramebuffer(pe.__webglFramebuffer[Je]);pe.__webglDepthbuffer&&t.deleteRenderbuffer(pe.__webglDepthbuffer[Je])}else{if(Array.isArray(pe.__webglFramebuffer))for(let Je=0;Je<pe.__webglFramebuffer.length;Je++)t.deleteFramebuffer(pe.__webglFramebuffer[Je]);else t.deleteFramebuffer(pe.__webglFramebuffer);if(pe.__webglDepthbuffer&&t.deleteRenderbuffer(pe.__webglDepthbuffer),pe.__webglMultisampledFramebuffer&&t.deleteFramebuffer(pe.__webglMultisampledFramebuffer),pe.__webglColorRenderbuffer)for(let Je=0;Je<pe.__webglColorRenderbuffer.length;Je++)pe.__webglColorRenderbuffer[Je]&&t.deleteRenderbuffer(pe.__webglColorRenderbuffer[Je]);pe.__webglDepthRenderbuffer&&t.deleteRenderbuffer(pe.__webglDepthRenderbuffer)}const ze=we.textures;for(let Je=0,Xe=ze.length;Je<Xe;Je++){const tt=r.get(ze[Je]);tt.__webglTexture&&(t.deleteTexture(tt.__webglTexture),o.memory.textures--),r.remove(ze[Je])}r.remove(we)}let F=0;function M(){F=0}function D(){const we=F;return we>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+we+" texture units while this GPU supports only "+i.maxTextures),F+=1,we}function O(we){const pe=[];return pe.push(we.wrapS),pe.push(we.wrapT),pe.push(we.wrapR||0),pe.push(we.magFilter),pe.push(we.minFilter),pe.push(we.anisotropy),pe.push(we.internalFormat),pe.push(we.format),pe.push(we.type),pe.push(we.generateMipmaps),pe.push(we.premultiplyAlpha),pe.push(we.flipY),pe.push(we.unpackAlignment),pe.push(we.colorSpace),pe.join()}function z(we,pe){const ze=r.get(we);if(we.isVideoTexture&&Ie(we),we.isRenderTargetTexture===!1&&we.version>0&&ze.__version!==we.version){const Je=we.image;if(Je===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Je.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(ze,we,pe);return}}n.bindTexture(t.TEXTURE_2D,ze.__webglTexture,t.TEXTURE0+pe)}function q(we,pe){const ze=r.get(we);if(we.version>0&&ze.__version!==we.version){Q(ze,we,pe);return}n.bindTexture(t.TEXTURE_2D_ARRAY,ze.__webglTexture,t.TEXTURE0+pe)}function G(we,pe){const ze=r.get(we);if(we.version>0&&ze.__version!==we.version){Q(ze,we,pe);return}n.bindTexture(t.TEXTURE_3D,ze.__webglTexture,t.TEXTURE0+pe)}function K(we,pe){const ze=r.get(we);if(we.version>0&&ze.__version!==we.version){ie(ze,we,pe);return}n.bindTexture(t.TEXTURE_CUBE_MAP,ze.__webglTexture,t.TEXTURE0+pe)}const te={[Yk]:t.REPEAT,[i1]:t.CLAMP_TO_EDGE,[xD]:t.MIRRORED_REPEAT},re={[Il]:t.NEAREST,[Nae]:t.NEAREST_MIPMAP_NEAREST,[LC]:t.NEAREST_MIPMAP_LINEAR,[Ml]:t.LINEAR,[n3]:t.LINEAR_MIPMAP_NEAREST,[s1]:t.LINEAR_MIPMAP_LINEAR},H={[Uae]:t.NEVER,[Hae]:t.ALWAYS,[Bae]:t.LESS,[nq]:t.LEQUAL,[Fae]:t.EQUAL,[Vae]:t.GEQUAL,[jae]:t.GREATER,[zae]:t.NOTEQUAL};function Y(we,pe){if(pe.type===tp&&e.has("OES_texture_float_linear")===!1&&(pe.magFilter===Ml||pe.magFilter===n3||pe.magFilter===LC||pe.magFilter===s1||pe.minFilter===Ml||pe.minFilter===n3||pe.minFilter===LC||pe.minFilter===s1)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(we,t.TEXTURE_WRAP_S,te[pe.wrapS]),t.texParameteri(we,t.TEXTURE_WRAP_T,te[pe.wrapT]),(we===t.TEXTURE_3D||we===t.TEXTURE_2D_ARRAY)&&t.texParameteri(we,t.TEXTURE_WRAP_R,te[pe.wrapR]),t.texParameteri(we,t.TEXTURE_MAG_FILTER,re[pe.magFilter]),t.texParameteri(we,t.TEXTURE_MIN_FILTER,re[pe.minFilter]),pe.compareFunction&&(t.texParameteri(we,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(we,t.TEXTURE_COMPARE_FUNC,H[pe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(pe.magFilter===Il||pe.minFilter!==LC&&pe.minFilter!==s1||pe.type===tp&&e.has("OES_texture_float_linear")===!1)return;if(pe.anisotropy>1||r.get(pe).__currentAnisotropy){const ze=e.get("EXT_texture_filter_anisotropic");t.texParameterf(we,ze.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(pe.anisotropy,i.getMaxAnisotropy())),r.get(pe).__currentAnisotropy=pe.anisotropy}}}function Z(we,pe){let ze=!1;we.__webglInit===void 0&&(we.__webglInit=!0,pe.addEventListener("dispose",A));const Je=pe.source;let Xe=f.get(Je);Xe===void 0&&(Xe={},f.set(Je,Xe));const tt=O(pe);if(tt!==we.__cacheKey){Xe[tt]===void 0&&(Xe[tt]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,ze=!0),Xe[tt].usedTimes++;const Nt=Xe[we.__cacheKey];Nt!==void 0&&(Xe[we.__cacheKey].usedTimes--,Nt.usedTimes===0&&L(pe)),we.__cacheKey=tt,we.__webglTexture=Xe[tt].texture}return ze}function Q(we,pe,ze){let Je=t.TEXTURE_2D;(pe.isDataArrayTexture||pe.isCompressedArrayTexture)&&(Je=t.TEXTURE_2D_ARRAY),pe.isData3DTexture&&(Je=t.TEXTURE_3D);const Xe=Z(we,pe),tt=pe.source;n.bindTexture(Je,we.__webglTexture,t.TEXTURE0+ze);const Nt=r.get(tt);if(tt.version!==Nt.__version||Xe===!0){n.activeTexture(t.TEXTURE0+ze);const gt=Xi.getPrimaries(Xi.workingColorSpace),wt=pe.colorSpace===bm?null:Xi.getPrimaries(pe.colorSpace),Re=pe.colorSpace===bm||gt===wt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,pe.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,pe.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Re);let se=m(pe.image,!1,i.maxTextureSize);se=ae(pe,se);const W=s.convert(pe.format,pe.colorSpace),oe=s.convert(pe.type);let xe=v(pe.internalFormat,W,oe,pe.colorSpace,pe.isVideoTexture);Y(Je,pe);let Ce;const Se=pe.mipmaps,ye=pe.isVideoTexture!==!0,Ke=Nt.__version===void 0||Xe===!0,ke=tt.dataReady,He=x(pe,se);if(pe.isDepthTexture)xe=E(pe.format===EE,pe.type),Ke&&(ye?n.texStorage2D(t.TEXTURE_2D,1,xe,se.width,se.height):n.texImage2D(t.TEXTURE_2D,0,xe,se.width,se.height,0,W,oe,null));else if(pe.isDataTexture)if(Se.length>0){ye&&Ke&&n.texStorage2D(t.TEXTURE_2D,He,xe,Se[0].width,Se[0].height);for(let Fe=0,We=Se.length;Fe<We;Fe++)Ce=Se[Fe],ye?ke&&n.texSubImage2D(t.TEXTURE_2D,Fe,0,0,Ce.width,Ce.height,W,oe,Ce.data):n.texImage2D(t.TEXTURE_2D,Fe,xe,Ce.width,Ce.height,0,W,oe,Ce.data);pe.generateMipmaps=!1}else ye?(Ke&&n.texStorage2D(t.TEXTURE_2D,He,xe,se.width,se.height),ke&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,se.width,se.height,W,oe,se.data)):n.texImage2D(t.TEXTURE_2D,0,xe,se.width,se.height,0,W,oe,se.data);else if(pe.isCompressedTexture)if(pe.isCompressedArrayTexture){ye&&Ke&&n.texStorage3D(t.TEXTURE_2D_ARRAY,He,xe,Se[0].width,Se[0].height,se.depth);for(let Fe=0,We=Se.length;Fe<We;Fe++)if(Ce=Se[Fe],pe.format!==lu)if(W!==null)if(ye){if(ke)if(pe.layerUpdates.size>0){const at=eF(Ce.width,Ce.height,pe.format,pe.type);for(const Be of pe.layerUpdates){const nt=Ce.data.subarray(Be*at/Ce.data.BYTES_PER_ELEMENT,(Be+1)*at/Ce.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Fe,0,0,Be,Ce.width,Ce.height,1,W,nt)}pe.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Fe,0,0,0,Ce.width,Ce.height,se.depth,W,Ce.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,Fe,xe,Ce.width,Ce.height,se.depth,0,Ce.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ye?ke&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,Fe,0,0,0,Ce.width,Ce.height,se.depth,W,oe,Ce.data):n.texImage3D(t.TEXTURE_2D_ARRAY,Fe,xe,Ce.width,Ce.height,se.depth,0,W,oe,Ce.data)}else{ye&&Ke&&n.texStorage2D(t.TEXTURE_2D,He,xe,Se[0].width,Se[0].height);for(let Fe=0,We=Se.length;Fe<We;Fe++)Ce=Se[Fe],pe.format!==lu?W!==null?ye?ke&&n.compressedTexSubImage2D(t.TEXTURE_2D,Fe,0,0,Ce.width,Ce.height,W,Ce.data):n.compressedTexImage2D(t.TEXTURE_2D,Fe,xe,Ce.width,Ce.height,0,Ce.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ye?ke&&n.texSubImage2D(t.TEXTURE_2D,Fe,0,0,Ce.width,Ce.height,W,oe,Ce.data):n.texImage2D(t.TEXTURE_2D,Fe,xe,Ce.width,Ce.height,0,W,oe,Ce.data)}else if(pe.isDataArrayTexture)if(ye){if(Ke&&n.texStorage3D(t.TEXTURE_2D_ARRAY,He,xe,se.width,se.height,se.depth),ke)if(pe.layerUpdates.size>0){const Fe=eF(se.width,se.height,pe.format,pe.type);for(const We of pe.layerUpdates){const at=se.data.subarray(We*Fe/se.data.BYTES_PER_ELEMENT,(We+1)*Fe/se.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,We,se.width,se.height,1,W,oe,at)}pe.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,se.width,se.height,se.depth,W,oe,se.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,xe,se.width,se.height,se.depth,0,W,oe,se.data);else if(pe.isData3DTexture)ye?(Ke&&n.texStorage3D(t.TEXTURE_3D,He,xe,se.width,se.height,se.depth),ke&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,se.width,se.height,se.depth,W,oe,se.data)):n.texImage3D(t.TEXTURE_3D,0,xe,se.width,se.height,se.depth,0,W,oe,se.data);else if(pe.isFramebufferTexture){if(Ke)if(ye)n.texStorage2D(t.TEXTURE_2D,He,xe,se.width,se.height);else{let Fe=se.width,We=se.height;for(let at=0;at<He;at++)n.texImage2D(t.TEXTURE_2D,at,xe,Fe,We,0,W,oe,null),Fe>>=1,We>>=1}}else if(Se.length>0){if(ye&&Ke){const Fe=ve(Se[0]);n.texStorage2D(t.TEXTURE_2D,He,xe,Fe.width,Fe.height)}for(let Fe=0,We=Se.length;Fe<We;Fe++)Ce=Se[Fe],ye?ke&&n.texSubImage2D(t.TEXTURE_2D,Fe,0,0,W,oe,Ce):n.texImage2D(t.TEXTURE_2D,Fe,xe,W,oe,Ce);pe.generateMipmaps=!1}else if(ye){if(Ke){const Fe=ve(se);n.texStorage2D(t.TEXTURE_2D,He,xe,Fe.width,Fe.height)}ke&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,W,oe,se)}else n.texImage2D(t.TEXTURE_2D,0,xe,W,oe,se);g(pe)&&_(Je),Nt.__version=tt.version,pe.onUpdate&&pe.onUpdate(pe)}we.__version=pe.version}function ie(we,pe,ze){if(pe.image.length!==6)return;const Je=Z(we,pe),Xe=pe.source;n.bindTexture(t.TEXTURE_CUBE_MAP,we.__webglTexture,t.TEXTURE0+ze);const tt=r.get(Xe);if(Xe.version!==tt.__version||Je===!0){n.activeTexture(t.TEXTURE0+ze);const Nt=Xi.getPrimaries(Xi.workingColorSpace),gt=pe.colorSpace===bm?null:Xi.getPrimaries(pe.colorSpace),wt=pe.colorSpace===bm||Nt===gt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,pe.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,pe.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,wt);const Re=pe.isCompressedTexture||pe.image[0].isCompressedTexture,se=pe.image[0]&&pe.image[0].isDataTexture,W=[];for(let We=0;We<6;We++)!Re&&!se?W[We]=m(pe.image[We],!0,i.maxCubemapSize):W[We]=se?pe.image[We].image:pe.image[We],W[We]=ae(pe,W[We]);const oe=W[0],xe=s.convert(pe.format,pe.colorSpace),Ce=s.convert(pe.type),Se=v(pe.internalFormat,xe,Ce,pe.colorSpace),ye=pe.isVideoTexture!==!0,Ke=tt.__version===void 0||Je===!0,ke=Xe.dataReady;let He=x(pe,oe);Y(t.TEXTURE_CUBE_MAP,pe);let Fe;if(Re){ye&&Ke&&n.texStorage2D(t.TEXTURE_CUBE_MAP,He,Se,oe.width,oe.height);for(let We=0;We<6;We++){Fe=W[We].mipmaps;for(let at=0;at<Fe.length;at++){const Be=Fe[at];pe.format!==lu?xe!==null?ye?ke&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,at,0,0,Be.width,Be.height,xe,Be.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,at,Se,Be.width,Be.height,0,Be.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ye?ke&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,at,0,0,Be.width,Be.height,xe,Ce,Be.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,at,Se,Be.width,Be.height,0,xe,Ce,Be.data)}}}else{if(Fe=pe.mipmaps,ye&&Ke){Fe.length>0&&He++;const We=ve(W[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,He,Se,We.width,We.height)}for(let We=0;We<6;We++)if(se){ye?ke&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,0,0,W[We].width,W[We].height,xe,Ce,W[We].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,Se,W[We].width,W[We].height,0,xe,Ce,W[We].data);for(let at=0;at<Fe.length;at++){const nt=Fe[at].image[We].image;ye?ke&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,at+1,0,0,nt.width,nt.height,xe,Ce,nt.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,at+1,Se,nt.width,nt.height,0,xe,Ce,nt.data)}}else{ye?ke&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,0,0,xe,Ce,W[We]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,Se,xe,Ce,W[We]);for(let at=0;at<Fe.length;at++){const Be=Fe[at];ye?ke&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,at+1,0,0,xe,Ce,Be.image[We]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+We,at+1,Se,xe,Ce,Be.image[We])}}}g(pe)&&_(t.TEXTURE_CUBE_MAP),tt.__version=Xe.version,pe.onUpdate&&pe.onUpdate(pe)}we.__version=pe.version}function ge(we,pe,ze,Je,Xe,tt){const Nt=s.convert(ze.format,ze.colorSpace),gt=s.convert(ze.type),wt=v(ze.internalFormat,Nt,gt,ze.colorSpace),Re=r.get(pe),se=r.get(ze);if(se.__renderTarget=pe,!Re.__hasExternalTextures){const W=Math.max(1,pe.width>>tt),oe=Math.max(1,pe.height>>tt);Xe===t.TEXTURE_3D||Xe===t.TEXTURE_2D_ARRAY?n.texImage3D(Xe,tt,wt,W,oe,pe.depth,0,Nt,gt,null):n.texImage2D(Xe,tt,wt,W,oe,0,Nt,gt,null)}n.bindFramebuffer(t.FRAMEBUFFER,we),De(pe)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Je,Xe,se.__webglTexture,0,Ve(pe)):(Xe===t.TEXTURE_2D||Xe>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Xe<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,Je,Xe,se.__webglTexture,tt),n.bindFramebuffer(t.FRAMEBUFFER,null)}function Te(we,pe,ze){if(t.bindRenderbuffer(t.RENDERBUFFER,we),pe.depthBuffer){const Je=pe.depthTexture,Xe=Je&&Je.isDepthTexture?Je.type:null,tt=E(pe.stencilBuffer,Xe),Nt=pe.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,gt=Ve(pe);De(pe)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,gt,tt,pe.width,pe.height):ze?t.renderbufferStorageMultisample(t.RENDERBUFFER,gt,tt,pe.width,pe.height):t.renderbufferStorage(t.RENDERBUFFER,tt,pe.width,pe.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Nt,t.RENDERBUFFER,we)}else{const Je=pe.textures;for(let Xe=0;Xe<Je.length;Xe++){const tt=Je[Xe],Nt=s.convert(tt.format,tt.colorSpace),gt=s.convert(tt.type),wt=v(tt.internalFormat,Nt,gt,tt.colorSpace),Re=Ve(pe);ze&&De(pe)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Re,wt,pe.width,pe.height):De(pe)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Re,wt,pe.width,pe.height):t.renderbufferStorage(t.RENDERBUFFER,wt,pe.width,pe.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function be(we,pe){if(pe&&pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,we),!(pe.depthTexture&&pe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Je=r.get(pe.depthTexture);Je.__renderTarget=pe,(!Je.__webglTexture||pe.depthTexture.image.width!==pe.width||pe.depthTexture.image.height!==pe.height)&&(pe.depthTexture.image.width=pe.width,pe.depthTexture.image.height=pe.height,pe.depthTexture.needsUpdate=!0),z(pe.depthTexture,0);const Xe=Je.__webglTexture,tt=Ve(pe);if(pe.depthTexture.format===YT)De(pe)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Xe,0,tt):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Xe,0);else if(pe.depthTexture.format===EE)De(pe)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Xe,0,tt):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Xe,0);else throw new Error("Unknown depthTexture format")}function Pe(we){const pe=r.get(we),ze=we.isWebGLCubeRenderTarget===!0;if(pe.__boundDepthTexture!==we.depthTexture){const Je=we.depthTexture;if(pe.__depthDisposeCallback&&pe.__depthDisposeCallback(),Je){const Xe=()=>{delete pe.__boundDepthTexture,delete pe.__depthDisposeCallback,Je.removeEventListener("dispose",Xe)};Je.addEventListener("dispose",Xe),pe.__depthDisposeCallback=Xe}pe.__boundDepthTexture=Je}if(we.depthTexture&&!pe.__autoAllocateDepthBuffer){if(ze)throw new Error("target.depthTexture not supported in Cube render targets");const Je=we.texture.mipmaps;Je&&Je.length>0?be(pe.__webglFramebuffer[0],we):be(pe.__webglFramebuffer,we)}else if(ze){pe.__webglDepthbuffer=[];for(let Je=0;Je<6;Je++)if(n.bindFramebuffer(t.FRAMEBUFFER,pe.__webglFramebuffer[Je]),pe.__webglDepthbuffer[Je]===void 0)pe.__webglDepthbuffer[Je]=t.createRenderbuffer(),Te(pe.__webglDepthbuffer[Je],we,!1);else{const Xe=we.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,tt=pe.__webglDepthbuffer[Je];t.bindRenderbuffer(t.RENDERBUFFER,tt),t.framebufferRenderbuffer(t.FRAMEBUFFER,Xe,t.RENDERBUFFER,tt)}}else{const Je=we.texture.mipmaps;if(Je&&Je.length>0?n.bindFramebuffer(t.FRAMEBUFFER,pe.__webglFramebuffer[0]):n.bindFramebuffer(t.FRAMEBUFFER,pe.__webglFramebuffer),pe.__webglDepthbuffer===void 0)pe.__webglDepthbuffer=t.createRenderbuffer(),Te(pe.__webglDepthbuffer,we,!1);else{const Xe=we.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,tt=pe.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,tt),t.framebufferRenderbuffer(t.FRAMEBUFFER,Xe,t.RENDERBUFFER,tt)}}n.bindFramebuffer(t.FRAMEBUFFER,null)}function Ge(we,pe,ze){const Je=r.get(we);pe!==void 0&&ge(Je.__webglFramebuffer,we,we.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),ze!==void 0&&Pe(we)}function Ze(we){const pe=we.texture,ze=r.get(we),Je=r.get(pe);we.addEventListener("dispose",T);const Xe=we.textures,tt=we.isWebGLCubeRenderTarget===!0,Nt=Xe.length>1;if(Nt||(Je.__webglTexture===void 0&&(Je.__webglTexture=t.createTexture()),Je.__version=pe.version,o.memory.textures++),tt){ze.__webglFramebuffer=[];for(let gt=0;gt<6;gt++)if(pe.mipmaps&&pe.mipmaps.length>0){ze.__webglFramebuffer[gt]=[];for(let wt=0;wt<pe.mipmaps.length;wt++)ze.__webglFramebuffer[gt][wt]=t.createFramebuffer()}else ze.__webglFramebuffer[gt]=t.createFramebuffer()}else{if(pe.mipmaps&&pe.mipmaps.length>0){ze.__webglFramebuffer=[];for(let gt=0;gt<pe.mipmaps.length;gt++)ze.__webglFramebuffer[gt]=t.createFramebuffer()}else ze.__webglFramebuffer=t.createFramebuffer();if(Nt)for(let gt=0,wt=Xe.length;gt<wt;gt++){const Re=r.get(Xe[gt]);Re.__webglTexture===void 0&&(Re.__webglTexture=t.createTexture(),o.memory.textures++)}if(we.samples>0&&De(we)===!1){ze.__webglMultisampledFramebuffer=t.createFramebuffer(),ze.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,ze.__webglMultisampledFramebuffer);for(let gt=0;gt<Xe.length;gt++){const wt=Xe[gt];ze.__webglColorRenderbuffer[gt]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,ze.__webglColorRenderbuffer[gt]);const Re=s.convert(wt.format,wt.colorSpace),se=s.convert(wt.type),W=v(wt.internalFormat,Re,se,wt.colorSpace,we.isXRRenderTarget===!0),oe=Ve(we);t.renderbufferStorageMultisample(t.RENDERBUFFER,oe,W,we.width,we.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+gt,t.RENDERBUFFER,ze.__webglColorRenderbuffer[gt])}t.bindRenderbuffer(t.RENDERBUFFER,null),we.depthBuffer&&(ze.__webglDepthRenderbuffer=t.createRenderbuffer(),Te(ze.__webglDepthRenderbuffer,we,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(tt){n.bindTexture(t.TEXTURE_CUBE_MAP,Je.__webglTexture),Y(t.TEXTURE_CUBE_MAP,pe);for(let gt=0;gt<6;gt++)if(pe.mipmaps&&pe.mipmaps.length>0)for(let wt=0;wt<pe.mipmaps.length;wt++)ge(ze.__webglFramebuffer[gt][wt],we,pe,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+gt,wt);else ge(ze.__webglFramebuffer[gt],we,pe,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+gt,0);g(pe)&&_(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Nt){for(let gt=0,wt=Xe.length;gt<wt;gt++){const Re=Xe[gt],se=r.get(Re);n.bindTexture(t.TEXTURE_2D,se.__webglTexture),Y(t.TEXTURE_2D,Re),ge(ze.__webglFramebuffer,we,Re,t.COLOR_ATTACHMENT0+gt,t.TEXTURE_2D,0),g(Re)&&_(t.TEXTURE_2D)}n.unbindTexture()}else{let gt=t.TEXTURE_2D;if((we.isWebGL3DRenderTarget||we.isWebGLArrayRenderTarget)&&(gt=we.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(gt,Je.__webglTexture),Y(gt,pe),pe.mipmaps&&pe.mipmaps.length>0)for(let wt=0;wt<pe.mipmaps.length;wt++)ge(ze.__webglFramebuffer[wt],we,pe,t.COLOR_ATTACHMENT0,gt,wt);else ge(ze.__webglFramebuffer,we,pe,t.COLOR_ATTACHMENT0,gt,0);g(pe)&&_(gt),n.unbindTexture()}we.depthBuffer&&Pe(we)}function lt(we){const pe=we.textures;for(let ze=0,Je=pe.length;ze<Je;ze++){const Xe=pe[ze];if(g(Xe)){const tt=y(we),Nt=r.get(Xe).__webglTexture;n.bindTexture(tt,Nt),_(tt),n.unbindTexture()}}}const pt=[],ne=[];function Le(we){if(we.samples>0){if(De(we)===!1){const pe=we.textures,ze=we.width,Je=we.height;let Xe=t.COLOR_BUFFER_BIT;const tt=we.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Nt=r.get(we),gt=pe.length>1;if(gt)for(let Re=0;Re<pe.length;Re++)n.bindFramebuffer(t.FRAMEBUFFER,Nt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Re,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,Nt.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Re,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,Nt.__webglMultisampledFramebuffer);const wt=we.texture.mipmaps;wt&&wt.length>0?n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Nt.__webglFramebuffer[0]):n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Nt.__webglFramebuffer);for(let Re=0;Re<pe.length;Re++){if(we.resolveDepthBuffer&&(we.depthBuffer&&(Xe|=t.DEPTH_BUFFER_BIT),we.stencilBuffer&&we.resolveStencilBuffer&&(Xe|=t.STENCIL_BUFFER_BIT)),gt){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Nt.__webglColorRenderbuffer[Re]);const se=r.get(pe[Re]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,se,0)}t.blitFramebuffer(0,0,ze,Je,0,0,ze,Je,Xe,t.NEAREST),c===!0&&(pt.length=0,ne.length=0,pt.push(t.COLOR_ATTACHMENT0+Re),we.depthBuffer&&we.resolveDepthBuffer===!1&&(pt.push(tt),ne.push(tt),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,ne)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,pt))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),gt)for(let Re=0;Re<pe.length;Re++){n.bindFramebuffer(t.FRAMEBUFFER,Nt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Re,t.RENDERBUFFER,Nt.__webglColorRenderbuffer[Re]);const se=r.get(pe[Re]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,Nt.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Re,t.TEXTURE_2D,se,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Nt.__webglMultisampledFramebuffer)}else if(we.depthBuffer&&we.resolveDepthBuffer===!1&&c){const pe=we.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[pe])}}}function Ve(we){return Math.min(i.maxSamples,we.samples)}function De(we){const pe=r.get(we);return we.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&pe.__useRenderToTexture!==!1}function Ie(we){const pe=o.render.frame;u.get(we)!==pe&&(u.set(we,pe),we.update())}function ae(we,pe){const ze=we.colorSpace,Je=we.format,Xe=we.type;return we.isCompressedTexture===!0||we.isVideoTexture===!0||ze!==Cg&&ze!==bm&&(Xi.getTransfer(ze)===Bs?(Je!==lu||Xe!==ko)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ze)),pe}function ve(we){return typeof HTMLImageElement<"u"&&we instanceof HTMLImageElement?(l.width=we.naturalWidth||we.width,l.height=we.naturalHeight||we.height):typeof VideoFrame<"u"&&we instanceof VideoFrame?(l.width=we.displayWidth,l.height=we.displayHeight):(l.width=we.width,l.height=we.height),l}this.allocateTextureUnit=D,this.resetTextureUnits=M,this.setTexture2D=z,this.setTexture2DArray=q,this.setTexture3D=G,this.setTextureCube=K,this.rebindTextures=Ge,this.setupRenderTarget=Ze,this.updateRenderTargetMipmap=lt,this.updateMultisampleRenderTarget=Le,this.setupDepthRenderbuffer=Pe,this.setupFrameBufferTexture=ge,this.useMultisampledRTT=De}function wde(t,e){function n(r,i=bm){let s;const o=Xi.getTransfer(i);if(r===ko)return t.UNSIGNED_BYTE;if(r===$4)return t.UNSIGNED_SHORT_4_4_4_4;if(r===G4)return t.UNSIGNED_SHORT_5_5_5_1;if(r===ZW)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===XW)return t.BYTE;if(r===JW)return t.SHORT;if(r===qT)return t.UNSIGNED_SHORT;if(r===H4)return t.INT;if(r===pv)return t.UNSIGNED_INT;if(r===tp)return t.FLOAT;if(r===Av)return t.HALF_FLOAT;if(r===QW)return t.ALPHA;if(r===eq)return t.RGB;if(r===lu)return t.RGBA;if(r===YT)return t.DEPTH_COMPONENT;if(r===EE)return t.DEPTH_STENCIL;if(r===BA)return t.RED;if(r===W4)return t.RED_INTEGER;if(r===q4)return t.RG;if(r===Y4)return t.RG_INTEGER;if(r===yO)return t.RGBA_INTEGER;if(r===sk||r===ok||r===ak||r===ck)if(o===Bs)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===sk)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===ok)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===ak)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===ck)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===sk)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===ok)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===ak)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===ck)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===wD||r===TD||r===AD||r===CD)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===wD)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===TD)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===AD)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===CD)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===RD||r===kD||r===MD)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===RD||r===kD)return o===Bs?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===MD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===OD||r===ID||r===ND||r===PD||r===DD||r===LD||r===UD||r===BD||r===FD||r===jD||r===zD||r===VD||r===HD||r===$D)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===OD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===ID)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===ND)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===PD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===DD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===LD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===UD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===BD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===FD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===jD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===zD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===VD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===HD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===$D)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===lk||r===GD||r===WD)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===lk)return o===Bs?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===GD)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===WD)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===tq||r===qD||r===YD||r===KD)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===lk)return s.COMPRESSED_RED_RGTC1_EXT;if(r===qD)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===YD)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===KD)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===SE?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:n}}const Tde=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Ade=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Cde{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,r){if(this.texture===null){const i=new hc,s=e.properties.get(i);s.__webglTexture=n.texture,(n.depthNear!==r.depthNear||n.depthFar!==r.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,r=new ao({vertexShader:Tde,fragmentShader:Ade,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new ef(new jA(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Rde extends Pg{constructor(e,n){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,h=null,f=null,d=null,p=null;const m=new Cde,g=n.getContextAttributes();let _=null,y=null;const v=[],E=[],x=new zn;let A=null;const T=new su;T.viewport=new qo;const k=new su;k.viewport=new qo;const L=[T,k],I=new qce;let F=null,M=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Q){let ie=v[Q];return ie===void 0&&(ie=new E3,v[Q]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(Q){let ie=v[Q];return ie===void 0&&(ie=new E3,v[Q]=ie),ie.getGripSpace()},this.getHand=function(Q){let ie=v[Q];return ie===void 0&&(ie=new E3,v[Q]=ie),ie.getHandSpace()};function D(Q){const ie=E.indexOf(Q.inputSource);if(ie===-1)return;const ge=v[ie];ge!==void 0&&(ge.update(Q.inputSource,Q.frame,l||o),ge.dispatchEvent({type:Q.type,data:Q.inputSource}))}function O(){i.removeEventListener("select",D),i.removeEventListener("selectstart",D),i.removeEventListener("selectend",D),i.removeEventListener("squeeze",D),i.removeEventListener("squeezestart",D),i.removeEventListener("squeezeend",D),i.removeEventListener("end",O),i.removeEventListener("inputsourceschange",z);for(let Q=0;Q<v.length;Q++){const ie=E[Q];ie!==null&&(E[Q]=null,v[Q].disconnect(ie))}F=null,M=null,m.reset(),e.setRenderTarget(_),d=null,f=null,h=null,i=null,y=null,Z.stop(),r.isPresenting=!1,e.setPixelRatio(A),e.setSize(x.width,x.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Q){s=Q,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Q){a=Q,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(Q){l=Q},this.getBaseLayer=function(){return f!==null?f:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(Q){if(i=Q,i!==null){if(_=e.getRenderTarget(),i.addEventListener("select",D),i.addEventListener("selectstart",D),i.addEventListener("selectend",D),i.addEventListener("squeeze",D),i.addEventListener("squeezestart",D),i.addEventListener("squeezeend",D),i.addEventListener("end",O),i.addEventListener("inputsourceschange",z),g.xrCompatible!==!0&&await n.makeXRCompatible(),A=e.getPixelRatio(),e.getSize(x),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let ge=null,Te=null,be=null;g.depth&&(be=g.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,ge=g.stencil?EE:YT,Te=g.stencil?SE:pv);const Pe={colorFormat:n.RGBA8,depthFormat:be,scaleFactor:s};h=new XRWebGLBinding(i,n),f=h.createProjectionLayer(Pe),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),y=new il(f.textureWidth,f.textureHeight,{format:lu,type:ko,depthTexture:new SO(f.textureWidth,f.textureHeight,Te,void 0,void 0,void 0,void 0,void 0,void 0,ge),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const ge={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(i,n,ge),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),y=new il(d.framebufferWidth,d.framebufferHeight,{format:lu,type:ko,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await i.requestReferenceSpace(a),Z.setContext(i),Z.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};function z(Q){for(let ie=0;ie<Q.removed.length;ie++){const ge=Q.removed[ie],Te=E.indexOf(ge);Te>=0&&(E[Te]=null,v[Te].disconnect(ge))}for(let ie=0;ie<Q.added.length;ie++){const ge=Q.added[ie];let Te=E.indexOf(ge);if(Te===-1){for(let Pe=0;Pe<v.length;Pe++)if(Pe>=E.length){E.push(ge),Te=Pe;break}else if(E[Pe]===null){E[Pe]=ge,Te=Pe;break}if(Te===-1)break}const be=v[Te];be&&be.connect(ge)}}const q=new zt,G=new zt;function K(Q,ie,ge){q.setFromMatrixPosition(ie.matrixWorld),G.setFromMatrixPosition(ge.matrixWorld);const Te=q.distanceTo(G),be=ie.projectionMatrix.elements,Pe=ge.projectionMatrix.elements,Ge=be[14]/(be[10]-1),Ze=be[14]/(be[10]+1),lt=(be[9]+1)/be[5],pt=(be[9]-1)/be[5],ne=(be[8]-1)/be[0],Le=(Pe[8]+1)/Pe[0],Ve=Ge*ne,De=Ge*Le,Ie=Te/(-ne+Le),ae=Ie*-ne;if(ie.matrixWorld.decompose(Q.position,Q.quaternion,Q.scale),Q.translateX(ae),Q.translateZ(Ie),Q.matrixWorld.compose(Q.position,Q.quaternion,Q.scale),Q.matrixWorldInverse.copy(Q.matrixWorld).invert(),be[10]===-1)Q.projectionMatrix.copy(ie.projectionMatrix),Q.projectionMatrixInverse.copy(ie.projectionMatrixInverse);else{const ve=Ge+Ie,we=Ze+Ie,pe=Ve-ae,ze=De+(Te-ae),Je=lt*Ze/we*ve,Xe=pt*Ze/we*ve;Q.projectionMatrix.makePerspective(pe,ze,Je,Xe,ve,we),Q.projectionMatrixInverse.copy(Q.projectionMatrix).invert()}}function te(Q,ie){ie===null?Q.matrixWorld.copy(Q.matrix):Q.matrixWorld.multiplyMatrices(ie.matrixWorld,Q.matrix),Q.matrixWorldInverse.copy(Q.matrixWorld).invert()}this.updateCamera=function(Q){if(i===null)return;let ie=Q.near,ge=Q.far;m.texture!==null&&(m.depthNear>0&&(ie=m.depthNear),m.depthFar>0&&(ge=m.depthFar)),I.near=k.near=T.near=ie,I.far=k.far=T.far=ge,(F!==I.near||M!==I.far)&&(i.updateRenderState({depthNear:I.near,depthFar:I.far}),F=I.near,M=I.far),T.layers.mask=Q.layers.mask|2,k.layers.mask=Q.layers.mask|4,I.layers.mask=T.layers.mask|k.layers.mask;const Te=Q.parent,be=I.cameras;te(I,Te);for(let Pe=0;Pe<be.length;Pe++)te(be[Pe],Te);be.length===2?K(I,T,k):I.projectionMatrix.copy(T.projectionMatrix),re(Q,I,Te)};function re(Q,ie,ge){ge===null?Q.matrix.copy(ie.matrixWorld):(Q.matrix.copy(ge.matrixWorld),Q.matrix.invert(),Q.matrix.multiply(ie.matrixWorld)),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale),Q.updateMatrixWorld(!0),Q.projectionMatrix.copy(ie.projectionMatrix),Q.projectionMatrixInverse.copy(ie.projectionMatrixInverse),Q.isPerspectiveCamera&&(Q.fov=KT*2*Math.atan(1/Q.projectionMatrix.elements[5]),Q.zoom=1)}this.getCamera=function(){return I},this.getFoveation=function(){if(!(f===null&&d===null))return c},this.setFoveation=function(Q){c=Q,f!==null&&(f.fixedFoveation=Q),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=Q)},this.hasDepthSensing=function(){return m.texture!==null},this.getDepthSensingMesh=function(){return m.getMesh(I)};let H=null;function Y(Q,ie){if(u=ie.getViewerPose(l||o),p=ie,u!==null){const ge=u.views;d!==null&&(e.setRenderTargetFramebuffer(y,d.framebuffer),e.setRenderTarget(y));let Te=!1;ge.length!==I.cameras.length&&(I.cameras.length=0,Te=!0);for(let Ge=0;Ge<ge.length;Ge++){const Ze=ge[Ge];let lt=null;if(d!==null)lt=d.getViewport(Ze);else{const ne=h.getViewSubImage(f,Ze);lt=ne.viewport,Ge===0&&(e.setRenderTargetTextures(y,ne.colorTexture,ne.depthStencilTexture),e.setRenderTarget(y))}let pt=L[Ge];pt===void 0&&(pt=new su,pt.layers.enable(Ge),pt.viewport=new qo,L[Ge]=pt),pt.matrix.fromArray(Ze.transform.matrix),pt.matrix.decompose(pt.position,pt.quaternion,pt.scale),pt.projectionMatrix.fromArray(Ze.projectionMatrix),pt.projectionMatrixInverse.copy(pt.projectionMatrix).invert(),pt.viewport.set(lt.x,lt.y,lt.width,lt.height),Ge===0&&(I.matrix.copy(pt.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale)),Te===!0&&I.cameras.push(pt)}const be=i.enabledFeatures;if(be&&be.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&h){const Ge=h.getDepthInformation(ge[0]);Ge&&Ge.isValid&&Ge.texture&&m.init(e,Ge,i.renderState)}}for(let ge=0;ge<v.length;ge++){const Te=E[ge],be=v[ge];Te!==null&&be!==void 0&&be.update(Te,ie,l||o)}H&&H(Q,ie),ie.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ie}),p=null}const Z=new pq;Z.setAnimationLoop(Y),this.setAnimationLoop=function(Q){H=Q},this.dispose=function(){}}}const wy=new Pm,kde=new So;function Mde(t,e){function n(g,_){g.matrixAutoUpdate===!0&&g.updateMatrix(),_.value.copy(g.matrix)}function r(g,_){_.color.getRGB(g.fogColor.value,lq(t)),_.isFog?(g.fogNear.value=_.near,g.fogFar.value=_.far):_.isFogExp2&&(g.fogDensity.value=_.density)}function i(g,_,y,v,E){_.isMeshBasicMaterial||_.isMeshLambertMaterial?s(g,_):_.isMeshToonMaterial?(s(g,_),h(g,_)):_.isMeshPhongMaterial?(s(g,_),u(g,_)):_.isMeshStandardMaterial?(s(g,_),f(g,_),_.isMeshPhysicalMaterial&&d(g,_,E)):_.isMeshMatcapMaterial?(s(g,_),p(g,_)):_.isMeshDepthMaterial?s(g,_):_.isMeshDistanceMaterial?(s(g,_),m(g,_)):_.isMeshNormalMaterial?s(g,_):_.isLineBasicMaterial?(o(g,_),_.isLineDashedMaterial&&a(g,_)):_.isPointsMaterial?c(g,_,y,v):_.isSpriteMaterial?l(g,_):_.isShadowMaterial?(g.color.value.copy(_.color),g.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}function s(g,_){g.opacity.value=_.opacity,_.color&&g.diffuse.value.copy(_.color),_.emissive&&g.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(g.map.value=_.map,n(_.map,g.mapTransform)),_.alphaMap&&(g.alphaMap.value=_.alphaMap,n(_.alphaMap,g.alphaMapTransform)),_.bumpMap&&(g.bumpMap.value=_.bumpMap,n(_.bumpMap,g.bumpMapTransform),g.bumpScale.value=_.bumpScale,_.side===Ic&&(g.bumpScale.value*=-1)),_.normalMap&&(g.normalMap.value=_.normalMap,n(_.normalMap,g.normalMapTransform),g.normalScale.value.copy(_.normalScale),_.side===Ic&&g.normalScale.value.negate()),_.displacementMap&&(g.displacementMap.value=_.displacementMap,n(_.displacementMap,g.displacementMapTransform),g.displacementScale.value=_.displacementScale,g.displacementBias.value=_.displacementBias),_.emissiveMap&&(g.emissiveMap.value=_.emissiveMap,n(_.emissiveMap,g.emissiveMapTransform)),_.specularMap&&(g.specularMap.value=_.specularMap,n(_.specularMap,g.specularMapTransform)),_.alphaTest>0&&(g.alphaTest.value=_.alphaTest);const y=e.get(_),v=y.envMap,E=y.envMapRotation;v&&(g.envMap.value=v,wy.copy(E),wy.x*=-1,wy.y*=-1,wy.z*=-1,v.isCubeTexture&&v.isRenderTargetTexture===!1&&(wy.y*=-1,wy.z*=-1),g.envMapRotation.value.setFromMatrix4(kde.makeRotationFromEuler(wy)),g.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=_.reflectivity,g.ior.value=_.ior,g.refractionRatio.value=_.refractionRatio),_.lightMap&&(g.lightMap.value=_.lightMap,g.lightMapIntensity.value=_.lightMapIntensity,n(_.lightMap,g.lightMapTransform)),_.aoMap&&(g.aoMap.value=_.aoMap,g.aoMapIntensity.value=_.aoMapIntensity,n(_.aoMap,g.aoMapTransform))}function o(g,_){g.diffuse.value.copy(_.color),g.opacity.value=_.opacity,_.map&&(g.map.value=_.map,n(_.map,g.mapTransform))}function a(g,_){g.dashSize.value=_.dashSize,g.totalSize.value=_.dashSize+_.gapSize,g.scale.value=_.scale}function c(g,_,y,v){g.diffuse.value.copy(_.color),g.opacity.value=_.opacity,g.size.value=_.size*y,g.scale.value=v*.5,_.map&&(g.map.value=_.map,n(_.map,g.uvTransform)),_.alphaMap&&(g.alphaMap.value=_.alphaMap,n(_.alphaMap,g.alphaMapTransform)),_.alphaTest>0&&(g.alphaTest.value=_.alphaTest)}function l(g,_){g.diffuse.value.copy(_.color),g.opacity.value=_.opacity,g.rotation.value=_.rotation,_.map&&(g.map.value=_.map,n(_.map,g.mapTransform)),_.alphaMap&&(g.alphaMap.value=_.alphaMap,n(_.alphaMap,g.alphaMapTransform)),_.alphaTest>0&&(g.alphaTest.value=_.alphaTest)}function u(g,_){g.specular.value.copy(_.specular),g.shininess.value=Math.max(_.shininess,1e-4)}function h(g,_){_.gradientMap&&(g.gradientMap.value=_.gradientMap)}function f(g,_){g.metalness.value=_.metalness,_.metalnessMap&&(g.metalnessMap.value=_.metalnessMap,n(_.metalnessMap,g.metalnessMapTransform)),g.roughness.value=_.roughness,_.roughnessMap&&(g.roughnessMap.value=_.roughnessMap,n(_.roughnessMap,g.roughnessMapTransform)),_.envMap&&(g.envMapIntensity.value=_.envMapIntensity)}function d(g,_,y){g.ior.value=_.ior,_.sheen>0&&(g.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),g.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(g.sheenColorMap.value=_.sheenColorMap,n(_.sheenColorMap,g.sheenColorMapTransform)),_.sheenRoughnessMap&&(g.sheenRoughnessMap.value=_.sheenRoughnessMap,n(_.sheenRoughnessMap,g.sheenRoughnessMapTransform))),_.clearcoat>0&&(g.clearcoat.value=_.clearcoat,g.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(g.clearcoatMap.value=_.clearcoatMap,n(_.clearcoatMap,g.clearcoatMapTransform)),_.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap,n(_.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),_.clearcoatNormalMap&&(g.clearcoatNormalMap.value=_.clearcoatNormalMap,n(_.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),_.side===Ic&&g.clearcoatNormalScale.value.negate())),_.dispersion>0&&(g.dispersion.value=_.dispersion),_.iridescence>0&&(g.iridescence.value=_.iridescence,g.iridescenceIOR.value=_.iridescenceIOR,g.iridescenceThicknessMinimum.value=_.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=_.iridescenceThicknessRange[1],_.iridescenceMap&&(g.iridescenceMap.value=_.iridescenceMap,n(_.iridescenceMap,g.iridescenceMapTransform)),_.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=_.iridescenceThicknessMap,n(_.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),_.transmission>0&&(g.transmission.value=_.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),_.transmissionMap&&(g.transmissionMap.value=_.transmissionMap,n(_.transmissionMap,g.transmissionMapTransform)),g.thickness.value=_.thickness,_.thicknessMap&&(g.thicknessMap.value=_.thicknessMap,n(_.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=_.attenuationDistance,g.attenuationColor.value.copy(_.attenuationColor)),_.anisotropy>0&&(g.anisotropyVector.value.set(_.anisotropy*Math.cos(_.anisotropyRotation),_.anisotropy*Math.sin(_.anisotropyRotation)),_.anisotropyMap&&(g.anisotropyMap.value=_.anisotropyMap,n(_.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=_.specularIntensity,g.specularColor.value.copy(_.specularColor),_.specularColorMap&&(g.specularColorMap.value=_.specularColorMap,n(_.specularColorMap,g.specularColorMapTransform)),_.specularIntensityMap&&(g.specularIntensityMap.value=_.specularIntensityMap,n(_.specularIntensityMap,g.specularIntensityMapTransform))}function p(g,_){_.matcap&&(g.matcap.value=_.matcap)}function m(g,_){const y=e.get(_).light;g.referencePosition.value.setFromMatrixPosition(y.matrixWorld),g.nearDistance.value=y.shadow.camera.near,g.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function Ode(t,e,n,r){let i={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(y,v){const E=v.program;r.uniformBlockBinding(y,E)}function l(y,v){let E=i[y.id];E===void 0&&(p(y),E=u(y),i[y.id]=E,y.addEventListener("dispose",g));const x=v.program;r.updateUBOMapping(y,x);const A=e.render.frame;s[y.id]!==A&&(f(y),s[y.id]=A)}function u(y){const v=h();y.__bindingPointIndex=v;const E=t.createBuffer(),x=y.__size,A=y.usage;return t.bindBuffer(t.UNIFORM_BUFFER,E),t.bufferData(t.UNIFORM_BUFFER,x,A),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,v,E),E}function h(){for(let y=0;y<a;y++)if(o.indexOf(y)===-1)return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(y){const v=i[y.id],E=y.uniforms,x=y.__cache;t.bindBuffer(t.UNIFORM_BUFFER,v);for(let A=0,T=E.length;A<T;A++){const k=Array.isArray(E[A])?E[A]:[E[A]];for(let L=0,I=k.length;L<I;L++){const F=k[L];if(d(F,A,L,x)===!0){const M=F.__offset,D=Array.isArray(F.value)?F.value:[F.value];let O=0;for(let z=0;z<D.length;z++){const q=D[z],G=m(q);typeof q=="number"||typeof q=="boolean"?(F.__data[0]=q,t.bufferSubData(t.UNIFORM_BUFFER,M+O,F.__data)):q.isMatrix3?(F.__data[0]=q.elements[0],F.__data[1]=q.elements[1],F.__data[2]=q.elements[2],F.__data[3]=0,F.__data[4]=q.elements[3],F.__data[5]=q.elements[4],F.__data[6]=q.elements[5],F.__data[7]=0,F.__data[8]=q.elements[6],F.__data[9]=q.elements[7],F.__data[10]=q.elements[8],F.__data[11]=0):(q.toArray(F.__data,O),O+=G.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,M,F.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function d(y,v,E,x){const A=y.value,T=v+"_"+E;if(x[T]===void 0)return typeof A=="number"||typeof A=="boolean"?x[T]=A:x[T]=A.clone(),!0;{const k=x[T];if(typeof A=="number"||typeof A=="boolean"){if(k!==A)return x[T]=A,!0}else if(k.equals(A)===!1)return k.copy(A),!0}return!1}function p(y){const v=y.uniforms;let E=0;const x=16;for(let T=0,k=v.length;T<k;T++){const L=Array.isArray(v[T])?v[T]:[v[T]];for(let I=0,F=L.length;I<F;I++){const M=L[I],D=Array.isArray(M.value)?M.value:[M.value];for(let O=0,z=D.length;O<z;O++){const q=D[O],G=m(q),K=E%x,te=K%G.boundary,re=K+te;E+=te,re!==0&&x-re<G.storage&&(E+=x-re),M.__data=new Float32Array(G.storage/Float32Array.BYTES_PER_ELEMENT),M.__offset=E,E+=G.storage}}}const A=E%x;return A>0&&(E+=x-A),y.__size=E,y.__cache={},this}function m(y){const v={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(v.boundary=4,v.storage=4):y.isVector2?(v.boundary=8,v.storage=8):y.isVector3||y.isColor?(v.boundary=16,v.storage=12):y.isVector4?(v.boundary=16,v.storage=16):y.isMatrix3?(v.boundary=48,v.storage=48):y.isMatrix4?(v.boundary=64,v.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),v}function g(y){const v=y.target;v.removeEventListener("dispose",g);const E=o.indexOf(v.__bindingPointIndex);o.splice(E,1),t.deleteBuffer(i[v.id]),delete i[v.id],delete s[v.id]}function _(){for(const y in i)t.deleteBuffer(i[y]);o=[],i={},s={}}return{bind:c,update:l,dispose:_}}class Ide{constructor(e={}){const{canvas:n=oce(),context:r=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:f=!1}=e;this.isWebGLRenderer=!0;let d;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=r.getContextAttributes().alpha}else d=o;const p=new Uint32Array(4),m=new Int32Array(4);let g=null,_=null;const y=[],v=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=yg,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const E=this;let x=!1;this._outputColorSpace=Bi;let A=0,T=0,k=null,L=-1,I=null;const F=new qo,M=new qo;let D=null;const O=new wi(0);let z=0,q=n.width,G=n.height,K=1,te=null,re=null;const H=new qo(0,0,q,G),Y=new qo(0,0,q,G);let Z=!1;const Q=new fq;let ie=!1,ge=!1;const Te=new So,be=new So,Pe=new zt,Ge=new qo,Ze={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let lt=!1;function pt(){return k===null?K:1}let ne=r;function Le(je,vt){return n.getContext(je,vt)}try{const je={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${UA}`),n.addEventListener("webglcontextlost",We,!1),n.addEventListener("webglcontextrestored",at,!1),n.addEventListener("webglcontextcreationerror",Be,!1),ne===null){const vt="webgl2";if(ne=Le(vt,je),ne===null)throw Le(vt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(je){throw console.error("THREE.WebGLRenderer: "+je.message),je}let Ve,De,Ie,ae,ve,we,pe,ze,Je,Xe,tt,Nt,gt,wt,Re,se,W,oe,xe,Ce,Se,ye,Ke,ke;function He(){Ve=new Vhe(ne),Ve.init(),ye=new wde(ne,Ve),De=new Dhe(ne,Ve,e,ye),Ie=new Ede(ne,Ve),De.reverseDepthBuffer&&f&&Ie.buffers.depth.setReversed(!0),ae=new Ghe(ne),ve=new lde,we=new xde(ne,Ve,Ie,ve,De,ye,ae),pe=new Uhe(E),ze=new zhe(E),Je=new Jce(ne),Ke=new Nhe(ne,Je),Xe=new Hhe(ne,Je,ae,Ke),tt=new qhe(ne,Xe,Je,ae),xe=new Whe(ne,De,we),se=new Lhe(ve),Nt=new cde(E,pe,ze,Ve,De,Ke,se),gt=new Mde(E,ve),wt=new hde,Re=new _de(Ve),oe=new Ihe(E,pe,ze,Ie,tt,d,c),W=new bde(E,tt,De),ke=new Ode(ne,ae,De,Ie),Ce=new Phe(ne,Ve,ae),Se=new $he(ne,Ve,ae),ae.programs=Nt.programs,E.capabilities=De,E.extensions=Ve,E.properties=ve,E.renderLists=wt,E.shadowMap=W,E.state=Ie,E.info=ae}He();const Fe=new Rde(E,ne);this.xr=Fe,this.getContext=function(){return ne},this.getContextAttributes=function(){return ne.getContextAttributes()},this.forceContextLoss=function(){const je=Ve.get("WEBGL_lose_context");je&&je.loseContext()},this.forceContextRestore=function(){const je=Ve.get("WEBGL_lose_context");je&&je.restoreContext()},this.getPixelRatio=function(){return K},this.setPixelRatio=function(je){je!==void 0&&(K=je,this.setSize(q,G,!1))},this.getSize=function(je){return je.set(q,G)},this.setSize=function(je,vt,It=!0){if(Fe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}q=je,G=vt,n.width=Math.floor(je*K),n.height=Math.floor(vt*K),It===!0&&(n.style.width=je+"px",n.style.height=vt+"px"),this.setViewport(0,0,je,vt)},this.getDrawingBufferSize=function(je){return je.set(q*K,G*K).floor()},this.setDrawingBufferSize=function(je,vt,It){q=je,G=vt,K=It,n.width=Math.floor(je*It),n.height=Math.floor(vt*It),this.setViewport(0,0,je,vt)},this.getCurrentViewport=function(je){return je.copy(F)},this.getViewport=function(je){return je.copy(H)},this.setViewport=function(je,vt,It,Ut){je.isVector4?H.set(je.x,je.y,je.z,je.w):H.set(je,vt,It,Ut),Ie.viewport(F.copy(H).multiplyScalar(K).round())},this.getScissor=function(je){return je.copy(Y)},this.setScissor=function(je,vt,It,Ut){je.isVector4?Y.set(je.x,je.y,je.z,je.w):Y.set(je,vt,It,Ut),Ie.scissor(M.copy(Y).multiplyScalar(K).round())},this.getScissorTest=function(){return Z},this.setScissorTest=function(je){Ie.setScissorTest(Z=je)},this.setOpaqueSort=function(je){te=je},this.setTransparentSort=function(je){re=je},this.getClearColor=function(je){return je.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor(...arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha(...arguments)},this.clear=function(je=!0,vt=!0,It=!0){let Ut=0;if(je){let yt=!1;if(k!==null){const an=k.texture.format;yt=an===yO||an===Y4||an===W4}if(yt){const an=k.texture.type,In=an===ko||an===pv||an===qT||an===SE||an===$4||an===G4,_n=oe.getClearColor(),Pn=oe.getClearAlpha(),tr=_n.r,fr=_n.g,Cn=_n.b;In?(p[0]=tr,p[1]=fr,p[2]=Cn,p[3]=Pn,ne.clearBufferuiv(ne.COLOR,0,p)):(m[0]=tr,m[1]=fr,m[2]=Cn,m[3]=Pn,ne.clearBufferiv(ne.COLOR,0,m))}else Ut|=ne.COLOR_BUFFER_BIT}vt&&(Ut|=ne.DEPTH_BUFFER_BIT),It&&(Ut|=ne.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ne.clear(Ut)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",We,!1),n.removeEventListener("webglcontextrestored",at,!1),n.removeEventListener("webglcontextcreationerror",Be,!1),oe.dispose(),wt.dispose(),Re.dispose(),ve.dispose(),pe.dispose(),ze.dispose(),tt.dispose(),Ke.dispose(),ke.dispose(),Nt.dispose(),Fe.dispose(),Fe.removeEventListener("sessionstart",Rt),Fe.removeEventListener("sessionend",Vt),_t.stop()};function We(je){je.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function at(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const je=ae.autoReset,vt=W.enabled,It=W.autoUpdate,Ut=W.needsUpdate,yt=W.type;He(),ae.autoReset=je,W.enabled=vt,W.autoUpdate=It,W.needsUpdate=Ut,W.type=yt}function Be(je){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",je.statusMessage)}function nt(je){const vt=je.target;vt.removeEventListener("dispose",nt),it(vt)}function it(je){xt(je),ve.remove(je)}function xt(je){const vt=ve.get(je).programs;vt!==void 0&&(vt.forEach(function(It){Nt.releaseProgram(It)}),je.isShaderMaterial&&Nt.releaseShaderCache(je))}this.renderBufferDirect=function(je,vt,It,Ut,yt,an){vt===null&&(vt=Ze);const In=yt.isMesh&&yt.matrixWorld.determinant()<0,_n=ti(je,vt,It,Ut,yt);Ie.setMaterial(Ut,In);let Pn=It.index,tr=1;if(Ut.wireframe===!0){if(Pn=Xe.getWireframeAttribute(It),Pn===void 0)return;tr=2}const fr=It.drawRange,Cn=It.attributes.position;let yr=fr.start*tr,Hr=(fr.start+fr.count)*tr;an!==null&&(yr=Math.max(yr,an.start*tr),Hr=Math.min(Hr,(an.start+an.count)*tr)),Pn!==null?(yr=Math.max(yr,0),Hr=Math.min(Hr,Pn.count)):Cn!=null&&(yr=Math.max(yr,0),Hr=Math.min(Hr,Cn.count));const ds=Hr-yr;if(ds<0||ds===1/0)return;Ke.setup(yt,Ut,_n,It,Pn);let Lr,Gr=Ce;if(Pn!==null&&(Lr=Je.get(Pn),Gr=Se,Gr.setIndex(Lr)),yt.isMesh)Ut.wireframe===!0?(Ie.setLineWidth(Ut.wireframeLinewidth*pt()),Gr.setMode(ne.LINES)):Gr.setMode(ne.TRIANGLES);else if(yt.isLine){let ar=Ut.linewidth;ar===void 0&&(ar=1),Ie.setLineWidth(ar*pt()),yt.isLineSegments?Gr.setMode(ne.LINES):yt.isLineLoop?Gr.setMode(ne.LINE_LOOP):Gr.setMode(ne.LINE_STRIP)}else yt.isPoints?Gr.setMode(ne.POINTS):yt.isSprite&&Gr.setMode(ne.TRIANGLES);if(yt.isBatchedMesh)if(yt._multiDrawInstances!==null)uk("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Gr.renderMultiDrawInstances(yt._multiDrawStarts,yt._multiDrawCounts,yt._multiDrawCount,yt._multiDrawInstances);else if(Ve.get("WEBGL_multi_draw"))Gr.renderMultiDraw(yt._multiDrawStarts,yt._multiDrawCounts,yt._multiDrawCount);else{const ar=yt._multiDrawStarts,br=yt._multiDrawCounts,Un=yt._multiDrawCount,bi=Pn?Je.get(Pn).bytesPerElement:1,ai=ve.get(Ut).currentProgram.getUniforms();for(let Rs=0;Rs<Un;Rs++)ai.setValue(ne,"_gl_DrawID",Rs),Gr.render(ar[Rs]/bi,br[Rs])}else if(yt.isInstancedMesh)Gr.renderInstances(yr,ds,yt.count);else if(It.isInstancedBufferGeometry){const ar=It._maxInstanceCount!==void 0?It._maxInstanceCount:1/0,br=Math.min(It.instanceCount,ar);Gr.renderInstances(yr,ds,br)}else Gr.render(yr,ds)};function ot(je,vt,It){je.transparent===!0&&je.side===Oa&&je.forceSinglePass===!1?(je.side=Ic,je.needsUpdate=!0,mr(je,vt,It),je.side=Ag,je.needsUpdate=!0,mr(je,vt,It),je.side=Oa):mr(je,vt,It)}this.compile=function(je,vt,It=null){It===null&&(It=je),_=Re.get(It),_.init(vt),v.push(_),It.traverseVisible(function(yt){yt.isLight&&yt.layers.test(vt.layers)&&(_.pushLight(yt),yt.castShadow&&_.pushShadow(yt))}),je!==It&&je.traverseVisible(function(yt){yt.isLight&&yt.layers.test(vt.layers)&&(_.pushLight(yt),yt.castShadow&&_.pushShadow(yt))}),_.setupLights();const Ut=new Set;return je.traverse(function(yt){if(!(yt.isMesh||yt.isPoints||yt.isLine||yt.isSprite))return;const an=yt.material;if(an)if(Array.isArray(an))for(let In=0;In<an.length;In++){const _n=an[In];ot(_n,It,yt),Ut.add(_n)}else ot(an,It,yt),Ut.add(an)}),_=v.pop(),Ut},this.compileAsync=function(je,vt,It=null){const Ut=this.compile(je,vt,It);return new Promise(yt=>{function an(){if(Ut.forEach(function(In){ve.get(In).currentProgram.isReady()&&Ut.delete(In)}),Ut.size===0){yt(je);return}setTimeout(an,10)}Ve.get("KHR_parallel_shader_compile")!==null?an():setTimeout(an,10)})};let tn=null;function ln(je){tn&&tn(je)}function Rt(){_t.stop()}function Vt(){_t.start()}const _t=new pq;_t.setAnimationLoop(ln),typeof self<"u"&&_t.setContext(self),this.setAnimationLoop=function(je){tn=je,Fe.setAnimationLoop(je),je===null?_t.stop():_t.start()},Fe.addEventListener("sessionstart",Rt),Fe.addEventListener("sessionend",Vt),this.render=function(je,vt){if(vt!==void 0&&vt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(x===!0)return;if(je.matrixWorldAutoUpdate===!0&&je.updateMatrixWorld(),vt.parent===null&&vt.matrixWorldAutoUpdate===!0&&vt.updateMatrixWorld(),Fe.enabled===!0&&Fe.isPresenting===!0&&(Fe.cameraAutoUpdate===!0&&Fe.updateCamera(vt),vt=Fe.getCamera()),je.isScene===!0&&je.onBeforeRender(E,je,vt,k),_=Re.get(je,v.length),_.init(vt),v.push(_),be.multiplyMatrices(vt.projectionMatrix,vt.matrixWorldInverse),Q.setFromProjectionMatrix(be),ge=this.localClippingEnabled,ie=se.init(this.clippingPlanes,ge),g=wt.get(je,y.length),g.init(),y.push(g),Fe.enabled===!0&&Fe.isPresenting===!0){const an=E.xr.getDepthSensingMesh();an!==null&&Jt(an,vt,-1/0,E.sortObjects)}Jt(je,vt,0,E.sortObjects),g.finish(),E.sortObjects===!0&&g.sort(te,re),lt=Fe.enabled===!1||Fe.isPresenting===!1||Fe.hasDepthSensing()===!1,lt&&oe.addToRenderList(g,je),this.info.render.frame++,ie===!0&&se.beginShadows();const It=_.state.shadowsArray;W.render(It,je,vt),ie===!0&&se.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ut=g.opaque,yt=g.transmissive;if(_.setupLights(),vt.isArrayCamera){const an=vt.cameras;if(yt.length>0)for(let In=0,_n=an.length;In<_n;In++){const Pn=an[In];qt(Ut,yt,je,Pn)}lt&&oe.render(je);for(let In=0,_n=an.length;In<_n;In++){const Pn=an[In];Tn(g,je,Pn,Pn.viewport)}}else yt.length>0&&qt(Ut,yt,je,vt),lt&&oe.render(je),Tn(g,je,vt);k!==null&&T===0&&(we.updateMultisampleRenderTarget(k),we.updateRenderTargetMipmap(k)),je.isScene===!0&&je.onAfterRender(E,je,vt),Ke.resetDefaultState(),L=-1,I=null,v.pop(),v.length>0?(_=v[v.length-1],ie===!0&&se.setGlobalState(E.clippingPlanes,_.state.camera)):_=null,y.pop(),y.length>0?g=y[y.length-1]:g=null};function Jt(je,vt,It,Ut){if(je.visible===!1)return;if(je.layers.test(vt.layers)){if(je.isGroup)It=je.renderOrder;else if(je.isLOD)je.autoUpdate===!0&&je.update(vt);else if(je.isLight)_.pushLight(je),je.castShadow&&_.pushShadow(je);else if(je.isSprite){if(!je.frustumCulled||Q.intersectsSprite(je)){Ut&&Ge.setFromMatrixPosition(je.matrixWorld).applyMatrix4(be);const In=tt.update(je),_n=je.material;_n.visible&&g.push(je,In,_n,It,Ge.z,null)}}else if((je.isMesh||je.isLine||je.isPoints)&&(!je.frustumCulled||Q.intersectsObject(je))){const In=tt.update(je),_n=je.material;if(Ut&&(je.boundingSphere!==void 0?(je.boundingSphere===null&&je.computeBoundingSphere(),Ge.copy(je.boundingSphere.center)):(In.boundingSphere===null&&In.computeBoundingSphere(),Ge.copy(In.boundingSphere.center)),Ge.applyMatrix4(je.matrixWorld).applyMatrix4(be)),Array.isArray(_n)){const Pn=In.groups;for(let tr=0,fr=Pn.length;tr<fr;tr++){const Cn=Pn[tr],yr=_n[Cn.materialIndex];yr&&yr.visible&&g.push(je,In,yr,It,Ge.z,Cn)}}else _n.visible&&g.push(je,In,_n,It,Ge.z,null)}}const an=je.children;for(let In=0,_n=an.length;In<_n;In++)Jt(an[In],vt,It,Ut)}function Tn(je,vt,It,Ut){const yt=je.opaque,an=je.transmissive,In=je.transparent;_.setupLightsView(It),ie===!0&&se.setGlobalState(E.clippingPlanes,It),Ut&&Ie.viewport(F.copy(Ut)),yt.length>0&&An(yt,vt,It),an.length>0&&An(an,vt,It),In.length>0&&An(In,vt,It),Ie.buffers.depth.setTest(!0),Ie.buffers.depth.setMask(!0),Ie.buffers.color.setMask(!0),Ie.setPolygonOffset(!1)}function qt(je,vt,It,Ut){if((It.isScene===!0?It.overrideMaterial:null)!==null)return;_.state.transmissionRenderTarget[Ut.id]===void 0&&(_.state.transmissionRenderTarget[Ut.id]=new il(1,1,{generateMipmaps:!0,type:Ve.has("EXT_color_buffer_half_float")||Ve.has("EXT_color_buffer_float")?Av:ko,minFilter:s1,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Xi.workingColorSpace}));const an=_.state.transmissionRenderTarget[Ut.id],In=Ut.viewport||F;an.setSize(In.z*E.transmissionResolutionScale,In.w*E.transmissionResolutionScale);const _n=E.getRenderTarget();E.setRenderTarget(an),E.getClearColor(O),z=E.getClearAlpha(),z<1&&E.setClearColor(16777215,.5),E.clear(),lt&&oe.render(It);const Pn=E.toneMapping;E.toneMapping=yg;const tr=Ut.viewport;if(Ut.viewport!==void 0&&(Ut.viewport=void 0),_.setupLightsView(Ut),ie===!0&&se.setGlobalState(E.clippingPlanes,Ut),An(je,It,Ut),we.updateMultisampleRenderTarget(an),we.updateRenderTargetMipmap(an),Ve.has("WEBGL_multisampled_render_to_texture")===!1){let fr=!1;for(let Cn=0,yr=vt.length;Cn<yr;Cn++){const Hr=vt[Cn],ds=Hr.object,Lr=Hr.geometry,Gr=Hr.material,ar=Hr.group;if(Gr.side===Oa&&ds.layers.test(Ut.layers)){const br=Gr.side;Gr.side=Ic,Gr.needsUpdate=!0,Ln(ds,It,Ut,Lr,Gr,ar),Gr.side=br,Gr.needsUpdate=!0,fr=!0}}fr===!0&&(we.updateMultisampleRenderTarget(an),we.updateRenderTargetMipmap(an))}E.setRenderTarget(_n),E.setClearColor(O,z),tr!==void 0&&(Ut.viewport=tr),E.toneMapping=Pn}function An(je,vt,It){const Ut=vt.isScene===!0?vt.overrideMaterial:null;for(let yt=0,an=je.length;yt<an;yt++){const In=je[yt],_n=In.object,Pn=In.geometry,tr=In.group;let fr=In.material;fr.allowOverride===!0&&Ut!==null&&(fr=Ut),_n.layers.test(It.layers)&&Ln(_n,vt,It,Pn,fr,tr)}}function Ln(je,vt,It,Ut,yt,an){je.onBeforeRender(E,vt,It,Ut,yt,an),je.modelViewMatrix.multiplyMatrices(It.matrixWorldInverse,je.matrixWorld),je.normalMatrix.getNormalMatrix(je.modelViewMatrix),yt.onBeforeRender(E,vt,It,Ut,je,an),yt.transparent===!0&&yt.side===Oa&&yt.forceSinglePass===!1?(yt.side=Ic,yt.needsUpdate=!0,E.renderBufferDirect(It,vt,Ut,yt,je,an),yt.side=Ag,yt.needsUpdate=!0,E.renderBufferDirect(It,vt,Ut,yt,je,an),yt.side=Oa):E.renderBufferDirect(It,vt,Ut,yt,je,an),je.onAfterRender(E,vt,It,Ut,yt,an)}function mr(je,vt,It){vt.isScene!==!0&&(vt=Ze);const Ut=ve.get(je),yt=_.state.lights,an=_.state.shadowsArray,In=yt.state.version,_n=Nt.getParameters(je,yt.state,an,vt,It),Pn=Nt.getProgramCacheKey(_n);let tr=Ut.programs;Ut.environment=je.isMeshStandardMaterial?vt.environment:null,Ut.fog=vt.fog,Ut.envMap=(je.isMeshStandardMaterial?ze:pe).get(je.envMap||Ut.environment),Ut.envMapRotation=Ut.environment!==null&&je.envMap===null?vt.environmentRotation:je.envMapRotation,tr===void 0&&(je.addEventListener("dispose",nt),tr=new Map,Ut.programs=tr);let fr=tr.get(Pn);if(fr!==void 0){if(Ut.currentProgram===fr&&Ut.lightsStateVersion===In)return hi(je,_n),fr}else _n.uniforms=Nt.getUniforms(je),je.onBeforeCompile(_n,E),fr=Nt.acquireProgram(_n,Pn),tr.set(Pn,fr),Ut.uniforms=_n.uniforms;const Cn=Ut.uniforms;return(!je.isShaderMaterial&&!je.isRawShaderMaterial||je.clipping===!0)&&(Cn.clippingPlanes=se.uniform),hi(je,_n),Ut.needsLights=rs(je),Ut.lightsStateVersion=In,Ut.needsLights&&(Cn.ambientLightColor.value=yt.state.ambient,Cn.lightProbe.value=yt.state.probe,Cn.directionalLights.value=yt.state.directional,Cn.directionalLightShadows.value=yt.state.directionalShadow,Cn.spotLights.value=yt.state.spot,Cn.spotLightShadows.value=yt.state.spotShadow,Cn.rectAreaLights.value=yt.state.rectArea,Cn.ltc_1.value=yt.state.rectAreaLTC1,Cn.ltc_2.value=yt.state.rectAreaLTC2,Cn.pointLights.value=yt.state.point,Cn.pointLightShadows.value=yt.state.pointShadow,Cn.hemisphereLights.value=yt.state.hemi,Cn.directionalShadowMap.value=yt.state.directionalShadowMap,Cn.directionalShadowMatrix.value=yt.state.directionalShadowMatrix,Cn.spotShadowMap.value=yt.state.spotShadowMap,Cn.spotLightMatrix.value=yt.state.spotLightMatrix,Cn.spotLightMap.value=yt.state.spotLightMap,Cn.pointShadowMap.value=yt.state.pointShadowMap,Cn.pointShadowMatrix.value=yt.state.pointShadowMatrix),Ut.currentProgram=fr,Ut.uniformsList=null,fr}function ns(je){if(je.uniformsList===null){const vt=je.currentProgram.getUniforms();je.uniformsList=hk.seqWithValue(vt.seq,je.uniforms)}return je.uniformsList}function hi(je,vt){const It=ve.get(je);It.outputColorSpace=vt.outputColorSpace,It.batching=vt.batching,It.batchingColor=vt.batchingColor,It.instancing=vt.instancing,It.instancingColor=vt.instancingColor,It.instancingMorph=vt.instancingMorph,It.skinning=vt.skinning,It.morphTargets=vt.morphTargets,It.morphNormals=vt.morphNormals,It.morphColors=vt.morphColors,It.morphTargetsCount=vt.morphTargetsCount,It.numClippingPlanes=vt.numClippingPlanes,It.numIntersection=vt.numClipIntersection,It.vertexAlphas=vt.vertexAlphas,It.vertexTangents=vt.vertexTangents,It.toneMapping=vt.toneMapping}function ti(je,vt,It,Ut,yt){vt.isScene!==!0&&(vt=Ze),we.resetTextureUnits();const an=vt.fog,In=Ut.isMeshStandardMaterial?vt.environment:null,_n=k===null?E.outputColorSpace:k.isXRRenderTarget===!0?k.texture.colorSpace:Cg,Pn=(Ut.isMeshStandardMaterial?ze:pe).get(Ut.envMap||In),tr=Ut.vertexColors===!0&&!!It.attributes.color&&It.attributes.color.itemSize===4,fr=!!It.attributes.tangent&&(!!Ut.normalMap||Ut.anisotropy>0),Cn=!!It.morphAttributes.position,yr=!!It.morphAttributes.normal,Hr=!!It.morphAttributes.color;let ds=yg;Ut.toneMapped&&(k===null||k.isXRRenderTarget===!0)&&(ds=E.toneMapping);const Lr=It.morphAttributes.position||It.morphAttributes.normal||It.morphAttributes.color,Gr=Lr!==void 0?Lr.length:0,ar=ve.get(Ut),br=_.state.lights;if(ie===!0&&(ge===!0||je!==I)){const Xn=je===I&&Ut.id===L;se.setState(Ut,je,Xn)}let Un=!1;Ut.version===ar.__version?(ar.needsLights&&ar.lightsStateVersion!==br.state.version||ar.outputColorSpace!==_n||yt.isBatchedMesh&&ar.batching===!1||!yt.isBatchedMesh&&ar.batching===!0||yt.isBatchedMesh&&ar.batchingColor===!0&&yt.colorTexture===null||yt.isBatchedMesh&&ar.batchingColor===!1&&yt.colorTexture!==null||yt.isInstancedMesh&&ar.instancing===!1||!yt.isInstancedMesh&&ar.instancing===!0||yt.isSkinnedMesh&&ar.skinning===!1||!yt.isSkinnedMesh&&ar.skinning===!0||yt.isInstancedMesh&&ar.instancingColor===!0&&yt.instanceColor===null||yt.isInstancedMesh&&ar.instancingColor===!1&&yt.instanceColor!==null||yt.isInstancedMesh&&ar.instancingMorph===!0&&yt.morphTexture===null||yt.isInstancedMesh&&ar.instancingMorph===!1&&yt.morphTexture!==null||ar.envMap!==Pn||Ut.fog===!0&&ar.fog!==an||ar.numClippingPlanes!==void 0&&(ar.numClippingPlanes!==se.numPlanes||ar.numIntersection!==se.numIntersection)||ar.vertexAlphas!==tr||ar.vertexTangents!==fr||ar.morphTargets!==Cn||ar.morphNormals!==yr||ar.morphColors!==Hr||ar.toneMapping!==ds||ar.morphTargetsCount!==Gr)&&(Un=!0):(Un=!0,ar.__version=Ut.version);let bi=ar.currentProgram;Un===!0&&(bi=mr(Ut,vt,yt));let ai=!1,Rs=!1,lo=!1;const Ri=bi.getUniforms(),Mn=ar.uniforms;if(Ie.useProgram(bi.program)&&(ai=!0,Rs=!0,lo=!0),Ut.id!==L&&(L=Ut.id,Rs=!0),ai||I!==je){Ie.buffers.depth.getReversed()?(Te.copy(je.projectionMatrix),cce(Te),lce(Te),Ri.setValue(ne,"projectionMatrix",Te)):Ri.setValue(ne,"projectionMatrix",je.projectionMatrix),Ri.setValue(ne,"viewMatrix",je.matrixWorldInverse);const ps=Ri.map.cameraPosition;ps!==void 0&&ps.setValue(ne,Pe.setFromMatrixPosition(je.matrixWorld)),De.logarithmicDepthBuffer&&Ri.setValue(ne,"logDepthBufFC",2/(Math.log(je.far+1)/Math.LN2)),(Ut.isMeshPhongMaterial||Ut.isMeshToonMaterial||Ut.isMeshLambertMaterial||Ut.isMeshBasicMaterial||Ut.isMeshStandardMaterial||Ut.isShaderMaterial)&&Ri.setValue(ne,"isOrthographic",je.isOrthographicCamera===!0),I!==je&&(I=je,Rs=!0,lo=!0)}if(yt.isSkinnedMesh){Ri.setOptional(ne,yt,"bindMatrix"),Ri.setOptional(ne,yt,"bindMatrixInverse");const Xn=yt.skeleton;Xn&&(Xn.boneTexture===null&&Xn.computeBoneTexture(),Ri.setValue(ne,"boneTexture",Xn.boneTexture,we))}yt.isBatchedMesh&&(Ri.setOptional(ne,yt,"batchingTexture"),Ri.setValue(ne,"batchingTexture",yt._matricesTexture,we),Ri.setOptional(ne,yt,"batchingIdTexture"),Ri.setValue(ne,"batchingIdTexture",yt._indirectTexture,we),Ri.setOptional(ne,yt,"batchingColorTexture"),yt._colorsTexture!==null&&Ri.setValue(ne,"batchingColorTexture",yt._colorsTexture,we));const Pi=It.morphAttributes;if((Pi.position!==void 0||Pi.normal!==void 0||Pi.color!==void 0)&&xe.update(yt,It,bi),(Rs||ar.receiveShadow!==yt.receiveShadow)&&(ar.receiveShadow=yt.receiveShadow,Ri.setValue(ne,"receiveShadow",yt.receiveShadow)),Ut.isMeshGouraudMaterial&&Ut.envMap!==null&&(Mn.envMap.value=Pn,Mn.flipEnvMap.value=Pn.isCubeTexture&&Pn.isRenderTargetTexture===!1?-1:1),Ut.isMeshStandardMaterial&&Ut.envMap===null&&vt.environment!==null&&(Mn.envMapIntensity.value=vt.environmentIntensity),Rs&&(Ri.setValue(ne,"toneMappingExposure",E.toneMappingExposure),ar.needsLights&&Fi(Mn,lo),an&&Ut.fog===!0&&gt.refreshFogUniforms(Mn,an),gt.refreshMaterialUniforms(Mn,Ut,K,G,_.state.transmissionRenderTarget[je.id]),hk.upload(ne,ns(ar),Mn,we)),Ut.isShaderMaterial&&Ut.uniformsNeedUpdate===!0&&(hk.upload(ne,ns(ar),Mn,we),Ut.uniformsNeedUpdate=!1),Ut.isSpriteMaterial&&Ri.setValue(ne,"center",yt.center),Ri.setValue(ne,"modelViewMatrix",yt.modelViewMatrix),Ri.setValue(ne,"normalMatrix",yt.normalMatrix),Ri.setValue(ne,"modelMatrix",yt.matrixWorld),Ut.isShaderMaterial||Ut.isRawShaderMaterial){const Xn=Ut.uniformsGroups;for(let ps=0,al=Xn.length;ps<al;ps++){const ms=Xn[ps];ke.update(ms,bi),ke.bind(ms,bi)}}return bi}function Fi(je,vt){je.ambientLightColor.needsUpdate=vt,je.lightProbe.needsUpdate=vt,je.directionalLights.needsUpdate=vt,je.directionalLightShadows.needsUpdate=vt,je.pointLights.needsUpdate=vt,je.pointLightShadows.needsUpdate=vt,je.spotLights.needsUpdate=vt,je.spotLightShadows.needsUpdate=vt,je.rectAreaLights.needsUpdate=vt,je.hemisphereLights.needsUpdate=vt}function rs(je){return je.isMeshLambertMaterial||je.isMeshToonMaterial||je.isMeshPhongMaterial||je.isMeshStandardMaterial||je.isShadowMaterial||je.isShaderMaterial&&je.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return k},this.setRenderTargetTextures=function(je,vt,It){const Ut=ve.get(je);Ut.__autoAllocateDepthBuffer=je.resolveDepthBuffer===!1,Ut.__autoAllocateDepthBuffer===!1&&(Ut.__useRenderToTexture=!1),ve.get(je.texture).__webglTexture=vt,ve.get(je.depthTexture).__webglTexture=Ut.__autoAllocateDepthBuffer?void 0:It,Ut.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(je,vt){const It=ve.get(je);It.__webglFramebuffer=vt,It.__useDefaultFramebuffer=vt===void 0};const qi=ne.createFramebuffer();this.setRenderTarget=function(je,vt=0,It=0){k=je,A=vt,T=It;let Ut=!0,yt=null,an=!1,In=!1;if(je){const Pn=ve.get(je);if(Pn.__useDefaultFramebuffer!==void 0)Ie.bindFramebuffer(ne.FRAMEBUFFER,null),Ut=!1;else if(Pn.__webglFramebuffer===void 0)we.setupRenderTarget(je);else if(Pn.__hasExternalTextures)we.rebindTextures(je,ve.get(je.texture).__webglTexture,ve.get(je.depthTexture).__webglTexture);else if(je.depthBuffer){const Cn=je.depthTexture;if(Pn.__boundDepthTexture!==Cn){if(Cn!==null&&ve.has(Cn)&&(je.width!==Cn.image.width||je.height!==Cn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");we.setupDepthRenderbuffer(je)}}const tr=je.texture;(tr.isData3DTexture||tr.isDataArrayTexture||tr.isCompressedArrayTexture)&&(In=!0);const fr=ve.get(je).__webglFramebuffer;je.isWebGLCubeRenderTarget?(Array.isArray(fr[vt])?yt=fr[vt][It]:yt=fr[vt],an=!0):je.samples>0&&we.useMultisampledRTT(je)===!1?yt=ve.get(je).__webglMultisampledFramebuffer:Array.isArray(fr)?yt=fr[It]:yt=fr,F.copy(je.viewport),M.copy(je.scissor),D=je.scissorTest}else F.copy(H).multiplyScalar(K).floor(),M.copy(Y).multiplyScalar(K).floor(),D=Z;if(It!==0&&(yt=qi),Ie.bindFramebuffer(ne.FRAMEBUFFER,yt)&&Ut&&Ie.drawBuffers(je,yt),Ie.viewport(F),Ie.scissor(M),Ie.setScissorTest(D),an){const Pn=ve.get(je.texture);ne.framebufferTexture2D(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_CUBE_MAP_POSITIVE_X+vt,Pn.__webglTexture,It)}else if(In){const Pn=ve.get(je.texture),tr=vt;ne.framebufferTextureLayer(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,Pn.__webglTexture,It,tr)}else if(je!==null&&It!==0){const Pn=ve.get(je.texture);ne.framebufferTexture2D(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_2D,Pn.__webglTexture,It)}L=-1},this.readRenderTargetPixels=function(je,vt,It,Ut,yt,an,In){if(!(je&&je.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let _n=ve.get(je).__webglFramebuffer;if(je.isWebGLCubeRenderTarget&&In!==void 0&&(_n=_n[In]),_n){Ie.bindFramebuffer(ne.FRAMEBUFFER,_n);try{const Pn=je.texture,tr=Pn.format,fr=Pn.type;if(!De.textureFormatReadable(tr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!De.textureTypeReadable(fr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}vt>=0&&vt<=je.width-Ut&&It>=0&&It<=je.height-yt&&ne.readPixels(vt,It,Ut,yt,ye.convert(tr),ye.convert(fr),an)}finally{const Pn=k!==null?ve.get(k).__webglFramebuffer:null;Ie.bindFramebuffer(ne.FRAMEBUFFER,Pn)}}},this.readRenderTargetPixelsAsync=async function(je,vt,It,Ut,yt,an,In){if(!(je&&je.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let _n=ve.get(je).__webglFramebuffer;if(je.isWebGLCubeRenderTarget&&In!==void 0&&(_n=_n[In]),_n)if(vt>=0&&vt<=je.width-Ut&&It>=0&&It<=je.height-yt){Ie.bindFramebuffer(ne.FRAMEBUFFER,_n);const Pn=je.texture,tr=Pn.format,fr=Pn.type;if(!De.textureFormatReadable(tr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!De.textureTypeReadable(fr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Cn=ne.createBuffer();ne.bindBuffer(ne.PIXEL_PACK_BUFFER,Cn),ne.bufferData(ne.PIXEL_PACK_BUFFER,an.byteLength,ne.STREAM_READ),ne.readPixels(vt,It,Ut,yt,ye.convert(tr),ye.convert(fr),0);const yr=k!==null?ve.get(k).__webglFramebuffer:null;Ie.bindFramebuffer(ne.FRAMEBUFFER,yr);const Hr=ne.fenceSync(ne.SYNC_GPU_COMMANDS_COMPLETE,0);return ne.flush(),await ace(ne,Hr,4),ne.bindBuffer(ne.PIXEL_PACK_BUFFER,Cn),ne.getBufferSubData(ne.PIXEL_PACK_BUFFER,0,an),ne.deleteBuffer(Cn),ne.deleteSync(Hr),an}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(je,vt=null,It=0){const Ut=Math.pow(2,-It),yt=Math.floor(je.image.width*Ut),an=Math.floor(je.image.height*Ut),In=vt!==null?vt.x:0,_n=vt!==null?vt.y:0;we.setTexture2D(je,0),ne.copyTexSubImage2D(ne.TEXTURE_2D,It,0,0,In,_n,yt,an),Ie.unbindTexture()};const is=ne.createFramebuffer(),ss=ne.createFramebuffer();this.copyTextureToTexture=function(je,vt,It=null,Ut=null,yt=0,an=null){an===null&&(yt!==0?(uk("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),an=yt,yt=0):an=0);let In,_n,Pn,tr,fr,Cn,yr,Hr,ds;const Lr=je.isCompressedTexture?je.mipmaps[an]:je.image;if(It!==null)In=It.max.x-It.min.x,_n=It.max.y-It.min.y,Pn=It.isBox3?It.max.z-It.min.z:1,tr=It.min.x,fr=It.min.y,Cn=It.isBox3?It.min.z:0;else{const Pi=Math.pow(2,-yt);In=Math.floor(Lr.width*Pi),_n=Math.floor(Lr.height*Pi),je.isDataArrayTexture?Pn=Lr.depth:je.isData3DTexture?Pn=Math.floor(Lr.depth*Pi):Pn=1,tr=0,fr=0,Cn=0}Ut!==null?(yr=Ut.x,Hr=Ut.y,ds=Ut.z):(yr=0,Hr=0,ds=0);const Gr=ye.convert(vt.format),ar=ye.convert(vt.type);let br;vt.isData3DTexture?(we.setTexture3D(vt,0),br=ne.TEXTURE_3D):vt.isDataArrayTexture||vt.isCompressedArrayTexture?(we.setTexture2DArray(vt,0),br=ne.TEXTURE_2D_ARRAY):(we.setTexture2D(vt,0),br=ne.TEXTURE_2D),ne.pixelStorei(ne.UNPACK_FLIP_Y_WEBGL,vt.flipY),ne.pixelStorei(ne.UNPACK_PREMULTIPLY_ALPHA_WEBGL,vt.premultiplyAlpha),ne.pixelStorei(ne.UNPACK_ALIGNMENT,vt.unpackAlignment);const Un=ne.getParameter(ne.UNPACK_ROW_LENGTH),bi=ne.getParameter(ne.UNPACK_IMAGE_HEIGHT),ai=ne.getParameter(ne.UNPACK_SKIP_PIXELS),Rs=ne.getParameter(ne.UNPACK_SKIP_ROWS),lo=ne.getParameter(ne.UNPACK_SKIP_IMAGES);ne.pixelStorei(ne.UNPACK_ROW_LENGTH,Lr.width),ne.pixelStorei(ne.UNPACK_IMAGE_HEIGHT,Lr.height),ne.pixelStorei(ne.UNPACK_SKIP_PIXELS,tr),ne.pixelStorei(ne.UNPACK_SKIP_ROWS,fr),ne.pixelStorei(ne.UNPACK_SKIP_IMAGES,Cn);const Ri=je.isDataArrayTexture||je.isData3DTexture,Mn=vt.isDataArrayTexture||vt.isData3DTexture;if(je.isDepthTexture){const Pi=ve.get(je),Xn=ve.get(vt),ps=ve.get(Pi.__renderTarget),al=ve.get(Xn.__renderTarget);Ie.bindFramebuffer(ne.READ_FRAMEBUFFER,ps.__webglFramebuffer),Ie.bindFramebuffer(ne.DRAW_FRAMEBUFFER,al.__webglFramebuffer);for(let ms=0;ms<Pn;ms++)Ri&&(ne.framebufferTextureLayer(ne.READ_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ve.get(je).__webglTexture,yt,Cn+ms),ne.framebufferTextureLayer(ne.DRAW_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ve.get(vt).__webglTexture,an,ds+ms)),ne.blitFramebuffer(tr,fr,In,_n,yr,Hr,In,_n,ne.DEPTH_BUFFER_BIT,ne.NEAREST);Ie.bindFramebuffer(ne.READ_FRAMEBUFFER,null),Ie.bindFramebuffer(ne.DRAW_FRAMEBUFFER,null)}else if(yt!==0||je.isRenderTargetTexture||ve.has(je)){const Pi=ve.get(je),Xn=ve.get(vt);Ie.bindFramebuffer(ne.READ_FRAMEBUFFER,is),Ie.bindFramebuffer(ne.DRAW_FRAMEBUFFER,ss);for(let ps=0;ps<Pn;ps++)Ri?ne.framebufferTextureLayer(ne.READ_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,Pi.__webglTexture,yt,Cn+ps):ne.framebufferTexture2D(ne.READ_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_2D,Pi.__webglTexture,yt),Mn?ne.framebufferTextureLayer(ne.DRAW_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,Xn.__webglTexture,an,ds+ps):ne.framebufferTexture2D(ne.DRAW_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_2D,Xn.__webglTexture,an),yt!==0?ne.blitFramebuffer(tr,fr,In,_n,yr,Hr,In,_n,ne.COLOR_BUFFER_BIT,ne.NEAREST):Mn?ne.copyTexSubImage3D(br,an,yr,Hr,ds+ps,tr,fr,In,_n):ne.copyTexSubImage2D(br,an,yr,Hr,tr,fr,In,_n);Ie.bindFramebuffer(ne.READ_FRAMEBUFFER,null),Ie.bindFramebuffer(ne.DRAW_FRAMEBUFFER,null)}else Mn?je.isDataTexture||je.isData3DTexture?ne.texSubImage3D(br,an,yr,Hr,ds,In,_n,Pn,Gr,ar,Lr.data):vt.isCompressedArrayTexture?ne.compressedTexSubImage3D(br,an,yr,Hr,ds,In,_n,Pn,Gr,Lr.data):ne.texSubImage3D(br,an,yr,Hr,ds,In,_n,Pn,Gr,ar,Lr):je.isDataTexture?ne.texSubImage2D(ne.TEXTURE_2D,an,yr,Hr,In,_n,Gr,ar,Lr.data):je.isCompressedTexture?ne.compressedTexSubImage2D(ne.TEXTURE_2D,an,yr,Hr,Lr.width,Lr.height,Gr,Lr.data):ne.texSubImage2D(ne.TEXTURE_2D,an,yr,Hr,In,_n,Gr,ar,Lr);ne.pixelStorei(ne.UNPACK_ROW_LENGTH,Un),ne.pixelStorei(ne.UNPACK_IMAGE_HEIGHT,bi),ne.pixelStorei(ne.UNPACK_SKIP_PIXELS,ai),ne.pixelStorei(ne.UNPACK_SKIP_ROWS,Rs),ne.pixelStorei(ne.UNPACK_SKIP_IMAGES,lo),an===0&&vt.generateMipmaps&&ne.generateMipmap(br),Ie.unbindTexture()},this.copyTextureToTexture3D=function(je,vt,It=null,Ut=null,yt=0){return uk('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(je,vt,It,Ut,yt)},this.initRenderTarget=function(je){ve.get(je).__webglFramebuffer===void 0&&we.setupRenderTarget(je)},this.initTexture=function(je){je.isCubeTexture?we.setTextureCube(je,0):je.isData3DTexture?we.setTexture3D(je,0):je.isDataArrayTexture||je.isCompressedArrayTexture?we.setTexture2DArray(je,0):we.setTexture2D(je,0),Ie.unbindTexture()},this.resetState=function(){A=0,T=0,k=null,Ie.reset(),Ke.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return vg}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=Xi._getDrawingBufferColorSpace(e),n.unpackColorSpace=Xi._getUnpackColorSpace()}}var M3={exports:{}},O3={},I3={exports:{}},N3={};var TF;function Nde(){if(TF)return N3;TF=1;var t=z4();function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,i=t.useEffect,s=t.useLayoutEffect,o=t.useDebugValue;function a(h,f){var d=f(),p=r({inst:{value:d,getSnapshot:f}}),m=p[0].inst,g=p[1];return s(function(){m.value=d,m.getSnapshot=f,c(m)&&g({inst:m})},[h,d,f]),i(function(){return c(m)&&g({inst:m}),h(function(){c(m)&&g({inst:m})})},[h]),o(d),d}function c(h){var f=h.getSnapshot;h=h.value;try{var d=f();return!n(h,d)}catch{return!0}}function l(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:a;return N3.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,N3}var AF;function Pde(){return AF||(AF=1,I3.exports=Nde()),I3.exports}var CF;function Dde(){if(CF)return O3;CF=1;var t=z4(),e=Pde();function n(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:n,i=e.useSyncExternalStore,s=t.useRef,o=t.useEffect,a=t.useMemo,c=t.useDebugValue;return O3.useSyncExternalStoreWithSelector=function(l,u,h,f,d){var p=s(null);if(p.current===null){var m={hasValue:!1,value:null};p.current=m}else m=p.current;p=a(function(){function _(A){if(!y){if(y=!0,v=A,A=f(A),d!==void 0&&m.hasValue){var T=m.value;if(d(T,A))return E=T}return E=A}if(T=E,r(v,A))return T;var k=f(A);return d!==void 0&&d(T,k)?(v=A,T):(v=A,E=k)}var y=!1,v,E,x=h===void 0?null:h;return[function(){return _(u())},x===null?void 0:function(){return _(x())}]},[u,h,f,d]);var g=i(l,p[0],p[1]);return o(function(){m.hasValue=!0,m.value=g},[g]),c(g),g},O3}var RF;function Lde(){return RF||(RF=1,M3.exports=Dde()),M3.exports}var Ude=Lde();const Bde=_u(Ude),kF=t=>{let e;const n=new Set,r=(l,u)=>{const h=typeof l=="function"?l(e):l;if(!Object.is(h,e)){const f=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),n.forEach(d=>d(e,f))}},i=()=>e,a={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(n.add(l),()=>n.delete(l))},c=e=t(r,i,a);return a},wO=(t=>t?kF(t):kF),{useSyncExternalStoreWithSelector:Fde}=Bde,jde=t=>t;function zde(t,e=jde,n){const r=Fde(t.subscribe,t.getState,t.getInitialState,e,n);return ch.useDebugValue(r),r}const MF=(t,e)=>{const n=wO(t),r=(i,s=e)=>zde(n,i,s);return Object.assign(r,n),r},yq=((t,e)=>t?MF(t,e):MF),Vde=t=>typeof t=="object"&&typeof t.then=="function",o1=[];function bq(t,e,n=(r,i)=>r===i){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}function Sq(t,e=null,n=!1,r={}){e===null&&(e=[t]);for(const s of o1)if(bq(e,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=o1.indexOf(i);s!==-1&&o1.splice(s,1)},promise:(Vde(t)?t:t(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(o1.push(i),!n)throw i.promise}const Eq=(t,e,n)=>Sq(t,e,!1,n),Hde=(t,e,n)=>{Sq(t,e,!0,n)},$de=t=>{if(t===void 0||t.length===0)o1.splice(0,o1.length);else{const e=o1.find(n=>bq(t,n.keys,n.equal));e&&e.remove()}};var P3={exports:{}},D3={};var OF;function Gde(){return OF||(OF=1,(function(t){function e(q,G){var K=q.length;q.push(G);e:for(;0<K;){var te=K-1>>>1,re=q[te];if(0<i(re,G))q[te]=G,q[K]=re,K=te;else break e}}function n(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var G=q[0],K=q.pop();if(K!==G){q[0]=K;e:for(var te=0,re=q.length,H=re>>>1;te<H;){var Y=2*(te+1)-1,Z=q[Y],Q=Y+1,ie=q[Q];if(0>i(Z,K))Q<re&&0>i(ie,Z)?(q[te]=ie,q[Q]=K,te=Q):(q[te]=Z,q[Y]=K,te=Y);else if(Q<re&&0>i(ie,K))q[te]=ie,q[Q]=K,te=Q;else break e}}return G}function i(q,G){var K=q.sortIndex-G.sortIndex;return K!==0?K:q.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,f=3,d=!1,p=!1,m=!1,g=!1,_=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;function E(q){for(var G=n(l);G!==null;){if(G.callback===null)r(l);else if(G.startTime<=q)r(l),G.sortIndex=G.expirationTime,e(c,G);else break;G=n(l)}}function x(q){if(m=!1,E(q),!p)if(n(c)!==null)p=!0,A||(A=!0,M());else{var G=n(l);G!==null&&z(x,G.startTime-q)}}var A=!1,T=-1,k=5,L=-1;function I(){return g?!0:!(t.unstable_now()-L<k)}function F(){if(g=!1,A){var q=t.unstable_now();L=q;var G=!0;try{e:{p=!1,m&&(m=!1,y(T),T=-1),d=!0;var K=f;try{t:{for(E(q),h=n(c);h!==null&&!(h.expirationTime>q&&I());){var te=h.callback;if(typeof te=="function"){h.callback=null,f=h.priorityLevel;var re=te(h.expirationTime<=q);if(q=t.unstable_now(),typeof re=="function"){h.callback=re,E(q),G=!0;break t}h===n(c)&&r(c),E(q)}else r(c);h=n(c)}if(h!==null)G=!0;else{var H=n(l);H!==null&&z(x,H.startTime-q),G=!1}}break e}finally{h=null,f=K,d=!1}G=void 0}}finally{G?M():A=!1}}}var M;if(typeof v=="function")M=function(){v(F)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,O=D.port2;D.port1.onmessage=F,M=function(){O.postMessage(null)}}else M=function(){_(F,0)};function z(q,G){T=_(function(){q(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(q){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var K=f;f=G;try{return q()}finally{f=K}},t.unstable_requestPaint=function(){g=!0},t.unstable_runWithPriority=function(q,G){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var K=f;f=q;try{return G()}finally{f=K}},t.unstable_scheduleCallback=function(q,G,K){var te=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?te+K:te):K=te,q){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=K+re,q={id:u++,callback:G,priorityLevel:q,startTime:K,expirationTime:re,sortIndex:-1},K>te?(q.sortIndex=K,e(l,q),n(c)===null&&q===n(l)&&(m?(y(T),T=-1):m=!0,z(x,K-te))):(q.sortIndex=re,e(c,q),p||d||(p=!0,A||(A=!0,M()))),q},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(q){var G=f;return function(){var K=f;f=G;try{return q.apply(this,arguments)}finally{f=K}}}})(D3)),D3}var IF;function Wde(){return IF||(IF=1,P3.exports=Gde()),P3.exports}var eL=Wde();const qde=_u(eL);function xq(t){let e=t.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const wq=t=>t&&t.isOrthographicCamera,Yde=t=>t!=null&&(typeof t=="string"||typeof t=="number"||t.isColor),t5=((t,e)=>typeof window<"u"&&(((t=window.document)==null?void 0:t.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Ye.useLayoutEffect:Ye.useEffect;function Tq(t){const e=Ye.useRef(t);return t5(()=>{e.current=t},[t]),e}function Aq(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}function vS(t){var e;return(e=t.__r3f)==null?void 0:e.root.getState()}const Co={obj:t=>t===Object(t)&&!Co.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,nul:t=>t===null,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(Co.str(t)||Co.num(t)||Co.boo(t))return t===e;const s=Co.obj(t);if(s&&r==="reference")return t===e;const o=Co.arr(t);if(o&&n==="reference")return t===e;if((o||s)&&t===e)return!0;let a;for(a in t)if(!(a in e))return!1;if(s&&n==="shallow"&&r==="shallow"){for(a in i?e:t)if(!Co.equ(t[a],e[a],{strict:i,objects:"reference"}))return!1}else for(a in i?e:t)if(t[a]!==e[a])return!1;if(Co.und(a)){if(o&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function Kde(t){const e={nodes:{},materials:{},meshes:{}};return t&&t.traverse(n=>{n.name&&(e.nodes[n.name]=n),n.material&&!e.materials[n.material.name]&&(e.materials[n.material.name]=n.material),n.isMesh&&!e.meshes[n.name]&&(e.meshes[n.name]=n)}),e}function Xde(t){t.type!=="Scene"&&(t.dispose==null||t.dispose());for(const e in t){const n=t[e];n?.type!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const Cq=["children","key","ref"];function Jde(t){const e={};for(const n in t)Cq.includes(n)||(e[n]=t[n]);return e}function Zk(t,e,n,r){const i=t;let s=i?.__r3f;return s||(s={root:e,type:n,parent:null,children:[],props:Jde(r),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function ZT(t,e){if(!e.includes("-"))return{root:t,key:e,target:t[e]};if(e in t)return{root:t,key:e,target:t[e]};let n=t;const r=e.split("-");for(const i of r){if(typeof n!="object"||n===null){if(n!==void 0){const s=r.slice(r.indexOf(i)).join("-");return{root:n,key:s,target:void 0}}return{root:t,key:e,target:void 0}}e=i,t=n,n=n[e]}return{root:t,key:e,target:n}}const NF=/-\d+$/;function Qk(t,e){if(Co.str(e.props.attach)){if(NF.test(e.props.attach)){const i=e.props.attach.replace(NF,""),{root:s,key:o}=ZT(t.object,i);Array.isArray(s[o])||(s[o]=[])}const{root:n,key:r}=ZT(t.object,e.props.attach);e.previousAttach=n[r],n[r]=e.object}else Co.fun(e.props.attach)&&(e.previousAttach=e.props.attach(t.object,e.object))}function eM(t,e){if(Co.str(e.props.attach)){const{root:n,key:r}=ZT(t.object,e.props.attach),i=e.previousAttach;i===void 0?delete n[r]:n[r]=i}else e.previousAttach==null||e.previousAttach(t.object,e.object);delete e.previousAttach}const tL=[...Cq,"args","dispose","attach","object","onUpdate","dispose"],PF=new Map;function Zde(t){let e=PF.get(t.constructor);try{e||(e=new t.constructor,PF.set(t.constructor,e))}catch{}return e}function Qde(t,e){const n={};for(const r in e)if(!tL.includes(r)&&!Co.equ(e[r],t.props[r])){n[r]=e[r];for(const i in e)i.startsWith(`${r}-`)&&(n[i]=e[i])}for(const r in t.props){if(tL.includes(r)||e.hasOwnProperty(r))continue;const{root:i,key:s}=ZT(t.object,r);if(i.constructor&&i.constructor.length===0){const o=Zde(i);Co.und(o)||(n[s]=o[s])}else n[s]=0}return n}const epe=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],tpe=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function tv(t,e){var n;const r=t.__r3f,i=r&&xq(r).getState(),s=r?.eventCount;for(const a in e){let c=e[a];if(tL.includes(a))continue;if(r&&tpe.test(a)){typeof c=="function"?r.handlers[a]=c:delete r.handlers[a],r.eventCount=Object.keys(r.handlers).length;continue}if(c===void 0)continue;let{root:l,key:u,target:h}=ZT(t,a);if(h===void 0&&(typeof l!="object"||l===null))throw Error(`R3F: Cannot set "${a}". Ensure it is an object before setting "${u}".`);if(h instanceof JT&&c instanceof JT)h.mask=c.mask;else if(h instanceof wi&&Yde(c))h.set(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&c!=null&&c.constructor&&h.constructor===c.constructor)h.copy(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(c))typeof h.fromArray=="function"?h.fromArray(c):h.set(...c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof c=="number")typeof h.setScalar=="function"?h.setScalar(c):h.set(c);else{var o;l[u]=c,i&&!i.linear&&epe.includes(u)&&(o=l[u])!=null&&o.isTexture&&l[u].format===lu&&l[u].type===ko&&(l[u].colorSpace=Bi)}}if(r!=null&&r.parent&&i!=null&&i.internal&&(n=r.object)!=null&&n.isObject3D&&s!==r.eventCount){const a=r.object,c=i.internal.interaction.indexOf(a);c>-1&&i.internal.interaction.splice(c,1),r.eventCount&&a.raycast!==null&&i.internal.interaction.push(a)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&tx(r),t}function tx(t){var e;if(!t.parent)return;t.props.onUpdate==null||t.props.onUpdate(t.object);const n=(e=t.root)==null||e.getState==null?void 0:e.getState();n&&n.internal.frames===0&&n.invalidate()}function Rq(t,e){t.manual||(wq(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix())}const ru=t=>t?.isObject3D;function oR(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function kq(t,e,n,r){const i=n.get(e);i&&(n.delete(e),n.size===0&&(t.delete(r),i.target.releasePointerCapture(r)))}function npe(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(r=>r!==e),n.initialHits=n.initialHits.filter(r=>r!==e),n.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&n.hovered.delete(i)}),n.capturedMap.forEach((r,i)=>{kq(n.capturedMap,e,r,i)})}function rpe(t){function e(c){const{internal:l}=t.getState(),u=c.offsetX-l.initialClick[0],h=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function n(c){return c.filter(l=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=l.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(c,l){const u=t.getState(),h=new Set,f=[],d=l?l(u.internal.interaction):u.internal.interaction;for(let _=0;_<d.length;_++){const y=vS(d[_]);y&&(y.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(c,u);function p(_){const y=vS(_);if(!y||!y.events.enabled||y.raycaster.camera===null)return[];if(y.raycaster.camera===void 0){var v;y.events.compute==null||y.events.compute(c,y,(v=y.previousRoot)==null?void 0:v.getState()),y.raycaster.camera===void 0&&(y.raycaster.camera=null)}return y.raycaster.camera?y.raycaster.intersectObject(_,!0):[]}let m=d.flatMap(p).sort((_,y)=>{const v=vS(_.object),E=vS(y.object);return!v||!E?_.distance-y.distance:E.events.priority-v.events.priority||_.distance-y.distance}).filter(_=>{const y=oR(_);return h.has(y)?!1:(h.add(y),!0)});u.events.filter&&(m=u.events.filter(m,u));for(const _ of m){let y=_.object;for(;y;){var g;(g=y.__r3f)!=null&&g.eventCount&&f.push({..._,eventObject:y}),y=y.parent}}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(let _ of u.internal.capturedMap.get(c.pointerId).values())h.has(oR(_.intersection))||f.push(_.intersection);return f}function i(c,l,u,h){if(c.length){const f={stopped:!1};for(const d of c){let p=vS(d.object);if(p||d.object.traverseAncestors(m=>{const g=vS(m);if(g)return p=g,!1}),p){const{raycaster:m,pointer:g,camera:_,internal:y}=p,v=new zt(g.x,g.y,0).unproject(_),E=L=>{var I,F;return(I=(F=y.capturedMap.get(L))==null?void 0:F.has(d.eventObject))!=null?I:!1},x=L=>{const I={intersection:d,target:l.target};y.capturedMap.has(L)?y.capturedMap.get(L).set(d.eventObject,I):y.capturedMap.set(L,new Map([[d.eventObject,I]])),l.target.setPointerCapture(L)},A=L=>{const I=y.capturedMap.get(L);I&&kq(y.capturedMap,d.eventObject,I,L)};let T={};for(let L in l){let I=l[L];typeof I!="function"&&(T[L]=I)}let k={...d,...T,pointer:g,intersections:c,stopped:f.stopped,delta:u,unprojectedPoint:v,ray:m.ray,camera:_,stopPropagation(){const L="pointerId"in l&&y.capturedMap.get(l.pointerId);if((!L||L.has(d.eventObject))&&(k.stopped=f.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(I=>I.eventObject===d.eventObject))){const I=c.slice(0,c.indexOf(d));s([...I,d])}},target:{hasPointerCapture:E,setPointerCapture:x,releasePointerCapture:A},currentTarget:{hasPointerCapture:E,setPointerCapture:x,releasePointerCapture:A},nativeEvent:l};if(h(k),f.stopped===!0)break}}}return c}function s(c){const{internal:l}=t.getState();for(const u of l.hovered.values())if(!c.length||!c.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const f=u.eventObject.__r3f;if(l.hovered.delete(oR(u)),f!=null&&f.eventCount){const d=f.handlers,p={...u,intersections:c};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function o(c,l){for(let u=0;u<l.length;u++){const h=l[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(c)}}function a(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return l=>{const{internal:u}=t.getState();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:f}=t.getState();f.lastEvent.current=u;const d=c==="onPointerMove",p=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",g=r(u,d?n:void 0),_=p?e(u):0;c==="onPointerDown"&&(f.initialClick=[u.offsetX,u.offsetY],f.initialHits=g.map(v=>v.eventObject)),p&&!g.length&&_<=2&&(o(u,f.interaction),h&&h(u)),d&&s(g);function y(v){const E=v.eventObject,x=E.__r3f;if(!(x!=null&&x.eventCount))return;const A=x.handlers;if(d){if(A.onPointerOver||A.onPointerEnter||A.onPointerOut||A.onPointerLeave){const T=oR(v),k=f.hovered.get(T);k?k.stopped&&v.stopPropagation():(f.hovered.set(T,v),A.onPointerOver==null||A.onPointerOver(v),A.onPointerEnter==null||A.onPointerEnter(v))}A.onPointerMove==null||A.onPointerMove(v)}else{const T=A[c];T?(!p||f.initialHits.includes(E))&&(o(u,f.interaction.filter(k=>!f.initialHits.includes(k))),T(v)):p&&f.initialHits.includes(E)&&o(u,f.interaction.filter(k=>!f.initialHits.includes(k)))}}i(g,u,_,y)}}return{handlePointer:a}}const DF=t=>!!(t!=null&&t.render),n5=Ye.createContext(null),ipe=(t,e)=>{const n=yq((a,c)=>{const l=new zt,u=new zt,h=new zt;function f(_=c().camera,y=u,v=c().size){const{width:E,height:x,top:A,left:T}=v,k=E/x;y.isVector3?h.copy(y):h.set(...y);const L=_.getWorldPosition(l).distanceTo(h);if(wq(_))return{width:E/_.zoom,height:x/_.zoom,top:A,left:T,factor:1,distance:L,aspect:k};{const I=_.fov*Math.PI/180,F=2*Math.tan(I/2)*L,M=F*(E/x);return{width:M,height:F,top:A,left:T,factor:E/M,distance:L,aspect:k}}}let d;const p=_=>a(y=>({performance:{...y.performance,current:_}})),m=new zn;return{set:a,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(_=1)=>t(c(),_),advance:(_,y)=>e(_,y,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Yce,pointer:m,mouse:m,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const _=c();d&&clearTimeout(d),_.performance.current!==_.performance.min&&p(_.performance.min),d=setTimeout(()=>p(c().performance.max),_.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:_=>a(y=>({...y,events:{...y.events,..._}})),setSize:(_,y,v=0,E=0)=>{const x=c().camera,A={width:_,height:y,top:v,left:E};a(T=>({size:A,viewport:{...T.viewport,...f(x,u,A)}}))},setDpr:_=>a(y=>{const v=Aq(_);return{viewport:{...y.viewport,dpr:v,initialDpr:y.viewport.initialDpr||v}}}),setFrameloop:(_="always")=>{const y=c().clock;y.stop(),y.elapsedTime=0,_!=="never"&&(y.start(),y.elapsedTime=0),a(()=>({frameloop:_}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Ye.createRef(),active:!1,frames:0,priority:0,subscribe:(_,y,v)=>{const E=c().internal;return E.priority=E.priority+(y>0?1:0),E.subscribers.push({ref:_,priority:y,store:v}),E.subscribers=E.subscribers.sort((x,A)=>x.priority-A.priority),()=>{const x=c().internal;x!=null&&x.subscribers&&(x.priority=x.priority-(y>0?1:0),x.subscribers=x.subscribers.filter(A=>A.ref!==_))}}}}}),r=n.getState();let i=r.size,s=r.viewport.dpr,o=r.camera;return n.subscribe(()=>{const{camera:a,size:c,viewport:l,gl:u,set:h}=n.getState();if(c.width!==i.width||c.height!==i.height||l.dpr!==s){i=c,s=l.dpr,Rq(a,c),l.dpr>0&&u.setPixelRatio(l.dpr);const f=typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(c.width,c.height,f)}a!==o&&(o=a,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(a)}})))}),n.subscribe(a=>t(a)),n};function r5(){const t=Ye.useContext(n5);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function Dc(t=n=>n,e){return r5()(t,e)}function Dg(t,e=0){const n=r5(),r=n.getState().internal.subscribe,i=Tq(t);return t5(()=>r(i,e,n),[e,r,n]),null}const LF=new WeakMap,spe=t=>{var e;return typeof t=="function"&&(t==null||(e=t.prototype)==null?void 0:e.constructor)===t};function Mq(t,e){return function(n,...r){let i;return spe(n)?(i=LF.get(n),i||(i=new n,LF.set(n,i))):i=n,t&&t(i),Promise.all(r.map(s=>new Promise((o,a)=>i.load(s,c=>{ru(c?.scene)&&Object.assign(c,Kde(c.scene)),o(c)},e,c=>a(new Error(`Could not load ${s}: ${c?.message}`))))))}}function i5(t,e,n,r){const i=Array.isArray(e)?e:[e],s=Eq(Mq(n,r),[t,...i],{equal:Co.equ});return Array.isArray(e)?s:s[0]}i5.preload=function(t,e,n){const r=Array.isArray(e)?e:[e];return Hde(Mq(n),[t,...r])};i5.clear=function(t,e){const n=Array.isArray(e)?e:[e];return $de([t,...n])};const ope=1,ape=8,cpe=32,lpe=2;var upe={version:"9.5.0"};function hpe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var UF={exports:{}},BF={exports:{}},FF;function fpe(){return FF||(FF=1,(function(t){t.exports=function(e){function n(b,S,N,V){return new bd(b,S,N,V)}function r(){}function i(b){var S="https://react.dev/errors/"+b;if(1<arguments.length){S+="?args[]="+encodeURIComponent(arguments[1]);for(var N=2;N<arguments.length;N++)S+="&args[]="+encodeURIComponent(arguments[N])}return"Minified React error #"+b+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(b){var S=b,N=b;if(b.alternate)for(;S.return;)S=S.return;else{b=S;do S=b,(S.flags&4098)!==0&&(N=S.return),b=S.return;while(b)}return S.tag===3?N:null}function o(b){if(s(b)!==b)throw Error(i(188))}function a(b){var S=b.alternate;if(!S){if(S=s(b),S===null)throw Error(i(188));return S!==b?null:b}for(var N=b,V=S;;){var ee=N.return;if(ee===null)break;var le=ee.alternate;if(le===null){if(V=ee.return,V!==null){N=V;continue}break}if(ee.child===le.child){for(le=ee.child;le;){if(le===N)return o(ee),b;if(le===V)return o(ee),S;le=le.sibling}throw Error(i(188))}if(N.return!==V.return)N=ee,V=le;else{for(var Ne=!1,Qe=ee.child;Qe;){if(Qe===N){Ne=!0,N=ee,V=le;break}if(Qe===V){Ne=!0,V=ee,N=le;break}Qe=Qe.sibling}if(!Ne){for(Qe=le.child;Qe;){if(Qe===N){Ne=!0,N=le,V=ee;break}if(Qe===V){Ne=!0,V=le,N=ee;break}Qe=Qe.sibling}if(!Ne)throw Error(i(189))}}if(N.alternate!==V)throw Error(i(190))}if(N.tag!==3)throw Error(i(188));return N.stateNode.current===N?b:S}function c(b){var S=b.tag;if(S===5||S===26||S===27||S===6)return b;for(b=b.child;b!==null;){if(S=c(b),S!==null)return S;b=b.sibling}return null}function l(b){var S=b.tag;if(S===5||S===26||S===27||S===6)return b;for(b=b.child;b!==null;){if(b.tag!==4&&(S=l(b),S!==null))return S;b=b.sibling}return null}function u(b){return b===null||typeof b!="object"?null:(b=wd&&b[wd]||b["@@iterator"],typeof b=="function"?b:null)}function h(b){if(b==null)return null;if(typeof b=="function")return b.$$typeof===Jv?null:b.displayName||b.name||null;if(typeof b=="string")return b;switch(b){case Sd:return"Fragment";case A0:return"Profiler";case Ed:return"StrictMode";case Tf:return"Suspense";case Nu:return"SuspenseList";case Up:return"Activity"}if(typeof b=="object")switch(b.$$typeof){case Iu:return"Portal";case Xs:return b.displayName||"Context";case m_:return(b._context.displayName||"Context")+".Consumer";case Ec:var S=b.render;return b=b.displayName,b||(b=S.displayName||S.name||"",b=b!==""?"ForwardRef("+b+")":"ForwardRef"),b;case Lp:return S=b.displayName||null,S!==null?S:h(b.type)||"Memo";case Pu:S=b._payload,b=b._init;try{return h(b(S))}catch{}}return null}function f(b){return{current:b}}function d(b){0>zu||(b.current=H0[zu],H0[zu]=null,zu--)}function p(b,S){zu++,H0[zu]=b.current,b.current=S}function m(b){return b>>>=0,b===0?32:31-(Vu(b)/R_|0)|0}function g(b){var S=b&42;if(S!==0)return S;switch(b&-b){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return b&261888;case 262144:case 524288:case 1048576:case 2097152:return b&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return b&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return b}}function _(b,S,N){var V=b.pendingLanes;if(V===0)return 0;var ee=0,le=b.suspendedLanes,Ne=b.pingedLanes;b=b.warmLanes;var Qe=V&134217727;return Qe!==0?(V=Qe&~le,V!==0?ee=g(V):(Ne&=Qe,Ne!==0?ee=g(Ne):N||(N=Qe&~b,N!==0&&(ee=g(N))))):(Qe=V&~le,Qe!==0?ee=g(Qe):Ne!==0?ee=g(Ne):N||(N=V&~b,N!==0&&(ee=g(N)))),ee===0?0:S!==0&&S!==ee&&(S&le)===0&&(le=ee&-ee,N=S&-S,le>=N||le===32&&(N&4194048)!==0)?S:ee}function y(b,S){return(b.pendingLanes&~(b.suspendedLanes&~b.pingedLanes)&S)===0}function v(b,S){switch(b){case 1:case 2:case 4:case 8:case 64:return S+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function E(){var b=yl;return yl<<=1,(yl&62914560)===0&&(yl=4194304),b}function x(b){for(var S=[],N=0;31>N;N++)S.push(b);return S}function A(b,S){b.pendingLanes|=S,S!==268435456&&(b.suspendedLanes=0,b.pingedLanes=0,b.warmLanes=0)}function T(b,S,N,V,ee,le){var Ne=b.pendingLanes;b.pendingLanes=N,b.suspendedLanes=0,b.pingedLanes=0,b.warmLanes=0,b.expiredLanes&=N,b.entangledLanes&=N,b.errorRecoveryDisabledLanes&=N,b.shellSuspendCounter=0;var Qe=b.entanglements,St=b.expirationTimes,Lt=b.hiddenUpdates;for(N=Ne&~N;0<N;){var Kt=31-Ss(N),Xt=1<<Kt;Qe[Kt]=0,St[Kt]=-1;var vn=Lt[Kt];if(vn!==null)for(Lt[Kt]=null,Kt=0;Kt<vn.length;Kt++){var Zn=vn[Kt];Zn!==null&&(Zn.lane&=-536870913)}N&=~Xt}V!==0&&k(b,V,0),le!==0&&ee===0&&b.tag!==0&&(b.suspendedLanes|=le&~(Ne&~S))}function k(b,S,N){b.pendingLanes|=S,b.suspendedLanes&=~S;var V=31-Ss(S);b.entangledLanes|=S,b.entanglements[V]=b.entanglements[V]|1073741824|N&261930}function L(b,S){var N=b.entangledLanes|=S;for(b=b.entanglements;N;){var V=31-Ss(N),ee=1<<V;ee&S|b[V]&S&&(b[V]|=S),N&=~ee}}function I(b,S){var N=S&-S;return N=(N&42)!==0?1:F(N),(N&(b.suspendedLanes|S))!==0?0:N}function F(b){switch(b){case 2:b=1;break;case 8:b=4;break;case 32:b=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:b=128;break;case 268435456:b=134217728;break;default:b=0}return b}function M(b){return b&=-b,2<b?8<b?(b&134217727)!==0?32:268435456:8:2}function D(b){if(typeof Lx=="function"&&Ux(b),Za&&typeof Za.setStrictMode=="function")try{Za.setStrictMode(W0,b)}catch{}}function O(b,S){return b===S&&(b!==0||1/b===1/S)||b!==b&&S!==S}function z(b){if(py===void 0)try{throw Error()}catch(N){var S=N.stack.trim().match(/\n( *(at )?)/);py=S&&S[1]||"",To=-1<N.stack.indexOf(`
    at`)?" (<anonymous>)":-1<N.stack.indexOf("@")?"@unknown:0:0":""}return`
`+py+b+To}function q(b,S){if(!b||Lo)return"";Lo=!0;var N=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var V={DetermineComponentFrameRoot:function(){try{if(S){var Xt=function(){throw Error()};if(Object.defineProperty(Xt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Xt,[])}catch(Zn){var vn=Zn}Reflect.construct(b,[],Xt)}else{try{Xt.call()}catch(Zn){vn=Zn}b.call(Xt.prototype)}}else{try{throw Error()}catch(Zn){vn=Zn}(Xt=b())&&typeof Xt.catch=="function"&&Xt.catch(function(){})}}catch(Zn){if(Zn&&vn&&typeof Zn.stack=="string")return[Zn.stack,vn.stack]}return[null,null]}};V.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var ee=Object.getOwnPropertyDescriptor(V.DetermineComponentFrameRoot,"name");ee&&ee.configurable&&Object.defineProperty(V.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var le=V.DetermineComponentFrameRoot(),Ne=le[0],Qe=le[1];if(Ne&&Qe){var St=Ne.split(`
`),Lt=Qe.split(`
`);for(ee=V=0;V<St.length&&!St[V].includes("DetermineComponentFrameRoot");)V++;for(;ee<Lt.length&&!Lt[ee].includes("DetermineComponentFrameRoot");)ee++;if(V===St.length||ee===Lt.length)for(V=St.length-1,ee=Lt.length-1;1<=V&&0<=ee&&St[V]!==Lt[ee];)ee--;for(;1<=V&&0<=ee;V--,ee--)if(St[V]!==Lt[ee]){if(V!==1||ee!==1)do if(V--,ee--,0>ee||St[V]!==Lt[ee]){var Kt=`
`+St[V].replace(" at new "," at ");return b.displayName&&Kt.includes("<anonymous>")&&(Kt=Kt.replace("<anonymous>",b.displayName)),Kt}while(1<=V&&0<=ee);break}}}finally{Lo=!1,Error.prepareStackTrace=N}return(N=b?b.displayName||b.name:"")?z(N):""}function G(b,S){switch(b.tag){case 26:case 27:case 5:return z(b.type);case 16:return z("Lazy");case 13:return b.child!==S&&S!==null?z("Suspense Fallback"):z("Suspense");case 19:return z("SuspenseList");case 0:case 15:return q(b.type,!1);case 11:return q(b.type.render,!1);case 1:return q(b.type,!0);case 31:return z("Activity");default:return""}}function K(b){try{var S="",N=null;do S+=G(b,N),N=b,b=b.return;while(b);return S}catch(V){return`
Error generating stack: `+V.message+`
`+V.stack}}function te(b,S){if(typeof b=="object"&&b!==null){var N=ec.get(b);return N!==void 0?N:(S={value:b,source:S,stack:K(S)},ec.set(b,S),S)}return{value:b,source:S,stack:K(S)}}function re(b,S){ia[Oi++]=kd,ia[Oi++]=M_,M_=b,kd=S}function H(b,S,N){qc[xc++]=Hu,qc[xc++]=ql,qc[xc++]=wc,wc=b;var V=Hu;b=ql;var ee=32-Ss(V)-1;V&=~(1<<ee),N+=1;var le=32-Ss(S)+ee;if(30<le){var Ne=ee-ee%5;le=(V&(1<<Ne)-1).toString(32),V>>=Ne,ee-=Ne,Hu=1<<32-Ss(S)+ee|N<<ee|V,ql=le+b}else Hu=1<<le|N<<ee|V,ql=b}function Y(b){b.return!==null&&(re(b,1),H(b,1,0))}function Z(b){for(;b===M_;)M_=ia[--Oi],ia[Oi]=null,kd=ia[--Oi],ia[Oi]=null;for(;b===wc;)wc=qc[--xc],qc[xc]=null,ql=qc[--xc],qc[xc]=null,Hu=qc[--xc],qc[xc]=null}function Q(b,S){qc[xc++]=Hu,qc[xc++]=ql,qc[xc++]=wc,Hu=S.id,ql=S.overflow,wc=b}function ie(b,S){p(Mf,S),p(q0,b),p(sa,null),b=g_(S),d(sa),p(sa,b)}function ge(){d(sa),d(q0),d(Mf)}function Te(b){b.memoizedState!==null&&p(O_,b);var S=sa.current,N=R0(S,b.type);S!==N&&(p(q0,b),p(sa,N))}function be(b){q0.current===b&&(d(sa),d(q0)),O_.current===b&&(d(O_),Ba?Lh._currentValue=gl:Lh._currentValue2=gl)}function Pe(b){var S=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Le(te(S,b)),Of}function Ge(b,S){if(!gi)throw Error(i(175));Ix(b.stateNode,b.type,b.memoizedProps,S,b)||Pe(b,!0)}function Ze(b){for(Uo=b.return;Uo;)switch(Uo.tag){case 5:case 31:case 13:Yc=!1;return;case 27:case 3:Yc=!0;return;default:Uo=Uo.return}}function lt(b){if(!gi||b!==Uo)return!1;if(!_i)return Ze(b),_i=!0,!1;var S=b.tag;if(Gs?S!==3&&S!==27&&(S!==5||Do(b.type)&&!Fp(b.type,b.memoizedProps))&&li&&Pe(b):S!==3&&(S!==5||Do(b.type)&&!Fp(b.type,b.memoizedProps))&&li&&Pe(b),Ze(b),S===13){if(!gi)throw Error(i(316));if(b=b.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));li=Vb(b)}else if(S===31){if(b=b.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));li=zb(b)}else li=Gs&&S===27?$p(b.type,li):Uo?Hp(b.stateNode):null;return!0}function pt(){gi&&(li=Uo=null,_i=!1)}function ne(){var b=Yl;return b!==null&&(ue===null?ue=b:ue.push.apply(ue,b),Yl=null),b}function Le(b){Yl===null?Yl=[b]:Yl.push(b)}function Ve(b,S,N){Ba?(p(oa,S._currentValue),S._currentValue=N):(p(oa,S._currentValue2),S._currentValue2=N)}function De(b){var S=oa.current;Ba?b._currentValue=S:b._currentValue2=S,d(oa)}function Ie(b,S,N){for(;b!==null;){var V=b.alternate;if((b.childLanes&S)!==S?(b.childLanes|=S,V!==null&&(V.childLanes|=S)):V!==null&&(V.childLanes&S)!==S&&(V.childLanes|=S),b===N)break;b=b.return}}function ae(b,S,N,V){var ee=b.child;for(ee!==null&&(ee.return=b);ee!==null;){var le=ee.dependencies;if(le!==null){var Ne=ee.child;le=le.firstContext;e:for(;le!==null;){var Qe=le;le=ee;for(var St=0;St<S.length;St++)if(Qe.context===S[St]){le.lanes|=N,Qe=le.alternate,Qe!==null&&(Qe.lanes|=N),Ie(le.return,N,b),V||(Ne=null);break e}le=Qe.next}}else if(ee.tag===18){if(Ne=ee.return,Ne===null)throw Error(i(341));Ne.lanes|=N,le=Ne.alternate,le!==null&&(le.lanes|=N),Ie(Ne,N,b),Ne=null}else Ne=ee.child;if(Ne!==null)Ne.return=ee;else for(Ne=ee;Ne!==null;){if(Ne===b){Ne=null;break}if(ee=Ne.sibling,ee!==null){ee.return=Ne.return,Ne=ee;break}Ne=Ne.return}ee=Ne}}function ve(b,S,N,V){b=null;for(var ee=S,le=!1;ee!==null;){if(!le){if((ee.flags&524288)!==0)le=!0;else if((ee.flags&262144)!==0)break}if(ee.tag===10){var Ne=ee.alternate;if(Ne===null)throw Error(i(387));if(Ne=Ne.memoizedProps,Ne!==null){var Qe=ee.type;Qa(ee.pendingProps.value,Ne.value)||(b!==null?b.push(Qe):b=[Qe])}}else if(ee===O_.current){if(Ne=ee.alternate,Ne===null)throw Error(i(387));Ne.memoizedState.memoizedState!==ee.memoizedState.memoizedState&&(b!==null?b.push(Lh):b=[Lh])}ee=ee.return}b!==null&&ae(S,b,N,V),S.flags|=262144}function we(b){for(b=b.firstContext;b!==null;){var S=b.context;if(!Qa(Ba?S._currentValue:S._currentValue2,b.memoizedValue))return!0;b=b.next}return!1}function pe(b){zh=b,$u=null,b=b.dependencies,b!==null&&(b.firstContext=null)}function ze(b){return Xe(zh,b)}function Je(b,S){return zh===null&&pe(b),Xe(b,S)}function Xe(b,S){var N=Ba?S._currentValue:S._currentValue2;if(S={context:S,memoizedValue:N,next:null},$u===null){if(b===null)throw Error(i(308));$u=S,b.dependencies={lanes:0,firstContext:S},b.flags|=524288}else $u=$u.next=S;return N}function tt(){return{controller:new Kb,data:new Map,refCount:0}}function Nt(b){b.refCount--,b.refCount===0&&_s(I_,function(){b.controller.abort()})}function gt(){}function wt(b){b!==Es&&b.next===null&&(Es===null?N_=Es=b:Es=Es.next=b),Y0=!0,Vh||(Vh=!0,Se())}function Re(b,S){if(!P_&&Y0){P_=!0;do for(var N=!1,V=N_;V!==null;){if(b!==0){var ee=V.pendingLanes;if(ee===0)var le=0;else{var Ne=V.suspendedLanes,Qe=V.pingedLanes;le=(1<<31-Ss(42|b)+1)-1,le&=ee&~(Ne&~Qe),le=le&201326741?le&201326741|1:le?le|2:0}le!==0&&(N=!0,Ce(V,le))}else le=Ei,le=_(V,V===ws?le:0,V.cancelPendingCommit!==null||V.timeoutHandle!==ta),(le&3)===0||y(V,le)||(N=!0,Ce(V,le));V=V.next}while(N);P_=!1}}function se(){W()}function W(){Y0=Vh=!1;var b=0;Md!==0&&y_()&&(b=Md);for(var S=Fr(),N=null,V=N_;V!==null;){var ee=V.next,le=oe(V,S);le===0?(V.next=null,N===null?N_=ee:N.next=ee,ee===null&&(Es=N)):(N=V,(b!==0||(le&3)!==0)&&(Y0=!0)),V=ee}bt!==0&&bt!==5||Re(b),Md!==0&&(Md=0)}function oe(b,S){for(var N=b.suspendedLanes,V=b.pingedLanes,ee=b.expirationTimes,le=b.pendingLanes&-62914561;0<le;){var Ne=31-Ss(le),Qe=1<<Ne,St=ee[Ne];St===-1?((Qe&N)===0||(Qe&V)!==0)&&(ee[Ne]=v(Qe,S)):St<=S&&(b.expiredLanes|=Qe),le&=~Qe}if(S=ws,N=Ei,N=_(b,b===S?N:0,b.cancelPendingCommit!==null||b.timeoutHandle!==ta),V=b.callbackNode,N===0||b===S&&(cs===2||cs===9)||b.cancelPendingCommit!==null)return V!==null&&V!==null&&k_(V),b.callbackNode=null,b.callbackPriority=0;if((N&3)===0||y(b,N)){if(S=N&-N,S===b.callbackPriority)return S;switch(V!==null&&k_(V),M(N)){case 2:case 8:N=qb;break;case 32:N=Rd;break;case 268435456:N=Dx;break;default:N=Rd}return V=xe.bind(null,b),N=Br(N,V),b.callbackPriority=S,b.callbackNode=N,S}return V!==null&&V!==null&&k_(V),b.callbackPriority=2,b.callbackNode=null,2}function xe(b,S){if(bt!==0&&bt!==5)return b.callbackNode=null,b.callbackPriority=0,null;var N=b.callbackNode;if(Nh()&&b.callbackNode!==N)return null;var V=Ei;return V=_(b,b===ws?V:0,b.cancelPendingCommit!==null||b.timeoutHandle!==ta),V===0?null:(Is(b,V,S),oe(b,Fr()),b.callbackNode!=null&&b.callbackNode===N?xe.bind(null,b):null)}function Ce(b,S){if(Nh())return null;Is(b,S,!0)}function Se(){Af?Uu(function(){(Yr&6)!==0?Br(Wb,se):W()}):Br(Wb,se)}function ye(){if(Md===0){var b=Gu;b===0&&(b=$0,$0<<=1,($0&261888)===0&&($0=256)),Md=b}return Md}function Ke(b,S){if(Wp===null){var N=Wp=[];my=0,Gu=ye(),xs={status:"pending",value:void 0,then:function(V){N.push(V)}}}return my++,S.then(ke,ke),S}function ke(){if(--my===0&&Wp!==null){xs!==null&&(xs.status="fulfilled");var b=Wp;Wp=null,Gu=0,xs=null;for(var S=0;S<b.length;S++)(0,b[S])()}}function He(b,S){var N=[],V={status:"pending",value:null,reason:null,then:function(ee){N.push(ee)}};return b.then(function(){V.status="fulfilled",V.value=S;for(var ee=0;ee<N.length;ee++)(0,N[ee])(S)},function(ee){for(V.status="rejected",V.reason=ee,ee=0;ee<N.length;ee++)(0,N[ee])(void 0)}),V}function Fe(){var b=Ds.current;return b!==null?b:ws.pooledCache}function We(b,S){S===null?p(Ds,Ds.current):p(Ds,S.pool)}function at(){var b=Fe();return b===null?null:{parent:Ba?Ps._currentValue:Ps._currentValue2,pool:b}}function Be(b,S){if(Qa(b,S))return!0;if(typeof b!="object"||b===null||typeof S!="object"||S===null)return!1;var N=Object.keys(b),V=Object.keys(S);if(N.length!==V.length)return!1;for(V=0;V<N.length;V++){var ee=N[V];if(!Bx.call(S,ee)||!Qa(b[ee],S[ee]))return!1}return!0}function nt(b){return b=b.status,b==="fulfilled"||b==="rejected"}function it(b,S,N){switch(N=b[N],N===void 0?b.push(S):N!==S&&(S.then(gt,gt),S=N),S.status){case"fulfilled":return S.value;case"rejected":throw b=S.reason,tn(b),b;default:if(typeof S.status=="string")S.then(gt,gt);else{if(b=ws,b!==null&&100<b.shellSuspendCounter)throw Error(i(482));b=S,b.status="pending",b.then(function(V){if(S.status==="pending"){var ee=S;ee.status="fulfilled",ee.value=V}},function(V){if(S.status==="pending"){var ee=S;ee.status="rejected",ee.reason=V}})}switch(S.status){case"fulfilled":return S.value;case"rejected":throw b=S.reason,tn(b),b}throw Qs=S,Tc}}function xt(b){try{var S=b._init;return S(b._payload)}catch(N){throw N!==null&&typeof N=="object"&&typeof N.then=="function"?(Qs=N,Tc):N}}function ot(){if(Qs===null)throw Error(i(459));var b=Qs;return Qs=null,b}function tn(b){if(b===Tc||b===If)throw Error(i(483))}function ln(b){var S=Wu;return Wu+=1,Ws===null&&(Ws=[]),it(Ws,b,S)}function Rt(b,S){S=S.props.ref,b.ref=S!==void 0?S:null}function Vt(b,S){throw S.$$typeof===p_?Error(i(525)):(b=Object.prototype.toString.call(S),Error(i(31,b==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":b)))}function _t(b){function S(Tt,mt){if(b){var Mt=Tt.deletions;Mt===null?(Tt.deletions=[mt],Tt.flags|=16):Mt.push(mt)}}function N(Tt,mt){if(!b)return null;for(;mt!==null;)S(Tt,mt),mt=mt.sibling;return null}function V(Tt){for(var mt=new Map;Tt!==null;)Tt.key!==null?mt.set(Tt.key,Tt):mt.set(Tt.index,Tt),Tt=Tt.sibling;return mt}function ee(Tt,mt){return Tt=Ns(Tt,mt),Tt.index=0,Tt.sibling=null,Tt}function le(Tt,mt,Mt){return Tt.index=Mt,b?(Mt=Tt.alternate,Mt!==null?(Mt=Mt.index,Mt<mt?(Tt.flags|=67108866,mt):Mt):(Tt.flags|=67108866,mt)):(Tt.flags|=1048576,mt)}function Ne(Tt){return b&&Tt.alternate===null&&(Tt.flags|=67108866),Tt}function Qe(Tt,mt,Mt,on){return mt===null||mt.tag!==6?(mt=Rr(Mt,Tt.mode,on),mt.return=Tt,mt):(mt=ee(mt,Mt),mt.return=Tt,mt)}function St(Tt,mt,Mt,on){var $n=Mt.type;return $n===Sd?Kt(Tt,mt,Mt.props.children,on,Mt.key):mt!==null&&(mt.elementType===$n||typeof $n=="object"&&$n!==null&&$n.$$typeof===Pu&&xt($n)===mt.type)?(mt=ee(mt,Mt.props),Rt(mt,Mt),mt.return=Tt,mt):(mt=Xa(Mt.type,Mt.key,Mt.props,null,Tt.mode,on),Rt(mt,Mt),mt.return=Tt,mt)}function Lt(Tt,mt,Mt,on){return mt===null||mt.tag!==4||mt.stateNode.containerInfo!==Mt.containerInfo||mt.stateNode.implementation!==Mt.implementation?(mt=Hc(Mt,Tt.mode,on),mt.return=Tt,mt):(mt=ee(mt,Mt.children||[]),mt.return=Tt,mt)}function Kt(Tt,mt,Mt,on,$n){return mt===null||mt.tag!==7?(mt=Ph(Mt,Tt.mode,on,$n),mt.return=Tt,mt):(mt=ee(mt,Mt),mt.return=Tt,mt)}function Xt(Tt,mt,Mt){if(typeof mt=="string"&&mt!==""||typeof mt=="number"||typeof mt=="bigint")return mt=Rr(""+mt,Tt.mode,Mt),mt.return=Tt,mt;if(typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case wf:return Mt=Xa(mt.type,mt.key,mt.props,null,Tt.mode,Mt),Rt(Mt,mt),Mt.return=Tt,Mt;case Iu:return mt=Hc(mt,Tt.mode,Mt),mt.return=Tt,mt;case Pu:return mt=xt(mt),Xt(Tt,mt,Mt)}if(Bp(mt)||u(mt))return mt=Ph(mt,Tt.mode,Mt,null),mt.return=Tt,mt;if(typeof mt.then=="function")return Xt(Tt,ln(mt),Mt);if(mt.$$typeof===Xs)return Xt(Tt,Je(Tt,mt),Mt);Vt(Tt,mt)}return null}function vn(Tt,mt,Mt,on){var $n=mt!==null?mt.key:null;if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number"||typeof Mt=="bigint")return $n!==null?null:Qe(Tt,mt,""+Mt,on);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case wf:return Mt.key===$n?St(Tt,mt,Mt,on):null;case Iu:return Mt.key===$n?Lt(Tt,mt,Mt,on):null;case Pu:return Mt=xt(Mt),vn(Tt,mt,Mt,on)}if(Bp(Mt)||u(Mt))return $n!==null?null:Kt(Tt,mt,Mt,on,null);if(typeof Mt.then=="function")return vn(Tt,mt,ln(Mt),on);if(Mt.$$typeof===Xs)return vn(Tt,mt,Je(Tt,Mt),on);Vt(Tt,Mt)}return null}function Zn(Tt,mt,Mt,on,$n){if(typeof on=="string"&&on!==""||typeof on=="number"||typeof on=="bigint")return Tt=Tt.get(Mt)||null,Qe(mt,Tt,""+on,$n);if(typeof on=="object"&&on!==null){switch(on.$$typeof){case wf:return Tt=Tt.get(on.key===null?Mt:on.key)||null,St(mt,Tt,on,$n);case Iu:return Tt=Tt.get(on.key===null?Mt:on.key)||null,Lt(mt,Tt,on,$n);case Pu:return on=xt(on),Zn(Tt,mt,Mt,on,$n)}if(Bp(on)||u(on))return Tt=Tt.get(Mt)||null,Kt(mt,Tt,on,$n,null);if(typeof on.then=="function")return Zn(Tt,mt,Mt,ln(on),$n);if(on.$$typeof===Xs)return Zn(Tt,mt,Mt,Je(mt,on),$n);Vt(mt,on)}return null}function Nr(Tt,mt,Mt,on){for(var $n=null,Pr=null,er=mt,pr=mt=0,ki=null;er!==null&&pr<Mt.length;pr++){er.index>pr?(ki=er,er=null):ki=er.sibling;var Or=vn(Tt,er,Mt[pr],on);if(Or===null){er===null&&(er=ki);break}b&&er&&Or.alternate===null&&S(Tt,er),mt=le(Or,mt,pr),Pr===null?$n=Or:Pr.sibling=Or,Pr=Or,er=ki}if(pr===Mt.length)return N(Tt,er),_i&&re(Tt,pr),$n;if(er===null){for(;pr<Mt.length;pr++)er=Xt(Tt,Mt[pr],on),er!==null&&(mt=le(er,mt,pr),Pr===null?$n=er:Pr.sibling=er,Pr=er);return _i&&re(Tt,pr),$n}for(er=V(er);pr<Mt.length;pr++)ki=Zn(er,Tt,pr,Mt[pr],on),ki!==null&&(b&&ki.alternate!==null&&er.delete(ki.key===null?pr:ki.key),mt=le(ki,mt,pr),Pr===null?$n=ki:Pr.sibling=ki,Pr=ki);return b&&er.forEach(function(qs){return S(Tt,qs)}),_i&&re(Tt,pr),$n}function Vi(Tt,mt,Mt,on){if(Mt==null)throw Error(i(151));for(var $n=null,Pr=null,er=mt,pr=mt=0,ki=null,Or=Mt.next();er!==null&&!Or.done;pr++,Or=Mt.next()){er.index>pr?(ki=er,er=null):ki=er.sibling;var qs=vn(Tt,er,Or.value,on);if(qs===null){er===null&&(er=ki);break}b&&er&&qs.alternate===null&&S(Tt,er),mt=le(qs,mt,pr),Pr===null?$n=qs:Pr.sibling=qs,Pr=qs,er=ki}if(Or.done)return N(Tt,er),_i&&re(Tt,pr),$n;if(er===null){for(;!Or.done;pr++,Or=Mt.next())Or=Xt(Tt,Or.value,on),Or!==null&&(mt=le(Or,mt,pr),Pr===null?$n=Or:Pr.sibling=Or,Pr=Or);return _i&&re(Tt,pr),$n}for(er=V(er);!Or.done;pr++,Or=Mt.next())Or=Zn(er,Tt,pr,Or.value,on),Or!==null&&(b&&Or.alternate!==null&&er.delete(Or.key===null?pr:Or.key),mt=le(Or,mt,pr),Pr===null?$n=Or:Pr.sibling=Or,Pr=Or);return b&&er.forEach(function(Xc){return S(Tt,Xc)}),_i&&re(Tt,pr),$n}function Hi(Tt,mt,Mt,on){if(typeof Mt=="object"&&Mt!==null&&Mt.type===Sd&&Mt.key===null&&(Mt=Mt.props.children),typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case wf:e:{for(var $n=Mt.key;mt!==null;){if(mt.key===$n){if($n=Mt.type,$n===Sd){if(mt.tag===7){N(Tt,mt.sibling),on=ee(mt,Mt.props.children),on.return=Tt,Tt=on;break e}}else if(mt.elementType===$n||typeof $n=="object"&&$n!==null&&$n.$$typeof===Pu&&xt($n)===mt.type){N(Tt,mt.sibling),on=ee(mt,Mt.props),Rt(on,Mt),on.return=Tt,Tt=on;break e}N(Tt,mt);break}else S(Tt,mt);mt=mt.sibling}Mt.type===Sd?(on=Ph(Mt.props.children,Tt.mode,on,Mt.key),on.return=Tt,Tt=on):(on=Xa(Mt.type,Mt.key,Mt.props,null,Tt.mode,on),Rt(on,Mt),on.return=Tt,Tt=on)}return Ne(Tt);case Iu:e:{for($n=Mt.key;mt!==null;){if(mt.key===$n)if(mt.tag===4&&mt.stateNode.containerInfo===Mt.containerInfo&&mt.stateNode.implementation===Mt.implementation){N(Tt,mt.sibling),on=ee(mt,Mt.children||[]),on.return=Tt,Tt=on;break e}else{N(Tt,mt);break}else S(Tt,mt);mt=mt.sibling}on=Hc(Mt,Tt.mode,on),on.return=Tt,Tt=on}return Ne(Tt);case Pu:return Mt=xt(Mt),Hi(Tt,mt,Mt,on)}if(Bp(Mt))return Nr(Tt,mt,Mt,on);if(u(Mt)){if($n=u(Mt),typeof $n!="function")throw Error(i(150));return Mt=$n.call(Mt),Vi(Tt,mt,Mt,on)}if(typeof Mt.then=="function")return Hi(Tt,mt,ln(Mt),on);if(Mt.$$typeof===Xs)return Hi(Tt,mt,Je(Tt,Mt),on);Vt(Tt,Mt)}return typeof Mt=="string"&&Mt!==""||typeof Mt=="number"||typeof Mt=="bigint"?(Mt=""+Mt,mt!==null&&mt.tag===6?(N(Tt,mt.sibling),on=ee(mt,Mt),on.return=Tt,Tt=on):(N(Tt,mt),on=Rr(Mt,Tt.mode,on),on.return=Tt,Tt=on),Ne(Tt)):N(Tt,mt)}return function(Tt,mt,Mt,on){try{Wu=0;var $n=Hi(Tt,mt,Mt,on);return Ws=null,$n}catch(er){if(er===Tc||er===If)throw er;var Pr=n(29,er,null,Tt.mode);return Pr.lanes=on,Pr.return=Tt,Pr}}}function Jt(){for(var b=_e,S=Oe=_e=0;S<b;){var N=J[S];J[S++]=null;var V=J[S];J[S++]=null;var ee=J[S];J[S++]=null;var le=J[S];if(J[S++]=null,V!==null&&ee!==null){var Ne=V.pending;Ne===null?ee.next=ee:(ee.next=Ne.next,Ne.next=ee),V.pending=ee}le!==0&&Ln(N,ee,le)}}function Tn(b,S,N,V){J[_e++]=b,J[_e++]=S,J[_e++]=N,J[_e++]=V,Oe|=V,b.lanes|=V,b=b.alternate,b!==null&&(b.lanes|=V)}function qt(b,S,N,V){return Tn(b,S,N,V),mr(b)}function An(b,S){return Tn(b,null,null,S),mr(b)}function Ln(b,S,N){b.lanes|=N;var V=b.alternate;V!==null&&(V.lanes|=N);for(var ee=!1,le=b.return;le!==null;)le.childLanes|=N,V=le.alternate,V!==null&&(V.childLanes|=N),le.tag===22&&(b=le.stateNode,b===null||b._visibility&1||(ee=!0)),b=le,le=le.return;return b.tag===3?(le=b.stateNode,ee&&S!==null&&(ee=31-Ss(N),b=le.hiddenUpdates,V=b[ee],V===null?b[ee]=[S]:V.push(S),S.lane=N|536870912),le):null}function mr(b){if(50<Dn)throw Dn=0,Jn=null,Error(i(185));for(var S=b.return;S!==null;)b=S,S=b.return;return b.tag===3?b.stateNode:null}function ns(b){b.updateQueue={baseState:b.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function hi(b,S){b=b.updateQueue,S.updateQueue===b&&(S.updateQueue={baseState:b.baseState,firstBaseUpdate:b.firstBaseUpdate,lastBaseUpdate:b.lastBaseUpdate,shared:b.shared,callbacks:null})}function ti(b){return{lane:b,tag:0,payload:null,callback:null,next:null}}function Fi(b,S,N){var V=b.updateQueue;if(V===null)return null;if(V=V.shared,(Yr&2)!==0){var ee=V.pending;return ee===null?S.next=S:(S.next=ee.next,ee.next=S),V.pending=S,S=mr(b),Ln(b,null,N),S}return Tn(b,V,S,N),mr(b)}function rs(b,S,N){if(S=S.updateQueue,S!==null&&(S=S.shared,(N&4194048)!==0)){var V=S.lanes;V&=b.pendingLanes,N|=V,S.lanes=N,L(b,N)}}function qi(b,S){var N=b.updateQueue,V=b.alternate;if(V!==null&&(V=V.updateQueue,N===V)){var ee=null,le=null;if(N=N.firstBaseUpdate,N!==null){do{var Ne={lane:N.lane,tag:N.tag,payload:N.payload,callback:null,next:null};le===null?ee=le=Ne:le=le.next=Ne,N=N.next}while(N!==null);le===null?ee=le=S:le=le.next=S}else ee=le=S;N={baseState:V.baseState,firstBaseUpdate:ee,lastBaseUpdate:le,shared:V.shared,callbacks:V.callbacks},b.updateQueue=N;return}b=N.lastBaseUpdate,b===null?N.firstBaseUpdate=S:b.next=S,N.lastBaseUpdate=S}function is(){if(ct){var b=xs;if(b!==null)throw b}}function ss(b,S,N,V){ct=!1;var ee=b.updateQueue;$e=!1;var le=ee.firstBaseUpdate,Ne=ee.lastBaseUpdate,Qe=ee.shared.pending;if(Qe!==null){ee.shared.pending=null;var St=Qe,Lt=St.next;St.next=null,Ne===null?le=Lt:Ne.next=Lt,Ne=St;var Kt=b.alternate;Kt!==null&&(Kt=Kt.updateQueue,Qe=Kt.lastBaseUpdate,Qe!==Ne&&(Qe===null?Kt.firstBaseUpdate=Lt:Qe.next=Lt,Kt.lastBaseUpdate=St))}if(le!==null){var Xt=ee.baseState;Ne=0,Kt=Lt=St=null,Qe=le;do{var vn=Qe.lane&-536870913,Zn=vn!==Qe.lane;if(Zn?(Ei&vn)===vn:(V&vn)===vn){vn!==0&&vn===Gu&&(ct=!0),Kt!==null&&(Kt=Kt.next={lane:0,tag:Qe.tag,payload:Qe.payload,callback:null,next:null});e:{var Nr=b,Vi=Qe;vn=S;var Hi=N;switch(Vi.tag){case 1:if(Nr=Vi.payload,typeof Nr=="function"){Xt=Nr.call(Hi,Xt,vn);break e}Xt=Nr;break e;case 3:Nr.flags=Nr.flags&-65537|128;case 0:if(Nr=Vi.payload,vn=typeof Nr=="function"?Nr.call(Hi,Xt,vn):Nr,vn==null)break e;Xt=$c({},Xt,vn);break e;case 2:$e=!0}}vn=Qe.callback,vn!==null&&(b.flags|=64,Zn&&(b.flags|=8192),Zn=ee.callbacks,Zn===null?ee.callbacks=[vn]:Zn.push(vn))}else Zn={lane:vn,tag:Qe.tag,payload:Qe.payload,callback:Qe.callback,next:null},Kt===null?(Lt=Kt=Zn,St=Xt):Kt=Kt.next=Zn,Ne|=vn;if(Qe=Qe.next,Qe===null){if(Qe=ee.shared.pending,Qe===null)break;Zn=Qe,Qe=Zn.next,Zn.next=null,ee.lastBaseUpdate=Zn,ee.shared.pending=null}}while(!0);Kt===null&&(St=Xt),ee.baseState=St,ee.firstBaseUpdate=Lt,ee.lastBaseUpdate=Kt,le===null&&(ee.shared.lanes=0),w|=Ne,b.lanes=Ne,b.memoizedState=Xt}}function je(b,S){if(typeof b!="function")throw Error(i(191,b));b.call(S)}function vt(b,S){var N=b.callbacks;if(N!==null)for(b.callbacks=null,b=0;b<N.length;b++)je(N[b],S)}function It(b,S){b=Dd,p(kt,b),p(ft,S),Dd=b|S.baseLanes}function Ut(){p(kt,Dd),p(ft,ft.current)}function yt(){Dd=kt.current,d(ft),d(kt)}function an(b){var S=b.alternate;p(rn,rn.current&1),p(Wt,b),Yt===null&&(S===null||ft.current!==null||S.memoizedState!==null)&&(Yt=b)}function In(b){p(rn,rn.current),p(Wt,b),Yt===null&&(Yt=b)}function _n(b){b.tag===22?(p(rn,rn.current),p(Wt,b),Yt===null&&(Yt=b)):Pn()}function Pn(){p(rn,rn.current),p(Wt,Wt.current)}function tr(b){d(Wt),Yt===b&&(Yt=null),d(rn)}function fr(b){for(var S=b;S!==null;){if(S.tag===13){var N=S.memoizedState;if(N!==null&&(N=N.dehydrated,N===null||sy(N)||D0(N)))return S}else if(S.tag===19&&(S.memoizedProps.revealOrder==="forwards"||S.memoizedProps.revealOrder==="backwards"||S.memoizedProps.revealOrder==="unstable_legacy-backwards"||S.memoizedProps.revealOrder==="together")){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===b)break;for(;S.sibling===null;){if(S.return===null||S.return===b)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}function Cn(){throw Error(i(321))}function yr(b,S){if(S===null)return!1;for(var N=0;N<S.length&&N<b.length;N++)if(!Qa(b[N],S[N]))return!1;return!0}function Hr(b,S,N,V,ee,le){return Gn=le,pn=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,dr.H=b===null||b.memoizedState===null?Ti:Ls,Rn=!1,le=N(V,ee),Rn=!1,ir&&(le=Lr(S,N,V,ee)),ds(b),le}function ds(b){dr.H=jn;var S=Nn!==null&&Nn.next!==null;if(Gn=0,Ht=Nn=pn=null,mn=!1,Er=0,si=null,S)throw Error(i(300));b===null||zi||(b=b.dependencies,b!==null&&we(b)&&(zi=!0))}function Lr(b,S,N,V){pn=b;var ee=0;do{if(ir&&(si=null),Er=0,ir=!1,25<=ee)throw Error(i(301));if(ee+=1,Ht=Nn=null,b.updateQueue!=null){var le=b.updateQueue;le.lastEffect=null,le.events=null,le.stores=null,le.memoCache!=null&&(le.memoCache.index=0)}dr.H=wa,le=S(N,V)}while(ir);return le}function Gr(){var b=dr.H,S=b.useState()[0];return S=typeof S.then=="function"?lo(S):S,b=b.useState()[0],(Nn!==null?Nn.memoizedState:null)!==b&&(pn.flags|=1024),S}function ar(){var b=gr!==0;return gr=0,b}function br(b,S,N){S.updateQueue=b.updateQueue,S.flags&=-2053,b.lanes&=~N}function Un(b){if(mn){for(b=b.memoizedState;b!==null;){var S=b.queue;S!==null&&(S.pending=null),b=b.next}mn=!1}Gn=0,Ht=Nn=pn=null,ir=!1,Er=gr=0,si=null}function bi(){var b={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ht===null?pn.memoizedState=Ht=b:Ht=Ht.next=b,Ht}function ai(){if(Nn===null){var b=pn.alternate;b=b!==null?b.memoizedState:null}else b=Nn.next;var S=Ht===null?pn.memoizedState:Ht.next;if(S!==null)Ht=S,Nn=b;else{if(b===null)throw pn.alternate===null?Error(i(467)):Error(i(310));Nn=b,b={memoizedState:Nn.memoizedState,baseState:Nn.baseState,baseQueue:Nn.baseQueue,queue:Nn.queue,next:null},Ht===null?pn.memoizedState=Ht=b:Ht=Ht.next=b}return Ht}function Rs(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function lo(b){var S=Er;return Er+=1,si===null&&(si=[]),b=it(si,b,S),S=pn,(Ht===null?S.memoizedState:Ht.next)===null&&(S=S.alternate,dr.H=S===null||S.memoizedState===null?Ti:Ls),b}function Ri(b){if(b!==null&&typeof b=="object"){if(typeof b.then=="function")return lo(b);if(b.$$typeof===Xs)return ze(b)}throw Error(i(438,String(b)))}function Mn(b){var S=null,N=pn.updateQueue;if(N!==null&&(S=N.memoCache),S==null){var V=pn.alternate;V!==null&&(V=V.updateQueue,V!==null&&(V=V.memoCache,V!=null&&(S={data:V.data.map(function(ee){return ee.slice()}),index:0})))}if(S==null&&(S={data:[],index:0}),N===null&&(N=Rs(),pn.updateQueue=N),N.memoCache=S,N=S.data[S.index],N===void 0)for(N=S.data[S.index]=Array(b),V=0;V<b;V++)N[V]=xd;return S.index++,N}function Pi(b,S){return typeof S=="function"?S(b):S}function Xn(b){var S=ai();return ps(S,Nn,b)}function ps(b,S,N){var V=b.queue;if(V===null)throw Error(i(311));V.lastRenderedReducer=N;var ee=b.baseQueue,le=V.pending;if(le!==null){if(ee!==null){var Ne=ee.next;ee.next=le.next,le.next=Ne}S.baseQueue=ee=le,V.pending=null}if(le=b.baseState,ee===null)b.memoizedState=le;else{S=ee.next;var Qe=Ne=null,St=null,Lt=S,Kt=!1;do{var Xt=Lt.lane&-536870913;if(Xt!==Lt.lane?(Ei&Xt)===Xt:(Gn&Xt)===Xt){var vn=Lt.revertLane;if(vn===0)St!==null&&(St=St.next={lane:0,revertLane:0,gesture:null,action:Lt.action,hasEagerState:Lt.hasEagerState,eagerState:Lt.eagerState,next:null}),Xt===Gu&&(Kt=!0);else if((Gn&vn)===vn){Lt=Lt.next,vn===Gu&&(Kt=!0);continue}else Xt={lane:0,revertLane:Lt.revertLane,gesture:null,action:Lt.action,hasEagerState:Lt.hasEagerState,eagerState:Lt.eagerState,next:null},St===null?(Qe=St=Xt,Ne=le):St=St.next=Xt,pn.lanes|=vn,w|=vn;Xt=Lt.action,Rn&&N(le,Xt),le=Lt.hasEagerState?Lt.eagerState:N(le,Xt)}else vn={lane:Xt,revertLane:Lt.revertLane,gesture:Lt.gesture,action:Lt.action,hasEagerState:Lt.hasEagerState,eagerState:Lt.eagerState,next:null},St===null?(Qe=St=vn,Ne=le):St=St.next=vn,pn.lanes|=Xt,w|=Xt;Lt=Lt.next}while(Lt!==null&&Lt!==S);if(St===null?Ne=le:St.next=Qe,!Qa(le,b.memoizedState)&&(zi=!0,Kt&&(N=xs,N!==null)))throw N;b.memoizedState=le,b.baseState=Ne,b.baseQueue=St,V.lastRenderedState=le}return ee===null&&(V.lanes=0),[b.memoizedState,V.dispatch]}function al(b){var S=ai(),N=S.queue;if(N===null)throw Error(i(311));N.lastRenderedReducer=b;var V=N.dispatch,ee=N.pending,le=S.memoizedState;if(ee!==null){N.pending=null;var Ne=ee=ee.next;do le=b(le,Ne.action),Ne=Ne.next;while(Ne!==ee);Qa(le,S.memoizedState)||(zi=!0),S.memoizedState=le,S.baseQueue===null&&(S.baseState=le),N.lastRenderedState=le}return[le,V]}function ms(b,S,N){var V=pn,ee=ai(),le=_i;if(le){if(N===void 0)throw Error(i(407));N=N()}else N=S();var Ne=!Qa((Nn||ee).memoizedState,N);if(Ne&&(ee.memoizedState=N,zi=!0),ee=ee.queue,n0(qg.bind(null,V,ee,b),[b]),ee.getSnapshot!==S||Ne||Ht!==null&&Ht.memoizedState.tag&1){if(V.flags|=2048,mf(9,{destroy:void 0},e0.bind(null,V,ee,N,S),null),ws===null)throw Error(i(349));le||(Gn&127)!==0||Bc(V,S,N)}return N}function Bc(b,S,N){b.flags|=16384,b={getSnapshot:S,value:N},S=pn.updateQueue,S===null?(S=Rs(),pn.updateQueue=S,S.stores=[b]):(N=S.stores,N===null?S.stores=[b]:N.push(b))}function e0(b,S,N,V){S.value=N,S.getSnapshot=V,Yg(S)&&Kg(b)}function qg(b,S,N){return N(function(){Yg(S)&&Kg(b)})}function Yg(b){var S=b.getSnapshot;b=b.value;try{var N=S();return!Qa(b,N)}catch{return!0}}function Kg(b){var S=An(b,2);S!==null&&Ya(S,b,2)}function bp(b){var S=bi();if(typeof b=="function"){var N=b;if(b=N(),Rn){D(!0);try{N()}finally{D(!1)}}}return S.memoizedState=S.baseState=b,S.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:b},S}function ya(b,S,N,V){return b.baseState=N,ps(b,Nn,typeof V=="function"?V:Pi)}function _b(b,S,N,V,ee){if(ul(b))throw Error(i(485));if(b=S.action,b!==null){var le={payload:ee,action:b,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Ne){le.listeners.push(Ne)}};dr.T!==null?N(!0):le.isTransition=!1,V(le),N=S.pending,N===null?(le.next=S.pending=le,Fc(S,le)):(le.next=N.next,S.pending=N.next=le)}}function Fc(b,S){var N=S.action,V=S.payload,ee=b.state;if(S.isTransition){var le=dr.T,Ne={};dr.T=Ne;try{var Qe=N(ee,V),St=dr.S;St!==null&&St(Ne,Qe),Bv(b,S,Qe)}catch(Lt){cl(b,S,Lt)}finally{le!==null&&Ne.types!==null&&(le.types=Ne.types),dr.T=le}}else try{le=N(ee,V),Bv(b,S,le)}catch(Lt){cl(b,S,Lt)}}function Bv(b,S,N){N!==null&&typeof N=="object"&&typeof N.then=="function"?N.then(function(V){Xg(b,S,V)},function(V){return cl(b,S,V)}):Xg(b,S,N)}function Xg(b,S,N){S.status="fulfilled",S.value=N,Sp(S),b.state=N,S=b.pending,S!==null&&(N=S.next,N===S?b.pending=null:(N=N.next,S.next=N,Fc(b,N)))}function cl(b,S,N){var V=b.pending;if(b.pending=null,V!==null){V=V.next;do S.status="rejected",S.reason=N,Sp(S),S=S.next;while(S!==V)}b.action=null}function Sp(b){b=b.listeners;for(var S=0;S<b.length;S++)(0,b[S])()}function t0(b,S){return S}function bs(b,S){if(_i){var N=ws.formState;if(N!==null){e:{var V=pn;if(_i){if(li){var ee=kx(li,Yc);if(ee){li=Hp(ee),V=x_(ee);break e}}Pe(V)}V=!1}V&&(S=N[0])}}N=bi(),N.memoizedState=N.baseState=S,V={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t0,lastRenderedState:S},N.queue=V,N=zl.bind(null,pn,V),V.dispatch=N,V=bp(!1);var le=Hs.bind(null,pn,!1,V.queue);return V=bi(),ee={state:S,dispatch:null,action:b,pending:null},V.queue=ee,N=_b.bind(null,pn,ee,le,N),ee.dispatch=N,V.memoizedState=b,[S,N,!1]}function gc(b){var S=ai();return pf(S,Nn,b)}function pf(b,S,N){if(S=ps(b,S,t0)[0],b=Xn(Pi)[0],typeof S=="object"&&S!==null&&typeof S.then=="function")try{var V=lo(S)}catch(Ne){throw Ne===Tc?If:Ne}else V=S;S=ai();var ee=S.queue,le=ee.dispatch;return N!==S.memoizedState&&(pn.flags|=2048,mf(9,{destroy:void 0},_c.bind(null,ee,N),null)),[V,le,b]}function _c(b,S){b.action=S}function jc(b){var S=ai(),N=Nn;if(N!==null)return pf(S,N,b);ai(),S=S.memoizedState,N=ai();var V=N.queue.dispatch;return N.memoizedState=b,[S,V,!1]}function mf(b,S,N,V){return b={tag:b,create:N,deps:V,inst:S,next:null},S=pn.updateQueue,S===null&&(S=Rs(),pn.updateQueue=S),N=S.lastEffect,N===null?S.lastEffect=b.next=b:(V=N.next,N.next=b,b.next=V,S.lastEffect=b),b}function xu(){return ai().memoizedState}function Th(b,S,N,V){var ee=bi();pn.flags|=b,ee.memoizedState=mf(1|S,{destroy:void 0},N,V===void 0?null:V)}function vc(b,S,N,V){var ee=ai();V=V===void 0?null:V;var le=ee.memoizedState.inst;Nn!==null&&V!==null&&yr(V,Nn.memoizedState.deps)?ee.memoizedState=mf(S,le,N,V):(pn.flags|=b,ee.memoizedState=mf(1|S,le,N,V))}function hr(b,S){Th(8390656,8,b,S)}function n0(b,S){vc(2048,8,b,S)}function Fv(b){pn.flags|=4;var S=pn.updateQueue;if(S===null)S=Rs(),pn.updateQueue=S,S.events=[b];else{var N=S.events;N===null?S.events=[b]:N.push(b)}}function Jg(b){var S=ai().memoizedState;return Fv({ref:S,nextImpl:b}),function(){if((Yr&2)!==0)throw Error(i(440));return S.impl.apply(void 0,arguments)}}function Ah(b,S){return vc(4,2,b,S)}function Zg(b,S){return vc(4,4,b,S)}function r0(b,S){if(typeof S=="function"){b=b();var N=S(b);return function(){typeof N=="function"?N():S(null)}}if(S!=null)return b=b(),S.current=b,function(){S.current=null}}function Da(b,S,N){N=N!=null?N.concat([b]):null,vc(4,4,r0.bind(null,S,b),N)}function i0(){}function yc(b,S){var N=ai();S=S===void 0?null:S;var V=N.memoizedState;return S!==null&&yr(S,V[1])?V[0]:(N.memoizedState=[b,S],b)}function Qg(b,S){var N=ai();S=S===void 0?null:S;var V=N.memoizedState;if(S!==null&&yr(S,V[1]))return V[0];if(V=b(),Rn){D(!0);try{b()}finally{D(!1)}}return N.memoizedState=[V,S],V}function wu(b,S,N){return N===void 0||(Gn&1073741824)!==0&&(Ei&261930)===0?b.memoizedState=S:(b.memoizedState=N,b=c_(),pn.lanes|=b,w|=b,N)}function uo(b,S,N,V){return Qa(N,S)?N:ft.current!==null?(b=wu(b,N,V),Qa(b,S)||(zi=!0),b):(Gn&42)===0||(Gn&1073741824)!==0&&(Ei&261930)===0?(zi=!0,b.memoizedState=N):(b=c_(),pn.lanes|=b,w|=b,S)}function jv(b,S,N,V,ee){var le=ra();po(le!==0&&8>le?le:8);var Ne=dr.T,Qe={};dr.T=Qe,Hs(b,!1,S,N);try{var St=ee(),Lt=dr.S;if(Lt!==null&&Lt(Qe,St),St!==null&&typeof St=="object"&&typeof St.then=="function"){var Kt=He(St,V);Oo(b,S,Kt,Ki(b))}else Oo(b,S,V,Ki(b))}catch(Xt){Oo(b,S,{then:function(){},status:"rejected",reason:Xt},Ki())}finally{po(le),Ne!==null&&Qe.types!==null&&(Ne.types=Qe.types),dr.T=Ne}}function e_(b){var S=b.memoizedState;if(S!==null)return S;S={memoizedState:gl,baseState:gl,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:gl},next:null};var N={};return S.next={memoizedState:N,baseState:N,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:N},next:null},b.memoizedState=S,b=b.alternate,b!==null&&(b.memoizedState=S),S}function ll(){return ze(Lh)}function ks(){return ai().memoizedState}function Jo(){return ai().memoizedState}function zv(b){for(var S=b.return;S!==null;){switch(S.tag){case 24:case 3:var N=Ki();b=ti(N);var V=Fi(S,b,N);V!==null&&(Ya(V,S,N),rs(V,S,N)),S={cache:tt()},b.payload=S;return}S=S.return}}function vb(b,S,N){var V=Ki();N={lane:V,revertLane:0,gesture:null,action:N,hasEagerState:!1,eagerState:null,next:null},ul(b)?ba(S,N):(N=qt(b,S,N,V),N!==null&&(Ya(N,b,V),xn(N,S,V)))}function zl(b,S,N){var V=Ki();Oo(b,S,N,V)}function Oo(b,S,N,V){var ee={lane:V,revertLane:0,gesture:null,action:N,hasEagerState:!1,eagerState:null,next:null};if(ul(b))ba(S,ee);else{var le=b.alternate;if(b.lanes===0&&(le===null||le.lanes===0)&&(le=S.lastRenderedReducer,le!==null))try{var Ne=S.lastRenderedState,Qe=le(Ne,N);if(ee.hasEagerState=!0,ee.eagerState=Qe,Qa(Qe,Ne))return Tn(b,S,ee,0),ws===null&&Jt(),!1}catch{}if(N=qt(b,S,ee,V),N!==null)return Ya(N,b,V),xn(N,S,V),!0}return!1}function Hs(b,S,N,V){if(V={lane:2,revertLane:ye(),gesture:null,action:V,hasEagerState:!1,eagerState:null,next:null},ul(b)){if(S)throw Error(i(479))}else S=qt(b,N,V,2),S!==null&&Ya(S,b,2)}function ul(b){var S=b.alternate;return b===pn||S!==null&&S===pn}function ba(b,S){ir=mn=!0;var N=b.pending;N===null?S.next=S:(S.next=N.next,N.next=S),b.pending=S}function xn(b,S,N){if((N&4194048)!==0){var V=S.lanes;V&=b.pendingLanes,N|=V,S.lanes=N,L(b,N)}}function Vv(b,S,N,V){S=b.memoizedState,N=N(V,S),N=N==null?S:$c({},S,N),b.memoizedState=N,b.lanes===0&&(b.updateQueue.baseState=N)}function s0(b,S,N,V,ee,le,Ne){return b=b.stateNode,typeof b.shouldComponentUpdate=="function"?b.shouldComponentUpdate(V,le,Ne):S.prototype&&S.prototype.isPureReactComponent?!Be(N,V)||!Be(ee,le):!0}function Bt(b,S,N,V){b=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(N,V),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(N,V),S.state!==b&&os.enqueueReplaceState(S,S.state,null)}function en(b,S){var N=S;if("ref"in S){N={};for(var V in S)V!=="ref"&&(N[V]=S[V])}if(b=b.defaultProps){N===S&&(N=$c({},N));for(var ee in b)N[ee]===void 0&&(N[ee]=b[ee])}return N}function sn(b,S){try{var N=b.onUncaughtError;N(S.value,{componentStack:S.stack})}catch(V){setTimeout(function(){throw V})}}function Vn(b,S,N){try{var V=b.onCaughtError;V(N.value,{componentStack:N.stack,errorBoundary:S.tag===1?S.stateNode:null})}catch(ee){setTimeout(function(){throw ee})}}function kr(b,S,N){return N=ti(N),N.tag=3,N.payload={element:null},N.callback=function(){sn(b,S)},N}function Si(b){return b=ti(b),b.tag=3,b}function ho(b,S,N,V){var ee=N.type.getDerivedStateFromError;if(typeof ee=="function"){var le=V.value;b.payload=function(){return ee(le)},b.callback=function(){Vn(S,N,V)}}var Ne=N.stateNode;Ne!==null&&typeof Ne.componentDidCatch=="function"&&(b.callback=function(){Vn(S,N,V),typeof ee!="function"&&(rt===null?rt=new Set([this]):rt.add(this));var Qe=V.stack;this.componentDidCatch(V.value,{componentStack:Qe!==null?Qe:""})})}function Vl(b,S,N,V,ee){if(N.flags|=32768,V!==null&&typeof V=="object"&&typeof V.then=="function"){if(S=N.alternate,S!==null&&ve(S,N,ee,!0),N=Wt.current,N!==null){switch(N.tag){case 31:case 13:return Yt===null?S0():N.alternate===null&&P===0&&(P=3),N.flags&=-257,N.flags|=65536,N.lanes=ee,V===Hh?N.flags|=16384:(S=N.updateQueue,S===null?N.updateQueue=new Set([V]):S.add(V),Xr(b,V,ee)),!1;case 22:return N.flags|=65536,V===Hh?N.flags|=16384:(S=N.updateQueue,S===null?(S={transitions:null,markerInstances:null,retryQueue:new Set([V])},N.updateQueue=S):(N=S.retryQueue,N===null?S.retryQueue=new Set([V]):N.add(V)),Xr(b,V,ee)),!1}throw Error(i(435,N.tag))}return Xr(b,V,ee),S0(),!1}if(_i)return S=Wt.current,S!==null?((S.flags&65536)===0&&(S.flags|=256),S.flags|=65536,S.lanes=ee,V!==Of&&(b=Error(i(422),{cause:V}),Le(te(b,N)))):(V!==Of&&(S=Error(i(423),{cause:V}),Le(te(S,N))),b=b.current.alternate,b.flags|=65536,ee&=-ee,b.lanes|=ee,V=te(V,N),ee=kr(b.stateNode,V,ee),qi(b,ee),P!==4&&(P=2)),!1;var le=Error(i(520),{cause:V});if(le=te(le,N),X===null?X=[le]:X.push(le),P!==4&&(P=2),S===null)return!0;V=te(V,N),N=S;do{switch(N.tag){case 3:return N.flags|=65536,b=ee&-ee,N.lanes|=b,b=kr(N.stateNode,V,b),qi(N,b),!1;case 1:if(S=N.type,le=N.stateNode,(N.flags&128)===0&&(typeof S.getDerivedStateFromError=="function"||le!==null&&typeof le.componentDidCatch=="function"&&(rt===null||!rt.has(le))))return N.flags|=65536,ee&=-ee,N.lanes|=ee,ee=Si(ee),ho(ee,b,N,V),qi(N,ee),!1}N=N.return}while(N!==null);return!1}function Wr(b,S,N,V){S.child=b===null?B(S,null,N,V):C(S,b.child,N,V)}function t_(b,S,N,V,ee){N=N.render;var le=S.ref;if("ref"in V){var Ne={};for(var Qe in V)Qe!=="ref"&&(Ne[Qe]=V[Qe])}else Ne=V;return pe(S),V=Hr(b,S,N,Ne,le,ee),Qe=ar(),b!==null&&!zi?(br(b,S,ee),Tu(b,S,ee)):(_i&&Qe&&Y(S),S.flags|=1,Wr(b,S,V,ee),S.child)}function yb(b,S,N,V,ee){if(b===null){var le=N.type;return typeof le=="function"&&!Ka(le)&&le.defaultProps===void 0&&N.compare===null?(S.tag=15,S.type=le,zc(b,S,le,V,ee)):(b=Xa(N.type,null,V,S,S.mode,ee),b.ref=S.ref,b.return=S,S.child=b)}if(le=b.child,!fd(b,ee)){var Ne=le.memoizedProps;if(N=N.compare,N=N!==null?N:Be,N(Ne,V)&&b.ref===S.ref)return Tu(b,S,ee)}return S.flags|=1,b=Ns(le,V),b.ref=S.ref,b.return=S,S.child=b}function zc(b,S,N,V,ee){if(b!==null){var le=b.memoizedProps;if(Be(le,V)&&b.ref===S.ref)if(zi=!1,S.pendingProps=V=le,fd(b,ee))(b.flags&131072)!==0&&(zi=!0);else return S.lanes=b.lanes,Tu(b,S,ee)}return n_(b,S,N,V,ee)}function o0(b,S,N,V){var ee=V.children,le=b!==null?b.memoizedState:null;if(b===null&&S.stateNode===null&&(S.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),V.mode==="hidden"){if((S.flags&128)!==0){if(le=le!==null?le.baseLanes|N:N,b!==null){for(V=S.child=b.child,ee=0;V!==null;)ee=ee|V.lanes|V.childLanes,V=V.sibling;V=ee&~le}else V=0,S.child=null;return ld(b,S,le,N,V)}if((N&536870912)!==0)S.memoizedState={baseLanes:0,cachePool:null},b!==null&&We(S,le!==null?le.cachePool:null),le!==null?It(S,le):Ut(),_n(S);else return V=S.lanes=536870912,ld(b,S,le!==null?le.baseLanes|N:N,N,V)}else le!==null?(We(S,le.cachePool),It(S,le),Pn(),S.memoizedState=null):(b!==null&&We(S,null),Ut(),Pn());return Wr(b,S,ee,N),S.child}function a0(b,S){return b!==null&&b.tag===22||S.stateNode!==null||(S.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),S.sibling}function ld(b,S,N,V,ee){var le=Fe();return le=le===null?null:{parent:Ba?Ps._currentValue:Ps._currentValue2,pool:le},S.memoizedState={baseLanes:N,cachePool:le},b!==null&&We(S,null),Ut(),_n(S),b!==null&&ve(b,S,V,!0),S.childLanes=ee,null}function ud(b,S){return S=ji({mode:S.mode,children:S.children},b.mode),S.ref=b.ref,b.child=S,S.return=b,S}function c0(b,S,N){return C(S,b.child,null,N),b=ud(S,S.pendingProps),b.flags|=2,tr(S),S.memoizedState=null,b}function Yi(b,S,N){var V=S.pendingProps,ee=(S.flags&128)!==0;if(S.flags&=-129,b===null){if(_i){if(V.mode==="hidden")return b=ud(S,V),S.lanes=536870912,a0(null,b);if(In(S),(b=li)?(b=L0(b,Yc),b!==null&&(S.memoizedState={dehydrated:b,treeContext:wc!==null?{id:Hu,overflow:ql}:null,retryLane:536870912,hydrationErrors:null},N=ea(b),N.return=S,S.child=N,Uo=S,li=null)):b=null,b===null)throw Pe(S);return S.lanes=536870912,null}return ud(S,V)}var le=b.memoizedState;if(le!==null){var Ne=le.dehydrated;if(In(S),ee)if(S.flags&256)S.flags&=-257,S=c0(b,S,N);else if(S.memoizedState!==null)S.child=b.child,S.flags|=128,S=null;else throw Error(i(558));else if(zi||ve(b,S,N,!1),ee=(N&b.childLanes)!==0,zi||ee){if(V=ws,V!==null&&(Ne=I(V,N),Ne!==0&&Ne!==le.retryLane))throw le.retryLane=Ne,An(b,Ne),Ya(V,b,Ne),Bo;S0(),S=c0(b,S,N)}else b=le.treeContext,gi&&(li=Bh(Ne),Uo=S,_i=!0,Yl=null,Yc=!1,b!==null&&Q(S,b)),S=ud(S,V),S.flags|=4096;return S}return b=Ns(b.child,{mode:V.mode,children:V.children}),b.ref=S.ref,S.child=b,b.return=S,b}function l0(b,S){var N=S.ref;if(N===null)b!==null&&b.ref!==null&&(S.flags|=4194816);else{if(typeof N!="function"&&typeof N!="object")throw Error(i(284));(b===null||b.ref!==N)&&(S.flags|=4194816)}}function n_(b,S,N,V,ee){return pe(S),N=Hr(b,S,N,V,void 0,ee),V=ar(),b!==null&&!zi?(br(b,S,ee),Tu(b,S,ee)):(_i&&V&&Y(S),S.flags|=1,Wr(b,S,N,ee),S.child)}function u0(b,S,N,V,ee,le){return pe(S),S.updateQueue=null,N=Lr(S,V,N,ee),ds(b),V=ar(),b!==null&&!zi?(br(b,S,le),Tu(b,S,le)):(_i&&V&&Y(S),S.flags|=1,Wr(b,S,N,le),S.child)}function bb(b,S,N,V,ee){if(pe(S),S.stateNode===null){var le=jh,Ne=N.contextType;typeof Ne=="object"&&Ne!==null&&(le=ze(Ne)),le=new N(V,le),S.memoizedState=le.state!==null&&le.state!==void 0?le.state:null,le.updater=os,S.stateNode=le,le._reactInternals=S,le=S.stateNode,le.props=V,le.state=S.memoizedState,le.refs={},ns(S),Ne=N.contextType,le.context=typeof Ne=="object"&&Ne!==null?ze(Ne):jh,le.state=S.memoizedState,Ne=N.getDerivedStateFromProps,typeof Ne=="function"&&(Vv(S,N,Ne,V),le.state=S.memoizedState),typeof N.getDerivedStateFromProps=="function"||typeof le.getSnapshotBeforeUpdate=="function"||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(Ne=le.state,typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount(),Ne!==le.state&&os.enqueueReplaceState(le,le.state,null),ss(S,V,le,ee),is(),le.state=S.memoizedState),typeof le.componentDidMount=="function"&&(S.flags|=4194308),V=!0}else if(b===null){le=S.stateNode;var Qe=S.memoizedProps,St=en(N,Qe);le.props=St;var Lt=le.context,Kt=N.contextType;Ne=jh,typeof Kt=="object"&&Kt!==null&&(Ne=ze(Kt));var Xt=N.getDerivedStateFromProps;Kt=typeof Xt=="function"||typeof le.getSnapshotBeforeUpdate=="function",Qe=S.pendingProps!==Qe,Kt||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Qe||Lt!==Ne)&&Bt(S,le,V,Ne),$e=!1;var vn=S.memoizedState;le.state=vn,ss(S,V,le,ee),is(),Lt=S.memoizedState,Qe||vn!==Lt||$e?(typeof Xt=="function"&&(Vv(S,N,Xt,V),Lt=S.memoizedState),(St=$e||s0(S,N,St,V,vn,Lt,Ne))?(Kt||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount()),typeof le.componentDidMount=="function"&&(S.flags|=4194308)):(typeof le.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=V,S.memoizedState=Lt),le.props=V,le.state=Lt,le.context=Ne,V=St):(typeof le.componentDidMount=="function"&&(S.flags|=4194308),V=!1)}else{le=S.stateNode,hi(b,S),Ne=S.memoizedProps,Kt=en(N,Ne),le.props=Kt,Xt=S.pendingProps,vn=le.context,Lt=N.contextType,St=jh,typeof Lt=="object"&&Lt!==null&&(St=ze(Lt)),Qe=N.getDerivedStateFromProps,(Lt=typeof Qe=="function"||typeof le.getSnapshotBeforeUpdate=="function")||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ne!==Xt||vn!==St)&&Bt(S,le,V,St),$e=!1,vn=S.memoizedState,le.state=vn,ss(S,V,le,ee),is();var Zn=S.memoizedState;Ne!==Xt||vn!==Zn||$e||b!==null&&b.dependencies!==null&&we(b.dependencies)?(typeof Qe=="function"&&(Vv(S,N,Qe,V),Zn=S.memoizedState),(Kt=$e||s0(S,N,Kt,V,vn,Zn,St)||b!==null&&b.dependencies!==null&&we(b.dependencies))?(Lt||typeof le.UNSAFE_componentWillUpdate!="function"&&typeof le.componentWillUpdate!="function"||(typeof le.componentWillUpdate=="function"&&le.componentWillUpdate(V,Zn,St),typeof le.UNSAFE_componentWillUpdate=="function"&&le.UNSAFE_componentWillUpdate(V,Zn,St)),typeof le.componentDidUpdate=="function"&&(S.flags|=4),typeof le.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof le.componentDidUpdate!="function"||Ne===b.memoizedProps&&vn===b.memoizedState||(S.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ne===b.memoizedProps&&vn===b.memoizedState||(S.flags|=1024),S.memoizedProps=V,S.memoizedState=Zn),le.props=V,le.state=Zn,le.context=St,V=Kt):(typeof le.componentDidUpdate!="function"||Ne===b.memoizedProps&&vn===b.memoizedState||(S.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ne===b.memoizedProps&&vn===b.memoizedState||(S.flags|=1024),V=!1)}return le=V,l0(b,S),V=(S.flags&128)!==0,le||V?(le=S.stateNode,N=V&&typeof N.getDerivedStateFromError!="function"?null:le.render(),S.flags|=1,b!==null&&V?(S.child=C(S,b.child,null,ee),S.child=C(S,null,N,ee)):Wr(b,S,N,ee),S.memoizedState=le.state,b=S.child):b=Tu(b,S,ee),b}function hl(b,S,N,V){return pt(),S.flags|=256,Wr(b,S,N,V),S.child}function Ep(b){return{baseLanes:b,cachePool:at()}}function fl(b,S,N){return b=b!==null?b.childLanes&~N:0,S&&(b|=j),b}function Ms(b,S,N){var V=S.pendingProps,ee=!1,le=(S.flags&128)!==0,Ne;if((Ne=le)||(Ne=b!==null&&b.memoizedState===null?!1:(rn.current&2)!==0),Ne&&(ee=!0,S.flags&=-129),Ne=(S.flags&32)!==0,S.flags&=-33,b===null){if(_i){if(ee?an(S):Pn(),(b=li)?(b=Fb(b,Yc),b!==null&&(S.memoizedState={dehydrated:b,treeContext:wc!==null?{id:Hu,overflow:ql}:null,retryLane:536870912,hydrationErrors:null},N=ea(b),N.return=S,S.child=N,Uo=S,li=null)):b=null,b===null)throw Pe(S);return D0(b)?S.lanes=32:S.lanes=536870912,null}var Qe=V.children;return V=V.fallback,ee?(Pn(),ee=S.mode,Qe=ji({mode:"hidden",children:Qe},ee),V=Ph(V,ee,N,null),Qe.return=S,V.return=S,Qe.sibling=V,S.child=Qe,V=S.child,V.memoizedState=Ep(N),V.childLanes=fl(b,Ne,N),S.memoizedState=qu,a0(null,V)):(an(S),xp(S,Qe))}var St=b.memoizedState;if(St!==null&&(Qe=St.dehydrated,Qe!==null)){if(le)S.flags&256?(an(S),S.flags&=-257,S=wp(b,S,N)):S.memoizedState!==null?(Pn(),S.child=b.child,S.flags|=128,S=null):(Pn(),Qe=V.fallback,ee=S.mode,V=ji({mode:"visible",children:V.children},ee),Qe=Ph(Qe,ee,N,null),Qe.flags|=2,V.return=S,Qe.return=S,V.sibling=Qe,S.child=V,C(S,b.child,null,N),V=S.child,V.memoizedState=Ep(N),V.childLanes=fl(b,Ne,N),S.memoizedState=qu,S=a0(null,V));else if(an(S),D0(Qe))Ne=Bb(Qe).digest,V=Error(i(419)),V.stack="",V.digest=Ne,Le({value:V,source:null,stack:null}),S=wp(b,S,N);else if(zi||ve(b,S,N,!1),Ne=(N&b.childLanes)!==0,zi||Ne){if(Ne=ws,Ne!==null&&(V=I(Ne,N),V!==0&&V!==St.retryLane))throw St.retryLane=V,An(b,V),Ya(Ne,b,V),Bo;sy(Qe)||S0(),S=wp(b,S,N)}else sy(Qe)?(S.flags|=192,S.child=b.child,S=null):(b=St.treeContext,gi&&(li=Rf(Qe),Uo=S,_i=!0,Yl=null,Yc=!1,b!==null&&Q(S,b)),S=xp(S,V.children),S.flags|=4096);return S}return ee?(Pn(),Qe=V.fallback,ee=S.mode,St=b.child,le=St.sibling,V=Ns(St,{mode:"hidden",children:V.children}),V.subtreeFlags=St.subtreeFlags&65011712,le!==null?Qe=Ns(le,Qe):(Qe=Ph(Qe,ee,N,null),Qe.flags|=2),Qe.return=S,V.return=S,V.sibling=Qe,S.child=V,a0(null,V),V=S.child,Qe=b.child.memoizedState,Qe===null?Qe=Ep(N):(ee=Qe.cachePool,ee!==null?(St=Ba?Ps._currentValue:Ps._currentValue2,ee=ee.parent!==St?{parent:St,pool:St}:ee):ee=at(),Qe={baseLanes:Qe.baseLanes|N,cachePool:ee}),V.memoizedState=Qe,V.childLanes=fl(b,Ne,N),S.memoizedState=qu,a0(b.child,V)):(an(S),N=b.child,b=N.sibling,N=Ns(N,{mode:"visible",children:V.children}),N.return=S,N.sibling=null,b!==null&&(Ne=S.deletions,Ne===null?(S.deletions=[b],S.flags|=16):Ne.push(b)),S.child=N,S.memoizedState=null,N)}function xp(b,S){return S=ji({mode:"visible",children:S},b.mode),S.return=b,b.child=S}function ji(b,S){return b=n(22,b,null,S),b.lanes=0,b}function wp(b,S,N){return C(S,b.child,null,N),b=xp(S,S.pendingProps.children),b.flags|=2,S.memoizedState=null,b}function h0(b,S,N){b.lanes|=S;var V=b.alternate;V!==null&&(V.lanes|=S),Ie(b.return,S,N)}function Tp(b,S,N,V,ee,le){var Ne=b.memoizedState;Ne===null?b.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:V,tail:N,tailMode:ee,treeForkCount:le}:(Ne.isBackwards=S,Ne.rendering=null,Ne.renderingStartTime=0,Ne.last=V,Ne.tail=N,Ne.tailMode=ee,Ne.treeForkCount=le)}function hd(b,S,N){var V=S.pendingProps,ee=V.revealOrder,le=V.tail;V=V.children;var Ne=rn.current,Qe=(Ne&2)!==0;if(Qe?(Ne=Ne&1|2,S.flags|=128):Ne&=1,p(rn,Ne),Wr(b,S,V,N),V=_i?kd:0,!Qe&&b!==null&&(b.flags&128)!==0)e:for(b=S.child;b!==null;){if(b.tag===13)b.memoizedState!==null&&h0(b,N,S);else if(b.tag===19)h0(b,N,S);else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===S)break e;for(;b.sibling===null;){if(b.return===null||b.return===S)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}switch(ee){case"forwards":for(N=S.child,ee=null;N!==null;)b=N.alternate,b!==null&&fr(b)===null&&(ee=N),N=N.sibling;N=ee,N===null?(ee=S.child,S.child=null):(ee=N.sibling,N.sibling=null),Tp(S,!1,ee,N,le,V);break;case"backwards":case"unstable_legacy-backwards":for(N=null,ee=S.child,S.child=null;ee!==null;){if(b=ee.alternate,b!==null&&fr(b)===null){S.child=ee;break}b=ee.sibling,ee.sibling=N,N=ee,ee=b}Tp(S,!0,N,null,le,V);break;case"together":Tp(S,!1,null,null,void 0,V);break;default:S.memoizedState=null}return S.child}function Tu(b,S,N){if(b!==null&&(S.dependencies=b.dependencies),w|=S.lanes,(N&S.childLanes)===0)if(b!==null){if(ve(b,S,N,!1),(N&S.childLanes)===0)return null}else return null;if(b!==null&&S.child!==b.child)throw Error(i(153));if(S.child!==null){for(b=S.child,N=Ns(b,b.pendingProps),S.child=N,N.return=S;b.sibling!==null;)b=b.sibling,N=N.sibling=Ns(b,b.pendingProps),N.return=S;N.sibling=null}return S.child}function fd(b,S){return(b.lanes&S)!==0?!0:(b=b.dependencies,!!(b!==null&&we(b)))}function gf(b,S,N){switch(S.tag){case 3:ie(S,S.stateNode.containerInfo),Ve(S,Ps,b.memoizedState.cache),pt();break;case 27:case 5:Te(S);break;case 4:ie(S,S.stateNode.containerInfo);break;case 10:Ve(S,S.type,S.memoizedProps.value);break;case 31:if(S.memoizedState!==null)return S.flags|=128,In(S),null;break;case 13:var V=S.memoizedState;if(V!==null)return V.dehydrated!==null?(an(S),S.flags|=128,null):(N&S.child.childLanes)!==0?Ms(b,S,N):(an(S),b=Tu(b,S,N),b!==null?b.sibling:null);an(S);break;case 19:var ee=(b.flags&128)!==0;if(V=(N&S.childLanes)!==0,V||(ve(b,S,N,!1),V=(N&S.childLanes)!==0),ee){if(V)return hd(b,S,N);S.flags|=128}if(ee=S.memoizedState,ee!==null&&(ee.rendering=null,ee.tail=null,ee.lastEffect=null),p(rn,rn.current),V)break;return null;case 22:return S.lanes=0,o0(b,S,N,S.pendingProps);case 24:Ve(S,Ps,b.memoizedState.cache)}return Tu(b,S,N)}function Hl(b,S,N){if(b!==null)if(b.memoizedProps!==S.pendingProps)zi=!0;else{if(!fd(b,N)&&(S.flags&128)===0)return zi=!1,gf(b,S,N);zi=(b.flags&131072)!==0}else zi=!1,_i&&(S.flags&1048576)!==0&&H(S,kd,S.index);switch(S.lanes=0,S.tag){case 16:e:{var V=S.pendingProps;if(b=xt(S.elementType),S.type=b,typeof b=="function")Ka(b)?(V=en(b,V),S.tag=1,S=bb(null,S,b,V,N)):(S.tag=0,S=n_(null,S,b,V,N));else{if(b!=null){var ee=b.$$typeof;if(ee===Ec){S.tag=11,S=t_(null,S,b,V,N);break e}else if(ee===Lp){S.tag=14,S=yb(null,S,b,V,N);break e}}throw S=h(b)||b,Error(i(306,S,""))}}return S;case 0:return n_(b,S,S.type,S.pendingProps,N);case 1:return V=S.type,ee=en(V,S.pendingProps),bb(b,S,V,ee,N);case 3:e:{if(ie(S,S.stateNode.containerInfo),b===null)throw Error(i(387));var le=S.pendingProps;ee=S.memoizedState,V=ee.element,hi(b,S),ss(S,le,null,N);var Ne=S.memoizedState;if(le=Ne.cache,Ve(S,Ps,le),le!==ee.cache&&ae(S,[Ps],N,!0),is(),le=Ne.element,gi&&ee.isDehydrated)if(ee={element:le,isDehydrated:!1,cache:Ne.cache},S.updateQueue.baseState=ee,S.memoizedState=ee,S.flags&256){S=hl(b,S,le,N);break e}else if(le!==V){V=te(Error(i(424)),S),Le(V),S=hl(b,S,le,N);break e}else for(gi&&(li=Cf(S.stateNode.containerInfo),Uo=S,_i=!0,Yl=null,Yc=!0),N=B(S,null,le,N),S.child=N;N;)N.flags=N.flags&-3|4096,N=N.sibling;else{if(pt(),le===V){S=Tu(b,S,N);break e}Wr(b,S,le,N)}S=S.child}return S;case 26:if(_l)return l0(b,S),b===null?(N=uy(S.type,null,S.pendingProps,null))?S.memoizedState=N:_i||(S.stateNode=kf(S.type,S.pendingProps,Mf.current,S)):S.memoizedState=uy(S.type,b.memoizedProps,S.pendingProps,b.memoizedState),null;case 27:if(Gs)return Te(S),b===null&&Gs&&_i&&(V=S.stateNode=gs(S.type,S.pendingProps,Mf.current,sa.current,!1),Uo=S,Yc=!0,li=w_(S.type,V,li)),Wr(b,S,S.pendingProps.children,N),l0(b,S),b===null&&(S.flags|=4194304),S.child;case 5:return b===null&&_i&&(z0(S.type,S.pendingProps,sa.current),(ee=V=li)&&(V=Mx(V,S.type,S.pendingProps,Yc),V!==null?(S.stateNode=V,Uo=S,li=Gp(V),Yc=!1,ee=!0):ee=!1),ee||Pe(S)),Te(S),ee=S.type,le=S.pendingProps,Ne=b!==null?b.memoizedProps:null,V=le.children,Fp(ee,le)?V=null:Ne!==null&&Fp(ee,Ne)&&(S.flags|=32),S.memoizedState!==null&&(ee=Hr(b,S,Gr,null,null,N),Ba?Lh._currentValue=ee:Lh._currentValue2=ee),l0(b,S),Wr(b,S,V,N),S.child;case 6:return b===null&&_i&&($b(S.pendingProps,sa.current),(b=N=li)&&(N=Ox(N,S.pendingProps,Yc),N!==null?(S.stateNode=N,Uo=S,li=null,b=!0):b=!1),b||Pe(S)),null;case 13:return Ms(b,S,N);case 4:return ie(S,S.stateNode.containerInfo),V=S.pendingProps,b===null?S.child=C(S,null,V,N):Wr(b,S,V,N),S.child;case 11:return t_(b,S,S.type,S.pendingProps,N);case 7:return Wr(b,S,S.pendingProps,N),S.child;case 8:return Wr(b,S,S.pendingProps.children,N),S.child;case 12:return Wr(b,S,S.pendingProps.children,N),S.child;case 10:return V=S.pendingProps,Ve(S,S.type,V.value),Wr(b,S,V.children,N),S.child;case 9:return ee=S.type._context,V=S.pendingProps.children,pe(S),ee=ze(ee),V=V(ee),S.flags|=1,Wr(b,S,V,N),S.child;case 14:return yb(b,S,S.type,S.pendingProps,N);case 15:return zc(b,S,S.type,S.pendingProps,N);case 19:return hd(b,S,N);case 31:return Yi(b,S,N);case 22:return o0(b,S,N,S.pendingProps);case 24:return pe(S),V=ze(Ps),b===null?(ee=Fe(),ee===null&&(ee=ws,le=tt(),ee.pooledCache=le,le.refCount++,le!==null&&(ee.pooledCacheLanes|=N),ee=le),S.memoizedState={parent:V,cache:ee},ns(S),Ve(S,Ps,ee)):((b.lanes&N)!==0&&(hi(b,S),ss(S,null,null,N),is()),ee=b.memoizedState,le=S.memoizedState,ee.parent!==V?(ee={parent:V,cache:V},S.memoizedState=ee,S.lanes===0&&(S.memoizedState=S.updateQueue.baseState=ee),Ve(S,Ps,V)):(V=le.cache,Ve(S,Ps,V),V!==ee.cache&&ae(S,[Ps],N,!0))),Wr(b,S,S.pendingProps.children,N),S.child;case 29:throw S.pendingProps}throw Error(i(156,S.tag))}function dl(b){b.flags|=4}function f0(b){ml&&(b.flags|=8)}function Sb(b,S){if(b!==null&&b.child===S.child)return!1;if((S.flags&16)!==0)return!0;for(b=S.child;b!==null;){if((b.flags&8218)!==0||(b.subtreeFlags&8218)!==0)return!0;b=b.sibling}return!1}function Ap(b,S,N,V){if(na)for(N=S.child;N!==null;){if(N.tag===5||N.tag===6)k0(b,N.stateNode);else if(!(N.tag===4||Gs&&N.tag===27)&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===S)break;for(;N.sibling===null;){if(N.return===null||N.return===S)return;N=N.return}N.sibling.return=N.return,N=N.sibling}else if(ml)for(var ee=S.child;ee!==null;){if(ee.tag===5){var le=ee.stateNode;N&&V&&(le=Lb(le,ee.type,ee.memoizedProps)),k0(b,le)}else if(ee.tag===6)le=ee.stateNode,N&&V&&(le=Ub(le,ee.memoizedProps)),k0(b,le);else if(ee.tag!==4){if(ee.tag===22&&ee.memoizedState!==null)le=ee.child,le!==null&&(le.return=ee),Ap(b,ee,!0,!0);else if(ee.child!==null){ee.child.return=ee,ee=ee.child;continue}}if(ee===S)break;for(;ee.sibling===null;){if(ee.return===null||ee.return===S)return;ee=ee.return}ee.sibling.return=ee.return,ee=ee.sibling}}function d0(b,S,N,V){var ee=!1;if(ml)for(var le=S.child;le!==null;){if(le.tag===5){var Ne=le.stateNode;N&&V&&(Ne=Lb(Ne,le.type,le.memoizedProps)),S_(b,Ne)}else if(le.tag===6)Ne=le.stateNode,N&&V&&(Ne=Ub(Ne,le.memoizedProps)),S_(b,Ne);else if(le.tag!==4){if(le.tag===22&&le.memoizedState!==null)ee=le.child,ee!==null&&(ee.return=le),d0(b,le,!0,!0),ee=!0;else if(le.child!==null){le.child.return=le,le=le.child;continue}}if(le===S)break;for(;le.sibling===null;){if(le.return===null||le.return===S)return ee;le=le.return}le.sibling.return=le.return,le=le.sibling}return ee}function Cp(b,S){if(ml&&Sb(b,S)){b=S.stateNode;var N=b.containerInfo,V=iy();d0(V,S,!1,!1),b.pendingChildren=V,dl(S),Cx(N,V)}}function r_(b,S,N,V){if(na)b.memoizedProps!==V&&dl(S);else if(ml){var ee=b.stateNode,le=b.memoizedProps;if((b=Sb(b,S))||le!==V){var Ne=sa.current;le=mo(ee,N,le,V,!b,null),le===ee?S.stateNode=ee:(f0(S),Lu(le,N,V,Ne)&&dl(S),S.stateNode=le,b&&Ap(le,S,!1,!1))}else S.stateNode=ee}}function dd(b,S,N,V,ee){if((b.mode&32)!==0&&(N===null?xa(S,V):ty(S,N,V))){if(b.flags|=16777216,(ee&335544128)===ee||M0(S,V))if(ny(b.stateNode,S,V))b.flags|=8192;else if(xb())b.flags|=8192;else throw Qs=Hh,gy}else b.flags&=-16777217}function i_(b,S){if(hy(S)){if(b.flags|=16777216,!vl(S))if(xb())b.flags|=8192;else throw Qs=Hh,gy}else b.flags&=-16777217}function s_(b,S){S!==null&&(b.flags|=4),b.flags&16384&&(S=b.tag!==22?E():536870912,b.lanes|=S,$|=S)}function $s(b,S){if(!_i)switch(b.tailMode){case"hidden":S=b.tail;for(var N=null;S!==null;)S.alternate!==null&&(N=S),S=S.sibling;N===null?b.tail=null:N.sibling=null;break;case"collapsed":N=b.tail;for(var V=null;N!==null;)N.alternate!==null&&(V=N),N=N.sibling;V===null?S||b.tail===null?b.tail=null:b.tail.sibling=null:V.sibling=null}}function qr(b){var S=b.alternate!==null&&b.alternate.child===b.child,N=0,V=0;if(S)for(var ee=b.child;ee!==null;)N|=ee.lanes|ee.childLanes,V|=ee.subtreeFlags&65011712,V|=ee.flags&65011712,ee.return=b,ee=ee.sibling;else for(ee=b.child;ee!==null;)N|=ee.lanes|ee.childLanes,V|=ee.subtreeFlags,V|=ee.flags,ee.return=b,ee=ee.sibling;return b.subtreeFlags|=V,b.childLanes=N,S}function Eb(b,S,N){var V=S.pendingProps;switch(Z(S),S.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qr(S),null;case 1:return qr(S),null;case 3:return N=S.stateNode,V=null,b!==null&&(V=b.memoizedState.cache),S.memoizedState.cache!==V&&(S.flags|=2048),De(Ps),ge(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(b===null||b.child===null)&&(lt(S)?dl(S):b===null||b.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,ne())),Cp(b,S),qr(S),null;case 26:if(_l){var ee=S.type,le=S.memoizedState;return b===null?(dl(S),le!==null?(qr(S),i_(S,le)):(qr(S),dd(S,ee,null,V,N))):le?le!==b.memoizedState?(dl(S),qr(S),i_(S,le)):(qr(S),S.flags&=-16777217):(le=b.memoizedProps,na?le!==V&&dl(S):r_(b,S,ee,V),qr(S),dd(S,ee,le,V,N)),null}case 27:if(Gs){if(be(S),N=Mf.current,ee=S.type,b!==null&&S.stateNode!=null)na?b.memoizedProps!==V&&dl(S):r_(b,S,ee,V);else{if(!V){if(S.stateNode===null)throw Error(i(166));return qr(S),null}b=sa.current,lt(S)?Ge(S,b):(b=gs(ee,V,N,b,!0),S.stateNode=b,dl(S))}return qr(S),null}case 5:if(be(S),ee=S.type,b!==null&&S.stateNode!=null)r_(b,S,ee,V);else{if(!V){if(S.stateNode===null)throw Error(i(166));return qr(S),null}if(le=sa.current,lt(S))Ge(S,le),A_(S.stateNode,ee,V,le)&&(S.flags|=64);else{var Ne=Ab(ee,V,Mf.current,le,S);f0(S),Ap(Ne,S,!1,!1),S.stateNode=Ne,Lu(Ne,ee,V,le)&&dl(S)}}return qr(S),dd(S,S.type,b===null?null:b.memoizedProps,S.pendingProps,N),null;case 6:if(b&&S.stateNode!=null)N=b.memoizedProps,na?N!==V&&dl(S):ml&&(N!==V?(b=Mf.current,N=sa.current,f0(S),S.stateNode=v_(V,b,N,S)):S.stateNode=b.stateNode);else{if(typeof V!="string"&&S.stateNode===null)throw Error(i(166));if(b=Mf.current,N=sa.current,lt(S)){if(!gi)throw Error(i(176));if(b=S.stateNode,N=S.memoizedProps,V=null,ee=Uo,ee!==null)switch(ee.tag){case 27:case 5:V=ee.memoizedProps}U0(b,N,S,V)||Pe(S,!0)}else f0(S),S.stateNode=v_(V,b,N,S)}return qr(S),null;case 31:if(N=S.memoizedState,b===null||b.memoizedState!==null){if(V=lt(S),N!==null){if(b===null){if(!V)throw Error(i(318));if(!gi)throw Error(i(556));if(b=S.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(557));jb(b,S)}else pt(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;qr(S),b=!1}else N=ne(),b!==null&&b.memoizedState!==null&&(b.memoizedState.hydrationErrors=N),b=!0;if(!b)return S.flags&256?(tr(S),S):(tr(S),null);if((S.flags&128)!==0)throw Error(i(558))}return qr(S),null;case 13:if(V=S.memoizedState,b===null||b.memoizedState!==null&&b.memoizedState.dehydrated!==null){if(ee=lt(S),V!==null&&V.dehydrated!==null){if(b===null){if(!ee)throw Error(i(318));if(!gi)throw Error(i(344));if(ee=S.memoizedState,ee=ee!==null?ee.dehydrated:null,!ee)throw Error(i(317));Fh(ee,S)}else pt(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;qr(S),ee=!1}else ee=ne(),b!==null&&b.memoizedState!==null&&(b.memoizedState.hydrationErrors=ee),ee=!0;if(!ee)return S.flags&256?(tr(S),S):(tr(S),null)}return tr(S),(S.flags&128)!==0?(S.lanes=N,S):(N=V!==null,b=b!==null&&b.memoizedState!==null,N&&(V=S.child,ee=null,V.alternate!==null&&V.alternate.memoizedState!==null&&V.alternate.memoizedState.cachePool!==null&&(ee=V.alternate.memoizedState.cachePool.pool),le=null,V.memoizedState!==null&&V.memoizedState.cachePool!==null&&(le=V.memoizedState.cachePool.pool),le!==ee&&(V.flags|=2048)),N!==b&&N&&(S.child.flags|=8192),s_(S,S.updateQueue),qr(S),null);case 4:return ge(),Cp(b,S),b===null&&vr(S.stateNode.containerInfo),qr(S),null;case 10:return De(S.type),qr(S),null;case 19:if(d(rn),V=S.memoizedState,V===null)return qr(S),null;if(ee=(S.flags&128)!==0,le=V.rendering,le===null)if(ee)$s(V,!1);else{if(P!==0||b!==null&&(b.flags&128)!==0)for(b=S.child;b!==null;){if(le=fr(b),le!==null){for(S.flags|=128,$s(V,!1),b=le.updateQueue,S.updateQueue=b,s_(S,b),S.subtreeFlags=0,b=N,N=S.child;N!==null;)Dp(N,b),N=N.sibling;return p(rn,rn.current&1|2),_i&&re(S,V.treeForkCount),S.child}b=b.sibling}V.tail!==null&&Fr()>Ae&&(S.flags|=128,ee=!0,$s(V,!1),S.lanes=4194304)}else{if(!ee)if(b=fr(le),b!==null){if(S.flags|=128,ee=!0,b=b.updateQueue,S.updateQueue=b,s_(S,b),$s(V,!0),V.tail===null&&V.tailMode==="hidden"&&!le.alternate&&!_i)return qr(S),null}else 2*Fr()-V.renderingStartTime>Ae&&N!==536870912&&(S.flags|=128,ee=!0,$s(V,!1),S.lanes=4194304);V.isBackwards?(le.sibling=S.child,S.child=le):(b=V.last,b!==null?b.sibling=le:S.child=le,V.last=le)}return V.tail!==null?(b=V.tail,V.rendering=b,V.tail=b.sibling,V.renderingStartTime=Fr(),b.sibling=null,N=rn.current,p(rn,ee?N&1|2:N&1),_i&&re(S,V.treeForkCount),b):(qr(S),null);case 22:case 23:return tr(S),yt(),V=S.memoizedState!==null,b!==null?b.memoizedState!==null!==V&&(S.flags|=8192):V&&(S.flags|=8192),V?(N&536870912)!==0&&(S.flags&128)===0&&(qr(S),S.subtreeFlags&6&&(S.flags|=8192)):qr(S),N=S.updateQueue,N!==null&&s_(S,N.retryQueue),N=null,b!==null&&b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(N=b.memoizedState.cachePool.pool),V=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(V=S.memoizedState.cachePool.pool),V!==N&&(S.flags|=2048),b!==null&&d(Ds),null;case 24:return N=null,b!==null&&(N=b.memoizedState.cache),S.memoizedState.cache!==N&&(S.flags|=2048),De(Ps),qr(S),null;case 25:return null;case 30:return null}throw Error(i(156,S.tag))}function Ex(b,S){switch(Z(S),S.tag){case 1:return b=S.flags,b&65536?(S.flags=b&-65537|128,S):null;case 3:return De(Ps),ge(),b=S.flags,(b&65536)!==0&&(b&128)===0?(S.flags=b&-65537|128,S):null;case 26:case 27:case 5:return be(S),null;case 31:if(S.memoizedState!==null){if(tr(S),S.alternate===null)throw Error(i(340));pt()}return b=S.flags,b&65536?(S.flags=b&-65537|128,S):null;case 13:if(tr(S),b=S.memoizedState,b!==null&&b.dehydrated!==null){if(S.alternate===null)throw Error(i(340));pt()}return b=S.flags,b&65536?(S.flags=b&-65537|128,S):null;case 19:return d(rn),null;case 4:return ge(),null;case 10:return De(S.type),null;case 22:case 23:return tr(S),yt(),b!==null&&d(Ds),b=S.flags,b&65536?(S.flags=b&-65537|128,S):null;case 24:return De(Ps),null;case 25:return null;default:return null}}function p0(b,S){switch(Z(S),S.tag){case 3:De(Ps),ge();break;case 26:case 27:case 5:be(S);break;case 4:ge();break;case 31:S.memoizedState!==null&&tr(S);break;case 13:tr(S);break;case 19:d(rn);break;case 10:De(S.type);break;case 22:case 23:tr(S),yt(),b!==null&&d(Ds);break;case 24:De(Ps)}}function wn(b,S){try{var N=S.updateQueue,V=N!==null?N.lastEffect:null;if(V!==null){var ee=V.next;N=ee;do{if((N.tag&b)===b){V=void 0;var le=N.create,Ne=N.inst;V=le(),Ne.destroy=V}N=N.next}while(N!==ee)}}catch(Qe){Qt(S,S.return,Qe)}}function hn(b,S,N){try{var V=S.updateQueue,ee=V!==null?V.lastEffect:null;if(ee!==null){var le=ee.next;V=le;do{if((V.tag&b)===b){var Ne=V.inst,Qe=Ne.destroy;if(Qe!==void 0){Ne.destroy=void 0,ee=S;var St=N,Lt=Qe;try{Lt()}catch(Kt){Qt(ee,St,Kt)}}}V=V.next}while(V!==le)}}catch(Kt){Qt(S,S.return,Kt)}}function Sn(b){var S=b.updateQueue;if(S!==null){var N=b.stateNode;try{vt(S,N)}catch(V){Qt(b,b.return,V)}}}function pd(b,S,N){N.props=en(b.type,b.memoizedProps),N.state=b.memoizedState;try{N.componentWillUnmount()}catch(V){Qt(b,S,V)}}function $r(b,S){try{var N=b.ref;if(N!==null){switch(b.tag){case 26:case 27:case 5:var V=Du(b.stateNode);break;case 30:V=b.stateNode;break;default:V=b.stateNode}typeof N=="function"?b.refCleanup=N(V):N.current=V}}catch(ee){Qt(b,S,ee)}}function Cr(b,S){var N=b.ref,V=b.refCleanup;if(N!==null)if(typeof V=="function")try{V()}catch(ee){Qt(b,S,ee)}finally{b.refCleanup=null,b=b.alternate,b!=null&&(b.refCleanup=null)}else if(typeof N=="function")try{N(null)}catch(ee){Qt(b,S,ee)}else N.current=null}function Sa(b){var S=b.type,N=b.memoizedProps,V=b.stateNode;try{Cd(V,S,N,b)}catch(ee){Qt(b,b.return,ee)}}function Au(b,S,N){try{Rb(b.stateNode,b.type,N,S,b)}catch(V){Qt(b,b.return,V)}}function _f(b){return b.tag===5||b.tag===3||(_l?b.tag===26:!1)||(Gs?b.tag===27&&Wl(b.type):!1)||b.tag===4}function Rp(b){e:for(;;){for(;b.sibling===null;){if(b.return===null||_f(b.return))return null;b=b.return}for(b.sibling.return=b.return,b=b.sibling;b.tag!==5&&b.tag!==6&&b.tag!==18;){if(Gs&&b.tag===27&&Wl(b.type)||b.flags&2||b.child===null||b.tag===4)continue e;b.child.return=b,b=b.child}if(!(b.flags&2))return b.stateNode}}function md(b,S,N){var V=b.tag;if(V===5||V===6)b=b.stateNode,S?Mb(N,b,S):Cb(N,b);else if(V!==4&&(Gs&&V===27&&Wl(b.type)&&(N=b.stateNode,S=null),b=b.child,b!==null))for(md(b,S,N),b=b.sibling;b!==null;)md(b,S,N),b=b.sibling}function m0(b,S,N){var V=b.tag;if(V===5||V===6)b=b.stateNode,S?kb(N,b,S):P0(N,b);else if(V!==4&&(Gs&&V===27&&Wl(b.type)&&(N=b.stateNode),b=b.child,b!==null))for(m0(b,S,N),b=b.sibling;b!==null;)m0(b,S,N),b=b.sibling}function g0(b,S,N){b=b.containerInfo;try{E_(b,N)}catch(V){Qt(S,S.return,V)}}function Hv(b){var S=b.stateNode,N=b.memoizedProps;try{Zs(b.type,N,S,b)}catch(V){Qt(b,b.return,V)}}function kp(b,S){for(Qv(b.containerInfo),go=S;go!==null;)if(b=go,S=b.child,(b.subtreeFlags&1028)!==0&&S!==null)S.return=b,go=S;else for(;go!==null;){b=go;var N=b.alternate;switch(S=b.flags,b.tag){case 0:if((S&4)!==0&&(S=b.updateQueue,S=S!==null?S.events:null,S!==null))for(var V=0;V<S.length;V++){var ee=S[V];ee.ref.impl=ee.nextImpl}break;case 11:case 15:break;case 1:if((S&1024)!==0&&N!==null){S=void 0,V=b,ee=N.memoizedProps,N=N.memoizedState;var le=V.stateNode;try{var Ne=en(V.type,ee);S=le.getSnapshotBeforeUpdate(Ne,N),le.__reactInternalSnapshotBeforeUpdate=S}catch(Qe){Qt(V,V.return,Qe)}}break;case 3:(S&1024)!==0&&na&&Db(b.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((S&1024)!==0)throw Error(i(163))}if(S=b.sibling,S!==null){S.return=b.return,go=S;break}go=b.return}}function vf(b,S,N){var V=N.flags;switch(N.tag){case 0:case 11:case 15:Ru(b,N),V&4&&wn(5,N);break;case 1:if(Ru(b,N),V&4)if(b=N.stateNode,S===null)try{b.componentDidMount()}catch(Ne){Qt(N,N.return,Ne)}else{var ee=en(N.type,S.memoizedProps);S=S.memoizedState;try{b.componentDidUpdate(ee,S,b.__reactInternalSnapshotBeforeUpdate)}catch(Ne){Qt(N,N.return,Ne)}}V&64&&Sn(N),V&512&&$r(N,N.return);break;case 3:if(Ru(b,N),V&64&&(V=N.updateQueue,V!==null)){if(b=null,N.child!==null)switch(N.child.tag){case 27:case 5:b=Du(N.child.stateNode);break;case 1:b=N.child.stateNode}try{vt(V,b)}catch(Ne){Qt(N,N.return,Ne)}}break;case 27:Gs&&S===null&&V&4&&Hv(N);case 26:case 5:if(Ru(b,N),S===null){if(V&4)Sa(N);else if(V&64){b=N.type,S=N.memoizedProps,ee=N.stateNode;try{B0(ee,b,S,N)}catch(Ne){Qt(N,N.return,Ne)}}}V&512&&$r(N,N.return);break;case 12:Ru(b,N);break;case 31:Ru(b,N),V&4&&yf(b,N);break;case 13:Ru(b,N),V&4&&Wa(b,N),V&64&&(V=N.memoizedState,V!==null&&(V=V.dehydrated,V!==null&&(N=x0.bind(null,N),Rx(V,N))));break;case 22:if(V=N.memoizedState!==null||Kc,!V){S=S!==null&&S.memoizedState!==null||Us,ee=Kc;var le=Us;Kc=V,(Us=S)&&!le?Rh(b,N,(N.subtreeFlags&8772)!==0):Ru(b,N),Kc=ee,Us=le}break;case 30:break;default:Ru(b,N)}}function o_(b){var S=b.alternate;S!==null&&(b.alternate=null,o_(S)),b.child=null,b.deletions=null,b.sibling=null,b.tag===5&&(S=b.stateNode,S!==null&&Gl(S)),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}function Ue(b,S,N){for(N=N.child;N!==null;)Ch(b,S,N),N=N.sibling}function Ch(b,S,N){if(Za&&typeof Za.onCommitFiberUnmount=="function")try{Za.onCommitFiberUnmount(W0,N)}catch{}switch(N.tag){case 26:if(_l){Us||Cr(N,S),Ue(b,S,N),N.memoizedState?Ur(N.memoizedState):N.stateNode&&Js(N.stateNode);break}case 27:if(Gs){Us||Cr(N,S);var V=_o,ee=Ta;Wl(N.type)&&(_o=N.stateNode,Ta=!1),Ue(b,S,N),fy(N.stateNode),_o=V,Ta=ee;break}case 5:Us||Cr(N,S);case 6:if(na){if(V=_o,ee=Ta,_o=null,Ue(b,S,N),_o=V,Ta=ee,_o!==null)if(Ta)try{Ob(_o,N.stateNode)}catch(le){Qt(N,S,le)}else try{b_(_o,N.stateNode)}catch(le){Qt(N,S,le)}}else Ue(b,S,N);break;case 18:na&&_o!==null&&(Ta?Hb(_o,N.stateNode):ly(_o,N.stateNode));break;case 4:na?(V=_o,ee=Ta,_o=N.stateNode.containerInfo,Ta=!0,Ue(b,S,N),_o=V,Ta=ee):(ml&&g0(N.stateNode,N,iy()),Ue(b,S,N));break;case 0:case 11:case 14:case 15:hn(2,N,S),Us||hn(4,N,S),Ue(b,S,N);break;case 1:Us||(Cr(N,S),V=N.stateNode,typeof V.componentWillUnmount=="function"&&pd(N,S,V)),Ue(b,S,N);break;case 21:Ue(b,S,N);break;case 22:Us=(V=Us)||N.memoizedState!==null,Ue(b,S,N),Us=V;break;default:Ue(b,S,N)}}function yf(b,S){if(gi&&S.memoizedState===null&&(b=S.alternate,b!==null&&(b=b.memoizedState,b!==null))){b=b.dehydrated;try{ay(b)}catch(N){Qt(S,S.return,N)}}}function Wa(b,S){if(gi&&S.memoizedState===null&&(b=S.alternate,b!==null&&(b=b.memoizedState,b!==null&&(b=b.dehydrated,b!==null))))try{T_(b)}catch(N){Qt(S,S.return,N)}}function ci(b){switch(b.tag){case 31:case 13:case 19:var S=b.stateNode;return S===null&&(S=b.stateNode=new Kl),S;case 22:return b=b.stateNode,S=b._retryCache,S===null&&(S=b._retryCache=new Kl),S;default:throw Error(i(435,b.tag))}}function $l(b,S){var N=ci(b);S.forEach(function(V){if(!N.has(V)){N.add(V);var ee=Kv.bind(null,b,V);V.then(ee,ee)}})}function Os(b,S){var N=S.deletions;if(N!==null)for(var V=0;V<N.length;V++){var ee=N[V],le=b,Ne=S;if(na){var Qe=Ne;e:for(;Qe!==null;){switch(Qe.tag){case 27:if(Gs){if(Wl(Qe.type)){_o=Qe.stateNode,Ta=!1;break e}break}case 5:_o=Qe.stateNode,Ta=!1;break e;case 3:case 4:_o=Qe.stateNode.containerInfo,Ta=!0;break e}Qe=Qe.return}if(_o===null)throw Error(i(160));Ch(le,Ne,ee),_o=null,Ta=!1}else Ch(le,Ne,ee);le=ee.alternate,le!==null&&(le.return=null),ee.return=null}if(S.subtreeFlags&13886)for(S=S.child;S!==null;)Cu(S,b),S=S.sibling}function Cu(b,S){var N=b.alternate,V=b.flags;switch(b.tag){case 0:case 11:case 14:case 15:Os(S,b),fo(b),V&4&&(hn(3,b,b.return),wn(3,b),hn(5,b,b.return));break;case 1:Os(S,b),fo(b),V&512&&(Us||N===null||Cr(N,N.return)),V&64&&Kc&&(b=b.updateQueue,b!==null&&(V=b.callbacks,V!==null&&(N=b.shared.hiddenCallbacks,b.shared.hiddenCallbacks=N===null?V:N.concat(V))));break;case 26:if(_l){var ee=as;if(Os(S,b),fo(b),V&512&&(Us||N===null||Cr(N,N.return)),V&4){V=N!==null?N.memoizedState:null;var le=b.memoizedState;N===null?le===null?b.stateNode===null?b.stateNode=Nx(ee,b.type,b.memoizedProps,b):Ja(ee,b.type,b.stateNode):b.stateNode=Wc(ee,le,b.memoizedProps):V!==le?(V===null?N.stateNode!==null&&Js(N.stateNode):Ur(V),le===null?Ja(ee,b.type,b.stateNode):Wc(ee,le,b.memoizedProps)):le===null&&b.stateNode!==null&&Au(b,b.memoizedProps,N.memoizedProps)}break}case 27:if(Gs){Os(S,b),fo(b),V&512&&(Us||N===null||Cr(N,N.return)),N!==null&&V&4&&Au(b,b.memoizedProps,N.memoizedProps);break}case 5:if(Os(S,b),fo(b),V&512&&(Us||N===null||Cr(N,N.return)),na){if(b.flags&32){ee=b.stateNode;try{ry(ee)}catch(Xt){Qt(b,b.return,Xt)}}V&4&&b.stateNode!=null&&(ee=b.memoizedProps,Au(b,ee,N!==null?N.memoizedProps:ee)),V&1024&&(Id=!0)}else ml&&b.alternate!==null&&(b.alternate.stateNode=b.stateNode);break;case 6:if(Os(S,b),fo(b),V&4&&na){if(b.stateNode===null)throw Error(i(162));V=b.memoizedProps,N=N!==null?N.memoizedProps:V,ee=b.stateNode;try{ju(ee,N,V)}catch(Xt){Qt(b,b.return,Xt)}}break;case 3:if(_l?(Px(),ee=as,as=V0(S.containerInfo),Os(S,b),as=ee):Os(S,b),fo(b),V&4){if(na&&gi&&N!==null&&N.memoizedState.isDehydrated)try{oy(S.containerInfo)}catch(Xt){Qt(b,b.return,Xt)}if(ml){V=S.containerInfo,N=S.pendingChildren;try{E_(V,N)}catch(Xt){Qt(b,b.return,Xt)}}}Id&&(Id=!1,Vc(b));break;case 4:_l?(N=as,as=V0(b.stateNode.containerInfo),Os(S,b),fo(b),as=N):(Os(S,b),fo(b)),V&4&&ml&&g0(b.stateNode,b,b.stateNode.pendingChildren);break;case 12:Os(S,b),fo(b);break;case 31:Os(S,b),fo(b),V&4&&(V=b.updateQueue,V!==null&&(b.updateQueue=null,$l(b,V)));break;case 13:Os(S,b),fo(b),b.child.flags&8192&&b.memoizedState!==null!=(N!==null&&N.memoizedState!==null)&&(ce=Fr()),V&4&&(V=b.updateQueue,V!==null&&(b.updateQueue=null,$l(b,V)));break;case 22:ee=b.memoizedState!==null;var Ne=N!==null&&N.memoizedState!==null,Qe=Kc,St=Us;if(Kc=Qe||ee,Us=St||Ne,Os(S,b),Us=St,Kc=Qe,fo(b),V&8192&&(S=b.stateNode,S._visibility=ee?S._visibility&-2:S._visibility|1,ee&&(N===null||Ne||Kc||Us||bf(b)),na)){e:if(N=null,na)for(S=b;;){if(S.tag===5||_l&&S.tag===26){if(N===null){Ne=N=S;try{le=Ne.stateNode,ee?Ib(le):Ax(Ne.stateNode,Ne.memoizedProps)}catch(Xt){Qt(Ne,Ne.return,Xt)}}}else if(S.tag===6){if(N===null){Ne=S;try{var Lt=Ne.stateNode;ee?Nb(Lt):Pb(Lt,Ne.memoizedProps)}catch(Xt){Qt(Ne,Ne.return,Xt)}}}else if(S.tag===18){if(N===null){Ne=S;try{var Kt=Ne.stateNode;ee?F0(Kt):j0(Ne.stateNode)}catch(Xt){Qt(Ne,Ne.return,Xt)}}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===b)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===b)break e;for(;S.sibling===null;){if(S.return===null||S.return===b)break e;N===S&&(N=null),S=S.return}N===S&&(N=null),S.sibling.return=S.return,S=S.sibling}}V&4&&(V=b.updateQueue,V!==null&&(N=V.retryQueue,N!==null&&(V.retryQueue=null,$l(b,N))));break;case 19:Os(S,b),fo(b),V&4&&(V=b.updateQueue,V!==null&&(b.updateQueue=null,$l(b,V)));break;case 30:break;case 21:break;default:Os(S,b),fo(b)}}function fo(b){var S=b.flags;if(S&2){try{for(var N,V=b.return;V!==null;){if(_f(V)){N=V;break}V=V.return}if(na){if(N==null)throw Error(i(160));switch(N.tag){case 27:if(Gs){var ee=N.stateNode,le=Rp(b);m0(b,le,ee);break}case 5:var Ne=N.stateNode;N.flags&32&&(ry(Ne),N.flags&=-33);var Qe=Rp(b);m0(b,Qe,Ne);break;case 3:case 4:var St=N.stateNode.containerInfo,Lt=Rp(b);md(b,Lt,St);break;default:throw Error(i(161))}}}catch(Kt){Qt(b,b.return,Kt)}b.flags&=-3}S&4096&&(b.flags&=-4097)}function Vc(b){if(b.subtreeFlags&1024)for(b=b.child;b!==null;){var S=b;Vc(S),S.tag===5&&S.flags&1024&&O0(S.stateNode),b=b.sibling}}function Ru(b,S){if(S.subtreeFlags&8772)for(S=S.child;S!==null;)vf(b,S.alternate,S),S=S.sibling}function bf(b){for(b=b.child;b!==null;){var S=b;switch(S.tag){case 0:case 11:case 14:case 15:hn(4,S,S.return),bf(S);break;case 1:Cr(S,S.return);var N=S.stateNode;typeof N.componentWillUnmount=="function"&&pd(S,S.return,N),bf(S);break;case 27:Gs&&fy(S.stateNode);case 26:case 5:Cr(S,S.return),bf(S);break;case 22:S.memoizedState===null&&bf(S);break;case 30:bf(S);break;default:bf(S)}b=b.sibling}}function Rh(b,S,N){for(N=N&&(S.subtreeFlags&8772)!==0,S=S.child;S!==null;){var V=S.alternate,ee=b,le=S,Ne=le.flags;switch(le.tag){case 0:case 11:case 15:Rh(ee,le,N),wn(4,le);break;case 1:if(Rh(ee,le,N),V=le,ee=V.stateNode,typeof ee.componentDidMount=="function")try{ee.componentDidMount()}catch(Lt){Qt(V,V.return,Lt)}if(V=le,ee=V.updateQueue,ee!==null){var Qe=V.stateNode;try{var St=ee.shared.hiddenCallbacks;if(St!==null)for(ee.shared.hiddenCallbacks=null,ee=0;ee<St.length;ee++)je(St[ee],Qe)}catch(Lt){Qt(V,V.return,Lt)}}N&&Ne&64&&Sn(le),$r(le,le.return);break;case 27:Gs&&Hv(le);case 26:case 5:Rh(ee,le,N),N&&V===null&&Ne&4&&Sa(le),$r(le,le.return);break;case 12:Rh(ee,le,N);break;case 31:Rh(ee,le,N),N&&Ne&4&&yf(ee,le);break;case 13:Rh(ee,le,N),N&&Ne&4&&Wa(ee,le);break;case 22:le.memoizedState===null&&Rh(ee,le,N),$r(le,le.return);break;case 30:break;default:Rh(ee,le,N)}S=S.sibling}}function Io(b,S){var N=null;b!==null&&b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(N=b.memoizedState.cachePool.pool),b=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(b=S.memoizedState.cachePool.pool),b!==N&&(b!=null&&b.refCount++,N!=null&&Nt(N))}function Mp(b,S){b=null,S.alternate!==null&&(b=S.alternate.memoizedState.cache),S=S.memoizedState.cache,S!==b&&(S.refCount++,b!=null&&Nt(b))}function La(b,S,N,V){if(S.subtreeFlags&10256)for(S=S.child;S!==null;)_0(b,S,N,V),S=S.sibling}function _0(b,S,N,V){var ee=S.flags;switch(S.tag){case 0:case 11:case 15:La(b,S,N,V),ee&2048&&wn(9,S);break;case 1:La(b,S,N,V);break;case 3:La(b,S,N,V),ee&2048&&(b=null,S.alternate!==null&&(b=S.alternate.memoizedState.cache),S=S.memoizedState.cache,S!==b&&(S.refCount++,b!=null&&Nt(b)));break;case 12:if(ee&2048){La(b,S,N,V),b=S.stateNode;try{var le=S.memoizedProps,Ne=le.id,Qe=le.onPostCommit;typeof Qe=="function"&&Qe(Ne,S.alternate===null?"mount":"update",b.passiveEffectDuration,-0)}catch(St){Qt(S,S.return,St)}}else La(b,S,N,V);break;case 31:La(b,S,N,V);break;case 13:La(b,S,N,V);break;case 23:break;case 22:le=S.stateNode,Ne=S.alternate,S.memoizedState!==null?le._visibility&2?La(b,S,N,V):Op(b,S):le._visibility&2?La(b,S,N,V):(le._visibility|=2,kh(b,S,N,V,(S.subtreeFlags&10256)!==0||!1)),ee&2048&&Io(Ne,S);break;case 24:La(b,S,N,V),ee&2048&&Mp(S.alternate,S);break;default:La(b,S,N,V)}}function kh(b,S,N,V,ee){for(ee=ee&&((S.subtreeFlags&10256)!==0||!1),S=S.child;S!==null;){var le=b,Ne=S,Qe=N,St=V,Lt=Ne.flags;switch(Ne.tag){case 0:case 11:case 15:kh(le,Ne,Qe,St,ee),wn(8,Ne);break;case 23:break;case 22:var Kt=Ne.stateNode;Ne.memoizedState!==null?Kt._visibility&2?kh(le,Ne,Qe,St,ee):Op(le,Ne):(Kt._visibility|=2,kh(le,Ne,Qe,St,ee)),ee&&Lt&2048&&Io(Ne.alternate,Ne);break;case 24:kh(le,Ne,Qe,St,ee),ee&&Lt&2048&&Mp(Ne.alternate,Ne);break;default:kh(le,Ne,Qe,St,ee)}S=S.sibling}}function Op(b,S){if(S.subtreeFlags&10256)for(S=S.child;S!==null;){var N=b,V=S,ee=V.flags;switch(V.tag){case 22:Op(N,V),ee&2048&&Io(V.alternate,V);break;case 24:Op(N,V),ee&2048&&Mp(V.alternate,V);break;default:Op(N,V)}S=S.sibling}}function Zo(b,S,N){if(b.subtreeFlags&Xl)for(b=b.child;b!==null;)a_(b,S,N),b=b.sibling}function a_(b,S,N){switch(b.tag){case 26:if(Zo(b,S,N),b.flags&Xl)if(b.memoizedState!==null)C_(N,as,b.memoizedState,b.memoizedProps);else{var V=b.stateNode,ee=b.type;b=b.memoizedProps,((S&335544128)===S||M0(ee,b))&&Po(N,V,ee,b)}break;case 5:Zo(b,S,N),b.flags&Xl&&(V=b.stateNode,ee=b.type,b=b.memoizedProps,((S&335544128)===S||M0(ee,b))&&Po(N,V,ee,b));break;case 3:case 4:_l?(V=as,as=V0(b.stateNode.containerInfo),Zo(b,S,N),as=V):Zo(b,S,N);break;case 22:b.memoizedState===null&&(V=b.alternate,V!==null&&V.memoizedState!==null?(V=Xl,Xl=16777216,Zo(b,S,N),Xl=V):Zo(b,S,N));break;default:Zo(b,S,N)}}function Mh(b){var S=b.alternate;if(S!==null&&(b=S.child,b!==null)){S.child=null;do S=b.sibling,b.sibling=null,b=S;while(b!==null)}}function Qo(b){var S=b.deletions;if((b.flags&16)!==0){if(S!==null)for(var N=0;N<S.length;N++){var V=S[N];go=V,gd(V,b)}Mh(b)}if(b.subtreeFlags&10256)for(b=b.child;b!==null;)qa(b),b=b.sibling}function qa(b){switch(b.tag){case 0:case 11:case 15:Qo(b),b.flags&2048&&hn(9,b,b.return);break;case 3:Qo(b);break;case 12:Qo(b);break;case 22:var S=b.stateNode;b.memoizedState!==null&&S._visibility&2&&(b.return===null||b.return.tag!==13)?(S._visibility&=-3,ku(b)):Qo(b);break;default:Qo(b)}}function ku(b){var S=b.deletions;if((b.flags&16)!==0){if(S!==null)for(var N=0;N<S.length;N++){var V=S[N];go=V,gd(V,b)}Mh(b)}for(b=b.child;b!==null;){switch(S=b,S.tag){case 0:case 11:case 15:hn(8,S,S.return),ku(S);break;case 22:N=S.stateNode,N._visibility&2&&(N._visibility&=-3,ku(S));break;default:ku(S)}b=b.sibling}}function gd(b,S){for(;go!==null;){var N=go;switch(N.tag){case 0:case 11:case 15:hn(8,N,S);break;case 23:case 22:if(N.memoizedState!==null&&N.memoizedState.cachePool!==null){var V=N.memoizedState.cachePool.pool;V!=null&&V.refCount++}break;case 24:Nt(N.memoizedState.cache)}if(V=N.child,V!==null)V.return=N,go=V;else e:for(N=b;go!==null;){V=go;var ee=V.sibling,le=V.return;if(o_(V),V===N){go=null;break e}if(ee!==null){ee.return=le,go=ee;break e}go=le}}}function Mu(b){var S=Td(b);if(S!=null){if(typeof S.memoizedProps["data-testname"]!="string")throw Error(i(364));return S}if(b=Fu(b),b===null)throw Error(i(362));return b.stateNode.current}function v0(b,S){var N=b.tag;switch(S.$$typeof){case K0:if(b.type===S.value)return!0;break;case Nd:e:{for(S=S.value,b=[b,0],N=0;N<b.length;){var V=b[N++],ee=V.tag,le=b[N++],Ne=S[le];if(ee!==5&&ee!==26&&ee!==27||!Uh(V)){for(;Ne!=null&&v0(V,Ne);)le++,Ne=S[le];if(le===S.length){S=!0;break e}else for(V=V.child;V!==null;)b.push(V,le),V=V.sibling}}S=!1}return S;case Nf:if((N===5||N===26||N===27)&&I0(b.stateNode,S.value))return!0;break;case Xb:if((N===5||N===6||N===26||N===27)&&(b=Ad(b),b!==null&&0<=b.indexOf(S.value)))return!0;break;case _y:if((N===5||N===26||N===27)&&(b=b.memoizedProps["data-testname"],typeof b=="string"&&b.toLowerCase()===S.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function y0(b){switch(b.$$typeof){case K0:return"<"+(h(b.value)||"Unknown")+">";case Nd:return":has("+(y0(b)||"")+")";case Nf:return'[role="'+b.value+'"]';case Xb:return'"'+b.value+'"';case _y:return'[data-testname="'+b.value+'"]';default:throw Error(i(365))}}function _d(b,S){var N=[];b=[b,0];for(var V=0;V<b.length;){var ee=b[V++],le=ee.tag,Ne=b[V++],Qe=S[Ne];if(le!==5&&le!==26&&le!==27||!Uh(ee)){for(;Qe!=null&&v0(ee,Qe);)Ne++,Qe=S[Ne];if(Ne===S.length)N.push(ee);else for(ee=ee.child;ee!==null;)b.push(ee,Ne),ee=ee.sibling}}return N}function wr(b,S){if(!Bu)throw Error(i(363));b=Mu(b),b=_d(b,S),S=[],b=Array.from(b);for(var N=0;N<b.length;){var V=b[N++],ee=V.tag;if(ee===5||ee===26||ee===27)Uh(V)||S.push(V.stateNode);else for(V=V.child;V!==null;)b.push(V),V=V.sibling}return S}function Ki(){return(Yr&2)!==0&&Ei!==0?Ei&-Ei:dr.T!==null?ye():fi()}function c_(){if(j===0)if((Ei&536870912)===0||_i){var b=G0;G0<<=1,(G0&3932160)===0&&(G0=262144),j=b}else j=536870912;return b=Wt.current,b!==null&&(b.flags|=32),j}function Ya(b,S,N){(b===ws&&(cs===2||cs===9)||b.cancelPendingCommit!==null)&&(Ou(b,0),bc(b,Ei,j,!1)),A(b,N),((Yr&2)===0||b!==ws)&&(b===ws&&((Yr&2)===0&&(R|=N),P===4&&bc(b,Ei,j,!1)),wt(b))}function Is(b,S,N){if((Yr&6)!==0)throw Error(i(327));var V=!N&&(S&127)===0&&(S&b.expiredLanes)===0||y(b,S),ee=V?Gv(b,S):vd(b,S,!0),le=V;do{if(ee===0){D_&&!V&&bc(b,S,0,!1);break}else{if(N=b.current.alternate,le&&!b0(N)){ee=vd(b,S,!1),le=!1;continue}if(ee===2){if(le=S,b.errorRecoveryDisabledLanes&le)var Ne=0;else Ne=b.pendingLanes&-536870913,Ne=Ne!==0?Ne:Ne&536870912?536870912:0;if(Ne!==0){S=Ne;e:{var Qe=b;ee=X;var St=gi&&Qe.current.memoizedState.isDehydrated;if(St&&(Ou(Qe,Ne).flags|=256),Ne=vd(Qe,Ne,!1),Ne!==2){if(qp&&!St){Qe.errorRecoveryDisabledLanes|=le,R|=le,ee=4;break e}le=ue,ue=ee,le!==null&&(ue===null?ue=le:ue.push.apply(ue,le))}ee=Ne}if(le=!1,ee!==2)continue}}if(ee===1){Ou(b,0),bc(b,S,0,!0);break}e:{switch(V=b,le=ee,le){case 0:case 1:throw Error(i(345));case 4:if((S&4194048)!==S)break;case 6:bc(V,S,j,!Pd);break e;case 2:ue=null;break;case 3:case 5:break;default:throw Error(i(329))}if((S&62914560)===S&&(ee=ce+300-Fr(),10<ee)){if(bc(V,S,j,!Pd),_(V,0,!0)!==0)break e;et=S,V.timeoutHandle=Tx(Ip.bind(null,V,N,ue,Me,me,S,j,R,$,Pd,le,"Throttled",-0,0),ee);break e}Ip(V,N,ue,Me,me,S,j,R,$,Pd,le,null,-0,0)}}break}while(!0);wt(b)}function Ip(b,S,N,V,ee,le,Ne,Qe,St,Lt,Kt,Xt,vn,Zn){if(b.timeoutHandle=ta,Xt=S.subtreeFlags,Xt&8192||(Xt&16785408)===16785408){Xt=wo(),a_(S,le,Xt);var Nr=(le&62914560)===le?ce-Fr():(le&4194048)===le?de-Fr():0;if(Nr=jp(Xt,Nr),Nr!==null){et=le,b.cancelPendingCommit=Nr(h_.bind(null,b,S,le,N,V,ee,Ne,Qe,St,Kt,Xt,null,vn,Zn)),bc(b,le,Ne,!Lt);return}}h_(b,S,le,N,V,ee,Ne,Qe,St)}function b0(b){for(var S=b;;){var N=S.tag;if((N===0||N===11||N===15)&&S.flags&16384&&(N=S.updateQueue,N!==null&&(N=N.stores,N!==null)))for(var V=0;V<N.length;V++){var ee=N[V],le=ee.getSnapshot;ee=ee.value;try{if(!Qa(le(),ee))return!1}catch{return!1}}if(N=S.child,S.subtreeFlags&16384&&N!==null)N.return=S,S=N;else{if(S===b)break;for(;S.sibling===null;){if(S.return===null||S.return===b)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function bc(b,S,N,V){S&=~U,S&=~R,b.suspendedLanes|=S,b.pingedLanes&=~S,V&&(b.warmLanes|=S),V=b.expirationTimes;for(var ee=S;0<ee;){var le=31-Ss(ee),Ne=1<<le;V[le]=-1,ee&=~Ne}N!==0&&k(b,N,S)}function $v(){return(Yr&6)===0?(Re(0),!1):!0}function Ea(){if(cr!==null){if(cs===0)var b=cr.return;else b=cr,$u=zh=null,Un(b),Ws=null,Wu=0,b=cr;for(;b!==null;)p0(b.alternate,b),b=b.return;cr=null}}function Ou(b,S){var N=b.timeoutHandle;N!==ta&&(b.timeoutHandle=ta,ey(N)),N=b.cancelPendingCommit,N!==null&&(b.cancelPendingCommit=null,N()),et=0,Ea(),ws=b,cr=N=Ns(b.current,null),Ei=S,cs=0,tc=null,Pd=!1,D_=y(b,S),qp=!1,$=j=U=R=w=P=0,ue=X=null,me=!1,(S&8)!==0&&(S|=S&32);var V=b.entangledLanes;if(V!==0)for(b=b.entanglements,V&=S;0<V;){var ee=31-Ss(V),le=1<<ee;S|=b[ee],V&=~le}return Dd=S,Jt(),N}function Np(b,S){pn=null,dr.H=jn,S===Tc||S===If?(S=ot(),cs=3):S===gy?(S=ot(),cs=4):cs=S===Bo?8:S!==null&&typeof S=="object"&&typeof S.then=="function"?6:1,tc=S,cr===null&&(P=1,sn(b,te(S,b.current)))}function xb(){var b=Wt.current;return b===null?!0:(Ei&4194048)===Ei?Yt===null:(Ei&62914560)===Ei||(Ei&536870912)!==0?b===Yt:!1}function l_(){var b=dr.H;return dr.H=jn,b===null?jn:b}function Oh(){var b=dr.A;return dr.A=Jl,b}function S0(){P=4,Pd||(Ei&4194048)!==Ei&&Wt.current!==null||(D_=!0),(w&134217727)===0&&(R&134217727)===0||ws===null||bc(ws,Ei,j,!1)}function vd(b,S,N){var V=Yr;Yr|=2;var ee=l_(),le=Oh();(ws!==b||Ei!==S)&&(Me=null,Ou(b,S)),S=!1;var Ne=P;e:do try{if(cs!==0&&cr!==null){var Qe=cr,St=tc;switch(cs){case 8:Ea(),Ne=6;break e;case 3:case 2:case 9:case 6:Wt.current===null&&(S=!0);var Lt=cs;if(cs=0,tc=null,Ef(b,Qe,St,Lt),N&&D_){Ne=0;break e}break;default:Lt=cs,cs=0,tc=null,Ef(b,Qe,St,Lt)}}Sf(),Ne=P;break}catch(Kt){Np(b,Kt)}while(!0);return S&&b.shellSuspendCounter++,$u=zh=null,Yr=V,dr.H=ee,dr.A=le,cr===null&&(ws=null,Ei=0,Jt()),Ne}function Sf(){for(;cr!==null;)u_(cr)}function Gv(b,S){var N=Yr;Yr|=2;var V=l_(),ee=Oh();ws!==b||Ei!==S?(Me=null,Ae=Fr()+500,Ou(b,S)):D_=y(b,S);e:do try{if(cs!==0&&cr!==null){S=cr;var le=tc;t:switch(cs){case 1:cs=0,tc=null,Ef(b,S,le,1);break;case 2:case 9:if(nt(le)){cs=0,tc=null,Wv(S);break}S=function(){cs!==2&&cs!==9||ws!==b||(cs=7),wt(b)},le.then(S,S);break e;case 3:cs=7;break e;case 4:cs=5;break e;case 7:nt(le)?(cs=0,tc=null,Wv(S)):(cs=0,tc=null,Ef(b,S,le,7));break;case 5:var Ne=null;switch(cr.tag){case 26:Ne=cr.memoizedState;case 5:case 27:var Qe=cr,St=Qe.type,Lt=Qe.pendingProps;if(Ne?vl(Ne):ny(Qe.stateNode,St,Lt)){cs=0,tc=null;var Kt=Qe.sibling;if(Kt!==null)cr=Kt;else{var Xt=Qe.return;Xt!==null?(cr=Xt,Ih(Xt)):cr=null}break t}}cs=0,tc=null,Ef(b,S,le,5);break;case 6:cs=0,tc=null,Ef(b,S,le,6);break;case 8:Ea(),P=6;break e;default:throw Error(i(462))}}wb();break}catch(vn){Np(b,vn)}while(!0);return $u=zh=null,dr.H=V,dr.A=ee,Yr=N,cr!==null?0:(ws=null,Ei=0,Jt(),P)}function wb(){for(;cr!==null&&!bl();)u_(cr)}function u_(b){var S=Hl(b.alternate,b,Dd);b.memoizedProps=b.pendingProps,S===null?Ih(b):cr=S}function Wv(b){var S=b,N=S.alternate;switch(S.tag){case 15:case 0:S=u0(N,S,S.pendingProps,S.type,void 0,Ei);break;case 11:S=u0(N,S,S.pendingProps,S.type.render,S.ref,Ei);break;case 5:Un(S);default:p0(N,S),S=cr=Dp(S,Dd),S=Hl(N,S,Dd)}b.memoizedProps=b.pendingProps,S===null?Ih(b):cr=S}function Ef(b,S,N,V){$u=zh=null,Un(S),Ws=null,Wu=0;var ee=S.return;try{if(Vl(b,ee,S,N,Ei)){P=1,sn(b,te(N,b.current)),cr=null;return}}catch(le){if(ee!==null)throw cr=ee,le;P=1,sn(b,te(N,b.current)),cr=null;return}S.flags&32768?(_i||V===1?b=!0:D_||(Ei&536870912)!==0?b=!1:(Pd=b=!0,(V===2||V===9||V===3||V===6)&&(V=Wt.current,V!==null&&V.tag===13&&(V.flags|=16384))),qv(S,b)):Ih(S)}function Ih(b){var S=b;do{if((S.flags&32768)!==0){qv(S,Pd);return}b=S.return;var N=Eb(S.alternate,S,Dd);if(N!==null){cr=N;return}if(S=S.sibling,S!==null){cr=S;return}cr=S=b}while(S!==null);P===0&&(P=5)}function qv(b,S){do{var N=Ex(b.alternate,b);if(N!==null){N.flags&=32767,cr=N;return}if(N=b.return,N!==null&&(N.flags|=32768,N.subtreeFlags=0,N.deletions=null),!S&&(b=b.sibling,b!==null)){cr=b;return}cr=b=N}while(b!==null);P=6,cr=null}function h_(b,S,N,V,ee,le,Ne,Qe,St){b.cancelPendingCommit=null;do Nh();while(bt!==0);if((Yr&6)!==0)throw Error(i(327));if(S!==null){if(S===b.current)throw Error(i(177));if(le=S.lanes|S.childLanes,le|=Oe,T(b,N,le,Ne,Qe,St),b===ws&&(cr=ws=null,Ei=0),dt=S,ht=b,et=N,st=le,Ot=ee,En=V,(S.subtreeFlags&10256)!==0||(S.flags&10256)!==0?(b.callbackNode=null,b.callbackPriority=0,wx(Rd,function(){return d_(),null})):(b.callbackNode=null,b.callbackPriority=0),V=(S.flags&13878)!==0,(S.subtreeFlags&13878)!==0||V){V=dr.T,dr.T=null,ee=ra(),po(2),Ne=Yr,Yr|=4;try{kp(b,S,N)}finally{Yr=Ne,po(ee),dr.T=V}}bt=1,yd(),f_(),Pp()}}function yd(){if(bt===1){bt=0;var b=ht,S=dt,N=(S.flags&13878)!==0;if((S.subtreeFlags&13878)!==0||N){N=dr.T,dr.T=null;var V=ra();po(2);var ee=Yr;Yr|=4;try{Cu(S,b),__(b.containerInfo)}finally{Yr=ee,po(V),dr.T=N}}b.current=S,bt=2}}function f_(){if(bt===2){bt=0;var b=ht,S=dt,N=(S.flags&8772)!==0;if((S.subtreeFlags&8772)!==0||N){N=dr.T,dr.T=null;var V=ra();po(2);var ee=Yr;Yr|=4;try{vf(b,S.alternate,S)}finally{Yr=ee,po(V),dr.T=N}}bt=3}}function Pp(){if(bt===4||bt===3){bt=0,Gb();var b=ht,S=dt,N=et,V=En;(S.subtreeFlags&10256)!==0||(S.flags&10256)!==0?bt=5:(bt=0,dt=ht=null,Yv(b,b.pendingLanes));var ee=b.pendingLanes;if(ee===0&&(rt=null),M(N),S=S.stateNode,Za&&typeof Za.onCommitFiberRoot=="function")try{Za.onCommitFiberRoot(W0,S,void 0,(S.current.flags&128)===128)}catch{}if(V!==null){S=dr.T,ee=ra(),po(2),dr.T=null;try{for(var le=b.onRecoverableError,Ne=0;Ne<V.length;Ne++){var Qe=V[Ne];le(Qe.value,{componentStack:Qe.stack})}}finally{dr.T=S,po(ee)}}(et&3)!==0&&Nh(),wt(b),ee=b.pendingLanes,(N&261930)!==0&&(ee&42)!==0?b===Jn?Dn++:(Dn=0,Jn=b):Dn=0,gi&&cy(),Re(0)}}function Yv(b,S){(b.pooledCacheLanes&=S)===0&&(S=b.pooledCache,S!=null&&(b.pooledCache=null,Nt(S)))}function Nh(){return yd(),f_(),Pp(),d_()}function d_(){if(bt!==5)return!1;var b=ht,S=st;st=0;var N=M(et),V=32>N?32:N;N=dr.T;var ee=ra();try{po(V),dr.T=null,V=Ot,Ot=null;var le=ht,Ne=et;if(bt=0,dt=ht=null,et=0,(Yr&6)!==0)throw Error(i(331));var Qe=Yr;if(Yr|=4,qa(le.current),_0(le,le.current,Ne,V),Yr=Qe,Re(0,!1),Za&&typeof Za.onPostCommitFiberRoot=="function")try{Za.onPostCommitFiberRoot(W0,le)}catch{}return!0}finally{po(ee),dr.T=N,Yv(b,S)}}function E0(b,S,N){S=te(N,S),S=kr(b.stateNode,S,2),b=Fi(b,S,2),b!==null&&(A(b,2),wt(b))}function Qt(b,S,N){if(b.tag===3)E0(b,b,N);else for(;S!==null;){if(S.tag===3){E0(S,b,N);break}else if(S.tag===1){var V=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof V.componentDidCatch=="function"&&(rt===null||!rt.has(V))){b=te(N,b),N=Si(2),V=Fi(S,N,2),V!==null&&(ho(N,V,S,b),A(V,2),wt(V));break}}S=S.return}}function Xr(b,S,N){var V=b.pingCache;if(V===null){V=b.pingCache=new Sl;var ee=new Set;V.set(S,ee)}else ee=V.get(S),ee===void 0&&(ee=new Set,V.set(S,ee));ee.has(N)||(qp=!0,ee.add(N),b=xx.bind(null,b,S,N),S.then(b,b))}function xx(b,S,N){var V=b.pingCache;V!==null&&V.delete(S),b.pingedLanes|=b.suspendedLanes&N,b.warmLanes&=~N,ws===b&&(Ei&N)===N&&(P===4||P===3&&(Ei&62914560)===Ei&&300>Fr()-ce?(Yr&2)===0&&Ou(b,0):U|=N,$===Ei&&($=0)),wt(b)}function Tb(b,S){S===0&&(S=E()),b=An(b,S),b!==null&&(A(b,S),wt(b))}function x0(b){var S=b.memoizedState,N=0;S!==null&&(N=S.retryLane),Tb(b,N)}function Kv(b,S){var N=0;switch(b.tag){case 31:case 13:var V=b.stateNode,ee=b.memoizedState;ee!==null&&(N=ee.retryLane);break;case 19:V=b.stateNode;break;case 22:V=b.stateNode._retryCache;break;default:throw Error(i(314))}V!==null&&V.delete(S),Tb(b,N)}function wx(b,S){return Br(b,S)}function bd(b,S,N,V){this.tag=b,this.key=N,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=V,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ka(b){return b=b.prototype,!(!b||!b.isReactComponent)}function Ns(b,S){var N=b.alternate;return N===null?(N=n(b.tag,S,b.key,b.mode),N.elementType=b.elementType,N.type=b.type,N.stateNode=b.stateNode,N.alternate=b,b.alternate=N):(N.pendingProps=S,N.type=b.type,N.flags=0,N.subtreeFlags=0,N.deletions=null),N.flags=b.flags&65011712,N.childLanes=b.childLanes,N.lanes=b.lanes,N.child=b.child,N.memoizedProps=b.memoizedProps,N.memoizedState=b.memoizedState,N.updateQueue=b.updateQueue,S=b.dependencies,N.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},N.sibling=b.sibling,N.index=b.index,N.ref=b.ref,N.refCleanup=b.refCleanup,N}function Dp(b,S){b.flags&=65011714;var N=b.alternate;return N===null?(b.childLanes=0,b.lanes=S,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=N.childLanes,b.lanes=N.lanes,b.child=N.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=N.memoizedProps,b.memoizedState=N.memoizedState,b.updateQueue=N.updateQueue,b.type=N.type,S=N.dependencies,b.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext}),b}function Xa(b,S,N,V,ee,le){var Ne=0;if(V=b,typeof b=="function")Ka(b)&&(Ne=1);else if(typeof b=="string")Ne=_l&&Gs?Gc(b,N,sa.current)?26:dy(b)?27:5:_l?Gc(b,N,sa.current)?26:5:Gs&&dy(b)?27:5;else e:switch(b){case Up:return b=n(31,N,S,ee),b.elementType=Up,b.lanes=le,b;case Sd:return Ph(N.children,ee,le,S);case Ed:Ne=8,ee|=24;break;case A0:return b=n(12,N,S,ee|2),b.elementType=A0,b.lanes=le,b;case Tf:return b=n(13,N,S,ee),b.elementType=Tf,b.lanes=le,b;case Nu:return b=n(19,N,S,ee),b.elementType=Nu,b.lanes=le,b;default:if(typeof b=="object"&&b!==null)switch(b.$$typeof){case Xs:Ne=10;break e;case m_:Ne=9;break e;case Ec:Ne=11;break e;case Lp:Ne=14;break e;case Pu:Ne=16,V=null;break e}Ne=29,N=Error(i(130,b===null?"null":typeof b,"")),V=null}return S=n(Ne,N,S,ee),S.elementType=b,S.type=V,S.lanes=le,S}function Ph(b,S,N,V){return b=n(7,b,V,S),b.lanes=N,b}function Rr(b,S,N){return b=n(6,b,null,S),b.lanes=N,b}function ea(b){var S=n(18,null,null,0);return S.stateNode=b,S}function Hc(b,S,N){return S=n(4,b.children!==null?b.children:[],b.key,S),S.lanes=N,S.stateNode={containerInfo:b.containerInfo,pendingChildren:null,implementation:b.implementation},S}function Xv(b,S,N,V,ee,le,Ne,Qe,St){this.tag=1,this.containerInfo=b,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ta,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=x(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=x(0),this.hiddenUpdates=x(null),this.identifierPrefix=V,this.onUncaughtError=ee,this.onCaughtError=le,this.onRecoverableError=Ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=St,this.incompleteTransitions=new Map}function w0(b,S,N,V,ee,le,Ne,Qe,St,Lt,Kt,Xt){return b=new Xv(b,S,N,Ne,St,Lt,Kt,Xt,Qe),S=1,le===!0&&(S|=24),le=n(3,null,null,S),b.current=le,le.stateNode=b,S=tt(),S.refCount++,b.pooledCache=S,S.refCount++,le.memoizedState={element:V,isDehydrated:N,cache:S},ns(le),b}function No(b){return b?(b=jh,b):jh}function Dh(b){var S=b._reactInternals;if(S===void 0)throw typeof b.render=="function"?Error(i(188)):(b=Object.keys(b).join(","),Error(i(268,b)));return b=a(S),b=b!==null?c(b):null,b===null?null:Du(b.stateNode)}function T0(b,S,N,V,ee,le){ee=No(ee),V.context===null?V.context=ee:V.pendingContext=ee,V=ti(S),V.payload={element:N},le=le===void 0?null:le,le!==null&&(V.callback=le),N=Fi(b,V,S),N!==null&&(Ya(N,b,S),rs(N,b,S))}function Sc(b,S){if(b=b.memoizedState,b!==null&&b.dehydrated!==null){var N=b.retryLane;b.retryLane=N!==0&&N<S?N:S}}function Zt(b,S){Sc(b,S),(b=b.alternate)&&Sc(b,S)}var Sr={},xf=ch,Ua=qde,$c=Object.assign,p_=Symbol.for("react.element"),wf=Symbol.for("react.transitional.element"),Iu=Symbol.for("react.portal"),Sd=Symbol.for("react.fragment"),Ed=Symbol.for("react.strict_mode"),A0=Symbol.for("react.profiler"),m_=Symbol.for("react.consumer"),Xs=Symbol.for("react.context"),Ec=Symbol.for("react.forward_ref"),Tf=Symbol.for("react.suspense"),Nu=Symbol.for("react.suspense_list"),Lp=Symbol.for("react.memo"),Pu=Symbol.for("react.lazy"),Up=Symbol.for("react.activity"),xd=Symbol.for("react.memo_cache_sentinel"),wd=Symbol.iterator,Jv=Symbol.for("react.client.reference"),Bp=Array.isArray,dr=xf.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Zv=e.rendererVersion,C0=e.rendererPackageName,pl=e.extraDevToolsConfig,Du=e.getPublicInstance,g_=e.getRootHostContext,R0=e.getChildHostContext,Qv=e.prepareForCommit,__=e.resetAfterCommit,Ab=e.createInstance;e.cloneMutableInstance;var k0=e.appendInitialChild,Lu=e.finalizeInitialChildren,Fp=e.shouldSetTextContent,v_=e.createTextInstance;e.cloneMutableTextInstance;var Tx=e.scheduleTimeout,ey=e.cancelTimeout,ta=e.noTimeout,Ba=e.isPrimaryRenderer;e.warnsIfNotActing;var na=e.supportsMutation,ml=e.supportsPersistence,gi=e.supportsHydration,Td=e.getInstanceFromNode;e.beforeActiveInstanceBlur;var vr=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var po=e.setCurrentUpdatePriority,ra=e.getCurrentUpdatePriority,fi=e.resolveUpdatePriority;e.trackSchedulerEvent,e.resolveEventType,e.resolveEventTimeStamp;var y_=e.shouldAttemptEagerTransition,Gl=e.detachDeletedInstance;e.requestPostPaintCallback;var xa=e.maySuspendCommit,ty=e.maySuspendCommitOnUpdate,M0=e.maySuspendCommitInSyncRender,ny=e.preloadInstance,wo=e.startSuspendingCommit,Po=e.suspendInstance;e.suspendOnActiveViewTransition;var jp=e.waitForCommitToBeReady;e.getSuspendedCommitReason;var gl=e.NotPendingTransition,Lh=e.HostTransitionContext,O0=e.resetFormInstance;e.bindToConsole;var Af=e.supportsMicrotasks,Uu=e.scheduleMicrotask,Bu=e.supportsTestSelectors,Fu=e.findFiberRoot,zp=e.getBoundingRect,Ad=e.getTextContent,Uh=e.isHiddenSubtree,I0=e.matchAccessibilityRole,N0=e.setFocusIfFocusable,Vp=e.setupIntersectionObserver,P0=e.appendChild,Cb=e.appendChildToContainer,ju=e.commitTextUpdate,Cd=e.commitMount,Rb=e.commitUpdate,kb=e.insertBefore,Mb=e.insertInContainerBefore,b_=e.removeChild,Ob=e.removeChildFromContainer,ry=e.resetTextContent,Ib=e.hideInstance,Nb=e.hideTextInstance,Ax=e.unhideInstance,Pb=e.unhideTextInstance;e.cancelViewTransitionName,e.cancelRootViewTransitionName,e.restoreRootViewTransitionName,e.cloneRootViewTransitionContainer,e.removeRootViewTransitionClone,e.measureClonedInstance,e.hasInstanceChanged,e.hasInstanceAffectedParent,e.startViewTransition,e.startGestureTransition,e.stopViewTransition,e.getCurrentGestureOffset,e.createViewTransitionInstance;var Db=e.clearContainer;e.createFragmentInstance,e.updateFragmentInstanceFiber,e.commitNewChildToFragmentInstance,e.deleteChildFromFragmentInstance;var mo=e.cloneInstance,iy=e.createContainerChildSet,S_=e.appendChildToContainerChildSet,Cx=e.finalizeContainerChildren,E_=e.replaceContainerChildren,Lb=e.cloneHiddenInstance,Ub=e.cloneHiddenTextInstance,sy=e.isSuspenseInstancePending,D0=e.isSuspenseInstanceFallback,Bb=e.getSuspenseInstanceFallbackErrorDetails,Rx=e.registerSuspenseInstanceRetry,kx=e.canHydrateFormStateMarker,x_=e.isFormStateMarkerMatching,Hp=e.getNextHydratableSibling,$p=e.getNextHydratableSiblingAfterSingleton,Gp=e.getFirstHydratableChild,Cf=e.getFirstHydratableChildWithinContainer,Bh=e.getFirstHydratableChildWithinActivityInstance,Rf=e.getFirstHydratableChildWithinSuspenseInstance,w_=e.getFirstHydratableChildWithinSingleton,Mx=e.canHydrateInstance,Ox=e.canHydrateTextInstance,L0=e.canHydrateActivityInstance,Fb=e.canHydrateSuspenseInstance,Ix=e.hydrateInstance,U0=e.hydrateTextInstance,jb=e.hydrateActivityInstance,Fh=e.hydrateSuspenseInstance,zb=e.getNextHydratableInstanceAfterActivityInstance,Vb=e.getNextHydratableInstanceAfterSuspenseInstance,B0=e.commitHydratedInstance,oy=e.commitHydratedContainer,ay=e.commitHydratedActivityInstance,T_=e.commitHydratedSuspenseInstance,A_=e.finalizeHydratedChildren,cy=e.flushHydrationEvents;e.clearActivityBoundary;var ly=e.clearSuspenseBoundary;e.clearActivityBoundaryFromContainer;var Hb=e.clearSuspenseBoundaryFromContainer,F0=e.hideDehydratedBoundary,j0=e.unhideDehydratedBoundary,Do=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var z0=e.validateHydratableInstance,$b=e.validateHydratableTextInstance,_l=e.supportsResources,Gc=e.isHostHoistableType,V0=e.getHoistableRoot,uy=e.getResource,Wc=e.acquireResource,Ur=e.releaseResource,Nx=e.hydrateHoistable,Ja=e.mountHoistable,Js=e.unmountHoistable,kf=e.createHoistableInstance,Px=e.prepareToCommitHoistables,hy=e.mayResourceSuspendCommit,vl=e.preloadResource,C_=e.suspendResource,Gs=e.supportsSingletons,gs=e.resolveSingletonInstance,Zs=e.acquireSingletonInstance,fy=e.releaseSingletonInstance,dy=e.isHostSingletonType,Wl=e.isSingletonScope,H0=[],zu=-1,jh={},Ss=Math.clz32?Math.clz32:m,Vu=Math.log,R_=Math.LN2,$0=256,G0=262144,yl=4194304,Br=Ua.unstable_scheduleCallback,k_=Ua.unstable_cancelCallback,bl=Ua.unstable_shouldYield,Gb=Ua.unstable_requestPaint,Fr=Ua.unstable_now,Wb=Ua.unstable_ImmediatePriority,qb=Ua.unstable_UserBlockingPriority,Rd=Ua.unstable_NormalPriority,Dx=Ua.unstable_IdlePriority,Lx=Ua.log,Ux=Ua.unstable_setDisableYieldValue,W0=null,Za=null,Qa=typeof Object.is=="function"?Object.is:O,Yb=typeof reportError=="function"?reportError:function(b){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var S=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof b=="object"&&b!==null&&typeof b.message=="string"?String(b.message):String(b),error:b});if(!window.dispatchEvent(S))return}else if(typeof sf=="object"&&typeof sf.emit=="function"){sf.emit("uncaughtException",b);return}console.error(b)},Bx=Object.prototype.hasOwnProperty,py,To,Lo=!1,ec=new WeakMap,ia=[],Oi=0,M_=null,kd=0,qc=[],xc=0,wc=null,Hu=1,ql="",sa=f(null),q0=f(null),Mf=f(null),O_=f(null),Uo=null,li=null,_i=!1,Yl=null,Yc=!1,Of=Error(i(519)),oa=f(null),zh=null,$u=null,Kb=typeof AbortController<"u"?AbortController:function(){var b=[],S=this.signal={aborted:!1,addEventListener:function(N,V){b.push(V)}};this.abort=function(){S.aborted=!0,b.forEach(function(N){return N()})}},_s=Ua.unstable_scheduleCallback,I_=Ua.unstable_NormalPriority,Ps={$$typeof:Xs,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},N_=null,Es=null,Vh=!1,Y0=!1,P_=!1,Md=0,Wp=null,my=0,Gu=0,xs=null,Od=dr.S;dr.S=function(b,S){de=Fr(),typeof S=="object"&&S!==null&&typeof S.then=="function"&&Ke(b,S),Od!==null&&Od(b,S)};var Ds=f(null),Tc=Error(i(460)),gy=Error(i(474)),If=Error(i(542)),Hh={then:function(){}},Qs=null,Ws=null,Wu=0,C=_t(!0),B=_t(!1),J=[],_e=0,Oe=0,$e=!1,ct=!1,ft=f(null),kt=f(0),Wt=f(null),Yt=null,rn=f(0),Gn=0,pn=null,Nn=null,Ht=null,mn=!1,ir=!1,Rn=!1,gr=0,Er=0,si=null,nr=0,jn={readContext:ze,use:Ri,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useLayoutEffect:Cn,useInsertionEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useSyncExternalStore:Cn,useId:Cn,useHostTransitionStatus:Cn,useFormState:Cn,useActionState:Cn,useOptimistic:Cn,useMemoCache:Cn,useCacheRefresh:Cn};jn.useEffectEvent=Cn;var Ti={readContext:ze,use:Ri,useCallback:function(b,S){return bi().memoizedState=[b,S===void 0?null:S],b},useContext:ze,useEffect:hr,useImperativeHandle:function(b,S,N){N=N!=null?N.concat([b]):null,Th(4194308,4,r0.bind(null,S,b),N)},useLayoutEffect:function(b,S){return Th(4194308,4,b,S)},useInsertionEffect:function(b,S){Th(4,2,b,S)},useMemo:function(b,S){var N=bi();S=S===void 0?null:S;var V=b();if(Rn){D(!0);try{b()}finally{D(!1)}}return N.memoizedState=[V,S],V},useReducer:function(b,S,N){var V=bi();if(N!==void 0){var ee=N(S);if(Rn){D(!0);try{N(S)}finally{D(!1)}}}else ee=S;return V.memoizedState=V.baseState=ee,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:b,lastRenderedState:ee},V.queue=b,b=b.dispatch=vb.bind(null,pn,b),[V.memoizedState,b]},useRef:function(b){var S=bi();return b={current:b},S.memoizedState=b},useState:function(b){b=bp(b);var S=b.queue,N=zl.bind(null,pn,S);return S.dispatch=N,[b.memoizedState,N]},useDebugValue:i0,useDeferredValue:function(b,S){var N=bi();return wu(N,b,S)},useTransition:function(){var b=bp(!1);return b=jv.bind(null,pn,b.queue,!0,!1),bi().memoizedState=b,[!1,b]},useSyncExternalStore:function(b,S,N){var V=pn,ee=bi();if(_i){if(N===void 0)throw Error(i(407));N=N()}else{if(N=S(),ws===null)throw Error(i(349));(Ei&127)!==0||Bc(V,S,N)}ee.memoizedState=N;var le={value:N,getSnapshot:S};return ee.queue=le,hr(qg.bind(null,V,le,b),[b]),V.flags|=2048,mf(9,{destroy:void 0},e0.bind(null,V,le,N,S),null),N},useId:function(){var b=bi(),S=ws.identifierPrefix;if(_i){var N=ql,V=Hu;N=(V&~(1<<32-Ss(V)-1)).toString(32)+N,S="_"+S+"R_"+N,N=gr++,0<N&&(S+="H"+N.toString(32)),S+="_"}else N=nr++,S="_"+S+"r_"+N.toString(32)+"_";return b.memoizedState=S},useHostTransitionStatus:ll,useFormState:bs,useActionState:bs,useOptimistic:function(b){var S=bi();S.memoizedState=S.baseState=b;var N={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return S.queue=N,S=Hs.bind(null,pn,!0,N),N.dispatch=S,[b,S]},useMemoCache:Mn,useCacheRefresh:function(){return bi().memoizedState=zv.bind(null,pn)},useEffectEvent:function(b){var S=bi(),N={impl:b};return S.memoizedState=N,function(){if((Yr&2)!==0)throw Error(i(440));return N.impl.apply(void 0,arguments)}}},Ls={readContext:ze,use:Ri,useCallback:yc,useContext:ze,useEffect:n0,useImperativeHandle:Da,useInsertionEffect:Ah,useLayoutEffect:Zg,useMemo:Qg,useReducer:Xn,useRef:xu,useState:function(){return Xn(Pi)},useDebugValue:i0,useDeferredValue:function(b,S){var N=ai();return uo(N,Nn.memoizedState,b,S)},useTransition:function(){var b=Xn(Pi)[0],S=ai().memoizedState;return[typeof b=="boolean"?b:lo(b),S]},useSyncExternalStore:ms,useId:ks,useHostTransitionStatus:ll,useFormState:gc,useActionState:gc,useOptimistic:function(b,S){var N=ai();return ya(N,Nn,b,S)},useMemoCache:Mn,useCacheRefresh:Jo};Ls.useEffectEvent=Jg;var wa={readContext:ze,use:Ri,useCallback:yc,useContext:ze,useEffect:n0,useImperativeHandle:Da,useInsertionEffect:Ah,useLayoutEffect:Zg,useMemo:Qg,useReducer:al,useRef:xu,useState:function(){return al(Pi)},useDebugValue:i0,useDeferredValue:function(b,S){var N=ai();return Nn===null?wu(N,b,S):uo(N,Nn.memoizedState,b,S)},useTransition:function(){var b=al(Pi)[0],S=ai().memoizedState;return[typeof b=="boolean"?b:lo(b),S]},useSyncExternalStore:ms,useId:ks,useHostTransitionStatus:ll,useFormState:jc,useActionState:jc,useOptimistic:function(b,S){var N=ai();return Nn!==null?ya(N,Nn,b,S):(N.baseState=b,[b,N.queue.dispatch])},useMemoCache:Mn,useCacheRefresh:Jo};wa.useEffectEvent=Jg;var os={enqueueSetState:function(b,S,N){b=b._reactInternals;var V=Ki(),ee=ti(V);ee.payload=S,N!=null&&(ee.callback=N),S=Fi(b,ee,V),S!==null&&(Ya(S,b,V),rs(S,b,V))},enqueueReplaceState:function(b,S,N){b=b._reactInternals;var V=Ki(),ee=ti(V);ee.tag=1,ee.payload=S,N!=null&&(ee.callback=N),S=Fi(b,ee,V),S!==null&&(Ya(S,b,V),rs(S,b,V))},enqueueForceUpdate:function(b,S){b=b._reactInternals;var N=Ki(),V=ti(N);V.tag=2,S!=null&&(V.callback=S),S=Fi(b,V,N),S!==null&&(Ya(S,b,N),rs(S,b,N))}},Bo=Error(i(461)),zi=!1,qu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null},Kc=!1,Us=!1,Id=!1,Kl=typeof WeakSet=="function"?WeakSet:Set,go=null,_o=null,Ta=!1,as=null,Xl=8192,Jl={getCacheForType:function(b){var S=ze(Ps),N=S.data.get(b);return N===void 0&&(N=b(),S.data.set(b,N)),N},cacheSignal:function(){return ze(Ps).controller.signal}},K0=0,Nd=1,Nf=2,_y=3,Xb=4;if(typeof Symbol=="function"&&Symbol.for){var Fo=Symbol.for;K0=Fo("selector.component"),Nd=Fo("selector.has_pseudo_class"),Nf=Fo("selector.role"),_y=Fo("selector.test_id"),Xb=Fo("selector.text")}var Sl=typeof WeakMap=="function"?WeakMap:Map,Yr=0,ws=null,cr=null,Ei=0,cs=0,tc=null,Pd=!1,D_=!1,qp=!1,Dd=0,P=0,w=0,R=0,U=0,j=0,$=0,X=null,ue=null,me=!1,ce=0,de=0,Ae=1/0,Me=null,rt=null,bt=0,ht=null,dt=null,et=0,st=0,Ot=null,En=null,Dn=0,Jn=null;return Sr.attemptContinuousHydration=function(b){if(b.tag===13||b.tag===31){var S=An(b,67108864);S!==null&&Ya(S,b,67108864),Zt(b,67108864)}},Sr.attemptHydrationAtCurrentPriority=function(b){if(b.tag===13||b.tag===31){var S=Ki();S=F(S);var N=An(b,S);N!==null&&Ya(N,b,S),Zt(b,S)}},Sr.attemptSynchronousHydration=function(b){switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var S=g(b.pendingLanes);if(S!==0){for(b.pendingLanes|=2,b.entangledLanes|=2;S;){var N=1<<31-Ss(S);b.entanglements[1]|=N,S&=~N}wt(b),(Yr&6)===0&&(Ae=Fr()+500,Re(0))}}break;case 31:case 13:S=An(b,2),S!==null&&Ya(S,b,2),$v(),Zt(b,2)}},Sr.batchedUpdates=function(b,S){return b(S)},Sr.createComponentSelector=function(b){return{$$typeof:K0,value:b}},Sr.createContainer=function(b,S,N,V,ee,le,Ne,Qe,St,Lt){return w0(b,S,!1,null,N,V,le,null,Ne,Qe,St,Lt)},Sr.createHasPseudoClassSelector=function(b){return{$$typeof:Nd,value:b}},Sr.createHydrationContainer=function(b,S,N,V,ee,le,Ne,Qe,St,Lt,Kt,Xt,vn,Zn){var Nr;return b=w0(N,V,!0,b,ee,le,Qe,Zn,St,Lt,Kt,Xt),b.context=No(null),N=b.current,V=Ki(),V=F(V),ee=ti(V),ee.callback=(Nr=S)!=null?Nr:null,Fi(N,ee,V),S=V,b.current.lanes=S,A(b,S),wt(b),b},Sr.createPortal=function(b,S,N){var V=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Iu,key:V==null?null:""+V,children:b,containerInfo:S,implementation:N}},Sr.createRoleSelector=function(b){return{$$typeof:Nf,value:b}},Sr.createTestNameSelector=function(b){return{$$typeof:_y,value:b}},Sr.createTextSelector=function(b){return{$$typeof:Xb,value:b}},Sr.defaultOnCaughtError=function(b){console.error(b)},Sr.defaultOnRecoverableError=function(b){Yb(b)},Sr.defaultOnUncaughtError=function(b){Yb(b)},Sr.deferredUpdates=function(b){var S=dr.T,N=ra();try{return po(32),dr.T=null,b()}finally{po(N),dr.T=S}},Sr.discreteUpdates=function(b,S,N,V,ee){var le=dr.T,Ne=ra();try{return po(2),dr.T=null,b(S,N,V,ee)}finally{po(Ne),dr.T=le,Yr===0&&(Ae=Fr()+500)}},Sr.findAllNodes=wr,Sr.findBoundingRects=function(b,S){if(!Bu)throw Error(i(363));S=wr(b,S),b=[];for(var N=0;N<S.length;N++)b.push(zp(S[N]));for(S=b.length-1;0<S;S--){N=b[S];for(var V=N.x,ee=V+N.width,le=N.y,Ne=le+N.height,Qe=S-1;0<=Qe;Qe--)if(S!==Qe){var St=b[Qe],Lt=St.x,Kt=Lt+St.width,Xt=St.y,vn=Xt+St.height;if(V>=Lt&&le>=Xt&&ee<=Kt&&Ne<=vn){b.splice(S,1);break}else if(V!==Lt||N.width!==St.width||vn<le||Xt>Ne){if(!(le!==Xt||N.height!==St.height||Kt<V||Lt>ee)){Lt>V&&(St.width+=Lt-V,St.x=V),Kt<ee&&(St.width=ee-Lt),b.splice(S,1);break}}else{Xt>le&&(St.height+=Xt-le,St.y=le),vn<Ne&&(St.height=Ne-Xt),b.splice(S,1);break}}}return b},Sr.findHostInstance=Dh,Sr.findHostInstanceWithNoPortals=function(b){return b=a(b),b=b!==null?l(b):null,b===null?null:Du(b.stateNode)},Sr.findHostInstanceWithWarning=function(b){return Dh(b)},Sr.flushPassiveEffects=Nh,Sr.flushSyncFromReconciler=function(b){var S=Yr;Yr|=1;var N=dr.T,V=ra();try{if(po(2),dr.T=null,b)return b()}finally{po(V),dr.T=N,Yr=S,(Yr&6)===0&&Re(0)}},Sr.flushSyncWork=$v,Sr.focusWithin=function(b,S){if(!Bu)throw Error(i(363));for(b=Mu(b),S=_d(b,S),S=Array.from(S),b=0;b<S.length;){var N=S[b++],V=N.tag;if(!Uh(N)){if((V===5||V===26||V===27)&&N0(N.stateNode))return!0;for(N=N.child;N!==null;)S.push(N),N=N.sibling}}return!1},Sr.getFindAllNodesFailureDescription=function(b,S){if(!Bu)throw Error(i(363));var N=0,V=[];b=[Mu(b),0];for(var ee=0;ee<b.length;){var le=b[ee++],Ne=le.tag,Qe=b[ee++],St=S[Qe];if((Ne!==5&&Ne!==26&&Ne!==27||!Uh(le))&&(v0(le,St)&&(V.push(y0(St)),Qe++,Qe>N&&(N=Qe)),Qe<S.length))for(le=le.child;le!==null;)b.push(le,Qe),le=le.sibling}if(N<S.length){for(b=[];N<S.length;N++)b.push(y0(S[N]));return`findAllNodes was able to match part of the selector:
  `+(V.join(" > ")+`

No matching component was found for:
  `)+b.join(" > ")}return null},Sr.getPublicRootInstance=function(b){if(b=b.current,!b.child)return null;switch(b.child.tag){case 27:case 5:return Du(b.child.stateNode);default:return b.child.stateNode}},Sr.injectIntoDevTools=function(){var b={bundleType:0,version:Zv,rendererPackageName:C0,currentDispatcherRef:dr,reconcilerVersion:"19.2.0"};if(pl!==null&&(b.rendererConfig=pl),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")b=!1;else{var S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(S.isDisabled||!S.supportsFiber)b=!0;else{try{W0=S.inject(b),Za=S}catch{}b=!!S.checkDCE}}return b},Sr.isAlreadyRendering=function(){return(Yr&6)!==0},Sr.observeVisibleRects=function(b,S,N,V){if(!Bu)throw Error(i(363));b=wr(b,S);var ee=Vp(b,N,V).disconnect;return{disconnect:function(){ee()}}},Sr.shouldError=function(){return null},Sr.shouldSuspend=function(){return!1},Sr.startHostTransition=function(b,S,N,V){if(b.tag!==5)throw Error(i(476));var ee=e_(b).queue;jv(b,ee,S,gl,N===null?r:function(){var le=e_(b);return le.next===null&&(le=b.alternate.memoizedState),Oo(b,le.next.queue,{},Ki()),N(V)})},Sr.updateContainer=function(b,S,N,V){var ee=S.current,le=Ki();return T0(ee,le,b,S,N,V),le},Sr.updateContainerSync=function(b,S,N,V){return T0(S.current,2,b,S,N,V),2},Sr},t.exports.default=t.exports,Object.defineProperty(t.exports,"__esModule",{value:!0})})(BF)),BF.exports}var jF;function dpe(){return jF||(jF=1,UF.exports=fpe()),UF.exports}var ppe=dpe();const mpe=hpe(ppe);function gpe(t){const e=mpe(t);return e.injectIntoDevTools(),e}const Oq=0,wE={},_pe=/^three(?=[A-Z])/,TO=t=>`${t[0].toUpperCase()}${t.slice(1)}`;let vpe=0;const ype=t=>typeof t=="function";function Iq(t){if(ype(t)){const e=`${vpe++}`;return wE[e]=t,e}else Object.assign(wE,t)}function Nq(t,e){const n=TO(t),r=wE[n];if(t!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(t==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function bpe(t,e,n){var r;return t=TO(t)in wE?t:t.replace(_pe,""),Nq(t,e),t==="primitive"&&(r=e.object)!=null&&r.__r3f&&delete e.object.__r3f,Zk(e.object,n,t,e)}function Spe(t){if(!t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?eM(t.parent,t):ru(t.object)&&(t.object.visible=!1),t.isHidden=!0,tx(t)}}function Pq(t){if(t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?Qk(t.parent,t):ru(t.object)&&t.props.visible!==!1&&(t.object.visible=!0),t.isHidden=!1,tx(t)}}function s5(t,e,n){const r=e.root.getState();if(!(!t.parent&&t.object!==r.scene)){if(!e.object){var i,s;const o=wE[TO(e.type)];e.object=(i=e.props.object)!=null?i:new o(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(tv(e.object,e.props),e.props.attach)Qk(t,e);else if(ru(e.object)&&ru(t.object)){const o=t.object.children.indexOf(n?.object);if(n&&o!==-1){const a=t.object.children.indexOf(e.object);if(a!==-1){t.object.children.splice(a,1);const c=a<o?o-1:o;t.object.children.splice(c,0,e.object)}else e.object.parent=t.object,t.object.children.splice(o,0,e.object),e.object.dispatchEvent({type:"added"}),t.object.dispatchEvent({type:"childadded",child:e.object})}else t.object.add(e.object)}for(const o of e.children)s5(e,o);tx(e)}}function L3(t,e){e&&(e.parent=t,t.children.push(e),s5(t,e))}function zF(t,e,n){if(!e||!n)return;e.parent=t;const r=t.children.indexOf(n);r!==-1?t.children.splice(r,0,e):t.children.push(e),s5(t,e,n)}function Dq(t){if(typeof t.dispose=="function"){const e=()=>{try{t.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():eL.unstable_scheduleCallback(eL.unstable_IdlePriority,e)}}function nL(t,e,n){if(!e)return;e.parent=null;const r=t.children.indexOf(e);r!==-1&&t.children.splice(r,1),e.props.attach?eM(t,e):ru(e.object)&&ru(t.object)&&(t.object.remove(e.object),npe(xq(e),e.object));const i=e.props.dispose!==null&&n!==!1;for(let s=e.children.length-1;s>=0;s--){const o=e.children[s];nL(e,o,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&Dq(e.object),n===void 0&&tx(e)}function Epe(t,e){for(const n of[t,t.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(e);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=e)}const fk=[];function xpe(){for(const[n]of fk){const r=n.parent;if(r){n.props.attach?eM(r,n):ru(n.object)&&ru(r.object)&&r.object.remove(n.object);for(const i of n.children)i.props.attach?eM(n,i):ru(i.object)&&ru(n.object)&&n.object.remove(i.object)}n.isHidden&&Pq(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&Dq(n.object)}for(const[n,r,i]of fk){n.props=r;const s=n.parent;if(s){var t,e;const o=wE[TO(n.type)];n.object=(t=n.props.object)!=null?t:new o(...(e=n.props.args)!=null?e:[]),n.object.__r3f=n,Epe(i,n.object),tv(n.object,n.props),n.props.attach?Qk(s,n):ru(n.object)&&ru(s.object)&&s.object.add(n.object);for(const a of n.children)a.props.attach?Qk(n,a):ru(a.object)&&ru(n.object)&&n.object.add(a.object);tx(n)}}fk.length=0}const U3=()=>{},VF={};let aR=Oq;const wpe=0,Tpe=4,tM=gpe({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:bpe,removeChild:nL,appendChild:L3,appendInitialChild:L3,insertBefore:zF,appendChildToContainer(t,e){const n=t.getState().scene.__r3f;!e||!n||L3(n,e)},removeChildFromContainer(t,e){const n=t.getState().scene.__r3f;!e||!n||nL(n,e)},insertInContainerBefore(t,e,n){const r=t.getState().scene.__r3f;!e||!n||!r||zF(r,e,n)},getRootHostContext:()=>VF,getChildHostContext:()=>VF,commitUpdate(t,e,n,r,i){var s,o,a;Nq(e,r);let c=!1;if((t.type==="primitive"&&n.object!==r.object||((s=r.args)==null?void 0:s.length)!==((o=n.args)==null?void 0:o.length)||(a=r.args)!=null&&a.some((u,h)=>{var f;return u!==((f=n.args)==null?void 0:f[h])}))&&(c=!0),c)fk.push([t,{...r},i]);else{const u=Qde(t,r);Object.keys(u).length&&(Object.assign(t.props,u),tv(t.object,u))}(i.sibling===null||(i.flags&Tpe)===wpe)&&xpe()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:t=>t?.object,prepareForCommit:()=>null,preparePortalMount:t=>Zk(t.getState().scene,t,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:Spe,unhideInstance:Pq,createTextInstance:U3,hideTextInstance:U3,unhideTextInstance:U3,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Ye.createContext(null),setCurrentUpdatePriority(t){aR=t},getCurrentUpdatePriority(){return aR},resolveUpdatePriority(){var t;if(aR!==Oq)return aR;switch(typeof window<"u"&&((t=window.event)==null?void 0:t.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return lpe;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ape;default:return cpe}},resetFormInstance(){},rendererPackageName:"@react-three/fiber",rendererVersion:upe.version,applyViewTransitionName(t,e,n){},restoreViewTransitionName(t,e){},cancelViewTransitionName(t,e,n){},cancelRootViewTransitionName(t){},restoreRootViewTransitionName(t){},InstanceMeasurement:null,measureInstance:t=>null,wasInstanceInViewport:t=>!0,hasInstanceChanged:(t,e)=>!1,hasInstanceAffectedParent:(t,e)=>!1,suspendOnActiveViewTransition(t,e){},startGestureTransition:()=>null,startViewTransition:()=>null,stopViewTransition(t){},createViewTransitionInstance:t=>null,getCurrentGestureOffset(t){throw new Error("startGestureTransition is not yet supported in react-three-fiber.")},cloneMutableInstance(t,e){return t},cloneMutableTextInstance(t){return t},cloneRootViewTransitionContainer(t){throw new Error("Not implemented.")},removeRootViewTransitionClone(t,e){throw new Error("Not implemented.")},createFragmentInstance:t=>null,updateFragmentInstanceFiber(t,e){},commitNewChildToFragmentInstance(t,e){},deleteChildFromFragmentInstance(t,e){},measureClonedInstance:t=>null,maySuspendCommitOnUpdate:(t,e,n)=>!1,maySuspendCommitInSyncRender:(t,e)=>!1,startSuspendingCommit:()=>null,getSuspendedCommitReason:(t,e)=>null}),C1=new Map,yS={objects:"shallow",strict:!1};function Ape(t,e){if(!e&&typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:n,height:r,top:i,left:s}=t.parentElement.getBoundingClientRect();return{width:n,height:r,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function Cpe(t){const e=C1.get(t),n=e?.fiber,r=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||ipe(sL,$F),o=n||tM.createContainer(s,ope,null,!1,null,"",i,i,i,null);e||C1.set(t,{fiber:o,store:s});let a,c,l=!1,u=null;return{async configure(h={}){let f;u=new Promise(H=>f=H);let{gl:d,size:p,scene:m,events:g,onCreated:_,shadows:y=!1,linear:v=!1,flat:E=!1,legacy:x=!1,orthographic:A=!1,frameloop:T="always",dpr:k=[1,2],performance:L,raycaster:I,camera:F,onPointerMissed:M}=h,D=s.getState(),O=D.gl;if(!D.gl){const H={canvas:t,powerPreference:"high-performance",antialias:!0,alpha:!0},Y=typeof d=="function"?await d(H):d;DF(Y)?O=Y:O=new Ide({...H,...d}),D.set({gl:O})}let z=D.raycaster;z||D.set({raycaster:z=new dq});const{params:q,...G}=I||{};if(Co.equ(G,z,yS)||tv(z,{...G}),Co.equ(q,z.params,yS)||tv(z,{params:{...z.params,...q}}),!D.camera||D.camera===c&&!Co.equ(c,F,yS)){c=F;const H=F?.isCamera,Y=H?F:A?new EO(0,0,0,0,.1,1e3):new su(75,0,.1,1e3);H||(Y.position.z=5,F&&(tv(Y,F),Y.manual||("aspect"in F||"left"in F||"right"in F||"bottom"in F||"top"in F)&&(Y.manual=!0,Y.updateProjectionMatrix())),!D.camera&&!(F!=null&&F.rotation)&&Y.lookAt(0,0,0)),D.set({camera:Y}),z.camera=Y}if(!D.scene){let H;m!=null&&m.isScene?(H=m,Zk(H,s,"",{})):(H=new Jk,Zk(H,s,"",{}),m&&tv(H,m)),D.set({scene:H})}g&&!D.events.handlers&&D.set({events:g(s)});const K=Ape(t,p);if(Co.equ(K,D.size,yS)||D.setSize(K.width,K.height,K.top,K.left),k&&D.viewport.dpr!==Aq(k)&&D.setDpr(k),D.frameloop!==T&&D.setFrameloop(T),D.onPointerMissed||D.set({onPointerMissed:M}),L&&!Co.equ(L,D.performance,yS)&&D.set(H=>({performance:{...H.performance,...L}})),!D.xr){var te;const H=(Q,ie)=>{const ge=s.getState();ge.frameloop!=="never"&&$F(Q,!0,ge,ie)},Y=()=>{const Q=s.getState();Q.gl.xr.enabled=Q.gl.xr.isPresenting,Q.gl.xr.setAnimationLoop(Q.gl.xr.isPresenting?H:null),Q.gl.xr.isPresenting||sL(Q)},Z={connect(){const Q=s.getState().gl;Q.xr.addEventListener("sessionstart",Y),Q.xr.addEventListener("sessionend",Y)},disconnect(){const Q=s.getState().gl;Q.xr.removeEventListener("sessionstart",Y),Q.xr.removeEventListener("sessionend",Y)}};typeof((te=O.xr)==null?void 0:te.addEventListener)=="function"&&Z.connect(),D.set({xr:Z})}if(O.shadowMap){const H=O.shadowMap.enabled,Y=O.shadowMap.type;if(O.shadowMap.enabled=!!y,Co.boo(y))O.shadowMap.type=ik;else if(Co.str(y)){var re;const Z={basic:oae,percentage:V4,soft:ik,variance:lm};O.shadowMap.type=(re=Z[y])!=null?re:ik}else Co.obj(y)&&Object.assign(O.shadowMap,y);(H!==O.shadowMap.enabled||Y!==O.shadowMap.type)&&(O.shadowMap.needsUpdate=!0)}return Xi.enabled=!x,l||(O.outputColorSpace=v?Cg:Bi,O.toneMapping=E?yg:YW),D.legacy!==x&&D.set(()=>({legacy:x})),D.linear!==v&&D.set(()=>({linear:v})),D.flat!==E&&D.set(()=>({flat:E})),d&&!Co.fun(d)&&!DF(d)&&!Co.equ(d,O,yS)&&tv(O,d),a=_,l=!0,f(),this},render(h){return!l&&!u&&this.configure(),u.then(()=>{tM.updateContainer(Ee.jsx(Rpe,{store:s,children:h,onCreated:a,rootElement:t}),o,null,()=>{})}),s},unmount(){kpe(t)}}}function Rpe({store:t,children:e,onCreated:n,rootElement:r}){return t5(()=>{const i=t.getState();i.set(s=>({internal:{...s.internal,active:!0}})),n&&n(i),t.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),Ee.jsx(n5.Provider,{value:t,children:e})}function kpe(t,e){const n=C1.get(t),r=n?.fiber;if(r){const i=n?.store.getState();i&&(i.internal.active=!1),tM.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,o,a,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),Xde(i.scene),C1.delete(t)}catch{}},500)})}}function Mpe(t,e,n){return Ee.jsx(Ope,{children:t,container:e,state:n})}function Ope({state:t={},children:e,container:n}){const{events:r,size:i,...s}=t,o=r5(),[a]=Ye.useState(()=>new dq),[c]=Ye.useState(()=>new zn),l=Tq((h,f)=>{let d;if(f.camera&&i){const p=f.camera;d=h.viewport.getCurrentViewport(p,new zt,i),p!==h.camera&&Rq(p,i)}return{...h,...f,scene:n,raycaster:a,pointer:c,mouse:c,previousRoot:o,events:{...h.events,...f.events,...r},size:{...h.size,...i},viewport:{...h.viewport,...d},setEvents:p=>f.set(m=>({...m,events:{...m.events,...p}}))}}),u=Ye.useMemo(()=>{const h=yq((d,p)=>({...s,set:d,get:p})),f=d=>h.setState(p=>l.current(d,p));return f(o.getState()),o.subscribe(f),h},[o,n]);return Ee.jsx(Ee.Fragment,{children:tM.createPortal(Ee.jsx(n5.Provider,{value:u,children:e}),u,null)})}function Lq(t,e){const n={callback:t};return e.add(n),()=>{e.delete(n)}}const Uq=new Set,Bq=new Set,Ipe=new Set,Npe=t=>Lq(t,Uq),Ppe=t=>Lq(t,Bq);function B3(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function PT(t,e){switch(t){case"before":return B3(Uq,e);case"after":return B3(Bq,e);case"tail":return B3(Ipe,e)}}let F3,j3;function rL(t,e,n){let r=e.clock.getDelta();e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),F3=e.internal.subscribers;for(let i=0;i<F3.length;i++)j3=F3[i],j3.ref.current(j3.store.getState(),r,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let nM=!1,iL=!1,z3,HF,bS;function Fq(t){HF=requestAnimationFrame(Fq),nM=!0,z3=0,PT("before",t),iL=!0;for(const n of C1.values()){var e;bS=n.store.getState(),bS.internal.active&&(bS.frameloop==="always"||bS.internal.frames>0)&&!((e=bS.gl.xr)!=null&&e.isPresenting)&&(z3+=rL(t,bS))}if(iL=!1,PT("after",t),z3===0)return PT("tail",t),nM=!1,cancelAnimationFrame(HF)}function sL(t,e=1){var n;if(!t)return C1.forEach(r=>sL(r.store.getState(),e));(n=t.gl.xr)!=null&&n.isPresenting||!t.internal.active||t.frameloop==="never"||(e>1?t.internal.frames=Math.min(60,t.internal.frames+e):iL?t.internal.frames=2:t.internal.frames=1,nM||(nM=!0,requestAnimationFrame(Fq)))}function $F(t,e=!0,n,r){if(e&&PT("before",t),n)rL(t,n,r);else for(const i of C1.values())rL(t,i.store.getState());e&&PT("after",t)}const V3={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Dpe(t){const{handlePointer:e}=rpe(t);return{priority:1,enabled:!0,compute(n,r,i){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(V3).reduce((n,r)=>({...n,[r]:e(r)}),{}),update:()=>{var n;const{events:r,internal:i}=t.getState();(n=i.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:n=>{const{set:r,events:i}=t.getState();if(i.disconnect==null||i.disconnect(),r(s=>({events:{...s.events,connected:n}})),i.handlers)for(const s in i.handlers){const o=i.handlers[s],[a,c]=V3[s];n.addEventListener(a,o,{passive:c})}},disconnect:()=>{const{set:n,events:r}=t.getState();if(r.connected){if(r.handlers)for(const i in r.handlers){const s=r.handlers[i],[o]=V3[i];r.connected.removeEventListener(o,s)}n(i=>({events:{...i.events,connected:void 0}}))}}}}var cR={exports:{}},GF;function Lpe(){if(GF)return cR.exports;GF=1;function t(e,n=100,r={}){if(typeof e!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof e}\`.`);if(n<0)throw new RangeError("`wait` must not be negative.");const{immediate:i}=typeof r=="boolean"?{immediate:r}:r;let s,o,a,c,l;function u(){const d=s,p=o;return s=void 0,o=void 0,l=e.apply(d,p),l}function h(){const d=Date.now()-c;d<n&&d>=0?a=setTimeout(h,n-d):(a=void 0,i||(l=u()))}const f=function(...d){if(s&&this!==s&&Object.getPrototypeOf(this)===Object.getPrototypeOf(s))throw new Error("Debounced method called with different contexts of the same prototype.");s=this,o=d,c=Date.now();const p=i&&!a;return a||(a=setTimeout(h,n)),p&&(l=u()),l};return Object.defineProperty(f,"isPending",{get(){return a!==void 0}}),f.clear=()=>{a&&(clearTimeout(a),a=void 0)},f.flush=()=>{a&&f.trigger()},f.trigger=()=>{l=u(),f.clear()},f}return cR.exports.debounce=t,cR.exports=t,cR.exports}var Upe=Lpe();const Bpe=_u(Upe),bn=60,Tr=25,zm=bn*Tr;var Qr=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Qr||{}),la=(t=>(t.MAIN="main",t.TEMP="temp",t.TITLE="title",t.PLAYER="player",t.GADGETSTORE="gadgetstore",t))(la||{});var Fpe=(function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})(),jpe=Object.prototype.hasOwnProperty;function oL(t,e){return jpe.call(t,e)}function aL(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)oL(t,i)&&r.push(i);return r}function lh(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function cL(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Yy(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function jq(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function lL(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(lL(t[e]))return!0}else if(typeof t=="object"){for(var r=aL(t),i=r.length,s=0;s<i;s++)if(lL(t[r[s]]))return!0}}return!1}function WF(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var zq=(function(t){Fpe(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,WF(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=WF(n,{name:r,index:i,operation:s,tree:o}),c}return e})(Error),ua=zq,zpe=lh,JS={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=rM(n,this.path);r&&(r=lh(r));var i=p1(n,{op:"remove",path:this.from}).removed;return p1(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=rM(n,this.from);return p1(n,{op:"add",path:this.path,value:lh(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:QT(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},Vpe={add:function(t,e,n){return cL(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:JS.move,copy:JS.copy,test:JS.test,_get:JS._get};function rM(t,e){if(e=="")return t;var n={op:"_get",path:e};return p1(t,n),n.value}function p1(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):iM(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=rM(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=QT(t,e.value),o.test===!1)throw new ua("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new ua("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=lh(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=iM;;){if(d=c[u],d&&d.indexOf("~")!=-1&&(d=jq(d)),i&&(d=="__proto__"||d=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(l[d]===void 0?f=c.slice(0,u).join("/"):u==h-1&&(f=e.path),f!==void 0&&p(e,0,t,f)),u++,Array.isArray(l)){if(d==="-")d=l.length;else{if(n&&!cL(d))throw new ua("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);cL(d)&&(d=~~d)}if(u>=h){if(n&&e.op==="add"&&d>l.length)throw new ua("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=Vpe[e.op].call(e,l,d,t);if(o.test===!1)throw new ua("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=h){var o=JS[e.op].call(e,l,d,t);if(o.test===!1)throw new ua("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[d],n&&u<h&&(!l||typeof l!="object"))throw new ua("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function AO(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new ua("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=lh(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=p1(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function Hpe(t,e,n){var r=p1(t,e);if(r.test===!1)throw new ua("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function iM(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new ua("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(JS[t.op]){if(typeof t.path!="string")throw new ua("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new ua('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new ua("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new ua("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&lL(t.value))throw new ua("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ua("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new ua("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Vq([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ua("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new ua("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Vq(t,e,n){try{if(!Array.isArray(t))throw new ua("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)AO(lh(e),lh(t),n||!0);else{n=n||iM;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof ua)return i;throw i}}function QT(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!QT(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!QT(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}const $pe=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:ua,_areEquals:QT,applyOperation:p1,applyPatch:AO,applyReducer:Hpe,deepClone:zpe,getValueByPointer:rM,validate:Vq,validator:iM},Symbol.toStringTag,{value:"Module"}));var o5=new WeakMap,Gpe=(function(){function t(e){this.observers=new Map,this.obj=e}return t})(),Wpe=(function(){function t(e,n){this.callback=e,this.observer=n}return t})();function qpe(t){return o5.get(t)}function Ype(t,e){return t.observers.get(e)}function Kpe(t,e){t.observers.delete(e.callback)}function Xpe(t,e){e.unobserve()}function Jpe(t,e){var n=[],r,i=qpe(t);if(!i)i=new Gpe(t),o5.set(t,i);else{var s=Ype(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=lh(t),e){r.callback=e,r.next=null;var o=function(){uL(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){uL(r),clearTimeout(r.next),Kpe(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new Wpe(e,r)),r}function uL(t,e){e===void 0&&(e=!1);var n=o5.get(t.object);a5(n.value,t.object,t.patches,"",e),t.patches.length&&AO(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function a5(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=aL(e),o=aL(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(oL(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?a5(u,h,n,r+"/"+Yy(l),i):u!==h&&(i&&n.push({op:"test",path:r+"/"+Yy(l),value:lh(u)}),n.push({op:"replace",path:r+"/"+Yy(l),value:lh(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+Yy(l),value:lh(u)}),n.push({op:"remove",path:r+"/"+Yy(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!oL(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+Yy(l),value:lh(e[l])})}}}function Zpe(t,e,n){n===void 0&&(n=!1);var r=[];return a5(t,e,r,"",n),r}const Qpe=Object.freeze(Object.defineProperty({__proto__:null,compare:Zpe,generate:uL,observe:Jpe,unobserve:Xpe},Symbol.toStringTag,{value:"Module"}));Object.assign({},$pe,Qpe,{JsonPatchError:zq,deepClone:lh,escapePathComponent:Yy,unescapePathComponent:jq});var H3,qF;function eme(){if(qF)return H3;qF=1;var t=typeof Element<"u",e=typeof Map=="function",n=typeof Set=="function",r=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function i(s,o){if(s===o)return!0;if(s&&o&&typeof s=="object"&&typeof o=="object"){if(s.constructor!==o.constructor)return!1;var a,c,l;if(Array.isArray(s)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(!i(s[c],o[c]))return!1;return!0}var u;if(e&&s instanceof Map&&o instanceof Map){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;for(u=s.entries();!(c=u.next()).done;)if(!i(c.value[1],o.get(c.value[0])))return!1;return!0}if(n&&s instanceof Set&&o instanceof Set){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;return!0}if(r&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(o)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(s[c]!==o[c])return!1;return!0}if(s.constructor===RegExp)return s.source===o.source&&s.flags===o.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof o.valueOf=="function")return s.valueOf()===o.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof o.toString=="function")return s.toString()===o.toString();if(l=Object.keys(s),a=l.length,a!==Object.keys(o).length)return!1;for(c=a;c--!==0;)if(!Object.prototype.hasOwnProperty.call(o,l[c]))return!1;if(t&&s instanceof Element)return!1;for(c=a;c--!==0;)if(!((l[c]==="_owner"||l[c]==="__v"||l[c]==="__o")&&s.$$typeof)&&!i(s[l[c]],o[l[c]]))return!1;return!0}return s!==s&&o!==o}return H3=function(o,a){try{return i(o,a)}catch(c){if((c.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw c}},H3}var tme=eme();const J_=_u(tme);function fe(t){return t!=null}const nme=Object.fromEntries,Dm=Object.keys;function Ts(t){return lh(t)}function rme(t){return typeof t=="boolean"}function nn(t){return typeof t=="number"&&isNaN(t)===!1}function dn(t){return typeof t=="string"}function Kn(t){return Array.isArray(t)}function c5(t){return t}function ime(t){return t!==null&&typeof t=="object"&&dn(t.id)&&dn(t.name)&&Kn(t.pages)&&Kn(t.activelist)&&typeof t.flags=="object"}var Ft=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t[t.BLBLACK=33]="BLBLACK",t[t.BLDKBLUE=34]="BLDKBLUE",t[t.BLDKGREEN=35]="BLDKGREEN",t[t.BLDKCYAN=36]="BLDKCYAN",t[t.BLDKRED=37]="BLDKRED",t[t.BLDKPURPLE=38]="BLDKPURPLE",t[t.BLDKYELLOW=39]="BLDKYELLOW",t[t.BLLTGRAY=40]="BLLTGRAY",t[t.BLDKGRAY=41]="BLDKGRAY",t[t.BLBLUE=42]="BLBLUE",t[t.BLGREEN=43]="BLGREEN",t[t.BLCYAN=44]="BLCYAN",t[t.BLRED=45]="BLRED",t[t.BLPURPLE=46]="BLPURPLE",t[t.BLYELLOW=47]="BLYELLOW",t[t.BLWHITE=48]="BLWHITE",t))(Ft||{}),Fn=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t[t.ISGHOST=4]="ISGHOST",t))(Fn||{}),R1=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(R1||{}),yn=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.FIND=18]="FIND",t[t.FLEE=19]="FLEE",t[t.TO=20]="TO",t[t.MID=21]="MID",t[t.OVER=22]="OVER",t[t.UNDER=23]="UNDER",t[t.GROUND=24]="GROUND",t[t.WITHIN=25]="WITHIN",t[t.AWAYBY=26]="AWAYBY",t[t.ELEMENTS=27]="ELEMENTS",t))(yn||{}),Hn=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.VIEWIT=14]="VIEWIT",t[t.RUNIT=15]="RUNIT",t[t.ZSSEDIT=16]="ZSSEDIT",t[t.CHAREDIT=17]="CHAREDIT",t[t.COLOREDIT=18]="COLOREDIT",t))(Hn||{});function rr(t){return dn(t)?t.toLowerCase().trim():""}const m1=14,eA=3,Yo=8,Ia=14,yo=16,YF=16,sme=16;var Ji=(t=>(t[t.BLANK=0]="BLANK",t[t.TILES=1]="TILES",t[t.SPRITES=2]="SPRITES",t[t.DITHER=3]="DITHER",t[t.MEDIA=4]="MEDIA",t[t.CONTROL=5]="CONTROL",t))(Ji||{}),fc=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(fc||{});function q1(t){let e=0,n=0,r=bn*.5,i=Tr*.5,s=1.5,o="flat",a=0;return t.forEach(c=>{switch(c.type){case 1:e=Math.max(e,c.width),n=Math.max(n,c.height);break;case 3:e=Math.max(e,c.width),n=Math.max(n,c.height);break;case 5:r=c.focusx,i=c.focusy,s=c.viewscale,o=c.graphics,a=c.facing;break}}),{width:e,height:n,focusx:r,focusy:i,viewscale:s,graphics:o,facing:a}}function Cv(t,e){return`${t}:${e}`}const l5=1,u5=16,h5=256;var Ct=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Ct||{});const Lm=!!JSON.parse("false"),ome=!!JSON.parse("false"),ame=!!JSON.parse("false"),KF=!!JSON.parse("false");JSON.parse("false");JSON.parse("false");JSON.parse("false");JSON.parse("false");const kn={YIELD_AT_COUNT:512,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Yo*kn.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Ia*kn.DRAW_CHAR_SCALE}};function cme(t){const e=document.createElement("canvas");if(e.width=t?.width||1,e.height=t?.height||1,t){const n=e.getContext("2d"),r=n?.getImageData(0,0,t.width,t.height);if(r&&n){let i=0;const{data:s}=r;for(let o=0;o<s.length;o+=4){const a=t.bits[i];s[o]=a,s[o+1]=a,s[o+2]=a,s[o+3]=255,i+=1}n.putImageData(r,0,0)}}return e}function f5(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}function $3(t,e,n){return{width:t,height:e,size:t*e,bits:new Uint8Array(n)}}function G3(t,e,n){if(!fe(t))return;const r=Math.round(t.height/n),i=Math.round(t.width/e),s=e+2,o=n+2,a=i*e,c=i*s,l=r*o,u=f5(c,l);for(let h=0;h<r;++h)for(let f=0;f<i;++f)for(let d=0;d<n;++d)for(let p=0;p<e;++p){const m=f*e+p,g=h*n+d,_=t.bits[m+g*a],y=f*s+p+1,v=h*o+d+1,E=y+v*c;u.bits[E]=_,p===0&&(u.bits[E-1]=_),p===Yo-1&&(u.bits[E+1]=_),d===0&&(u.bits[E-c]=_),d===Ia-1&&(u.bits[E+c]=_)}return u}function Y1(t){const e=Math.floor(t.length/eA);if(e*eA!==t.length)return;const n=f5(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function lme(t,e){return t&1<<e?255:0}function K1(t){const e=Math.floor(t.length/m1);if(e*m1!==t.length)return;const n=Math.ceil(e/yo),r=Yo*yo,i=f5(r,Ia*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*Ia+a,u=t[c];for(let h=0;h<Yo;++h){const f=s*Yo+h;i.bits[f+l*r]=lme(u,7-h)}++a,a===Ia&&(a=0,++s,s===yo&&(s=0,++o))}return i}function ume(t,e,n){if(!fe(e))return;const r=Math.floor(e.bits.length/m1);if(n<0||n>255||t.length===m1||r*m1!==e.bits.length)return;const i=Yo*yo,s=n%yo*Yo,o=Math.floor(n/yo)*Ia,a=0;for(let c=0;c<Ia;++c)for(let l=0;l<Yo;++l){const u=s+l,h=o+c;e.bits[u+h*i]=t[a]?255:0}}function hme(t,e){const n=[];if(!fe(t))return Uint8Array.from(n);const r=Math.floor(t.bits.length/m1);if(e<0||e>255||r*m1!==t.bits.length)return Uint8Array.from(n);const i=Yo*yo,s=e%yo*Yo,o=Math.floor(e/yo)*Ia;for(let a=0;a<Ia;++a)for(let c=0;c<Yo;++c){const l=s+c,u=o+a;n.push(t.bits[l+u*i])}return Uint8Array.from(n)}const XF="0123456789abcdef",Hq=[],sM=[];for(let t=0;t<256;t++)Hq[t]=XF[t>>4&15]+XF[t&15],t<16&&(t<10?sM[48+t]=t:sM[87+t]=t);const d5=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=Hq[t[r++]];return n},oM=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=sM[t.charCodeAt(s++)]<<4|sM[t.charCodeAt(s++)];return r};var JF="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fme=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var lR=0;lR<JF.length;lR++)fme[JF.charCodeAt(lR)]=lR;new TextDecoder;new TextEncoder;const ZF=typeof window<"u"?window:self,QF=ZF.crypto||ZF.msCrypto||{};QF.subtle||QF.webkitSubtle;const X1=oM("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),J1=oM("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f"),a1=globalThis||void 0||self;var $q=typeof a1=="object"&&a1&&a1.Object===Object&&a1,dme=typeof self=="object"&&self&&self.Object===Object&&self,Vm=$q||dme||Function("return this")(),nd=Vm.Symbol,Gq=Object.prototype,pme=Gq.hasOwnProperty,mme=Gq.toString,Jx=nd?nd.toStringTag:void 0;function gme(t){var e=pme.call(t,Jx),n=t[Jx];try{t[Jx]=void 0;var r=!0}catch{}var i=mme.call(t);return r&&(e?t[Jx]=n:delete t[Jx]),i}var _me=Object.prototype,vme=_me.toString;function yme(t){return vme.call(t)}var bme="[object Null]",Sme="[object Undefined]",e7=nd?nd.toStringTag:void 0;function Rv(t){return t==null?t===void 0?Sme:bme:e7&&e7 in Object(t)?gme(t):yme(t)}function sp(t){return t!=null&&typeof t=="object"}var Eme="[object Symbol]";function CO(t){return typeof t=="symbol"||sp(t)&&Rv(t)==Eme}function RO(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Wi=Array.isArray,t7=nd?nd.prototype:void 0,n7=t7?t7.toString:void 0;function Wq(t){if(typeof t=="string")return t;if(Wi(t))return RO(t,Wq)+"";if(CO(t))return n7?n7.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var xme=/\s/;function wme(t){for(var e=t.length;e--&&xme.test(t.charAt(e)););return e}var Tme=/^\s+/;function Ame(t){return t&&t.slice(0,wme(t)+1).replace(Tme,"")}function rd(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var r7=NaN,Cme=/^[-+]0x[0-9a-f]+$/i,Rme=/^0b[01]+$/i,kme=/^0o[0-7]+$/i,Mme=parseInt;function Ome(t){if(typeof t=="number")return t;if(CO(t))return r7;if(rd(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=rd(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Ame(t);var n=Rme.test(t);return n||kme.test(t)?Mme(t.slice(2),n?2:8):Cme.test(t)?r7:+t}var i7=1/0,Ime=17976931348623157e292;function Nme(t){if(!t)return t===0?t:0;if(t=Ome(t),t===i7||t===-i7){var e=t<0?-1:1;return e*Ime}return t===t?t:0}function kO(t){var e=Nme(t),n=e%1;return e===e?n?e-n:e:0}function TE(t){return t}var Pme="[object AsyncFunction]",Dme="[object Function]",Lme="[object GeneratorFunction]",Ume="[object Proxy]";function Lg(t){if(!rd(t))return!1;var e=Rv(t);return e==Dme||e==Lme||e==Pme||e==Ume}var W3=Vm["__core-js_shared__"],s7=(function(){var t=/[^.]+$/.exec(W3&&W3.keys&&W3.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function Bme(t){return!!s7&&s7 in t}var Fme=Function.prototype,jme=Fme.toString;function Z1(t){if(t!=null){try{return jme.call(t)}catch{}try{return t+""}catch{}}return""}var zme=/[\\^$.*+?()[\]{}|]/g,Vme=/^\[object .+?Constructor\]$/,Hme=Function.prototype,$me=Object.prototype,Gme=Hme.toString,Wme=$me.hasOwnProperty,qme=RegExp("^"+Gme.call(Wme).replace(zme,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Yme(t){if(!rd(t)||Bme(t))return!1;var e=Lg(t)?qme:Vme;return e.test(Z1(t))}function Kme(t,e){return t?.[e]}function Q1(t,e){var n=Kme(t,e);return Yme(n)?n:void 0}var hL=Q1(Vm,"WeakMap"),o7=Object.create,Xme=(function(){function t(){}return function(e){if(!rd(e))return{};if(o7)return o7(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}})();function Jme(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function ic(){}function Zme(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Qme=800,e0e=16,t0e=Date.now;function n0e(t){var e=0,n=0;return function(){var r=t0e(),i=e0e-(r-n);if(n=r,i>0){if(++e>=Qme)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function r0e(t){return function(){return t}}var aM=(function(){try{var t=Q1(Object,"defineProperty");return t({},"",{}),t}catch{}})(),i0e=aM?function(t,e){return aM(t,"toString",{configurable:!0,enumerable:!1,value:r0e(e),writable:!0})}:TE,s0e=n0e(i0e);function qq(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function Yq(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function o0e(t){return t!==t}function a0e(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function p5(t,e,n){return e===e?a0e(t,e,n):Yq(t,o0e,n)}function Kq(t,e){var n=t==null?0:t.length;return!!n&&p5(t,e,0)>-1}var c0e=9007199254740991,l0e=/^(?:0|[1-9]\d*)$/;function MO(t,e){var n=typeof t;return e=e??c0e,!!e&&(n=="number"||n!="symbol"&&l0e.test(t))&&t>-1&&t%1==0&&t<e}function m5(t,e,n){e=="__proto__"&&aM?aM(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function zA(t,e){return t===e||t!==t&&e!==e}var u0e=Object.prototype,h0e=u0e.hasOwnProperty;function OO(t,e,n){var r=t[e];(!(h0e.call(t,e)&&zA(r,n))||n===void 0&&!(e in t))&&m5(t,e,n)}function g5(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?m5(n,a,c):OO(n,a,c)}return n}var a7=Math.max;function f0e(t,e,n){return e=a7(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=a7(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),Jme(t,this,a)}}function _5(t,e){return s0e(f0e(t,e,TE),t+"")}var d0e=9007199254740991;function v5(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=d0e}function Hm(t){return t!=null&&v5(t.length)&&!Lg(t)}function Xq(t,e,n){if(!rd(n))return!1;var r=typeof e;return(r=="number"?Hm(n)&&MO(e,n.length):r=="string"&&e in n)?zA(n[e],t):!1}function p0e(t){return _5(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&Xq(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var m0e=Object.prototype;function VA(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||m0e;return t===n}function g0e(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var _0e="[object Arguments]";function c7(t){return sp(t)&&Rv(t)==_0e}var Jq=Object.prototype,v0e=Jq.hasOwnProperty,y0e=Jq.propertyIsEnumerable,IO=c7((function(){return arguments})())?c7:function(t){return sp(t)&&v0e.call(t,"callee")&&!y0e.call(t,"callee")};function b0e(){return!1}var Zq=typeof nf=="object"&&nf&&!nf.nodeType&&nf,l7=Zq&&typeof rf=="object"&&rf&&!rf.nodeType&&rf,S0e=l7&&l7.exports===Zq,u7=S0e?Vm.Buffer:void 0,E0e=u7?u7.isBuffer:void 0,tA=E0e||b0e,x0e="[object Arguments]",w0e="[object Array]",T0e="[object Boolean]",A0e="[object Date]",C0e="[object Error]",R0e="[object Function]",k0e="[object Map]",M0e="[object Number]",O0e="[object Object]",I0e="[object RegExp]",N0e="[object Set]",P0e="[object String]",D0e="[object WeakMap]",L0e="[object ArrayBuffer]",U0e="[object DataView]",B0e="[object Float32Array]",F0e="[object Float64Array]",j0e="[object Int8Array]",z0e="[object Int16Array]",V0e="[object Int32Array]",H0e="[object Uint8Array]",$0e="[object Uint8ClampedArray]",G0e="[object Uint16Array]",W0e="[object Uint32Array]",vo={};vo[B0e]=vo[F0e]=vo[j0e]=vo[z0e]=vo[V0e]=vo[H0e]=vo[$0e]=vo[G0e]=vo[W0e]=!0;vo[x0e]=vo[w0e]=vo[L0e]=vo[T0e]=vo[U0e]=vo[A0e]=vo[C0e]=vo[R0e]=vo[k0e]=vo[M0e]=vo[O0e]=vo[I0e]=vo[N0e]=vo[P0e]=vo[D0e]=!1;function q0e(t){return sp(t)&&v5(t.length)&&!!vo[Rv(t)]}function NO(t){return function(e){return t(e)}}var Qq=typeof nf=="object"&&nf&&!nf.nodeType&&nf,DT=Qq&&typeof rf=="object"&&rf&&!rf.nodeType&&rf,Y0e=DT&&DT.exports===Qq,q3=Y0e&&$q.process,mv=(function(){try{var t=DT&&DT.require&&DT.require("util").types;return t||q3&&q3.binding&&q3.binding("util")}catch{}})(),h7=mv&&mv.isTypedArray,y5=h7?NO(h7):q0e,K0e=Object.prototype,X0e=K0e.hasOwnProperty;function eY(t,e){var n=Wi(t),r=!n&&IO(t),i=!n&&!r&&tA(t),s=!n&&!r&&!i&&y5(t),o=n||r||i||s,a=o?g0e(t.length,String):[],c=a.length;for(var l in t)(e||X0e.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||MO(l,c)))&&a.push(l);return a}function tY(t,e){return function(n){return t(e(n))}}var J0e=tY(Object.keys,Object),Z0e=Object.prototype,Q0e=Z0e.hasOwnProperty;function nY(t){if(!VA(t))return J0e(t);var e=[];for(var n in Object(t))Q0e.call(t,n)&&n!="constructor"&&e.push(n);return e}function id(t){return Hm(t)?eY(t):nY(t)}var ege=Object.prototype,tge=ege.hasOwnProperty,gh=p0e(function(t,e){if(VA(e)||Hm(e)){g5(e,id(e),t);return}for(var n in e)tge.call(e,n)&&OO(t,n,e[n])});function nge(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var rge=Object.prototype,ige=rge.hasOwnProperty;function sge(t){if(!rd(t))return nge(t);var e=VA(t),n=[];for(var r in t)r=="constructor"&&(e||!ige.call(t,r))||n.push(r);return n}function rY(t){return Hm(t)?eY(t,!0):sge(t)}var oge=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,age=/^\w*$/;function b5(t,e){if(Wi(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||CO(t)?!0:age.test(t)||!oge.test(t)||e!=null&&t in Object(e)}var nA=Q1(Object,"create");function cge(){this.__data__=nA?nA(null):{},this.size=0}function lge(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var uge="__lodash_hash_undefined__",hge=Object.prototype,fge=hge.hasOwnProperty;function dge(t){var e=this.__data__;if(nA){var n=e[t];return n===uge?void 0:n}return fge.call(e,t)?e[t]:void 0}var pge=Object.prototype,mge=pge.hasOwnProperty;function gge(t){var e=this.__data__;return nA?e[t]!==void 0:mge.call(e,t)}var _ge="__lodash_hash_undefined__";function vge(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=nA&&e===void 0?_ge:e,this}function k1(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}k1.prototype.clear=cge;k1.prototype.delete=lge;k1.prototype.get=dge;k1.prototype.has=gge;k1.prototype.set=vge;function yge(){this.__data__=[],this.size=0}function PO(t,e){for(var n=t.length;n--;)if(zA(t[n][0],e))return n;return-1}var bge=Array.prototype,Sge=bge.splice;function Ege(t){var e=this.__data__,n=PO(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Sge.call(e,n,1),--this.size,!0}function xge(t){var e=this.__data__,n=PO(e,t);return n<0?void 0:e[n][1]}function wge(t){return PO(this.__data__,t)>-1}function Tge(t,e){var n=this.__data__,r=PO(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Ug(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ug.prototype.clear=yge;Ug.prototype.delete=Ege;Ug.prototype.get=xge;Ug.prototype.has=wge;Ug.prototype.set=Tge;var rA=Q1(Vm,"Map");function Age(){this.size=0,this.__data__={hash:new k1,map:new(rA||Ug),string:new k1}}function Cge(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function DO(t,e){var n=t.__data__;return Cge(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Rge(t){var e=DO(this,t).delete(t);return this.size-=e?1:0,e}function kge(t){return DO(this,t).get(t)}function Mge(t){return DO(this,t).has(t)}function Oge(t,e){var n=DO(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Bg(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Bg.prototype.clear=Age;Bg.prototype.delete=Rge;Bg.prototype.get=kge;Bg.prototype.has=Mge;Bg.prototype.set=Oge;var Ige="Expected a function";function S5(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ige);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(S5.Cache||Bg),n}S5.Cache=Bg;var Nge=500;function Pge(t){var e=S5(t,function(r){return n.size===Nge&&n.clear(),r}),n=e.cache;return e}var Dge=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Lge=/\\(\\)?/g,Uge=Pge(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Dge,function(n,r,i,s){e.push(i?s.replace(Lge,"$1"):r||n)}),e});function iY(t){return t==null?"":Wq(t)}function LO(t,e){return Wi(t)?t:b5(t,e)?[t]:Uge(iY(t))}function HA(t){if(typeof t=="string"||CO(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function E5(t,e){e=LO(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[HA(e[n++])];return n&&n==r?t:void 0}function Bge(t,e,n){var r=t==null?void 0:E5(t,e);return r===void 0?n:r}function x5(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var f7=nd?nd.isConcatSpreadable:void 0;function Fge(t){return Wi(t)||IO(t)||!!(f7&&t&&t[f7])}function w5(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=Fge),i||(i=[]);++s<o;){var a=t[s];n(a)?x5(i,a):r||(i[i.length]=a)}return i}function of(t){var e=t==null?0:t.length;return e?w5(t):[]}var sY=tY(Object.getPrototypeOf,Object);function T5(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function jge(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:T5(t,e,n)}var zge="\\ud800-\\udfff",Vge="\\u0300-\\u036f",Hge="\\ufe20-\\ufe2f",$ge="\\u20d0-\\u20ff",Gge=Vge+Hge+$ge,Wge="\\ufe0e\\ufe0f",qge="\\u200d",Yge=RegExp("["+qge+zge+Gge+Wge+"]");function oY(t){return Yge.test(t)}function Kge(t){return t.split("")}var aY="\\ud800-\\udfff",Xge="\\u0300-\\u036f",Jge="\\ufe20-\\ufe2f",Zge="\\u20d0-\\u20ff",Qge=Xge+Jge+Zge,e_e="\\ufe0e\\ufe0f",t_e="["+aY+"]",fL="["+Qge+"]",dL="\\ud83c[\\udffb-\\udfff]",n_e="(?:"+fL+"|"+dL+")",cY="[^"+aY+"]",lY="(?:\\ud83c[\\udde6-\\uddff]){2}",uY="[\\ud800-\\udbff][\\udc00-\\udfff]",r_e="\\u200d",hY=n_e+"?",fY="["+e_e+"]?",i_e="(?:"+r_e+"(?:"+[cY,lY,uY].join("|")+")"+fY+hY+")*",s_e=fY+hY+i_e,o_e="(?:"+[cY+fL+"?",fL,lY,uY,t_e].join("|")+")",a_e=RegExp(dL+"(?="+dL+")|"+o_e+s_e,"g");function c_e(t){return t.match(a_e)||[]}function l_e(t){return oY(t)?c_e(t):Kge(t)}function u_e(t){return function(e){e=iY(e);var n=oY(e)?l_e(e):void 0,r=n?n[0]:e.charAt(0),i=n?jge(n,1).join(""):e.slice(1);return r[t]()+i}}var dY=u_e("toUpperCase");function h_e(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function f_e(){this.__data__=new Ug,this.size=0}function d_e(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function p_e(t){return this.__data__.get(t)}function m_e(t){return this.__data__.has(t)}var g_e=200;function __e(t,e){var n=this.__data__;if(n instanceof Ug){var r=n.__data__;if(!rA||r.length<g_e-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Bg(r)}return n.set(t,e),this.size=n.size,this}function Mm(t){var e=this.__data__=new Ug(t);this.size=e.size}Mm.prototype.clear=f_e;Mm.prototype.delete=d_e;Mm.prototype.get=p_e;Mm.prototype.has=m_e;Mm.prototype.set=__e;function v_e(t,e){return t&&g5(e,id(e),t)}var pY=typeof nf=="object"&&nf&&!nf.nodeType&&nf,d7=pY&&typeof rf=="object"&&rf&&!rf.nodeType&&rf,y_e=d7&&d7.exports===pY,p7=y_e?Vm.Buffer:void 0,m7=p7?p7.allocUnsafe:void 0;function b_e(t,e){var n=t.length,r=m7?m7(n):new t.constructor(n);return t.copy(r),r}function A5(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function mY(){return[]}var S_e=Object.prototype,E_e=S_e.propertyIsEnumerable,g7=Object.getOwnPropertySymbols,C5=g7?function(t){return t==null?[]:(t=Object(t),A5(g7(t),function(e){return E_e.call(t,e)}))}:mY;function x_e(t,e){return g5(t,C5(t),e)}var w_e=Object.getOwnPropertySymbols,T_e=w_e?function(t){for(var e=[];t;)x5(e,C5(t)),t=sY(t);return e}:mY;function gY(t,e,n){var r=e(t);return Wi(t)?r:x5(r,n(t))}function pL(t){return gY(t,id,C5)}function A_e(t){return gY(t,rY,T_e)}var mL=Q1(Vm,"DataView"),gL=Q1(Vm,"Promise"),fE=Q1(Vm,"Set"),_7="[object Map]",C_e="[object Object]",v7="[object Promise]",y7="[object Set]",b7="[object WeakMap]",S7="[object DataView]",R_e=Z1(mL),k_e=Z1(rA),M_e=Z1(gL),O_e=Z1(fE),I_e=Z1(hL),Hf=Rv;(mL&&Hf(new mL(new ArrayBuffer(1)))!=S7||rA&&Hf(new rA)!=_7||gL&&Hf(gL.resolve())!=v7||fE&&Hf(new fE)!=y7||hL&&Hf(new hL)!=b7)&&(Hf=function(t){var e=Rv(t),n=e==C_e?t.constructor:void 0,r=n?Z1(n):"";if(r)switch(r){case R_e:return S7;case k_e:return _7;case M_e:return v7;case O_e:return y7;case I_e:return b7}return e});var N_e=Object.prototype,P_e=N_e.hasOwnProperty;function D_e(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&P_e.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var cM=Vm.Uint8Array;function L_e(t){var e=new t.constructor(t.byteLength);return new cM(e).set(new cM(t)),e}function U_e(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var B_e=/\w*$/;function F_e(t){var e=new t.constructor(t.source,B_e.exec(t));return e.lastIndex=t.lastIndex,e}var E7=nd?nd.prototype:void 0,x7=E7?E7.valueOf:void 0;function j_e(t){return x7?Object(x7.call(t)):{}}function z_e(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var V_e="[object Boolean]",H_e="[object Date]",$_e="[object Map]",G_e="[object Number]",W_e="[object RegExp]",q_e="[object Set]",Y_e="[object String]",K_e="[object Symbol]",X_e="[object ArrayBuffer]",J_e="[object DataView]",Z_e="[object Float32Array]",Q_e="[object Float64Array]",eve="[object Int8Array]",tve="[object Int16Array]",nve="[object Int32Array]",rve="[object Uint8Array]",ive="[object Uint8ClampedArray]",sve="[object Uint16Array]",ove="[object Uint32Array]";function ave(t,e,n){var r=t.constructor;switch(e){case X_e:return L_e(t);case V_e:case H_e:return new r(+t);case J_e:return U_e(t);case Z_e:case Q_e:case eve:case tve:case nve:case rve:case ive:case sve:case ove:return z_e(t);case $_e:return new r;case G_e:case Y_e:return new r(t);case W_e:return F_e(t);case q_e:return new r;case K_e:return j_e(t)}}function cve(t){return typeof t.constructor=="function"&&!VA(t)?Xme(sY(t)):{}}var lve="[object Map]";function uve(t){return sp(t)&&Hf(t)==lve}var w7=mv&&mv.isMap,hve=w7?NO(w7):uve,fve="[object Set]";function dve(t){return sp(t)&&Hf(t)==fve}var T7=mv&&mv.isSet,pve=T7?NO(T7):dve,_Y="[object Arguments]",mve="[object Array]",gve="[object Boolean]",_ve="[object Date]",vve="[object Error]",vY="[object Function]",yve="[object GeneratorFunction]",bve="[object Map]",Sve="[object Number]",yY="[object Object]",Eve="[object RegExp]",xve="[object Set]",wve="[object String]",Tve="[object Symbol]",Ave="[object WeakMap]",Cve="[object ArrayBuffer]",Rve="[object DataView]",kve="[object Float32Array]",Mve="[object Float64Array]",Ove="[object Int8Array]",Ive="[object Int16Array]",Nve="[object Int32Array]",Pve="[object Uint8Array]",Dve="[object Uint8ClampedArray]",Lve="[object Uint16Array]",Uve="[object Uint32Array]",eo={};eo[_Y]=eo[mve]=eo[Cve]=eo[Rve]=eo[gve]=eo[_ve]=eo[kve]=eo[Mve]=eo[Ove]=eo[Ive]=eo[Nve]=eo[bve]=eo[Sve]=eo[yY]=eo[Eve]=eo[xve]=eo[wve]=eo[Tve]=eo[Pve]=eo[Dve]=eo[Lve]=eo[Uve]=!0;eo[vve]=eo[vY]=eo[Ave]=!1;function dk(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!rd(t))return t;var a=Wi(t);if(a)return o=D_e(t),Zme(t,o);var c=Hf(t),l=c==vY||c==yve;if(tA(t))return b_e(t);if(c==yY||c==_Y||l&&!i)return o=l?{}:cve(t),x_e(t,v_e(o,t));if(!eo[c])return i?t:{};o=ave(t,c),s||(s=new Mm);var u=s.get(t);if(u)return u;s.set(t,o),pve(t)?t.forEach(function(d){o.add(dk(d,e,n,d,t,s))}):hve(t)&&t.forEach(function(d,p){o.set(p,dk(d,e,n,p,t,s))});var h=pL,f=a?void 0:h(t);return qq(f||t,function(d,p){f&&(p=d,d=t[p]),OO(o,p,dk(d,e,n,p,t,s))}),o}var Bve=4;function sl(t){return dk(t,Bve)}function $A(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var Fve="__lodash_hash_undefined__";function jve(t){return this.__data__.set(t,Fve),this}function zve(t){return this.__data__.has(t)}function AE(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Bg;++e<n;)this.add(t[e])}AE.prototype.add=AE.prototype.push=jve;AE.prototype.has=zve;function bY(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function R5(t,e){return t.has(e)}var Vve=1,Hve=2;function SY(t,e,n,r,i,s){var o=n&Vve,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var h=-1,f=!0,d=n&Hve?new AE:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var p=t[h],m=e[h];if(r)var g=o?r(m,p,h,e,t,s):r(p,m,h,t,e,s);if(g!==void 0){if(g)continue;f=!1;break}if(d){if(!bY(e,function(_,y){if(!R5(d,y)&&(p===_||i(p,_,n,r,s)))return d.push(y)})){f=!1;break}}else if(!(p===m||i(p,m,n,r,s))){f=!1;break}}return s.delete(t),s.delete(e),f}function $ve(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function k5(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var Gve=1,Wve=2,qve="[object Boolean]",Yve="[object Date]",Kve="[object Error]",Xve="[object Map]",Jve="[object Number]",Zve="[object RegExp]",Qve="[object Set]",eye="[object String]",tye="[object Symbol]",nye="[object ArrayBuffer]",rye="[object DataView]",A7=nd?nd.prototype:void 0,Y3=A7?A7.valueOf:void 0;function iye(t,e,n,r,i,s,o){switch(n){case rye:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case nye:return!(t.byteLength!=e.byteLength||!s(new cM(t),new cM(e)));case qve:case Yve:case Jve:return zA(+t,+e);case Kve:return t.name==e.name&&t.message==e.message;case Zve:case eye:return t==e+"";case Xve:var a=$ve;case Qve:var c=r&Gve;if(a||(a=k5),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=Wve,o.set(t,e);var u=SY(a(t),a(e),r,i,s,o);return o.delete(t),u;case tye:if(Y3)return Y3.call(t)==Y3.call(e)}return!1}var sye=1,oye=Object.prototype,aye=oye.hasOwnProperty;function cye(t,e,n,r,i,s){var o=n&sye,a=pL(t),c=a.length,l=pL(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in e:aye.call(e,f)))return!1}var d=s.get(t),p=s.get(e);if(d&&p)return d==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var g=o;++h<c;){f=a[h];var _=t[f],y=e[f];if(r)var v=o?r(y,_,f,e,t,s):r(_,y,f,t,e,s);if(!(v===void 0?_===y||i(_,y,n,r,s):v)){m=!1;break}g||(g=f=="constructor")}if(m&&!g){var E=t.constructor,x=e.constructor;E!=x&&"constructor"in t&&"constructor"in e&&!(typeof E=="function"&&E instanceof E&&typeof x=="function"&&x instanceof x)&&(m=!1)}return s.delete(t),s.delete(e),m}var lye=1,C7="[object Arguments]",R7="[object Array]",uR="[object Object]",uye=Object.prototype,k7=uye.hasOwnProperty;function hye(t,e,n,r,i,s){var o=Wi(t),a=Wi(e),c=o?R7:Hf(t),l=a?R7:Hf(e);c=c==C7?uR:c,l=l==C7?uR:l;var u=c==uR,h=l==uR,f=c==l;if(f&&tA(t)){if(!tA(e))return!1;o=!0,u=!1}if(f&&!u)return s||(s=new Mm),o||y5(t)?SY(t,e,n,r,i,s):iye(t,e,c,n,r,i,s);if(!(n&lye)){var d=u&&k7.call(t,"__wrapped__"),p=h&&k7.call(e,"__wrapped__");if(d||p){var m=d?t.value():t,g=p?e.value():e;return s||(s=new Mm),i(m,g,n,r,s)}}return f?(s||(s=new Mm),cye(t,e,n,r,i,s)):!1}function M5(t,e,n,r,i){return t===e?!0:t==null||e==null||!sp(t)&&!sp(e)?t!==t&&e!==e:hye(t,e,n,r,M5,i)}var fye=1,dye=2;function pye(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new Mm,h;if(!(h===void 0?M5(l,c,fye|dye,r,u):h))return!1}}return!0}function EY(t){return t===t&&!rd(t)}function mye(t){for(var e=id(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,EY(i)]}return e}function xY(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function gye(t){var e=mye(t);return e.length==1&&e[0][2]?xY(e[0][0],e[0][1]):function(n){return n===t||pye(n,t,e)}}function _ye(t,e){return t!=null&&e in Object(t)}function wY(t,e,n){e=LO(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=HA(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&v5(i)&&MO(o,i)&&(Wi(t)||IO(t)))}function vye(t,e){return t!=null&&wY(t,e,_ye)}var yye=1,bye=2;function Sye(t,e){return b5(t)&&EY(e)?xY(HA(t),e):function(n){var r=Bge(n,t);return r===void 0&&r===e?vye(n,t):M5(e,r,yye|bye)}}function Eye(t){return function(e){return e?.[t]}}function xye(t){return function(e){return E5(e,t)}}function wye(t){return b5(t)?Eye(HA(t)):xye(t)}function $m(t){return typeof t=="function"?t:t==null?TE:typeof t=="object"?Wi(t)?Sye(t[0],t[1]):gye(t):wye(t)}function Tye(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Aye(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var Cye=Aye();function Rye(t,e){return t&&Cye(t,e,id)}function kye(t,e){return function(n,r){if(n==null)return n;if(!Hm(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var eb=kye(Rye);function Mye(t,e,n,r){return eb(t,function(i,s,o){e(r,i,n(i),o)}),r}function Oye(t,e){return function(n,r){var i=Wi(n)?Tye:Mye,s=e?e():{};return i(n,t,$m(r),s)}}var TY=Object.prototype,Iye=TY.hasOwnProperty,O5=_5(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&Xq(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=rY(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||zA(u,TY[l])&&!Iye.call(t,l))&&(t[l]=s[l])}return t});function M7(t){return sp(t)&&Hm(t)}var Nye=200;function Pye(t,e,n,r){var i=-1,s=Kq,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=Nye&&(s=R5,o=!1,e=new AE(e));e:for(;++i<a;){var u=t[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var f=l;f--;)if(e[f]===h)continue e;c.push(u)}else s(e,h,r)||c.push(u)}return c}var UO=_5(function(t,e){return M7(t)?Pye(t,w5(e,1,M7,!0)):[]});function M1(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Qc(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:kO(e),T5(t,e<0?0:e,r)):[]}function iA(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:kO(e),e=r-e,T5(t,0,e<0?0:e)):[]}function Dye(t){return typeof t=="function"?t:TE}function Dr(t,e){var n=Wi(t)?qq:eb;return n(t,Dye(e))}function Lye(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Uye(t,e){var n=!0;return eb(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function np(t,e,n){var r=Wi(t)?Lye:Uye;return r(t,$m(e))}function AY(t,e){var n=[];return eb(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function cd(t,e){var n=Wi(t)?A5:AY;return n(t,$m(e))}function Bye(t){return function(e,n,r){var i=Object(e);if(!Hm(e)){var s=$m(n);e=id(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var Fye=Math.max;function jye(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:kO(n);return i<0&&(i=Fye(r+i,0)),Yq(t,$m(e),i)}var CE=Bye(jye);function op(t){return t&&t.length?t[0]:void 0}function zye(t,e){var n=-1,r=Hm(t)?Array(t.length):[];return eb(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function or(t,e){var n=Wi(t)?RO:zye;return n(t,$m(e))}function Zf(t,e){return w5(or(t,e))}var Vye=Object.prototype,Hye=Vye.hasOwnProperty,CY=Oye(function(t,e,n){Hye.call(t,n)?t[n].push(e):m5(t,n,[e])}),$ye=Object.prototype,Gye=$ye.hasOwnProperty;function Wye(t,e){return t!=null&&Gye.call(t,e)}function Mr(t,e){return t!=null&&wY(t,e,Wye)}var qye="[object String]";function _h(t){return typeof t=="string"||!Wi(t)&&sp(t)&&Rv(t)==qye}function Yye(t,e){return RO(e,function(n){return t[n]})}function $a(t){return t==null?[]:Yye(t,id(t))}var Kye=Math.max;function vu(t,e,n,r){t=Hm(t)?t:$a(t),n=n?kO(n):0;var i=t.length;return n<0&&(n=Kye(i+n,0)),_h(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&p5(t,e,n)>-1}function O7(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return p5(t,e,i)}var Xye="[object Map]",Jye="[object Set]",Zye=Object.prototype,Qye=Zye.hasOwnProperty;function so(t){if(t==null)return!0;if(Hm(t)&&(Wi(t)||typeof t=="string"||typeof t.splice=="function"||tA(t)||y5(t)||IO(t)))return!t.length;var e=Hf(t);if(e==Xye||e==Jye)return!t.size;if(VA(t))return!nY(t).length;for(var n in t)if(Qye.call(t,n))return!1;return!0}var e1e="[object RegExp]";function t1e(t){return sp(t)&&Rv(t)==e1e}var I7=mv&&mv.isRegExp,Rg=I7?NO(I7):t1e;function kg(t){return t===void 0}var n1e="Expected a function";function r1e(t){if(typeof t!="function")throw new TypeError(n1e);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function i1e(t,e,n,r){if(!rd(t))return t;e=LO(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=HA(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=rd(u)?u:MO(e[i+1])?[]:{})}OO(a,c,l),a=a[c]}return t}function s1e(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=E5(t,o);n(a,o)&&i1e(s,LO(o,t),a)}return s}function dp(t,e){if(t==null)return{};var n=RO(A_e(t),function(r){return[r]});return e=$m(e),s1e(t,n,function(r,i){return e(r,i[0])})}function o1e(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function vh(t,e,n){var r=Wi(t)?h_e:o1e,i=arguments.length<3;return r(t,$m(e),n,i,eb)}function BO(t,e){var n=Wi(t)?A5:AY;return n(t,r1e($m(e)))}function a1e(t,e){var n;return eb(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function I5(t,e,n){var r=Wi(t)?bY:a1e;return r(t,$m(e))}var c1e=1/0,l1e=fE&&1/k5(new fE([,-0]))[1]==c1e?function(t){return new fE(t)}:ic,u1e=200;function h1e(t,e,n){var r=-1,i=Kq,s=t.length,o=!0,a=[],c=a;if(s>=u1e){var l=l1e(t);if(l)return k5(l);o=!1,i=R5,c=new AE}else c=a;e:for(;++r<s;){var u=t[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue e;a.push(u)}else i(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function FO(t){return t&&t.length?h1e(t):[]}function _L(t){console&&console.error&&console.error(`Error: ${t}`)}function RY(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function kY(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function MY(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function f1e(t){return d1e(t)?t.LABEL:t.name}function d1e(t){return _h(t.LABEL)&&t.LABEL!==""}class Gm{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Dr(this.definition,n=>{n.accept(e)})}}class yh extends Gm{constructor(e){super([]),this.idx=1,gh(this,dp(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class nx extends Gm{constructor(e){super(e.definition),this.orgText="",gh(this,dp(e,n=>n!==void 0))}}class bh extends Gm{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,gh(this,dp(e,n=>n!==void 0))}}class fh extends Gm{constructor(e){super(e.definition),this.idx=1,gh(this,dp(e,n=>n!==void 0))}}class Wm extends Gm{constructor(e){super(e.definition),this.idx=1,gh(this,dp(e,n=>n!==void 0))}}class qm extends Gm{constructor(e){super(e.definition),this.idx=1,gh(this,dp(e,n=>n!==void 0))}}class cc extends Gm{constructor(e){super(e.definition),this.idx=1,gh(this,dp(e,n=>n!==void 0))}}class pp extends Gm{constructor(e){super(e.definition),this.idx=1,gh(this,dp(e,n=>n!==void 0))}}class mp extends Gm{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,gh(this,dp(e,n=>n!==void 0))}}class Ko{constructor(e){this.idx=1,gh(this,dp(e,n=>n!==void 0))}accept(e){e.visit(this)}}function p1e(t){return or(t,pk)}function pk(t){function e(n){return or(n,pk)}if(t instanceof yh){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return _h(t.label)&&(n.label=t.label),n}else{if(t instanceof bh)return{type:"Alternative",definition:e(t.definition)};if(t instanceof fh)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Wm)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof qm)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:pk(new Ko({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof pp)return{type:"RepetitionWithSeparator",idx:t.idx,separator:pk(new Ko({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof cc)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof mp)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Ko){const n={type:"Terminal",name:t.terminalType.name,label:f1e(t.terminalType),idx:t.idx};_h(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Rg(r)?r.source:r),n}else{if(t instanceof nx)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class tb{visit(e){const n=e;switch(n.constructor){case yh:return this.visitNonTerminal(n);case bh:return this.visitAlternative(n);case fh:return this.visitOption(n);case Wm:return this.visitRepetitionMandatory(n);case qm:return this.visitRepetitionMandatoryWithSeparator(n);case pp:return this.visitRepetitionWithSeparator(n);case cc:return this.visitRepetition(n);case mp:return this.visitAlternation(n);case Ko:return this.visitTerminal(n);case nx:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function m1e(t){return t instanceof bh||t instanceof fh||t instanceof cc||t instanceof Wm||t instanceof qm||t instanceof pp||t instanceof Ko||t instanceof nx}function lM(t,e=[]){return t instanceof fh||t instanceof cc||t instanceof pp?!0:t instanceof mp?I5(t.definition,r=>lM(r,e)):t instanceof yh&&vu(e,t)?!1:t instanceof Gm?(t instanceof yh&&e.push(t),np(t.definition,r=>lM(r,e))):!1}function g1e(t){return t instanceof mp}function mm(t){if(t instanceof yh)return"SUBRULE";if(t instanceof fh)return"OPTION";if(t instanceof mp)return"OR";if(t instanceof Wm)return"AT_LEAST_ONE";if(t instanceof qm)return"AT_LEAST_ONE_SEP";if(t instanceof pp)return"MANY_SEP";if(t instanceof cc)return"MANY";if(t instanceof Ko)return"CONSUME";throw Error("non exhaustive match")}class jO{walk(e,n=[]){Dr(e.definition,(r,i)=>{const s=Qc(e.definition,i+1);if(r instanceof yh)this.walkProdRef(r,s,n);else if(r instanceof Ko)this.walkTerminal(r,s,n);else if(r instanceof bh)this.walkFlat(r,s,n);else if(r instanceof fh)this.walkOption(r,s,n);else if(r instanceof Wm)this.walkAtLeastOne(r,s,n);else if(r instanceof qm)this.walkAtLeastOneSep(r,s,n);else if(r instanceof pp)this.walkManySep(r,s,n);else if(r instanceof cc)this.walkMany(r,s,n);else if(r instanceof mp)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new fh({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=N7(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new fh({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=N7(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Dr(e.definition,s=>{const o=new bh({definition:[s]});this.walk(o,i)})}}function N7(t,e,n){return[new fh({definition:[new Ko({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function GA(t){if(t instanceof yh)return GA(t.referencedRule);if(t instanceof Ko)return y1e(t);if(m1e(t))return _1e(t);if(g1e(t))return v1e(t);throw Error("non exhaustive match")}function _1e(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=lM(s),e=e.concat(GA(s)),r=r+1,i=n.length>r;return FO(e)}function v1e(t){const e=or(t.definition,n=>GA(n));return FO(of(e))}function y1e(t){return[t.terminalType]}const OY="_~IN~_";class b1e extends jO{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=E1e(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new bh({definition:s}),a=GA(o);this.follows[i]=a}}function S1e(t){const e={};return Dr(t,n=>{const r=new b1e(n).startWalking();gh(e,r)}),e}function E1e(t,e){return t.name+e+OY}function jr(t){return t.charCodeAt(0)}function K3(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function Zx(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function SS(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function x1e(){throw Error("Internal Error - Should never get here!")}function P7(t){return t.type==="Character"}const uM=[];for(let t=jr("0");t<=jr("9");t++)uM.push(t);const hM=[jr("_")].concat(uM);for(let t=jr("a");t<=jr("z");t++)hM.push(t);for(let t=jr("A");t<=jr("Z");t++)hM.push(t);const D7=[jr(" "),jr("\f"),jr(`
`),jr("\r"),jr("	"),jr("\v"),jr("	"),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr("\u2028"),jr("\u2029"),jr(""),jr(""),jr(""),jr("\uFEFF")],w1e=/[0-9a-fA-F]/,hR=/[0-9]/,T1e=/[1-9]/;class A1e{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Zx(r,"global");break;case"i":Zx(r,"ignoreCase");break;case"m":Zx(r,"multiLine");break;case"u":Zx(r,"unicode");break;case"y":Zx(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break;case"<":{switch(this.popChar()){case"=":n="Lookbehind";break;case"!":n="NegativeLookbehind"}break}}SS(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return x1e()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;SS(n);break}if(!(e===!0&&n===void 0)&&SS(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),SS(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[jr(`
`),jr("\r"),jr("\u2028"),jr("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=uM;break;case"D":e=uM,n=!0;break;case"s":e=D7;break;case"S":e=D7,n=!0;break;case"w":e=hM;break;case"W":e=hM,n=!0;break}if(SS(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=jr("\f");break;case"n":e=jr(`
`);break;case"r":e=jr("\r");break;case"t":e=jr("	");break;case"v":e=jr("\v");break}if(SS(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:jr("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:jr(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:jr(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,P7(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,P7(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else K3(r.value,e),e.push(jr("-")),K3(i.value,e)}else K3(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:jr("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;this.consumeChar("("),this.peekChar(0)==="?"?(this.consumeChar("?"),this.consumeChar(":"),e=!1):this.groupIdx++;const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(T1e.test(e)===!1)throw Error("Expecting a positive integer");for(;hR.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(hR.test(e)===!1)throw Error("Expecting an integer");for(;hR.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:jr(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return hR.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!"||this.peekChar(2)==="<"&&(this.peekChar(3)==="="||this.peekChar(3)==="!"));default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(w1e.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class N5{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Lookbehind":this.visitLookbehind(e);break;case"NegativeLookbehind":this.visitNegativeLookbehind(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitLookbehind(e){}visitNegativeLookbehind(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let mk={};const C1e=new A1e;function zO(t){const e=t.toString();if(mk.hasOwnProperty(e))return mk[e];{const n=C1e.pattern(e);return mk[e]=n,n}}function R1e(){mk={}}const IY="Complement Sets are not supported for first char optimization",fM=`Unable to use "first char" lexer optimizations:
`;function k1e(t,e=!1){try{const n=zO(t);return vL(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===IY)e&&RY(`${fM}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),_L(`${fM}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function vL(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)vL(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"Lookbehind":case"NegativeLookbehind":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":fR(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(IY);Dr(o.value,c=>{if(typeof c=="number")fR(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)fR(u,e,n);else{for(let u=l.from;u<=l.to&&u<xT;u++)fR(u,e,n);if(l.to>=xT){const u=l.from>=xT?l.from:xT,h=l.to,f=gv(u),d=gv(h);for(let p=f;p<=d;p++)e[p]=p}}}});break;case"Group":vL(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&yL(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return $a(e)}function fR(t,e,n){const r=gv(t);e[r]=r,n===!0&&M1e(t,e)}function M1e(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=gv(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=gv(i.charCodeAt(0));e[s]=s}}}function L7(t,e){return CE(t.value,n=>{if(typeof n=="number")return vu(e,n);{const r=n;return CE(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function yL(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Wi(t.value)?np(t.value,yL):yL(t.value):!1}class O1e extends N5{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return;case"Lookbehind":this.visitLookbehind(e);return;case"NegativeLookbehind":this.visitNegativeLookbehind(e);return}super.visitChildren(e)}}visitCharacter(e){vu(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?L7(e,this.targetCharCodes)===void 0&&(this.found=!0):L7(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function P5(t,e){if(e instanceof RegExp){const n=zO(e),r=new O1e(t);return r.visit(n),r.found}else return CE(e,n=>vu(t,n.charCodeAt(0)))!==void 0}const O1="PATTERN",ET="defaultMode",dR="modes";let NY=typeof new RegExp("(?:)").sticky=="boolean";function I1e(t,e){e=O5(e,{useSticky:NY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(y,v)=>v()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{nbe()});let r;n("Reject Lexer.NA",()=>{r=BO(t,y=>y[O1]===Lc.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=or(r,y=>{const v=y[O1];if(Rg(v)){const E=v.source;return E.length===1&&E!=="^"&&E!=="$"&&E!=="."&&!v.ignoreCase?E:E.length===2&&E[0]==="\\"&&!vu(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],E[1])?E[1]:e.useSticky?B7(v):U7(v)}else{if(Lg(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const E=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),x=new RegExp(E);return e.useSticky?B7(x):U7(x)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=or(r,y=>y.tokenTypeIdx),a=or(r,y=>{const v=y.GROUP;if(v!==Lc.SKIPPED){if(_h(v))return v;if(kg(v))return!1;throw Error("non exhaustive match")}}),c=or(r,y=>{const v=y.LONGER_ALT;if(v)return Wi(v)?or(v,x=>O7(r,x)):[O7(r,v)]}),l=or(r,y=>y.PUSH_MODE),u=or(r,y=>Mr(y,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const y=LY(e.lineTerminatorCharacters);h=or(r,v=>!1),e.positionTracking!=="onlyOffset"&&(h=or(r,v=>Mr(v,"LINE_BREAKS")?!!v.LINE_BREAKS:DY(v,y)===!1&&P5(y,v.PATTERN)))});let f,d,p,m;n("Misc Mapping #2",()=>{f=or(r,PY),d=or(s,Q1e),p=vh(r,(y,v)=>{const E=v.GROUP;return _h(E)&&E!==Lc.SKIPPED&&(y[E]=[]),y},{}),m=or(s,(y,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:f[v],short:d[v],group:a[v],push:l[v],pop:u[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let g=!0,_=[];return e.safeMode||n("First Char Optimization",()=>{_=vh(r,(y,v,E)=>{if(typeof v.PATTERN=="string"){const x=v.PATTERN.charCodeAt(0),A=gv(x);X3(y,A,m[E])}else if(Wi(v.START_CHARS_HINT)){let x;Dr(v.START_CHARS_HINT,A=>{const T=typeof A=="string"?A.charCodeAt(0):A,k=gv(T);x!==k&&(x=k,X3(y,k,m[E]))})}else if(Rg(v.PATTERN))if(v.PATTERN.unicode)g=!1,e.ensureOptimizations&&_L(`${fM}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const x=k1e(v.PATTERN,e.ensureOptimizations);so(x)&&(g=!1),Dr(x,A=>{X3(y,A,m[E])})}else e.ensureOptimizations&&_L(`${fM}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return y},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:_,hasCustom:i,canBeOptimized:g}}function N1e(t,e){let n=[];const r=D1e(t);n=n.concat(r.errors);const i=L1e(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(P1e(s)),n=n.concat($1e(s)),n=n.concat(G1e(s,e)),n=n.concat(W1e(s)),n}function P1e(t){let e=[];const n=cd(t,r=>Rg(r[O1]));return e=e.concat(B1e(n)),e=e.concat(z1e(n)),e=e.concat(V1e(n)),e=e.concat(H1e(n)),e=e.concat(F1e(n)),e}function D1e(t){const e=cd(t,i=>!Mr(i,O1)),n=or(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:pa.MISSING_PATTERN,tokenTypes:[i]})),r=UO(t,e);return{errors:n,valid:r}}function L1e(t){const e=cd(t,i=>{const s=i[O1];return!Rg(s)&&!Lg(s)&&!Mr(s,"exec")&&!_h(s)}),n=or(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:pa.INVALID_PATTERN,tokenTypes:[i]})),r=UO(t,e);return{errors:n,valid:r}}const U1e=/[^\\][$]/;function B1e(t){class e extends N5{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=cd(t,i=>{const s=i.PATTERN;try{const o=zO(s),a=new e;return a.visit(o),a.found}catch{return U1e.test(s.source)}});return or(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:pa.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function F1e(t){const e=cd(t,r=>r.PATTERN.test(""));return or(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:pa.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const j1e=/[^\\[][\^]|^\^/;function z1e(t){class e extends N5{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=cd(t,i=>{const s=i.PATTERN;try{const o=zO(s),a=new e;return a.visit(o),a.found}catch{return j1e.test(s.source)}});return or(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:pa.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function V1e(t){const e=cd(t,r=>{const i=r[O1];return i instanceof RegExp&&(i.multiline||i.global)});return or(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:pa.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function H1e(t){const e=[];let n=or(t,s=>vh(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!vu(e,a)&&a.PATTERN!==Lc.NA&&(e.push(a),o.push(a)),o),[]));n=$A(n);const r=cd(n,s=>s.length>1);return or(r,s=>{const o=or(s,c=>c.name);return{message:`The same RegExp pattern ->${op(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:pa.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function $1e(t){const e=cd(t,r=>{if(!Mr(r,"GROUP"))return!1;const i=r.GROUP;return i!==Lc.SKIPPED&&i!==Lc.NA&&!_h(i)});return or(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:pa.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function G1e(t,e){const n=cd(t,i=>i.PUSH_MODE!==void 0&&!vu(e,i.PUSH_MODE));return or(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:pa.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function W1e(t){const e=[],n=vh(t,(r,i,s)=>{const o=i.PATTERN;return o===Lc.NA||(_h(o)?r.push({str:o,idx:s,tokenType:i}):Rg(o)&&Y1e(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Dr(t,(r,i)=>{Dr(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&q1e(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:pa.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function q1e(t,e){if(Rg(e)){if(K1e(e))return!1;const n=e.exec(t);return n!==null&&n.index===0}else{if(Lg(e))return e(t,0,[],{});if(Mr(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function Y1e(t){return CE([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function K1e(t){return/(\(\?=)|(\(\?!)|(\(\?<=)|(\(\?<!)/.test(t.source)}function U7(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function B7(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function X1e(t,e,n){const r=[];return Mr(t,ET)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ET+`> property in its definition
`,type:pa.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Mr(t,dR)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+dR+`> property in its definition
`,type:pa.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Mr(t,dR)&&Mr(t,ET)&&!Mr(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ET}: <${t.defaultMode}>which does not exist
`,type:pa.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Mr(t,dR)&&Dr(t.modes,(i,s)=>{Dr(i,(o,a)=>{if(kg(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:pa.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Mr(o,"LONGER_ALT")){const c=Wi(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Dr(c,l=>{!kg(l)&&!vu(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:pa.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function J1e(t,e,n){const r=[];let i=!1;const s=$A(of($a(t.modes))),o=BO(s,c=>c[O1]===Lc.NA),a=LY(n);return e&&Dr(o,c=>{const l=DY(c,a);if(l!==!1){const h={message:tbe(c,l),type:l.issue,tokenType:c};r.push(h)}else Mr(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):P5(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:pa.NO_LINE_BREAKS_FLAGS}),r}function Z1e(t){const e={},n=id(t);return Dr(n,r=>{const i=t[r];if(Wi(i))e[r]=[];else throw Error("non exhaustive match")}),e}function PY(t){const e=t.PATTERN;if(Rg(e))return!1;if(Lg(e))return!0;if(Mr(e,"exec"))return!0;if(_h(e))return!1;throw Error("non exhaustive match")}function Q1e(t){return _h(t)&&t.length===1?t.charCodeAt(0):!1}const ebe={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function DY(t,e){if(Mr(t,"LINE_BREAKS"))return!1;if(Rg(t.PATTERN)){try{P5(e,t.PATTERN)}catch(n){return{issue:pa.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(_h(t.PATTERN))return!1;if(PY(t))return{issue:pa.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function tbe(t,e){if(e.issue===pa.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===pa.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function LY(t){return or(t,n=>_h(n)?n.charCodeAt(0):n)}function X3(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const xT=256;let gk=[];function gv(t){return t<xT?t:gk[t]}function nbe(){if(so(gk)){gk=new Array(65536);for(let t=0;t<65536;t++)gk[t]=t>255?255+~~(t/255):t}}function WA(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function dM(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let F7=1;const UY={};function qA(t){const e=rbe(t);ibe(e),obe(e),sbe(e),Dr(e,n=>{n.isParent=n.categoryMatches.length>0})}function rbe(t){let e=sl(t),n=t,r=!0;for(;r;){n=$A(of(or(n,s=>s.CATEGORIES)));const i=UO(n,e);e=e.concat(i),so(i)?r=!1:n=i}return e}function ibe(t){Dr(t,e=>{FY(e)||(UY[F7]=e,e.tokenTypeIdx=F7++),j7(e)&&!Wi(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),j7(e)||(e.CATEGORIES=[]),abe(e)||(e.categoryMatches=[]),cbe(e)||(e.categoryMatchesMap={})})}function sbe(t){Dr(t,e=>{e.categoryMatches=[],Dr(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(UY[r].tokenTypeIdx)})})}function obe(t){Dr(t,e=>{BY([],e)})}function BY(t,e){Dr(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Dr(e.CATEGORIES,n=>{const r=t.concat(e);vu(r,n)||BY(r,n)})}function FY(t){return Mr(t,"tokenTypeIdx")}function j7(t){return Mr(t,"CATEGORIES")}function abe(t){return Mr(t,"categoryMatches")}function cbe(t){return Mr(t,"categoryMatchesMap")}function lbe(t){return Mr(t,"tokenTypeIdx")}const ube={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i,s){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var pa;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(pa||(pa={}));const wT={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:ube,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(wT);let Lc=class{constructor(e,n=wT){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=kY(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=gh({},wT,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===wT.lineTerminatorsPattern)this.config.lineTerminatorsPattern=ebe;else if(this.config.lineTerminatorCharacters===wT.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Wi(e)?i={modes:{defaultMode:sl(e)},defaultMode:ET}:(s=!1,i=sl(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(X1e(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(J1e(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Dr(i.modes,(a,c)=>{i.modes[c]=BO(a,l=>kg(l))});const o=id(i.modes);if(Dr(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(N1e(a,o))}),so(this.lexerDefinitionErrors)){qA(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=I1e(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=gh({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!so(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=or(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Dr(this.lexerDefinitionWarning,a=>{RY(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(NY?(this.chopInput=TE,this.match=this.matchWithTest):(this.updateLastIndex=ic,this.match=this.matchWithExec),s&&(this.handleModes=ic),this.trackStartLines===!1&&(this.computeNewColumn=TE),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=ic),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=vh(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!so(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{R1e()}),this.TRACE_INIT("toFastProperties",()=>{MY(this)})})}tokenize(e,n=this.defaultMode){if(!so(this.lexerDefinitionErrors)){const i=or(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,h,f,d,p,m,g,_;const y=e,v=y.length;let E=0,x=0;const A=this.hasCustom?0:Math.floor(e.length/10),T=new Array(A),k=[];let L=this.trackStartLines?1:void 0,I=this.trackStartLines?1:void 0;const F=Z1e(this.emptyGroups),M=this.trackStartLines,D=this.config.lineTerminatorsPattern;let O=0,z=[],q=[];const G=[],K=[];Object.freeze(K);let te;function re(){return z}function H(ge){const Te=gv(ge),be=q[Te];return be===void 0?K:be}const Y=ge=>{if(G.length===1&&ge.tokenType.PUSH_MODE===void 0){const Te=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(ge);k.push({offset:ge.startOffset,line:ge.startLine,column:ge.startColumn,length:ge.image.length,message:Te})}else{G.pop();const Te=M1(G);z=this.patternIdxToConfig[Te],q=this.charCodeToPatternIdxToConfig[Te],O=z.length;const be=this.canModeBeOptimized[Te]&&this.config.safeMode===!1;q&&be?te=H:te=re}};function Z(ge){G.push(ge),q=this.charCodeToPatternIdxToConfig[ge],z=this.patternIdxToConfig[ge],O=z.length,O=z.length;const Te=this.canModeBeOptimized[ge]&&this.config.safeMode===!1;q&&Te?te=H:te=re}Z.call(this,n);let Q;const ie=this.config.recoveryEnabled;for(;E<v;){c=null;const ge=y.charCodeAt(E),Te=te(ge),be=Te.length;for(r=0;r<be;r++){Q=Te[r];const Pe=Q.pattern;l=null;const Ge=Q.short;if(Ge!==!1?ge===Ge&&(c=Pe):Q.isCustom===!0?(_=Pe.exec(y,E,T,F),_!==null?(c=_[0],_.payload!==void 0&&(l=_.payload)):c=null):(this.updateLastIndex(Pe,E),c=this.match(Pe,e,E)),c!==null){if(a=Q.longerAlt,a!==void 0){const Ze=a.length;for(s=0;s<Ze;s++){const lt=z[a[s]],pt=lt.pattern;if(u=null,lt.isCustom===!0?(_=pt.exec(y,E,T,F),_!==null?(o=_[0],_.payload!==void 0&&(u=_.payload)):o=null):(this.updateLastIndex(pt,E),o=this.match(pt,e,E)),o&&o.length>c.length){c=o,l=u,Q=lt;break}}}break}}if(c!==null){if(h=c.length,f=Q.group,f!==void 0&&(d=Q.tokenTypeIdx,p=this.createTokenInstance(c,E,d,Q.tokenType,L,I,h),this.handlePayload(p,l),f===!1?x=this.addToken(T,x,p):F[f].push(p)),e=this.chopInput(e,h),E=E+h,I=this.computeNewColumn(I,h),M===!0&&Q.canLineTerminator===!0){let Pe=0,Ge,Ze;D.lastIndex=0;do Ge=D.test(c),Ge===!0&&(Ze=D.lastIndex-1,Pe++);while(Ge===!0);Pe!==0&&(L=L+Pe,I=h-Ze,this.updateTokenEndLineColumnLocation(p,f,Ze,Pe,L,I,h))}this.handleModes(Q,Y,Z,p)}else{const Pe=E,Ge=L,Ze=I;let lt=ie===!1;for(;lt===!1&&E<v;)for(e=this.chopInput(e,1),E++,i=0;i<O;i++){const pt=z[i],ne=pt.pattern,Le=pt.short;if(Le!==!1?y.charCodeAt(E)===Le&&(lt=!0):pt.isCustom===!0?lt=ne.exec(y,E,T,F)!==null:(this.updateLastIndex(ne,E),lt=ne.exec(e)!==null),lt===!0)break}if(m=E-Pe,I=this.computeNewColumn(I,m),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(y,Pe,m,Ge,Ze,M1(G)),k.push({offset:Pe,line:Ge,column:Ze,length:m,message:g}),ie===!1)break}}return this.hasCustom||(T.length=x),{tokens:T,groups:F,errors:k}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};Lc.SKIPPED="This marks a skipped Token pattern, this means each token identified by it will be consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";Lc.NA=/NOT_APPLICABLE/;function LT(t){return jY(t)?t.LABEL:t.name}function jY(t){return _h(t.LABEL)&&t.LABEL!==""}const hbe="parent",z7="categories",V7="label",H7="group",$7="push_mode",G7="pop_mode",W7="longer_alt",q7="line_breaks",Y7="start_chars_hint";function yu(t){return fbe(t)}function fbe(t){const e=t.pattern,n={};if(n.name=t.name,kg(e)||(n.PATTERN=e),Mr(t,hbe))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Mr(t,z7)&&(n.CATEGORIES=t[z7]),qA([n]),Mr(t,V7)&&(n.LABEL=t[V7]),Mr(t,H7)&&(n.GROUP=t[H7]),Mr(t,G7)&&(n.POP_MODE=t[G7]),Mr(t,$7)&&(n.PUSH_MODE=t[$7]),Mr(t,W7)&&(n.LONGER_ALT=t[W7]),Mr(t,q7)&&(n.LINE_BREAKS=t[q7]),Mr(t,Y7)&&(n.START_CHARS_HINT=t[Y7]),n}const I1=yu({name:"EOF",pattern:Lc.NA});qA([I1]);function YA(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function dbe(t,e){return WA(t,e)}const zY={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${jY(t)?`--> ${LT(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+op(e).image+"'";if(r)return s+r+a;{const c=vh(t,(f,d)=>f.concat(d),[]),l=or(c,f=>`[${or(f,d=>LT(d)).join(", ")}]`),h=`one of these possible Token sequences:
${or(l,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+op(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${or(t,l=>`[${or(l,u=>LT(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(zY);const pbe={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},c1={buildDuplicateFoundError(t,e){function n(u){return u instanceof Ko?u.terminalType.name:u instanceof yh?u.nonTerminalName:""}const r=t.name,i=op(e),s=i.idx,o=mm(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=or(t.prefixPath,i=>LT(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=or(t.prefixPath,i=>LT(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=mm(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=or(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof nx?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function mbe(t,e){const n=new gbe(t,e);return n.resolveRefs(),n.errors}class gbe extends tb{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Dr($a(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:pu.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class _be extends jO{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=sl(this.path.ruleStack).reverse(),this.occurrenceStack=sl(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){so(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class vbe extends _be{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new bh({definition:i});this.possibleTokTypes=GA(s),this.found=!0}}}class VO extends jO{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class ybe extends VO{walkMany(e,n,r){if(e.idx===this.occurrence){const i=op(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ko&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class K7 extends VO{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=op(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ko&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class bbe extends VO{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=op(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ko&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class X7 extends VO{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=op(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ko&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function bL(t,e,n=[]){n=sl(n);let r=[],i=0;function s(a){return a.concat(Qc(t,i+1))}function o(a){const c=bL(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof bh)return o(a.definition);if(a instanceof yh)return o(a.definition);if(a instanceof fh)r=o(a.definition);else if(a instanceof Wm){const c=a.definition.concat([new cc({definition:a.definition})]);return o(c)}else if(a instanceof qm){const c=[new bh({definition:a.definition}),new cc({definition:[new Ko({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof pp){const c=a.definition.concat([new cc({definition:[new Ko({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof cc){const c=a.definition.concat([new cc({definition:a.definition})]);r=o(c)}else{if(a instanceof mp)return Dr(a.definition,c=>{so(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ko)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Qc(t,i)}),r}function VY(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!so(h);){const f=h.pop();if(f===o){a&&M1(h).idx<=l&&h.pop();continue}const d=f.def,p=f.idx,m=f.ruleStack,g=f.occurrenceStack;if(so(d))continue;const _=d[0];if(_===i){const y={idx:p,def:Qc(d),ruleStack:iA(m),occurrenceStack:iA(g)};h.push(y)}else if(_ instanceof Ko)if(p<c-1){const y=p+1,v=e[y];if(n(v,_.terminalType)){const E={idx:y,def:Qc(d),ruleStack:m,occurrenceStack:g};h.push(E)}}else if(p===c-1)u.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:m,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(_ instanceof yh){const y=sl(m);y.push(_.nonTerminalName);const v=sl(g);v.push(_.idx);const E={idx:p,def:_.definition.concat(s,Qc(d)),ruleStack:y,occurrenceStack:v};h.push(E)}else if(_ instanceof fh){const y={idx:p,def:Qc(d),ruleStack:m,occurrenceStack:g};h.push(y),h.push(o);const v={idx:p,def:_.definition.concat(Qc(d)),ruleStack:m,occurrenceStack:g};h.push(v)}else if(_ instanceof Wm){const y=new cc({definition:_.definition,idx:_.idx}),v=_.definition.concat([y],Qc(d)),E={idx:p,def:v,ruleStack:m,occurrenceStack:g};h.push(E)}else if(_ instanceof qm){const y=new Ko({terminalType:_.separator}),v=new cc({definition:[y].concat(_.definition),idx:_.idx}),E=_.definition.concat([v],Qc(d)),x={idx:p,def:E,ruleStack:m,occurrenceStack:g};h.push(x)}else if(_ instanceof pp){const y={idx:p,def:Qc(d),ruleStack:m,occurrenceStack:g};h.push(y),h.push(o);const v=new Ko({terminalType:_.separator}),E=new cc({definition:[v].concat(_.definition),idx:_.idx}),x=_.definition.concat([E],Qc(d)),A={idx:p,def:x,ruleStack:m,occurrenceStack:g};h.push(A)}else if(_ instanceof cc){const y={idx:p,def:Qc(d),ruleStack:m,occurrenceStack:g};h.push(y),h.push(o);const v=new cc({definition:_.definition,idx:_.idx}),E=_.definition.concat([v],Qc(d)),x={idx:p,def:E,ruleStack:m,occurrenceStack:g};h.push(x)}else if(_ instanceof mp)for(let y=_.definition.length-1;y>=0;y--){const v=_.definition[y],E={idx:p,def:v.definition.concat(Qc(d)),ruleStack:m,occurrenceStack:g};h.push(E),h.push(o)}else if(_ instanceof bh)h.push({idx:p,def:_.definition.concat(Qc(d)),ruleStack:m,occurrenceStack:g});else if(_ instanceof nx)h.push(Sbe(_,p,m,g));else throw Error("non exhaustive match")}return u}function Sbe(t,e,n,r){const i=sl(n);i.push(t.name);const s=sl(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var ha;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ha||(ha={}));function HY(t){if(t instanceof fh||t==="Option")return ha.OPTION;if(t instanceof cc||t==="Repetition")return ha.REPETITION;if(t instanceof Wm||t==="RepetitionMandatory")return ha.REPETITION_MANDATORY;if(t instanceof qm||t==="RepetitionMandatoryWithSeparator")return ha.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof pp||t==="RepetitionWithSeparator")return ha.REPETITION_WITH_SEPARATOR;if(t instanceof mp||t==="Alternation")return ha.ALTERNATION;throw Error("non exhaustive match")}function Ebe(t,e,n,r,i,s){const o=D5(t,e,n),a=WY(o)?dM:WA;return s(o,r,a,i)}function xbe(t,e,n,r,i,s){const o=L5(t,e,i,n),a=WY(o)?dM:WA;return s(o[0],a,r)}function wbe(t,e,n,r){const i=t.length,s=np(t,o=>np(o,a=>a.length===1));if(e)return function(o){const a=or(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let f=0;f<u;f++){const d=l[f],p=d.length;for(let m=0;m<p;m++){const g=this.LA(m+1);if(n(g,d[m])===!1)continue e}return c}}};if(s&&!r){const o=or(t,c=>of(c)),a=vh(o,(c,l,u)=>(Dr(l,h=>{Mr(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Dr(h.categoryMatches,f=>{Mr(c,f)||(c[f]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,u[f])===!1)continue e}return o}}}}function Tbe(t,e,n){const r=np(t,s=>s.length===1),i=t.length;if(r&&!n){const s=of(t);if(s.length===1&&so(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=vh(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Dr(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class Abe extends jO{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,ha.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,ha.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,ha.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,ha.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,ha.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class $Y extends tb{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ha.OPTION)}visitRepetition(e){this.checkIsTarget(e,ha.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ha.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ha.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ha.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ha.ALTERNATION)}}function J7(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function J3(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function Cbe(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function GY(t,e){const n=or(t,o=>bL([o],1)),r=J7(n.length),i=or(n,o=>{const a={};return Dr(o,c=>{const l=J3(c.partialPath);Dr(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=J7(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,f=l[u].suffixDef,d=J3(h);if(Cbe(i,d,c)||so(f)||h.length===e){const m=r[c];if(SL(m,h)===!1){m.push(h);for(let g=0;g<d.length;g++){const _=d[g];i[c][_]=!0}}}else{const m=bL(f,o+1,h);s[c]=s[c].concat(m),Dr(m,g=>{const _=J3(g.partialPath);Dr(_,y=>{i[c][y]=!0})})}}}}return r}function D5(t,e,n,r){const i=new $Y(t,ha.ALTERNATION,r);return e.accept(i),GY(i.result,n)}function L5(t,e,n,r){const i=new $Y(t,n);e.accept(i);const s=i.result,a=new Abe(e,t,n).startWalking(),c=new bh({definition:s}),l=new bh({definition:a});return GY([c,l],r)}function SL(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function Rbe(t,e){return t.length<e.length&&np(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function WY(t){return np(t,e=>np(e,n=>np(n,r=>so(r.categoryMatches))))}function kbe(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return or(e,n=>Object.assign({type:pu.CUSTOM_LOOKAHEAD_VALIDATION},n))}function Mbe(t,e,n,r){const i=Zf(t,c=>Obe(c,n)),s=Hbe(t,e,n),o=Zf(t,c=>Fbe(c,n)),a=Zf(t,c=>Pbe(c,t,r,n));return i.concat(s,o,a)}function Obe(t,e){const n=new Nbe;t.accept(n);const r=n.allProductions,i=CY(r,Ibe),s=dp(i,a=>a.length>1);return or($a(s),a=>{const c=op(a),l=e.buildDuplicateFoundError(t,a),u=mm(c),h={message:l,type:pu.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},f=qY(c);return f&&(h.parameter=f),h})}function Ibe(t){return`${mm(t)}_#_${t.idx}_#_${qY(t)}`}function qY(t){return t instanceof Ko?t.terminalType.name:t instanceof yh?t.nonTerminalName:""}class Nbe extends tb{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function Pbe(t,e,n,r){const i=[];if(vh(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:pu.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function Dbe(t,e,n){const r=[];let i;return vu(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:pu.INVALID_RULE_OVERRIDE,ruleName:t})),r}function YY(t,e,n,r=[]){const i=[],s=_k(e.definition);if(so(s))return[];{const o=t.name;vu(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:pu.LEFT_RECURSION,ruleName:o});const c=UO(s,r.concat([t])),l=Zf(c,u=>{const h=sl(r);return h.push(u),YY(t,u,n,h)});return i.concat(l)}}function _k(t){let e=[];if(so(t))return e;const n=op(t);if(n instanceof yh)e.push(n.referencedRule);else if(n instanceof bh||n instanceof fh||n instanceof Wm||n instanceof qm||n instanceof pp||n instanceof cc)e=e.concat(_k(n.definition));else if(n instanceof mp)e=of(or(n.definition,s=>_k(s.definition)));else if(!(n instanceof Ko))throw Error("non exhaustive match");const r=lM(n),i=t.length>1;if(r&&i){const s=Qc(t);return e.concat(_k(s))}else return e}class U5 extends tb{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function Lbe(t,e){const n=new U5;t.accept(n);const r=n.alternations;return Zf(r,s=>{const o=iA(s.definition);return Zf(o,(a,c)=>{const l=VY([a],[],WA,1);return so(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:pu.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function Ube(t,e,n){const r=new U5;t.accept(r);let i=r.alternations;return i=BO(i,o=>o.ignoreAmbiguities===!0),Zf(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=D5(a,t,c,o),u=zbe(l,o,t,n),h=Vbe(l,o,t,n);return u.concat(h)})}class Bbe extends tb{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function Fbe(t,e){const n=new U5;t.accept(n);const r=n.alternations;return Zf(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:pu.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function jbe(t,e,n){const r=[];return Dr(t,i=>{const s=new Bbe;i.accept(s);const o=s.allProductions;Dr(o,a=>{const c=HY(a),l=a.maxLookahead||e,u=a.idx,f=L5(u,i,c,l)[0];if(so(of(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:pu.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function zbe(t,e,n,r){const i=[],s=vh(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Dr(c,u=>{const h=[l];Dr(t,(f,d)=>{l!==d&&SL(f,u)&&e.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!SL(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return or(s,a=>{const c=or(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:pu.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function Vbe(t,e,n,r){const i=vh(t,(o,a,c)=>{const l=or(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return $A(Zf(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=cd(i,f=>e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&Rbe(f.path,l));return or(u,f=>{const d=[f.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:d,prefixPath:f.path}),type:pu.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function Hbe(t,e,n){const r=[],i=or(e,s=>s.name);return Dr(t,s=>{const o=s.name;if(vu(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:pu.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function $be(t){const e=O5(t,{errMsgProvider:pbe}),n={};return Dr(t.rules,r=>{n[r.name]=r}),mbe(n,e.errMsgProvider)}function Gbe(t){return t=O5(t,{errMsgProvider:c1}),Mbe(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const KY="MismatchedTokenException",XY="NoViableAltException",JY="EarlyExitException",ZY="NotAllInputParsedException",QY=[KY,XY,JY,ZY];Object.freeze(QY);function pM(t){return vu(QY,t.name)}class HO extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class eK extends HO{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=KY}}class Wbe extends HO{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=XY}}class qbe extends HO{constructor(e,n){super(e,n),this.name=ZY}}class Ybe extends HO{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=JY}}const Z3={},tK="InRuleRecoveryException";class Kbe extends Error{constructor(e){super(e),this.name=tK}}class Xbe{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Mr(e,"recoveryEnabled")?e.recoveryEnabled:Mg.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Jbe)}getTokenToInsert(e){const n=YA(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:f,ruleName:this.getCurrRuleFullName()}),p=new eK(d,l,this.LA(0));p.resyncedTokens=iA(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new Kbe("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||so(n))return!1;const r=this.LA(1);return CE(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return vu(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=CE(e,s=>dbe(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Z3;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return or(e,(r,i)=>i===0?Z3:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=or(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return of(e)}getFollowSetFromFollowKey(e){if(e===Z3)return[I1];const n=e.ruleName+e.idxInCallingRule+OY+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,I1)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return iA(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=sl(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return or(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function Jbe(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=I1,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const Zbe=4,kv=8,nK=1<<kv,rK=2<<kv,EL=3<<kv,xL=4<<kv,wL=5<<kv,vk=6<<kv;function Q3(t,e,n){return n|e|t}class Qbe{constructor(e){var n;this.maxLookahead=(n=e?.maxLookahead)!==null&&n!==void 0?n:Mg.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(so(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Zf(e,n=>YY(n,n,c1))}validateEmptyOrAlternatives(e){return Zf(e,n=>Lbe(n,c1))}validateAmbiguousAlternationAlternatives(e,n){return Zf(e,r=>Ube(r,n,c1))}validateSomeNonEmptyLookaheadPath(e,n){return jbe(e,n,c1)}buildLookaheadForAlternation(e){return Ebe(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,wbe)}buildLookaheadForOptional(e){return xbe(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,HY(e.prodType),Tbe)}}class eSe{initLooksAhead(e){this.dynamicTokensEnabled=Mr(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Mg.dynamicTokensEnabled,this.maxLookahead=Mr(e,"maxLookahead")?e.maxLookahead:Mg.maxLookahead,this.lookaheadStrategy=Mr(e,"lookaheadStrategy")?e.lookaheadStrategy:new Qbe({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Dr(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=nSe(n);Dr(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${mm(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=Q3(this.fullRuleNameToShort[n.name],nK,l.idx);this.setLaFuncCache(f,h)})}),Dr(i,l=>{this.computeLookaheadFunc(n,l.idx,EL,"Repetition",l.maxLookahead,mm(l))}),Dr(s,l=>{this.computeLookaheadFunc(n,l.idx,rK,"Option",l.maxLookahead,mm(l))}),Dr(o,l=>{this.computeLookaheadFunc(n,l.idx,xL,"RepetitionMandatory",l.maxLookahead,mm(l))}),Dr(a,l=>{this.computeLookaheadFunc(n,l.idx,vk,"RepetitionMandatoryWithSeparator",l.maxLookahead,mm(l))}),Dr(c,l=>{this.computeLookaheadFunc(n,l.idx,wL,"RepetitionWithSeparator",l.maxLookahead,mm(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Q3(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return Q3(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class tSe extends tb{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const pR=new tSe;function nSe(t){pR.reset(),t.accept(pR);const e=pR.dslMethods;return pR.reset(),e}function Z7(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function Q7(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function rSe(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function iSe(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const sSe="name";function iK(t,e){Object.defineProperty(t,sSe,{enumerable:!1,configurable:!0,writable:!1,value:e})}function oSe(t,e){const n=id(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function aSe(t,e){const n=function(){};iK(n,t+"BaseSemantics");const r={visit:function(i,s){if(Wi(i)&&(i=i[0]),!kg(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=lSe(this,e);if(!so(i)){const s=or(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function cSe(t,e,n){const r=function(){};iK(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Dr(e,s=>{i[s]=oSe}),r.prototype=i,r.prototype.constructor=r,r}var TL;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(TL||(TL={}));function lSe(t,e){return uSe(t,e)}function uSe(t,e){const n=cd(e,i=>Lg(t[i])===!1),r=or(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:TL.MISSING_METHOD,methodName:i}));return $A(r)}class hSe{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Mr(e,"nodeLocationTracking")?e.nodeLocationTracking:Mg.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=ic,this.cstFinallyStateUpdate=ic,this.cstPostTerminal=ic,this.cstPostNonTerminal=ic,this.cstPostRule=ic;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Q7,this.setNodeLocationFromNode=Q7,this.cstPostRule=ic,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=ic,this.setNodeLocationFromNode=ic,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Z7,this.setNodeLocationFromNode=Z7,this.cstPostRule=ic,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=ic,this.setNodeLocationFromNode=ic,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=ic,this.setNodeLocationFromNode=ic,this.cstPostRule=ic,this.setInitialNodeLocation=ic;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];rSe(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];iSe(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(kg(this.baseCstVisitorConstructor)){const e=aSe(this.className,id(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(kg(this.baseCstVisitorWithDefaultsConstructor)){const e=cSe(this.className,id(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class fSe{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):gM}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?gM:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class dSe{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=_M){if(vu(this.definedRulesNames,e)){const o={message:c1.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:pu.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=_M){const i=Dbe(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(pM(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return p1e($a(this.gastProductionsCache))}}class pSe{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=dM,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Mr(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Wi(e)){if(so(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Wi(e))this.tokensMap=vh(e,(s,o)=>(s[o.name]=o,s),{});else if(Mr(e,"modes")&&np(of($a(e.modes)),lbe)){const s=of($a(e.modes)),o=FO(s);this.tokensMap=vh(o,(a,c)=>(a[c.name]=c,a),{})}else if(rd(e))this.tokensMap=sl(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=I1;const r=Mr(e,"modes")?of($a(e.modes)):$a(e),i=np(r,s=>so(s.categoryMatches));this.tokenMatcher=i?dM:WA,qA($a(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Mr(r,"resyncEnabled")?r.resyncEnabled:_M.resyncEnabled,s=Mr(r,"recoveryValueFunc")?r.recoveryValueFunc:_M.recoveryValueFunc,o=this.ruleShortNameIdx<<Zbe+kv;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(pM(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(rK,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(xL,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ha.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,xL,e,bbe)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(vk,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,X7],a,vk,e,X7)}else throw this.raiseEarlyExitException(e,ha.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(EL,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,EL,e,ybe,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(wL,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,K7],a,wL,e,K7)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,vk,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(nK,n),i=Wi(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new qbe(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw pM(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new eK(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===tK?r:s}}else throw r}saveRecogState(){const e=this.errors,n=sl(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),I1)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class mSe{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Mr(e,"errorMessageProvider")?e.errorMessageProvider:Mg.errorMessageProvider}SAVE_ERROR(e){if(pM(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:sl(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return sl(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=L5(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new Ybe(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=D5(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Wbe(c,this.LA(1),a))}}class gSe{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(kg(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return VY([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=op(e.ruleStack),i=this.getGAstProductions()[n];return new vbe(i,e).startWalking()}}const $O={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze($O);const ej=!0,tj=Math.pow(2,kv)-1,sK=yu({name:"RECORDING_PHASE_TOKEN",pattern:Lc.NA});qA([sK]);const oK=YA(sK,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(oK);const _Se={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class vSe{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return gM}topLevelRuleRecord(e,n){try{const r=new nx({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Qx.call(this,fh,e,n)}atLeastOneInternalRecord(e,n){Qx.call(this,Wm,n,e)}atLeastOneSepFirstInternalRecord(e,n){Qx.call(this,qm,n,e,ej)}manyInternalRecord(e,n){Qx.call(this,cc,n,e)}manySepFirstInternalRecord(e,n){Qx.call(this,pp,n,e,ej)}orInternalRecord(e,n){return ySe.call(this,e,n)}subruleInternalRecord(e,n,r){if(mM(n),!e||Mr(e,"ruleName")===!1){const a=new Error(`<SUBRULE${nj(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=M1(this.recordingProdStack),s=e.ruleName,o=new yh({idx:n,nonTerminalName:s,label:r?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?_Se:$O}consumeInternalRecord(e,n,r){if(mM(n),!FY(e)){const o=new Error(`<CONSUME${nj(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=M1(this.recordingProdStack),s=new Ko({idx:n,terminalType:e,label:r?.LABEL});return i.definition.push(s),oK}}function Qx(t,e,n,r=!1){mM(n);const i=M1(this.recordingProdStack),s=Lg(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),Mr(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),$O}function ySe(t,e){mM(e);const n=M1(this.recordingProdStack),r=Wi(t)===!1,i=r===!1?t:t.DEF,s=new mp({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});Mr(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=I5(i,a=>Lg(a.GATE));return s.hasPredicates=o,n.definition.push(s),Dr(i,a=>{const c=new bh({definition:[]});s.definition.push(c),Mr(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Mr(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),$O}function nj(t){return t===0?"":`${t}`}function mM(t){if(t<0||t>tj){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${tj+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class bSe{initPerformanceTracer(e){if(Mr(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Mg.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=kY(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function SSe(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const gM=YA(I1,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(gM);const Mg=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:zY,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),_M=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var pu;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(pu||(pu={}));let B5=class aK{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{MY(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Dr(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=$be({rules:$a(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(so(r)&&this.skipValidations===!1){const i=Gbe({rules:$a(this.gastProductionsCache),tokenTypes:$a(this.tokensMap),errMsgProvider:c1,grammarName:n}),s=kbe({lookaheadStrategy:this.lookaheadStrategy,rules:$a(this.gastProductionsCache),tokenTypes:$a(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),so(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=S1e($a(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:$a(this.gastProductionsCache)}),this.preComputeLookaheadFunctions($a(this.gastProductionsCache))})),!aK.DEFER_DEFINITION_ERRORS_HANDLING&&!so(this.definitionErrors))throw e=or(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Mr(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Mr(n,"skipValidations")?n.skipValidations:Mg.skipValidations}};B5.DEFER_DEFINITION_ERRORS_HANDLING=!1;SSe(B5,[Xbe,eSe,hSe,fSe,pSe,dSe,mSe,gSe,vSe,bSe]);class ESe extends B5{constructor(e,n=Mg){const r=sl(n);r.outputCst=!0,super(e,r)}}function xSe(t){const e=new wSe,n=$a(t);return or(n,r=>e.visitRule(r))}class wSe extends tb{visitRule(e){const n=this.visitEach(e.definition),r=CY(n,s=>s.propertyName),i=or(r,(s,o)=>{const a=!I5(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=or(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:mR(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:mR(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:mR(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:mR(e)}]}visitEachAndOverrideWith(e,n){return or(this.visitEach(e),r=>gh({},r,n))}visitEach(e){return of(or(e,n=>this.visit(n)))}}function mR(t){return t instanceof yh?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function TSe(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(of(or(t,r=>ASe(r)))),e.includeVisitorInterface&&(n=n.concat(MSe(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function ASe(t){const e=CSe(t),n=RSe(t);return[e,n]}function CSe(t){const e=cK(t.name),n=F5(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function RSe(t){return`export type ${F5(t.name)} = {
  ${or(t.properties,n=>kSe(n)).join(`
  `)}
};`}function kSe(t){const e=ISe(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function MSe(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${or(e,n=>OSe(n)).join(`
  `)}
}`}function OSe(t){const e=F5(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function ISe(t){if(Wi(t)){const e=FO(or(t,r=>rj(r)));return"("+vh(e,(r,i)=>r+" | "+i)+")"}else return rj(t)}function rj(t){return t.kind==="token"?"IToken":cK(t.name)}function cK(t){return dY(t)+"CstNode"}function F5(t){return dY(t)+"CstChildren"}const NSe={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function PSe(t,e){const n=Object.assign(Object.assign({},NSe),e),r=xSe(t);return TSe(r,n)}var yk={exports:{}},DSe=yk.exports,ij;function LSe(){return ij||(ij=1,(function(t,e){(function(n,r){t.exports=r()})(DSe,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return(function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h})(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(yk)),yk.exports}var USe=LSe();const j5=_u(USe);new zn;new zn;function Ci(t,e,n){return Math.max(e,Math.min(n,t))}function BSe(t,e){return Ci(t-Math.floor(t/e)*e,0,e)}function FSe(t,e){var n=BSe(e-t,Math.PI*2);return n>Math.PI&&(n-=Math.PI*2),n}function lK(t){return t/180*Math.PI}function uK(t){return t*180/Math.PI}const jSe=j5("089fad0j9awfem09wavefc09uwaef");function sj(t){return 2*Math.floor(t/2)}function z5(t,e){return Math.round(t/e)*e}function zSe(){return jSe()}function VSe(t){return j5(t)()}function au(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(zSe()*i)}function hK(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(VSe(t)*s)}function RE(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function HSe(t){return t[au(0,t.length-1)]}function $Se(t,e){return e[hK(t,0,e.length-1)]}function Gf(...t){return HSe(t.flat())}function GSe(t,...e){return $Se(t,e.flat())}function WSe(t){return[...new Set(t)].filter(fe)}var fK={},GO={};GO.byteLength=KSe;GO.toByteArray=JSe;GO.fromByteArray=eEe;var Sm=[],zf=[],qSe=typeof Uint8Array<"u"?Uint8Array:Array,eN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ES=0,YSe=eN.length;ES<YSe;++ES)Sm[ES]=eN[ES],zf[eN.charCodeAt(ES)]=ES;zf[45]=62;zf[95]=63;function dK(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function KSe(t){var e=dK(t),n=e[0],r=e[1];return(n+r)*3/4-r}function XSe(t,e,n){return(e+n)*3/4-n}function JSe(t){var e,n=dK(t),r=n[0],i=n[1],s=new qSe(XSe(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=zf[t.charCodeAt(c)]<<18|zf[t.charCodeAt(c+1)]<<12|zf[t.charCodeAt(c+2)]<<6|zf[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=zf[t.charCodeAt(c)]<<2|zf[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=zf[t.charCodeAt(c)]<<10|zf[t.charCodeAt(c+1)]<<4|zf[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function ZSe(t){return Sm[t>>18&63]+Sm[t>>12&63]+Sm[t>>6&63]+Sm[t&63]}function QSe(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(ZSe(r));return i.join("")}function eEe(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(QSe(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Sm[e>>2]+Sm[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Sm[e>>10]+Sm[e>>4&63]+Sm[e<<2&63]+"=")),i.join("")}var V5={};V5.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,f=n?-1:1,d=t[e+h];for(h+=f,s=d&(1<<-u)-1,d>>=-u,u+=a;u>0;s=s*256+t[e+h],h+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+h],h+=f,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(d?-1:1)*o*Math.pow(2,s-r)};V5.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=f/c:e+=f*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+d]=o&255,d+=p,o/=256,l-=8);t[n+d-p]|=m*128};(function(t){const e=GO,n=V5,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=x,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const Re=new s(1),se={foo:function(){return 42}};return Object.setPrototypeOf(se,s.prototype),Object.setPrototypeOf(Re,se),Re.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(Re){if(Re>i)throw new RangeError('The value "'+Re+'" is invalid for option "size"');const se=new s(Re);return Object.setPrototypeOf(se,u.prototype),se}function u(Re,se,W){if(typeof Re=="number"){if(typeof se=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(Re)}return h(Re,se,W)}u.poolSize=8192;function h(Re,se,W){if(typeof Re=="string")return m(Re,se);if(o.isView(Re))return _(Re);if(Re==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Re);if(Xe(Re,o)||Re&&Xe(Re.buffer,o)||typeof a<"u"&&(Xe(Re,a)||Re&&Xe(Re.buffer,a)))return y(Re,se,W);if(typeof Re=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const oe=Re.valueOf&&Re.valueOf();if(oe!=null&&oe!==Re)return u.from(oe,se,W);const xe=v(Re);if(xe)return xe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Re[Symbol.toPrimitive]=="function")return u.from(Re[Symbol.toPrimitive]("string"),se,W);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Re)}u.from=function(Re,se,W){return h(Re,se,W)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function f(Re){if(typeof Re!="number")throw new TypeError('"size" argument must be of type number');if(Re<0)throw new RangeError('The value "'+Re+'" is invalid for option "size"')}function d(Re,se,W){return f(Re),Re<=0?l(Re):se!==void 0?typeof W=="string"?l(Re).fill(se,W):l(Re).fill(se):l(Re)}u.alloc=function(Re,se,W){return d(Re,se,W)};function p(Re){return f(Re),l(Re<0?0:E(Re)|0)}u.allocUnsafe=function(Re){return p(Re)},u.allocUnsafeSlow=function(Re){return p(Re)};function m(Re,se){if((typeof se!="string"||se==="")&&(se="utf8"),!u.isEncoding(se))throw new TypeError("Unknown encoding: "+se);const W=A(Re,se)|0;let oe=l(W);const xe=oe.write(Re,se);return xe!==W&&(oe=oe.slice(0,xe)),oe}function g(Re){const se=Re.length<0?0:E(Re.length)|0,W=l(se);for(let oe=0;oe<se;oe+=1)W[oe]=Re[oe]&255;return W}function _(Re){if(Xe(Re,s)){const se=new s(Re);return y(se.buffer,se.byteOffset,se.byteLength)}return g(Re)}function y(Re,se,W){if(se<0||Re.byteLength<se)throw new RangeError('"offset" is outside of buffer bounds');if(Re.byteLength<se+(W||0))throw new RangeError('"length" is outside of buffer bounds');let oe;return se===void 0&&W===void 0?oe=new s(Re):W===void 0?oe=new s(Re,se):oe=new s(Re,se,W),Object.setPrototypeOf(oe,u.prototype),oe}function v(Re){if(u.isBuffer(Re)){const se=E(Re.length)|0,W=l(se);return W.length===0||Re.copy(W,0,0,se),W}if(Re.length!==void 0)return typeof Re.length!="number"||tt(Re.length)?l(0):g(Re);if(Re.type==="Buffer"&&Array.isArray(Re.data))return g(Re.data)}function E(Re){if(Re>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return Re|0}function x(Re){return+Re!=Re&&(Re=0),u.alloc(+Re)}u.isBuffer=function(se){return se!=null&&se._isBuffer===!0&&se!==u.prototype},u.compare=function(se,W){if(Xe(se,s)&&(se=u.from(se,se.offset,se.byteLength)),Xe(W,s)&&(W=u.from(W,W.offset,W.byteLength)),!u.isBuffer(se)||!u.isBuffer(W))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(se===W)return 0;let oe=se.length,xe=W.length;for(let Ce=0,Se=Math.min(oe,xe);Ce<Se;++Ce)if(se[Ce]!==W[Ce]){oe=se[Ce],xe=W[Ce];break}return oe<xe?-1:xe<oe?1:0},u.isEncoding=function(se){switch(String(se).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(se,W){if(!Array.isArray(se))throw new TypeError('"list" argument must be an Array of Buffers');if(se.length===0)return u.alloc(0);let oe;if(W===void 0)for(W=0,oe=0;oe<se.length;++oe)W+=se[oe].length;const xe=u.allocUnsafe(W);let Ce=0;for(oe=0;oe<se.length;++oe){let Se=se[oe];if(Xe(Se,s))Ce+Se.length>xe.length?(u.isBuffer(Se)||(Se=u.from(Se)),Se.copy(xe,Ce)):s.prototype.set.call(xe,Se,Ce);else if(u.isBuffer(Se))Se.copy(xe,Ce);else throw new TypeError('"list" argument must be an Array of Buffers');Ce+=Se.length}return xe};function A(Re,se){if(u.isBuffer(Re))return Re.length;if(o.isView(Re)||Xe(Re,o))return Re.byteLength;if(typeof Re!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Re);const W=Re.length,oe=arguments.length>2&&arguments[2]===!0;if(!oe&&W===0)return 0;let xe=!1;for(;;)switch(se){case"ascii":case"latin1":case"binary":return W;case"utf8":case"utf-8":return ve(Re).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W*2;case"hex":return W>>>1;case"base64":return ze(Re).length;default:if(xe)return oe?-1:ve(Re).length;se=(""+se).toLowerCase(),xe=!0}}u.byteLength=A;function T(Re,se,W){let oe=!1;if((se===void 0||se<0)&&(se=0),se>this.length||((W===void 0||W>this.length)&&(W=this.length),W<=0)||(W>>>=0,se>>>=0,W<=se))return"";for(Re||(Re="utf8");;)switch(Re){case"hex":return Y(this,se,W);case"utf8":case"utf-8":return G(this,se,W);case"ascii":return re(this,se,W);case"latin1":case"binary":return H(this,se,W);case"base64":return q(this,se,W);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Z(this,se,W);default:if(oe)throw new TypeError("Unknown encoding: "+Re);Re=(Re+"").toLowerCase(),oe=!0}}u.prototype._isBuffer=!0;function k(Re,se,W){const oe=Re[se];Re[se]=Re[W],Re[W]=oe}u.prototype.swap16=function(){const se=this.length;if(se%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let W=0;W<se;W+=2)k(this,W,W+1);return this},u.prototype.swap32=function(){const se=this.length;if(se%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let W=0;W<se;W+=4)k(this,W,W+3),k(this,W+1,W+2);return this},u.prototype.swap64=function(){const se=this.length;if(se%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let W=0;W<se;W+=8)k(this,W,W+7),k(this,W+1,W+6),k(this,W+2,W+5),k(this,W+3,W+4);return this},u.prototype.toString=function(){const se=this.length;return se===0?"":arguments.length===0?G(this,0,se):T.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(se){if(!u.isBuffer(se))throw new TypeError("Argument must be a Buffer");return this===se?!0:u.compare(this,se)===0},u.prototype.inspect=function(){let se="";const W=t.INSPECT_MAX_BYTES;return se=this.toString("hex",0,W).replace(/(.{2})/g,"$1 ").trim(),this.length>W&&(se+=" ... "),"<Buffer "+se+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(se,W,oe,xe,Ce){if(Xe(se,s)&&(se=u.from(se,se.offset,se.byteLength)),!u.isBuffer(se))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof se);if(W===void 0&&(W=0),oe===void 0&&(oe=se?se.length:0),xe===void 0&&(xe=0),Ce===void 0&&(Ce=this.length),W<0||oe>se.length||xe<0||Ce>this.length)throw new RangeError("out of range index");if(xe>=Ce&&W>=oe)return 0;if(xe>=Ce)return-1;if(W>=oe)return 1;if(W>>>=0,oe>>>=0,xe>>>=0,Ce>>>=0,this===se)return 0;let Se=Ce-xe,ye=oe-W;const Ke=Math.min(Se,ye),ke=this.slice(xe,Ce),He=se.slice(W,oe);for(let Fe=0;Fe<Ke;++Fe)if(ke[Fe]!==He[Fe]){Se=ke[Fe],ye=He[Fe];break}return Se<ye?-1:ye<Se?1:0};function L(Re,se,W,oe,xe){if(Re.length===0)return-1;if(typeof W=="string"?(oe=W,W=0):W>2147483647?W=2147483647:W<-2147483648&&(W=-2147483648),W=+W,tt(W)&&(W=xe?0:Re.length-1),W<0&&(W=Re.length+W),W>=Re.length){if(xe)return-1;W=Re.length-1}else if(W<0)if(xe)W=0;else return-1;if(typeof se=="string"&&(se=u.from(se,oe)),u.isBuffer(se))return se.length===0?-1:I(Re,se,W,oe,xe);if(typeof se=="number")return se=se&255,typeof s.prototype.indexOf=="function"?xe?s.prototype.indexOf.call(Re,se,W):s.prototype.lastIndexOf.call(Re,se,W):I(Re,[se],W,oe,xe);throw new TypeError("val must be string, number or Buffer")}function I(Re,se,W,oe,xe){let Ce=1,Se=Re.length,ye=se.length;if(oe!==void 0&&(oe=String(oe).toLowerCase(),oe==="ucs2"||oe==="ucs-2"||oe==="utf16le"||oe==="utf-16le")){if(Re.length<2||se.length<2)return-1;Ce=2,Se/=2,ye/=2,W/=2}function Ke(He,Fe){return Ce===1?He[Fe]:He.readUInt16BE(Fe*Ce)}let ke;if(xe){let He=-1;for(ke=W;ke<Se;ke++)if(Ke(Re,ke)===Ke(se,He===-1?0:ke-He)){if(He===-1&&(He=ke),ke-He+1===ye)return He*Ce}else He!==-1&&(ke-=ke-He),He=-1}else for(W+ye>Se&&(W=Se-ye),ke=W;ke>=0;ke--){let He=!0;for(let Fe=0;Fe<ye;Fe++)if(Ke(Re,ke+Fe)!==Ke(se,Fe)){He=!1;break}if(He)return ke}return-1}u.prototype.includes=function(se,W,oe){return this.indexOf(se,W,oe)!==-1},u.prototype.indexOf=function(se,W,oe){return L(this,se,W,oe,!0)},u.prototype.lastIndexOf=function(se,W,oe){return L(this,se,W,oe,!1)};function F(Re,se,W,oe){W=Number(W)||0;const xe=Re.length-W;oe?(oe=Number(oe),oe>xe&&(oe=xe)):oe=xe;const Ce=se.length;oe>Ce/2&&(oe=Ce/2);let Se;for(Se=0;Se<oe;++Se){const ye=parseInt(se.substr(Se*2,2),16);if(tt(ye))return Se;Re[W+Se]=ye}return Se}function M(Re,se,W,oe){return Je(ve(se,Re.length-W),Re,W,oe)}function D(Re,se,W,oe){return Je(we(se),Re,W,oe)}function O(Re,se,W,oe){return Je(ze(se),Re,W,oe)}function z(Re,se,W,oe){return Je(pe(se,Re.length-W),Re,W,oe)}u.prototype.write=function(se,W,oe,xe){if(W===void 0)xe="utf8",oe=this.length,W=0;else if(oe===void 0&&typeof W=="string")xe=W,oe=this.length,W=0;else if(isFinite(W))W=W>>>0,isFinite(oe)?(oe=oe>>>0,xe===void 0&&(xe="utf8")):(xe=oe,oe=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Ce=this.length-W;if((oe===void 0||oe>Ce)&&(oe=Ce),se.length>0&&(oe<0||W<0)||W>this.length)throw new RangeError("Attempt to write outside buffer bounds");xe||(xe="utf8");let Se=!1;for(;;)switch(xe){case"hex":return F(this,se,W,oe);case"utf8":case"utf-8":return M(this,se,W,oe);case"ascii":case"latin1":case"binary":return D(this,se,W,oe);case"base64":return O(this,se,W,oe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,se,W,oe);default:if(Se)throw new TypeError("Unknown encoding: "+xe);xe=(""+xe).toLowerCase(),Se=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function q(Re,se,W){return se===0&&W===Re.length?e.fromByteArray(Re):e.fromByteArray(Re.slice(se,W))}function G(Re,se,W){W=Math.min(Re.length,W);const oe=[];let xe=se;for(;xe<W;){const Ce=Re[xe];let Se=null,ye=Ce>239?4:Ce>223?3:Ce>191?2:1;if(xe+ye<=W){let Ke,ke,He,Fe;switch(ye){case 1:Ce<128&&(Se=Ce);break;case 2:Ke=Re[xe+1],(Ke&192)===128&&(Fe=(Ce&31)<<6|Ke&63,Fe>127&&(Se=Fe));break;case 3:Ke=Re[xe+1],ke=Re[xe+2],(Ke&192)===128&&(ke&192)===128&&(Fe=(Ce&15)<<12|(Ke&63)<<6|ke&63,Fe>2047&&(Fe<55296||Fe>57343)&&(Se=Fe));break;case 4:Ke=Re[xe+1],ke=Re[xe+2],He=Re[xe+3],(Ke&192)===128&&(ke&192)===128&&(He&192)===128&&(Fe=(Ce&15)<<18|(Ke&63)<<12|(ke&63)<<6|He&63,Fe>65535&&Fe<1114112&&(Se=Fe))}}Se===null?(Se=65533,ye=1):Se>65535&&(Se-=65536,oe.push(Se>>>10&1023|55296),Se=56320|Se&1023),oe.push(Se),xe+=ye}return te(oe)}const K=4096;function te(Re){const se=Re.length;if(se<=K)return String.fromCharCode.apply(String,Re);let W="",oe=0;for(;oe<se;)W+=String.fromCharCode.apply(String,Re.slice(oe,oe+=K));return W}function re(Re,se,W){let oe="";W=Math.min(Re.length,W);for(let xe=se;xe<W;++xe)oe+=String.fromCharCode(Re[xe]&127);return oe}function H(Re,se,W){let oe="";W=Math.min(Re.length,W);for(let xe=se;xe<W;++xe)oe+=String.fromCharCode(Re[xe]);return oe}function Y(Re,se,W){const oe=Re.length;(!se||se<0)&&(se=0),(!W||W<0||W>oe)&&(W=oe);let xe="";for(let Ce=se;Ce<W;++Ce)xe+=Nt[Re[Ce]];return xe}function Z(Re,se,W){const oe=Re.slice(se,W);let xe="";for(let Ce=0;Ce<oe.length-1;Ce+=2)xe+=String.fromCharCode(oe[Ce]+oe[Ce+1]*256);return xe}u.prototype.slice=function(se,W){const oe=this.length;se=~~se,W=W===void 0?oe:~~W,se<0?(se+=oe,se<0&&(se=0)):se>oe&&(se=oe),W<0?(W+=oe,W<0&&(W=0)):W>oe&&(W=oe),W<se&&(W=se);const xe=this.subarray(se,W);return Object.setPrototypeOf(xe,u.prototype),xe};function Q(Re,se,W){if(Re%1!==0||Re<0)throw new RangeError("offset is not uint");if(Re+se>W)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(se,W,oe){se=se>>>0,W=W>>>0,oe||Q(se,W,this.length);let xe=this[se],Ce=1,Se=0;for(;++Se<W&&(Ce*=256);)xe+=this[se+Se]*Ce;return xe},u.prototype.readUintBE=u.prototype.readUIntBE=function(se,W,oe){se=se>>>0,W=W>>>0,oe||Q(se,W,this.length);let xe=this[se+--W],Ce=1;for(;W>0&&(Ce*=256);)xe+=this[se+--W]*Ce;return xe},u.prototype.readUint8=u.prototype.readUInt8=function(se,W){return se=se>>>0,W||Q(se,1,this.length),this[se]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(se,W){return se=se>>>0,W||Q(se,2,this.length),this[se]|this[se+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(se,W){return se=se>>>0,W||Q(se,2,this.length),this[se]<<8|this[se+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(se,W){return se=se>>>0,W||Q(se,4,this.length),(this[se]|this[se+1]<<8|this[se+2]<<16)+this[se+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(se,W){return se=se>>>0,W||Q(se,4,this.length),this[se]*16777216+(this[se+1]<<16|this[se+2]<<8|this[se+3])},u.prototype.readBigUInt64LE=gt(function(se){se=se>>>0,Ve(se,"offset");const W=this[se],oe=this[se+7];(W===void 0||oe===void 0)&&De(se,this.length-8);const xe=W+this[++se]*2**8+this[++se]*2**16+this[++se]*2**24,Ce=this[++se]+this[++se]*2**8+this[++se]*2**16+oe*2**24;return BigInt(xe)+(BigInt(Ce)<<BigInt(32))}),u.prototype.readBigUInt64BE=gt(function(se){se=se>>>0,Ve(se,"offset");const W=this[se],oe=this[se+7];(W===void 0||oe===void 0)&&De(se,this.length-8);const xe=W*2**24+this[++se]*2**16+this[++se]*2**8+this[++se],Ce=this[++se]*2**24+this[++se]*2**16+this[++se]*2**8+oe;return(BigInt(xe)<<BigInt(32))+BigInt(Ce)}),u.prototype.readIntLE=function(se,W,oe){se=se>>>0,W=W>>>0,oe||Q(se,W,this.length);let xe=this[se],Ce=1,Se=0;for(;++Se<W&&(Ce*=256);)xe+=this[se+Se]*Ce;return Ce*=128,xe>=Ce&&(xe-=Math.pow(2,8*W)),xe},u.prototype.readIntBE=function(se,W,oe){se=se>>>0,W=W>>>0,oe||Q(se,W,this.length);let xe=W,Ce=1,Se=this[se+--xe];for(;xe>0&&(Ce*=256);)Se+=this[se+--xe]*Ce;return Ce*=128,Se>=Ce&&(Se-=Math.pow(2,8*W)),Se},u.prototype.readInt8=function(se,W){return se=se>>>0,W||Q(se,1,this.length),this[se]&128?(255-this[se]+1)*-1:this[se]},u.prototype.readInt16LE=function(se,W){se=se>>>0,W||Q(se,2,this.length);const oe=this[se]|this[se+1]<<8;return oe&32768?oe|4294901760:oe},u.prototype.readInt16BE=function(se,W){se=se>>>0,W||Q(se,2,this.length);const oe=this[se+1]|this[se]<<8;return oe&32768?oe|4294901760:oe},u.prototype.readInt32LE=function(se,W){return se=se>>>0,W||Q(se,4,this.length),this[se]|this[se+1]<<8|this[se+2]<<16|this[se+3]<<24},u.prototype.readInt32BE=function(se,W){return se=se>>>0,W||Q(se,4,this.length),this[se]<<24|this[se+1]<<16|this[se+2]<<8|this[se+3]},u.prototype.readBigInt64LE=gt(function(se){se=se>>>0,Ve(se,"offset");const W=this[se],oe=this[se+7];(W===void 0||oe===void 0)&&De(se,this.length-8);const xe=this[se+4]+this[se+5]*2**8+this[se+6]*2**16+(oe<<24);return(BigInt(xe)<<BigInt(32))+BigInt(W+this[++se]*2**8+this[++se]*2**16+this[++se]*2**24)}),u.prototype.readBigInt64BE=gt(function(se){se=se>>>0,Ve(se,"offset");const W=this[se],oe=this[se+7];(W===void 0||oe===void 0)&&De(se,this.length-8);const xe=(W<<24)+this[++se]*2**16+this[++se]*2**8+this[++se];return(BigInt(xe)<<BigInt(32))+BigInt(this[++se]*2**24+this[++se]*2**16+this[++se]*2**8+oe)}),u.prototype.readFloatLE=function(se,W){return se=se>>>0,W||Q(se,4,this.length),n.read(this,se,!0,23,4)},u.prototype.readFloatBE=function(se,W){return se=se>>>0,W||Q(se,4,this.length),n.read(this,se,!1,23,4)},u.prototype.readDoubleLE=function(se,W){return se=se>>>0,W||Q(se,8,this.length),n.read(this,se,!0,52,8)},u.prototype.readDoubleBE=function(se,W){return se=se>>>0,W||Q(se,8,this.length),n.read(this,se,!1,52,8)};function ie(Re,se,W,oe,xe,Ce){if(!u.isBuffer(Re))throw new TypeError('"buffer" argument must be a Buffer instance');if(se>xe||se<Ce)throw new RangeError('"value" argument is out of bounds');if(W+oe>Re.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(se,W,oe,xe){if(se=+se,W=W>>>0,oe=oe>>>0,!xe){const ye=Math.pow(2,8*oe)-1;ie(this,se,W,oe,ye,0)}let Ce=1,Se=0;for(this[W]=se&255;++Se<oe&&(Ce*=256);)this[W+Se]=se/Ce&255;return W+oe},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(se,W,oe,xe){if(se=+se,W=W>>>0,oe=oe>>>0,!xe){const ye=Math.pow(2,8*oe)-1;ie(this,se,W,oe,ye,0)}let Ce=oe-1,Se=1;for(this[W+Ce]=se&255;--Ce>=0&&(Se*=256);)this[W+Ce]=se/Se&255;return W+oe},u.prototype.writeUint8=u.prototype.writeUInt8=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,1,255,0),this[W]=se&255,W+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,2,65535,0),this[W]=se&255,this[W+1]=se>>>8,W+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,2,65535,0),this[W]=se>>>8,this[W+1]=se&255,W+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,4,4294967295,0),this[W+3]=se>>>24,this[W+2]=se>>>16,this[W+1]=se>>>8,this[W]=se&255,W+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,4,4294967295,0),this[W]=se>>>24,this[W+1]=se>>>16,this[W+2]=se>>>8,this[W+3]=se&255,W+4};function ge(Re,se,W,oe,xe){Le(se,oe,xe,Re,W,7);let Ce=Number(se&BigInt(4294967295));Re[W++]=Ce,Ce=Ce>>8,Re[W++]=Ce,Ce=Ce>>8,Re[W++]=Ce,Ce=Ce>>8,Re[W++]=Ce;let Se=Number(se>>BigInt(32)&BigInt(4294967295));return Re[W++]=Se,Se=Se>>8,Re[W++]=Se,Se=Se>>8,Re[W++]=Se,Se=Se>>8,Re[W++]=Se,W}function Te(Re,se,W,oe,xe){Le(se,oe,xe,Re,W,7);let Ce=Number(se&BigInt(4294967295));Re[W+7]=Ce,Ce=Ce>>8,Re[W+6]=Ce,Ce=Ce>>8,Re[W+5]=Ce,Ce=Ce>>8,Re[W+4]=Ce;let Se=Number(se>>BigInt(32)&BigInt(4294967295));return Re[W+3]=Se,Se=Se>>8,Re[W+2]=Se,Se=Se>>8,Re[W+1]=Se,Se=Se>>8,Re[W]=Se,W+8}u.prototype.writeBigUInt64LE=gt(function(se,W=0){return ge(this,se,W,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=gt(function(se,W=0){return Te(this,se,W,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(se,W,oe,xe){if(se=+se,W=W>>>0,!xe){const Ke=Math.pow(2,8*oe-1);ie(this,se,W,oe,Ke-1,-Ke)}let Ce=0,Se=1,ye=0;for(this[W]=se&255;++Ce<oe&&(Se*=256);)se<0&&ye===0&&this[W+Ce-1]!==0&&(ye=1),this[W+Ce]=(se/Se>>0)-ye&255;return W+oe},u.prototype.writeIntBE=function(se,W,oe,xe){if(se=+se,W=W>>>0,!xe){const Ke=Math.pow(2,8*oe-1);ie(this,se,W,oe,Ke-1,-Ke)}let Ce=oe-1,Se=1,ye=0;for(this[W+Ce]=se&255;--Ce>=0&&(Se*=256);)se<0&&ye===0&&this[W+Ce+1]!==0&&(ye=1),this[W+Ce]=(se/Se>>0)-ye&255;return W+oe},u.prototype.writeInt8=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,1,127,-128),se<0&&(se=255+se+1),this[W]=se&255,W+1},u.prototype.writeInt16LE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,2,32767,-32768),this[W]=se&255,this[W+1]=se>>>8,W+2},u.prototype.writeInt16BE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,2,32767,-32768),this[W]=se>>>8,this[W+1]=se&255,W+2},u.prototype.writeInt32LE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,4,2147483647,-2147483648),this[W]=se&255,this[W+1]=se>>>8,this[W+2]=se>>>16,this[W+3]=se>>>24,W+4},u.prototype.writeInt32BE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,4,2147483647,-2147483648),se<0&&(se=4294967295+se+1),this[W]=se>>>24,this[W+1]=se>>>16,this[W+2]=se>>>8,this[W+3]=se&255,W+4},u.prototype.writeBigInt64LE=gt(function(se,W=0){return ge(this,se,W,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=gt(function(se,W=0){return Te(this,se,W,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function be(Re,se,W,oe,xe,Ce){if(W+oe>Re.length)throw new RangeError("Index out of range");if(W<0)throw new RangeError("Index out of range")}function Pe(Re,se,W,oe,xe){return se=+se,W=W>>>0,xe||be(Re,se,W,4),n.write(Re,se,W,oe,23,4),W+4}u.prototype.writeFloatLE=function(se,W,oe){return Pe(this,se,W,!0,oe)},u.prototype.writeFloatBE=function(se,W,oe){return Pe(this,se,W,!1,oe)};function Ge(Re,se,W,oe,xe){return se=+se,W=W>>>0,xe||be(Re,se,W,8),n.write(Re,se,W,oe,52,8),W+8}u.prototype.writeDoubleLE=function(se,W,oe){return Ge(this,se,W,!0,oe)},u.prototype.writeDoubleBE=function(se,W,oe){return Ge(this,se,W,!1,oe)},u.prototype.copy=function(se,W,oe,xe){if(!u.isBuffer(se))throw new TypeError("argument should be a Buffer");if(oe||(oe=0),!xe&&xe!==0&&(xe=this.length),W>=se.length&&(W=se.length),W||(W=0),xe>0&&xe<oe&&(xe=oe),xe===oe||se.length===0||this.length===0)return 0;if(W<0)throw new RangeError("targetStart out of bounds");if(oe<0||oe>=this.length)throw new RangeError("Index out of range");if(xe<0)throw new RangeError("sourceEnd out of bounds");xe>this.length&&(xe=this.length),se.length-W<xe-oe&&(xe=se.length-W+oe);const Ce=xe-oe;return this===se&&typeof s.prototype.copyWithin=="function"?this.copyWithin(W,oe,xe):s.prototype.set.call(se,this.subarray(oe,xe),W),Ce},u.prototype.fill=function(se,W,oe,xe){if(typeof se=="string"){if(typeof W=="string"?(xe=W,W=0,oe=this.length):typeof oe=="string"&&(xe=oe,oe=this.length),xe!==void 0&&typeof xe!="string")throw new TypeError("encoding must be a string");if(typeof xe=="string"&&!u.isEncoding(xe))throw new TypeError("Unknown encoding: "+xe);if(se.length===1){const Se=se.charCodeAt(0);(xe==="utf8"&&Se<128||xe==="latin1")&&(se=Se)}}else typeof se=="number"?se=se&255:typeof se=="boolean"&&(se=Number(se));if(W<0||this.length<W||this.length<oe)throw new RangeError("Out of range index");if(oe<=W)return this;W=W>>>0,oe=oe===void 0?this.length:oe>>>0,se||(se=0);let Ce;if(typeof se=="number")for(Ce=W;Ce<oe;++Ce)this[Ce]=se;else{const Se=u.isBuffer(se)?se:u.from(se,xe),ye=Se.length;if(ye===0)throw new TypeError('The value "'+se+'" is invalid for argument "value"');for(Ce=0;Ce<oe-W;++Ce)this[Ce+W]=Se[Ce%ye]}return this};const Ze={};function lt(Re,se,W){Ze[Re]=class extends W{constructor(){super(),Object.defineProperty(this,"message",{value:se.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Re}]`,this.stack,delete this.name}get code(){return Re}set code(xe){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:xe,writable:!0})}toString(){return`${this.name} [${Re}]: ${this.message}`}}}lt("ERR_BUFFER_OUT_OF_BOUNDS",function(Re){return Re?`${Re} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),lt("ERR_INVALID_ARG_TYPE",function(Re,se){return`The "${Re}" argument must be of type number. Received type ${typeof se}`},TypeError),lt("ERR_OUT_OF_RANGE",function(Re,se,W){let oe=`The value of "${Re}" is out of range.`,xe=W;return Number.isInteger(W)&&Math.abs(W)>2**32?xe=pt(String(W)):typeof W=="bigint"&&(xe=String(W),(W>BigInt(2)**BigInt(32)||W<-(BigInt(2)**BigInt(32)))&&(xe=pt(xe)),xe+="n"),oe+=` It must be ${se}. Received ${xe}`,oe},RangeError);function pt(Re){let se="",W=Re.length;const oe=Re[0]==="-"?1:0;for(;W>=oe+4;W-=3)se=`_${Re.slice(W-3,W)}${se}`;return`${Re.slice(0,W)}${se}`}function ne(Re,se,W){Ve(se,"offset"),(Re[se]===void 0||Re[se+W]===void 0)&&De(se,Re.length-(W+1))}function Le(Re,se,W,oe,xe,Ce){if(Re>W||Re<se){const Se=typeof se=="bigint"?"n":"";let ye;throw se===0||se===BigInt(0)?ye=`>= 0${Se} and < 2${Se} ** ${(Ce+1)*8}${Se}`:ye=`>= -(2${Se} ** ${(Ce+1)*8-1}${Se}) and < 2 ** ${(Ce+1)*8-1}${Se}`,new Ze.ERR_OUT_OF_RANGE("value",ye,Re)}ne(oe,xe,Ce)}function Ve(Re,se){if(typeof Re!="number")throw new Ze.ERR_INVALID_ARG_TYPE(se,"number",Re)}function De(Re,se,W){throw Math.floor(Re)!==Re?(Ve(Re,W),new Ze.ERR_OUT_OF_RANGE("offset","an integer",Re)):se<0?new Ze.ERR_BUFFER_OUT_OF_BOUNDS:new Ze.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${se}`,Re)}const Ie=/[^+/0-9A-Za-z-_]/g;function ae(Re){if(Re=Re.split("=")[0],Re=Re.trim().replace(Ie,""),Re.length<2)return"";for(;Re.length%4!==0;)Re=Re+"=";return Re}function ve(Re,se){se=se||1/0;let W;const oe=Re.length;let xe=null;const Ce=[];for(let Se=0;Se<oe;++Se){if(W=Re.charCodeAt(Se),W>55295&&W<57344){if(!xe){if(W>56319){(se-=3)>-1&&Ce.push(239,191,189);continue}else if(Se+1===oe){(se-=3)>-1&&Ce.push(239,191,189);continue}xe=W;continue}if(W<56320){(se-=3)>-1&&Ce.push(239,191,189),xe=W;continue}W=(xe-55296<<10|W-56320)+65536}else xe&&(se-=3)>-1&&Ce.push(239,191,189);if(xe=null,W<128){if((se-=1)<0)break;Ce.push(W)}else if(W<2048){if((se-=2)<0)break;Ce.push(W>>6|192,W&63|128)}else if(W<65536){if((se-=3)<0)break;Ce.push(W>>12|224,W>>6&63|128,W&63|128)}else if(W<1114112){if((se-=4)<0)break;Ce.push(W>>18|240,W>>12&63|128,W>>6&63|128,W&63|128)}else throw new Error("Invalid code point")}return Ce}function we(Re){const se=[];for(let W=0;W<Re.length;++W)se.push(Re.charCodeAt(W)&255);return se}function pe(Re,se){let W,oe,xe;const Ce=[];for(let Se=0;Se<Re.length&&!((se-=2)<0);++Se)W=Re.charCodeAt(Se),oe=W>>8,xe=W%256,Ce.push(xe),Ce.push(oe);return Ce}function ze(Re){return e.toByteArray(ae(Re))}function Je(Re,se,W,oe){let xe;for(xe=0;xe<oe&&!(xe+W>=se.length||xe>=Re.length);++xe)se[xe+W]=Re[xe];return xe}function Xe(Re,se){return Re instanceof se||Re!=null&&Re.constructor!=null&&Re.constructor.name!=null&&Re.constructor.name===se.name}function tt(Re){return Re!==Re}const Nt=(function(){const Re="0123456789abcdef",se=new Array(256);for(let W=0;W<16;++W){const oe=W*16;for(let xe=0;xe<16;++xe)se[oe+xe]=Re[W]+Re[xe]}return se})();function gt(Re){return typeof BigInt>"u"?wt:Re}function wt(){throw new Error("BigInt not supported")}})(fK);const js=fK.Buffer;var AL;try{AL=new TextDecoder}catch{}var Wn,Om,Et=0,ro={},Ui,rv,Vf=0,Em=0,Mc,Sg,Sh=[],Ii,oj={useRecords:!1,mapsAsObjects:!0};class pK{}const mK=new pK;mK.name="MessagePack 0xC1";var av=!1,gK=2,tEe;try{new Function("")}catch{gK=1/0}class sA{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(Wn)return EK(()=>(RL(),this?this.unpack(e,n):sA.prototype.unpack.call(oj,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof js<"u"?js.from(e):new Uint8Array(e)),typeof n=="object"?(Om=n.end||e.length,Et=n.start||0):(Et=0,Om=n>-1?n:e.length),Em=0,rv=null,Mc=null,Wn=e;try{Ii=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw Wn=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof sA){if(ro=this,this.structures)return Ui=this.structures,gR(n);(!Ui||Ui.length>0)&&(Ui=[])}else ro=oj,(!Ui||Ui.length>0)&&(Ui=[]);return gR(n)}unpackMultiple(e,n){let r,i=0;try{av=!0;let s=e.length,o=this?this.unpack(e,s):WO.unpack(e,s);if(n){if(n(o,i,Et)===!1)return;for(;Et<s;)if(i=Et,n(gR(),i,Et)===!1)return}else{for(r=[o];Et<s;)i=Et,r.push(gR());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{av=!1,RL()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function gR(t){try{if(!ro.trusted&&!av){let n=Ui.sharedLength||0;n<Ui.length&&(Ui.length=n)}let e;if(ro.randomAccessStructure&&Wn[Et]<64&&Wn[Et]>=32&&tEe||(e=ka()),Mc&&(Et=Mc.postBundlePosition,Mc=null),av&&(Ui.restoreStructures=null),Et==Om)Ui&&Ui.restoreStructures&&aj(),Ui=null,Wn=null,Sg&&(Sg=null);else{if(Et>Om)throw new Error("Unexpected end of MessagePack data");if(!av){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Ui&&Ui.restoreStructures&&aj(),RL(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||Et>Om)&&(e.incomplete=!0),e}}function aj(){for(let t in Ui.restoreStructures)Ui[t]=Ui.restoreStructures[t];Ui.restoreStructures=null}function ka(){let t=Wn[Et++];if(t<160)if(t<128){if(t<64)return t;{let e=Ui[t&63]||ro.getStructures&&_K()[t&63];return e?(e.read||(e.read=H5(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,ro.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=yK();r==="__proto__"&&(r="__proto_"),e[r]=ka()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(ka(),ka());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=ka();return ro.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(Em>=Et)return rv.slice(Et-Vf,(Et+=e)-Vf);if(Em==0&&Om<140){let n=e<16?$5(e):vK(e);if(n!=null)return n}return CL(e)}else{let e;switch(t){case 192:return null;case 193:return Mc?(e=ka(),e>0?Mc[1].slice(Mc.position1,Mc.position1+=e):Mc[0].slice(Mc.position0,Mc.position0-=e)):mK;case 194:return!1;case 195:return!0;case 196:if(e=Wn[Et++],e===void 0)throw new Error("Unexpected end of buffer");return tN(e);case 197:return e=Ii.getUint16(Et),Et+=2,tN(e);case 198:return e=Ii.getUint32(Et),Et+=4,tN(e);case 199:return Ty(Wn[Et++]);case 200:return e=Ii.getUint16(Et),Et+=2,Ty(e);case 201:return e=Ii.getUint32(Et),Et+=4,Ty(e);case 202:if(e=Ii.getFloat32(Et),ro.useFloat32>2){let n=G5[(Wn[Et]&127)<<1|Wn[Et+1]>>7];return Et+=4,(n*e+(e>0?.5:-.5)>>0)/n}return Et+=4,e;case 203:return e=Ii.getFloat64(Et),Et+=8,e;case 204:return Wn[Et++];case 205:return e=Ii.getUint16(Et),Et+=2,e;case 206:return e=Ii.getUint32(Et),Et+=4,e;case 207:return ro.int64AsType==="number"?(e=Ii.getUint32(Et)*4294967296,e+=Ii.getUint32(Et+4)):ro.int64AsType==="string"?e=Ii.getBigUint64(Et).toString():ro.int64AsType==="auto"?(e=Ii.getBigUint64(Et),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Ii.getBigUint64(Et),Et+=8,e;case 208:return Ii.getInt8(Et++);case 209:return e=Ii.getInt16(Et),Et+=2,e;case 210:return e=Ii.getInt32(Et),Et+=4,e;case 211:return ro.int64AsType==="number"?(e=Ii.getInt32(Et)*4294967296,e+=Ii.getUint32(Et+4)):ro.int64AsType==="string"?e=Ii.getBigInt64(Et).toString():ro.int64AsType==="auto"?(e=Ii.getBigInt64(Et),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Ii.getBigInt64(Et),Et+=8,e;case 212:if(e=Wn[Et++],e==114)return dj(Wn[Et++]&63);{let n=Sh[e];if(n)return n.read?(Et++,n.read(ka())):n.noBuffer?(Et++,n()):n(Wn.subarray(Et,++Et));throw new Error("Unknown extension "+e)}case 213:return e=Wn[Et],e==114?(Et++,dj(Wn[Et++]&63,Wn[Et++])):Ty(2);case 214:return Ty(4);case 215:return Ty(8);case 216:return Ty(16);case 217:return e=Wn[Et++],Em>=Et?rv.slice(Et-Vf,(Et+=e)-Vf):rEe(e);case 218:return e=Ii.getUint16(Et),Et+=2,Em>=Et?rv.slice(Et-Vf,(Et+=e)-Vf):iEe(e);case 219:return e=Ii.getUint32(Et),Et+=4,Em>=Et?rv.slice(Et-Vf,(Et+=e)-Vf):sEe(e);case 220:return e=Ii.getUint16(Et),Et+=2,lj(e);case 221:return e=Ii.getUint32(Et),Et+=4,lj(e);case 222:return e=Ii.getUint16(Et),Et+=2,uj(e);case 223:return e=Ii.getUint32(Et),Et+=4,uj(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const nEe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function H5(t,e){function n(){if(n.count++>gK){let i=t.read=new Function("r","return function(){return "+(ro.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":nEe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(ka);return t.highByte===0&&(t.read=cj(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=ka()}return ro.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?cj(e,n):n}const cj=(t,e)=>function(){let n=Wn[Et++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Ui[r]||_K()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=H5(i,t)),i.read()};function _K(){let t=EK(()=>(Wn=null,ro.getStructures()));return Ui=ro._mergeStructures(t,Ui)}var CL=KA,rEe=KA,iEe=KA,sEe=KA;function KA(t){let e;if(t<16&&(e=$5(t)))return e;if(t>64&&AL)return AL.decode(Wn.subarray(Et,Et+=t));const n=Et+t,r=[];for(e="";Et<n;){const i=Wn[Et++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=Wn[Et++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=Wn[Et++]&63,o=Wn[Et++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Wn[Et++]&63,o=Wn[Et++]&63,a=Wn[Et++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Rc.apply(String,r),r.length=0)}return r.length>0&&(e+=Rc.apply(String,r)),e}function lj(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=ka();return ro.freezeData?Object.freeze(e):e}function uj(t){if(ro.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=yK();r==="__proto__"&&(r="__proto_"),e[r]=ka()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(ka(),ka());return e}}var Rc=String.fromCharCode;function vK(t){let e=Et,n=new Array(t);for(let r=0;r<t;r++){const i=Wn[Et++];if((i&128)>0){Et=e;return}n[r]=i}return Rc.apply(String,n)}function $5(t){if(t<4)if(t<2){if(t===0)return"";{let e=Wn[Et++];if((e&128)>1){Et-=1;return}return Rc(e)}}else{let e=Wn[Et++],n=Wn[Et++];if((e&128)>0||(n&128)>0){Et-=2;return}if(t<3)return Rc(e,n);let r=Wn[Et++];if((r&128)>0){Et-=3;return}return Rc(e,n,r)}else{let e=Wn[Et++],n=Wn[Et++],r=Wn[Et++],i=Wn[Et++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){Et-=4;return}if(t<6){if(t===4)return Rc(e,n,r,i);{let s=Wn[Et++];if((s&128)>0){Et-=5;return}return Rc(e,n,r,i,s)}}else if(t<8){let s=Wn[Et++],o=Wn[Et++];if((s&128)>0||(o&128)>0){Et-=6;return}if(t<7)return Rc(e,n,r,i,s,o);let a=Wn[Et++];if((a&128)>0){Et-=7;return}return Rc(e,n,r,i,s,o,a)}else{let s=Wn[Et++],o=Wn[Et++],a=Wn[Et++],c=Wn[Et++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){Et-=8;return}if(t<10){if(t===8)return Rc(e,n,r,i,s,o,a,c);{let l=Wn[Et++];if((l&128)>0){Et-=9;return}return Rc(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=Wn[Et++],u=Wn[Et++];if((l&128)>0||(u&128)>0){Et-=10;return}if(t<11)return Rc(e,n,r,i,s,o,a,c,l,u);let h=Wn[Et++];if((h&128)>0){Et-=11;return}return Rc(e,n,r,i,s,o,a,c,l,u,h)}else{let l=Wn[Et++],u=Wn[Et++],h=Wn[Et++],f=Wn[Et++];if((l&128)>0||(u&128)>0||(h&128)>0||(f&128)>0){Et-=12;return}if(t<14){if(t===12)return Rc(e,n,r,i,s,o,a,c,l,u,h,f);{let d=Wn[Et++];if((d&128)>0){Et-=13;return}return Rc(e,n,r,i,s,o,a,c,l,u,h,f,d)}}else{let d=Wn[Et++],p=Wn[Et++];if((d&128)>0||(p&128)>0){Et-=14;return}if(t<15)return Rc(e,n,r,i,s,o,a,c,l,u,h,f,d,p);let m=Wn[Et++];if((m&128)>0){Et-=15;return}return Rc(e,n,r,i,s,o,a,c,l,u,h,f,d,p,m)}}}}}function hj(){let t=Wn[Et++],e;if(t<192)e=t-160;else switch(t){case 217:e=Wn[Et++];break;case 218:e=Ii.getUint16(Et),Et+=2;break;case 219:e=Ii.getUint32(Et),Et+=4;break;default:throw new Error("Expected string")}return KA(e)}function tN(t){return ro.copyBuffers?Uint8Array.prototype.slice.call(Wn,Et,Et+=t):Wn.subarray(Et,Et+=t)}function Ty(t){let e=Wn[Et++];if(Sh[e]){let n;return Sh[e](Wn.subarray(Et,n=Et+=t),r=>{Et=r;try{return ka()}finally{Et=n}})}else throw new Error("Unknown extension type "+e)}var fj=new Array(4096);function yK(){let t=Wn[Et++];if(t>=160&&t<192){if(t=t-160,Em>=Et)return rv.slice(Et-Vf,(Et+=t)-Vf);if(!(Em==0&&Om<180))return CL(t)}else return Et--,bK(ka());let e=(t<<5^(t>1?Ii.getUint16(Et):t>0?Wn[Et]:0))&4095,n=fj[e],r=Et,i=Et+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Ii.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=Wn[r++],s!=n[o++]){r=1879048192;break}if(r===i)return Et=r,n.string;i-=3,r=Et}for(n=[],fj[e]=n,n.bytes=t;r<i;)s=Ii.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=Wn[r++],n.push(s);let a=t<16?$5(t):vK(t);return a!=null?n.string=a:n.string=CL(t)}function bK(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";if(ro.allowArraysInMapKeys&&Array.isArray(t)&&t.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return t.flat().toString();throw new Error(`Invalid property type for record: ${typeof t}`)}const dj=(t,e)=>{let n=ka().map(bK),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Ui[t];return i&&(i.isShared||av)&&((Ui.restoreStructures||(Ui.restoreStructures=[]))[t]=i),Ui[t]=n,n.read=H5(n,r),n.read()};Sh[0]=()=>{};Sh[0].noBuffer=!0;Sh[66]=t=>{let e=t.byteLength%8||8,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);if(t.byteLength!==e){let r=new DataView(t.buffer,t.byteOffset,t.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=r.getBigUint64(s);for(let f=s+8;f<o;f+=8)h<<=64n,h|=r.getBigUint64(f);return h}let c=s+(a>>4<<3),l=i(s,c),u=i(c,o);return l<<BigInt((o-c)*8)|u};n=n<<BigInt((r.byteLength-e)*8)|i(e,r.byteLength)}return n};let pj={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};Sh[101]=()=>{let t=ka();if(!pj[t[0]]){let e=Error(t[1],{cause:t[2]});return e.name=t[0],e}return pj[t[0]](t[1],{cause:t[2]})};Sh[105]=t=>{if(ro.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Ii.getUint32(Et-4);Sg||(Sg=new Map);let n=Wn[Et],r;n>=144&&n<160||n==220||n==221?r=[]:n>=128&&n<144||n==222||n==223?r=new Map:(n>=199&&n<=201||n>=212&&n<=216)&&Wn[Et+1]===115?r=new Set:r={};let i={target:r};Sg.set(e,i);let s=ka();if(i.used)Object.assign(r,s);else return i.target=s;if(r instanceof Map)for(let[o,a]of s.entries())r.set(o,a);if(r instanceof Set)for(let o of Array.from(s))r.add(o);return r};Sh[112]=t=>{if(ro.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Ii.getUint32(Et-4),n=Sg.get(e);return n.used=!0,n.target};Sh[115]=()=>new Set(ka());const SK=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let oEe=typeof globalThis=="object"?globalThis:window;Sh[116]=t=>{let e=t[0],n=Uint8Array.prototype.slice.call(t,1).buffer,r=SK[e];if(!r){if(e===16)return n;if(e===17)return new DataView(n);throw new Error("Could not find typed array for code "+e)}return new oEe[r](n)};Sh[120]=()=>{let t=ka();return new RegExp(t[0],t[1])};const aEe=[];Sh[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=Et;return Et+=e-t.length,Mc=aEe,Mc=[hj(),hj()],Mc.position0=0,Mc.position1=0,Mc.postBundlePosition=Et,Et=n,ka()};Sh[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function EK(t){let e=Om,n=Et,r=Vf,i=Em,s=rv,o=Sg,a=Mc,c=new Uint8Array(Wn.slice(0,Om)),l=Ui,u=Ui.slice(0,Ui.length),h=ro,f=av,d=t();return Om=e,Et=n,Vf=r,Em=i,rv=s,Sg=o,Mc=a,Wn=c,av=f,Ui=l,Ui.splice(0,Ui.length,...u),ro=h,Ii=new DataView(Wn.buffer,Wn.byteOffset,Wn.byteLength),d}function RL(){Wn=null,Sg=null,Ui=null}const G5=new Array(147);for(let t=0;t<256;t++)G5[t]=+("1e"+Math.floor(45.15-t*.30103));var WO=new sA({useRecords:!1});WO.unpack;WO.unpackMultiple;WO.unpack;let cEe=new Float32Array(1);new Uint8Array(cEe.buffer,0,4);let bk;try{bk=new TextEncoder}catch{}let kL,ML;const kE=typeof js<"u",_R=kE?function(t){return js.allocUnsafeSlow(t)}:Uint8Array,xK=kE?js:Uint8Array,mj=kE?4294967296:2144337920;let jt,ew,Ks,At=0,Tl,Vo=null,lEe;const uEe=21760,hEe=/[\u0080-\uFFFF]/,xS=Symbol("record-id");class fEe extends sA{constructor(e){super(e),this.offset=0;let n,r,i,s,o=xK.prototype.utf8Write?function(D,O){return jt.utf8Write(D,O,jt.byteLength-O)}:bk&&bk.encodeInto?function(D,O){return bk.encodeInto(D,jt.subarray(O)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let f=u>32||h+u>64,d=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],g=0,_=0;this.pack=this.encode=function(D,O){if(jt||(jt=new _R(8192),Ks=jt.dataView||(jt.dataView=new DataView(jt.buffer,0,8192)),At=0),Tl=jt.length-10,Tl-At<2048?(jt=new _R(jt.length),Ks=jt.dataView||(jt.dataView=new DataView(jt.buffer,0,jt.length)),Tl=jt.length-10,At=0):At=At+7&2147483640,n=At,O&_Ee&&(At+=O&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof D!="string"?(Vo=[],Vo.size=1/0):Vo=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let q=i.sharedLength||0;if(q>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let G=0;G<q;G++){let K=i[G];if(!K)continue;let te,re=i.transitions;for(let H=0,Y=K.length;H<Y;H++){let Z=K[H];te=re[Z],te||(te=re[Z]=Object.create(null)),re=te}re[xS]=G+64}this.lastNamedStructuresLength=q}c||(i.nextId=q+64)}r&&(r=!1);let z;try{a.randomAccessStructure&&D&&typeof D=="object"?D.constructor===Object?M(D):D.constructor!==Map&&!Array.isArray(D)&&!ML.some(G=>D instanceof G)?M(D.toJSON?D.toJSON():D):E(D):E(D);let q=Vo;if(Vo&&_j(n,E,0),s&&s.idsToInsert){let G=s.idsToInsert.sort((H,Y)=>H.offset>Y.offset?1:-1),K=G.length,te=-1;for(;q&&K>0;){let H=G[--K].offset+n;H<q.stringsPosition+n&&te===-1&&(te=0),H>q.position+n?te>=0&&(te+=6):(te>=0&&(Ks.setUint32(q.position+n,Ks.getUint32(q.position+n)+te),te=-1),q=q.previous,K++)}te>=0&&q&&Ks.setUint32(q.position+n,Ks.getUint32(q.position+n)+te),At+=G.length*6,At>Tl&&L(At),a.offset=At;let re=dEe(jt.subarray(n,At),G);return s=null,re}return a.offset=At,O&mEe?(jt.start=n,jt.end=At,jt):jt.subarray(n,At)}catch(q){throw z=q,q}finally{if(i&&(y(),r&&a.saveStructures)){let q=i.sharedLength||0,G=jt.subarray(n,At),K=pEe(i,a);if(!z)return a.saveStructures(K,K.isCompatible)===!1?a.pack(D,O):(a.lastNamedStructuresLength=q,jt.length>1073741824&&(jt=null),G)}jt.length>1073741824&&(jt=null),O&gEe&&(At=n)}};const y=()=>{_<10&&_++;let D=i.sharedLength||0;if(i.length>D&&!c&&(i.length=D),g>1e4)i.transitions=null,_=0,g=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let O=0,z=m.length;O<z;O++)m[O][xS]=0;m=[]}},v=D=>{var O=D.length;O<16?jt[At++]=144|O:O<65536?(jt[At++]=220,jt[At++]=O>>8,jt[At++]=O&255):(jt[At++]=221,Ks.setUint32(At,O),At+=4);for(let z=0;z<O;z++)E(D[z])},E=D=>{At>Tl&&(jt=L(At));var O=typeof D,z;if(O==="string"){let q=D.length;if(Vo&&q>=4&&q<4096){if((Vo.size+=q)>uEe){let re,H=(Vo[0]?Vo[0].length*3+Vo[1].length:0)+10;At+H>Tl&&(jt=L(At+H));let Y;Vo.position?(Y=Vo,jt[At]=200,At+=3,jt[At++]=98,re=At-n,At+=4,_j(n,E,0),Ks.setUint16(re+n-3,At-n-re)):(jt[At++]=214,jt[At++]=98,re=At-n,At+=4),Vo=["",""],Vo.previous=Y,Vo.size=0,Vo.position=re}let te=hEe.test(D);Vo[te?0:1]+=D,jt[At++]=193,E(te?-q:q);return}let G;q<32?G=1:q<256?G=2:q<65536?G=3:G=5;let K=q*3;if(At+K>Tl&&(jt=L(At+K)),q<64||!o){let te,re,H,Y=At+G;for(te=0;te<q;te++)re=D.charCodeAt(te),re<128?jt[Y++]=re:re<2048?(jt[Y++]=re>>6|192,jt[Y++]=re&63|128):(re&64512)===55296&&((H=D.charCodeAt(te+1))&64512)===56320?(re=65536+((re&1023)<<10)+(H&1023),te++,jt[Y++]=re>>18|240,jt[Y++]=re>>12&63|128,jt[Y++]=re>>6&63|128,jt[Y++]=re&63|128):(jt[Y++]=re>>12|224,jt[Y++]=re>>6&63|128,jt[Y++]=re&63|128);z=Y-At-G}else z=o(D,At+G);z<32?jt[At++]=160|z:z<256?(G<2&&jt.copyWithin(At+2,At+1,At+1+z),jt[At++]=217,jt[At++]=z):z<65536?(G<3&&jt.copyWithin(At+3,At+2,At+2+z),jt[At++]=218,jt[At++]=z>>8,jt[At++]=z&255):(G<5&&jt.copyWithin(At+5,At+3,At+3+z),jt[At++]=219,Ks.setUint32(At,z),At+=4),At+=z}else if(O==="number")if(D>>>0===D)D<32||D<128&&this.useRecords===!1||D<64&&!this.randomAccessStructure?jt[At++]=D:D<256?(jt[At++]=204,jt[At++]=D):D<65536?(jt[At++]=205,jt[At++]=D>>8,jt[At++]=D&255):(jt[At++]=206,Ks.setUint32(At,D),At+=4);else if(D>>0===D)D>=-32?jt[At++]=256+D:D>=-128?(jt[At++]=208,jt[At++]=D+256):D>=-32768?(jt[At++]=209,Ks.setInt16(At,D),At+=2):(jt[At++]=210,Ks.setInt32(At,D),At+=4);else{let q;if((q=this.useFloat32)>0&&D<4294967296&&D>=-2147483648){jt[At++]=202,Ks.setFloat32(At,D);let G;if(q<4||(G=D*G5[(jt[At]&127)<<1|jt[At+1]>>7])>>0===G){At+=4;return}else At--}jt[At++]=203,Ks.setFloat64(At,D),At+=8}else if(O==="object"||O==="function")if(!D)jt[At++]=192;else{if(s){let G=s.get(D);if(G){if(!G.id){let K=s.idsToInsert||(s.idsToInsert=[]);G.id=K.push(G)}jt[At++]=214,jt[At++]=112,Ks.setUint32(At,G.id),At+=4;return}else s.set(D,{offset:At-n})}let q=D.constructor;if(q===Object)k(D);else if(q===Array)v(D);else if(q===Map)if(this.mapAsEmptyObject)jt[At++]=128;else{z=D.size,z<16?jt[At++]=128|z:z<65536?(jt[At++]=222,jt[At++]=z>>8,jt[At++]=z&255):(jt[At++]=223,Ks.setUint32(At,z),At+=4);for(let[G,K]of D)E(G),E(K)}else{for(let G=0,K=kL.length;G<K;G++){let te=ML[G];if(D instanceof te){let re=kL[G];if(re.write){re.type&&(jt[At++]=212,jt[At++]=re.type,jt[At++]=0);let ie=re.write.call(this,D);ie===D?Array.isArray(D)?v(D):k(D):E(ie);return}let H=jt,Y=Ks,Z=At;jt=null;let Q;try{Q=re.pack.call(this,D,ie=>(jt=H,H=null,At+=ie,At>Tl&&L(At),{target:jt,targetView:Ks,position:At-ie}),E)}finally{H&&(jt=H,Ks=Y,At=Z,Tl=jt.length-10)}Q&&(Q.length+At>Tl&&L(Q.length+At),At=gj(Q,jt,At,re.type));return}}if(Array.isArray(D))v(D);else{if(D.toJSON){const G=D.toJSON();if(G!==D)return E(G)}if(O==="function")return E(this.writeFunction&&this.writeFunction(D));k(D)}}}else if(O==="boolean")jt[At++]=D?195:194;else if(O==="bigint"){if(D<9223372036854776e3&&D>=-9223372036854776e3)jt[At++]=211,Ks.setBigInt64(At,D);else if(D<18446744073709552e3&&D>0)jt[At++]=207,Ks.setBigUint64(At,D);else if(this.largeBigIntToFloat)jt[At++]=203,Ks.setFloat64(At,Number(D));else{if(this.largeBigIntToString)return E(D.toString());if(this.useBigIntExtension||this.moreTypes){let q=D<0?BigInt(-1):BigInt(0),G;if(D>>BigInt(65536)===q){let K=BigInt(18446744073709552e3)-BigInt(1),te=[];for(;te.push(D&K),D>>BigInt(63)!==q;)D>>=BigInt(64);G=new Uint8Array(new BigUint64Array(te).buffer),G.reverse()}else{let K=D<0,te=(K?~D:D).toString(16);if(te.length%2?te="0"+te:parseInt(te.charAt(0),16)>=8&&(te="00"+te),kE)G=js.from(te,"hex");else{G=new Uint8Array(te.length/2);for(let re=0;re<G.length;re++)G[re]=parseInt(te.slice(re*2,re*2+2),16)}if(K)for(let re=0;re<G.length;re++)G[re]=~G[re]}G.length+At>Tl&&L(G.length+At),At=gj(G,jt,At,66);return}else throw new RangeError(D+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}At+=8}else if(O==="undefined")this.encodeUndefinedAsNil?jt[At++]=192:(jt[At++]=212,jt[At++]=0,jt[At++]=0);else throw new Error("Unknown type: "+O)},x=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?D=>{let O;if(this.skipValues){O=[];for(let G in D)(typeof D.hasOwnProperty!="function"||D.hasOwnProperty(G))&&!this.skipValues.includes(D[G])&&O.push(G)}else O=Object.keys(D);let z=O.length;z<16?jt[At++]=128|z:z<65536?(jt[At++]=222,jt[At++]=z>>8,jt[At++]=z&255):(jt[At++]=223,Ks.setUint32(At,z),At+=4);let q;if(this.coercibleKeyAsNumber)for(let G=0;G<z;G++){q=O[G];let K=Number(q);E(isNaN(K)?q:K),E(D[q])}else for(let G=0;G<z;G++)E(q=O[G]),E(D[q])}:D=>{jt[At++]=222;let O=At-n;At+=2;let z=0;for(let q in D)(typeof D.hasOwnProperty!="function"||D.hasOwnProperty(q))&&(E(q),E(D[q]),z++);if(z>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');jt[O+++n]=z>>8,jt[O+n]=z&255},A=this.useRecords===!1?x:e.progressiveRecords&&!f?D=>{let O,z=i.transitions||(i.transitions=Object.create(null)),q=At++-n,G;for(let K in D)if(typeof D.hasOwnProperty!="function"||D.hasOwnProperty(K)){if(O=z[K],O)z=O;else{let te=Object.keys(D),re=z;z=i.transitions;let H=0;for(let Y=0,Z=te.length;Y<Z;Y++){let Q=te[Y];O=z[Q],O||(O=z[Q]=Object.create(null),H++),z=O}q+n+1==At?(At--,I(z,te,H)):F(z,te,q,H),G=!0,z=re[K]}E(D[K])}if(!G){let K=z[xS];K?jt[q+n]=K:F(z,Object.keys(D),q,0)}}:D=>{let O,z=i.transitions||(i.transitions=Object.create(null)),q=0;for(let K in D)(typeof D.hasOwnProperty!="function"||D.hasOwnProperty(K))&&(O=z[K],O||(O=z[K]=Object.create(null),q++),z=O);let G=z[xS];G?G>=96&&f?(jt[At++]=((G-=96)&31)+96,jt[At++]=G>>5):jt[At++]=G:I(z,z.__keys__||Object.keys(D),q);for(let K in D)(typeof D.hasOwnProperty!="function"||D.hasOwnProperty(K))&&E(D[K])},T=typeof this.useRecords=="function"&&this.useRecords,k=T?D=>{T(D)?A(D):x(D)}:A,L=D=>{let O;if(D>16777216){if(D-n>mj)throw new Error("Packed buffer would be larger than maximum buffer size");O=Math.min(mj,Math.round(Math.max((D-n)*(D>67108864?1.25:2),4194304)/4096)*4096)}else O=(Math.max(D-n<<2,jt.length-1)>>12)+1<<12;let z=new _R(O);return Ks=z.dataView||(z.dataView=new DataView(z.buffer,0,O)),D=Math.min(D,jt.length),jt.copy?jt.copy(z,0,n,D):z.set(jt.slice(n,D)),At-=n,n=0,Tl=z.length-10,jt=z},I=(D,O,z)=>{let q=i.nextId;q||(q=64),q<d&&this.shouldShareStructure&&!this.shouldShareStructure(O)?(q=i.nextOwnId,q<p||(q=d),i.nextOwnId=q+1):(q>=p&&(q=d),i.nextId=q+1);let G=O.highByte=q>=96&&f?q-96>>5:-1;D[xS]=q,D.__keys__=O,i[q-64]=O,q<d?(O.isShared=!0,i.sharedLength=q-63,r=!0,G>=0?(jt[At++]=(q&31)+96,jt[At++]=G):jt[At++]=q):(G>=0?(jt[At++]=213,jt[At++]=114,jt[At++]=(q&31)+96,jt[At++]=G):(jt[At++]=212,jt[At++]=114,jt[At++]=q),z&&(g+=_*z),m.length>=h&&(m.shift()[xS]=0),m.push(D),E(O))},F=(D,O,z,q)=>{let G=jt,K=At,te=Tl,re=n;jt=ew,At=0,n=0,jt||(ew=jt=new _R(8192)),Tl=jt.length-10,I(D,O,q),ew=jt;let H=At;if(jt=G,At=K,Tl=te,n=re,H>1){let Y=At+H-1;Y>Tl&&L(Y);let Z=z+n;jt.copyWithin(Z+H,Z+1,At),jt.set(ew.slice(0,H),Z),At=Y}else jt[z+n]=ew[0]},M=D=>{let O=lEe(D,jt,n,At,i,L,(z,q,G)=>{if(G)return r=!0;At=q;let K=jt;return E(z),y(),K!==jt?{position:At,targetView:Ks,target:jt}:At},this);if(O===0)return k(D);At=O}}useBuffer(e){jt=e,jt.dataView||(jt.dataView=new DataView(jt.buffer,jt.byteOffset,jt.byteLength)),Ks=jt.dataView,At=0}set position(e){At=e}get position(){return At}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ML=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,pK];kL=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?nN(t,16,e):rN(kE?js.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==xK&&this.moreTypes?nN(t,SK.indexOf(n.name),e):rN(t,e)}},{pack(t,e){this.moreTypes?nN(t,17,e):rN(kE?js.from(t):new Uint8Array(t),e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function nN(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function rN(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function gj(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function dEe(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function _j(t,e,n){if(Vo.length>0){Ks.setUint32(Vo.position+t,At+n-Vo.position-t),Vo.stringsPosition=At-t;let r=Vo;Vo=null,e(r[0]),e(r[1])}}function pEe(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let wK=new fEe({useRecords:!1});wK.pack;wK.pack;const mEe=512,gEe=1024,_Ee=2048;function vEe(t){return typeof t=="object"&&dn(t.session)&&dn(t.player)&&dn(t.id)&&dn(t.sender)&&dn(t.target)}function yEe(t){t.emit("","sessionreset")}function _r(t,e,n,...r){return t.emit(e,"log",[`$red${n}$blue>>`,...r]),!1}function us(t,e,...n){return t.emit(e,"log",n),!0}function OL(t,e,...n){return t.emit(e,"chat",n),!0}function TK(t,e,n){t.emit(e,"toast",n)}function bEe(t,e,n){t.emit(e,"bridge:streamstart",n)}function SEe(t,e){t.emit(e,"bridge:streamstop",void 0)}function EEe(t,e,n){t.emit(e,"bridge:chatstart",n)}function xEe(t,e){t.emit(e,"bridge:chatstop")}function wEe(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function TEe(t,e,n){t.emit(e,"bridge:join",n)}function AEe(t,e,n){t.emit(e,"bridge:start",n)}function CEe(t,e,n){t.emit(e,"bridge:tab",n)}function REe(t,e){t.emit(e,"bridge:tabopen")}function kEe(t,e,n){t.emit(e,"bridge:showjoincode",n)}function MEe(t,e){t.emit(e,"gadgetserver:desync")}function OEe(t,e){t.emit(e,"gadgetserver:clearscroll")}function IEe(t,e,n,r){t.emit(e,"heavy:ttsinfo",[n,r])}function NEe(t,e,n,r,i,s){t.emit(e,"heavy:ttsrequest",[n,r,i,s])}function nm(t,e,n,r){t.emit(e,"register:input",[n,r])}function ME(t,e,n){t.emit(e,"register:copy",n)}function PEe(t,e){t.emit(e,"register:screenshot")}function vj(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function DEe(t,e){t.emit(e,"register:share",void 0)}function LEe(t,e){t.emit(e,"register:nuke",void 0)}function UEe(t,e){t.emit(e,"synth:audioenabled")}function AK(t,e,n,r){t.emit(e,"synth:audiobuffer",[n,r])}function yj(t,e,n,r){t.emit(e,"synth:play",[n,r])}function BEe(t,e,n,r,i){t.emit(e,"synth:bgplay",[n,r,i])}function FEe(t,e,n,r){t.emit(e,"synth:bpm",[n,r])}function jEe(t,e,n,r){t.emit(e,"synth:playvolume",[n,r])}function zEe(t,e,n,r){t.emit(e,"synth:bgplayvolume",[n,r])}function VEe(t,e,n,r){t.emit(e,"synth:ttsvolume",[n,r])}function HEe(t,e,n,r,i){t.emit(e,"synth:ttsengine",[n,r,i])}function $Ee(t,e,n,r,i){t.emit(e,"synth:tts",[n,r,i])}function GEe(t,e,n,r){t.emit(e,"synth:ttsinfo",[n,r])}function WEe(t,e,n,r,i){t.emit(e,"synth:ttsqueue",[n,r,i])}function qEe(t,e,n){t.emit(e,"synth:ttsclearqueue",[n])}function iN(t,e,n,r,i,s){t.emit(e,"synth:voice",[n,r,i,s])}function CK(t,e,n,r,i,s,o){t.emit(e,"synth:voicefx",[n,r,i,s,o])}function YEe(t,e,n){t.emit(e,"synth:record",n)}function KEe(t,e){t.emit(e,"synth:flush")}function XEe(t,e,n,r){t.emit(e,"synth:update",[n,r])}function JEe(t,e,n,r){t.emit(e,"register:store",[n,r])}function ZEe(t,e,n){t.emit(e,"register:inspector",n)}function bj(t,e,n){t.emit(e,"register:findany",n)}function N1(t,e,n){t.emit(e,"register:terminal:open",n)}function W5(t,e,n){t.emit(e,"register:terminal:quickopen",n)}function UT(t,e){t.emit(e,"register:terminal:close")}function RK(t,e,n){t.emit(e,"register:terminal:inclayout",n)}function q5(t,e){t.emit(e,"register:terminal:full")}function QEe(t,e,n,r,i,s){t.emit(e,"register:editor:open",[n,r,i,s])}function exe(t,e){t.emit(e,"register:editor:close")}function txe(t,e){t.emit(e,"vm:operator")}function nxe(t,e){t.emit(e,"vm:admin")}function rxe(t,e,n,r){t.emit(e,"vm:zztsearch",[n,r])}function ixe(t,e){t.emit(e,"vm:zztrandom")}function kK(t,e){t.emit(e,"vm:zsswords")}function sxe(t,e){t.emit(e,"vm:halt")}function oxe(t,e,n){t.emit(e,"vm:topic",n)}function MK(t,e,n){t.emit(e,"vm:books",n)}function axe(t,e){t.emit(e,"vm:search")}function cxe(t,e,n){t.emit(e,"vm:login",n)}function lxe(t,e){t.emit(e,"vm:local")}function OK(t,e,n){t.emit(e,"vm:logout",n)}function IK(t,e){t.emit(e,"vm:doot")}function NK(t,e,n,r){t.emit(e,"vm:input",[n,r])}function uxe(t,e){t.emit(e,"vm:agentstart")}function hxe(t,e,n){t.emit(e,"vm:agentstop",n)}function fxe(t,e){t.emit(e,"vm:agentlist")}function dxe(t,e,n,r){t.emit(e,"vm:agentprompt",[n,r])}function pxe(t,e,n){t.emit(e,"vm:makeitscroll",n)}function Y5(t,e){t.emit(e,"vm:refscroll")}function mxe(t,e,n,r){t.emit(e,"vm:inspect",[n,r])}function gxe(t,e){t.emit(e,"vm:findany")}function PK(t,e){const[n,r]=e;return`${t}:${[n,r].filter(fe).join(":")}`}function _xe(t,e,n,r){t.emit(e,"vm:codewatch",[n,r])}function vxe(t,e,n,r){t.emit(e,"vm:coderelease",[n,r])}function Am(t,e,n){t.emit(e,"vm:cli",n)}function K5(t,e){t.emit(e,"vm:clirepeatlast")}function yxe(t,e){t.emit(e,"vm:restart")}function bxe(t,e){t.emit(e,"vm:flush")}function Sxe(t,e,n){t.emit(e,"vm:fork",n)}function Sj(t,e,n,...r){t.emit(e,"vm:publish",[n,...r])}function Exe(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function xxe(t,e){return{filename:t,json:e}}function wxe(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function dh(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=Exe(i,s);break;case"json":o=xxe(i,s);break;case"binary":o=wxe(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}const sN=new Set,BT={emit(t,e,n,r,i){BT.invoke(zxe(t,e,n,r,i))},invoke(t){sN.forEach(e=>e.handle(t))},connect(t){sN.add(t)},disconnect(t){sN.delete(t)}};var tw={},Ej;function Txe(){return Ej||(Ej=1,(function(t){var e=tw&&tw.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var f=0,d=u.length,p;f<d;f++)(p||!(f in u))&&(p||(p=Array.prototype.slice.call(u,0,f)),p[f]=u[f]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","beige","better","big","blue","bold","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","common","cool","cozy","crisp","cuddly","curly","curvy","cute","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","fair","famous","fancy","fast","few","fiery","fifty","fine","five","flat","floppy","fluffy","forty","four","frank","free","fresh","fruity","full","funky","funny","fuzzy","gentle","giant","gold","good","goofy","great","green","grumpy","happy","heavy","hip","honest","hot","huge","humble","hungry","icy","itchy","jolly","khaki","kind","large","late","lazy","legal","lemon","light","little","long","loose","loud","lovely","lucky","major","many","metal","mighty","modern","moody","neat","new","nice","nine","ninety","odd","old","olive","open","orange","perky","petite","pink","plain","plenty","polite","pretty","proud","public","puny","purple","quick","quiet","rare","ready","real","red","rich","ripe","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","sparkly","spicy","spotty","stale","strict","strong","sunny","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","wacky","warm","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["actors","ads","adults","aliens","animals","ants","apes","apples","areas","baboons","badgers","bags","balloons","bananas","banks","bars","baths","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","breads","brooms","buckets","bugs","buses","bushes","buttons","camels","cameras","candies","candles","canyons","carpets","carrots","cars","cases","cats","chairs","chefs","chicken","cities","clocks","cloths","clouds","clowns","clubs","coats","cobras","coins","colts","comics","cooks","corners","cougars","cows","crabs","crews","cups","cycles","dancers","days","deer","deserts","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","eagles","ears","eels","eggs","emus","ends","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hoops","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lilies","lines","lions","lizards","llamas","loops","mails","mammals","mangos","maps","masks","meals","melons","memes","meteors","mice","mirrors","moles","moments","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","papers","parents","parks","parrots","parts","paths","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","regions","results","rice","rings","rivers","rockets","rocks","rooms","roses","rules","sails","schools","seals","seas","sheep","shirts","shoes","showers","shrimps","sides","signs","singers","sites","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stamps","stars","states","steaks","streets","suits","suns","swans","symbols","tables","taxes","taxis","teams","teeth","terms","things","ties","tigers","times","tips","tires","toes","tools","towns","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","wasps","waves","ways","webs","weeks","windows","wings","wolves","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enjoy","enter","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","lie","like","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","pick","play","poke","post","press","prove","pull","pump","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","search","see","sell","send","serve","shake","share","shave","shine","shop","shout","show","sin","sing","sink","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","stare","start","stay","stick","stop","strive","study","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowingly","lazily","noisily","oddly","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,f=l.capitalize,d=f===void 0?!0:f,p=l.adjectiveCount,m=p===void 0?1:p,g=l.addAdverb,_=g===void 0?!1:g,y=e(e(e([],e([],Array(m),!0).map(function(v){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),_?[n(t.adverbs)]:[],!0);return d&&(y=y.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),y.join(h)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(d?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*h+h*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(d?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*h+h*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(d?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(tw)),tw}var Axe=Txe();const X5=_u(Axe),Cxe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Rxe=t=>crypto.getRandomValues(new Uint8Array(t)),kxe=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i|0;for(;c--;)if(o+=t[a[c]&r]||"",o.length>=s)return o}}},DK=(t,e=21)=>kxe(t,e|0,Rxe),Mxe=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=Cxe[n[t]&63];return e};var oN,xj;function LK(){return xj||(xj=1,oN="abcdefghijklmnopqrstuvwxyz"),oN}var aN,wj;function UK(){return wj||(wj=1,aN="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),aN}var cN,Tj;function BK(){return Tj||(Tj=1,cN="0123456789"),cN}var lN,Aj;function Oxe(){return Aj||(Aj=1,lN="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz"),lN}var uN,Cj;function Ixe(){return Cj||(Cj=1,uN="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz"),uN}var hN,Rj;function Nxe(){if(Rj)return hN;Rj=1;const t=BK(),e=LK(),n=UK();return hN=t+e+n,hN}var fN,kj;function Pxe(){return kj||(kj=1,fN={lowercase:LK(),uppercase:UK(),numbers:BK(),nolookalikes:Oxe(),nolookalikesSafe:Ixe(),alphanumeric:Nxe()}),fN}var IL=Pxe();function Go(){return`sid_${Mxe(12).replaceAll("-",".")}`}const Dxe=DK(IL.numbers,4),Lxe=DK(`${IL.numbers}${IL.lowercase}`,16);function Uxe(){return`pid_${Dxe()}_${Lxe()}`}function Nl(t){return t?.startsWith("pid_")??!1}function J5(){return X5({capitalize:!1,adjectiveCount:1})}function Bxe(){return X5({addAdverb:!1,capitalize:!1,adjectiveCount:0})}const Fxe=20,Mj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function jxe(t){const e=j5(t),n=[];for(let r=0;r<Fxe;++r)n.push(Mj[Math.floor(e()*Mj.length)]);return n.join("")}function zxe(t,e,n,r,i){return{session:t,player:e,id:Go(),sender:n,target:r,data:i}}function _v(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function Ym(t,e=[],n=c5,r=""){const i=Go(),s=rr(t),o=e.map(rr);let a=r;const c={id(){return i},name(){return t},session(l){return fe(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,h){BT.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=_v(l.target),f=rr(u);!a&&f==="ready"&&(a=l.session),f==="sessionreset"&&(a=""),o.findIndex(d=>d==="all"||d===f)!==-1&&n(l),(i===u||f==="all"||s===f)&&n({...l,target:h})},disconnect(){BT.disconnect(c)}};return BT.connect(c),c}const qe=Ym("SOFTWARE");function Z5(t,e,n={}){if(fe(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];fe(a)&&(s=a);const c=n[s];fe(c)&&(o=c(o)),r[s]=o}return r}catch(r){_r(qe,"","format",r.message)}}function Vxe(t,e){return t%e}function Hxe(t,e){return Math.floor(t/e)}function vM(t,e){return{x:Vxe(t,e),y:Hxe(t,e)}}function Oj(t,e){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function Yf(t,e){return t.x+t.y*e}function $xe(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function Ij(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}function cv(t){return fe(t)&&fe(t.x)&&fe(t.y)}function zo(t,e){switch(e){case yn.NORTH:--t.y;break;case yn.SOUTH:++t.y;break;case yn.WEST:--t.x;break;case yn.EAST:++t.x;break}return t}function l1(t,e){return t<0?yn.WEST:t>0?yn.EAST:e<0?yn.NORTH:e>0?yn.SOUTH:yn.IDLE}function Xd(t,e){return l1(e.x-t.x,e.y-t.y)}const FK={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER",ground:"GROUND",within:"WITHIN",awayby:"AWAYBY",elements:"ELEMENTS"};function sd(t){return Kn(t)&&jK(t[0])}function jK(t){return fe(yn[t])&&dn(t)}function zK(t){const e=yn[t];return fe(e)?e:yn.IDLE}function XA(t){if(dn(t))return FK[rr(t)]}function Gxe(t){if(sd(t))return t;if(jK(t))return[t];const e=XA(t);if(fe(e))return[e]}function Nj(t){const e=he.words[t],n=Gxe(e);return sd(n)?[n,t+1]:[void 0,t]}function VK(t){const e=[];let[n,r]=Nj(t);for(;sd(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[a,c,l]=Dt(he.words,r,[ut.NUMBER,ut.NUMBER]);e.push(a,c),r=l;break}case"FLEE":case"FIND":{const[a,c]=Dt(he.words,r,[ut.KIND]);console.info("kind",a),r=c;break}case"TO":{const[a,c,l]=Dt(he.words,r,[ut.DIR,ut.DIR]),u=he.element?.x??0,h=he.element?.y??0;a.destpt.x-=u,a.destpt.y-=h,c.destpt.x-=u,c.destpt.y-=h,e.push(u+a.destpt.x+c.destpt.x,h+a.destpt.y+c.destpt.y),r=l;break}case"WITHIN":case"AWAYBY":{const[a,c]=Dt(he.words,r,[ut.NUMBER]);e.push(a),r=c;break}}const i=r;switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":case"WITHIN":case"AWAYBY":case"ELEMENTS":break;default:return[e,r]}const[s,o]=Nj(i);n=s,r=o}return e.length?[e,r]:[void 0,t]}function g1(t,e){if(!fe(t)||!uc(e))return;const{color:n,bg:r}=rE(e);fe(n)&&(t.color=n),fe(r)&&(t.bg=r)}function As(t){return t?.category===R1.ISOBJECT}function Pj(){return{id:Go()}}const JA=RE(32,126).map(t=>String.fromCharCode(t));function mi(t){return yu({...t,name:`token_${t.name}`})}function $t(t){return mi({name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:_a})}const oA=mi({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),HK=mi({name:"whitespace",pattern:/ +/,group:Lc.SKIPPED}),$K=mi({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Lc.SKIPPED}),P1=mi({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),mg=mi({name:"command",pattern:/#/,start_chars_hint:["#"]});let GK=!1;const Wxe="@#/?':!",qxe=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function Yxe(t,e){if(!GK)return null;let n=e;const r=t[n-1]??"";if(n>0&&r!==" "&&r!==`
`)return null;if(t[n]===" "){for(;t[n]===" ";)n++;if(Wxe.includes(t[n]))return null}for(;n>0&&`$"@#':!/?
`.includes(t[n])===!1;)n--;switch(t[n]){case"?":case"/":{const o=t.substring(n+1,e+1).toLowerCase();if(o.indexOf(" ")<1||qxe.test(o))return null;break}case"#":return null;case'"':{for(n--;n>0&&t[n]===" ";)n--;if(!(n<1||t[n]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=e;for(t[i]==='"'&&++i;i<t.length&&t[i]!==`
`;)i++;const s=t.substring(e,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const aA=mi({name:"text",pattern:Yxe,line_breaks:!1,start_chars_hint:JA}),cA=mi({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),OE=mi({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),lA=mi({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),Q5=mi({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),_a=mi({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:JA}),FT=mi({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),ZS=mi({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),WK=$t("isterrain"),qK=$t("isobject"),YK=$t("issolid"),KK=$t("iswalk"),XK=$t("isswim"),JK=$t("isbullet"),ZK=$t("isghost"),QK=$t("iswalking"),eX=$t("iswalkable"),tX=$t("isswimming"),nX=$t("isswimmable"),rX=$t("black"),iX=$t("dkblue"),sX=$t("dkgreen"),oX=$t("dkcyan"),aX=$t("dkred"),cX=$t("dkpurple"),lX=$t("dkyellow"),uX=$t("ltgray"),hX=$t("dkgray"),fX=$t("blue"),dX=$t("green"),pX=$t("cyan"),mX=$t("red"),gX=$t("purple"),_X=$t("yellow"),vX=$t("white"),yX=$t("brown"),bX=$t("dkwhite"),SX=$t("ltgrey"),EX=$t("gray"),xX=$t("grey"),wX=$t("dkgrey"),TX=$t("ltblack"),AX=$t("onblack"),CX=$t("ondkblue"),RX=$t("ondkgreen"),kX=$t("ondkcyan"),MX=$t("ondkred"),OX=$t("ondkpurple"),IX=$t("ondkyellow"),NX=$t("onltgray"),PX=$t("ondkgray"),DX=$t("onblue"),LX=$t("ongreen"),UX=$t("oncyan"),BX=$t("onred"),FX=$t("onpurple"),jX=$t("onyellow"),zX=$t("onwhite"),VX=$t("onbrown"),HX=$t("ondkwhite"),$X=$t("onltgrey"),GX=$t("ongray"),WX=$t("ongrey"),qX=$t("ondkgrey"),YX=$t("onltblack"),KX=$t("onclear"),XX=$t("blblack"),JX=$t("bldkblue"),ZX=$t("bldkgreen"),QX=$t("bldkcyan"),eJ=$t("bldkred"),tJ=$t("bldkpurple"),nJ=$t("bldkyellow"),rJ=$t("blltgray"),iJ=$t("bldkgray"),sJ=$t("blblue"),oJ=$t("blgreen"),aJ=$t("blcyan"),cJ=$t("blred"),lJ=$t("blpurple"),uJ=$t("blyellow"),hJ=$t("blwhite"),fJ=$t("blbrown"),dJ=$t("bldkwhite"),pJ=$t("blltgrey"),mJ=$t("blgray"),gJ=$t("blgrey"),_J=$t("bldkgrey"),vJ=$t("blltblack"),yJ=$t("idle"),bJ=$t("up"),SJ=$t("down"),EJ=$t("left"),xJ=$t("right"),wJ=$t("by"),TJ=$t("at"),AJ=$t("flow"),CJ=$t("seek"),RJ=$t("rndns"),kJ=$t("rndne"),MJ=$t("rnd"),OJ=$t("cw"),IJ=$t("ccw"),NJ=$t("opp"),PJ=$t("rndp"),DJ=$t("away"),LJ=$t("toward"),UJ=$t("find"),BJ=$t("flee"),FJ=$t("to"),jJ=$t("i"),zJ=$t("u"),VJ=$t("north"),HJ=$t("n"),$J=$t("d"),GJ=$t("south"),WJ=$t("s"),qJ=$t("l"),YJ=$t("west"),KJ=$t("w"),XJ=$t("r"),JJ=$t("east"),ZJ=$t("e"),QJ=$t("over"),eZ=$t("under"),tZ=$t("ground"),nZ=$t("within"),rZ=$t("awayby"),iZ=$t("elements"),sZ=mi({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:_a}),oZ=$t("contact"),aZ=$t("blocked"),cZ=$t("any"),lZ=$t("countof"),uZ=$t("abs"),hZ=$t("intceil"),fZ=$t("intfloor"),dZ=$t("intround"),pZ=$t("clamp"),mZ=$t("min"),gZ=$t("max"),_Z=$t("pick"),vZ=$t("pickwith"),yZ=$t("random"),bZ=$t("randomwith"),SZ=$t("run"),EZ=$t("runwith"),xZ=mi({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),e6=mi({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:_a}),t6=mi({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:_a}),n6=mi({name:"islessthan",pattern:/<|below/i,longer_alt:_a}),r6=mi({name:"isgreaterthan",pattern:/>|above/i,longer_alt:_a}),i6=mi({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:_a}),s6=mi({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:_a}),yM=mi({name:"or",pattern:/or/i,longer_alt:_a}),bM=mi({name:"not",pattern:/not/i,longer_alt:_a}),SM=mi({name:"and",pattern:/and/i,longer_alt:_a}),EM=mi({name:"plus",pattern:/\+/}),xM=mi({name:"minus",pattern:/-/}),o6=mi({name:"power",pattern:/\*\*/}),a6=mi({name:"multiply",pattern:/\*/}),_1=mi({name:"divide",pattern:/\//}),c6=mi({name:"moddivide",pattern:/%/}),l6=mi({name:"floordivide",pattern:/%%/}),uA=mi({name:"query",pattern:/\?/}),u6=mi({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),h6=mi({name:"rparen",pattern:/\)/,pop_mode:!0}),f6=mi({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:JA,longer_alt:_a}),wZ=mi({name:"command_toast",pattern:/toast .*/i,start_chars_hint:JA,longer_alt:_a}),TZ=mi({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:JA,longer_alt:_a}),v1=mi({name:"if",pattern:/if|try|take|give|duplicate/i,longer_alt:_a}),y1=mi({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:_a}),wM=$t("done"),b1=$t("else"),d6=$t("while"),p6=$t("repeat"),m6=$t("waitfor"),g6=mi({name:"foreach",pattern:/foreach|for/i,longer_alt:_a}),_6=$t("break"),v6=$t("continue");function AZ(t,e){return[...t,SJ,...e,ZS,WK,qK,YK,eX,QK,KK,nX,tX,XK,JK,ZK,rX,iX,sX,oX,aX,cX,lX,uX,hX,fX,dX,pX,mX,gX,_X,vX,yX,bX,SX,EX,xX,wX,TX,AX,CX,RX,kX,MX,OX,IX,NX,PX,DX,LX,UX,BX,FX,jX,zX,VX,HX,$X,GX,WX,qX,YX,KX,XX,JX,ZX,QX,eJ,tJ,nJ,rJ,iJ,sJ,oJ,aJ,cJ,lJ,uJ,hJ,fJ,dJ,pJ,mJ,gJ,_J,vJ,yJ,bJ,EJ,xJ,wJ,TJ,AJ,CJ,PJ,RJ,kJ,MJ,OJ,IJ,NJ,nZ,rZ,iZ,DJ,LJ,UJ,BJ,FJ,VJ,GJ,YJ,JJ,QJ,eZ,tZ,sZ,oZ,aZ,cZ,lZ,uZ,hZ,fZ,dZ,pZ,mZ,gZ,vZ,_Z,bZ,yZ,EZ,SZ,xZ,e6,t6,i6,n6,s6,r6,yM,bM,SM,EM,xM,o6,a6,_1,l6,c6,uA,u6,h6,jJ,zJ,HJ,$J,WJ,qJ,KJ,XJ,ZJ,FT,_a]}const CZ=AZ([aA,P1,f6,wZ,TZ,mg,cA,OE,lA,Q5,oA,HK],[_6,v6,wM,y1,b1,g6,v1,p6,m6,d6]),Kxe=new Lc({defaultMode:"use_newlines",modes:{use_newlines:CZ,ignore_newlines:AZ([$K],[])}},{skipValidations:!Lm,ensureOptimizations:Lm,positionTracking:"full"});function RZ(t){GK=!0;const e=Kxe.tokenize(t||` 
`),[n]=(Kn(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(YA(oA,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function no(t){return`${t??""}`}function u1(t,e){const n=parseFloat(no(t));return isNaN(n)?e:n}function rp(t,e){return typeof t==typeof e?t:e}function NL(t,e,n=!0){if(n){const[r,...i]=e;switch(rr(r??"")){default:return{type:Hn.OBJECT,values:e};case"loader":return{type:Hn.LOADER,values:i};case"board":return{type:Hn.BOARD,values:i};case"object":return{type:Hn.OBJECT,values:i};case"terrain":return{type:Hn.TERRAIN,values:i};case"charset":return{type:Hn.CHARSET,values:i};case"palette":return{type:Hn.PALETTE,values:i}}}else{const[r,i,...s]=e,o=rr(i??""),a=[r,t,...s];switch(o){default:return{type:Hn.CONST,values:e};case"rn":case"range":return{type:Hn.RANGE,values:a};case"sl":case"select":return{type:Hn.SELECT,values:a};case"nm":case"number":return{type:Hn.NUMBER,values:a};case"tx":case"text":return{type:Hn.TEXT,values:a};case"hk":case"hotkey":return{type:Hn.HOTKEY,values:a};case"copyit":return{type:Hn.COPYIT,values:a};case"openit":return{type:Hn.OPENIT,values:a};case"viewit":return{type:Hn.VIEWIT,values:a};case"runit":return{type:Hn.RUNIT,values:a};case"zssedit":return{type:Hn.ZSSEDIT,values:a};case"charedit":return{type:Hn.CHAREDIT,values:a};case"coloredit":return{type:Hn.COLOREDIT,values:a}}}}function Z_(t){switch(t){case Hn.LOADER:return"loader";case Hn.BOARD:return"board";case Hn.OBJECT:return"object";case Hn.TERRAIN:return"terrain";case Hn.CHARSET:return"charset";case Hn.PALETTE:return"palette";case Hn.CONST:return"const";case Hn.RANGE:return"range";case Hn.SELECT:return"select";case Hn.NUMBER:return"number";case Hn.TEXT:return"text";case Hn.HOTKEY:return"hotkey";case Hn.COPYIT:return"copyit";case Hn.OPENIT:return"openit";case Hn.VIEWIT:return"viewit";case Hn.RUNIT:return"runit";case Hn.ZSSEDIT:return"zssedit";case Hn.CHAREDIT:return"charedit";case Hn.COLOREDIT:return"coloredit"}}function PL(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(Kn(s)){const[o,...a]=s;switch(o){case"text":fe(e[i])||(e[i]="");break;case"range":fe(e[i])||(e[i]=4);break;case"number":fe(e[i])||(e[i]=0);break;case"select":if(!fe(e[i])){const[,c]=a;e[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":e[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":e[i]=kZ(s)??s;break;case"isitem":e.item=1;break;case"notitem":e.item=0;break;case"ispushable":e.pushable=s===""?1:s;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=Fn.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=Fn.ISSWIM;break;case"issolid":e.collision=Fn.ISSOLID;break;case"isbullet":e.collision=Fn.ISBULLET;break;case"isghost":e.collision=Fn.ISGHOST;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function hA(t){if(fe(t))switch(Um(t)){default:return;case Qr.ERROR:return t.code??"";case Qr.LOADER:return t.code??"";case Qr.BOARD:{fe(t.board)||(t.board=z8()),t.board.id=t.id,t.board.name=oc(t);const e=nw(t),n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];switch(i){case"isdark":t.board.isdark=1;break;case"notdark":t.board.isdark=0;break;case"restartonzap":t.board.restartonzap=1;break;case"norestartonzap":t.board.restartonzap=0;break;case"startx":case"starty":case"facing":case"timelimit":case"maxplayershots":nn(s)&&(t.board[i]=s);break;case"over":case"under":case"camera":case"graphics":case"charset":case"palette":case"exitnorth":case"exitsouth":case"exitwest":case"exiteast":dn(s)&&(rr(s)==="empty"?t.board[i]=void 0:t.board[i]=s);break;case"b1":case"b2":case"b3":case"b4":case"b5":case"b6":case"b7":case"b8":case"b9":case"b10":fe(s)&&(t.board[i]=kZ(s)??s);break}}return t.board}case Qr.OBJECT:return fe(t.object)||(t.object=Pj()),t.object.id=t.id,t.object.code=t.code,t.object.name=oc(t),t.object.category=R1.ISOBJECT,PL(nw(t),t.object),t.object;case Qr.TERRAIN:return fe(t.terrain)||(t.terrain=Pj()),t.terrain.id=t.id,t.terrain.name=oc(t),t.terrain.category=R1.ISTERRAIN,PL(nw(t),t.terrain),t.terrain;case Qr.PALETTE:{if(fe(t.palette)||(t.palette=Y1(J1)),fe(t.palette?.bits)){const e=nw(t),n=Dm(e);for(let r=0;r<n.length;++r){const i=n[r].toLowerCase(),s=e[i];if(i.startsWith("color")&&dn(s)){const o=parseFloat(i.replace("color",""));if(o>=0&&o<=15){vR.set(s);const a=o*eA,c=vR.r*63,l=vR.g*63,u=vR.b*63;t.palette.bits[a+0]=Ci(c,0,63),t.palette.bits[a+1]=Ci(l,0,63),t.palette.bits[a+2]=Ci(u,0,63)}}}}return t.palette}case Qr.CHARSET:{if(fe(t.charset)||(t.charset=K1(X1)),fe(t.charset?.bits)){const e=nw(t),n=Dm(e);for(let r=0;r<n.length;++r){const i=n[r].toLowerCase(),s=e[i];if(i.startsWith("char")&&dn(s)){const o=parseFloat(i.replace("char",""));if(o>=0&&o<=255){const c=[];for(let l=0;l<112;++l)switch(s[l]){case"-":case void 0:c.push(0);break;default:c.push(128);break}ume(Uint8Array.from(c),t.charset,o)}}}}return t.charset}}}function oc(t){return ZA(t).name??""}function Xxe(t,e){return ZA(t)[e]}const vR=new wi;function kZ(t){if(!dn(t))return;const e=WE(t);if(fe(e)&&fe(Ft[e]))return Ft[e];const n=rr(t),r=yn[n];if(fe(r))return r}function nw(t){const e={...ZA(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function ZA(t){return fe(t)?(fe(t.stats?.type)||(t.stats=MZ(t.code),fe(t.stats.type)||(t.stats.type=Qr.OBJECT)),t.stats):{}}function MZ(t){const e=RZ(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===P1){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),l=a.split(" "),u=NL(dn(c)?c:"",l,r),h=u.values.join(" ");switch(r=!1,u.type){case Hn.LOADER:n.type=Qr.LOADER,n.name=h;break;case Hn.BOARD:n.type=Qr.BOARD,n.name=h;break;case Hn.OBJECT:n.type=Qr.OBJECT,n.name=h||"object";break;case Hn.TERRAIN:n.type=Qr.TERRAIN,n.name=h;break;case Hn.CHARSET:n.type=Qr.CHARSET,n.name=h;break;case Hn.PALETTE:n.type=Qr.PALETTE,n.name=h;break;case Hn.CONST:{const[f,...d]=u.values;if(dn(f)){const p=rr(f),m=d.join(" ");if(dn(m)){const g=parseFloat(m);nn(g)?n[p]=g:n[p]=`${no(n[p])}${m}`}else n[p]=1}break}case Hn.RANGE:case Hn.SELECT:case Hn.NUMBER:case Hn.TEXT:case Hn.HOTKEY:case Hn.ZSSEDIT:case Hn.CHAREDIT:case Hn.COLOREDIT:{const[f,...d]=u.values;if(dn(f)){const p=rr(f);n[p]=[Z_(u.type),...d]}break}}}}return n}function Um(t){return ZA(t).type??Qr.ERROR}function Ay(t){return OZ(Um(t))}function OZ(t){switch(t){default:case Qr.ERROR:return"error";case Qr.LOADER:return Z_(Hn.LOADER);case Qr.BOARD:return Z_(Hn.BOARD);case Qr.OBJECT:return Z_(Hn.OBJECT);case Qr.TERRAIN:return Z_(Hn.TERRAIN);case Qr.CHARSET:return Z_(Hn.CHARSET);case Qr.PALETTE:return Z_(Hn.PALETTE)}}function Jxe(t,e){return{id:Go(),code:t,...e}}function IZ(t,e){const n=fA(t,e);if(fe(t)&&fe(n)){const r=rr(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==oc(i)),NZ(t),n}}function Zxe(t,e){t&&delete t.flags[e]}function mu(t,e=1,n=Ft.WHITE,r=Ft.BLACK){const i=t?.kinddata;return{name:rr(t?.name??i?.name),char:t?.displaychar??i?.displaychar??t?.char??i?.char??e,color:t?.displaycolor??i?.displaycolor??t?.color??i?.color??n,bg:t?.displaybg??i?.displaybg??t?.bg??i?.bg??r,light:t?.light??i?.light??0}}function Qxe(t,e,n){let r=ewe(t,e,n);if(!fe(r)){const i=OZ(e);return r=Jxe(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),nwe(t,r),[r,!0]}return[r,!1]}function fA(t,e){if(!fe(t))return;const n=rr(e);return t.pages.find(i=>i.id===e||n===oc(i))}function DL(t,e,n){if(!fe(t))return[];const r=rr(n);return t.pages.filter(s=>Um(s)===e).filter(s=>{const o=ZA(s),a=rr(oc(s));return s.id===n||r===a||fe(o[n])})}function ewe(t,e,n){if(!fe(t))return;const r=rr(n);return t.pages.find(s=>Um(s)===e&&(s.id===n||r===oc(s)))}function IE(t,e,n){return y6(t,e)?.[n]}function y6(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function rw(t){return fe(t)?Ts(t.pages).sort((n,r)=>{const i=Um(n),s=Um(r);return i===s?oc(n).localeCompare(oc(r)):s-i}):[]}function twe(t){fe(t)&&(t.name=J5())}function NZ(t){fe(t)&&(t.token=`${Bxe()}${au(1111,9999)}`)}function nwe(t,e){if(!fe(t)||!fe(e))return!1;const n=fA(t,e.id);return fe(n)?!1:(t.pages.push(e),NZ(t),!0)}function dA(t,e,n,r){const i=y6(t,e);return i&&(i[n]=r),r}function PZ(t){return{id:Go(),name:J5(),timestamp:0,activelist:[],pages:t,flags:{}}}const rwe=80,QA=1e3/rwe,iwe=3;function oh(t){return new Promise(e=>setTimeout(e,t))}const gp={session:Go(),operator:"",software:{main:"",temp:""},books:new Map};function Cm(){return gp.operator}function gm(){return[...gp.books.values()]}function swe(){const[t]=gp.books.values();return t}function iv(t){const e=rr(t);return gp.books.get(t)??gm().find(n=>n.name===e)}function DZ(t,e){fe(iv(e))&&(gp.software[t]=e)}function Zh(t){return iv(gp.software[t])}function owe(t){const e=PZ([]);return dn(t)&&(e.name=t),LZ(e),us(qe,gp.operator,`created [book] ${e.name}`),e}function awe(t){let e=iv(t);return fe(e)||(e=PZ([]),e.name=t),LZ(e),us(qe,gp.operator,`created [book] ${e.name}`),e}function sv(t,e){let n=fe(e)?awe(e):Zh(t);return fe(n)||(fe(n)||(n=swe()),fe(n)||(n=owe(e)),fe(n)&&us(qe,gp.operator,`opened [book] ${n.name} for ${t}`)),DZ(t,n.id),n}function cwe(t,e,n){return Qxe(sv(t),n,e)}function uu(t,e){const n=Zh(la.MAIN),r=Gf(DL(n,t,e));if(fe(r))return r;const i=gm();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==n?.id){const a=Gf(DL(o,t,e));if(fe(a))return a}}}function ap(t){if(fe(t?.kinddata))return t.kinddata;if(!dn(t?.kind)||!t.kind)return;const e=uu(Qr.OBJECT,t.kind);if(fe(e))return t.kinddata=hA(e),t.kinddata;const n=uu(Qr.TERRAIN,t.kind);if(fe(n))return t.kinddata=hA(n),t.kinddata}function ri(t,e){const n=t?.kinddata,r=n?.id??"",i=t?.[e];if(fe(i))return i;const s=n?.[e];if(fe(s))return s;const o=uu(Qr.OBJECT,r)??uu(Qr.TERRAIN,r),a=Xxe(o,e);if(fe(a))return a;switch(e){case"group":return"";case"cycle":return iwe;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return Fn.ISWALK;default:return}}function LL(t,e){const n={x:t?.x??-1,y:t?.y??-1},r={x:e?.x??-1,y:e?.y??-1},i=Xd(n,r),s=ri(e,"pushable");return nn(s)?s!==0:dn(s)?s.trim().split(" ").map(o=>zK(XA(o))).some(o=>o===i):!1}function Qf(t,e,n,r){if(!fe(t)||!fe(e))return;const[i,s]=e,o=uu(Qr.OBJECT,i);if(fe(o)){const c=Xte(t,n,i,r);if(fe(c))return g1(c,s),ap(c),UZ(t,c),UL(t,c),c}const a=uu(Qr.TERRAIN,i);if(fe(a)){const c=aUe(t,n,i);if(fe(c)){g1(c,s),ap(c);const l=Yf(n,bn);return UL(t,c,l),c}}}function lwe(t,e,n){if(!fe(t)||!fe(e))return;const[r,i]=e,s=uu(Qr.OBJECT,r);if(fe(s)){const o=Xte(t,n,r);return g1(o,i),o}}function Cs(t){const e=uu(Qr.BOARD,t);return hA(e)}function Eg(t){const e=sv(la.MAIN);return y6(e,t)}function uwe(t){const e=sv(la.MAIN);return Zxe(e,t)}function LZ(t){return gp.books.set(t.id,t),t.id}function hwe(t){const e=iv(t);e&&gp.books.delete(e.id)}function lc(t){if(!fe(t))return;for(let n=0;n<t.terrain.length;++n)ap(t.terrain[n]);const e=Object.keys(t.objects);for(let n=0;n<e.length;++n){const r=e[n];ap(t.objects[r])}fwe(t)}function UL(t,e,n){if(!fe(t)||!fe(t.named)||!fe(e))return;const r=rr(e.name??e.kinddata?.name??"");t.named[r]||(t.named[r]=new Set),t.named[r].add(e?.id??n??"")}function UZ(t,e){if(!(!fe(t)||!fe(t.lookup)||!fe(e?.id))&&!fe(e.removed)&&ri(e,"collision")!==Fn.ISGHOST){const n=e.x??0,r=e.y??0;t.lookup[n+r*bn]=e.id}}function b6(t,e){if(fe(t)&&fe(e?.id)){if(fe(t.lookup)&&fe(e.x)&&fe(e.y)){const r=e.x+e.y*bn;t.lookup[r]===e.id&&(t.lookup[r]=void 0)}const n=mu(e);fe(t.named?.[n.name])&&fe(e.id)&&t.named[n.name].delete(e.id)}}function fwe(t){fe(t)&&(delete t.named,delete t.lookup,dwe(t))}function dwe(t){if(!fe(t)||fe(t.lookup)&&fe(t.named))return;const e=new Array(bn*Tr).fill(void 0),n={},r=Object.values(t.objects);for(let o=0;o<r.length;++o){const a=r[o];if(fe(a.x)&&fe(a.y)&&fe(a.id)&&!fe(a.removed)){a.category=R1.ISOBJECT,ri(a,"collision")!==Fn.ISGHOST&&(e[a.x+a.y*bn]=a.id),dn(a.code)&&!fe(a.name)&&PL(MZ(a.code),a);const c=mu(a);n[c.name]||(n[c.name]=new Set),n[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];if(fe(a)){a.x=i,a.y=s,a.category=R1.ISTERRAIN;const c=mu(ap(a));n[c.name]||(n[c.name]=new Set),n[c.name].add(o)}++i,i>=bn&&(i=0,++s)}t.lookup=e,t.named=n}function pwe(t,e){if(fe(t)&&fe(e?.x)&&fe(e.y)){const n=mu(e),r=xA(t,e);fe(t.named?.[n.name])&&t.named[n.name].delete(r)}}var Sk={exports:{}},Ek={exports:{}},mwe=Ek.exports,Dj;function gwe(){return Dj||(Dj=1,(function(t,e){(function(n,r){t.exports=r()})(mwe,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(m){if(m)for(var g=0;g<u.length;g++)m[u[g]]!==void 0&&this["set"+r(u[g])](m[u[g]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",g=this.getLineNumber()||"",_=this.getColumnNumber()||"",y=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+g+":"+_+")":"[eval]:"+g+":"+_:y?y+" ("+m+":"+g+":"+_+")":m+":"+g+":"+_}},h.fromString=function(g){var _=g.indexOf("("),y=g.lastIndexOf(")"),v=g.substring(0,_),E=g.substring(_+1,y).split(","),x=g.substring(y+1);if(x.indexOf("@")===0)var A=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(x,""),T=A[1],k=A[2],L=A[3];return new h({functionName:v,args:E||void 0,fileName:T,lineNumber:k||void 0,columnNumber:L||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=(function(m){return function(g){this[m]=!!g}})(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=(function(m){return function(g){if(!n(g))throw new TypeError(m+" must be a Number");this[m]=Number(g)}})(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=(function(m){return function(g){this[m]=String(g)}})(a[p]);return h})})(Ek)),Ek.exports}var _we=Sk.exports,Lj;function vwe(){return Lj||(Lj=1,(function(t,e){(function(n,r){t.exports=r(gwe())})(_we,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,m=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:m,lineNumber:d[1],columnNumber:d[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=u.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],f=2,d=u.length;f<d;f+=2){var p=l.exec(u[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[f]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],f=0,d=u.length;f<d;f+=2){var p=l.exec(u[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[f]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;d.match(/\(([^)]*)\)/)&&(m=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:g,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:u})},this)}}})})(Sk)),Sk.exports}var ywe=vwe();const bwe=_u(ywe);function Mv(t){const e={},n={everytick(){},aftertick(){},listcommands(){return Dm(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}const BZ="15.1.22",Uj=(t,e,n)=>({endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}),Bj=(t,e,n)=>({endTime:e,insertTime:n,type:"linearRampToValue",value:t}),BL=(t,e)=>({startTime:e,type:"setValue",value:t}),FZ=(t,e,n)=>({duration:n,startTime:e,type:"setValueCurve",values:t}),jZ=(t,e,{startTime:n,target:r,timeConstant:i})=>r+(e-r)*Math.exp((n-t)/i),QS=t=>t.type==="exponentialRampToValue",TM=t=>t.type==="linearRampToValue",Q_=t=>QS(t)||TM(t),S6=t=>t.type==="setValue",hg=t=>t.type==="setValueCurve",AM=(t,e,n,r)=>{const i=t[e];return i===void 0?r:Q_(i)||S6(i)?i.value:hg(i)?i.values[i.values.length-1]:jZ(n,AM(t,e-1,i.startTime,r),i)},Fj=(t,e,n,r,i)=>n===void 0?[r.insertTime,i]:Q_(n)?[n.endTime,n.value]:S6(n)?[n.startTime,n.value]:hg(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,AM(t,e-1,n.startTime,i)],FL=t=>t.type==="cancelAndHold",jL=t=>t.type==="cancelScheduledValues",V_=t=>FL(t)||jL(t)?t.cancelTime:QS(t)||TM(t)?t.endTime:t.startTime,jj=(t,e,n,{endTime:r,value:i})=>n===i?i:0<n&&0<i||n<0&&i<0?n*(i/n)**((t-e)/(r-e)):0,zj=(t,e,n,{endTime:r,value:i})=>n+(t-e)/(r-e)*(i-n),Swe=(t,e)=>{const n=Math.floor(e),r=Math.ceil(e);return n===r?t[n]:(1-(e-n))*t[n]+(1-(r-e))*t[r]},Ewe=(t,{duration:e,startTime:n,values:r})=>{const i=(t-n)/e*(r.length-1);return Swe(r,i)},yR=t=>t.type==="setTarget";class xwe{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const n=V_(e);if(FL(e)||jL(e)){const r=this._automationEvents.findIndex(s=>jL(e)&&hg(s)?s.startTime+s.duration>=n:V_(s)>=n),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),FL(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Q_(i)){if(s!==void 0&&yR(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:hg(s)?s.startTime+s.duration:V_(s),a=s===void 0?this._defaultValue:hg(s)?s.values[s.values.length-1]:s.value,c=QS(i)?jj(n,o,a,i):zj(n,o,a,i),l=QS(i)?Uj(c,n,this._currenTime):Bj(c,n,this._currenTime);this._automationEvents.push(l)}if(s!==void 0&&yR(s)&&this._automationEvents.push(BL(this.getValue(n),n)),s!==void 0&&hg(s)&&s.startTime+s.duration>n){const o=n-s.startTime,a=(s.values.length-1)/s.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=s.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const f=l*h%1;u[h]=s.values[h-1]*(1-f)+s.values[h]*f}this._automationEvents[this._automationEvents.length-1]=FZ(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>V_(o)>n),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&hg(i)&&V_(i)+i.duration>n)return!1;const s=QS(e)?Uj(e.value,e.endTime,this._currenTime):TM(e)?Bj(e.value,n,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if(hg(e)&&n+e.duration>V_(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const n=this._automationEvents.findIndex(r=>V_(r)>e);if(n>1){const r=this._automationEvents.slice(n-1),i=r[0];yR(i)&&r.unshift(BL(AM(this._automationEvents,n-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const n=this._automationEvents.findIndex(o=>V_(o)>e),r=this._automationEvents[n],i=(n===-1?this._automationEvents.length:n)-1,s=this._automationEvents[i];if(s!==void 0&&yR(s)&&(r===void 0||!Q_(r)||r.insertTime>e))return jZ(e,AM(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&S6(s)&&(r===void 0||!Q_(r)))return s.value;if(s!==void 0&&hg(s)&&(r===void 0||!Q_(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?Ewe(e,s):s.values[s.values.length-1];if(s!==void 0&&Q_(s)&&(r===void 0||!Q_(r)))return s.value;if(r!==void 0&&QS(r)){const[o,a]=Fj(this._automationEvents,i,s,r,this._defaultValue);return jj(e,o,a,r)}if(r!==void 0&&TM(r)){const[o,a]=Fj(this._automationEvents,i,s,r,this._defaultValue);return zj(e,o,a,r)}return this._defaultValue}}const wwe=t=>({cancelTime:t,type:"cancelAndHold"}),Twe=t=>({cancelTime:t,type:"cancelScheduledValues"}),Awe=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),Cwe=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),Rwe=(t,e,n)=>({startTime:e,target:t,timeConstant:n,type:"setTarget"}),kwe=()=>new DOMException("","AbortError"),Mwe=t=>(e,n,[r,i,s],o)=>{t(e[i],[n,r,s],a=>a[0]===n&&a[1]===r,o)},Owe=t=>(e,n,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:n})},Iwe=t=>(e,n)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})},NE=new WeakSet,zZ=new WeakMap,E6=new WeakMap,VZ=new WeakMap,x6=new WeakMap,qO=new WeakMap,HZ=new WeakMap,zL=new WeakMap,VL=new WeakMap,HL=new WeakMap,$Z={construct(){return $Z}},Nwe=t=>{try{const e=new Proxy(t,$Z);new e}catch{return!1}return!0},Vj=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Hj=(t,e)=>{const n=[];let r=t.replace(/^[\s]+/,""),i=r.match(Vj);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());n.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(Vj)}return[n.join(";"),r]},$j=t=>{if(t!==void 0&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Gj=t=>{if(!Nwe(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(t.prototype===null||typeof t.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Pwe=(t,e,n,r,i,s,o,a,c,l,u,h,f)=>{let d=0;return(p,m,g={credentials:"omit"})=>{const _=u.get(p);if(_!==void 0&&_.has(m))return Promise.resolve();const y=l.get(p);if(y!==void 0){const x=y.get(m);if(x!==void 0)return x}const v=s(p),E=v.audioWorklet===void 0?i(m).then(([x,A])=>{const[T,k]=Hj(x,A),L=`${T};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${k}
})})(window,'_AWGS')`;return n(L)}).then(()=>{const x=f._AWGS.pop();if(x===void 0)throw new SyntaxError;r(v.currentTime,v.sampleRate,()=>x(class{},void 0,(A,T)=>{if(A.trim()==="")throw e();const k=VL.get(v);if(k!==void 0){if(k.has(A))throw e();Gj(T),$j(T.parameterDescriptors),k.set(A,T)}else Gj(T),$j(T.parameterDescriptors),VL.set(v,new Map([[A,T]]))},v.sampleRate,void 0,void 0))}):Promise.all([i(m),Promise.resolve(t(h,h))]).then(([[x,A],T])=>{const k=d+1;d=k;const[L,I]=Hj(x,A),O=`${L};((AudioWorkletProcessor,registerProcessor)=>{${I}
})(${T?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${T?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${T?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${k}',class extends AudioWorkletProcessor{process(){return !1}})`,z=new Blob([O],{type:"application/javascript; charset=utf-8"}),q=URL.createObjectURL(z);return v.audioWorklet.addModule(q,g).then(()=>{if(a(v))return v;const G=o(v);return G.audioWorklet.addModule(q,g).then(()=>G)}).then(G=>{if(c===null)throw new SyntaxError;try{new c(G,`__sac${k}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(q))});return y===void 0?l.set(p,new Map([[m,E]])):y.set(m,E),E.then(()=>{const x=u.get(p);x===void 0?u.set(p,new Set([m])):x.add(m)}).finally(()=>{const x=l.get(p);x!==void 0&&x.delete(m)}),E}},cp=(t,e)=>{const n=t.get(e);if(n===void 0)throw new Error("A value with the given key could not be found.");return n},YO=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(n.length===0)throw Error("No element was found.");const[r]=n;return t.delete(r),r},GZ=(t,e,n,r)=>{const i=cp(t,e),s=YO(i,o=>o[0]===n&&o[1]===r);return i.size===0&&t.delete(e),s},eC=t=>cp(HZ,t),PE=t=>{if(NE.has(t))throw new Error("The AudioNode is already stored.");NE.add(t),eC(t).forEach(e=>e(!0))},WZ=t=>"port"in t,tC=t=>{if(!NE.has(t))throw new Error("The AudioNode is not stored.");NE.delete(t),eC(t).forEach(e=>e(!1))},$L=(t,e)=>{!WZ(t)&&e.every(n=>n.size===0)&&tC(t)},Dwe=(t,e,n,r,i,s,o,a,c,l,u,h,f)=>{const d=new WeakMap;return(p,m,g,_,y)=>{const{activeInputs:v,passiveInputs:E}=s(m),{outputs:x}=s(p),A=a(p),T=k=>{const L=c(m),I=c(p);if(k){const F=GZ(E,p,g,_);t(v,p,F,!1),!y&&!h(p)&&n(I,L,g,_),f(m)&&PE(m)}else{const F=r(v,p,g,_);e(E,_,F,!1),!y&&!h(p)&&i(I,L,g,_);const M=o(m);if(M===0)u(m)&&$L(m,v);else{const D=d.get(m);D!==void 0&&clearTimeout(D),d.set(m,setTimeout(()=>{u(m)&&$L(m,v)},M*1e3))}}};return l(x,[m,g,_],k=>k[0]===m&&k[1]===g&&k[2]===_,!0)?(A.add(T),u(p)?t(v,p,[g,_,T],!0):e(E,_,[p,g,T],!0),!0):!1}},Lwe=t=>(e,n,[r,i,s],o)=>{const a=e.get(r);a===void 0?e.set(r,new Set([[i,n,s]])):t(a,[i,n,s],c=>c[0]===i&&c[1]===n,o)},Uwe=t=>(e,n)=>{const r=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(r).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(r),r.disconnect()};n.addEventListener("ended",i)},Bwe=t=>(e,n)=>{t(e).add(n)},Fwe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},jwe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...Fwe,...c},h=r(l,u),f=s(l)?e():null;super(a,!1,h,f),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},Ul=(t,e)=>t.context===e,zwe=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Ul(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},CM=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Km=()=>new DOMException("","IndexSizeError"),w6=t=>{t.getChannelData=(e=>n=>{try{return e.call(t,n)}catch(r){throw r.code===12?Km():r}})(t.getChannelData)},Vwe={numberOfChannels:1},Hwe=(t,e,n,r,i,s,o,a)=>{let c=null;return class qZ{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:f,sampleRate:d}={...Vwe,...u};c===null&&(c=new i(1,1,44100));const p=r!==null&&e(s,s)?new r({length:h,numberOfChannels:f,sampleRate:d}):c.createBuffer(f,h,d);if(p.numberOfChannels===0)throw n();return typeof p.copyFromChannel!="function"?(o(p),w6(p)):e(CM,()=>CM(p))||a(p),t.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===qZ.prototype||t.has(u)}}},sh=-34028234663852886e22,ou=-sh,xg=t=>NE.has(t),$we={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Gwe=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const h=s(l),f={...$we,...u},d=i(h,f),p=o(h),m=p?e():null;super(l,!1,d,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=f.buffer!==null,this._nativeAudioBufferSourceNode=d,this._onended=null,this._playbackRate=n(this,p,d.playbackRate,ou,sh)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){PE(this);const f=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",f),xg(this)&&tC(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",f)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},Wwe=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=n(l);const f=Ul(h,u);if(!f){const d={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,d),o!==null&&h.start(...o),a!==null&&h.stop(a)}return s.set(u,h),f?await t(u,l.playbackRate,h.playbackRate):await r(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},qwe=t=>"playbackRate"in t,Ywe=t=>"frequency"in t&&"gain"in t,Kwe=t=>"offset"in t,Xwe=t=>!("frequency"in t)&&"gain"in t,Jwe=t=>"detune"in t&&"frequency"in t&&!("gain"in t),Zwe=t=>"pan"in t,hu=t=>cp(zZ,t),nC=t=>cp(VZ,t),GL=(t,e)=>{const{activeInputs:n}=hu(t);n.forEach(i=>i.forEach(([s])=>{e.includes(t)||GL(s,[...e,t])}));const r=qwe(t)?[t.playbackRate]:WZ(t)?Array.from(t.parameters.values()):Ywe(t)?[t.Q,t.detune,t.frequency,t.gain]:Kwe(t)?[t.offset]:Xwe(t)?[t.gain]:Jwe(t)?[t.detune,t.frequency]:Zwe(t)?[t.pan]:[];for(const i of r){const s=nC(i);s!==void 0&&s.activeInputs.forEach(([o])=>GL(o,e))}xg(t)&&tC(t)},YZ=t=>{GL(t.destination,[])},Qwe=t=>t===void 0||typeof t=="number"||typeof t=="string"&&(t==="balanced"||t==="interactive"||t==="playback"),eTe=(t,e,n,r,i,s,o,a,c)=>class extends t{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?n():p}if(h===null)throw r();if(!Qwe(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw n();super(h,2);const{latencyHint:f}=u,{sampleRate:d}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:f==="balanced"?512/d:f==="interactive"||f===void 0?256/d:f==="playback"?1024/d:Math.max(2,Math.min(128,Math.round(f*d/128)))*128/d,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),YZ(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const f=()=>{this._nativeAudioContext.removeEventListener("statechange",f),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",f)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},tTe=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const h=s(l),f=o(h),d=i(h,u,f),p=f?e(a):null;super(l,!1,d,p),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=d}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},nTe=t=>{const e=new WeakMap,n=async(r,i)=>{const s=i.destination;return e.set(i,s),await t(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):n(r,i)}}},rTe=(t,e,n,r,i,s,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const x=new Float32Array(1),A=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),T=o(l);let k=!1,L=[0,0,-1,0,1,0],I=[0,0,0];const F=()=>{if(k)return;k=!0;const z=r(l,256,9,0);z.onaudioprocess=({inputBuffer:q})=>{const G=[s(q,x,0),s(q,x,1),s(q,x,2),s(q,x,3),s(q,x,4),s(q,x,5)];G.some((te,re)=>te!==L[re])&&(u.setOrientation(...G),L=G);const K=[s(q,x,6),s(q,x,7),s(q,x,8)];K.some((te,re)=>te!==I[re])&&(u.setPosition(...K),I=K)},A.connect(z)},M=z=>q=>{q!==L[z]&&(L[z]=q,u.setOrientation(...L))},D=z=>q=>{q!==I[z]&&(I[z]=q,u.setPosition(...I))},O=(z,q,G)=>{const K=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:q});K.connect(A,0,z),K.start(),Object.defineProperty(K.offset,"defaultValue",{get(){return q}});const te=t({context:c},T,K.offset,ou,sh);return a(te,"value",re=>()=>re.call(te),re=>H=>{try{re.call(te,H)}catch(Y){if(Y.code!==9)throw Y}F(),T&&G(H)}),te.cancelAndHoldAtTime=(re=>T?()=>{throw i()}:(...H)=>{const Y=re.apply(te,H);return F(),Y})(te.cancelAndHoldAtTime),te.cancelScheduledValues=(re=>T?()=>{throw i()}:(...H)=>{const Y=re.apply(te,H);return F(),Y})(te.cancelScheduledValues),te.exponentialRampToValueAtTime=(re=>T?()=>{throw i()}:(...H)=>{const Y=re.apply(te,H);return F(),Y})(te.exponentialRampToValueAtTime),te.linearRampToValueAtTime=(re=>T?()=>{throw i()}:(...H)=>{const Y=re.apply(te,H);return F(),Y})(te.linearRampToValueAtTime),te.setTargetAtTime=(re=>T?()=>{throw i()}:(...H)=>{const Y=re.apply(te,H);return F(),Y})(te.setTargetAtTime),te.setValueAtTime=(re=>T?()=>{throw i()}:(...H)=>{const Y=re.apply(te,H);return F(),Y})(te.setValueAtTime),te.setValueCurveAtTime=(re=>T?()=>{throw i()}:(...H)=>{const Y=re.apply(te,H);return F(),Y})(te.setValueCurveAtTime),te};return{forwardX:O(0,0,M(0)),forwardY:O(1,0,M(1)),forwardZ:O(2,-1,M(2)),positionX:O(6,0,D(0)),positionY:O(7,0,D(1)),positionZ:O(8,0,D(2)),upX:O(3,0,M(3)),upY:O(4,1,M(4)),upZ:O(5,0,M(5))}},{forwardX:f,forwardY:d,forwardZ:p,positionX:m,positionY:g,positionZ:_,upX:y,upY:v,upZ:E}=u.forwardX===void 0?h():u;return{get forwardX(){return f},get forwardY(){return d},get forwardZ(){return p},get positionX(){return m},get positionY(){return g},get positionZ(){return _},get upX(){return y},get upY(){return v},get upZ(){return E}}},RM=t=>"context"in t,rC=t=>RM(t[0]),nb=(t,e,n,r)=>{for(const i of t)if(n(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},Wj=(t,e,[n,r],i)=>{nb(t,[e,n,r],s=>s[0]===e&&s[1]===n,i)},qj=(t,[e,n,r],i)=>{const s=t.get(e);s===void 0?t.set(e,new Set([[n,r]])):nb(s,[n,r],o=>o[0]===n,i)},rx=t=>"inputs"in t,kM=(t,e,n,r)=>{if(rx(e)){const i=e.inputs[r];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,r),[e,n,r]},KZ=(t,e,n)=>{for(const r of t)if(r[0]===e&&r[1]===n)return t.delete(r),r;return null},iTe=(t,e,n)=>YO(t,r=>r[0]===e&&r[1]===n),XZ=(t,e)=>{if(!eC(t).delete(e))throw new Error("Missing the expected event listener.")},JZ=(t,e,n)=>{const r=cp(t,e),i=YO(r,s=>s[0]===n);return r.size===0&&t.delete(e),i},MM=(t,e,n,r)=>{rx(e)?t.disconnect(e.inputs[r],n,0):t.disconnect(e,n,r)},Eo=t=>cp(E6,t),pA=t=>cp(x6,t),D1=t=>zL.has(t),xk=t=>!NE.has(t),Yj=(t,e)=>new Promise(n=>{if(e!==null)n(!0);else{const r=t.createScriptProcessor(256,1,1),i=t.createGain(),s=t.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=t.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(t.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?n(!0):n(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(t.destination)},a.start()}}),dN=(t,e)=>{const n=new Map;for(const r of t)for(const i of r){const s=n.get(i);n.set(i,s===void 0?1:s+1)}n.forEach((r,i)=>e(i,r))},OM=t=>"context"in t,sTe=t=>{const e=new Map;t.connect=(n=>(r,i=0,s=0)=>{const o=OM(r)?n(r,i,s):n(r,i),a=e.get(r);return a===void 0?e.set(r,[{input:s,output:i}]):a.every(c=>c.input!==s||c.output!==i)&&a.push({input:s,output:i}),o})(t.connect.bind(t)),t.disconnect=(n=>(r,i,s)=>{if(n.apply(t),r===void 0)e.clear();else if(typeof r=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==r);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(r))if(i===void 0)e.delete(r);else{const o=e.get(r);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==s||s===void 0));a.length===0?e.delete(r):e.set(r,a)}}for(const[o,a]of e)a.forEach(c=>{OM(o)?t.connect(o,c.output,c.input):t.connect(o,c.output)})})(t.disconnect)},oTe=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=nC(e),{outputs:o}=hu(t),a=eC(t),c=l=>{const u=Eo(t),h=pA(e);if(l){const f=JZ(s,t,n);Wj(i,t,f,!1),!r&&!D1(t)&&u.connect(h,n)}else{const f=iTe(i,t,n);qj(s,f,!1),!r&&!D1(t)&&u.disconnect(h,n)}};return nb(o,[e,n],l=>l[0]===e&&l[1]===n,!0)?(a.add(c),xg(t)?Wj(i,t,[n,c],!0):qj(s,[t,n,c],!0),!0):!1},aTe=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=hu(e),o=KZ(i[r],t,n);return o===null?[GZ(s,t,n,r)[2],!1]:[o[2],!0]},cTe=(t,e,n)=>{const{activeInputs:r,passiveInputs:i}=nC(e),s=KZ(r,t,n);return s===null?[JZ(i,t,n)[1],!1]:[s[2],!0]},T6=(t,e,n,r,i)=>{const[s,o]=aTe(t,n,r,i);if(s!==null&&(XZ(t,s),o&&!e&&!D1(t)&&MM(Eo(t),Eo(n),r,i)),xg(n)){const{activeInputs:a}=hu(n);$L(n,a)}},A6=(t,e,n,r)=>{const[i,s]=cTe(t,n,r);i!==null&&(XZ(t,i),s&&!e&&!D1(t)&&Eo(t).disconnect(pA(n),r))},lTe=(t,e)=>{const n=hu(t),r=[];for(const i of n.outputs)rC(i)?T6(t,e,...i):A6(t,e,...i),r.push(i[0]);return n.outputs.clear(),r},uTe=(t,e,n)=>{const r=hu(t),i=[];for(const s of r.outputs)s[1]===n&&(rC(s)?T6(t,e,...s):A6(t,e,...s),i.push(s[0]),r.outputs.delete(s));return i},hTe=(t,e,n,r,i)=>{const s=hu(t);return Array.from(s.outputs).filter(o=>o[0]===n&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(rC(o)?T6(t,e,...o):A6(t,e,...o),s.outputs.delete(o),o[0]))},fTe=(t,e,n,r,i,s,o,a,c,l,u,h,f,d,p,m)=>class extends l{constructor(_,y,v,E){super(v),this._context=_,this._nativeAudioNode=v;const x=u(_);h(x)&&n(Yj,()=>Yj(x,m))!==!0&&sTe(v),E6.set(this,v),HZ.set(this,new Set),_.state!=="closed"&&y&&PE(this),t(this,E,v)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(_){this._nativeAudioNode.channelCount=_}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(_){this._nativeAudioNode.channelCountMode=_}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(_){this._nativeAudioNode.channelInterpretation=_}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(_,y=0,v=0){if(y<0||y>=this._nativeAudioNode.numberOfOutputs)throw i();const E=u(this._context),x=p(E);if(f(_)||d(_))throw s();if(RM(_)){const k=Eo(_);try{const I=kM(this._nativeAudioNode,k,y,v),F=xk(this);(x||F)&&this._nativeAudioNode.disconnect(...I),this.context.state!=="closed"&&!F&&xk(_)&&PE(_)}catch(I){throw I.code===12?s():I}if(e(this,_,y,v,x)){const I=c([this],_);dN(I,r(x))}return _}const A=pA(_);if(A.name==="playbackRate"&&A.maxValue===1024)throw o();try{this._nativeAudioNode.connect(A,y),(x||xk(this))&&this._nativeAudioNode.disconnect(A,y)}catch(k){throw k.code===12?s():k}if(oTe(this,_,y,x)){const k=c([this],_);dN(k,r(x))}}disconnect(_,y,v){let E;const x=u(this._context),A=p(x);if(_===void 0)E=lTe(this,A);else if(typeof _=="number"){if(_<0||_>=this.numberOfOutputs)throw i();E=uTe(this,A,_)}else{if(y!==void 0&&(y<0||y>=this.numberOfOutputs)||RM(_)&&v!==void 0&&(v<0||v>=_.numberOfInputs))throw i();if(E=hTe(this,A,_,y,v),E.length===0)throw s()}for(const T of E){const k=c([this],T);dN(k,a)}}},dTe=(t,e,n,r,i,s,o,a,c,l,u,h,f)=>(d,p,m,g=null,_=null)=>{const y=m.value,v=new xwe(y),E=p?r(v):null,x={get defaultValue(){return y},get maxValue(){return g===null?m.maxValue:g},get minValue(){return _===null?m.minValue:_},get value(){return m.value},set value(A){m.value=A,x.setValueAtTime(A,d.context.currentTime)},cancelAndHoldAtTime(A){if(typeof m.cancelAndHoldAtTime=="function")E===null&&v.flush(d.context.currentTime),v.add(i(A)),m.cancelAndHoldAtTime(A);else{const T=Array.from(v).pop();E===null&&v.flush(d.context.currentTime),v.add(i(A));const k=Array.from(v).pop();m.cancelScheduledValues(A),T!==k&&k!==void 0&&(k.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(k.value,k.endTime):k.type==="linearRampToValue"?m.linearRampToValueAtTime(k.value,k.endTime):k.type==="setValue"?m.setValueAtTime(k.value,k.startTime):k.type==="setValueCurve"&&m.setValueCurveAtTime(k.values,k.startTime,k.duration))}return x},cancelScheduledValues(A){return E===null&&v.flush(d.context.currentTime),v.add(s(A)),m.cancelScheduledValues(A),x},exponentialRampToValueAtTime(A,T){if(A===0)throw new RangeError;if(!Number.isFinite(T)||T<0)throw new RangeError;const k=d.context.currentTime;return E===null&&v.flush(k),Array.from(v).length===0&&(v.add(l(y,k)),m.setValueAtTime(y,k)),v.add(o(A,T)),m.exponentialRampToValueAtTime(A,T),x},linearRampToValueAtTime(A,T){const k=d.context.currentTime;return E===null&&v.flush(k),Array.from(v).length===0&&(v.add(l(y,k)),m.setValueAtTime(y,k)),v.add(a(A,T)),m.linearRampToValueAtTime(A,T),x},setTargetAtTime(A,T,k){return E===null&&v.flush(d.context.currentTime),v.add(c(A,T,k)),m.setTargetAtTime(A,T,k),x},setValueAtTime(A,T){return E===null&&v.flush(d.context.currentTime),v.add(l(A,T)),m.setValueAtTime(A,T),x},setValueCurveAtTime(A,T,k){const L=A instanceof Float32Array?A:new Float32Array(A);if(h!==null&&h.name==="webkitAudioContext"){const I=T+k,F=d.context.sampleRate,M=Math.ceil(T*F),D=Math.floor(I*F),O=D-M,z=new Float32Array(O);for(let G=0;G<O;G+=1){const K=(L.length-1)/k*((M+G)/F-T),te=Math.floor(K),re=Math.ceil(K);z[G]=te===re?L[te]:(1-(K-te))*L[te]+(1-(re-K))*L[re]}E===null&&v.flush(d.context.currentTime),v.add(u(z,T,k)),m.setValueCurveAtTime(z,T,k);const q=D/F;q<I&&f(x,z[z.length-1],q),f(x,L[L.length-1],I)}else E===null&&v.flush(d.context.currentTime),v.add(u(L,T,k)),m.setValueCurveAtTime(L,T,k);return x}};return n.set(x,m),e.set(x,d),t(x,E),x},pTe=t=>({replay(e){for(const n of t)if(n.type==="exponentialRampToValue"){const{endTime:r,value:i}=n;e.exponentialRampToValueAtTime(i,r)}else if(n.type==="linearRampToValue"){const{endTime:r,value:i}=n;e.linearRampToValueAtTime(i,r)}else if(n.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=n;e.setTargetAtTime(i,r,s)}else if(n.type==="setValue"){const{startTime:r,value:i}=n;e.setValueAtTime(i,r)}else if(n.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=n;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class ZZ{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,n=null){return this._map.forEach((r,i)=>e.call(n,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const mTe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},gTe=(t,e,n,r,i,s,o,a,c,l,u,h,f,d)=>class extends e{constructor(m,g,_){var y;const v=a(m),E=c(v),x=u({...mTe,..._});f(x);const A=VL.get(v),T=A?.get(g),k=E||v.state!=="closed"?v:(y=o(v))!==null&&y!==void 0?y:v,L=i(k,E?null:m.baseLatency,l,g,T,x),I=E?r(g,x,T):null;super(m,!0,L,I);const F=[];L.parameters.forEach((D,O)=>{const z=n(this,E,D);F.push([O,z])}),this._nativeAudioWorkletNode=L,this._onprocessorerror=null,this._parameters=new ZZ(F),E&&t(v,this);const{activeInputs:M}=s(this);h(L,M)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const g=typeof m=="function"?d(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=g;const _=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=_!==null&&_===g?m:_}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function IM(t,e,n,r,i){if(typeof t.copyFromChannel=="function")e[n].byteLength===0&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],r,i);else{const s=t.getChannelData(r);if(e[n].byteLength===0)e[n]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(o)}}}const QZ=(t,e,n,r,i)=>{typeof t.copyToChannel=="function"?e[n].byteLength!==0&&t.copyToChannel(e[n],r,i):e[n].byteLength!==0&&t.getChannelData(r).set(e[n],i)},NM=(t,e)=>{const n=[];for(let r=0;r<t;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));n.push(i)}return n},_Te=(t,e)=>{const n=cp(HL,t),r=Eo(e);return cp(n,r)},vTe=async(t,e,n,r,i,s,o)=>{const a=e===null?Math.ceil(t.context.length/128)*128:e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce((g,_)=>g+_,0),u=l===0?null:n.createBuffer(l,a,n.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const h=hu(t),f=await _Te(n,t),d=NM(r.numberOfInputs,r.channelCount),p=NM(r.numberOfOutputs,i),m=Array.from(t.parameters.keys()).reduce((g,_)=>({...g,[_]:new Float32Array(128)}),{});for(let g=0;g<a;g+=128){if(r.numberOfInputs>0&&e!==null)for(let _=0;_<r.numberOfInputs;_+=1)for(let y=0;y<r.channelCount;y+=1)IM(e,d[_],y,y,g);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:_},y)=>{IM(e,m,_,c+y,g)});for(let _=0;_<r.numberOfInputs;_+=1)for(let y=0;y<i[_];y+=1)p[_][y].byteLength===0&&(p[_][y]=new Float32Array(128));try{const _=d.map((v,E)=>h.activeInputs[E].size===0?[]:v),y=o(g/n.sampleRate,n.sampleRate,()=>f.process(_,p,m));if(u!==null)for(let v=0,E=0;v<r.numberOfOutputs;v+=1){for(let x=0;x<i[v];x+=1)QZ(u,p[v],x,E+x,g);E+=i[v]}if(!y)break}catch(_){t.dispatchEvent(new ErrorEvent("processorerror",{colno:_.colno,filename:_.filename,lineno:_.lineno,message:_.message}));break}}return u},yTe=(t,e,n,r,i,s,o,a,c,l,u,h,f,d,p,m)=>(g,_,y)=>{const v=new WeakMap;let E=null;const x=async(A,T)=>{let k=u(A),L=null;const I=Ul(k,T),F=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(h===null){const M=F.reduce((q,G)=>q+G,0),D=i(T,{channelCount:Math.max(1,M),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,M)}),O=[];for(let q=0;q<A.numberOfOutputs;q+=1)O.push(r(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:F[q]}));const z=o(T,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});z.connect=e.bind(null,O),z.disconnect=c.bind(null,O),L=[D,O,z]}else I||(k=new h(T,g));if(v.set(T,L===null?k:L[2]),L!==null){if(E===null){if(y===void 0)throw new Error("Missing the processor constructor.");if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const G=A.channelCount*A.numberOfInputs,K=y.parameterDescriptors===void 0?0:y.parameterDescriptors.length,te=G+K;E=vTe(A,te===0?null:await(async()=>{const H=new f(te,Math.ceil(A.context.length/128)*128,T.sampleRate),Y=[],Z=[];for(let ge=0;ge<_.numberOfInputs;ge+=1)Y.push(o(H,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),Z.push(i(H,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const Q=await Promise.all(Array.from(A.parameters.values()).map(async ge=>{const Te=s(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ge.value});return await d(H,ge,Te.offset),Te})),ie=r(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,G+K)});for(let ge=0;ge<_.numberOfInputs;ge+=1){Y[ge].connect(Z[ge]);for(let Te=0;Te<_.channelCount;Te+=1)Z[ge].connect(ie,Te,ge*_.channelCount+Te)}for(const[ge,Te]of Q.entries())Te.connect(ie,0,G+ge),Te.start(0);return ie.connect(H.destination),await Promise.all(Y.map(ge=>p(A,H,ge))),m(H)})(),T,_,F,y,l)}const M=await E,D=n(T,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[O,z,q]=L;M!==null&&(D.buffer=M,D.start(0)),D.connect(O);for(let G=0,K=0;G<A.numberOfOutputs;G+=1){const te=z[G];for(let re=0;re<F[G];re+=1)O.connect(te,K+re,re);K+=F[G]}return q}if(I)for(const[M,D]of A.parameters.entries())await t(T,D,k.parameters.get(M));else for(const[M,D]of A.parameters.entries())await d(T,D,k.parameters.get(M));return await p(A,T,k),k};return{render(A,T){a(T,A);const k=v.get(T);return k!==void 0?Promise.resolve(k):x(A,T)}}},bTe=(t,e,n,r,i,s,o,a,c,l,u,h,f,d,p,m,g,_,y,v)=>class extends p{constructor(x,A){super(x,A),this._nativeContext=x,this._audioWorklet=t===void 0?void 0:{addModule:(T,k)=>t(this,T,k)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(x,A,T){return new n({length:A,numberOfChannels:x,sampleRate:T})}createBufferSource(){return new r(this)}createChannelMerger(x=6){return new s(this,{numberOfInputs:x})}createChannelSplitter(x=6){return new o(this,{numberOfOutputs:x})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(x=1){return new u(this,{maxDelayTime:x})}createDynamicsCompressor(){return new h(this)}createGain(){return new f(this)}createIIRFilter(x,A){return new d(this,{feedback:A,feedforward:x})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(x,A,T={disableNormalization:!1}){return new _(this,{...T,imag:A,real:x})}createStereoPanner(){return new y(this)}createWaveShaper(){return new v(this)}decodeAudioData(x,A,T){return l(this._nativeContext,x).then(k=>(typeof A=="function"&&A(k),k),k=>{throw typeof T=="function"&&T(k),k})}},STe={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},ETe=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const h=s(l),f={...STe,...u},d=i(h,f),p=o(h),m=p?n():null;super(l,!1,d,m),this._Q=e(this,p,d.Q,ou,sh),this._detune=e(this,p,d.detune,1200*Math.log2(ou),-1200*Math.log2(ou)),this._frequency=e(this,p,d.frequency,l.sampleRate/2,0),this._gain=e(this,p,d.gain,40*Math.log10(ou),sh),this._nativeBiquadFilterNode=d,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(f){throw f.code===11?r():f}if(l.length!==u.length||u.length!==h.length)throw r()}},xTe=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=Ul(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return s.set(c,l),u?(await t(c,a.Q,l.Q),await t(c,a.detune,l.detune),await t(c,a.frequency,l.frequency),await t(c,a.gain,l.gain)):(await r(c,a.Q,l.Q),await r(c,a.detune,l.detune),await r(c,a.frequency,l.frequency),await r(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},wTe=(t,e)=>(n,r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t.get(n);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(t.set(n,o),o.catch(()=>!1).then(a=>(t.delete(n),e.set(n,a),a))):(e.set(n,o),o)}catch{return e.set(n,!1),!1}},TTe={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},ATe=(t,e,n,r,i)=>class extends t{constructor(o,a){const c=r(o),l={...TTe,...a},u=n(c,l),h=i(c)?e():null;super(o,!1,u,h)}},CTe=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Ul(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},RTe={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},kTe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u=s({...RTe,...c}),h=n(l,u),f=i(l)?e():null;super(a,!1,h,f)}},MTe=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Ul(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},OTe=t=>(e,n,r)=>t(n,e,r),ITe=t=>(e,n,r=0,i=0)=>{const s=e[r];if(s===void 0)throw t();return OM(n)?s.connect(n,0,i):s.connect(n,0)},NTe=t=>(e,n)=>{const r=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return r.buffer=i,r.loop=!0,r.connect(n),r.start(),()=>{r.stop(),r.disconnect(n)}},PTe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},DTe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...PTe,...l},f=r(u,h),d=s(u),p=d?n():null;super(c,!1,f,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=f,this._offset=e(this,d,f.offset,ou,sh),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){PE(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),xg(this)&&tC(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},LTe=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=n(l);const f=Ul(h,u);if(!f){const d={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,d),o!==null&&h.start(o),a!==null&&h.stop(a)}return s.set(u,h),f?await t(u,l.offset,h.offset):await r(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},UTe=t=>e=>(t[0]=e,t[0]),BTe={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},FTe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u={...BTe,...c},h=n(l,u),d=i(l)?e():null;super(a,!1,h,d),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},jTe=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Ul(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(o,l)}return r.set(o,a),rx(a)?await n(s,o,a.inputs[0]):await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},zTe=(t,e)=>(n,r,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,r,i)}catch(s){throw s.name==="SyntaxError"?t():s}},VTe=()=>new DOMException("","DataCloneError"),Kj=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise(r=>{const i=()=>{n.onmessage=null,e.close(),n.close(),r()};n.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}})},HTe=(t,e,n,r,i,s,o,a,c,l,u)=>(h,f)=>{const d=o(h)?h:s(h);if(i.has(f)){const p=n();return Promise.reject(p)}try{i.add(f)}catch{}return e(c,()=>c(d))?d.decodeAudioData(f).then(p=>(Kj(f).catch(()=>{}),e(a,()=>a(p))||u(p),t.add(p),p)):new Promise((p,m)=>{const g=async()=>{try{await Kj(f)}catch{}},_=y=>{m(y),g()};try{d.decodeAudioData(f,y=>{typeof y.copyFromChannel!="function"&&(l(y),w6(y)),t.add(y),g().then(()=>p(y))},y=>{_(y===null?r():y)})}catch(y){_(y)}})},$Te=(t,e,n,r,i,s,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=s(c.context),f=a(h);if(u===l){if(e.delete(c),!f&&o(c)){const d=r(c),{outputs:p}=n(c);for(const m of p)if(rC(m)){const g=r(m[0]);t(d,g,m[1],m[2])}else{const g=i(m[0]);d.connect(g,m[1])}}}else e.set(c,u-l)},GTe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},WTe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...GTe,...l},f=r(u,h),d=s(u),p=d?n(h.maxDelayTime):null;super(c,!1,f,p),this._delayTime=e(this,d,f.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},qTe=(t,e,n,r,i)=>s=>{const o=new WeakMap,a=async(c,l)=>{let u=n(c);const h=Ul(u,l);if(!h){const f={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,f)}return o.set(l,u),h?await t(l,c.delayTime,u.delayTime):await r(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},YTe=t=>(e,n,r,i)=>t(e[i],s=>s[0]===n&&s[1]===r),KTe=t=>(e,n)=>{t(e).delete(n)},XTe=t=>"delayTime"in t,JTe=(t,e,n)=>function r(i,s){const o=RM(s)?s:n(t,s);if(XTe(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>r([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},bR=(t,e,n)=>{const r=e[n];if(r===void 0)throw t();return r},ZTe=t=>(e,n=void 0,r=void 0,i=0)=>n===void 0?e.forEach(s=>s.disconnect()):typeof n=="number"?bR(t,e,n).disconnect():OM(n)?r===void 0?e.forEach(s=>s.disconnect(n)):i===void 0?bR(t,e,r).disconnect(n,0):bR(t,e,r).disconnect(n,0,i):r===void 0?e.forEach(s=>s.disconnect(n)):bR(t,e,r).disconnect(n,0),QTe={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},eAe=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const h=s(l),f={...QTe,...u},d=r(h,f),p=o(h),m=p?n():null;super(l,!1,d,m),this._attack=e(this,p,d.attack),this._knee=e(this,p,d.knee),this._nativeDynamicsCompressorNode=d,this._ratio=e(this,p,d.ratio),this._release=e(this,p,d.release),this._threshold=e(this,p,d.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},tAe=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=Ul(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return s.set(c,l),u?(await t(c,a.attack,l.attack),await t(c,a.knee,l.knee),await t(c,a.ratio,l.ratio),await t(c,a.release,l.release),await t(c,a.threshold,l.threshold)):(await r(c,a.attack,l.attack),await r(c,a.knee,l.knee),await r(c,a.ratio,l.ratio),await r(c,a.release,l.release),await r(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},nAe=()=>new DOMException("","EncodingError"),rAe=t=>e=>new Promise((n,r)=>{if(t===null){r(new SyntaxError);return}const i=t.document.head;if(i===null)r(new SyntaxError);else{const s=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,l=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(u,h,f,d,p)=>{if(h===a||h===t.location.href&&f===1&&d===1)return l(),r(p),!1;if(c!==null)return c(u,h,f,d,p)},s.onerror=()=>{l(),r(new SyntaxError)},s.onload=()=>{l(),n()},s.src=a,s.type="module",i.appendChild(s)}}),iAe=t=>class{constructor(n){this._nativeEventTarget=n,this._listeners=new WeakMap}addEventListener(n,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=t(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(n,s,i)}}dispatchEvent(n){return this._nativeEventTarget.dispatchEvent(n)}removeEventListener(n,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(n,s===void 0?null:s,i)}},sAe=t=>(e,n,r)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*n)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{t!==null&&(delete t.currentFrame,delete t.currentTime)}},oAe=t=>async e=>{try{const n=await fetch(e);if(n.ok)return[await n.text(),n.url]}catch{}throw t()},aAe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},cAe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...aAe,...c},h=r(l,u),f=s(l),d=f?n():null;super(a,!1,h,d),this._gain=e(this,f,h.gain,ou,sh)}get gain(){return this._gain}},lAe=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=Ul(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return s.set(c,l),u?await t(c,a.gain,l.gain):await r(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},uAe=(t,e)=>n=>e(t,n),hAe=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer},fAe=t=>e=>{var n;return(n=t.get(e))!==null&&n!==void 0?n:0},dAe=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer},pAe=t=>e=>t.get(e),Uc=()=>new DOMException("","InvalidStateError"),mAe=t=>e=>{const n=t.get(e);if(n===void 0)throw Uc();return n},gAe=(t,e)=>n=>{let r=t.get(n);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),t.set(n,r),r},_Ae=t=>e=>{const n=t.get(e);if(n===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return n},KO=()=>new DOMException("","InvalidAccessError"),vAe=t=>{t.getFrequencyResponse=(e=>(n,r,i)=>{if(n.length!==r.length||r.length!==i.length)throw KO();return e.call(t,n,r,i)})(t.getFrequencyResponse)},yAe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},bAe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u=i(l),h={...yAe,...c},f=e(l,u?null:a.baseLatency,h),d=u?n(h.feedback,h.feedforward):null;super(a,!1,f,d),vAe(f),this._nativeIIRFilterNode=f,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},eQ=(t,e,n,r,i,s,o,a,c,l,u)=>{const h=l.length;let f=a;for(let d=0;d<h;d+=1){let p=n[0]*l[d];for(let m=1;m<i;m+=1){const g=f-m&c-1;p+=n[m]*s[g],p-=t[m]*o[g]}for(let m=i;m<r;m+=1)p+=n[m]*s[f-m&c-1];for(let m=i;m<e;m+=1)p-=t[m]*o[f-m&c-1];s[f]=l[d],o[f]=p,f=f+1&c-1,u[d]=p}return f},SAe=(t,e,n,r)=>{const i=n instanceof Float64Array?n:new Float64Array(n),s=r instanceof Float64Array?r:new Float64Array(r),o=i.length,a=s.length,c=Math.min(o,a);if(i[0]!==1){for(let p=0;p<o;p+=1)s[p]/=i[0];for(let p=1;p<a;p+=1)i[p]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),f=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),d=t.numberOfChannels;for(let p=0;p<d;p+=1){const m=t.getChannelData(p),g=f.getChannelData(p);u.fill(0),h.fill(0),eQ(i,o,s,a,c,u,h,0,l,m,g)}return f},EAe=(t,e,n,r,i)=>(s,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let f=null,d=e(u);const p=Ul(d,h);if(h.createIIRFilter===void 0?f=t(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=h.createIIRFilter(o,s)),a.set(h,f===null?d:f),f!==null){if(c===null){if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new n(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await r(u,g,g.destination);const _=await i(g);return SAe(_,h,s,o)})()}const m=await c;return f.buffer=m,f.start(0),f}return await r(u,h,d),d};return{render(u,h){const f=a.get(h);return f!==void 0?Promise.resolve(f):l(u,h)}}},xAe=(t,e,n,r,i,s)=>o=>(a,c)=>{const l=t.get(a);if(l===void 0){if(!o&&s(a)){const u=r(a),{outputs:h}=n(a);for(const f of h)if(rC(f)){const d=r(f[0]);e(u,d,f[1],f[2])}else{const d=i(f[0]);u.disconnect(d,f[1])}}t.set(a,c)}else t.set(a,l+c)},wAe=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},TAe=(t,e)=>n=>t.has(n)||e(n),AAe=(t,e)=>n=>t.has(n)||e(n),CAe=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},RAe=t=>e=>t!==null&&e instanceof t,kAe=t=>e=>t!==null&&typeof t.AudioNode=="function"&&e instanceof t.AudioNode,MAe=t=>e=>t!==null&&typeof t.AudioParam=="function"&&e instanceof t.AudioParam,OAe=(t,e)=>n=>t(n)||e(n),IAe=t=>e=>t!==null&&e instanceof t,NAe=t=>t!==null&&t.isSecureContext,PAe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),c=e(a,o);if(r(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},DAe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},LAe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s);if(r(a))throw new TypeError;const c={...DAe,...o},l=e(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},UAe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),c=e(a,o);if(r(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},BAe=(t,e,n)=>class extends t{constructor(i,s){const o=n(i),a=e(o,s);super(i,!0,a,null)}},FAe=(t,e,n,r,i,s)=>class extends n{constructor(a,c){super(a),this._nativeContext=a,qO.set(this,a),r(a)&&i.set(a,new Set),this._destination=new t(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},mA=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return n===void 0?!1:(n.catch(()=>{}),!0)}catch{}return!1},jAe=(t,e)=>(n,r,i)=>{const s=new Set;return n.connect=(o=>(a,c=0,l=0)=>{const u=s.size===0;if(e(a))return o.call(n,a,c,l),t(s,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&r(),a;o.call(n,a,c),t(s,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&r()})(n.connect),n.disconnect=(o=>(a,c,l)=>{const u=s.size>0;if(a===void 0)o.apply(n),s.clear();else if(typeof a=="number"){o.call(n,a);for(const f of s)f[1]===a&&s.delete(f)}else{e(a)?o.call(n,a,c,l):o.call(n,a,c);for(const f of s)f[0]===a&&(c===void 0||f[1]===c)&&(l===void 0||f[2]===l)&&s.delete(f)}const h=s.size===0;u&&h&&i()})(n.disconnect),n},Ro=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n]&&(t[n]=r)},mc=(t,e)=>{Ro(t,e,"channelCount"),Ro(t,e,"channelCountMode"),Ro(t,e,"channelInterpretation")},Xj=t=>typeof t.getFloatTimeDomainData=="function",zAe=t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const r=Math.max(n.length,t.fftSize);for(let i=0;i<r;i+=1)e[i]=(n[i]-128)*.0078125;return e}},VAe=(t,e)=>(n,r)=>{const i=n.createAnalyser();if(mc(i,r),!(r.maxDecibels>r.minDecibels))throw e();return Ro(i,r,"fftSize"),Ro(i,r,"maxDecibels"),Ro(i,r,"minDecibels"),Ro(i,r,"smoothingTimeConstant"),t(Xj,()=>Xj(i))||zAe(i),i},HAe=t=>t===null?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,fa=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n].value&&(t[n].value=r)},$Ae=t=>{t.start=(e=>{let n=!1;return(r=0,i=0,s)=>{if(n)throw Uc();e.call(t,r,i,s),n=!0}})(t.start)},C6=t=>{t.start=(e=>(n=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,r,i)})(t.start)},R6=t=>{t.stop=(e=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})(t.stop)},GAe=(t,e,n,r,i,s,o,a,c,l,u)=>(h,f)=>{const d=h.createBufferSource();return mc(d,f),fa(d,f,"playbackRate"),Ro(d,f,"buffer"),Ro(d,f,"loop"),Ro(d,f,"loopEnd"),Ro(d,f,"loopStart"),e(n,()=>n(h))||$Ae(d),e(r,()=>r(h))||c(d),e(i,()=>i(h))||l(d,h),e(s,()=>s(h))||C6(d),e(o,()=>o(h))||u(d,h),e(a,()=>a(h))||R6(d),t(h,d),d},WAe=t=>t===null?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,qAe=(t,e)=>(n,r,i)=>{const s=n.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=t(n,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},YAe=t=>t===null?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,KAe=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},XAe=(t,e,n,r,i)=>(s,o,a,c,l,u)=>{if(a!==null)try{const h=new a(s,c,u),f=new Map;let d=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>d,set:p=>{typeof d=="function"&&h.removeEventListener("processorerror",d),d=typeof p=="function"?p:null,typeof d=="function"&&h.addEventListener("processorerror",d)}}}),h.addEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const g=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(g!==null){const _=f.get(m[1]);_!==void 0?m[1]=_:(m[1]=y=>{y.type==="error"?(Object.defineProperties(y,{type:{value:"processorerror"}}),g(y)):g(new ErrorEvent(m[0],{...y}))},f.set(g,m[1]))}}return p.call(h,"error",m[1],m[2]),p.call(h,...m)})(h.addEventListener),h.removeEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const g=f.get(m[1]);g!==void 0&&(f.delete(m[1]),m[1]=g)}return p.call(h,"error",m[1],m[2]),p.call(h,m[0],m[1],m[2])})(h.removeEventListener),u.numberOfOutputs!==0){const p=n(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(s.destination),i(h,()=>p.disconnect(),()=>p.connect(s.destination))}return h}catch(h){throw h.code===11?r():h}if(l===void 0)throw r();return KAe(u),e(s,o,l,u)},tQ=(t,e)=>t===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),JAe=t=>new Promise((e,n)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),n(s)},i.postMessage(t)}),ZAe=async(t,e)=>{const n=await JAe(e);return new t(n)},QAe=(t,e,n,r)=>{let i=HL.get(t);i===void 0&&(i=new WeakMap,HL.set(t,i));const s=ZAe(n,r);return i.set(e,s),s},eCe=(t,e,n,r,i,s,o,a,c,l,u,h,f)=>(d,p,m,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw c();const _=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(_.some(Le=>Le<1))throw c();if(_.length!==g.numberOfOutputs)throw e();if(g.channelCountMode!=="explicit")throw c();const y=g.channelCount*g.numberOfInputs,v=_.reduce((Le,Ve)=>Le+Ve,0),E=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(y+E>6||v>6)throw c();const x=new MessageChannel,A=[],T=[];for(let Le=0;Le<g.numberOfInputs;Le+=1)A.push(o(d,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),T.push(i(d,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const k=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:Le,maxValue:Ve,minValue:De,name:Ie}of m.parameterDescriptors){const ae=s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[Ie]!==void 0?g.parameterData[Ie]:Le===void 0?0:Le});Object.defineProperties(ae.offset,{defaultValue:{get:()=>Le===void 0?0:Le},maxValue:{get:()=>Ve===void 0?ou:Ve},minValue:{get:()=>De===void 0?sh:De}}),k.push(ae)}const L=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+E)}),I=tQ(p,d.sampleRate),F=a(d,I,y+E,Math.max(1,v)),M=i(d,{channelCount:Math.max(1,v),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,v)}),D=[];for(let Le=0;Le<g.numberOfOutputs;Le+=1)D.push(r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[Le]}));for(let Le=0;Le<g.numberOfInputs;Le+=1){A[Le].connect(T[Le]);for(let Ve=0;Ve<g.channelCount;Ve+=1)T[Le].connect(L,Ve,Le*g.channelCount+Ve)}const O=new ZZ(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:Le},Ve)=>{const De=k[Ve];return De.connect(L,0,y+Ve),De.start(0),[Le,De.offset]}));L.connect(F);let z=g.channelInterpretation,q=null;const G=g.numberOfOutputs===0?[F]:D,K={get bufferSize(){return I},get channelCount(){return g.channelCount},set channelCount(Le){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(Le){throw n()},get channelInterpretation(){return z},set channelInterpretation(Le){for(const Ve of A)Ve.channelInterpretation=Le;z=Le},get context(){return F.context},get inputs(){return A},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return q},set onprocessorerror(Le){typeof q=="function"&&K.removeEventListener("processorerror",q),q=typeof Le=="function"?Le:null,typeof q=="function"&&K.addEventListener("processorerror",q)},get parameters(){return O},get port(){return x.port2},addEventListener(...Le){return F.addEventListener(Le[0],Le[1],Le[2])},connect:t.bind(null,G),disconnect:l.bind(null,G),dispatchEvent(...Le){return F.dispatchEvent(Le[0])},removeEventListener(...Le){return F.removeEventListener(Le[0],Le[1],Le[2])}},te=new Map;x.port1.addEventListener=(Le=>(...Ve)=>{if(Ve[0]==="message"){const De=typeof Ve[1]=="function"?Ve[1]:typeof Ve[1]=="object"&&Ve[1]!==null&&typeof Ve[1].handleEvent=="function"?Ve[1].handleEvent:null;if(De!==null){const Ie=te.get(Ve[1]);Ie!==void 0?Ve[1]=Ie:(Ve[1]=ae=>{u(d.currentTime,d.sampleRate,()=>De(ae))},te.set(De,Ve[1]))}}return Le.call(x.port1,Ve[0],Ve[1],Ve[2])})(x.port1.addEventListener),x.port1.removeEventListener=(Le=>(...Ve)=>{if(Ve[0]==="message"){const De=te.get(Ve[1]);De!==void 0&&(te.delete(Ve[1]),Ve[1]=De)}return Le.call(x.port1,Ve[0],Ve[1],Ve[2])})(x.port1.removeEventListener);let re=null;Object.defineProperty(x.port1,"onmessage",{get:()=>re,set:Le=>{typeof re=="function"&&x.port1.removeEventListener("message",re),re=typeof Le=="function"?Le:null,typeof re=="function"&&(x.port1.addEventListener("message",re),x.port1.start())}}),m.prototype.port=x.port1;let H=null;QAe(d,K,m,g).then(Le=>H=Le);const Z=NM(g.numberOfInputs,g.channelCount),Q=NM(g.numberOfOutputs,_),ie=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((Le,{name:Ve})=>({...Le,[Ve]:new Float32Array(128)}),{});let ge=!0;const Te=()=>{g.numberOfOutputs>0&&F.disconnect(M);for(let Le=0,Ve=0;Le<g.numberOfOutputs;Le+=1){const De=D[Le];for(let Ie=0;Ie<_[Le];Ie+=1)M.disconnect(De,Ve+Ie,Ie);Ve+=_[Le]}},be=new Map;F.onaudioprocess=({inputBuffer:Le,outputBuffer:Ve})=>{if(H!==null){const De=h(K);for(let Ie=0;Ie<I;Ie+=128){for(let ae=0;ae<g.numberOfInputs;ae+=1)for(let ve=0;ve<g.channelCount;ve+=1)IM(Le,Z[ae],ve,ve,Ie);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:ae},ve)=>{IM(Le,ie,ae,y+ve,Ie)});for(let ae=0;ae<g.numberOfInputs;ae+=1)for(let ve=0;ve<_[ae];ve+=1)Q[ae][ve].byteLength===0&&(Q[ae][ve]=new Float32Array(128));try{const ae=Z.map((we,pe)=>{if(De[pe].size>0)return be.set(pe,I/128),we;const Je=be.get(pe);return Je===void 0?[]:(we.every(Xe=>Xe.every(tt=>tt===0))&&(Je===1?be.delete(pe):be.set(pe,Je-1)),we)});ge=u(d.currentTime+Ie/d.sampleRate,d.sampleRate,()=>H.process(ae,Q,ie));for(let we=0,pe=0;we<g.numberOfOutputs;we+=1){for(let ze=0;ze<_[we];ze+=1)QZ(Ve,Q[we],ze,pe+ze,Ie);pe+=_[we]}}catch(ae){ge=!1,K.dispatchEvent(new ErrorEvent("processorerror",{colno:ae.colno,filename:ae.filename,lineno:ae.lineno,message:ae.message}))}if(!ge){for(let ae=0;ae<g.numberOfInputs;ae+=1){A[ae].disconnect(T[ae]);for(let ve=0;ve<g.channelCount;ve+=1)T[Ie].disconnect(L,ve,ae*g.channelCount+ve)}if(m.parameterDescriptors!==void 0){const ae=m.parameterDescriptors.length;for(let ve=0;ve<ae;ve+=1){const we=k[ve];we.disconnect(L,0,y+ve),we.stop()}}L.disconnect(F),F.onaudioprocess=null,Pe?Te():lt();break}}}};let Pe=!1;const Ge=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Ze=()=>F.connect(Ge).connect(d.destination),lt=()=>{F.disconnect(Ge),Ge.disconnect()},pt=()=>{if(ge){lt(),g.numberOfOutputs>0&&F.connect(M);for(let Le=0,Ve=0;Le<g.numberOfOutputs;Le+=1){const De=D[Le];for(let Ie=0;Ie<_[Le];Ie+=1)M.connect(De,Ve+Ie,Ie);Ve+=_[Le]}}Pe=!0},ne=()=>{ge&&(Ze(),Te()),Pe=!1};return Ze(),f(K,pt,ne)},nQ=(t,e)=>{const n=t.createBiquadFilter();return mc(n,e),fa(n,e,"Q"),fa(n,e,"detune"),fa(n,e,"frequency"),fa(n,e,"gain"),Ro(n,e,"type"),n},tCe=(t,e)=>(n,r)=>{const i=n.createChannelMerger(r.numberOfInputs);return t!==null&&t.name==="webkitAudioContext"&&e(n,i),mc(i,r),i},nCe=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:n=>{if(n!==e)throw Uc()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:n=>{if(n!=="explicit")throw Uc()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:n=>{if(n!=="discrete")throw Uc()}})},iC=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return mc(n,e),nCe(n),n},rCe=(t,e,n,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return n(s,o);const a=s.createConstantSource();return mc(a,o),fa(a,o,"offset"),e(r,()=>r(s))||C6(a),e(i,()=>i(s))||R6(a),t(s,a),a},ix=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),iCe=(t,e,n,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=n(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},f=()=>c.connect(l),d=()=>c.disconnect(l);return t(i,c),r(ix(h,l),f,d)},sCe=(t,e)=>(n,r)=>{const i=n.createConvolver();if(mc(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),Ro(i,r,"buffer"),r.channelCount>2||(e(i,"channelCount",s=>()=>s.call(i),s=>o=>{if(o>2)throw t();return s.call(i,o)}),r.channelCountMode==="max"))throw t();return e(i,"channelCountMode",s=>()=>s.call(i),s=>o=>{if(o==="max")throw t();return s.call(i,o)}),i},rQ=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return mc(n,e),fa(n,e,"delayTime"),n},oCe=t=>(e,n)=>{const r=e.createDynamicsCompressor();if(mc(r,n),n.channelCount>2||n.channelCountMode==="max")throw t();return fa(r,n,"attack"),fa(r,n,"knee"),fa(r,n,"ratio"),fa(r,n,"release"),fa(r,n,"threshold"),r},Eh=(t,e)=>{const n=t.createGain();return mc(n,e),fa(n,e,"gain"),n},aCe=t=>(e,n,r)=>{if(e.createIIRFilter===void 0)return t(e,n,r);const i=e.createIIRFilter(r.feedforward,r.feedback);return mc(i,r),i};function cCe(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function lCe(t,e){return[t[0]*e[0]-t[1]*e[1],t[0]*e[1]+t[1]*e[0]]}function Jj(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)n=lCe(n,e),n[0]+=t[r];return n}const uCe=(t,e,n,r)=>(i,s,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=tQ(s,i.sampleRate),f=l instanceof Float64Array?l:new Float64Array(l),d=u instanceof Float64Array?u:new Float64Array(u),p=f.length,m=d.length,g=Math.min(p,m);if(p===0||p>20)throw r();if(f[0]===0)throw e();if(m===0||m>20)throw r();if(d[0]===0)throw e();if(f[0]!==1){for(let k=0;k<m;k+=1)d[k]/=f[0];for(let k=1;k<p;k+=1)f[k]/=f[0]}const _=n(i,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=c;const y=32,v=[],E=[],x=[];for(let k=0;k<o;k+=1){v.push(0);const L=new Float32Array(y),I=new Float32Array(y);L.fill(0),I.fill(0),E.push(L),x.push(I)}_.onaudioprocess=k=>{const L=k.inputBuffer,I=k.outputBuffer,F=L.numberOfChannels;for(let M=0;M<F;M+=1){const D=L.getChannelData(M),O=I.getChannelData(M);v[M]=eQ(f,p,d,m,g,E[M],x[M],v[M],y,D,O)}};const A=i.sampleRate/2;return ix({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(k){_.channelCount=k},get channelCountMode(){return _.channelCountMode},set channelCountMode(k){_.channelCountMode=k},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(k){_.channelInterpretation=k},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener(...k){return _.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return _.dispatchEvent(k[0])},getFrequencyResponse(k,L,I){if(k.length!==L.length||L.length!==I.length)throw t();const F=k.length;for(let M=0;M<F;M+=1){const D=-Math.PI*(k[M]/A),O=[Math.cos(D),Math.sin(D)],z=Jj(d,O),q=Jj(f,O),G=cCe(z,q);L[M]=Math.sqrt(G[0]*G[0]+G[1]*G[1]),I[M]=Math.atan2(G[1],G[0])}},removeEventListener(...k){return _.removeEventListener(k[0],k[1],k[2])}},_)},hCe=(t,e)=>t.createMediaElementSource(e.mediaElement),fCe=(t,e)=>{const n=t.createMediaStreamDestination();return mc(n,e),n.numberOfOutputs===1&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},dCe=(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},pCe=(t,e)=>(n,{mediaStreamTrack:r})=>{if(typeof n.createMediaStreamTrackSource=="function")return n.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=n.createMediaStreamSource(i);if(r.kind!=="audio")throw t();if(e(n))throw new TypeError;return s},mCe=t=>t===null?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,gCe=(t,e,n,r,i,s)=>(o,a)=>{const c=o.createOscillator();return mc(c,a),fa(c,a,"detune"),fa(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Ro(c,a,"type"),e(n,()=>n(o))||C6(c),e(r,()=>r(o))||s(c,o),e(i,()=>i(o))||R6(c),t(o,c),c},_Ce=t=>(e,n)=>{const r=e.createPanner();return r.orientationX===void 0?t(e,n):(mc(r,n),fa(r,n,"orientationX"),fa(r,n,"orientationY"),fa(r,n,"orientationZ"),fa(r,n,"positionX"),fa(r,n,"positionY"),fa(r,n,"positionZ"),Ro(r,n,"coneInnerAngle"),Ro(r,n,"coneOuterAngle"),Ro(r,n,"coneOuterGain"),Ro(r,n,"distanceModel"),Ro(r,n,"maxDistance"),Ro(r,n,"panningModel"),Ro(r,n,"refDistance"),Ro(r,n,"rolloffFactor"),r)},vCe=(t,e,n,r,i,s,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:f,coneOuterGain:d,distanceModel:p,maxDistance:m,orientationX:g,orientationY:_,orientationZ:y,panningModel:v,positionX:E,positionY:x,positionZ:A,refDistance:T,rolloffFactor:k,...L})=>{const I=u.createPanner();if(L.channelCount>2||L.channelCountMode==="max")throw o();mc(I,L);const F={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},M=n(u,{...F,channelInterpretation:"speakers",numberOfInputs:6}),D=r(u,{...L,gain:1}),O=r(u,{...F,gain:1}),z=r(u,{...F,gain:0}),q=r(u,{...F,gain:0}),G=r(u,{...F,gain:0}),K=r(u,{...F,gain:0}),te=r(u,{...F,gain:0}),re=i(u,256,6,1),H=s(u,{...F,curve:new Float32Array([1,1]),oversample:"none"});let Y=[g,_,y],Z=[E,x,A];const Q=new Float32Array(1);re.onaudioprocess=({inputBuffer:be})=>{const Pe=[c(be,Q,0),c(be,Q,1),c(be,Q,2)];Pe.some((Ze,lt)=>Ze!==Y[lt])&&(I.setOrientation(...Pe),Y=Pe);const Ge=[c(be,Q,3),c(be,Q,4),c(be,Q,5)];Ge.some((Ze,lt)=>Ze!==Z[lt])&&(I.setPosition(...Ge),Z=Ge)},Object.defineProperty(z.gain,"defaultValue",{get:()=>0}),Object.defineProperty(q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(G.gain,"defaultValue",{get:()=>0}),Object.defineProperty(K.gain,"defaultValue",{get:()=>0}),Object.defineProperty(te.gain,"defaultValue",{get:()=>0});const ie={get bufferSize(){},get channelCount(){return I.channelCount},set channelCount(be){if(be>2)throw o();D.channelCount=be,I.channelCount=be},get channelCountMode(){return I.channelCountMode},set channelCountMode(be){if(be==="max")throw o();D.channelCountMode=be,I.channelCountMode=be},get channelInterpretation(){return I.channelInterpretation},set channelInterpretation(be){D.channelInterpretation=be,I.channelInterpretation=be},get coneInnerAngle(){return I.coneInnerAngle},set coneInnerAngle(be){I.coneInnerAngle=be},get coneOuterAngle(){return I.coneOuterAngle},set coneOuterAngle(be){I.coneOuterAngle=be},get coneOuterGain(){return I.coneOuterGain},set coneOuterGain(be){if(be<0||be>1)throw e();I.coneOuterGain=be},get context(){return I.context},get distanceModel(){return I.distanceModel},set distanceModel(be){I.distanceModel=be},get inputs(){return[D]},get maxDistance(){return I.maxDistance},set maxDistance(be){if(be<0)throw new RangeError;I.maxDistance=be},get numberOfInputs(){return I.numberOfInputs},get numberOfOutputs(){return I.numberOfOutputs},get orientationX(){return O.gain},get orientationY(){return z.gain},get orientationZ(){return q.gain},get panningModel(){return I.panningModel},set panningModel(be){I.panningModel=be},get positionX(){return G.gain},get positionY(){return K.gain},get positionZ(){return te.gain},get refDistance(){return I.refDistance},set refDistance(be){if(be<0)throw new RangeError;I.refDistance=be},get rolloffFactor(){return I.rolloffFactor},set rolloffFactor(be){if(be<0)throw new RangeError;I.rolloffFactor=be},addEventListener(...be){return D.addEventListener(be[0],be[1],be[2])},dispatchEvent(...be){return D.dispatchEvent(be[0])},removeEventListener(...be){return D.removeEventListener(be[0],be[1],be[2])}};h!==ie.coneInnerAngle&&(ie.coneInnerAngle=h),f!==ie.coneOuterAngle&&(ie.coneOuterAngle=f),d!==ie.coneOuterGain&&(ie.coneOuterGain=d),p!==ie.distanceModel&&(ie.distanceModel=p),m!==ie.maxDistance&&(ie.maxDistance=m),g!==ie.orientationX.value&&(ie.orientationX.value=g),_!==ie.orientationY.value&&(ie.orientationY.value=_),y!==ie.orientationZ.value&&(ie.orientationZ.value=y),v!==ie.panningModel&&(ie.panningModel=v),E!==ie.positionX.value&&(ie.positionX.value=E),x!==ie.positionY.value&&(ie.positionY.value=x),A!==ie.positionZ.value&&(ie.positionZ.value=A),T!==ie.refDistance&&(ie.refDistance=T),k!==ie.rolloffFactor&&(ie.rolloffFactor=k),(Y[0]!==1||Y[1]!==0||Y[2]!==0)&&I.setOrientation(...Y),(Z[0]!==0||Z[1]!==0||Z[2]!==0)&&I.setPosition(...Z);const ge=()=>{D.connect(I),t(D,H,0,0),H.connect(O).connect(M,0,0),H.connect(z).connect(M,0,1),H.connect(q).connect(M,0,2),H.connect(G).connect(M,0,3),H.connect(K).connect(M,0,4),H.connect(te).connect(M,0,5),M.connect(re).connect(u.destination)},Te=()=>{D.disconnect(I),a(D,H,0,0),H.disconnect(O),O.disconnect(M),H.disconnect(z),z.disconnect(M),H.disconnect(q),q.disconnect(M),H.disconnect(G),G.disconnect(M),H.disconnect(K),K.disconnect(M),H.disconnect(te),te.disconnect(M),M.disconnect(re),re.disconnect(u.destination)};return l(ix(ie,I),ge,Te)},yCe=t=>(e,{disableNormalization:n,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,s,{disableNormalization:n});if(Array.from(r).length<2)throw t();return a},sC=(t,e,n,r)=>t.createScriptProcessor(e,n,r),bCe=(t,e)=>(n,r)=>{const i=r.channelCountMode;if(i==="clamped-max")throw e();if(n.createStereoPanner===void 0)return t(n,r);const s=n.createStereoPanner();return mc(s,r),fa(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),s},SCe=(t,e,n,r,i,s)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(p,m,g,_)=>{const y=new Float32Array(16385),v=new Float32Array(16385);for(let L=0;L<16385;L+=1){const I=L/16384*c;y[L]=Math.cos(I),v[L]=Math.sin(I)}const E=n(p,{...l,gain:0}),x=r(p,{...u,curve:y}),A=r(p,{...u,curve:a}),T=n(p,{...l,gain:0}),k=r(p,{...u,curve:v});return{connectGraph(){m.connect(E),m.connect(A.inputs===void 0?A:A.inputs[0]),m.connect(T),A.connect(g),g.connect(x.inputs===void 0?x:x.inputs[0]),g.connect(k.inputs===void 0?k:k.inputs[0]),x.connect(E.gain),k.connect(T.gain),E.connect(_,0,0),T.connect(_,0,1)},disconnectGraph(){m.disconnect(E),m.disconnect(A.inputs===void 0?A:A.inputs[0]),m.disconnect(T),A.disconnect(g),g.disconnect(x.inputs===void 0?x:x.inputs[0]),g.disconnect(k.inputs===void 0?k:k.inputs[0]),x.disconnect(E.gain),k.disconnect(T.gain),E.disconnect(_,0,0),T.disconnect(_,0,1)}}},f=(p,m,g,_)=>{const y=new Float32Array(16385),v=new Float32Array(16385),E=new Float32Array(16385),x=new Float32Array(16385),A=Math.floor(16385/2);for(let G=0;G<16385;G+=1)if(G>A){const K=(G-A)/(16384-A)*c;y[G]=Math.cos(K),v[G]=Math.sin(K),E[G]=0,x[G]=1}else{const K=G/(16384-A)*c;y[G]=1,v[G]=0,E[G]=Math.cos(K),x[G]=Math.sin(K)}const T=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),k=n(p,{...l,gain:0}),L=r(p,{...u,curve:y}),I=n(p,{...l,gain:0}),F=r(p,{...u,curve:v}),M=r(p,{...u,curve:a}),D=n(p,{...l,gain:0}),O=r(p,{...u,curve:E}),z=n(p,{...l,gain:0}),q=r(p,{...u,curve:x});return{connectGraph(){m.connect(T),m.connect(M.inputs===void 0?M:M.inputs[0]),T.connect(k,0),T.connect(I,0),T.connect(D,1),T.connect(z,1),M.connect(g),g.connect(L.inputs===void 0?L:L.inputs[0]),g.connect(F.inputs===void 0?F:F.inputs[0]),g.connect(O.inputs===void 0?O:O.inputs[0]),g.connect(q.inputs===void 0?q:q.inputs[0]),L.connect(k.gain),F.connect(I.gain),O.connect(D.gain),q.connect(z.gain),k.connect(_,0,0),D.connect(_,0,0),I.connect(_,0,1),z.connect(_,0,1)},disconnectGraph(){m.disconnect(T),m.disconnect(M.inputs===void 0?M:M.inputs[0]),T.disconnect(k,0),T.disconnect(I,0),T.disconnect(D,1),T.disconnect(z,1),M.disconnect(g),g.disconnect(L.inputs===void 0?L:L.inputs[0]),g.disconnect(F.inputs===void 0?F:F.inputs[0]),g.disconnect(O.inputs===void 0?O:O.inputs[0]),g.disconnect(q.inputs===void 0?q:q.inputs[0]),L.disconnect(k.gain),F.disconnect(I.gain),O.disconnect(D.gain),q.disconnect(z.gain),k.disconnect(_,0,0),D.disconnect(_,0,0),I.disconnect(_,0,1),z.disconnect(_,0,1)}}},d=(p,m,g,_,y)=>{if(m===1)return h(p,g,_,y);if(m===2)return f(p,g,_,y);throw i()};return(p,{channelCount:m,channelCountMode:g,pan:_,...y})=>{if(g==="max")throw i();const v=t(p,{...y,channelCount:1,channelCountMode:g,numberOfInputs:2}),E=n(p,{...y,channelCount:m,channelCountMode:g,gain:1}),x=n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:_});let{connectGraph:A,disconnectGraph:T}=d(p,m,E,x,v);Object.defineProperty(x.gain,"defaultValue",{get:()=>0}),Object.defineProperty(x.gain,"maxValue",{get:()=>1}),Object.defineProperty(x.gain,"minValue",{get:()=>-1});const k={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(M){E.channelCount!==M&&(L&&T(),{connectGraph:A,disconnectGraph:T}=d(p,M,E,x,v),L&&A()),E.channelCount=M},get channelCountMode(){return E.channelCountMode},set channelCountMode(M){if(M==="clamped-max"||M==="max")throw i();E.channelCountMode=M},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(M){E.channelInterpretation=M},get context(){return E.context},get inputs(){return[E]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get pan(){return x.gain},addEventListener(...M){return E.addEventListener(M[0],M[1],M[2])},dispatchEvent(...M){return E.dispatchEvent(M[0])},removeEventListener(...M){return E.removeEventListener(M[0],M[1],M[2])}};let L=!1;const I=()=>{A(),L=!0},F=()=>{T(),L=!1};return s(ix(k,v),I,F)}},ECe=(t,e,n,r,i,s,o)=>(a,c)=>{const l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return n(a,c);mc(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Ro(l,{curve:u},"curve"),Ro(l,c,"oversample");let h=null,f=!1;return o(l,"curve",m=>()=>m.call(l),m=>g=>(m.call(l,g),f&&(r(g)&&h===null?h=t(a,l):!r(g)&&h!==null&&(h(),h=null)),g)),i(l,()=>{f=!0,r(l.curve)&&(h=t(a,l))},()=>{f=!1,h!==null&&(h(),h=null)})},xCe=(t,e,n,r,i)=>(s,{curve:o,oversample:a,...c})=>{const l=s.createWaveShaper(),u=s.createWaveShaper();mc(l,c),mc(u,c);const h=n(s,{...c,gain:1}),f=n(s,{...c,gain:-1}),d=n(s,{...c,gain:1}),p=n(s,{...c,gain:-1});let m=null,g=!1,_=null;const y={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(x){h.channelCount=x,f.channelCount=x,l.channelCount=x,d.channelCount=x,u.channelCount=x,p.channelCount=x},get channelCountMode(){return l.channelCountMode},set channelCountMode(x){h.channelCountMode=x,f.channelCountMode=x,l.channelCountMode=x,d.channelCountMode=x,u.channelCountMode=x,p.channelCountMode=x},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(x){h.channelInterpretation=x,f.channelInterpretation=x,l.channelInterpretation=x,d.channelInterpretation=x,u.channelInterpretation=x,p.channelInterpretation=x},get context(){return l.context},get curve(){return _},set curve(x){if(x!==null&&x.length<2)throw e();if(x===null)l.curve=x,u.curve=x;else{const A=x.length,T=new Float32Array(A+2-A%2),k=new Float32Array(A+2-A%2);T[0]=x[0],k[0]=-x[A-1];const L=Math.ceil((A+1)/2),I=(A+1)/2-1;for(let F=1;F<L;F+=1){const M=F/L*I,D=Math.floor(M),O=Math.ceil(M);T[F]=D===O?x[D]:(1-(M-D))*x[D]+(1-(O-M))*x[O],k[F]=D===O?-x[A-1-D]:-((1-(M-D))*x[A-1-D])-(1-(O-M))*x[A-1-O]}T[L]=A%2===1?x[L-1]:(x[L-2]+x[L-1])/2,l.curve=T,u.curve=k}_=x,g&&(r(_)&&m===null?m=t(s,h):m!==null&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(x){l.oversample=x,u.oversample=x},addEventListener(...x){return h.addEventListener(x[0],x[1],x[2])},dispatchEvent(...x){return h.dispatchEvent(x[0])},removeEventListener(...x){return h.removeEventListener(x[0],x[1],x[2])}};o!==null&&(y.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==y.oversample&&(y.oversample=a);const v=()=>{h.connect(l).connect(d),h.connect(f).connect(u).connect(p).connect(d),g=!0,r(_)&&(m=t(s,h))},E=()=>{h.disconnect(l),l.disconnect(d),h.disconnect(f),f.disconnect(u),u.disconnect(p),p.disconnect(d),g=!1,m!==null&&(m(),m=null)};return i(ix(y,d),v,E)},bu=()=>new DOMException("","NotSupportedError"),wCe={numberOfChannels:1},TCe=(t,e,n,r,i)=>class extends t{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:f}={...wCe,...l},d=r(h,u,f);e(mA,()=>mA(d))||d.addEventListener("statechange",(()=>{let p=0;const m=g=>{this._state==="running"&&(p>0?(d.removeEventListener("statechange",m),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):p+=1)};return m})()),super(d,h),this._length=u,this._nativeOfflineAudioContext=d,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,YZ(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},ACe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},CCe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...ACe,...l},f=n(u,h),d=s(u),p=d?r():null,m=c.sampleRate/2;super(c,!1,f,p),this._detune=e(this,d,f.detune,153600,-153600),this._frequency=e(this,d,f.frequency,m,-m),this._nativeOscillatorNode=f,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){PE(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),xg(this)&&tC(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},RCe=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let f=n(u);const d=Ul(f,h);if(!d){const p={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:o===null?void 0:o,type:f.type};f=e(h,p),a!==null&&f.start(a),c!==null&&f.stop(c)}return s.set(h,f),d?(await t(h,u.detune,f.detune),await t(h,u.frequency,f.frequency)):(await r(h,u.detune,f.detune),await r(h,u.frequency,f.frequency)),await i(u,h,f),f};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const f=s.get(h);return f!==void 0?Promise.resolve(f):l(u,h)}}},kCe={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},MCe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...kCe,...l},f=n(u,h),d=s(u),p=d?r():null;super(c,!1,f,p),this._nativePannerNode=f,this._orientationX=e(this,d,f.orientationX,ou,sh),this._orientationY=e(this,d,f.orientationY,ou,sh),this._orientationZ=e(this,d,f.orientationZ,ou,sh),this._positionX=e(this,d,f.positionX,ou,sh),this._positionY=e(this,d,f.positionY,ou,sh),this._positionZ=e(this,d,f.positionZ,ou,sh),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},OCe=(t,e,n,r,i,s,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const f=async(d,p)=>{let m=null,g=s(d);const _={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},y={..._,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},v=Ul(g,p);if("bufferSize"in g)m=r(p,{..._,gain:1});else if(!v){const E={...y,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=i(p,E)}if(u.set(p,m===null?g:m),m!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const F=new o(6,d.context.length,p.sampleRate),M=e(F,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});M.connect(F.destination),h=(async()=>{const D=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(async(O,z)=>{const q=n(F,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:z===0?1:0});return await a(F,O,q.offset),q}));for(let O=0;O<6;O+=1)D[O].connect(M,0,O),D[O].start(0);return l(F)})()}const E=await h,x=r(p,{..._,gain:1});await c(d,p,x);const A=[];for(let F=0;F<E.numberOfChannels;F+=1)A.push(E.getChannelData(F));let T=[A[0][0],A[1][0],A[2][0]],k=[A[3][0],A[4][0],A[5][0]],L=r(p,{..._,gain:1}),I=i(p,{...y,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:k[0],positionY:k[1],positionZ:k[2]});x.connect(L).connect(I.inputs[0]),I.connect(m);for(let F=128;F<E.length;F+=128){const M=[A[0][F],A[1][F],A[2][F]],D=[A[3][F],A[4][F],A[5][F]];if(M.some((O,z)=>O!==T[z])||D.some((O,z)=>O!==k[z])){T=M,k=D;const O=F/p.sampleRate;L.gain.setValueAtTime(0,O),L=r(p,{..._,gain:0}),I=i(p,{...y,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:k[0],positionY:k[1],positionZ:k[2]}),L.gain.setValueAtTime(1,O),x.connect(L).connect(I.inputs[0]),I.connect(m)}}return m}return v?(await t(p,d.orientationX,g.orientationX),await t(p,d.orientationY,g.orientationY),await t(p,d.orientationZ,g.orientationZ),await t(p,d.positionX,g.positionX),await t(p,d.positionY,g.positionY),await t(p,d.positionZ,g.positionZ)):(await a(p,d.orientationX,g.orientationX),await a(p,d.orientationY,g.orientationY),await a(p,d.orientationZ,g.orientationZ),await a(p,d.positionX,g.positionX),await a(p,d.positionY,g.positionY),await a(p,d.positionZ,g.positionZ)),rx(g)?await c(d,p,g.inputs[0]):await c(d,p,g),g};return{render(d,p){const m=u.get(p);return m!==void 0?Promise.resolve(m):f(d,p)}}},ICe={disableNormalization:!1},NCe=(t,e,n,r)=>class iQ{constructor(s,o){const a=e(s),c=r({...ICe,...o}),l=t(a,c);return n.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===iQ.prototype||n.has(s)}},PCe=(t,e)=>(n,r,i)=>(t(r).replay(i),e(r,n,i)),DCe=(t,e,n)=>async(r,i,s)=>{const o=t(r);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const f=await e(l).render(l,i),d=r.context.destination;!n(l)&&(r!==d||!n(r))&&f.connect(s,u,c)})).reduce((a,c)=>[...a,...c],[]))},LCe=(t,e,n)=>async(r,i,s)=>{const o=e(r);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await t(a).render(a,i);n(a)||u.connect(s,c)}))},UCe=(t,e,n,r)=>i=>t(mA,()=>mA(i))?Promise.resolve(t(r,r)).then(s=>{if(!s){const o=n(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),BCe=t=>(e,n)=>{t.set(e,n)},FCe=t=>(e,n)=>t.set(e,n),jCe=(t,e,n,r,i,s,o,a)=>(c,l)=>n(c).render(c,l).then(()=>Promise.all(Array.from(r(l)).map(u=>n(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),w6(u)):e(s,()=>s(u))||a(u),t.add(u),u)),zCe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},VCe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...zCe,...c},h=n(l,u),f=s(l),d=f?r():null;super(a,!1,h,d),this._pan=e(this,f,h.pan)}get pan(){return this._pan}},HCe=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=Ul(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return s.set(c,l),u?await t(c,a.pan,l.pan):await r(c,a.pan,l.pan),rx(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},$Ce=t=>()=>{if(t===null)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},GCe=(t,e)=>async()=>{if(t===null)return!0;if(e===null)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(n);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new t(r,"a",{numberOfOutputs:0}),c=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await r.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},WCe=(t,e)=>()=>{if(e===null)return Promise.resolve(!1);const n=new e(1,1,44100),r=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{n.oncomplete=()=>{r.disconnect(),i(n.currentTime!==0)},n.startRendering()})},qCe=()=>new DOMException("","UnknownError"),YCe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},KCe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),h={...YCe,...l},f=n(u,h),p=s(u)?r():null;super(c,!0,f,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=f,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},XCe=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Ul(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(o,l)}return r.set(o,a),rx(a)?await n(s,o,a.inputs[0]):await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},JCe=()=>typeof window>"u"?null:window,ZCe=(t,e)=>n=>{n.copyFromChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)r[h]=l[h+o]},n.copyToChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=r[h]}},QCe=t=>e=>{e.copyFromChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyToChannel)},eRe=t=>(e,n)=>{const r=n.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),t(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},tRe=(t,e)=>(n,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(r,()=>{const a=r.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(r,0,c)},()=>i.disconnect(r))},sQ=(t,e,n)=>t.copyFromChannel===void 0?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),oQ=t=>{if(t===null)return!1;const e=t.length;return e%2!==0?t[Math.floor(e/2)]!==0:t[e/2-1]+t[e/2]!==0},oC=(t,e,n,r)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(s),set:r(o)})},nRe=t=>({...t,outputChannelCount:t.outputChannelCount!==void 0?t.outputChannelCount:t.numberOfInputs===1&&t.numberOfOutputs===1?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),rRe=t=>({...t,channelCount:t.numberOfOutputs}),iRe=t=>{const{imag:e,real:n}=t;return e===void 0?n===void 0?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:n===void 0?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}},aQ=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(r){if(r.code!==9)throw r;aQ(t,e,n+1e-7)}},sRe=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},oRe=t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},aRe=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},k6=t=>{const e=t.createOscillator();try{e.start(-1)}catch(n){return n instanceof RangeError}return!1},cQ=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},M6=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(n){return n instanceof RangeError}return!1},cRe=t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}},lRe=t=>{t.start=(e=>(n=0,r=0,i)=>{const s=t.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})(t.start)},lQ=(t,e)=>{const n=e.createGain();t.connect(n);const r=(i=>()=>{i.call(t,n),t.removeEventListener("ended",r)})(t.disconnect);t.addEventListener("ended",r),ix(t,n),t.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(t,o)}catch{n.gain.setValueAtTime(0,o)}else i.call(t,o),s=!0}})(t.stop)},sx=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),typeof e=="function"?e.call(t,n):e.handleEvent.call(t,n)},uRe=Mwe(nb),hRe=Lwe(nb),fRe=YTe(YO),uQ=new WeakMap,dRe=fAe(uQ),_p=wTe(new Map,new WeakMap),Bm=JCe(),hQ=VAe(_p,Km),O6=hAe(hu),ol=DCe(hu,O6,D1),pRe=zwe(hQ,Eo,ol),co=mAe(qO),Fg=mCe(Bm),zs=IAe(Fg),fQ=new WeakMap,dQ=iAe(sx),aC=WAe(Bm),I6=RAe(aC),N6=kAe(Bm),pQ=MAe(Bm),gA=YAe(Bm),Pa=fTe(Owe(zZ),Dwe(uRe,hRe,kM,fRe,MM,hu,dRe,eC,Eo,nb,xg,D1,xk),_p,xAe(zL,MM,hu,Eo,pA,xg),Km,KO,bu,$Te(kM,zL,hu,Eo,pA,co,xg,zs),JTe(fQ,hu,cp),dQ,co,I6,N6,pQ,zs,gA),mRe=jwe(Pa,pRe,Km,hQ,co,zs),P6=new WeakSet,Zj=HAe(Bm),mQ=UTe(new Uint32Array(1)),D6=ZCe(mQ,Km),L6=QCe(mQ),gQ=Hwe(P6,_p,bu,Zj,Fg,$Ce(Zj),D6,L6),XO=Uwe(Eh),_Q=LCe(O6,nC,D1),Xm=OTe(_Q),ox=GAe(XO,_p,sRe,oRe,aRe,k6,cQ,M6,lRe,eRe(oC),lQ),Jm=PCe(dAe(nC),_Q),gRe=Wwe(Xm,ox,Eo,Jm,ol),vp=dTe(Iwe(VZ),fQ,x6,pTe,wwe,Twe,Awe,Cwe,Rwe,BL,FZ,aC,aQ),_Re=Gwe(Pa,gRe,vp,Uc,ox,co,zs,sx),vRe=tTe(Pa,nTe,Km,Uc,qAe(Eh,oC),co,zs,ol),yRe=xTe(Xm,nQ,Eo,Jm,ol),rb=FCe(uQ),bRe=ETe(Pa,vp,yRe,KO,nQ,co,zs,rb),Ov=jAe(nb,N6),SRe=tRe(Uc,Ov),Iv=tCe(aC,SRe),ERe=CTe(Iv,Eo,ol),xRe=ATe(Pa,ERe,Iv,co,zs),wRe=MTe(iC,Eo,ol),TRe=kTe(Pa,wRe,iC,co,zs,rRe),ARe=iCe(XO,ox,Eh,Ov),ax=rCe(XO,_p,ARe,k6,M6),CRe=LTe(Xm,ax,Eo,Jm,ol),RRe=DTe(Pa,vp,CRe,ax,co,zs,sx),vQ=sCe(bu,oC),kRe=jTe(vQ,Eo,ol),MRe=FTe(Pa,kRe,vQ,co,zs,rb),ORe=qTe(Xm,rQ,Eo,Jm,ol),IRe=WTe(Pa,vp,ORe,rQ,co,zs,rb),yQ=oCe(bu),NRe=tAe(Xm,yQ,Eo,Jm,ol),PRe=eAe(Pa,vp,NRe,yQ,bu,co,zs,rb),DRe=lAe(Xm,Eh,Eo,Jm,ol),LRe=cAe(Pa,vp,DRe,Eh,co,zs),URe=uCe(KO,Uc,sC,bu),JO=UCe(_p,Eh,sC,WCe(Eh,Fg)),BRe=EAe(ox,Eo,Fg,ol,JO),FRe=aCe(URe),jRe=bAe(Pa,FRe,BRe,co,zs,rb),zRe=rTe(vp,Iv,ax,sC,bu,sQ,zs,oC),bQ=new WeakMap,VRe=FAe(vRe,zRe,dQ,zs,bQ,sx),SQ=gCe(XO,_p,k6,cQ,M6,lQ),HRe=RCe(Xm,SQ,Eo,Jm,ol),$Re=CCe(Pa,vp,SQ,HRe,co,zs,sx),xQ=NTe(ox),GRe=xCe(xQ,Uc,Eh,oQ,Ov),ZO=ECe(xQ,Uc,GRe,oQ,Ov,aC,oC),WRe=vCe(kM,Uc,Iv,Eh,sC,ZO,bu,MM,sQ,Ov),wQ=_Ce(WRe),qRe=OCe(Xm,Iv,ax,Eh,wQ,Eo,Fg,Jm,ol,JO),YRe=MCe(Pa,vp,wQ,qRe,co,zs,rb),KRe=yCe(Km),XRe=NCe(KRe,co,new WeakSet,iRe),JRe=SCe(Iv,iC,Eh,ZO,bu,Ov),TQ=bCe(JRe,bu),ZRe=HCe(Xm,TQ,Eo,Jm,ol),QRe=VCe(Pa,vp,TQ,ZRe,co,zs),eke=XCe(ZO,Eo,ol),tke=KCe(Pa,Uc,ZO,eke,co,zs,rb),AQ=NAe(Bm),U6=sAe(Bm),CQ=new WeakMap,nke=gAe(CQ,Fg),rke=AQ?Pwe(_p,bu,rAe(Bm),U6,oAe(kwe),co,nke,zs,gA,new WeakMap,new WeakMap,GCe(gA,Fg),Bm):void 0,ike=OAe(I6,zs),ske=HTe(P6,_p,VTe,nAe,new WeakSet,co,ike,CM,mA,D6,L6),RQ=bTe(rke,mRe,gQ,_Re,bRe,xRe,TRe,RRe,MRe,ske,IRe,PRe,LRe,jRe,VRe,$Re,YRe,XRe,QRe,tke),oke=PAe(Pa,hCe,co,zs),ake=LAe(Pa,fCe,co,zs),cke=UAe(Pa,dCe,co,zs),lke=pCe(Uc,zs),uke=BAe(Pa,lke,co),hke=eTe(RQ,Uc,bu,qCe,oke,ake,cke,uke,aC),B6=_Ae(bQ),fke=Bwe(B6),kQ=ITe(Km),dke=KTe(B6),MQ=ZTe(Km),OQ=new WeakMap,pke=uAe(OQ,cp),mke=eCe(kQ,Km,Uc,Iv,iC,ax,Eh,sC,bu,MQ,U6,pke,Ov),gke=XAe(Uc,mke,Eh,bu,Ov),_ke=yTe(Xm,kQ,ox,Iv,iC,ax,Eh,dke,MQ,U6,Eo,gA,Fg,Jm,ol,JO),vke=pAe(CQ),yke=BCe(OQ),Qj=AQ?gTe(fke,Pa,vp,_ke,gke,hu,vke,co,zs,gA,nRe,yke,cRe,sx):void 0,bke=zTe(bu,Fg),Ske=jCe(P6,_p,O6,B6,JO,CM,D6,L6),Eke=TCe(RQ,_p,Uc,bke,Ske),xke=wAe(qO,I6),wke=TAe(E6,N6),Tke=AAe(x6,pQ),Ake=CAe(qO,zs);function af(t){return t===void 0}function xi(t){return t!==void 0}function Cke(t){return typeof t=="function"}function lp(t){return typeof t=="number"}function lv(t){return Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object}function IQ(t){return typeof t=="boolean"}function ph(t){return Array.isArray(t)}function Og(t){return typeof t=="string"}function SR(t){return Og(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function Ir(t,e){if(!t)throw new Error(e)}function Kf(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function NQ(t){!t.isOffline&&t.state!=="running"&&QO('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let PQ=!1,e9=!1;function t9(t){PQ=t}function Rke(t){af(t)&&PQ&&!e9&&(e9=!0,QO("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let DQ=console;function kke(...t){DQ.log(...t)}function QO(...t){DQ.warn(...t)}function Mke(t){return new hke(t)}function Oke(t,e,n){return new Eke(t,e,n)}const Jh=typeof self=="object"?self:null,Ike=Jh&&(Jh.hasOwnProperty("AudioContext")||Jh.hasOwnProperty("webkitAudioContext"));function Nke(t,e,n){return Ir(xi(Qj),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof Jh?.BaseAudioContext?Jh?.AudioWorkletNode:Qj)(t,e,n)}var WL=function(t,e){return WL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},WL(t,e)};function eI(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");WL(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var PM=function(){return PM=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},PM.apply(this,arguments)};function LQ(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Vs(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function UQ(t,e){return function(n,r){e(n,r,t)}}function BQ(t,e,n,r,i,s){function o(_){if(_!==void 0&&typeof _!="function")throw new TypeError("Function expected");return _}for(var a=r.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&t?r.static?t:t.prototype:null,u=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,d=n.length-1;d>=0;d--){var p={};for(var m in r)p[m]=m==="access"?{}:r[m];for(var m in r.access)p.access[m]=r.access[m];p.addInitializer=function(_){if(f)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(_||null))};var g=(0,n[d])(a==="accessor"?{get:u.get,set:u.set}:u[c],p);if(a==="accessor"){if(g===void 0)continue;if(g===null||typeof g!="object")throw new TypeError("Object expected");(h=o(g.get))&&(u.get=h),(h=o(g.set))&&(u.set=h),(h=o(g.init))&&i.unshift(h)}else(h=o(g))&&(a==="field"?i.unshift(h):u[c]=h)}l&&Object.defineProperty(l,r.name,u),f=!0}function FQ(t,e,n){for(var r=arguments.length>2,i=0;i<e.length;i++)n=r?e[i].call(t,n):e[i].call(t);return r?n:void 0}function jQ(t){return typeof t=="symbol"?t:"".concat(t)}function zQ(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function VQ(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function oo(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function cC(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var tI=Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]});function HQ(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&tI(e,t,n)}function DM(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ib(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function $Q(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ib(arguments[e]));return t}function GQ(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function _A(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function DE(t){return this instanceof DE?(this.v=t,this):new DE(t)}function WQ(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(d){return function(p){return Promise.resolve(p).then(d,h)}}function a(d,p){r[d]&&(i[d]=function(m){return new Promise(function(g,_){s.push([d,m,g,_])>1||c(d,m)})},p&&(i[d]=p(i[d])))}function c(d,p){try{l(r[d](p))}catch(m){f(s[0][3],m)}}function l(d){d.value instanceof DE?Promise.resolve(d.value.v).then(u,h):f(s[0][2],d)}function u(d){c("next",d)}function h(d){c("throw",d)}function f(d,p){d(p),s.shift(),s.length&&c(s[0][0],s[0][1])}}function qQ(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:DE(t[i](o)),done:!1}:s?s(o):o}:s}}function YQ(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof DM=="function"?DM(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function KQ(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var Pke=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},qL=function(t){return qL=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},qL(t)};function XQ(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=qL(t),r=0;r<n.length;r++)n[r]!=="default"&&tI(e,t,n[r]);return Pke(e,t),e}function JQ(t){return t&&t.__esModule?t:{default:t}}function ZQ(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function QQ(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}function eee(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function tee(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var Dke=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function nee(t){function e(s){t.error=t.hasError?new Dke(s,t.error,"An error was suppressed during disposal."):s,t.hasError=!0}var n,r=0;function i(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(i);if(n.dispose){var s=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return i()}function ree(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?n:i+s+"."+o.toLowerCase()+"js"}):t}const Lke={__extends:eI,__assign:PM,__rest:LQ,__decorate:Vs,__param:UQ,__esDecorate:BQ,__runInitializers:FQ,__propKey:jQ,__setFunctionName:zQ,__metadata:VQ,__awaiter:oo,__generator:cC,__createBinding:tI,__exportStar:HQ,__values:DM,__read:ib,__spread:$Q,__spreadArrays:GQ,__spreadArray:_A,__await:DE,__asyncGenerator:WQ,__asyncDelegator:qQ,__asyncValues:YQ,__makeTemplateObject:KQ,__importStar:XQ,__importDefault:JQ,__classPrivateFieldGet:ZQ,__classPrivateFieldSet:QQ,__classPrivateFieldIn:eee,__addDisposableResource:tee,__disposeResources:nee,__rewriteRelativeImportExtension:ree},Uke=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:tee,get __assign(){return PM},__asyncDelegator:qQ,__asyncGenerator:WQ,__asyncValues:YQ,__await:DE,__awaiter:oo,__classPrivateFieldGet:ZQ,__classPrivateFieldIn:eee,__classPrivateFieldSet:QQ,__createBinding:tI,__decorate:Vs,__disposeResources:nee,__esDecorate:BQ,__exportStar:HQ,__extends:eI,__generator:cC,__importDefault:JQ,__importStar:XQ,__makeTemplateObject:KQ,__metadata:VQ,__param:UQ,__propKey:jQ,__read:ib,__rest:LQ,__rewriteRelativeImportExtension:ree,__runInitializers:FQ,__setFunctionName:zQ,__spread:$Q,__spreadArray:_A,__spreadArrays:GQ,__values:DM,default:Lke},Symbol.toStringTag,{value:"Module"}));class Bke{constructor(e,n,r,i){this._callback=e,this._type=n,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);r.onmessage=this._callback.bind(this),this._worker=r}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var n;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((n=this._worker)===null||n===void 0||n.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function L1(t){return Tke(t)}function uv(t){return wke(t)}function wk(t){return Ake(t)}function zS(t){return xke(t)}function Fke(t){return t instanceof gQ}function jke(t,e){return t==="value"||L1(e)||uv(e)||Fke(e)}function hv(t,...e){if(!e.length)return t;const n=e.shift();if(lv(t)&&lv(n))for(const r in n)jke(r,n[r])?t[r]=n[r]:lv(n[r])?(t[r]||Object.assign(t,{[r]:{}}),hv(t[r],n[r])):Object.assign(t,{[r]:n[r]});return hv(t,...e)}function zke(t,e){return t.length===e.length&&t.every((n,r)=>e[r]===n)}function Yn(t,e,n=[],r){const i={},s=Array.from(e);if(lv(s[0])&&r&&!Reflect.has(s[0],r)&&(Object.keys(s[0]).some(a=>Reflect.has(t,a))||(hv(i,{[r]:s[0]}),n.splice(n.indexOf(r),1),s.shift())),s.length===1&&lv(s[0]))hv(i,s[0]);else for(let o=0;o<n.length;o++)xi(s[o])&&(i[n[o]]=s[o]);return hv(t,i)}function Vke(t){return t.constructor.getDefaults()}function Im(t,e){return af(t)?e:t}function kc(t,e){return e.forEach(n=>{Reflect.has(t,n)&&delete t[n]}),t}class jg{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Jh&&this.toString()===Jh.TONE_DEBUG_CLASS)&&kke(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}jg.version=BZ;const F6=1e-6;function LE(t,e){return t>e+F6}function YL(t,e){return LE(t,e)||Jd(t,e)}function LM(t,e){return t+F6<e}function Jd(t,e){return Math.abs(t-e)<F6}function Hke(t,e,n){return Math.max(Math.min(t,n),e)}class ed extends jg{constructor(){super(),this.name="Timeline",this._timeline=[];const e=Yn(ed.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(Ir(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const n=this._timeline[this.length-1];Ir(YL(e.time,n.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const n=this._search(e.time);this._timeline.splice(n+1,0,e)}if(this.length>this.memory){const n=this.length-this.memory;this._timeline.splice(0,n)}return this}remove(e){const n=this._timeline.indexOf(e);return n!==-1&&this._timeline.splice(n,1),this}get(e,n="time"){const r=this._search(e,n);return r!==-1?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,n="time"){const r=this._search(e,n);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(e){const n=this._timeline.length;if(n>0&&this._timeline[n-1].time<e)return this._timeline[n-1];const r=this._search(e);return r-1>=0?this._timeline[r-1]:null}cancel(e){if(this._timeline.length>1){let n=this._search(e);if(n>=0)if(Jd(this._timeline[n].time,e)){for(let r=n;r>=0&&Jd(this._timeline[r].time,e);r--)n=r;this._timeline=this._timeline.slice(0,n)}else this._timeline=this._timeline.slice(0,n+1);else this._timeline=[]}else this._timeline.length===1&&YL(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const n=this._search(e);return n>=0&&(this._timeline=this._timeline.slice(n+1)),this}previousEvent(e){const n=this._timeline.indexOf(e);return n>0?this._timeline[n-1]:null}_search(e,n="time"){if(this._timeline.length===0)return-1;let r=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][n]<=e)return i-1;for(;r<s;){let o=Math.floor(r+(s-r)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Jd(a[n],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(Jd(u[n],e))o=l;else break}return o}else{if(LM(a[n],e)&&LE(c[n],e))return o;LE(a[n],e)?s=o:r=o+1}}return-1}_iterate(e,n=0,r=this._timeline.length-1){this._timeline.slice(n,r+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,n){const r=this._search(e);return r!==-1&&this._iterate(n,0,r),this}forEachAfter(e,n){const r=this._search(e);return this._iterate(n,r+1),this}forEachBetween(e,n,r){let i=this._search(e),s=this._search(n);return i!==-1&&s!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[s].time===n&&(s-=1),this._iterate(r,i,s)):i===-1&&this._iterate(r,0,s),this}forEachFrom(e,n){let r=this._search(e);for(;r>=0&&this._timeline[r].time>=e;)r--;return this._iterate(n,r+1),this}forEachAtTime(e,n){const r=this._search(e);if(r!==-1&&Jd(this._timeline[r].time,e)){let i=r;for(let s=r;s>=0&&Jd(this._timeline[s].time,e);s--)i=s;this._iterate(s=>{n(s)},i,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const iee=[];function nI(t){iee.push(t)}function $ke(t){iee.forEach(e=>e(t))}const see=[];function rI(t){see.push(t)}function Gke(t){see.forEach(e=>e(t))}class lC extends jg{constructor(){super(...arguments),this.name="Emitter"}on(e,n){return e.split(/\W+/).forEach(i=>{af(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(n)}),this}once(e,n){const r=(...i)=>{n(...i),this.off(e,r)};return this.on(e,r),this}off(e,n){return e.split(/\W+/).forEach(i=>{if(af(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(af(n))this._events[i]=[];else{const s=this._events[i];for(let o=s.length-1;o>=0;o--)s[o]===n&&s.splice(o,1)}}),this}emit(e,...n){if(this._events&&this._events.hasOwnProperty(e)){const r=this._events[e].slice(0);for(let i=0,s=r.length;i<s;i++)r[i].apply(this,n)}return this}static mixin(e){["on","once","off","emit"].forEach(n=>{const r=Object.getOwnPropertyDescriptor(lC.prototype,n);Object.defineProperty(e.prototype,n,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class oee extends lC{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class cx extends oee{constructor(){var e,n;super(),this.name="Context",this._constants=new Map,this._timeouts=new ed,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const r=Yn(cx.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=Mke({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new Bke(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((n=arguments[0])===null||n===void 0)&&n.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||($ke(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,n,r){return this._context.createBuffer(e,n,r)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,n){return this._context.createIIRFilter(e,n)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,n,r){return this._context.createPeriodicWave(e,n,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return Ir(zS(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return Ir(zS(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return Ir(zS(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){Ir(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){Ir(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){Ir(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){Ir(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,n){return Nke(this.rawContext,e,n)}addAudioWorkletModule(e){return oo(this,void 0,void 0,function*(){Ir(xi(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return oo(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return zS(this._context)?this._context.resume():Promise.resolve()}close(){return oo(this,void 0,void 0,function*(){zS(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&Gke(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const n=this._context.createBuffer(1,128,this._context.sampleRate),r=n.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=n,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,n=>{n.callback(),this._timeouts.remove(n)})}setTimeout(e,n){this._timeoutIds++;const r=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:r+n}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(n=>{n.id===e&&this._timeouts.remove(n)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,n){const r=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),i()},id:r,time:s+n})};return i(),r}}class Wke extends oee{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,n,r){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,n){return{}}createPanner(){return{}}createPeriodicWave(e,n,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,n){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return oo(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,n){return 0}clearTimeout(e){return this}setInterval(e,n){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function yi(t,e){ph(e)?e.forEach(n=>yi(t,n)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function uC(t,e){ph(e)?e.forEach(n=>uC(t,n)):Object.defineProperty(t,e,{writable:!0})}const hs=()=>{};class Fs extends jg{constructor(){super(),this.name="ToneAudioBuffer",this.onload=hs;const e=Yn(Fs.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,Og(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:hs,onload:hs,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:bo().sampleRate}set(e){return e instanceof Fs?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return oo(this,void 0,void 0,function*(){const n=Fs.load(e).then(r=>{this.set(r),this.onload(this)});Fs.downloads.push(n);try{yield n}finally{const r=Fs.downloads.indexOf(n);Fs.downloads.splice(r,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const n=ph(e)&&e[0].length>0,r=n?e.length:1,i=n?e[0].length:e.length,s=bo(),o=s.createBuffer(r,i,s.sampleRate),a=!n&&r===1?[e]:e;for(let c=0;c<r;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(lp(e))this.fromArray(this.toArray(e));else{let n=new Float32Array(this.length);const r=this.numberOfChannels;for(let i=0;i<r;i++){const s=this.toArray(i);for(let o=0;o<s.length;o++)n[o]+=s[o]}n=n.map(i=>i/r),this.fromArray(n)}return this}toArray(e){if(lp(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const n=[];for(let r=0;r<this.numberOfChannels;r++)n[r]=this.getChannelData(r);return n}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,n=this.duration){Ir(this.loaded,"Buffer is not loaded");const r=Math.floor(e*this.sampleRate),i=Math.floor(n*this.sampleRate);Ir(r<i,"The start time must be less than the end time");const s=i-r,o=bo().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(r,i),a);return new Fs(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Fs().fromArray(e)}static fromUrl(e){return oo(this,void 0,void 0,function*(){return yield new Fs().load(e)})}static load(e){return oo(this,void 0,void 0,function*(){const n=Fs.baseUrl===""||Fs.baseUrl.endsWith("/")?Fs.baseUrl:Fs.baseUrl+"/",r=yield fetch(n+e);if(!r.ok)throw new Error(`could not load url: ${e}`);const i=yield r.arrayBuffer();return yield bo().decodeAudioData(i)})}static supportsType(e){const n=e.split("."),r=n[n.length-1];return document.createElement("audio").canPlayType("audio/"+r)!==""}static loaded(){return oo(this,void 0,void 0,function*(){for(yield Promise.resolve();Fs.downloads.length;)yield Fs.downloads[0]})}}Fs.baseUrl="";Fs.downloads=[];class hC extends cx{constructor(){super({clockSource:"offline",context:wk(arguments[0])?arguments[0]:Oke(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:wk(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=wk(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return oo(this,void 0,void 0,function*(){let n=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,n++;const r=Math.floor(this.sampleRate/128);e&&n%r===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return oo(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const n=yield this._context.startRendering();return new Fs(n)})}close(){return Promise.resolve()}}const aee=new Wke;let h1=aee;function bo(){return h1===aee&&Ike&&UM(new cx),h1}function UM(t,e=!1){e&&h1.dispose(),zS(t)?h1=new cx(t):wk(t)?h1=new hC(t):h1=t}function qke(){return h1.resume()}if(Jh&&!Jh.TONE_SILENCE_LOGGING){const e=` * Tone.js v${BZ} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function cee(t){return Math.pow(10,t/20)}function lee(t){return 20*(Math.log(t)/Math.LN10)}function uee(t){return Math.pow(2,t/12)}let iI=440;function Yke(){return iI}function Kke(t){iI=t}function f1(t){return Math.round(hee(t))}function hee(t){return 69+12*Math.log2(t/iI)}function fee(t){return iI*Math.pow(2,(t-69)/12)}class j6 extends jg{constructor(e,n,r){super(),this.defaultUnits="s",this._val=n,this._units=r,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,n)=>{const r=parseInt(e,10),i=n==="."?1.5:1;return r===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/r)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const n=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(n)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,n,r)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i+=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i+=this._beatsToUnits(parseFloat(r)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof j6&&this.fromType(this._val),af(this._val))return this._noArg();if(Og(this._val)&&af(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(lv(this._val)){let e=0;for(const n in this._val)if(xi(this._val[n])){const r=this._val[n],i=new this.constructor(this.context,n).valueOf()*r;e+=i}return e}if(xi(this._units)){const e=this._expressions[this._units],n=this._val.toString().trim().match(e.regexp);return n?e.method.apply(this,n.slice(1)):e.method.call(this,this._val)}else return Og(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Xf extends j6{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const n=new Xf(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(n))},regexp:/^@(.+)/}})}quantize(e,n=1){const r=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/r)*r-i;return i+a*n}toNotation(){const e=this.toSeconds(),n=["1m"];for(let s=1;s<9;s++){const o=Math.pow(2,s);n.push(o+"n."),n.push(o+"n"),n.push(o+"t")}n.push("0");let r=n[0],i=new Xf(this.context,n[0]).toSeconds();return n.forEach(s=>{const o=new Xf(this.context,s).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(r=s,i=o)}),r}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let n=this.valueOf()/e;n=parseFloat(n.toFixed(4));const r=Math.floor(n/this._getTimeSignature());let i=n%1*4;n=Math.floor(n)%this._getTimeSignature();const s=i.toString();return s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3))),[r,n,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return f1(this.toFrequency())}_now(){return this.context.now()}}function Oc(t,e){return new Xf(bo(),t,e)}class uh extends Xf{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Yke()}static set A4(e){Kke(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:uh.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,n){const i=Xke[e.toLowerCase()]+(parseInt(n,10)+1)*12;return this.defaultUnits==="midi"?i:uh.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,n,r){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i*=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i*=this._beatsToUnits(parseFloat(r)/4)),i}}})}transpose(e){return new uh(this.context,this.valueOf()*uee(e))}harmonize(e){return e.map(n=>this.transpose(n))}toMidi(){return f1(this.valueOf())}toNote(){const e=this.toFrequency(),n=Math.log2(e/uh.A4);let r=Math.round(12*n)+57;const i=Math.floor(r/12);return i<0&&(r+=-12*i),Jke[r%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),n=this.valueOf()/e;return Math.floor(n*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return fee(e)}static ftom(e){return f1(e)}}const Xke={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Jke=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function n9(t,e){return new uh(bo(),t,e)}class dE extends Xf{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Pl extends jg{constructor(){super();const e=Yn(Pl.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:bo()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return Rke(e),new Xf(this.context,e).toSeconds()}toFrequency(e){return new uh(this.context,e).toFrequency()}toTicks(e){return new dE(this.context,e).toTicks()}_getPartialProperties(e){const n=this.get();return Object.keys(n).forEach(r=>{af(e[r])&&delete n[r]}),n}get(){const e=Vke(this);return Object.keys(e).forEach(n=>{if(Reflect.has(this,n)){const r=this[n];xi(r)&&xi(r.value)&&xi(r.setValueAtTime)?e[n]=r.value:r instanceof Pl?e[n]=r._getPartialProperties(e[n]):ph(r)||lp(r)||Og(r)||IQ(r)?e[n]=r:delete e[n]}}),e}set(e){return Object.keys(e).forEach(n=>{Reflect.has(this,n)&&xi(this[n])&&(this[n]&&xi(this[n].value)&&xi(this[n].setValueAtTime)?this[n].value!==e[n]&&(this[n].value=e[n]):this[n]instanceof Pl?this[n].set(e[n]):this[n]=e[n])}),this}}class fC extends ed{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const n=this.get(e);return n!==null?n.state:this._initial}setStateAtTime(e,n,r){return Kf(n,0),this.add(Object.assign({},r,{state:e,time:n})),this}getLastState(e,n){const r=this._search(n);for(let i=r;i>=0;i--){const s=this._timeline[i];if(s.state===e)return s}}getNextState(e,n){const r=this._search(n);if(r!==-1)for(let i=r;i<this._timeline.length;i++){const s=this._timeline[i];if(s.state===e)return s}}}class Zr extends Pl{constructor(){const e=Yn(Zr.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Ir(xi(e.param)&&(L1(e.param)||e.param instanceof Zr),"param must be an AudioParam");!L1(e.param);)e.param=e.param._param;this._swappable=xi(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new ed(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,xi(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Pl.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return xi(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return xi(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,n){return this.units===n}_assertRange(e){return xi(this.maxValue)&&xi(this.minValue)&&Kf(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?cee(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?lee(e):e}setValueAtTime(e,n){const r=this.toSeconds(n),i=this._fromType(e);return Ir(isFinite(i)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,r),this._events.add({time:r,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,r),this}getValueAtTime(e){const n=Math.max(this.toSeconds(e),0),r=this._events.getAfter(n),i=this._events.get(n);let s=this._initialValue;if(i===null)s=this._initialValue;else if(i.type==="setTargetAtTime"&&(r===null||r.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(s=this._exponentialApproach(i.time,a,i.value,i.constant,n))}else if(r===null)s=i.value;else if(r.type==="linearRampToValueAtTime"||r.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}r.type==="linearRampToValueAtTime"?s=this._linearInterpolate(i.time,o,r.time,r.value,n):s=this._exponentialInterpolate(i.time,o,r.time,r.value,n)}else s=i.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let n=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(n)===0&&(n=this._toType(this._minOutput)),this.setValueAtTime(n,e),this}linearRampToValueAtTime(e,n){const r=this._fromType(e),i=this.toSeconds(n);return Ir(isFinite(r)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(r),this._events.add({time:i,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(r,i),this}exponentialRampToValueAtTime(e,n){let r=this._fromType(e);r=Jd(r,0)?this._minOutput:r,this._assertRange(r);const i=this.toSeconds(n);return Ir(isFinite(r)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(r,i),this}exponentialRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(e,r+this.toSeconds(n)),this}linearRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(e,r+this.toSeconds(n)),this}targetRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(e,r,n),this}exponentialApproachValueAtTime(e,n,r){n=this.toSeconds(n),r=this.toSeconds(r);const i=Math.log(r+1)/Math.log(200);return this.setTargetAtTime(e,n,i),this.cancelAndHoldAtTime(n+r*.9),this.linearRampToValueAtTime(e,n+r),this}setTargetAtTime(e,n,r){const i=this._fromType(e);Ir(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(n);return this._assertRange(i),Ir(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({constant:r,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,s,r),this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(e,n,r,i=1){r=this.toSeconds(r),n=this.toSeconds(n);const s=this._fromType(e[0])*i;this.setValueAtTime(this._toType(s),n);const o=r/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),n+a*o)}return this}cancelScheduledValues(e){const n=this.toSeconds(e);return Ir(isFinite(n),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(n),this._param.cancelScheduledValues(n),this.log(this.units,"cancelScheduledValues",n),this}cancelAndHoldAtTime(e){const n=this.toSeconds(e),r=this._fromType(this.getValueAtTime(n));Ir(isFinite(n),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",n,"value="+r);const i=this._events.get(n),s=this._events.getAfter(n);return i&&Jd(i.time,n)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(n),this._events.cancel(n+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(r),n):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(r),n)),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}rampTo(e,n=.1,r){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,n,r):this.linearRampTo(e,n,r),this}apply(e){const n=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(n),n);const r=this._events.get(n);if(r&&r.type==="setTargetAtTime"){const i=this._events.getAfter(r.time),s=i?i.time:n+2,o=(s-n)/10;for(let a=n;a<s;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){Ir(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const n=this.input;return n.disconnect(this._param),this.apply(e),this._param=e,n.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,n,r,i,s){return r+(n-r)*Math.exp(-(s-e)/i)}_linearInterpolate(e,n,r,i,s){return n+(i-n)*((s-e)/(r-e))}_exponentialInterpolate(e,n,r,i,s){return n*Math.pow(i/n,(s-e)/(r-e))}}class Qn extends Pl{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return xi(this.input)?L1(this.input)||this.input instanceof Zr?1:this.input.numberOfInputs:0}get numberOfOutputs(){return xi(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return xi(e)&&(e instanceof Qn||uv(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(r=>{r.channelCount=e.channelCount,r.channelCountMode=e.channelCountMode,r.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();Ir(e.length>0,"ToneAudioNode does not have any internal nodes");const n=e[0];return{channelCount:n.channelCount,channelCountMode:n.channelCountMode,channelInterpretation:n.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelInterpretation:e}))}connect(e,n=0,r=0){return up(this,e,n,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return QO("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,n=0,r=0){return dee(this,e,n,r),this}chain(...e){return U1(this,...e),this}fan(...e){return e.forEach(n=>this.connect(n)),this}dispose(){return super.dispose(),xi(this.input)&&(this.input instanceof Qn?this.input.dispose():uv(this.input)&&this.input.disconnect()),xi(this.output)&&(this.output instanceof Qn?this.output.dispose():uv(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function U1(...t){const e=t.shift();t.reduce((n,r)=>(n instanceof Qn?n.connect(r):uv(n)&&up(n,r),r),e)}function up(t,e,n=0,r=0){for(Ir(xi(t),"Cannot connect from undefined node"),Ir(xi(e),"Cannot connect to undefined node"),(e instanceof Qn||uv(e))&&Ir(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Ir(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Qn||e instanceof Zr;)xi(e.input)&&(e=e.input);for(;t instanceof Qn;)xi(t.output)&&(t=t.output);L1(e)?t.connect(e,n):t.connect(e,n,r)}function dee(t,e,n=0,r=0){if(xi(e))for(;e instanceof Qn;)e=e.input;for(;!uv(t);)xi(t.output)&&(t=t.output);L1(e)?t.disconnect(e,n):uv(e)?t.disconnect(e,n,r):t.disconnect()}class Vr extends Qn{constructor(){const e=Yn(Vr.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Zr({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),yi(this,"gain")}static getDefaults(){return Object.assign(Qn.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class UE extends Qn{constructor(e){super(e),this.onended=hs,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Vr({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(n){const r=this.toSeconds(n);return this._startTime!==-1&&r>=this._startTime&&(this._stopTime===-1||r<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Qn.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:hs})}_startGain(e,n=1){Ir(this._startTime===-1,"Source cannot be started more than once");const r=this.toSeconds(this._fadeIn);return this._startTime=e+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(n,e+r):this._gainNode.gain.exponentialApproachValueAtTime(n,e,r)):this._gainNode.gain.setValueAtTime(n,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){Ir(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const n=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+n,this._stopTime=Math.max(this._stopTime,this.now()),n>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,n,e):this._gainNode.gain.targetRampTo(0,n,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const r=this._curve==="exponential"?n*2:0;this._stopSource(this.now()+r),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==hs&&(this.onended(this),this.onended=hs,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Ir(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=hs,this}}class z6 extends UE{constructor(){const e=Yn(z6.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),up(this._source,this._gainNode),this.offset=new Zr({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(UE.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._source.start(n),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Mi extends Qn{constructor(){const e=Yn(Mi.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new z6({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Qn.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,n=0,r=0){return sI(this,e,n,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,n){return this._param.setValueAtTime(e,n),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,n){return this._param.linearRampToValueAtTime(e,n),this}exponentialRampToValueAtTime(e,n){return this._param.exponentialRampToValueAtTime(e,n),this}exponentialRampTo(e,n,r){return this._param.exponentialRampTo(e,n,r),this}linearRampTo(e,n,r){return this._param.linearRampTo(e,n,r),this}targetRampTo(e,n,r){return this._param.targetRampTo(e,n,r),this}exponentialApproachValueAtTime(e,n,r){return this._param.exponentialApproachValueAtTime(e,n,r),this}setTargetAtTime(e,n,r){return this._param.setTargetAtTime(e,n,r),this}setValueCurveAtTime(e,n,r,i){return this._param.setValueCurveAtTime(e,n,r,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,n,r){return this._param.rampTo(e,n,r),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function sI(t,e,n,r){(e instanceof Zr||L1(e)||e instanceof Mi&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Mi&&(e.overridden=!0)),up(t,e,n,r)}class V6 extends Zr{constructor(){const e=Yn(V6.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new ed(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Zr.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,n,r){n=this.toSeconds(n),this.setRampPoint(n);const i=this._fromType(e),s=this._events.get(n),o=Math.round(Math.max(1/r,1));for(let a=0;a<=o;a++){const c=r*a+n,l=this._exponentialApproach(s.time,s.value,i,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,n){const r=this.toSeconds(n);super.setValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,n){const r=this.toSeconds(n);super.linearRampToValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,n){n=this.toSeconds(n);const r=this._fromType(e),i=this._events.get(n),s=Math.round(Math.max((n-i.time)*10,1)),o=(n-i.time)/s;for(let a=0;a<=s;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,n,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,n){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(af(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const r=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(n));const s=this._events.get(n);return s&&s.time===n&&s.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(n-this.sampleTime))),.5*(n-e.time)*(r+i)+e.ticks}getTicksAtTime(e){const n=this.toSeconds(e),r=this._events.get(n);return Math.max(this._getTicksUntilEvent(r,n),0)}getDurationOfTicks(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(n);return this.getTimeOfTick(i+e)-r}getTimeOfTick(e){const n=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(n&&n.ticks===e)return n.time;if(n&&r&&r.type==="linearRampToValueAtTime"&&n.value!==r.value){const i=this._fromType(this.getValueAtTime(n.time)),o=(this._fromType(this.getValueAtTime(r.time))-i)/(r.time-n.time),a=Math.sqrt(Math.pow(i,2)-2*o*(n.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+n.time}else return n?n.value===0?1/0:n.time+(e-n.ticks)/n.value:e/this._initialValue}ticksToTime(e,n){return this.getDurationOfTicks(e,n)}timeToTicks(e,n){const r=this.toSeconds(n),i=this.toSeconds(e),s=this.getTicksAtTime(r);return this.getTicksAtTime(r+i)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const n=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(n,0)}}class H6 extends Mi{constructor(){const e=Yn(H6.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new V6({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Mi.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,n){return this._param.ticksToTime(e,n)}timeToTicks(e,n){return this._param.timeToTicks(e,n)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,n){return this._param.getDurationOfTicks(e,n)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class $6 extends Pl{constructor(){const e=Yn($6.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new fC,this._tickOffset=new ed,this._ticksAtTime=new ed,this._secondsAtTime=new ed,this.frequency=new H6({context:this.context,units:e.units,value:e.frequency}),yi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Pl.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,n){const r=this.toSeconds(e);return this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),xi(n)&&this.setTicksAtTime(n,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(e){const n=this.toSeconds(e);if(this._state.getValueAtTime(n)==="stopped"){const r=this._state.get(n);r&&r.time>0&&(this._tickOffset.cancel(r.time),this._state.cancel(r.time))}return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this.setTicksAtTime(0,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const n=this.toSeconds(e),r=this._state.getLastState("stopped",n),i=this._ticksAtTime.get(n),s={state:"paused",time:n};this._state.add(s);let o=i||r,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,n+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const n=this.now(),r=this.frequency.timeToTicks(e,n);this.setTicksAtTime(r,n)}getSecondsAtTime(e){e=this.toSeconds(e);const n=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);const i=this._secondsAtTime.get(e);let s=i||n,o=i?i.seconds:0,a=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time;const u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(o=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==r.time&&(a={state:c.state,time:c.time,seconds:o})),s=c}),this._state.remove(r),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,n){return n=this.toSeconds(n),this._tickOffset.cancel(n),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,n),ticks:e,time:n}),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,n=this.now()){const r=this._tickOffset.get(n),i=this._state.get(n),s=Math.max(r.time,i.time),o=this.frequency.getTicksAtTime(s)+e-r.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,n,r){let i=this._state.get(e);this._state.forEachBetween(e,n,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,r),i=o});let s=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=Jd(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<n;){try{r(h,Math.round(this.getTicksAtTime(h)))}catch(f){s=f;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class oI extends Pl{constructor(){const e=Yn(oI.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=hs,this._lastUpdate=0,this._state=new fC("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new $6({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,yi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Pl.getDefaults(),{callback:hs,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,n){NQ(this.context);const r=this.toSeconds(e);return this.log("start",r),this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,n),r<this._lastUpdate&&this.emit("start",r,n)),this}stop(e){const n=this.toSeconds(e);return this.log("stop",n),this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._tickSource.stop(n),n<this._lastUpdate&&this.emit("stop",n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._tickSource.pause(n),n<this._lastUpdate&&this.emit("pause",n)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,n){return this._tickSource.setTicksAtTime(e,n),this}getTimeOfTick(e,n=this.now()){return this._tickSource.getTimeOfTick(e,n)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(i+e,r)}_loop(){const e=this._lastUpdate,n=this.now();this._lastUpdate=n,this.log("loop",e,n),e!==n&&(this._state.forEachBetween(e,n,r=>{switch(r.state){case"started":const i=this._tickSource.getTicksAtTime(r.time);this.emit("start",r.time,i);break;case"stopped":r.time!==0&&this.emit("stop",r.time);break;case"paused":this.emit("pause",r.time);break}}),this._tickSource.forEachTickBetween(e,n,(r,i)=>{this.callback(r,i)}))}getStateAtTime(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}lC.mixin(oI);class BE extends Qn{constructor(){const e=Yn(BE.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const n=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(n,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(n),this.delayTime=new Zr({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),yi(this,"delayTime")}static getDefaults(){return Object.assign(Qn.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class th extends Qn{constructor(){const e=Yn(th.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new Vr({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,yi(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Qn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class G6 extends Qn{constructor(){const e=Yn(G6.getDefaults(),arguments);super(e),this.name="Destination",this.input=new th({context:this.context}),this.output=new Vr({context:this.context}),this.volume=this.input.volume,U1(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Qn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),U1(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}nI(t=>{t.destination=new G6({context:t})});rI(t=>{t.destination.dispose()});class Zke extends Qn{constructor(){super(...arguments),this.name="Listener",this.positionX=new Zr({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Zr({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Zr({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Zr({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Zr({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Zr({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Zr({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Zr({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Zr({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Qn.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}nI(t=>{t.listener=new Zke({context:t})});rI(t=>{t.listener.dispose()});function Qke(t,e){return oo(this,arguments,void 0,function*(n,r,i=2,s=bo().sampleRate){const o=bo(),a=new hC(i,r,s);UM(a),yield n(a);const c=a.render();UM(o);const l=yield c;return new Fs(l)})}class W6 extends jg{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=Yn(W6.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(n=>{this._loadingCount++;const r=e.urls[n];this.add(n,r,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:hs,onload:hs,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return Ir(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,n])=>n.loaded)}add(e,n,r=hs,i=hs){return Og(n)?(this.baseUrl&&n.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new Fs(this.baseUrl+n,r,i))):this._buffers.set(e.toString(),new Fs(n,r,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class BM extends uh{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return f1(super._frequencyToUnits(e))}_ticksToUnits(e){return f1(super._ticksToUnits(e))}_beatsToUnits(e){return f1(super._beatsToUnits(e))}_secondsToUnits(e){return f1(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return fee(this.toMidi())}transpose(e){return new BM(this.context,this.toMidi()+e)}}class ac extends dE{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class eMe extends Pl{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new ed,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,n){return this._events.add({callback:e,time:this.toSeconds(n)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,n=>{e-n.time<=this.expiration&&n.callback(),this._events.remove(n)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}nI(t=>{t.draw=new eMe({context:t})});rI(t=>{t.draw.dispose()});class tMe extends jg{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){Ir(xi(e.time),"Events must have a time property"),Ir(xi(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let n=new nMe(e.time,e.time+e.duration,e);for(this._root===null?this._root=n:this._root.insert(n),this._length++;n!==null;)n.updateHeight(),n.updateMax(),this._rebalance(n),n=n.parent;return this}remove(e){if(this._root!==null){const n=[];this._root.search(e.time,n);for(const r of n)if(r.event===e){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,n=>this.remove(n)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,n){e.parent!==null?(e.isLeftChild()?e.parent.left=n:e.parent.right=n,this._rebalance(e.parent)):this._setRoot(n)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const n=e.getBalance();let r,i=null;if(n>0)if(e.left.right===null)r=e.left,r.right=e.right,i=r;else{for(r=e.left.right;r.right!==null;)r=r.right;r.parent&&(r.parent.right=r.left,i=r.parent,r.left=e.left,r.right=e.right)}else if(e.right.left===null)r=e.right,r.left=e.left,i=r;else{for(r=e.right.left;r.left!==null;)r=r.left;r.parent&&(r.parent.left=r.right,i=r.parent,r.left=e.left,r.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=r:e.parent.right=r:this._setRoot(r),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const n=e.parent,r=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rotateRight(e){const n=e.parent,r=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rebalance(e){const n=e.getBalance();n>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):n<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const n=[];if(this._root.search(e,n),n.length>0){let r=n[0];for(let i=1;i<n.length;i++)n[i].low>r.low&&(r=n[i]);return r.event}}return null}forEach(e){if(this._root!==null){const n=[];this._root.traverse(r=>n.push(r)),n.forEach(r=>{r.event&&e(r.event)})}return this}forEachAtTime(e,n){if(this._root!==null){const r=[];this._root.search(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}forEachFrom(e,n){if(this._root!==null){const r=[];this._root.searchAfter(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class nMe{constructor(e,n,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=e,this.high=n,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,n){e>this.max||(this.left!==null&&this.left.search(e,n),this.low<=e&&this.high>e&&n.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,n))}searchAfter(e,n){this.low>=e&&(n.push(this),this.left!==null&&this.left.searchAfter(e,n)),this.right!==null&&this.right.searchAfter(e,n)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class rMe extends jg{constructor(e){super(),this.name="TimelineValue",this._timeline=new ed({memory:10}),this._initialValue=e}set(e,n){return this._timeline.add({value:e,time:n}),this}get(e){const n=this._timeline.get(e);return n?n.value:this._initialValue}}class hp extends Qn{constructor(){super(Yn(hp.getDefaults(),arguments,["context"]))}connect(e,n=0,r=0){return sI(this,e,n,r),this}}class Nv extends hp{constructor(){const e=Yn(Nv.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,ph(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):Cke(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Mi.getDefaults(),{length:1024})}setMap(e,n=1024){const r=new Float32Array(n);for(let i=0,s=n;i<s;i++){const o=i/(s-1)*2-1;r[i]=e(o,i)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const n=["none","2x","4x"].some(r=>r.includes(e));Ir(n,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class aI extends hp{constructor(){const e=Yn(aI.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new Nv({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(hp.getDefaults(),{value:1})}_expFunc(e){return n=>Math.pow(Math.abs(n),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class vv{constructor(e,n){this.id=vv._eventId++,this._remainderTime=0;const r=Object.assign(vv.getDefaults(),n);this.transport=e,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:hs,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const n=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*n),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}vv._eventId=0;class q6 extends vv{constructor(e,n){super(e,n),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const r=Object.assign(q6.getDefaults(),n);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},vv.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return LM(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new ac(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){LM(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ac(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const n=this.transport.getTicksAtTime(e);LE(n,this.time)&&(this._nextTick=this.floatTime+Math.ceil((n-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class cI extends Pl{constructor(){const e=Yn(cI.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new rMe(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new ed,this._repeatedEvents=new tMe,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new oI({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),yi(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Pl.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,n){if(this._loop.get(e)&&n>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),n=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&n%this._ppq!==0&&n%(this._swingTicks*2)!==0){const r=n%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(r*Math.PI)*this._swingAmount;e+=new ac(this.context,this._swingTicks*2/3).toSeconds()*i}t9(!0),this._timeline.forEachAtTime(n,r=>r.invoke(e)),t9(!1)}schedule(e,n){const r=new vv(this,{callback:e,time:new dE(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(e,n,r,i=1/0){const s=new q6(this,{callback:e,duration:new Xf(this.context,i).toTicks(),interval:new Xf(this.context,n).toTicks(),time:new dE(this.context,r).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,n){const r=new vv(this,{callback:e,once:!0,time:new dE(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const n=this._scheduledEvents[e.toString()];n.timeline.remove(n.event),n.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,n){return this._scheduledEvents[e.id.toString()]={event:e,timeline:n},n.add(e),e.id}cancel(e=0){const n=this.toTicks(e);return this._timeline.forEachFrom(n,r=>this.clear(r.id)),this._repeatedEvents.forEachFrom(n,r=>this.clear(r.id)),this}_bindClockEvents(){this._clock.on("start",(e,n)=>{n=new ac(this.context,n).toSeconds(),this.emit("start",e,n)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,n){this.context.resume();let r;return xi(n)&&(r=this.toTicks(n)),this._clock.start(e,r),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){ph(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Xf(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Xf(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new ac(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),n=this._clock.getTicksAtTime(e);return new ac(this.context,n).toBarsBeatsSixteenths()}set position(e){const n=this.toTicks(e);this.ticks=n}get seconds(){return this._clock.seconds}set seconds(e){const n=this.now(),r=this._clock.frequency.timeToTicks(e,n);this.ticks=r}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const n=this.now();if(this.state==="started"){const r=this._clock.getTicksAtTime(n),i=this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,n),s=n+i;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",n),this._clock.setTicksAtTime(e,n)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const n=this.now(),r=this.getTicksAtTime(n),i=e-r%e;return this._clock.nextTickTime(i,n)}}syncSignal(e,n){const r=this.now();let i=this.bpm,s=1/(60/i.getValueAtTime(r)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/s,l=new Vr(c),u=new aI(-1),h=new Vr(c);i.chain(l,u,h),i=h,s=1/s,o=[l,u,h]}n||(e.getValueAtTime(r)!==0?n=e.getValueAtTime(r)/s:n=0);const a=new Vr(n);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let n=this._syncedSignals.length-1;n>=0;n--){const r=this._syncedSignals[n];r.signal===e&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(n,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),uC(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}lC.mixin(cI);nI(t=>{t.transport=new cI({context:t})});rI(t=>{t.transport.dispose()});class ma extends Qn{constructor(e){super(e),this.input=void 0,this._state=new fC("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=hs,this._syncedStop=hs,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new th({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,yi(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Qn.getDefaults(),{mute:!1,onstop:hs,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,n,r){let i=af(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")Ir(LE(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,n,r);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const s=this._state.get(i);s&&(s.offset=this.toSeconds(Im(n,0)),s.duration=r?this.toSeconds(r):void 0);const o=this.context.transport.schedule(a=>{this._start(a,n,r)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else NQ(this.context),this._start(i,n,r);return this}stop(e){let n=af(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(n=this._clampToCurrentTime(n),this._state.getValueAtTime(n)==="started"||xi(this._state.getNextState("started",n))){if(this.log("stop",n),!this._synced)this._stop(n);else{const r=this.context.transport.schedule(this._stop.bind(this),n);this._scheduled.push(r)}this._state.cancel(n),this._state.setStateAtTime("stopped",n)}return this}restart(e,n,r){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,n,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,n)=>{if(LE(n,0)){const r=this._state.get(n);if(r&&r.state==="started"&&r.time!==n){const i=n-this.toSeconds(r.time);let s;r.duration&&(s=this.toSeconds(r.duration)-i),this._start(e,this.toSeconds(r.offset)+i,s)}}},this._syncedStop=e=>{const n=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(n)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=hs,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class dC extends UE{constructor(){const e=Yn(dC.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,up(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Zr({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Fs(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(UE.getDefaults(),{url:new Fs,loop:!1,loopEnd:0,loopStart:0,onload:hs,onerror:hs,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,n,r,i=1){Ir(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,i),this.loop?n=Im(n,this.loopStart):n=Im(n,0);let o=Math.max(this.toSeconds(n),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;YL(o,a)&&(o=(o-c)%l+c),Jd(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,LM(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,o)),xi(r)){let a=this.toSeconds(r);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class B1 extends ma{constructor(){const e=Yn(B1.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ma.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(Ir(e in r9,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const n=this.now();this._stop(n),this._start(n)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const n=r9[this._type];this._source=new dC({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const wS=44100*5,pN=2,ig={brown:null,pink:null,white:null},r9={get brown(){if(!ig.brown){const t=[];for(let e=0;e<pN;e++){const n=new Float32Array(wS);t[e]=n;let r=0;for(let i=0;i<wS;i++){const s=Math.random()*2-1;n[i]=(r+.02*s)/1.02,r=n[i],n[i]*=3.5}}ig.brown=new Fs().fromArray(t)}return ig.brown},get pink(){if(!ig.pink){const t=[];for(let e=0;e<pN;e++){const n=new Float32Array(wS);t[e]=n;let r,i,s,o,a,c,l;r=i=s=o=a=c=l=0;for(let u=0;u<wS;u++){const h=Math.random()*2-1;r=.99886*r+h*.0555179,i=.99332*i+h*.0750759,s=.969*s+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,n[u]=r+i+s+o+a+c+l+h*.5362,n[u]*=.11,l=h*.115926}}ig.pink=new Fs().fromArray(t)}return ig.pink},get white(){if(!ig.white){const t=[];for(let e=0;e<pN;e++){const n=new Float32Array(wS);t[e]=n;for(let r=0;r<wS;r++)n[r]=Math.random()*2-1}ig.white=new Fs().fromArray(t)}return ig.white}};function sb(t,e){return oo(this,void 0,void 0,function*(){const n=e/t.context.sampleRate,r=new hC(1,n,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:r})).toDestination().start(0),(yield r.render()).getChannelData(0)})}class Y6 extends UE{constructor(){const e=Yn(Y6.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],up(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Zr({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Zr({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),yi(this,["frequency","detune"])}static getDefaults(){return Object.assign(UE.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._oscillator.start(n),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Wo extends ma{constructor(){const e=Yn(Wo.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new Mi({context:this.context,units:"frequency",value:e.frequency}),yi(this,"frequency"),this.detune=new Mi({context:this.context,units:"cents",value:e.detune}),yi(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(ma.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const n=this.toSeconds(e),r=new Y6({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}_stop(e){const n=this.toSeconds(e);this._oscillator&&this._oscillator.stop(n)}_restart(e){const n=this.toSeconds(e);return this.log("restart",n),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(n),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Wo._periodicWaveCache.find(n=>n.phase===this._phase&&zke(n.partials,this._partials));{const e=Wo._periodicWaveCache.find(n=>n.type===this._type&&n.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const n=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&n)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const r=this._getCachedPeriodicWave();if(xi(r)){const{partials:i,wave:s}=r;this._wave=s,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,s]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,s);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Wo._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Wo._periodicWaveCache.length>100&&Wo._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Kf(e,0);let n=this._type;const r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(n=r[1]),this._type!=="custom")e===0?this.type=n:this.type=n+e.toString();else{const i=new Float32Array(e);this._partials.forEach((s,o)=>i[o]=s),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,n){let i=2048;const s=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[s,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(s[c]=-u*Math.sin(n*c),o[c]=u*Math.cos(n*c)):(s[c]=0,o[c]=0)}return[s,o]}_inverseFFT(e,n,r){let i=0;const s=e.length;for(let o=0;o<s;o++)i+=e[o]*Math.cos(o*r)+n[o]*Math.sin(o*r);return i}getInitialValue(){const[e,n]=this._getRealImaginary(this._type,0);let r=0;const i=Math.PI*2,s=32;for(let o=0;o<s;o++)r=Math.max(this._inverseFFT(e,n,o/s*i),r);return Hke(-this._inverseFFT(e,n,this._phase)/r,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return oo(this,arguments,void 0,function*(e=1024){return sb(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Wo._periodicWaveCache=[];class K6 extends hp{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Nv({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class kl extends Mi{constructor(){const e=Yn(kl.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Vr({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Mi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class lI extends ma{constructor(){const e=Yn(lI.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new K6({context:this.context}),this._modulationNode=new Vr({context:this.context}),this._carrier=new Wo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Wo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new kl({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),yi(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Wo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return oo(this,arguments,void 0,function*(e=1024){return sb(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class pC extends ma{constructor(){const e=Yn(pC.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new Vr({context:this.context,gain:0}),this._carrier=new Wo({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Mi({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Wo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new kl({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new kl({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),yi(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Wo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return oo(this,arguments,void 0,function*(e=1024){return sb(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class mC extends ma{constructor(){const e=Yn(mC.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new Vr({context:this.context,gain:0}),this._thresh=new Nv({context:this.context,mapping:n=>n<=0?-1:1}),this.width=new Mi({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Wo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),yi(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(ma.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return oo(this,arguments,void 0,function*(e=1024){return sb(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class uI extends ma{constructor(){const e=Yn(uI.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new Mi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Mi({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,yi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Wo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(n=>n.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(n=>n.stop(e))}_restart(e){this._forEach(n=>n.restart(e))}_forEach(e){for(let n=0;n<this._oscillators.length;n++)e(this._oscillators[n],n)}get type(){return this._type}set type(e){this._type=e,this._forEach(n=>n.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const n=-e/2,r=e/(this._oscillators.length-1);this._forEach((i,s)=>i.detune.value=n+r*s)}}get count(){return this._oscillators.length}set count(e){if(Kf(e,1),this._oscillators.length!==e){this._forEach(n=>n.dispose()),this._oscillators=[];for(let n=0;n<e;n++){const r=new Wo({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+n/e*360,partialCount:this._partialCount,onstop:n===0?()=>this.onstop(this):hs});this.type==="custom"&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state==="started"&&this._forEach(n=>n.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((n,r)=>n.phase=this._phase+r/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(n=>n.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(n=>n.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(n=>n.partialCount=e),this._type=this._oscillators[0].type}asArray(){return oo(this,arguments,void 0,function*(e=1024){return sb(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class hI extends ma{constructor(){const e=Yn(hI.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new kl({context:this.context,value:2}),this._pulse=new mC({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Wo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),yi(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(ma.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return oo(this,arguments,void 0,function*(e=1024){return sb(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const i9={am:lI,fat:uI,fm:pC,oscillator:Wo,pulse:mC,pwm:hI};class Rm extends ma{constructor(){const e=Yn(Rm.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new Mi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Mi({context:this.context,units:"cents",value:e.detune}),yi(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Wo.getDefaults(),pC.getDefaults(),lI.getDefaults(),uI.getDefaults(),mC.getDefaults(),hI.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(n=>this._sourceType===n)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const n=i9[e],r=this.now();if(this._oscillator){const i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new n({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let n="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(n=this._oscillator.type),e==="fm"?this.type="fm"+n:e==="am"?this.type="am"+n:e==="fat"?this.type="fat"+n:e==="oscillator"?this.type=n:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,n){return e instanceof i9[n]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&lp(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&lp(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Og(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return oo(this,arguments,void 0,function*(e=1024){return sb(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class X6 extends Mi{constructor(){super(Yn(X6.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new Vr({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,U1(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Mi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class FE extends hp{constructor(){const e=Yn(FE.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new kl({context:this.context,value:e.max-e.min}),this._add=this.output=new X6({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(hp.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class J6 extends hp{constructor(){super(Yn(J6.getDefaults(),arguments)),this.name="Zero",this._gain=new Vr({context:this.context}),this.output=this._gain,this.input=void 0,up(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),dee(this.context.getConstant(0),this._gain),this}}class jE extends Qn{constructor(){const e=Yn(jE.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Zr.prototype._fromType,this._toType=Zr.prototype._toType,this._is=Zr.prototype._is,this._clampValue=Zr.prototype._clampValue,this._oscillator=new Wo(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Vr({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Mi({context:this.context,units:"audioRange",value:0}),this._zeros=new J6({context:this.context}),this._a2g=new K6({context:this.context}),this._scaler=this.output=new FE({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),yi(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(Wo.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const n=this.min,r=this.max;this._units=e,this.min=n,this.max=r}get state(){return this._oscillator.state}connect(e,n,r){return(e instanceof Zr||e instanceof Mi)&&(this.convert=e.convert,this.units=e.units),sI(this,e,n,r),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function pee(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Kf(s,t,e),n.set(this,s)}})}}function zg(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Kf(this.toSeconds(s),t,e),n.set(this,s)}})}}class gC extends ma{constructor(){const e=Yn(gC.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new Fs({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ma.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:hs,onerror:hs,playbackRate:1,reverse:!1})}load(e){return oo(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=hs){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,n,r){return super.start(e,n,r),this}_start(e,n,r){this._loop?n=Im(n,this._loopStart):n=Im(n,0);const i=this.toSeconds(n),s=r;r=Im(r,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(r);o=o/this._playbackRate,e=this.toSeconds(e);const a=new dC({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&af(s)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const n=this.toSeconds(e);this._activeSources.forEach(r=>r.stop(n))}restart(e,n,r){return super.restart(e,n,r),this}_restart(e,n,r){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,n,r)}seek(e,n){const r=this.toSeconds(n);if(this._state.getValueAtTime(r)==="started"){const i=this.toSeconds(e);this._stop(r),this._start(r,i)}return this}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Kf(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Kf(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(n=>{n.loop=e}),e)){const n=this._state.getNextState("stopped",this.now());n&&this._state.cancel(n.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const n=this.now(),r=this._state.getNextState("stopped",n);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,n)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Vs([zg(0)],gC.prototype,"fadeIn",void 0);Vs([zg(0)],gC.prototype,"fadeOut",void 0);class iMe extends hp{constructor(){super(...arguments),this.name="Abs",this._abs=new Nv({context:this.context,mapping:e=>Math.abs(e)<.001?0:Math.abs(e)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class sMe extends hp{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Nv({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Z6 extends FE{constructor(){const e=Yn(Z6.getDefaults(),arguments,["min","max","exponent"]);super(e),this.name="ScaleExp",this.input=this._exp=new aI({context:this.context,value:e.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(FE.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(e){this._exp.value=e}dispose(){return super.dispose(),this._exp.dispose(),this}}class nl extends Qn{constructor(){const e=Yn(nl.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new Mi({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(Qn.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,n){if(Og(e))return e;{let r;for(r in ER)if(ER[r][n]===e)return r;return e}}_setCurve(e,n,r){if(Og(r)&&Reflect.has(ER,r)){const i=ER[r];lv(i)?e!=="_decayCurve"&&(this[e]=i[n]):this[e]=i}else if(ph(r)&&e!=="_decayCurve")this[e]=r;else throw new Error("Envelope: invalid curve: "+r)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,n=1){this.log("triggerAttack",e,n),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(n,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(n,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(n,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,n)}if(s&&this.sustain<1){const a=n*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const n=this.getValueAtTime(e);if(n>0){const r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,r,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,r,e):(Ir(ph(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,r,n))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),this.triggerAttack(n,r),this.triggerRelease(n+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,n=0,r=0){return sI(this,e,n,r),this}asArray(){return oo(this,arguments,void 0,function*(e=1024){const n=e/this.context.sampleRate,r=new hC(1,n,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),o=s*.1,a=s+o,c=new this.constructor(Object.assign(this.get(),{attack:n*this.toSeconds(this.attack)/a,decay:n*this.toSeconds(this.decay)/a,release:n*this.toSeconds(this.release)/a,context:r}));return c._sig.toDestination(),c.triggerAttackRelease(n*(i+o)/a,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Vs([zg(0)],nl.prototype,"attack",void 0);Vs([zg(0)],nl.prototype,"decay",void 0);Vs([pee(0,1)],nl.prototype,"sustain",void 0);Vs([zg(0)],nl.prototype,"release",void 0);const ER=(()=>{let e,n;const r=[];for(e=0;e<128;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[],s=6.4;for(e=0;e<127;e++){n=e/127;const f=Math.sin(n*(Math.PI*2)*s-Math.PI/2)+1;i[e]=f/10+n*.83}i[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)n=e/127,c[e]=.5*(1-Math.cos(Math.PI*n));const l=[];for(e=0;e<128;e++){n=e/127;const f=Math.pow(n,3)*4+.2,d=Math.cos(f*Math.PI*2*n);l[e]=Math.abs(d*(1-n))}function u(f){const d=new Array(f.length);for(let p=0;p<f.length;p++)d[p]=1-f[p];return d}function h(f){return f.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:r,Out:h(r)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class Fm extends Qn{constructor(){const e=Yn(Fm.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=n=>this._original_triggerRelease(n),this._volume=this.output=new th({context:this.context,volume:e.volume}),this.volume=this._volume.volume,yi(this,"volume")}static getDefaults(){return Object.assign(Qn.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,n){const r=this["_original_"+e]=this[e];this[e]=(...i)=>{const s=i[n],o=this.context.transport.schedule(a=>{i[n]=a,r.apply(this,i)},s);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r),o=this.toSeconds(n);return this.triggerAttack(e,s,i),this.triggerRelease(s+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class lf extends Fm{constructor(){const e=Yn(lf.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Fm.getDefaults(),{detune:0,onsilence:hs,portamento:0})}triggerAttack(e,n,r=1){this.log("triggerAttack",e,n,r);const i=this.toSeconds(n);return this._triggerEnvelopeAttack(i,r),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const n=this.toSeconds(e);return this._triggerEnvelopeRelease(n),this}setNote(e,n){const r=this.toSeconds(n),i=e instanceof uh?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(r)>.05){const s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,s,r)}else this.frequency.setValueAtTime(i,r);return this}}Vs([zg(0)],lf.prototype,"portamento",void 0);class fI extends nl{constructor(){super(Yn(fI.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Vr({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Ga extends lf{constructor(){const e=Yn(Ga.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Rm(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new fI(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),yi(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(lf.getDefaults(),{envelope:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(kc(Rm.getDefaults(),[...Object.keys(ma.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,n){if(this.envelope.triggerAttack(e,n),this.oscillator.start(e),this.envelope.sustain===0){const r=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+r+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class FM extends lf{constructor(){const e=Yn(FM.getDefaults(),arguments);super(e),this.name="ModulationSynth",this._carrier=new Ga({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Ga({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Mi({context:this.context,units:"frequency"}),this.detune=new Mi({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new kl({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new Vr({context:this.context,gain:0}),yi(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(lf.getDefaults(),{harmonicity:3,oscillator:Object.assign(kc(Rm.getDefaults(),[...Object.keys(ma.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(kc(Rm.getDefaults(),[...Object.keys(ma.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,n){this._carrier._triggerEnvelopeAttack(e,n),this._modulator._triggerEnvelopeAttack(e,n)}_triggerEnvelopeRelease(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class zE extends Qn{constructor(){const e=Yn(zE.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Zr({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new Zr({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new Zr({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new Zr({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(Qn.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){Ir(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const n=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*19980+20;n[o]=c}const r=new Float32Array(e),i=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(n,r,i),r}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Nc extends Qn{constructor(){const e=Yn(Nc.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new Vr({context:this.context}),this.output=new Vr({context:this.context}),this._filters=[],this._filters=[],this.Q=new Mi({context:this.context,units:"positive",value:e.Q}),this.frequency=new Mi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Mi({context:this.context,units:"cents",value:e.detune}),this.gain=new Mi({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,yi(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){Ir(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(r=>r.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const n=lp(e)?e:parseInt(e,10),r=[-12,-24,-48,-96];let i=r.indexOf(n);Ir(i!==-1,`rolloff can only be ${r.join(", ")}`),i+=1,this._rolloff=n,this.input.disconnect(),this._filters.forEach(s=>s.disconnect()),this._filters=new Array(i);for(let s=0;s<i;s++){const o=new zE({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[s]=o}this._internalChannels=this._filters,U1(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const n=new zE({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),r=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{n.getFrequencyResponse(e).forEach((s,o)=>r[o]*=s)}),n.dispose(),r}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),uC(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Q6 extends FM{constructor(){const e=Yn(Q6.getDefaults(),arguments);super(e),this.name="FMSynth",this.modulationIndex=new kl({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(FM.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const s9=[1,1.483,1.932,2.546,2.63,3.897];class e8 extends lf{constructor(){const e=Yn(e8.getDefaults(),arguments);super(e),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[],this.detune=new Mi({context:this.context,units:"cents",value:e.detune}),this.frequency=new Mi({context:this.context,units:"frequency"}),this._amplitude=new Vr({context:this.context,gain:0}).connect(this.output),this._highpass=new Nc({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let n=0;n<s9.length;n++){const r=new pC({context:this.context,harmonicity:e.harmonicity,modulationIndex:e.modulationIndex,modulationType:"square",onstop:n===0?()=>this.onsilence(this):hs,type:"square"});r.connect(this._highpass),this._oscillators[n]=r;const i=new kl({context:this.context,value:s9[n]});this._freqMultipliers[n]=i,this.frequency.chain(i,r.frequency),this.detune.connect(r.detune)}this._filterFreqScaler=new FE({context:this.context,max:7e3,min:this.toFrequency(e.resonance)}),this.envelope=new nl({attack:e.envelope.attack,attackCurve:"linear",context:this.context,decay:e.envelope.decay,release:e.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=e.octaves,this.octaves=e.octaves}static getDefaults(){return hv(lf.getDefaults(),{envelope:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(e,n=1){return this.envelope.triggerAttack(e,n),this._oscillators.forEach(r=>r.start(e)),this.envelope.sustain===0&&this._oscillators.forEach(r=>{r.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(e){return this.envelope.triggerRelease(e),this._oscillators.forEach(n=>n.stop(e+this.toSeconds(this.envelope.release))),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(e){this._oscillators.forEach(n=>n.modulationIndex.value=e)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(e){this._oscillators.forEach(n=>n.harmonicity.value=e)}get resonance(){return this._filterFreqScaler.min}set resonance(e){this._filterFreqScaler.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}dispose(){return super.dispose(),this._oscillators.forEach(e=>e.dispose()),this._freqMultipliers.forEach(e=>e.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class lx extends Ga{constructor(){const e=Yn(lx.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,yi(this,["oscillator","envelope"])}static getDefaults(){return hv(lf.getDefaults(),Ga.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,n){const r=this.toSeconds(n),i=this.toFrequency(e instanceof uh?e.toFrequency():e),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,r),this.oscillator.frequency.exponentialRampToValueAtTime(i,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Vs([pee(0)],lx.prototype,"octaves",void 0);Vs([zg(0)],lx.prototype,"pitchDecay",void 0);class yv extends Fm{constructor(){const e=Yn(yv.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new B1(Object.assign({context:this.context},e.noise)),this.envelope=new fI(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Fm.getDefaults(),{envelope:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(kc(B1.getDefaults(),Object.keys(ma.getDefaults())),{type:"white"})})}triggerAttack(e,n=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,n),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(n,r),this.triggerRelease(n+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const mee=new Set;function t8(t){mee.add(t)}function gee(t,e){const n=`registerProcessor("${t}", ${e})`;mee.add(n)}const oMe=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;t8(oMe);const aMe=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;t8(aMe);const cMe=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;t8(cMe);const lMe="feedback-comb-filter",uMe=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;gee(lMe,uMe);class n8 extends Qn{constructor(){const e=Yn(n8.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OnePoleFilter",this._frequency=e.frequency,this._type=e.type,this.input=new Vr({context:this.context}),this.output=new Vr({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(Qn.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const e=this._filter,n=this.toFrequency(this._frequency),r=1/(2*Math.PI*n);if(this._type==="lowpass"){const i=1/(r*this.context.sampleRate),s=i-1;this._filter=this.context.createIIRFilter([i,0],[1,s])}else{const i=1/(r*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,i])}this.input.chain(this._filter,this.output),e&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(e),e.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(e){this._frequency=e,this._createFilter()}get type(){return this._type}set type(e){this._type=e,this._createFilter()}getFrequencyResponse(e=128){const n=new Float32Array(e);for(let s=0;s<e;s++){const a=Math.pow(s/e,2)*19980+20;n[s]=a}const r=new Float32Array(e),i=new Float32Array(e);return this._filter.getFrequencyResponse(n,r,i),r}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class r8 extends Fm{constructor(){const e=Yn(r8.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),Ir(!lp(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const n=e.voice.getDefaults();this.options=Object.assign(n,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const r=this._voices.indexOf(this._dummyVoice);this._voices.splice(r,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Fm.getDefaults(),{maxPolyphony:32,options:{},voice:Ga})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const n=this._activeVoices.findIndex(r=>r.voice===e);this._activeVoices.splice(n,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Ir(e instanceof lf,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else QO("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),n=this._voices.indexOf(e);this._voices.splice(n,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,n,r){e.forEach(i=>{const s=new BM(this.context,i).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(i,n,r),this._activeVoices.push({midi:s,voice:o,released:!1}),this.log("triggerAttack",i,n))})}_triggerRelease(e,n){e.forEach(r=>{const i=new BM(this.context,r).toMidi(),s=this._activeVoices.find(({midi:o,released:a})=>o===i&&!a);s&&(s.voice.triggerRelease(n),s.released=!0,this.log("triggerRelease",r,n))})}_scheduleEvent(e,n,r,i){Ir(!this.disposed,"Synth was already disposed"),r<=this.now()?e==="attack"?this._triggerAttack(n,r,i):this._triggerRelease(n,r):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,n,r,i)},r-this.now())}triggerAttack(e,n,r){Array.isArray(e)||(e=[e]);const i=this.toSeconds(n);return this._scheduleEvent("attack",e,i,r),this}triggerRelease(e,n){Array.isArray(e)||(e=[e]);const r=this.toSeconds(n);return this._scheduleEvent("release",e,r),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r);if(this.triggerAttack(e,s,i),ph(n)){Ir(ph(e),"If the duration is an array, the notes must also be an array"),e=e;for(let o=0;o<e.length;o++){const a=n[Math.min(o,n.length-1)],c=this.toSeconds(a);Ir(c>0,"The duration must be greater than 0"),this.triggerRelease(e[o],s+c)}}else{const o=this.toSeconds(n);Ir(o>0,"The duration must be greater than 0"),this.triggerRelease(e,s+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const n=kc(e,["onsilence","context"]);return this.options=hv(this.options,n),this._voices.forEach(r=>r.set(n)),this._dummyVoice.set(n),this}get(){return this._dummyVoice.get()}releaseAll(e){const n=this.toSeconds(e);return this._activeVoices.forEach(({voice:r})=>{r.triggerRelease(n)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class _C extends Fm{constructor(){const e=Yn(_C.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const n={};Object.keys(e.urls).forEach(r=>{const i=parseInt(r,10);if(Ir(SR(r)||lp(i)&&isFinite(i),`url key is neither a note or midi pitch: ${r}`),SR(r)){const s=new uh(this.context,r).toMidi();n[s]=e.urls[r]}else lp(i)&&isFinite(i)&&(n[i]=e.urls[i])}),this._buffers=new W6({urls:n,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Fm.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:hs,onerror:hs,release:.1,urls:{}})}_findClosest(e){let r=0;for(;r<96;){if(this._buffers.has(e+r))return-r;if(this._buffers.has(e-r))return r;r++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,n,r=1){return this.log("triggerAttack",e,n,r),Array.isArray(e)||(e=[e]),e.forEach(i=>{const s=hee(new uh(this.context,i).toFrequency()),o=Math.round(s),a=s-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=uee(c+a),f=new dC({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);f.start(n,0,u.duration/h,r),ph(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(f),f.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const d=this._activeSources.get(o),p=d.indexOf(f);p!==-1&&d.splice(p,1)}}}),this}triggerRelease(e,n){return this.log("triggerRelease",e,n),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=new uh(this.context,r).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const s=this._activeSources.get(i);n=this.toSeconds(n),s.forEach(o=>{o.stop(n)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const n=this.toSeconds(e);return this._activeSources.forEach(r=>{for(;r.length;)r.shift().stop(n)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,n,r,i=1){const s=this.toSeconds(r);return this.triggerAttack(e,s,i),ph(n)?(Ir(ph(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=n[Math.min(a,n.length-1)];this.triggerRelease(o,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(n)),this}add(e,n,r){if(Ir(SR(e)||isFinite(e),`note must be a pitch or midi: ${e}`),SR(e)){const i=new uh(this.context,e).toMidi();this._buffers.add(i,n,r)}else this._buffers.add(e,n,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(n=>n.dispose())}),this._activeSources.clear(),this}}Vs([zg(0)],_C.prototype,"attack",void 0);Vs([zg(0)],_C.prototype,"release",void 0);class eE extends Pl{constructor(){const e=Yn(eE.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new fC("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(Pl.getDefaults(),{callback:hs,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,n=>{let r;if(n.state==="started"){n.id!==-1&&this.context.transport.clear(n.id);const i=n.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||lp(this._loop)&&this._loop>1){r=1/0,lp(this._loop)&&(r=this._loop*this._getLoopDuration());const s=this._state.getAfter(i);s!==null&&(r=Math.min(r,s.time-i)),r!==1/0&&(r=new ac(this.context,r));const o=new ac(this.context,this._getLoopDuration());n.id=this.context.transport.scheduleRepeat(this._tick.bind(this),o,new ac(this.context,i),r)}else n.id=this.context.transport.schedule(this._tick.bind(this),new ac(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const n=this.toTicks(e);return this._state.getValueAtTime(n)==="stopped"&&(this._state.add({id:-1,state:"started",time:n}),this._rescheduleEvents(n)),this}stop(e){this.cancel(e);const n=this.toTicks(e);if(this._state.getValueAtTime(n)==="started"){this._state.setStateAtTime("stopped",n,{id:-1});const r=this._state.getBefore(n);let i=n;r!==null&&(i=r.time),this._rescheduleEvents(i)}return this}cancel(e){e=Im(e,-1/0);const n=this.toTicks(e);return this._state.forEachFrom(n,r=>{this.context.transport.clear(r.id)}),this._state.cancel(n),this}_tick(e){const n=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(n)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let r=.02;IQ(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*r}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new ac(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new ac(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,n=this._state.get(e);if(n!==null&&n.state==="started"){const r=this._getLoopDuration();return(e-n.time)%r/r}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class vA extends eE{constructor(){const e=Yn(vA.getDefaults(),arguments,["callback","events"]);super(e),this.name="Part",this._state=new fC("stopped"),this._events=new Set,this._state.increasing=!0,e.events.forEach(n=>{ph(n)?this.add(n[0],n[1]):this.add(n)})}static getDefaults(){return Object.assign(eE.getDefaults(),{events:[]})}start(e,n){const r=this.toTicks(e);if(this._state.getValueAtTime(r)!=="started"){n=Im(n,this._loop?this._loopStart:0),this._loop?n=Im(n,this._loopStart):n=Im(n,0);const i=this.toTicks(n);this._state.add({id:-1,offset:i,state:"started",time:r}),this._forEach(s=>{this._startNote(s,r,i)})}return this}_startNote(e,n,r){n-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(n+=this._getLoopDuration()),e.start(new ac(this.context,n))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(new ac(this.context,n))):e.startOffset>=r&&e.start(new ac(this.context,n))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(n=>{n.startOffset+=this._startOffset})}stop(e){const n=this.toTicks(e);return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._forEach(r=>{r.stop(e)}),this}at(e,n){const r=new dE(this.context,e).toTicks(),i=new ac(this.context,1).toSeconds(),s=this._events.values();let o=s.next();for(;!o.done;){const a=o.value;if(Math.abs(r-a.startOffset)<i)return xi(n)&&(a.value=n),a;o=s.next()}return xi(n)?(this.add(e,n),this.at(e)):null}add(e,n){e instanceof Object&&Reflect.has(e,"time")&&(n=e,e=n.time);const r=this.toTicks(e);let i;return n instanceof eE?(i=n,i.callback=this._tick.bind(this)):i=new eE({callback:this._tick.bind(this),context:this.context,value:n}),i.startOffset=r,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(e){this._state.forEach(n=>{n.state==="started"?this._startNote(e,n.time,n.offset):e.stop(new ac(this.context,n.time))})}remove(e,n){return lv(e)&&e.hasOwnProperty("time")&&(n=e,e=n.time),e=this.toTicks(e),this._events.forEach(r=>{r.startOffset===e&&(af(n)||xi(n)&&r.value===n)&&(this._events.delete(r),r.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(n=>n.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(n=>{n instanceof vA?n._forEach(e):e(n)}),this}_setAll(e,n){this._forEach(r=>{r[e]=n})}_tick(e,n){this.mute||this.callback(e,n)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(n=>{n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.loop=e,this._testLoopBoundries(n)})}get loopEnd(){return new ac(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopEnd=e,this._testLoopBoundries(n)})}get loopStart(){return new ac(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopStart=this.loopStart,this._testLoopBoundries(n)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class dI extends Qn{constructor(){const e=Yn(dI.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new sMe({context:this.context}),this.a=new Vr({context:this.context,gain:0}),this.b=new Vr({context:this.context,gain:0}),this.output=new Vr({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new Mi({context:this.context,units:"normalRange",value:e.fade}),yi(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",up(this._split,this.a.gain,0),up(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Qn.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}let Dl=class extends Qn{constructor(e){super(e),this.name="Effect",this._dryWet=new dI({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Vr({context:this.context}),this.effectReturn=new Vr({context:this.context}),this.input=new Vr({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],yi(this,"wet")}static getDefaults(){return Object.assign(Qn.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};class o9 extends Dl{constructor(e){super(e),this.name="LFOEffect",this._lfo=new jE({context:this.context,frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=e.type,yi(this,["frequency","depth"])}static getDefaults(){return Object.assign(Dl.getDefaults(),{frequency:1,type:"sine",depth:1})}start(e){return this._lfo.start(e),this}stop(e){return this._lfo.stop(e),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class i8 extends o9{constructor(){const e=Yn(i8.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(e),this.name="AutoFilter",this.filter=new Nc(Object.assign(e.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency}static getDefaults(){return Object.assign(o9.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}dispose(){return super.dispose(),this.filter.dispose(),this}}class s8 extends Qn{constructor(){const e=Yn(s8.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Zr({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",yi(this,"pan")}static getDefaults(){return Object.assign(Qn.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class o8 extends Qn{constructor(){const e=Yn(o8.getDefaults(),arguments,["smoothing"]);super(e),this.name="Follower",this._abs=this.input=new iMe({context:this.context}),this._lowpass=this.output=new n8({context:this.context,frequency:1/this.toSeconds(e.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=e.smoothing}static getDefaults(){return Object.assign(Qn.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class a8 extends Dl{constructor(){const e=Yn(a8.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);super(e),this.name="AutoWah",this._follower=new o8({context:this.context,smoothing:e.follower}),this._sweepRange=new Z6({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this._inputBoost=new Vr({context:this.context}),this._bandpass=new Nc({context:this.context,rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new Nc({context:this.context,type:"peaking"}),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,yi(this,["gain","Q"])}static getDefaults(){return Object.assign(Dl.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(e){this._follower.smoothing=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._setSweepRange()}get sensitivity(){return lee(1/this._inputBoost.gain.value)}set sensitivity(e){this._inputBoost.gain.value=1/cee(e)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const hMe="bit-crusher",fMe=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;gee(hMe,fMe);class pI extends Qn{constructor(){const e=Yn(pI.getDefaults(),arguments,["channels"]);super(e),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Qn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class vC extends Qn{constructor(){const e=Yn(vC.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(Qn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class a9 extends Qn{constructor(e){super(e),this.name="StereoEffect",this.input=new Vr({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new dI({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new pI({context:this.context,channels:2}),this._merge=new vC({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),yi(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),U1(...e),up(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),U1(...e),up(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Qn.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class c9 extends a9{constructor(e){super(e),this.feedback=new Mi({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new Vr({context:this.context}),this._feedbackR=new Vr({context:this.context}),this._feedbackSplit=new pI({context:this.context,channels:2}),this._feedbackMerge=new vC({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),yi(this,["feedback"])}static getDefaults(){return Object.assign(a9.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class c8 extends c9{constructor(){const e=Yn(c8.getDefaults(),arguments,["frequency","delayTime","depth"]);super(e),this.name="Chorus",this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new jE({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new jE({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new BE({context:this.context}),this._delayNodeR=new BE({context:this.context}),this.frequency=this._lfoL.frequency,yi(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(c9.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;const n=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-n,0),this._lfoL.max=this._delayTime+n,this._lfoR.min=Math.max(this._delayTime-n,0),this._lfoR.max=this._delayTime+n}get delayTime(){return this._delayTime*1e3}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class yA extends Dl{constructor(){const e=Yn(yA.getDefaults(),arguments,["distortion"]);super(e),this.name="Distortion",this._shaper=new Nv({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(Dl.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;const n=e*100,r=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+n)*i*20*r/(Math.PI+n*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class l9 extends Dl{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new Vr({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,yi(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Dl.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class l8 extends l9{constructor(){const e=Yn(l8.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new BE({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),yi(this,"delayTime")}static getDefaults(){return Object.assign(l9.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class u8 extends Dl{constructor(){const e=Yn(u8.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const n=this.toSeconds(e.decay);Kf(n,.001),this._decay=n;const r=this.toSeconds(e.preDelay);Kf(r,0),this._preDelay=r,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Dl.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Kf(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Kf(e,0),this._preDelay=e,this.generate()}generate(){return oo(this,void 0,void 0,function*(){const e=this.ready,n=new hC(2,this._decay+this._preDelay,this.context.sampleRate),r=new B1({context:n}),i=new B1({context:n}),s=new vC({context:n});r.connect(s,0,0),i.connect(s,0,1);const o=new Vr({context:n}).toDestination();s.connect(o),r.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=n.render();return this.ready=a.then(hs),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class mI extends Dl{constructor(){const e=Yn(mI.getDefaults(),arguments,["frequency","depth"]);super(e),this.name="Vibrato",this._delayNode=new BE({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new jE({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,yi(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(Dl.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Va extends Qn{constructor(){const e=Yn(Va.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new Vr({context:this.context}),Va._allSolos.has(this.context)||Va._allSolos.set(this.context,new Set),Va._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Qn.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Va._allSolos.get(this.context).forEach(n=>n._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Va._soloed.has(this.context)||Va._soloed.set(this.context,new Set),Va._soloed.get(this.context).add(this)}_removeSolo(){Va._soloed.has(this.context)&&Va._soloed.get(this.context).delete(this)}_isSoloed(){return Va._soloed.has(this.context)&&Va._soloed.get(this.context).has(this)}_noSolos(){return!Va._soloed.has(this.context)||Va._soloed.has(this.context)&&Va._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Va._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Va._allSolos=new Map;Va._soloed=new Map;class h8 extends Qn{constructor(){const e=Yn(h8.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new s8({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new th({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,yi(this,["pan","volume"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class nh extends Qn{constructor(){const e=Yn(nh.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new Va({solo:e.solo,context:this.context}),this._panVol=this.output=new h8({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),yi(this,["pan","volume"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return nh.buses.has(e)||nh.buses.set(e,new Vr({context:this.context})),nh.buses.get(e)}send(e,n=0){const r=this._getBus(e),i=new Vr({context:this.context,units:"decibels",gain:n});return this.connect(i),i.connect(r),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}nh.buses=new Map;class f8 extends Qn{constructor(){const e=Yn(f8.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(e),this.name="MultibandSplit",this.input=new Vr({context:this.context}),this.output=void 0,this.low=new Nc({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Nc({context:this.context,frequency:0,type:"highpass"}),this.mid=new Nc({context:this.context,frequency:0,type:"lowpass"}),this.high=new Nc({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new Mi({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new Mi({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new Mi({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),yi(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),uC(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class d8 extends Qn{constructor(){const e=Yn(d8.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new Zr({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new Zr({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new Zr({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new Zr({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new Zr({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),yi(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class bA extends Qn{constructor(){const e=Yn(bA.getDefaults(),arguments,["low","mid","high"]);super(e),this.name="EQ3",this.output=new Vr({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new f8({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new Vr({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new Vr({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new Vr({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),yi(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(Qn.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),uC(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}bo().transport;function KL(){return bo().transport}bo().destination;bo().destination;function dMe(){return bo().destination}bo().listener;bo().draw;bo();const u9=4,pMe={a:1,b:2,c:3,d:4,e:5,f:6,g:7,x:8,A:1,B:2,C:3,D:4,E:5,F:6,G:7,X:8,"#":9,"!":10,y:13,t:14,s:15,i:16,q:17,h:18,w:19,Y:13,T:14,S:15,I:16,Q:17,H:18,W:19,3:20,".":21,"+":11,"-":12,0:22,1:23,2:24,p:25,4:26,5:27,6:29,7:28,8:30,9:31},_ee="64n";function mMe(t){return Oc({[_ee]:t}).toNotation()}function gMe(t){return Oc({[_ee]:t}).toSeconds()}function vee(t,e,n,r=!0,i=mMe,s=gMe){let o=e,a=4,c=2,l="",u="";const h=[];function f(){u="",l="",o+=s(c)}function d(){const p=i(c);u===null?(h.push([o,[t,p,u]]),f()):nn(u)?(h.push([o,[t,p,u]]),f()):u.startsWith("#")?(h.push([o,[t,p,u]]),f()):u!==""&&(h.push([o,[t,p,`${u}${l}${a}`]]),f())}if(dn(n))u=n;else for(let p=0;p<n.length;++p){switch(n[p]){case 9:case 10:break;default:d();break}switch(n[p]){case 1:u="A";break;case 2:u="B";break;case 3:u="C";break;case 4:u="D";break;case 5:u="E";break;case 6:u="F";break;case 7:u="G";break;case 8:u=null;break;case 9:l+="#";break;case 10:l+="b";break;case 11:a<8&&++a;break;case 12:a>0&&--a;break;case 13:c=1;break;case 14:c=2;break;case 15:c=4;break;case 16:c=8;break;case 17:c=16;break;case 18:c=32;break;case 19:c=64;break;case 20:c=Math.round(c/3);break;case 21:c=Math.round(c*3/2);break;case 22:u=0;break;case 23:u=1;break;case 24:u=2;break;case 25:u=3;break;case 26:u=4;break;case 27:u=5;break;case 29:u=6;break;case 28:u=7;break;case 30:u=8;break;case 31:u=9;break}}return d(),r&&h.push([o,[t,"8n",-1]]),h}function XL(t){const e=[],n=t.split(";");for(let r=0;r<n.length;++r){const i=[],s=n[r];for(let o=0;o<s.length;++o){const a=pMe[s[o]];fe(a)&&i.push(a)}e.push(i)}return e}const h9="synthstate",_Me={voices:{},voicefx:{}};function yee(t){const e=Zh(la.MAIN),n=IE(e,h9,t);if(fe(n))return n;const r=Ts(_Me);return dA(e,h9,t,r),r}function mN(t,e,n,r){const i=yee(t);if(rr(n)==="restart"){i.voices={},i.voicefx={};return}fe(i.voices[e])||(i.voices[e]={}),i.voices[e][n]=r}function bee(t,e,n,r,i){const s=yee(t);switch(fe(s.voicefx[e])||(s.voicefx[e]={}),fe(s.voicefx[e][n])||(s.voicefx[e][n]={}),r){case"on":s.voicefx[e][n].on="on";break;case"off":s.voicefx[e][n].on="off";break;default:nn(r)?s.voicefx[e][n].on=i:s.voicefx[e][n][r]=i;break}}const f9="synthplay",vMe=[];function d9(t){const e=Zh(la.MAIN),n=IE(e,f9,t);if(fe(n))return n;const r=Ts(vMe);return dA(e,f9,t,r),r}function yMe(t,e){const n=Zh(la.MAIN);if(!fe(n))return;if(t===""){yj(qe,"",t,e);return}if(e===""){const o=d9(t);o.length=0,yj(qe,"",t,"");return}const r=XL(e);let i=0;for(let o=0;o<r.length;++o){const a=r[o],c=vee(o,0,a,!0,u=>`${u}n`,u=>Math.max(1,Math.round(u*.5-2))),l=c[c.length-1];fe(l)&&(i=Math.max(i,l[0]))}d9(t).push([e,i])}let p9=0;const m9=Lm,bMe=["Command","lines"];class SMe extends ESe{constructor(){super(CZ,{traceInitPerf:Lm,skipValidations:!Lm,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"}),this.performSelfAnalysis()}PEEK(e,n,...r){console.info(e,r.map(i=>[i.image,i.tokenType]),n)}RULED(e,n,r){const i=bMe.some(s=>e.includes(s));return this.RULE(e,()=>{const o=(p9++).toString().padStart(3),a=i?"font-weight: bold;":"";if(m9&&!this.RECORDING_PHASE){const c=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${o}%c> ${e} ${c.join(" ")}`,a)}n(),m9&&!this.RECORDING_PHASE&&console.info(`${o}%c< ${e} `,a),p9--},r)}program=this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))});line=this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(oA)}])});stmt=this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])});inline_go=this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))});inline_try=this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))});inline_command=this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))});inline=this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])});stmt_label=this.RULED("stmt_label",()=>{this.CONSUME(OE)});stmt_stat=this.RULED("stmt_stat",()=>{this.CONSUME(P1)});stmt_text=this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(aA)}])});stmt_comment=this.RULED("stmt_comment",()=>{this.CONSUME(cA)});stmt_hyperlink=this.RULED("stmt_hyperlink",()=>{this.CONSUME(lA),this.CONSUME(Q5)});stmt_command=this.RULED("stmt_command",()=>{this.CONSUME(mg),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])});structured_cmd=this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])});short_go=this.RULED("short_go",()=>{this.CONSUME(_1),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});short_try=this.RULED("short_try",()=>{this.CONSUME(uA),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});command_if=this.RULED("command_if",()=>{this.CONSUME(v1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))});command_if_block=this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(y1),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(oA)),this.CONSUME4(mg),this.CONSUME4(wM)}}])});command_block=this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(y1),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(mg),this.CONSUME(wM)}}])});command_fork=this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(y1),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])});command_else_if=this.RULED("command_else_if",()=>{this.CONSUME(mg),this.CONSUME(b1),this.CONSUME(v1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))});command_else=this.RULED("command_else",()=>{this.CONSUME(mg),this.CONSUME(b1),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))});command_while=this.RULED("command_while",()=>{this.CONSUME(d6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_repeat=this.RULED("command_repeat",()=>{this.CONSUME(p6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_waitfor=this.RULED("command_waitfor",()=>{this.CONSUME(m6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_foreach=this.RULED("command_foreach",()=>{this.CONSUME(g6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_break=this.RULED("command_break",()=>{this.CONSUME(_6)});command_continue=this.RULED("command_continue",()=>{this.CONSUME(v6)});command_play=this.RULED("command_play",()=>{this.CONSUME(f6)});command_toast=this.RULED("command_toast",()=>{this.CONSUME(wZ)});command_ticker=this.RULED("command_ticker",()=>{this.CONSUME(TZ)});expr=this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(yM),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})});and_test=this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(SM),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})});not_test=this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(bM),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])});comparison=this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})});comp_op=this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(e6)},{ALT:()=>this.CONSUME(t6)},{ALT:()=>this.CONSUME(n6)},{ALT:()=>this.CONSUME(r6)},{ALT:()=>this.CONSUME(i6)},{ALT:()=>this.CONSUME(s6)}])});expr_value=this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(yM),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})});and_test_value=this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(SM),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})});not_test_value=this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(bM),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])});arith_expr=this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])});arith_expr_item=this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(EM)},{ALT:()=>this.CONSUME(xM)}]),this.SUBRULE(this.term)});term=this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))});term_item=this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(a6)},{ALT:()=>this.CONSUME(_1)},{ALT:()=>this.CONSUME(c6)},{ALT:()=>this.CONSUME(l6)}]),this.SUBRULE(this.factor)});factor=this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(EM)},{ALT:()=>this.CONSUME(xM)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])});power=this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(o6),this.SUBRULE(this.factor)})});words=this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))});kind=this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)});category=this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(WK)},{ALT:()=>this.CONSUME(qK)}])});collision=this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(YK)},{ALT:()=>this.CONSUME(KK)},{ALT:()=>this.CONSUME(XK)},{ALT:()=>this.CONSUME(JK)},{ALT:()=>this.CONSUME(ZK)},{ALT:()=>this.CONSUME(QK)},{ALT:()=>this.CONSUME(eX)},{ALT:()=>this.CONSUME(tX)},{ALT:()=>this.CONSUME(nX)}])});color=this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(rX)},{ALT:()=>this.CONSUME(iX)},{ALT:()=>this.CONSUME(sX)},{ALT:()=>this.CONSUME(oX)},{ALT:()=>this.CONSUME(aX)},{ALT:()=>this.CONSUME(cX)},{ALT:()=>this.CONSUME(lX)},{ALT:()=>this.CONSUME(uX)},{ALT:()=>this.CONSUME(hX)},{ALT:()=>this.CONSUME(fX)},{ALT:()=>this.CONSUME(dX)},{ALT:()=>this.CONSUME(pX)},{ALT:()=>this.CONSUME(mX)},{ALT:()=>this.CONSUME(gX)},{ALT:()=>this.CONSUME(_X)},{ALT:()=>this.CONSUME(vX)},{ALT:()=>this.CONSUME(yX)},{ALT:()=>this.CONSUME(bX)},{ALT:()=>this.CONSUME(SX)},{ALT:()=>this.CONSUME(EX)},{ALT:()=>this.CONSUME(xX)},{ALT:()=>this.CONSUME(wX)},{ALT:()=>this.CONSUME(TX)},{ALT:()=>this.CONSUME(AX)},{ALT:()=>this.CONSUME(CX)},{ALT:()=>this.CONSUME(RX)},{ALT:()=>this.CONSUME(kX)},{ALT:()=>this.CONSUME(MX)},{ALT:()=>this.CONSUME(OX)},{ALT:()=>this.CONSUME(IX)},{ALT:()=>this.CONSUME(NX)},{ALT:()=>this.CONSUME(PX)},{ALT:()=>this.CONSUME(DX)},{ALT:()=>this.CONSUME(LX)},{ALT:()=>this.CONSUME(UX)},{ALT:()=>this.CONSUME(BX)},{ALT:()=>this.CONSUME(FX)},{ALT:()=>this.CONSUME(jX)},{ALT:()=>this.CONSUME(zX)},{ALT:()=>this.CONSUME(VX)},{ALT:()=>this.CONSUME(HX)},{ALT:()=>this.CONSUME($X)},{ALT:()=>this.CONSUME(GX)},{ALT:()=>this.CONSUME(WX)},{ALT:()=>this.CONSUME(qX)},{ALT:()=>this.CONSUME(YX)},{ALT:()=>this.CONSUME(KX)},{ALT:()=>this.CONSUME(XX)},{ALT:()=>this.CONSUME(JX)},{ALT:()=>this.CONSUME(ZX)},{ALT:()=>this.CONSUME(QX)},{ALT:()=>this.CONSUME(eJ)},{ALT:()=>this.CONSUME(tJ)},{ALT:()=>this.CONSUME(nJ)},{ALT:()=>this.CONSUME(rJ)},{ALT:()=>this.CONSUME(iJ)},{ALT:()=>this.CONSUME(sJ)},{ALT:()=>this.CONSUME(oJ)},{ALT:()=>this.CONSUME(aJ)},{ALT:()=>this.CONSUME(cJ)},{ALT:()=>this.CONSUME(lJ)},{ALT:()=>this.CONSUME(uJ)},{ALT:()=>this.CONSUME(hJ)},{ALT:()=>this.CONSUME(fJ)},{ALT:()=>this.CONSUME(dJ)},{ALT:()=>this.CONSUME(pJ)},{ALT:()=>this.CONSUME(mJ)},{ALT:()=>this.CONSUME(gJ)},{ALT:()=>this.CONSUME(_J)},{ALT:()=>this.CONSUME(vJ)}])});dir_mod=this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(OJ)},{ALT:()=>this.CONSUME(IJ)},{ALT:()=>this.CONSUME(NJ)},{ALT:()=>this.CONSUME(PJ)},{ALT:()=>this.CONSUME(QJ)},{ALT:()=>this.CONSUME(eZ)},{ALT:()=>this.CONSUME(tZ)},{ALT:()=>this.SUBRULE(this.dir_within)},{ALT:()=>this.SUBRULE(this.dir_awayby)},{ALT:()=>this.CONSUME(iZ)}])});dir_by=this.RULED("dir_by",()=>{this.CONSUME(wJ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_at=this.RULED("dir_at",()=>{this.CONSUME(TJ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_away=this.RULED("dir_away",()=>{this.CONSUME(DJ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_toward=this.RULED("dir_toward",()=>{this.CONSUME(LJ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_find=this.RULED("dir_find",()=>{this.CONSUME(UJ),this.OR([{ALT:()=>this.SUBRULE(this.kind)},{ALT:()=>this.CONSUME(ZS)}])});dir_flee=this.RULED("dir_flee",()=>{this.CONSUME(BJ),this.OR([{ALT:()=>this.SUBRULE(this.kind)},{ALT:()=>this.CONSUME(ZS)}])});dir_to=this.RULED("dir_to",()=>{this.CONSUME(FJ),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)});dir_within=this.RULED("dir_within",()=>{this.CONSUME(nZ),this.SUBRULE1(this.simple_token)});dir_awayby=this.RULED("dir_awayby",()=>{this.CONSUME(rZ),this.SUBRULE1(this.simple_token)});dir=this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(yJ)},{ALT:()=>this.CONSUME(bJ)},{ALT:()=>this.CONSUME(SJ)},{ALT:()=>this.CONSUME(EJ)},{ALT:()=>this.CONSUME(xJ)},{ALT:()=>this.SUBRULE(this.dir_by)},{ALT:()=>this.SUBRULE(this.dir_at)},{ALT:()=>this.SUBRULE(this.dir_away)},{ALT:()=>this.SUBRULE(this.dir_toward)},{ALT:()=>this.CONSUME(AJ)},{ALT:()=>this.CONSUME(CJ)},{ALT:()=>this.CONSUME(RJ)},{ALT:()=>this.CONSUME(kJ)},{ALT:()=>this.CONSUME(MJ)},{ALT:()=>this.SUBRULE(this.dir_find)},{ALT:()=>this.SUBRULE(this.dir_flee)},{ALT:()=>this.SUBRULE(this.dir_to)},{ALT:()=>this.CONSUME(jJ)},{ALT:()=>this.CONSUME(zJ)},{ALT:()=>this.CONSUME(VJ)},{ALT:()=>this.CONSUME(HJ)},{ALT:()=>this.CONSUME($J)},{ALT:()=>this.CONSUME(GJ)},{ALT:()=>this.CONSUME(WJ)},{ALT:()=>this.CONSUME(qJ)},{ALT:()=>this.CONSUME(YJ)},{ALT:()=>this.CONSUME(KJ)},{ALT:()=>this.CONSUME(XJ)},{ALT:()=>this.CONSUME(JJ)},{ALT:()=>this.CONSUME(ZJ)}])});expr_any=this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])});token_expr_any=this.RULED("token_expr_any",()=>{this.CONSUME(cZ),this.SUBRULE(this.expr_any)});token_expr_count=this.RULED("token_expr_count",()=>{this.CONSUME(lZ),this.SUBRULE(this.expr_any)});token_expr_blocked=this.RULED("token_expr_blocked",()=>{this.CONSUME(aZ),this.SUBRULE(this.dir)});token_expr_abs=this.RULED("token_expr_abs",()=>{this.CONSUME(uZ),this.SUBRULE(this.simple_token)});token_expr_intceil=this.RULED("token_expr_intceil",()=>{this.CONSUME(hZ),this.SUBRULE(this.simple_token)});token_expr_intfloor=this.RULED("token_expr_intfloor",()=>{this.CONSUME(fZ),this.SUBRULE(this.simple_token)});token_expr_intround=this.RULED("token_expr_intround",()=>{this.CONSUME(dZ),this.SUBRULE(this.simple_token)});token_expr_clamp=this.RULED("token_expr_clamp",()=>{this.CONSUME(pZ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)});token_expr_min=this.RULED("token_expr_min",()=>{this.CONSUME(mZ),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_max=this.RULED("token_expr_max",()=>{this.CONSUME(gZ),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pick=this.RULED("token_expr_pick",()=>{this.CONSUME(_Z),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pickwith=this.RULED("token_expr_pickwith",()=>{this.CONSUME(vZ),this.SUBRULE1(this.simple_token),this.AT_LEAST_ONE(()=>this.SUBRULE2(this.simple_token))});token_expr_random=this.RULED("token_expr_random",()=>{this.CONSUME(yZ),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))});token_expr_randomwith=this.RULED("token_expr_randomwith",()=>{this.CONSUME(bZ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))});token_expr_run=this.RULED("token_expr_run",()=>{this.CONSUME(SZ),this.SUBRULE(this.string_token)});token_expr_runwith=this.RULED("token_expr_runwith",()=>{this.CONSUME(EZ),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)});token_expr=this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(sZ)},{ALT:()=>this.CONSUME(oZ)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])});string_token=this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(_a)},{ALT:()=>this.CONSUME(FT)}])});simple_token=this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(ZS)},{ALT:()=>this.CONSUME(_a)},{ALT:()=>this.CONSUME(FT)},{ALT:()=>this.SUBRULE(this.color)}])});token=this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(OE)},{ALT:()=>this.CONSUME(FT)},{ALT:()=>this.CONSUME(_a)},{ALT:()=>this.CONSUME(ZS)},{ALT:()=>this.CONSUME(xZ)},{ALT:()=>{this.CONSUME(u6),this.SUBRULE(this.expr),this.CONSUME(h6)}}])})}const tE=new SMe;if(ome){const t=tE.getGAstProductions(),e=PSe(t);console.info(e)}const EMe=tE.getBaseCstVisitorConstructor();var Bn=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(Bn||{}),Ky=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Ky||{}),om=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(om||{}),Tk=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(Tk||{});function jo(t,e){const[n]=t??[];return(n?.image??e).trimStart().replaceAll(/^"|"$/g,"")}class xMe extends EMe{unique=0;constructor(){super(),Lm&&this.validateVisitor()}visit(e){if(Kn(e)&&(e=e[0]),!!fe(e))return this[e.name](e.children,e.location)}createcodenode(e,n){return[{...n,...e,lineindex:0}]}createstringnode(e,n){return this.createcodenode(e,{type:12,literal:1,value:n})}createtemplatenode(e,n){return this.createcodenode(e,{type:12,literal:2,value:n})}createmarknode(e,n,r){return this.createlinenode(e,this.createcodenode(e,{type:3,id:n,comment:r}))}creategotonode(e,n,r){return this.createlinenode(e,this.createcodenode(e,{type:4,id:n,comment:r}))}createlinenode(e,n){return this.createcodenode(e,{type:2,stmts:n})}createapinode(e,n,r){return this.createlinenode(e,this.createcodenode(e,{type:1,words:r,method:n}))}createlogicnode(e,n,r,i){return this.createlinenode(e,this.createcodenode(e,{type:14,skip:r,words:i,method:n}))}createcountnode(e){return this.createcodenode(e,{type:5,index:this.unique++})}createexprnodeondemand(e,n){return e.length===1?e[0]:this.createcodenode(n,{type:31,words:e})[0]}go(e){return Array.isArray(e)?e.map(n=>this.visit(n)).flat():fe(e)?[this.visit(e)].flat():[]}program(e,n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(e.line)].flat()})}line(e){return e.stmt?this.go(e.stmt):[]}stmt(e){return e.stmt_label?this.go(e.stmt_label):e.stmt_stat?this.go(e.stmt_stat):e.stmt_text?this.go(e.stmt_text):e.stmt_comment?this.go(e.stmt_comment):e.stmt_hyperlink?this.go(e.stmt_hyperlink):e.stmt_command?this.go(e.stmt_command):e.short_go?this.go(e.short_go):e.short_try?this.go(e.short_try):[]}inline_go(e){const n=[];return e.short_go&&n.push(...this.go(e.short_go)),e.inline&&n.push(...this.go(e.inline)),n}inline_try(e){const n=[];return e.short_try&&n.push(...this.go(e.short_try)),e.inline&&n.push(...this.go(e.inline)),n}inline_command(e){const n=[];return e.stmt_command&&n.push(...this.go(e.stmt_command)),e.inline&&n.push(...this.go(e.inline)),n}inline(e){const n=[];return e.stmt_stat&&n.push(...this.go(e.stmt_stat)),e.stmt_text&&n.push(...this.go(e.stmt_text)),e.stmt_comment&&n.push(...this.go(e.stmt_comment)),e.stmt_hyperlink&&n.push(...this.go(e.stmt_hyperlink)),e.inline_go&&n.push(...this.go(e.inline_go)),e.inline_try&&n.push(...this.go(e.inline_try)),e.inline_command&&n.push(...this.go(e.inline_command)),e.structured_cmd&&n.push(...this.go(e.structured_cmd)),n}stmt_label(e,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:jo(e.token_label,":").slice(1).trim()}))}stmt_stat(e,n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:jo(e.token_stat,"@").slice(1)}))}stmt_text(e,n){const r=jo(e.token_text,"");return this.createlinenode(n,this.createcodenode(n,{type:6,value:r}))}stmt_comment(e,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:jo(e.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(e,n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:jo(e.token_hyperlink,"!").slice(1),text:jo(e.token_hyperlinktext,";").slice(1)}))}stmt_command(e,n){return e.structured_cmd?this.go(e.structured_cmd):this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(e.words)}))}structured_cmd(e){return e.command_if?this.go(e.command_if):e.command_while?this.go(e.command_while):e.command_repeat?this.go(e.command_repeat):e.command_waitfor?this.go(e.command_waitfor):e.command_foreach?this.go(e.command_foreach):e.command_break?this.go(e.command_break):e.command_continue?this.go(e.command_continue):[]}short_go(e,n){return e.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}short_try(e,n){return e.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}command_if(e,n){const[r]=this.createlogicnode(n,jo(e.token_if,"if").toLowerCase(),"",this.go(e.words)),[i]=this.go(e.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(e,n){const r=Go(),i=Go();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(e.inline),this.go(e.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(e.command_else_if),this.go(e.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(e){return[this.go(e.inline),this.go(e.line)].flat()}command_fork(e){return[this.go(e.inline),this.go(e.line)].flat()}command_else_if(e,n){const r=Go(),i=Go();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,jo(e.token_if,"if"),r,this.go(e.words)),this.go(e.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(e,n){const r=[];return e.words&&r.push(...this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(e.words)}))),e.command_fork&&r.push(...this.go(e.command_fork)),this.createcodenode(n,{type:17,lines:r})}command_while(e,n){const r=Go(),i=Go();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(e.words)),this.go(e.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(e,n){const r=Go(),i=Go(),o=[this.createcountnode(n),this.go(e.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(e.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(e,n){const r=Go(),i=Go(),o=[this.createcountnode(n),this.go(e.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(e.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(e,n){const r=Go();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(e.words))].flat()})}command_break(e,n){return this.createcodenode(n,{type:19,goto:0})}command_continue(e,n){return this.createcodenode(n,{type:20,goto:0})}command_play(e,n){const r=jo(e.token_command_play,"").trim(),[i,...s]=r.split(" ");return[this.createstringnode(n,i),this.createstringnode(n,s.join(" "))].flat()}command_toast(e,n){const i=jo(e.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(n,"toast"),this.createtemplatenode(n,i)].flat()}command_ticker(e,n){const i=jo(e.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(n,"ticker"),this.createtemplatenode(n,i)].flat()}expr(e,n){return e.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),n),this.createexprnodeondemand(this.go(e.RHS),n)]}):this.go(e.LHS)}and_test(e,n){return e.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),n),this.createexprnodeondemand(this.go(e.RHS),n)]}):this.go(e.LHS)}not_test(e,n){return e.comparison?this.go(e.comparison):e.LHS?this.createcodenode(n,{type:26,items:this.go(e.LHS)}):[]}comparison(e,n){if(e.RHS){const[r]=this.go(e.comp_op);return this.createcodenode(n,{type:27,compare:r,lhs:this.createexprnodeondemand(this.go(e.LHS),n),rhs:this.createexprnodeondemand(this.go(e.RHS),n)})}return this.go(e.LHS)}comp_op(e,n){return e.token_iseq?this.createcodenode(n,{type:28,method:0}):e.token_isnoteq?this.createcodenode(n,{type:28,method:1}):e.token_islessthan?this.createcodenode(n,{type:28,method:2}):e.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):e.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):e.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(e,n){return e.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),n),this.createexprnodeondemand(this.go(e.RHS),n)]}):this.go(e.LHS)}and_test_value(e,n){return e.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),n),this.createexprnodeondemand(this.go(e.RHS),n)]}):this.go(e.LHS)}not_test_value(e,n){return e.arith_expr?this.go(e.arith_expr):e.LHS?this.createcodenode(n,{type:26,items:this.go(e.LHS)}):[]}arith_expr(e,n){if(e.LHS)return this.go(e.LHS);const r=this.go(e.term);return e.RHS?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(e.RHS)}):r}arith_expr_item(e,n){return this.createcodenode(n,{type:30,operator:e.token_plus?1:2,rhs:this.go(e.term)[0]})}term(e,n){return e.term_item?this.createcodenode(n,{type:29,lhs:this.go(e.factor)[0],items:this.go(e.term_item)}):this.go(e.factor)}term_item(e,n){let r=0;return e.token_multiply&&(r=4),e.token_divide&&(r=5),e.token_moddivide&&(r=6),e.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(e.factor)[0]})}factor(e,n){if(e.power)return this.go(e.power);let r=0;return e.token_plus&&(r=8),e.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(e.LHS)[0]})})}power(e,n){const r=this.go(e.token);return e.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(e.factor)[0]})}):r}words(e){return this.go(e.expr)}kind(e){return[this.go(e.color),this.go(e.string_token)].flat()}category(e,n){return e.token_isterrain?this.createcodenode(n,{type:12,literal:1,value:"isterrain"}):e.token_isobject?this.createcodenode(n,{type:12,literal:1,value:"isobject"}):[]}collision(e,n){return e.token_iswalkable?this.createcodenode(n,{type:12,literal:1,value:"iswalkable"}):e.token_iswalking?this.createcodenode(n,{type:12,literal:1,value:"iswalking"}):e.token_iswalk?this.createcodenode(n,{type:12,literal:1,value:"iswalk"}):e.token_isswimmable?this.createcodenode(n,{type:12,literal:1,value:"isswimmable"}):e.token_isswimming?this.createcodenode(n,{type:12,literal:1,value:"isswimming"}):e.token_isswim?this.createcodenode(n,{type:12,literal:1,value:"isswim"}):e.token_issolid?this.createcodenode(n,{type:12,literal:1,value:"issolid"}):e.token_isbullet?this.createcodenode(n,{type:12,literal:1,value:"isbullet"}):e.token_isghost?this.createcodenode(n,{type:12,literal:1,value:"isghost"}):[]}color(e,n){let r="ERROR";return e.token_black&&(r="black"),e.token_dkblue&&(r="dkblue"),e.token_dkgreen&&(r="dkgreen"),e.token_dkcyan&&(r="dkcyan"),e.token_dkred&&(r="dkred"),e.token_dkpurple&&(r="dkpurple"),e.token_dkyellow&&(r="dkyellow"),e.token_ltgray&&(r="ltgray"),e.token_dkgray&&(r="dkgray"),e.token_blue&&(r="blue"),e.token_green&&(r="green"),e.token_cyan&&(r="cyan"),e.token_red&&(r="red"),e.token_purple&&(r="purple"),e.token_yellow&&(r="yellow"),e.token_white&&(r="white"),e.token_brown&&(r="brown"),e.token_dkwhite&&(r="dkwhite"),e.token_ltgrey&&(r="ltgrey"),e.token_gray&&(r="gray"),e.token_grey&&(r="grey"),e.token_dkgrey&&(r="dkgrey"),e.token_ltblack&&(r="ltblack"),e.token_onblack&&(r="onblack"),e.token_ondkblue&&(r="ondkblue"),e.token_ondkgreen&&(r="ondkgreen"),e.token_ondkcyan&&(r="ondkcyan"),e.token_ondkred&&(r="ondkred"),e.token_ondkpurple&&(r="ondkpurple"),e.token_ondkyellow&&(r="ondkyellow"),e.token_onltgray&&(r="onltgray"),e.token_ondkgray&&(r="ondkgray"),e.token_onblue&&(r="onblue"),e.token_ongreen&&(r="ongreen"),e.token_oncyan&&(r="oncyan"),e.token_onred&&(r="onred"),e.token_onpurple&&(r="onpurple"),e.token_onyellow&&(r="onyellow"),e.token_onwhite&&(r="onwhite"),e.token_onbrown&&(r="onbrown"),e.token_ondkwhite&&(r="ondkwhite"),e.token_onltgrey&&(r="onltgrey"),e.token_ongray&&(r="ongray"),e.token_ongrey&&(r="ongrey"),e.token_ondkgrey&&(r="ondkgrey"),e.token_onltblack&&(r="onltblack"),e.token_onclear&&(r="onclear"),e.token_blblack&&(r="blblack"),e.token_bldkblue&&(r="blblue"),e.token_bldkgreen&&(r="blgreen"),e.token_bldkcyan&&(r="bldkcyan"),e.token_bldkred&&(r="bldkred"),e.token_bldkpurple&&(r="bldkpurple"),e.token_bldkyellow&&(r="bldkyellow"),e.token_blltgray&&(r="blltgray"),e.token_bldkgray&&(r="bldkgray"),e.token_blblue&&(r="blblue"),e.token_blgreen&&(r="blgreen"),e.token_blcyan&&(r="blcyan"),e.token_blred&&(r="blred"),e.token_blpurple&&(r="blpurple"),e.token_blyellow&&(r="blyellow"),e.token_blwhite&&(r="blwhite"),e.token_blbrown&&(r="blbrown"),e.token_bldkwhite&&(r="bldkwhite"),e.token_blltgrey&&(r="blltgrey"),e.token_blgray&&(r="blgray"),e.token_blgrey&&(r="blgrey"),e.token_bldkgrey&&(r="bldkgrey"),e.token_blltblack&&(r="blltblack"),this.createcodenode(n,{type:12,literal:1,value:r})}dir_mod(e,n){if(e.dir_within)return this.go(e.dir_within);if(e.dir_awayby)return this.go(e.dir_awayby);let r="ERROR";return e.token_cw&&(r="cw"),e.token_ccw&&(r="ccw"),e.token_opp&&(r="opp"),e.token_rndp&&(r="rndp"),e.token_over&&(r="over"),e.token_under&&(r="under"),e.token_ground&&(r="ground"),e.token_elements&&(r="elements"),this.createcodenode(n,{type:12,literal:1,value:r})}dir_by(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"by"}),...this.go(e.simple_token)]}dir_at(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"at"}),...this.go(e.simple_token)]}dir_away(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"away"}),...this.go(e.simple_token)]}dir_toward(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"toward"}),...this.go(e.simple_token)]}dir_find(e,n){const r=this.go(e.kind);if(e.token_numberliteral){const i=parseFloat(jo(e.token_numberliteral,"0"));r.push(...this.createcodenode(n,{type:12,literal:0,value:i}))}return[...this.createcodenode(n,{type:12,literal:1,value:"find"}),...r]}dir_flee(e,n){const r=this.go(e.kind);if(e.token_numberliteral){const i=parseFloat(jo(e.token_numberliteral,"0"));r.push(...this.createcodenode(n,{type:12,literal:0,value:i}))}return[...this.createcodenode(n,{type:12,literal:1,value:"flee"}),...r]}dir_to(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"to"}),...this.go(e.dir)]}dir_within(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"within"}),...this.go(e.simple_token)]}dir_awayby(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"awayby"}),...this.go(e.simple_token)]}dir(e,n){const r=this.go(e.dir_mod)??[];return e.token_i&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"i"})),e.token_idle&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"idle"})),e.token_n&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"n"})),e.token_u&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"u"})),e.token_north&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"north"})),e.token_up&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"up"})),e.token_s&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"s"})),e.token_d&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"d"})),e.token_south&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"south"})),e.token_down&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"down"})),e.token_w&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"w"})),e.token_l&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"l"})),e.token_west&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"west"})),e.token_left&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"left"})),e.token_e&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"e"})),e.token_r&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"r"})),e.token_east&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"east"})),e.token_right&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"right"})),e.token_rnd&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"rnd"})),e.token_rndne&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"rndne"})),e.token_rndns&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"rndns"})),e.token_flow&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"flow"})),e.token_seek&&r.push(...this.createcodenode(n,{type:12,literal:1,value:"seek"})),e.dir_by&&r.push(...this.go(e.dir_by)),e.dir_at&&r.push(...this.go(e.dir_at)),e.dir_away&&r.push(...this.go(e.dir_away)),e.dir_toward&&r.push(...this.go(e.dir_toward)),e.dir_find&&r.push(...this.go(e.dir_find)),e.dir_flee&&r.push(...this.go(e.dir_flee)),e.dir_to&&r.push(...this.go(e.dir_to)),r.flat()}expr_any(e){return[this.go(e.dir),this.go(e.kind),this.go(e.color)].flat()}token_expr_any(e,n){return[this.createcodenode(n,{type:12,literal:1,value:"any"}),this.go(e.expr_any)].flat()}token_expr_count(e,n){return[this.createcodenode(n,{type:12,literal:1,value:"countof"}),this.go(e.expr_any)].flat()}token_expr_blocked(e,n){return[this.createcodenode(n,{type:12,literal:1,value:"blocked"}),this.go(e.dir)].flat()}token_expr_abs(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"abs"}),...this.go(e.simple_token)]}token_expr_intceil(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intceil"}),...this.go(e.simple_token)]}token_expr_intfloor(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intfloor"}),...this.go(e.simple_token)]}token_expr_intround(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intround"}),...this.go(e.simple_token)]}token_expr_clamp(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"clamp"}),...this.go(e.simple_token)]}token_expr_min(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"min"}),...this.go(e.simple_token)]}token_expr_max(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"max"}),...this.go(e.simple_token)]}token_expr_pick(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pick"}),...this.go(e.simple_token)]}token_expr_pickwith(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pickwith"}),...this.go(e.simple_token)]}token_expr_random(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"random"}),...this.go(e.simple_token)]}token_expr_randomwith(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"randomwith"}),...this.go(e.simple_token)]}token_expr_run(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"run"}),...this.go(e.string_token)]}token_expr_runwith(e,n){return[...this.createcodenode(n,{type:12,literal:1,value:"runwith"}),...this.go(e.simple_token),...this.go(e.string_token)]}token_expr(e,n){return e.token_expr_aligned?this.createcodenode(n,{type:12,literal:1,value:"aligned"}):e.token_contact?this.createcodenode(n,{type:12,literal:1,value:"contact"}):e.token_expr_any?this.go(e.token_expr_any):e.token_expr_count?this.go(e.token_expr_count):e.token_expr_blocked?this.go(e.token_expr_blocked):e.token_expr_abs?this.go(e.token_expr_abs):e.token_expr_intceil?this.go(e.token_expr_intceil):e.token_expr_intfloor?this.go(e.token_expr_intfloor):e.token_expr_intround?this.go(e.token_expr_intround):e.token_expr_clamp?this.go(e.token_expr_clamp):e.token_expr_min?this.go(e.token_expr_min):e.token_expr_max?this.go(e.token_expr_max):e.token_expr_pick?this.go(e.token_expr_pick):e.token_expr_pickwith?this.go(e.token_expr_pickwith):e.token_expr_random?this.go(e.token_expr_random):e.token_expr_randomwith?this.go(e.token_expr_randomwith):e.token_expr_run?this.go(e.token_expr_run):e.token_expr_runwith?this.go(e.token_expr_runwith):[]}string_token(e,n){if(e.token_stringliteraldouble){const r=jo(e.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=jo(e.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:r})}return[]}simple_token(e,n){if(e.token_stringliteraldouble){const r=jo(e.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=jo(e.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(e.token_numberliteral){const r=parseFloat(jo(e.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return e.color?this.go(e.color):[]}token(e,n){if(e.category)return this.go(e.category);if(e.collision)return this.go(e.collision);if(e.color)return this.go(e.color);if(e.dir)return this.go(e.dir);if(e.command_play)return this.go(e.command_play);if(e.command_toast)return this.go(e.command_toast);if(e.command_ticker)return this.go(e.command_ticker);if(e.token_label){const r=jo(e.token_label,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(e.token_stringliteraldouble){const r=jo(e.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=jo(e.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(e.token_numberliteral){const r=parseFloat(jo(e.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}if(e.token_lparen)return[this.createexprnodeondemand(this.go(e.expr),n)];if(e.token_stop){const r=jo(e.token_stop,"");return this.createcodenode(n,{type:12,literal:1,value:r})}return[]}}const wMe=new xMe;function JL(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];Kn(r)?r.forEach(i=>{e.push(JL(i))}):e.push(JL(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>n?.start??0)),end:Math.max(...e.filter(n=>n).map(n=>n?.end??0))},t.range}function See(t){const e=RZ(`${t}
`);if(e.errors.length>0)return e;tE.input=e.tokens;const n=tE.program();if(tE.errors.length>0)return{tokens:e.tokens,errors:tE.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=wMe.go(n);return r?(JL(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}var iw={},gN={},_N={},vN={},g9;function TMe(){if(g9)return vN;g9=1;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return vN.encode=function(e){if(0<=e&&e<t.length)return t[e];throw new TypeError("Must be between 0 and 63: "+e)},vN}var _9;function Eee(){if(_9)return _N;_9=1;const t=TMe(),e=5,n=1<<e,r=n-1,i=n;function s(o){return o<0?(-o<<1)+1:(o<<1)+0}return _N.encode=function(a){let c="",l,u=s(a);do l=u&r,u>>>=e,u>0&&(l|=i),c+=t.encode(l);while(u>0);return c},_N}var jd={},Cy={},TT={exports:{}};var AMe=TT.exports,v9;function CMe(){return v9||(v9=1,(function(t,e){(function(n){var r=e&&!e.nodeType&&e,i=t&&!t.nodeType&&t,s=typeof qf=="object"&&qf;(s.global===s||s.window===s||s.self===s)&&(n=s);var o,a=2147483647,c=36,l=1,u=26,h=38,f=700,d=72,p=128,m="-",g=/^xn--/,_=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=c-l,x=Math.floor,A=String.fromCharCode,T;function k(re){throw new RangeError(v[re])}function L(re,H){for(var Y=re.length,Z=[];Y--;)Z[Y]=H(re[Y]);return Z}function I(re,H){var Y=re.split("@"),Z="";Y.length>1&&(Z=Y[0]+"@",re=Y[1]),re=re.replace(y,".");var Q=re.split("."),ie=L(Q,H).join(".");return Z+ie}function F(re){for(var H=[],Y=0,Z=re.length,Q,ie;Y<Z;)Q=re.charCodeAt(Y++),Q>=55296&&Q<=56319&&Y<Z?(ie=re.charCodeAt(Y++),(ie&64512)==56320?H.push(((Q&1023)<<10)+(ie&1023)+65536):(H.push(Q),Y--)):H.push(Q);return H}function M(re){return L(re,function(H){var Y="";return H>65535&&(H-=65536,Y+=A(H>>>10&1023|55296),H=56320|H&1023),Y+=A(H),Y}).join("")}function D(re){return re-48<10?re-22:re-65<26?re-65:re-97<26?re-97:c}function O(re,H){return re+22+75*(re<26)-((H!=0)<<5)}function z(re,H,Y){var Z=0;for(re=Y?x(re/f):re>>1,re+=x(re/H);re>E*u>>1;Z+=c)re=x(re/E);return x(Z+(E+1)*re/(re+h))}function q(re){var H=[],Y=re.length,Z,Q=0,ie=p,ge=d,Te,be,Pe,Ge,Ze,lt,pt,ne,Le;for(Te=re.lastIndexOf(m),Te<0&&(Te=0),be=0;be<Te;++be)re.charCodeAt(be)>=128&&k("not-basic"),H.push(re.charCodeAt(be));for(Pe=Te>0?Te+1:0;Pe<Y;){for(Ge=Q,Ze=1,lt=c;Pe>=Y&&k("invalid-input"),pt=D(re.charCodeAt(Pe++)),(pt>=c||pt>x((a-Q)/Ze))&&k("overflow"),Q+=pt*Ze,ne=lt<=ge?l:lt>=ge+u?u:lt-ge,!(pt<ne);lt+=c)Le=c-ne,Ze>x(a/Le)&&k("overflow"),Ze*=Le;Z=H.length+1,ge=z(Q-Ge,Z,Ge==0),x(Q/Z)>a-ie&&k("overflow"),ie+=x(Q/Z),Q%=Z,H.splice(Q++,0,ie)}return M(H)}function G(re){var H,Y,Z,Q,ie,ge,Te,be,Pe,Ge,Ze,lt=[],pt,ne,Le,Ve;for(re=F(re),pt=re.length,H=p,Y=0,ie=d,ge=0;ge<pt;++ge)Ze=re[ge],Ze<128&&lt.push(A(Ze));for(Z=Q=lt.length,Q&&lt.push(m);Z<pt;){for(Te=a,ge=0;ge<pt;++ge)Ze=re[ge],Ze>=H&&Ze<Te&&(Te=Ze);for(ne=Z+1,Te-H>x((a-Y)/ne)&&k("overflow"),Y+=(Te-H)*ne,H=Te,ge=0;ge<pt;++ge)if(Ze=re[ge],Ze<H&&++Y>a&&k("overflow"),Ze==H){for(be=Y,Pe=c;Ge=Pe<=ie?l:Pe>=ie+u?u:Pe-ie,!(be<Ge);Pe+=c)Ve=be-Ge,Le=c-Ge,lt.push(A(O(Ge+Ve%Le,0))),be=x(Ve/Le);lt.push(A(O(be,0))),ie=z(Y,ne,Z==Q),Y=0,++Z}++Y,++H}return lt.join("")}function K(re){return I(re,function(H){return g.test(H)?q(H.slice(4).toLowerCase()):H})}function te(re){return I(re,function(H){return _.test(H)?"xn--"+G(H):H})}if(o={version:"1.4.1",ucs2:{decode:F,encode:M},decode:q,encode:G,toASCII:te,toUnicode:K},r&&i)if(t.exports==r)i.exports=o;else for(T in o)o.hasOwnProperty(T)&&(r[T]=o[T]);else n.punycode=o})(AMe)})(TT,TT.exports)),TT.exports}var yN,y9;function ux(){return y9||(y9=1,yN=TypeError),yN}const RMe={},kMe=Object.freeze(Object.defineProperty({__proto__:null,default:RMe},Symbol.toStringTag,{value:"Module"})),MMe=VW(kMe);var bN,b9;function gI(){if(b9)return bN;b9=1;var t=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,n=t&&e&&typeof e.get=="function"?e.get:null,r=t&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,h=u?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,d=f?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,_=String.prototype.match,y=String.prototype.slice,v=String.prototype.replace,E=String.prototype.toUpperCase,x=String.prototype.toLowerCase,A=RegExp.prototype.test,T=Array.prototype.concat,k=Array.prototype.join,L=Array.prototype.slice,I=Math.floor,F=typeof BigInt=="function"?BigInt.prototype.valueOf:null,M=Object.getOwnPropertySymbols,D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,O=typeof Symbol=="function"&&typeof Symbol.iterator=="object",z=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===O||!0)?Symbol.toStringTag:null,q=Object.prototype.propertyIsEnumerable,G=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(Se){return Se.__proto__}:null);function K(Se,ye){if(Se===1/0||Se===-1/0||Se!==Se||Se&&Se>-1e3&&Se<1e3||A.call(/e/,ye))return ye;var Ke=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof Se=="number"){var ke=Se<0?-I(-Se):I(Se);if(ke!==Se){var He=String(ke),Fe=y.call(ye,He.length+1);return v.call(He,Ke,"$&_")+"."+v.call(v.call(Fe,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(ye,Ke,"$&_")}var te=MMe,re=te.custom,H=ne(re)?re:null,Y={__proto__:null,double:'"',single:"'"},Z={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};bN=function Se(ye,Ke,ke,He){var Fe=Ke||{};if(De(Fe,"quoteStyle")&&!De(Y,Fe.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(De(Fe,"maxStringLength")&&(typeof Fe.maxStringLength=="number"?Fe.maxStringLength<0&&Fe.maxStringLength!==1/0:Fe.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var We=De(Fe,"customInspect")?Fe.customInspect:!0;if(typeof We!="boolean"&&We!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(De(Fe,"indent")&&Fe.indent!==null&&Fe.indent!=="	"&&!(parseInt(Fe.indent,10)===Fe.indent&&Fe.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(De(Fe,"numericSeparator")&&typeof Fe.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var at=Fe.numericSeparator;if(typeof ye>"u")return"undefined";if(ye===null)return"null";if(typeof ye=="boolean")return ye?"true":"false";if(typeof ye=="string")return Nt(ye,Fe);if(typeof ye=="number"){if(ye===0)return 1/0/ye>0?"0":"-0";var Be=String(ye);return at?K(ye,Be):Be}if(typeof ye=="bigint"){var nt=String(ye)+"n";return at?K(ye,nt):nt}var it=typeof Fe.depth>"u"?5:Fe.depth;if(typeof ke>"u"&&(ke=0),ke>=it&&it>0&&typeof ye=="object")return Te(ye)?"[Array]":"[Object]";var xt=oe(Fe,ke);if(typeof He>"u")He=[];else if(ve(He,ye)>=0)return"[Circular]";function ot(qi,is,ss){if(is&&(He=L.call(He),He.push(is)),ss){var je={depth:Fe.depth};return De(Fe,"quoteStyle")&&(je.quoteStyle=Fe.quoteStyle),Se(qi,je,ke+1,He)}return Se(qi,Fe,ke+1,He)}if(typeof ye=="function"&&!Pe(ye)){var tn=ae(ye),ln=Ce(ye,ot);return"[Function"+(tn?": "+tn:" (anonymous)")+"]"+(ln.length>0?" { "+k.call(ln,", ")+" }":"")}if(ne(ye)){var Rt=O?v.call(String(ye),/^(Symbol\(.*\))_[^)]*$/,"$1"):D.call(ye);return typeof ye=="object"&&!O?wt(Rt):Rt}if(tt(ye)){for(var Vt="<"+x.call(String(ye.nodeName)),_t=ye.attributes||[],Jt=0;Jt<_t.length;Jt++)Vt+=" "+_t[Jt].name+"="+Q(ie(_t[Jt].value),"double",Fe);return Vt+=">",ye.childNodes&&ye.childNodes.length&&(Vt+="..."),Vt+="</"+x.call(String(ye.nodeName))+">",Vt}if(Te(ye)){if(ye.length===0)return"[]";var Tn=Ce(ye,ot);return xt&&!W(Tn)?"["+xe(Tn,xt)+"]":"[ "+k.call(Tn,", ")+" ]"}if(Ge(ye)){var qt=Ce(ye,ot);return!("cause"in Error.prototype)&&"cause"in ye&&!q.call(ye,"cause")?"{ ["+String(ye)+"] "+k.call(T.call("[cause]: "+ot(ye.cause),qt),", ")+" }":qt.length===0?"["+String(ye)+"]":"{ ["+String(ye)+"] "+k.call(qt,", ")+" }"}if(typeof ye=="object"&&We){if(H&&typeof ye[H]=="function"&&te)return te(ye,{depth:it-ke});if(We!=="symbol"&&typeof ye.inspect=="function")return ye.inspect()}if(we(ye)){var An=[];return r&&r.call(ye,function(qi,is){An.push(ot(is,ye,!0)+" => "+ot(qi,ye))}),se("Map",n.call(ye),An,xt)}if(Je(ye)){var Ln=[];return a&&a.call(ye,function(qi){Ln.push(ot(qi,ye))}),se("Set",o.call(ye),Ln,xt)}if(pe(ye))return Re("WeakMap");if(Xe(ye))return Re("WeakSet");if(ze(ye))return Re("WeakRef");if(lt(ye))return wt(ot(Number(ye)));if(Le(ye))return wt(ot(F.call(ye)));if(pt(ye))return wt(p.call(ye));if(Ze(ye))return wt(ot(String(ye)));if(typeof window<"u"&&ye===window)return"{ [object Window] }";if(typeof globalThis<"u"&&ye===globalThis||typeof qf<"u"&&ye===qf)return"{ [object globalThis] }";if(!be(ye)&&!Pe(ye)){var mr=Ce(ye,ot),ns=G?G(ye)===Object.prototype:ye instanceof Object||ye.constructor===Object,hi=ye instanceof Object?"":"null prototype",ti=!ns&&z&&Object(ye)===ye&&z in ye?y.call(Ie(ye),8,-1):hi?"Object":"",Fi=ns||typeof ye.constructor!="function"?"":ye.constructor.name?ye.constructor.name+" ":"",rs=Fi+(ti||hi?"["+k.call(T.call([],ti||[],hi||[]),": ")+"] ":"");return mr.length===0?rs+"{}":xt?rs+"{"+xe(mr,xt)+"}":rs+"{ "+k.call(mr,", ")+" }"}return String(ye)};function Q(Se,ye,Ke){var ke=Ke.quoteStyle||ye,He=Y[ke];return He+Se+He}function ie(Se){return v.call(String(Se),/"/g,"&quot;")}function ge(Se){return!z||!(typeof Se=="object"&&(z in Se||typeof Se[z]<"u"))}function Te(Se){return Ie(Se)==="[object Array]"&&ge(Se)}function be(Se){return Ie(Se)==="[object Date]"&&ge(Se)}function Pe(Se){return Ie(Se)==="[object RegExp]"&&ge(Se)}function Ge(Se){return Ie(Se)==="[object Error]"&&ge(Se)}function Ze(Se){return Ie(Se)==="[object String]"&&ge(Se)}function lt(Se){return Ie(Se)==="[object Number]"&&ge(Se)}function pt(Se){return Ie(Se)==="[object Boolean]"&&ge(Se)}function ne(Se){if(O)return Se&&typeof Se=="object"&&Se instanceof Symbol;if(typeof Se=="symbol")return!0;if(!Se||typeof Se!="object"||!D)return!1;try{return D.call(Se),!0}catch{}return!1}function Le(Se){if(!Se||typeof Se!="object"||!F)return!1;try{return F.call(Se),!0}catch{}return!1}var Ve=Object.prototype.hasOwnProperty||function(Se){return Se in this};function De(Se,ye){return Ve.call(Se,ye)}function Ie(Se){return m.call(Se)}function ae(Se){if(Se.name)return Se.name;var ye=_.call(g.call(Se),/^function\s*([\w$]+)/);return ye?ye[1]:null}function ve(Se,ye){if(Se.indexOf)return Se.indexOf(ye);for(var Ke=0,ke=Se.length;Ke<ke;Ke++)if(Se[Ke]===ye)return Ke;return-1}function we(Se){if(!n||!Se||typeof Se!="object")return!1;try{n.call(Se);try{o.call(Se)}catch{return!0}return Se instanceof Map}catch{}return!1}function pe(Se){if(!l||!Se||typeof Se!="object")return!1;try{l.call(Se,l);try{h.call(Se,h)}catch{return!0}return Se instanceof WeakMap}catch{}return!1}function ze(Se){if(!d||!Se||typeof Se!="object")return!1;try{return d.call(Se),!0}catch{}return!1}function Je(Se){if(!o||!Se||typeof Se!="object")return!1;try{o.call(Se);try{n.call(Se)}catch{return!0}return Se instanceof Set}catch{}return!1}function Xe(Se){if(!h||!Se||typeof Se!="object")return!1;try{h.call(Se,h);try{l.call(Se,l)}catch{return!0}return Se instanceof WeakSet}catch{}return!1}function tt(Se){return!Se||typeof Se!="object"?!1:typeof HTMLElement<"u"&&Se instanceof HTMLElement?!0:typeof Se.nodeName=="string"&&typeof Se.getAttribute=="function"}function Nt(Se,ye){if(Se.length>ye.maxStringLength){var Ke=Se.length-ye.maxStringLength,ke="... "+Ke+" more character"+(Ke>1?"s":"");return Nt(y.call(Se,0,ye.maxStringLength),ye)+ke}var He=Z[ye.quoteStyle||"single"];He.lastIndex=0;var Fe=v.call(v.call(Se,He,"\\$1"),/[\x00-\x1f]/g,gt);return Q(Fe,"single",ye)}function gt(Se){var ye=Se.charCodeAt(0),Ke={8:"b",9:"t",10:"n",12:"f",13:"r"}[ye];return Ke?"\\"+Ke:"\\x"+(ye<16?"0":"")+E.call(ye.toString(16))}function wt(Se){return"Object("+Se+")"}function Re(Se){return Se+" { ? }"}function se(Se,ye,Ke,ke){var He=ke?xe(Ke,ke):k.call(Ke,", ");return Se+" ("+ye+") {"+He+"}"}function W(Se){for(var ye=0;ye<Se.length;ye++)if(ve(Se[ye],`
`)>=0)return!1;return!0}function oe(Se,ye){var Ke;if(Se.indent==="	")Ke="	";else if(typeof Se.indent=="number"&&Se.indent>0)Ke=k.call(Array(Se.indent+1)," ");else return null;return{base:Ke,prev:k.call(Array(ye+1),Ke)}}function xe(Se,ye){if(Se.length===0)return"";var Ke=`
`+ye.prev+ye.base;return Ke+k.call(Se,","+Ke)+`
`+ye.prev}function Ce(Se,ye){var Ke=Te(Se),ke=[];if(Ke){ke.length=Se.length;for(var He=0;He<Se.length;He++)ke[He]=De(Se,He)?ye(Se[He],Se):""}var Fe=typeof M=="function"?M(Se):[],We;if(O){We={};for(var at=0;at<Fe.length;at++)We["$"+Fe[at]]=Fe[at]}for(var Be in Se)De(Se,Be)&&(Ke&&String(Number(Be))===Be&&Be<Se.length||O&&We["$"+Be]instanceof Symbol||(A.call(/[^\w$]/,Be)?ke.push(ye(Be,Se)+": "+ye(Se[Be],Se)):ke.push(Be+": "+ye(Se[Be],Se))));if(typeof M=="function")for(var nt=0;nt<Fe.length;nt++)q.call(Se,Fe[nt])&&ke.push("["+ye(Fe[nt])+"]: "+ye(Se[Fe[nt]],Se));return ke}return bN}var SN,S9;function OMe(){if(S9)return SN;S9=1;var t=gI(),e=ux(),n=function(a,c,l){for(var u=a,h;(h=u.next)!=null;u=h)if(h.key===c)return u.next=h.next,l||(h.next=a.next,a.next=h),h},r=function(a,c){if(a){var l=n(a,c);return l&&l.value}},i=function(a,c,l){var u=n(a,c);u?u.value=l:a.next={key:c,next:a.next,value:l}},s=function(a,c){return a?!!n(a,c):!1},o=function(a,c){if(a)return n(a,c,!0)};return SN=function(){var c,l={assert:function(u){if(!l.has(u))throw new e("Side channel does not contain "+t(u))},delete:function(u){var h=c&&c.next,f=o(c,u);return f&&h&&h===f&&(c=void 0),!!f},get:function(u){return r(c,u)},has:function(u){return s(c,u)},set:function(u,h){c||(c={next:void 0}),i(c,u,h)}};return l},SN}var EN,E9;function xee(){return E9||(E9=1,EN=Object),EN}var xN,x9;function IMe(){return x9||(x9=1,xN=Error),xN}var wN,w9;function NMe(){return w9||(w9=1,wN=EvalError),wN}var TN,T9;function PMe(){return T9||(T9=1,TN=RangeError),TN}var AN,A9;function DMe(){return A9||(A9=1,AN=ReferenceError),AN}var CN,C9;function LMe(){return C9||(C9=1,CN=SyntaxError),CN}var RN,R9;function UMe(){return R9||(R9=1,RN=URIError),RN}var kN,k9;function BMe(){return k9||(k9=1,kN=Math.abs),kN}var MN,M9;function FMe(){return M9||(M9=1,MN=Math.floor),MN}var ON,O9;function jMe(){return O9||(O9=1,ON=Math.max),ON}var IN,I9;function zMe(){return I9||(I9=1,IN=Math.min),IN}var NN,N9;function VMe(){return N9||(N9=1,NN=Math.pow),NN}var PN,P9;function HMe(){return P9||(P9=1,PN=Math.round),PN}var DN,D9;function $Me(){return D9||(D9=1,DN=Number.isNaN||function(e){return e!==e}),DN}var LN,L9;function GMe(){if(L9)return LN;L9=1;var t=$Me();return LN=function(n){return t(n)||n===0?n:n<0?-1:1},LN}var UN,U9;function WMe(){return U9||(U9=1,UN=Object.getOwnPropertyDescriptor),UN}var BN,B9;function wee(){if(B9)return BN;B9=1;var t=WMe();if(t)try{t([],"length")}catch{t=null}return BN=t,BN}var FN,F9;function qMe(){if(F9)return FN;F9=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return FN=t,FN}var jN,j9;function YMe(){return j9||(j9=1,jN=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,n);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),jN}var zN,z9;function KMe(){if(z9)return zN;z9=1;var t=typeof Symbol<"u"&&Symbol,e=YMe();return zN=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},zN}var VN,V9;function Tee(){return V9||(V9=1,VN=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),VN}var HN,H9;function Aee(){if(H9)return HN;H9=1;var t=xee();return HN=t.getPrototypeOf||null,HN}var $N,$9;function XMe(){if($9)return $N;$9=1;var t="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,n=Math.max,r="[object Function]",i=function(c,l){for(var u=[],h=0;h<c.length;h+=1)u[h]=c[h];for(var f=0;f<l.length;f+=1)u[f+c.length]=l[f];return u},s=function(c,l){for(var u=[],h=l,f=0;h<c.length;h+=1,f+=1)u[f]=c[h];return u},o=function(a,c){for(var l="",u=0;u<a.length;u+=1)l+=a[u],u+1<a.length&&(l+=c);return l};return $N=function(c){var l=this;if(typeof l!="function"||e.apply(l)!==r)throw new TypeError(t+l);for(var u=s(arguments,1),h,f=function(){if(this instanceof h){var _=l.apply(this,i(u,arguments));return Object(_)===_?_:this}return l.apply(c,i(u,arguments))},d=n(0,l.length-u.length),p=[],m=0;m<d;m++)p[m]="$"+m;if(h=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(f),l.prototype){var g=function(){};g.prototype=l.prototype,h.prototype=new g,g.prototype=null}return h},$N}var GN,G9;function _I(){if(G9)return GN;G9=1;var t=XMe();return GN=Function.prototype.bind||t,GN}var WN,W9;function p8(){return W9||(W9=1,WN=Function.prototype.call),WN}var qN,q9;function Cee(){return q9||(q9=1,qN=Function.prototype.apply),qN}var YN,Y9;function JMe(){return Y9||(Y9=1,YN=typeof Reflect<"u"&&Reflect&&Reflect.apply),YN}var KN,K9;function ZMe(){if(K9)return KN;K9=1;var t=_I(),e=Cee(),n=p8(),r=JMe();return KN=r||t.call(n,e),KN}var XN,X9;function Ree(){if(X9)return XN;X9=1;var t=_I(),e=ux(),n=p8(),r=ZMe();return XN=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return r(t,n,s)},XN}var JN,J9;function QMe(){if(J9)return JN;J9=1;var t=Ree(),e=wee(),n;try{n=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!n&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return JN=r&&typeof r.get=="function"?t([r.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,JN}var ZN,Z9;function eOe(){if(Z9)return ZN;Z9=1;var t=Tee(),e=Aee(),n=QMe();return ZN=t?function(i){return t(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:n?function(i){return n(i)}:null,ZN}var QN,Q9;function tOe(){if(Q9)return QN;Q9=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,n=_I();return QN=n.call(t,e),QN}var eP,ez;function m8(){if(ez)return eP;ez=1;var t,e=xee(),n=IMe(),r=NMe(),i=PMe(),s=DMe(),o=LMe(),a=ux(),c=UMe(),l=BMe(),u=FMe(),h=jMe(),f=zMe(),d=VMe(),p=HMe(),m=GMe(),g=Function,_=function(Pe){try{return g('"use strict"; return ('+Pe+").constructor;")()}catch{}},y=wee(),v=qMe(),E=function(){throw new a},x=y?(function(){try{return arguments.callee,E}catch{try{return y(arguments,"callee").get}catch{return E}}})():E,A=KMe()(),T=eOe(),k=Aee(),L=Tee(),I=Cee(),F=p8(),M={},D=typeof Uint8Array>"u"||!T?t:T(Uint8Array),O={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":A&&T?T([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":M,"%AsyncGenerator%":M,"%AsyncGeneratorFunction%":M,"%AsyncIteratorPrototype%":M,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":n,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?t:Float16Array,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":M,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":A&&T?T(T([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!A||!T?t:T(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":y,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!A||!T?t:T(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":A&&T?T(""[Symbol.iterator]()):t,"%Symbol%":A?Symbol:t,"%SyntaxError%":o,"%ThrowTypeError%":x,"%TypedArray%":D,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet,"%Function.prototype.call%":F,"%Function.prototype.apply%":I,"%Object.defineProperty%":v,"%Object.getPrototypeOf%":k,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":h,"%Math.min%":f,"%Math.pow%":d,"%Math.round%":p,"%Math.sign%":m,"%Reflect.getPrototypeOf%":L};if(T)try{null.error}catch(Pe){var z=T(T(Pe));O["%Error.prototype%"]=z}var q=function Pe(Ge){var Ze;if(Ge==="%AsyncFunction%")Ze=_("async function () {}");else if(Ge==="%GeneratorFunction%")Ze=_("function* () {}");else if(Ge==="%AsyncGeneratorFunction%")Ze=_("async function* () {}");else if(Ge==="%AsyncGenerator%"){var lt=Pe("%AsyncGeneratorFunction%");lt&&(Ze=lt.prototype)}else if(Ge==="%AsyncIteratorPrototype%"){var pt=Pe("%AsyncGenerator%");pt&&T&&(Ze=T(pt.prototype))}return O[Ge]=Ze,Ze},G={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},K=_I(),te=tOe(),re=K.call(F,Array.prototype.concat),H=K.call(I,Array.prototype.splice),Y=K.call(F,String.prototype.replace),Z=K.call(F,String.prototype.slice),Q=K.call(F,RegExp.prototype.exec),ie=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,ge=/\\(\\)?/g,Te=function(Ge){var Ze=Z(Ge,0,1),lt=Z(Ge,-1);if(Ze==="%"&&lt!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(lt==="%"&&Ze!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var pt=[];return Y(Ge,ie,function(ne,Le,Ve,De){pt[pt.length]=Ve?Y(De,ge,"$1"):Le||ne}),pt},be=function(Ge,Ze){var lt=Ge,pt;if(te(G,lt)&&(pt=G[lt],lt="%"+pt[0]+"%"),te(O,lt)){var ne=O[lt];if(ne===M&&(ne=q(lt)),typeof ne>"u"&&!Ze)throw new a("intrinsic "+Ge+" exists, but is not available. Please file an issue!");return{alias:pt,name:lt,value:ne}}throw new o("intrinsic "+Ge+" does not exist!")};return eP=function(Ge,Ze){if(typeof Ge!="string"||Ge.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Ze!="boolean")throw new a('"allowMissing" argument must be a boolean');if(Q(/^%?[^%]*%?$/,Ge)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var lt=Te(Ge),pt=lt.length>0?lt[0]:"",ne=be("%"+pt+"%",Ze),Le=ne.name,Ve=ne.value,De=!1,Ie=ne.alias;Ie&&(pt=Ie[0],H(lt,re([0,1],Ie)));for(var ae=1,ve=!0;ae<lt.length;ae+=1){var we=lt[ae],pe=Z(we,0,1),ze=Z(we,-1);if((pe==='"'||pe==="'"||pe==="`"||ze==='"'||ze==="'"||ze==="`")&&pe!==ze)throw new o("property names with quotes must have matching quotes");if((we==="constructor"||!ve)&&(De=!0),pt+="."+we,Le="%"+pt+"%",te(O,Le))Ve=O[Le];else if(Ve!=null){if(!(we in Ve)){if(!Ze)throw new a("base intrinsic for "+Ge+" exists, but the property is not available.");return}if(y&&ae+1>=lt.length){var Je=y(Ve,we);ve=!!Je,ve&&"get"in Je&&!("originalValue"in Je.get)?Ve=Je.get:Ve=Ve[we]}else ve=te(Ve,we),Ve=Ve[we];ve&&!De&&(O[Le]=Ve)}}return Ve},eP}var tP,tz;function kee(){if(tz)return tP;tz=1;var t=m8(),e=Ree(),n=e([t("%String.prototype.indexOf%")]);return tP=function(i,s){var o=t(i,!!s);return typeof o=="function"&&n(i,".prototype.")>-1?e([o]):o},tP}var nP,nz;function Mee(){if(nz)return nP;nz=1;var t=m8(),e=kee(),n=gI(),r=ux(),i=t("%Map%",!0),s=e("Map.prototype.get",!0),o=e("Map.prototype.set",!0),a=e("Map.prototype.has",!0),c=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return nP=!!i&&function(){var h,f={assert:function(d){if(!f.has(d))throw new r("Side channel does not contain "+n(d))},delete:function(d){if(h){var p=c(h,d);return l(h)===0&&(h=void 0),p}return!1},get:function(d){if(h)return s(h,d)},has:function(d){return h?a(h,d):!1},set:function(d,p){h||(h=new i),o(h,d,p)}};return f},nP}var rP,rz;function nOe(){if(rz)return rP;rz=1;var t=m8(),e=kee(),n=gI(),r=Mee(),i=ux(),s=t("%WeakMap%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),c=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return rP=s?function(){var h,f,d={assert:function(p){if(!d.has(p))throw new i("Side channel does not contain "+n(p))},delete:function(p){if(s&&p&&(typeof p=="object"||typeof p=="function")){if(h)return l(h,p)}else if(r&&f)return f.delete(p);return!1},get:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?o(h,p):f&&f.get(p)},has:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?c(h,p):!!f&&f.has(p)},set:function(p,m){s&&p&&(typeof p=="object"||typeof p=="function")?(h||(h=new s),a(h,p,m)):r&&(f||(f=r()),f.set(p,m))}};return d}:r,rP}var iP,iz;function Oee(){if(iz)return iP;iz=1;var t=ux(),e=gI(),n=OMe(),r=Mee(),i=nOe(),s=i||r||n;return iP=function(){var a,c={assert:function(l){if(!c.has(l))throw new t("Side channel does not contain "+e(l))},delete:function(l){return!!a&&a.delete(l)},get:function(l){return a&&a.get(l)},has:function(l){return!!a&&a.has(l)},set:function(l,u){a||(a=s()),a.set(l,u)}};return c},iP}var sP,sz;function g8(){if(sz)return sP;sz=1;var t=String.prototype.replace,e=/%20/g,n={RFC1738:"RFC1738",RFC3986:"RFC3986"};return sP={default:n.RFC3986,formatters:{RFC1738:function(r){return t.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:n.RFC1738,RFC3986:n.RFC3986},sP}var oP,oz;function Iee(){if(oz)return oP;oz=1;var t=g8(),e=Oee(),n=Object.prototype.hasOwnProperty,r=Array.isArray,i=e(),s=function(T,k){return i.set(T,k),T},o=function(T){return i.has(T)},a=function(T){return i.get(T)},c=function(T,k){i.set(T,k)},l=(function(){for(var A=[],T=0;T<256;++T)A.push("%"+((T<16?"0":"")+T.toString(16)).toUpperCase());return A})(),u=function(T){for(;T.length>1;){var k=T.pop(),L=k.obj[k.prop];if(r(L)){for(var I=[],F=0;F<L.length;++F)typeof L[F]<"u"&&I.push(L[F]);k.obj[k.prop]=I}}},h=function(T,k){for(var L=k&&k.plainObjects?{__proto__:null}:{},I=0;I<T.length;++I)typeof T[I]<"u"&&(L[I]=T[I]);return L},f=function A(T,k,L){if(!k)return T;if(typeof k!="object"&&typeof k!="function"){if(r(T))T.push(k);else if(T&&typeof T=="object")if(o(T)){var I=a(T)+1;T[I]=k,c(T,I)}else(L&&(L.plainObjects||L.allowPrototypes)||!n.call(Object.prototype,k))&&(T[k]=!0);else return[T,k];return T}if(!T||typeof T!="object"){if(o(k)){for(var F=Object.keys(k),M=L&&L.plainObjects?{__proto__:null,0:T}:{0:T},D=0;D<F.length;D++){var O=parseInt(F[D],10);M[O+1]=k[F[D]]}return s(M,a(k)+1)}return[T].concat(k)}var z=T;return r(T)&&!r(k)&&(z=h(T,L)),r(T)&&r(k)?(k.forEach(function(q,G){if(n.call(T,G)){var K=T[G];K&&typeof K=="object"&&q&&typeof q=="object"?T[G]=A(K,q,L):T.push(q)}else T[G]=q}),T):Object.keys(k).reduce(function(q,G){var K=k[G];return n.call(q,G)?q[G]=A(q[G],K,L):q[G]=K,q},z)},d=function(T,k){return Object.keys(k).reduce(function(L,I){return L[I]=k[I],L},T)},p=function(A,T,k){var L=A.replace(/\+/g," ");if(k==="iso-8859-1")return L.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(L)}catch{return L}},m=1024,g=function(T,k,L,I,F){if(T.length===0)return T;var M=T;if(typeof T=="symbol"?M=Symbol.prototype.toString.call(T):typeof T!="string"&&(M=String(T)),L==="iso-8859-1")return escape(M).replace(/%u[0-9a-f]{4}/gi,function(te){return"%26%23"+parseInt(te.slice(2),16)+"%3B"});for(var D="",O=0;O<M.length;O+=m){for(var z=M.length>=m?M.slice(O,O+m):M,q=[],G=0;G<z.length;++G){var K=z.charCodeAt(G);if(K===45||K===46||K===95||K===126||K>=48&&K<=57||K>=65&&K<=90||K>=97&&K<=122||F===t.RFC1738&&(K===40||K===41)){q[q.length]=z.charAt(G);continue}if(K<128){q[q.length]=l[K];continue}if(K<2048){q[q.length]=l[192|K>>6]+l[128|K&63];continue}if(K<55296||K>=57344){q[q.length]=l[224|K>>12]+l[128|K>>6&63]+l[128|K&63];continue}G+=1,K=65536+((K&1023)<<10|z.charCodeAt(G)&1023),q[q.length]=l[240|K>>18]+l[128|K>>12&63]+l[128|K>>6&63]+l[128|K&63]}D+=q.join("")}return D},_=function(T){for(var k=[{obj:{o:T},prop:"o"}],L=[],I=0;I<k.length;++I)for(var F=k[I],M=F.obj[F.prop],D=Object.keys(M),O=0;O<D.length;++O){var z=D[O],q=M[z];typeof q=="object"&&q!==null&&L.indexOf(q)===-1&&(k.push({obj:M,prop:z}),L.push(q))}return u(k),T},y=function(T){return Object.prototype.toString.call(T)==="[object RegExp]"},v=function(T){return!T||typeof T!="object"?!1:!!(T.constructor&&T.constructor.isBuffer&&T.constructor.isBuffer(T))},E=function(T,k,L,I){if(o(T)){var F=a(T)+1;return T[F]=k,c(T,F),T}var M=[].concat(T,k);return M.length>L?s(h(M,{plainObjects:I}),M.length-1):M},x=function(T,k){if(r(T)){for(var L=[],I=0;I<T.length;I+=1)L.push(k(T[I]));return L}return k(T)};return oP={arrayToObject:h,assign:d,combine:E,compact:_,decode:p,encode:g,isBuffer:v,isOverflow:o,isRegExp:y,maybeMap:x,merge:f},oP}var aP,az;function rOe(){if(az)return aP;az=1;var t=Oee(),e=Iee(),n=g8(),r=Object.prototype.hasOwnProperty,i={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,_){return g+"["+_+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(m,g){o.apply(m,s(g)?g:[g])},c=Date.prototype.toISOString,l=n.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:n.formatters[l],indices:!1,serializeDate:function(g){return c.call(g)},skipNulls:!1,strictNullHandling:!1},h=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},f={},d=function m(g,_,y,v,E,x,A,T,k,L,I,F,M,D,O,z,q,G){for(var K=g,te=G,re=0,H=!1;(te=te.get(f))!==void 0&&!H;){var Y=te.get(g);if(re+=1,typeof Y<"u"){if(Y===re)throw new RangeError("Cyclic object value");H=!0}typeof te.get(f)>"u"&&(re=0)}if(typeof L=="function"?K=L(_,K):K instanceof Date?K=M(K):y==="comma"&&s(K)&&(K=e.maybeMap(K,function(Le){return Le instanceof Date?M(Le):Le})),K===null){if(x)return k&&!z?k(_,u.encoder,q,"key",D):_;K=""}if(h(K)||e.isBuffer(K)){if(k){var Z=z?_:k(_,u.encoder,q,"key",D);return[O(Z)+"="+O(k(K,u.encoder,q,"value",D))]}return[O(_)+"="+O(String(K))]}var Q=[];if(typeof K>"u")return Q;var ie;if(y==="comma"&&s(K))z&&k&&(K=e.maybeMap(K,k)),ie=[{value:K.length>0?K.join(",")||null:void 0}];else if(s(L))ie=L;else{var ge=Object.keys(K);ie=I?ge.sort(I):ge}var Te=T?String(_).replace(/\./g,"%2E"):String(_),be=v&&s(K)&&K.length===1?Te+"[]":Te;if(E&&s(K)&&K.length===0)return be+"[]";for(var Pe=0;Pe<ie.length;++Pe){var Ge=ie[Pe],Ze=typeof Ge=="object"&&Ge&&typeof Ge.value<"u"?Ge.value:K[Ge];if(!(A&&Ze===null)){var lt=F&&T?String(Ge).replace(/\./g,"%2E"):String(Ge),pt=s(K)?typeof y=="function"?y(be,lt):be:be+(F?"."+lt:"["+lt+"]");G.set(g,re);var ne=t();ne.set(f,G),a(Q,m(Ze,pt,y,v,E,x,A,T,y==="comma"&&z&&s(K)?null:k,L,I,F,M,D,O,z,q,ne))}}return Q},p=function(g){if(!g)return u;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var _=g.charset||u.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var y=n.default;if(typeof g.format<"u"){if(!r.call(n.formatters,g.format))throw new TypeError("Unknown format option provided.");y=g.format}var v=n.formatters[y],E=u.filter;(typeof g.filter=="function"||s(g.filter))&&(E=g.filter);var x;if(g.arrayFormat in i?x=g.arrayFormat:"indices"in g?x=g.indices?"indices":"repeat":x=u.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var A=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:u.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:u.addQueryPrefix,allowDots:A,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:x,charset:_,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?u.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:u.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:u.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:u.encodeValuesOnly,filter:E,format:y,formatter:v,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:u.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:u.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:u.strictNullHandling}};return aP=function(m,g){var _=m,y=p(g),v,E;typeof y.filter=="function"?(E=y.filter,_=E("",_)):s(y.filter)&&(E=y.filter,v=E);var x=[];if(typeof _!="object"||_===null)return"";var A=i[y.arrayFormat],T=A==="comma"&&y.commaRoundTrip;v||(v=Object.keys(_)),y.sort&&v.sort(y.sort);for(var k=t(),L=0;L<v.length;++L){var I=v[L],F=_[I];y.skipNulls&&F===null||a(x,d(F,I,A,T,y.allowEmptyArrays,y.strictNullHandling,y.skipNulls,y.encodeDotInKeys,y.encode?y.encoder:null,y.filter,y.sort,y.allowDots,y.serializeDate,y.format,y.formatter,y.encodeValuesOnly,y.charset,k))}var M=x.join(y.delimiter),D=y.addQueryPrefix===!0?"?":"";return y.charsetSentinel&&(y.charset==="iso-8859-1"?D+="utf8=%26%2310003%3B&":D+="utf8=%E2%9C%93&"),M.length>0?D+M:""},aP}var cP,cz;function iOe(){if(cz)return cP;cz=1;var t=Iee(),e=Object.prototype.hasOwnProperty,n=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:t.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(d){return d.replace(/&#(\d+);/g,function(p,m){return String.fromCharCode(parseInt(m,10))})},s=function(d,p,m){if(d&&typeof d=="string"&&p.comma&&d.indexOf(",")>-1)return d.split(",");if(p.throwOnLimitExceeded&&m>=p.arrayLimit)throw new RangeError("Array limit exceeded. Only "+p.arrayLimit+" element"+(p.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(p,m){var g={__proto__:null},_=m.ignoreQueryPrefix?p.replace(/^\?/,""):p;_=_.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=m.parameterLimit===1/0?void 0:m.parameterLimit,v=_.split(m.delimiter,m.throwOnLimitExceeded?y+1:y);if(m.throwOnLimitExceeded&&v.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var E=-1,x,A=m.charset;if(m.charsetSentinel)for(x=0;x<v.length;++x)v[x].indexOf("utf8=")===0&&(v[x]===a?A="utf-8":v[x]===o&&(A="iso-8859-1"),E=x,x=v.length);for(x=0;x<v.length;++x)if(x!==E){var T=v[x],k=T.indexOf("]="),L=k===-1?T.indexOf("="):k+1,I,F;if(L===-1?(I=m.decoder(T,r.decoder,A,"key"),F=m.strictNullHandling?null:""):(I=m.decoder(T.slice(0,L),r.decoder,A,"key"),I!==null&&(F=t.maybeMap(s(T.slice(L+1),m,n(g[I])?g[I].length:0),function(D){return m.decoder(D,r.decoder,A,"value")}))),F&&m.interpretNumericEntities&&A==="iso-8859-1"&&(F=i(String(F))),T.indexOf("[]=")>-1&&(F=n(F)?[F]:F),I!==null){var M=e.call(g,I);M&&m.duplicates==="combine"?g[I]=t.combine(g[I],F,m.arrayLimit,m.plainObjects):(!M||m.duplicates==="last")&&(g[I]=F)}}return g},l=function(d,p,m,g){var _=0;if(d.length>0&&d[d.length-1]==="[]"){var y=d.slice(0,-1).join("");_=Array.isArray(p)&&p[y]?p[y].length:0}for(var v=g?p:s(p,m,_),E=d.length-1;E>=0;--E){var x,A=d[E];if(A==="[]"&&m.parseArrays)t.isOverflow(v)?x=v:x=m.allowEmptyArrays&&(v===""||m.strictNullHandling&&v===null)?[]:t.combine([],v,m.arrayLimit,m.plainObjects);else{x=m.plainObjects?{__proto__:null}:{};var T=A.charAt(0)==="["&&A.charAt(A.length-1)==="]"?A.slice(1,-1):A,k=m.decodeDotInKeys?T.replace(/%2E/g,"."):T,L=parseInt(k,10);!m.parseArrays&&k===""?x={0:v}:!isNaN(L)&&A!==k&&String(L)===k&&L>=0&&m.parseArrays&&L<=m.arrayLimit?(x=[],x[L]=v):k!=="__proto__"&&(x[k]=v)}v=x}return v},u=function(p,m){var g=m.allowDots?p.replace(/\.([^.[]+)/g,"[$1]"):p;if(m.depth<=0)return!m.plainObjects&&e.call(Object.prototype,g)&&!m.allowPrototypes?void 0:[g];var _=/(\[[^[\]]*])/,y=/(\[[^[\]]*])/g,v=_.exec(g),E=v?g.slice(0,v.index):g,x=[];if(E){if(!m.plainObjects&&e.call(Object.prototype,E)&&!m.allowPrototypes)return;x.push(E)}for(var A=0;(v=y.exec(g))!==null&&A<m.depth;){A+=1;var T=v[1].slice(1,-1);if(!m.plainObjects&&e.call(Object.prototype,T)&&!m.allowPrototypes)return;x.push(v[1])}if(v){if(m.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+m.depth+" and strictDepth is true");x.push("["+g.slice(v.index)+"]")}return x},h=function(p,m,g,_){if(p){var y=u(p,g);if(y)return l(y,m,g,_)}},f=function(p){if(!p)return r;if(typeof p.allowEmptyArrays<"u"&&typeof p.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof p.decodeDotInKeys<"u"&&typeof p.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(p.decoder!==null&&typeof p.decoder<"u"&&typeof p.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof p.throwOnLimitExceeded<"u"&&typeof p.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var m=typeof p.charset>"u"?r.charset:p.charset,g=typeof p.duplicates>"u"?r.duplicates:p.duplicates;if(g!=="combine"&&g!=="first"&&g!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var _=typeof p.allowDots>"u"?p.decodeDotInKeys===!0?!0:r.allowDots:!!p.allowDots;return{allowDots:_,allowEmptyArrays:typeof p.allowEmptyArrays=="boolean"?!!p.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof p.allowPrototypes=="boolean"?p.allowPrototypes:r.allowPrototypes,allowSparse:typeof p.allowSparse=="boolean"?p.allowSparse:r.allowSparse,arrayLimit:typeof p.arrayLimit=="number"?p.arrayLimit:r.arrayLimit,charset:m,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:r.charsetSentinel,comma:typeof p.comma=="boolean"?p.comma:r.comma,decodeDotInKeys:typeof p.decodeDotInKeys=="boolean"?p.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof p.decoder=="function"?p.decoder:r.decoder,delimiter:typeof p.delimiter=="string"||t.isRegExp(p.delimiter)?p.delimiter:r.delimiter,depth:typeof p.depth=="number"||p.depth===!1?+p.depth:r.depth,duplicates:g,ignoreQueryPrefix:p.ignoreQueryPrefix===!0,interpretNumericEntities:typeof p.interpretNumericEntities=="boolean"?p.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof p.parameterLimit=="number"?p.parameterLimit:r.parameterLimit,parseArrays:p.parseArrays!==!1,plainObjects:typeof p.plainObjects=="boolean"?p.plainObjects:r.plainObjects,strictDepth:typeof p.strictDepth=="boolean"?!!p.strictDepth:r.strictDepth,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof p.throwOnLimitExceeded=="boolean"?p.throwOnLimitExceeded:!1}};return cP=function(d,p){var m=f(p);if(d===""||d===null||typeof d>"u")return m.plainObjects?{__proto__:null}:{};for(var g=typeof d=="string"?c(d,m):d,_=m.plainObjects?{__proto__:null}:{},y=Object.keys(g),v=0;v<y.length;++v){var E=y[v],x=h(E,g[E],m,typeof d=="string");_=t.merge(_,x,m)}return m.allowSparse===!0?_:t.compact(_)},cP}var lP,lz;function sOe(){if(lz)return lP;lz=1;var t=rOe(),e=iOe(),n=g8();return lP={formats:n,parse:e,stringify:t},lP}var uz;function oOe(){if(uz)return Cy;uz=1;var t=CMe();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var n=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,d={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=sOe();function _(x,A,T){if(x&&typeof x=="object"&&x instanceof e)return x;var k=new e;return k.parse(x,A,T),k}e.prototype.parse=function(x,A,T){if(typeof x!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof x);var k=x.indexOf("?"),L=k!==-1&&k<x.indexOf("#")?"?":"#",I=x.split(L),F=/\\/g;I[0]=I[0].replace(F,"/"),x=I.join(L);var M=x;if(M=M.trim(),!T&&x.split("#").length===1){var D=i.exec(M);if(D)return this.path=M,this.href=M,this.pathname=D[1],D[2]?(this.search=D[2],A?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):A&&(this.search="",this.query={}),this}var O=n.exec(M);if(O){O=O[0];var z=O.toLowerCase();this.protocol=z,M=M.substr(O.length)}if(T||O||M.match(/^\/\/[^@/]+@[^@/]+/)){var q=M.substr(0,2)==="//";q&&!(O&&p[O])&&(M=M.substr(2),this.slashes=!0)}if(!p[O]&&(q||O&&!m[O])){for(var G=-1,K=0;K<l.length;K++){var te=M.indexOf(l[K]);te!==-1&&(G===-1||te<G)&&(G=te)}var re,H;G===-1?H=M.lastIndexOf("@"):H=M.lastIndexOf("@",G),H!==-1&&(re=M.slice(0,H),M=M.slice(H+1),this.auth=decodeURIComponent(re)),G=-1;for(var K=0;K<c.length;K++){var te=M.indexOf(c[K]);te!==-1&&(G===-1||te<G)&&(G=te)}G===-1&&(G=M.length),this.host=M.slice(0,G),M=M.slice(G),this.parseHost(),this.hostname=this.hostname||"";var Y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!Y)for(var Z=this.hostname.split(/\./),K=0,Q=Z.length;K<Q;K++){var ie=Z[K];if(ie&&!ie.match(h)){for(var ge="",Te=0,be=ie.length;Te<be;Te++)ie.charCodeAt(Te)>127?ge+="x":ge+=ie[Te];if(!ge.match(h)){var Pe=Z.slice(0,K),Ge=Z.slice(K+1),Ze=ie.match(f);Ze&&(Pe.push(Ze[1]),Ge.unshift(Ze[2])),Ge.length&&(M="/"+Ge.join(".")+M),this.hostname=Pe.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),Y||(this.hostname=t.toASCII(this.hostname));var lt=this.port?":"+this.port:"",pt=this.hostname||"";this.host=pt+lt,this.href+=this.host,Y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),M[0]!=="/"&&(M="/"+M))}if(!d[z])for(var K=0,Q=a.length;K<Q;K++){var ne=a[K];if(M.indexOf(ne)!==-1){var Le=encodeURIComponent(ne);Le===ne&&(Le=escape(ne)),M=M.split(ne).join(Le)}}var Ve=M.indexOf("#");Ve!==-1&&(this.hash=M.substr(Ve),M=M.slice(0,Ve));var De=M.indexOf("?");if(De!==-1?(this.search=M.substr(De),this.query=M.substr(De+1),A&&(this.query=g.parse(this.query)),M=M.slice(0,De)):A&&(this.search="",this.query={}),M&&(this.pathname=M),m[z]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var lt=this.pathname||"",Ie=this.search||"";this.path=lt+Ie}return this.href=this.format(),this};function y(x){return typeof x=="string"&&(x=_(x)),x instanceof e?x.format():e.prototype.format.call(x)}e.prototype.format=function(){var x=this.auth||"";x&&(x=encodeURIComponent(x),x=x.replace(/%3A/i,":"),x+="@");var A=this.protocol||"",T=this.pathname||"",k=this.hash||"",L=!1,I="";this.host?L=x+this.host:this.hostname&&(L=x+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(L+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(I=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var F=this.search||I&&"?"+I||"";return A&&A.substr(-1)!==":"&&(A+=":"),this.slashes||(!A||m[A])&&L!==!1?(L="//"+(L||""),T&&T.charAt(0)!=="/"&&(T="/"+T)):L||(L=""),k&&k.charAt(0)!=="#"&&(k="#"+k),F&&F.charAt(0)!=="?"&&(F="?"+F),T=T.replace(/[?#]/g,function(M){return encodeURIComponent(M)}),F=F.replace("#","%23"),A+L+T+F+k};function v(x,A){return _(x,!1,!0).resolve(A)}e.prototype.resolve=function(x){return this.resolveObject(_(x,!1,!0)).format()};function E(x,A){return x?_(x,!1,!0).resolveObject(A):A}return e.prototype.resolveObject=function(x){if(typeof x=="string"){var A=new e;A.parse(x,!1,!0),x=A}for(var T=new e,k=Object.keys(this),L=0;L<k.length;L++){var I=k[L];T[I]=this[I]}if(T.hash=x.hash,x.href==="")return T.href=T.format(),T;if(x.slashes&&!x.protocol){for(var F=Object.keys(x),M=0;M<F.length;M++){var D=F[M];D!=="protocol"&&(T[D]=x[D])}return m[T.protocol]&&T.hostname&&!T.pathname&&(T.pathname="/",T.path=T.pathname),T.href=T.format(),T}if(x.protocol&&x.protocol!==T.protocol){if(!m[x.protocol]){for(var O=Object.keys(x),z=0;z<O.length;z++){var q=O[z];T[q]=x[q]}return T.href=T.format(),T}if(T.protocol=x.protocol,!x.host&&!p[x.protocol]){for(var Q=(x.pathname||"").split("/");Q.length&&!(x.host=Q.shift()););x.host||(x.host=""),x.hostname||(x.hostname=""),Q[0]!==""&&Q.unshift(""),Q.length<2&&Q.unshift(""),T.pathname=Q.join("/")}else T.pathname=x.pathname;if(T.search=x.search,T.query=x.query,T.host=x.host||"",T.auth=x.auth,T.hostname=x.hostname||x.host,T.port=x.port,T.pathname||T.search){var G=T.pathname||"",K=T.search||"";T.path=G+K}return T.slashes=T.slashes||x.slashes,T.href=T.format(),T}var te=T.pathname&&T.pathname.charAt(0)==="/",re=x.host||x.pathname&&x.pathname.charAt(0)==="/",H=re||te||T.host&&x.pathname,Y=H,Z=T.pathname&&T.pathname.split("/")||[],Q=x.pathname&&x.pathname.split("/")||[],ie=T.protocol&&!m[T.protocol];if(ie&&(T.hostname="",T.port=null,T.host&&(Z[0]===""?Z[0]=T.host:Z.unshift(T.host)),T.host="",x.protocol&&(x.hostname=null,x.port=null,x.host&&(Q[0]===""?Q[0]=x.host:Q.unshift(x.host)),x.host=null),H=H&&(Q[0]===""||Z[0]==="")),re)T.host=x.host||x.host===""?x.host:T.host,T.hostname=x.hostname||x.hostname===""?x.hostname:T.hostname,T.search=x.search,T.query=x.query,Z=Q;else if(Q.length)Z||(Z=[]),Z.pop(),Z=Z.concat(Q),T.search=x.search,T.query=x.query;else if(x.search!=null){if(ie){T.host=Z.shift(),T.hostname=T.host;var ge=T.host&&T.host.indexOf("@")>0?T.host.split("@"):!1;ge&&(T.auth=ge.shift(),T.hostname=ge.shift(),T.host=T.hostname)}return T.search=x.search,T.query=x.query,(T.pathname!==null||T.search!==null)&&(T.path=(T.pathname?T.pathname:"")+(T.search?T.search:"")),T.href=T.format(),T}if(!Z.length)return T.pathname=null,T.search?T.path="/"+T.search:T.path=null,T.href=T.format(),T;for(var Te=Z.slice(-1)[0],be=(T.host||x.host||Z.length>1)&&(Te==="."||Te==="..")||Te==="",Pe=0,Ge=Z.length;Ge>=0;Ge--)Te=Z[Ge],Te==="."?Z.splice(Ge,1):Te===".."?(Z.splice(Ge,1),Pe++):Pe&&(Z.splice(Ge,1),Pe--);if(!H&&!Y)for(;Pe--;Pe)Z.unshift("..");H&&Z[0]!==""&&(!Z[0]||Z[0].charAt(0)!=="/")&&Z.unshift(""),be&&Z.join("/").substr(-1)!=="/"&&Z.push("");var Ze=Z[0]===""||Z[0]&&Z[0].charAt(0)==="/";if(ie){T.hostname=Ze?"":Z.length?Z.shift():"",T.host=T.hostname;var ge=T.host&&T.host.indexOf("@")>0?T.host.split("@"):!1;ge&&(T.auth=ge.shift(),T.hostname=ge.shift(),T.host=T.hostname)}return H=H||T.host&&Z.length,H&&!Ze&&Z.unshift(""),Z.length>0?T.pathname=Z.join("/"):(T.pathname=null,T.path=null),(T.pathname!==null||T.search!==null)&&(T.path=(T.pathname?T.pathname:"")+(T.search?T.search:"")),T.auth=x.auth||T.auth,T.slashes=T.slashes||x.slashes,T.href=T.format(),T},e.prototype.parseHost=function(){var x=this.host,A=r.exec(x);A&&(A=A[0],A!==":"&&(this.port=A.substr(1)),x=x.substr(0,x.length-A.length)),x&&(this.hostname=x)},Cy.parse=_,Cy.resolve=v,Cy.resolveObject=E,Cy.format=y,Cy.Url=e,Cy}var uP,hz;function aOe(){return hz||(hz=1,uP=typeof URL=="function"?URL:oOe().URL),uP}var fz;function vI(){if(fz)return jd;fz=1;const t=aOe();function e(I,F,M){if(F in I)return I[F];if(arguments.length===3)return M;throw new Error('"'+F+'" is a required argument.')}jd.getArg=e;const n=(function(){return!("__proto__"in Object.create(null))})();function r(I){return I}function i(I){return o(I)?"$"+I:I}jd.toSetString=n?r:i;function s(I){return o(I)?I.slice(1):I}jd.fromSetString=n?r:s;function o(I){if(!I)return!1;const F=I.length;if(F<9||I.charCodeAt(F-1)!==95||I.charCodeAt(F-2)!==95||I.charCodeAt(F-3)!==111||I.charCodeAt(F-4)!==116||I.charCodeAt(F-5)!==111||I.charCodeAt(F-6)!==114||I.charCodeAt(F-7)!==112||I.charCodeAt(F-8)!==95||I.charCodeAt(F-9)!==95)return!1;for(let M=F-10;M>=0;M--)if(I.charCodeAt(M)!==36)return!1;return!0}function a(I,F){return I===F?0:I===null?1:F===null?-1:I>F?1:-1}function c(I,F){let M=I.generatedLine-F.generatedLine;return M!==0||(M=I.generatedColumn-F.generatedColumn,M!==0)||(M=a(I.source,F.source),M!==0)||(M=I.originalLine-F.originalLine,M!==0)||(M=I.originalColumn-F.originalColumn,M!==0)?M:a(I.name,F.name)}jd.compareByGeneratedPositionsInflated=c;function l(I){return JSON.parse(I.replace(/^\)]}'[^\n]*\n/,""))}jd.parseSourceMapInput=l;const u="http:",h=`${u}//host`;function f(I){return F=>{const M=_(F),D=m(F),O=new t(F,D);I(O);const z=O.toString();return M==="absolute"?z:M==="scheme-relative"?z.slice(u.length):M==="path-absolute"?z.slice(h.length):y(D,z)}}function d(I,F){return new t(I,F).toString()}function p(I,F){let M=0;do{const D=I+M++;if(F.indexOf(D)===-1)return D}while(!0)}function m(I){const F=I.split("..").length-1,M=p("p",I);let D=`${h}/`;for(let O=0;O<F;O++)D+=`${M}/`;return D}const g=/^[A-Za-z0-9\+\-\.]+:/;function _(I){return I[0]==="/"?I[1]==="/"?"scheme-relative":"path-absolute":g.test(I)?"absolute":"path-relative"}function y(I,F){typeof I=="string"&&(I=new t(I)),typeof F=="string"&&(F=new t(F));const M=F.pathname.split("/"),D=I.pathname.split("/");for(D.length>0&&!D[D.length-1]&&D.pop();M.length>0&&D.length>0&&M[0]===D[0];)M.shift(),D.shift();return D.map(()=>"..").concat(M).join("/")+F.search+F.hash}const v=f(I=>{I.pathname=I.pathname.replace(/\/?$/,"/")}),E=f(I=>{I.href=new t(".",I.toString()).toString()}),x=f(I=>{});jd.normalize=x;function A(I,F){const M=_(F),D=_(I);if(I=v(I),M==="absolute")return d(F,void 0);if(D==="absolute")return d(F,I);if(M==="scheme-relative")return x(F);if(D==="scheme-relative")return d(F,d(I,h)).slice(u.length);if(M==="path-absolute")return x(F);if(D==="path-absolute")return d(F,d(I,h)).slice(h.length);const O=m(F+I),z=d(F,d(I,O));return y(O,z)}jd.join=A;function T(I,F){const M=k(I,F);return typeof M=="string"?M:x(F)}jd.relative=T;function k(I,F){if(_(I)!==_(F))return null;const D=m(I+F),O=new t(I,D),z=new t(F,D);try{new t("",z.toString())}catch{return null}return z.protocol!==O.protocol||z.user!==O.user||z.password!==O.password||z.hostname!==O.hostname||z.port!==O.port?null:y(O,z)}function L(I,F,M){I&&_(F)==="path-absolute"&&(F=F.replace(/^\//,""));let D=x(F||"");return I&&(D=A(I,D)),M&&(D=A(E(M),D)),D}return jd.computeSourceURL=L,jd}var hP={},dz;function Nee(){if(dz)return hP;dz=1;class t{constructor(){this._array=[],this._set=new Map}static fromArray(n,r){const i=new t;for(let s=0,o=n.length;s<o;s++)i.add(n[s],r);return i}size(){return this._set.size}add(n,r){const i=this.has(n),s=this._array.length;(!i||r)&&this._array.push(n),i||this._set.set(n,s)}has(n){return this._set.has(n)}indexOf(n){const r=this._set.get(n);if(r>=0)return r;throw new Error('"'+n+'" is not in the set.')}at(n){if(n>=0&&n<this._array.length)return this._array[n];throw new Error("No element indexed by "+n)}toArray(){return this._array.slice()}}return hP.ArraySet=t,hP}var fP={},pz;function cOe(){if(pz)return fP;pz=1;const t=vI();function e(r,i){const s=r.generatedLine,o=i.generatedLine,a=r.generatedColumn,c=i.generatedColumn;return o>s||o==s&&c>=a||t.compareByGeneratedPositionsInflated(r,i)<=0}class n{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(i,s){this._array.forEach(i,s)}add(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))}toArray(){return this._sorted||(this._array.sort(t.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}return fP.MappingList=n,fP}var mz;function Pee(){if(mz)return gN;mz=1;const t=Eee(),e=vI(),n=Nee().ArraySet,r=cOe().MappingList;class i{constructor(o){o||(o={}),this._file=e.getArg(o,"file",null),this._sourceRoot=e.getArg(o,"sourceRoot",null),this._skipValidation=e.getArg(o,"skipValidation",!1),this._sources=new n,this._names=new n,this._mappings=new r,this._sourcesContents=null}static fromSourceMap(o){const a=o.sourceRoot,c=new i({file:o.file,sourceRoot:a});return o.eachMapping(function(l){const u={generated:{line:l.generatedLine,column:l.generatedColumn}};l.source!=null&&(u.source=l.source,a!=null&&(u.source=e.relative(a,u.source)),u.original={line:l.originalLine,column:l.originalColumn},l.name!=null&&(u.name=l.name)),c.addMapping(u)}),o.sources.forEach(function(l){let u=l;a!=null&&(u=e.relative(a,l)),c._sources.has(u)||c._sources.add(u);const h=o.sourceContentFor(l);h!=null&&c.setSourceContent(l,h)}),c}addMapping(o){const a=e.getArg(o,"generated"),c=e.getArg(o,"original",null);let l=e.getArg(o,"source",null),u=e.getArg(o,"name",null);this._skipValidation||this._validateMapping(a,c,l,u),l!=null&&(l=String(l),this._sources.has(l)||this._sources.add(l)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:a.line,generatedColumn:a.column,originalLine:c&&c.line,originalColumn:c&&c.column,source:l,name:u})}setSourceContent(o,a){let c=o;this._sourceRoot!=null&&(c=e.relative(this._sourceRoot,c)),a!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(c)]=a):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(c)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(o,a,c){let l=a;if(a==null){if(o.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);l=o.file}const u=this._sourceRoot;u!=null&&(l=e.relative(u,l));const h=this._mappings.toArray().length>0?new n:this._sources,f=new n;this._mappings.unsortedForEach(function(d){if(d.source===l&&d.originalLine!=null){const g=o.originalPositionFor({line:d.originalLine,column:d.originalColumn});g.source!=null&&(d.source=g.source,c!=null&&(d.source=e.join(c,d.source)),u!=null&&(d.source=e.relative(u,d.source)),d.originalLine=g.line,d.originalColumn=g.column,g.name!=null&&(d.name=g.name))}const p=d.source;p!=null&&!h.has(p)&&h.add(p);const m=d.name;m!=null&&!f.has(m)&&f.add(m)},this),this._sources=h,this._names=f,o.sources.forEach(function(d){const p=o.sourceContentFor(d);p!=null&&(c!=null&&(d=e.join(c,d)),u!=null&&(d=e.relative(u,d)),this.setSourceContent(d,p))},this)}_validateMapping(o,a,c,l){if(a&&typeof a.line!="number"&&typeof a.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(o&&"line"in o&&"column"in o&&o.line>0&&o.column>=0&&!a&&!c&&!l)){if(!(o&&"line"in o&&"column"in o&&a&&"line"in a&&"column"in a&&o.line>0&&o.column>=0&&a.line>0&&a.column>=0&&c))throw new Error("Invalid mapping: "+JSON.stringify({generated:o,source:c,original:a,name:l}))}}_serializeMappings(){let o=0,a=1,c=0,l=0,u=0,h=0,f="",d,p,m,g;const _=this._mappings.toArray();for(let y=0,v=_.length;y<v;y++){if(p=_[y],d="",p.generatedLine!==a)for(o=0;p.generatedLine!==a;)d+=";",a++;else if(y>0){if(!e.compareByGeneratedPositionsInflated(p,_[y-1]))continue;d+=","}d+=t.encode(p.generatedColumn-o),o=p.generatedColumn,p.source!=null&&(g=this._sources.indexOf(p.source),d+=t.encode(g-h),h=g,d+=t.encode(p.originalLine-1-l),l=p.originalLine-1,d+=t.encode(p.originalColumn-c),c=p.originalColumn,p.name!=null&&(m=this._names.indexOf(p.name),d+=t.encode(m-u),u=m)),f+=d}return f}_generateSourcesContent(o,a){return o.map(function(c){if(!this._sourcesContents)return null;a!=null&&(c=e.relative(a,c));const l=e.toSetString(c);return Object.prototype.hasOwnProperty.call(this._sourcesContents,l)?this._sourcesContents[l]:null},this)}toJSON(){const o={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(o.file=this._file),this._sourceRoot!=null&&(o.sourceRoot=this._sourceRoot),this._sourcesContents&&(o.sourcesContent=this._generateSourcesContent(o.sources,o.sourceRoot)),o}toString(){return JSON.stringify(this.toJSON())}}return i.prototype._version=3,gN.SourceMapGenerator=i,gN}var sw={},dP={},gz;function lOe(){return gz||(gz=1,(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a===t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(dP)),dP}var xR={exports:{}},_z;function Dee(){if(_z)return xR.exports;_z=1;let t=null;return xR.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},xR.exports.initialize=e=>{t=e},xR.exports}var pP,vz;function uOe(){if(vz)return pP;vz=1;const t=Dee();function e(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let n=null;return pP=function(){if(n)return n;const i=[];return n=t().then(s=>WebAssembly.instantiate(s,{env:{mapping_callback(o,a,c,l,u,h,f,d,p,m){const g=new e;g.generatedLine=o+1,g.generatedColumn=a,c&&(g.lastGeneratedColumn=l-1),u&&(g.source=h,g.originalLine=f+1,g.originalColumn=d,p&&(g.name=m)),i[i.length-1](g)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(s=>({exports:s.instance.exports,withMappingCallback:(o,a)=>{i.push(o);try{a()}finally{i.pop()}}})).then(null,s=>{throw n=null,s}),n},pP}var yz;function hOe(){if(yz)return sw;yz=1;const t=vI(),e=lOe(),n=Nee().ArraySet;Eee();const r=Dee(),i=uOe(),s=Symbol("smcInternal");class o{constructor(f,d){return f==s?Promise.resolve(this):l(f,d)}static initialize(f){r.initialize(f["lib/mappings.wasm"])}static fromSourceMap(f,d){return u(f,d)}static async with(f,d,p){const m=await new o(f,d);try{return await p(m)}finally{m.destroy()}}eachMapping(f,d,p){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(f){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}o.prototype._version=3,o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,sw.SourceMapConsumer=o;class a extends o{constructor(f,d){return super(s).then(p=>{let m=f;typeof f=="string"&&(m=t.parseSourceMapInput(f));const g=t.getArg(m,"version"),_=t.getArg(m,"sources").map(String),y=t.getArg(m,"names",[]),v=t.getArg(m,"sourceRoot",null),E=t.getArg(m,"sourcesContent",null),x=t.getArg(m,"mappings"),A=t.getArg(m,"file",null),T=t.getArg(m,"x_google_ignoreList",null);if(g!=p._version)throw new Error("Unsupported version: "+g);return p._sourceLookupCache=new Map,p._names=n.fromArray(y.map(String),!0),p._sources=n.fromArray(_,!0),p._absoluteSources=n.fromArray(p._sources.toArray().map(function(k){return t.computeSourceURL(v,k,d)}),!0),p.sourceRoot=v,p.sourcesContent=E,p._mappings=x,p._sourceMapURL=d,p.file=A,p.x_google_ignoreList=T,p._computedColumnSpans=!1,p._mappingsPtr=0,p._wasm=null,i().then(k=>(p._wasm=k,p))})}_findSourceIndex(f){const d=this._sourceLookupCache.get(f);if(typeof d=="number")return d;const p=t.computeSourceURL(null,f,this._sourceMapURL);if(this._absoluteSources.has(p)){const g=this._absoluteSources.indexOf(p);return this._sourceLookupCache.set(f,g),g}const m=t.computeSourceURL(this.sourceRoot,f,this._sourceMapURL);if(this._absoluteSources.has(m)){const g=this._absoluteSources.indexOf(m);return this._sourceLookupCache.set(f,g),g}return-1}static fromSourceMap(f,d){return new a(f.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const f=this._mappings,d=f.length,p=this._wasm.exports.allocate_mappings(d)>>>0,m=new Uint8Array(this._wasm.exports.memory.buffer,p,d);for(let _=0;_<d;_++)m[_]=f.charCodeAt(_);const g=this._wasm.exports.parse_mappings(p);if(!g){const _=this._wasm.exports.get_last_error();let y=`Error parsing mappings (code ${_}): `;switch(_){case 1:y+="the mappings contained a negative line, column, source index, or name index";break;case 2:y+="the mappings contained a number larger than 2**32";break;case 3:y+="reached EOF while in the middle of parsing a VLQ";break;case 4:y+="invalid base 64 character while parsing a VLQ";break;default:y+="unknown error code";break}throw new Error(y)}this._mappingsPtr=g}eachMapping(f,d,p){const m=d||null,g=p||o.GENERATED_ORDER;this._wasm.withMappingCallback(_=>{_.source!==null&&(_.source=this._absoluteSources.at(_.source),_.name!==null&&(_.name=this._names.at(_.name))),this._computedColumnSpans&&_.lastGeneratedColumn===null&&(_.lastGeneratedColumn=1/0),f.call(m,_)},()=>{switch(g){case o.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case o.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(f){let d=t.getArg(f,"source");const p=t.getArg(f,"line"),m=f.column||0;if(d=this._findSourceIndex(d),d<0)return[];if(p<1)throw new Error("Line numbers must be >= 1");if(m<0)throw new Error("Column numbers must be >= 0");const g=[];return this._wasm.withMappingCallback(_=>{let y=_.lastGeneratedColumn;this._computedColumnSpans&&y===null&&(y=1/0),g.push({line:_.generatedLine,column:_.generatedColumn,lastColumn:y})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),d,p-1,"column"in f,m)}),g}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(f){const d={generatedLine:t.getArg(f,"line"),generatedColumn:t.getArg(f,"column")};if(d.generatedLine<1)throw new Error("Line numbers must be >= 1");if(d.generatedColumn<0)throw new Error("Column numbers must be >= 0");let p=t.getArg(f,"bias",o.GREATEST_LOWER_BOUND);p==null&&(p=o.GREATEST_LOWER_BOUND);let m;if(this._wasm.withMappingCallback(g=>m=g,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),d.generatedLine-1,d.generatedColumn,p)}),m&&m.generatedLine===d.generatedLine){let g=t.getArg(m,"source",null);g!==null&&(g=this._absoluteSources.at(g));let _=t.getArg(m,"name",null);return _!==null&&(_=this._names.at(_)),{source:g,line:t.getArg(m,"originalLine",null),column:t.getArg(m,"originalColumn",null),name:_}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(f){return f==null}):!1}sourceContentFor(f,d){if(!this.sourcesContent)return null;const p=this._findSourceIndex(f);if(p>=0)return this.sourcesContent[p];if(d)return null;throw new Error('"'+f+'" is not in the SourceMap.')}generatedPositionFor(f){let d=t.getArg(f,"source");if(d=this._findSourceIndex(d),d<0)return{line:null,column:null,lastColumn:null};const p={source:d,originalLine:t.getArg(f,"line"),originalColumn:t.getArg(f,"column")};if(p.originalLine<1)throw new Error("Line numbers must be >= 1");if(p.originalColumn<0)throw new Error("Column numbers must be >= 0");let m=t.getArg(f,"bias",o.GREATEST_LOWER_BOUND);m==null&&(m=o.GREATEST_LOWER_BOUND);let g;if(this._wasm.withMappingCallback(_=>g=_,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),p.source,p.originalLine-1,p.originalColumn,m)}),g&&g.source===p.source){let _=g.lastGeneratedColumn;return this._computedColumnSpans&&_===null&&(_=1/0),{line:t.getArg(g,"generatedLine",null),column:t.getArg(g,"generatedColumn",null),lastColumn:_}}return{line:null,column:null,lastColumn:null}}}a.prototype.consumer=o,sw.BasicSourceMapConsumer=a;class c extends o{constructor(f,d){return super(s).then(p=>{let m=f;typeof f=="string"&&(m=t.parseSourceMapInput(f));const g=t.getArg(m,"version"),_=t.getArg(m,"sections");if(g!=p._version)throw new Error("Unsupported version: "+g);let y={line:-1,column:0};return Promise.all(_.map(v=>{if(v.url)throw new Error("Support for url field in sections not implemented.");const E=t.getArg(v,"offset"),x=t.getArg(E,"line"),A=t.getArg(E,"column");if(x<y.line||x===y.line&&A<y.column)throw new Error("Section offsets must be ordered and non-overlapping.");return y=E,new o(t.getArg(v,"map"),d).then(k=>({generatedOffset:{generatedLine:x+1,generatedColumn:A+1},consumer:k}))})).then(v=>(p._sections=v,p))})}get sources(){const f=[];for(let d=0;d<this._sections.length;d++)for(let p=0;p<this._sections[d].consumer.sources.length;p++)f.push(this._sections[d].consumer.sources[p]);return f}originalPositionFor(f){const d={generatedLine:t.getArg(f,"line"),generatedColumn:t.getArg(f,"column")},p=e.search(d,this._sections,function(g,_){const y=g.generatedLine-_.generatedOffset.generatedLine;return y||g.generatedColumn-(_.generatedOffset.generatedColumn-1)}),m=this._sections[p];return m?m.consumer.originalPositionFor({line:d.generatedLine-(m.generatedOffset.generatedLine-1),column:d.generatedColumn-(m.generatedOffset.generatedLine===d.generatedLine?m.generatedOffset.generatedColumn-1:0),bias:f.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(f){return f.consumer.hasContentsOfAllSources()})}sourceContentFor(f,d){for(let p=0;p<this._sections.length;p++){const g=this._sections[p].consumer.sourceContentFor(f,!0);if(g)return g}if(d)return null;throw new Error('"'+f+'" is not in the SourceMap.')}_findSectionIndex(f){for(let d=0;d<this._sections.length;d++){const{consumer:p}=this._sections[d];if(p._findSourceIndex(f)!==-1)return d}return-1}generatedPositionFor(f){const d=this._findSectionIndex(t.getArg(f,"source")),p=d>=0?this._sections[d]:null,m=d>=0&&d+1<this._sections.length?this._sections[d+1]:null,g=p&&p.consumer.generatedPositionFor(f);if(g&&g.line!==null){const _=p.generatedOffset.generatedLine-1,y=p.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=y,typeof g.lastColumn=="number"&&(g.lastColumn+=y)),g.lastColumn===1/0&&m&&g.line===m.generatedOffset.generatedLine&&(g.lastColumn=m.generatedOffset.generatedColumn-2),g.line+=_,g}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(f){const d=this._findSectionIndex(t.getArg(f,"source")),p=d>=0?this._sections[d]:null,m=d>=0&&d+1<this._sections.length?this._sections[d+1]:null;return p?p.consumer.allGeneratedPositionsFor(f).map(g=>{const _=p.generatedOffset.generatedLine-1,y=p.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=y,typeof g.lastColumn=="number"&&(g.lastColumn+=y)),g.lastColumn===1/0&&m&&g.line===m.generatedOffset.generatedLine&&(g.lastColumn=m.generatedOffset.generatedColumn-2),g.line+=_,g}):[]}eachMapping(f,d,p){this._sections.forEach((m,g)=>{const _=g+1<this._sections.length?this._sections[g+1]:null,{generatedOffset:y}=m,v=y.generatedLine-1,E=y.generatedColumn-1;m.consumer.eachMapping(function(x){x.generatedLine===1&&(x.generatedColumn+=E,typeof x.lastGeneratedColumn=="number"&&(x.lastGeneratedColumn+=E)),x.lastGeneratedColumn===1/0&&_&&x.generatedLine===_.generatedOffset.generatedLine&&(x.lastGeneratedColumn=_.generatedOffset.generatedColumn-2),x.generatedLine+=v,f.call(this,x)},d,p)})}computeColumnSpans(){for(let f=0;f<this._sections.length;f++)this._sections[f].consumer.computeColumnSpans()}destroy(){for(let f=0;f<this._sections.length;f++)this._sections[f].consumer.destroy()}}sw.IndexedSourceMapConsumer=c;function l(h,f){let d=h;typeof h=="string"&&(d=t.parseSourceMapInput(h));const p=d.sections!=null?new c(d,f):new a(d,f);return Promise.resolve(p)}function u(h,f){return a.fromSourceMap(h,f)}return sw}var mP={},bz;function fOe(){if(bz)return mP;bz=1;const t=Pee().SourceMapGenerator,e=vI(),n=/(\r?\n)/,r=10,i="$$$isSourceNode$$$";class s{constructor(a,c,l,u,h){this.children=[],this.sourceContents={},this.line=a??null,this.column=c??null,this.source=l??null,this.name=h??null,this[i]=!0,u!=null&&this.add(u)}static fromStringWithSourceMap(a,c,l){const u=new s,h=a.split(n);let f=0;const d=function(){const v=x(),E=x()||"";return v+E;function x(){return f<h.length?h[f++]:void 0}};let p=1,m=0,g=null,_;return c.eachMapping(function(v){if(g!==null)if(p<v.generatedLine)y(g,d()),p++,m=0;else{_=h[f]||"";const E=_.substr(0,v.generatedColumn-m);h[f]=_.substr(v.generatedColumn-m),m=v.generatedColumn,y(g,E),g=v;return}for(;p<v.generatedLine;)u.add(d()),p++;m<v.generatedColumn&&(_=h[f]||"",u.add(_.substr(0,v.generatedColumn)),h[f]=_.substr(v.generatedColumn),m=v.generatedColumn),g=v},this),f<h.length&&(g&&y(g,d()),u.add(h.splice(f).join(""))),c.sources.forEach(function(v){const E=c.sourceContentFor(v);E!=null&&(l!=null&&(v=e.join(l,v)),u.setSourceContent(v,E))}),u;function y(v,E){if(v===null||v.source===void 0)u.add(E);else{const x=l?e.join(l,v.source):v.source;u.add(new s(v.originalLine,v.originalColumn,x,E,v.name))}}}add(a){if(Array.isArray(a))a.forEach(function(c){this.add(c)},this);else if(a[i]||typeof a=="string")a&&this.children.push(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}prepend(a){if(Array.isArray(a))for(let c=a.length-1;c>=0;c--)this.prepend(a[c]);else if(a[i]||typeof a=="string")this.children.unshift(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}walk(a){let c;for(let l=0,u=this.children.length;l<u;l++)c=this.children[l],c[i]?c.walk(a):c!==""&&a(c,{source:this.source,line:this.line,column:this.column,name:this.name})}join(a){let c,l;const u=this.children.length;if(u>0){for(c=[],l=0;l<u-1;l++)c.push(this.children[l]),c.push(a);c.push(this.children[l]),this.children=c}return this}replaceRight(a,c){const l=this.children[this.children.length-1];return l[i]?l.replaceRight(a,c):typeof l=="string"?this.children[this.children.length-1]=l.replace(a,c):this.children.push("".replace(a,c)),this}setSourceContent(a,c){this.sourceContents[e.toSetString(a)]=c}walkSourceContents(a){for(let l=0,u=this.children.length;l<u;l++)this.children[l][i]&&this.children[l].walkSourceContents(a);const c=Object.keys(this.sourceContents);for(let l=0,u=c.length;l<u;l++)a(e.fromSetString(c[l]),this.sourceContents[c[l]])}toString(){let a="";return this.walk(function(c){a+=c}),a}toStringWithSourceMap(a){const c={code:"",line:1,column:0},l=new t(a);let u=!1,h=null,f=null,d=null,p=null;return this.walk(function(m,g){c.code+=m,g.source!==null&&g.line!==null&&g.column!==null?((h!==g.source||f!==g.line||d!==g.column||p!==g.name)&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name}),h=g.source,f=g.line,d=g.column,p=g.name,u=!0):u&&(l.addMapping({generated:{line:c.line,column:c.column}}),h=null,u=!1);for(let _=0,y=m.length;_<y;_++)m.charCodeAt(_)===r?(c.line++,c.column=0,_+1===y?(h=null,u=!1):u&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name})):c.column++}),this.walkSourceContents(function(m,g){l.setSourceContent(m,g)}),{code:c.code,map:l}}}return mP.SourceNode=s,mP}var Sz;function dOe(){return Sz||(Sz=1,iw.SourceMapGenerator=Pee().SourceMapGenerator,iw.SourceMapConsumer=hOe().SourceMapConsumer,iw.SourceNode=fOe().SourceNode),iw}var pOe=dOe();const ah={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},yI="zss.js";function Li(t,e){return new pOe.SourceNode(t.startLine??1,t.startColumn??1,yI,e)}function ZL(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function wR(t){return`'${ZL(t)}'`}function gP(t){const e=dx(t);return e.errors.length?t:`['${e.tokens.map(r=>{if(r.tokenType===EC){const i=ZL(r.image.substring(1));return rr(i)==="center"?"$CENTER":`', api.print(api.get('${i}')), '`}return ZL(r.image)}).join("")}'].join('')`}function ow(t){return t.filter(e=>e!==void 0).map(Zi)}function Ez(t){return Li(t,"")}function mOe(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function sc(t,e,n){return Li(t,[`api.${e}(`,...mOe(n,", "),")"])}function gOe(t){if(t.type===Bn.COMPARE&&t.compare.type===Bn.COMPARE_ITEM)switch(t.compare.method){case Ky.IS_EQ:return sc(t,"isEq",[Zi(t.lhs),Zi(t.rhs)]);case Ky.IS_NOT_EQ:return sc(t,"isNotEq",[Zi(t.lhs),Zi(t.rhs)]);case Ky.IS_LESS_THAN:return sc(t,"isLessThan",[Zi(t.lhs),Zi(t.rhs)]);case Ky.IS_GREATER_THAN:return sc(t,"isGreaterThan",[Zi(t.lhs),Zi(t.rhs)]);case Ky.IS_LESS_THAN_OR_EQ:return sc(t,"isLessThanOrEq",[Zi(t.lhs),Zi(t.rhs)]);case Ky.IS_GREATER_THAN_OR_EQ:return sc(t,"isGreaterThanOrEq",[Zi(t.lhs),Zi(t.rhs)])}return Li(t,"")}function Ry(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",Zi(n),")"])}function xz(t,e,n){return t.prepend(`api.${e}(`),t.add([Zi(n),")"])}function _Oe(t,e){if(t.type===Bn.OPERATOR_ITEM)switch(t.operator){case om.PLUS:return Ry(e,"opPlus",t.rhs);case om.MINUS:return Ry(e,"opMinus",t.rhs);case om.POWER:return Ry(e,"opPower",t.rhs);case om.MULTIPLY:return Ry(e,"opMultiply",t.rhs);case om.DIVIDE:return Ry(e,"opDivide",t.rhs);case om.MOD_DIVIDE:return Ry(e,"opModDivide",t.rhs);case om.FLOOR_DIVIDE:return Ry(e,"opFloorDivide",t.rhs);case om.UNI_PLUS:return xz(e,"opUniPlus",t.rhs);case om.UNI_MINUS:return xz(e,"opUniMinus",t.rhs)}return Li(t,"")}function vOe(t){if(t.type===Bn.OPERATOR){const e=t.lhs?Zi(t.lhs):Li(t,"");return t.items.forEach(n=>_Oe(n,e)),e}return Li(t,"")}function TR(t,e){return Li(t,[sc(t,"jump",[`${e}`]),"; continue;"])}function sg(t){return ah.linelookup[t??""]??-1}function QL(t,e){ah.linelookup[t]=e}function VS(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.ELSE_IF:i.type===e&&(i.done=n);break;case Bn.IF_BLOCK:case Bn.IF_CHECK:i.type===e&&(i.skip=n);break;case Bn.LINE:VS(i.stmts,e,n);break}}}function Lee(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.ELSE_IF:i.type===e&&QL(i.done,n);break;case Bn.IF_BLOCK:case Bn.IF_CHECK:i.type===e&&QL(i.skip,n);break;case Bn.LINE:Lee(i.stmts,e,n);break}}}function Zi(t){switch(t.type){case Bn.PROGRAM:return Li(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(Zi).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${yI}`]);case Bn.API:return Li(t,["  ",sc(t,t.method,ow(t.words)),`;
`]);case Bn.LINE:return Li(t,[`case ${t.lineindex}:
`,...t.stmts.map(Zi).flat(),`  break;
`]);case Bn.MARK:return Li(t,`  // ${t.comment}
`);case Bn.GOTO:{const e=sg(t.id);return Li(t,["  ",TR(t,e),`
`])}case Bn.COUNT:return Li(t,`${t.index}`);case Bn.LITERAL:switch(t.literal){case Tk.NUMBER:return Li(t,`${t.value}`);case Tk.STRING:return Li(t,wR(t.value));case Tk.TEMPLATE:return Li(t,gP(t.value))}return Ez(t);case Bn.TEXT:return Li(t,["  ",sc(t,"text",[gP(t.value)]),`;
`]);case Bn.STAT:if(ah.isfirststat){ah.isfirststat=!1;const e=t.value.trim().split(" ").map(wR);return Li(t,["  ",sc(t,"stat",e),`;
`])}return Li(t,`  // skipped ${t.value}
`);case Bn.LABEL:{const e=rr(t.name),n=t.active?"label":"comment";ah.labels[e]||(ah.labels[e]=[]);const r=(t.active?1:-1)*t.lineindex;return ah.labels[e].push(r),Li(t,`  // ${r} '${e}' ${n}
`)}case Bn.HYPERLINK:return Li(t,["  ",sc(t,"hyperlink",[gP(t.text),...t.link.split(" ").filter(e=>e.length>0).map(wR)]),`;
`]);case Bn.MOVE:{const e=sc(t,"command",[wR("go"),ow(t.words)].flat());return t.wait?Li(t,["  if (",e,`) { continue; };
`]):Li(t,["  ",e,`;
`])}case Bn.COMMAND:return Li(t,["  if (",sc(t,"command",ow(t.words)),`) { continue; };
`]);case Bn.IF:{const e=t.block?.type===Bn.IF_BLOCK?t.block:void 0;if(fe(e)){VS([t.check],Bn.IF_CHECK,e.skip);const n=Li(t,Zi(t.check));return e.lines.forEach(r=>n.add(Zi(r))),Lee(e.altlines,Bn.ELSE_IF,sg(e.done)),e.altlines.forEach(r=>n.add(Zi(r))),n}return Li(t,Zi(t.check))}case Bn.IF_CHECK:{const e=sg(t.skip);return e===-1?Li(t,["  ",sc(t,t.method,ow(t.words)),`;
`]):Li(t,["  if (!",sc(t,t.method,ow(t.words)),") { ",TR(t,e),` }
`])}case Bn.ELSE_IF:case Bn.ELSE:{const e=Li(t,"");return t.lines.forEach(n=>e.add(Zi(n))),e}case Bn.WHILE:{const e=sg(t.loop),n=sg(t.done),r=Li(t,"");return VS(t.lines,Bn.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=n;break;case Bn.CONTINUE:i.goto=e;break}r.add(Zi(i))}),r}case Bn.REPEAT:{const e=sg(t.loop),n=sg(t.done),r=Li(t,"");return VS(t.lines,Bn.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=n;break;case Bn.CONTINUE:i.goto=e;break}r.add(Zi(i))}),r}case Bn.WAITFOR:{const e=Li(t,"");return VS(t.lines,Bn.IF_CHECK,t.loop),t.lines.forEach(n=>{e.add(Zi(n))}),e}case Bn.FOREACH:{const e=sg(t.loop),n=sg(t.done),r=Li(t,"");return VS(t.lines,Bn.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=n;break;case Bn.CONTINUE:i.goto=e;break}r.add(Zi(i))}),r}case Bn.BREAK:return Li(t,["  ",TR(t,t.goto),`
`]);case Bn.CONTINUE:return Li(t,["  ",TR(t,t.goto),`
`]);case Bn.OR:return sc(t,"or",t.items.map(Zi));case Bn.AND:return sc(t,"and",t.items.map(Zi));case Bn.NOT:return sc(t,"not",t.items.map(Zi));case Bn.COMPARE:return gOe(t);case Bn.OPERATOR:return vOe(t);case Bn.EXPR:return sc(t,"expr",t.words.map(Zi));default:return console.error("<unsupported node>",t.type,t),Ez(t)}}function am(t){if(fe(t))switch(t.type===Bn.LINE&&++ah.lineindex,t.lineindex=ah.lineindex,t.type){case Bn.PROGRAM:t.lines.forEach(am);break;case Bn.LINE:t.stmts.forEach(am);break;case Bn.MARK:QL(t.id,t.lineindex);break;case Bn.IF:am(t.check),am(t.block);break;case Bn.IF_BLOCK:t.lines.forEach(am),t.altlines.forEach(am);break;case Bn.ELSE_IF:t.lines.forEach(am);break;case Bn.ELSE:case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.WAITFOR:t.lines.forEach(am);break;case Bn.MOVE:case Bn.COMMAND:case Bn.IF_CHECK:t.words.forEach(am);break}}function Uee(t){ah.labels={},ah.internal=1,ah.lineindex=0,ah.isfirststat=!0,am(t)}function yOe(t){return Uee(t),{...Zi(t).toStringWithSourceMap({file:`${yI}.map`}),...ah}}function bOe(t,e){const n=`compile-${t}`;console.time(n);const r=See(e);if(console.timeEnd(n),KF&&console.info(e,r.errors),r.errors&&r.errors.length>0)return console.info(e,r.tokens,r.errors),r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=yOe(r.ast);if(i.code){KF&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...r,...i,source:"",code:new Function("api"," ")}}function SOe(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=bOe(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return fe(s)?s.isended():!0},scrollunlock(i,s){const o=e[i];fe(o)&&o.scrollunlock(s)},halt(i){const s=e[i];return fe(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];fe(o)&&o.set("arg",s)},boot(i,s,o,a){let c=e[i];if(!fe(e[i])){const l=n(o,a);if(c=e[i]=eUe(i,s,l),l.errors?.length){const[u]=l.errors,h=(u?.line??2)-1,f=a.replaceAll(`\r
`,"").split(`
`).map((y,v)=>[y,v]),d=f.slice(h-2,h);for(let y=0;y<d.length;++y){const[v,E]=d[y];_r(qe,Cm(),"build",`$grey${E+1} $grey${v}`)}const[p,m]=f[h]??[];if(dn(p)&&fe(m)){const y=(u.column??1)-1,v=y+u.length,E=y<p.length?p:`${p}*`,x=E.substring(0,y),A=E.substring(y,v),T=E.substring(v);_r(qe,Cm(),"build",`$red${m+1} $grey${x}$red${A}$grey${T}`)}const g=f.slice(h+1,h+3);for(let y=0;y<g.length;++y){const[v,E]=g[y];_r(qe,Cm(),"build",`$grey${E+1} $grey${v}`)}const _=u.message.split(`
`).slice(0,4).join(" ");_r(qe,Cm(),"build",_);return}}return c},tick(i,s,o,a,c){return!!r.boot(i,s,a,c)?.tick(o)},once(i,s,o,a){r.boot(i,s,o,a)?.once(),r.halt(i)},message(i){const{target:s,path:o}=_v(i.target),a=e[s];if(fe(a)){const c={...i,target:o};a.message(c)}}};return r}const Bee={};function pE(t){return Bee[t]?.content}function EOe(t){return Bee[t]?.format}function S1(t){return Kn(t)&&typeof t[0]=="string"}function xOe(t){const e=he.words[t];return dn(e)?[e,t+1]:[void 0,t]}function _P(t){const e=he.words[t];if(S1(e))return[e,t+1];const[n,r]=YM(t),[i,s]=xOe(r);return dn(i)&&(i==="empty"||ap({kind:i}))?[[i,n],s]:[void 0,t]}function SA(t){if(!S1(t))return;const[e]=t;return e}function jM(t){if(!S1(t))return;const[,e]=t,n=fe(e)?WM(e):void 0;return fe(n)?n:void 0}function Fee(t){if(!S1(t))return;const[,e]=t,n=fe(e)?qM(e):void 0;return fe(n)?V8(n):void 0}function e4(t,e,n,r){if(!fe(t))return!1;const i=mu(t);return!(fe(e)&&e!==i.name||fe(n)&&n!==i.color||fe(r)&&r!==i.bg)}function hx(t,e){const n=t??Fn.ISWALK,r=e??Fn.ISWALK;if(n===Fn.ISGHOST||r===Fn.ISGHOST)return!1;switch(n){case Fn.ISWALK:return r!==Fn.ISWALK;case Fn.ISSWIM:return r!==Fn.ISSWIM;case Fn.ISSOLID:return!0;case Fn.ISBULLET:return r!==Fn.ISWALK&&r!==Fn.ISSWIM}}function jT(t,e,n){const r=t?.objects[n];if(fe(r))return r;const i=fx(t,"player");return fe(e)?(e.x<0&&(e.x=au(0,bn-1)),e.y<0&&(e.y=au(0,Tr-1)),zee(e,i)):Gf(...i)}function wz(t,e){const n=fe(e)?WM(e):void 0,r=fe(e)?qM(e):void 0,i=[];if(fe(t)){for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];fe(a)&&e4(a,void 0,n,r)&&i.push(a)}const s=Object.values(t.objects);for(let o=0;o<s.length;++o){const a=s[o];e4(a,void 0,n,r)&&i.push(a)}}return i}function jee(t,e){return fe(t)?e.map(n=>{if(typeof n=="string"){const r=t.objects[n];if(fe(r))return r;const i=fx(t,rr(n));if(i.length)return i}else if(cv(n)&&n.x>=0&&n.x<bn&&n.y>=0&&n.y<Tr){const r=n.x+n.y*bn,i=t.lookup?.[r];return fe(i)?t.objects[i]:t.terrain[r]}}).flat().filter(fe):[]}function wOe(t,e,n,r){if(!fe(t))return;fe(t.distmaps)||(t.distmaps={});const i=`${e}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=t.distmaps[i];if(!fe(s)){s=new Array(zm).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(fe(c)&&E1(c)){const l=Yf(c,bn);if(s[l]===-2){const u=Ev(t,c.x,c.y);hx(e,ri(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}t.distmaps[i]=s}return s}function Tz(t,e){return E1(t)?e[Yf(t,bn)]:-1}function zM(t,e){const n=SA(e),r=jM(e),i=Fee(e);return fx(t,n??"").filter(s=>e4(s,n,r,i))}function fx(t,e){const n=t?.named?.[e];return fe(n)?[...n.values()].map(i=>typeof i=="string"?t?.objects[i]:t?.terrain[i]).filter(fe):[]}function TOe(t){const e=[];for(let n=0;n<Tr;++n)for(let r=0;r<bn;++r){const i={x:r,y:n},s=fs(t,i);!s?.name&&!s?.kind&&e.push(i)}return e}function zee(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function Az(t,e,n,r,i){if(!fe(t))return;const s=wOe(t,e,n,r);if(!fe(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=Tz(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=Tz(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function nE(t,e,n,r){const i=Vee(e);if(!fe(t)||!fe(i))return!1;const s=mh(i,e);if(!As(s)||!s?.id)return!1;const o=Cs(n);if(!fe(o))return!1;lc(o);const a=j8(o,Fn.ISWALK,r,!0);if(!fe(a)&&!As(a)){const c=ri(a,"collision");if(hx(Fn.ISWALK,c))return!1}return b6(i,s),delete i.objects[s.id],s.x=r.x,s.y=r.y,o.objects[s.id]=s,UL(o,s),UZ(o,s),dA(t,e,"enterx",r.x),dA(t,e,"entery",r.y),ROe(t,e,o.id),!0}function AOe(t){const n=(t?.activelist??[]).map(r=>{const i=IE(t,r,"board");return dn(i)?i:""});return WSe(n)}function COe(t){const e=AOe(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=Cs(e[i]);if(fe(s)&&!n.has(s.id)){cUe(s);const o=Cs(s.overboard??"");fe(o)&&(n.has(o.id)||r.push(o)),r.push(s)}}return r}function ROe(t,e,n){if(!fe(t))return;dA(t,e,"board",n);const r=Cs(n);fe(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function Vee(t){const e=Zh(la.MAIN),n=IE(e,t,"board"),r=uu(Qr.BOARD,n);return hA(r)}const bI=SOe();function vP(t){bI.halt(t)}function kOe(t){bI.message(t)}function MOe(t,e,n,r){if(!fe(t)||!fe(e)||!fe(n))return;const i={...he};he.book=t,he.board=e,he.element=n,he.elementid=n.id??"",he.elementisplayer=Nl(he.elementid);const s=he.element.player??Cm();he.elementfocus=he.elementisplayer?he.elementid:s;const o=ri(n,"cycle"),a=n.id??"",c=rr(n.name??n.kinddata?.name??"");if(bI.tick(a,B8.RUNTIME,o,c,r),nn(n?.tickertime)&&he.timestamp-n.tickertime>QA*5&&(n.tickertime=0,n.tickertext=""),he.elementisplayer){const l=Eg(he.elementid);nn(l.inputcurrent)&&(l.inputcurrent=0)}Dm(i).forEach(l=>{he[l]=i[l]})}function VM(t){const e=sv(la.MAIN),n=fA(e,t);if(!fe(e)||!fe(n))return;const r={...he},i=`${t}_run`,s=he.element?.name??he.element?.kinddata?.name??"",o=n?.code??"";bI.once(i,B8.RUNTIME,rr(s),o),Dm(r).forEach(a=>{he[a]=r[a]})}const Hee={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Fn.ISSOLID,Fn.ISWALK,Fn.ISSWIM,Fn.ISBULLET,Fn.ISGHOST,Fn.ISWALK,Fn.ISSWIM;function HM(t){return Kn(t)&&t4(t[0])}function t4(t){return fe(Fn[t])&&dn(t)}function $ee(t){if(dn(t))return Hee[rr(t)]}function OOe(t){const e=he.words[t];if(HM(e))return[e,t+1];if(t4(e))return[[e],t+1];const[n,r]=nu(t);return HM(n)?[n,r]:t4(n)?[[n],r]:[void 0,t]}function TS(t,e=0){const n=[];let r=t;for(;r<he.words.length;){const[i,s]=nu(r);if(Kn(i)&&!sd(i)&&!EA(i)&&!HM(i)&&!uc(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function nu(t){const e=he.words[t],n=t+1;if(_8(e)){const[r,i]=IOe(t);if(fe(r))return[r,i]}if($ee(e)){const[r,i]=OOe(t);if(fe(r))return[r,i]}if(WE(e)){const[r,i]=YM(t);if(fe(r))return[r,i]}if(dn(e)&&rr(e)==="rnd"){const[r,i]=nu(n),[s,o]=nu(i);return nn(r)&&nn(s)?[au(r,s),o]:nn(r)?[au(0,r),i]:[au(0,1),n]}if(XA(e)){const[r,i]=VK(t);if(fe(r))return[r,i]}if(!fe(e))return[void 0,t];if(nn(e)||Kn(e))return[e,n];if(dn(e)){const r=rr(e),i=he.get?.(e);if(fe(i))return[i,n];switch(r){case"aligned":case"alligned":{const s=jT(he.board,{x:he.element?.x??-1,y:he.element?.y??-1},he.elementfocus);return!fe(he.element)||!fe(s)?[0,n]:[he.element.x===s.x||he.element.y===s.y?1:0,n]}case"contact":{const s=jT(he.board,{x:he.element?.x??-1,y:he.element?.y??-1},he.elementfocus);if(!fe(he.element)||!fe(s))return[0,n];const o=(s.x??0)-(he.element?.x??0),a=(s.y??0)-(he.element?.y??0);return[o===0&&Math.abs(a)<2||a===0&&Math.abs(o)<2?1:0,n]}case"blocked":{const[s,o]=Dt(he.words,n,[ut.DIR]);return[nUe(he.board,he.element,s.destpt)?1:0,o]}case"any":{const[s]=Dt(he.words,n,[ut.ANY]);if(sd(s)){const[l,u,h]=Dt(he.words,n,[ut.DIR,ut.COLOR_OR_KIND]);if(l.targets.length){const[d,p]=u,m=[];for(let g=0;g<l.targets.length;++g){const _=l.targets[g],y=["any","at",_.x,_.y,...Kn(p)?p:[],d].filter(E=>E!==void 0),[v]=Dt(y,0,[ut.ANY]);Kn(v)&&v.length&&m.push(...v)}return[m,h]}let f;switch(l.layer){default:case yn.MID:f=fs(he.board,l.destpt);break;case yn.GROUND:f=Ev(he.board,l.destpt.x,l.destpt.y);break}if(fe(f)){const d=mu(f);if(uc(u))return[WM(u)===d.color||qM(u)===d.bg?[f]:[],h];const p=rr(SA(u)),m=jM(u);if((p.length&&p!==d.name||fe(m)&&m!==d.color)===!1)return[[f],h]}return[[],h]}const[o,a]=Dt(he.words,n,[ut.COLOR_OR_KIND]);return uc(o)?[wz(he.board,o),a]:[zM(he.board,o),a]}case"countof":{const[s]=Dt(he.words,n,[ut.ANY]);if(sd(s)){const[l,u,h]=Dt(he.words,n,[ut.DIR,ut.COLOR_OR_KIND]);if(l.targets.length){let d=0;const[p,m]=u;for(let g=0;g<l.targets.length;++g){const _=l.targets[g],y=["countof","at",_.x,_.y,...Kn(m)?m:[],p].filter(E=>E!==void 0),[v]=Dt(y,0,[ut.ANY]);nn(v)&&(d+=v)}return[d,h]}let f;switch(l.layer){default:case yn.MID:f=fs(he.board,l.destpt);break;case yn.GROUND:f=Ev(he.board,l.destpt.x,l.destpt.y);break}if(fe(f)){const d=mu(f);if(uc(u))return[WM(u)===d.color||qM(u)===d.bg?1:0,h];const p=rr(SA(u)),m=jM(u),g=p.length?p===d.name:!0,_=fe(m)?m===d.color:!0;if(g&&_)return[1,h]}return[0,h]}const[o,a]=Dt(he.words,n,[ut.COLOR_OR_KIND]);return uc(o)?[wz(he.board,o).length,a]:[zM(he.board,o).length,a]}case"rnd":return[au(0,1),n];case"abs":{const[s,o]=Dt(he.words,n,[ut.NUMBER]);return[Math.abs(s),o]}case"intceil":{const[s,o]=Dt(he.words,n,[ut.NUMBER]);return[Math.ceil(s),o]}case"intfloor":{const[s,o]=Dt(he.words,n,[ut.NUMBER]);return[Math.floor(s),o]}case"intround":{const[s,o]=Dt(he.words,n,[ut.NUMBER]);return[Math.round(s),o]}case"clamp":{const[s,o,a,c]=Dt(he.words,n,[ut.NUMBER,ut.NUMBER,ut.NUMBER]);return[Ci(s,o,a),c]}case"min":{const[s,o]=TS(n);return[Math.min(...s),o]}case"max":{const[s,o]=TS(n);return[Math.max(...s),o]}case"pick":{const[s,o]=TS(n);return[Gf(s),o]}case"pickwith":{const[s,o]=Dt(he.words,n,[ut.NUMBER_OR_STRING]),[a,c]=TS(o);return[GSe(`${s}`,a),c]}case"random":{const[s,o]=TS(n,2),[a,c]=s;return[au(a,c??0),o]}case"randomwith":{const[s,o]=Dt(he.words,n,[ut.NUMBER_OR_STRING]),[a,c]=TS(o,2),[l,u]=a;return[hK(`${s}`,l,u??0),c]}case"run":{const[s,o]=Dt(he.words,n,[ut.NAME]);return VM(s),[he.get?.("arg"),o]}case"runwith":{const[s,o,a]=Dt(he.words,n,[ut.ANY,ut.NAME]);return fe(he.element)&&(he.element.arg=s),VM(o),[he.get?.("arg"),a]}}}return[e,n]}const Gee={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function EA(t){return Kn(t)&&Wee(t[0])}function Wee(t){return fe(R1[t])&&dn(t)}function _8(t){if(dn(t))return Gee[rr(t)]}function Cz(t){if(EA(t))return t;if(Wee(t))return[t];const e=_8(t);if(fe(e))return[e]}function IOe(t){const e=he.words[t],n=Cz(e);if(EA(n))return[n,t+1];const[r,i]=nu(t),s=Cz(r);return EA(s)?[s,i]:[void 0,t]}function rh(t,e,n,r,i){const[s,o]=Dt(i,0,[ut.NUMBER_OR_STRING,ut.MAYBE_NUMBER_OR_STRING]);CK(qe,t,e,n,r,s,o),bee(e,n,r,s,o)}const NOe=["echo","reverb","autofilter","distortion","vibrato","fc","fcrush","autowah"];function v8(t,e,n,r){const[i,s]=Dt(r,0,[ut.NUMBER_OR_STRING]);if(nn(i))iN(qe,t,e,n,"volume",i),mN(e,n,"volume",i);else if(NOe.includes(rr(i))){const[o,a]=Dt(r,s,[ut.NUMBER_OR_STRING,ut.MAYBE_NUMBER_OR_STRING]);CK(qe,t,e,n,i,o,a),bee(e,n,i,o,a)}else{const[o]=Dt(r,s,[ut.MAYBE_NUMBER_OR_STRING]);if(nn(o)){const a=r.length-s,c=new Array(a).fill(ut.NUMBER),l=Dt(r,s,c).slice(0,a),u=l.length===1?l[0]:l;iN(qe,t,e,n,i,u),mN(e,n,i,u)}else{const[a]=Dt(r,s,[ut.MAYBE_NUMBER_OR_STRING]);iN(qe,t,e,n,i,a),mN(e,n,i,a)}}}function qee(t,e){const[n]=Dt(e,0,[ut.MAYBE_NAME]);let r="";if(dn(n)){const i=t.get(n);r=dn(i)&&!fe(_8(i))&&!fe($ee(i))&&!fe(WE(i))&&!fe(XA(i))?i:n}return r}function H_(t,e,n){BEe(qe,he.elementfocus,he.board?.id??"",qee(t,e),n)}const SI=Mv().command("ttsengine",(t,e)=>{const[n,r]=Dt(e,0,[ut.STRING,ut.MAYBE_STRING]);return HEe(qe,he.elementfocus,he.board?.id??"",n,r??""),0}).command("tts",(t,e)=>{const[n,r]=Dt(e,0,[ut.MAYBE_NUMBER_OR_STRING,ut.MAYBE_STRING]);return fe(n)&&fe(r)?$Ee(qe,he.elementfocus,he.board?.id??"",n,r):dn(n)?GEe(qe,he.elementfocus,he.board?.id??"",n):qEe(qe,he.elementfocus,he.board?.id??""),0}).command("ttsqueue",(t,e)=>{const[n,r]=Dt(e,0,[ut.NUMBER_OR_STRING,ut.STRING]);return WEe(qe,he.elementfocus,he.board?.id??"",n,r),0}).command("bpm",(t,e)=>{const[n]=Dt(e,0,[ut.NUMBER]);return FEe(qe,he.elementfocus,he.board?.id??"",n),0}).command("vol",(t,e)=>{const[n]=Dt(e,0,[ut.NUMBER]);return jEe(qe,he.elementfocus,he.board?.id??"",n),0}).command("bgvol",(t,e)=>{const[n]=Dt(e,0,[ut.NUMBER]);return zEe(qe,he.elementfocus,he.board?.id??"",n),0}).command("ttsvol",(t,e)=>{const[n]=Dt(e,0,[ut.NUMBER]);return VEe(qe,he.elementfocus,he.board?.id??"",n),0}).command("play",(t,e)=>(yMe(he.board?.id??"",qee(t,e)),0)).command("bgplay",(t,e)=>(H_(t,e,""),0)).command("bgplayon64n",(t,e)=>(H_(t,e,"@64n"),0)).command("bgplayon32n",(t,e)=>(H_(t,e,"@32n"),0)).command("bgplayon16n",(t,e)=>(H_(t,e,"@16n"),0)).command("bgplayon8n",(t,e)=>(H_(t,e,"@8n"),0)).command("bgplayon4n",(t,e)=>(H_(t,e,"@4n"),0)).command("bgplayon2n",(t,e)=>(H_(t,e,"@2n"),0)).command("bgplayon1n",(t,e)=>(H_(t,e,"@1m"),0)).command("synth",(t,e)=>{for(let n=0;n<4;++n)v8(he.elementfocus,he.board?.id??"",n,e);return 0}).command("synthrecord",(t,e)=>{const[n]=Dt(e,0,[ut.MAYBE_STRING]);return YEe(qe,he.elementfocus,n??""),0}).command("synthflush",()=>(KEe(qe,he.elementfocus),0)).command("echo",(t,e)=>{for(let n=0;n<2;++n)rh(he.elementfocus,he.board?.id??"",n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<2;++n)rh(he.elementfocus,he.board?.id??"",n,"fc",e);return 0}).command("autofilter",(t,e)=>{for(let n=0;n<2;++n)rh(he.elementfocus,he.board?.id??"",n,"autofilter",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<2;++n)rh(he.elementfocus,he.board?.id??"",n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<2;++n)rh(he.elementfocus,he.board?.id??"",n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<2;++n)rh(he.elementfocus,he.board?.id??"",n,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let n=0;n<2;++n)rh(he.elementfocus,he.board?.id??"",n,"autowah",e);return 0});for(let t=0;t<4;++t)SI.command(`synth${t+1}`,(e,n)=>{const r=he.board?.id??"";return v8(he.elementfocus,r,t,n),0});SI.command("synth5",(t,e)=>{for(let n=4;n<8;++n){const r=he.board?.id??"";v8(he.elementfocus,r,n,e)}return 0});for(let t=0;t<4;++t){const e=t+1;SI.command(`echo${e}`,(n,r)=>{const i=he.board?.id??"";return rh(he.elementfocus,i,t,"echo",r),0}).command(`fcrush${e}`,(n,r)=>{const i=he.board?.id??"";return rh(he.elementfocus,i,t,"fcrush",r),0}).command(`autofilter${e}`,(n,r)=>{const i=he.board?.id??"";return rh(he.elementfocus,i,t,"autofilter",r),0}).command(`reverb${e}`,(n,r)=>{const i=he.board?.id??"";return rh(he.elementfocus,i,t,"reverb",r),0}).command(`distort${e}`,(n,r)=>{const i=he.board?.id??"";return rh(he.elementfocus,i,t,"distort",r),0}).command(`vibrato${e}`,(n,r)=>{const i=he.board?.id??"";return rh(he.elementfocus,i,t,"vibrato",r),0}).command(`autowah${e}`,(n,r)=>{const i=he.board?.id??"";return rh(he.elementfocus,i,t,"autowah",r),0})}function Rz(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=fs(e,{x:s,y:i});As(o)&&td(e,o,t.timestamp),Ol(e,{x:s,y:i})}}function POe(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)Ol(t,{x:i,y:r})}function kz(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=fs(e,{x:s,y:i});As(o)&&td(e,o,t.timestamp),Ol(e,{x:s,y:i})}}function F1(t,e){fe(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.displaychar=e.displaychar,t.displaycolor=e.displaycolor,t.displaybg=e.displaybg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.p4=e.p4,t.p5=e.p5,t.p6=e.p6,t.p7=e.p7,t.p8=e.p8,t.p9=e.p9,t.p10=e.p10,t.code=e.code,t.item=e.item,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.lightdir=e.lightdir,t.stepx=e.stepx,t.stepy=e.stepy,t.shootx=e.shootx,t.shooty=e.shooty,t.pushable=e.pushable,t.collision=e.collision,t.breakable=e.breakable,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function EI(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return DOe(t,e,n,"",i)}if(!fe(he.book))return;const s=he.book,o=Cs(t);if(!fe(o))return;const a=Cs(e);if(!fe(a))return;lc(o),lc(a);let c=!1;if(fe(o)&&fe(a)){switch(i){case"all":Rz(s,a,n,r);break;case"object":kz(s,a,n,r);break;case"terrain":POe(a,n,r);break;default:c=!0;break}for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let h=!1,f=!1;switch(i){case"all":h=!0,f=!0;break;case"object":h=!0;break;case"terrain":f=!0;break}const d={x:u,y:l};let p,m=fs(o,d);if(As(m)?(p=Ev(o,u,l),Nl(m?.id)&&(m=void 0)):(p=m,m=void 0),fe(p)&&(f||c&&ri(p,"group")===i)){c&&Rz(s,a,d,d);const g=Qf(a,[p.kind??""],d);F1(g,p)}if(fe(m)&&(h||c&&ri(m,"group")===i)){c&&kz(s,a,d,d);const g=Qf(a,[m.kind??""],d);F1(g,m)}}lc(a)}}function DOe(t,e,n,r,i){if(!fe(he.book))return;const s=he.book,o=Cs(t);if(!fe(o))return;const a=Cs(e);if(fe(a)&&(lc(o),lc(a),fe(o)&&fe(a))){const{terrainelements:c,objectelements:l}=Jte(o,r,i);if(c.length===0&&l.length===0)return;const u={x:bn,y:Tr};for(let h=0;h<c.length;++h){const f=c[h];nn(f.x)&&(u.x=Math.min(u.x,f.x)),nn(f.y)&&(u.y=Math.min(u.y,f.y))}for(let h=0;h<l.length;++h){const f=l[h];nn(f.x)&&(u.x=Math.min(u.x,f.x)),nn(f.y)&&(u.y=Math.min(u.y,f.y))}for(let h=0;h<c.length;++h){const f=c[h],d={x:n.x+(f.x??0)-u.x,y:n.y+(f.y??0)-u.y},p=fs(a,d);fe(p)&&(As(p)&&td(a,p,s.timestamp),Ol(a,d));const m=Qf(a,[f.kind??""],d);F1(m,f)}for(let h=0;h<l.length;++h){const f=l[h],d={x:n.x+(f.x??0)-u.x,y:n.y+(f.y??0)-u.y},p=Qf(a,[f.kind??""],d);F1(p,f)}lc(a)}}function AR(t,e,n){if(!fe(he.element?.x)||!fe(he.element.y))return 0;if(he.elementisplayer){const c=he.board?.maxplayershots??0;if(c>0&&oUe(he.board).filter(u=>!u.removed&&Nl(u.party)&&ri(u,"collision")===Fn.ISBULLET).length>=c)return t.set("didshoot",0),t.yield(),0}const[r,i]=Dt(e,0,[ut.DIR,ut.MAYBE_KIND]),[s]=i??[];if(rr(s)==="player")return t.set("didshoot",0),t.yield(),0;he.element.shootx=Ci(r.destpt.x-r.startpt.x,-1,1),he.element.shooty=Ci(r.destpt.y-r.startpt.y,-1,1);const o=i??["bullet"],a=lwe(he.board,o,{x:he.element.x,y:he.element.y});if(fe(a)){fe(n)&&(a.arg=n),a.cycle=1,a.party=he.element.party??he.element.id??"",a.collision=Fn.ISBULLET,a.breakable=1,a.stepx=r.destpt.x-he.element.x,a.stepy=r.destpt.y-he.element.y,a.bg=Ft.ONCLEAR;const c=ap(a),l=a.code??c?.code??"";MOe(he.book,he.board,a,l)}return he.elementisplayer&&t.set("didshoot",fe(a)?1:0),t.yield(),0}function AT(t,e,n){if(!cv(he.element)||!fe(he.book)||!fe(he.board)||!fe(he.element))return 0;const[r,i]=Dt(t,0,[ut.DIR,ut.KIND]),[s]=i;if(rr(s)==="player")return 0;if(r.targets.length){for(let f=0;f<r.targets.length;++f){const d=r.targets[f];AT(["at",d.x,d.y,...i],e,n)}return 0}const{destpt:o}=r;if(o.x<0||o.x>=bn||o.y<0||o.y>=Tr)return 0;const[a]=i,c={x:he.element?.x??0,y:he.element?.y??0},l=ap({kind:a});if(ri(l,"collision")===Fn.ISGHOST)return Qf(he.board,i,r.destpt,e),0;let h=fs(he.board,r.destpt);if(As(h)&&ri(h,"pushable")){const f=Ts(r.destpt),d=zo(f,Xd(c,f));Qh(he.book,he.board,h,d),h=fs(he.board,r.destpt)}if(a==="empty")return td(he.board,h,he.timestamp),0;if(h?.kind===a){const[,f]=i;return g1(h,f),0}if(As(h)&&td(he.board,h,he.timestamp),As(l)||Qf(he.board,i,r.destpt,e),As(l)){const f=Qf(he.board,i,r.destpt,e);fe(f)&&fe(n)&&(f.arg=n)}return 0}function CR(t,e,n){if(!fe(he.book)||!fe(he.board))return 1;const[r,i]=Dt(e,0,[ut.DIR,ut.DIR]),s=fs(he.board,r.destpt);if(fe(s)&&fe(s.kind)){const[o]=s.kind;if(rr(o)==="player")return 1;const a=ri(s,"collision"),c=j8(he.board,a,i.destpt);if(fe(c))return 1;const l=Qf(he.board,[s.kind],i.destpt);if(!fe(l))return 1;F1(l,s),fe(n)&&(l.arg=n)}else return 1;return 0}const LOe={x:0,y:0},UOe={x:bn-1,y:Tr-1},BOe="all",FOe=Mv().command("build",(t,e)=>{if(!fe(he.book)||!fe(he.board)||!fe(he.element))return 0;const[n,r]=Dt(e,0,[ut.NAME,ut.MAYBE_STRING]),[i]=cwe(la.TEMP,Go(),Qr.BOARD);if(!fe(i))return 0;const s=hA(i);if(!fe(s))return 0;if(dn(r)){const o=Cs(r);if(fe(o))switch(EI(o.id,s.id,LOe,UOe,BOe),s.isdark=o.isdark,s.startx=o.startx,s.starty=o.starty,s.over=o.over,s.under=o.under,s.camera=o.camera,s.graphics=o.graphics,s.facing=o.facing,s.charset=o.charset,s.palette=o.palette,s.timelimit=o.timelimit,s.restartonzap=o.restartonzap,s.maxplayershots=o.maxplayershots,s.b1=o.b1,s.b2=o.b2,s.b3=o.b3,s.b4=o.b4,s.b5=o.b5,s.b6=o.b6,s.b7=o.b7,s.b8=o.b8,s.b9=o.b9,s.b10=o.b10,rr(n)){case"exitwest":s.exiteast=he.board.id;break;case"exiteast":s.exitwest=he.board.id;break;case"exitnorth":s.exitsouth=he.board.id;break;case"exitsouth":s.exitnorth=he.board.id;break}}return t.set(n,s.id),0}).command("goto",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r]=Dt(e,0,[ut.STRING]),[i,s]=Dt(e,r,[ut.MAYBE_NUMBER,ut.MAYBE_NUMBER]),o=Cs(n);if(!fe(o))return 0;lc(o);const a={x:i??o.startx??Math.round(bn*.5),y:s??o.starty??Math.round(Tr*.5)},c=mu(he.element);if(c.name!=="player"){const l=ri(he.element,"color"),u=ri(he.element,"bg"),h=kI(l,u),f=zM(o,[c.name,h]),[d]=f.sort((p,m)=>{const g=p.y??1e4,_=m.y??1e4,y=g-_;if(y!==0)return y;const v=p.x??1e4,E=m.x??1e4;return v-E});fe(d)&&nn(d.x)&&nn(d.y)&&(a.x=d.x,a.y=d.y)}return nE(he.book,he.elementfocus,o.id,a),0}).command("transport",(t,e)=>{if(!fe(he.book)||!fe(he.board)||!fe(he.element))return 0;const[n]=Dt(e,0,[ut.STRING]),r=mh(he.board,n);if(fe(he.element?.x)&&fe(he.element.y)&&fe(r?.x)&&fe(r.y)){let i=!0;const s={x:he.element.x,y:he.element.y},o=s.x-r.x,a=s.y-r.y;if(ri(he.element,"shootx")!==o||ri(he.element,"shooty")!==a)return 0;for(;i&&(s.x+=o,s.y+=a,!(s.x<0||s.x>=bn||s.y<0||s.y>=Tr));){const c=fs(he.board,s);c?.kind===he.element.kind&&ri(c,"shootx")===-o&&ri(c,"shooty")===-a&&Qh(he.book,he.board,r,{x:s.x+o,y:s.y+a})&&(i=!1)}i&&Qh(he.book,he.board,r,{x:he.element.x+o,y:he.element.y+a})}return 0}).command("shove",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r]=Dt(e,0,[ut.DIR,ut.DIR]),i=fs(he.board,n.destpt);if(As(i)){const s=n.destpt.x+(r.destpt.x-r.startpt.x),o=n.destpt.y+(r.destpt.y-r.startpt.y);Qh(he.book,he.board,i,{x:s,y:o})}return 0}).command("push",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r]=Dt(e,0,[ut.DIR,ut.DIR]),i=fs(he.board,n.destpt);if(As(i)&&ri(i,"pushable")){const s=n.destpt.x+(r.destpt.x-r.startpt.x),o=n.destpt.y+(r.destpt.y-r.startpt.y);Qh(he.book,he.board,i,{x:s,y:o})}return 0}).command("duplicate",CR).command("duplicatewith",(t,e)=>{const[n,r]=Dt(e,0,[ut.ANY]);return CR(e.slice(r),n)}).command("dupe",CR).command("dupewith",(t,e)=>{const[n,r]=Dt(e,0,[ut.ANY]);return CR(e.slice(r),n)}).command("write",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r,i]=Dt(e,0,[ut.DIR,ut.COLOR]),s=e.slice(i).map(no).join(" "),{color:o,bg:a}=rE(r),c=$g(s,256,1)?.measuredwidth??1,l=Hg(256,1,o??Ft.WHITE,a??Ft.BLACK);ei(s,l,!1);const u=c-1;switch(Xd(n.startpt,n.destpt)){case yn.EAST:for(let f=0;f<c;++f)Ol(he.board,{x:n.destpt.x+f,y:n.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case yn.WEST:for(let f=0;f<c;++f)Ol(he.board,{x:n.destpt.x+f-u,y:n.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case yn.NORTH:for(let f=0;f<c;++f)Ol(he.board,{x:n.destpt.x,y:n.destpt.y+f-u,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case yn.SOUTH:for(let f=0;f<c;++f)Ol(he.board,{x:n.destpt.x,y:n.destpt.y+f,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break}return 0}).command("change",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r]=Dt(e,0,[ut.KIND,ut.KIND]),[i]=n,[s]=r;if(rr(i)==="player"||rr(s)==="player")return 0;(SA(n)??"")==="empty"&&TOe(he.board).forEach(u=>{Qf(he.board,r,u)});const a=SA(r),c=jM(r),l=Fee(r);return zM(he.board,n).forEach(u=>{if(fe(c)&&(u.color=c),fe(l)&&(u.bg=l),mu(u).name!==a){const f=ri(u,"color"),d=ri(u,"bg");if(td(he.board,u,he.timestamp),a!=="empty"){const p={x:u.x??0,y:u.y??0},m=Qf(he.board,r,p);fe(m)&&(m.color=f,m.bg=d)}}}),0}).command("put",(t,e)=>AT(e)).command("putwith",(t,e)=>{const[n,r]=Dt(e,0,[ut.ANY]);return AT(e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=Dt(e,0,[ut.ANY]);return fe(he.board)&&mh(he.board,n)?0:AT(e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=Dt(e,0,[ut.ANY,ut.ANY]);return fe(he.board)&&mh(he.board,r)?0:AT(e.slice(i),r,n)}).command("shoot",AR).command("shootwith",(t,e)=>{const[n,r]=Dt(e,0,[ut.ANY]);return AR(t,e.slice(r),n)}).command("throwstar",(t,e)=>AR(t,[...e,"star"])).command("throwstarwith",(t,e)=>{const[n,r]=Dt(e,0,[ut.ANY]);return AR(t,[...e.slice(r),"star"],n)});var yP={};const ys=VW(Uke);var bP={},SP={},Mz;function jOe(){return Mz||(Mz=1,Object.defineProperty(SP,"__esModule",{value:!0})),SP}var EP={},aw={},xP={},wP={},cw={},Oz;function zOe(){if(Oz)return cw;Oz=1,Object.defineProperty(cw,"__esModule",{value:!0}),cw.dim=void 0;const t=e=>e;return cw.dim=t,cw}var Iz;function VOe(){return Iz||(Iz=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.toLine=void 0;const e=zOe(),n=i=>" "+(i.length?`{ ${i.toString().split(",").map(s=>Number(s).toString(16).toUpperCase().padStart(i.BYTES_PER_ELEMENT<<1,"0")).join(" ")} }`:"{}"),r=(i,s=" ")=>{switch(i){case null:return"!n";case void 0:return"!u";case!0:return"!t";case!1:return"!f"}switch(typeof i){case"number":case"bigint":{const o=typeof i=="number"&&Math.round(i)!==i?i+"":Intl.NumberFormat("en-US").format(i)+(typeof i=="bigint"?"n":"");return o[0]==="0"&&o[1]==="."?o.slice(1):o}case"string":return i?i.split(/([\u0000-\u001F]|\n|\t)/).filter(Boolean).map(a=>a===`
`?"":a==="	"?"":a.length===1&&a.charCodeAt(0)<32?"\\x"+a.charCodeAt(0).toString(16).padStart(2,"0"):(0,e.dim)('"')+JSON.stringify(a).slice(1,-1)+(0,e.dim)('"')).join(" "):'""';case"object":{if(Array.isArray(i))return i.length?`[${s}${i.map(a=>(0,t.toLine)(a,s)).join(","+s)}${s}]`:"[]";if(i instanceof DataView)return i.constructor.name+n(new Uint8Array(i.buffer,i.byteOffset,i.byteLength));if(ArrayBuffer.isView(i))return i.constructor.name+n(i);if(i instanceof ArrayBuffer)return"ArrayBuffer"+n(new Uint8Array(i));if(i instanceof Date)return"Date { "+i.getTime()+" }";if(i instanceof RegExp)return i+"";const o=Object.keys(i);return o.length?`{${s}${o.map(a=>`${a}${s}${(0,e.dim)("=")}${s}${(0,t.toLine)(i[a],s)}`).join(","+s)}${s}}`:"{}"}case"function":return`fn ${(0,t.toLine)(i.name)} ( ${i.length} args )`;case"symbol":return`sym ( ${i.description} )`}return"?"};t.toLine=r})(wP)),wP}var TP={},AP={},Nz;function HOe(){return Nz||(Nz=1,Object.defineProperty(AP,"__esModule",{value:!0})),AP}var CP={},RP={},Pz;function $Oe(){return Pz||(Pz=1,Object.defineProperty(RP,"__esModule",{value:!0})),RP}var kP={},Dz;function GOe(){return Dz||(Dz=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ServerClockVector=t.ClockVector=t.LogicalClock=t.interval=t.printTs=t.containsId=t.contains=t.compare=t.equal=t.tick=t.tss=t.ts=t.Timespan=t.Timestamp=void 0;class e{constructor(g,_){this.sid=g,this.time=_}}t.Timestamp=e;class n{constructor(g,_,y){this.sid=g,this.time=_,this.span=y}}t.Timespan=n;const r=(m,g)=>new e(m,g);t.ts=r;const i=(m,g,_)=>new n(m,g,_);t.tss=i;const s=(m,g)=>(0,t.ts)(m.sid,m.time+g);t.tick=s;const o=(m,g)=>m.time===g.time&&m.sid===g.sid;t.equal=o;const a=(m,g)=>{const _=m.time,y=g.time;if(_>y)return 1;if(_<y)return-1;const v=m.sid,E=g.sid;return v>E?1:v<E?-1:0};t.compare=a;const c=(m,g,_,y)=>{if(m.sid!==_.sid)return!1;const v=m.time,E=_.time;return!(v>E||v+g<E+y)};t.contains=c;const l=(m,g,_)=>{if(m.sid!==_.sid)return!1;const y=m.time,v=_.time;return!(y>v||y+g<v+1)};t.containsId=l;const u=m=>{if(m.sid===1)return"."+m.time;let g=""+m.sid;return g.length>4&&(g=".."+g.slice(g.length-4)),g+"."+m.time};t.printTs=u;const h=(m,g,_)=>new n(m.sid,m.time+g,_);t.interval=h;class f extends e{tick(g){const _=new e(this.sid,this.time);return this.time+=g,_}}t.LogicalClock=f;class d extends f{constructor(){super(...arguments),this.peers=new Map}observe(g,_){const y=g.time+_-1,v=g.sid;if(v!==this.sid){const E=this.peers.get(g.sid);E?y>E.time&&(E.time=y):this.peers.set(g.sid,(0,t.ts)(v,y))}y>=this.time&&(this.time=y+1)}clone(){return this.fork(this.sid)}fork(g){const _=new d(g,this.time);return g!==this.sid&&_.observe((0,t.tick)(this,-1),1),this.peers.forEach(y=>{_.observe(y,1)}),_}toString(g=""){const _=this.peers.size;let y=1,v="";return this.peers.forEach(E=>{v+=`
${g}${y===_?"":""} ${E.sid}.${E.time}`,y++}),`clock ${this.sid}.${this.time}${v}`}}t.ClockVector=d;class p extends f{constructor(){super(...arguments),this.peers=new Map}observe(g,_){if(g.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<g.time)throw new Error("TIME_TRAVEL");const y=g.time+_;y>this.time&&(this.time=y)}clone(){return this.fork()}fork(){return new p(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}t.ServerClockVector=p})(kP)),kP}var Lz;function Xo(){return Lz||(Lz=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar($Oe(),t),e.__exportStar(GOe(),t)})(CP)),CP}var Di={},lw={},Uz;function hf(){if(Uz)return lw;Uz=1,Object.defineProperty(lw,"__esModule",{value:!0}),lw.printTree=void 0;const t=(e="",n)=>{let r="",i=n.length-1;for(;i>=0&&!n[i];i--);for(let s=0;s<=i;s++){const o=n[s];if(!o)continue;const a=s===i,c=o(e+(a?" ":"")+"  "),l=c?a?"":"":"";r+=`
`+e+l+(c?" "+c:"")}return r};return lw.printTree=t,lw}var Bz;function yC(){if(Bz)return Di;Bz=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.NopOp=Di.DelOp=Di.UpdArrOp=Di.InsArrOp=Di.InsBinOp=Di.InsStrOp=Di.InsVecOp=Di.InsObjOp=Di.InsValOp=Di.NewArrOp=Di.NewBinOp=Di.NewStrOp=Di.NewVecOp=Di.NewObjOp=Di.NewValOp=Di.NewConOp=void 0;const t=hf(),e=Xo();class n{constructor(E){this.id=E}span(){return 1}toString(){let E=this.name()+" "+(0,e.printTs)(this.id);const x=this.span();return x>1&&(E+="!"+x),E}}class r extends n{constructor(E,x){super(E),this.id=E,this.val=x}name(){return"new_con"}toString(){const E=this.val,x="Uint8Array",A=E instanceof e.Timestamp?`{ ${(0,e.printTs)(E)} }`:E instanceof Uint8Array?E.length<13?`${x} { ${(""+E).replaceAll(",",", ")} }`:`${x}(${E.length})`:`{ ${JSON.stringify(E)} }`;return super.toString()+" "+A}}Di.NewConOp=r;class i extends n{name(){return"new_val"}}Di.NewValOp=i;class s extends n{name(){return"new_obj"}}Di.NewObjOp=s;class o extends n{name(){return"new_vec"}}Di.NewVecOp=o;class a extends n{name(){return"new_str"}}Di.NewStrOp=a;class c extends n{name(){return"new_bin"}}Di.NewBinOp=c;class l extends n{name(){return"new_arr"}}Di.NewArrOp=l;class u extends n{constructor(E,x,A){super(E),this.id=E,this.obj=x,this.val=A}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,e.printTs)(this.obj)}, val = ${(0,e.printTs)(this.val)}`}}Di.InsValOp=u;class h extends n{constructor(E,x,A){super(E),this.id=E,this.obj=x,this.data=A}name(){return"ins_obj"}toString(E=""){return super.toString()+`, obj = ${(0,e.printTs)(this.obj)}`+(0,t.printTree)(E,this.data.map(A=>T=>`${JSON.stringify(A[0])}: ${(0,e.printTs)(A[1])}`))}}Di.InsObjOp=h;class f extends n{constructor(E,x,A){super(E),this.id=E,this.obj=x,this.data=A}name(){return"ins_vec"}toString(E=""){return super.toString()+`, obj = ${(0,e.printTs)(this.obj)}`+(0,t.printTree)(E,this.data.map(A=>T=>`${A[0]}: ${(0,e.printTs)(A[1])}`))}}Di.InsVecOp=f;class d extends n{constructor(E,x,A,T){super(E),this.id=E,this.obj=x,this.ref=A,this.data=T}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,e.printTs)(this.obj)} { ${(0,e.printTs)(this.ref)}  ${JSON.stringify(this.data)} }`}}Di.InsStrOp=d;class p extends n{constructor(E,x,A,T){super(E),this.id=E,this.obj=x,this.ref=A,this.data=T}span(){return this.data.length}name(){return"ins_bin"}toString(){const E=(0,e.printTs)(this.ref);return super.toString()+`, obj = ${(0,e.printTs)(this.obj)} { ${E}  ${this.data} }`}}Di.InsBinOp=p;class m extends n{constructor(E,x,A,T){super(E),this.id=E,this.obj=x,this.ref=A,this.data=T}span(){return this.data.length}name(){return"ins_arr"}toString(){const E=(0,e.printTs)(this.obj),x=(0,e.printTs)(this.ref),A=this.data.map(e.printTs).join(", ");return super.toString()+", obj = "+E+" { "+x+"  "+A+" }"}}Di.InsArrOp=m;class g extends n{constructor(E,x,A,T){super(E),this.id=E,this.obj=x,this.ref=A,this.val=T}name(){return"upd_arr"}toString(){const E=(0,e.printTs)(this.obj),x=(0,e.printTs)(this.ref),A=(0,e.printTs)(this.val);return super.toString()+", obj = "+E+" { "+x+": "+A+" }"}}Di.UpdArrOp=g;class _ extends n{constructor(E,x,A){super(E),this.id=E,this.obj=x,this.what=A}name(){return"del"}toString(){const E=this.what.map(x=>(0,e.printTs)(x)+"!"+x.span).join(", ");return super.toString()+`, obj = ${(0,e.printTs)(this.obj)} { ${E} }`}}Di.DelOp=_;class y extends n{constructor(E,x){super(E),this.id=E,this.len=x}span(){return this.len}name(){return"nop"}}return Di.NopOp=y,Di}var uw={},MP={},hw={},fw={},dw={},pw={},Fz;function WOe(){if(Fz)return pw;Fz=1,Object.defineProperty(pw,"__esModule",{value:!0}),pw.Slice=void 0;let t=class{constructor(n,r,i,s){this.uint8=n,this.view=r,this.start=i,this.end=s}subarray(){return this.uint8.subarray(this.start,this.end)}};return pw.Slice=t,pw}var jz;function y8(){if(jz)return dw;jz=1,Object.defineProperty(dw,"__esModule",{value:!0}),dw.Writer=void 0;const t=WOe(),e=new Uint8Array([]),n=new DataView(e.buffer),r=typeof js=="function",i=r?js.prototype.utf8Write:null,s=r?js.from:null,o=typeof TextEncoder<"u"?new TextEncoder:null;let a=class{constructor(l=64*1024){this.allocSize=l,this.view=n,this.x0=0,this.x=0,this.uint8=new Uint8Array(l),this.size=l,this.view=new DataView(this.uint8.buffer)}grow(l){const u=this.x0,h=this.x,f=this.uint8,d=new Uint8Array(l),p=new DataView(d.buffer),m=f.subarray(u,h);d.set(m,0),this.x=h-u,this.x0=0,this.uint8=d,this.size=l,this.view=p}ensureCapacity(l){const u=this.size,h=u-this.x;if(h<l){const f=u-this.x0,d=l-h,p=f+d;this.grow(p<=this.allocSize?this.allocSize:p*2)}}move(l){this.ensureCapacity(l),this.x+=l}reset(){this.x0=this.x}newBuffer(l){const u=this.uint8=new Uint8Array(l);this.size=l,this.view=new DataView(u.buffer),this.x=this.x0=0}flush(){const l=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,l}flushSlice(){const l=new t.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,l}u8(l){this.ensureCapacity(1),this.uint8[this.x++]=l}u16(l){this.ensureCapacity(2),this.view.setUint16(this.x,l),this.x+=2}u32(l){this.ensureCapacity(4),this.view.setUint32(this.x,l),this.x+=4}i32(l){this.ensureCapacity(4),this.view.setInt32(this.x,l),this.x+=4}u64(l){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(l)),this.x+=8}f64(l){this.ensureCapacity(8),this.view.setFloat64(this.x,l),this.x+=8}u8u16(l,u){this.ensureCapacity(3);let h=this.x;this.uint8[h++]=l,this.uint8[h++]=u>>>8,this.uint8[h++]=u&255,this.x=h}u8u32(l,u){this.ensureCapacity(5);let h=this.x;this.uint8[h++]=l,this.view.setUint32(h,u),this.x=h+4}u8u64(l,u){this.ensureCapacity(9);let h=this.x;this.uint8[h++]=l,this.view.setBigUint64(h,BigInt(u)),this.x=h+8}u8f32(l,u){this.ensureCapacity(5);let h=this.x;this.uint8[h++]=l,this.view.setFloat32(h,u),this.x=h+4}u8f64(l,u){this.ensureCapacity(9);let h=this.x;this.uint8[h++]=l,this.view.setFloat64(h,u),this.x=h+8}buf(l,u){this.ensureCapacity(u);const h=this.x;this.uint8.set(l,h),this.x=h+u}utf8(l){const u=l.length*4;if(u<168)return this.utf8Native(l);this.ensureCapacity(u);const h=this.size-this.x;if(i){const f=i.call(this.uint8,l,this.x,h);return this.x+=f,f}else if(s){const f=this.uint8,d=f.byteOffset+this.x,m=s(f.buffer).subarray(d,d+h).write(l,0,h,"utf8");return this.x+=m,m}else if(u>1024&&o){const f=o.encodeInto(l,this.uint8.subarray(this.x,this.x+h)).written;return this.x+=f,f}return this.utf8Native(l)}utf8Native(l){const u=l.length,h=this.uint8;let f=this.x,d=0;for(;d<u;){let m=l.charCodeAt(d++);if((m&4294967168)===0){h[f++]=m;continue}else if((m&4294965248)===0)h[f++]=m>>6&31|192;else{if(m>=55296&&m<=56319&&d<u){const g=l.charCodeAt(d);(g&64512)===56320&&(d++,m=((m&1023)<<10)+(g&1023)+65536)}(m&4294901760)===0?(h[f++]=m>>12&15|224,h[f++]=m>>6&63|128):(h[f++]=m>>18&7|240,h[f++]=m>>12&63|128,h[f++]=m>>6&63|128)}h[f++]=m&63|128}const p=f-this.x;return this.x=f,p}ascii(l){const u=l.length;this.ensureCapacity(u);const h=this.uint8;let f=this.x,d=0;for(;d<u;)h[f++]=l.charCodeAt(d++);this.x=f}};return dw.Writer=a,dw}var zz;function b8(){if(zz)return fw;zz=1,Object.defineProperty(fw,"__esModule",{value:!0}),fw.CrdtWriter=void 0;const t=y8();let e=class extends t.Writer{id(r,i){r<=7&&i<=15?this.u8(r<<4|i):(this.b1vu56(1,r),this.vu57(i))}vu57(r){if(r<=127)this.u8(r);else if(r<=16383){this.ensureCapacity(2);const i=this.uint8;i[this.x++]=128|r&127,i[this.x++]=r>>>7}else if(r<=2097151){this.ensureCapacity(3);const i=this.uint8;i[this.x++]=128|r&127,i[this.x++]=128|r>>>7&127,i[this.x++]=r>>>14}else if(r<=268435455){this.ensureCapacity(4);const i=this.uint8;i[this.x++]=128|r&127,i[this.x++]=128|r>>>7&127,i[this.x++]=128|r>>>14&127,i[this.x++]=r>>>21}else{let i=r|0;i<0&&(i+=4294967296);const s=(r-i)/4294967296;if(r<=34359738367){this.ensureCapacity(5);const o=this.uint8;o[this.x++]=128|r&127,o[this.x++]=128|r>>>7&127,o[this.x++]=128|r>>>14&127,o[this.x++]=128|r>>>21&127,o[this.x++]=s<<4|r>>>28}else if(r<=4398046511103){this.ensureCapacity(6);const o=this.uint8;o[this.x++]=128|r&127,o[this.x++]=128|r>>>7&127,o[this.x++]=128|r>>>14&127,o[this.x++]=128|r>>>21&127,o[this.x++]=128|(s&7)<<4|r>>>28,o[this.x++]=s>>>3}else if(r<=562949953421311){this.ensureCapacity(7);const o=this.uint8;o[this.x++]=128|r&127,o[this.x++]=128|r>>>7&127,o[this.x++]=128|r>>>14&127,o[this.x++]=128|r>>>21&127,o[this.x++]=128|(s&7)<<4|r>>>28,o[this.x++]=128|(s&1016)>>>3,o[this.x++]=s>>>10}else{this.ensureCapacity(8);const o=this.uint8;o[this.x++]=128|r&127,o[this.x++]=128|r>>>7&127,o[this.x++]=128|r>>>14&127,o[this.x++]=128|r>>>21&127,o[this.x++]=128|(s&7)<<4|r>>>28,o[this.x++]=128|(s&1016)>>>3,o[this.x++]=128|(s&130048)>>>10,o[this.x++]=s>>>17}}}b1vu56(r,i){if(i<=63)this.u8(r<<7|i);else{const s=r<<7|64;if(i<=8191){this.ensureCapacity(2);const o=this.uint8;o[this.x++]=s|i&63,o[this.x++]=i>>>6}else if(i<=1048575){this.ensureCapacity(3);const o=this.uint8;o[this.x++]=s|i&63,o[this.x++]=128|i>>>6&127,o[this.x++]=i>>>13}else if(i<=134217727){this.ensureCapacity(4);const o=this.uint8;o[this.x++]=s|i&63,o[this.x++]=128|i>>>6&127,o[this.x++]=128|i>>>13&127,o[this.x++]=i>>>20}else{let o=i|0;o<0&&(o+=4294967296);const a=(i-o)/4294967296;if(i<=17179869183){this.ensureCapacity(5);const c=this.uint8;c[this.x++]=s|i&63,c[this.x++]=128|i>>>6&127,c[this.x++]=128|i>>>13&127,c[this.x++]=128|i>>>20&127,c[this.x++]=a<<5|i>>>27}else if(i<=2199023255551){this.ensureCapacity(6);const c=this.uint8;c[this.x++]=s|i&63,c[this.x++]=128|i>>>6&127,c[this.x++]=128|i>>>13&127,c[this.x++]=128|i>>>20&127,c[this.x++]=128|(a&3)<<5|i>>>27,c[this.x++]=a>>>2}else if(i<=0xffffffffffff){this.ensureCapacity(7);const c=this.uint8;c[this.x++]=s|i&63,c[this.x++]=128|i>>>6&127,c[this.x++]=128|i>>>13&127,c[this.x++]=128|i>>>20&127,c[this.x++]=128|(a&3)<<5|i>>>27,c[this.x++]=128|(a&508)>>>2,c[this.x++]=a>>>9}else{this.ensureCapacity(8);const c=this.uint8;c[this.x++]=s|i&63,c[this.x++]=128|i>>>6&127,c[this.x++]=128|i>>>13&127,c[this.x++]=128|i>>>20&127,c[this.x++]=128|(a&3)<<5|i>>>27,c[this.x++]=128|(a&508)>>>2,c[this.x++]=128|(a&65024)>>>9,c[this.x++]=a>>>16}}}}};return fw.CrdtWriter=e,fw}var mw={},gw={},Vz;function qOe(){if(Vz)return gw;Vz=1,Object.defineProperty(gw,"__esModule",{value:!0}),gw.isFloat32=void 0;const t=new DataView(new ArrayBuffer(4)),e=n=>(t.setFloat32(0,n),n===t.getFloat32(0));return gw.isFloat32=e,gw}var _w={},Hz;function S8(){if(Hz)return _w;Hz=1,Object.defineProperty(_w,"__esModule",{value:!0}),_w.JsonPackExtension=void 0;let t=class{constructor(n,r){this.tag=n,this.val=r}};return _w.JsonPackExtension=t,_w}var vw={},$z;function YOe(){if($z)return vw;$z=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.CborEncoderFast=void 0;const t=y8(),e=Number.isSafeInteger;let n=class{constructor(i=new t.Writer){this.writer=i}encode(i){return this.writeAny(i),this.writer.flush()}writeAny(i){switch(typeof i){case"number":return this.writeNumber(i);case"string":return this.writeStr(i);case"boolean":return this.writer.u8(244+ +i);case"object":return i?i.constructor===Array?this.writeArr(i):this.writeObj(i):this.writer.u8(246)}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(i){i?this.writer.u8(245):this.writer.u8(244)}writeNumber(i){e(i)?this.writeInteger(i):typeof i=="bigint"?this.writeBigInt(i):this.writeFloat(i)}writeBigInt(i){i>=0?this.writeBigUint(i):this.writeBigSint(i)}writeBigUint(i){if(i<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(i));this.writer.u8u64(27,i)}writeBigSint(i){if(i>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(i));const s=-BigInt(1)-i;this.writer.u8u64(59,s)}writeInteger(i){i>=0?this.writeUInteger(i):this.encodeNint(i)}writeUInteger(i){const s=this.writer;s.ensureCapacity(9);const o=s.uint8;let a=s.x;i<=23?o[a++]=0+i:i<=255?(o[a++]=24,o[a++]=i):i<=65535?(o[a++]=25,s.view.setUint16(a,i),a+=2):i<=4294967295?(o[a++]=26,s.view.setUint32(a,i),a+=4):(o[a++]=27,s.view.setBigUint64(a,BigInt(i)),a+=8),s.x=a}encodeNumber(i){this.writeNumber(i)}encodeInteger(i){this.writeInteger(i)}encodeUint(i){this.writeUInteger(i)}encodeNint(i){const s=-1-i,o=this.writer;o.ensureCapacity(9);const a=o.uint8;let c=o.x;s<24?a[c++]=32+s:s<=255?(a[c++]=56,a[c++]=s):s<=65535?(a[c++]=57,o.view.setUint16(c,s),c+=2):s<=4294967295?(a[c++]=58,o.view.setUint32(c,s),c+=4):(a[c++]=59,o.view.setBigUint64(c,BigInt(s)),c+=8),o.x=c}writeFloat(i){this.writer.u8f64(251,i)}writeBin(i){const s=i.length;this.writeBinHdr(s),this.writer.buf(i,s)}writeBinHdr(i){const s=this.writer;i<=23?s.u8(64+i):i<=255?s.u16(22528+i):i<=65535?s.u8u16(89,i):i<=4294967295?s.u8u32(90,i):s.u8u64(91,i)}writeStr(i){const s=this.writer,a=i.length*4;s.ensureCapacity(5+a);const c=s.uint8;let l=s.x;a<=23?s.x++:a<=255?(c[s.x++]=120,l=s.x,s.x++):a<=65535?(c[s.x++]=121,l=s.x,s.x+=2):(c[s.x++]=122,l=s.x,s.x+=4);const u=s.utf8(i);a<=23?c[l]=96+u:a<=255?c[l]=u:a<=65535?s.view.setUint16(l,u):s.view.setUint32(l,u)}writeStrHdr(i){const s=this.writer;i<=23?s.u8(96+i):i<=255?s.u16(30720+i):i<=65535?s.u8u16(121,i):s.u8u32(122,i)}writeAsciiStr(i){this.writeStrHdr(i.length),this.writer.ascii(i)}writeArr(i){const s=i.length;this.writeArrHdr(s);for(let o=0;o<s;o++)this.writeAny(i[o])}writeArrHdr(i){const s=this.writer;i<=23?s.u8(128+i):i<=255?s.u16(38912+i):i<=65535?s.u8u16(153,i):i<=4294967295?s.u8u32(154,i):s.u8u64(155,i)}writeObj(i){const s=Object.keys(i),o=s.length;this.writeObjHdr(o);for(let a=0;a<o;a++){const c=s[a];this.writeStr(c),this.writeAny(i[c])}}writeObjHdr(i){const s=this.writer;i<=23?s.u8(160+i):i<=255?s.u16(47104+i):i<=65535?s.u8u16(185,i):i<=4294967295?s.u8u32(186,i):s.u8u64(187,i)}writeMapHdr(i){this.writeObjHdr(i)}writeStartMap(){this.writer.u8(191)}writeTag(i,s){this.writeTagHdr(i),this.writeAny(s)}writeTagHdr(i){const s=this.writer;i<=23?s.u8(192+i):i<=255?s.u16(55296+i):i<=65535?s.u8u16(217,i):i<=4294967295?s.u8u32(218,i):s.u8u64(219,i)}writeTkn(i){const s=this.writer;i<=23?s.u8(224+i):i<=255&&s.u16(63488+i)}writeStartStr(){this.writer.u8(127)}writeStrChunk(i){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(i){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(i){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(i,s){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return vw.CborEncoderFast=n,vw}var yw={},Gz;function E8(){if(Gz)return yw;Gz=1,Object.defineProperty(yw,"__esModule",{value:!0}),yw.JsonPackValue=void 0;let t=class{constructor(n){this.val=n}};return yw.JsonPackValue=t,yw}var Wz;function Yee(){if(Wz)return mw;Wz=1,Object.defineProperty(mw,"__esModule",{value:!0}),mw.CborEncoder=void 0;const t=qOe(),e=S8(),n=YOe(),r=E8();let i=class extends n.CborEncoderFast{writeUnknown(o){this.writeNull()}writeAny(o){switch(typeof o){case"number":return this.writeNumber(o);case"string":return this.writeStr(o);case"boolean":return this.writer.u8(244+ +o);case"object":{if(!o)return this.writer.u8(246);switch(o.constructor){case Object:return this.writeObj(o);case Array:return this.writeArr(o);case Uint8Array:return this.writeBin(o);case Map:return this.writeMap(o);case e.JsonPackExtension:return this.writeTag(o.tag,o.val);case r.JsonPackValue:{const c=o.val;return this.writer.buf(c,c.length)}default:return o instanceof Uint8Array?this.writeBin(o):Array.isArray(o)?this.writeArr(o):o instanceof Map?this.writeMap(o):this.writeUnknown(o)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(o);default:return this.writeUnknown(o)}}writeFloat(o){(0,t.isFloat32)(o)?this.writer.u8f32(250,o):this.writer.u8f64(251,o)}writeMap(o){this.writeMapHdr(o.size),o.forEach((a,c)=>{this.writeAny(c),this.writeAny(a)})}writeUndef(){this.writer.u8(247)}};return mw.CborEncoder=i,mw}var qz;function Kee(){if(qz)return hw;qz=1,Object.defineProperty(hw,"__esModule",{value:!0}),hw.Encoder=void 0;const e=ys.__importStar(yC()),n=b8(),r=Xo(),i=Yee();class s extends i.CborEncoder{constructor(a=new n.CrdtWriter){super(a),this.writer=a,this.patchSid=0}encode(a){this.writer.reset();const c=a.getId(),l=this.patchSid=c.sid,u=this.writer;u.vu57(l),u.vu57(c.time);const h=a.meta;return h===void 0?this.writeUndef():this.writeArr([h]),this.encodeOperations(a),u.flush()}encodeOperations(a){const c=a.ops,l=c.length;this.writer.vu57(l);for(let u=0;u<l;u++)this.encodeOperation(c[u])}encodeId(a){const c=a.sid,l=a.time,u=this.writer;c===this.patchSid?u.b1vu56(0,l):(u.b1vu56(1,l),u.vu57(c))}encodeTss(a){this.encodeId(a),this.writer.vu57(a.span)}writeInsStr(a,c,l,u){const h=this.writer;return a<=7?h.u8(96+a):(h.u8(96),h.vu57(a)),this.encodeId(c),this.encodeId(l),h.utf8(u)}encodeOperation(a){const c=this.writer;switch(a.constructor){case e.NewConOp:{const h=a.val;h instanceof r.Timestamp?(c.u8(1),this.encodeId(h)):(c.u8(0),this.writeAny(h));break}case e.NewValOp:{c.u8(8);break}case e.NewObjOp:{c.u8(16);break}case e.NewVecOp:{c.u8(24);break}case e.NewStrOp:{c.u8(32);break}case e.NewBinOp:{c.u8(40);break}case e.NewArrOp:{c.u8(48);break}case e.InsValOp:{const u=a;c.u8(72),this.encodeId(u.obj),this.encodeId(u.val);break}case e.InsObjOp:{const u=a,h=u.data,f=h.length;f<=7?c.u8(80+f):(c.u8(80),c.vu57(f)),this.encodeId(u.obj);for(let d=0;d<f;d++){const p=h[d];this.writeStr(p[0]),this.encodeId(p[1])}break}case e.InsVecOp:{const u=a,h=u.data,f=h.length;f<=7?c.u8(88+f):(c.u8(88),c.vu57(f)),this.encodeId(u.obj);for(let d=0;d<f;d++){const p=h[d];c.u8(p[0]),this.encodeId(p[1])}break}case e.InsStrOp:{const u=a,h=u.obj,f=u.ref,d=u.data,p=d.length;c.ensureCapacity(24+p*4);const m=c.x,g=this.writeInsStr(p,h,f,d);p!==g&&(c.x=m,this.writeInsStr(g,h,f,d));break}case e.InsBinOp:{const u=a,h=u.data,f=h.length;f<=7?c.u8(104+f):(c.u8(104),c.vu57(f)),this.encodeId(u.obj),this.encodeId(u.ref),c.buf(h,f);break}case e.InsArrOp:{const u=a,h=u.data,f=h.length;f<=7?c.u8(112+f):(c.u8(112),c.vu57(f)),this.encodeId(u.obj),this.encodeId(u.ref);for(let d=0;d<f;d++)this.encodeId(h[d]);break}case e.UpdArrOp:{const u=a;c.u8(120),this.encodeId(u.obj),this.encodeId(u.ref),this.encodeId(u.val);break}case e.DelOp:{const u=a,h=u.what,f=h.length;f<=7?c.u8(128+f):(c.u8(128),c.vu57(f)),this.encodeId(u.obj);for(let d=0;d<f;d++)this.encodeTss(h[d]);break}case e.NopOp:{const h=a.len;h<=7?c.u8(136+h):(c.u8(136),c.vu57(h));break}default:throw new Error("UNKNOWN_OP")}}}return hw.Encoder=s,hw}var bw={},Sw={},Ew={},xw={},RR={},ky={},Yz;function KOe(){if(Yz)return ky;Yz=1,Object.defineProperty(ky,"__esModule",{value:!0}),ky.decodeAsciiMax15=ky.decodeAscii=void 0;const t=String.fromCharCode,e=(r,i,s)=>{const o=[];for(let a=0;a<s;a++){const c=r[i++];if(c&128)return;o.push(c)}return t.apply(String,o)};ky.decodeAscii=e;const n=(r,i,s)=>{if(s<4)if(s<2){if(s===0)return"";{const o=r[i++];if((o&128)>1){i-=1;return}return t(o)}}else{const o=r[i++],a=r[i++];if((o&128)>0||(a&128)>0){i-=2;return}if(s<3)return t(o,a);const c=r[i++];if((c&128)>0){i-=3;return}return t(o,a,c)}else{const o=r[i++],a=r[i++],c=r[i++],l=r[i++];if((o&128)>0||(a&128)>0||(c&128)>0||(l&128)>0){i-=4;return}if(s<6){if(s===4)return t(o,a,c,l);{const u=r[i++];if((u&128)>0){i-=5;return}return t(o,a,c,l,u)}}else if(s<8){const u=r[i++],h=r[i++];if((u&128)>0||(h&128)>0){i-=6;return}if(s<7)return t(o,a,c,l,u,h);const f=r[i++];if((f&128)>0){i-=7;return}return t(o,a,c,l,u,h,f)}else{const u=r[i++],h=r[i++],f=r[i++],d=r[i++];if((u&128)>0||(h&128)>0||(f&128)>0||(d&128)>0){i-=8;return}if(s<10){if(s===8)return t(o,a,c,l,u,h,f,d);{const p=r[i++];if((p&128)>0){i-=9;return}return t(o,a,c,l,u,h,f,d,p)}}else if(s<12){const p=r[i++],m=r[i++];if((p&128)>0||(m&128)>0){i-=10;return}if(s<11)return t(o,a,c,l,u,h,f,d,p,m);const g=r[i++];if((g&128)>0){i-=11;return}return t(o,a,c,l,u,h,f,d,p,m,g)}else{const p=r[i++],m=r[i++],g=r[i++],_=r[i++];if((p&128)>0||(m&128)>0||(g&128)>0||(_&128)>0){i-=12;return}if(s<14){if(s===12)return t(o,a,c,l,u,h,f,d,p,m,g,_);{const y=r[i++];if((y&128)>0){i-=13;return}return t(o,a,c,l,u,h,f,d,p,m,g,_,y)}}else{const y=r[i++],v=r[i++];if((y&128)>0||(v&128)>0){i-=14;return}if(s<15)return t(o,a,c,l,u,h,f,d,p,m,g,_,y,v);const E=r[i++];if((E&128)>0){i-=15;return}return t(o,a,c,l,u,h,f,d,p,m,g,_,y,v,E)}}}}};return ky.decodeAsciiMax15=n,ky}var kR={},Kz;function XOe(){if(Kz)return kR;Kz=1,Object.defineProperty(kR,"__esModule",{value:!0});const t=String.fromCharCode;return kR.default=(e,n,r)=>{let i=n;const s=i+r,o=[];for(;i<s;){let a=e[i++];if((a&128)!==0){const c=e[i++]&63;if((a&224)===192)a=(a&31)<<6|c;else{const l=e[i++]&63;if((a&240)===224)a=(a&31)<<12|c<<6|l;else if((a&248)===240){const u=e[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;if(h>65535){h-=65536;const f=h>>>10&1023|55296;a=56320|h&1023,o.push(f)}else a=h}}}o.push(a)}return t.apply(String,o)},kR}var Xz;function JOe(){if(Xz)return RR;Xz=1,Object.defineProperty(RR,"__esModule",{value:!0});const t=ys,e=KOe(),n=t.__importDefault(XOe()),r=typeof js<"u",i=r?js.prototype.utf8Slice:null,s=r?js.from:null,o=(u,h,f)=>(0,e.decodeAsciiMax15)(u,h,f)??(0,n.default)(u,h,f),a=(u,h,f)=>(0,e.decodeAscii)(u,h,f)??(0,n.default)(u,h,f),c=i?(u,h,f)=>i.call(u,h,h+f):s?(u,h,f)=>s(u).subarray(h,h+f).toString("utf8"):n.default,l=(u,h,f)=>f<16?o(u,h,f):f<32?a(u,h,f):c(u,h,f);return RR.default=l,RR}var Jz;function ZOe(){if(Jz)return xw;Jz=1,Object.defineProperty(xw,"__esModule",{value:!0}),xw.decodeUtf8=void 0;const e=ys.__importDefault(JOe());return xw.decodeUtf8=e.default,xw}var Zz;function x8(){if(Zz)return Ew;Zz=1,Object.defineProperty(Ew,"__esModule",{value:!0}),Ew.Reader=void 0;const t=ZOe();let e=class Xee{constructor(r=new Uint8Array([]),i=new DataView(r.buffer,r.byteOffset,r.length),s=0,o=r.length){this.uint8=r,this.view=i,this.x=s,this.end=o}reset(r){this.x=0,this.uint8=r,this.view=new DataView(r.buffer,r.byteOffset,r.length)}size(){return this.end-this.x}peek(){return this.view.getUint8(this.x)}peak(){return this.peek()}skip(r){this.x+=r}buf(r=this.size()){const i=this.x,s=i+r,o=this.uint8.subarray(i,s);return this.x=s,o}subarray(r=0,i){const s=this.x,o=s+r,a=typeof i=="number"?s+i:this.end;return this.uint8.subarray(o,a)}slice(r=0,i){const s=this.x,o=s+r,a=typeof i=="number"?s+i:this.end;return new Xee(this.uint8,this.view,o,a)}cut(r=this.size()){const i=this.slice(0,r);return this.skip(r),i}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let r=this.x;const i=(this.uint8[r++]<<8)+this.uint8[r++];return this.x=r,i}i16(){const r=this.view.getInt16(this.x);return this.x+=2,r}u32(){const r=this.view.getUint32(this.x);return this.x+=4,r}i32(){const r=this.view.getInt32(this.x);return this.x+=4,r}u64(){const r=this.view.getBigUint64(this.x);return this.x+=8,r}i64(){const r=this.view.getBigInt64(this.x);return this.x+=8,r}f32(){const r=this.x;return this.x+=4,this.view.getFloat32(r)}f64(){const r=this.x;return this.x+=8,this.view.getFloat64(r)}utf8(r){const i=this.x;return this.x+=r,(0,t.decodeUtf8)(this.uint8,i,r)}ascii(r){const i=this.uint8;let s="";const o=this.x+r;for(let a=this.x;a<o;a++)s+=String.fromCharCode(i[a]);return this.x=o,s}};return Ew.Reader=e,Ew}var Qz;function Jee(){if(Qz)return Sw;Qz=1,Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.CrdtReader=void 0;const t=x8();let e=class extends t.Reader{id(){const r=this.u8();return r<=127?[r>>>4,r&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const r=this.u8();if(r<=127)return r;const i=this.u8();if(i<=127)return i<<7|r&127;const s=this.u8();if(s<=127)return s<<14|(i&127)<<7|r&127;const o=this.u8();if(o<=127)return o<<21|(s&127)<<14|(i&127)<<7|r&127;const a=this.u8();if(a<=127)return a*268435456+((o&127)<<21|(s&127)<<14|(i&127)<<7|r&127);const c=this.u8();if(c<=127)return c*34359738368+((a&127)*268435456+((o&127)<<21|(s&127)<<14|(i&127)<<7|r&127));const l=this.u8();return l<=127?l*4398046511104+((c&127)*34359738368+((a&127)*268435456+((o&127)<<21|(s&127)<<14|(i&127)<<7|r&127))):this.u8()*562949953421312+((l&127)*4398046511104+((c&127)*34359738368+((a&127)*268435456+((o&127)<<21|(s&127)<<14|(i&127)<<7|r&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const r=this.u8(),i=r&128?1:0,s=127&r;if(s<=63)return[i,s];const o=this.u8();if(o<=127)return[i,o<<6|s&63];const a=this.u8();if(a<=127)return[i,a<<13|(o&127)<<6|s&63];const c=this.u8();if(c<=127)return[i,c<<20|(a&127)<<13|(o&127)<<6|s&63];const l=this.u8();if(l<=127)return[i,l*134217728+((c&127)<<20|(a&127)<<13|(o&127)<<6|s&63)];const u=this.u8();if(u<=127)return[i,u*17179869184+((l&127)*134217728+((c&127)<<20|(a&127)<<13|(o&127)<<6|s&63))];const h=this.u8();if(h<=127)return[i,h*2199023255552+((u&127)*17179869184+((l&127)*134217728+((c&127)<<20|(a&127)<<13|(o&127)<<6|s&63)))];const f=this.u8();return[i,f*281474976710656+((h&127)*2199023255552+((u&127)*17179869184+((l&127)*134217728+((c&127)<<20|(a&127)<<13|(o&127)<<6|s&63))))]}};return Sw.CrdtReader=e,Sw}var ww={},Tw={},eV;function xI(){return eV||(eV=1,Object.defineProperty(Tw,"__esModule",{value:!0}),Tw.isUint8Array=void 0,Tw.isUint8Array=typeof js=="function"?t=>t instanceof Uint8Array||js.isBuffer(t):t=>t instanceof Uint8Array),Tw}var OP={},IP={},tV;function QOe(){return tV||(tV=1,Object.defineProperty(IP,"__esModule",{value:!0})),IP}var nV;function wI(){return nV||(nV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ORIGIN=void 0;const e=ys,n=Xo();e.__exportStar(QOe(),t),t.ORIGIN=(0,n.ts)(0,0)})(OP)),OP}var NP={},PP={},Aw={},rV;function TI(){if(rV)return Aw;rV=1,Object.defineProperty(Aw,"__esModule",{value:!0}),Aw.printBinary=void 0;const t=(e="",n)=>{const r=n[0],i=n[1];let s="";return r&&(s+=`
`+e+" "+r(e+"  ")),i&&(s+=`
`+e+" "+i(e+"  ")),s};return Aw.printBinary=t,Aw}var Cw={},iV;function eIe(){if(iV)return Cw;iV=1,Object.defineProperty(Cw,"__esModule",{value:!0}),Cw.printJson=void 0;const t=(e="",n,r=2)=>(JSON.stringify(n,null,r)||"nil").split(`
`).join(`
`+e);return Cw.printJson=t,Cw}var sV;function tIe(){return sV||(sV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(hf(),t),e.__exportStar(TI(),t),e.__exportStar(eIe(),t)})(PP)),PP}var oV;function w8(){return oV||(oV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.s=t.schema=t.nodes=t.SchemaNode=t.NodeBuilder=void 0;const e=ys,n=xI(),r=Xo(),i=e.__importStar(rte()),s=tIe(),o=u=>{switch(typeof u){case"number":case"boolean":case"undefined":return!0;case"object":return u===null||u instanceof r.Timestamp;default:return!1}};class a{constructor(h){this._build=h}build(h){return this._build?.(h)??h.con(void 0)}}t.NodeBuilder=a;class c extends a{toString(h){return this.type}}t.SchemaNode=c;var l;(function(u){class h extends c{constructor(E){super(),this.raw=E,this.type="con"}build(E){return E.con(this.raw)}toString(E){return this.type+" "+i.con(this.raw)}}u.con=h;class f extends c{constructor(E){super(),this.raw=E,this.type="str"}build(E){return E.json(this.raw)}toString(E){return this.type+" "+i.con(this.raw)}}u.str=f;class d extends c{constructor(E){super(),this.raw=E,this.type="bin"}build(E){return E.json(this.raw)}toString(E){return this.type+" "+i.bin(this.raw)}}u.bin=d;class p extends c{constructor(E){super(),this.value=E,this.type="val"}build(E){const x=E.val(),A=this.value.build(E);return E.setVal(x,A),x}toString(E){return this.type+(0,s.printTree)(E,[x=>this.value.toString(x)])}}u.val=p;class m extends c{constructor(E){super(),this.value=E,this.type="vec"}build(E){const x=E.vec(),A=this.value,T=A.length;if(T){const k=[];for(let L=0;L<T;L++){const I=A[L];if(!I)continue;const F=I.build(E);k.push([L,F])}E.insVec(x,k)}return x}toString(E){return this.type+(0,s.printTree)(E,[...this.value.map((x,A)=>T=>`${A}: ${x?x.toString(T):i.line(x)}`)])}}u.vec=m;class g extends c{constructor(E,x){super(),this.obj=E,this.opt=x,this.type="obj"}optional(){return this}build(E){const x=E.obj(),A=[],T={...this.obj,...this.opt},k=Object.keys(T),L=k.length;if(L){for(let I=0;I<L;I++){const F=k[I],M=T[F].build(E);A.push([F,M])}E.insObj(x,A)}return x}toString(E=""){return this.type+(0,s.printTree)(E,[...[...Object.entries(this.obj)].map(([x,A])=>T=>i.line(x)+(0,s.printTree)(T+" ",[k=>A.toString(k)])),...[...Object.entries(this.opt??[])].map(([x,A])=>T=>i.line(x)+"?"+(0,s.printTree)(T+" ",[k=>A.toString(k)]))])}}u.obj=g;class _ extends c{constructor(E){super(),this.arr=E,this.type="arr"}build(E){const x=E.arr(),A=this.arr,T=A.length;if(T){const k=[];for(let L=0;L<T;L++)k.push(A[L].build(E));E.insArr(x,x,k)}return x}toString(E){return this.type+(0,s.printTree)(E,[...this.arr.map((x,A)=>T=>`[${A}]: ${x?x.toString(T):i.line(x)}`)])}}u.arr=_;class y extends c{constructor(E,x){super(),this.id=E,this.data=x,this.type="ext"}build(E){const x=new Uint8Array([this.id,0,0]),A=E.vec();return x[1]=A.sid%256,x[2]=A.time%256,E.insVec(A,[[0,E.constOrJson(t.s.con(x))],[1,this.data.build(E)]]),A}toString(E){return this.type+"("+this.id+")"+(0,s.printTree)(E,[x=>this.data.toString(x)])}}u.ext=y})(l||(t.nodes=l={})),t.schema={con:u=>new l.con(u),str:u=>new l.str(u||""),bin:u=>new l.bin(u),val:u=>new l.val(u),vec:(...u)=>new l.vec(u),obj:(u,h)=>new l.obj(u,h),map:u=>t.schema.obj(u),arr:u=>new l.arr(u),json:u=>{switch(typeof u){case"object":{if(!u)return t.s.val(t.s.con(u));if(u instanceof a)return u;if(Array.isArray(u))return t.s.arr(u.map(h=>t.s.json(h)));if((0,n.isUint8Array)(u))return t.s.bin(u);if(u instanceof r.Timestamp)return t.s.val(t.s.con(u));{const h={},f=Object.keys(u);for(const d of f)h[d]=t.s.jsonCon(u[d]);return t.s.obj(h)}}case"string":return t.s.str(u);default:return t.s.val(t.s.con(u))}},jsonCon:u=>o(u)?t.s.con(u):t.s.json(u),ext:(u,h)=>new l.ext(u,h)},t.s=t.schema})(NP)),NP}var aV;function T8(){if(aV)return ww;aV=1,Object.defineProperty(ww,"__esModule",{value:!0}),ww.PatchBuilder=void 0;const e=ys.__importStar(yC()),n=Xo(),r=xI(),i=nte(),s=wI(),o=w8(),a=l=>{switch(typeof l){case"number":case"boolean":return!0;default:return l===null}};let c=class{constructor(u){this.clock=u,this.patch=new i.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const u=this.patch;return this.patch=new i.Patch,u}obj(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new e.NewObjOp(u)),u}arr(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new e.NewArrOp(u)),u}vec(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new e.NewVecOp(u)),u}str(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new e.NewStrOp(u)),u}bin(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new e.NewBinOp(u)),u}con(u){this.pad();const h=this.clock.tick(1);return this.patch.ops.push(new e.NewConOp(h,u)),h}val(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new e.NewValOp(u)),u}root(u){return this.setVal(s.ORIGIN,u)}insObj(u,h){if(!h.length)throw new Error("EMPTY_TUPLES");this.pad();const f=this.clock.tick(1),d=new e.InsObjOp(f,u,h),p=d.span();return p>1&&this.clock.tick(p-1),this.patch.ops.push(d),f}insVec(u,h){if(!h.length)throw new Error("EMPTY_TUPLES");this.pad();const f=this.clock.tick(1),d=new e.InsVecOp(f,u,h),p=d.span();return p>1&&this.clock.tick(p-1),this.patch.ops.push(d),f}setVal(u,h){this.pad();const f=this.clock.tick(1),d=new e.InsValOp(f,u,h);return this.patch.ops.push(d),f}insStr(u,h,f){if(!f.length)throw new Error("EMPTY_STRING");this.pad();const d=this.clock.tick(1),p=new e.InsStrOp(d,u,h,f),m=p.span();return m>1&&this.clock.tick(m-1),this.patch.ops.push(p),d}insBin(u,h,f){if(!f.length)throw new Error("EMPTY_BINARY");this.pad();const d=this.clock.tick(1),p=new e.InsBinOp(d,u,h,f),m=p.span();return m>1&&this.clock.tick(m-1),this.patch.ops.push(p),d}insArr(u,h,f){this.pad();const d=this.clock.tick(1),p=new e.InsArrOp(d,u,h,f),m=p.span();return m>1&&this.clock.tick(m-1),this.patch.ops.push(p),d}updArr(u,h,f){this.pad();const d=this.clock.tick(1),p=new e.UpdArrOp(d,u,h,f);return this.patch.ops.push(p),d}del(u,h){this.pad();const f=this.clock.tick(1);return this.patch.ops.push(new e.DelOp(f,u,h)),f}nop(u){this.pad();const h=this.clock.tick(u);return this.patch.ops.push(new e.NopOp(h,u)),h}jsonObj(u){const h=this.obj(),f=Object.keys(u);if(f.length){const d=[];for(const p of f){const m=u[p],g=m instanceof n.Timestamp?m:a(m)?this.con(m):this.json(m);d.push([p,g])}this.insObj(h,d)}return h}jsonArr(u){const h=this.arr();if(u.length){const f=[];for(const d of u)f.push(this.json(d));this.insArr(h,h,f)}return h}jsonStr(u){const h=this.str();return u&&this.insStr(h,h,u),h}jsonBin(u){const h=this.bin();return u.length&&this.insBin(h,h,u),h}jsonVal(u){const h=this.val(),f=this.con(u);return this.setVal(h,f),h}json(u){if(u instanceof n.Timestamp)return u;if(u===void 0)return this.con(u);if(u instanceof Array)return this.jsonArr(u);if((0,r.isUint8Array)(u))return this.jsonBin(u);if(u instanceof o.NodeBuilder)return u.build(this);switch(typeof u){case"object":return u===null?this.jsonVal(u):this.jsonObj(u);case"string":return this.jsonStr(u);case"number":case"boolean":return this.jsonVal(u)}throw new Error("INVALID_JSON")}constOrJson(u){return u instanceof n.Timestamp?u:a(u)?this.con(u):this.json(u)}maybeConst(u){return u instanceof n.Timestamp?u:this.con(u)}pad(){const u=this.patch.nextTime();if(!u)return;const h=this.clock.time-u;if(h>0){const f=(0,n.ts)(this.clock.sid,u),d=new e.NopOp(f,h);this.patch.ops.push(d)}}};return ww.PatchBuilder=c,ww}var Rw={},kw={},Mw={},cV;function nIe(){if(cV)return Mw;cV=1,Object.defineProperty(Mw,"__esModule",{value:!0}),Mw.decodeF16=void 0;const t=Math.pow,e=n=>{const r=(n&31744)>>10,i=n&1023;return(n>>15?-1:1)*(r?r===31?i?NaN:1/0:t(2,r-15)*(1+i/1024):6103515625e-14*(i/1024))};return Mw.decodeF16=e,Mw}var MR={},Ow={},OR={},lV;function rIe(){if(lV)return OR;lV=1,Object.defineProperty(OR,"__esModule",{value:!0});const t=String.fromCharCode;return OR.default=(e,n,r)=>{let i=n;const s=i+r;let o="";for(;i<s;){const a=e[i++];if((a&128)===0){o+=t(a);continue}const c=e[i++]&63;if((a&224)===192){o+=t((a&31)<<6|c);continue}const l=e[i++]&63;if((a&240)===224){o+=t((a&31)<<12|c<<6|l);continue}if((a&248)===240){const u=e[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;if(h>65535){h-=65536;const f=h>>>10&1023|55296;h=56320|h&1023,o+=t(f,h)}else o+=t(h)}else o+=t(a)}return o},OR}var uV;function iIe(){if(uV)return Ow;uV=1,Object.defineProperty(Ow,"__esModule",{value:!0}),Ow.CachedUtf8Decoder=void 0;const e=ys.__importDefault(rIe());let n=1+Math.round(Math.random()*((-1>>>0)-1));function r(o,a){return n^=n<<13,n^=n>>>17,n^=n<<5,(n>>>0)%(a-o+1)+o}class i{constructor(a,c){this.bytes=a,this.value=c}}let s=class{constructor(){this.caches=[];for(let a=0;a<31;a++)this.caches.push([])}get(a,c,l){const u=this.caches[l-1],h=u.length;e:for(let f=0;f<h;f++){const d=u[f],p=d.bytes;for(let m=0;m<l;m++)if(p[m]!==a[c+m])continue e;return d.value}return null}store(a,c){const l=this.caches[a.length-1],u=new i(a,c);l.length>=16?l[r(0,15)]=u:l.push(u)}decode(a,c,l){if(!l)return"";const u=this.get(a,c,l);if(u!==null)return u;const h=(0,e.default)(a,c,l),f=Uint8Array.prototype.slice.call(a,c,c+l);return this.store(f,h),h}};return Ow.CachedUtf8Decoder=s,Ow}var hV;function Zee(){if(hV)return MR;hV=1,Object.defineProperty(MR,"__esModule",{value:!0});const t=iIe();return MR.default=new t.CachedUtf8Decoder,MR}var fV;function Qee(){if(fV)return kw;fV=1,Object.defineProperty(kw,"__esModule",{value:!0}),kw.CborDecoderBase=void 0;const t=ys,e=nIe(),n=S8(),r=E8(),i=x8(),s=t.__importDefault(Zee());let o=class{constructor(c=new i.Reader,l=s.default){this.reader=c,this.keyDecoder=l}read(c){return this.reader.reset(c),this.readAny()}decode(c){return this.reader.reset(c),this.readAny()}val(){return this.readAny()}readAny(){const l=this.reader.u8(),u=l>>5,h=l&31;return u<4?u<2?u===0?this.readUint(h):this.readNint(h):u===2?this.readBin(h):this.readStr(h):u<6?u===4?this.readArr(h):this.readObj(h):u===6?this.readTag(h):this.readTkn(h)}readAnyRaw(c){const l=c>>5,u=c&31;return l<4?l<2?l===0?this.readUint(u):this.readNint(u):l===2?this.readBin(u):this.readStr(u):l<6?l===4?this.readArr(u):this.readObj(u):l===6?this.readTag(u):this.readTkn(u)}readMinorLen(c){if(c<24)return c;switch(c){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(c){if(c<25)return c===24?this.reader.u8():c;if(c<27)return c===25?this.reader.u16():this.reader.u32();{const l=this.reader.u64();return l>9007199254740991?l:Number(l)}}readNint(c){if(c<25)return c===24?-this.reader.u8()-1:-c-1;if(c<27)return c===25?-this.reader.u16()-1:-this.reader.u32()-1;{const l=this.reader.u64();return l>9007199254740991-1?-l-BigInt(1):-Number(l)-1}}readBin(c){const l=this.reader;if(c<=23)return l.buf(c);switch(c){case 24:return l.buf(l.u8());case 25:return l.buf(l.u16());case 26:return l.buf(l.u32());case 27:return l.buf(Number(l.u64()));case 31:{let u=0;const h=[];for(;this.reader.peak()!==255;){const m=this.readBinChunk();u+=m.length,h.push(m)}this.reader.x++;const f=new Uint8Array(u);let d=0;const p=h.length;for(let m=0;m<p;m++){const g=h[m];f.set(g,d),d+=g.length}return f}default:throw 1}}readBinChunk(){const c=this.reader.u8(),l=c>>5,u=c&31;if(l!==2)throw 2;if(u>27)throw 3;return this.readBin(u)}readAsStr(){const l=this.reader.u8(),u=l>>5,h=l&31;if(u!==3)throw 11;return this.readStr(h)}readStr(c){const l=this.reader;if(c<=23)return l.utf8(c);switch(c){case 24:return l.utf8(l.u8());case 25:return l.utf8(l.u16());case 26:return l.utf8(l.u32());case 27:return l.utf8(Number(l.u64()));case 31:{let u="";for(;l.peak()!==255;)u+=this.readStrChunk();return this.reader.x++,u}default:throw 1}}readStrLen(c){if(c<=23)return c;switch(c){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const c=this.reader.u8(),l=c>>5,u=c&31;if(l!==3)throw 4;if(u>27)throw 5;return this.readStr(u)}readArr(c){const l=this.readMinorLen(c);return l>=0?this.readArrRaw(l):this.readArrIndef()}readArrRaw(c){const l=[];for(let u=0;u<c;u++)l.push(this.readAny());return l}readArrIndef(){const c=[];for(;this.reader.peak()!==255;)c.push(this.readAny());return this.reader.x++,c}readObj(c){if(c<28){let l=c;switch(c){case 24:l=this.reader.u8();break;case 25:l=this.reader.u16();break;case 26:l=this.reader.u32();break;case 27:l=Number(this.reader.u64());break}const u={};for(let h=0;h<l;h++){const f=this.key();if(f==="__proto__")throw 6;const d=this.readAny();u[f]=d}return u}else{if(c===31)return this.readObjIndef();throw 1}}readObjRaw(c){const l={};for(let u=0;u<c;u++){const h=this.key(),f=this.readAny();l[h]=f}return l}readObjIndef(){const c={};for(;this.reader.peak()!==255;){const l=this.key();if(this.reader.peak()===255)throw 7;const u=this.readAny();c[l]=u}return this.reader.x++,c}key(){const c=this.reader.u8(),l=c>>5,u=c&31;if(l!==3)return String(this.readAnyRaw(c));const h=this.readStrLen(u);if(h>31)return this.reader.utf8(h);const f=this.keyDecoder.decode(this.reader.uint8,this.reader.x,h);return this.reader.skip(h),f}readTag(c){if(c<=23)return this.readTagRaw(c);switch(c){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(c){return new n.JsonPackExtension(c,this.readAny())}readTkn(c){switch(c){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new r.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(c<=23)return new r.JsonPackValue(c);throw 1}f16(){return(0,e.decodeF16)(this.reader.u16())}};return kw.CborDecoderBase=o,kw}var dV;function sIe(){if(dV)return Rw;dV=1,Object.defineProperty(Rw,"__esModule",{value:!0}),Rw.CborDecoder=void 0;const t=Qee(),e=E8();let n=class extends t.CborDecoderBase{readAsMap(){const i=this.reader.u8(),s=i>>5,o=i&31;if(s===5)return this.readMap(o);throw 0}readMap(i){const s=this.readMinorLen(i);return s>=0?this.readMapRaw(s):this.readMapIndef()}readMapRaw(i){const s=new Map;for(let o=0;o<i;o++){const a=this.readAny(),c=this.readAny();s.set(a,c)}return s}readMapIndef(){const i=new Map;for(;this.reader.peak()!==255;){const s=this.readAny();if(this.reader.peak()===255)throw 7;const o=this.readAny();i.set(s,o)}return this.reader.x++,i}skipN(i){for(let s=0;s<i;s++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(i){const s=i>>5,o=i&31;switch(s){case 0:case 1:this.skipUNint(o);break;case 2:this.skipBin(o);break;case 3:this.skipStr(o);break;case 4:this.skipArr(o);break;case 5:this.skipObj(o);break;case 7:this.skipTkn(o);break;case 6:this.skipTag(o);break}}skipMinorLen(i){if(i<=23)return i;switch(i){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(i){if(!(i<=23))switch(i){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(i){const s=this.skipMinorLen(i);if(s>=0)this.reader.skip(s);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const i=this.reader.u8(),s=i>>5,o=i&31;if(s!==2)throw 2;if(o>27)throw 3;this.skipBin(o)}skipStr(i){const s=this.skipMinorLen(i);if(s>=0)this.reader.skip(s);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const i=this.reader.u8(),s=i>>5,o=i&31;if(s!==3)throw 4;if(o>27)throw 5;this.skipStr(o)}skipArr(i){const s=this.skipMinorLen(i);if(s>=0)this.skipN(s);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(i){const s=this.readMinorLen(i);if(s>=0)return this.skipN(s*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(i){if(this.skipMinorLen(i)<0)throw 1;this.skipAny()}skipTkn(i){switch(i){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(i<=23))throw 1}validate(i,s=0,o=i.length){this.reader.reset(i),this.reader.x=s;const a=s;if(this.skipAny(),this.reader.x-a!==o)throw 8}decodeLevel(i){return this.reader.reset(i),this.readLevel()}readLevel(){const i=this.reader.u8(),s=i>>5,o=i&31;switch(s){case 4:return this.readArrLevel(o);case 5:return this.readObjLevel(o);default:return super.readAnyRaw(i)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.readAny()}}readAsValue(){const i=this.reader,s=i.x;this.skipAny();const o=i.x;return new e.JsonPackValue(i.uint8.subarray(s,o))}readObjLevel(i){const s=this.readMinorLen(i);return s>=0?this.readObjRawLevel(s):this.readObjIndefLevel()}readObjRawLevel(i){const s={};for(let o=0;o<i;o++){const a=this.key(),c=this.readPrimitiveOrVal();s[a]=c}return s}readObjIndefLevel(){const i={};for(;this.reader.peak()!==255;){const s=this.key();if(this.reader.peak()===255)throw 7;const o=this.readPrimitiveOrVal();i[s]=o}return this.reader.x++,i}readArrLevel(i){const s=this.readMinorLen(i);return s>=0?this.readArrRawLevel(s):this.readArrIndefLevel()}readArrRawLevel(i){const s=[];for(let o=0;o<i;o++)s.push(this.readPrimitiveOrVal());return s}readArrIndefLevel(){const i=[];for(;this.reader.peak()!==255;)i.push(this.readPrimitiveOrVal());return this.reader.x++,i}readHdr(i){const s=this.reader.u8();if(s>>5!==i)throw 0;const a=s&31;if(a<24)return a;switch(a){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(i){const s=this.readObjHdr();for(let o=0;o<s;o++){if(this.key()===i)return this;this.skipAny()}throw 9}findIndex(i){const s=this.readArrHdr();if(i>=s)throw 10;for(let o=0;o<i;o++)this.skipAny();return this}find(i){for(let s=0;s<i.length;s++){const o=i[s];typeof o=="string"?this.findKey(o):this.findIndex(o)}return this}};return Rw.CborDecoder=n,Rw}var pV;function ete(){if(pV)return bw;pV=1,Object.defineProperty(bw,"__esModule",{value:!0}),bw.Decoder=void 0;const t=Jee(),e=Xo(),n=T8(),r=sIe();class i extends r.CborDecoder{constructor(o=new t.CrdtReader){super(o)}decode(o){return this.reader.reset(o),this.readPatch()}readPatch(){const o=this.reader,a=o.vu57(),c=o.vu57(),u=a===1?new e.ServerClockVector(1,c):new e.ClockVector(a,c);this.patchSid=u.sid;const h=this.builder=new n.PatchBuilder(u),f=this.val();return Array.isArray(f)&&(h.patch.meta=f[0]),this.decodeOperations(),h.patch}decodeId(){const o=this.reader,[a,c]=o.b1vu56();return a?new e.Timestamp(o.vu57(),c):new e.Timestamp(this.patchSid,c)}decodeTss(){const o=this.decodeId(),a=this.reader.vu57();return(0,e.interval)(o,0,a)}decodeOperations(){const a=this.reader.vu57();for(let c=0;c<a;c++)this.decodeOperation()}decodeOperation(){const o=this.builder,a=this.reader,c=a.u8();switch(c>>3){case 0:{const u=c&7;o.con(u?this.decodeId():this.val());break}case 1:{o.val();break}case 2:{o.obj();break}case 3:{o.vec();break}case 4:{o.str();break}case 5:{o.bin();break}case 6:{o.arr();break}case 9:{const u=this.decodeId(),h=this.decodeId();o.setVal(u,h);break}case 10:{const u=c&7||a.vu57(),h=this.decodeId(),f=[];for(let d=0;d<u;d++){const p=this.val();if(typeof p!="string")continue;const m=this.decodeId();f.push([p,m])}o.insObj(h,f);break}case 11:{const u=c&7||a.vu57(),h=this.decodeId(),f=[];for(let d=0;d<u;d++){const p=this.val();if(typeof p!="number")continue;const m=this.decodeId();f.push([p,m])}o.insVec(h,f);break}case 12:{const u=c&7||a.vu57(),h=this.decodeId(),f=this.decodeId(),d=a.utf8(u);o.insStr(h,f,d);break}case 13:{const u=c&7||a.vu57(),h=this.decodeId(),f=this.decodeId(),d=a.buf(u);if(!(d instanceof Uint8Array))return;o.insBin(h,f,d);break}case 14:{const u=c&7||a.vu57(),h=this.decodeId(),f=this.decodeId(),d=[];for(let p=0;p<u;p++)d.push(this.decodeId());o.insArr(h,f,d);break}case 15:{const u=this.decodeId(),h=this.decodeId(),f=this.decodeId();o.updArr(u,h,f);break}case 16:{const u=c&7||a.vu57(),h=this.decodeId(),f=[];for(let d=0;d<u;d++)f.push(this.decodeTss());o.del(h,f);break}case 17:{const u=c&7||a.vu57();o.nop(u);break}default:throw new Error("UNKNOWN_OP")}}}return bw.Decoder=i,bw}var DP={},mV;function oIe(){return mV||(mV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.decoder=t.encode=t.encoder=void 0;const e=Kee(),n=ete(),r=b8(),i=new r.CrdtWriter(1024*4);t.encoder=new e.Encoder(i);const s=a=>t.encoder.encode(a);t.encode=s,t.decoder=new n.Decoder;const o=a=>t.decoder.decode(a);t.decode=o})(DP)),DP}var gV;function aIe(){return gV||(gV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(Kee(),t),e.__exportStar(ete(),t),e.__exportStar(oIe(),t)})(MP)),MP}var _V;function nte(){if(_V)return uw;_V=1,Object.defineProperty(uw,"__esModule",{value:!0}),uw.Patch=void 0;const e=ys.__importStar(yC()),n=Xo(),r=hf(),i=aIe();let s=class tte{constructor(){this.ops=[],this.meta=void 0}static fromBinary(a){return(0,i.decode)(a)}getId(){const a=this.ops[0];if(a)return a.id}span(){let a=0;for(const c of this.ops)a+=c.span();return a}nextTime(){const a=this.ops,c=a.length;if(!c)return 0;const l=a[c-1];return l.id.time+l.span()}rewriteTime(a){const c=new tte,l=this.ops,u=l.length,h=c.ops;for(let f=0;f<u;f++){const d=l[f];d instanceof e.DelOp?h.push(new e.DelOp(a(d.id),a(d.obj),d.what)):d instanceof e.NewConOp?h.push(new e.NewConOp(a(d.id),d.val instanceof n.Timestamp?a(d.val):d.val)):d instanceof e.NewVecOp?h.push(new e.NewVecOp(a(d.id))):d instanceof e.NewValOp?h.push(new e.NewValOp(a(d.id))):d instanceof e.NewObjOp?h.push(new e.NewObjOp(a(d.id))):d instanceof e.NewStrOp?h.push(new e.NewStrOp(a(d.id))):d instanceof e.NewBinOp?h.push(new e.NewBinOp(a(d.id))):d instanceof e.NewArrOp?h.push(new e.NewArrOp(a(d.id))):d instanceof e.InsArrOp?h.push(new e.InsArrOp(a(d.id),a(d.obj),a(d.ref),d.data.map(a))):d instanceof e.UpdArrOp?h.push(new e.UpdArrOp(a(d.id),a(d.obj),a(d.ref),a(d.val))):d instanceof e.InsStrOp?h.push(new e.InsStrOp(a(d.id),a(d.obj),a(d.ref),d.data)):d instanceof e.InsBinOp?h.push(new e.InsBinOp(a(d.id),a(d.obj),a(d.ref),d.data)):d instanceof e.InsValOp?h.push(new e.InsValOp(a(d.id),a(d.obj),a(d.val))):d instanceof e.InsObjOp?h.push(new e.InsObjOp(a(d.id),a(d.obj),d.data.map(([p,m])=>[p,a(m)]))):d instanceof e.InsVecOp?h.push(new e.InsVecOp(a(d.id),a(d.obj),d.data.map(([p,m])=>[p,a(m)]))):d instanceof e.NopOp&&h.push(new e.NopOp(a(d.id),d.len))}return c}rebase(a,c){const l=this.getId();if(!l)throw new Error("EMPTY_PATCH");const u=l.sid,h=l.time;if(c??(c=h),h===a)return this;const f=a-h;return this.rewriteTime(d=>{if(d.sid!==u)return d;const p=d.time;return p<c?d:(0,n.ts)(u,p+f)})}clone(){return this.rewriteTime(a=>a)}toBinary(){return(0,i.encode)(this)}toString(a=""){const c=this.getId();return`Patch ${c?(0,n.printTs)(c):"(nil)"}!${this.span()}`+(0,r.printTree)(a,this.ops.map(u=>h=>u.toString(h)))}};return uw.Patch=s,uw}var vV;function ob(){return vV||(vV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(HOe(),t),e.__exportStar(Xo(),t),e.__exportStar(yC(),t),e.__exportStar(nte(),t),e.__exportStar(T8(),t),e.__exportStar(w8(),t)})(TP)),TP}var yV;function rte(){return yV||(yV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.bin=t.con=t.line=void 0;const e=VOe(),n=ob();t.line=e.toLine;const r=s=>s instanceof Uint8Array?"Uint8Array "+(0,t.bin)(s):`{ ${s instanceof n.Timestamp?(0,n.printTs)(s):(0,t.line)(s)} }`;t.con=r;const i=s=>"{ "+(""+s).replaceAll(",",", ")+" }";t.bin=i})(xP)),xP}var bV;function AI(){if(bV)return aw;bV=1,Object.defineProperty(aw,"__esModule",{value:!0}),aw.ConNode=void 0;const t=rte(),e=Xo();let n=class{constructor(i,s){this.id=i,this.val=s,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(i){return this.name()+" "+(0,e.printTs)(this.id)+" "+(0,t.con)(this.val)}};return aw.ConNode=n,aw}var Iw={},My={},Oy={},Nw={},Pw={},Dw={},SV;function cIe(){if(SV)return Dw;SV=1,Object.defineProperty(Dw,"__esModule",{value:!0}),Dw.RelativeTimestamp=void 0;let t=class{constructor(n,r){this.sessionIndex=n,this.timeDiff=r}};return Dw.RelativeTimestamp=t,Dw}var EV;function lIe(){if(EV)return Pw;EV=1,Object.defineProperty(Pw,"__esModule",{value:!0}),Pw.ClockEncoder=void 0;const t=Xo(),e=cIe();class n{constructor(s,o){this.index=s,this.clock=o}}let r=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(s){this.index=1,this.clock=s;const o=new n(this.index++,(0,t.tick)(s,-1));this.table.clear(),this.table.set(s.sid,o)}append(s){const o=s.time,a=s.sid;let c=this.table.get(a);if(!c){let h=this.clock.peers.get(a);h||(h=new t.Timestamp(a,this.clock.time-1)),c=new n(this.index++,h),this.table.set(a,c)}const u=c.clock.time-o;if(u<0)throw new Error("TIME_TRAVEL");return new e.RelativeTimestamp(c.index,u)}toJson(){const s=[];return this.table.forEach(o=>{const a=o.clock;s.push(a.sid,a.time)}),s}};return Pw.ClockEncoder=r,Pw}var Iy={},xV;function ite(){if(xV)return Iy;xV=1,Object.defineProperty(Iy,"__esModule",{value:!0}),Iy.CRDT_MAJOR_OVERLAY=Iy.CRDT_MAJOR=void 0;var t;(function(n){n[n.CON=0]="CON",n[n.VAL=1]="VAL",n[n.OBJ=2]="OBJ",n[n.VEC=3]="VEC",n[n.STR=4]="STR",n[n.BIN=5]="BIN",n[n.ARR=6]="ARR"})(t||(Iy.CRDT_MAJOR=t={}));var e;return(function(n){n[n.CON=0]="CON",n[n.VAL=32]="VAL",n[n.VEC=96]="VEC",n[n.OBJ=64]="OBJ",n[n.STR=128]="STR",n[n.BIN=160]="BIN",n[n.ARR=192]="ARR"})(e||(Iy.CRDT_MAJOR_OVERLAY=e={})),Iy}var wV;function uIe(){if(wV)return Nw;wV=1,Object.defineProperty(Nw,"__esModule",{value:!0}),Nw.Encoder=void 0;const e=ys.__importStar(Vg()),n=lIe(),r=b8(),i=Xo(),s=Yee(),o=ite();let a=class extends s.CborEncoder{constructor(l){super(l||new r.CrdtWriter),this.clockEncoder=new n.ClockEncoder,this.time=0,this.cTableEntry=u=>{const h=u.clock,f=this.writer;f.vu57(h.sid),f.vu57(h.time)},this.tsLogical=u=>{const h=this.clockEncoder.append(u);this.writer.id(h.sessionIndex,h.timeDiff)},this.tsServer=u=>{this.writer.vu57(u.time)},this.ts=this.tsLogical,this.cKey=(u,h)=>{this.writeStr(h),this.cNode(this.doc.index.get(u))}}encode(l){this.doc=l;const u=this.writer;return u.reset(),l.clock.sid===1?this.encodeServer(l):this.encodeLogical(l),u.flush()}encodeLogical(l){const u=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(l.clock),u.ensureCapacity(4);const h=u.x0,f=u.x;u.x+=4,this.cRoot(l.root),this.encodeClockTable(h,f)}encodeServer(l){this.ts=this.tsServer;const u=this.writer;u.u8(128),u.vu57(this.time=l.clock.time),this.cRoot(l.root)}encodeClockTable(l,u){const h=this.writer,f=h.x0-l;h.view.setUint32(h.x0+(u-l),h.x-u-f-4);const p=this.clockEncoder.table,m=p.size;h.vu57(m),p.forEach(this.cTableEntry)}cRoot(l){l.val.sid===0?this.writer.u8(0):this.cNode(l.node())}writeTL(l,u){const h=this.writer;u<31?h.u8(l|u):(h.u8(l|31),h.vu57(u))}cNode(l){l instanceof e.ConNode?this.cCon(l):l instanceof e.ValNode?this.cVal(l):l instanceof e.StrNode?this.cStr(l):l instanceof e.ObjNode?this.cObj(l):l instanceof e.VecNode?this.cVec(l):l instanceof e.ArrNode?this.cArr(l):l instanceof e.BinNode&&this.cBin(l)}cCon(l){const u=l.val;this.ts(l.id),u instanceof i.Timestamp?(this.writer.u8(1),this.ts(u)):(this.writer.u8(0),this.writeAny(u))}cVal(l){this.ts(l.id),this.writer.u8(32),this.cNode(l.node())}cObj(l){this.ts(l.id);const u=l.keys;this.writeTL(o.CRDT_MAJOR_OVERLAY.OBJ,u.size),u.forEach(this.cKey)}cVec(l){const u=l.elements,h=u.length;this.ts(l.id),this.writeTL(o.CRDT_MAJOR_OVERLAY.VEC,h);const f=this.doc.index;for(let d=0;d<h;d++){const p=u[d];p?this.cNode(f.get(p)):this.writer.u8(0)}}cStr(l){const u=this.ts;u(l.id),this.writeTL(o.CRDT_MAJOR_OVERLAY.STR,l.count);for(let h=l.first();h;h=l.next(h))u(h.id),h.del?this.writeUInteger(h.span):this.writeStr(h.data)}cBin(l){const u=this.ts,h=this.writer;u(l.id),this.writeTL(o.CRDT_MAJOR_OVERLAY.BIN,l.count);for(let f=l.first();f;f=l.next(f)){u(f.id);const d=f.span,p=f.del;h.b1vu56(~~p,d),!p&&h.buf(f.data,d)}}cArr(l){const u=this.ts,h=this.writer;u(l.id),this.writeTL(o.CRDT_MAJOR_OVERLAY.ARR,l.count);const f=this.doc.index;for(let d=l.first();d;d=l.next(d)){u(d.id);const p=d.span,m=d.del;if(h.b1vu56(~~m,p),m)continue;const g=d.data;for(let _=0;_<p;_++)this.cNode(f.get(g[_]))}}};return Nw.Encoder=a,Nw}var Lw={},Uw={},TV;function hIe(){if(TV)return Uw;TV=1,Object.defineProperty(Uw,"__esModule",{value:!0}),Uw.ClockDecoder=void 0;const t=Xo();let e=class ste{static fromArr(r){const i=new ste(r[0],r[1]),s=r.length;for(let o=2;o<s;o+=2)i.pushTuple(r[o],r[o+1]);return i}constructor(r,i){this.table=[],this.clock=new t.ClockVector(r,i+1),this.table.push((0,t.ts)(r,i))}pushTuple(r,i){const s=(0,t.ts)(r,i);this.clock.observe(s,1),this.table.push(s)}decodeId(r,i){if(!r)return(0,t.ts)(0,i);const s=this.table[r-1];if(!s)throw new Error("INVALID_CLOCK_TABLE");return(0,t.ts)(s.sid,s.time-i)}};return Uw.ClockDecoder=e,Uw}var AV;function fIe(){if(AV)return Lw;AV=1,Object.defineProperty(Lw,"__esModule",{value:!0}),Lw.Decoder=void 0;const e=ys.__importStar(Vg()),n=hIe(),r=Jee(),i=Xo(),s=O8(),o=Qee(),a=ite();class c extends o.CborDecoderBase{constructor(){super(new r.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const u=this.ts(),h=this.val();return typeof h=="string"?new e.StrChunk(u,h.length,h):new e.StrChunk(u,~~h,"")},this.cBinChunk=()=>{const u=this.ts(),h=this.reader,[f,d]=h.b1vu56();return f?new e.BinChunk(u,d,void 0):new e.BinChunk(u,d,h.buf(d))},this.cArrChunk=()=>{const u=this.ts(),[h,f]=this.reader.b1vu56();if(h)return new e.ArrChunk(u,f,void 0);const d=[];for(let p=0;p<f;p++)d.push(this.cNode().id);return new e.ArrChunk(u,f,d)}}decode(u,h){this.clockDecoder=void 0,this.time=-1;const f=this.reader;if(f.reset(u),f.peak()&128){f.x++;const p=this.time=f.vu57();h||(h=s.Model.withServerClock(void 0,p))}else if(this.decodeClockTable(),!h){const p=this.clockDecoder.clock;h=s.Model.create(void 0,p)}return this.doc=h,h.root=new e.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,h}decodeClockTable(){const u=this.reader,h=u.u32(),f=u.x;u.x+=h;const d=u.vu57(),p=u.vu57(),m=u.vu57();this.clockDecoder=new n.ClockDecoder(p,m);for(let g=1;g<d;g++){const _=u.vu57(),y=u.vu57();this.clockDecoder.pushTuple(_,y)}u.x=f}ts(){if(this.time<0){const[f,d]=this.reader.id();return this.clockDecoder.decodeId(f,d)}else return new i.Timestamp(1,this.reader.vu57())}cRoot(){const u=this.reader;return u.uint8[u.x]?this.cNode():s.UNDEFINED}cNode(){const u=this.reader,h=this.ts(),f=u.u8(),d=f>>5,p=f&31;switch(d){case a.CRDT_MAJOR.CON:return this.cCon(h,p);case a.CRDT_MAJOR.VAL:return this.cVal(h);case a.CRDT_MAJOR.OBJ:return this.cObj(h,p!==31?p:u.vu57());case a.CRDT_MAJOR.VEC:return this.cVec(h,p!==31?p:u.vu57());case a.CRDT_MAJOR.STR:return this.cStr(h,p!==31?p:u.vu57());case a.CRDT_MAJOR.BIN:return this.cBin(h,p!==31?p:u.vu57());case a.CRDT_MAJOR.ARR:return this.cArr(h,p!==31?p:u.vu57())}throw new Error("UNKNOWN_NODE")}cCon(u,h){const f=this.doc,d=h?this.ts():this.val(),p=new e.ConNode(u,d);return f.index.set(u,p),p}cVal(u){const h=this.cNode(),f=this.doc,d=new e.ValNode(f,u,h.id);return f.index.set(u,d),d}cObj(u,h){const f=new e.ObjNode(this.doc,u);for(let d=0;d<h;d++)this.cObjChunk(f);return this.doc.index.set(u,f),f}cObjChunk(u){const h=this.key();u.keys.set(h,this.cNode().id)}cVec(u,h){const f=this.reader,d=new e.VecNode(this.doc,u),p=d.elements;for(let m=0;m<h;m++)f.peak()?p.push(this.cNode().id):(f.x++,p.push(void 0));return this.doc.index.set(u,d),d}cStr(u,h){const f=new e.StrNode(u);return h&&f.ingest(h,this.cStrChunk),this.doc.index.set(u,f),f}cBin(u,h){const f=new e.BinNode(u);return h&&f.ingest(h,this.cBinChunk),this.doc.index.set(u,f),f}cArr(u,h){const f=new e.ArrNode(this.doc,u);return h&&f.ingest(h,this.cArrChunk),this.doc.index.set(u,f),f}}return Lw.Decoder=c,Lw}var CV;function dIe(){if(CV)return Oy;CV=1,Object.defineProperty(Oy,"__esModule",{value:!0}),Oy.decoder=Oy.encoder=void 0;const t=uIe(),e=fIe();return Oy.encoder=new t.Encoder,Oy.decoder=new e.Decoder,Oy}var LP={},Aa={},Bw={},IR={},RV;function A8(){if(RV)return IR;RV=1,Object.defineProperty(IR,"__esModule",{value:!0}),IR.hasOwnProperty=e;const t=Object.prototype.hasOwnProperty;function e(n,r){return t.call(n,r)}return IR}var kV;function ote(){if(kV)return Bw;kV=1,Object.defineProperty(Bw,"__esModule",{value:!0}),Bw.get=void 0;const t=A8(),e=(n,r)=>{const i=r.length;let s;if(!i)return n;for(let o=0;o<i;o++)if(s=r[o],n instanceof Array){if(typeof s!="number"){if(s==="-")return;const a=~~s;if(""+a!==s)return;s=a}n=n[s]}else if(typeof n=="object"){if(!n||!(0,t.hasOwnProperty)(n,s))return;n=n[s]}else return;return n};return Bw.get=e,Bw}var UP={},MV;function C8(){return MV||(MV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.isInteger=t.isRoot=t.toPath=void 0,t.unescapeComponent=s,t.escapeComponent=o,t.parseJsonPointer=a,t.formatJsonPointer=c,t.isChild=u,t.isPathEqual=h,t.parent=d,t.isValidIndex=p;const e=/~1/g,n=/~0/g,r=/~/g,i=/\//g;function s(g){return g.indexOf("~")===-1?g:g.replace(e,"/").replace(n,"~")}function o(g){return g.indexOf("/")===-1&&g.indexOf("~")===-1?g:g.replace(r,"~0").replace(i,"~1")}function a(g){return g?g.slice(1).split("/").map(s):[]}function c(g){return(0,t.isRoot)(g)?"":"/"+g.map(_=>o(String(_))).join("/")}const l=g=>typeof g=="string"?a(g):g;t.toPath=l;function u(g,_){if(g.length>=_.length)return!1;for(let y=0;y<g.length;y++)if(g[y]!==_[y])return!1;return!0}function h(g,_){if(g.length!==_.length)return!1;for(let y=0;y<g.length;y++)if(g[y]!==_[y])return!1;return!0}const f=g=>!g.length;t.isRoot=f;function d(g){if(g.length<1)throw new Error("NO_PARENT");return g.slice(0,g.length-1)}function p(g){if(typeof g=="number")return!0;const _=Number.parseInt(g,10);return String(_)===g&&_>=0}const m=g=>{const _=g.length;let y=0,v;for(;y<_;){if(v=g.charCodeAt(y),v>=48&&v<=57){y++;continue}return!1}return!0};t.isInteger=m})(UP)),UP}var Fw={},BP={},FP={},OV;function pIe(){return OV||(OV=1,Object.defineProperty(FP,"__esModule",{value:!0})),FP}var jP={},IV;function mIe(){return IV||(IV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.validatePath=t.validateJsonPointer=void 0;const e=i=>{if(typeof i=="string"){if(i){if(i[0]!=="/")throw new Error("POINTER_INVALID");if(i.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,t.validatePath)(i)};t.validateJsonPointer=e;const{isArray:n}=Array,r=i=>{if(!n(i))throw new Error("Invalid path.");if(i.length>256)throw new Error("Path too long.");for(const s of i)switch(typeof s){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};t.validatePath=r})(jP)),jP}var zd={},NV;function gIe(){if(NV)return zd;NV=1,Object.defineProperty(zd,"__esModule",{value:!0}),zd.isObjectReference=zd.isArrayEnd=zd.isArrayReference=zd.find=void 0;const t=A8(),{isArray:e}=Array,n=(o,a)=>{const c=a.length;if(!c)return{val:o};let l,u;for(let f=0;f<c;f++)if(l=o,u=a[f],e(l)){const d=l.length;if(u==="-")u=d;else if(typeof u=="string"){const p=~~u;if(""+p!==u)throw new Error("INVALID_INDEX");if(u=p,u<0)throw new Error("INVALID_INDEX")}o=l[u]}else if(typeof l=="object"&&l)o=(0,t.hasOwnProperty)(l,u)?l[u]:void 0;else throw new Error("NOT_FOUND");return{val:o,obj:l,key:u}};zd.find=n;const r=o=>e(o.obj)&&typeof o.key=="number";zd.isArrayReference=r;const i=o=>o.obj.length===o.key;zd.isArrayEnd=i;const s=o=>typeof o.obj=="object"&&typeof o.key=="string";return zd.isObjectReference=s,zd}var zP={},jw={},PV;function _Ie(){if(PV)return jw;PV=1,Object.defineProperty(jw,"__esModule",{value:!0}),jw.findByPointer=void 0;const t=A8(),e=C8(),{isArray:n}=Array,r=(i,s)=>{if(!i)return{val:s};let o,a,c=0,l=1;for(;c>-1;)if(c=i.indexOf("/",l),a=c>-1?i.substring(l,c):i.substring(l),l=c+1,o=s,n(o)){const u=o.length;if(a==="-")a=u;else{const h=~~a;if(""+h!==a)throw new Error("INVALID_INDEX");if(a=h,a<0)throw"INVALID_INDEX"}s=o[a]}else if(typeof o=="object"&&o)a=(0,e.unescapeComponent)(a),s=(0,t.hasOwnProperty)(o,a)?o[a]:void 0;else throw"NOT_FOUND";return{val:s,obj:o,key:a}};return jw.findByPointer=r,jw}var DV;function vIe(){return DV||(DV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),ys.__exportStar(_Ie(),t)})(zP)),zP}var LV;function ate(){return LV||(LV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(pIe(),t),e.__exportStar(C8(),t),e.__exportStar(mIe(),t),e.__exportStar(ote(),t),e.__exportStar(gIe(),t),e.__exportStar(vIe(),t)})(BP)),BP}var UV;function yIe(){if(UV)return Fw;UV=1,Object.defineProperty(Fw,"__esModule",{value:!0}),Fw.find=void 0;const t=ate(),e=Vg(),n=(r,i)=>{const s=(0,t.toPath)(i);let o=r;const a=s.length;if(!a)return o;let c=0;for(;c<a&&o;){const l=s[c++];if(o=o.container(),!o)throw new Error("NOT_CONTAINER");if(o instanceof e.ObjNode){const u=o.get(String(l));if(!u)throw new Error("NOT_FOUND");o=u}else if(o instanceof e.ArrNode){const u=o.getNode(Number(l));if(!u)throw new Error("NOT_FOUND");o=u}else if(o instanceof e.VecNode){const u=o.get(Number(l));if(!u)throw new Error("NOT_FOUND");o=u}}return o};return Fw.find=n,Fw}var zw={},Vd={},Vw={},BV;function cte(){if(BV)return Vw;BV=1,Object.defineProperty(Vw,"__esModule",{value:!0}),Vw.FanOut=void 0;class t{constructor(){this.listeners=new Set}emit(n){this.listeners.forEach(r=>r(n))}listen(n){const r=this.listeners;return r.add(n),()=>r.delete(n)}}return Vw.FanOut=t,Vw}var FV;function lte(){if(FV)return Vd;FV=1,Object.defineProperty(Vd,"__esModule",{value:!0}),Vd.OnNewFanOut=Vd.MapFanOut=Vd.MicrotaskBufferFanOut=Vd.MergeFanOut=void 0;const t=cte();class e extends t.FanOut{constructor(o){super(),this.fanouts=o,this.unsubs=[]}listen(o){this.listeners.size||(this.unsubs=this.fanouts.map(c=>c.listen(l=>this.emit(l))));const a=super.listen(o);return()=>{if(a(),!this.listeners.size){for(const c of this.unsubs)c();this.unsubs=[]}}}}Vd.MergeFanOut=e;class n extends t.FanOut{constructor(o){super(),this.source=o,this.buffer=[],this.unsub=void 0}listen(o){this.unsub||(this.unsub=this.source.listen(c=>{const l=this.buffer;l.length||queueMicrotask(()=>{this.emit(l),this.buffer=[]}),l.push(c)}));const a=super.listen(o);return()=>{a(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.buffer=[],this.unsub?.(),this.unsub=void 0}}Vd.MicrotaskBufferFanOut=n;class r extends t.FanOut{constructor(o,a){super(),this.source=o,this.mapper=a,this.unsub=void 0}listen(o){this.unsub||(this.unsub=this.source.listen(c=>this.emit(this.mapper(c))));const a=super.listen(o);return()=>{a(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.unsub?.(),this.unsub=void 0}}Vd.MapFanOut=r;class i extends t.FanOut{constructor(o,a=void 0){super(),this.source=o,this.last=a,this.unsub=void 0}listen(o){this.unsub||(this.unsub=this.source.listen(c=>{this.last!==c&&this.emit(this.last=c)}));const a=super.listen(o);return()=>{a(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.last=void 0,this.unsub?.(),this.unsub=void 0}}return Vd.OnNewFanOut=i,Vd}var jV;function bIe(){if(jV)return zw;jV=1,Object.defineProperty(zw,"__esModule",{value:!0}),zw.NodeEvents=void 0;const t=lte();let e=class{constructor(r){this.api=r,this.subscribe=i=>this.onViewChanges.listen(()=>i()),this.getSnapshot=()=>this.api.view(),this.onChanges=new t.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new t.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return zw.NodeEvents=e,zw}var Hw={},zV;function SIe(){if(zV)return Hw;zV=1,Object.defineProperty(Hw,"__esModule",{value:!0}),Hw.ExtNode=void 0;const t=Xo();let e=class{constructor(r){this.data=r,this.api=void 0,this.id=r.id}children(r){}child(){return this.data}container(){return this.data.container()}toString(r,i){return this.name()+(i?" "+(0,t.printTs)(i):"")+" "+this.data.toString(r)}};return Hw.ExtNode=e,Hw}var Ny={},VP={},HP={},VV;function EIe(){return VV||(VV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.deepEqual=void 0;const e=Array.isArray,n=Object.prototype,r=(i,s)=>{if(i===s)return!0;let o=0,a=0;if(e(i)){if(!e(s)||(o=i.length,o!==s.length))return!1;for(a=o;a--!==0;)if(!(0,t.deepEqual)(i[a],s[a]))return!1;return!0}if(i&&s&&typeof i=="object"&&typeof s=="object"){e:{if(i.__proto__===n)break e;if(i instanceof Uint8Array){if(!(s instanceof Uint8Array))return!1;const l=i.length;if(l!==s.length)return!1;for(let u=0;u<l;u++)if(i[u]!==s[u])return!1;return!0}}const c=Object.keys(i);if(o=c.length,o!==Object.keys(s).length||e(s))return!1;for(a=o;a--!==0;){const l=c[a];if(!(0,t.deepEqual)(i[l],s[l]))return!1}return!0}return!1};t.deepEqual=r})(HP)),HP}var HV;function ute(){return HV||(HV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),ys.__exportStar(EIe(),t)})(VP)),VP}var $w={},$V;function xIe(){if($V)return $w;$V=1,Object.defineProperty($w,"__esModule",{value:!0}),$w.cmpUint8Array=void 0;const t=(e,n)=>{const r=e.length;if(r!==n.length)return!1;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0};return $w.cmpUint8Array=t,$w}var $P={},GV;function R8(){return GV||(GV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.apply=t.invert=t.dst=t.src=t.diffEdit=t.diff=t.overlap=t.sfx=t.pfx=t.normalize=void 0;const e=v=>{const E=v.length;if(E<2)return v;let x=0;e:{if(!v[0][1])break e;for(x=1;x<E;x++){const T=v[x-1],k=v[x];if(!k[1]||T[0]===k[0])break e}return v}const A=[];for(let T=0;T<x;T++)A.push(v[T]);for(let T=x;T<E;T++){const k=v[T];if(!k[1])continue;const L=A.length>0?A[A.length-1]:null;L&&L[0]===k[0]?L[1]+=k[1]:A.push(k)}return A};t.normalize=e;const n=v=>{const E=v.charCodeAt(0);return E>=56320&&E<=57343},r=v=>{const E=v.charCodeAt(v.length-1);return E>=55296&&E<=56319},i=(v,E)=>{v.push([0,""]);let x=0,A=0,T=0,k="",L="",I=0;for(;x<v.length;){if(x<v.length-1&&!v[x][1]){v.splice(x,1);continue}const M=v[x];switch(M[0]){case 1:T++,x++,L+=M[1];break;case-1:A++,x++,k+=M[1];break;case 0:{let D=x-T-A-1;if(E){const G=v[D];if(D>=0){let re=G[1];if(r(re)){const H=re.slice(-1);if(G[1]=re=re.slice(0,-1),k=H+k,L=H+L,!re){v.splice(D,1),x--;let Y=D-1;const Z=v[Y];if(Z){const Q=Z[0];Q===1?(T++,Y--,L=Z[1]+L):Q===-1&&(A++,Y--,k=Z[1]+k)}D=Y}}}const K=v[x],te=K[1];if(n(te)){const re=te.charAt(0);K[1]=te.slice(1),k+=re,L+=re}}if(x<v.length-1&&!v[x][1]){v.splice(x,1);break}const O=k.length>0,z=L.length>0;if(O||z){O&&z&&(I=(0,t.pfx)(L,k),I!==0&&(D>=0?v[D][1]+=L.slice(0,I):(v.splice(0,0,[0,L.slice(0,I)]),x++),L=L.slice(I),k=k.slice(I)),I=(0,t.sfx)(L,k),I!==0&&(v[x][1]=L.slice(L.length-I)+v[x][1],L=L.slice(0,L.length-I),k=k.slice(0,k.length-I)));const G=T+A,K=k.length,te=L.length;K===0&&te===0?(v.splice(x-G,G),x=x-G):K===0?(v.splice(x-G,G,[1,L]),x=x-G+1):te===0?(v.splice(x-G,G,[-1,k]),x=x-G+1):(v.splice(x-G,G,[-1,k],[1,L]),x=x-G+2)}const q=v[x-1];x!==0&&q[0]===0?(q[1]+=v[x][1],v.splice(x,1)):x++,T=0,A=0,k="",L="";break}}}v[v.length-1][1]===""&&v.pop();let F=!1;for(x=1;x<v.length-1;){const M=v[x-1],D=v[x+1];if(M[0]===0&&D[0]===0){const O=M[1],z=v[x],q=z[1],G=D[1];q.slice(q.length-O.length)===O?(v[x][1]=O+q.slice(0,q.length-O.length),D[1]=O+G,v.splice(x-1,1),F=!0):q.slice(0,G.length)===G&&(M[1]+=D[1],z[1]=q.slice(G.length)+G,v.splice(x+1,1),F=!0)}x++}F&&i(v,E)},s=(v,E,x,A)=>{if(x>0&&x<v.length){const L=v.charCodeAt(x);L>=56320&&L<=57343&&x--}if(A>0&&A<E.length){const L=E.charCodeAt(A);L>=56320&&L<=57343&&A--}const T=h(v.slice(0,x),E.slice(0,A),!1),k=h(v.slice(x),E.slice(A),!1);return T.concat(k)},o=(v,E)=>{const x=v.length,A=E.length,T=Math.ceil((x+A)/2),k=T,L=2*T,I=new Array(L),F=new Array(L);for(let K=0;K<L;K++)I[K]=-1,F[K]=-1;I[k+1]=0,F[k+1]=0;const M=x-A,D=M%2!==0;let O=0,z=0,q=0,G=0;for(let K=0;K<T;K++){for(let te=-K+O;te<=K-z;te+=2){const re=k+te;let H=0;const Y=I[re-1],Z=I[re+1];te===-K||te!==K&&Y<Z?H=Z:H=Y+1;let Q=H-te;for(;H<x&&Q<A&&v.charAt(H)===E.charAt(Q);)H++,Q++;if(I[re]=H,H>x)z+=2;else if(Q>A)O+=2;else if(D){const ie=k+M-te,ge=F[ie];if(ie>=0&&ie<L&&ge!==-1&&H>=x-ge)return s(v,E,H,Q)}}for(let te=-K+q;te<=K-G;te+=2){const re=k+te;let H=te===-K||te!==K&&F[re-1]<F[re+1]?F[re+1]:F[re-1]+1,Y=H-te;for(;H<x&&Y<A&&v.charAt(x-H-1)===E.charAt(A-Y-1);)H++,Y++;if(F[re]=H,H>x)G+=2;else if(Y>A)q+=2;else if(!D){const Z=k+M-te,Q=I[Z];if(Z>=0&&Z<L&&Q!==-1){const ie=k+Q-Z;if(H=x-H,Q>=H)return s(v,E,Q,ie)}}}}return[[-1,v],[1,E]]},a=(v,E)=>{if(!v)return[[1,E]];if(!E)return[[-1,v]];const x=v.length,A=E.length,T=x>A?v:E,k=x>A?E:v,L=k.length,I=T.indexOf(k);if(I>=0){const F=T.slice(0,I),M=T.slice(I+L);return x>A?[[-1,F],[0,k],[-1,M]]:[[1,F],[0,k],[1,M]]}return L===1?[[-1,v],[1,E]]:o(v,E)},c=(v,E)=>{if(!v||!E||v.charAt(0)!==E.charAt(0))return 0;let x=0,A=Math.min(v.length,E.length),T=A,k=0;for(;x<T;)v.slice(k,T)===E.slice(k,T)?(x=T,k=x):A=T,T=Math.floor((A-x)/2+x);const L=v.charCodeAt(T-1);return L>=55296&&L<=56319&&T--,T};t.pfx=c;const l=(v,E)=>{if(!v||!E||v.slice(-1)!==E.slice(-1))return 0;let x=0,A=Math.min(v.length,E.length),T=A,k=0;for(;x<T;)v.slice(v.length-T,v.length-k)===E.slice(E.length-T,E.length-k)?(x=T,k=x):A=T,T=Math.floor((A-x)/2+x);if(T>0&&T<v.length){const L=v.length-T-1,I=v.charCodeAt(L),F=I>=55296&&I<=56319,M=I===8205||I>=65024&&I<=65039||I>=768&&I<=879;if(F||M)for(T--;T>0;){const D=v.length-T-1;if(D<0)break;const O=v.charCodeAt(D),z=O>=55296&&O<=56319,q=O===8205||O>=65024&&O<=65039||O>=768&&O<=879;if(!z&&!q)break;T--}}return T};t.sfx=l;const u=(v,E)=>{const x=v.length,A=E.length;if(x===0||A===0)return 0;let T=x;if(x>A?(T=A,v=v.substring(x-A)):x<A&&(E=E.substring(0,x)),v===E)return T;let k=0,L=1;for(;;){const I=v.substring(T-L),F=E.indexOf(I);if(F===-1)return k;L+=F,(F===0||v.substring(T-L)===E.substring(0,L))&&(k=L,L++)}};t.overlap=u;const h=(v,E,x)=>{if(v===E)return v?[[0,v]]:[];const A=(0,t.pfx)(v,E),T=v.slice(0,A);v=v.slice(A),E=E.slice(A);const k=(0,t.sfx)(v,E),L=v.slice(v.length-k);v=v.slice(0,v.length-k),E=E.slice(0,E.length-k);const I=a(v,E);return T&&I.unshift([0,T]),L&&I.push([0,L]),i(I,x),I},f=(v,E)=>h(v,E,!0);t.diff=f;const d=(v,E,x)=>{e:{if(x<0)break e;const A=v.length,T=E.length;if(A===T)break e;const k=E.slice(x),L=k.length;if(L>A||v.slice(A-L)!==k)break e;if(T>A){const M=A-L,D=v.slice(0,M),O=E.slice(0,M);if(D!==O)break e;const z=E.slice(M,x),q=[];return D&&q.push([0,D]),z&&q.push([1,z]),k&&q.push([0,k]),q}else{const M=T-L,D=E.slice(0,M),O=v.slice(0,M);if(O!==D)break e;const z=v.slice(M,A-L),q=[];return O&&q.push([0,O]),z&&q.push([-1,z]),k&&q.push([0,k]),q}}return(0,t.diff)(v,E)};t.diffEdit=d;const p=v=>{let E="";const x=v.length;for(let A=0;A<x;A++){const T=v[A];T[0]!==1&&(E+=T[1])}return E};t.src=p;const m=v=>{let E="";const x=v.length;for(let A=0;A<x;A++){const T=v[A];T[0]!==-1&&(E+=T[1])}return E};t.dst=m;const g=v=>{const E=v[0];return E===0?v:E===1?[-1,v[1]]:[1,v[1]]},_=v=>v.map(g);t.invert=_;const y=(v,E,x,A)=>{const T=v.length;let k=E;for(let L=T-1;L>=0;L--){const[I,F]=v[L];if(I===0)k-=F.length;else if(I===1)x(k,F);else{const M=F.length;k-=M,A(k,M,F)}}};t.apply=y})($P)),$P}var GP={},WV;function wIe(){return WV||(WV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.dst=t.src=t.apply=t.diff=t.toBin=t.toStr=void 0;const n=ys.__importStar(R8()),r=l=>{let u="";const h=l.length;for(let f=0;f<h;f++)u+=String.fromCharCode(l[f]);return u};t.toStr=r;const i=l=>{const u=l.length,h=new Uint8Array(u);for(let f=0;f<u;f++)h[f]=l.charCodeAt(f);return h};t.toBin=i;const s=(l,u)=>{const h=(0,t.toStr)(l),f=(0,t.toStr)(u);return n.diff(h,f)};t.diff=s;const o=(l,u,h,f)=>n.apply(l,u,(d,p)=>h(d,(0,t.toBin)(p)),f);t.apply=o;const a=l=>(0,t.toBin)(n.src(l));t.src=a;const c=l=>(0,t.toBin)(n.dst(l));t.dst=c})(GP)),GP}var WP={},qV;function TIe(){return qV||(qV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.apply=t.diff=t.agg=void 0;const n=ys.__importStar(R8()),r=o=>{const a=[],c=o.length;let l=[];const u=(h,f)=>{if(!f.length)return;const d=l.length;if(d){const p=l[d-1];if(p[0]===h){p[1]+=f;return}}l.push([h,f])};e:for(let h=0;h<c;h++){const f=o[h],d=f[0],p=f[1],m=p.indexOf(`
`);if(m<0){u(d,p);continue e}else u(d,p.slice(0,m+1)),l.length&&a.push(l),l=[];let g=m;const _=p.length;t:for(;g<_;){const y=p.indexOf(`
`,g+1);if(y<0){u(d,p.slice(g+1));break t}a.push([[d,p.slice(g+1,y+1)]]),g=y}}l.length&&a.push(l);{const h=a.length;for(let f=0;f<h;f++){const d=a[f]=n.normalize(a[f]),p=d.length;e:{if(p<2)break e;const m=d[0],g=d[1],_=g[0];if(m[0]!==0||_!==-1&&_!==1)break e;for(let y=2;y<p;y++)if(d[y][0]!==_)break e;for(let y=f+1;y<h;y++){const v=a[y]=n.normalize(a[y]),E=v.length,x=m[1];let A,T;if(v.length>1&&(A=v[0])[0]===_&&(T=v[1])[0]===0&&x===A[1]){d.splice(0,1),g[1]=x+g[1],T[1]=x+T[1],v.splice(0,1);break e}else for(let k=0;k<E;k++)if(v[k][0]!==_)break e}}e:{if(d.length<2)break e;const m=d[d.length-1],g=m[1];if(m[0]!==-1)break e;t:for(let _=f+1;_<h;_++){const y=a[_]=n.normalize(a[_]),v=y.length;let E;if(v===0)continue t;if(v===1){if(E=y[0],E[0]===-1)continue t;if(y[0][0]!==0)break e}else if(E=y[1],v>2||y[0][0]!==-1)break e;const x=E[0];if(x===-1)continue t;if(x!==0)break e;const A=E[1];if(A.length>g.length||!g.endsWith(A))break e;const T=g.length-A.length;m[1]=g.slice(0,T),d.push([0,A]),E[0]=-1,a[f]=n.normalize(a[f]),a[_]=n.normalize(a[_]);break e}}}}return a};t.agg=r;const i=(o,a)=>{if(!a.length)return o.map((y,v)=>[-1,v,-1]);if(!o.length)return a.map((y,v)=>[1,-1,v]);const c=o.join(`
`)+`
`,l=a.join(`
`)+`
`;if(c===l)return[];const u=n.diff(c,l),h=(0,t.agg)(u),f=h.length,d=[];let p=-1,m=-1;const g=o.length,_=a.length;for(let y=0;y<f;y++){const v=h[y];let E=v.length;if(!E)continue;const x=v[E-1],A=x[0],T=x[1];if(T===`
`)v.splice(E-1,1);else{const L=T.length;T[L-1]===`
`&&(L===1?v.splice(E-1,1):x[1]=T.slice(0,L-1))}let k=0;if(E=v.length,!E)A===0?(k=0,p++,m++):A===1?(k=1,m++):A===-1&&(k=-1,p++);else if(y+1===f)p+1<g?m+1<_?(k=E===1&&v[0][0]===0?0:2,p++,m++):(k=-1,p++):(k=1,m++);else{const I=v[0][0];E===1&&I===A&&I===0?(p++,m++):A===0?(k=2,p++,m++):A===1?(k=1,m++):A===-1&&(k=-1,p++)}k===0&&o[p]!==a[m]&&(k=2),d.push([k,p,m])}return d};t.diff=i;const s=(o,a,c,l)=>{const u=o.length;e:for(let h=u-1;h>=0;h--){const[f,d,p]=o[h];switch(f){case 0:continue e;case-1:a(d);break;case 1:c(d,p);break;case 2:l(d,p);break}}};t.apply=s})(WP)),WP}var qP={},Gw={},YV;function CI(){if(YV)return Gw;YV=1,Object.defineProperty(Gw,"__esModule",{value:!0}),Gw.sort=void 0;const t=e=>{const n=e.length;for(let r=1;r<n;r++){const i=e[r];let s=r;for(;s!==0&&e[s-1]>i;)e[s]=e[s-1],s--;e[s]=i}return e};return Gw.sort=t,Gw}var YP={},KV;function k8(){return KV||(KV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.hash=t.updateJson=t.updateBin=t.updateStr=t.updateNum=t.CONST=void 0;const e=CI();var n;(function(c){c[c.START_STATE=5381]="START_STATE",c[c.NULL=982452847]="NULL",c[c.TRUE=982453247]="TRUE",c[c.FALSE=982454243]="FALSE",c[c.ARRAY=982452259]="ARRAY",c[c.STRING=982453601]="STRING",c[c.OBJECT=982454533]="OBJECT",c[c.BINARY=982454837]="BINARY"})(n||(t.CONST=n={}));const r=(c,l)=>(c<<5)+c+l;t.updateNum=r;const i=(c,l)=>{const u=l.length;c=(0,t.updateNum)(c,n.STRING),c=(0,t.updateNum)(c,u);let h=u;for(;h;)c=(c<<5)+c+l.charCodeAt(--h);return c};t.updateStr=i;const s=(c,l)=>{const u=l.length;c=(0,t.updateNum)(c,n.BINARY),c=(0,t.updateNum)(c,u);let h=u;for(;h;)c=(c<<5)+c+l[--h];return c};t.updateBin=s;const o=(c,l)=>{switch(typeof l){case"number":return(0,t.updateNum)(c,l);case"string":return c=(0,t.updateNum)(c,n.STRING),(0,t.updateStr)(c,l);case"object":{if(l===null)return(0,t.updateNum)(c,n.NULL);if(Array.isArray(l)){const f=l.length;c=(0,t.updateNum)(c,n.ARRAY);for(let d=0;d<f;d++)c=(0,t.updateJson)(c,l[d]);return c}if(l instanceof Uint8Array)return(0,t.updateBin)(c,l);c=(0,t.updateNum)(c,n.OBJECT);const u=(0,e.sort)(Object.keys(l)),h=u.length;for(let f=0;f<h;f++){const d=u[f];c=(0,t.updateStr)(c,d),c=(0,t.updateJson)(c,l[d])}return c}case"boolean":return(0,t.updateNum)(c,l?n.TRUE:n.FALSE)}return c};t.updateJson=o;const a=c=>(0,t.updateJson)(n.START_STATE,c)>>>0;t.hash=a})(YP)),YP}var KP={},XV;function hte(){return XV||(XV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.structHash=void 0;const e=CI(),n=k8(),r=ob(),i=s=>{switch(typeof s){case"string":return(0,n.hash)(s).toString(36);case"number":case"bigint":return s.toString(36);case"boolean":return s?"T":"F";case"object":if(s===null)return"N";if(s instanceof r.Timestamp)return(s.sid%2e6).toString(36)+"."+s.time.toString(36);if(Array.isArray(s)){const o=s.length;let a="[";for(let c=0;c<o;c++)a+=(0,t.structHash)(s[c])+";";return a+"]"}else{if(s instanceof Uint8Array)return(0,n.hash)(s).toString(36);{const o=Object.keys(s);(0,e.sort)(o);let a="{";const c=o.length;for(let l=0;l<c;l++){const u=o[l];a+=(0,n.hash)(u).toString(36)+":"+(0,t.structHash)(s[u])+","}return a+"}"}}default:return"U"}};t.structHash=i})(KP)),KP}var JV;function AIe(){return JV||(JV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.structHashCrdt=void 0;const e=CI(),n=yte(),r=k8(),i=hte(),s=o=>{if(o instanceof n.ConNode)return(0,i.structHash)(o.val);if(o instanceof n.ValNode)return(0,t.structHashCrdt)(o.node());if(o instanceof n.StrNode)return(0,r.hash)(o.view()).toString(36);if(o instanceof n.ObjNode){let a="{";const c=Array.from(o.keys.keys());(0,e.sort)(c);const l=c.length;for(let u=0;u<l;u++){const h=c[u],f=o.get(h);a+=(0,r.hash)(h).toString(36)+":"+(0,t.structHashCrdt)(f)+","}return a+"}"}else if(o instanceof n.ArrNode||o instanceof n.VecNode){let a="[";return o.children(c=>{a+=(0,t.structHashCrdt)(c)+";"}),a+"]"}else if(o instanceof n.BinNode)return(0,r.hash)(o.view()).toString(36);return"U"};t.structHashCrdt=s})(qP)),qP}var XP={},ZV;function CIe(){return ZV||(ZV=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.structHashSchema=void 0;const e=CI(),n=w8(),r=k8(),i=hte(),s=o=>{if(o instanceof n.nodes.con||o instanceof n.nodes.str||o instanceof n.nodes.bin)return(0,i.structHash)(o.raw);if(o instanceof n.nodes.val)return(0,t.structHashSchema)(o.value);if(o instanceof n.nodes.obj){let a="{";const c={...o.obj,...o.opt},l=Object.keys(c);(0,e.sort)(l);const u=l.length;for(let h=0;h<u;h++){const f=l[h],d=c[f];a+=(0,r.hash)(f).toString(36)+":"+(0,t.structHashSchema)(d)+","}return a+"}"}else if(o instanceof n.nodes.arr||o instanceof n.nodes.vec){let a="[";const c=o instanceof n.nodes.arr?o.arr:o.value;for(const l of c)a+=(0,t.structHashSchema)(l)+";";return a+"]"}return(0,i.structHash)(o)};t.structHashSchema=s})(XP)),XP}var QV;function fte(){if(QV)return Ny;QV=1,Object.defineProperty(Ny,"__esModule",{value:!0}),Ny.JsonCrdtDiff=Ny.DiffError=void 0;const t=ys,e=ute(),n=xIe(),r=ob(),i=Vg(),s=t.__importStar(R8()),o=t.__importStar(wIe()),a=t.__importStar(TIe()),c=AIe(),l=CIe();class u extends Error{constructor(d="DIFF"){super(d)}}Ny.DiffError=u;let h=class{constructor(d){this.model=d,this.builder=new r.PatchBuilder(d.clock.clone())}diffStr(d,p){const m=d.view();if(m===p)return;const g=this.builder;s.apply(s.diff(m,p),m.length,(_,y)=>g.insStr(d.id,_?d.find(_-1):d.id,y),(_,y)=>g.del(d.id,d.findInterval(_,y)))}diffBin(d,p){const m=d.view();if((0,n.cmpUint8Array)(m,p))return;const g=this.builder;o.apply(o.diff(m,p),m.length,(_,y)=>g.insBin(d.id,_?d.find(_-1):d.id,y),(_,y)=>g.del(d.id,d.findInterval(_,y)))}diffArr(d,p){if(d.size()===0){const T=p.length;if(T===0)return;let k=d.id;for(let L=0;L<T;L++)k=this.builder.insArr(d.id,k,[this.buildView(p[L])]);return}else if(p.length===0){const T=[];for(const k of d.chunks()){if(k.del)continue;const L=k.id;T.push((0,r.tss)(L.sid,L.time,k.span))}T.length&&this.builder.del(d.id,T);return}const m=[];d.children(T=>m.push((0,c.structHashCrdt)(T)));const g=[],_=p.length;for(let T=0;T<_;T++)g.push((0,l.structHashSchema)(p[T]));const y=a.diff(m,g);if(!y.length)return;const v=[],E=[];a.apply(y,T=>{const k=d.findInterval(T,1);if(!k||!k.length)throw new u;E.push(...k)},(T,k)=>{const L=p[k],I=T>=0?d.find(T):d.id;if(!I)throw new u;v.push([I,[L]])},(T,k)=>{const L=p[k];try{this.diffAny(d.getNode(T),L)}catch(I){if(I instanceof u){const F=d.findInterval(T,1);E.push(...F);const M=T?d.find(T-1):d.id;if(!M)throw new u;v.push([M,[L]])}else throw I}});const x=this.builder,A=v.length;for(let T=0;T<A;T++){const[k,L]=v[T];x.insArr(d.id,k,L.map(I=>this.buildView(I)))}E.length&&x.del(d.id,E)}diffObj(d,p){const m=this.builder,g=[],_=new Set;d.forEach(E=>{_.add(E),p[E]===void 0&&g.push([E,m.con(void 0)])});const y=Object.keys(p),v=y.length;for(let E=0;E<v;E++){const x=y[E],A=p[x];if(_.has(x)){const T=d.get(x);if(T)try{this.diffAny(T,A);continue}catch(k){if(!(k instanceof u))throw k}}g.push([x,this.buildConView(A)])}g.length&&m.insObj(d.id,g)}diffVec(d,p){const m=this.builder,g=[],_=d.elements,y=_.length,v=p.length,E=d.doc.index,x=Math.min(y,v);for(let A=v;A<y;A++){const T=_[A];if(T){const k=E.get(T);if(!k||k instanceof i.ConNode&&k.val===void 0)continue;g.push([A,m.con(void 0)])}}e:for(let A=0;A<x;A++){const T=p[A],k=d.get(A);if(k){try{this.diffAny(k,T);continue}catch(L){if(!(L instanceof u))throw L}if(k instanceof i.ConNode&&typeof T!="object"){const L=m.con(T);g.push([A,L]);continue e}}g.push([A,this.buildConView(T)])}for(let A=y;A<v;A++)g.push([A,this.buildConView(p[A])]);g.length&&m.insVec(d.id,g)}diffVal(d,p){try{this.diffAny(d.node(),p)}catch(m){if(m instanceof u)this.builder.setVal(d.id,this.buildConView(p));else throw m}}diffAny(d,p){if(d instanceof i.ConNode){p instanceof r.nodes.con&&(p=p.raw);const m=d.val;if(m!==p&&(m instanceof r.Timestamp&&!(p instanceof r.Timestamp)||!(m instanceof r.Timestamp)&&p instanceof r.Timestamp||!(0,e.deepEqual)(d.val,p)))throw new u}else if(d instanceof i.StrNode){if(p instanceof r.nodes.str&&(p=p.raw),typeof p!="string")throw new u;this.diffStr(d,p)}else if(d instanceof i.ObjNode){if(p instanceof r.nodes.obj&&(p=p.opt?{...p.obj,...p.opt}:p.obj),p instanceof r.NodeBuilder)throw new u;if(p instanceof Uint8Array)throw new u;if(!p||typeof p!="object"||Array.isArray(p))throw new u;this.diffObj(d,p)}else if(d instanceof i.ValNode)p instanceof r.nodes.val&&(p=p.value),this.diffVal(d,p);else if(d instanceof i.ArrNode){if(p instanceof r.nodes.arr&&(p=p.arr),!Array.isArray(p))throw new u;this.diffArr(d,p)}else if(d instanceof i.VecNode){if(p instanceof r.nodes.vec&&(p=p.value),!Array.isArray(p))throw new u;this.diffVec(d,p)}else if(d instanceof i.BinNode){if(p instanceof r.nodes.bin&&(p=p.raw),!(p instanceof Uint8Array))throw new u;this.diffBin(d,p)}else throw new u}diff(d,p){return this.diffAny(d,p),this.builder.flush()}diffDstKeys(d,p){const m=this.builder,g=[],_=Object.keys(p),y=_.length;for(let v=0;v<y;v++){const E=_[v],x=d.get(E),A=p[E];if(!x){g.push([E,this.buildConView(A)]);continue}try{this.diffAny(x,A)}catch(T){if(T instanceof u)g.push([E,this.buildConView(A)]);else throw T}}return g.length&&m.insObj(d.id,g),this.builder.flush()}buildView(d){const p=this.builder;return d instanceof r.Timestamp?p.con(d):d instanceof r.nodes.con?p.con(d.raw):p.json(d)}buildConView(d){const p=this.builder;return d instanceof r.Timestamp?p.con(d):d instanceof r.nodes.con?p.con(d.raw):p.constOrJson(d)}};return Ny.JsonCrdtDiff=h,Ny}var JP={},eH;function RIe(){return eH||(eH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.merge=t.diff=void 0;const e=fte(),n=(i,s)=>{const a=new e.JsonCrdtDiff(i.api.model).diff(i.node,s);return a.ops.length?a:void 0};t.diff=n;const r=(i,s)=>{const o=(0,t.diff)(i,s);return o&&i.api.model.applyLocalPatch(o),o};t.merge=r})(JP)),JP}var ZP={},tH;function kIe(){return tH||(tH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.proxy$=t.proxy=void 0;const e=(r,i=[])=>new Proxy(()=>{},{get:(s,o,a)=>(i.push(String(o)),(0,t.proxy)(r,i)),apply:(s,o,a)=>r(i,...a)});t.proxy=e;const n=(r,i,s=[])=>new Proxy({},{get:(o,a,c)=>a===i?r(s):(s.push(String(a)),(0,t.proxy$)(r,i,s))});t.proxy$=n})(ZP)),ZP}var nH;function MIe(){if(nH)return Aa;nH=1,Object.defineProperty(Aa,"__esModule",{value:!0}),Aa.ModelApi=Aa.ArrApi=Aa.BinApi=Aa.StrApi=Aa.ObjApi=Aa.VecApi=Aa.ValApi=Aa.ConApi=Aa.NodeApi=void 0;const t=ys,e=hf(),n=ote(),r=C8(),i=yIe(),s=Vg(),o=bIe(),a=cte(),c=T8(),l=lte(),u=SIe(),h=fte(),f=t.__importStar(RIe()),d=Xo(),p=kIe(),m=L=>{if(!L)return[void 0,""];if(typeof L=="number")return[void 0,L];switch(typeof L=="string"&&(L=(0,r.toPath)(L)),L.length){case 0:return[void 0,""];case 1:return[void 0,L[0]];default:{const I=L[L.length-1];return[L.slice(0,-1),I]}}};class g{constructor(I,F){this.node=I,this.api=F,this.ev=void 0}get events(){return this.ev||(this.ev=new o.NodeEvents(this))}find(I){let F=this.node;if(I===void 0){if(typeof F.child=="function"){const M=F.child();if(!M){if(F instanceof s.RootNode)return F;throw new Error("NO_CHILD")}return M}throw new Error("CANNOT_IN")}for(typeof I=="string"&&I&&I[0]!=="/"&&(I="/"+I),typeof I=="number"&&(I=[I]);F instanceof s.ValNode;)F=F.child();return(0,i.find)(F,I)}in(I){const F=this.find(I);return this.api.wrap(F)}asVal(){if(this.node instanceof s.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof s.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof s.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof s.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof s.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof s.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof s.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(I){let F;const M=this.node;if(M instanceof u.ExtNode&&(F=M),M instanceof s.VecNode&&(F=M.ext()),!F)throw new Error("NOT_EXT");const D=this.api.wrap(F);if(!I||D instanceof I.Api)return D;throw new Error("NOT_EXT")}val(I){return this.in(I).asVal()}str(I){return this.in(I).asStr()}bin(I){return this.in(I).asBin()}arr(I){return this.in(I).asArr()}vec(I){return this.in(I).asVec()}obj(I){return this.in(I).asObj()}con(I){return this.in(I).asCon()}view(){return this.node.view()}select(I,F){try{let M=I!==void 0?this.find(I):this.node;if(F)for(;M instanceof s.ValNode;)M=M.child();return this.api.wrap(M)}catch{return}}read(I){const F=this.view();if(Array.isArray(I))return(0,n.get)(F,I);if(!I)return F;let M=I+"";return I&&M[0]!=="/"&&(M="/"+M),(0,n.get)(F,(0,r.toPath)(M))}add(I,F){const[M,D]=m(I);e:try{const O=this.select(M,!0);if(O instanceof E)O.set({[D]:F});else if(O instanceof T||O instanceof x||O instanceof A){const z=O.length();let q=0;if(typeof D=="number")q=D;else if(D==="-")q=z;else if(q=~~D,q+""!==D)break e;if(q!==q)break e;if(q<0&&(q=0),q>z&&(q=z),O instanceof T)O.ins(q,Array.isArray(F)?F:[F]);else if(O instanceof x)O.ins(q,F+"");else if(O instanceof A){if(!(F instanceof Uint8Array))break e;O.ins(q,F)}}else if(O instanceof v)O.set([[~~D,F]]);else break e;return!0}catch{}return!1}replace(I,F){const[M,D]=m(I);e:try{const O=this.select(M,!0);if(O instanceof E){const z=D+"";if(!O.has(z))break e;O.set({[D]:F})}else if(O instanceof T){const z=O.length();let q=0;if(typeof D=="number")q=D;else if(q=~~D,q+""!==D)break e;if(q!==q||q<0||q>z)break e;q===z?O.ins(q,[F]):O.upd(q,F)}else if(O instanceof v)O.set([[~~D,F]]);else break e;return!0}catch{}return!1}remove(I,F=1){const[M,D]=m(I);e:try{const O=this.select(M,!0);if(O instanceof E){const z=D+"";if(!O.has(z))break e;O.del([z])}else if(O instanceof T||O instanceof x||O instanceof A){const z=O.length();let q=0;if(typeof D=="number")q=D;else if(D==="-")q=F;else if(q=~~D,q+""!==D)break e;if(q!==q||q<0||q>z)break e;O.del(q,Math.min(F,z-q))}else if(O instanceof v)O.set([[~~D,void 0]]);else break e;return!0}catch{}return!1}diff(I){return f.diff(this,I)}merge(I){return f.merge(this,I)}op(I){if(!Array.isArray(I))return!1;const[F,M,D]=I;switch(F){case"add":return this.add(M,D);case"replace":return this.replace(M,D);case"merge":return!!this.select(M)?.merge(D);case"remove":return this.remove(M,D)}}get s(){return{$:this}}get $(){return(0,p.proxy$)(I=>{try{return this.api.wrap(this.find(I))}catch{return}},"$")}toString(I=""){return"api("+(this.constructor===g?"*":this.node.name())+")"+(0,e.printTree)(I,[M=>this.node.toString(M)])}}Aa.NodeApi=g;class _ extends g{get s(){return{$:this}}}Aa.ConApi=_;class y extends g{get(){return this.in()}set(I){const{api:F,node:M}=this,O=F.builder.constOrJson(I);F.builder.setVal(M.id,O),F.apply()}get s(){const I=this;return{$:this,get _(){const M=I.node.node();return I.api.wrap(M).s}}}}Aa.ValApi=y;class v extends g{get(I){return this.in(I)}set(I){const{api:F,node:M}=this,{builder:D}=F;D.insVec(M.id,I.map(([O,z])=>[O,D.constOrJson(z)])),F.apply()}push(...I){const F=this.length();this.set(I.map((M,D)=>[F+D,M]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(F,M,D)=>{if(M==="$")return this;if(M==="toExt")return()=>this.asExt();const O=Number(M);if(Number.isNaN(O))throw new Error("INVALID_INDEX");const z=this.node.get(O);if(!z)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(z).s}})}}Aa.VecApi=v;class E extends g{get(I){return this.in(I)}set(I){const{api:F,node:M}=this,{builder:D}=F;D.insObj(M.id,Object.entries(I).map(([O,z])=>[O,D.constOrJson(z)])),F.apply()}del(I){const{api:F,node:M}=this,{builder:D}=F;F.builder.insObj(M.id,I.map(O=>[O,D.con(void 0)])),F.apply()}has(I){return this.node.keys.has(I)}diffKeys(I){const M=new h.JsonCrdtDiff(this.api.model).diffDstKeys(this.node,I);return M.ops.length?M:void 0}mergeKeys(I){const F=this.diffKeys(I);return F&&this.api.model.applyLocalPatch(F),F}get s(){return new Proxy({},{get:(F,M,D)=>{if(M==="$")return this;const O=String(M),z=this.node.get(O);if(!z)throw new Error("NO_SUCH_KEY");return this.api.wrap(z).s}})}}Aa.ObjApi=E;class x extends g{ins(I,F){const{api:M,node:D}=this;M.onBeforeLocalChange.emit(M.next);const O=M.builder;O.pad();const z=M.builder.nextTime(),q=new d.Timestamp(O.clock.sid,z),G=D.insAt(I,q,F);if(!G)throw new Error("OUT_OF_BOUNDS");O.insStr(D.id,G,F),M.advance()}del(I,F){const{api:M,node:D}=this;M.onBeforeLocalChange.emit(M.next);const O=M.builder;O.pad();const z=D.findInterval(I,F);if(!z)throw new Error("OUT_OF_BOUNDS");D.delete(z),O.del(D.id,z),M.advance()}findId(I){const F=this.node,D=F.length()-1;return I>D&&(I=D),I<0?F.id:F.find(I)||F.id}findPos(I){const F=this.node,M=F.id;if(M.sid===I.sid&&M.time===I.time)return-1;const D=F.findById(I);return D?F.pos(D)+(D.del?0:I.time-D.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}Aa.StrApi=x;class A extends g{ins(I,F){const{api:M,node:D}=this,O=I?D.find(I-1):D.id;if(!O)throw new Error("OUT_OF_BOUNDS");M.builder.insBin(D.id,O,F),M.apply()}del(I,F){const{api:M,node:D}=this,O=D.findInterval(I,F);if(!O)throw new Error("OUT_OF_BOUNDS");M.builder.del(D.id,O),M.apply()}length(){return this.node.length()}get s(){return{$:this}}}Aa.BinApi=A;class T extends g{get(I){return this.in(I)}ins(I,F){const{api:M,node:D}=this,{builder:O}=M,z=I?D.find(I-1):D.id;if(!z)throw new Error("OUT_OF_BOUNDS");const q=[];for(let G=0;G<F.length;G++)q.push(O.json(F[G]));O.insArr(D.id,z,q),M.apply()}push(...I){const F=this.length();this.ins(F,I)}upd(I,F){const{api:M,node:D}=this,O=D.getId(I);if(!O)throw new Error("OUT_OF_BOUNDS");const{builder:z}=M;z.updArr(D.id,O,z.constOrJson(F)),M.apply()}del(I,F){const{api:M,node:D}=this,O=D.findInterval(I,F);if(!O)throw new Error("OUT_OF_BOUNDS");M.builder.del(D.id,O),M.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(F,M,D)=>{if(M==="$")return this;const O=Number(M);if(Number.isNaN(O))throw new Error("INVALID_INDEX");const z=this.node.getNode(O);if(!z)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(z).s}})}}Aa.ArrApi=T;class k extends y{constructor(I){super(I.root,void 0),this.model=I,this.next=0,this.onBeforeReset=new a.FanOut,this.onReset=new a.FanOut,this.onBeforePatch=new a.FanOut,this.onPatch=new a.FanOut,this.onBeforeLocalChange=new a.FanOut,this.onLocalChange=new a.FanOut,this.onLocalChanges=new l.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new a.FanOut,this.onTransaction=new a.FanOut,this.onChange=new l.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new l.MicrotaskBufferFanOut(this.onChange),this.onFlush=new a.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=F=>this.onChanges.listen(()=>F()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new c.PatchBuilder(I.clock),I.onbeforereset=()=>this.onBeforeReset.emit(),I.onreset=()=>this.onReset.emit(),I.onbeforepatch=F=>this.onBeforePatch.emit(F),I.onpatch=F=>this.onPatch.emit(F)}wrap(I){if(I instanceof s.ValNode)return I.api||(I.api=new y(I,this));if(I instanceof s.StrNode)return I.api||(I.api=new x(I,this));if(I instanceof s.BinNode)return I.api||(I.api=new A(I,this));if(I instanceof s.ArrNode)return I.api||(I.api=new T(I,this));if(I instanceof s.ObjNode)return I.api||(I.api=new E(I,this));if(I instanceof s.ConNode)return I.api||(I.api=new _(I,this));if(I instanceof s.VecNode)return I.api||(I.api=new v(I,this));if(I instanceof u.ExtNode){if(I.api)return I.api;const F=this.model.ext.get(I.extId);return I.api=new F.Api(I,this)}else throw new Error("UNKNOWN_NODE")}root(I){return this.set(I)}set(I){return super.set(I),this}apply(){const I=this.builder.patch.ops,F=I.length,M=this.model,D=this.next;this.onBeforeLocalChange.emit(D);for(let O=this.next;O<F;O++)M.applyOperation(I[O]);this.next=F,M.tick++,this.onLocalChange.emit(D)}advance(){const I=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(I)}transaction(I){if(this.inTx)I();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),I(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const I=this.builder.flush();return this.next=0,I.ops.length&&this.onFlush.emit(I),I}autoFlush(I=!1){const F=()=>this.builder.patch.ops.length&&this.flush(),M=this.onLocalChanges.listen(F),D=this.onBeforeTransaction.listen(F),O=this.onTransaction.listen(F);return I&&F(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,M(),D(),O()}}}return Aa.ModelApi=k,Aa}var rH;function dte(){return rH||(rH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),ys.__exportStar(MIe(),t)})(LP)),LP}var Ww={},iH;function OIe(){if(iH)return Ww;iH=1,Object.defineProperty(Ww,"__esModule",{value:!0}),Ww.randomSessionId=void 0;const t=65535,e=9007199254740991-t,n=()=>Math.floor(e*Math.random()+t);return Ww.randomSessionId=n,Ww}var qw={},sH;function IIe(){if(sH)return qw;sH=1,Object.defineProperty(qw,"__esModule",{value:!0}),qw.Extensions=void 0;const t=hf();let e=class pte{constructor(){this.ext={}}register(r){this.ext[r.id]=r}get(r){return this.ext[r]}size(){return Object.keys(this.ext).length}clone(){const r=new pte;for(const i of Object.values(this.ext))r.register(i);return r}toString(r=""){const i=Object.keys(this.ext).map(s=>+s).sort();return"extensions"+(0,t.printTree)(r,i.map(s=>o=>`${s}: ${this.ext[s].name}`))}};return qw.Extensions=e,qw}var Py={},QP={},e2={},oH;function NIe(){return oH||(oH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),ys.__exportStar(TI(),t)})(e2)),e2}var aH;function PIe(){return aH||(aH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.print=t.remove=t.insert=t.insertLeft=t.insertRight=void 0;const e=NIe(),n=JSON.stringify,r=(m,g,_)=>{const y=g.p;if(!y)return m;const v=g===y.l;let E=y.bf|0;switch(v?y.bf=++E:y.bf=--E,E){case 0:return m;case 1:case-1:return r(m,y,g);default:{const x=_===g.l;return v?x?(i(y,g),g.p?m:g):(o(y,g,_),_.p?m:_):x?(a(y,g,_),_.p?m:_):(s(y,g),g.p?m:g)}}},i=(m,g)=>{const _=m.p,y=g.r;g.p=_,g.r=m,m.p=g,m.l=y,y&&(y.p=m),_&&(_.l===m?_.l=g:_.r=g);let v=m.bf,E=g.bf;v+=-1-(E>0?E:0),E+=-1+(v<0?v:0),m.bf=v,g.bf=E},s=(m,g)=>{const _=m.p,y=g.l;g.p=_,g.l=m,m.p=g,m.r=y,y&&(y.p=m),_&&(_.l===m?_.l=g:_.r=g);let v=m.bf,E=g.bf;v+=1-(E<0?E:0),E+=1+(v>0?v:0),m.bf=v,g.bf=E},o=(m,g,_)=>{s(g,_),i(m,_)},a=(m,g,_)=>{i(g,_),s(m,_)},c=(m,g,_)=>(_.r=g,g.p=_,_.bf--,_.l?m:r(m,_,g));t.insertRight=c;const l=(m,g,_)=>(_.l=g,g.p=_,_.bf++,_.r?m:r(m,_,g));t.insertLeft=l;const u=(m,g,_)=>{if(!m)return g;const y=g.k;let v=m,E,x=0;for(;E=(x=_(y,v.k))<0?v.l:v.r;)v=E;return x<0?(0,t.insertLeft)(m,g,v):(0,t.insertRight)(m,g,v)};t.insert=u;const h=(m,g)=>{if(!m)return g;const _=g.p,y=g.l,v=g.r;if(g.p=g.l=g.r=void 0,y&&v)if(y.r){let A=y,T=A;for(;T=A.r;)A=T;const k=A.l,L=A.p,I=k;return _&&(_.l===g?_.l=A:_.r=A),A.p=_,A.r=v,A.bf=g.bf,y!==A&&(A.l=y,y.p=A),v.p=A,L&&(L.l===A?L.l=I:L.r=I),I&&(I.p=L),d(_?m:A,L,1)}else{_&&(_.l===g?_.l=y:_.r=y),y.p=_,y.r=v,v.p=y;const A=g.bf;if(_)return y.bf=A,f(m,y,1);const T=A-1;if(y.bf=T,T>=-1)return y;const k=v.l;return v.bf>0?(a(y,v,k),k):(s(y,v),v)}const E=y||v;return E&&(E.p=_),_?_.l===g?(_.l=E,f(m,_,1)):(_.r=E,d(m,_,1)):E};t.remove=h;const f=(m,g,_)=>{let y=g.bf|0;y-=_,g.bf=y;let v=_;if(y===-1)return m;if(y<-1){const x=g.r;if(x.bf<=0)x.l&&x.bf===0&&(v=0),s(g,x),g=x;else{const A=x.l;a(g,x,A),g=A}}const E=g.p;return E?E.l===g?f(m,E,v):d(m,E,v):g},d=(m,g,_)=>{let y=g.bf|0;y+=_,g.bf=y;let v=_;if(y===1)return m;if(y>1){const x=g.l;if(x.bf>=0)x.r&&x.bf===0&&(v=0),i(g,x),g=x;else{const A=x.r;o(g,x,A),g=A}}const E=g.p;return E?E.l===g?f(m,E,v):d(m,E,v):g},p=(m,g="")=>{if(!m)return"";const{bf:_,l:y,r:v,k:E,v:x}=m,A=x&&typeof x=="object"&&x.constructor===Object?n(x):x&&typeof x=="object"?x.toString(g):n(x),T=E!==void 0?` { ${n(E)} = ${A} }`:"",k=_?` [${_}]`:"";return m.constructor.name+`${k}`+T+(0,e.printBinary)(g,[y?L=>(0,t.print)(y,L):null,v?L=>(0,t.print)(v,L):null])};t.print=p})(QP)),QP}var Yw={},t2={},Kw={},cH;function mte(){if(cH)return Kw;cH=1,Object.defineProperty(Kw,"__esModule",{value:!0}),Kw.first=void 0;const t=e=>{let n=e;for(;n;)if(n.l)n=n.l;else return n;return n};return Kw.first=t,Kw}var Xw={},lH;function DIe(){if(lH)return Xw;lH=1,Object.defineProperty(Xw,"__esModule",{value:!0}),Xw.next=void 0;const t=mte(),e=n=>{const r=n.r;if(r)return(0,t.first)(r);let i=n.p;for(;i&&i.r===n;)n=i,i=i.p;return i};return Xw.next=e,Xw}var uH;function M8(){return uH||(uH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.remove=t.insert=t.insertLeft=t.insertRight=t.findOrNextLower=t.find=t.size=t.prev=t.last=t.next=t.first=void 0;const e=mte();Object.defineProperty(t,"first",{enumerable:!0,get:function(){return e.first}});const n=DIe();Object.defineProperty(t,"next",{enumerable:!0,get:function(){return n.next}});const r=d=>{let p=d;for(;p;)if(p.r)p=p.r;else return p;return p};t.last=r;const i=d=>{if(d.l){for(d=d.l;d.r;)d=d.r;return d}let p=d.p;for(;p&&p.l===d;)d=p,p=p.p;return p};t.prev=i;const s=d=>{const p=d.l,m=d.r;return 1+(p?s(p):0)+(m?s(m):0)},o=d=>d?s(d):0;t.size=o;const a=(d,p,m)=>{let g=d;for(;g;){const _=m(p,g.k);if(_===0)return g;g=_<0?g.l:g.r}return g};t.find=a;const c=(d,p,m)=>{let g=d,_;for(;g;){const y=m(g.k,p);if(y===0)return g;if(y>0)g=g.l;else{const v=g.r;if(_=g,!v)return _;g=v}}return _};t.findOrNextLower=c;const l=(d,p)=>{const m=d.r=p.r;p.r=d,d.p=p,m&&(m.p=d)};t.insertRight=l;const u=(d,p)=>{const m=d.l=p.l;p.l=d,d.p=p,m&&(m.p=d)};t.insertLeft=u;const h=(d,p,m)=>{if(!d)return p;const g=p.k;let _=d;for(;_;){const y=m(g,_.k),v=y<0?_.l:_.r;if(v)_=v;else{y<0?(0,t.insertLeft)(p,_):(0,t.insertRight)(p,_);break}}return d};t.insert=h;const f=(d,p)=>{const m=p.p,g=p.l,_=p.r;if(p.p=p.l=p.r=void 0,!g&&!_){if(m)m.l===p?m.l=void 0:m.r=void 0;else return;return d}else if(g&&_){let v=g;for(;v.r;)v=v.r;return v.r=_,_.p=v,m?(m.l===p?m.l=g:m.r=g,g.p=m,d):(g.p=void 0,g)}const y=g||_;if(y.p=m,m)m.l===p?m.l=y:m.r=y;else return y;return d};t.remove=f})(t2)),t2}var n2={},hH;function LIe(){return hH||(hH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),ys.__exportStar(hf(),t)})(n2)),n2}var fH;function UIe(){if(fH)return Yw;fH=1,Object.defineProperty(Yw,"__esModule",{value:!0}),Yw.createMap=void 0;const t=M8(),e=LIe(),n=(i,s)=>i===s?0:i<s?-1:1,r=(i,s,o,a,c,l)=>{class u{constructor(f){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=t.next,this.comparator=f||n}set(f,d){const p=this.root;if(p===void 0){this._size=1;const E=new i(f,d);return this.root=this.min=this.max=s(void 0,E,this.comparator)}const m=this.comparator;let g;const _=this.max;if(g=m(f,_.k),g===0)return _.v=d,_;if(g>0){const E=this.max=new i(f,d);return this.root=a(p,E,_),this._size++,E}const y=this.min;if(g=m(f,y.k),g===0)return y.v=d,y;if(g<0){const E=this.min=new i(f,d);return this.root=o(p,E,y),this._size++,E}let v=p;do{if(g=m(f,v.k),g===0)return v.v=d,v;if(g>0){const E=v.r;if(E===void 0){const x=new i(f,d);return this.root=a(p,x,v),this._size++,x}v=E}else if(g<0){const E=v.l;if(E===void 0){const x=new i(f,d);return this.root=o(p,x,v),this._size++,x}v=E}}while(!0)}find(f){const d=this.comparator;let p=this.root;for(;p;){const m=+d(f,p.k);if(m===0)return p;p=m<0?p.l:p.r}}get(f){return this.find(f)?.v}del(f){const d=this.find(f);return d?(d===this.max&&(this.max=(0,t.prev)(d)),d===this.min&&(this.min=(0,t.next)(d)),this.root=c(this.root,d),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(f){return!!this.find(f)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(f){return(0,t.findOrNextLower)(this.root,f,this.comparator)||void 0}forEach(f){let d=this.first();if(d)do f(d);while(d=(0,t.next)(d))}first(){return this.min}last(){return this.max}iterator0(){let f=this.first();return()=>{if(!f)return;const d=f;return f=(0,t.next)(f),d}}iterator(){const f=this.iterator0();return{next:()=>{const d=f();return{value:d,done:!d}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(f){return this.constructor.name+(0,e.printTree)(f,[d=>l(this.root,d)])}}return u};return Yw.createMap=r,Yw}var dH;function gte(){if(dH)return Py;dH=1,Object.defineProperty(Py,"__esModule",{value:!0}),Py.AvlMap=Py.AvlNode=void 0;const t=PIe(),e=UIe();class n{constructor(i,s){this.k=i,this.v=s,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return Py.AvlNode=n,Py.AvlMap=(0,e.createMap)(n,t.insert,t.insertLeft,t.insertRight,t.remove,t.print),Py}var pH;function O8(){if(pH)return My;pH=1,Object.defineProperty(My,"__esModule",{value:!0}),My.Model=My.UNDEFINED=void 0;const t=ys,e=t.__importStar(yC()),n=t.__importStar(Xo()),r=dIe(),i=dte(),s=wI(),o=OIe(),a=Vg(),c=AI(),l=hf(),u=IIe(),h=gte(),f=ob();My.UNDEFINED=new c.ConNode(s.ORIGIN,void 0);let d=class n4{rndSid(){const m=this.clock,g=m.sid,_=m.peers;for(;;){const y=(0,o.randomSessionId)();if(g!==y&&!_.has(y))return y}}static fromPatches(m){if(!m.length)throw new Error("NO_PATCHES");const y=m[0].getId().sid;if(!y)throw new Error("NO_SID");const v=n4.create(void 0,y);return v.applyBatch(m),v}constructor(m){this.root=new a.RootNode(this,s.ORIGIN),this.index=new h.AvlMap(n.compare),this.ext=new u.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=m,m.time||(m.time=1)}get api(){return this._api||(this._api=new i.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(m){const g=m.length;for(let _=0;_<g;_++)this.applyPatch(m[_])}applyLocalPatch(m){const g=m.getId();if(g){const _=this.clock;if(_.sid===g.sid){const y=_.time;y>g.time&&(m=m.rebase(y))}}this.applyPatch(m)}applyPatch(m){this.onbeforepatch?.(m);const g=m.ops,{length:_}=g;for(let y=0;y<_;y++)this.applyOperation(g[y]);this.tick++,this.onpatch?.(m)}applyOperation(m){this.clock.observe(m.id,m.span());const g=this.index;if(m instanceof e.InsStrOp){const _=g.get(m.obj);_ instanceof a.StrNode&&_.ins(m.ref,m.id,m.data)}else if(m instanceof e.NewObjOp){const _=m.id;g.get(_)||g.set(_,new a.ObjNode(this,_))}else if(m instanceof e.NewArrOp){const _=m.id;g.get(_)||g.set(_,new a.ArrNode(this,_))}else if(m instanceof e.NewStrOp){const _=m.id;g.get(_)||g.set(_,new a.StrNode(_))}else if(m instanceof e.NewValOp){const _=m.id;g.get(_)||g.set(_,new a.ValNode(this,_,s.ORIGIN))}else if(m instanceof e.NewConOp){const _=m.id;g.get(_)||g.set(_,new c.ConNode(_,m.val))}else if(m instanceof e.InsObjOp){const _=g.get(m.obj),y=m.data,v=y.length;if(_ instanceof a.ObjNode)for(let E=0;E<v;E++){const x=y[E],A=g.get(x[1]);if(!A||_.id.time>=x[1].time)continue;const T=_.put(x[0]+"",A.id);T&&this._gcTree(T)}}else if(m instanceof e.InsVecOp){const _=g.get(m.obj),y=m.data,v=y.length;if(_ instanceof a.VecNode)for(let E=0;E<v;E++){const x=y[E],A=g.get(x[1]);if(!A||_.id.time>=x[1].time)continue;const T=_.put(Number(x[0]),A.id);T&&this._gcTree(T)}}else if(m instanceof e.InsValOp){const _=m.obj,y=_.sid===0&&_.time===0?this.root:g.get(_);if(y instanceof a.ValNode&&g.get(m.val)){const E=y.set(m.val);E&&this._gcTree(E)}}else if(m instanceof e.InsArrOp){const _=g.get(m.obj);if(_ instanceof a.ArrNode){const y=[],v=m.data,E=v.length;for(let x=0;x<E;x++){const A=v[x];g.get(A)&&(_.id.time>=A.time||y.push(A))}y.length&&_.ins(m.ref,m.id,y)}}else if(m instanceof e.UpdArrOp){const _=g.get(m.obj);if(_ instanceof a.ArrNode){const y=m.val;if(g.get(y)){const v=_.upd(m.ref,y);v&&this._gcTree(v)}}}else if(m instanceof e.DelOp){const _=g.get(m.obj);if(_ instanceof a.ArrNode){const y=m.what.length;for(let v=0;v<y;v++){const E=m.what[v];for(let x=0;x<E.span;x++){const A=_.getById(new n.Timestamp(E.sid,E.time+x));A&&this._gcTree(A)}}_.delete(m.what)}else(_ instanceof a.StrNode||_ instanceof a.BinNode)&&_.delete(m.what)}else if(m instanceof e.NewBinOp){const _=m.id;g.get(_)||g.set(_,new a.BinNode(_))}else if(m instanceof e.InsBinOp){const _=g.get(m.obj);_ instanceof a.BinNode&&_.ins(m.ref,m.id,m.data)}else if(m instanceof e.NewVecOp){const _=m.id;g.get(_)||g.set(_,new a.VecNode(this,_))}}_gcTree(m){if(m.sid===0)return;const _=this.index.get(m);if(!_)return;const y=_.api;y&&y.events.handleDelete(),_.children(v=>this._gcTree(v.id)),this.index.del(m)}fork(m=this.rndSid()){const g=n4.fromBinary(this.toBinary());return g.clock.sid!==m&&g.clock instanceof n.ClockVector&&(g.clock=g.clock.fork(m)),g.ext=this.ext,g}clone(){return this.fork(this.clock.sid)}reset(m){this.onbeforereset?.();const g=this.index;this.index=new h.AvlMap(n.compare);const _=m.toBinary();r.decoder.decode(_,this),this.clock=m.clock.clone(),this.ext=m.ext.clone();const y=this._api;y&&(y.flush(),y.builder.clock=this.clock,y.node=this.root),g.forEach(({v})=>{const E=v.api;if(!E)return;const x=this.index.get(v.id);if(!x){E.events.handleDelete();return}E.node=x,x.api=E}),this.tick++,this.onreset?.()}view(){return this.root.view()}toBinary(){return r.encoder.encode(this)}setSchema(m,g=!0){const _=this.clock;if(_.time===1){const v=_.sid;g&&(_.sid=2),this.api.set(m),g&&this.setSid(v)}return this}setSid(m){const g=this.clock,_=g.sid;_!==m&&(g.sid=m,g.observe(new n.Timestamp(_,g.time-1),1))}toString(m=""){const g=()=>"",_=this.ext.size()>0;return"model"+(0,l.printTree)(m,[y=>this.root.toString(y),g,y=>{const v=[];return this.index.forEach(E=>v.push(E.v)),`index (${v.length} nodes)`+(v.length?(0,l.printTree)(y,v.map(E=>x=>`${E.name()} ${n.printTs(E.id)}`)):"")},g,y=>`view${(0,l.printTree)(y,[v=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+v)])}`,g,y=>this.clock.toString(y),_?g:null,_?y=>this.ext.toString(y):null])}};return My.Model=d,d.sid=o.randomSessionId,d.create=(p,m=d.sid())=>{const g=typeof m=="number"?m===1?new n.ServerClockVector(1,1):new n.ClockVector(m,1):m,_=new d(g);return p!==void 0&&_.setSchema(p instanceof f.NodeBuilder?p:f.s.json(p),!0),_},d.withServerClock=(p,m=1)=>d.create(p,new n.ServerClockVector(1,m)),d.fromBinary=p=>r.decoder.decode(p),d.load=(p,m,g)=>{const _=r.decoder.decode(p);return g&&_.setSchema(g,!0),typeof m=="number"&&_.setSid(m),_},My}var mH;function _te(){if(mH)return Iw;mH=1,Object.defineProperty(Iw,"__esModule",{value:!0}),Iw.ValNode=void 0;const t=Xo(),e=hf(),n=O8();let r=class{constructor(s,o,a){this.doc=s,this.id=o,this.val=a,this.api=void 0}set(s){if((0,t.compare)(s,this.val)<=0&&this.val.sid!==0||(0,t.compare)(s,this.id)<=0)return;const o=this.val;return this.val=s,o}node(){return this.val.sid===0?n.UNDEFINED:this.child()}view(){return this.node()?.view()}children(s){s(this.node())}child(){return this.doc.index.get(this.val)}container(){const s=this.node();return s?s.container():void 0}name(){return"val"}toString(s=""){const o=this.node();return this.name()+" "+(0,t.printTs)(this.id)+(0,e.printTree)(s,[c=>o?o.toString(c):(0,t.printTs)(this.val)])}};return Iw.ValNode=r,Iw}var Jw={},gH;function BIe(){if(gH)return Jw;gH=1,Object.defineProperty(Jw,"__esModule",{value:!0}),Jw.RootNode=void 0;const t=wI(),e=_te();let n=class extends e.ValNode{constructor(i,s){super(i,t.ORIGIN,s)}name(){return"root"}};return Jw.RootNode=n,Jw}var Zw={},Qw={},_H;function FIe(){if(_H)return Qw;_H=1,Object.defineProperty(Qw,"__esModule",{value:!0}),Qw.CRDT_CONSTANTS=void 0;var t;return(function(e){e[e.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"})(t||(Qw.CRDT_CONSTANTS=t={})),Qw}var vH;function jIe(){if(vH)return Zw;vH=1,Object.defineProperty(Zw,"__esModule",{value:!0}),Zw.VecNode=void 0;const t=AI(),e=FIe(),n=hf(),r=Xo();let i=class{constructor(o,a){this.doc=o,this.id=a,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(o){return this.elements[o]}get(o){const a=this.elements[o];if(a)return this.doc.index.get(a)}put(o,a){if(o>e.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const c=this.val(o);if(!(c&&(0,r.compare)(c,a)>=0)){if(o>this.elements.length)for(let l=this.elements.length;l<o;l++)this.elements.push(void 0);return o<this.elements.length?this.elements[o]=a:this.elements.push(a),c}}ext(){if(this.__extNode)return this.__extNode;const o=this.getExtId();if(!(o>=0))return;const c=this.doc.ext.get(o);if(c)return this.__extNode=new c.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const o=this.get(0);if(!(o instanceof t.ConNode))return-1;const a=o.val,c=this.id;return!(a instanceof Uint8Array)||a.length!==3||a[1]!==c.sid%256||a[2]!==c.time%256?-1:a[0]}child(){return this.ext()}container(){return this}children(o){const a=this.elements,c=a.length,l=this.doc.index;for(let u=0;u<c;u++){const h=a[u];if(!h)continue;const f=l.get(h);f&&o(f)}}view(){const o=this.ext();if(o)return o.view();let a=!0;const c=this._view,l=[],u=this.doc.index,h=this.elements,f=h.length;for(let d=0;d<f;d++){const p=h[d],m=p?u.get(p):void 0,g=m?m.view():void 0;c[d]!==g&&(a=!1),l.push(g)}return a?c:this._view=l}name(){return"vec"}toString(o=""){const a=this.ext(),c=this.name()+" "+(0,r.printTs)(this.id)+(a?` { extension = ${this.getExtId()} }`:"");if(a)return this.child().toString(o,this.id);const l=this.doc.index;return c+(0,n.printTree)(o,[...this.elements.map((u,h)=>f=>`${h}: ${u&&l.get(u)?l.get(u).toString(f+"  "+" ".repeat((""+h).length)):"nil"}`),...a?[u=>`${this.child().toString(u)}`]:[]])}};return Zw.VecNode=i,Zw}var eT={},yH;function zIe(){if(yH)return eT;yH=1,Object.defineProperty(eT,"__esModule",{value:!0}),eT.ObjNode=void 0;const t=hf(),e=Xo(),n=AI();let r=class{constructor(s,o){this.doc=s,this.id=o,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(s){const o=this.keys.get(s);if(o)return this.doc.index.get(o)}put(s,o){const a=this.keys.get(s);if(!(a&&(0,e.compare)(a,o)>=0))return this.keys.set(s,o),a}nodes(s){const o=this.doc.index;this.keys.forEach((a,c)=>s(o.get(a),c))}forEach(s){const o=this.doc.index;this.keys.forEach((a,c)=>{const l=o.get(a);!l||l instanceof n.ConNode&&l.val===void 0||s(c,l)})}children(s){const o=this.doc.index;this.keys.forEach((a,c)=>s(o.get(a)))}child(){}container(){return this}view(){const s=this.doc,o=s.clock.time+s.tick,a=this._view;if(this._tick===o)return a;const c={},l=s.index;let u=!0;return this.keys.forEach((h,f)=>{const d=l.get(h);if(!d){u=!1;return}const p=d.view();p!==void 0?(a[f]!==p&&(u=!1),c[f]=p):a[f]!==void 0&&(u=!1)}),u?a:(this._tick=o,this._view=c)}name(){return"obj"}toString(s=""){return this.name()+" "+(0,e.printTs)(this.id)+(0,t.printTree)(s,[...this.keys.entries()].filter(([,a])=>!!this.doc.index.get(a)).map(([a,c])=>l=>JSON.stringify(a)+(0,t.printTree)(l+" ",[u=>this.doc.index.get(c).toString(u)])))}};return eT.ObjNode=r,eT}var Dy={},tT={},nT={},bH;function VIe(){if(bH)return nT;bH=1,Object.defineProperty(nT,"__esModule",{value:!0}),nT.printOctets=void 0;const t=(e,n=16)=>{let r="";if(!e.length)return r;e[0]<16&&(r+="0"),r+=e[0].toString(16);for(let i=1;i<e.length&&i<n;i++){const s=e[i];r+=" ",s<16&&(r+="0"),r+=s.toString(16)}return e.length>n&&(r+=` (${e.length-n} more)`),r};return nT.printOctets=t,nT}var r2={},SH;function HIe(){return SH||(SH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.rlSplay=t.lrSplay=t.llSplay=t.rrSplay=t.lSplay=t.rSplay=t.splay=void 0;const e=(c,l,u)=>{const h=l.p;if(!h)return c;const f=h.p,d=h.l===l;return f?(f.l===h?d?c=(0,t.llSplay)(c,l,h,f):c=(0,t.lrSplay)(c,l,h,f):d?c=(0,t.rlSplay)(c,l,h,f):c=(0,t.rrSplay)(c,l,h,f),u>1?(0,t.splay)(c,l,u-1):c):(d?(0,t.rSplay)(l,h):(0,t.lSplay)(l,h),l)};t.splay=e;const n=(c,l)=>{const u=c.r;c.p=void 0,c.r=l,l.p=c,l.l=u,u&&(u.p=l)};t.rSplay=n;const r=(c,l)=>{const u=c.l;c.p=void 0,c.l=l,l.p=c,l.r=u,u&&(u.p=l)};t.lSplay=r;const i=(c,l,u,h)=>{const f=u.l,d=l.l,p=h.p;return l.p=p,l.l=u,u.p=l,u.l=h,u.r=d,h.p=u,h.r=f,f&&(f.p=h),d&&(d.p=u),p?p.l===h?p.l=l:p.r=l:c=l,c};t.rrSplay=i;const s=(c,l,u,h)=>{const f=u.r,d=l.r,p=h.p;return l.p=p,l.r=u,u.p=l,u.l=d,u.r=h,h.p=u,h.l=f,f&&(f.p=h),d&&(d.p=u),p?p.l===h?p.l=l:p.r=l:c=l,c};t.llSplay=s;const o=(c,l,u,h)=>{const f=l.l,d=l.r,p=h.p;return l.p=p,l.l=u,l.r=h,u.p=l,u.r=f,h.p=l,h.l=d,f&&(f.p=u),d&&(d.p=h),p?p.l===h?p.l=l:p.r=l:c=l,c};t.lrSplay=o;const a=(c,l,u,h)=>{const f=l.r,d=l.l,p=h.p;return l.p=p,l.l=h,l.r=u,u.p=l,u.l=f,h.p=l,h.r=d,f&&(f.p=u),d&&(d.p=h),p?p.l===h?p.l=l:p.r=l:c=l,c};t.rlSplay=a})(r2)),r2}var i2={},EH;function $Ie(){return EH||(EH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.splay2=void 0;const e=(c,l)=>{const u=l.p2;if(!u)return c;const h=u.p2,f=u.l2===l;return h?(h.l2===u?f?c=s(c,l,u,h):c=o(c,l,u,h):f?c=a(c,l,u,h):c=i(c,l,u,h),(0,t.splay2)(c,l)):(f?n(l,u):r(l,u),l)};t.splay2=e;const n=(c,l)=>{const u=c.r2;c.p2=void 0,c.r2=l,l.p2=c,l.l2=u,u&&(u.p2=l)},r=(c,l)=>{const u=c.l2;c.p2=void 0,c.l2=l,l.p2=c,l.r2=u,u&&(u.p2=l)},i=(c,l,u,h)=>{const f=u.l2,d=l.l2,p=h.p2;return l.p2=p,l.l2=u,u.p2=l,u.l2=h,u.r2=d,h.p2=u,h.r2=f,f&&(f.p2=h),d&&(d.p2=u),p?p.l2===h?p.l2=l:p.r2=l:c=l,c},s=(c,l,u,h)=>{const f=u.r2,d=l.r2,p=h.p2;return l.p2=p,l.r2=u,u.p2=l,u.l2=d,u.r2=h,h.p2=u,h.l2=f,f&&(f.p2=h),d&&(d.p2=u),p?p.l2===h?p.l2=l:p.r2=l:c=l,c},o=(c,l,u,h)=>{const f=l.l2,d=l.r2,p=h.p2;return l.p2=p,l.l2=u,l.r2=h,u.p2=l,u.r2=f,h.p2=l,h.l2=d,f&&(f.p2=u),d&&(d.p2=h),p?p.l2===h?p.l2=l:p.r2=l:c=l,c},a=(c,l,u,h)=>{const f=l.r2,d=l.l2,p=h.p2;return l.p2=p,l.l2=h,l.r2=u,u.p2=l,u.l2=f,h.p2=l,h.r2=d,f&&(f.p2=u),d&&(d.p2=h),p?p.l2===h?p.l2=l:p.r2=l:c=l,c}})(i2)),i2}var Ql={},xH;function GIe(){if(xH)return Ql;xH=1,Object.defineProperty(Ql,"__esModule",{value:!0}),Ql.remove2=Ql.insert2=Ql.prev2=Ql.next2=Ql.last2=Ql.first2=void 0;const t=c=>{let l=c;for(;l;)if(l.l2)l=l.l2;else return l;return l};Ql.first2=t;const e=c=>{let l=c;for(;l;)if(l.r2)l=l.r2;else return l;return l};Ql.last2=e;const n=c=>{if(c.r2){for(c=c.r2;c.l2;)c=c.l2;return c}let l=c.p2;for(;l&&l.r2===c;)c=l,l=l.p2;return l};Ql.next2=n;const r=c=>{if(c.l2){for(c=c.l2;c.r2;)c=c.r2;return c}let l=c.p2;for(;l&&l.l2===c;)c=l,l=l.p2;return l};Ql.prev2=r;const i=(c,l)=>{const u=c.r2=l.r2;l.r2=c,c.p2=l,u&&(u.p2=c)},s=(c,l)=>{const u=c.l2=l.l2;l.l2=c,c.p2=l,u&&(u.p2=c)},o=(c,l,u)=>{if(!c)return l;let h=c;for(;h;){const f=u(l,h),d=f<0?h.l2:h.r2;if(d)h=d;else{f<0?s(l,h):i(l,h);break}}return c};Ql.insert2=o;const a=(c,l)=>{const u=l.p2,h=l.l2,f=l.r2;if(l.p2=l.l2=l.r2=void 0,!h&&!f){if(u)u.l2===l?u.l2=void 0:u.r2=void 0;else return;return c}else if(h&&f){let p=h;for(;p.r2;)p=p.r2;return p.r2=f,f.p2=p,u?(u.l2===l?u.l2=h:u.r2=h,h.p2=u,c):(h.p2=void 0,h)}const d=h||f;if(d.p2=u,u)u.l2===l?u.l2=d:u.r2=d;else return d;return c};return Ql.remove2=a,Ql}var rT={},wH={},TH;function WIe(){if(TH)return wH;if(TH=1,typeof Iterator>"u"&&typeof globalThis=="object"){class t{[Symbol.iterator](){return this}find(n){for(const r of this)if(n(r))return r}}globalThis.Iterator=t}return wH}var AH;function qIe(){if(AH)return rT;AH=1,Object.defineProperty(rT,"__esModule",{value:!0}),rT.UndEndIterator=void 0,WIe();class t extends Iterator{constructor(r){super(),this.n=r}next(){const r=this.n();return new e(r,r===void 0)}}rT.UndEndIterator=t;class e{constructor(r,i){this.value=r,this.done=i}}return rT}var CH;function I8(){if(CH)return tT;CH=1,Object.defineProperty(tT,"__esModule",{value:!0}),tT.AbstractRga=void 0;const t=Xo(),e=xI(),n=VIe(),r=HIe(),i=$Ie(),s=GIe(),o=wI(),a=hf(),c=TI(),l=qIe(),u=(_,y)=>{const v=_.id,E=y.id;return v.sid-E.sid||v.time-E.time},h=_=>{const y=_.l,v=_.r;_.len=(_.del?0:_.span)+(y?y.len:0)+(v?v.len:0)},f=_=>{const y=_.l,v=_.r;_.len=_.span+(y?y.len:0)+(v?v.len:0)},d=(_,y)=>{for(;_;)_.len+=y,_=_.p},p=_=>{const y=_.r;if(y){_=y;let E;for(;E=_.l;)_=E;return _}let v=_.p;for(;v&&v.r===_;)_=v,v=v.p;return v},m=_=>{const y=_.l;if(y){_=y;let E;for(;E=_.r;)_=E;return _}let v=_.p;for(;v&&v.l===_;)_=v,v=v.p;return v};let g=class{constructor(y){this.id=y,this.root=void 0,this.ids=void 0,this.count=0}ins(y,v,E){const x=this.id,A=y.time,T=y.sid;if(x.time===A&&x.sid===T){this.insAfterRoot(y,v,E);return}let L=this.ids,I=L;for(;L;){const G=L.id,K=G.sid;if(K>T)L=L.l2;else if(K<T)I=L,L=L.r2;else{const te=G.time;if(te>A)L=L.l2;else if(te<A)I=L,L=L.r2;else{I=L;break}}}if(!I)return;const F=I.id,M=F.time,D=F.sid,O=I.span;if(D!==T||A-M>=O)return;const q=A-M;this.insAfterChunk(y,I,q,v,E)}insAt(y,v,E){if(!y){const I=this.id;return this.insAfterRoot(I,v,E),I}const x=this.findChunk(y-1);if(!x)return;const[A,T]=x,k=A.id,L=T===0?k:new t.Timestamp(k.sid,k.time+T);return this.insAfterChunk(L,A,T,v,E),L}insAfterRoot(y,v,E){const x=this.createChunk(v,E),A=this.first();if(!A)this.setRoot(x);else if((0,t.compare)(A.id,v)<0)this.insertBefore(x,A);else{if((0,t.containsId)(A.id,A.span,v))return;this.insertAfterRef(x,y,A)}}insAfterChunk(y,v,E,x,A){const T=v.id,k=T.time,L=T.sid,I=v.span,F=this.createChunk(x,A);if(E+1<I){const D=x.sid,O=x.time;if(L===D&&k<=O&&k+I-1>=O)return;if(O>y.time+1||D>y.sid){this.insertInside(F,v,E+1),this.splay(F);return}}this.insertAfterRef(F,y,v),this.splay(F)}delete(y){const v=y.length;for(let E=0;E<v;E++)this.deleteSpan(y[E]);this.onChange()}deleteSpan(y){const v=y.span,E=y.time,x=E+v-1,A=this.findById(y);if(!A)return;let T=A,k=T;for(;T;){k=T;const L=T.id,I=T.span,F=L.time,M=F+I-1;if(T.del){if(M>=x)break;T=T.s;continue}const D=E<=F,O=E<=M;if(D)if(x>=M){if(T.delete(),d(T,-T.span),x<=M)break}else{const q=x-F+1,G=this.split(T,q);T.delete(),h(G),d(T,-T.span);break}else if(O)if(x>=M){const q=E-F,G=this.split(T,q);if(G.delete(),G.len=G.r?G.r.len:0,d(T,-G.span),x<=M)break}else{const q=this.split(T,x-F+1),G=this.split(T,E-F);G.delete(),h(q),h(G),d(T,-G.span);break}T=T.s}k&&this.mergeTombstones2(A,k)}find(y){let v=this.root;for(;v;){const E=v.l,x=E?E.len:0;let A;if(y<x)v=E;else if(v.del)y-=x,v=v.r;else if(y<x+(A=v.span)){const T=y-x,k=v.id;return T?new t.Timestamp(k.sid,k.time+T):k}else y-=x+A,v=v.r}}findChunk(y){let v=this.root;for(;v;){const E=v.l,x=E?E.len:0;let A;if(y<x)v=E;else if(v.del)y-=x,v=v.r;else{if(y<x+(A=v.span))return[v,y-x];y-=x+A,v=v.r}}}findInterval(y,v){const E=[];if(!v)return E;let x=this.root,A=0;for(;x;){const L=x.l?x.l.len:0;if(y<L)x=x.l;else if(x.del)y-=L,x=x.r;else if(y<L+x.span){A=y-L;break}else y-=L+x.span,x=x.r}if(!x)return E;if(x.span>=v+A){const L=x.id;return E.push((0,t.tss)(L.sid,L.time+A,v)),E}const T=x.span-A,k=x.id;if(E.push((0,t.tss)(k.sid,k.time+A,T)),v-=T,x=p(x),!x)return E;do{if(x.del)continue;const L=x.id,I=x.span;if(v<=I)return E.push((0,t.tss)(L.sid,L.time,v)),E;E.push((0,t.tss)(L.sid,L.time,I)),v-=I}while((x=p(x))&&v>0);return E}findInterval2(y,v){const E=[];return this.range0(void 0,y,v,(x,A,T)=>{const k=x.id;E.push((0,t.tss)(k.sid,k.time+A,T))}),E}range0(y,v,E,x){let A=y||this.findById(v);if(y)for(;A&&!(0,t.containsId)(A.id,A.span,v);)A=p(A);if(A){if(A.del){if((0,t.containsId)(A.id,A.span,E))return}else{const T=v.time-A.id.time;if((0,t.containsId)(A.id,A.span,E)){const I=E.time-v.time+1;return x(A,T,I),A}const L=A.span-T;if(x(A,T,L))return A}for(A=p(A);A;){if((0,t.containsId)(A.id,A.span,E))return!A.del&&x(A,0,E.time-A.id.time+1),A;if(!A.del&&x(A,0,A.span))return A;A=p(A)}return A}}first(){let y=this.root;for(;y;){const v=y.l;if(v)y=v;else return y}return y}last(){let y=this.root;for(;y;){const v=y.r;if(v)y=v;else return y}return y}lastId(){const y=this.last();if(!y)return;const v=y.id,E=y.span;return E===1?v:new t.Timestamp(v.sid,v.time+E-1)}next(y){return p(y)}prev(y){return m(y)}length(){const y=this.root;return y?y.len:0}size(){return this.count}pos(y){const v=y.p,E=y.l;if(!v)return E?E.len:0;const x=this.pos(v);if(v.r===y)return x+(v.del?0:v.span)+(E?E.len:0);const T=y.r;return x-(y.del?0:y.span)-(T?T.len:0)}chunks0(){let y=this.first();return()=>{const v=y;return y&&(y=p(y)),v}}chunks(){return new l.UndEndIterator(this.chunks0())}setRoot(y){this.root=y,this.insertId(y),this.onChange()}insertBefore(y,v){const E=v.l;v.l=y,y.l=E,y.p=v;let x=0;E&&(E.p=y,x=E.len),y.len=y.span+x,d(v,y.span),this.insertId(y),this.onChange()}insertAfter(y,v){const E=v.r;v.r=y,y.r=E,y.p=v;let x=0;E&&(E.p=y,x=E.len),y.len=y.span+x,d(v,y.span),this.insertId(y),this.onChange()}insertAfterRef(y,v,E){const x=y.id,A=x.sid,T=x.time;let k=!1;for(;;){const L=E.id,I=L.time+E.span;E.s||(k=L.sid===A&&I===T&&I-1===v.time,k&&(E.s=y));const F=p(E);if(!F)break;const M=F.id,D=M.time,O=M.sid;if(D<T)break;if(D===T){if(O===A)return;if(O<A)break}E=F}k&&!E.del?(this.mergeContent(E,y.data),E.s=void 0):this.insertAfter(y,E)}mergeContent(y,v){const E=y.span;y.merge(v),d(y,y.span-E),this.onChange()}insertInside(y,v,E){const x=v.p,A=v.l,T=v.r,k=v.s,L=v.len,I=v.split(E);if(v.s=I,I.s=k,v.l=v.r=I.l=I.r=void 0,I.l=void 0,y.p=x,!A)y.l=v,v.p=y;else{y.l=A,A.p=y;const D=A.r;A.r=v,v.p=A,v.l=D,D&&(D.p=v)}if(!T)y.r=I,I.p=y;else{y.r=T,T.p=y;const D=T.l;T.l=I,I.p=T,I.r=D,D&&(D.p=I)}x?x.l===v?x.l=y:x.r=y:this.root=y,h(v),h(I),A&&(A.len=(A.l?A.l.len:0)+v.len+(A.del?0:A.span)),T&&(T.len=(T.r?T.r.len:0)+I.len+(T.del?0:T.span)),y.len=L+y.span;const F=y.span;let M=y.p;for(;M;)M.len+=F,M=M.p;this.insertId(I),this.insertIdFast(y),this.onChange()}split(y,v){const E=y.s,x=y.split(v),A=y.r;return y.s=x,x.r=A,x.s=E,y.r=x,x.p=y,this.insertId(x),A&&(A.p=x),x}mergeTombstones(y,v){if(!y.del||!v.del)return!1;const E=y.id,x=v.id;return E.sid!==x.sid||E.time+y.span!==x.time?!1:(y.s=v.s,y.span+=v.span,this.deleteChunk(v),!0)}mergeTombstones2(y,v){let E=y;for(;E;){const A=p(E);if(!A)break;if(!this.mergeTombstones(E,A)){if(A===v){if(A){const k=p(A);k&&this.mergeTombstones(A,k)}break}E=E.s}}const x=m(y);x&&this.mergeTombstones(x,y)}rmTombstones(){let y=this.first();const v=[];for(;y;)y.del&&v.push(y),y=p(y);for(let E=0;E<v.length;E++)this.deleteChunk(v[E])}deleteChunk(y){this.deleteId(y);const v=y.p,E=y.l,x=y.r;if(y.id=o.ORIGIN,!E&&!x)v?v.l===y?v.l=void 0:v.r=void 0:this.root=void 0;else if(E&&x){let A=E;for(;A.r;)A=A.r;A.r=x,x.p=A;const T=x.len;let k;for(k=A,v?(v.l===y?v.l=E:v.r=E,E.p=v):(this.root=E,E.p=void 0);k&&k!==v;)k.len+=T,k=k.p}else{const A=E||x;A.p=v,v?v.l===y?v.l=A:v.r=A:this.root=A}}insertId(y){this.ids=(0,s.insert2)(this.ids,y,u),this.count++,this.ids=(0,i.splay2)(this.ids,y)}insertIdFast(y){this.ids=(0,s.insert2)(this.ids,y,u),this.count++}deleteId(y){this.ids=(0,s.remove2)(this.ids,y),this.count--}findById(y){const v=y.sid,E=y.time;let x=this.ids,A=x;for(;x;){const M=x.id,D=M.sid;if(D>v)x=x.l2;else if(D<v)A=x,x=x.r2;else{const O=M.time;if(O>E)x=x.l2;else if(O<E)A=x,x=x.r2;else{A=x;break}}}if(!A)return;const T=A.id,k=T.time,L=T.sid,I=A.span;if(!(L!==v||E<k||E-k>=I))return A}posById(y){const v=this.findById(y);if(!v)return;const E=this.pos(v);return v.del?E:E+(y.time-v.id.time)}prevId(y){let v=this.findById(y);if(!v)return;const E=y.time;if(v.id.time<E)return new t.Timestamp(y.sid,E-1);if(v=m(v),!v)return;const x=v.id;return v.span>1?new t.Timestamp(x.sid,x.time+v.span-1):x}spanView(y){const v=[];let E=y.span;const x=y.time;let A=this.findById(y);if(!A)return v;if(!A.del)if(A.span>=E+x-A.id.time){const T=x-A.id.time,k=T+E,L=A.view().slice(T,k);return v.push(L),v}else{const T=x-A.id.time,k=A.view().slice(T,y.span);E-=A.span-T,v.push(k)}for(;A=A.s;){const T=A.span;if(!A.del){if(T>E){const k=A.view().slice(0,E);v.push(k);break}v.push(A.data)}if(E-=T,E<=0)break}return v}splay(y){const v=y.p;if(!v)return;const E=v.p,x=v.l===y;if(!E){x?(0,r.rSplay)(y,v):(0,r.lSplay)(y,v),this.root=y,h(v),f(y);return}E.l===v?x?this.root=(0,r.llSplay)(this.root,y,v,E):this.root=(0,r.lrSplay)(this.root,y,v,E):x?this.root=(0,r.rlSplay)(this.root,y,v,E):this.root=(0,r.rrSplay)(this.root,y,v,E),h(E),h(v),f(y),this.splay(y)}iterator(){let y=this.first();return()=>{const v=y;return y&&(y=p(y)),v}}ingest(y,v){if(y<1)return;const E=new Map;this.root=this._ingest(y,()=>{const x=v(),A=x.id,T=A.sid+"."+A.time,k=E.get(T);k&&(k.s=x,E.delete(T));const L=(0,t.tick)(A,x.span);return E.set(L.sid+"."+L.time,x),x})}_ingest(y,v){const E=y>>1,x=y-E-1,A=E>0?this._ingest(E,v):void 0,T=v();A&&(T.l=A,A.p=T);const k=x>0?this._ingest(x,v):void 0;return k&&(T.r=k,k.p=T),h(T),this.insertId(T),T}toStringName(){return"AbstractRga"}toString(y=""){const v=this.view();let E="";return(0,e.isUint8Array)(v)?E+=` { ${(0,n.printOctets)(v)||""} }`:typeof v=="string"&&(E+=`{ ${v.length>32?JSON.stringify(v.substring(0,32))+" ":JSON.stringify(v)} }`),`${this.toStringName()} ${(0,t.printTs)(this.id)} ${E}`+(0,a.printTree)(y,[A=>this.root?this.printChunk(A,this.root):""])}printChunk(y,v){return this.formatChunk(v)+(0,c.printBinary)(y,[v.l?E=>this.printChunk(E,v.l):null,v.r?E=>this.printChunk(E,v.r):null])}formatChunk(y){let E=`chunk ${(0,t.printTs)(y.id)}:${y.span} .${y.len}.`;if(y.del)E+=` [${y.span}]`;else if((0,e.isUint8Array)(y.data))E+=` { ${(0,n.printOctets)(y.data)||""} }`;else if(typeof y.data=="string"){const x=y.data.length>32?JSON.stringify(y.data.substring(0,32))+" ":JSON.stringify(y.data);E+=` { ${x} }`}return E}};return tT.AbstractRga=g,tT}var RH;function YIe(){if(RH)return Dy;RH=1,Object.defineProperty(Dy,"__esModule",{value:!0}),Dy.ArrNode=Dy.ArrChunk=void 0;const t=I8(),e=Xo(),n=TI(),r=hf();class i{constructor(a,c,l){this.id=a,this.span=c,this.len=l?c:0,this.del=!l,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=l}merge(a){this.data.push(...a),this.span=this.data.length}split(a){const c=this.span;if(this.span=a,!this.del){const u=this.data.splice(a);return new i((0,e.tick)(this.id,a),c-a,u)}return new i((0,e.tick)(this.id,a),c-a,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new i(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}Dy.ArrChunk=i;let s=class extends t.AbstractRga{constructor(a,c){super(c),this.doc=a,this._tick=0,this._view=[],this.api=void 0}get(a){const c=this.findChunk(a);if(c)return c[0].data[c[1]]}getNode(a){const c=this.get(a);if(c)return this.doc.index.get(c)}getId(a){const c=this.findChunk(a);if(!c)return;const[l,u]=c,h=l.id;return u?(0,e.tick)(h,u):h}getById(a){const c=this.findById(a);if(!c||c.del)return;const l=a.time-c.id.time;return c.data[l]}upd(a,c){const l=this.findById(a);if(!l)return;const u=l.data;if(!u)return;const h=a.time-l.id.time,f=u[h];if(!(f&&(0,e.compare)(f,c)>=0))return u[h]=c,this.onChange(),f}createChunk(a,c){return new i(a,c?c.length:0,c)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const a=this.doc,c=a.clock.time+a.tick,l=this._view;if(this._tick===c)return l;const u=[],h=a.index;let f=!0;for(let p=this.first();p;p=this.next(p))if(!p.del)for(const m of p.data){const g=h.get(m);if(!g){f=!1;continue}const _=g.view();l[u.length]!==_&&(f=!1),u.push(_)}return l.length!==u.length&&(f=!1),f?l:(this._tick=c,this._view=u)}children(a){const c=this.doc.index;for(let l=this.first();l;l=this.next(l)){const u=l.data;if(!u)continue;const h=u.length;for(let f=0;f<h;f++)a(c.get(u[f]))}}name(){return"arr"}printChunk(a,c){const l=this.pos(c);let u="";if(!c.del){const h=this.doc.index;u=(0,r.printTree)(a,c.data.map(f=>h.get(f)).filter(f=>!!f).map((f,d)=>p=>`[${l+d}]: ${f.toString(p+"    "+" ".repeat(String(d).length))}`))}return this.formatChunk(c)+u+(0,n.printBinary)(a,[c.l?h=>this.printChunk(h,c.l):null,c.r?h=>this.printChunk(h,c.r):null])}};return Dy.ArrNode=s,Dy}var Ly={},kH;function KIe(){if(kH)return Ly;kH=1,Object.defineProperty(Ly,"__esModule",{value:!0}),Ly.BinNode=Ly.BinChunk=void 0;const t=Xo(),e=I8();class n{constructor(s,o,a){this.id=s,this.span=o,this.len=a?o:0,this.del=!a,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=a}merge(s){const o=this.data.length,a=new Uint8Array(o+s.length);a.set(this.data),a.set(s,o),this.data=a,this.span=a.length}split(s){if(!this.del){const a=this.data,c=a.subarray(s),l=new n((0,t.tick)(this.id,s),this.span-s,c);return this.data=a.subarray(0,s),this.span=s,l}const o=new n((0,t.tick)(this.id,s),this.span-s,void 0);return this.span=s,o}delete(){this.del=!0,this.data=void 0}clone(){return new n(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}Ly.BinChunk=n;let r=class extends e.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const s=new Uint8Array(this.length());let o=0,a=this.first();for(;a;){if(!a.del){const c=a.data;s.set(c,o),o+=c.length}a=this.next(a)}return this._view=s}children(){}child(){}container(){}name(){return"bin"}createChunk(s,o){return new n(s,o?o.length:0,o)}onChange(){this._view=null}toStringName(){return this.name()}};return Ly.BinNode=r,Ly}var Uy={},MH;function XIe(){if(MH)return Uy;MH=1,Object.defineProperty(Uy,"__esModule",{value:!0}),Uy.StrNode=Uy.StrChunk=void 0;const t=Xo(),e=I8(),n=M8();class r{constructor(o,a,c){this.id=o,this.span=a,this.len=c?a:0,this.del=!c,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=c}merge(o){this.data+=o,this.span=this.data.length}split(o){if(!this.del){const c=new r((0,t.tick)(this.id,o),this.span-o,this.data.slice(o));return this.data=this.data.slice(0,o),this.span=o,c}const a=new r((0,t.tick)(this.id,o),this.span-o,"");return this.span=o,a}delete(){this.del=!0,this.data=""}clone(){return new r(this.id,this.span,this.data)}view(){return this.data}}Uy.StrChunk=r;let i=class extends e.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let o="";for(let a=this.first();a;a=(0,n.next)(a))o+=a.data;return this._view=o}name(){return"str"}createChunk(o,a){return new r(o,a?a.length:0,a||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Uy.StrNode=i,Uy}var OH;function JIe(){return OH||(OH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StrChunk=t.StrNode=t.BinChunk=t.BinNode=t.ArrChunk=t.ArrNode=t.ObjNode=t.VecNode=t.RootNode=t.ValNode=t.ConNode=void 0;var e=AI();Object.defineProperty(t,"ConNode",{enumerable:!0,get:function(){return e.ConNode}});var n=_te();Object.defineProperty(t,"ValNode",{enumerable:!0,get:function(){return n.ValNode}});var r=BIe();Object.defineProperty(t,"RootNode",{enumerable:!0,get:function(){return r.RootNode}});var i=jIe();Object.defineProperty(t,"VecNode",{enumerable:!0,get:function(){return i.VecNode}});var s=zIe();Object.defineProperty(t,"ObjNode",{enumerable:!0,get:function(){return s.ObjNode}});var o=YIe();Object.defineProperty(t,"ArrNode",{enumerable:!0,get:function(){return o.ArrNode}}),Object.defineProperty(t,"ArrChunk",{enumerable:!0,get:function(){return o.ArrChunk}});var a=KIe();Object.defineProperty(t,"BinNode",{enumerable:!0,get:function(){return a.BinNode}}),Object.defineProperty(t,"BinChunk",{enumerable:!0,get:function(){return a.BinChunk}});var c=XIe();Object.defineProperty(t,"StrNode",{enumerable:!0,get:function(){return c.StrNode}}),Object.defineProperty(t,"StrChunk",{enumerable:!0,get:function(){return c.StrChunk}})})(EP)),EP}var IH;function Vg(){return IH||(IH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(jOe(),t),e.__exportStar(JIe(),t)})(bP)),bP}var s2={},NH;function ZIe(){return NH||(NH=1,Object.defineProperty(s2,"__esModule",{value:!0})),s2}var o2={},PH;function vte(){return PH||(PH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Model=void 0;const e=ys;var n=O8();Object.defineProperty(t,"Model",{enumerable:!0,get:function(){return n.Model}}),e.__exportStar(dte(),t)})(o2)),o2}var DH;function yte(){return DH||(DH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ys;e.__exportStar(Vg(),t),e.__exportStar(ZIe(),t),e.__exportStar(vte(),t),e.__exportStar(ob(),t)})(yP)),yP}var r4=yte(),iT={},a2={},LH;function QIe(){return LH||(LH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.listToUint8=t.concatList=t.concat=void 0;const e=(i,s)=>{const o=new Uint8Array(i.length+s.length);return o.set(i),o.set(s,i.length),o};t.concat=e;const n=i=>{const s=i.length;let o=0,a=0;for(let l=0;l<s;l++)o+=i[l].length;const c=new Uint8Array(o);for(let l=0;l<s;l++){const u=i[l];c.set(u,a),a+=u.length}return c};t.concatList=n;const r=i=>{switch(i.length){case 0:return new Uint8Array(0);case 1:return i[0];default:return(0,t.concatList)(i)}};t.listToUint8=r})(a2)),a2}var c2={},UH;function e3e(){return UH||(UH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.cloneBinary=void 0;const e=xI(),{isArray:n}=Array,r=Object.keys,i=s=>{if(!s)return s;if(n(s)){const o=[],a=s.length;for(let c=0;c<a;c++)o.push((0,t.cloneBinary)(s[c]));return o}else if(typeof s=="object"){if((0,e.isUint8Array)(s))return new Uint8Array(s);const o=r(s),a=o.length,c={};for(let l=0;l<a;l++){const u=o[l];c[u]=(0,t.cloneBinary)(s[u])}return c}return s};t.cloneBinary=i})(c2)),c2}var l2={},BH;function t3e(){return BH||(BH=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.toSchema=void 0;const e=Vg(),n=ob(),r=i=>{if(i instanceof e.ConNode)return n.s.con(i.val);if(i instanceof e.ValNode)return n.s.val((0,t.toSchema)(i.node()));if(i instanceof e.ObjNode){const s={};return i.nodes((o,a)=>s[a]=(0,t.toSchema)(o)),n.s.obj(s)}if(i instanceof e.VecNode){const s=[];return i.children(o=>s.push((0,t.toSchema)(o))),n.s.vec(...s)}if(i instanceof e.StrNode)return n.s.str(i.view());if(i instanceof e.BinNode)return n.s.bin(i.view());if(i instanceof e.ArrNode){const s=[];return i.children(o=>{o&&s.push((0,t.toSchema)(o))}),n.s.arr(s)}return n.s.con(void 0)};t.toSchema=r})(l2)),l2}var FH;function n3e(){if(FH)return iT;FH=1,Object.defineProperty(iT,"__esModule",{value:!0}),iT.Log=void 0;const t=gte(),e=M8(),n=hf(),r=QIe(),i=e3e(),s=vte(),o=t3e(),a=ob(),c=Vg();let l=class Ak{static fromNewModel(h){const f=h.clock.sid,d=new Ak(()=>s.Model.create(void 0,f)),p=h.api;return p.builder.patch.ops.length&&d.end.applyPatch(p.flush()),d}static from(h){const f=h.toBinary(),d=()=>s.Model.fromBinary(f);return new Ak(d,h)}constructor(h,f=h(),d){this.start=h,this.end=f,this.patches=new t.AvlMap(a.compare);const p=g=>{const _=g.getId();_&&this.patches.set(_,g)},m=f.api;this.__onPatch=m.onPatch.listen(p),this.__onFlush=m.onFlush.listen(p),this.metadata=d??{}}destroy(){this.__onPatch(),this.__onFlush()}replayToEnd(){const h=this.start().clone();for(let f=(0,e.first)(this.patches.root);f;f=(0,e.next)(f))h.applyPatch(f.v);return h}replayTo(h,f=!0){const d=this.start().clone();let p=0;for(let m=(0,e.first)(this.patches.root);m&&(p=(0,a.compare)(h,m.k))>=0&&!(p===0&&!f);m=(0,e.next)(m))d.applyPatch(m.v);return d}advanceTo(h){const f=[];let d=(0,e.first)(this.patches.root);for(;d&&(0,a.compare)(h,d.k)>=0;d=(0,e.next)(d))f.push(d.v);for(const m of f)this.patches.del(m.getId());const p=this.start;this.start=()=>{const m=p();for(const g of f)m.applyPatch(g);return m}}findMax(h){let f=this.patches.max;for(;f;){if(f.k.sid===h)return f.v;f=(0,e.prev)(f)}}clone(){const h=this.start,f=(0,i.cloneBinary)(this.metadata),d=this.end.clone(),p=new Ak(h,d,f);for(const{v:m}of this.patches.entries()){const g=m.clone(),_=g.getId();_&&p.patches.set(_,g)}return p}rebaseBatch(h,f){const d=f?this.findMax(f):this.patches.max?.v;if(!d)return h;const p=d.getId();if(!p)return h;let m=p.time+d.span();const g=[],_=h.length;for(let y=0;y<_;y++){const v=h[y].rebase(m);m+=v.span(),g.push(v)}return g}reset(h){this.start=h.start,this.metadata=h.metadata,this.patches=h.patches,this.end.reset(h.end),h.destroy()}undo(h){const f=h.ops,d=f.length;if(!d)throw new Error("EMPTY_PATCH");const p=h.getId();let m;const g=()=>m||(m=this.replayTo(p,!1)),_=this.end.api.builder;for(let y=d-1;y>=0;y--){const v=f[y],E=v.id;if(v instanceof a.InsStrOp||v instanceof a.InsArrOp||v instanceof a.InsBinOp){_.del(v.obj,[new a.Timespan(E.sid,E.time,v.span())]);continue}const x=g();if(v instanceof a.InsValOp){const A=x.index.get(v.obj);if(A instanceof c.ValNode){const k=(0,o.toSchema)(A.node()).build(_);_.setVal(v.obj,k)}}else if(v instanceof a.InsObjOp||v instanceof a.InsVecOp){const A=[],T=x.index.get(v.obj);for(const[k]of v.data){let L;if(T instanceof c.ObjNode?L=T.get(k+""):T instanceof c.VecNode&&(L=T.get(+k)),L){const F=(0,o.toSchema)(L).build(_);A.push([k,F])}else A.push([k,_.con(void 0)])}A.length&&(v instanceof a.InsObjOp?_.insObj(v.obj,A):v instanceof a.InsVecOp&&_.insVec(v.obj,A))}else if(v instanceof a.DelOp){const A=x.index.find(v.obj);if(A){const T=A.v;if(T instanceof c.StrNode){let k="";for(const F of v.what)k+=T.spanView(F).join("");let L=v.obj;const I=v.what[0];if(I){const F=T.prevId(I);F&&(L=F)}_.insStr(v.obj,L,k)}else if(T instanceof c.BinNode){const k=[];for(const M of v.what)k.push(...T.spanView(M));let L=v.obj;const I=v.what[0];if(I){const M=T.prevId(I);M&&(L=M)}const F=(0,r.listToUint8)(k);_.insBin(v.obj,L,F)}else if(T instanceof c.ArrNode){const k=[];for(const F of v.what){const M=T.spanView(F);for(const D of M)for(const O of D){const z=x.index.get(O);if(z){const G=(0,o.toSchema)(z).build(_);k.push(G)}}}let L=v.obj;const I=v.what[0];if(I){const F=T.prevId(I);F&&(L=F)}_.insArr(v.obj,L,k)}}}}return _.flush()}toString(h){const f=[];return this.patches.forEach(({v:d})=>f.push(d)),"log"+(0,n.printTree)(h,[d=>"start"+(0,n.printTree)(d,[p=>this.start().toString(p)]),()=>"",d=>"history"+(0,n.printTree)(d,f.map((p,m)=>g=>`${m}: ${p.toString(g)}`)),()=>"",d=>"end"+(0,n.printTree)(d,[p=>this.end.toString(p)])])}};return iT.Log=l,iT}var r3e=n3e();function bte(t){const e=t.node?.id??{sid:-1,time:-1};return{get nodeId(){return e},toJSON(){const n=t.view();return typeof n=="string"?n:""},insert(n,r){t.ins(n,r)},delete(n,r){t.del(n,r)},get length(){return t.length()}}}let jH=!1;const cf=r4.Model.create();(cf.view()===void 0||typeof cf.view()!="object")&&cf.api.set({});const bv=()=>cf.api.obj();let i4;function Ste(){i4?.destroy?.(),i4=r3e.Log.from(cf)}Ste();function zH(){return i4}function VH(t){cf.applyPatch(t),dm.emit("","modem:sync",d5(t.toBinary()))}function i3e(t,e){return t?.sid===e?.sid&&t?.time===e?.time}function s3e(t,e){for(const n of t.ops){const r=n.obj;if(r&&i3e(e,r))return!0}return!1}function Ete(t,e){const[,n]=Ye.useState(0);Ye.useEffect(()=>{const s=cf.api.subscribe(()=>n(o=>1-o));return()=>s()},[]);const r=bv();if(!r.has(t))return;const i=r.get(t);if(i)try{if(e===0){const s=i.view();return typeof s=="number"?s:void 0}if(e===1){const o=i.get?.()??i,a=o.asStr?.()??o;if(a&&typeof a.ins=="function")return bte(a)}}catch{}}function bC(t){const e=Ete(t,0);if(nn(e))return e}function xte(t){const e=Ete(t,1);if(!(!fe(e)||typeof e?.toJSON!="function"))return e}function o3e(t,e,n){const r=bv();if(r.has(t))return;const i=n;r.set({[t]:i})}function a3e(t,e){o3e(t,0,e)}function wte(t,e){const n=bv();n.has(t)||n.set({[t]:e})}function cu(t,e){bv().set({[t]:e})}function c3e(t,e){bv().set({[t]:e})}function HH(t){const e=bv();if(!e.has(t))return;const n=e.get(t);if(n)try{const i=n.get?.()??n,s=i?.view?.();if(typeof s=="string"){const o=i.asStr?.();return o?bte(o):s}return s}catch{return}}function Tte(t,e){const n=cf.api.subscribe(()=>{bv().has(t)&&e(HH(t))});return bv().has(t)&&e(HH(t)),()=>n()}function l3e(t,e){return Tte(t,n=>{nn(n)&&e(n)})}function u3e(t,e){return Tte(t,n=>{n&&typeof n.toJSON=="function"&&e(n.toJSON())})}const dm=Ym("modem",["second"],t=>{if(dm.session(t))switch(t.target){case"second":!jH&&t.data%2===0&&dm.emit(t.player,"modem:join");break;case"join":t.sender!==dm.id()&&dm.reply(t,"joinack",d5(cf.toBinary()));break;case"joinack":if(t.sender!==dm.id()){jH=!0;try{const e=oM(t.data),n=r4.Model.fromBinary(e);cf.reset(n),Ste()}catch(e){console.error("modem joinack decode",e)}}break;case"sync":{if(t.sender!==dm.id()&&fe(t.data))try{const e=r4.Patch.fromBinary(oM(t.data));cf.applyPatch(e)}catch(e){console.error("modem sync decode",e)}break}case"presence":{if(t.sender!==dm.id()&&fe(t.data))try{const e=t.data;$M.set(e.clientId,{...e,lastSeen:Date.now()})}catch(e){console.error("modem presence decode",e)}break}}});function h3e(t){dm.emit("","modem:sync",d5(t.toBinary()))}cf.api.autoFlush(!0);cf.api.onFlush.listen(h3e);const $M=new Map,f3e=3e4;function d3e(t,e,n,r,i,s){const o={clientId:t,codepageKey:e,cursor:n,select:r,name:i??`User ${t.slice(0,6)}`,color:s??"#3b82f6"};dm.emit("","modem:presence",o),$M.set(t,{...o,lastSeen:Date.now()})}function p3e(t){const e=Date.now(),n=[];for(const[r,i]of $M.entries())e-i.lastSeen>f3e?$M.delete(r):i.codepageKey===t&&n.push(i);return n}function m3e(t){const[e,n]=Ye.useState([]);return Ye.useEffect(()=>{if(!t){n([]);return}const r=()=>{n(p3e(t))};r();const i=setInterval(r,500);return()=>clearInterval(i)},[t]),e}const g3e=`desc;$DKGRAYname and type of codepage
`,_3e=Object.freeze(Object.defineProperty({__proto__:null,default:g3e},Symbol.toStringTag,{value:"Module"})),v3e=`desc;$DKGRAYShow admin scroll
`,y3e=Object.freeze(Object.defineProperty({__proto__:null,default:v3e},Symbol.toStringTag,{value:"Module"})),b3e=`desc;$DKGRAYStart/stop/list AI agents; prompt with <id> <values>
`,S3e=Object.freeze(Object.defineProperty({__proto__:null,default:b3e},Symbol.toStringTag,{value:"Module"})),E3e=`desc;$DKGRAYCreate array variable
`,x3e=Object.freeze(Object.defineProperty({__proto__:null,default:E3e},Symbol.toStringTag,{value:"Module"})),w3e=`desc;$DKGRAYApply autofilter to fx 0-1
`,T3e=Object.freeze(Object.defineProperty({__proto__:null,default:w3e},Symbol.toStringTag,{value:"Module"})),A3e=`desc;$DKGRAYAutofilter for fx 0
`,C3e=Object.freeze(Object.defineProperty({__proto__:null,default:A3e},Symbol.toStringTag,{value:"Module"})),R3e=`desc;$DKGRAYAutofilter for fx 1
`,k3e=Object.freeze(Object.defineProperty({__proto__:null,default:R3e},Symbol.toStringTag,{value:"Module"})),M3e=`desc;$DKGRAYAutofilter for fx 2
`,O3e=Object.freeze(Object.defineProperty({__proto__:null,default:M3e},Symbol.toStringTag,{value:"Module"})),I3e=`desc;$DKGRAYApply autowah to fx 0-1
`,N3e=Object.freeze(Object.defineProperty({__proto__:null,default:I3e},Symbol.toStringTag,{value:"Module"})),P3e=`desc;$DKGRAYAutowah for fx 0
`,D3e=Object.freeze(Object.defineProperty({__proto__:null,default:P3e},Symbol.toStringTag,{value:"Module"})),L3e=`desc;$DKGRAYAutowah for fx 1
`,U3e=Object.freeze(Object.defineProperty({__proto__:null,default:L3e},Symbol.toStringTag,{value:"Module"})),B3e=`desc;$DKGRAYAutowah for fx 2
`,F3e=Object.freeze(Object.defineProperty({__proto__:null,default:B3e},Symbol.toStringTag,{value:"Module"})),j3e=`desc;$DKGRAYBBS login/publish actions
`,z3e=Object.freeze(Object.defineProperty({__proto__:null,default:j3e},Symbol.toStringTag,{value:"Module"})),V3e="desc;$DKGRAYchanges object into specified element",H3e=Object.freeze(Object.defineProperty({__proto__:null,default:V3e},Symbol.toStringTag,{value:"Module"})),$3e="desc;$DKGRAYlike #play but for sound effects",G3e=Object.freeze(Object.defineProperty({__proto__:null,default:$3e},Symbol.toStringTag,{value:"Module"})),W3e=`desc;$DKGRAYQuantized bgplay on 16n
`,q3e=Object.freeze(Object.defineProperty({__proto__:null,default:W3e},Symbol.toStringTag,{value:"Module"})),Y3e=`desc;$DKGRAYQuantized bgplay on 1m
`,K3e=Object.freeze(Object.defineProperty({__proto__:null,default:Y3e},Symbol.toStringTag,{value:"Module"})),X3e=`desc;$DKGRAYQuantized bgplay on 2n
`,J3e=Object.freeze(Object.defineProperty({__proto__:null,default:X3e},Symbol.toStringTag,{value:"Module"})),Z3e=`desc;$DKGRAYQuantized bgplay on 32n
`,Q3e=Object.freeze(Object.defineProperty({__proto__:null,default:Z3e},Symbol.toStringTag,{value:"Module"})),eNe=`desc;$DKGRAYQuantized bgplay on 4n
`,tNe=Object.freeze(Object.defineProperty({__proto__:null,default:eNe},Symbol.toStringTag,{value:"Module"})),nNe=`desc;$DKGRAYQuantized bgplay on 64n
`,rNe=Object.freeze(Object.defineProperty({__proto__:null,default:nNe},Symbol.toStringTag,{value:"Module"})),iNe=`desc;$DKGRAYQuantized bgplay on 8n
`,sNe=Object.freeze(Object.defineProperty({__proto__:null,default:iNe},Symbol.toStringTag,{value:"Module"})),oNe=`desc;$DKGRAYSet bgplay volume
`,aNe=Object.freeze(Object.defineProperty({__proto__:null,default:oNe},Symbol.toStringTag,{value:"Module"})),cNe=`desc;$DKGRAYCopy code from named element
`,lNe=Object.freeze(Object.defineProperty({__proto__:null,default:cNe},Symbol.toStringTag,{value:"Module"})),uNe=`desc;$DKGRAY
`,hNe=Object.freeze(Object.defineProperty({__proto__:null,default:uNe},Symbol.toStringTag,{value:"Module"})),fNe=`desc;$DKGRAYUsed to move player to board
`,dNe=Object.freeze(Object.defineProperty({__proto__:null,default:fNe},Symbol.toStringTag,{value:"Module"})),pNe=`desc;$DKGRAYList all boards as goto hyperlinks
`,mNe=Object.freeze(Object.defineProperty({__proto__:null,default:pNe},Symbol.toStringTag,{value:"Module"})),gNe=`desc;$DKGRAYExport entire book as JSON (operator only)
`,_Ne=Object.freeze(Object.defineProperty({__proto__:null,default:gNe},Symbol.toStringTag,{value:"Module"})),vNe=`desc;$DKGRAYShow book export options (operator only)
`,yNe=Object.freeze(Object.defineProperty({__proto__:null,default:vNe},Symbol.toStringTag,{value:"Module"})),bNe=`desc;$DKGRAYRename the main book (operator only)
`,SNe=Object.freeze(Object.defineProperty({__proto__:null,default:bNe},Symbol.toStringTag,{value:"Module"})),ENe=`desc;$DKGRAYList all books
`,xNe=Object.freeze(Object.defineProperty({__proto__:null,default:ENe},Symbol.toStringTag,{value:"Module"})),wNe=`desc;$DKGRAYTrash a book by address (operator only)
`,TNe=Object.freeze(Object.defineProperty({__proto__:null,default:wNe},Symbol.toStringTag,{value:"Module"})),ANe=`desc;$DKGRAYSet BPM
`,CNe=Object.freeze(Object.defineProperty({__proto__:null,default:ANe},Symbol.toStringTag,{value:"Module"})),RNe=`desc;$DKGRAY
`,kNe=Object.freeze(Object.defineProperty({__proto__:null,default:RNe},Symbol.toStringTag,{value:"Module"})),MNe=`desc;$DKGRAYStart/stop stream broadcast (operator only)
`,ONe=Object.freeze(Object.defineProperty({__proto__:null,default:MNe},Symbol.toStringTag,{value:"Module"})),INe=`desc;$DKGRAYCreate new board and write id to stat
`,NNe=Object.freeze(Object.defineProperty({__proto__:null,default:INe},Symbol.toStringTag,{value:"Module"})),PNe=`desc;$DKGRAYChange elements of one kind to another
`,DNe=Object.freeze(Object.defineProperty({__proto__:null,default:PNe},Symbol.toStringTag,{value:"Module"})),LNe=`desc;$DKGRAYSet character (self or at direction)
`,UNe=Object.freeze(Object.defineProperty({__proto__:null,default:LNe},Symbol.toStringTag,{value:"Module"})),BNe=`desc;$DKGRAY
`,FNe=Object.freeze(Object.defineProperty({__proto__:null,default:BNe},Symbol.toStringTag,{value:"Module"})),jNe=`desc;$DKGRAYStart/stop twitch chat integration (operator only)
`,zNe=Object.freeze(Object.defineProperty({__proto__:null,default:jNe},Symbol.toStringTag,{value:"Module"})),VNe="desc;$DKGRAYClear variables (set to 0)",HNe=Object.freeze(Object.defineProperty({__proto__:null,default:VNe},Symbol.toStringTag,{value:"Module"})),$Ne=`desc;$DKGRAYSet color (self or at direction)
`,GNe=Object.freeze(Object.defineProperty({__proto__:null,default:$Ne},Symbol.toStringTag,{value:"Module"})),WNe=`desc;$DKGRAY
`,qNe=Object.freeze(Object.defineProperty({__proto__:null,default:WNe},Symbol.toStringTag,{value:"Module"})),YNe=`desc;$DKGRAYCopy region from source to current board
`,KNe=Object.freeze(Object.defineProperty({__proto__:null,default:YNe},Symbol.toStringTag,{value:"Module"})),XNe=`desc;$DKGRAYSet element cycle value (1-255)
`,JNe=Object.freeze(Object.defineProperty({__proto__:null,default:XNe},Symbol.toStringTag,{value:"Module"})),ZNe=`desc;$DKGRAYEnter dev mode / halt execution (operator only)
`,QNe=Object.freeze(Object.defineProperty({__proto__:null,default:ZNe},Symbol.toStringTag,{value:"Module"})),ePe=`desc;$DKGRAYDelete element (halt execution unless @isitem)
`,tPe=Object.freeze(Object.defineProperty({__proto__:null,default:ePe},Symbol.toStringTag,{value:"Module"})),nPe=`desc;$DKGRAYApply distortion to fx 0-1
`,rPe=Object.freeze(Object.defineProperty({__proto__:null,default:nPe},Symbol.toStringTag,{value:"Module"})),iPe=`desc;$DKGRAYDistortion for fx 0
`,sPe=Object.freeze(Object.defineProperty({__proto__:null,default:iPe},Symbol.toStringTag,{value:"Module"})),oPe=`desc;$DKGRAYDistortion for fx 1
`,aPe=Object.freeze(Object.defineProperty({__proto__:null,default:oPe},Symbol.toStringTag,{value:"Module"})),cPe=`desc;$DKGRAYDistortion for fx 2
`,lPe=Object.freeze(Object.defineProperty({__proto__:null,default:cPe},Symbol.toStringTag,{value:"Module"})),uPe=`desc;$DKGRAYstarts a do-done block
`,hPe=Object.freeze(Object.defineProperty({__proto__:null,default:uPe},Symbol.toStringTag,{value:"Module"})),fPe=`desc;$DKGRAYcompletes an if-do-done block
`,dPe=Object.freeze(Object.defineProperty({__proto__:null,default:fPe},Symbol.toStringTag,{value:"Module"})),pPe=`desc;$DKGRAYDuplicate element at direction in given direction
`,mPe=Object.freeze(Object.defineProperty({__proto__:null,default:pPe},Symbol.toStringTag,{value:"Module"})),gPe=`desc;$DKGRAYDuplicate element with argument
`,_Pe=Object.freeze(Object.defineProperty({__proto__:null,default:gPe},Symbol.toStringTag,{value:"Module"})),vPe="desc;$DKGRAYDuplicate element at direction in given direction",yPe=Object.freeze(Object.defineProperty({__proto__:null,default:vPe},Symbol.toStringTag,{value:"Module"})),bPe=`desc;$DKGRAYDuplicate element with argument
`,SPe=Object.freeze(Object.defineProperty({__proto__:null,default:bPe},Symbol.toStringTag,{value:"Module"})),EPe="desc;$DKGRAYApply echo effect to fx 0-1",xPe=Object.freeze(Object.defineProperty({__proto__:null,default:EPe},Symbol.toStringTag,{value:"Module"})),wPe=`desc;$DKGRAYEcho for fx 0
`,TPe=Object.freeze(Object.defineProperty({__proto__:null,default:wPe},Symbol.toStringTag,{value:"Module"})),APe=`desc;$DKGRAYEcho for fx 1
`,CPe=Object.freeze(Object.defineProperty({__proto__:null,default:APe},Symbol.toStringTag,{value:"Module"})),RPe=`desc;$DKGRAYEcho for fx 2
`,kPe=Object.freeze(Object.defineProperty({__proto__:null,default:RPe},Symbol.toStringTag,{value:"Module"})),MPe=`desc;$DKGRAYelse logic in an if-do-done block
`,OPe=Object.freeze(Object.defineProperty({__proto__:null,default:MPe},Symbol.toStringTag,{value:"Module"})),IPe=`desc;$DKGRAYconditional else logic in an if-do-done block
`,NPe=Object.freeze(Object.defineProperty({__proto__:null,default:IPe},Symbol.toStringTag,{value:"Module"})),PPe="desc;$DKGRAYEnd program (optionally set 'arg' variable)",DPe=Object.freeze(Object.defineProperty({__proto__:null,default:PPe},Symbol.toStringTag,{value:"Module"})),LPe="desc;$DKGRAYSet health to 0",UPe=Object.freeze(Object.defineProperty({__proto__:null,default:LPe},Symbol.toStringTag,{value:"Module"})),BPe=`desc;$DKGRAY
`,FPe=Object.freeze(Object.defineProperty({__proto__:null,default:BPe},Symbol.toStringTag,{value:"Module"})),jPe=`desc;$DKGRAYShow export menu (operator only)
`,zPe=Object.freeze(Object.defineProperty({__proto__:null,default:jPe},Symbol.toStringTag,{value:"Module"})),VPe=`desc;$DKGRAYApply frequency crush to fx 0-1
`,HPe=Object.freeze(Object.defineProperty({__proto__:null,default:VPe},Symbol.toStringTag,{value:"Module"})),$Pe=`desc;$DKGRAYFrequency crush for fx 0
`,GPe=Object.freeze(Object.defineProperty({__proto__:null,default:$Pe},Symbol.toStringTag,{value:"Module"})),WPe=`desc;$DKGRAYFrequency crush for fx 1
`,qPe=Object.freeze(Object.defineProperty({__proto__:null,default:WPe},Symbol.toStringTag,{value:"Module"})),YPe=`desc;$DKGRAYFrequency crush for fx 2
`,KPe=Object.freeze(Object.defineProperty({__proto__:null,default:YPe},Symbol.toStringTag,{value:"Module"})),XPe=`desc;$DKGRAYFetch URL with label, method, and optional data
`,JPe=Object.freeze(Object.defineProperty({__proto__:null,default:XPe},Symbol.toStringTag,{value:"Module"})),ZPe=`desc;$DKGRAYFetch URL with argument, label, method, and optional data
`,QPe=Object.freeze(Object.defineProperty({__proto__:null,default:ZPe},Symbol.toStringTag,{value:"Module"})),e2e=`desc;$DKGRAYHighlight matched elements
`,t2e=Object.freeze(Object.defineProperty({__proto__:null,default:e2e},Symbol.toStringTag,{value:"Module"})),n2e=`desc;$DKGRAY
`,r2e=Object.freeze(Object.defineProperty({__proto__:null,default:n2e},Symbol.toStringTag,{value:"Module"})),i2e=`desc;$DKGRAYOpen tab with copy of state (operator only)
`,s2e=Object.freeze(Object.defineProperty({__proto__:null,default:i2e},Symbol.toStringTag,{value:"Module"})),o2e=`desc;$DKGRAYToggle built-in inspector
`,a2e=Object.freeze(Object.defineProperty({__proto__:null,default:o2e},Symbol.toStringTag,{value:"Module"})),c2e=`desc;$DKGRAYMove element in direction
`,l2e=Object.freeze(Object.defineProperty({__proto__:null,default:c2e},Symbol.toStringTag,{value:"Module"})),u2e=`desc;$DKGRAYTeleport player to board by stat with optional x, y
`,h2e=Object.freeze(Object.defineProperty({__proto__:null,default:u2e},Symbol.toStringTag,{value:"Module"})),f2e=`desc;$DKGRAYShow help scroll
`,d2e=Object.freeze(Object.defineProperty({__proto__:null,default:f2e},Symbol.toStringTag,{value:"Module"})),p2e=`desc;$DKGRAYhyperlink
`,m2e=Object.freeze(Object.defineProperty({__proto__:null,default:p2e},Symbol.toStringTag,{value:"Module"})),g2e=`desc;$DKGRAYYield execution until next tick
`,_2e=Object.freeze(Object.defineProperty({__proto__:null,default:g2e},Symbol.toStringTag,{value:"Module"})),v2e=`desc;$DKGRAYevals condition for true or false
`,y2e=Object.freeze(Object.defineProperty({__proto__:null,default:v2e},Symbol.toStringTag,{value:"Module"})),b2e=`desc;$DKGRAYExport zip file for itch.io (operator only)
`,S2e=Object.freeze(Object.defineProperty({__proto__:null,default:b2e},Symbol.toStringTag,{value:"Module"})),E2e=`desc;$DKGRAYStart multiplayer session (operator only)
`,x2e=Object.freeze(Object.defineProperty({__proto__:null,default:E2e},Symbol.toStringTag,{value:"Module"})),w2e=`desc;$DKGRAYOpen new tab with the join url (operator only)
`,T2e=Object.freeze(Object.defineProperty({__proto__:null,default:w2e},Symbol.toStringTag,{value:"Module"})),A2e=`desc;$DKGRAYLoad code from object codepage into object at given direction
`,C2e=Object.freeze(Object.defineProperty({__proto__:null,default:A2e},Symbol.toStringTag,{value:"Module"})),R2e=`desc;$DKGRAYLock against external messages
`,k2e=Object.freeze(Object.defineProperty({__proto__:null,default:R2e},Symbol.toStringTag,{value:"Module"})),M2e=`desc;$DKGRAYDoes a countdown and reloads into an empty state (operator only)
`,O2e=Object.freeze(Object.defineProperty({__proto__:null,default:M2e},Symbol.toStringTag,{value:"Module"})),I2e=`desc;$DKGRAYUses given id to ensure only one element of given kind is made
`,N2e=Object.freeze(Object.defineProperty({__proto__:null,default:I2e},Symbol.toStringTag,{value:"Module"})),P2e=`desc;$DKGRAYPut element with argument and oneof logic
`,D2e=Object.freeze(Object.defineProperty({__proto__:null,default:P2e},Symbol.toStringTag,{value:"Module"})),L2e=`desc;$DKGRAYExport code page as JSON (operator only)
`,U2e=Object.freeze(Object.defineProperty({__proto__:null,default:L2e},Symbol.toStringTag,{value:"Module"})),B2e=`desc;$DKGRAYOpen a code page editor
`,F2e=Object.freeze(Object.defineProperty({__proto__:null,default:B2e},Symbol.toStringTag,{value:"Module"})),j2e=`desc;$DKGRAYList all pages in main book
`,z2e=Object.freeze(Object.defineProperty({__proto__:null,default:j2e},Symbol.toStringTag,{value:"Module"})),V2e=`desc;$DKGRAYTrash a code page (operator only)
`,H2e=Object.freeze(Object.defineProperty({__proto__:null,default:V2e},Symbol.toStringTag,{value:"Module"})),$2e=`desc;$DKGRAY
`,G2e=Object.freeze(Object.defineProperty({__proto__:null,default:$2e},Symbol.toStringTag,{value:"Module"})),W2e=`desc;$DKGRAYRotate board elements by degrees
`,q2e=Object.freeze(Object.defineProperty({__proto__:null,default:W2e},Symbol.toStringTag,{value:"Module"})),Y2e="desc;$DKGRAYPlay music notes",K2e=Object.freeze(Object.defineProperty({__proto__:null,default:Y2e},Symbol.toStringTag,{value:"Module"})),X2e=`desc;$DKGRAYShove target object in direction ONLY if pushable
`,J2e=Object.freeze(Object.defineProperty({__proto__:null,default:X2e},Symbol.toStringTag,{value:"Module"})),Z2e="desc;$DKGRAYPut element in direction",Q2e=Object.freeze(Object.defineProperty({__proto__:null,default:Z2e},Symbol.toStringTag,{value:"Module"})),eDe=`desc;$DKGRAYPut element with argument
`,tDe=Object.freeze(Object.defineProperty({__proto__:null,default:eDe},Symbol.toStringTag,{value:"Module"})),nDe=`desc;$DKGRAYRead property from object into variable
`,rDe=Object.freeze(Object.defineProperty({__proto__:null,default:nDe},Symbol.toStringTag,{value:"Module"})),iDe=`desc;$DKGRAYParse binary data
`,sDe=Object.freeze(Object.defineProperty({__proto__:null,default:iDe},Symbol.toStringTag,{value:"Module"})),oDe=`desc;$DKGRAYParse JSON data
`,aDe=Object.freeze(Object.defineProperty({__proto__:null,default:oDe},Symbol.toStringTag,{value:"Module"})),cDe=`desc;$DKGRAYParse text data
`,lDe=Object.freeze(Object.defineProperty({__proto__:null,default:cDe},Symbol.toStringTag,{value:"Module"})),uDe=`desc;$DKGRAY
`,hDe=Object.freeze(Object.defineProperty({__proto__:null,default:uDe},Symbol.toStringTag,{value:"Module"})),fDe=`desc;$DKGRAYRemix from source with pattern size and mirror to current board
`,dDe=Object.freeze(Object.defineProperty({__proto__:null,default:fDe},Symbol.toStringTag,{value:"Module"})),pDe=`desc;$DKGRAY
`,mDe=Object.freeze(Object.defineProperty({__proto__:null,default:pDe},Symbol.toStringTag,{value:"Module"})),gDe=`desc;$DKGRAYRestart software, deletes all chip and player state (operator only)
`,_De=Object.freeze(Object.defineProperty({__proto__:null,default:gDe},Symbol.toStringTag,{value:"Module"})),vDe=`desc;$DKGRAYRestore all labels of given name
`,yDe=Object.freeze(Object.defineProperty({__proto__:null,default:vDe},Symbol.toStringTag,{value:"Module"})),bDe=`desc;$DKGRAYApply reverb to fx 0-1
`,SDe=Object.freeze(Object.defineProperty({__proto__:null,default:bDe},Symbol.toStringTag,{value:"Module"})),EDe=`desc;$DKGRAYReverb for fx 0
`,xDe=Object.freeze(Object.defineProperty({__proto__:null,default:EDe},Symbol.toStringTag,{value:"Module"})),wDe=`desc;$DKGRAYReverb for fx 1
`,TDe=Object.freeze(Object.defineProperty({__proto__:null,default:wDe},Symbol.toStringTag,{value:"Module"})),ADe=`desc;$DKGRAYReverb for fx 2
`,CDe=Object.freeze(Object.defineProperty({__proto__:null,default:ADe},Symbol.toStringTag,{value:"Module"})),RDe=`desc;$DKGRAYRevert board to snapshot state
`,kDe=Object.freeze(Object.defineProperty({__proto__:null,default:RDe},Symbol.toStringTag,{value:"Module"})),MDe=`desc;$DKGRAYRun object codepage of given name
`,ODe=Object.freeze(Object.defineProperty({__proto__:null,default:MDe},Symbol.toStringTag,{value:"Module"})),IDe=`desc;$DKGRAYRun function with argument
`,NDe=Object.freeze(Object.defineProperty({__proto__:null,default:IDe},Symbol.toStringTag,{value:"Module"})),PDe=`desc;$DKGRAYSave state to url (operator only)
`,DDe=Object.freeze(Object.defineProperty({__proto__:null,default:PDe},Symbol.toStringTag,{value:"Module"})),LDe=`desc;$DKGRAYRegister screenshot for capture
`,UDe=Object.freeze(Object.defineProperty({__proto__:null,default:LDe},Symbol.toStringTag,{value:"Module"})),BDe=`desc;$DKGRAYsend
`,FDe=Object.freeze(Object.defineProperty({__proto__:null,default:BDe},Symbol.toStringTag,{value:"Module"})),jDe="desc;$DKGRAYSet variable to value",zDe=Object.freeze(Object.defineProperty({__proto__:null,default:jDe},Symbol.toStringTag,{value:"Module"})),VDe=`desc;$DKGRAYget share url (operator only)
`,HDe=Object.freeze(Object.defineProperty({__proto__:null,default:VDe},Symbol.toStringTag,{value:"Module"})),$De=`desc;$DKGRAYShoot projectile, with optional kind
`,GDe=Object.freeze(Object.defineProperty({__proto__:null,default:$De},Symbol.toStringTag,{value:"Module"})),WDe=`desc;$DKGRAYShoot projectile with argument
`,qDe=Object.freeze(Object.defineProperty({__proto__:null,default:WDe},Symbol.toStringTag,{value:"Module"})),YDe=`desc;$DKGRAYshortsend
`,KDe=Object.freeze(Object.defineProperty({__proto__:null,default:YDe},Symbol.toStringTag,{value:"Module"})),XDe=`desc;$DKGRAYShove target object in direction
`,JDe=Object.freeze(Object.defineProperty({__proto__:null,default:XDe},Symbol.toStringTag,{value:"Module"})),ZDe=`desc;$DKGRAYCreate board snapshot
`,QDe=Object.freeze(Object.defineProperty({__proto__:null,default:ZDe},Symbol.toStringTag,{value:"Module"})),eLe=`desc;$DKGRAYstat
`,tLe=Object.freeze(Object.defineProperty({__proto__:null,default:eLe},Symbol.toStringTag,{value:"Module"})),nLe=`desc;$DKGRAYConfigure or restart 8track synth
`,rLe=Object.freeze(Object.defineProperty({__proto__:null,default:nLe},Symbol.toStringTag,{value:"Module"})),iLe=`desc;$DKGRAYConfigure synth voice 1
`,sLe=Object.freeze(Object.defineProperty({__proto__:null,default:iLe},Symbol.toStringTag,{value:"Module"})),oLe=`desc;$DKGRAYConfigure synth voice 2
`,aLe=Object.freeze(Object.defineProperty({__proto__:null,default:oLe},Symbol.toStringTag,{value:"Module"})),cLe=`desc;$DKGRAYConfigure synth voice 3
`,lLe=Object.freeze(Object.defineProperty({__proto__:null,default:cLe},Symbol.toStringTag,{value:"Module"})),uLe=`desc;$DKGRAYConfigure synth voice 4
`,hLe=Object.freeze(Object.defineProperty({__proto__:null,default:uLe},Symbol.toStringTag,{value:"Module"})),fLe=`desc;$DKGRAYConfigure bgplay synth (voices 4-8)
`,dLe=Object.freeze(Object.defineProperty({__proto__:null,default:fLe},Symbol.toStringTag,{value:"Module"})),pLe=`desc;$DKGRAYClear buffer of played notes
`,mLe=Object.freeze(Object.defineProperty({__proto__:null,default:pLe},Symbol.toStringTag,{value:"Module"})),gLe=`desc;$DKGRAYRecord played note buffer to an mp3 file
`,_Le=Object.freeze(Object.defineProperty({__proto__:null,default:gLe},Symbol.toStringTag,{value:"Module"})),vLe=`desc;$DKGRAYtext
`,yLe=Object.freeze(Object.defineProperty({__proto__:null,default:vLe},Symbol.toStringTag,{value:"Module"})),bLe="desc;$DKGRAYThrow star projectile, shorthand for `#shoot <dir> star`\n",SLe=Object.freeze(Object.defineProperty({__proto__:null,default:bLe},Symbol.toStringTag,{value:"Module"})),ELe=`desc;$DKGRAYThrow star with argument
`,xLe=Object.freeze(Object.defineProperty({__proto__:null,default:ELe},Symbol.toStringTag,{value:"Module"})),wLe=`desc;$DKGRAYSets element ticker text
`,TLe=Object.freeze(Object.defineProperty({__proto__:null,default:wLe},Symbol.toStringTag,{value:"Module"})),ALe=`desc;$DKGRAYShow toast notification
`,CLe=Object.freeze(Object.defineProperty({__proto__:null,default:ALe},Symbol.toStringTag,{value:"Module"})),RLe=`desc;$DKGRAYMove element across board with transporter logic
`,kLe=Object.freeze(Object.defineProperty({__proto__:null,default:RLe},Symbol.toStringTag,{value:"Module"})),MLe=`desc;$DKGRAYList books/codepages to delete (operator only)
`,OLe=Object.freeze(Object.defineProperty({__proto__:null,default:MLe},Symbol.toStringTag,{value:"Module"})),ILe=`desc;$DKGRAYSpeak text with voice (or clear queue)
`,NLe=Object.freeze(Object.defineProperty({__proto__:null,default:ILe},Symbol.toStringTag,{value:"Module"})),PLe=`desc;$DKGRAYSet TTS engine and config
`,DLe=Object.freeze(Object.defineProperty({__proto__:null,default:PLe},Symbol.toStringTag,{value:"Module"})),LLe=`desc;$DKGRAYQueue TTS phrase
`,ULe=Object.freeze(Object.defineProperty({__proto__:null,default:LLe},Symbol.toStringTag,{value:"Module"})),BLe=`desc;$DKGRAYSet TTS volume
`,FLe=Object.freeze(Object.defineProperty({__proto__:null,default:BLe},Symbol.toStringTag,{value:"Module"})),jLe=`desc;$DKGRAY
`,zLe=Object.freeze(Object.defineProperty({__proto__:null,default:jLe},Symbol.toStringTag,{value:"Module"})),VLe=`desc;$DKGRAY
`,HLe=Object.freeze(Object.defineProperty({__proto__:null,default:VLe},Symbol.toStringTag,{value:"Module"})),$Le=`desc;$DKGRAYUnlock against messages from others
`,GLe=Object.freeze(Object.defineProperty({__proto__:null,default:$Le},Symbol.toStringTag,{value:"Module"})),WLe=`desc;$DKGRAYAutomate user input actions (up/down/left/right/etc)
`,qLe=Object.freeze(Object.defineProperty({__proto__:null,default:WLe},Symbol.toStringTag,{value:"Module"})),YLe=`desc;$DKGRAYApply vibrato to fx 0-1
`,KLe=Object.freeze(Object.defineProperty({__proto__:null,default:YLe},Symbol.toStringTag,{value:"Module"})),XLe=`desc;$DKGRAYVibrato for fx 0
`,JLe=Object.freeze(Object.defineProperty({__proto__:null,default:XLe},Symbol.toStringTag,{value:"Module"})),ZLe=`desc;$DKGRAYVibrato for fx 1
`,QLe=Object.freeze(Object.defineProperty({__proto__:null,default:ZLe},Symbol.toStringTag,{value:"Module"})),e4e=`desc;$DKGRAYVibrato for fx 2
`,t4e=Object.freeze(Object.defineProperty({__proto__:null,default:e4e},Symbol.toStringTag,{value:"Module"})),n4e="desc;$DKGRAYSet main volume",r4e=Object.freeze(Object.defineProperty({__proto__:null,default:n4e},Symbol.toStringTag,{value:"Module"})),i4e="desc;$DKGRAY",s4e=Object.freeze(Object.defineProperty({__proto__:null,default:i4e},Symbol.toStringTag,{value:"Module"})),o4e="desc;$DKGRAYWill cause element to move in direction each tick",a4e=Object.freeze(Object.defineProperty({__proto__:null,default:o4e},Symbol.toStringTag,{value:"Module"})),c4e="desc;$DKGRAYWeave board elements in direction",l4e=Object.freeze(Object.defineProperty({__proto__:null,default:c4e},Symbol.toStringTag,{value:"Module"})),u4e="desc;$DKGRAYlooping do-done block",h4e=Object.freeze(Object.defineProperty({__proto__:null,default:u4e},Symbol.toStringTag,{value:"Module"})),f4e="desc;$DKGRAYSwitch to target board by id, name, or stat",d4e=Object.freeze(Object.defineProperty({__proto__:null,default:f4e},Symbol.toStringTag,{value:"Module"})),p4e="desc;$DKGRAYSwitch to target object id",m4e=Object.freeze(Object.defineProperty({__proto__:null,default:p4e},Symbol.toStringTag,{value:"Module"})),g4e="desc;$DKGRAYWrite text to board at direction",_4e=Object.freeze(Object.defineProperty({__proto__:null,default:g4e},Symbol.toStringTag,{value:"Module"})),v4e="desc;$DKGRAYDe-activate first label of given name",y4e=Object.freeze(Object.defineProperty({__proto__:null,default:v4e},Symbol.toStringTag,{value:"Module"})),b4e=`desc;$DKGRAYGet random ZZT content
`,S4e=Object.freeze(Object.defineProperty({__proto__:null,default:b4e},Symbol.toStringTag,{value:"Module"})),E4e=`desc;$DKGRAYSearch ZZT content by field and text
`,x4e=Object.freeze(Object.defineProperty({__proto__:null,default:E4e},Symbol.toStringTag,{value:"Module"})),w4e=`desc;$DKGRAYdesignates an inactive label or comment
`,T4e=Object.freeze(Object.defineProperty({__proto__:null,default:w4e},Symbol.toStringTag,{value:"Module"})),A4e=`desc;$DKGRAYadds hyperlink text

`,C4e=Object.freeze(Object.defineProperty({__proto__:null,default:A4e},Symbol.toStringTag,{value:"Module"})),R4e=`desc;$DKGRAYsends the given message when hotkey is pressed

`,k4e=Object.freeze(Object.defineProperty({__proto__:null,default:R4e},Symbol.toStringTag,{value:"Module"})),M4e=`desc;$DKGRAYread number input into given stat/flag
`,O4e=Object.freeze(Object.defineProperty({__proto__:null,default:M4e},Symbol.toStringTag,{value:"Module"})),I4e=`desc;$DKGRAYa slider input from 1 to 9 

`,N4e=Object.freeze(Object.defineProperty({__proto__:null,default:I4e},Symbol.toStringTag,{value:"Module"})),P4e=`desc;$DKGRAYlist with label value pairs to pick from
`,D4e=Object.freeze(Object.defineProperty({__proto__:null,default:P4e},Symbol.toStringTag,{value:"Module"})),L4e=`desc;$DKGRAYread text input into given stat/flag
`,U4e=Object.freeze(Object.defineProperty({__proto__:null,default:L4e},Symbol.toStringTag,{value:"Module"})),B4e=`desc;$DKGRAYdesignates a starting point for running code
`,F4e=Object.freeze(Object.defineProperty({__proto__:null,default:B4e},Symbol.toStringTag,{value:"Module"})),j4e=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,z4e=Object.freeze(Object.defineProperty({__proto__:null,default:j4e},Symbol.toStringTag,{value:"Module"})),V4e=`desc;$DKGRAYwill move the object in the given direction
`,H4e=Object.freeze(Object.defineProperty({__proto__:null,default:V4e},Symbol.toStringTag,{value:"Module"})),$4e=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,G4e=Object.freeze(Object.defineProperty({__proto__:null,default:$4e},Symbol.toStringTag,{value:"Module"})),W4e=`desc;$DKGRAYcustom 8x14 charset
`,q4e=Object.freeze(Object.defineProperty({__proto__:null,default:W4e},Symbol.toStringTag,{value:"Module"})),Y4e=`desc;$DKGRAYsets stat to given value

`,K4e=Object.freeze(Object.defineProperty({__proto__:null,default:Y4e},Symbol.toStringTag,{value:"Module"})),X4e=`desc;$DKGRAYsends the given message when hotkey is pressed

`,J4e=Object.freeze(Object.defineProperty({__proto__:null,default:X4e},Symbol.toStringTag,{value:"Module"})),Z4e=`desc;$DKGRAYread external content and/or handle events
`,Q4e=Object.freeze(Object.defineProperty({__proto__:null,default:Z4e},Symbol.toStringTag,{value:"Module"})),e5e=`desc;$DKGRAYread number input into given stat/flag
`,t5e=Object.freeze(Object.defineProperty({__proto__:null,default:e5e},Symbol.toStringTag,{value:"Module"})),n5e=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,r5e=Object.freeze(Object.defineProperty({__proto__:null,default:n5e},Symbol.toStringTag,{value:"Module"})),i5e=`desc;$DKGRAYcustom palette colors
`,s5e=Object.freeze(Object.defineProperty({__proto__:null,default:i5e},Symbol.toStringTag,{value:"Module"})),o5e=`desc;$DKGRAYa slider input from 1 to 9 

`,a5e=Object.freeze(Object.defineProperty({__proto__:null,default:o5e},Symbol.toStringTag,{value:"Module"})),c5e=`desc;$DKGRAYlist with label value pairs to pick from
`,l5e=Object.freeze(Object.defineProperty({__proto__:null,default:c5e},Symbol.toStringTag,{value:"Module"})),u5e=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,h5e=Object.freeze(Object.defineProperty({__proto__:null,default:u5e},Symbol.toStringTag,{value:"Module"})),f5e=`desc;$DKGRAYread text input into given stat/flag
`,d5e=Object.freeze(Object.defineProperty({__proto__:null,default:f5e},Symbol.toStringTag,{value:"Module"})),p5e=`desc;$DKGRAYadds text
`,m5e=Object.freeze(Object.defineProperty({__proto__:null,default:p5e},Symbol.toStringTag,{value:"Module"})),g5e=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,_5e=Object.freeze(Object.defineProperty({__proto__:null,default:g5e},Symbol.toStringTag,{value:"Module"})),v5e=`section;legend
s1, s2, s3, s4 = sound sources/operators
m = modulator
c = carrier
--> = signal flow
section;algo0
S1 --> M --> S2 --> M --> S3 --> M --> S4 --> C
`,y5e=Object.freeze(Object.defineProperty({__proto__:null,default:v5e},Symbol.toStringTag,{value:"Module"})),b5e=`section;#autofilter on
#autofilter <number>
$white 0-100, 0 is off, 100 is full volume
#autofilter depth <number>
$white Controls the intensity of the filter.
#autofilter frequency <number>
$white The rate of oscilation of the effect.
#autofilter octaves <number>
$white Controls the range of the effect.
#autofilter q <number>
$white Sets the intensity of the effect.
#autofilter type <lowpass, highpass, ...>
$white Sets the behavior of the filter.
!openit https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode/type;filter types`,S5e=Object.freeze(Object.defineProperty({__proto__:null,default:b5e},Symbol.toStringTag,{value:"Module"})),E5e=`section;#autowah on
#autowah <number>
$white 0-100, 0 is off, 100 is full volume
#autowah basefrequency <frequency>
$white The frequency the filter is set to at the
$white low point of the wah.
#autowah octaves <number>
$white The number of octaves above the baseFrequency 
$white the filter will sweep to when fully open.
#autowah sensitivity <number>
$white The decibel threshold sensitivity for 
$white the incoming signal.
$white Normal range of -40 to 0.
#autowah gain <number>
$white Controls the loudness of the effect.
#autowah follower <seconds>
$white Sets the smoothing time for the effect.`,x5e=Object.freeze(Object.defineProperty({__proto__:null,default:E5e},Symbol.toStringTag,{value:"Module"})),w5e=`press$white C$yellow to chat
press$white #$yellow to run a quick command
section;dev-tools
#gadget
$white toggles inspector tool on/off
#zztrandom
$white downloads random from the museumofzzt api
#zztsearch <field> <value>
$white searches the museumofzzt api for zzt games
section;multi-player
#set user <name>
$white sets your display name when talking to others
#joincode OR $meta+O 
$white starts a multi-player session showing a
$white QR code. It also provides are sharable link
$white you can give to other to join the game.`,T5e=Object.freeze(Object.defineProperty({__proto__:null,default:w5e},Symbol.toStringTag,{value:"Module"})),A5e=`section;element - movement and state
#go <dir>
$whitemove element one step
#walk <dir>
$whiteset step for continuous movement
#idle
$whitepause until next tick
#set <name> <value>
$whiteset stat or variable
#clear <stat>
$whiteset stats to 0
#cycle <1-255>
$whiteset element cycle speed
section;element - transformation
#become <kind>
$whitetransform into kind
#char [dir] <value>
$whiteset char at dir or self
#color [dir] <color>
$whiteset color at dir or self
#bind <name>
$whiteset copy code from named element
section;element - lifecycle
#end [result]
$whiteend program, optional arg
#die
$whitedelete element
#lock / #unlock
$whitelock or unlock chip
#restore <id>
$whiterestore labels
#zap <id>
$whitedeactivate label
section;element - execution
#run <func>
$whiterun codepage by name
#runwith <arg> <func>
$whiterun with argument
#load <dir> [action]
$whiteload code from object
#read <from> <prop> <name>
$whiteread property into stat
#array <name> val
$whiteset stat to array
section;element - ui
#toast text
$whiteshow toast notification
#ticker text
$whiteset ticker text
section;board - navigation
#build <stat> [source]
$whitecreate board, write id to stat
#goto <stat> [x y]
$whiteteleport player to board
#transport <target>
$whitemove object along transporter
section;board - placement
#put <dir> <kind>
$whiteplace element at direction
#putwith <arg> <dir> <kind>
$whiteplace with arg
#oneof <mark> <dir> <kind>
$whiteplace only if none with mark
#oneofwith <arg> <mark> <dir> <kind>
$whiteoneof with arg
#write <dir> <color> text
$whitewrite colored text
section;board - projectiles
#shoot <dir> [kind]
$whiteshoot bullet
#shootwith <arg> <dir> [kind]
$whiteshoot with arg
#throwstar <dir>
$whiteshoot star
#throwstarwith <arg> <dir>
$whitestar with arg
section;board - manipulation
#duplicate / #dupe <dir> <dupedir>
$whiteduplicate element
#duplicatewith / #dupewith <arg> <dir> <dupedir>
$whitedupe with arg
#shove <dir> <movedir>
$whitemove object
#push <dir> <movedir>
$whiteshove if pushable only
#change <target> <into>
$whitechange elements to kind
section;transforms
#snapshot
$whitesave board state
#revert
$whiterestore snapshot
#copy <stat> [filter]
$whitecopy region from board
#remix <stat> <size> <mirror> [filter]
$whiteremix with pattern
#weave <dir> [filter]
$whiteshift/wrap board
#pivot <degrees> [filter]
$whiterotate by degrees
section;loader - file read
#readline <kind> [args]
$whiteread text line or regex
#readjson <jmespath> <name>
$whitequery json into stat
#readbin <kind> [args]
$whiteread binary (uint8, int16, etc)
section;loader - context
#withboard <stat>
$whiteset board context
#withobject <id>
$whiteset element context
#userinput <action>
$whitesimulate input (up, down, ok, etc)
section;network
#fetch <label> <url> [method] [args]
$whitehttp request, callback at label
#fetchwith <arg> <label> <url> [method] [args]
$whitefetch with arg
section;audio - playback
#play [buffer]
$whiteplay music
#bgplay [buffer]
$whitebackground play
#bgplayon64n $26 #bgplayon1n
$whitequantized bg play
#vol / #bgvol <volume>
$whiteset volume
#bpm <bpm>
$whiteset tempo
section;audio - synthesis
#synth [config]
$whiteconfigure play voices
#synth1  #synth5
$whiteper-voice config
#synthrecord [filename]
$whiterecord output
#synthflush
$whiteclear synth buffer
section;audio - tts
#ttsengine <engine> [config]
$whiteset tts engine
#tts [voice] [phrase]
$whitespeak or clear queue
#ttsqueue <voice> <phrase>
$whitequeue phrase
#ttsvol <volume>
$whiteset tts volume
section;audio - effects
#echo / #fcrush / #autofilter
$whitevoices 0 $26 1
#reverb / #distort / #vibrato / #autowah
$whitevoices 0 $26 1
#echo1-3, #reverb1-3, etc
$whiteper-voice
section;runtime
#send <spec>
$whitedispatch to elements
#shortsend <spec>
$whiteshort send
#text text
$whiteset gadget text
#hyperlink <label> words
$whitecreate hyperlink
#help
$whiteopen reference scroll
#endgame
$whiteset health to 0
`,C5e=Object.freeze(Object.defineProperty({__proto__:null,default:A5e},Symbol.toStringTag,{value:"Module"})),R5e=`section;#distort on
#distort <number>
$white 0-100, 0 is off, 100 is full volume
#distort distortion <number>
$white 0 or higher, controls strength of effect.
#distort oversample <2x|4x|none>
$white oversample improves quality.`,k5e=Object.freeze(Object.defineProperty({__proto__:null,default:R5e},Symbol.toStringTag,{value:"Module"})),M5e=`section;#echo on
#echo <number>
$white 0-100, 0 is off, 100 is full volume
#echo delaytime <seconds>
$white duration between echos.
#echo feedback <number>
$white A number that is between [0, 1]
$white 1 is forever feedback and 0 is none.`,O5e=Object.freeze(Object.defineProperty({__proto__:null,default:M5e},Symbol.toStringTag,{value:"Module"})),I5e=`!fcrushscroll hk c C next;#fcrush on
!echoscroll hk e E next;#echo on
!reverbscroll hk r R next;#reverb on
!autofilterscroll hk f F next;#autofilter on
!distortscroll hk d D next;#distort on
!vibratoscroll hk v V next;#vibrato on
!autowahscroll hk w W next;#autowah on`,N5e=Object.freeze(Object.defineProperty({__proto__:null,default:I5e},Symbol.toStringTag,{value:"Module"})),P5e=`section;#fcrush on
#fcrush <number>
$white 0-100, 0 is off, 100 is full volume
#fcrush rate <number>
$white 1 or higher, more rate, more crush`,D5e=Object.freeze(Object.defineProperty({__proto__:null,default:P5e},Symbol.toStringTag,{value:"Module"})),L5e=`section;keyboard input
option;arrow keys;$greenmove
option;shift + arrow keys;$greenshoot
option;enter;$greenok / accept
option;escape;$greencancel / close
option;tab;$greenmenu / layout
section;controller input
option;left stick;$greenmove
option;right stick;$greenshoot
option;left trigger;$greenalt
option;right trigger;$green$meta
option;left shoulder;$greencancel / close
option;right shoulder;$greenok / accept
option;d-pad;$greenmove
option;a X;$greenshoot down
option;b $9;$greenshoot right
option;x $254;$greenshoot left
option;y $30;$greenshoot up
option;menu;$greenmenu / change layout
`,U5e=Object.freeze(Object.defineProperty({__proto__:null,default:L5e},Symbol.toStringTag,{value:"Module"})),B5e=`option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,F5e=Object.freeze(Object.defineProperty({__proto__:null,default:B5e},Symbol.toStringTag,{value:"Module"})),j5e=`!helpcontrols hk c C next;read help on controls
!helptext hk t T next;read help on text and inputs
"
keyboard input
option;? or /;$greenopen cli
option;esc;$greenclose cli, scroll, or editor
option;tab;$greenchange layout
option;up or down arrow keys;$greennavigate cli lines
option;left or right arrow keys;$greenchange cli lines
option;enter;$greenaction on selected line
option;alt + arrow keys;$greenskip words and cli lines
option;$meta + up / down arrow keys;$greeninput history`,z5e=Object.freeze(Object.defineProperty({__proto__:null,default:j5e},Symbol.toStringTag,{value:"Module"})),V5e=`player settings
$white#set user "name goes here"
`,H5e=Object.freeze(Object.defineProperty({__proto__:null,default:V5e},Symbol.toStringTag,{value:"Module"})),$5e=`section;typography
plain text
use $34@quoted strings for special chars$34
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$yellow to change
 foreground color
use color names like $black$ONGREEN$$ongreen$ONCLEAR$yellow to change
 background color
use onclear $WHITE$$onclear$yellow to change
 background to transparent
section;hyperlinks
"
option;!message$59 Label;
send the given #message when the
<hyperlink> is pressed
"
option;!message hotkey <shortcut>$59 Label;
option;!message hk <shortcut>$59 Label;
send the given #message when the <shortcut>
is pressed. is-hotkey listens for <shortcut>
!openit https://github.com/ianstormtaylor/is-hotkey;$whiteis-hotkey on https://github.com/
"
option;!flagorstat range [minword] [maxword]$59 Label;
option;!flagorstat rn [minword] [maxword]$59 Label;
uses the standard 1 to 9 values input range
[minword] is the label for value 1
[maxword] is the label for value 9
write user range input into a flagorstat
"
option;!flagorstat select <choices>$59 Label;
option;!flagorstat sl <choices>$59 Label;
<choices> is a list of <word> <value> pairs
select gives a user a way to cycle through
preset choices
write user select input into a flagorstat
"
option;!flagorstat number$59 Label;
option;!flagorstat nm$59 Label;
write user number input into a flagorstat
"
option;!flagorstat text$59 Label;
option;!flagorstat tx$59 Label;
write user text input into a flagorstat
"
option;!copyit content goes here$59 Label;
copies given content into the clipboard
"
option;!openit url$59 Label;
opens the given url in a new browser tab
"
option;!runit content goes here$59 Label;
opens the cli, with the input filled out with 
the given content`,G5e=Object.freeze(Object.defineProperty({__proto__:null,default:$5e},Symbol.toStringTag,{value:"Module"})),W5e=`!helpmenu hk 1 1 next;controls and $greenstart here
!objectlistscroll hk 2 2 next;list object elements
!terrainlistscroll hk 3 3 next;list terrain elements
!adminscroll hk 4 4 next;cpu #admin
!cliscroll hk t T next;cli commands
!commandsscroll hk d D next;dictionary of all commands
!charscroll hk a A next;char
!colorscroll hk c C next;color
!bgscroll hk b B next;bg
!notesscroll hk n N next;notes
!synthscroll hk s S next;synth
!effectsscroll hk e E next;effects
!voicescroll hk v V next;tts voices
`,q5e=Object.freeze(Object.defineProperty({__proto__:null,default:W5e},Symbol.toStringTag,{value:"Module"})),Y5e=`"duration             cdefgab = notes 
"y = 64th note        x = rest
"t = 32nd note        
"s = 16th note        drums
"i = eight note       0 = hihat
"q = quarter note     1 = open hihat
"h = half note        2 = cowbell
"w = whole note       p = clap
"mods                 4 = high snare
"3 = triplet          5 = high woodblock
". = time and a half  6 = low snare
"# = sharp            7 = low tom
"! = flat             8 = low woodblock
"+ = increase octave  9 = bass drum
"- = decrease octave
helpful resource on scales
!openit https://www.pianoscales.org/;https://www.pianoscales.org/`,K5e=Object.freeze(Object.defineProperty({__proto__:null,default:Y5e},Symbol.toStringTag,{value:"Module"})),X5e=`section;sine, square, triangle, sawtooth
#synth phase <degrees>
$white The phase is the starting position within 
$white the oscillator's cycle. For example a phase 
$white of 180 would start halfway through the
$white oscillator's cycle.
section;amsine, amsquare, amtriangle, amsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
section;fmsine, fmsquare, fmtriangle, fmsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
#synth modindex <degrees>
$white The modulation index which is in essence
$white the depth or amount of the modulation.
$white In other terms it is the ratio of the 
$white frequency of the modulating signal (mf) 
$white to the amplitude of the modulating signal 
$white (ma) -- as in ma/mf
section;fatsine, fatsquare, fattriangle, fatsawtooth
#synth phase <degrees>
#synth count <number>
$white This sets the number of oscillators to 
$white spread along the given range.
#synth spread <cents>
$white This signals the number of cents between
$white oscillators.`,J5e=Object.freeze(Object.defineProperty({__proto__:null,default:X5e},Symbol.toStringTag,{value:"Module"})),Z5e=`section;pulse
#synth width <range>
$white A number that is between [-1, 1] altering
$white this value changes the shape of the square
$white wave`,Q5e=Object.freeze(Object.defineProperty({__proto__:null,default:Z5e},Symbol.toStringTag,{value:"Module"})),e6e=`section;pwm
#synth modfreq <frequency>
$white This sets the frequency of change for the 
$white pulse width of this oscillator.`,t6e=Object.freeze(Object.defineProperty({__proto__:null,default:e6e},Symbol.toStringTag,{value:"Module"})),n6e=`section;#reverb on
#reverb <number>
$white 0-100, 0 is off, 100 is full volume
#reverb predelay <seconds>
$white The amount of time before the reverb
$white is fully ramped in.
#reverb decay <seconds>
$white The duration of the reverb.
`,r6e=Object.freeze(Object.defineProperty({__proto__:null,default:n6e},Symbol.toStringTag,{value:"Module"})),i6e=`switching voices
#synth <sine, square, triangle, sawtooth> 
#synth <pwm, pulse, bells, doot>
#synth <retro, buzz, clang, metallic>
#synth <retro, buzz, clang, metallic>
#synth <algo0, algo1, ... ,algo7> 
voice settings
#synth restart - resets voice to default
#synth vol <db> - control volume
#synth port <seconds>
#synth env <attack> <delay> <sustain> <release>
voice specific 
!oscscroll hk o O next;sine, square, triangle, sawtooth
!pwmscroll hk m M next;pwm
!pulsescroll hk p P next;pulse
!algoscroll hk a A next;algo0 -> algo7
`,s6e=Object.freeze(Object.defineProperty({__proto__:null,default:i6e},Symbol.toStringTag,{value:"Module"})),o6e=`section;#vibrato on
#vibrato <number>
$white 0-100, 0 is off, 100 is full volume
#vibrato maxdelay <seconds>
$white longer delay increases the vibrato`,a6e=Object.freeze(Object.defineProperty({__proto__:null,default:o6e},Symbol.toStringTag,{value:"Module"})),c6e=`update this to explain

#tts
#ttsqueue
#ttsengine
`,l6e=Object.freeze(Object.defineProperty({__proto__:null,default:c6e},Symbol.toStringTag,{value:"Module"}));var e1=(t=>(t[t.Border=-1]="Border",t[t.Data=0]="Data",t[t.Function=1]="Function",t[t.Position=2]="Position",t[t.Timing=3]="Timing",t[t.Alignment=4]="Alignment",t))(e1||{}),u6e=Object.defineProperty,h6e=(t,e,n)=>e in t?u6e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,NR=(t,e,n)=>(h6e(t,typeof e!="symbol"?e+"":e,n),n);const f6e=[0,1],Ate=[1,0],Cte=[2,3],Rte=[3,2],d6e={L:f6e,M:Ate,Q:Cte,H:Rte},p6e=/^[0-9]*$/,m6e=/^[A-Z0-9 $%*+.\/:-]*$/,u2="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",N8=1,P8=40,$H=3,g6e=3,PR=40,_6e=10,kte=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],Mte=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class v6e{constructor(e,n,r,i){if(this.version=e,this.ecc=n,NR(this,"size"),NR(this,"mask"),NR(this,"modules",[]),NR(this,"types",[]),e<N8||e>P8)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,n){return e>=0&&e<this.size&&n>=0&&n<this.size&&this.modules[n][e]}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2===0,e1.Timing),this.setFunctionModule(r,6,r%2===0,e1.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),n=e.length;for(let r=0;r<n;r++)for(let i=0;i<n;i++)r===0&&i===0||r===0&&i===n-1||r===n-1&&i===0||this.drawAlignmentPattern(e[r],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const n=this.ecc[1]<<3|e;let r=n;for(let s=0;s<10;s++)r=r<<1^(r>>>9)*1335;const i=(n<<10|r)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,og(i,s));this.setFunctionModule(8,7,og(i,6)),this.setFunctionModule(8,8,og(i,7)),this.setFunctionModule(7,8,og(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,og(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,og(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,og(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let r=0;r<12;r++)e=e<<1^(e>>>11)*7973;const n=this.version<<12|e;for(let r=0;r<18;r++){const i=og(n,r),s=this.size-11+r%3,o=Math.floor(r/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,n){for(let r=-4;r<=4;r++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(r)),o=e+i,a=n+r;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,e1.Position)}}drawAlignmentPattern(e,n){for(let r=-2;r<=2;r++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,n+r,Math.max(Math.abs(i),Math.abs(r))!==1,e1.Alignment)}setFunctionModule(e,n,r,i=e1.Function){this.modules[n][e]=r,this.types[n][e]=i}addEccAndInterleave(e){const n=this.version,r=this.ecc;if(e.length!==Ck(n,r))throw new RangeError("Invalid argument");const i=Mte[r[0]][n],s=kte[r[0]][n],o=Math.floor(s4(n)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=C6e(s);for(let f=0,d=0;f<i;f++){const p=e.slice(d,d+c-s+(f<a?0:1));d+=p.length;const m=R6e(p,u);f<a&&p.push(0),l.push(p.concat(m))}const h=[];for(let f=0;f<l[0].length;f++)l.forEach((d,p)=>{(f!==c-s||p>=a)&&h.push(d[f])});return h}drawCodewords(e){if(e.length!==Math.floor(s4(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let r=this.size-1;r>=1;r-=2){r===6&&(r=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=r-s,c=(r+1&2)===0?this.size-1-i:i;!this.types[c][o]&&n<e.length*8&&(this.modules[c][o]=og(e[n>>>3],7-(n&7)),n++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let n=0;n<this.size;n++)for(let r=0;r<this.size;r++){let i;switch(e){case 0:i=(r+n)%2===0;break;case 1:i=n%2===0;break;case 2:i=r%3===0;break;case 3:i=(r+n)%3===0;break;case 4:i=(Math.floor(r/3)+Math.floor(n/2))%2===0;break;case 5:i=r*n%2+r*n%3===0;break;case 6:i=(r*n%2+r*n%3)%2===0;break;case 7:i=((r+n)%2+r*n%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[n][r]&&i&&(this.modules[n][r]=!this.modules[n][r])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=$H:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*PR),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*PR}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=$H:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*PR),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*PR}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=g6e)}let n=0;for(const s of this.modules)n=s.reduce((o,a)=>o+(a?1:0),n);const r=this.size*this.size,i=Math.ceil(Math.abs(n*20-r*10)/r)-1;return e+=i*_6e,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,n=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,r=[6];for(let i=this.size-7;r.length<e;i-=n)r.splice(1,0,i);return r}}finderPenaltyCountPatterns(e){const n=e[1],r=n>0&&e[2]===n&&e[3]===n*3&&e[4]===n&&e[5]===n;return(r&&e[0]>=n*4&&e[6]>=n?1:0)+(r&&e[6]>=n*4&&e[0]>=n?1:0)}finderPenaltyTerminateAndCount(e,n,r){return e&&(this.finderPenaltyAddHistory(n,r),n=0),n+=this.size,this.finderPenaltyAddHistory(n,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(e,n){n[0]===0&&(e+=this.size),n.pop(),n.unshift(e)}}function gg(t,e,n){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let r=e-1;r>=0;r--)n.push(t>>>r&1)}function og(t,e){return(t>>>e&1)!==0}class D8{constructor(e,n,r){if(this.mode=e,this.numChars=n,this.bitData=r,n<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}getData(){return this.bitData.slice()}}const y6e=[1,10,12,14],b6e=[2,9,11,13],S6e=[4,8,16,16];function Ote(t,e){return t[Math.floor((e+7)/17)+1]}function Ite(t){const e=[];for(const n of t)gg(n,8,e);return new D8(S6e,t.length,e)}function E6e(t){if(!Nte(t))throw new RangeError("String contains non-numeric characters");const e=[];for(let n=0;n<t.length;){const r=Math.min(t.length-n,3);gg(Number.parseInt(t.substring(n,n+r),10),r*3+1,e),n+=r}return new D8(y6e,t.length,e)}function x6e(t){if(!Pte(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let n;for(n=0;n+2<=t.length;n+=2){let r=u2.indexOf(t.charAt(n))*45;r+=u2.indexOf(t.charAt(n+1)),gg(r,11,e)}return n<t.length&&gg(u2.indexOf(t.charAt(n)),6,e),new D8(b6e,t.length,e)}function w6e(t){return t===""?[]:Nte(t)?[E6e(t)]:Pte(t)?[x6e(t)]:[Ite(A6e(t))]}function Nte(t){return p6e.test(t)}function Pte(t){return m6e.test(t)}function T6e(t,e){let n=0;for(const r of t){const i=Ote(r.mode,e);if(r.numChars>=1<<i)return Number.POSITIVE_INFINITY;n+=4+i+r.bitData.length}return n}function A6e(t){t=encodeURI(t);const e=[];for(let n=0;n<t.length;n++)t.charAt(n)!=="%"?e.push(t.charCodeAt(n)):(e.push(Number.parseInt(t.substring(n+1,n+3),16)),n+=2);return e}function s4(t){if(t<N8||t>P8)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const n=Math.floor(t/7)+2;e-=(25*n-10)*n-55,t>=7&&(e-=36)}return e}function Ck(t,e){return Math.floor(s4(t)/8)-kte[e[0]][t]*Mte[e[0]][t]}function C6e(t){if(t<1||t>255)throw new RangeError("Degree out of range");const e=[];for(let r=0;r<t-1;r++)e.push(0);e.push(1);let n=1;for(let r=0;r<t;r++){for(let i=0;i<e.length;i++)e[i]=o4(e[i],n),i+1<e.length&&(e[i]^=e[i+1]);n=o4(n,2)}return e}function R6e(t,e){const n=e.map(r=>0);for(const r of t){const i=r^n.shift();n.push(0),e.forEach((s,o)=>n[o]^=o4(s,i))}return n}function o4(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let n=0;for(let r=7;r>=0;r--)n=n<<1^(n>>>7)*285,n^=(e>>>r&1)*t;return n}function k6e(t,e,n=1,r=40,i=-1,s=!0){if(!(N8<=n&&n<=r&&r<=P8)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=n;;o++){const h=Ck(o,e)*8,f=T6e(t,o);if(f<=h){a=f;break}if(o>=r)throw new RangeError("Data too long")}for(const h of[Ate,Cte,Rte])s&&a<=Ck(o,h)*8&&(e=h);const c=[];for(const h of t){gg(h.mode[0],4,c),gg(h.numChars,Ote(h.mode,o),c);for(const f of h.getData())c.push(f)}const l=Ck(o,e)*8;gg(0,Math.min(4,l-c.length),c),gg(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)gg(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,f)=>u[f>>>3]|=h<<7-(f&7)),new v6e(o,e,u,i)}function M6e(t,e){const{ecc:n="L",boostEcc:r=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof t=="string"?w6e(t):Array.isArray(t)?[Ite(t)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof t}`);const l=k6e(c,d6e[n],i,s,o,r),u=O6e({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e?.invert&&(u.data=u.data.map(h=>h.map(f=>!f))),e?.onEncoded?.(u),u}function O6e(t,e=1){if(!e)return t;const{size:n}=t,r=n+e*2;t.size=r,t.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)t.data.unshift(Array.from({length:r},o=>!1)),t.data.push(Array.from({length:r},o=>!1));const i=e1.Border;t.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)t.types.unshift(Array.from({length:r},o=>i)),t.types.push(Array.from({length:r},o=>i));return t}function I6e(t,e,n,r=!1){return e<0||n<0||e>=t.length||n>=t.length?r:t[n][e]}function N6e(t,e={}){const n={WHITE_ALL:"",WHITE_BLACK:"",BLACK_WHITE:"",BLACK_ALL:" "},r=M6e(t,e),i=!1,s=!0,o=(l,u)=>I6e(r.data,l,u,!0),a=[];let c="";for(let l=0;l<r.size;l+=2){for(let u=0;u<r.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=n.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=n.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=n.BLACK_WHITE:c+=n.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}function P6e(t){const e=[],n=N6e(t).split(`
`),r={32:32,9600:223,9604:220,9608:219};for(let i=0;i<n.length;i++){const s=[...n[i]].map(o=>`$${r[o.charCodeAt(0)]}`).join("");e.push(s)}return e}const j1="$dkpurple",D6e="$196",L6e="$205";function zr(t,e,n){us(t,e,n)}function Dte(t,e,n){const r=D6e.repeat(n);zr(t,e,`${j1}${r}`)}function L8(t,e,n){const r=L6e.repeat(n);zr(t,e,`${j1}${r}`)}function Sv(t,e,n){Dte(t,e,n.length+2),zr(t,e,`${j1} $white${n} `),L8(t,e,n.length+2)}function Xy(t,e,n){zr(t,e,`${j1} ${" ".repeat(n.length)} `),zr(t,e,`${j1} $gray${n} `),L8(t,e,n.length+2)}function ih(t,e,n,r){zr(t,e,`${j1} $white${n} $blue${r}`)}function to(t,e,n){zr(t,e,`${j1}$blue${n}`)}function a4(t,e,n,r){zr(t,e,`!${n};${r}`)}function U6e(t,e,n){const r=P6e(n);for(let i=0;i<r.length;i++)zr(t,e,r[i])}function c4(t,e,n,r,i=!0){i&&(U6e(t,e,n),setTimeout(()=>q5(t,e),200)),zr(t,e,`!copyit ${n};${r}`)}function B6e(t,e,n,r){zr(t,e,`!openit ${n};${r}`)}const Rk={},HS={};function F6e(){return{id:Go(),board:"",layers:[],scroll:[],sidebar:[],exiteast:"",exitwest:"",exitnorth:"",exitsouth:""}}const j6e=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit","bgedit"]),z6e=new Set(["tx","text"]),V6e={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},GH={};let H6e=t=>{let e=GH[t];return fe(e)||(GH[t]=e=F6e()),e};function h2(t){return H6e(t)}function U8(t){return fe(Rk[t])||(Rk[t]=[]),Rk[t]}function $6e(t,e,n){Object.values(HS).forEach(r=>{if(r[e]!==void 0){const i=Cv(t.id(),e);nn(n)&&cu(i,n),dn(n)&&c3e(i,n)}})}function G6e(t){const e=U8(t);return Rk[t]=[],e}function WH(t){const e=[];let n;for(let r=0;r<t.length;++r){const i=t[r],s=dn(i)&&fe(G8(i));fe(n)&&n!==s&&e.push(" "),e.push(i),n=s}return e}function W6e(t,e){U8(t).push(e)}function q6e(t,e,n,r,i=()=>0,s=c5){switch(rr(no(r[0]))){case"copyit":case"openit":case"viewit":case"runit":r.unshift("istargetless");break}const a=[e,n,...r],c=rr(`${a[3]}`),l={...he};function u(h,f){fe(f)&&f!==i(h)&&(he.board=l.board,he.element=l.element,he.elementfocus=l.elementfocus,s(h,f))}if(j6e.has(c)){const h=`${a[2]}`;HS[e]=HS[e]??{};const f=i(h)??V6e[c];if(HS[e][h]===void 0){const d=Cv(e,h);z6e.has(c)?(dn(f)&&wte(d,f),HS[e][h]=u3e(d,p=>{u(h,p)})):(nn(f)&&a3e(d,f),HS[e][h]=l3e(d,p=>{u(h,p)}))}}U8(t).push(a)}const qH=Object.assign({"./editor/codepagename.txt":_3e,"./editor/command/admin.txt":y3e,"./editor/command/agent.txt":S3e,"./editor/command/array.txt":x3e,"./editor/command/autofilter.txt":T3e,"./editor/command/autofilter1.txt":C3e,"./editor/command/autofilter2.txt":k3e,"./editor/command/autofilter3.txt":O3e,"./editor/command/autowah.txt":N3e,"./editor/command/autowah1.txt":D3e,"./editor/command/autowah2.txt":U3e,"./editor/command/autowah3.txt":F3e,"./editor/command/bbs.txt":z3e,"./editor/command/become.txt":H3e,"./editor/command/bgplay.txt":G3e,"./editor/command/bgplayon16n.txt":q3e,"./editor/command/bgplayon1n.txt":K3e,"./editor/command/bgplayon2n.txt":J3e,"./editor/command/bgplayon32n.txt":Q3e,"./editor/command/bgplayon4n.txt":tNe,"./editor/command/bgplayon64n.txt":rNe,"./editor/command/bgplayon8n.txt":sNe,"./editor/command/bgvol.txt":aNe,"./editor/command/bind.txt":lNe,"./editor/command/board.txt":hNe,"./editor/command/boardopen.txt":dNe,"./editor/command/boards.txt":mNe,"./editor/command/bookallexport.txt":_Ne,"./editor/command/bookexport.txt":yNe,"./editor/command/bookrename.txt":SNe,"./editor/command/books.txt":xNe,"./editor/command/booktrash.txt":TNe,"./editor/command/bpm.txt":CNe,"./editor/command/break.txt":kNe,"./editor/command/broadcast.txt":ONe,"./editor/command/build.txt":NNe,"./editor/command/change.txt":DNe,"./editor/command/char.txt":UNe,"./editor/command/charset.txt":FNe,"./editor/command/chat.txt":zNe,"./editor/command/clear.txt":HNe,"./editor/command/color.txt":GNe,"./editor/command/continue.txt":qNe,"./editor/command/copy.txt":KNe,"./editor/command/cycle.txt":JNe,"./editor/command/dev.txt":QNe,"./editor/command/die.txt":tPe,"./editor/command/distort.txt":rPe,"./editor/command/distort1.txt":sPe,"./editor/command/distort2.txt":aPe,"./editor/command/distort3.txt":lPe,"./editor/command/do.txt":hPe,"./editor/command/done.txt":dPe,"./editor/command/dupe.txt":mPe,"./editor/command/dupewith.txt":_Pe,"./editor/command/duplicate.txt":yPe,"./editor/command/duplicatewith.txt":SPe,"./editor/command/echo.txt":xPe,"./editor/command/echo1.txt":TPe,"./editor/command/echo2.txt":CPe,"./editor/command/echo3.txt":kPe,"./editor/command/else.txt":OPe,"./editor/command/elseif.txt":NPe,"./editor/command/end.txt":DPe,"./editor/command/endgame.txt":UPe,"./editor/command/endwith.txt":FPe,"./editor/command/export.txt":zPe,"./editor/command/fcrush.txt":HPe,"./editor/command/fcrush1.txt":GPe,"./editor/command/fcrush2.txt":qPe,"./editor/command/fcrush3.txt":KPe,"./editor/command/fetch.txt":JPe,"./editor/command/fetchwith.txt":QPe,"./editor/command/findany.txt":t2e,"./editor/command/foreach.txt":r2e,"./editor/command/fork.txt":s2e,"./editor/command/gadget.txt":a2e,"./editor/command/go.txt":l2e,"./editor/command/goto.txt":h2e,"./editor/command/help.txt":d2e,"./editor/command/hyperlink.txt":m2e,"./editor/command/idle.txt":_2e,"./editor/command/if.txt":y2e,"./editor/command/itchiopublish.txt":S2e,"./editor/command/joincode.txt":x2e,"./editor/command/jointab.txt":T2e,"./editor/command/load.txt":C2e,"./editor/command/lock.txt":k2e,"./editor/command/nuke.txt":O2e,"./editor/command/oneof.txt":N2e,"./editor/command/oneofwith.txt":D2e,"./editor/command/pageexport.txt":U2e,"./editor/command/pageopen.txt":F2e,"./editor/command/pages.txt":z2e,"./editor/command/pagetrash.txt":H2e,"./editor/command/palette.txt":G2e,"./editor/command/pivot.txt":q2e,"./editor/command/play.txt":K2e,"./editor/command/push.txt":J2e,"./editor/command/put.txt":Q2e,"./editor/command/putwith.txt":tDe,"./editor/command/read.txt":rDe,"./editor/command/readbin.txt":sDe,"./editor/command/readjson.txt":aDe,"./editor/command/readline.txt":lDe,"./editor/command/readrexpaint.txt":hDe,"./editor/command/remix.txt":dDe,"./editor/command/repeat.txt":mDe,"./editor/command/restart.txt":_De,"./editor/command/restore.txt":yDe,"./editor/command/reverb.txt":SDe,"./editor/command/reverb1.txt":xDe,"./editor/command/reverb2.txt":TDe,"./editor/command/reverb3.txt":CDe,"./editor/command/revert.txt":kDe,"./editor/command/run.txt":ODe,"./editor/command/runwith.txt":NDe,"./editor/command/save.txt":DDe,"./editor/command/screenshot.txt":UDe,"./editor/command/send.txt":FDe,"./editor/command/set.txt":zDe,"./editor/command/share.txt":HDe,"./editor/command/shoot.txt":GDe,"./editor/command/shootwith.txt":qDe,"./editor/command/shortsend.txt":KDe,"./editor/command/shove.txt":JDe,"./editor/command/snapshot.txt":QDe,"./editor/command/stat.txt":tLe,"./editor/command/synth.txt":rLe,"./editor/command/synth1.txt":sLe,"./editor/command/synth2.txt":aLe,"./editor/command/synth3.txt":lLe,"./editor/command/synth4.txt":hLe,"./editor/command/synth5.txt":dLe,"./editor/command/synthflush.txt":mLe,"./editor/command/synthrecord.txt":_Le,"./editor/command/text.txt":yLe,"./editor/command/throwstar.txt":SLe,"./editor/command/throwstarwith.txt":xLe,"./editor/command/ticker.txt":TLe,"./editor/command/toast.txt":CLe,"./editor/command/transport.txt":kLe,"./editor/command/trash.txt":OLe,"./editor/command/tts.txt":NLe,"./editor/command/ttsengine.txt":DLe,"./editor/command/ttsqueue.txt":ULe,"./editor/command/ttsvol.txt":FLe,"./editor/command/twitchbroadcast.txt":zLe,"./editor/command/twitchchat.txt":HLe,"./editor/command/unlock.txt":GLe,"./editor/command/userinput.txt":qLe,"./editor/command/vibrato.txt":KLe,"./editor/command/vibrato1.txt":JLe,"./editor/command/vibrato2.txt":QLe,"./editor/command/vibrato3.txt":t4e,"./editor/command/vol.txt":r4e,"./editor/command/waitfor.txt":s4e,"./editor/command/walk.txt":a4e,"./editor/command/weave.txt":l4e,"./editor/command/while.txt":h4e,"./editor/command/withboard.txt":d4e,"./editor/command/withobject.txt":m4e,"./editor/command/write.txt":_4e,"./editor/command/zap.txt":y4e,"./editor/command/zztrandom.txt":S4e,"./editor/command/zztsearch.txt":x4e,"./editor/comment.txt":T4e,"./editor/hyperlink.txt":C4e,"./editor/hyperlink/hotkey.txt":k4e,"./editor/hyperlink/number.txt":O4e,"./editor/hyperlink/range.txt":N4e,"./editor/hyperlink/select.txt":D4e,"./editor/hyperlink/text.txt":U4e,"./editor/label.txt":F4e,"./editor/shortgo.txt":z4e,"./editor/shorttry.txt":H4e,"./editor/stat/board.txt":G4e,"./editor/stat/charset.txt":q4e,"./editor/stat/const.txt":K4e,"./editor/stat/hotkey.txt":J4e,"./editor/stat/loader.txt":Q4e,"./editor/stat/number.txt":t5e,"./editor/stat/object.txt":r5e,"./editor/stat/palette.txt":s5e,"./editor/stat/range.txt":a5e,"./editor/stat/select.txt":l5e,"./editor/stat/terrain.txt":h5e,"./editor/stat/text.txt":d5e,"./editor/text.txt":m5e,"./help/nopages.txt":_5e,"./refscroll/algoscroll.txt":y5e,"./refscroll/autofilterscroll.txt":S5e,"./refscroll/autowahscroll.txt":x5e,"./refscroll/cliscroll.txt":T5e,"./refscroll/commandsscroll.txt":C5e,"./refscroll/distortscroll.txt":k5e,"./refscroll/echoscroll.txt":O5e,"./refscroll/effectsscroll.txt":N5e,"./refscroll/fcrushscroll.txt":D5e,"./refscroll/helpcontrols.txt":U5e,"./refscroll/helpdeveloper.txt":F5e,"./refscroll/helpmenu.txt":z5e,"./refscroll/helpplayer.txt":H5e,"./refscroll/helptext.txt":G5e,"./refscroll/menu.txt":q5e,"./refscroll/notesscroll.txt":K5e,"./refscroll/oscscroll.txt":J5e,"./refscroll/pulsescroll.txt":Q5e,"./refscroll/pwmscroll.txt":t6e,"./refscroll/reverbscroll.txt":r6e,"./refscroll/synthscroll.txt":s6e,"./refscroll/vibratoscroll.txt":a6e,"./refscroll/voicescroll.txt":l6e}),Lte={};Dm(qH).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");Lte[e]=qH[t].default});function Ute(t){const e=rr(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Lte[e];if(fe(n))return n;const{target:r,path:i}=_v(e);switch(r){case"editor":{const s=_v(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function Bte(t,e){const n=(t??"").split(`
`);for(let r=0;r<n.length;++r)e(n[r].split(";"))}function Y6e(t,e){const[n,...r]=e,i=r[0]??"",s=r[1]??"";switch(rr(n.trim())){case"header":Sv(qe,t,i);break;case"section":Xy(qe,t,i);break;case"option":ih(qe,t,i,s);break;default:n.trimStart().startsWith("!")?a4(qe,t,n.trimStart().slice(1),i):zr(qe,t,n);break}}function K6e(t){const e={};return Bte(t,n=>{const[r,...i]=n,s=i[0]??"";e[r]=s}),e}function DR(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var f2={exports:{}},YH;function X6e(){return YH||(YH=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof DR=="function"&&DR;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var f=new Error("Cannot find module '"+l+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[l]={exports:{}};r[l][0].call(d.exports,function(p){var m=r[l][1][p];return o(m||p)},d,d.exports,n,r,i,s)}return i[l].exports}for(var a=typeof DR=="function"&&DR,c=0;c<s.length;c++)o(s[c]);return o})({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,f,d,p,m,g=[],_=0,y=c.length,v=y,E=s.getTypeOf(c)!=="string";_<c.length;)v=y-_,h=E?(l=c[_++],u=_<y?c[_++]:0,_<y?c[_++]:0):(l=c.charCodeAt(_++),u=_<y?c.charCodeAt(_++):0,_<y?c.charCodeAt(_++):0),f=l>>2,d=(3&l)<<4|u>>4,p=1<v?(15&u)<<2|h>>6:64,m=2<v?63&h:64,g.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(m));return g.join("")},i.decode=function(c){var l,u,h,f,d,p,m=0,g=0,_="data:";if(c.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var y,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(y=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(f=a.indexOf(c.charAt(m++)))>>4,u=(15&f)<<4|(d=a.indexOf(c.charAt(m++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(m++))),y[g++]=l,d!==64&&(y[g++]=u),p!==64&&(y[g++]=h);return y}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,h,f,d,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,f){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=(function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c})();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(l,u,h,f){var d=o,p=f+h;l^=-1;for(var m=f;m<p;m++)l=l>>>8^d[255&(l^u[m])];return-1^l})(0|c,a,a.length,0):(function(l,u,h,f){var d=o,p=f+h;l^=-1;for(var m=f;m<p;m++)l=l>>>8^d[255&(l^u.charCodeAt(m))];return-1^l})(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var m,g="";for(m=0;m<p;m++)g+=String.fromCharCode(255&d),d>>>=8;return g}function o(d,p,m,g,_,y){var v,E,x=d.file,A=d.compression,T=y!==l.utf8encode,k=a.transformTo("string",y(x.name)),L=a.transformTo("string",l.utf8encode(x.name)),I=x.comment,F=a.transformTo("string",y(I)),M=a.transformTo("string",l.utf8encode(I)),D=L.length!==x.name.length,O=M.length!==I.length,z="",q="",G="",K=x.dir,te=x.date,re={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(re.crc32=d.crc32,re.compressedSize=d.compressedSize,re.uncompressedSize=d.uncompressedSize);var H=0;p&&(H|=8),T||!D&&!O||(H|=2048);var Y=0,Z=0;K&&(Y|=16),_==="UNIX"?(Z=798,Y|=(function(ie,ge){var Te=ie;return ie||(Te=ge?16893:33204),(65535&Te)<<16})(x.unixPermissions,K)):(Z=20,Y|=(function(ie){return 63&(ie||0)})(x.dosPermissions)),v=te.getUTCHours(),v<<=6,v|=te.getUTCMinutes(),v<<=5,v|=te.getUTCSeconds()/2,E=te.getUTCFullYear()-1980,E<<=4,E|=te.getUTCMonth()+1,E<<=5,E|=te.getUTCDate(),D&&(q=s(1,1)+s(u(k),4)+L,z+="up"+s(q.length,2)+q),O&&(G=s(1,1)+s(u(F),4)+M,z+="uc"+s(G.length,2)+G);var Q="";return Q+=`
\0`,Q+=s(H,2),Q+=A.magic,Q+=s(v,2),Q+=s(E,2),Q+=s(re.crc32,4),Q+=s(re.compressedSize,4),Q+=s(re.uncompressedSize,4),Q+=s(k.length,2),Q+=s(z.length,2),{fileRecord:h.LOCAL_FILE_HEADER+Q+k+z,dirRecord:h.CENTRAL_FILE_HEADER+s(Z,2)+Q+s(F.length,2)+"\0\0\0\0"+s(Y,4)+s(g,4)+k+z+F}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),h=n("../signature");function f(d,p,m,g){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-g-1))/m:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var m=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,m=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:(function(g){return h.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-d,g=(function(_,y,v,E,x){var A=a.transformTo("string",x(E));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(_,2)+s(_,2)+s(y,4)+s(v,4)+s(A.length,2)+A})(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(m){p.processChunk(m)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(m){p.error(m)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var m=0;m<p.length;m++)try{p[m].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=(function(y,v){var E=y||v,x=s[E];if(!x)throw new Error(E+" is not a valid compression method !");return x})(d.options.compression,c.compression),m=d.options.compressionOptions||c.compressionOptions||{},g=d.dir,_=d.date;d._compressWorker(p,m).withStreamInfo("file",{name:f,dir:g,date:_,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var m=f.decompressed.getContentWorker().pipe(new l);m.on("error",function(g){p(g)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(m){var g=new c(d);return g.load(m),g}).then(function(m){var g=[o.Promise.resolve(m)],_=m.files;if(d.checkCRC32)for(var y=0;y<_.length;y++)g.push(h(_[y]));return o.Promise.all(g)}).then(function(m){for(var g=m.shift(),_=g.files,y=0;y<_.length;y++){var v=_[y],E=v.fileNameStr,x=s.resolve(v.fileNameStr);p.file(x,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:d.createFolders}),v.dir||(p.file(x).unsafeOriginalName=E)}return g.zipComment.length&&(p.comment=g.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,f){u.push(h)||u._helper.pause(),l&&l(f)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof js<"u",newBufferFrom:function(s,o){if(js.from&&js.from!==Uint8Array.from)return js.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new js(s,o)},allocBuffer:function(s){if(js.alloc)return js.alloc(s);var o=new js(s);return o.fill(0),o},isBuffer:function(s){return js.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(x,A,T){var k,L=a.getTypeOf(A),I=a.extend(T||{},u);I.date=I.date||new Date,I.compression!==null&&(I.compression=I.compression.toUpperCase()),typeof I.unixPermissions=="string"&&(I.unixPermissions=parseInt(I.unixPermissions,8)),I.unixPermissions&&16384&I.unixPermissions&&(I.dir=!0),I.dosPermissions&&16&I.dosPermissions&&(I.dir=!0),I.dir&&(x=_(x)),I.createFolders&&(k=g(x))&&y.call(this,k,!0);var F=L==="string"&&I.binary===!1&&I.base64===!1;T&&T.binary!==void 0||(I.binary=!F),(A instanceof h&&A.uncompressedSize===0||I.dir||!A||A.length===0)&&(I.base64=!1,I.binary=!0,A="",I.compression="STORE",L="string");var M=null;M=A instanceof h||A instanceof c?A:p.isNode&&p.isStream(A)?new m(x,A):a.prepareContent(x,A,I.binary,I.optimizedBinaryString,I.base64);var D=new f(x,M,I);this.files[x]=D}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),g=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var A=x.lastIndexOf("/");return 0<A?x.substring(0,A):""},_=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},y=function(x,A){return A=A!==void 0?A:u.createFolders,x=_(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:A}),this.files[x]};function v(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var A,T,k;for(A in this.files)k=this.files[A],(T=A.slice(this.root.length,A.length))&&A.slice(0,this.root.length)===this.root&&x(T,k)},filter:function(x){var A=[];return this.forEach(function(T,k){x(T,k)&&A.push(k)}),A},file:function(x,A,T){if(arguments.length!==1)return x=this.root+x,s.call(this,x,A,T),this;if(v(x)){var k=x;return this.filter(function(I,F){return!F.dir&&k.test(I)})}var L=this.files[this.root+x];return L&&!L.dir?L:null},folder:function(x){if(!x)return this;if(v(x))return this.filter(function(L,I){return I.dir&&x.test(L)});var A=this.root+x,T=y.call(this,A),k=this.clone();return k.root=T.name,k},remove:function(x){x=this.root+x;var A=this.files[x];if(A||(x.slice(-1)!=="/"&&(x+="/"),A=this.files[x]),A&&!A.dir)delete this.files[x];else for(var T=this.filter(function(L,I){return I.name.slice(0,x.length)===x}),k=0;k<T.length;k++)delete this.files[T[k].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var A,T={};try{if((T=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");a.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var k=T.comment||this.comment||"";A=d.generateWorker(this,T,k)}catch(L){(A=new c("error")).error(L)}return new l(A,T.type||"string",T.mimeType)},generateAsync:function(x,A){return this.generateInternalStream(x).accumulate(A)},generateNodeStream:function(x,A){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(A)}};r.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===l&&this.data[f+2]===u&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&l===f[1]&&u===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),h=null;if(l.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,m){return new u.Promise(function(g,_){var y=[],v=p._internalType,E=p._outputType,x=p._mimeType;p.on("data",function(A,T){y.push(A),m&&m(T)}).on("error",function(A){y=[],_(A)}).on("end",function(){try{var A=(function(T,k,L){switch(T){case"blob":return s.newBlob(s.transformTo("arraybuffer",k),L);case"base64":return c.encode(k);default:return s.transformTo(T,k)}})(E,(function(T,k){var L,I=0,F=null,M=0;for(L=0;L<k.length;L++)M+=k[L].length;switch(T){case"string":return k.join("");case"array":return Array.prototype.concat.apply([],k);case"uint8array":for(F=new Uint8Array(M),L=0;L<k.length;L++)F.set(k[L],I),I+=k[L].length;return F;case"nodebuffer":return js.concat(k);default:throw new Error("concat : unsupported type '"+T+"'")}})(v,y),x);g(A)}catch(T){_(T)}y=[]}).resume()})}function d(p,m,g){var _=m;switch(m){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=m,this._mimeType=g,s.checkSupport(_),this._worker=p.pipe(new o(_)),p.lock()}catch(y){this._worker=new a("error"),this._worker.error(y)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,m){var g=this;return p==="data"?this._worker.on(p,function(_){m.call(g,_.data,_.meta)}):this._worker.on(p,function(){s.delay(m,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof js<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):(function(p){var m,g,_,y,v,E=p.length,x=0;for(y=0;y<E;y++)(64512&(g=p.charCodeAt(y)))==55296&&y+1<E&&(64512&(_=p.charCodeAt(y+1)))==56320&&(g=65536+(g-55296<<10)+(_-56320),y++),x+=g<128?1:g<2048?2:g<65536?3:4;for(m=o.uint8array?new Uint8Array(x):new Array(x),y=v=0;v<x;y++)(64512&(g=p.charCodeAt(y)))==55296&&y+1<E&&(64512&(_=p.charCodeAt(y+1)))==56320&&(g=65536+(g-55296<<10)+(_-56320),y++),g<128?m[v++]=g:(g<2048?m[v++]=192|g>>>6:(g<65536?m[v++]=224|g>>>12:(m[v++]=240|g>>>18,m[v++]=128|g>>>12&63),m[v++]=128|g>>>6&63),m[v++]=128|63&g);return m})(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):(function(p){var m,g,_,y,v=p.length,E=new Array(2*v);for(m=g=0;m<v;)if((_=p[m++])<128)E[g++]=_;else if(4<(y=l[_]))E[g++]=65533,m+=y-1;else{for(_&=y===2?31:y===3?15:7;1<y&&m<v;)_=_<<6|63&p[m++],y--;1<y?E[g++]=65533:_<65536?E[g++]=_:(_-=65536,E[g++]=55296|_>>10&1023,E[g++]=56320|1023&_)}return E.length!==g&&(E.subarray?E=E.subarray(0,g):E.length=g),s.applyFromCharCode(E)})(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var g=(function(y,v){var E;for((v=v||y.length)>y.length&&(v=y.length),E=v-1;0<=E&&(192&y[E])==128;)E--;return E<0||E===0?v:E+l[y[E]]>v?E:v})(p),_=p;g!==p.length&&(o.uint8array?(_=p.subarray(0,g),this.leftOver=p.subarray(g,p.length)):(_=p.slice(0,g),this.leftOver=p.slice(g,p.length))),this.push({data:i.utf8decode(_),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,g){for(var _=0;_<m.length;++_)g[_]=255&m.charCodeAt(_);return g}n("setimmediate"),i.newBlob=function(m,g){i.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(m),_.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,g,_){var y=[],v=0,E=m.length;if(E<=_)return String.fromCharCode.apply(null,m);for(;v<E;)g==="array"||g==="nodebuffer"?y.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+_,E)))):y.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+_,E)))),v+=_;return y.join("")},stringifyByChar:function(m){for(var g="",_=0;_<m.length;_++)g+=String.fromCharCode(m[_]);return g},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function f(m){var g=65536,_=i.getTypeOf(m),y=!0;if(_==="uint8array"?y=h.applyCanBeUsed.uint8array:_==="nodebuffer"&&(y=h.applyCanBeUsed.nodebuffer),y)for(;1<g;)try{return h.stringifyByChunk(m,_,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(m)}function d(m,g){for(var _=0;_<m.length;_++)g[_]=m[_];return g}i.applyFromCharCode=f;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:f,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,g){if(g=g||"",!m)return g;i.checkSupport(m);var _=i.getTypeOf(g);return p[_][m](g)},i.resolve=function(m){for(var g=m.split("/"),_=[],y=0;y<g.length;y++){var v=g[y];v==="."||v===""&&y!==0&&y!==g.length-1||(v===".."?_.pop():_.push(v))}return _.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var g,_,y="";for(_=0;_<(m||"").length;_++)y+="\\x"+((g=m.charCodeAt(_))<16?"0":"")+g.toString(16).toUpperCase();return y},i.delay=function(m,g,_){setImmediate(function(){m.apply(_||null,g||[])})},i.inherits=function(m,g){function _(){}_.prototype=g.prototype,m.prototype=new _},i.extend=function(){var m,g,_={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&_[g]===void 0&&(_[g]=arguments[m][g]);return _},i.prepareContent=function(m,g,_,y,v){return c.Promise.resolve(g).then(function(E){return s.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new c.Promise(function(x,A){var T=new FileReader;T.onload=function(k){x(k.target.result)},T.onerror=function(k){A(k.target.error)},T.readAsArrayBuffer(E)}):E}).then(function(E){var x=i.getTypeOf(E);return x?(x==="arraybuffer"?E=i.transformTo("uint8array",E):x==="string"&&(v?E=o.decode(E):_&&y!==!0&&(E=(function(A){return u(A,s.uint8array?new Uint8Array(A.length):new Array(A.length))})(E))),E):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=l.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=(function(g){for(var _ in u)if(Object.prototype.hasOwnProperty.call(u,_)&&u[_].magic===g)return u[_];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,m,g,_=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<_;)p=d.readInt(2),m=d.readInt(2),g=d.readData(m),this.extraFields[p]={id:p,length:m,value:g};d.setIndex(_)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var _=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,g){this.name=p,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,g="string";try{if(!p)throw new Error("No output type specified.");var _=(g=p.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var y=!this._dataBinary;y&&!_&&(m=m.pipe(new c.Utf8EncodeWorker)),!y&&_&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(v){(m=new u("error")).error(v)}return new o(m,g,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(g,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var m,g;a=!0;for(var _=d.length;_;){for(g=d,d=[],m=-1;++m<_;)g[m]();_=d.length}a=!1}r.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof qf<"u"?qf:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,_!==o&&m(this,_)}function f(_,y,v){this.promise=_,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function d(_,y,v){s(function(){var E;try{E=y(v)}catch(x){return a.reject(_,x)}E===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,E)})}function p(_){var y=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof y=="function")return function(){y.apply(_,arguments)}}function m(_,y){var v=!1;function E(T){v||(v=!0,a.reject(_,T))}function x(T){v||(v=!0,a.resolve(_,T))}var A=g(function(){y(x,E)});A.status==="error"&&E(A.value)}function g(_,y){var v={};try{v.value=_(y),v.status="success"}catch(E){v.status="error",v.value=E}return v}(r.exports=h).prototype.finally=function(_){if(typeof _!="function")return this;var y=this.constructor;return this.then(function(v){return y.resolve(_()).then(function(){return v})},function(v){return y.resolve(_()).then(function(){throw v})})},h.prototype.catch=function(_){return this.then(null,_)},h.prototype.then=function(_,y){if(typeof _!="function"&&this.state===l||typeof y!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==u?d(v,this.state===l?_:y,this.outcome):this.queue.push(new f(v,_,y)),v},f.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},f.prototype.otherCallFulfilled=function(_){d(this.promise,this.onFulfilled,_)},f.prototype.callRejected=function(_){a.reject(this.promise,_)},f.prototype.otherCallRejected=function(_){d(this.promise,this.onRejected,_)},a.resolve=function(_,y){var v=g(p,y);if(v.status==="error")return a.reject(_,v.value);var E=v.value;if(E)m(_,E);else{_.state=l,_.outcome=y;for(var x=-1,A=_.queue.length;++x<A;)_.queue[x].callFulfilled(y)}return _},a.reject=function(_,y){_.state=c,_.outcome=y;for(var v=-1,E=_.queue.length;++v<E;)_.queue[v].callRejected(y);return _},h.resolve=function(_){return _ instanceof this?_:a.resolve(new this(o),_)},h.reject=function(_){var y=new this(o);return a.reject(y,_)},h.all=function(_){var y=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=_.length,E=!1;if(!v)return this.resolve([]);for(var x=new Array(v),A=0,T=-1,k=new this(o);++T<v;)L(_[T],T);return k;function L(I,F){y.resolve(I).then(function(M){x[F]=M,++A!==v||E||(E=!0,a.resolve(k,x))},function(M){E||(E=!0,a.reject(k,M))})}},h.race=function(_){var y=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=_.length,E=!1;if(!v)return this.resolve([]);for(var x=-1,A=new this(o);++x<v;)T=_[x],y.resolve(T).then(function(k){E||(E=!0,a.resolve(A,k))},function(k){E||(E=!0,a.reject(A,k))});var T;return A}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,h=0,f=-1,d=0,p=8;function m(_){if(!(this instanceof m))return new m(_);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},_||{});var y=this.options;y.raw&&0<y.windowBits?y.windowBits=-y.windowBits:y.gzip&&0<y.windowBits&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(v!==h)throw new Error(c[v]);if(y.header&&s.deflateSetHeader(this.strm,y.header),y.dictionary){var E;if(E=typeof y.dictionary=="string"?a.string2buf(y.dictionary):u.call(y.dictionary)==="[object ArrayBuffer]"?new Uint8Array(y.dictionary):y.dictionary,(v=s.deflateSetDictionary(this.strm,E))!==h)throw new Error(c[v]);this._dict_set=!0}}function g(_,y){var v=new m(y);if(v.push(_,!0),v.err)throw v.msg||c[v.err];return v.result}m.prototype.push=function(_,y){var v,E,x=this.strm,A=this.options.chunkSize;if(this.ended)return!1;E=y===~~y?y:y===!0?4:0,typeof _=="string"?x.input=a.string2buf(_):u.call(_)==="[object ArrayBuffer]"?x.input=new Uint8Array(_):x.input=_,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(A),x.next_out=0,x.avail_out=A),(v=s.deflate(x,E))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&v!==1);return E===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):E!==2||(this.onEnd(h),!(x.avail_out=0))},m.prototype.onData=function(_){this.chunks.push(_)},m.prototype.onEnd=function(_){_===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Deflate=m,i.deflate=g,i.deflateRaw=function(_,y){return(y=y||{}).raw=!0,g(_,y)},i.gzip=function(_,y){return(y=y||{}).gzip=!0,g(_,y)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&(15&g.windowBits)==0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var _=s.inflateInit2(this.strm,g.windowBits);if(_!==c.Z_OK)throw new Error(l[_]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,g){var _=new d(g);if(_.push(m,!0),_.err)throw _.msg||l[_.err];return _.result}d.prototype.push=function(m,g){var _,y,v,E,x,A,T=this.strm,k=this.options.chunkSize,L=this.options.dictionary,I=!1;if(this.ended)return!1;y=g===~~g?g:g===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?T.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?T.input=new Uint8Array(m):T.input=m,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new o.Buf8(k),T.next_out=0,T.avail_out=k),(_=s.inflate(T,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&L&&(A=typeof L=="string"?a.string2buf(L):f.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,_=s.inflateSetDictionary(this.strm,A)),_===c.Z_BUF_ERROR&&I===!0&&(_=c.Z_OK,I=!1),_!==c.Z_STREAM_END&&_!==c.Z_OK)return this.onEnd(_),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&_!==c.Z_STREAM_END&&(T.avail_in!==0||y!==c.Z_FINISH&&y!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(T.output,T.next_out),E=T.next_out-v,x=a.buf2string(T.output,v),T.next_out=E,T.avail_out=k-E,E&&o.arraySet(T.output,T.output,v,E,0),this.onData(x)):this.onData(o.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(I=!0)}while((0<T.avail_in||T.avail_out===0)&&_!==c.Z_STREAM_END);return _===c.Z_STREAM_END&&(y=c.Z_FINISH),y===c.Z_FINISH?(_=s.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===c.Z_OK):y!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(T.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(m,g){return(g=g||{}).raw=!0,p(m,g)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,f){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),f);else for(var d=0;d<h;d++)c[f+d]=l[u+d]},flattenChunks:function(c){var l,u,h,f,d,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=f=0,u=c.length;l<u;l++)d=c[l],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,l,u,h,f){for(var d=0;d<h;d++)c[f+d]=l[u+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,m,g,_=h.length,y=0;for(m=0;m<_;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),y+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(y),m=g=0;g<y;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),d<128?f[g++]=d:(d<2048?f[g++]=192|d>>>6:(d<65536?f[g++]=224|d>>>12:(f[g++]=240|d>>>18,f[g++]=128|d>>>12&63),f[g++]=128|d>>>6&63),f[g++]=128|63&d);return f},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,m,g,_=f||h.length,y=new Array(2*_);for(d=p=0;d<_;)if((m=h[d++])<128)y[p++]=m;else if(4<(g=c[m]))y[p++]=65533,d+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&d<_;)m=m<<6|63&h[d++],g--;1<g?y[p++]=65533:m<65536?y[p++]=m:(m-=65536,y[p++]=55296|m>>10&1023,y[p++]=56320|1023&m)}return u(y,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=(function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a})();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var f=l;f<h;f++)o=o>>>8^u[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),h=0,f=4,d=0,p=-2,m=-1,g=4,_=2,y=8,v=9,E=286,x=30,A=19,T=2*E+1,k=15,L=3,I=258,F=I+L+1,M=42,D=113,O=1,z=2,q=3,G=4;function K(ne,Le){return ne.msg=u[Le],Le}function te(ne){return(ne<<1)-(4<ne?9:0)}function re(ne){for(var Le=ne.length;0<=--Le;)ne[Le]=0}function H(ne){var Le=ne.state,Ve=Le.pending;Ve>ne.avail_out&&(Ve=ne.avail_out),Ve!==0&&(o.arraySet(ne.output,Le.pending_buf,Le.pending_out,Ve,ne.next_out),ne.next_out+=Ve,Le.pending_out+=Ve,ne.total_out+=Ve,ne.avail_out-=Ve,Le.pending-=Ve,Le.pending===0&&(Le.pending_out=0))}function Y(ne,Le){a._tr_flush_block(ne,0<=ne.block_start?ne.block_start:-1,ne.strstart-ne.block_start,Le),ne.block_start=ne.strstart,H(ne.strm)}function Z(ne,Le){ne.pending_buf[ne.pending++]=Le}function Q(ne,Le){ne.pending_buf[ne.pending++]=Le>>>8&255,ne.pending_buf[ne.pending++]=255&Le}function ie(ne,Le){var Ve,De,Ie=ne.max_chain_length,ae=ne.strstart,ve=ne.prev_length,we=ne.nice_match,pe=ne.strstart>ne.w_size-F?ne.strstart-(ne.w_size-F):0,ze=ne.window,Je=ne.w_mask,Xe=ne.prev,tt=ne.strstart+I,Nt=ze[ae+ve-1],gt=ze[ae+ve];ne.prev_length>=ne.good_match&&(Ie>>=2),we>ne.lookahead&&(we=ne.lookahead);do if(ze[(Ve=Le)+ve]===gt&&ze[Ve+ve-1]===Nt&&ze[Ve]===ze[ae]&&ze[++Ve]===ze[ae+1]){ae+=2,Ve++;do;while(ze[++ae]===ze[++Ve]&&ze[++ae]===ze[++Ve]&&ze[++ae]===ze[++Ve]&&ze[++ae]===ze[++Ve]&&ze[++ae]===ze[++Ve]&&ze[++ae]===ze[++Ve]&&ze[++ae]===ze[++Ve]&&ze[++ae]===ze[++Ve]&&ae<tt);if(De=I-(tt-ae),ae=tt-I,ve<De){if(ne.match_start=Le,we<=(ve=De))break;Nt=ze[ae+ve-1],gt=ze[ae+ve]}}while((Le=Xe[Le&Je])>pe&&--Ie!=0);return ve<=ne.lookahead?ve:ne.lookahead}function ge(ne){var Le,Ve,De,Ie,ae,ve,we,pe,ze,Je,Xe=ne.w_size;do{if(Ie=ne.window_size-ne.lookahead-ne.strstart,ne.strstart>=Xe+(Xe-F)){for(o.arraySet(ne.window,ne.window,Xe,Xe,0),ne.match_start-=Xe,ne.strstart-=Xe,ne.block_start-=Xe,Le=Ve=ne.hash_size;De=ne.head[--Le],ne.head[Le]=Xe<=De?De-Xe:0,--Ve;);for(Le=Ve=Xe;De=ne.prev[--Le],ne.prev[Le]=Xe<=De?De-Xe:0,--Ve;);Ie+=Xe}if(ne.strm.avail_in===0)break;if(ve=ne.strm,we=ne.window,pe=ne.strstart+ne.lookahead,ze=Ie,Je=void 0,Je=ve.avail_in,ze<Je&&(Je=ze),Ve=Je===0?0:(ve.avail_in-=Je,o.arraySet(we,ve.input,ve.next_in,Je,pe),ve.state.wrap===1?ve.adler=c(ve.adler,we,Je,pe):ve.state.wrap===2&&(ve.adler=l(ve.adler,we,Je,pe)),ve.next_in+=Je,ve.total_in+=Je,Je),ne.lookahead+=Ve,ne.lookahead+ne.insert>=L)for(ae=ne.strstart-ne.insert,ne.ins_h=ne.window[ae],ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ae+1])&ne.hash_mask;ne.insert&&(ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ae+L-1])&ne.hash_mask,ne.prev[ae&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ae,ae++,ne.insert--,!(ne.lookahead+ne.insert<L)););}while(ne.lookahead<F&&ne.strm.avail_in!==0)}function Te(ne,Le){for(var Ve,De;;){if(ne.lookahead<F){if(ge(ne),ne.lookahead<F&&Le===h)return O;if(ne.lookahead===0)break}if(Ve=0,ne.lookahead>=L&&(ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+L-1])&ne.hash_mask,Ve=ne.prev[ne.strstart&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ne.strstart),Ve!==0&&ne.strstart-Ve<=ne.w_size-F&&(ne.match_length=ie(ne,Ve)),ne.match_length>=L)if(De=a._tr_tally(ne,ne.strstart-ne.match_start,ne.match_length-L),ne.lookahead-=ne.match_length,ne.match_length<=ne.max_lazy_match&&ne.lookahead>=L){for(ne.match_length--;ne.strstart++,ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+L-1])&ne.hash_mask,Ve=ne.prev[ne.strstart&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ne.strstart,--ne.match_length!=0;);ne.strstart++}else ne.strstart+=ne.match_length,ne.match_length=0,ne.ins_h=ne.window[ne.strstart],ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+1])&ne.hash_mask;else De=a._tr_tally(ne,0,ne.window[ne.strstart]),ne.lookahead--,ne.strstart++;if(De&&(Y(ne,!1),ne.strm.avail_out===0))return O}return ne.insert=ne.strstart<L-1?ne.strstart:L-1,Le===f?(Y(ne,!0),ne.strm.avail_out===0?q:G):ne.last_lit&&(Y(ne,!1),ne.strm.avail_out===0)?O:z}function be(ne,Le){for(var Ve,De,Ie;;){if(ne.lookahead<F){if(ge(ne),ne.lookahead<F&&Le===h)return O;if(ne.lookahead===0)break}if(Ve=0,ne.lookahead>=L&&(ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+L-1])&ne.hash_mask,Ve=ne.prev[ne.strstart&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ne.strstart),ne.prev_length=ne.match_length,ne.prev_match=ne.match_start,ne.match_length=L-1,Ve!==0&&ne.prev_length<ne.max_lazy_match&&ne.strstart-Ve<=ne.w_size-F&&(ne.match_length=ie(ne,Ve),ne.match_length<=5&&(ne.strategy===1||ne.match_length===L&&4096<ne.strstart-ne.match_start)&&(ne.match_length=L-1)),ne.prev_length>=L&&ne.match_length<=ne.prev_length){for(Ie=ne.strstart+ne.lookahead-L,De=a._tr_tally(ne,ne.strstart-1-ne.prev_match,ne.prev_length-L),ne.lookahead-=ne.prev_length-1,ne.prev_length-=2;++ne.strstart<=Ie&&(ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+L-1])&ne.hash_mask,Ve=ne.prev[ne.strstart&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ne.strstart),--ne.prev_length!=0;);if(ne.match_available=0,ne.match_length=L-1,ne.strstart++,De&&(Y(ne,!1),ne.strm.avail_out===0))return O}else if(ne.match_available){if((De=a._tr_tally(ne,0,ne.window[ne.strstart-1]))&&Y(ne,!1),ne.strstart++,ne.lookahead--,ne.strm.avail_out===0)return O}else ne.match_available=1,ne.strstart++,ne.lookahead--}return ne.match_available&&(De=a._tr_tally(ne,0,ne.window[ne.strstart-1]),ne.match_available=0),ne.insert=ne.strstart<L-1?ne.strstart:L-1,Le===f?(Y(ne,!0),ne.strm.avail_out===0?q:G):ne.last_lit&&(Y(ne,!1),ne.strm.avail_out===0)?O:z}function Pe(ne,Le,Ve,De,Ie){this.good_length=ne,this.max_lazy=Le,this.nice_length=Ve,this.max_chain=De,this.func=Ie}function Ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*T),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*A+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(k+1),this.heap=new o.Buf16(2*E+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*E+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ze(ne){var Le;return ne&&ne.state?(ne.total_in=ne.total_out=0,ne.data_type=_,(Le=ne.state).pending=0,Le.pending_out=0,Le.wrap<0&&(Le.wrap=-Le.wrap),Le.status=Le.wrap?M:D,ne.adler=Le.wrap===2?0:1,Le.last_flush=h,a._tr_init(Le),d):K(ne,p)}function lt(ne){var Le=Ze(ne);return Le===d&&(function(Ve){Ve.window_size=2*Ve.w_size,re(Ve.head),Ve.max_lazy_match=s[Ve.level].max_lazy,Ve.good_match=s[Ve.level].good_length,Ve.nice_match=s[Ve.level].nice_length,Ve.max_chain_length=s[Ve.level].max_chain,Ve.strstart=0,Ve.block_start=0,Ve.lookahead=0,Ve.insert=0,Ve.match_length=Ve.prev_length=L-1,Ve.match_available=0,Ve.ins_h=0})(ne.state),Le}function pt(ne,Le,Ve,De,Ie,ae){if(!ne)return p;var ve=1;if(Le===m&&(Le=6),De<0?(ve=0,De=-De):15<De&&(ve=2,De-=16),Ie<1||v<Ie||Ve!==y||De<8||15<De||Le<0||9<Le||ae<0||g<ae)return K(ne,p);De===8&&(De=9);var we=new Ge;return(ne.state=we).strm=ne,we.wrap=ve,we.gzhead=null,we.w_bits=De,we.w_size=1<<we.w_bits,we.w_mask=we.w_size-1,we.hash_bits=Ie+7,we.hash_size=1<<we.hash_bits,we.hash_mask=we.hash_size-1,we.hash_shift=~~((we.hash_bits+L-1)/L),we.window=new o.Buf8(2*we.w_size),we.head=new o.Buf16(we.hash_size),we.prev=new o.Buf16(we.w_size),we.lit_bufsize=1<<Ie+6,we.pending_buf_size=4*we.lit_bufsize,we.pending_buf=new o.Buf8(we.pending_buf_size),we.d_buf=1*we.lit_bufsize,we.l_buf=3*we.lit_bufsize,we.level=Le,we.strategy=ae,we.method=Ve,lt(ne)}s=[new Pe(0,0,0,0,function(ne,Le){var Ve=65535;for(Ve>ne.pending_buf_size-5&&(Ve=ne.pending_buf_size-5);;){if(ne.lookahead<=1){if(ge(ne),ne.lookahead===0&&Le===h)return O;if(ne.lookahead===0)break}ne.strstart+=ne.lookahead,ne.lookahead=0;var De=ne.block_start+Ve;if((ne.strstart===0||ne.strstart>=De)&&(ne.lookahead=ne.strstart-De,ne.strstart=De,Y(ne,!1),ne.strm.avail_out===0)||ne.strstart-ne.block_start>=ne.w_size-F&&(Y(ne,!1),ne.strm.avail_out===0))return O}return ne.insert=0,Le===f?(Y(ne,!0),ne.strm.avail_out===0?q:G):(ne.strstart>ne.block_start&&(Y(ne,!1),ne.strm.avail_out),O)}),new Pe(4,4,8,4,Te),new Pe(4,5,16,8,Te),new Pe(4,6,32,32,Te),new Pe(4,4,16,16,be),new Pe(8,16,32,32,be),new Pe(8,16,128,128,be),new Pe(8,32,128,256,be),new Pe(32,128,258,1024,be),new Pe(32,258,258,4096,be)],i.deflateInit=function(ne,Le){return pt(ne,Le,y,15,8,0)},i.deflateInit2=pt,i.deflateReset=lt,i.deflateResetKeep=Ze,i.deflateSetHeader=function(ne,Le){return ne&&ne.state?ne.state.wrap!==2?p:(ne.state.gzhead=Le,d):p},i.deflate=function(ne,Le){var Ve,De,Ie,ae;if(!ne||!ne.state||5<Le||Le<0)return ne?K(ne,p):p;if(De=ne.state,!ne.output||!ne.input&&ne.avail_in!==0||De.status===666&&Le!==f)return K(ne,ne.avail_out===0?-5:p);if(De.strm=ne,Ve=De.last_flush,De.last_flush=Le,De.status===M)if(De.wrap===2)ne.adler=0,Z(De,31),Z(De,139),Z(De,8),De.gzhead?(Z(De,(De.gzhead.text?1:0)+(De.gzhead.hcrc?2:0)+(De.gzhead.extra?4:0)+(De.gzhead.name?8:0)+(De.gzhead.comment?16:0)),Z(De,255&De.gzhead.time),Z(De,De.gzhead.time>>8&255),Z(De,De.gzhead.time>>16&255),Z(De,De.gzhead.time>>24&255),Z(De,De.level===9?2:2<=De.strategy||De.level<2?4:0),Z(De,255&De.gzhead.os),De.gzhead.extra&&De.gzhead.extra.length&&(Z(De,255&De.gzhead.extra.length),Z(De,De.gzhead.extra.length>>8&255)),De.gzhead.hcrc&&(ne.adler=l(ne.adler,De.pending_buf,De.pending,0)),De.gzindex=0,De.status=69):(Z(De,0),Z(De,0),Z(De,0),Z(De,0),Z(De,0),Z(De,De.level===9?2:2<=De.strategy||De.level<2?4:0),Z(De,3),De.status=D);else{var ve=y+(De.w_bits-8<<4)<<8;ve|=(2<=De.strategy||De.level<2?0:De.level<6?1:De.level===6?2:3)<<6,De.strstart!==0&&(ve|=32),ve+=31-ve%31,De.status=D,Q(De,ve),De.strstart!==0&&(Q(De,ne.adler>>>16),Q(De,65535&ne.adler)),ne.adler=1}if(De.status===69)if(De.gzhead.extra){for(Ie=De.pending;De.gzindex<(65535&De.gzhead.extra.length)&&(De.pending!==De.pending_buf_size||(De.gzhead.hcrc&&De.pending>Ie&&(ne.adler=l(ne.adler,De.pending_buf,De.pending-Ie,Ie)),H(ne),Ie=De.pending,De.pending!==De.pending_buf_size));)Z(De,255&De.gzhead.extra[De.gzindex]),De.gzindex++;De.gzhead.hcrc&&De.pending>Ie&&(ne.adler=l(ne.adler,De.pending_buf,De.pending-Ie,Ie)),De.gzindex===De.gzhead.extra.length&&(De.gzindex=0,De.status=73)}else De.status=73;if(De.status===73)if(De.gzhead.name){Ie=De.pending;do{if(De.pending===De.pending_buf_size&&(De.gzhead.hcrc&&De.pending>Ie&&(ne.adler=l(ne.adler,De.pending_buf,De.pending-Ie,Ie)),H(ne),Ie=De.pending,De.pending===De.pending_buf_size)){ae=1;break}ae=De.gzindex<De.gzhead.name.length?255&De.gzhead.name.charCodeAt(De.gzindex++):0,Z(De,ae)}while(ae!==0);De.gzhead.hcrc&&De.pending>Ie&&(ne.adler=l(ne.adler,De.pending_buf,De.pending-Ie,Ie)),ae===0&&(De.gzindex=0,De.status=91)}else De.status=91;if(De.status===91)if(De.gzhead.comment){Ie=De.pending;do{if(De.pending===De.pending_buf_size&&(De.gzhead.hcrc&&De.pending>Ie&&(ne.adler=l(ne.adler,De.pending_buf,De.pending-Ie,Ie)),H(ne),Ie=De.pending,De.pending===De.pending_buf_size)){ae=1;break}ae=De.gzindex<De.gzhead.comment.length?255&De.gzhead.comment.charCodeAt(De.gzindex++):0,Z(De,ae)}while(ae!==0);De.gzhead.hcrc&&De.pending>Ie&&(ne.adler=l(ne.adler,De.pending_buf,De.pending-Ie,Ie)),ae===0&&(De.status=103)}else De.status=103;if(De.status===103&&(De.gzhead.hcrc?(De.pending+2>De.pending_buf_size&&H(ne),De.pending+2<=De.pending_buf_size&&(Z(De,255&ne.adler),Z(De,ne.adler>>8&255),ne.adler=0,De.status=D)):De.status=D),De.pending!==0){if(H(ne),ne.avail_out===0)return De.last_flush=-1,d}else if(ne.avail_in===0&&te(Le)<=te(Ve)&&Le!==f)return K(ne,-5);if(De.status===666&&ne.avail_in!==0)return K(ne,-5);if(ne.avail_in!==0||De.lookahead!==0||Le!==h&&De.status!==666){var we=De.strategy===2?(function(pe,ze){for(var Je;;){if(pe.lookahead===0&&(ge(pe),pe.lookahead===0)){if(ze===h)return O;break}if(pe.match_length=0,Je=a._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++,Je&&(Y(pe,!1),pe.strm.avail_out===0))return O}return pe.insert=0,ze===f?(Y(pe,!0),pe.strm.avail_out===0?q:G):pe.last_lit&&(Y(pe,!1),pe.strm.avail_out===0)?O:z})(De,Le):De.strategy===3?(function(pe,ze){for(var Je,Xe,tt,Nt,gt=pe.window;;){if(pe.lookahead<=I){if(ge(pe),pe.lookahead<=I&&ze===h)return O;if(pe.lookahead===0)break}if(pe.match_length=0,pe.lookahead>=L&&0<pe.strstart&&(Xe=gt[tt=pe.strstart-1])===gt[++tt]&&Xe===gt[++tt]&&Xe===gt[++tt]){Nt=pe.strstart+I;do;while(Xe===gt[++tt]&&Xe===gt[++tt]&&Xe===gt[++tt]&&Xe===gt[++tt]&&Xe===gt[++tt]&&Xe===gt[++tt]&&Xe===gt[++tt]&&Xe===gt[++tt]&&tt<Nt);pe.match_length=I-(Nt-tt),pe.match_length>pe.lookahead&&(pe.match_length=pe.lookahead)}if(pe.match_length>=L?(Je=a._tr_tally(pe,1,pe.match_length-L),pe.lookahead-=pe.match_length,pe.strstart+=pe.match_length,pe.match_length=0):(Je=a._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++),Je&&(Y(pe,!1),pe.strm.avail_out===0))return O}return pe.insert=0,ze===f?(Y(pe,!0),pe.strm.avail_out===0?q:G):pe.last_lit&&(Y(pe,!1),pe.strm.avail_out===0)?O:z})(De,Le):s[De.level].func(De,Le);if(we!==q&&we!==G||(De.status=666),we===O||we===q)return ne.avail_out===0&&(De.last_flush=-1),d;if(we===z&&(Le===1?a._tr_align(De):Le!==5&&(a._tr_stored_block(De,0,0,!1),Le===3&&(re(De.head),De.lookahead===0&&(De.strstart=0,De.block_start=0,De.insert=0))),H(ne),ne.avail_out===0))return De.last_flush=-1,d}return Le!==f?d:De.wrap<=0?1:(De.wrap===2?(Z(De,255&ne.adler),Z(De,ne.adler>>8&255),Z(De,ne.adler>>16&255),Z(De,ne.adler>>24&255),Z(De,255&ne.total_in),Z(De,ne.total_in>>8&255),Z(De,ne.total_in>>16&255),Z(De,ne.total_in>>24&255)):(Q(De,ne.adler>>>16),Q(De,65535&ne.adler)),H(ne),0<De.wrap&&(De.wrap=-De.wrap),De.pending!==0?d:1)},i.deflateEnd=function(ne){var Le;return ne&&ne.state?(Le=ne.state.status)!==M&&Le!==69&&Le!==73&&Le!==91&&Le!==103&&Le!==D&&Le!==666?K(ne,p):(ne.state=null,Le===D?K(ne,-3):d):p},i.deflateSetDictionary=function(ne,Le){var Ve,De,Ie,ae,ve,we,pe,ze,Je=Le.length;if(!ne||!ne.state||(ae=(Ve=ne.state).wrap)===2||ae===1&&Ve.status!==M||Ve.lookahead)return p;for(ae===1&&(ne.adler=c(ne.adler,Le,Je,0)),Ve.wrap=0,Je>=Ve.w_size&&(ae===0&&(re(Ve.head),Ve.strstart=0,Ve.block_start=0,Ve.insert=0),ze=new o.Buf8(Ve.w_size),o.arraySet(ze,Le,Je-Ve.w_size,Ve.w_size,0),Le=ze,Je=Ve.w_size),ve=ne.avail_in,we=ne.next_in,pe=ne.input,ne.avail_in=Je,ne.next_in=0,ne.input=Le,ge(Ve);Ve.lookahead>=L;){for(De=Ve.strstart,Ie=Ve.lookahead-(L-1);Ve.ins_h=(Ve.ins_h<<Ve.hash_shift^Ve.window[De+L-1])&Ve.hash_mask,Ve.prev[De&Ve.w_mask]=Ve.head[Ve.ins_h],Ve.head[Ve.ins_h]=De,De++,--Ie;);Ve.strstart=De,Ve.lookahead=L-1,ge(Ve)}return Ve.strstart+=Ve.lookahead,Ve.block_start=Ve.strstart,Ve.insert=Ve.lookahead,Ve.lookahead=0,Ve.match_length=Ve.prev_length=L-1,Ve.match_available=0,ne.next_in=we,ne.input=pe,ne.avail_in=ve,Ve.wrap=ae,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,h,f,d,p,m,g,_,y,v,E,x,A,T,k,L,I,F,M,D,O,z;a=s.state,c=s.next_in,O=s.input,l=c+(s.avail_in-5),u=s.next_out,z=s.output,h=u-(o-s.avail_out),f=u+(s.avail_out-257),d=a.dmax,p=a.wsize,m=a.whave,g=a.wnext,_=a.window,y=a.hold,v=a.bits,E=a.lencode,x=a.distcode,A=(1<<a.lenbits)-1,T=(1<<a.distbits)-1;e:do{v<15&&(y+=O[c++]<<v,v+=8,y+=O[c++]<<v,v+=8),k=E[y&A];t:for(;;){if(y>>>=L=k>>>24,v-=L,(L=k>>>16&255)===0)z[u++]=65535&k;else{if(!(16&L)){if((64&L)==0){k=E[(65535&k)+(y&(1<<L)-1)];continue t}if(32&L){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}I=65535&k,(L&=15)&&(v<L&&(y+=O[c++]<<v,v+=8),I+=y&(1<<L)-1,y>>>=L,v-=L),v<15&&(y+=O[c++]<<v,v+=8,y+=O[c++]<<v,v+=8),k=x[y&T];n:for(;;){if(y>>>=L=k>>>24,v-=L,!(16&(L=k>>>16&255))){if((64&L)==0){k=x[(65535&k)+(y&(1<<L)-1)];continue n}s.msg="invalid distance code",a.mode=30;break e}if(F=65535&k,v<(L&=15)&&(y+=O[c++]<<v,(v+=8)<L&&(y+=O[c++]<<v,v+=8)),d<(F+=y&(1<<L)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(y>>>=L,v-=L,(L=u-h)<F){if(m<(L=F-L)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(D=_,(M=0)===g){if(M+=p-L,L<I){for(I-=L;z[u++]=_[M++],--L;);M=u-F,D=z}}else if(g<L){if(M+=p+g-L,(L-=g)<I){for(I-=L;z[u++]=_[M++],--L;);if(M=0,g<I){for(I-=L=g;z[u++]=_[M++],--L;);M=u-F,D=z}}}else if(M+=g-L,L<I){for(I-=L;z[u++]=_[M++],--L;);M=u-F,D=z}for(;2<I;)z[u++]=D[M++],z[u++]=D[M++],z[u++]=D[M++],I-=3;I&&(z[u++]=D[M++],1<I&&(z[u++]=D[M++]))}else{for(M=u-F;z[u++]=z[M++],z[u++]=z[M++],z[u++]=z[M++],2<(I-=3););I&&(z[u++]=z[M++],1<I&&(z[u++]=z[M++]))}break}}break}}while(c<l&&u<f);c-=I=v>>3,y&=(1<<(v-=I<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<f?f-u+257:257-(u-f),a.hold=y,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,h=2,f=0,d=-2,p=1,m=852,g=592;function _(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(M){var D;return M&&M.state?(D=M.state,M.total_in=M.total_out=D.total=0,M.msg="",D.wrap&&(M.adler=1&D.wrap),D.mode=p,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new s.Buf32(m),D.distcode=D.distdyn=new s.Buf32(g),D.sane=1,D.back=-1,f):d}function E(M){var D;return M&&M.state?((D=M.state).wsize=0,D.whave=0,D.wnext=0,v(M)):d}function x(M,D){var O,z;return M&&M.state?(z=M.state,D<0?(O=0,D=-D):(O=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?d:(z.window!==null&&z.wbits!==D&&(z.window=null),z.wrap=O,z.wbits=D,E(M))):d}function A(M,D){var O,z;return M?(z=new y,(M.state=z).window=null,(O=x(M,D))!==f&&(M.state=null),O):d}var T,k,L=!0;function I(M){if(L){var D;for(T=new s.Buf32(512),k=new s.Buf32(32),D=0;D<144;)M.lens[D++]=8;for(;D<256;)M.lens[D++]=9;for(;D<280;)M.lens[D++]=7;for(;D<288;)M.lens[D++]=8;for(l(u,M.lens,0,288,T,0,M.work,{bits:9}),D=0;D<32;)M.lens[D++]=5;l(h,M.lens,0,32,k,0,M.work,{bits:5}),L=!1}M.lencode=T,M.lenbits=9,M.distcode=k,M.distbits=5}function F(M,D,O,z){var q,G=M.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new s.Buf8(G.wsize)),z>=G.wsize?(s.arraySet(G.window,D,O-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(z<(q=G.wsize-G.wnext)&&(q=z),s.arraySet(G.window,D,O-z,q,G.wnext),(z-=q)?(s.arraySet(G.window,D,O-z,z,0),G.wnext=z,G.whave=G.wsize):(G.wnext+=q,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=q))),0}i.inflateReset=E,i.inflateReset2=x,i.inflateResetKeep=v,i.inflateInit=function(M){return A(M,15)},i.inflateInit2=A,i.inflate=function(M,D){var O,z,q,G,K,te,re,H,Y,Z,Q,ie,ge,Te,be,Pe,Ge,Ze,lt,pt,ne,Le,Ve,De,Ie=0,ae=new s.Buf8(4),ve=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return d;(O=M.state).mode===12&&(O.mode=13),K=M.next_out,q=M.output,re=M.avail_out,G=M.next_in,z=M.input,te=M.avail_in,H=O.hold,Y=O.bits,Z=te,Q=re,Le=f;e:for(;;)switch(O.mode){case p:if(O.wrap===0){O.mode=13;break}for(;Y<16;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if(2&O.wrap&&H===35615){ae[O.check=0]=255&H,ae[1]=H>>>8&255,O.check=a(O.check,ae,2,0),Y=H=0,O.mode=2;break}if(O.flags=0,O.head&&(O.head.done=!1),!(1&O.wrap)||(((255&H)<<8)+(H>>8))%31){M.msg="incorrect header check",O.mode=30;break}if((15&H)!=8){M.msg="unknown compression method",O.mode=30;break}if(Y-=4,ne=8+(15&(H>>>=4)),O.wbits===0)O.wbits=ne;else if(ne>O.wbits){M.msg="invalid window size",O.mode=30;break}O.dmax=1<<ne,M.adler=O.check=1,O.mode=512&H?10:12,Y=H=0;break;case 2:for(;Y<16;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if(O.flags=H,(255&O.flags)!=8){M.msg="unknown compression method",O.mode=30;break}if(57344&O.flags){M.msg="unknown header flags set",O.mode=30;break}O.head&&(O.head.text=H>>8&1),512&O.flags&&(ae[0]=255&H,ae[1]=H>>>8&255,O.check=a(O.check,ae,2,0)),Y=H=0,O.mode=3;case 3:for(;Y<32;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}O.head&&(O.head.time=H),512&O.flags&&(ae[0]=255&H,ae[1]=H>>>8&255,ae[2]=H>>>16&255,ae[3]=H>>>24&255,O.check=a(O.check,ae,4,0)),Y=H=0,O.mode=4;case 4:for(;Y<16;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}O.head&&(O.head.xflags=255&H,O.head.os=H>>8),512&O.flags&&(ae[0]=255&H,ae[1]=H>>>8&255,O.check=a(O.check,ae,2,0)),Y=H=0,O.mode=5;case 5:if(1024&O.flags){for(;Y<16;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}O.length=H,O.head&&(O.head.extra_len=H),512&O.flags&&(ae[0]=255&H,ae[1]=H>>>8&255,O.check=a(O.check,ae,2,0)),Y=H=0}else O.head&&(O.head.extra=null);O.mode=6;case 6:if(1024&O.flags&&(te<(ie=O.length)&&(ie=te),ie&&(O.head&&(ne=O.head.extra_len-O.length,O.head.extra||(O.head.extra=new Array(O.head.extra_len)),s.arraySet(O.head.extra,z,G,ie,ne)),512&O.flags&&(O.check=a(O.check,z,ie,G)),te-=ie,G+=ie,O.length-=ie),O.length))break e;O.length=0,O.mode=7;case 7:if(2048&O.flags){if(te===0)break e;for(ie=0;ne=z[G+ie++],O.head&&ne&&O.length<65536&&(O.head.name+=String.fromCharCode(ne)),ne&&ie<te;);if(512&O.flags&&(O.check=a(O.check,z,ie,G)),te-=ie,G+=ie,ne)break e}else O.head&&(O.head.name=null);O.length=0,O.mode=8;case 8:if(4096&O.flags){if(te===0)break e;for(ie=0;ne=z[G+ie++],O.head&&ne&&O.length<65536&&(O.head.comment+=String.fromCharCode(ne)),ne&&ie<te;);if(512&O.flags&&(O.check=a(O.check,z,ie,G)),te-=ie,G+=ie,ne)break e}else O.head&&(O.head.comment=null);O.mode=9;case 9:if(512&O.flags){for(;Y<16;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if(H!==(65535&O.check)){M.msg="header crc mismatch",O.mode=30;break}Y=H=0}O.head&&(O.head.hcrc=O.flags>>9&1,O.head.done=!0),M.adler=O.check=0,O.mode=12;break;case 10:for(;Y<32;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}M.adler=O.check=_(H),Y=H=0,O.mode=11;case 11:if(O.havedict===0)return M.next_out=K,M.avail_out=re,M.next_in=G,M.avail_in=te,O.hold=H,O.bits=Y,2;M.adler=O.check=1,O.mode=12;case 12:if(D===5||D===6)break e;case 13:if(O.last){H>>>=7&Y,Y-=7&Y,O.mode=27;break}for(;Y<3;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}switch(O.last=1&H,Y-=1,3&(H>>>=1)){case 0:O.mode=14;break;case 1:if(I(O),O.mode=20,D!==6)break;H>>>=2,Y-=2;break e;case 2:O.mode=17;break;case 3:M.msg="invalid block type",O.mode=30}H>>>=2,Y-=2;break;case 14:for(H>>>=7&Y,Y-=7&Y;Y<32;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if((65535&H)!=(H>>>16^65535)){M.msg="invalid stored block lengths",O.mode=30;break}if(O.length=65535&H,Y=H=0,O.mode=15,D===6)break e;case 15:O.mode=16;case 16:if(ie=O.length){if(te<ie&&(ie=te),re<ie&&(ie=re),ie===0)break e;s.arraySet(q,z,G,ie,K),te-=ie,G+=ie,re-=ie,K+=ie,O.length-=ie;break}O.mode=12;break;case 17:for(;Y<14;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if(O.nlen=257+(31&H),H>>>=5,Y-=5,O.ndist=1+(31&H),H>>>=5,Y-=5,O.ncode=4+(15&H),H>>>=4,Y-=4,286<O.nlen||30<O.ndist){M.msg="too many length or distance symbols",O.mode=30;break}O.have=0,O.mode=18;case 18:for(;O.have<O.ncode;){for(;Y<3;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}O.lens[ve[O.have++]]=7&H,H>>>=3,Y-=3}for(;O.have<19;)O.lens[ve[O.have++]]=0;if(O.lencode=O.lendyn,O.lenbits=7,Ve={bits:O.lenbits},Le=l(0,O.lens,0,19,O.lencode,0,O.work,Ve),O.lenbits=Ve.bits,Le){M.msg="invalid code lengths set",O.mode=30;break}O.have=0,O.mode=19;case 19:for(;O.have<O.nlen+O.ndist;){for(;Pe=(Ie=O.lencode[H&(1<<O.lenbits)-1])>>>16&255,Ge=65535&Ie,!((be=Ie>>>24)<=Y);){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if(Ge<16)H>>>=be,Y-=be,O.lens[O.have++]=Ge;else{if(Ge===16){for(De=be+2;Y<De;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if(H>>>=be,Y-=be,O.have===0){M.msg="invalid bit length repeat",O.mode=30;break}ne=O.lens[O.have-1],ie=3+(3&H),H>>>=2,Y-=2}else if(Ge===17){for(De=be+3;Y<De;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}Y-=be,ne=0,ie=3+(7&(H>>>=be)),H>>>=3,Y-=3}else{for(De=be+7;Y<De;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}Y-=be,ne=0,ie=11+(127&(H>>>=be)),H>>>=7,Y-=7}if(O.have+ie>O.nlen+O.ndist){M.msg="invalid bit length repeat",O.mode=30;break}for(;ie--;)O.lens[O.have++]=ne}}if(O.mode===30)break;if(O.lens[256]===0){M.msg="invalid code -- missing end-of-block",O.mode=30;break}if(O.lenbits=9,Ve={bits:O.lenbits},Le=l(u,O.lens,0,O.nlen,O.lencode,0,O.work,Ve),O.lenbits=Ve.bits,Le){M.msg="invalid literal/lengths set",O.mode=30;break}if(O.distbits=6,O.distcode=O.distdyn,Ve={bits:O.distbits},Le=l(h,O.lens,O.nlen,O.ndist,O.distcode,0,O.work,Ve),O.distbits=Ve.bits,Le){M.msg="invalid distances set",O.mode=30;break}if(O.mode=20,D===6)break e;case 20:O.mode=21;case 21:if(6<=te&&258<=re){M.next_out=K,M.avail_out=re,M.next_in=G,M.avail_in=te,O.hold=H,O.bits=Y,c(M,Q),K=M.next_out,q=M.output,re=M.avail_out,G=M.next_in,z=M.input,te=M.avail_in,H=O.hold,Y=O.bits,O.mode===12&&(O.back=-1);break}for(O.back=0;Pe=(Ie=O.lencode[H&(1<<O.lenbits)-1])>>>16&255,Ge=65535&Ie,!((be=Ie>>>24)<=Y);){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if(Pe&&(240&Pe)==0){for(Ze=be,lt=Pe,pt=Ge;Pe=(Ie=O.lencode[pt+((H&(1<<Ze+lt)-1)>>Ze)])>>>16&255,Ge=65535&Ie,!(Ze+(be=Ie>>>24)<=Y);){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}H>>>=Ze,Y-=Ze,O.back+=Ze}if(H>>>=be,Y-=be,O.back+=be,O.length=Ge,Pe===0){O.mode=26;break}if(32&Pe){O.back=-1,O.mode=12;break}if(64&Pe){M.msg="invalid literal/length code",O.mode=30;break}O.extra=15&Pe,O.mode=22;case 22:if(O.extra){for(De=O.extra;Y<De;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}O.length+=H&(1<<O.extra)-1,H>>>=O.extra,Y-=O.extra,O.back+=O.extra}O.was=O.length,O.mode=23;case 23:for(;Pe=(Ie=O.distcode[H&(1<<O.distbits)-1])>>>16&255,Ge=65535&Ie,!((be=Ie>>>24)<=Y);){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if((240&Pe)==0){for(Ze=be,lt=Pe,pt=Ge;Pe=(Ie=O.distcode[pt+((H&(1<<Ze+lt)-1)>>Ze)])>>>16&255,Ge=65535&Ie,!(Ze+(be=Ie>>>24)<=Y);){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}H>>>=Ze,Y-=Ze,O.back+=Ze}if(H>>>=be,Y-=be,O.back+=be,64&Pe){M.msg="invalid distance code",O.mode=30;break}O.offset=Ge,O.extra=15&Pe,O.mode=24;case 24:if(O.extra){for(De=O.extra;Y<De;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}O.offset+=H&(1<<O.extra)-1,H>>>=O.extra,Y-=O.extra,O.back+=O.extra}if(O.offset>O.dmax){M.msg="invalid distance too far back",O.mode=30;break}O.mode=25;case 25:if(re===0)break e;if(ie=Q-re,O.offset>ie){if((ie=O.offset-ie)>O.whave&&O.sane){M.msg="invalid distance too far back",O.mode=30;break}ge=ie>O.wnext?(ie-=O.wnext,O.wsize-ie):O.wnext-ie,ie>O.length&&(ie=O.length),Te=O.window}else Te=q,ge=K-O.offset,ie=O.length;for(re<ie&&(ie=re),re-=ie,O.length-=ie;q[K++]=Te[ge++],--ie;);O.length===0&&(O.mode=21);break;case 26:if(re===0)break e;q[K++]=O.length,re--,O.mode=21;break;case 27:if(O.wrap){for(;Y<32;){if(te===0)break e;te--,H|=z[G++]<<Y,Y+=8}if(Q-=re,M.total_out+=Q,O.total+=Q,Q&&(M.adler=O.check=O.flags?a(O.check,q,Q,K-Q):o(O.check,q,Q,K-Q)),Q=re,(O.flags?H:_(H))!==O.check){M.msg="incorrect data check",O.mode=30;break}Y=H=0}O.mode=28;case 28:if(O.wrap&&O.flags){for(;Y<32;){if(te===0)break e;te--,H+=z[G++]<<Y,Y+=8}if(H!==(4294967295&O.total)){M.msg="incorrect length check",O.mode=30;break}Y=H=0}O.mode=29;case 29:Le=1;break e;case 30:Le=-3;break e;case 31:return-4;default:return d}return M.next_out=K,M.avail_out=re,M.next_in=G,M.avail_in=te,O.hold=H,O.bits=Y,(O.wsize||Q!==M.avail_out&&O.mode<30&&(O.mode<27||D!==4))&&F(M,M.output,M.next_out,Q-M.avail_out)?(O.mode=31,-4):(Z-=M.avail_in,Q-=M.avail_out,M.total_in+=Z,M.total_out+=Q,O.total+=Q,O.wrap&&Q&&(M.adler=O.check=O.flags?a(O.check,q,Q,M.next_out-Q):o(O.check,q,Q,M.next_out-Q)),M.data_type=O.bits+(O.last?64:0)+(O.mode===12?128:0)+(O.mode===20||O.mode===15?256:0),(Z==0&&Q===0||D===4)&&Le===f&&(Le=-5),Le)},i.inflateEnd=function(M){if(!M||!M.state)return d;var D=M.state;return D.window&&(D.window=null),M.state=null,f},i.inflateGetHeader=function(M,D){var O;return M&&M.state?(2&(O=M.state).wrap)==0?d:((O.head=D).done=!1,f):d},i.inflateSetDictionary=function(M,D){var O,z=D.length;return M&&M.state?(O=M.state).wrap!==0&&O.mode!==11?d:O.mode===11&&o(1,D,z,0)!==O.check?-3:F(M,D,z,z)?(O.mode=31,-4):(O.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,f,d,p,m,g,_){var y,v,E,x,A,T,k,L,I,F=_.bits,M=0,D=0,O=0,z=0,q=0,G=0,K=0,te=0,re=0,H=0,Y=null,Z=0,Q=new s.Buf16(16),ie=new s.Buf16(16),ge=null,Te=0;for(M=0;M<=15;M++)Q[M]=0;for(D=0;D<d;D++)Q[h[f+D]]++;for(q=F,z=15;1<=z&&Q[z]===0;z--);if(z<q&&(q=z),z===0)return p[m++]=20971520,p[m++]=20971520,_.bits=1,0;for(O=1;O<z&&Q[O]===0;O++);for(q<O&&(q=O),M=te=1;M<=15;M++)if(te<<=1,(te-=Q[M])<0)return-1;if(0<te&&(u===0||z!==1))return-1;for(ie[1]=0,M=1;M<15;M++)ie[M+1]=ie[M]+Q[M];for(D=0;D<d;D++)h[f+D]!==0&&(g[ie[h[f+D]]++]=D);if(T=u===0?(Y=ge=g,19):u===1?(Y=o,Z-=257,ge=a,Te-=257,256):(Y=c,ge=l,-1),M=O,A=m,K=D=H=0,E=-1,x=(re=1<<(G=q))-1,u===1&&852<re||u===2&&592<re)return 1;for(;;){for(k=M-K,I=g[D]<T?(L=0,g[D]):g[D]>T?(L=ge[Te+g[D]],Y[Z+g[D]]):(L=96,0),y=1<<M-K,O=v=1<<G;p[A+(H>>K)+(v-=y)]=k<<24|L<<16|I|0,v!==0;);for(y=1<<M-1;H&y;)y>>=1;if(y!==0?(H&=y-1,H+=y):H=0,D++,--Q[M]==0){if(M===z)break;M=h[f+g[D]]}if(q<M&&(H&x)!==E){for(K===0&&(K=q),A+=O,te=1<<(G=M-K);G+K<z&&!((te-=Q[G+K])<=0);)G++,te<<=1;if(re+=1<<G,u===1&&852<re||u===2&&592<re)return 1;p[E=H&x]=q<<24|G<<16|A-m|0}}return H!==0&&(p[A+H]=M-K<<24|64<<16|0),_.bits=q,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(Ie){for(var ae=Ie.length;0<=--ae;)Ie[ae]=0}var l=0,u=29,h=256,f=h+1+u,d=30,p=19,m=2*f+1,g=15,_=16,y=7,v=256,E=16,x=17,A=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=new Array(2*(f+2));c(F);var M=new Array(2*d);c(M);var D=new Array(512);c(D);var O=new Array(256);c(O);var z=new Array(u);c(z);var q,G,K,te=new Array(d);function re(Ie,ae,ve,we,pe){this.static_tree=Ie,this.extra_bits=ae,this.extra_base=ve,this.elems=we,this.max_length=pe,this.has_stree=Ie&&Ie.length}function H(Ie,ae){this.dyn_tree=Ie,this.max_code=0,this.stat_desc=ae}function Y(Ie){return Ie<256?D[Ie]:D[256+(Ie>>>7)]}function Z(Ie,ae){Ie.pending_buf[Ie.pending++]=255&ae,Ie.pending_buf[Ie.pending++]=ae>>>8&255}function Q(Ie,ae,ve){Ie.bi_valid>_-ve?(Ie.bi_buf|=ae<<Ie.bi_valid&65535,Z(Ie,Ie.bi_buf),Ie.bi_buf=ae>>_-Ie.bi_valid,Ie.bi_valid+=ve-_):(Ie.bi_buf|=ae<<Ie.bi_valid&65535,Ie.bi_valid+=ve)}function ie(Ie,ae,ve){Q(Ie,ve[2*ae],ve[2*ae+1])}function ge(Ie,ae){for(var ve=0;ve|=1&Ie,Ie>>>=1,ve<<=1,0<--ae;);return ve>>>1}function Te(Ie,ae,ve){var we,pe,ze=new Array(g+1),Je=0;for(we=1;we<=g;we++)ze[we]=Je=Je+ve[we-1]<<1;for(pe=0;pe<=ae;pe++){var Xe=Ie[2*pe+1];Xe!==0&&(Ie[2*pe]=ge(ze[Xe]++,Xe))}}function be(Ie){var ae;for(ae=0;ae<f;ae++)Ie.dyn_ltree[2*ae]=0;for(ae=0;ae<d;ae++)Ie.dyn_dtree[2*ae]=0;for(ae=0;ae<p;ae++)Ie.bl_tree[2*ae]=0;Ie.dyn_ltree[2*v]=1,Ie.opt_len=Ie.static_len=0,Ie.last_lit=Ie.matches=0}function Pe(Ie){8<Ie.bi_valid?Z(Ie,Ie.bi_buf):0<Ie.bi_valid&&(Ie.pending_buf[Ie.pending++]=Ie.bi_buf),Ie.bi_buf=0,Ie.bi_valid=0}function Ge(Ie,ae,ve,we){var pe=2*ae,ze=2*ve;return Ie[pe]<Ie[ze]||Ie[pe]===Ie[ze]&&we[ae]<=we[ve]}function Ze(Ie,ae,ve){for(var we=Ie.heap[ve],pe=ve<<1;pe<=Ie.heap_len&&(pe<Ie.heap_len&&Ge(ae,Ie.heap[pe+1],Ie.heap[pe],Ie.depth)&&pe++,!Ge(ae,we,Ie.heap[pe],Ie.depth));)Ie.heap[ve]=Ie.heap[pe],ve=pe,pe<<=1;Ie.heap[ve]=we}function lt(Ie,ae,ve){var we,pe,ze,Je,Xe=0;if(Ie.last_lit!==0)for(;we=Ie.pending_buf[Ie.d_buf+2*Xe]<<8|Ie.pending_buf[Ie.d_buf+2*Xe+1],pe=Ie.pending_buf[Ie.l_buf+Xe],Xe++,we===0?ie(Ie,pe,ae):(ie(Ie,(ze=O[pe])+h+1,ae),(Je=T[ze])!==0&&Q(Ie,pe-=z[ze],Je),ie(Ie,ze=Y(--we),ve),(Je=k[ze])!==0&&Q(Ie,we-=te[ze],Je)),Xe<Ie.last_lit;);ie(Ie,v,ae)}function pt(Ie,ae){var ve,we,pe,ze=ae.dyn_tree,Je=ae.stat_desc.static_tree,Xe=ae.stat_desc.has_stree,tt=ae.stat_desc.elems,Nt=-1;for(Ie.heap_len=0,Ie.heap_max=m,ve=0;ve<tt;ve++)ze[2*ve]!==0?(Ie.heap[++Ie.heap_len]=Nt=ve,Ie.depth[ve]=0):ze[2*ve+1]=0;for(;Ie.heap_len<2;)ze[2*(pe=Ie.heap[++Ie.heap_len]=Nt<2?++Nt:0)]=1,Ie.depth[pe]=0,Ie.opt_len--,Xe&&(Ie.static_len-=Je[2*pe+1]);for(ae.max_code=Nt,ve=Ie.heap_len>>1;1<=ve;ve--)Ze(Ie,ze,ve);for(pe=tt;ve=Ie.heap[1],Ie.heap[1]=Ie.heap[Ie.heap_len--],Ze(Ie,ze,1),we=Ie.heap[1],Ie.heap[--Ie.heap_max]=ve,Ie.heap[--Ie.heap_max]=we,ze[2*pe]=ze[2*ve]+ze[2*we],Ie.depth[pe]=(Ie.depth[ve]>=Ie.depth[we]?Ie.depth[ve]:Ie.depth[we])+1,ze[2*ve+1]=ze[2*we+1]=pe,Ie.heap[1]=pe++,Ze(Ie,ze,1),2<=Ie.heap_len;);Ie.heap[--Ie.heap_max]=Ie.heap[1],(function(gt,wt){var Re,se,W,oe,xe,Ce,Se=wt.dyn_tree,ye=wt.max_code,Ke=wt.stat_desc.static_tree,ke=wt.stat_desc.has_stree,He=wt.stat_desc.extra_bits,Fe=wt.stat_desc.extra_base,We=wt.stat_desc.max_length,at=0;for(oe=0;oe<=g;oe++)gt.bl_count[oe]=0;for(Se[2*gt.heap[gt.heap_max]+1]=0,Re=gt.heap_max+1;Re<m;Re++)We<(oe=Se[2*Se[2*(se=gt.heap[Re])+1]+1]+1)&&(oe=We,at++),Se[2*se+1]=oe,ye<se||(gt.bl_count[oe]++,xe=0,Fe<=se&&(xe=He[se-Fe]),Ce=Se[2*se],gt.opt_len+=Ce*(oe+xe),ke&&(gt.static_len+=Ce*(Ke[2*se+1]+xe)));if(at!==0){do{for(oe=We-1;gt.bl_count[oe]===0;)oe--;gt.bl_count[oe]--,gt.bl_count[oe+1]+=2,gt.bl_count[We]--,at-=2}while(0<at);for(oe=We;oe!==0;oe--)for(se=gt.bl_count[oe];se!==0;)ye<(W=gt.heap[--Re])||(Se[2*W+1]!==oe&&(gt.opt_len+=(oe-Se[2*W+1])*Se[2*W],Se[2*W+1]=oe),se--)}})(Ie,ae),Te(ze,Nt,Ie.bl_count)}function ne(Ie,ae,ve){var we,pe,ze=-1,Je=ae[1],Xe=0,tt=7,Nt=4;for(Je===0&&(tt=138,Nt=3),ae[2*(ve+1)+1]=65535,we=0;we<=ve;we++)pe=Je,Je=ae[2*(we+1)+1],++Xe<tt&&pe===Je||(Xe<Nt?Ie.bl_tree[2*pe]+=Xe:pe!==0?(pe!==ze&&Ie.bl_tree[2*pe]++,Ie.bl_tree[2*E]++):Xe<=10?Ie.bl_tree[2*x]++:Ie.bl_tree[2*A]++,ze=pe,Nt=(Xe=0)===Je?(tt=138,3):pe===Je?(tt=6,3):(tt=7,4))}function Le(Ie,ae,ve){var we,pe,ze=-1,Je=ae[1],Xe=0,tt=7,Nt=4;for(Je===0&&(tt=138,Nt=3),we=0;we<=ve;we++)if(pe=Je,Je=ae[2*(we+1)+1],!(++Xe<tt&&pe===Je)){if(Xe<Nt)for(;ie(Ie,pe,Ie.bl_tree),--Xe!=0;);else pe!==0?(pe!==ze&&(ie(Ie,pe,Ie.bl_tree),Xe--),ie(Ie,E,Ie.bl_tree),Q(Ie,Xe-3,2)):Xe<=10?(ie(Ie,x,Ie.bl_tree),Q(Ie,Xe-3,3)):(ie(Ie,A,Ie.bl_tree),Q(Ie,Xe-11,7));ze=pe,Nt=(Xe=0)===Je?(tt=138,3):pe===Je?(tt=6,3):(tt=7,4)}}c(te);var Ve=!1;function De(Ie,ae,ve,we){Q(Ie,(l<<1)+(we?1:0),3),(function(pe,ze,Je,Xe){Pe(pe),Z(pe,Je),Z(pe,~Je),s.arraySet(pe.pending_buf,pe.window,ze,Je,pe.pending),pe.pending+=Je})(Ie,ae,ve)}i._tr_init=function(Ie){Ve||((function(){var ae,ve,we,pe,ze,Je=new Array(g+1);for(pe=we=0;pe<u-1;pe++)for(z[pe]=we,ae=0;ae<1<<T[pe];ae++)O[we++]=pe;for(O[we-1]=pe,pe=ze=0;pe<16;pe++)for(te[pe]=ze,ae=0;ae<1<<k[pe];ae++)D[ze++]=pe;for(ze>>=7;pe<d;pe++)for(te[pe]=ze<<7,ae=0;ae<1<<k[pe]-7;ae++)D[256+ze++]=pe;for(ve=0;ve<=g;ve++)Je[ve]=0;for(ae=0;ae<=143;)F[2*ae+1]=8,ae++,Je[8]++;for(;ae<=255;)F[2*ae+1]=9,ae++,Je[9]++;for(;ae<=279;)F[2*ae+1]=7,ae++,Je[7]++;for(;ae<=287;)F[2*ae+1]=8,ae++,Je[8]++;for(Te(F,f+1,Je),ae=0;ae<d;ae++)M[2*ae+1]=5,M[2*ae]=ge(ae,5);q=new re(F,T,h+1,f,g),G=new re(M,k,0,d,g),K=new re(new Array(0),L,0,p,y)})(),Ve=!0),Ie.l_desc=new H(Ie.dyn_ltree,q),Ie.d_desc=new H(Ie.dyn_dtree,G),Ie.bl_desc=new H(Ie.bl_tree,K),Ie.bi_buf=0,Ie.bi_valid=0,be(Ie)},i._tr_stored_block=De,i._tr_flush_block=function(Ie,ae,ve,we){var pe,ze,Je=0;0<Ie.level?(Ie.strm.data_type===2&&(Ie.strm.data_type=(function(Xe){var tt,Nt=4093624447;for(tt=0;tt<=31;tt++,Nt>>>=1)if(1&Nt&&Xe.dyn_ltree[2*tt]!==0)return o;if(Xe.dyn_ltree[18]!==0||Xe.dyn_ltree[20]!==0||Xe.dyn_ltree[26]!==0)return a;for(tt=32;tt<h;tt++)if(Xe.dyn_ltree[2*tt]!==0)return a;return o})(Ie)),pt(Ie,Ie.l_desc),pt(Ie,Ie.d_desc),Je=(function(Xe){var tt;for(ne(Xe,Xe.dyn_ltree,Xe.l_desc.max_code),ne(Xe,Xe.dyn_dtree,Xe.d_desc.max_code),pt(Xe,Xe.bl_desc),tt=p-1;3<=tt&&Xe.bl_tree[2*I[tt]+1]===0;tt--);return Xe.opt_len+=3*(tt+1)+5+5+4,tt})(Ie),pe=Ie.opt_len+3+7>>>3,(ze=Ie.static_len+3+7>>>3)<=pe&&(pe=ze)):pe=ze=ve+5,ve+4<=pe&&ae!==-1?De(Ie,ae,ve,we):Ie.strategy===4||ze===pe?(Q(Ie,2+(we?1:0),3),lt(Ie,F,M)):(Q(Ie,4+(we?1:0),3),(function(Xe,tt,Nt,gt){var wt;for(Q(Xe,tt-257,5),Q(Xe,Nt-1,5),Q(Xe,gt-4,4),wt=0;wt<gt;wt++)Q(Xe,Xe.bl_tree[2*I[wt]+1],3);Le(Xe,Xe.dyn_ltree,tt-1),Le(Xe,Xe.dyn_dtree,Nt-1)})(Ie,Ie.l_desc.max_code+1,Ie.d_desc.max_code+1,Je+1),lt(Ie,Ie.dyn_ltree,Ie.dyn_dtree)),be(Ie),we&&Pe(Ie)},i._tr_tally=function(Ie,ae,ve){return Ie.pending_buf[Ie.d_buf+2*Ie.last_lit]=ae>>>8&255,Ie.pending_buf[Ie.d_buf+2*Ie.last_lit+1]=255&ae,Ie.pending_buf[Ie.l_buf+Ie.last_lit]=255&ve,Ie.last_lit++,ae===0?Ie.dyn_ltree[2*ve]++:(Ie.matches++,ae--,Ie.dyn_ltree[2*(O[ve]+h+1)]++,Ie.dyn_dtree[2*Y(ae)]++),Ie.last_lit===Ie.lit_bufsize-1},i._tr_align=function(Ie){Q(Ie,2,3),ie(Ie,v,F),(function(ae){ae.bi_valid===16?(Z(ae,ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0):8<=ae.bi_valid&&(ae.pending_buf[ae.pending++]=255&ae.bi_buf,ae.bi_buf>>=8,ae.bi_valid-=8)})(Ie)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,f=1,d={},p=!1,m=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,c={}.toString.call(o.process)==="[object process]"?function(E){sf.nextTick(function(){y(E)})}:(function(){if(o.postMessage&&!o.importScripts){var E=!0,x=o.onmessage;return o.onmessage=function(){E=!1},o.postMessage("","*"),o.onmessage=x,E}})()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(E){o.postMessage(h+E,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(E){y(E.data)},function(E){u.port2.postMessage(E)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(E){var x=m.createElement("script");x.onreadystatechange=function(){y(E),x.onreadystatechange=null,l.removeChild(x),x=null},l.appendChild(x)}):function(E){setTimeout(y,0,E)},g.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var x=new Array(arguments.length-1),A=0;A<x.length;A++)x[A]=arguments[A+1];var T={callback:E,args:x};return d[f]=T,c(f),f++},g.clearImmediate=_}function _(E){delete d[E]}function y(E){if(p)setTimeout(y,0,E);else{var x=d[E];if(x){p=!0;try{(function(A){var T=A.callback,k=A.args;switch(k.length){case 0:T();break;case 1:T(k[0]);break;case 2:T(k[0],k[1]);break;case 3:T(k[0],k[1],k[2]);break;default:T.apply(a,k)}})(x)}finally{_(E),p=!1}}}}function v(E){E.source===o&&typeof E.data=="string"&&E.data.indexOf(h)===0&&y(+E.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof qf<"u"?qf:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(f2)),f2.exports}var J6e=X6e();const Z6e=_u(J6e),Fte={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Fte);var Lf=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},$S,CT,Jy;class Q6e{constructor(...e){$S.set(this,new Map),CT.set(this,new Map),Jy.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Lf(this,Jy,"f").has(r)||Lf(this,Jy,"f").set(r,new Set);const s=Lf(this,Jy,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s?.add(a),o&&Lf(this,CT,"f").set(r,a),o=!1,c)continue;const l=Lf(this,$S,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Lf(this,$S,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/s,"").toLowerCase(),r=n.replace(/^.*\./s,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Lf(this,$S,"f").get(r)??null}getExtension(e){return typeof e!="string"?null:(e=e?.split?.(";")[0],(e&&Lf(this,CT,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Lf(this,Jy,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Lf(this,Jy,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Lf(this,$S,"f"),extensions:Lf(this,CT,"f")}}}$S=new WeakMap,CT=new WeakMap,Jy=new WeakMap;new Q6e(Fte)._freeze();var LR={},KH;function e8e(){if(KH)return LR;KH=1,Object.defineProperty(LR,"__esModule",{value:!0});function t(a){return typeof a=="string"?a.startsWith("#")?"hex":null:"r"in a&&"g"in a&&"b"in a?"rgb":"h"in a&&"s"in a&&"l"in a?"hsl":"h"in a&&"s"in a&&"v"in a?"hsv":null}function e(a){const c=a.replace("#",""),l=parseInt(c.substring(0,2),16),u=parseInt(c.substring(2,4),16),h=parseInt(c.substring(4,6),16);return{r:l,g:u,b:h}}function n(a){const{r:c,g:l,b:u}=a;return`#${(c<<16|l<<8|u).toString(16).padStart(6,"0")}`}function r(a,c,l){c/=100,l/=100;const u=d=>(d+a/30)%12,h=c*Math.min(l,1-l),f=d=>l-h*Math.max(-1,Math.min(u(d)-3,Math.min(9-u(d),1)));return{r:Math.round(f(0)*255),g:Math.round(f(8)*255),b:Math.round(f(4)*255)}}function i(a,c,l){c/=100,l/=100;const u=f=>(f+a/60)%6,h=f=>l-l*c*Math.max(0,Math.min(u(f),4-u(f),1));return{r:Math.round(h(5)*255),g:Math.round(h(3)*255),b:Math.round(h(1)*255)}}function s(a,c){const l=Math.abs(a.r-c.r),u=Math.abs(a.g-c.g),h=Math.abs(a.b-c.b),f=1-l/255,d=1-u/255,p=1-h/255;return(f+d+p)/3}function o(a){let c=Math.min(Math.max(a.similarityThreshold||.8,.01),1);const{targetColor:l,colorArray:u}=a,h=t(l);if(h===null)return null;let f;if(h==="hex")f=e(l);else if(h==="rgb")f=l;else if(h==="hsl"){const{h:m,s:g,l:_}=l;f=r(m,g,_)}else if(h==="hsv"){const{h:m,s:g,v:_}=l;f=i(m,g,_)}else return null;let d=null,p=0;for(const m of u){t(m.hex?m.hex:m.rgb),m.hex?m.rgb||(m.rgb=e(m.hex)):m.hex=n(m.rgb);const g=Math.round(s(f,m.rgb)*100)/100;g>=c&&g>p&&(p=g,d={name:m.name,hex:m.hex,rgb:m.rgb,similarity:g})}return d}return LR.default=o,LR}e8e();function VE(t,e=16){return t?RE(e-1).map(n=>{const r=n*eA;return new wi(t.bits[r]/63,t.bits[r+1]/63,t.bits[r+2]/63)}):[]}async function jte(t){const e=new FormData;e.append("url",t);const n=new Request("https://bytes.zed.cafe",{method:"POST",body:e});return await(await fetch(n)).text()}function zte(){return location.href.includes("/join/")}async function t8e(t,e){const n=new FormData;n.append("email",t),n.append("tag",e);const r=new Request("https://bbs.zed.cafe/api/login",{method:"POST",body:n});return await(await fetch(r)).json()}async function n8e(t,e){const n=new FormData;n.append("email",t),n.append("code",e);const r=new Request("https://bbs.zed.cafe/api/code",{method:"POST",body:n});return await(await fetch(r)).json()}async function r8e(t,e){const n=new FormData;n.append("email",t),n.append("code",e);const r=new Request("https://bbs.zed.cafe/api/list",{method:"POST",body:n});return await(await fetch(r)).json()}async function i8e(t,e,n,r,i){const s=new FormData;s.append("email",t),s.append("code",e),s.append("filename",n),s.append("url",r),s.append("tags",i.join(","));const o=new Request("https://bbs.zed.cafe/api/publish",{method:"POST",body:s});return await(await fetch(o)).json()}async function s8e(t,e,n){const r=new FormData;r.append("email",t),r.append("code",e),r.append("filename",n);const i=new Request("https://bbs.zed.cafe/api/delete",{method:"POST",body:r});return await(await fetch(i)).json()}function io(t,e,n){n().catch(r=>{console.error(r),_r(t,e,"crash",r?.message)})}function UR(t){if(Um(t)!==Qr.TERRAIN&&Um(t)!==Qr.OBJECT)return"";const n={kind:oc(t)};return ap(n),`${Vte(n)}$ONCLEAR$BLUE `}function Vte(t){const e=mu(t),n=`${Ft[e.color]}`,r=`${Ft[e.bg>Ft.WHITE?Ft.BLACK:e.bg]}`;return`$${n}$ON${r}$${e.char}`}function o8e(t){if(!fe(t?.id))return"";let e=mu(t).name;if(t.kind==="player"){const{user:r}=Eg(t.id);e=dn(r)?r:"player"}return`${Vte(t)}$ONCLEAR$CYAN ${e}:$WHITE `}new zn;function HE(t,e=!1){const[n,r]=Dt(t,0,[ut.ANY]);if(e&&sd(n)){const[i,s,o]=Dt(t,0,[ut.DIR,ut.NAME]);return s.startsWith(":")?{targetdir:i,label:s.substring(1).trim(),args:t.slice(o)}:{targetdir:i,label:s,args:t.slice(o)}}else{const[i,s,o]=Dt(t,0,[ut.NAME,ut.ANY]);return dn(s)&&s.startsWith(":")?{targetname:i,label:s.substring(1).trim(),args:t.slice(o)}:{targetname:"self",label:i,args:t.slice(r)}}}let ag="",Hd="";function a8e(t){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.exec(String(t).toLowerCase())}function ja(t){return t===Cm()}function AS(){bxe(qe,Cm())}const c8e=Mv().command("shortsend",(t,e)=>{const n=HE(e);return n.targetname==="self"?dh(qe,he.elementfocus,void 0,"text",`cli:${n.label}`,n.args.join(" ")):GE(t,he.element,n),0}).command("send",(t,e)=>{const n=HE(e,!0);return GE(t,he.element,n),0}).command("stat",(t,e)=>(pxe(qe,he.elementfocus,e.map(no).join(" ")),0)).command("text",(t,e)=>{const n=e.map(no).join(" ");if(fe(he.element)&&he.elementisplayer){he.element.tickertext=n,he.element.tickertime=he.timestamp,F8("",he.element,n);const{user:r}=Eg(he.elementid),i=dn(r)?r:"player";dh(qe,he.elementid,void 0,"text",`chat:message:${he.board?.id??""}`,`${i}:${n}`)}return 0}).command("hyperlink",(t,e)=>{const[n,...r]=e,{user:i}=Eg(he.elementid),s=dn(i)?i:"player",o=mu(he.element),a=`$${Ft[o.color]}$ON${Ft[o.bg]}$${o.char}$ONCLEAR $WHITE${s}$BLUE `,c=t.template(no(n).split(" "));return us(qe,he.elementid,`!${t.template(r)};${a}${c}`),0}).command("bookrename",()=>{if(!ja(he.elementfocus))return 0;const t=sv(la.MAIN);return twe(t),fe(t)&&ih(qe,he.elementfocus,"main",`${t?.name??"empty"} $GREEN${t?.id??""}`),0}).command("booktrash",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.NAME]),r=Zh(la.MAIN),i=iv(n);return fe(i)&&(r===i&&DZ(la.MAIN,""),hwe(n),us(qe,he.elementfocus,`trashed [book] ${i.name}`),AS(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=Dt(e,0,[ut.NAME]),r=Cs(n);return fe(r)&&nE(he.book,he.elementfocus,r.id,{x:au(0,bn-1),y:au(0,Tr-1)}),0}).command("pageopen",(t,e)=>{const[n,r]=Dt(e,0,[ut.NAME,ut.MAYBE_NAME]);let i,s;const o=gm();for(let a=0;a<o.length&&(s=o[a],i=fA(s,n),!fe(i));++a);if(fe(i)&&fe(s)){const a=oc(i),c=[i.id,r];wte(PK(s.id,c),i.code);const l=Ay(i),u=`${UR(i)}$ONCLEAR$GREEN ${a} - ${s.name}`;QEe(qe,he.elementfocus,s.id,c,l,u)}else _r(qe,"pageopen",`page ${n} not found`,he.elementfocus);return 0}).command("pagetrash",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.NAME]),r=sv(la.MAIN),i=IZ(r,n);if(fe(n)){const s=oc(i),o=Ay(i);us(qe,he.elementfocus,`trashed [${o}] ${s}`),AS(),t.command("pages")}return 0}).command("help",()=>(Y5(qe,he.elementfocus),0)).command("books",()=>{if(!ja(he.elementfocus))return 0;Xy(qe,he.elementfocus,"books");const t=Zh(la.MAIN);ih(qe,he.elementfocus,"main",`${t?.name??"empty"} $GREEN${t?.id??""}`);const e=Zh(la.MAIN);ih(qe,he.elementfocus,"content",`${e?.name??"empty"} ${e?.id??""}`),L8(qe,he.elementfocus,7);const n=gm();return n.length?n.forEach(r=>{zr(qe,he.elementfocus,`!bookopen ${r.id};${r.name}`)}):to(qe,he.elementfocus,"no books found"),zr(qe,he.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=sv(la.MAIN);if(!fe(t))return 0;Xy(qe,he.elementfocus,"pages"),ih(qe,he.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?rw(t).forEach(r=>{const i=oc(r),s=Ay(r),o=UR(r);zr(qe,he.elementfocus,`!pageopen ${r.id};$blue[${s}] ${o}$white${i}`)}):(zr(qe,he.elementfocus,""),Bte(Ute("help:nopages"),n=>Y6e(he.elementfocus,n)));const e=gm();for(let n=0;n<e.length;++n){const r=e[n];r.id!==t.id&&(ih(qe,he.elementfocus,"content",`${r.name} $GREEN${r.id}`),rw(r).forEach(s=>{const o=oc(s),a=Ay(s);zr(qe,he.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Xy(qe,he.elementfocus,"boards");const t=sv(la.MAIN);if(fe(t)){ih(qe,he.elementfocus,"main",`${t.name} $GREEN${t.id}`);const n=rw(t);n.filter(r=>Um(r)===Qr.BOARD).forEach(r=>{const i=oc(r);zr(qe,he.elementfocus,`!boardopen ${r.id};$blue[#goto]$white ${i}`)}),n.length===0&&(zr(qe,he.elementfocus,""),to(qe,he.elementfocus,"$white no boards found"),to(qe,he.elementfocus,"$white use @ to create a board"),to(qe,he.elementfocus,"$white @board name of board"))}const e=gm();for(let n=0;n<e.length;++n){const r=e[n];r.id!==t.id&&(ih(qe,he.elementfocus,"content",`${r.name} $GREEN${r.id}`),rw(r).filter(s=>Um(s)===Qr.BOARD).forEach(s=>{const o=oc(s);zr(qe,he.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{if(!ja(he.elementfocus))return 0;Xy(qe,he.elementfocus,"$REDTRASH"),to(qe,he.elementfocus,"books");const t=gm();t.length&&(t.forEach(n=>{zr(qe,he.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),zr(qe,he.elementfocus,""));const e=Zh(la.MAIN);return fe(e)&&(to(qe,he.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=oc(n),i=Ay(n),s=UR(n);zr(qe,he.elementfocus,`!pagetrash ${n.id};$REDTRASH [${i}] ${s}${r}`)}),zr(qe,he.elementfocus,"")),0}).command("dev",()=>(ja(he.elementfocus)&&(AS(),sxe(qe,he.elementfocus)),0)).command("share",()=>(ja(he.elementfocus)&&(AS(),DEe(qe,he.elementfocus)),0)).command("save",()=>(ja(he.elementfocus)&&AS(),0)).command("fork",(t,e)=>{if(ja(he.elementfocus)){const[n]=Dt(e,0,[ut.MAYBE_NAME]);Sxe(qe,he.elementfocus,n??"")}return 0}).command("nuke",()=>(ja(he.elementfocus)&&LEe(qe,he.elementfocus),0)).command("endgame",()=>(OK(qe,he.elementfocus,!1),0)).command("restart",()=>(ja(he.elementfocus)&&(yxe(qe,he.elementfocus),AS()),0)).command("export",()=>{if(!ja(he.elementfocus))return 0;Sv(qe,he.elementfocus,"E X P O R T"),Xy(qe,he.elementfocus,"books");const t=gm();return t.length&&t.forEach(e=>zr(qe,he.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.NAME]),r=iv(n);return fe(r)&&(Sv(qe,he.elementfocus,"E X P O R T"),Xy(qe,he.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=rw(r);zr(qe,he.elementfocus,`!bookallexport ${n};$blue[all] $whiteexport book`),i.forEach(s=>{const o=oc(s),a=Ay(s),c=UR(s);zr(qe,he.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}] ${c}$white${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.NAME]),r=iv(n);return fe(r)&&vj(qe,he.elementfocus,Ts(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.NAME]),{target:r,path:i}=_v(n),s=iv(r),o=fA(s,i);return fe(o)&&vj(qe,he.elementfocus,Ts(o),`${oc(o)}.${Ay(o)}.json`),0}).command("itchiopublish",()=>{if(!ja(he.elementfocus))return 0;const t=Zh(la.MAIN);return Sj(qe,he.elementfocus,"itchio",t?.name??""),0}).command("gadget",()=>(ZEe(qe,he.elementfocus,void 0),0)).command("findany",(t,e)=>{const[n]=Dt(e,0,[ut.ANY]);if(Kn(n)){const r=n.filter(cv);bj(qe,he.elementfocus,r)}else bj(qe,he.elementfocus,[]);return 0}).command("zztsearch",(t,e)=>{const[n,r]=Dt(e,0,[ut.NAME,ut.MAYBE_NAME]),i=fe(r)?n:"title",s=fe(r)?r:n;return rxe(qe,he.elementfocus,i,s),0}).command("zztrandom",()=>(ixe(qe,he.elementfocus),0)).command("admin",()=>(nxe(qe,he.elementfocus),0)).command("joincode",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.MAYBE_NAME]),r=Vee(he.elementfocus);return fe(r)?AEe(qe,he.elementfocus,!!n):_r(qe,he.elementfocus,"multiplayer","need to have an active player on a board in order to start multiplayer"),0}).command("jointab",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.MAYBE_NAME]);return CEe(qe,he.elementfocus,!!n),0}).command("chat",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.MAYBE_NAME]);return n?EEe(qe,he.elementfocus,n):xEe(qe,he.elementfocus),0}).command("broadcast",(t,e)=>{if(!ja(he.elementfocus))return 0;const[n]=Dt(e,0,[ut.MAYBE_NAME]);return n?bEe(qe,he.elementfocus,n):SEe(qe,he.elementfocus),0}).command("agent",(t,e)=>{const[n,r]=Dt(e,0,[ut.MAYBE_NAME]);switch(rr(n)){case"start":uxe(qe,he.elementfocus);break;case"stop":{const[i]=Dt(e,1,[ut.NAME]);fe(i)?hxe(qe,he.elementfocus,i):_r(qe,he.elementfocus,"agent","#agent stop <id>");break}case"":case"list":fxe(qe,he.elementfocus);break;default:{if(dn(n)){let i=r;const s=[];for(;i<e.length;){const[o,a]=Dt(e,i,[ut.ANY]);s.push(o),i=a}dxe(qe,he.elementfocus,n,s.map(no).join(" "))}else _r(qe,he.elementfocus,"agent","#agent <id> <prompt>");break}}return 0}).command("screenshot",()=>(PEe(qe,he.elementfocus),0)).command("bbs",(t,e)=>{const[n,r]=Dt(e,0,[ut.ANY]);switch(rr(n)){default:if(Hd)ag?to(qe,he.elementfocus,"you are already logged in, use #bbs restart to login again"):io(qe,he.elementfocus,async()=>{to(qe,he.elementfocus,`confirming login with $green${n}`),(await n8e(Hd,n)).success&&(ag=`${n}`,to(qe,he.elementfocus,`$green${Hd} has been logged in`))});else{const[i,s]=Dt(e,0,[ut.NAME,ut.NAME]);a8e(i)&&s?io(qe,he.elementfocus,async()=>{to(qe,he.elementfocus,`starting login with $green${i} ${s}`),(await t8e(i,s)).success&&(Hd=i,to(qe,he.elementfocus,"check your email for #bbs <code>"))}):to(qe,he.elementfocus,"please login with $green#bbs <email> <tag>")}break;case"restart":Hd="",ag="",to(qe,he.elementfocus,"bbs restarted"),to(qe,he.elementfocus,"please login with $green#bbs <email> <tag>");break;case"list":!Hd||!ag?to(qe,he.elementfocus,"please login with $green#bbs <email> <tag>$blue first"):io(qe,he.elementfocus,async()=>{to(qe,he.elementfocus,"listing files");const i=await r8e(Hd,ag);if(i.success)for(let s=0;s<i.list.length;++s){const{metadata:o}=i.list[s];B6e(qe,he.elementfocus,o.url,o.filename),to(qe,he.elementfocus,o.tags)}});break;case"pub":case"publish":if(!Hd||!ag)to(qe,he.elementfocus,"please login with $green#bbs <email> <tag>$blue first");else{const[i,s]=Dt(e,r,[ut.NAME]),o=[];for(let a=s;a<e.length;){const[c,l]=Dt(e,a,[ut.NAME]);a=l,o.push(c)}Sj(qe,he.elementfocus,"bbs",Hd,ag,i,...o)}break;case"del":case"delete":if(!Hd||!ag)to(qe,he.elementfocus,"please login with $green#bbs <email> <tag>$blue first");else{const[i]=Dt(e,r,[ut.NAME]);io(qe,he.elementfocus,async()=>{to(qe,he.elementfocus,`deleting ${i}`),(await s8e(Hd,ag,i)).success&&to(qe,he.elementfocus,`$red${i} has been deleted`)})}break}return 0}),l8e=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),XH=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","arg"]),u8e=["NORTH","SOUTH","WEST","EAST"];function h8e(t,e,n){const r=Eg(t);if(nn(r.inputcurrent)||(r.inputcurrent=0),Kn(r.inputqueue)||(r.inputqueue=[]),r.inputcurrent>0)return r;const[i]=r.inputqueue,[s=Ct.NONE,o=0]=i??[Ct.NONE,0];switch(r.inputmove=[],r.inputok=0,r.inputcancel=0,r.inputmenu=0,r.inputalt=o&l5?1:0,r.inputctrl=o&u5?1:0,r.inputshift=o&h5?1:0,s){case Ct.MOVE_UP:case Ct.MOVE_DOWN:case Ct.MOVE_LEFT:case Ct.MOVE_RIGHT:{const a=u8e[s-Ct.MOVE_UP];if(dn(e)&&e==="fpv"&&nn(n))switch(Math.round(n/90)){default:case 0:r.inputmove=[a];break;case 1:switch(a){default:case"NORTH":r.inputmove=["EAST"];break;case"EAST":r.inputmove=["SOUTH"];break;case"SOUTH":r.inputmove=["WEST"];break;case"WEST":r.inputmove=["NORTH"];break}break;case 2:switch(a){default:case"NORTH":r.inputmove=["SOUTH"];break;case"EAST":r.inputmove=["WEST"];break;case"SOUTH":r.inputmove=["NORTH"];break;case"WEST":r.inputmove=["EAST"];break}break;case 3:switch(a){default:case"NORTH":r.inputmove=["WEST"];break;case"EAST":r.inputmove=["NORTH"];break;case"SOUTH":r.inputmove=["EAST"];break;case"WEST":r.inputmove=["SOUTH"];break}break}else r.inputmove=[a];break}case Ct.OK_BUTTON:r.inputok=1;break;case Ct.CANCEL_BUTTON:r.inputcancel=1;break;case Ct.MENU_BUTTON:r.inputmenu=1;break}return r.inputcurrent=s,r.inputqueue=r.inputqueue.filter(a=>{const[c]=a;return c!==Ct.NONE&&c!==s}),r}function f8e(t){const e=Gee[t];if(fe(e))return e;const n=Hee[t];if(fe(n))return n;const r=RI[t];if(fe(r))return r;const i=FK[t];if(fe(i))return i}const d8e=Mv({get(t,e){const n=f8e(e);if(fe(n))return[!0,n];if(he.elementisplayer&&l8e.has(e)){const c=t.get("graphics"),l=t.get("facing"),u=h8e(he.elementid,c,l)[e];return[fe(u),u]}const r=jT(he.board,{x:he.element?.x??-1,y:he.element?.y??-1},he.elementfocus),i=r?.id??he.elementfocus??Cm(),s=he.element?.sender,o=Kte(he.board,dn(s)?s:"");switch(e){case"camera":case"graphics":case"facing":{const c=Eg(i)[e];return[!0,fe(c)?c:he.board?.[e]??0]}case"isdark":return[!0,he.board?.isdark?1:0];case"startx":return[!0,he.board?.startx??0];case"starty":return[!0,he.board?.starty??0];case"over":return[!0,he.board?.over??""];case"under":return[!0,he.board?.under??""];case"palette":return[!0,he.board?.palette??""];case"charset":return[!0,he.board?.charset??""];case"exitnorth":return[!0,he.board?.exitnorth??""];case"exitsouth":return[!0,he.board?.exitsouth??""];case"exitwest":return[!0,he.board?.exitwest??""];case"exiteast":return[!0,he.board?.exiteast??""];case"timelimit":return[!0,he.board?.timelimit??0];case"restartonzap":return[!0,he.board?.restartonzap??0];case"maxplayershots":return[!0,he.board?.maxplayershots??0];case"b1":return[!0,he.board?.b1??0];case"b2":return[!0,he.board?.b2??0];case"b3":return[!0,he.board?.b3??0];case"b4":return[!0,he.board?.b4??0];case"b5":return[!0,he.board?.b5??0];case"b6":return[!0,he.board?.b6??0];case"b7":return[!0,he.board?.b7??0];case"b8":return[!0,he.board?.b8??0];case"b9":return[!0,he.board?.b9??0];case"b10":return[!0,he.board?.b10??0];case"currenttick":return[!0,he.timestamp];case"boardid":return[!0,he.board?.id??""];case"playerid":return[!0,i];case"playerx":return[!0,r?.x??-1];case"playery":return[!0,r?.y??-1];case"thisid":return[!0,he.element?.id??""];case"thisx":return[!0,he.element?.x??-1];case"thisy":return[!0,he.element?.y??-1];case"senderid":return[!0,o?.id??""];case"senderx":return[!0,o?.x??-1];case"sendery":return[!0,o?.y??-1];default:{if(XH.has(e))return[!0,ri(he.element,e)??0];break}}const a=Eg(i)[e];return[fe(a),a]},set(t,e,n){const r={x:he.element?.x??-1,y:he.element?.y??-1},s=jT(he.board,r,he.elementfocus)?.id??he.elementfocus;switch(e){case"camera":case"graphics":break;case"facing":n=rq.euclideanModulo(n,360);break;case"isdark":if(fe(he.board))return he.board.isdark=n?1:0,[!0,he.board.isdark];break;case"startx":if(fe(he.board))return he.board.startx=u1(n,0),[!0,he.board.startx];break;case"starty":if(fe(he.board))return he.board.starty=u1(n,0),[!0,he.board.starty];break;case"over":if(fe(he.board)){const a=no(n);return he.board.over!==a&&(he.board.overboard=void 0),he.board.over=a,[!0,a]}break;case"under":if(fe(he.board)){const a=no(n);return he.board.under!==a&&(he.board.underboard=void 0),he.board.under=a,[!0,a]}break;case"palette":if(fe(he.board)){const a=no(n);return he.board.palette!==a&&(he.board.palettepage=void 0),he.board.palette=a,[!0,a]}break;case"charset":if(fe(he.board)){const a=no(n);return he.board.charset!==a&&(he.board.charsetpage=void 0),he.board.charset=a,[!0,a]}break;case"exitnorth":if(fe(he.board))return[!0,he.board.exitnorth=no(n)];break;case"exitsouth":if(fe(he.board))return[!0,he.board.exitsouth=no(n)];break;case"exitwest":if(fe(he.board))return[!0,he.board.exitwest=no(n)];break;case"exiteast":if(fe(he.board))return[!0,he.board.exiteast=no(n)];break;case"timelimit":if(fe(he.board))return[!0,he.board.timelimit=u1(n,0)];break;case"restartonzap":if(fe(he.board))return[!0,he.board.restartonzap=n?1:0];break;case"maxplayershots":if(fe(he.board))return[!0,he.board.maxplayershots=u1(n,0)];break;case"b1":if(fe(he.board))return[!0,he.board.b1=n];break;case"b2":if(fe(he.board))return[!0,he.board.b2=n];break;case"b3":if(fe(he.board))return[!0,he.board.b3=n];break;case"b4":if(fe(he.board))return[!0,he.board.b4=n];break;case"b5":if(fe(he.board))return[!0,he.board.b5=n];break;case"b6":if(fe(he.board))return[!0,he.board.b6=n];break;case"b7":if(fe(he.board))return[!0,he.board.b7=n];break;case"b8":if(fe(he.board))return[!0,he.board.b8=n];break;case"b9":if(fe(he.board))return[!0,he.board.b9=n];break;case"b10":if(fe(he.board))return[!0,he.board.b10=n];break;case"currenttick":case"boardid":return[!0,n];case"playerid":case"playerx":case"playery":return[!0,n];case"thisid":case"thisx":case"thisy":return[!0,n];case"senderid":return fe(he.element)&&(he.element.sender=n),[!0,n];case"senderx":case"sendery":return[!0,n];default:{if(XH.has(e)){if(fe(he.element))switch(e){case"color":if(uc(n)){const{color:a,bg:c}=rE(n);fe(a)&&(he.element.color=a),fe(c)&&(he.element.bg=c)}else nn(n)&&(he.element.color=n);break;case"bg":if(uc(n)){const{color:a,bg:c}=rE(n);he.element.bg=a??c??Ft.PURPLE}else nn(n)&&(he.element.bg=n);break;case"displaycolor":if(uc(n)){const{color:a,bg:c}=rE(n);fe(a)&&(he.element.displaycolor=a),fe(c)&&(he.element.displaybg=c)}else nn(n)&&(he.element.displaycolor=n);break;case"displaybg":{if(uc(n)){const{color:a,bg:c}=rE(n);he.element.displaybg=a??c??Ft.PURPLE}else nn(n)&&(he.element.displaybg=n);break}default:he.element[e]=n;break}return[!0,n]}break}}const o=Eg(s);return fe(o)?(o[e]=n,e==="user"&&JEe(qe,s,e,n),[!0,n]):[!1,n]},everytick(t){if(he.elementisplayer){const e=t.get("health");nn(e)&&e<=0&&(t.endofprogram(),OK(qe,he.elementid,!0))}!he.element?.removed&&fe(he.element?.x)&&fe(he.element.y)&&fe(he.element.stepx)&&fe(he.element.stepy)&&(he.element.stepx||he.element.stepy)&&Qh(he.book,he.board,he.element,{x:he.element.x+he.element.stepx,y:he.element.y+he.element.stepy})}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(no(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=Dt(e,0,[ut.NAME,ut.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{const[n]=Dt(e,0,[ut.KIND]),r=mu(he.element),[i,s]=n,o=[...kI(r.color,r.bg),...s??[]],a=[i,o];if(b6(he.board,he.element),td(he.board,he.element,he.timestamp)){const c={x:he.element?.x??0,y:he.element?.y??0};Qf(he.board,a,c)}return t.endofprogram(),0}).command("bind",(t,e)=>{const[n]=Dt(e,0,[ut.NAME]),r=fx(he.board,n);return fe(he.element)&&r.length>0&&(he.element.code=Gf(...r).code??"",vP(he.elementid)),0}).command("char",(t,e)=>{const[n]=Dt(e,0,[ut.ANY]);if(sd(n)){const[r,i]=Dt(e,0,[ut.DIR,ut.NUMBER]);if(r.targets.length){for(let o=0;o<r.targets.length;++o){const a=r.targets[o],c=fs(he.board,a);fe(c)&&(c.char=i)}return 0}const s=fs(he.board,r.destpt);fe(s)&&(s.char=i)}else fe(he.element)&&nn(n)&&(he.element.char=n);return 0}).command("color",(t,e)=>{const[n]=Dt(e,0,[ut.ANY]);if(sd(n)){const[r,i]=Dt(e,0,[ut.DIR,ut.COLOR]);if(r.targets.length){for(let o=0;o<r.targets.length;++o){const a=r.targets[o],c=fs(he.board,a);fe(c)&&g1(c,i??Ft.PURPLE)}return 0}const s=fs(he.board,r.destpt);fe(s)&&g1(s,i??Ft.PURPLE)}else{const[r]=Dt(e,0,[ut.COLOR]);fe(he.element)&&fe(r)&&g1(he.element,r)}return 0}).command("go",(t,e)=>{if(fe(he.element)){const[n]=Dt(e,0,[ut.DIR]);if(Qh(he.book,he.board,he.element,n.destpt),t.yield(),he.element.x===n.destpt.x&&he.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!fe(he.element))return 0;const[n]=Dt(e,0,[ut.DIR]),r=he.element.x??0,i=he.element.y??0;return he.element.stepx=n.destpt.x-r,he.element.stepy=n.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",(t,e)=>{const[n]=Dt(e,0,[ut.ANY]);return fe(n)&&t.set("arg",n),t.endofprogram(),0}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(no(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(no(e[0])),0)).command("cycle",(t,e)=>{if(fe(he.element)){const[n]=Dt(e,0,[ut.NUMBER]);he.element.cycle=Ci(Math.round(n),1,255)}return 0}).command("die",t=>{if(td(he.board,he.element,he.timestamp),ri(he.element,"item")){const e={x:he.element?.x??-1,y:he.element?.y??-1},n=jT(he.board,e,he.elementfocus);fe(n?.x)&&fe(n.y)&&Math.abs(n.x-e.x)+Math.abs(n.y-e.y)<2&&(n.x=e.x,n.y=e.y)}else t.endofprogram();return 0}).command("run",(t,e)=>{const[n]=Dt(e,0,[ut.NAME]);return VM(n),0}).command("runwith",(t,e)=>{const[n,r]=Dt(e,0,[ut.ANY,ut.NAME]);return t.set("arg",n),VM(r),0}).command("array",(t,e)=>{const n=[],[r,i]=Dt(e,0,[ut.NAME]);for(let s=i;s<e.length;){const[o,a]=Dt(e,s,[ut.ANY]);n.push(o),s=a}return t.set(r,n),0}).command("read",(t,e)=>{const[n,r,i]=Dt(e,0,[ut.ANY,ut.NUMBER_OR_STRING,ut.NAME]);if(fe(n)){const s=n[r];t.set(i,s)}return 0}).command("load",(t,e)=>{const[n,r,i]=Dt(e,0,[ut.DIR,ut.NAME]),s=fs(he.board,n.destpt);if(fe(s)&&As(s))if(rr(r)==="append"){const[o]=Dt(e,i,[ut.NAME]),a=uu(Qr.OBJECT,o);fe(a)&&(s.code+=a.code,vP(s.id??""))}else{const o=uu(Qr.OBJECT,r);fe(o)&&(s.code=o.code,vP(s.id??""))}return 0}).command("toast",(t,e)=>{const n=e.map(no).join("");return TK(qe,he.elementfocus,n),0}).command("ticker",(t,e)=>{const n=e.map(no).join("");return fe(he.element)&&(he.element.tickertext=n,he.element.tickertime=he.timestamp,F8(he.board?.id,he.element,n)),0});function JH(t,e){if(!fe(t))return;const n=rr(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const p8e=(t,e)=>{const n=pE(t.id());if(!fe(n))return 0;const[r,i]=Dt(e,0,[ut.NAME]),s=rr(r);switch(s){case"seek":{const[o]=Dt(e,i,[ut.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=Dt(e,i,[ut.NAME]);t.set(o,JH(n,s));break}case"text":{const[o,a]=Dt(e,i,[ut.NAME,ut.NAME]),c=JH(n,o);if(nn(c)&&dn(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(l);t.set(a,h),n.cursor+=c}break}}return 0},$E=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",GM=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!GM(t[n],e[n]))return!1;return!0}if($E(t)&&$E(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!GM(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},BR=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if($E(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},m8e=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",ZH=t=>t>="0"&&t<="9"||t==="-",g8e=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var Pt;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(Pt||(Pt={}));const QH={"(":Pt.TOK_LPAREN,")":Pt.TOK_RPAREN,"*":Pt.TOK_STAR,",":Pt.TOK_COMMA,".":Pt.TOK_DOT,":":Pt.TOK_COLON,"@":Pt.TOK_CURRENT,$:Pt.TOK_ROOT,"]":Pt.TOK_RBRACKET,"{":Pt.TOK_LBRACE,"}":Pt.TOK_RBRACE},_8e={"!":!0,"<":!0,"=":!0,">":!0},v8e={"	":!0,"\n":!0,"\r":!0," ":!0};class y8e{constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(m8e(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:Pt.TOK_UNQUOTEDIDENTIFIER,value:i});else if(QH[e[this._current]]!==void 0)n.push({start:this._current,type:QH[e[this._current]],value:e[this._current]}),this._current+=1;else if(ZH(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:Pt.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:Pt.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:Pt.TOK_LITERAL,value:o})}else if(_8e[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(v8e[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:Pt.TOK_AND,value:"&&"})):n.push({start:r,type:Pt.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:Pt.TOK_OR,value:"||"})):n.push({start:r,type:Pt.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&g8e(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;ZH(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:Pt.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:Pt.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:Pt.TOK_FLATTEN,value:"[]"}):{start:n,type:Pt.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:Pt.TOK_NE,value:"!="}):{start:n,type:Pt.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:Pt.TOK_LTE,value:"<="}):{start:n,type:Pt.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:Pt.TOK_GTE,value:">="}):{start:n,type:Pt.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:Pt.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const r=["true","false","null"],i="-0123456789";if(e==="")return!1;if('[{"'.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const b8e=new y8e,Al={[Pt.TOK_EOF]:0,[Pt.TOK_UNQUOTEDIDENTIFIER]:0,[Pt.TOK_QUOTEDIDENTIFIER]:0,[Pt.TOK_RBRACKET]:0,[Pt.TOK_RPAREN]:0,[Pt.TOK_COMMA]:0,[Pt.TOK_RBRACE]:0,[Pt.TOK_NUMBER]:0,[Pt.TOK_CURRENT]:0,[Pt.TOK_EXPREF]:0,[Pt.TOK_ROOT]:0,[Pt.TOK_PIPE]:1,[Pt.TOK_OR]:2,[Pt.TOK_AND]:3,[Pt.TOK_EQ]:5,[Pt.TOK_GT]:5,[Pt.TOK_LT]:5,[Pt.TOK_GTE]:5,[Pt.TOK_LTE]:5,[Pt.TOK_NE]:5,[Pt.TOK_FLATTEN]:9,[Pt.TOK_STAR]:20,[Pt.TOK_FILTER]:21,[Pt.TOK_DOT]:40,[Pt.TOK_NOT]:45,[Pt.TOK_LBRACE]:50,[Pt.TOK_LBRACKET]:55,[Pt.TOK_LPAREN]:60};class S8e{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Pt.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...b8e.tokenize(e),{type:Pt.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<Al[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case Pt.TOK_LITERAL:return{type:"Literal",value:e.value};case Pt.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case Pt.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===Pt.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Pt.TOK_NOT:return r=this.expression(Al.Not),{type:"NotExpression",children:[r]};case Pt.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Pt.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Al.Star),{type:"ValueProjection",children:[n,r]};case Pt.TOK_FILTER:return this.led(e.type,{type:"Identity"});case Pt.TOK_LBRACE:return this.parseMultiselectHash();case Pt.TOK_FLATTEN:return n={type:Pt.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(Al.Flatten),{type:"Projection",children:[n,r]};case Pt.TOK_LBRACKET:return this.lookahead(0)===Pt.TOK_NUMBER||this.lookahead(0)===Pt.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Pt.TOK_STAR&&this.lookahead(1)===Pt.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(Al.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Pt.TOK_CURRENT:return{type:Pt.TOK_CURRENT};case Pt.TOK_ROOT:return{type:Pt.TOK_ROOT};case Pt.TOK_EXPREF:return i=this.expression(Al.Expref),{type:"ExpressionReference",children:[i]};case Pt.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Pt.TOK_RPAREN;)this.lookahead(0)===Pt.TOK_CURRENT?(i={type:Pt.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Pt.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case Pt.TOK_DOT:const i=Al.Dot;return this.lookahead(0)!==Pt.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Pt.TOK_PIPE:return r=this.expression(Al.Pipe),{type:Pt.TOK_PIPE,children:[n,r]};case Pt.TOK_OR:return r=this.expression(Al.Or),{type:"OrExpression",children:[n,r]};case Pt.TOK_AND:return r=this.expression(Al.And),{type:"AndExpression",children:[n,r]};case Pt.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Pt.TOK_RPAREN;)this.lookahead(0)===Pt.TOK_CURRENT?(a={type:Pt.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Pt.TOK_COMMA&&this.match(Pt.TOK_COMMA),o.push(a);return this.match(Pt.TOK_RPAREN),{name:s,type:"Function",children:o};case Pt.TOK_FILTER:const l=this.expression(0);return this.match(Pt.TOK_RBRACKET),r=this.lookahead(0)===Pt.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Al.Filter),{type:"FilterProjection",children:[n,r,l]};case Pt.TOK_FLATTEN:const u={type:Pt.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(Al.Flatten);return{type:"Projection",children:[u,h]};case Pt.TOK_EQ:case Pt.TOK_NE:case Pt.TOK_GT:case Pt.TOK_GTE:case Pt.TOK_LT:case Pt.TOK_LTE:return this.parseComparator(n,e);case Pt.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===Pt.TOK_NUMBER||f.type===Pt.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Pt.TOK_STAR),this.match(Pt.TOK_RBRACKET),r=this.parseProjectionRHS(Al.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Pt.TOK_COLON||this.lookahead(1)===Pt.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Pt.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(Al.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Pt.TOK_RBRACKET&&n<3;){if(r===Pt.TOK_COLON)n+=1,this.advance();else if(r===Pt.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Pt.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(Al[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([Pt.TOK_UNQUOTEDIDENTIFIER,Pt.TOK_QUOTEDIDENTIFIER,Pt.TOK_STAR].includes(n))return this.expression(e);if(n===Pt.TOK_LBRACKET)return this.match(Pt.TOK_LBRACKET),this.parseMultiselectList();if(n===Pt.TOK_LBRACE)return this.match(Pt.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(Al[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Pt.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===Pt.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===Pt.TOK_DOT)return this.match(Pt.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==Pt.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===Pt.TOK_COMMA&&(this.match(Pt.TOK_COMMA),this.lookahead(0)===Pt.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Pt.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[Pt.TOK_UNQUOTEDIDENTIFIER,Pt.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Pt.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Pt.TOK_COMMA)this.match(Pt.TOK_COMMA);else if(this.lookahead(0)===Pt.TOK_RBRACE){this.match(Pt.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const E8e=new S8e;var gn;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(gn||(gn={}));class x8e{constructor(e){this.TYPE_NAME_TABLE={[gn.TYPE_NUMBER]:"number",[gn.TYPE_ANY]:"any",[gn.TYPE_STRING]:"string",[gn.TYPE_ARRAY]:"array",[gn.TYPE_OBJECT]:"object",[gn.TYPE_BOOLEAN]:"boolean",[gn.TYPE_EXPREF]:"expression",[gn.TYPE_NULL]:"null",[gn.TYPE_ARRAY_NUMBER]:"Array<number>",[gn.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>$E(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===gn.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[gn.TYPE_NUMBER,gn.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===gn.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[gn.TYPE_NUMBER,gn.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==gn.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===gn.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![gn.TYPE_NUMBER,gn.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===gn.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===gn.TYPE_NUMBER?n:r===gn.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===gn.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case gn.TYPE_NUMBER:return"number";case gn.TYPE_STRING:return"string";case gn.TYPE_ARRAY:return"array";case gn.TYPE_OBJECT:return"object";case gn.TYPE_BOOLEAN:return"boolean";case gn.TYPE_EXPREF:return"expref";case gn.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[gn.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[gn.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[gn.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[gn.TYPE_STRING,gn.TYPE_ARRAY]},{types:[gn.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[gn.TYPE_STRING]},{types:[gn.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[gn.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[gn.TYPE_STRING]},{types:[gn.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[gn.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[gn.TYPE_STRING,gn.TYPE_ARRAY,gn.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[gn.TYPE_EXPREF]},{types:[gn.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[gn.TYPE_ARRAY_NUMBER,gn.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[gn.TYPE_ARRAY]},{types:[gn.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[gn.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[gn.TYPE_ARRAY_NUMBER,gn.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[gn.TYPE_ARRAY]},{types:[gn.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[gn.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[gn.TYPE_STRING,gn.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[gn.TYPE_ARRAY_STRING,gn.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[gn.TYPE_ARRAY]},{types:[gn.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[gn.TYPE_STRING]},{types:[gn.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[gn.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[gn.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[gn.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[gn.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[gn.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[gn.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var g;return(g=!m.optional)!==null&&g!==void 0?g:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let m=0;m<r.length;m+=1){p=!1,f=r[m].types,d=this.getTypeName(n[m]);let g;for(g=0;g<f.length;g+=1)if(d!==void 0&&this.typeMatches(d,f[g],n[m])){p=!0;break}if(!p&&d!==void 0){const _=f.map(y=>this.TYPE_NAME_TABLE[y]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${_}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(e,n,r){if(n===gn.TYPE_ANY)return!0;if(n===gn.TYPE_ARRAY_STRING||n===gn.TYPE_ARRAY_NUMBER||n===gn.TYPE_ARRAY){if(n===gn.TYPE_ARRAY)return e===gn.TYPE_ARRAY;if(e===gn.TYPE_ARRAY){let i;n===gn.TYPE_ARRAY_NUMBER?i=gn.TYPE_NUMBER:n===gn.TYPE_ARRAY_STRING&&(i=gn.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return gn.TYPE_STRING;case"[object Number]":return gn.TYPE_NUMBER;case"[object Array]":return gn.TYPE_ARRAY;case"[object Boolean]":return gn.TYPE_BOOLEAN;case"[object Null]":return gn.TYPE_NULL;case"[object Object]":return e.jmespathType===Pt.TOK_EXPREF?gn.TYPE_EXPREF:gn.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class w8e{constructor(){this._rootValue=null,this.runtime=new x8e(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,h,f,d;switch(e.type){case"Field":return n===null?null:$E(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),f=1;f<e.children.length;f+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...e.children],g=this.computeSliceParams(n.length,m),[_,y,v]=g;if(s=[],v>0)for(f=_;f<y;f+=v)s.push(n[f]);else for(f=_;f>y;f+=v)s.push(n[f]);return s;case"Projection":if(d=this.visit(e.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(e.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(e.children[0],n),!$E(d))return null;h=[];const E=Object.values(d);for(f=0;f<E.length;f+=1)i=this.visit(e.children[1],E[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(e.children[0],n),!Array.isArray(d))return null;const x=[],A=[];for(f=0;f<d.length;f+=1)r=this.visit(e.children[2],d[f]),BR(r)||x.push(d[f]);for(let M=0;M<x.length;M+=1)i=this.visit(e.children[1],x[M]),i!==null&&A.push(i);return A;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case Pt.TOK_EQ:s=GM(o,a);break;case Pt.TOK_NE:s=!GM(o,a);break;case Pt.TOK_GT:s=o>a;break;case Pt.TOK_GTE:s=o>=a;break;case Pt.TOK_LT:s=o<a;break;case Pt.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case Pt.TOK_FLATTEN:const T=this.visit(e.children[0],n);if(!Array.isArray(T))return null;let k=[];for(f=0;f<T.length;f+=1)i=T[f],Array.isArray(i)?k=[...k,...i]:k.push(i);return k;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<e.children.length;f+=1)h.push(this.visit(e.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let L;for(f=0;f<e.children.length;f+=1)L=e.children[f],h[L.name]=this.visit(L.value,n);return h;case"OrExpression":return r=this.visit(e.children[0],n),BR(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),BR(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),BR(o);case"Literal":return e.value;case Pt.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case Pt.TOK_CURRENT:return n;case Pt.TOK_ROOT:return this._rootValue;case"Function":const I=[];for(let M=0;M<e.children.length;M+=1)I.push(this.visit(e.children[M],n));return this.runtime.callFunction(e.name,I);case"ExpressionReference":const F=e.children[0];return F.jmespathType=Pt.TOK_EXPREF,F;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const T8e=new w8e;gn.TYPE_ANY;gn.TYPE_ARRAY;gn.TYPE_ARRAY_NUMBER;gn.TYPE_ARRAY_STRING;gn.TYPE_BOOLEAN;gn.TYPE_EXPREF;gn.TYPE_NULL;gn.TYPE_NUMBER;gn.TYPE_OBJECT;gn.TYPE_STRING;function A8e(t,e){const n=E8e.parse(e);return T8e.search(n,t)}const C8e=(t,e)=>{const n=pE(t.id());if(!fe(n))return 0;const[r,i]=Dt(e,0,[ut.NAME,ut.NAME]),s=A8e(n.json,r);return t.set(i,s),0},R8e=(t,e)=>{const n=pE(t.id());if(!fe(n))return 0;const[r,i]=Dt(e,0,[ut.NAME]);switch(rr(r)){case"seek":{const[o]=Dt(e,i,[ut.NUMBER]);n.cursor=Ci(o,0,n.lines.length-1);break}case"line":n.cursor=Ci(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[h,f]=Dt(e,u,[ut.NAME]);t.set(h,c[l]??0),++l,u=f}break}}return 0},k8e=Mv({get(t,e){const n=EOe(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const r=pE(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=pE(t.id());if(e==="filename")return[!0,r.filename];break}case"binary":{const r=pE(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("endgame",()=>0).command("shortsend",(t,e)=>{const n=HE(e);return GE(t,he.element,n),0}).command("send",(t,e)=>{const n=HE(e,!0);return GE(t,he.element,n),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(no).join(" ");return OL(qe,"","$GREEN",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=t.template(no(n).split(" "));return OL(qe,"",`!${t.template(r)};${i}`),0}).command("readline",R8e).command("readjson",C8e).command("readbin",p8e).command("withboard",(t,e)=>{const[n]=Dt(e,0,[ut.STRING]),r=Cs(n);return fe(r)&&(he.board=r,he.element={x:au(0,bn-1),y:au(0,Tr-1)}),0}).command("withobject",(t,e)=>{const[n]=Dt(e,0,[ut.STRING]),r=mh(he.board,n);return fe(r)&&(he.element=r,he.elementid=r.id??"",he.elementisplayer=Nl(he.elementid),he.elementfocus=he.elementisplayer?he.elementid:he.element?.player??Cm()),0}).command("userinput",(t,e)=>{const[n]=Dt(e,0,[ut.NAME]),r=Cm();switch(rr(n)){case"up":nm(qe,r,Ct.MOVE_UP,!1);break;case"down":nm(qe,r,Ct.MOVE_DOWN,!1);break;case"left":nm(qe,r,Ct.MOVE_RIGHT,!1);break;case"right":nm(qe,r,Ct.MOVE_RIGHT,!1);break;case"shootup":nm(qe,r,Ct.MOVE_UP,!0);break;case"shootdown":nm(qe,r,Ct.MOVE_DOWN,!0);break;case"shootleft":nm(qe,r,Ct.MOVE_RIGHT,!0);break;case"shootright":nm(qe,r,Ct.MOVE_RIGHT,!0);break;case"ok":nm(qe,r,Ct.OK_BUTTON,!1);break;case"cancel":nm(qe,r,Ct.CANCEL_BUTTON,!1);break}return 0});function e$(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=Dt(i,a,[ut.ANY]);Kn(c)&&!sd(c)&&!EA(c)&&!HM(c)&&!uc(c)?o.push(...c):o.push(c),a=l}switch(rr(r)){case"get":case"post:json":wEe(qe,he.elementfocus,t,e,n,r,o);break}return 0}const M8e=Mv().command("fetch",(t,e)=>{const[n,r,i="get",s]=Dt(e,0,[ut.NAME,ut.NAME,ut.MAYBE_STRING]);return e$(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=Dt(e,0,[ut.ANY,ut.NAME,ut.NAME,ut.MAYBE_STRING]);return e$(n,r,i,s,e,o),0}),O8e=Mv({set(t,e,n){return $6e(t,e,n),[!1,void 0]},aftertick(t){const e=G6e(he.elementid),[n]=e;if(e.length===1&&dn(n)){if(fe(he.element))if(n.trim().length===0){const r=h2(he.elementid);r.sidebar=[]}else he.element.tickertext=n,he.element.tickertime=he.timestamp,F8(he.board?.id,he.element,n)}else if(e.length>1)if(he.elementisplayer){const r=h2(he.elementid);r.sidebar=WH(e)}else{const r=he.elementfocus;t.scrolllock(r);const i=h2(r);i.scrollname=he.element?.name??he.element?.kinddata?.name??"",i.scroll=WH(e)}}}).command("endgame",t=>(t.set("health",0),0)).command("shortsend",(t,e)=>{const n=HE(e);return GE(t,he.element,n),0}).command("send",(t,e)=>{const n=HE(e,!0);return GE(t,he.element,n),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(no).join("");return W6e(he.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=t.template(no(n).split(" ")),s=t.template(r);return q6e(he.elementid,t.id(),i,s.split(" "),t.get,t.set),0}).command("help",()=>(Y5(qe,he.elementfocus),0));function I8e(t,e,n,r,i){if(!fe(he.book))return;const s=Cs(t);if(!fe(s))return;const o=z8(),a=i==="all"||i==="object",c=i==="all"||i==="terrain";lc(s),lc(o);const l=-Math.tan(e*.5),u=Math.sin(e),h=Math.round(12.5*l),f=Math.round(12.5*u),d=new Array(Tr).fill(0);Ij(h,0,-h,Tr-1).forEach(y=>{y.x<0?d[y.y]=Math.min(d[y.y],y.x):d[y.y]=Math.max(d[y.y],y.x)});const m=new Array(bn).fill(0);Ij(0,f,bn-1,-f).forEach(y=>{y.y<0?m[y.x]=Math.min(m[y.x],y.y):m[y.x]=Math.max(m[y.x],y.y)});const _=[d,m,d];for(let y=0;y<_.length;++y){const v=_[y];if(y!==1){for(let E=0;E<Tr;++E){const x=v[E],A=E*bn;for(let T=0;T<bn;T++){const k=(T+x+bn)%bn;c&&(o.terrain[k+A]=s.terrain[T+A])}}if(a){const E=Object.keys(s.objects);for(let x=0;x<E.length;++x){const A=E[x],{x:T,y:k}=s.objects[A];if(fe(T)&&fe(k)){const L=v[k];s.objects[A].x=(T+L+bn)%bn,s.objects[A].lx=s.objects[A].x}}}}if(y===1){for(let E=0;E<bn;++E){const x=v[E];for(let A=0;A<Tr;++A){const T=(A+x+Tr)%Tr;c&&(o.terrain[E+T*bn]=s.terrain[E+A*bn])}}if(a){const E=Object.keys(s.objects);for(let x=0;x<E.length;++x){const A=E[x],{x:T,y:k}=s.objects[A];if(fe(T)&&fe(k)){const L=v[T];s.objects[A].y=(k+L+Tr)%Tr,s.objects[A].ly=s.objects[A].y}}}}c&&(s.terrain=[...o.terrain]),lc(o),lc(s)}}var d2,t$;function N8e(){if(t$)return d2;t$=1;function t(e,n){let r=0,i=0,s=0;for(;s<e.length;s++)r+=e[s];for(s=0,n*=r;n&&s<e.length;){if(i+=e[s],n<=i)return s;s++}return 0}return d2=t,d2}var p2,n$;function Hte(){if(n$)return p2;n$=1;const t=N8e(),e=function(){};return e.prototype.FMX=0,e.prototype.FMY=0,e.prototype.FMXxFMY=0,e.prototype.T=0,e.prototype.N=0,e.prototype.initiliazedField=!1,e.prototype.generationComplete=!1,e.prototype.wave=null,e.prototype.compatible=null,e.prototype.weightLogWeights=null,e.prototype.sumOfWeights=0,e.prototype.sumOfWeightLogWeights=0,e.prototype.startingEntropy=0,e.prototype.sumsOfOnes=null,e.prototype.sumsOfWeights=null,e.prototype.sumsOfWeightLogWeights=null,e.prototype.entropies=null,e.prototype.propagator=null,e.prototype.observed=null,e.prototype.distribution=null,e.prototype.stack=null,e.prototype.stackSize=0,e.prototype.DX=[-1,0,1,0],e.prototype.DY=[0,1,0,-1],e.prototype.opposite=[2,3,0,1],e.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let n=0;n<this.FMXxFMY;n++){this.wave[n]=new Array(this.T),this.compatible[n]=new Array(this.T);for(let r=0;r<this.T;r++)this.compatible[n][r]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let n=0;n<this.T;n++)this.weightLogWeights[n]=this.weights[n]*Math.log(this.weights[n]),this.sumOfWeights+=this.weights[n],this.sumOfWeightLogWeights+=this.weightLogWeights[n];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},e.prototype.observe=function(n){let r=1e3,i=-1;for(let a=0;a<this.FMXxFMY;a++){if(this.onBoundary(a%this.FMX,a/this.FMX|0))continue;const c=this.sumsOfOnes[a];if(c===0)return!1;const l=this.entropies[a];if(c>1&&l<=r){const u=1e-6*n();l+u<r&&(r=l+u,i=a)}}if(i===-1){this.observed=new Array(this.FMXxFMY);for(let a=0;a<this.FMXxFMY;a++)for(let c=0;c<this.T;c++)if(this.wave[a][c]){this.observed[a]=c;break}return!0}for(let a=0;a<this.T;a++)this.distribution[a]=this.wave[i][a]?this.weights[a]:0;const s=t(this.distribution,n()),o=this.wave[i];for(let a=0;a<this.T;a++)o[a]!==(a===s)&&this.ban(i,a);return null},e.prototype.propagate=function(){for(;this.stackSize>0;){const n=this.stack[this.stackSize-1];this.stackSize--;const r=n[0],i=r%this.FMX,s=r/this.FMX|0;for(let o=0;o<4;o++){const a=this.DX[o],c=this.DY[o];let l=i+a,u=s+c;if(this.onBoundary(l,u))continue;l<0?l+=this.FMX:l>=this.FMX&&(l-=this.FMX),u<0?u+=this.FMY:u>=this.FMY&&(u-=this.FMY);const h=l+u*this.FMX,f=this.propagator[o][n[1]],d=this.compatible[h];for(let p=0;p<f.length;p++){const m=f[p],g=d[m];g[o]--,g[o]==0&&this.ban(h,m)}}}},e.prototype.singleIteration=function(n){const r=this.observe(n);return r!==null?(this.generationComplete=r,!!r):(this.propagate(),null)},e.prototype.iterate=function(n,r){this.wave||this.initialize(),this.initiliazedField||this.clear(),n=n||0,r=r||Math.random;for(let i=0;i<n||n===0;i++){const s=this.singleIteration(r);if(s!==null)return!!s}return!0},e.prototype.generate=function(n){for(n=n||Math.random,this.wave||this.initialize(),this.clear();;){const r=this.singleIteration(n);if(r!==null)return!!r}},e.prototype.isGenerationComplete=function(){return this.generationComplete},e.prototype.ban=function(n,r){const i=this.compatible[n][r];for(let o=0;o<4;o++)i[o]=0;this.wave[n][r]=!1,this.stack[this.stackSize]=[n,r],this.stackSize++,this.sumsOfOnes[n]-=1,this.sumsOfWeights[n]-=this.weights[r],this.sumsOfWeightLogWeights[n]-=this.weightLogWeights[r];const s=this.sumsOfWeights[n];this.entropies[n]=Math.log(s)-this.sumsOfWeightLogWeights[n]/s},e.prototype.clear=function(){for(let n=0;n<this.FMXxFMY;n++){for(let r=0;r<this.T;r++){this.wave[n][r]=!0;for(let i=0;i<4;i++)this.compatible[n][r][i]=this.propagator[this.opposite[i]][r].length}this.sumsOfOnes[n]=this.weights.length,this.sumsOfWeights[n]=this.sumOfWeights,this.sumsOfWeightLogWeights[n]=this.sumOfWeightLogWeights,this.entropies[n]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1},p2=e,p2}var m2,r$;function P8e(){if(r$)return m2;r$=1;const t=Hte(),e=function(r,i,s,o,a,c,l,u,h,f){f=f||0,this.N=o,this.FMX=a,this.FMY=c,this.FMXxFMY=a*c,this.periodic=u;const d=i,p=new Array(d);for(let F=0;F<d;F++)p[F]=new Array(s);this.colors=[];const m={};for(let F=0;F<s;F++)for(let M=0;M<i;M++){const D=(F*i+M)*4,O=[r[D],r[D+1],r[D+2],r[D+3]],z=O.join("-");m.hasOwnProperty(z)||(m[z]=this.colors.length,this.colors.push(O)),p[M][F]=m[z]}const g=this.colors.length,_=Math.pow(g,o*o),y=function(M){let D=new Array(o*o);for(let O=0;O<o;O++)for(let z=0;z<o;z++)D[z+O*o]=M(z,O);return D},v=function(M,D){return y(function(O,z){return p[(M+O)%i][(D+z)%s]})},E=function(M){return y(function(D,O){return M[o-1-O+D*o]})},x=function(M){return y(function(D,O){return M[o-1-D+O*o]})},A=function(M){let D=0,O=1;for(let z=0;z<M.length;z++)D+=M[M.length-1-z]*O,O*=g;return D},T=function(M){let D=M,O=_;const z=new Array(o*o);for(let q=0;q<z.length;q++){O/=g;let G=0;for(;D>=O;)D-=O,G++;z[q]=G}return z},k={},L=[];for(let F=0;F<(l?s:s-o+1);F++)for(let M=0;M<(l?i:i-o+1);M++){const D=new Array(8);D[0]=v(M,F),D[1]=x(D[0]),D[2]=E(D[0]),D[3]=x(D[2]),D[4]=E(D[2]),D[5]=x(D[4]),D[6]=E(D[4]),D[7]=x(D[6]);for(let O=0;O<h;O++){const z=A(D[O]);k[z]?k[z]++:(L.push(z),k[z]=1)}}this.T=L.length,this.ground=(f+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let F=0;F<this.T;F++){const M=parseInt(L[F],10);this.patterns[F]=T(M),this.weights[F]=k[M]}const I=function(M,D,O,z){const q=O<0?0:O,G=O<0?O+o:o,K=z<0?0:z,te=z<0?z+o:o;for(let re=K;re<te;re++)for(let H=q;H<G;H++)if(M[H+o*re]!=D[H-O+o*(re-z)])return!1;return!0};this.propagator=new Array(4);for(let F=0;F<4;F++){this.propagator[F]=new Array(this.T);for(let M=0;M<this.T;M++){const D=[];for(let O=0;O<this.T;O++)I(this.patterns[M],this.patterns[O],this.DX[F],this.DY[F])&&D.push(O);this.propagator[F][M]=D}}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(n,r){return!this.periodic&&(n+this.N>this.FMX||r+this.N>this.FMY||n<0||r<0)},e.prototype.clear=function(){if(t.prototype.clear.call(this),this.ground!==0){for(let n=0;n<this.FMX;n++){for(let r=0;r<this.T;r++)r!==this.ground&&this.ban(n+(this.FMY-1)*this.FMX,r);for(let r=0;r<this.FMY-1;r++)this.ban(n+r*this.FMX,this.ground)}this.propagate()}},e.prototype.graphics=function(n){return n=n||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(n):this.graphicsIncomplete(n),n},e.prototype.graphicsComplete=function(n){for(let r=0;r<this.FMY;r++){const i=r<this.FMY-this.N+1?0:this.N-1;for(let s=0;s<this.FMX;s++){const o=s<this.FMX-this.N+1?0:this.N-1,a=(r*this.FMX+s)*4,c=this.colors[this.patterns[this.observed[s-o+(r-i)*this.FMX]][o+i*this.N]];n[a]=c[0],n[a+1]=c[1],n[a+2]=c[2],n[a+3]=c[3]}}},e.prototype.graphicsIncomplete=function(n){for(let r=0;r<this.FMXxFMY;r++){const i=r%this.FMX,s=r/this.FMX|0;let o=0,a=0,c=0,l=0,u=0;for(let f=0;f<this.N;f++)for(let d=0;d<this.N;d++){let p=i-d;p<0&&(p+=this.FMX);let m=s-f;if(m<0&&(m+=this.FMY),this.onBoundary(p,m))continue;const g=p+m*this.FMX;for(let _=0;_<this.T;_++)if(this.wave[g][_]){o++;const y=this.colors[this.patterns[_][d+f*this.N]];a+=y[0],c+=y[1],l+=y[2],u+=y[3]}}const h=r*4;n[h]=a/o,n[h+1]=c/o,n[h+2]=l/o,n[h+3]=u/o}},m2=e,m2}var g2,i$;function D8e(){if(i$)return g2;i$=1;const t=Hte(),e=function(r,i,s,o,a){const c=r.tilesize||16;this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=a,this.tilesize=c;const l=!!r.unique;let u=null;i&&r.subsets&&r.subsets[i]&&(u=r.subsets[i]);const h=function(A){const T=new Array(c*c);for(let k=0;k<c;k++)for(let L=0;L<c;L++)T[L+k*c]=A(L,k);return T},f=function(A){return h(function(T,k){return A[c-1-k+T*c]})},d=function(A){return h(function(T,k){return A[c-1-T+k*c]})};this.tiles=[];const p=[],m=[],g={};let _,y,v;for(let x=0;x<r.tiles.length;x++){const A=r.tiles[x];if(u!==null&&u.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":v=4,_=function(k){return(k+1)%4},y=function(k){return k%2===0?k+1:k-1};break;case"T":v=4,_=function(k){return(k+1)%4},y=function(k){return k%2===0?k:4-k};break;case"I":v=2,_=function(k){return 1-k},y=function(k){return k};break;case"\\":v=2,_=function(k){return 1-k},y=function(k){return 1-k};break;case"F":v=8,_=function(k){return k<4?(k+1)%4:4+(k-1)%4},y=function(k){return k<4?k+4:k-4};break;default:v=1,_=function(k){return k},y=function(k){return k};break}this.T=m.length,g[A.name]=this.T;for(let k=0;k<v;k++)m.push([this.T+k,this.T+_(k),this.T+_(_(k)),this.T+_(_(_(k))),this.T+y(k),this.T+y(_(k)),this.T+y(_(_(k))),this.T+y(_(_(_(k))))]);let T;if(l)for(let k=0;k<v;k++)T=A.bitmap[k],this.tiles.push(h(function(L,I){return[T[(c*I+L)*4],T[(c*I+L)*4+1],T[(c*I+L)*4+2],T[(c*I+L)*4+3]]}));else{T=A.bitmap,this.tiles.push(h(function(k,L){return[T[(c*L+k)*4],T[(c*L+k)*4+1],T[(c*L+k)*4+2],T[(c*L+k)*4+3]]}));for(let k=1;k<v;k++)this.tiles.push(k<4?f(this.tiles[this.T+k-1]):d(this.tiles[this.T+k-4]))}for(let k=0;k<v;k++)p.push(A.weight||1)}this.T=m.length,this.weights=p,this.propagator=new Array(4);const E=new Array(4);for(let x=0;x<4;x++){this.propagator[x]=new Array(this.T),E[x]=new Array(this.T);for(let A=0;A<this.T;A++){E[x][A]=new Array(this.T);for(let T=0;T<this.T;T++)E[x][A][T]=!1}}for(let x=0;x<r.neighbors.length;x++){const A=r.neighbors[x],T=A.left.split(" ").filter(function(D){return D.length}),k=A.right.split(" ").filter(function(D){return D.length});if(u!==null&&(u.indexOf(T[0])===-1||u.indexOf(k[0])===-1))continue;const L=m[g[T[0]]][T.length==1?0:parseInt(T[1],10)],I=m[L][1],F=m[g[k[0]]][k.length==1?0:parseInt(k[1],10)],M=m[F][1];E[0][F][L]=!0,E[0][m[F][6]][m[L][6]]=!0,E[0][m[L][4]][m[F][4]]=!0,E[0][m[L][2]][m[F][2]]=!0,E[1][M][I]=!0,E[1][m[I][6]][m[M][6]]=!0,E[1][m[M][4]][m[I][4]]=!0,E[1][m[I][2]][m[M][2]]=!0}for(let x=0;x<this.T;x++)for(let A=0;A<this.T;A++)E[2][x][A]=E[0][A][x],E[3][x][A]=E[1][A][x];for(let x=0;x<4;x++)for(let A=0;A<this.T;A++){const T=[],k=E[x][A];for(let L=0;L<this.T;L++)k[L]&&T.push(L);this.propagator[x][A]=T}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(n,r){return!this.periodic&&(n<0||r<0||n>=this.FMX||r>=this.FMY)},e.prototype.graphics=function(n,r){return n=n||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(n):this.graphicsIncomplete(n,r),n},e.prototype.graphicsComplete=function(n){for(let r=0;r<this.FMX;r++)for(let i=0;i<this.FMY;i++){const s=this.tiles[this.observed[r+i*this.FMX]];for(let o=0;o<this.tilesize;o++)for(let a=0;a<this.tilesize;a++){const c=(r*this.tilesize+a+(i*this.tilesize+o)*this.FMX*this.tilesize)*4,l=s[a+o*this.tilesize];n[c]=l[0],n[c+1]=l[1],n[c+2]=l[2],n[c+3]=l[3]}}},e.prototype.graphicsIncomplete=function(n,r){(!r||r.length!==4)&&(r=!1);for(let i=0;i<this.FMX;i++)for(let s=0;s<this.FMY;s++){const o=this.wave[i+s*this.FMX];let a=0,c=0;for(let u=0;u<this.T;u++)o[u]&&(a++,c+=this.weights[u]);const l=1/c;for(let u=0;u<this.tilesize;u++)for(let h=0;h<this.tilesize;h++){const f=(i*this.tilesize+h+(s*this.tilesize+u)*this.FMX*this.tilesize)*4;if(r&&a===this.T)n[f]=r[0],n[f+1]=r[1],n[f+2]=r[2],n[f+3]=r[3];else{let d=0,p=0,m=0,g=0;for(let _=0;_<this.T;_++)if(o[_]){const y=this.tiles[_][h+u*this.tilesize],v=this.weights[_]*l;d+=y[0]*v,p+=y[1]*v,m+=y[2]*v,g+=y[3]*v}n[f]=d,n[f+1]=p,n[f+2]=m,n[f+3]=g}}}},g2=e,g2}var _2,s$;function L8e(){return s$||(s$=1,_2={OverlappingModel:P8e(),SimpleTiledModel:D8e()}),_2}var U8e=L8e();const B8e=_u(U8e);function F8e(t,e,n,r,i,s,o){if(!fe(he.book))return!1;const a=he.book,c=Cs(t);if(!fe(c))return!1;const l=Cs(e);if(!fe(l))return!1;lc(c),lc(l);let u=0;const h=new Map,f=new Map;let d=0;const p=32,m=new Uint8Array(zm*4);for(let E=0;E<Tr;++E)for(let x=0;x<bn;++x){const A=fs(l,{x,y:E}),T=A?.char??0,k=A?.color??p,L=A?.bg??p;let I=0;const F=ap(A),M=rr(F?.name??"empty"),D=h.get(M);nn(D)?I=D:(I=u,h.set(M,u),f.set(u,M),u++),m[d++]=T,m[d++]=k,m[d++]=L,m[d++]=I}const g=s.x-i.x+1,_=s.y-i.y+1,y=new B8e.OverlappingModel(m,bn,Tr,n,g,_,!0,!1,r);if(!y.generate())return!1;d=0;const v=y.graphics();for(let E=i.y;E<=s.y;++E)for(let x=i.x;x<=s.x;++x){const A={x,y:E},T=v[d++],k=v[d++],L=v[d++],I=v[d++];switch(o){case"all":{const O=fs(c,{x,y:E});As(O)&&td(c,O,a.timestamp),Ol(c,{x,y:E});break}case"object":{const O=fs(c,{x,y:E});As(O)&&td(c,O,a.timestamp);break}case"terrain":Ol(c,{x,y:E});break}let F=f.get(I)??"";const M=ap({kind:F});switch(o){case"all":break;case"object":As(M)||(F="");break;case"terrain":As(M)&&(F="");break;default:if(ri(M,"group")!==o&&(F=""),F){const O=fs(c,{x,y:E});As(O)&&td(c,O,a.timestamp),Ol(c,{x,y:E})}break}const D=F?Qf(c,[F],A):void 0;if(!(!fe(D)||!fe(M))&&(F1(D,M),T>0&&(D.char=T),k<p&&(D.color=k),L<p&&(D.bg=L),As(D))){const O=Gf(fx(l,F));fe(O)&&(Ol(c,{...Ev(l,O.x??0,O.y??0),x,y:E}),F1(D,O))}}return!0}function $te(t){return`zss_snapshot_${t}`}const Gte={x:0,y:0},Wte={x:bn-1,y:Tr-1},qte="all";function j8e(t){const e=Cs(t);if(!fe(e))return;const n=gm(),r=$te(e.id);for(let s=0;s<n.length;++s)IZ(n[s],r);const i=Cs(r);if(fe(i))return EI(t,i.id,Gte,Wte,qte),i}function z8e(t){const e=Cs(t);if(!fe(e))return;const n=$te(e.id),r=Cs(n);if(fe(r))return EI(r.id,t,Gte,Wte,qte),r}function V8e(t,e,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return H8e(t,e,i,s)}if(!fe(he.book))return;const o=Cs(t);if(!fe(o))return;const a=z8();lc(o);for(let c=n.y;c<=r.y;++c)for(let l=n.x;l<=r.x;++l){let u=!1,h=!1;switch(s){case"all":u=!0,h=!0;break;case"object":u=!0;break;case"terrain":h=!0;break}const f=(l+e.x+bn)%bn,d=(c+e.y+Tr)%Tr;if(u){const p=fs(o,{x:l,y:c});As(p)&&fe(p?.x)&&fe(p?.y)&&(p.x=f,p.lx=f,p.y=d,p.ly=d)}h&&(a.terrain[f+d*bn]=o.terrain[l+c*bn])}(s==="all"||s==="terrain")&&(o.terrain=[...a.terrain]),lc(o)}function H8e(t,e,n,r){if(!fe(he.book))return;const i=he.book,s=Cs(t);if(!fe(s))return;lc(s);const{terrainelements:o,objectelements:a}=Jte(s,n,r);if(o.length===0&&a.length===0)return;e.x<0&&(o.sort((d,p)=>{const m=d.x??0,g=p.x??0;return m-g}),a.sort((d,p)=>{const m=d.x??0,g=p.x??0;return m-g})),e.x>0&&(o.sort((d,p)=>{const m=d.x??0;return(p.x??0)-m}),a.sort((d,p)=>{const m=d.x??0;return(p.x??0)-m})),e.y<0&&(o.sort((d,p)=>{const m=d.y??0,g=p.y??0;return m-g}),a.sort((d,p)=>{const m=d.y??0,g=p.y??0;return m-g})),e.y>0&&(o.sort((d,p)=>{const m=d.y??0;return(p.y??0)-m}),a.sort((d,p)=>{const m=d.y??0;return(p.y??0)-m}));const c=a.map(d=>d.id??""),l=o.map(d=>Yf({x:d.x??0,y:d.y??0},bn)),u=[],h=[];for(let d=0;d<o.length;++d){const p=o[d],m={x:p.x??-1,y:p.y??-1},g=fs(s,m);fe(g)&&As(g)&&(u.push(g.id??""),u.push(g.id??""),h.push(Yf({x:g.x??0,y:g.y??0},bn)))}let f=!1;for(let d=0;d<o.length;++d){const p=o[d],m=ri(p,"collision"),g={x:p.x??-1,y:p.y??-1},_=Yf(g,bn),y={x:g.x+e.x,y:g.y+e.y};if(E1(y)){const v=fs(s,y),E=v?.id??"",x=Yf({x:v?.x??0,y:v?.y??0},bn),A=ri(v,"collision");if(fe(v)&&As(v)&&u.includes(E)!==!0&&c.includes(E)!==!0){let T=!1;const k=h.includes(_),L=k?fs(s,g):void 0,I=k?ri(L,"pushable"):!1,F=k&&I;if(LL(p,v)&&(m!==Fn.ISWALK||k)){let M=k;fe(L)&&I&&(f=Qh(i,s,L,{x:(L.x??0)-e.x,y:(L.y??0)-e.y})!==!0,f||(M=!1)),(M||m!==Fn.ISWALK)&&(f=Qh(i,s,v,{x:(v.x??0)+e.x,y:(v.y??0)+e.y})!==!0,f&&(T=F))}else(m!==Fn.ISWALK||F)&&(f=!0,T=F);T&&fe(L)&&(f=Qh(i,s,L,{x:(L.x??0)-e.x,y:(L.y??0)-e.y})!==!0)}else A===Fn.ISSOLID&&l.includes(x)===!1&&(f=!0)}else f=!0}if(!f){for(let d=0;d<a.length;++d){const p=a[d],m=ri(p,"collision"),g={x:p.x??0,y:p.y??0},_={x:g.x+e.x,y:g.y+e.y};if(E1(_)){const y=fs(s,_),v=y?.id??"",E=ri(y,"collision"),x=ri(y,"group");fe(y)&&As(y)&&u.includes(v)&&c.includes(v)!==!0?LL(p,y)?f=Qh(i,s,y,_)!==!0:f=!0:hx(m,E)&&r!==x&&(f=!0)}else f=!0}if(!f){for(let d=0;d<o.length;++d){const p=o[d],m={x:p.x??-1,y:p.y??-1},g={x:m.x+e.x,y:m.y+e.y},_=Ev(s,g.x,g.y);if(fe(p)&&fe(_)){Ol(s,{...p,x:g.x,y:g.y}),Ol(s,{..._,x:m.x,y:m.y});const y=fs(s,m);As(y)&&fe(y)&&(y.x=(y.x??0)+e.x,y.y=(y.y??0)+e.y,y.lx=(y.lx??0)+e.x,y.ly=(y.ly??0)+e.y)}}lc(s);for(let d=0;d<a.length;++d){const p=a[d],m={x:p.x??-1,y:p.y??-1},g={x:m.x+e.x,y:m.y+e.y};if(!Qh(i,s,p,g))break}lc(s)}}}function FR(t,e){let n="all";const r={x:0,y:0},i={x:bn-1,y:Tr-1};for(let s=e;s<t.length;){const[o,a]=Dt(t,s,[ut.MAYBE_NUMBER_OR_STRING]);if(dn(o))n=rr(o),s=a;else if(nn(o)){const[c,l,u,h]=Dt(t,a,[ut.NUMBER,ut.MAYBE_NUMBER,ut.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=h}else break}return{targetset:n,pt1:r,pt2:i}}function o$(t,e){const n=gm();for(let r=0;r<n.length;++r){const i=n[r],s=Gf(DL(i,t,e));if(fe(s))return s}}const $8e=Mv().command("snapshot",()=>(!fe(he.book)||!fe(he.board)||j8e(he.board.id),0)).command("revert",()=>(!fe(he.book)||!fe(he.board)||z8e(he.board.id),0)).command("copy",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r]=Dt(e,0,[ut.STRING]),i=o$(Qr.BOARD,n);if(fe(i)){const s=FR(e,r);EI(i.id,he.board.id,s.pt1,s.pt2,s.targetset)}return 0}).command("remix",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r,i,s]=Dt(e,0,[ut.STRING,ut.NUMBER,ut.NUMBER]),o=o$(Qr.BOARD,n);if(fe(o)){const a=FR(e,s);F8e(he.board.id,o.id,r,i,a.pt1,a.pt2,a.targetset)}return 0}).command("weave",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r]=Dt(e,0,[ut.DIR]),i={x:n.destpt.x-(he.element?.x??0),y:n.destpt.y-(he.element?.y??0)},s=FR(e,r);return V8e(he.board.id,i,s.pt1,s.pt2,he.elementid,s.targetset),0}).command("pivot",(t,e)=>{if(!fe(he.book)||!fe(he.board))return 0;const[n,r]=Dt(e,0,[ut.NUMBER]),i=FR(e,r);return I8e(he.board.id,lK(n),i.pt1,i.pt2,i.targetset),0});var B8=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(B8||{});const G8e={audio:SI,board:FOe,cli:c8e,element:d8e,runtime:O8e,loader:k8e,network:M8e,transform:$8e},v2=["audio","board","network","transform","element"],W8e={0:[],1:["cli",...v2],2:["loader",...v2],3:["runtime",...v2]},q8e={0:new Map,1:new Map,2:new Map,3:new Map};function SC(t){return(W8e[t]??[]).map(n=>G8e[n]).filter(fe)}function Y8e(t,e){const n=q8e[t];if(!n.has(e)){let r;const i=SC(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!fe(r));++s);n.set(e,r)}return n.get(e)}function K8e(t,e,n){const r=SC(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function X8e(t,e,n,r){const i=SC(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function J8e(t,e){const n=SC(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}function Z8e(t,e){const n=SC(t);for(let r=0;r<n.length;++r)n[r].aftertick(e)}function y2(t){return Kn(t)?t.length>0?1:0:t??0}function Q8e(t){return`${t}_chip`}function Yte(t=""){return`vm:${t??""}`}function eUe(t,e,n){const r=Q8e(t),i=Eg(r);let s;const o=Ts(Object.entries(n.labels??{}));(!Kn(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.sk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(n.errors?.length??0)!==0?1:0);function a(l,u){he.words=u;const h=Y8e(e,l);return fe(h)?h(c,u):l!=="send"?a("shortsend",[l,...u]):0}const c={halt(){uwe(r)},id(){return t},set(l,u){const[h,f]=X8e(e,c,l,u);if(h)return f},get(l){const[u,h]=K8e(e,c,l);if(u)return h},once(){i.lc=0,i.ys=0,he.get=c.get;try{s?.(c)||(i.es=1)}catch(l){_r(qe,he.elementfocus,"crash",l.message),i.es=1}},tick(l){const u=nn(i.ps)?i.ps:0,h=u%l===0;if(i.ps=u+1,h===!1)return!1;J8e(e,c);const f=c.shouldtick();return f&&c.once(),Z8e(e,c),f},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return!i.sk&&(i.es===0||c.hm()!==0)},checkcount(){return nn(i.lc)?++i.lc>kn.YIELD_AT_COUNT:!0},haslabel(l){if(Kn(i.lb))for(let u=0;u<i.lb.length;++u){const[h,f]=i.lb[u];if(h===l)return(f.find(p=>nn(p)&&p>0)??0)>0}return!1},hm(){if(Kn(i.mg)&&Kn(i.lb)){const[l]=i.mg;if(fe(l))for(let u=0;u<i.lb.length;++u){const[h,f]=i.lb[u];if(h===l)return f.find(d=>nn(d)&&d>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.checkcount()},send(l,u,h,f){qe.emit(l,`${Yte(u)}:${h}`,f)},lock(l){i.lk=l},unlock(){i.lk=""},scrolllock(l){i.sk=l},scrollunlock(l){i.sk===l&&(i.sk="")},message(l){i.sk&&l.player!==i.sk||i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(Kn(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l){const f=h[1].findIndex(d=>d>0);if(f>=0&&fe(h[1])){h[1][f]*=-1;break}}}},restore(l){if(Kn(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l)for(let f=0;f<h[1].length;f++)h[1][f]=Math.abs(h[1][f])}},getcase(){i.ec=nn(i.ec)?i.ec:1;const l=c.hm();if(l&&Kn(i.mg)){const[,u,h,f]=i.mg;c.set("senderid",h),fe(u)&&c.set("arg",u),f&&(c.set("player",f),he.elementfocus=f),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=nn(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const u=bwe.parse(l),[h]=u.filter(f=>f.fileName===yI);return{line:h?.lineNumber??0,column:h?.columnNumber??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},print(l){return Kn(l)?`array ${l.length} ${l.length===1?"item":"items"}`:typeof l=="object"?`obj ${Object.keys(l).join(", ")}`:l},template(l){return dx(l.join(" "),!0).tokens.map(h=>{if(h.tokenType===EC){const f=c.get(h.image.substring(1));if(fe(f))return f}return h.image}).join(" ")},command(...l){if(l.length===0)return 0;const[u,...h]=l;return a(rr(no(u)),h)},if(...l){const[u,h]=Dt(l,0,[ut.ANY]),f=y2(u);return f&&h<l.length&&c.command(...l.slice(h)),f?1:0},try(...l){const[,u]=Dt(l,0,[ut.DIR]),h=c.command("go",...l);return h&&u<l.length&&c.command(...l.slice(u)),h?1:0},take(...l){const[u,h,f]=Dt(l,0,[ut.NAME,ut.ANY]),d=nn(h),p=d?f:1,m=c.get(u),g=d?h:1;if(!nn(m))return p<l.length&&c.command(...l.slice(p)),1;const _=m-g;return _<0?(p<l.length&&c.command(...l.slice(p)),1):(c.set(u,_),0)},give(...l){const[u,h,f]=Dt(l,0,[ut.NAME,ut.ANY]),d=nn(h),p=d?f:1,m=c.get(u),g=d?h:1,_=m===void 0?1:0;return _&&p<l.length&&c.command(...l.slice(p)),c.set(u,u1(m,0)+g),_},duplicate(...l){return c.command("duplicate",...l)},repeatstart(l,...u){const[h,f]=Dt(u,0,[ut.NUMBER]),d=`repeatcount${l}`,p=`repeatwords${l}`;i[d]=h,i[p]=f<u.length?u.slice(f):void 0},repeat(l){const u=`repeatcount${l}`,h=`repeatwords${l}`;if(!nn(i[u]))return 0;const f=i[u];i[u]=f-1;const d=f>0,p=i[h];return d&&Kn(p)&&c.command(...p),d?1:0},foreachstart(l,...u){const[h,f]=Dt(u,0,[ut.NAME,ut.ANY]);if(Kn(f)){const d=`${h}_values`,p=Ts(f);c.set(h,p.shift()),c.set(d,p)}else{const[,d,p,m]=Dt(u,0,[ut.NAME,ut.NUMBER,ut.NUMBER,ut.MAYBE_NUMBER]);let g=Math.min(d,p),_=Math.max(d,p);const y=(m??0)||1;if(y<0){const v=g;g=_,_=v}c.set(h,g-y)}return 0},foreach(l,...u){const[h,f]=Dt(u,0,[ut.NAME,ut.ANY]);if(Kn(f)){const A=`${h}_values`,T=c.get(A),k=T.shift();return c.set(h,k),T.length>0?1:0}const[,d,p,m,g]=Dt(u,0,[ut.NAME,ut.NUMBER,ut.NUMBER,ut.MAYBE_NUMBER]);let _=Math.min(d,p),y=Math.max(d,p);const v=(m??0)||1;if(v<0){const A=_;_=y,y=A}let E=c.get(h);!nn(E)||E<_||E>y?E=_:E+=v;const x=E<=y?1:0;return x&&(c.set(h,E),g<u.length&&c.command(...u.slice(g))),x},waitfor(...l){const[u]=Dt(l,0,[ut.ANY]),h=y2(u);return h||c.yield(),h?1:0},or(...l){let u=0;for(let h=0;h<l.length;){const[f,d]=Dt(l,h,[ut.ANY]);if(u=f,u)break;h=d}return u},and(...l){let u=0;for(let h=0;h<l.length;){const[f,d]=Dt(l,h,[ut.ANY]);if(u=f,!u)break;h=d}return u},not(...l){const[u]=Dt(l,0,[ut.ANY]);return y2(u)?0:1},expr(...l){const[u]=Dt(l,0,[ut.ANY]);return u},isEq(l,u){const[h]=Dt([l],0,[ut.ANY]),[f]=Dt([u],0,[ut.ANY]);return typeof h=="object"||typeof f=="object"?J_(h,f)?1:0:h===f?1:0},isNotEq(l,u){return this.isEq(l,u)?0:1},isLessThan(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return h<f?1:0},isGreaterThan(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return h>f?1:0},isLessThanOrEq(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return h<=f?1:0},isGreaterThanOrEq(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return h>=f?1:0},opPlus(l,u){const[h]=Dt([l],0,[ut.ANY]),[f]=Dt([u],0,[ut.ANY]);return h+f},opMinus(l,u){const[h]=Dt([l],0,[ut.ANY]),[f]=Dt([u],0,[ut.ANY]);return h-f},opPower(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return Math.pow(h,f)},opMultiply(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return h*f},opDivide(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return h/f},opModDivide(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return h%f},opFloorDivide(l,u){const[h]=Dt([l],0,[ut.NUMBER]),[f]=Dt([u],0,[ut.NUMBER]);return Math.floor(h/f)},opUniPlus(l){const[u]=Dt([l],0,[ut.NUMBER]);return+u},opUniMinus(l){const[u]=Dt([l],0,[ut.NUMBER]);return-u}};return s=n.code,c}function a$(t,e){const n=Nl(t.id),r=Nl(t.party??t.id),i=t.kind==="object"||t.kind==="scroll";let s="";t.party&&r&&(s=t.party),n&&(s=t.id??"");const o=Nl(e.party??e.id),a=e.kind==="object"||e.kind==="scroll";return{sameparty:r===o&&!a&&!i,fromelementplayer:s}}function tUe(t,e,n,r){const i=Zh(la.MAIN);if(!fe(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(fe(c.id)){const l=`${Yte(c.id)}:${e}`;qe.emit("",l,n)}}}if(cv(t)){for(let o=0;o<r.length;++o){const a=r[o],c=fs(a,t);fe(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(rr(t)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(jee(a,[t]));break}}}}function Ho(t,e,n){if(!fe(he.board)||!fe(t))return;const r=Nl(t.id),i=Nl(e.id);let s=n,o=r&&!i?t.id??"":"";switch(n){case"shot":{const{sameparty:a,fromelementplayer:c}=a$(t,e);a&&As(e)?s="partyshot":o=c;break}case"touch":{const{sameparty:a,fromelementplayer:c}=a$(t,e);a?s="bump":o=c;break}}if(s==="shot"&&ri(e,"breakable")&&td(he.board,e,he.timestamp),fe(e?.id)){let a="";fe(t?.id)?a=t.id:a=`${Yf({x:t.x??0,y:t.y??0},bn)}`,kOe({id:Go(),session:qe.session(),player:o,sender:a,target:`${e.id}:${s}`,data:void 0})}}function GE(t,e,n){if(fe(n.targetname)){const r=Object.keys(he.board?.objects??{});switch(n.targetname){case"all":for(let i=0;i<r.length;++i){const s=r[i],o=mh(he.board,s);fe(o)&&Ho(e,o,n.label)}break;case"others":for(let i=0;i<r.length;++i){const s=r[i],o=mh(he.board,s);s!==t.id()&&fe(o)&&Ho(e,o,n.label)}break;case"sender":{const i=Kte(he.board,he.element?.sender??"");fe(i)&&As(i)&&Ho(e,i,n.label);break}case"self":he.elementid!==t.id()?t.send(he.elementfocus,he.elementid,n.label):fe(he.element)&&Ho(e,he.element,n.label);break;case"ping":{const i=Zh(la.MAIN),s=COe(i);tUe("all",n.label,void 0,s);break}default:{const i=jee(he.board,[n.targetname]);for(let s=0;s<i.length;++s){const o=i[s];fe(o)&&Ho(e,o,n.label)}break}}}else if(fe(n.targetdir))if(n.targetdir.targets.length)for(let r=0;r<n.targetdir.targets.length;++r){const i=fs(he.board,n.targetdir.targets[r]);fe(i)&&Ho(e,i,n.label)}else{const r=fs(he.board,n.targetdir.destpt);fe(r)&&Ho(e,r,n.label)}}function F8(t,e,n){!fe(t)||!fe(e?.id)||OL(qe,t,`${o8e(e)}${n}`)}function j8(t,e,n,r=!1){if(!fe(t)||!fe(t.lookup)||n.x<0||n.x>=bn||n.y<0||n.y>=Tr)return{name:"edge",kind:"edge",collision:Fn.ISSOLID,x:n.x,y:n.y};const i=n.x+n.y*bn,s=mh(t,t.lookup[i]??"404");if(fe(s))return r&&Nl(s.id)?void 0:s;const o=t.terrain[i];if(fe(o)&&hx(e,ri(o,"collision")))return o}function nUe(t,e,n){const r=mh(t,e?.id??""),i=r?.x??-1,s=r?.y??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=ri(r,"collision"),a=j8(t,o,n);return fe(a)}function l4(t,e,n){const r=mh(t,e?.id??"");if(!fe(t)||!fe(r)||!fe(r.x)||!fe(r.y)||!fe(t.lookup)||n.x<0||n.x>=bn||n.y<0||n.y>=Tr)return{name:"edge",kind:"edge",collision:Fn.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=xA(t,r),s=xA(t,n),o=ri(r,"collision");if(o===Fn.ISGHOST){r.x=n.x,r.y=n.y;return}const a=Nl(r?.id),c=mh(t,t.lookup[s]??"");if(ri(c,"collision")===Fn.ISGHOST)return;const l=Nl(c?.id??"");if(fe(c)&&(!a||!l))return{...c};const u=t.terrain[s],h=ri(u,"collision");if(hx(o,h))return{...u,x:n.x,y:n.y};r.x=n.x,r.y=n.y,fe(r.removed)||(t.lookup[i]=void 0,t.lookup[s]=r.id??"")}function Qh(t,e,n,r,i={}){if(!fe(n?.id))return!1;let s=l4(e,n,r);const o=ri(n,"collision"),a=Nl(n.id),c=o===Fn.ISBULLET;if(o!==Fn.ISBULLET&&fe(s)&&As(s)){const l=Ev(e,s.x??-1,s.y??-1),u=ri(l,"collision");if(!hx(o,u)){const h=Nl(n?.id),f=!!ri(s,"item"),d=LL(n,s),p=s.id??"";if(d&&(!h||!f)&&!i[p]){i[p]=!0;const m=Xd({x:n.x??0,y:n.y??0},r),g=zo({x:s.x??0,y:s.y??0},m);!Qh(t,e,s,g)&&h&&Ho(n,s,"touch")}s=l4(e,n,r)}}if(fe(s)){const l=Nl(s.id),u=ri(s,"collision")===Fn.ISBULLET,h=s.kind==="edge";return a?h?lUe(t,e,n,r)||Ho(s,n,"thud"):u?(e?.restartonzap&&l$(t,e,n,n.id??""),Ho(s,n,"shot"),Ho(n,s,"thud")):(Ho(s,n,"touch"),Ho(n,s,"touch")):c?u?(Ho(s,n,"thud"),Ho(n,s,"thud")):(l&&e?.restartonzap&&l$(t,e,s,s.id??""),Ho(s,n,"thud"),Ho(n,s,"shot")):l?(Ho(s,n,"touch"),Ho(n,s,"touch")):u?(Ho(s,n,"shot"),Ho(n,s,"thud")):(Ho(s,n,"thud"),Ho(n,s,"bump")),!1}return!0}function rUe(){return new Array(bn*Tr).map(()=>{})}function xA(t,e){return!fe(t)||!fe(e?.x)||!fe(e?.y)||e.x<0||e.x>=bn||e.y<0||e.y>=Tr?-1:e.x+e.y*bn}function fs(t,e){const n=xA(t,e);if(n<0||!fe(t?.lookup))return;const r=mh(t,t.lookup[n]??"");return fe(r)?r:t.terrain[n]}function Kte(t,e){const n=mh(t,e);if(fe(n))return n;const r=parseFloat(e),i=vM(isNaN(r)?-1:r,bn);return Ev(t,i.x,i.y)}function GS(t,e,n,r,i){const s=yn.MID;if(!fe(t)||!fe(e))return{dir:r,startpt:i,destpt:i,layer:s,targets:[]};const o={x:e.x??0,y:e.y??0},a={x:o.x+(e.stepx??0),y:o.y+(e.stepy??0)},c=Xd(o,a);for(let l=0;l<r.length;++l){const u=zK(r[l]);switch(u){case yn.IDLE:break;case yn.NORTH:case yn.SOUTH:case yn.WEST:case yn.EAST:zo(o,u);break;case yn.BY:{const[h,f]=r.slice(l+1);nn(h)&&nn(f)&&(o.x+=h,o.y+=f),l+=2;break}case yn.TO:{const[h,f]=r.slice(l+1);nn(h)&&nn(f)&&(o.x=h,o.y=f),l+=2;break}case yn.AT:{const[h,f]=r.slice(l+1);nn(h)&&nn(f)&&(o.x=h,o.y=f),l+=2;break}case yn.FLOW:zo(o,c);break;case yn.SEEK:{const h=iUe(t,e,n);cv(h)&&zo(o,Xd(i,h));break}case yn.RNDNS:zo(o,Gf(yn.NORTH,yn.SOUTH));break;case yn.RNDNE:zo(o,Gf(yn.NORTH,yn.EAST));break;case yn.RND:zo(o,Gf(yn.NORTH,yn.SOUTH,yn.WEST,yn.EAST));break;case yn.CW:case yn.CCW:case yn.OPP:case yn.RNDP:{const h=GS(t,e,n,r.slice(l+1),i);switch(o.x=i.x,o.y=i.y,u){case yn.CW:switch(Xd(i,h.destpt)){case yn.NORTH:zo(o,yn.EAST);break;case yn.SOUTH:zo(o,yn.WEST);break;case yn.EAST:zo(o,yn.SOUTH);break;case yn.WEST:zo(o,yn.NORTH);break}break;case yn.CCW:switch(Xd(i,h.destpt)){case yn.NORTH:zo(o,yn.WEST);break;case yn.SOUTH:zo(o,yn.EAST);break;case yn.EAST:zo(o,yn.NORTH);break;case yn.WEST:zo(o,yn.SOUTH);break}break;case yn.OPP:switch(Xd(i,h.destpt)){case yn.NORTH:zo(o,yn.SOUTH);break;case yn.SOUTH:zo(o,yn.NORTH);break;case yn.EAST:zo(o,yn.WEST);break;case yn.WEST:zo(o,yn.EAST);break}break;case yn.RNDP:switch(Xd(i,h.destpt)){case yn.NORTH:case yn.SOUTH:o.x+=Gf(-1,1);break;case yn.WEST:case yn.EAST:o.y+=Gf(-1,1);break}break}return{dir:r,startpt:i,destpt:o,layer:s,targets:[]}}case yn.FLEE:break;case yn.FIND:break;case yn.AWAY:{const[h,f]=r.slice(l+1);if(nn(h)&&nn(f)){const d={x:h,y:f},p=d.x-o.x,m=d.y-o.y;if(Math.abs(p)>1||Math.abs(m)>1){const g=ri(e,"collision"),_=Az(t,g,o,d,!0);if(fe(_)&&(_.x!==h||_.y!==f)){const y=c$(t,_);fe(y)||(o.x=_.x,o.y=_.y)}}else{const g=l1(-p,-m);zo(o,g)}}l+=2;break}case yn.TOWARD:{const[h,f]=r.slice(l+1);if(nn(h)&&nn(f)){const d={x:h,y:f},p=d.x-o.x,m=d.y-o.y;if(Math.abs(p)>1||Math.abs(m)>1){const g=ri(e,"collision"),_=Az(t,g,o,d,!1);if(fe(_)&&(_.x!==h||_.y!==f)){const y=c$(t,_);fe(y)||(o.x=_.x,o.y=_.y)}}else{const g=l1(p,m);zo(o,g)}}l+=2;break}case yn.MID:case yn.OVER:case yn.UNDER:case yn.GROUND:{const h=GS(t,e,n,r.slice(l+1),i);return h.layer=u,h}case yn.WITHIN:{const[h]=r.slice(l+1),f=GS(t,e,n,r.slice(l+2),i);if(f.targets.length===0&&nn(h)&&h>0)for(let d=-h;d<=h;++d)for(let p=-h;p<=h;++p){const m={x:f.destpt.x+p,y:f.destpt.y+d};E1(m)&&f.targets.push(m)}return nn(h)&&h>0?{...f,targets:f.targets.filter(d=>cv(d)?Oj(d,f.destpt)<=h:!1)}:f}case yn.AWAYBY:{const[h]=r.slice(l+1),f=GS(t,e,n,r.slice(l+2),i);if(f.targets.length===0)for(let d=-bn;d<=bn;++d)for(let p=-bn;p<=bn;++p){const m={x:f.destpt.x+p,y:f.destpt.y+d};E1(m)&&f.targets.push(m)}return nn(h)&&h>0?{...f,targets:f.targets.filter(d=>cv(d)?Oj(d,f.destpt)>=h:!1)}:f}case yn.ELEMENTS:{const h=GS(t,e,n,r.slice(l+1),i);o.x=i.x,o.y=i.y,h.targets=[];const f=Xd(h.startpt,h.destpt);for(let d=0;d<bn&&(zo(o,f),!!E1(o));++d)h.targets.push({x:o.x,y:o.y});return h}}}return{dir:r,startpt:i,destpt:o,layer:s,targets:[]}}function iUe(t,e,n){if(!fe(t)||!fe(e))return;const r=t.objects[n];if(fe(r))return r;if(cv(e))return zee(e,fx(t,"player"))}function Ev(t,e,n){return(e>=0&&e<bn)??(n>=0&&n<Tr)?t?.terrain[e+n*bn]:void 0}function sUe(t,e){if(!fe(t)||!fe(e))return;const n=Ts(e);return n.id=n.id??Go(),t.objects[n.id]=n,t.objects[n.id]}function Xte(t,e,n,r){return sUe(t,{...e,kind:n,id:r})}function mh(t,e){if(t)return t.objects[e]}function c$(t,e){const n=xA(t,e);if(n<0||!fe(t?.lookup))return;const r=mh(t,t.lookup[n]??"");if(fe(r))return r}function oUe(t){return fe(t)?[...Object.values(t.objects)]:[]}function Jte(t,e,n){const r=[],i=[];if(!fe(t))return{objectelements:r,terrainelements:i};function s(o,a){if(o.removed)return!1;switch(n){case"all":return!0;case"self":return o?.id===e;case"others":return o?.id!==e;case"terrain":return a===!0;case"object":return a===!1}const c=ri(o,n);return fe(c)||mu(o).name===n||ri(o,"group")===n}for(let o=0;o<zm;++o){const a=t.terrain[o],c=t.objects[t.lookup?.[o]??""];if(fe(a)&&s(a,!0)){i.push(a);const l=t.objects[t.lookup?.[o]??""];fe(l)&&As(l)&&r.push(l)}else As(c)&&s(c,!1)&&r.push(c)}return{objectelements:r,terrainelements:i}}function td(t,e,n){return!fe(e)||mu(e).name==="player"?!1:(e.id?(e.removed=n,b6(t,e)):(Ol(t,{x:e?.x??0,y:e?.y??0}),pwe(t,e)),!0)}function Ol(t,e){if(!fe(t)||!fe(e)||!fe(e.x)||!fe(e.y)||e.x<0||e.x>=bn||e.y<0||e.y>=Tr)return;const n=Ts(e),r=e.x+e.y*bn;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function aUe(t,e,n){return Ol(t,{...e,kind:n})}function cUe(t){if(fe(t)){if(dn(t.over))if(dn(t.overboard)){const e=Cs(t.overboard);fe(e)||delete t.overboard}else{const e=Cs(t.over);fe(e)&&(t.overboard=e.id)}else dn(t.overboard)&&delete t.overboard;if(dn(t.under))if(dn(t.underboard)){const e=Cs(t.underboard);fe(e)||delete t.underboard}else{const e=Cs(t.under);fe(e)&&(t.underboard=e.id)}else dn(t.underboard)&&delete t.underboard;if(dn(t.charset))if(dn(t.charsetpage)){const e=uu(Qr.CHARSET,t.charset);fe(e)||delete t.charsetpage}else{const e=uu(Qr.CHARSET,t.charset);fe(e)&&(t.charsetpage=e.id)}else dn(t.charsetpage)&&delete t.charsetpage;if(dn(t.palette))if(dn(t.palettepage)){const e=uu(Qr.PALETTE,t.palette);fe(e)||delete t.palettepage}else{const e=uu(Qr.PALETTE,t.palette);fe(e)&&(t.palettepage=e.id)}else dn(t.palettepage)&&delete t.palettepage}}function z8(t=c5){const e={terrain:rUe(),objects:{},id:"",name:""};return t(e)}function lUe(t,e,n,r){const i=n.id??"";if(r.x<0){const s=Cs(e?.exitwest??"");if(fe(s))return nE(t,i,s.id,{x:bn-1,y:r.y})}else if(r.x>=bn){const s=Cs(e?.exiteast??"");if(fe(s))return nE(t,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=Cs(e?.exitnorth??"");if(fe(s))return nE(t,i,s.id,{x:r.x,y:Tr-1})}else if(r.y>=Tr){const s=Cs(e?.exitsouth??"");if(fe(s))return nE(t,i,s.id,{x:r.x,y:0})}return!1}function l$(t,e,n,r){const i=IE(t,r,"enterx"),s=IE(t,r,"entery");nn(i)&&nn(s)&&fe(n)&&l4(e,n,{x:i,y:s})}function E1(t){return $xe(t.x,t.y,0,bn-1,Tr-1,0)}const he={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var ut=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.COLOR_OR_KIND=7]="COLOR_OR_KIND",t[t.MAYBE_KIND=8]="MAYBE_KIND",t[t.MAYBE_NAME=9]="MAYBE_NAME",t[t.MAYBE_NUMBER=10]="MAYBE_NUMBER",t[t.MAYBE_STRING=11]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",t[t.ANY=13]="ANY",t))(ut||{});function Cc(t,e,n){throw console.info(n,he.element,he.elementid,he.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function u$(t){const e={x:he.element?.x??0,y:he.element?.y??0};return GS(he.board,he.element,he.elementfocus,t,e)}function Dt(t,e,n){const r=he.words;he.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=_P(s);S1(a)?(s=c,i.push(a)):Cc("kind",a,t);break}case 0:{if(WE(t[s])===void 0){const[a,c]=nu(s);uc(a)?(s=c,i.push(a)):nn(a)?(s=c,i.push(kI(a,void 0))):Cc("color",a,t)}else{const[a,c]=YM(s);uc(a)?(s=c,i.push(a)):Cc("color",a,t)}break}case 2:{if(XA(t[s])===void 0){const[a,c]=nu(s);sd(a)?(s=c,i.push(u$(a))):Cc("direction",a,t)}else{const[a,c]=VK(s);sd(a)?(s=c,i.push(u$(a))):Cc("direction",a,t)}break}case 3:{const a=he.words[s];dn(a)||Cc("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=nu(s);if(dn(a)){const l=parseFloat(a);nn(l)?i.push(l):Cc("number",a,t)}else nn(a)?i.push(a):Cc("number",a,t);s=c;break}case 5:{const[a,c]=nu(s);dn(a)||Cc("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=nu(s);let l=a;if(dn(l)){const u=parseFloat(l);nn(u)&&(l=u)}else nn(l)||Cc("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=_P(s);if(S1(a))s=c,i.push(a);else if(WE(t[s])===void 0){const[l,u]=nu(s);uc(l)?(s=u,i.push(l)):Cc("color",l,t)}else{const[l,u]=YM(s);uc(l)?(s=u,i.push(l)):Cc("color or kind",l,t)}break}case 8:{const[a,c]=_P(s);a!==void 0&&!S1(a)&&Cc("optional kind",a,t),s=c,i.push(a);break}case 9:{const a=he.words[s];a!==void 0&&!dn(a)&&Cc("optional string",a,t),++s,i.push(a);break}case 10:{const[a,c]=nu(s);if(dn(a)){const l=parseFloat(a);nn(l)?i.push(l):Cc("optional number",a,t)}else nn(a)||a===void 0?i.push(a):Cc("optional number",a,t);s=c;break}case 11:{const[a,c]=nu(s);a!==void 0&&!dn(a)&&Cc("optional string",a,t),s=c,i.push(a);break}case 12:{const[a,c]=nu(s);let l=a;if(dn(l)){const u=parseFloat(l);nn(u)&&(l=u)}else l!==void 0&&!nn(l)&&Cc("number or string",l,t);s=c,i.push(l);break}case 13:{const[a,c]=nu(s);s=c,i.push(a);break}}return he.words=r,[...i,s]}function uUe(t){if(fe(t)&&(t<Ft.ONBLACK||t>Ft.ONCLEAR))return t}function V8(t){return fe(t)&&t>Ft.WHITE&&t<Ft.ONCLEAR?t-Ft.ONBLACK:void 0}const RI={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR",blblack:"BLBLACK",bldkblue:"BLDKBLUE",bldkgreen:"BLDKGREEN",bldkcyan:"BLDKCYAN",bldkred:"BLDKRED",bldkpurple:"BLDKPURPLE",bldkyellow:"BLDKYELLOW",blltgray:"BLLTGRAY",bldkgray:"BLDKGRAY",blblue:"BLBLUE",blgreen:"BLGREEN",blcyan:"BLCYAN",blred:"BLRED",blpurple:"BLPURPLE",blyellow:"BLYELLOW",blwhite:"BLWHITE",blbrown:"BLDKYELLOW",bldkwhite:"BLLTGRAY",blltgrey:"BLLTGRAY",blgray:"BLLTGRAY",blgrey:"BLLTGRAY",bldkgrey:"BLDKGRAY",blltblack:"BLDKGRAY"};function uc(t){return Kn(t)&&Zte(t[0])}function hUe(t){return uc(t)&&t[0].startsWith("ON")}function Zte(t){return fe(Ft[t])&&dn(t)}function WE(t){if(dn(t))return RI[rr(t)]}function kI(t,e){return[fe(t)?`${Ft[t]}`:void 0,fe(e)?`ON${Ft[e]}`:void 0].filter(fe)}function WM(t){return t.map(e=>Ft[e]).find(e=>fe(e)&&e<Ft.ONBLACK)}function qM(t){return t.map(e=>Ft[e]).find(e=>fe(e)&&e>=Ft.ONBLACK)}function fUe(t){if(uc(t))return t;if(Zte(t))return[t];const e=WE(t);if(fe(e))return[e]}function h$(t){const e=he.words[t],n=fUe(e);return uc(n)?[n,t+1]:[void 0,t]}function YM(t){const e=[];let n=t;const r=parseFloat(he.words[t]);if(nn(r))return[kI(r,void 0),t+1];const[i,s]=h$(t);uc(i)&&(e.push(...i),n=s);const[o,a]=h$(s);return hUe(o)&&(e.push(...o),n=a),e.length?[e,n]:[void 0,t]}function rE(t){const e={};for(let n=0;n<t.length;++n){const r=t[n],i=Ft[r];fe(i)&&(i<Ft.ONBLACK||i>Ft.ONCLEAR?e.color=i:e.bg=V8(i))}return e}const z1=navigator.userAgent.includes("Mac");navigator.userAgent.includes("Linux");const Qte=navigator.userAgent.includes("Firefox")||navigator.userAgent.includes("FxiOS"),wA=z1?"cmd":"ctrl",dUe=RE(32,126).map(t=>String.fromCharCode(t)),ene=yu({name:"Whitespace",pattern:/ +/}),pUe=yu({name:"WhitespaceSkipped",pattern:/ +/,group:Lc.SKIPPED}),MI=yu({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),OI=yu({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:dUe}),II=yu({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),NI=yu({name:"EscapedDollar",pattern:"$$",start_chars_hint:["$"]}),EC=yu({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:["$"]}),H8=yu({name:"Center",pattern:/\$CENTER/i,start_chars_hint:["$"]}),$8=yu({name:"MetaKey",pattern:/\$META/i,start_chars_hint:["$"]}),PI=yu({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),DI=yu({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function mUe(t,e=""){return yu({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const gUe=Object.keys(RI),tne=gUe.map(t=>mUe(`\\$(${t})`,t)),_Ue=[ene,MI,...tne,II,OI,PI,NI,DI,H8,$8,EC],vUe=new Lc(_Ue,{skipValidations:!Lm,ensureOptimizations:Lm}),yUe=new Lc([pUe,MI,...tne,II,OI,PI,NI,DI,H8,$8,EC],{skipValidations:!Lm,ensureOptimizations:Lm}),f$=/\$CENTER/i;function G8(t){if(f$.test(t))return t.replace(f$,"")}function dx(t,e=!1){return e?yUe.tokenize(t):vUe.tokenize(t)}function Hg(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function W8(t){t.active={...t.reset}}function q8(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case NI:s("$");break;case PI:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case II:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case MI:{e.x=e.active.leftedge??0,++e.y;break}case H8:break;case $8:{s(wA);break}default:{const l=c.tokenType.name,u=RI[l],h=uUe(Ft[u]),f=V8(Ft[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):fe(h)?e.active.color=h:fe(f)?e.active.bg=f:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(fe(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){W8(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;fv(u,u+l.length,e.active.color,e.active.bg,e),TA(u,l,e)}}}function ei(t,e,n){const r=dx(t);r.tokens&&(q8(r.tokens,e),n&&W8(e),e.changed())}function d$(t){const e=dx(t);if(!e.tokens)return"";const n=e.tokens.filter(r=>{switch(r.tokenType){case ene:case MI:case II:case OI:case PI:case NI:case DI:case EC:return!0;default:return!1}}).map(r=>r.image).join("");return n.trim().length===0?"":n}function $g(t,e,n){const r=dx(t);if(!r.tokens)return;const i=Hg(e,n,Ft.WHITE,Ft.BLACK);return i.measureonly=!0,q8(r.tokens,i),i.x>0&&++i.y,i}function TA(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function fv(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function bUe(t,e,n,r){const i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;++o)r.bg[o]=n;r.changed()}function Uf(t,e,n,r,i,s,o){const a=Math.min(n,r),c=Math.max(n,r);if(a>e||c<0)return;const l=Math.max(0,a),u=Math.min(e,c);fv(t+l,t+u,i,s,o)}function sT(t,e,n,r,i,s){const o=Math.min(n,r),a=Math.max(n,r);if(o>e||a<0)return;const c=Math.max(0,o),l=Math.min(e,a);bUe(t+c,t+l,i,s)}function u4(t,e,n){const r=YA(OI,t,0,0,0,0,0,0);q8([r],e),n&&W8(e),e.changed()}function yp(t){const e=t.reset.leftedge??0,n=t.reset.rightedge??t.width-1,r=t.reset.topedge??0,i=t.reset.bottomedge??t.height-1,s=n-e+1,o=i-r+1;return{left:e,right:n,top:r,bottom:i,width:s,height:o}}const SUe=t=>t;function Y8(t,e=SUe){const n=ch.useSyncExternalStore(t.subscribe,ch.useCallback(()=>e(t.getState()),[t,e]),ch.useCallback(()=>e(t.getInitialState()),[t,e]));return ch.useDebugValue(n),n}const p$=t=>{const e=wO(t),n=r=>Y8(e,r);return Object.assign(n,e),n},Pv=(t=>t?p$(t):p$);function nne(t){return t.generateMipmaps=!1,t.minFilter=Il,t.magFilter=Il,t.needsUpdate=!0,t}function _m(t){if(fe(t))return nne(new jce(cme(t)))}const xC=Ye.createContext(Hg(1,1,15,1));function Bl(){return Ye.useContext(xC)}const rne=Pv(()=>({blink:!1}));setInterval(()=>{rne.setState(t=>({blink:!t.blink}))},333);function ff(){return rne(t=>t.blink)}function ine(){return wO(t=>{function e(){t(n=>({render:n.render+1}))}return{dither:[],render:0,changed(){queueMicrotask(e)}}})}function EUe(t){t.fill(0)}function b2(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return-1;t[r+i*e]=s}const sne=Ye.createContext(ine());function xUe(t,e,n){const[r]=Ye.useState(()=>ine()),i=t*e,s=r.getState();return s.dither.length!==i&&(s.dither=new Array(i).fill(n),s.render=0),r}function one(){return wO(t=>{function e(){t(n=>({render:n.render+1}))}return{width:0,height:0,char:[],color:[],bg:[],render:0,changed(){queueMicrotask(e)}}})}function LI(t,e,n,r){t.char.fill(e),t.color.fill(n),t.bg.fill(r)}function $o(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return;const o=r+i*e;Dm(s).forEach(a=>{const c=s[a];fe(c)&&(t[a][o]=c)})}const K8=Ye.createContext(one());function ab(t,e,n,r,i){const[s]=Ye.useState(()=>one()),o=t*e,a=s.getState();return a.char.length!==o&&(a.width=t,a.height=e,a.char=new Array(o).fill(n),a.color=new Array(o).fill(r),a.bg=new Array(o).fill(i),a.render=0),s}function ane(){return Ye.useContext(K8).getState()}const S2=Y1(J1),oT=K1(X1),va=Pv(t=>({palette:S2,charset:oT,mood:"",viewimage:"",screen:{},reset(){const e=fe(oT)?G3(oT,Yo,Ia):void 0;t({palette:S2,mood:"",viewimage:"",screen:{},palettedata:VE(S2),charset:oT,charsetdata:_m(oT),spritecharset:e,spritecharsetdata:_m(e)})},setmood(e){t(n=>J_(n.mood,e)?n:{...n,mood:e})},setviewimage(e){t(n=>J_(n.viewimage,e)?n:{...n,viewimage:e})},setpalette(e){t(n=>J_(n.palette,e)?n:{...n,palette:e,palettedata:VE(e)})},setcharset(e){t(n=>{if(J_(n.charset,e))return n;const r=fe(e)?G3(e,Yo,Ia):void 0;return{...n,charset:e,charsetdata:_m(e),spritecharset:r,spritecharsetdata:_m(r)}})},setaltcharset(e){t(n=>{if(J_(n.altcharset,e))return n;const r=fe(e)?G3(e,Yo,Ia):void 0;return{...n,altcharset:e,altcharsetdata:_m(e),spritealtcharset:r,spritealtcharsetdata:_m(r)}})},setscreen(e,n){t(r=>J_(r.screen,n)?r:{...r,screen:{...r.screen,[e]:n}})}}));va.getState().reset();const Jf=Pv(()=>({active:!0,saferows:1,insetcols:1,insetrows:1,islowrez:!1,islandscape:!0,sidebaropen:!0,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!1,showtouchcontrols:!1,checknumbers:"",wordlist:[],wordlistflag:""}));async function X8(t){const e=au(1111111,9999999),n=rr(t.replace(/[^a-zA-Z/]/g,""));return await(await fetch(`https://raw.githubusercontent.com/wiki/goldbuick/zed-software-system/${n}.md?q=${e}`)).text()}var kk={exports:{}},wUe=kk.exports,m$;function TUe(){return m$||(m$=1,(function(t,e){(function(n,r){r()})(wUe,function(){function n(l,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function r(l,u,h){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){c(f.response,u,h)},f.onerror=function(){console.error("could not download file")},f.send()}function i(l){var u=new XMLHttpRequest;u.open("HEAD",l,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function s(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(u)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof qf=="object"&&qf.global===qf?qf:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(l,u,h){var f=o.URL||o.webkitURL,d=document.createElement("a");u=u||l.name||"download",d.download=u,d.rel="noopener",typeof l=="string"?(d.href=l,d.origin===location.origin?s(d):i(d.href)?r(l,u,h):s(d,d.target="_blank")):(d.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(d.href)},4e4),setTimeout(function(){s(d)},0))}:"msSaveOrOpenBlob"in navigator?function(l,u,h){if(u=u||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(n(l,h),u);else if(i(l))r(l,u,h);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){s(f)})}}:function(l,u,h,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return r(l,u,h);var d=l.type==="application/octet-stream",p=/constructor/i.test(o.HTMLElement)||o.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||d&&p||a)&&typeof FileReader<"u"){var g=new FileReader;g.onloadend=function(){var v=g.result;v=m?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=v:location=v,f=null},g.readAsDataURL(l)}else{var _=o.URL||o.webkitURL,y=_.createObjectURL(l);f?f.location=y:location.href=y,f=null,setTimeout(function(){_.revokeObjectURL(y)},4e4)}});o.saveAs=c.saveAs=c,t.exports=c})})(kk)),kk.exports}var AUe=TUe();async function CUe(t,e){const n=new Z6e;n.file("index.html",`<!doctype html>
      <html lang=en>
      <head>
      <meta charset=utf-8>
      <title>...adding bytes</title>
      </head>
      <body>
      <script>location = 'https://zed.cafe/#${e}';<\/script>
      </body>
    </html>`);const r=await n.generateAsync({type:"blob"});AUe.saveAs(r,`${t}.zip`)}function da(){return navigator.clipboard}function J8(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var cb=J8();function cne(t){cb=t}var zT={exec:()=>null};function es(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(i,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(fu.caret,"$1"),n=n.replace(i,o),r},getRegex:()=>new RegExp(n,e)};return r}var RUe=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),fu={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},kUe=/^(?:[ \t]*(?:\n|$))+/,MUe=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,OUe=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,wC=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,IUe=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Z8=/(?:[*+-]|\d{1,9}[.)])/,lne=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,une=es(lne).replace(/bull/g,Z8).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),NUe=es(lne).replace(/bull/g,Z8).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Q8=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,PUe=/^[^\n]+/,eU=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,DUe=es(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",eU).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),LUe=es(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Z8).getRegex(),UI="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",tU=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,UUe=es("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",tU).replace("tag",UI).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),hne=es(Q8).replace("hr",wC).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",UI).getRegex(),BUe=es(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",hne).getRegex(),nU={blockquote:BUe,code:MUe,def:DUe,fences:OUe,heading:IUe,hr:wC,html:UUe,lheading:une,list:LUe,newline:kUe,paragraph:hne,table:zT,text:PUe},g$=es("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",wC).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",UI).getRegex(),FUe={...nU,lheading:NUe,table:g$,paragraph:es(Q8).replace("hr",wC).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",g$).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",UI).getRegex()},jUe={...nU,html:es(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",tU).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:zT,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:es(Q8).replace("hr",wC).replace("heading",` *#{1,6} *[^
]`).replace("lheading",une).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},zUe=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,VUe=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,fne=/^( {2,}|\\)\n(?!\s*$)/,HUe=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,BI=/[\p{P}\p{S}]/u,rU=/[\s\p{P}\p{S}]/u,dne=/[^\s\p{P}\p{S}]/u,$Ue=es(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,rU).getRegex(),pne=/(?!~)[\p{P}\p{S}]/u,GUe=/(?!~)[\s\p{P}\p{S}]/u,WUe=/(?:[^\s\p{P}\p{S}]|~)/u,qUe=es(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",RUe?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),mne=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,YUe=es(mne,"u").replace(/punct/g,BI).getRegex(),KUe=es(mne,"u").replace(/punct/g,pne).getRegex(),gne="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",XUe=es(gne,"gu").replace(/notPunctSpace/g,dne).replace(/punctSpace/g,rU).replace(/punct/g,BI).getRegex(),JUe=es(gne,"gu").replace(/notPunctSpace/g,WUe).replace(/punctSpace/g,GUe).replace(/punct/g,pne).getRegex(),ZUe=es("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,dne).replace(/punctSpace/g,rU).replace(/punct/g,BI).getRegex(),QUe=es(/\\(punct)/,"gu").replace(/punct/g,BI).getRegex(),eBe=es(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),tBe=es(tU).replace("(?:-->|$)","-->").getRegex(),nBe=es("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",tBe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),KM=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,rBe=es(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",KM).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),_ne=es(/^!?\[(label)\]\[(ref)\]/).replace("label",KM).replace("ref",eU).getRegex(),vne=es(/^!?\[(ref)\](?:\[\])?/).replace("ref",eU).getRegex(),iBe=es("reflink|nolink(?!\\()","g").replace("reflink",_ne).replace("nolink",vne).getRegex(),_$=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,iU={_backpedal:zT,anyPunctuation:QUe,autolink:eBe,blockSkip:qUe,br:fne,code:VUe,del:zT,emStrongLDelim:YUe,emStrongRDelimAst:XUe,emStrongRDelimUnd:ZUe,escape:zUe,link:rBe,nolink:vne,punctuation:$Ue,reflink:_ne,reflinkSearch:iBe,tag:nBe,text:HUe,url:zT},sBe={...iU,link:es(/^!?\[(label)\]\((.*?)\)/).replace("label",KM).getRegex(),reflink:es(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",KM).getRegex()},h4={...iU,emStrongRDelimAst:JUe,emStrongLDelim:KUe,url:es(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",_$).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:es(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",_$).getRegex()},oBe={...h4,br:es(fne).replace("{2,}","*").getRegex(),text:es(h4.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},jR={normal:nU,gfm:FUe,pedantic:jUe},aT={normal:iU,gfm:h4,breaks:oBe,pedantic:sBe},aBe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},v$=t=>aBe[t];function cm(t,e){if(e){if(fu.escapeTest.test(t))return t.replace(fu.escapeReplace,v$)}else if(fu.escapeTestNoEncode.test(t))return t.replace(fu.escapeReplaceNoEncode,v$);return t}function y$(t){try{t=encodeURI(t).replace(fu.percentDecode,"%")}catch{return null}return t}function b$(t,e){let n=t.replace(fu.findPipe,(s,o,a)=>{let c=!1,l=o;for(;--l>=0&&a[l]==="\\";)c=!c;return c?"|":" |"}),r=n.split(fu.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(fu.slashPipe,"|");return r}function cT(t,e,n){let r=t.length;if(r===0)return"";let i=0;for(;i<r&&t.charAt(r-i-1)===e;)i++;return t.slice(0,r-i)}function cBe(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function S$(t,e,n,r,i){let s=e.href,o=e.title||null,a=t[1].replace(i.other.outputLinkReplace,"$1");r.state.inLink=!0;let c={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,c}function lBe(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(s=>{let o=s.match(n.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=i.length?s.slice(i.length):s}).join(`
`)}var XM=class{options;rules;lexer;constructor(t){this.options=t||cb}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:cT(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=lBe(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=cT(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:cT(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=cT(e[0],`
`).split(`
`),r="",i="",s=[];for(;n.length>0;){let o=!1,a=[],c;for(c=0;c<n.length;c++)if(this.rules.other.blockquoteStart.test(n[c]))a.push(n[c]),o=!0;else if(!o)a.push(n[c]);else break;n=n.slice(c);let l=a.join(`
`),u=l.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${l}`:l,i=i?`${i}
${u}`:u;let h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,s,!0),this.lexer.state.top=h,n.length===0)break;let f=s.at(-1);if(f?.type==="code")break;if(f?.type==="blockquote"){let d=f,p=d.raw+`
`+n.join(`
`),m=this.blockquote(p);s[s.length-1]=m,r=r.substring(0,r.length-d.raw.length)+m.raw,i=i.substring(0,i.length-d.text.length)+m.text;break}else if(f?.type==="list"){let d=f,p=d.raw+`
`+n.join(`
`),m=this.list(p);s[s.length-1]=m,r=r.substring(0,r.length-f.raw.length)+m.raw,i=i.substring(0,i.length-d.raw.length)+m.raw,n=p.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:i}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),r=n.length>1,i={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");let s=this.rules.other.listItemRegex(n),o=!1;for(;t;){let c=!1,l="",u="";if(!(e=s.exec(t))||this.rules.block.hr.test(t))break;l=e[0],t=t.substring(l.length);let h=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,_=>" ".repeat(3*_.length)),f=t.split(`
`,1)[0],d=!h.trim(),p=0;if(this.options.pedantic?(p=2,u=h.trimStart()):d?p=e[1].length+1:(p=e[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,u=h.slice(p),p+=e[1].length),d&&this.rules.other.blankLine.test(f)&&(l+=f+`
`,t=t.substring(f.length+1),c=!0),!c){let _=this.rules.other.nextBulletRegex(p),y=this.rules.other.hrRegex(p),v=this.rules.other.fencesBeginRegex(p),E=this.rules.other.headingBeginRegex(p),x=this.rules.other.htmlBeginRegex(p);for(;t;){let A=t.split(`
`,1)[0],T;if(f=A,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),T=f):T=f.replace(this.rules.other.tabCharGlobal,"    "),v.test(f)||E.test(f)||x.test(f)||_.test(f)||y.test(f))break;if(T.search(this.rules.other.nonSpaceChar)>=p||!f.trim())u+=`
`+T.slice(p);else{if(d||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||v.test(h)||E.test(h)||y.test(h))break;u+=`
`+f}!d&&!f.trim()&&(d=!0),l+=A+`
`,t=t.substring(A.length+1),h=T.slice(p)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(l)&&(o=!0));let m=null,g;this.options.gfm&&(m=this.rules.other.listIsTask.exec(u),m&&(g=m[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:l,task:!!m,checked:g,loose:!1,text:u,tokens:[]}),i.raw+=l}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let l=i.items[c].tokens.filter(h=>h.type==="space"),u=l.length>0&&l.some(h=>this.rules.other.anyLine.test(h.raw));i.loose=u}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:i}}}table(t){let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=b$(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let o of r)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<n.length;o++)s.header.push({text:n[o],tokens:this.lexer.inline(n[o]),header:!0,align:s.align[o]});for(let o of i)s.rows.push(b$(o,s.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:s.align[c]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=cT(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=cBe(e[2],"()");if(s===-2)return;if(s>-1){let o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let r=e[2],i="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],i=s[3])}else i=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),S$(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[r.toLowerCase()];if(!i){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return S$(n,i,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let i=[...r[0]].length-1,s,o,a=i,c=0,l=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,e=e.slice(-1*t.length+i);(r=l.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(o=[...s].length,r[3]||r[4]){a+=o;continue}else if((r[5]||r[6])&&i%3&&!((i+o)%3)){c+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+c);let u=[...r[0]][0].length,h=t.slice(0,i+r.index+u+o);if(Math.min(i,o)%2){let d=h.slice(1,-1);return{type:"em",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}let f=h.slice(2,-2);return{type:"strong",raw:h,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let n,r;if(e[2]==="@")n=e[0],r="mailto:"+n;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);n=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Zd=class f4{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||cb,this.options.tokenizer=this.options.tokenizer||new XM,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:fu,block:jR.normal,inline:aT.normal};this.options.pedantic?(n.block=jR.pedantic,n.inline=aT.pedantic):this.options.gfm&&(n.block=jR.gfm,this.options.breaks?n.inline=aT.breaks:n.inline=aT.gfm),this.tokenizer.rules=n}static get rules(){return{block:jR,inline:aT}}static lex(e,n){return new f4(n).lex(e)}static lexInline(e,n){return new f4(n).inlineTokens(e)}lex(e){e=e.replace(fu.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){for(this.options.pedantic&&(e=e.replace(fu.tabCharGlobal,"    ").replace(fu.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},e,n))?(e=e.substring(i.raw.length),n.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let o=n.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:n.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):n.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},n.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),n.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let o=1/0,a=e.slice(1),c;this.options.extensions.startBlock.forEach(l=>{c=l.call({lexer:this},a),typeof c=="number"&&c>=0&&(o=Math.min(o,c))}),o<1/0&&o>=0&&(s=e.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let o=n.at(-1);r&&o?.type==="paragraph"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):n.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):n.push(i);continue}if(e){let o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){let r=e,i=null;if(this.tokens.links){let c=Object.keys(this.tokens.links);if(c.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)c.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)s=i[2]?i[2].length:0,r=r.slice(0,i.index+s)+"["+"a".repeat(i[0].length-s-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=this.options.hooks?.emStrongMask?.call({lexer:this},r)??r;let o=!1,a="";for(;e;){o||(a=""),o=!1;let c;if(this.options.extensions?.inline?.some(u=>(c=u.call({lexer:this},e,n))?(e=e.substring(c.raw.length),n.push(c),!0):!1))continue;if(c=this.tokenizer.escape(e)){e=e.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.tag(e)){e=e.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.link(e)){e=e.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(c.raw.length);let u=n.at(-1);c.type==="text"&&u?.type==="text"?(u.raw+=c.raw,u.text+=c.text):n.push(c);continue}if(c=this.tokenizer.emStrong(e,r,a)){e=e.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.codespan(e)){e=e.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.br(e)){e=e.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.del(e)){e=e.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.autolink(e)){e=e.substring(c.raw.length),n.push(c);continue}if(!this.state.inLink&&(c=this.tokenizer.url(e))){e=e.substring(c.raw.length),n.push(c);continue}let l=e;if(this.options.extensions?.startInline){let u=1/0,h=e.slice(1),f;this.options.extensions.startInline.forEach(d=>{f=d.call({lexer:this},h),typeof f=="number"&&f>=0&&(u=Math.min(u,f))}),u<1/0&&u>=0&&(l=e.substring(0,u+1))}if(c=this.tokenizer.inlineText(l)){e=e.substring(c.raw.length),c.raw.slice(-1)!=="_"&&(a=c.raw.slice(-1)),o=!0;let u=n.at(-1);u?.type==="text"?(u.raw+=c.raw,u.text+=c.text):n.push(c);continue}if(e){let u="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return n}},JM=class{options;parser;constructor(e){this.options=e||cb}space(e){return""}code({text:e,lang:n,escaped:r}){let i=(n||"").match(fu.notSpaceStart)?.[0],s=e.replace(fu.endingNewline,"")+`
`;return i?'<pre><code class="language-'+cm(i)+'">'+(r?s:cm(s,!0))+`</code></pre>
`:"<pre><code>"+(r?s:cm(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:n}){return`<h${n}>${this.parser.parseInline(e)}</h${n}>
`}hr(e){return`<hr>
`}list(e){let n=e.ordered,r=e.start,i="";for(let a=0;a<e.items.length;a++){let c=e.items[a];i+=this.listitem(c)}let s=n?"ol":"ul",o=n&&r!==1?' start="'+r+'"':"";return"<"+s+o+`>
`+i+"</"+s+`>
`}listitem(e){let n="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+cm(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):n+=r+" "}return n+=this.parser.parse(e.tokens,!!e.loose),`<li>${n}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let n="",r="";for(let s=0;s<e.header.length;s++)r+=this.tablecell(e.header[s]);n+=this.tablerow({text:r});let i="";for(let s=0;s<e.rows.length;s++){let o=e.rows[s];r="";for(let a=0;a<o.length;a++)r+=this.tablecell(o[a]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+n+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let n=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+n+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${cm(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:n,tokens:r}){let i=this.parser.parseInline(r),s=y$(e);if(s===null)return i;e=s;let o='<a href="'+e+'"';return n&&(o+=' title="'+cm(n)+'"'),o+=">"+i+"</a>",o}image({href:e,title:n,text:r,tokens:i}){i&&(r=this.parser.parseInline(i,this.parser.textRenderer));let s=y$(e);if(s===null)return cm(r);e=s;let o=`<img src="${e}" alt="${r}"`;return n&&(o+=` title="${cm(n)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:cm(e.text)}},sU=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},Qd=class d4{options;renderer;textRenderer;constructor(e){this.options=e||cb,this.options.renderer=this.options.renderer||new JM,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new sU}static parse(e,n){return new d4(n).parse(e)}static parseInline(e,n){return new d4(n).parseInline(e)}parse(e,n=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=s,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){r+=c||"";continue}}let o=s;switch(o.type){case"space":{r+=this.renderer.space(o);continue}case"hr":{r+=this.renderer.hr(o);continue}case"heading":{r+=this.renderer.heading(o);continue}case"code":{r+=this.renderer.code(o);continue}case"table":{r+=this.renderer.table(o);continue}case"blockquote":{r+=this.renderer.blockquote(o);continue}case"list":{r+=this.renderer.list(o);continue}case"html":{r+=this.renderer.html(o);continue}case"def":{r+=this.renderer.def(o);continue}case"paragraph":{r+=this.renderer.paragraph(o);continue}case"text":{let a=o,c=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],c+=`
`+this.renderer.text(a);n?r+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):r+=c;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(e,n=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=a||"";continue}}let o=s;switch(o.type){case"escape":{r+=n.text(o);break}case"html":{r+=n.html(o);break}case"link":{r+=n.link(o);break}case"image":{r+=n.image(o);break}case"strong":{r+=n.strong(o);break}case"em":{r+=n.em(o);break}case"codespan":{r+=n.codespan(o);break}case"br":{r+=n.br(o);break}case"del":{r+=n.del(o);break}case"text":{r+=n.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},RT=class{options;block;constructor(t){this.options=t||cb}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Zd.lex:Zd.lexInline}provideParser(){return this.block?Qd.parse:Qd.parseInline}},uBe=class{defaults=J8();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Qd;Renderer=JM;TextRenderer=sU;Lexer=Zd;Tokenizer=XM;Hooks=RT;constructor(...t){this.use(...t)}walkTokens(t,e){let n=[];for(let r of t)switch(n=n.concat(e.call(this,r)),r.type){case"table":{let i=r;for(let s of i.header)n=n.concat(this.walkTokens(s.tokens,e));for(let s of i.rows)for(let o of s)n=n.concat(this.walkTokens(o.tokens,e));break}case"list":{let i=r;n=n.concat(this.walkTokens(i.items,e));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let o=i[s].flat(1/0);n=n.concat(this.walkTokens(o,e))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let s=e.renderers[i.name];s?e.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[i.level];s?s.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),n.renderer){let i=this.defaults.renderer||new JM(this.defaults);for(let s in n.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=n.renderer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u||""}}r.renderer=i}if(n.tokenizer){let i=this.defaults.tokenizer||new XM(this.defaults);for(let s in n.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=n.tokenizer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}r.tokenizer=i}if(n.hooks){let i=this.defaults.hooks||new RT;for(let s in n.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=n.hooks[o],c=i[o];RT.passThroughHooks.has(s)?i[o]=l=>{if(this.defaults.async&&RT.passThroughHooksRespectAsync.has(s))return(async()=>{let h=await a.call(i,l);return c.call(i,h)})();let u=a.call(i,l);return c.call(i,u)}:i[o]=(...l)=>{if(this.defaults.async)return(async()=>{let h=await a.apply(i,l);return h===!1&&(h=await c.apply(i,l)),h})();let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}r.hooks=i}if(n.walkTokens){let i=this.defaults.walkTokens,s=n.walkTokens;r.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Zd.lex(t,e??this.defaults)}parser(t,e){return Qd.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},i={...this.defaults,...r},s=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=t),i.async)return(async()=>{let o=i.hooks?await i.hooks.preprocess(e):e,a=await(i.hooks?await i.hooks.provideLexer():t?Zd.lex:Zd.lexInline)(o,i),c=i.hooks?await i.hooks.processAllTokens(a):a;i.walkTokens&&await Promise.all(this.walkTokens(c,i.walkTokens));let l=await(i.hooks?await i.hooks.provideParser():t?Qd.parse:Qd.parseInline)(c,i);return i.hooks?await i.hooks.postprocess(l):l})().catch(s);try{i.hooks&&(e=i.hooks.preprocess(e));let o=(i.hooks?i.hooks.provideLexer():t?Zd.lex:Zd.lexInline)(e,i);i.hooks&&(o=i.hooks.processAllTokens(o)),i.walkTokens&&this.walkTokens(o,i.walkTokens);let a=(i.hooks?i.hooks.provideParser():t?Qd.parse:Qd.parseInline)(o,i);return i.hooks&&(a=i.hooks.postprocess(a)),a}catch(o){return s(o)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+cm(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},V1=new uBe;function vs(t,e){return V1.parse(t,e)}vs.options=vs.setOptions=function(t){return V1.setOptions(t),vs.defaults=V1.defaults,cne(vs.defaults),vs};vs.getDefaults=J8;vs.defaults=cb;vs.use=function(...t){return V1.use(...t),vs.defaults=V1.defaults,cne(vs.defaults),vs};vs.walkTokens=function(t,e){return V1.walkTokens(t,e)};vs.parseInline=V1.parseInline;vs.Parser=Qd;vs.parser=Qd.parse;vs.Renderer=JM;vs.TextRenderer=sU;vs.Lexer=Zd;vs.lexer=Zd.lex;vs.Tokenizer=XM;vs.Hooks=RT;vs.parse=vs;vs.options;vs.setOptions;vs.use;vs.walkTokens;vs.parseInline;Qd.parse;Zd.lex;function fg(t,e){switch(e.type){default:console.info("unknown",e);break;case"heading":Sv(qe,t,e.text),zr(qe,t," ");break;case"hr":zr(qe,t," "),Dte(qe,t,10),zr(qe,t," ");break;case"paragraph":for(let n=0;n<(e.tokens?.length??0);++n)fe(e.tokens?.[n])&&fg(t,e.tokens[n]);break;case"code":e.text.split(`
`).forEach(n=>zr(qe,t,n.replace(/\s+/g," ").trim()));break;case"text":zr(qe,t,e.text);break;case"link":{const[n,...r]=e.text.split("|").map(s=>s.trim()),i=[...r,e.href??""];a4(qe,t,i.join(" "),n);break}case"image":a4(qe,t,`openit ${e.href}`,`show ${e.title??e.href}`);break;case"blockquote":e.text.split(`
`).forEach(n=>{zr(qe,t,`$dkpurple$221$white  ${n}`)}),zr(qe,t," ");break;case"list":for(let n=0;n<(e.items?.length??0);++n)fe(e.items?.[n])&&fg(t,e.items[n]);zr(qe,t," ");break;case"list_item":zr(qe,t,` $grey$7 ${e.text}`);break}}function oU(t,e){vs.use({pedantic:!1,gfm:!0,breaks:!1,renderer:{heading(n){return fg(t,n),""},code(n){return fg(t,n),""},blockquote(n){return fg(t,n),""},hr(n){return fg(t,n),""},list(n){return fg(t,n),""},listitem(n){return fg(t,n),""},paragraph(n){return fg(t,n),""}}}),vs.parse(e)}async function px(t,e={},n){return window.__TAURI_INTERNALS__.invoke(t,e,n)}var qE;(function(t){t[t.Audio=1]="Audio",t[t.Cache=2]="Cache",t[t.Config=3]="Config",t[t.Data=4]="Data",t[t.LocalData=5]="LocalData",t[t.Document=6]="Document",t[t.Download=7]="Download",t[t.Picture=8]="Picture",t[t.Public=9]="Public",t[t.Video=10]="Video",t[t.Resource=11]="Resource",t[t.Temp=12]="Temp",t[t.AppConfig=13]="AppConfig",t[t.AppData=14]="AppData",t[t.AppLocalData=15]="AppLocalData",t[t.AppCache=16]="AppCache",t[t.AppLog=17]="AppLog",t[t.Desktop=18]="Desktop",t[t.Executable=19]="Executable",t[t.Font=20]="Font",t[t.Home=21]="Home",t[t.Runtime=22]="Runtime",t[t.Template=23]="Template"})(qE||(qE={}));async function hBe(){return px("plugin:path|resolve_directory",{directory:qE.AppData})}async function fBe(...t){return px("plugin:path|join",{paths:t})}var E$;(function(t){t[t.Start=0]="Start",t[t.Current=1]="Current",t[t.End=2]="End"})(E$||(E$={}));async function dBe(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await px("plugin:fs|mkdir",{path:t instanceof URL?t.toString():t,options:e})}async function pBe(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const n=await px("plugin:fs|read_text_file",{path:t instanceof URL?t.toString():t,options:e}),r=n instanceof ArrayBuffer?n:Uint8Array.from(n);return new TextDecoder().decode(r)}async function mBe(t,e,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const r=new TextEncoder;await px("plugin:fs|write_text_file",r.encode(e),{headers:{path:encodeURIComponent(t instanceof URL?t.toString():t),options:JSON.stringify(n)}})}async function gBe(t){return px("plugin:opener|reveal_item_in_dir",{paths:typeof t=="string"?[t]:t})}function aU(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function _Be(t,e){let n;const r=()=>{if(n)return n;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),n=aU(i),n.then(s=>{s.onclose=()=>n=void 0},()=>{}),n};return(i,s)=>r().then(o=>s(o.transaction(e,i).objectStore(e)))}let E2;function yne(){return E2||(E2=_Be("keyval-store","keyval")),E2}function bne(t,e=yne()){return e("readonly",n=>aU(n.get(t)))}function Sne(t,e,n=yne()){return n("readwrite",r=>new Promise((i,s)=>{r.get(t).onsuccess=function(){try{r.put(e(this.result),t),i(aU(r.transaction))}catch(o){s(o)}}}))}const FI=typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window),AA="zss-content.json";async function YE(t){return bne(t)}async function ZM(t,e){return Sne(t,e)}function vBe(t){return t==="crt"?"on":"off"}async function Mk(t){const e=await YE(`config_${t}`);return e?e&&e!=="off"?"on":"off":vBe(t)}async function yBe(){return YE("HISTORYBUFFER")}async function x$(t){return ZM("HISTORYBUFFER",()=>t)}async function bBe(t){let e=await YE(t);if(e===void 0){for(;e===void 0;){const n=X5({addAdverb:!0,capitalize:!1,adjectiveCount:2});await YE(n)===void 0&&(e=n)}await ZM(t,()=>e),await ZM(e,()=>t)}return e}async function SBe(t){return await YE(t)}function Ene(t){try{const e=location.hash.slice(1);if(e.length)return e}catch(e){_r(qe,t,"crash",e.message)}return""}async function cU(t){const e=Ene(t);if(FI){if(e.length)return zr(qe,t,"reading url content, make sure to save"),location.hash="",e;try{zr(qe,t,`reading ${AA}`);const n=await pBe(AA,{baseDir:qE.AppData});return JSON.parse(n)}catch(n){return _r(qe,t,"readcontent",n.toString()),[]}}if(e.length){const n=await SBe(e);return fe(n)&&n.length>e.length?n:e}return""}async function xne(t,e,n,r,i){if(FI){try{zr(qe,t,`writing ${AA}`),await mBe(AA,JSON.stringify(i,null,2),{baseDir:qE.AppData,create:!0})}catch(o){_r(qe,t,"writecontent",o.toString())}return}if(r.length>2048){const o=await bBe(r);return xne(t,e,n,o,i)}const s=`#${r}`;if(location.hash!==s){CA=r,location.hash=s;const o=`wrote ${n.length} chars [${n.slice(0,8)}...${n.slice(-8)}]`;e.includes("autosave")||us(qe,t,o),document.title=e}}async function wne(){return await YE("storage")??{}}async function EBe(t,e){const n=await wne();return n[t]=e,ZM("storage",()=>n)}let CA="";async function xBe(t){if(FI){await dBe("",{baseDir:qE.AppData,recursive:!0});try{const e=await hBe(),n=await fBe(e,AA);await gBe(n)}catch(e){_r(qe,t,"storage",e.toString())}return}window.addEventListener("hashchange",()=>{io(qe,t,async()=>{const e=Ene(t);if(CA!==e){CA=e;const n=await cU(t);MK(qe,t,n)}})})}async function wBe(t){const e=await cU(t);if(Kn(e)){_r(qe,t,"storage","#share not supported in server mode");return}const n=`#${e}`;CA=e,location.hash=n;const r=await jte(location.href);c4(qe,t,r,r)}function TBe(t){if(FI){_r(qe,t,"storage","#nuke not supported in server mode");return}location.hash="",CA=location.hash,location.reload()}function w$(t){const e=Ye.useRef(null);return n=>{const r=t(n);return(e.current===void 0||r===void 0?e.current===r:J_(e.current,r))?e.current:e.current=r}}const Kr=Pv(()=>({desync:!1,zsswords:{cli:[],loader:[],runtime:[],flags:[],stats:[],kinds:[],altkinds:[],colors:[],dirs:[],dirmods:[],exprs:[]},gadget:{id:"",board:"",exiteast:"",exitwest:"",exitnorth:"",exitsouth:"",layers:[],tickers:[],scrollname:"",scroll:[],sidebar:[]},layercache:{},slim:[]})),ABe=256;var Wf=(t=>(t[t.TOP=0]="TOP",t[t.FULL=1]="FULL",t[t.BOTTOM=2]="BOTTOM",t[t.SPLIT_X=3]="SPLIT_X",t[t.MAX=4]="MAX",t))(Wf||{});const ls=Pv(t=>({layout:0,inspector:!1,quickterminal:!1,toast:"",terminal:{open:!0,info:[],logs:[]},editor:{open:!1,book:"",path:[],type:"",title:""},reset(){t({layout:0,inspector:!1,quickterminal:!1,toast:"",terminal:{open:!0,logs:[]},editor:{open:!1,book:"",path:[],type:"",title:""}})}})),Ai=Pv(t=>({pan:0,scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""],reset(){t({pan:0,scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""]})}})),Zc=Pv(t=>({xscroll:0,yscroll:0,cursor:0,select:void 0,reset(){t({xscroll:0,yscroll:0,cursor:0,select:void 0})}})),ev=Pv(t=>({pts:[],cursor:void 0,select:void 0,reset(){t({pts:[],cursor:void 0,select:void 0})}}));function CBe(t){return t.type===Ji.TILES}function RBe(t){return t.type===Ji.SPRITES}function QM(t){const e=Ft.ONCLEAR;return t<=e?t:t-e}function kBe(t,e,n){const r=e*n,i=new Array(r).fill(0),s=new Array(r).fill(0),o=new Array(r).fill(Ft.ONCLEAR),a=[...t].filter(CBe).reverse();for(let c=0;c<r;c++){const l=c%e,u=Math.floor(c/e);for(let h=0;h<a.length;h++){const f=a[h];if(l>=f.width||u>=f.height)continue;const d=l+u*f.width,p=f.char[d]??0,m=QM(f.color[d]??0),g=QM(f.bg[d]??0);if(p!==0||g!==0){i[c]=p,s[c]=m,o[c]=g;break}}}return{char:i,color:s,bg:o}}function MBe(t){const e=[];for(const n of t)if(RBe(n))for(const r of n.sprites)r.pid||e.push({x:r.x,y:r.y,char:r.char,color:QM(r.color),bg:QM(r.bg)});return e}function OBe(t){return t.replace(/[^a-zA-Z0-9._-]/g,"_")||"board"}function IBe(){const{charsetdata:t,palettedata:e}=va.getState(),{board:n,layers:r=[]}=Kr.getState().gadget;if(!fe(t)||!fe(e))throw new Error("charsetdata or palettedata not loaded");const{width:i,height:s}=q1(r);if(i===0||s===0)throw new Error("No tile layers to capture");const o=kBe(r,i,s),a=MBe(r),c=kn.DRAW_CHAR_WIDTH(),l=kn.DRAW_CHAR_HEIGHT(),u=document.createElement("canvas");u.width=i*c,u.height=s*l;const h=u.getContext("2d");if(!h)throw new Error("Could not get canvas 2d context");const f=t.image,d=f.getContext("2d");if(!d)throw new Error("Could not get charset canvas context");const m=d.getImageData(0,0,f.width,f.height).data,g=h.createImageData(u.width,u.height),_=g.data,y=e[0];for(let A=0;A<_.length;A+=4)_[A]=Math.round(y.r*255),_[A+1]=Math.round(y.g*255),_[A+2]=Math.round(y.b*255),_[A+3]=255;for(let A=0;A<s;A++)for(let T=0;T<i;T++){const k=T+A*i,L=o.char[k]??1,I=o.color[k]??0,F=o.bg[k]??0,M=L%yo,D=Math.floor(L/yo),O=M*Yo,z=D*Ia,q=e[I],G=e[F];for(let K=0;K<l;K++)for(let te=0;te<c;te++){const re=O+Math.floor(te/kn.DRAW_CHAR_SCALE),H=z+Math.floor(K/kn.DRAW_CHAR_SCALE),Y=(re+H*f.width)*4,Z=m[Y],Q=T*c+te,ie=A*l+K,ge=(Q+ie*u.width)*4;Z===0?G&&(_[ge]=Math.round(G.r*255),_[ge+1]=Math.round(G.g*255),_[ge+2]=Math.round(G.b*255)):(_[ge]=Math.round(q.r*255),_[ge+1]=Math.round(q.g*255),_[ge+2]=Math.round(q.b*255)),_[ge+3]=255}}for(const A of a){const T=Math.floor(A.x),k=Math.floor(A.y);if(T<0||T>=i||k<0||k>=s)continue;const L=A.char%yo,I=Math.floor(A.char/yo),F=L*Yo,M=I*Ia,D=e[A.color],O=e[A.bg];for(let z=0;z<l;z++)for(let q=0;q<c;q++){const G=F+Math.floor(q/kn.DRAW_CHAR_SCALE),K=M+Math.floor(z/kn.DRAW_CHAR_SCALE),te=(G+K*f.width)*4,re=m[te],H=T*c+q,Y=k*l+z,Z=(H+Y*u.width)*4;re===0?O&&(_[Z]=Math.round(O.r*255),_[Z+1]=Math.round(O.g*255),_[Z+2]=Math.round(O.b*255)):(_[Z]=Math.round(D.r*255),_[Z+1]=Math.round(D.g*255),_[Z+2]=Math.round(D.b*255)),_[Z+3]=255}}h.putImageData(g,0,0);const v=u.toDataURL("image/png"),E=`${OBe(n)}.png`,x=document.createElement("a");x.href=v,x.download=E,x.click()}var Ok={exports:{}},NBe=Ok.exports,T$;function PBe(){return T$||(T$=1,(function(t,e){(function(n,r){t.exports=r()})(NBe,(()=>(()=>{var n={944:function(o){var a;a=()=>(()=>{var c={d:(_,y)=>{for(var v in y)c.o(y,v)&&!c.o(_,v)&&Object.defineProperty(_,v,{enumerable:!0,get:y[v]})},o:(_,y)=>Object.prototype.hasOwnProperty.call(_,y)},l={};function u(_){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},u(_)}function h(_,y){var v=typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(!v){if(Array.isArray(_)||(v=d(_))||y){v&&(_=v);var E=0,x=function(){};return{s:x,n:function(){return E>=_.length?{done:!0}:{done:!1,value:_[E++]}},e:function(L){throw L},f:x}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var A,T=!0,k=!1;return{s:function(){v=v.call(_)},n:function(){var L=v.next();return T=L.done,L},e:function(L){k=!0,A=L},f:function(){try{T||v.return==null||v.return()}finally{if(k)throw A}}}}function f(_,y){return(function(v){if(Array.isArray(v))return v})(_)||(function(v,E){var x=v==null?null:typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(x!=null){var A,T,k,L,I=[],F=!0,M=!1;try{if(k=(x=x.call(v)).next,E!==0)for(;!(F=(A=k.call(x)).done)&&(I.push(A.value),I.length!==E);F=!0);}catch(D){M=!0,T=D}finally{try{if(!F&&x.return!=null&&(L=x.return(),Object(L)!==L))return}finally{if(M)throw T}}return I}})(_,y)||d(_,y)||(function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function d(_,y){if(_){if(typeof _=="string")return p(_,y);var v=Object.prototype.toString.call(_).slice(8,-1);return v==="Object"&&_.constructor&&(v=_.constructor.name),v==="Map"||v==="Set"?Array.from(_):v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?p(_,y):void 0}}function p(_,y){(y==null||y>_.length)&&(y=_.length);for(var v=0,E=new Array(y);v<y;v++)E[v]=_[v];return E}function m(_,y){if(!(_ instanceof y))throw new TypeError("Cannot call a class as a function")}c.d(l,{default:()=>g});var g=(function(){function _(){var E=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];m(this,_),this.strict=E,this.defaults=new Map,this.validators=new Map,this.types=new Map,this.optional=new Set,this.required=new Set}var y,v;return y=_,(v=[{key:"allowExtra",value:function(){return this.strict=!1,this}},{key:"setDefaults",value:function(E){var x=this;return Object.entries(E).forEach((function(A){var T=f(A,2),k=T[0],L=T[1];return x.defaults.set(k,L)})),this}},{key:"setValidators",value:function(E){var x=this;return Object.entries(E).forEach((function(A){var T=f(A,2),k=T[0],L=T[1];return x.validators.set(k,L)})),this}},{key:"setTypes",value:function(E){var x=this;return Object.entries(E).forEach((function(A){var T=f(A,2),k=T[0],L=T[1];return x.types.set(k,L)})),this}},{key:"setOptional",value:function(E){var x=this;return E.forEach((function(A){return x.optional.add(A)})),this}},{key:"setRequired",value:function(E){var x=this;return E.forEach((function(A){return x.required.add(A)})),this}},{key:"resolve",value:function(E){return this.validate(Object.assign(this.getDefaults(),E))}},{key:"getDefaults",value:function(){var E,x={},A=h(this.defaults);try{for(A.s();!(E=A.n()).done;){var T=f(E.value,2),k=T[0],L=T[1];x[k]=L}}catch(I){A.e(I)}finally{A.f()}return x}},{key:"validate",value:function(E){for(var x in E)this.validators.has(x)&&(E[x]=this.validators.get(x)(E[x]));for(var A in E){if(!this.optionExists(A))throw new Error('Unkown option "'.concat(A,'".'));this.checkType(A,E[A])}var T,k=h(this.required.values());try{for(k.s();!(T=k.n()).done;){var L=T.value;if(E[L]===void 0)throw new Error('Option "'.concat(L,'" is required.'))}}catch(I){k.e(I)}finally{k.f()}return E}},{key:"checkType",value:function(E,x){if(this.types.has(E)){var A=this.types.get(E),T=u(x);if(T!==A)throw new Error('Wrong value for option "'.concat(E,'": expected type "').concat(A,'", got "').concat(T,'".'))}}},{key:"optionExists",value:function(E){return!this.strict||this.defaults.has(E)||this.validators.has(E)||this.optional.has(E)||this.required.has(E)||this.types.has(E)}}])&&(function(E,x){for(var A=0;A<x.length;A++){var T=x[A];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(E,(k=(function(L,I){if(u(L)!=="object"||L===null)return L;var F=L[Symbol.toPrimitive];if(F!==void 0){var M=F.call(L,"string");if(u(M)!=="object")return M;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(L)})(T.key),u(k)==="symbol"?k:String(k)),T)}var k})(y.prototype,v),Object.defineProperty(y,"prototype",{writable:!1}),_})();return l.default})(),o.exports=a()},162:function(o){o.exports=(()=>{var a={d:(u,h)=>{for(var f in h)a.o(h,f)&&!a.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:h[f]})},o:(u,h)=>Object.prototype.hasOwnProperty.call(u,h)},c={};a.d(c,{default:()=>l});var l=(function(){function u(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,u),this._events={},this.on=this.addEventListener,this.off=this.removeEventListener}var h;return(h=[{key:"emit",value:function(f,d){if(Object.prototype.hasOwnProperty.call(this._events,f))for(var p=this._events[f],m={type:f,detail:d},g=p.length,_=0;_<g;_++)this.handle(p[_],m)}},{key:"handle",value:function(f,d){f(d)}},{key:"addEventListener",value:function(f,d){Object.prototype.hasOwnProperty.call(this._events,f)||(this._events[f]=[]),this._events[f].indexOf(d)<0&&this._events[f].push(d)}},{key:"removeEventListener",value:function(f,d){if(Object.prototype.hasOwnProperty.call(this._events,f)){var p=this._events[f],m=p.indexOf(d);m>=0&&p.splice(m,1),p.length===0&&delete this._events[f]}}}])&&(function(f,d){for(var p=0;p<d.length;p++){var m=d[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(f,m.key,m)}})(u.prototype,h),u})();return c.default})()}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={exports:{}};return n[o].call(c.exports,c,c.exports,i),c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{GamepadHandler:()=>E,GamepadListener:()=>G});var o=i(162),a=i.n(o),c=i(944),l=i.n(c);function u(K){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},u(K)}function h(K,te){if(!(K instanceof te))throw new TypeError("Cannot call a class as a function")}function f(K,te){for(var re=0;re<te.length;re++){var H=te[re];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(K,g(H.key),H)}}function d(K,te){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(re,H){return re.__proto__=H,re},d(K,te)}function p(K,te){if(te&&(u(te)==="object"||typeof te=="function"))return te;if(te!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(re){if(re===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return re})(K)}function m(K){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(te){return te.__proto__||Object.getPrototypeOf(te)},m(K)}function g(K){var te=(function(re,H){if(u(re)!=="object"||re===null)return re;var Y=re[Symbol.toPrimitive];if(Y!==void 0){var Z=Y.call(re,"string");if(u(Z)!=="object")return Z;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(re)})(K);return u(te)==="symbol"?te:String(te)}var _,y,v,E=(function(K){(function(ge,Te){if(typeof Te!="function"&&Te!==null)throw new TypeError("Super expression must either be null or a function");ge.prototype=Object.create(Te&&Te.prototype,{constructor:{value:ge,writable:!0,configurable:!0}}),Object.defineProperty(ge,"prototype",{writable:!1}),Te&&d(ge,Te)})(ie,K);var te,re,H,Y,Z,Q=(Y=ie,Z=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ge,Te=m(Y);if(Z){var be=m(this).constructor;ge=Reflect.construct(Te,arguments,be)}else ge=Te.apply(this,arguments);return p(this,ge)});function ie(ge,Te){var be,Pe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return h(this,ie),(be=Q.call(this)).index=ge,be.gamepad=Te,be.options=be.constructor.resolveOptions(Pe),be.axes=new Array(Te.axes.length).fill(null),be.buttons=new Array(Te.buttons.length).fill(null),be.initAxes(),be.initButtons(),be}return te=ie,H=[{key:"resolveOptions",value:function(ge){var Te,be,Pe,Ge,Ze=ge.axis,lt=ge.button;return{axis:this.optionResolver.resolve((Te=(be=Ze??lt)!==null&&be!==void 0?be:ge)!==null&&Te!==void 0?Te:{}),button:this.optionResolver.resolve((Pe=(Ge=lt??Ze)!==null&&Ge!==void 0?Ge:ge)!==null&&Pe!==void 0?Pe:{})}}}],(re=[{key:"initAxes",value:function(){for(var ge=this.axes.length,Te=0;Te<ge;Te++)this.axes[Te]=this.resolveAxisValue(Te)}},{key:"initButtons",value:function(){for(var ge=this.buttons.length,Te=0;Te<ge;Te++)this.buttons[Te]=this.resolveButtonValue(Te)}},{key:"update",value:function(ge){this.gamepad=ge,this.updateAxis(),this.updateButtons()}},{key:"updateAxis",value:function(){for(var ge=this.axes.length,Te=0;Te<ge;Te++)this.setAxisValue(Te,this.resolveAxisValue(Te))}},{key:"updateButtons",value:function(){for(var ge=this.buttons.length,Te=0;Te<ge;Te++)this.setButtonValue(Te,this.resolveButtonValue(Te))}},{key:"setAxisValue",value:function(ge,Te){this.axes[ge]!==Te&&(this.axes[ge]=Te,this.emit("axis",{gamepad:this.gamepad,index:this.index,axis:ge,value:Te}))}},{key:"setButtonValue",value:function(ge,Te){this.buttons[ge]!==Te&&(this.buttons[ge]=Te,this.emit("button",{gamepad:this.gamepad,index:this.index,button:ge,pressed:this.gamepad.buttons[ge].pressed,value:Te}))}},{key:"resolveAxisValue",value:function(ge){var Te=this.options.axis,be=Te.deadZone,Pe=Te.analog,Ge=Te.precision,Ze=this.gamepad.axes[ge];return be&&Ze<be&&Ze>-be?0:Pe?Ge?Math.round(Ze*Ge)/Ge:Ze:Ze>0?1:Ze<0?-1:0}},{key:"resolveButtonValue",value:function(ge){var Te=this.options.button,be=Te.deadZone,Pe=Te.analog,Ge=Te.precision,Ze=this.gamepad.buttons[ge].value;return be>0&&Ze<be&&Ze>-be?0:Pe?Ge?Math.round(Ze*Ge)/Ge:Ze:Ze===0?0:1}}])&&f(te.prototype,re),H&&f(te,H),Object.defineProperty(te,"prototype",{writable:!1}),ie})(a());function x(K){return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},x(K)}function A(K,te){for(var re=0;re<te.length;re++){var H=te[re];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(K,T(H.key),H)}}function T(K){var te=(function(re,H){if(x(re)!=="object"||re===null)return re;var Y=re[Symbol.toPrimitive];if(Y!==void 0){var Z=Y.call(re,"string");if(x(Z)!=="object")return Z;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(re)})(K);return x(te)==="symbol"?te:String(te)}_=E,y="optionResolver",v=new(l())().setDefaults({analog:!0,deadZone:0,precision:0}).setTypes({analog:"boolean",deadZone:"number",precision:"number"}).setValidators({deadZone:function(K){return Math.max(Math.min(K,1),0)},precision:function(K){return K>0?Math.pow(10,K):0}}),(y=g(y))in _?Object.defineProperty(_,y,{value:v,enumerable:!0,configurable:!0,writable:!0}):_[y]=v;var k=(function(){function K(H){(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,K),this.callback=H,this.frame=null,this.update=this.update.bind(this)}var te,re;return te=K,(re=[{key:"setCallback",value:function(H){this.callback=H}},{key:"start",value:function(){this.frame||(this.frame=window.requestAnimationFrame(this.update))}},{key:"stop",value:function(){this.frame&&(window.cancelAnimationFrame(this.frame),this.frame=null)}},{key:"update",value:function(){this.frame=window.requestAnimationFrame(this.update),this.callback()}}])&&A(te.prototype,re),Object.defineProperty(te,"prototype",{writable:!1}),K})();function L(K){return L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},L(K)}function I(K,te){if(!(K instanceof te))throw new TypeError("Cannot call a class as a function")}function F(K,te){for(var re=0;re<te.length;re++){var H=te[re];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(K,M(H.key),H)}}function M(K){var te=(function(re,H){if(L(re)!=="object"||re===null)return re;var Y=re[Symbol.toPrimitive];if(Y!==void 0){var Z=Y.call(re,"string");if(L(Z)!=="object")return Z;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(re)})(K);return L(te)==="symbol"?te:String(te)}function D(K,te){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(re,H){return re.__proto__=H,re},D(K,te)}function O(K,te){if(te&&(L(te)==="object"||typeof te=="function"))return te;if(te!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return z(K)}function z(K){if(K===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K}function q(K){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(te){return te.__proto__||Object.getPrototypeOf(te)},q(K)}var G=(function(K){(function(ie,ge){if(typeof ge!="function"&&ge!==null)throw new TypeError("Super expression must either be null or a function");ie.prototype=Object.create(ge&&ge.prototype,{constructor:{value:ie,writable:!0,configurable:!0}}),Object.defineProperty(ie,"prototype",{writable:!1}),ge&&D(ie,ge)})(Q,K);var te,re,H,Y,Z=(H=Q,Y=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ie,ge=q(H);if(Y){var Te=q(this).constructor;ie=Reflect.construct(ge,arguments,Te)}else ie=ge.apply(this,arguments);return O(this,ie)});function Q(){var ie,ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(I(this,Q),ie=Z.call(this),typeof navigator.getGamepads!="function")throw new Error("This browser does not support gamepad API.");return ie.options=ge,ie.onAxis=ie.onAxis.bind(z(ie)),ie.update=ie.update.bind(z(ie)),ie.start=ie.start.bind(z(ie)),ie.stop=ie.stop.bind(z(ie)),ie.discover=ie.discover.bind(z(ie)),ie.onButton=ie.onButton.bind(z(ie)),ie.handlers=new Array(4).fill(null),ie.loop=new k(ie.update),window.addEventListener("error",ie.stop),ie}return te=Q,(re=[{key:"start",value:function(){this.loop.start()}},{key:"stop",value:function(){this.loop.stop()}},{key:"update",value:function(){var ie=navigator.getGamepads();this.discover(ie[0],0),this.discover(ie[1],1),this.discover(ie[2],2),this.discover(ie[3],3)}},{key:"discover",value:function(ie,ge){ie?(this.handlers[ge]===null&&this.registerHandler(ge,ie),this.handlers[ge].update(ie)):this.handlers[ge]&&this.removeGamepad(ge)}},{key:"registerHandler",value:function(ie,ge){var Te=new E(ie,ge,this.options);this.handlers[ie]=Te,Te.addEventListener("axis",this.onAxis),Te.addEventListener("button",this.onButton),this.emit("gamepad:connected",{index:ie,gamepad:ge}),this.emit("gamepad:".concat(ie,":connected"),{index:ie,gamepad:ge})}},{key:"removeGamepad",value:function(ie){var ge=this.handlers[ie];ge.removeEventListener("axis",this.onAxis),ge.removeEventListener("button",this.onButton),this.handlers[ie]=null,this.emit("gamepad:disconnected",{index:ie}),this.emit("gamepad:".concat(ie,":disconnected"),{index:ie})}},{key:"onAxis",value:function(ie){var ge=ie.detail.index;this.emit("gamepad:axis",ie.detail),this.emit("gamepad:".concat(ge,":axis"),ie.detail),this.emit("gamepad:".concat(ge,":axis:").concat(ie.detail.axis),ie.detail)}},{key:"onButton",value:function(ie){var ge=ie.detail.index;this.emit("gamepad:button",ie.detail),this.emit("gamepad:".concat(ge,":button"),ie.detail),this.emit("gamepad:".concat(ge,":button:").concat(ie.detail.button),ie.detail)}}])&&F(te.prototype,re),Object.defineProperty(te,"prototype",{writable:!1}),Q})(a())})(),s})()))})(Ok)),Ok.exports}var DBe=PBe(),$d={},A$;function LBe(){if(A$)return $d;A$=1,Object.defineProperty($d,"__esModule",{value:!0});for(var t=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),e={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},n={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:t?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},r={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},i=1;i<20;i++)r["f"+i]=111+i;function s(f,d,p){d&&!("byKey"in d)&&(p=d,d=null),Array.isArray(f)||(f=[f]);var m=f.map(function(y){return c(y,d)}),g=function(v){return m.some(function(E){return l(E,v)})},_=p==null?g:g(p);return _}function o(f,d){return s(f,d)}function a(f,d){return s(f,{byKey:!0},d)}function c(f,d){var p=d&&d.byKey,m={};f=f.replace("++","+add");var g=f.split("+"),_=g.length;for(var y in e)m[e[y]]=!1;var v=!0,E=!1,x=void 0;try{for(var A=g[Symbol.iterator](),T;!(v=(T=A.next()).done);v=!0){var k=T.value,L=k.endsWith("?")&&k.length>1;L&&(k=k.slice(0,-1));var I=h(k),F=e[I];if(k.length>1&&!F&&!n[k]&&!r[I])throw new TypeError('Unknown modifier: "'+k+'"');(_===1||!F)&&(p?m.key=I:m.which=u(k)),F&&(m[F]=L?null:!0)}}catch(M){E=!0,x=M}finally{try{!v&&A.return&&A.return()}finally{if(E)throw x}}return m}function l(f,d){for(var p in f){var m=f[p],g=void 0;if(m!=null&&(p==="key"&&d.key!=null?g=d.key.toLowerCase():p==="which"?g=m===91&&d.which===93?91:d.which:g=d[p],!(g==null&&m===!1)&&g!==m))return!1}return!0}function u(f){f=h(f);var d=r[f]||f.toUpperCase().charCodeAt(0);return d}function h(f){return f=f.toLowerCase(),f=n[f]||f,f}return $d.default=s,$d.isHotkey=s,$d.isCodeHotkey=o,$d.isKeyHotkey=a,$d.parseHotkey=c,$d.compareHotkey=l,$d.toKeyCode=u,$d.toKeyName=h,$d}var UBe=LBe();const C$=_u(UBe);function Tne(t){return{all:t=t||new Map,on:function(e,n){var r=t.get(e);r?r.push(n):t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&(n?r.splice(r.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var r=t.get(e);r&&r.slice().map(function(i){i(n)}),(r=t.get("*"))&&r.slice().map(function(i){i(e,n)})}}}const x1={};function lU(t){return`${ii()}local${t}`}const BBe=1e3,WS={};let x2=0,R$=performance.now();const KE=100,k$=[Ct.MOVE_UP,Ct.MOVE_DOWN,Ct.MOVE_LEFT,Ct.MOVE_RIGHT,Ct.OK_BUTTON,Ct.CANCEL_BUTTON,Ct.MENU_BUTTON];function Ane(){const t=performance.now(),e=t-R$,n=Dm(x1);for(let r=0;r<n.length;++r){const i=parseFloat(n[r]);if(WS[i]=WS[i]??0,WS[i]+=e,WS[i]>=KE){WS[i]-=KE;const s=x1[i],o={alt:!!s[Ct.ALT],ctrl:!!s[Ct.CTRL],shift:!!s[Ct.SHIFT]};for(let a=0;a<k$.length;++a){const c=k$[a];s[c]&&Rne(i,c,o)}}}if(++x2,R$=t,setTimeout(Ane,10),x2>BBe){x2=0;const r=Dm(x1);for(let i=1;i<r.length;++i){const s=parseFloat(r[i]);IK(qe,lU(s))}}}Ane();function uU(t){return x1[t]=x1[t]??{[Ct.NONE]:!1,[Ct.ALT]:!1,[Ct.CTRL]:!1,[Ct.SHIFT]:!1,[Ct.MOVE_UP]:!1,[Ct.MOVE_DOWN]:!1,[Ct.MOVE_LEFT]:!1,[Ct.MOVE_RIGHT]:!1,[Ct.OK_BUTTON]:!1,[Ct.CANCEL_BUTTON]:!1,[Ct.MENU_BUTTON]:!1},x1[t]}function xr(t,e){const n=uU(t);n[e]||(WS[t]=KE*-2,Rne(t,e,{alt:n[Ct.ALT],ctrl:n[Ct.CTRL],shift:n[Ct.SHIFT]})),n[e]=!0}function ur(t,e){const n=uU(t);n[e]=!1}const vm={root:Tne(),ignorehotkeys:!1},Cne=Ye.createContext(vm.root);function TC(t){return{alt:t.altKey,ctrl:z1?t.metaKey:t.ctrlKey,shift:t.shiftKey}}function Rne(t,e,n){if(t===0)vm.root.emit(Ct[e],n);else{let r=0;const i=lU(t);n.alt&&(r|=l5),n.ctrl&&(r|=u5),n.shift&&(r|=h5),NK(qe,i,e,r)}}window.addEventListener("wheel",t=>{t.preventDefault()},{passive:!1});window.addEventListener("keydown",t=>{const e=rr(t.key),n=TC(t),r=ii();switch(e){case"s":case"j":case"o":case"f":case"z":case"y":case"a":case"p":case"h":case"n":case"k":case"[":case"]":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"delete":case"backspace":(n.alt||n.ctrl||n.shift)&&t.preventDefault();break;case"tab":case"arrowleft":case"arrowright":case"arrowup":case"arrowdown":case"'":case'"':case"/":t.preventDefault();break}switch(n.alt?xr(0,Ct.ALT):ur(0,Ct.ALT),n.ctrl?xr(0,Ct.CTRL):ur(0,Ct.CTRL),n.shift?xr(0,Ct.SHIFT):ur(0,Ct.SHIFT),e){case"arrowleft":xr(0,Ct.MOVE_LEFT),t.metaKey&&ur(0,Ct.MOVE_LEFT);break;case"arrowright":xr(0,Ct.MOVE_RIGHT),t.metaKey&&ur(0,Ct.MOVE_RIGHT);break;case"arrowup":xr(0,Ct.MOVE_UP),t.metaKey&&ur(0,Ct.MOVE_UP);break;case"arrowdown":xr(0,Ct.MOVE_DOWN),t.metaKey&&ur(0,Ct.MOVE_DOWN);break;case"enter":xr(0,Ct.OK_BUTTON);break;case"esc":case"escape":xr(0,Ct.CANCEL_BUTTON);break;case"tab":xr(0,Ct.MENU_BUTTON);break;case"s":n.ctrl&&Am(qe,r,"#save");break;case"j":n.ctrl&&Am(qe,r,n.shift?"#jointab hush":"#jointab");break;case"o":n.ctrl&&Am(qe,r,n.shift?"#joincode hush":"#joincode");break;case"l":break;case"f":n.ctrl&&Am(qe,r,"#fork");break;case"h":n.ctrl&&Y5(qe,r)}vm.root.emit("keydown",t)},{capture:!0});window.addEventListener("keyup",t=>{const e=rr(t.key),n=TC(t);switch(n.alt?xr(0,Ct.ALT):ur(0,Ct.ALT),n.ctrl?xr(0,Ct.CTRL):ur(0,Ct.CTRL),n.shift?xr(0,Ct.SHIFT):ur(0,Ct.SHIFT),e){case"meta":break;case"arrowleft":ur(0,Ct.MOVE_LEFT);break;case"arrowright":ur(0,Ct.MOVE_RIGHT);break;case"arrowup":ur(0,Ct.MOVE_UP);break;case"arrowdown":ur(0,Ct.MOVE_DOWN);break;case"enter":ur(0,Ct.OK_BUTTON);break;case"esc":case"escape":ur(0,Ct.CANCEL_BUTTON);break;case"tab":ur(0,Ct.MENU_BUTTON);break}},{capture:!0});window.addEventListener("blur",()=>{ur(0,Ct.ALT),ur(0,Ct.CTRL),ur(0,Ct.SHIFT),ur(0,Ct.MOVE_UP),ur(0,Ct.MOVE_DOWN),ur(0,Ct.MOVE_LEFT),ur(0,Ct.MOVE_RIGHT),ur(0,Ct.OK_BUTTON),ur(0,Ct.CANCEL_BUTTON),ur(0,Ct.MENU_BUTTON)});Ym("userinput",[],t=>{switch(t.target){case"up":nn(t.data)&&ur(0,t.data);break;case"down":nn(t.data)&&xr(0,t.data);break}});const kne=0,Mne=1,One=2,Ine=3,FBe=4,jBe=5,zBe=6,VBe=7,HBe=9,$Be=12,GBe=13,WBe=14,qBe=15,w2={[Ine]:Ct.MOVE_UP,[kne]:Ct.MOVE_DOWN,[One]:Ct.MOVE_LEFT,[Mne]:Ct.MOVE_RIGHT,[FBe]:Ct.CANCEL_BUTTON,[jBe]:Ct.OK_BUTTON,[zBe]:Ct.ALT,[VBe]:Ct.CTRL,[HBe]:Ct.MENU_BUTTON,[$Be]:Ct.MOVE_UP,[GBe]:Ct.MOVE_DOWN,[WBe]:Ct.MOVE_LEFT,[qBe]:Ct.MOVE_RIGHT},T2={};function YBe(t){return T2[t]=T2[t]??{},T2[t]}function KBe(t,e,n){const r=YBe(t),i=l1(r[0]??0,r[1]??0),s=l1(r[2]??0,r[3]??0);r[e]=n;const o=l1(r[0]??0,r[1]??0),a=l1(r[2]??0,r[3]??0);if(i!==o)switch(ur(t,Ct.MOVE_LEFT),ur(t,Ct.MOVE_RIGHT),ur(t,Ct.MOVE_UP),ur(t,Ct.MOVE_DOWN),o){case yn.NORTH:xr(t,Ct.MOVE_UP);break;case yn.SOUTH:xr(t,Ct.MOVE_DOWN);break;case yn.WEST:xr(t,Ct.MOVE_LEFT);break;case yn.EAST:xr(t,Ct.MOVE_RIGHT);break}if(s!==a)switch(a===yn.IDLE?ur(t,Ct.SHIFT):xr(t,Ct.SHIFT),ur(t,Ct.MOVE_LEFT),ur(t,Ct.MOVE_RIGHT),ur(t,Ct.MOVE_UP),ur(t,Ct.MOVE_DOWN),a){case yn.NORTH:xr(t,Ct.MOVE_UP);break;case yn.SOUTH:xr(t,Ct.MOVE_DOWN);break;case yn.WEST:xr(t,Ct.MOVE_LEFT);break;case yn.EAST:xr(t,Ct.MOVE_RIGHT);break}}const AC=new DBe.GamepadListener({analog:!1,deadZone:.3});AC.on("gamepad:connected",t=>{const e=ii();us(qe,e,`connected ${t.detail.gamepad.id}`),uU(t.detail.index),t.detail.index>0&&lxe(qe,lU(t.detail.index))});AC.on("gamepad:disconnected",t=>{const e=ii();us(qe,e,`disconnected gamepad ${t.detail.index}`),delete x1[t.detail.index]});AC.on("gamepad:axis",t=>{KBe(t.detail.index,t.detail.axis,t.detail.value)});AC.on("gamepad:button",t=>{const e=t.detail.index;switch(t.detail.button){case One:case Mne:case Ine:case kne:ur(e,Ct.MOVE_UP),ur(e,Ct.MOVE_DOWN),ur(e,Ct.MOVE_LEFT),ur(e,Ct.MOVE_RIGHT),t.detail.value?(xr(e,Ct.SHIFT),xr(e,w2[t.detail.button])):ur(e,Ct.SHIFT);break;default:t.detail.value?xr(e,w2[t.detail.button]):ur(e,w2[t.detail.button]);break}});AC.start();const M$="keyup";function w1({hotkey:t,althotkey:e,children:n}){return Ye.useEffect(()=>{const r=C$(t,{byKey:!0}),i=fe(e)?C$(e,{byKey:!0}):void 0;function s(o){vm.ignorehotkeys===!1&&(r(o)||i?.(o))&&n()}return document.addEventListener(M$,s,!1),()=>document.removeEventListener(M$,s,!1)},[t,e,n]),null}function xo(t){const e=Ye.useContext(Cne);return Ye.useEffect(()=>{const n=Object.entries(t);return n.forEach(([r,i])=>e.on(r,i)),()=>{n.forEach(([r,i])=>e.off(r,i))}},[e,t]),null}function Dv({blockhotkeys:t,children:e}){const[n]=Ye.useState(()=>Tne());return Ye.useEffect(()=>{const r=vm.root,i=vm.ignorehotkeys;return vm.root=n,vm.ignorehotkeys=!!t,()=>{vm.root=r,vm.ignorehotkeys=i}},[n,t]),Ee.jsx(Cne.Provider,{value:n,children:e})}function XBe(t){try{return sessionStorage.getItem(t)??void 0}catch(e){_r(ui,Ao,`readsession ${t}`,e.message)}}function JBe(t,e){try{fe(e)?sessionStorage.setItem(t,e):sessionStorage.removeItem(t)}catch(n){_r(ui,Ao,`writesession ${t} <- ${e}`,n.message)}}async function Nne(){const t=await X8("cli");oU(Ao,t)}async function Pne(){await oh(1e3),to(ui,Ao,"try typing $green#help$blue and pressing enter!")}function ZBe(){Am(ui,Ao,"#pages")}function QBe(t){const e=t.map(r=>`${r}`).join(" ");return e.startsWith("!")?`!${e}`:`$onclear$blue${e}`}const O$=/\((\d+)\)/;function I$(t){const{terminal:e}=ls.getState(),n=QBe(t.data),[r=""]=e.logs,i=[...e.logs],s=d$(r).replace(O$,""),o=d$(n),a=s.indexOf(o);if(o.length&&s.length&&a===0){const c=O$.exec(r);if(fe(c)){const l=parseFloat(c[1])+1;i.shift(),i.unshift(`(${l})${n}`)}else i.shift(),i.unshift(`(2)${n}`)}else{for(;i.length>=ABe;)i.pop();i.unshift(n),Ai.getState().ycursor>0&&Ai.setState(c=>({ycursor:c.ycursor+1,yselect:c.yselect?c.yselect+1:void 0}))}ls.setState(c=>({terminal:{...c.terminal,logs:i}}))}function eFe(t){const{layout:e,editor:n}=ls.getState();let i=e+(t?1:-1);i<0&&(i+=Wf.MAX),i>=Wf.MAX&&(i-=Wf.MAX),n.open||i===Wf.SPLIT_X&&(i=Wf.TOP),ls.setState({layout:i})}async function tFe(t){if(t.length===0){_r(ui,Ao,"content","no content found"),await Nne(),kK(ui,Ao),q5(ui,Ao),await Pne();return}MK(ui,Ao,t)}let A2=0;const N$=10,Ao=XBe("PLAYER")??Uxe();JBe("PLAYER",Ao);let P$;function ii(){return Ao}const ui=Ym("register",["ready","second","log","chat","toast"],function(t){if(!ui.session(t))return;switch(t.target){case"ready":case"chat":case"toast":case"second":break;default:if(t.player!==Ao)return;break}const e=Kr.getState().gadget.board;switch(t.target){case"ready":{io(ui,t.player,async()=>{await xBe(Ao);const n=await yBe();fe(n)&&Ai.setState({buffer:n.filter(r=>r.includes("#broadcast")===!1)}),await oh(256),us(ui,Ao,`myplayerid ${Ao}`),txe(ui,Ao)});break}case"ackoperator":MEe(ui,Ao),io(ui,t.player,async()=>{const n=await cU(Ao);zte()&&dn(n)?TEe(ui,Ao,n):await tFe(n)});break;case"loginready":io(ui,t.player,async()=>{const n=await wne();cxe(ui,Ao,n),kK(ui,Ao)});break;case"acklogin":t.data?(UT(ui,Ao),dh(ui,t.player,void 0,"text","sim:load","")):io(ui,t.player,async()=>{await Nne(),ZBe(),q5(ui,Ao),dh(ui,t.player,void 0,"text","sim:load",""),await Pne()});break;case"ackzsswords":{Kr.setState({zsswords:t.data});const n=[],r=Object.values(t.data);for(let i=0;i<r.length;++i)n.push(...r[i]);break}case"input":if(Kn(t.data)){const[n,r]=t.data;r?(xr(0,Ct.SHIFT),xr(0,n),ur(0,n),ur(0,Ct.SHIFT)):(xr(0,n),ur(0,n))}break;case"store":io(ui,t.player,async()=>{if(Kn(t.data)){const[n,r]=t.data;await EBe(n,r)}});break;case"copy":dn(t.data)&&fe(da())&&da().writeText(t.data).then(()=>TK(ui,t.player,`copied! ${t.data.slice(0,200)}`)).catch(n=>console.error(n));break;case"downloadjsonfile":if(Kn(t.data)){const[n,r]=t.data;try{const i=new Blob([JSON.stringify({exported:r,data:n},null,2)],{type:"application/json;charset=utf-8"}),s=URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=r,o.click(),URL.revokeObjectURL(s)}catch(i){console.error(i)}}break;case"share":io(ui,t.player,async function(){await wBe(t.player)});break;case"screenshot":IBe();break;case"nuke":io(ui,t.player,async function(){Sv(ui,t.player,"nuke in"),ih(ui,t.player,"3","..."),await oh(1e3),ih(ui,t.player,"2","..."),await oh(1e3),ih(ui,t.player,"1","..."),await oh(1e3),Sv(ui,t.player,"BYE"),await oh(100),TBe(t.player)});break;case"savemem":io(ui,t.player,async function(){if(Kn(t.data)){const[n,r,i]=t.data;dn(n)&&dn(r)&&Kn(i)&&i.every(ime)&&await xne(t.player,n,r,r,i)}});break;case"forkmem":if(Kn(t.data)){const[n,r]=t.data;if(dn(n)&&dn(r)){const i=r?`https://${r}/#${n}`:location.href.replace(/#.*/,`#${n}`);window.open(i,"_blank")}}break;case"publishmem":io(ui,t.player,async()=>{if(Kn(t.data)){const[n,r]=t.data;switch(r){case"itchio":{const[,,i]=t.data;dn(n)&&dn(i)&&(to(ui,t.player,`publishing ${i}`),await CUe(i,n),to(ui,t.player,`$green${i} has been exported for upload to itch.io`));break}case"bbs":{const[,,i,s,o,...a]=t.data;if(dn(n)&&dn(i)&&dn(s)&&dn(o)){to(ui,t.player,`publishing ${o}`);const c=await jte(`${location.origin}/#${n}`);(await i8e(i,s,o,c,a)).success&&to(ui,t.player,`$green${o} has been published to bbs`)}break}default:_r(ui,t.player,"publish",`unknown publish method ${r}`);break}}});break;case"second":++A2,A2>=N$&&(A2-=N$,IK(ui,Ao));break;case"inspector":ls.setState(n=>{const r=fe(t.data)?!!t.data:!n.inspector;return us(ui,t.player,`gadget inspector ${r?"$greenon":"$redoff"}`),r&&us(ui,t.player,"mouse click or tap elements to inspect"),{inspector:r}});break;case"findany":Kn(t.data)&&ev.setState({pts:t.data});break;case"log":I$(t);break;case"chat":{(t.player===""||t.player===e)&&I$(t);break}case"toast":if(fe(t.data)){clearTimeout(P$),ls.setState({toast:t.data});const n=Math.max(t.data.length*150,3e3),r=Math.min(n,14e3);P$=setTimeout(()=>ls.setState({toast:""}),r)}break;case"terminal:full":ls.setState(n=>({layout:Wf.FULL,terminal:{...n.terminal,open:!0}}));break;case"terminal:open":if(dn(t.data)){const n=Ai.getState().buffer;n[0]=t.data,Ai.setState({buffer:n,bufferindex:0,xcursor:t.data.length,ycursor:0,xselect:void 0,yselect:void 0})}ls.setState(n=>({terminal:{...n.terminal,open:!0}}));break;case"terminal:quickopen":if(dn(t.data)){const n=Ai.getState().buffer;n[0]=t.data,Ai.setState({buffer:n,bufferindex:0,xcursor:t.data.length,ycursor:0,xselect:void 0,yselect:void 0})}ls.setState({quickterminal:!0,layout:Wf.TOP});break;case"terminal:close":ls.setState(n=>({quickterminal:!1,terminal:{...n.terminal,open:!1}}));break;case"terminal:toggle":ls.setState(n=>({terminal:{...n.terminal,open:!n.terminal.open}}));break;case"terminal:inclayout":rme(t.data)&&eFe(t.data);break;case"editor:open":if(Kn(t.data)){const[n,r,i,s]=t.data;ls.setState(()=>({editor:{open:!0,player:t.player,book:n,path:r,type:i,title:s}}))}break;case"editor:close":ls.setState(n=>({editor:{...n.editor,open:!1}}));break}});function nFe(t,e){const n=new lx().connect(t);return n.set({octaves:8,volume:8,pitchDecay:.125}),n.connect(e),{basstrigger(r){n.triggerAttackRelease("C1","8n",r)}}}function rFe(t){const e=new bA(-6,6,10).connect(t),n=new Nc(8e3,"highpass",-12);n.connect(e);const r=new yv;r.set({envelope:{attack:.001,decay:.05,sustain:.001,release:.05}}),r.connect(n);const i=new bA(-6,3,8).connect(t),s=new Nc(6e3,"highpass",-12);s.connect(i);const o=new yv;return o.set({envelope:{attack:.001,decay:.2,sustain:.1,release:.3}}),o.connect(s),{ticktrigger(a){r.triggerAttackRelease("16n",a)},tweettrigger(a){o.triggerAttackRelease("8n",a)}}}function iFe(t,e){const n=new Nc(350,"bandpass").connect(t),r=new Vr().connect(n);r.gain.value=0;const i=new r8().connect(r);i.volume.value=16,i.maxPolyphony=8,i.set({envelope:{attack:.001,decay:.01,sustain:.1,release:.1},oscillator:{type:"square"}});const s=new bA(-10,10,-1).connect(t);s.connect(e);const o=new Nc(800,"highpass",-12);o.connect(s);const a=new yv;return a.set({envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),a.connect(o),{cowbelltrigger(c,l){const u=Oc("64n").toSeconds()+Oc(c).toSeconds();r.gain.setValueAtTime(.5,l),r.gain.exponentialRampToValueAtTime(.01,u+l),i.triggerAttackRelease([800,540],c,l)},claptrigger(c,l){a.triggerAttackRelease(c,l)}}}function sFe(t){const e=new yA().connect(t);e.set({distortion:.666});const n=new Ga;n.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),n.connect(e);const r=new Nc;r.set({type:"highpass",frequency:1e4}),r.connect(e);const i=new yv;i.set({envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),i.connect(r);const s=new yA().connect(t);s.set({distortion:.876});const o=new Ga;o.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),o.connect(s);const a=new Nc;a.set({type:"highpass",frequency:1e4}),a.connect(s);const c=new yv;return c.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),c.connect(a),{hisnaretrigger(l,u){const h=Oc("512n").toSeconds(),f=Oc("32n").toSeconds();n.triggerAttackRelease(1e4,l,u,1),n.frequency.exponentialRampToValueAtTime(300,u+h),n.frequency.exponentialRampToValueAtTime(100,u+f),i.triggerAttackRelease("8n",u,.333),i.volume.setValueAtTime(1,u),i.volume.exponentialRampToValueAtTime(0,u+Oc("32n").toSeconds())},lowsnaretrigger(l,u){const h=Oc("512n").toSeconds(),f=Oc("32n").toSeconds();o.triggerAttackRelease(1e4,l,u,1),o.frequency.exponentialRampToValueAtTime(150,u+h),o.frequency.exponentialRampToValueAtTime(100,u+f),c.triggerAttackRelease("8n",u,.25),c.volume.setValueAtTime(1,u),c.volume.exponentialRampToValueAtTime(0,u+Oc("32n").toSeconds())}}}function oFe(t){const e=new Ga().connect(t);e.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"sawtooth"}});const n=new Ga().connect(t);n.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"triangle"}});const r=new yv().connect(t);return r.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),{lowtomtrigger(i,s){const o=Oc("256n").toSeconds(),a=Oc(i).toSeconds()-o;e.triggerAttackRelease("C4",a,s,1),e.frequency.exponentialRampToValueAtTime(n9("C0").toFrequency(),s+a),n.triggerAttackRelease("C5",a,s,.5),n.frequency.exponentialRampToValueAtTime(n9("C0").toFrequency(),s+a);const c=Oc("4n").toSeconds();r.triggerAttackRelease("8n",s),r.volume.setValueAtTime(1,s),r.volume.exponentialRampToValueAtTime(0,s+c)}}}function aFe(t){const e=new Nc;e.set({type:"bandpass",frequency:256,Q:.17}),e.connect(t);const n=new Ga;n.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),n.connect(e);const r=new Ga;r.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),r.connect(e);const i=new Nc;i.set({type:"bandpass",frequency:256,Q:.17}),i.connect(t);const s=new Ga;s.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),s.connect(i);const o=new Ga;return o.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),o.connect(i),{hiwoodblocktrigger(a,c){n.triggerAttackRelease(2e3,a,c),n.frequency.exponentialRampToValueAtTime(1e3,c+Oc("32n").toSeconds()),r.triggerAttackRelease(999,a,c),r.frequency.exponentialRampToValueAtTime(888,c+Oc("256n").toSeconds())},lowwoodblocktrigger(a,c){s.triggerAttackRelease(2e3,a,c),s.frequency.exponentialRampToValueAtTime(100,c+Oc("32n").toSeconds()),o.triggerAttackRelease(699,a,c),o.frequency.exponentialRampToValueAtTime(399,c+Oc("256n").toSeconds())}}}function cFe(t,e){const n=rFe(t),r=iFe(t,e),i=sFe(t),s=aFe(t),o=oFe(t),a=nFe(t,e);return{ticktrigger:n.ticktrigger,tweettrigger:n.tweettrigger,cowbelltrigger:r.cowbelltrigger,claptrigger:r.claptrigger,hisnaretrigger:i.hisnaretrigger,hiwoodblocktrigger:s.hiwoodblocktrigger,lowsnaretrigger:i.lowsnaretrigger,lowtomtrigger:o.lowtomtrigger,lowwoodblocktrigger:s.lowwoodblocktrigger,basstrigger:a.basstrigger}}const lFe="data:text/javascript;base64,Ly8gQSBkb3duc2FtcGxpbmcvZGVncmFkaW5nIHByb2Nlc3NpbmcgZWZmZWN0Ci8vIFNhbXBsZSBhbmQgaG9sZHMgdGhlIHNpZ25hbCBiYXNlZCBvbiBhbiBpbmNyZW1lbnRpbmcgY291bnRlcgovLyB3cml0dGVuIGJ5IFRpbW8gSG9vZ2xhbmQsIChjKSAyMDIzLCB3d3cudGltb2hvb2dsYW5kLmNvbQovLwoKY2xhc3MgU3ludGhGQ3J1c2hXb3JrbGV0UHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFsKICAgICAgewogICAgICAgIG5hbWU6ICdyYXRlJywKICAgICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgICAgbWluVmFsdWU6IDEsCiAgICAgICAgbWF4VmFsdWU6IDUxMiwKICAgICAgfSwKICAgIF0KICB9CgogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoKQogICAgLy8gdGhlIGZyYW1lIGNvdW50ZXIKICAgIHRoaXMuY291bnQgPSAwCiAgICAvLyBzYW1wbGUgYW5kIGhvbGQgdmFyaWFibGUgYXJyYXkKICAgIHRoaXMuc2FoID0gW10KICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXQogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXQoKICAgIC8vIGNoZWNrIGZvciBkYXRhCiAgICBpZiAoIWlucHV0WzBdIHx8ICFpbnB1dFsxXSB8fCAhb3V0cHV0WzBdIHx8ICFvdXRwdXRbMV0pIHsKICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICAvLyBmb3IgdGhlIGxlbmd0aCBvZiB0aGUgc2FtcGxlIGFycmF5IChnZW5lcmFsbHkgMTI4KQogICAgY29uc3QgcmF0ZSA9IHBhcmFtZXRlcnMucmF0ZVswXQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dFswXS5sZW5ndGg7IGkrKykgewogICAgICAvLyBmb3IgZXZlcnkgY2hhbm5lbAogICAgICBmb3IgKGxldCBjaGFubmVsID0gMDsgY2hhbm5lbCA8IGlucHV0Lmxlbmd0aDsgKytjaGFubmVsKSB7CiAgICAgICAgLy8gaWYgY291bnRlciBlcXVhbHMgMCwgc2FtcGxlIGFuZCBob2xkCiAgICAgICAgaWYgKHRoaXMuY291bnQgJSByYXRlID09PSAwKSB7CiAgICAgICAgICB0aGlzLnNhaFtjaGFubmVsXSA9IGlucHV0W2NoYW5uZWxdW2ldCiAgICAgICAgfQogICAgICAgIC8vIG91dHB1dCB0aGUgY3VycmVudGx5IGhlbGQgc2FtcGxlCiAgICAgICAgb3V0cHV0W2NoYW5uZWxdW2ldID0gdGhpcy5zYWhbY2hhbm5lbF0KICAgICAgfQogICAgICAvLyBpbmNyZW1lbnQgc2FtcGxlIGNvdW50ZXIKICAgICAgdGhpcy5jb3VudCsrCiAgICB9CiAgICByZXR1cm4gdHJ1ZQogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2ZjcnVzaHByb2Nlc3NvcicsIFN5bnRoRkNydXNoV29ya2xldFByb2Nlc3NvcikK";class hU extends Dl{name="FrequencyCrusher";rate;_audioworkletnode=this.context.createAudioWorkletNode("fcrushprocessor");constructor(){const e=Yn(hU.getDefaults(),arguments,["rate"]);super(e),this.rate=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("rate"),value:e.rate,minValue:1,maxValue:512}),this.connectEffect(this._audioworkletnode)}static getDefaults(){return Object.assign(Dl.getDefaults(),{rate:64})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}function uFe(){return bo().rawContext.audioWorklet.addModule(lFe)}function zR(t){const e=bo().isOffline?"offline":"",n=new nh(ca(0)),r=new nh(ca(0)),i=new nh(ca(0)),s=new nh(ca(0)),o=new nh(ca(0)),a=new nh(ca(0)),c=new nh(ca(0));n.receive(`${e}fc${t}`),r.receive(`${e}echo${t}`),i.receive(`${e}reverb${t}`),s.receive(`${e}autofilter${t}`),o.receive(`${e}vibrato${t}`),a.receive(`${e}distortion${t}`),c.receive(`${e}autowah${t}`);const l=new nh;l.send(`${e}fc${t}`),l.send(`${e}echo${t}`),l.send(`${e}reverb${t}`),l.send(`${e}autofilter${t}`),l.send(`${e}vibrato${t}`),l.send(`${e}distortion${t}`),l.send(`${e}autowah${t}`);function u(){return{fc:n.volume.value,echo:r.volume.value,reverb:i.volume.value,autofilter:s.volume.value,vibrato:o.volume.value,distortion:a.volume.value,autowah:c.volume.value}}function h(p){n.volume.value=p.fc,r.volume.value=p.echo,i.volume.value=p.reverb,s.volume.value=p.autofilter,o.volume.value=p.vibrato,a.volume.value=p.distortion,c.volume.value=p.autowah}function f(){n.volume.value=ca(0),r.volume.value=ca(0),i.volume.value=ca(0),s.volume.value=ca(0),o.volume.value=ca(0),a.volume.value=ca(0),c.volume.value=ca(0)}function d(){n.dispose(),r.dispose(),i.dispose(),s.dispose(),o.dispose(),a.dispose(),c.dispose(),l.dispose()}return{sendtofx:l,fc:n,echo:r,reverb:i,autofilter:s,vibrato:o,distortion:a,autowah:c,fcrush:n,distort:a,getreplay:u,setreplay:h,applyreset:f,destroy:d}}function ca(t){return 20*Math.log10(t)-35}function hFe(){const t=new u8,e=Ts(t.get()),n=new l8,r=Ts(n.get()),i=new i8,s=Ts(i.get()),o=new yA,a=Ts(o.get()),c=new mI,l=Ts(c.get()),u=new hU,h=Ts(u.get()),f=new a8,d=Ts(f.get());function p(){t.set({...e,wet:.5}),n.set({...r,wet:.5,delayTime:"8n",maxDelay:"8n",feedback:.666}),i.set({...s,wet:.5,depth:.5,frequency:3,octaves:5}),o.set({...a,wet:1,oversample:"4x"}),c.set({...l,wet:1,depth:0,maxDelay:.5}),u.set({...h,wet:1,rate:32}),f.set({...d,wet:1})}function m(){return{fc:Ts(u.get()),echo:Ts(n.get()),reverb:Ts(t.get()),autofilter:Ts(i.get()),vibrato:Ts(c.get()),distortion:Ts(o.get())}}function g(y){u.set(y.fc),n.set(y.echo),t.set(y.reverb),i.set(y.autofilter),c.set(y.vibrato),o.set(y.distortion)}function _(){u.dispose(),n.dispose(),t.dispose(),i.dispose(),c.dispose(),o.dispose()}return p(),{fc:u,echo:n,reverb:t,autofilter:i,vibrato:c,distortion:o,applyreset:p,getreplay:m,setreplay:g,autowah:f,fcrush:u,distort:o,destroy:_}}const fFe="/assets/sidechainworklet-4DrJ3CKW.js";class fU extends Dl{name="SidechainCompressor";threshold;ratio;attack;release;mix;makeupGain;sidechain=new Vr;_audioworkletnode=this.context.createAudioWorkletNode("sidechaincompressorprocessor",{numberOfInputs:2,outputChannelCount:[2]});constructor(){const e=Yn(fU.getDefaults(),arguments,["threshold","ratio","attack","release","mix","makeupGain"]);super(e),this.threshold=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("threshold"),value:e.threshold,minValue:-128,maxValue:0}),this.ratio=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("ratio"),value:e.ratio,minValue:1,maxValue:128}),this.attack=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("attack"),value:e.attack,minValue:1e-4,maxValue:128}),this.release=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("release"),value:e.release,minValue:1e-4,maxValue:128}),this.mix=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("mix"),value:e.mix,minValue:0,maxValue:1}),this.makeupGain=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("makeupGain"),value:e.makeupGain,minValue:-128,maxValue:60}),this.connectEffect(this._audioworkletnode),this.sidechain.connect(this._audioworkletnode,0,1)}static getDefaults(){return Object.assign(Dl.getDefaults(),{threshold:-28,ratio:4,attack:.005,release:.005,mix:1,makeupGain:0})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}function dFe(){return bo().rawContext.audioWorklet.addModule(fFe)}function pFe(){const t=dMe(),e=new th;e.connect(t);let n;bo().isOffline||(n=bo().createMediaStreamDestination(),e.connect(n));const r=new Vr,i=new mI({maxDelay:.005,frequency:.125,depth:.3,type:"square",wet:.1}),s=new c8({frequency:.01,delayTime:7,depth:.7,type:"sawtooth",spread:128,wet:.5});s.start();const o=new B1({type:"pink",volume:-50}),a=new th,c=new K6,l=new Wo(Math.PI*.25,"sine");l.chain(c,a.volume),l.start(),o.start(),o.chain(a,s),i.chain(s,e);const u=new d8({threshold:-28,ratio:4,attack:.003,release:.15,knee:30});r.chain(u,i);const h=new fU({threshold:-42,ratio:5,attack:.005,release:.06,mix:.75,makeupGain:24});h.connect(r);const f=new th(-12),d=new th(-28),p=new th(ca(20));p.connect(h);const m=new th(ca(100)+10);m.connect(r);const g=new th;g.connect(r),g.connect(f);const _=new th;_.connect(r),_.connect(f),f.connect(h.sidechain),d.connect(h.sidechain);const y=cFe(m,d);return{mainvolume:e,broadcastdestination:n,razzlegain:r,playvolume:p,drumvolume:m,bgplayvolume:g,ttsvolume:_,drum:y}}function mFe(t){return new Int8Array(t)}function gFe(t){return new Int16Array(t)}function Dne(t){return new Int32Array(t)}function Lne(t){return new Float32Array(t)}function _Fe(t){return new Float64Array(t)}function Une(t){if(t.length==1)return Lne(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Une(t));return n}function Bne(t){if(t.length==1)return Dne(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Bne(t));return n}function Fne(t){if(t.length==1)return gFe(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Fne(t));return n}function jne(t){if(t.length==1)return new Array(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(jne(t));return n}var zne={};zne.fill=function(t,e,n,r){if(arguments.length==2)for(var i=0;i<t.length;i++)t[i]=arguments[1];else for(var i=e;i<n;i++)t[i]=r};var CC={};CC.arraycopy=function(t,e,n,r,i){for(var s=e+i;e<s;)n[r++]=t[e++]};CC.out={};CC.out.println=function(t){console.log(t)};CC.out.printf=function(){console.log.apply(console,arguments)};var jI={};jI.SQRT2=1.4142135623730951;jI.FAST_LOG10=function(t){return Math.log10(t)};jI.FAST_LOG10_X=function(t,e){return Math.log10(t)*e};function Ig(t){this.ordinal=t}Ig.short_block_allowed=new Ig(0);Ig.short_block_coupled=new Ig(1);Ig.short_block_dispensed=new Ig(2);Ig.short_block_forced=new Ig(3);var Vne={};Vne.MAX_VALUE=34028235e31;function uf(t){this.ordinal=t}uf.vbr_off=new uf(0);uf.vbr_mt=new uf(1);uf.vbr_rh=new uf(2);uf.vbr_abr=new uf(3);uf.vbr_mtrh=new uf(4);uf.vbr_default=uf.vbr_mtrh;var vFe=function(t){},Mo={System:CC,VbrMode:uf,Float:Vne,ShortBlock:Ig,Util:jI,Arrays:zne,new_array_n:jne,new_byte:mFe,new_double:_Fe,new_float:Lne,new_float_n:Une,new_int:Dne,new_int_n:Bne,new_short_n:Fne,assert:vFe},C2,D$;function yFe(){if(D$)return C2;D$=1;var t=Mo,e=t.System,n=t.Util,r=t.Arrays,i=t.new_float,s=Fl();function o(){var a=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*n.SQRT2*.5/2384e-9,.017876148*n.SQRT2*.5/2384e-9,.003134727*n.SQRT2*.5/2384e-9,.002457142*n.SQRT2*.5/2384e-9,971317e-9*n.SQRT2*.5/2384e-9,218868e-9*n.SQRT2*.5/2384e-9,101566e-9*n.SQRT2*.5/2384e-9,13828e-9*n.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],c=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],l=c[s.SHORT_TYPE],u=c[s.SHORT_TYPE],h=c[s.SHORT_TYPE],f=c[s.SHORT_TYPE],d=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function p(_,y,v){for(var E=10,x=y+238-14-286,A=-15;A<0;A++){var T,k,L;T=a[E+-10],k=_[x+-224]*T,L=_[y+224]*T,T=a[E+-9],k+=_[x+-160]*T,L+=_[y+160]*T,T=a[E+-8],k+=_[x+-96]*T,L+=_[y+96]*T,T=a[E+-7],k+=_[x+-32]*T,L+=_[y+32]*T,T=a[E+-6],k+=_[x+32]*T,L+=_[y+-32]*T,T=a[E+-5],k+=_[x+96]*T,L+=_[y+-96]*T,T=a[E+-4],k+=_[x+160]*T,L+=_[y+-160]*T,T=a[E+-3],k+=_[x+224]*T,L+=_[y+-224]*T,T=a[E+-2],k+=_[y+-256]*T,L-=_[x+256]*T,T=a[E+-1],k+=_[y+-192]*T,L-=_[x+192]*T,T=a[E+0],k+=_[y+-128]*T,L-=_[x+128]*T,T=a[E+1],k+=_[y+-64]*T,L-=_[x+64]*T,T=a[E+2],k+=_[y+0]*T,L-=_[x+0]*T,T=a[E+3],k+=_[y+64]*T,L-=_[x+-64]*T,T=a[E+4],k+=_[y+128]*T,L-=_[x+-128]*T,T=a[E+5],k+=_[y+192]*T,L-=_[x+-192]*T,k*=a[E+6],T=L-k,v[30+A*2]=L+k,v[31+A*2]=a[E+7]*T,E+=18,y--,x++}{var k,L,I,F;L=_[y+-16]*a[E+-10],k=_[y+-32]*a[E+-2],L+=(_[y+-48]-_[y+16])*a[E+-9],k+=_[y+-96]*a[E+-1],L+=(_[y+-80]+_[y+48])*a[E+-8],k+=_[y+-160]*a[E+0],L+=(_[y+-112]-_[y+80])*a[E+-7],k+=_[y+-224]*a[E+1],L+=(_[y+-144]+_[y+112])*a[E+-6],k-=_[y+32]*a[E+2],L+=(_[y+-176]-_[y+144])*a[E+-5],k-=_[y+96]*a[E+3],L+=(_[y+-208]+_[y+176])*a[E+-4],k-=_[y+160]*a[E+4],L+=(_[y+-240]-_[y+208])*a[E+-3],k-=_[y+224],I=k-L,F=k+L,L=v[14],k=v[15]-L,v[31]=F+L,v[30]=I+k,v[15]=I-k,v[14]=F-L}{var M;M=v[28]-v[0],v[0]+=v[28],v[28]=M*a[E+-36+7],M=v[29]-v[1],v[1]+=v[29],v[29]=M*a[E+-36+7],M=v[26]-v[2],v[2]+=v[26],v[26]=M*a[E+-72+7],M=v[27]-v[3],v[3]+=v[27],v[27]=M*a[E+-72+7],M=v[24]-v[4],v[4]+=v[24],v[24]=M*a[E+-108+7],M=v[25]-v[5],v[5]+=v[25],v[25]=M*a[E+-108+7],M=v[22]-v[6],v[6]+=v[22],v[22]=M*n.SQRT2,M=v[23]-v[7],v[7]+=v[23],v[23]=M*n.SQRT2-v[7],v[7]-=v[6],v[22]-=v[7],v[23]-=v[22],M=v[6],v[6]=v[31]-M,v[31]=v[31]+M,M=v[7],v[7]=v[30]-M,v[30]=v[30]+M,M=v[22],v[22]=v[15]-M,v[15]=v[15]+M,M=v[23],v[23]=v[14]-M,v[14]=v[14]+M,M=v[20]-v[8],v[8]+=v[20],v[20]=M*a[E+-180+7],M=v[21]-v[9],v[9]+=v[21],v[21]=M*a[E+-180+7],M=v[18]-v[10],v[10]+=v[18],v[18]=M*a[E+-216+7],M=v[19]-v[11],v[11]+=v[19],v[19]=M*a[E+-216+7],M=v[16]-v[12],v[12]+=v[16],v[16]=M*a[E+-252+7],M=v[17]-v[13],v[13]+=v[17],v[17]=M*a[E+-252+7],M=-v[20]+v[24],v[20]+=v[24],v[24]=M*a[E+-216+7],M=-v[21]+v[25],v[21]+=v[25],v[25]=M*a[E+-216+7],M=v[4]-v[8],v[4]+=v[8],v[8]=M*a[E+-216+7],M=v[5]-v[9],v[5]+=v[9],v[9]=M*a[E+-216+7],M=v[0]-v[12],v[0]+=v[12],v[12]=M*a[E+-72+7],M=v[1]-v[13],v[1]+=v[13],v[13]=M*a[E+-72+7],M=v[16]-v[28],v[16]+=v[28],v[28]=M*a[E+-72+7],M=-v[17]+v[29],v[17]+=v[29],v[29]=M*a[E+-72+7],M=n.SQRT2*(v[2]-v[10]),v[2]+=v[10],v[10]=M,M=n.SQRT2*(v[3]-v[11]),v[3]+=v[11],v[11]=M,M=n.SQRT2*(-v[18]+v[26]),v[18]+=v[26],v[26]=M-v[18],M=n.SQRT2*(-v[19]+v[27]),v[19]+=v[27],v[27]=M-v[19],M=v[2],v[19]-=v[3],v[3]-=M,v[2]=v[31]-M,v[31]+=M,M=v[3],v[11]-=v[19],v[18]-=M,v[3]=v[30]-M,v[30]+=M,M=v[18],v[27]-=v[11],v[19]-=M,v[18]=v[15]-M,v[15]+=M,M=v[19],v[10]-=M,v[19]=v[14]-M,v[14]+=M,M=v[10],v[11]-=M,v[10]=v[23]-M,v[23]+=M,M=v[11],v[26]-=M,v[11]=v[22]-M,v[22]+=M,M=v[26],v[27]-=M,v[26]=v[7]-M,v[7]+=M,M=v[27],v[27]=v[6]-M,v[6]+=M,M=n.SQRT2*(v[0]-v[4]),v[0]+=v[4],v[4]=M,M=n.SQRT2*(v[1]-v[5]),v[1]+=v[5],v[5]=M,M=n.SQRT2*(v[16]-v[20]),v[16]+=v[20],v[20]=M,M=n.SQRT2*(v[17]-v[21]),v[17]+=v[21],v[21]=M,M=-n.SQRT2*(v[8]-v[12]),v[8]+=v[12],v[12]=M-v[8],M=-n.SQRT2*(v[9]-v[13]),v[9]+=v[13],v[13]=M-v[9],M=-n.SQRT2*(v[25]-v[29]),v[25]+=v[29],v[29]=M-v[25],M=-n.SQRT2*(v[24]+v[28]),v[24]-=v[28],v[28]=M-v[24],M=v[24]-v[16],v[24]=M,M=v[20]-M,v[20]=M,M=v[28]-M,v[28]=M,M=v[25]-v[17],v[25]=M,M=v[21]-M,v[21]=M,M=v[29]-M,v[29]=M,M=v[17]-v[1],v[17]=M,M=v[9]-M,v[9]=M,M=v[25]-M,v[25]=M,M=v[5]-M,v[5]=M,M=v[21]-M,v[21]=M,M=v[13]-M,v[13]=M,M=v[29]-M,v[29]=M,M=v[1]-v[0],v[1]=M,M=v[16]-M,v[16]=M,M=v[17]-M,v[17]=M,M=v[8]-M,v[8]=M,M=v[9]-M,v[9]=M,M=v[24]-M,v[24]=M,M=v[25]-M,v[25]=M,M=v[4]-M,v[4]=M,M=v[5]-M,v[5]=M,M=v[20]-M,v[20]=M,M=v[21]-M,v[21]=M,M=v[12]-M,v[12]=M,M=v[13]-M,v[13]=M,M=v[28]-M,v[28]=M,M=v[29]-M,v[29]=M,M=v[0],v[0]+=v[31],v[31]-=M,M=v[1],v[1]+=v[30],v[30]-=M,M=v[16],v[16]+=v[15],v[15]-=M,M=v[17],v[17]+=v[14],v[14]-=M,M=v[8],v[8]+=v[23],v[23]-=M,M=v[9],v[9]+=v[22],v[22]-=M,M=v[24],v[24]+=v[7],v[7]-=M,M=v[25],v[25]+=v[6],v[6]-=M,M=v[4],v[4]+=v[27],v[27]-=M,M=v[5],v[5]+=v[26],v[26]-=M,M=v[20],v[20]+=v[11],v[11]-=M,M=v[21],v[21]+=v[10],v[10]-=M,M=v[12],v[12]+=v[19],v[19]-=M,M=v[13],v[13]+=v[18],v[18]-=M,M=v[28],v[28]+=v[3],v[3]-=M,M=v[29],v[29]+=v[2],v[2]-=M}}function m(_,y){for(var v=0;v<3;v++){var E,x,A,T,k,L;T=_[y+6]*c[s.SHORT_TYPE][0]-_[y+15],E=_[y+0]*c[s.SHORT_TYPE][2]-_[y+9],x=T+E,A=T-E,T=_[y+15]*c[s.SHORT_TYPE][0]+_[y+6],E=_[y+9]*c[s.SHORT_TYPE][2]+_[y+0],k=T+E,L=-T+E,E=(_[y+3]*c[s.SHORT_TYPE][1]-_[y+12])*2069978111953089e-26,T=(_[y+12]*c[s.SHORT_TYPE][1]+_[y+3])*2069978111953089e-26,_[y+0]=x*190752519173728e-25+E,_[y+15]=-k*190752519173728e-25+T,A=A*.8660254037844387*1907525191737281e-26,k=k*.5*1907525191737281e-26+T,_[y+3]=A-k,_[y+6]=A+k,x=x*.5*1907525191737281e-26-E,L=L*.8660254037844387*1907525191737281e-26,_[y+9]=x+L,_[y+12]=x-L,y++}}function g(_,y,v){var E,x;{var A,T,k,L,I,F,M,D;A=v[17]-v[9],k=v[15]-v[11],L=v[14]-v[12],I=v[0]+v[8],F=v[1]+v[7],M=v[2]+v[6],D=v[3]+v[5],_[y+17]=I+M-D-(F-v[4]),x=(I+M-D)*u[19]+(F-v[4]),E=(A-k-L)*u[18],_[y+5]=E+x,_[y+6]=E-x,T=(v[16]-v[10])*u[18],F=F*u[19]+v[4],E=A*u[12]+T+k*u[13]+L*u[14],x=-I*u[16]+F-M*u[17]+D*u[15],_[y+1]=E+x,_[y+2]=E-x,E=A*u[13]-T-k*u[14]+L*u[12],x=-I*u[17]+F-M*u[15]+D*u[16],_[y+9]=E+x,_[y+10]=E-x,E=A*u[14]-T+k*u[12]-L*u[13],x=I*u[15]-F+M*u[16]-D*u[17],_[y+13]=E+x,_[y+14]=E-x}{var O,z,q,G,K,te,re,H;O=v[8]-v[0],q=v[6]-v[2],G=v[5]-v[3],K=v[17]+v[9],te=v[16]+v[10],re=v[15]+v[11],H=v[14]+v[12],_[y+0]=K+re+H+(te+v[13]),E=(K+re+H)*u[19]-(te+v[13]),x=(O-q+G)*u[18],_[y+11]=E+x,_[y+12]=E-x,z=(v[7]-v[1])*u[18],te=v[13]-te*u[19],E=K*u[15]-te+re*u[16]+H*u[17],x=O*u[14]+z+q*u[12]+G*u[13],_[y+3]=E+x,_[y+4]=E-x,E=-K*u[17]+te-re*u[15]-H*u[16],x=O*u[13]+z-q*u[14]-G*u[12],_[y+7]=E+x,_[y+8]=E-x,E=-K*u[16]+te-re*u[17]-H*u[15],x=O*u[12]-z+q*u[13]-G*u[14],_[y+15]=E+x,_[y+16]=E-x}}this.mdct_sub48=function(_,y,v){for(var E=y,x=286,A=0;A<_.channels_out;A++){for(var T=0;T<_.mode_gr;T++){for(var k,L=_.l3_side.tt[T][A],I=L.xr,F=0,M=_.sb_sample[A][1-T],D=0,O=0;O<18/2;O++)for(p(E,x,M[D]),p(E,x+32,M[D+1]),D+=2,x+=64,k=1;k<32;k+=2)M[D-1][k]*=-1;for(k=0;k<32;k++,F+=18){var z=L.block_type,q=_.sb_sample[A][T],G=_.sb_sample[A][1-T];if(L.mixed_block_flag!=0&&k<2&&(z=0),_.amp_filter[k]<1e-12)r.fill(I,F+0,F+18,0);else{if(_.amp_filter[k]<1)for(var O=0;O<18;O++)G[O][d[k]]*=_.amp_filter[k];if(z==s.SHORT_TYPE){for(var O=-12/4;O<0;O++){var K=c[s.SHORT_TYPE][O+3];I[F+O*3+9]=q[9+O][d[k]]*K-q[8-O][d[k]],I[F+O*3+18]=q[14-O][d[k]]*K+q[15+O][d[k]],I[F+O*3+10]=q[15+O][d[k]]*K-q[14-O][d[k]],I[F+O*3+19]=G[2-O][d[k]]*K+G[3+O][d[k]],I[F+O*3+11]=G[3+O][d[k]]*K-G[2-O][d[k]],I[F+O*3+20]=G[8-O][d[k]]*K+G[9+O][d[k]]}m(I,F)}else{for(var te=i(18),O=-36/4;O<0;O++){var re,H;re=c[z][O+27]*G[O+9][d[k]]+c[z][O+36]*G[8-O][d[k]],H=c[z][O+9]*q[O+9][d[k]]-c[z][O+18]*q[8-O][d[k]],te[O+9]=re-H*l[3+O+9],te[O+18]=re*l[3+O+9]+H}g(I,F,te)}}if(z!=s.SHORT_TYPE&&k!=0)for(var O=7;O>=0;--O){var Y,Z;Y=I[F+O]*h[20+O]+I[F+-1-O]*f[28+O],Z=I[F+O]*f[28+O]-I[F+-1-O]*h[20+O],I[F+-1-O]=Y,I[F+O]=Z}}}if(E=v,x=286,_.mode_gr==1)for(var Q=0;Q<18;Q++)e.arraycopy(_.sb_sample[A][1][Q],0,_.sb_sample[A][0][Q],0,32)}}}return C2=o,C2}var R2,L$;function Hne(){if(L$)return R2;L$=1;var t=Fl(),e=Mo,n=e.System,r=e.new_float,i=e.new_float_n;function s(){this.l=r(t.SBMAX_l),this.s=i([t.SBMAX_s,3]);var o=this;this.assign=function(a){n.arraycopy(a.l,0,o.l,0,t.SBMAX_l);for(var c=0;c<t.SBMAX_s;c++)for(var l=0;l<3;l++)o.s[c][l]=a.s[c][l]}}return R2=s,R2}var k2,U$;function bFe(){if(U$)return k2;U$=1;var t=Hne();function e(){this.thm=new t,this.en=new t}return k2=e,k2}function fp(t){var e=t;this.ordinal=function(){return e}}fp.STEREO=new fp(0);fp.JOINT_STEREO=new fp(1);fp.DUAL_CHANNEL=new fp(2);fp.MONO=new fp(3);fp.NOT_SET=new fp(4);var RC=fp,M2,B$;function Fl(){if(B$)return M2;B$=1;var t=Mo,e=t.System,n=t.VbrMode,r=t.new_array_n,i=t.new_float,s=t.new_float_n,o=t.new_int,a=t.assert;c.ENCDELAY=576,c.POSTDELAY=1152,c.MDCTDELAY=48,c.FFTOFFSET=224+c.MDCTDELAY,c.DECDELAY=528,c.SBLIMIT=32,c.CBANDS=64,c.SBPSY_l=21,c.SBPSY_s=12,c.SBMAX_l=22,c.SBMAX_s=13,c.PSFB21=6,c.PSFB12=6,c.BLKSIZE=1024,c.HBLKSIZE=c.BLKSIZE/2+1,c.BLKSIZE_s=256,c.HBLKSIZE_s=c.BLKSIZE_s/2+1,c.NORM_TYPE=0,c.START_TYPE=1,c.SHORT_TYPE=2,c.STOP_TYPE=3,c.MPG_MD_LR_LR=0,c.MPG_MD_LR_I=1,c.MPG_MD_MS_LR=2,c.MPG_MD_MS_I=3,c.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function c(){var l=yFe(),u=bFe(),h=RC,f=c.FFTOFFSET,d=c.MPG_MD_MS_LR,p=null;this.psy=null;var m=null,g=null,_=null;this.setModules=function(A,T,k,L){p=A,this.psy=T,m=T,g=L,_=k};var y=new l;function v(A){var T,k;if(A.ATH.useAdjust==0){A.ATH.adjust=1;return}if(k=A.loudness_sq[0][0],T=A.loudness_sq[1][0],A.channels_out==2?(k+=A.loudness_sq[0][1],T+=A.loudness_sq[1][1]):(k+=k,T+=T),A.mode_gr==2&&(k=Math.max(k,T)),k*=.5,k*=A.ATH.aaSensitivityP,k>.03125)A.ATH.adjust>=1?A.ATH.adjust=1:A.ATH.adjust<A.ATH.adjustLimit&&(A.ATH.adjust=A.ATH.adjustLimit),A.ATH.adjustLimit=1;else{var L=31.98*k+625e-6;A.ATH.adjust>=L?(A.ATH.adjust*=L*.075+.925,A.ATH.adjust<L&&(A.ATH.adjust=L)):A.ATH.adjustLimit>=L?A.ATH.adjust=L:A.ATH.adjust<A.ATH.adjustLimit&&(A.ATH.adjust=A.ATH.adjustLimit),A.ATH.adjustLimit=L}}function E(A){var T,k;for(a(0<=A.bitrate_index&&A.bitrate_index<16),a(0<=A.mode_ext&&A.mode_ext<4),A.bitrate_stereoMode_Hist[A.bitrate_index][4]++,A.bitrate_stereoMode_Hist[15][4]++,A.channels_out==2&&(A.bitrate_stereoMode_Hist[A.bitrate_index][A.mode_ext]++,A.bitrate_stereoMode_Hist[15][A.mode_ext]++),T=0;T<A.mode_gr;++T)for(k=0;k<A.channels_out;++k){var L=A.l3_side.tt[T][k].block_type|0;A.l3_side.tt[T][k].mixed_block_flag!=0&&(L=4),A.bitrate_blockType_Hist[A.bitrate_index][L]++,A.bitrate_blockType_Hist[A.bitrate_index][5]++,A.bitrate_blockType_Hist[15][L]++,A.bitrate_blockType_Hist[15][5]++}}function x(A,T){var k=A.internal_flags,L,I;if(k.lame_encode_frame_init==0){var F,M,D=i(2014),O=i(2014);for(k.lame_encode_frame_init=1,F=0,M=0;F<286+576*(1+k.mode_gr);++F)F<576*k.mode_gr?(D[F]=0,k.channels_out==2&&(O[F]=0)):(D[F]=T[0][M],k.channels_out==2&&(O[F]=T[1][M]),++M);for(I=0;I<k.mode_gr;I++)for(L=0;L<k.channels_out;L++)k.l3_side.tt[I][L].block_type=c.SHORT_TYPE;y.mdct_sub48(k,D,O),a(576>=c.FFTOFFSET),a(k.mf_size>=c.BLKSIZE+A.framesize-c.FFTOFFSET),a(k.mf_size>=512+A.framesize-32)}}this.lame_encode_mp3_frame=function(A,T,k,L,I,F){var M,D=r([2,2]);D[0][0]=new u,D[0][1]=new u,D[1][0]=new u,D[1][1]=new u;var O=r([2,2]);O[0][0]=new u,O[0][1]=new u,O[1][0]=new u,O[1][1]=new u;var z,q=[null,null],G=A.internal_flags,K=s([2,4]),te=[.5,.5],re=[[0,0],[0,0]],H=[[0,0],[0,0]],Y,Z,Q;if(q[0]=T,q[1]=k,G.lame_encode_frame_init==0&&x(A,q),G.padding=0,(G.slot_lag-=G.frac_SpF)<0&&(G.slot_lag+=A.out_samplerate,G.padding=1),G.psymodel!=0){var ie,ge=[null,null],Te=0,be=o(2);for(Q=0;Q<G.mode_gr;Q++){for(Z=0;Z<G.channels_out;Z++)ge[Z]=q[Z],Te=576+Q*576-c.FFTOFFSET;if(A.VBR==n.vbr_mtrh||A.VBR==n.vbr_mt?ie=m.L3psycho_anal_vbr(A,ge,Te,Q,D,O,re[Q],H[Q],K[Q],be):ie=m.L3psycho_anal_ns(A,ge,Te,Q,D,O,re[Q],H[Q],K[Q],be),ie!=0)return-4;for(A.mode==h.JOINT_STEREO&&(te[Q]=K[Q][2]+K[Q][3],te[Q]>0&&(te[Q]=K[Q][3]/te[Q])),Z=0;Z<G.channels_out;Z++){var Pe=G.l3_side.tt[Q][Z];Pe.block_type=be[Z],Pe.mixed_block_flag=0}}}else for(Q=0;Q<G.mode_gr;Q++)for(Z=0;Z<G.channels_out;Z++)G.l3_side.tt[Q][Z].block_type=c.NORM_TYPE,G.l3_side.tt[Q][Z].mixed_block_flag=0,H[Q][Z]=re[Q][Z]=700;if(v(G),y.mdct_sub48(G,q[0],q[1]),G.mode_ext=c.MPG_MD_LR_LR,A.force_ms)G.mode_ext=c.MPG_MD_MS_LR;else if(A.mode==h.JOINT_STEREO){var Ge=0,Ze=0;for(Q=0;Q<G.mode_gr;Q++)for(Z=0;Z<G.channels_out;Z++)Ge+=H[Q][Z],Ze+=re[Q][Z];if(Ge<=1*Ze){var lt=G.l3_side.tt[0],pt=G.l3_side.tt[G.mode_gr-1];lt[0].block_type==lt[1].block_type&&pt[0].block_type==pt[1].block_type&&(G.mode_ext=c.MPG_MD_MS_LR)}}if(G.mode_ext==d?(z=O,Y=H):(z=D,Y=re),A.analysis&&G.pinfo!=null)for(Q=0;Q<G.mode_gr;Q++)for(Z=0;Z<G.channels_out;Z++)G.pinfo.ms_ratio[Q]=G.ms_ratio[Q],G.pinfo.ms_ener_ratio[Q]=te[Q],G.pinfo.blocktype[Q][Z]=G.l3_side.tt[Q][Z].block_type,G.pinfo.pe[Q][Z]=Y[Q][Z],e.arraycopy(G.l3_side.tt[Q][Z].xr,0,G.pinfo.xr[Q][Z],0,576),G.mode_ext==d&&(G.pinfo.ers[Q][Z]=G.pinfo.ers[Q][Z+2],e.arraycopy(G.pinfo.energy[Q][Z+2],0,G.pinfo.energy[Q][Z],0,G.pinfo.energy[Q][Z].length));if(A.VBR==n.vbr_off||A.VBR==n.vbr_abr){var ne,Le;for(ne=0;ne<18;ne++)G.nsPsy.pefirbuf[ne]=G.nsPsy.pefirbuf[ne+1];for(Le=0,Q=0;Q<G.mode_gr;Q++)for(Z=0;Z<G.channels_out;Z++)Le+=Y[Q][Z];for(G.nsPsy.pefirbuf[18]=Le,Le=G.nsPsy.pefirbuf[9],ne=0;ne<9;ne++)Le+=(G.nsPsy.pefirbuf[ne]+G.nsPsy.pefirbuf[18-ne])*c.fircoef[ne];for(Le=670*5*G.mode_gr*G.channels_out/Le,Q=0;Q<G.mode_gr;Q++)for(Z=0;Z<G.channels_out;Z++)Y[Q][Z]*=Le}if(G.iteration_loop.iteration_loop(A,Y,te,z),p.format_bitstream(A),M=p.copy_buffer(G,L,I,F,1),A.bWriteVbrTag&&g.addVbrFrame(A),A.analysis&&G.pinfo!=null){for(Z=0;Z<G.channels_out;Z++){var Ve;for(Ve=0;Ve<f;Ve++)G.pinfo.pcmdata[Z][Ve]=G.pinfo.pcmdata[Z][Ve+A.framesize];for(Ve=f;Ve<1600;Ve++)G.pinfo.pcmdata[Z][Ve]=q[Z][Ve-f]}_.set_frame_pinfo(A,z)}return E(G),M}}return M2=c,M2}var $ne=Mo,F$=$ne.Util,j$=$ne.new_float,Ca=Fl();function SFe(){var t=j$(Ca.BLKSIZE),e=j$(Ca.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(s,o,a){var c=0,l,u,h;a<<=1;var f=o+a;l=4;do{var d,p,m,g,_,y,v;v=l>>1,g=l,_=l<<1,y=_+g,l=_<<1,u=o,h=u+v;do{var E,x,A,T;x=s[u+0]-s[u+g],E=s[u+0]+s[u+g],T=s[u+_]-s[u+y],A=s[u+_]+s[u+y],s[u+_]=E-A,s[u+0]=E+A,s[u+y]=x-T,s[u+g]=x+T,x=s[h+0]-s[h+g],E=s[h+0]+s[h+g],T=F$.SQRT2*s[h+y],A=F$.SQRT2*s[h+_],s[h+_]=E-A,s[h+0]=E+A,s[h+y]=x-T,s[h+g]=x+T,h+=l,u+=l}while(u<f);for(p=n[c+0],d=n[c+1],m=1;m<v;m++){var k,L;k=1-2*d*d,L=2*d*p,u=o+m,h=o+g-m;do{var I,F,M,E,x,D,A,O,T,z;F=L*s[u+g]-k*s[h+g],I=k*s[u+g]+L*s[h+g],x=s[u+0]-I,E=s[u+0]+I,D=s[h+0]-F,M=s[h+0]+F,F=L*s[u+y]-k*s[h+y],I=k*s[u+y]+L*s[h+y],T=s[u+_]-I,A=s[u+_]+I,z=s[h+_]-F,O=s[h+_]+F,F=d*A-p*z,I=p*A+d*z,s[u+_]=E-I,s[u+0]=E+I,s[h+y]=D-F,s[h+g]=D+F,F=p*O-d*T,I=d*O+p*T,s[h+_]=M-I,s[h+0]=M+I,s[u+y]=x-F,s[u+g]=x+F,h+=l,u+=l}while(u<f);k=p,p=k*n[c+0]-d*n[c+1],d=k*n[c+1]+d*n[c+0]}c+=2}while(l<a)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,o,a,c,l){for(var u=0;u<3;u++){var h=Ca.BLKSIZE_s/2,f=65535&576/3*(u+1),d=Ca.BLKSIZE_s/8-1;do{var p,m,g,_,y,v=i[d<<2]&255;p=e[v]*c[a][l+v+f],y=e[127-v]*c[a][l+v+f+128],m=p-y,p=p+y,g=e[v+64]*c[a][l+v+f+64],y=e[63-v]*c[a][l+v+f+192],_=g-y,g=g+y,h-=4,o[u][h+0]=p+g,o[u][h+2]=p-g,o[u][h+1]=m+_,o[u][h+3]=m-_,p=e[v+1]*c[a][l+v+f+1],y=e[126-v]*c[a][l+v+f+129],m=p-y,p=p+y,g=e[v+65]*c[a][l+v+f+65],y=e[62-v]*c[a][l+v+f+193],_=g-y,g=g+y,o[u][h+Ca.BLKSIZE_s/2+0]=p+g,o[u][h+Ca.BLKSIZE_s/2+2]=p-g,o[u][h+Ca.BLKSIZE_s/2+1]=m+_,o[u][h+Ca.BLKSIZE_s/2+3]=m-_}while(--d>=0);r(o[u],h,Ca.BLKSIZE_s/2)}},this.fft_long=function(s,o,a,c,l){var u=Ca.BLKSIZE/8-1,h=Ca.BLKSIZE/2;do{var f,d,p,m,g,_=i[u]&255;f=t[_]*c[a][l+_],g=t[_+512]*c[a][l+_+512],d=f-g,f=f+g,p=t[_+256]*c[a][l+_+256],g=t[_+768]*c[a][l+_+768],m=p-g,p=p+g,h-=4,o[h+0]=f+p,o[h+2]=f-p,o[h+1]=d+m,o[h+3]=d-m,f=t[_+1]*c[a][l+_+1],g=t[_+513]*c[a][l+_+513],d=f-g,f=f+g,p=t[_+257]*c[a][l+_+257],g=t[_+769]*c[a][l+_+769],m=p-g,p=p+g,o[h+Ca.BLKSIZE/2+0]=f+p,o[h+Ca.BLKSIZE/2+2]=f-p,o[h+Ca.BLKSIZE/2+1]=d+m,o[h+Ca.BLKSIZE/2+3]=d-m}while(--u>=0);r(o,h,Ca.BLKSIZE/2)},this.init_fft=function(s){for(var o=0;o<Ca.BLKSIZE;o++)t[o]=.42-.5*Math.cos(2*Math.PI*(o+.5)/Ca.BLKSIZE)+.08*Math.cos(4*Math.PI*(o+.5)/Ca.BLKSIZE);for(var o=0;o<Ca.BLKSIZE_s/2;o++)e[o]=.5*(1-Math.cos(2*Math.PI*(o+.5)/Ca.BLKSIZE_s))}}var EFe=SFe,Gg=Mo,CS=Gg.VbrMode,z$=Gg.Float,RS=Gg.ShortBlock,Ku=Gg.Util,xFe=Gg.Arrays,za=Gg.new_float,Bf=Gg.new_float_n,By=Gg.new_int,Jr=Gg.assert,wFe=EFe,Gt=Fl();function TFe(){var t=RC,e=new wFe,n=2.302585092994046,r=2,i=16,s=2,o=16,a=.34,c=1/(14752*14752)/(Gt.BLKSIZE/2),l=.01,u=.8,h=.6,f=.3,d=3.5,p=21,m=.2302585093;function g(W,oe){for(var xe=0,Ce=0;Ce<Gt.BLKSIZE/2;++Ce)xe+=W[Ce]*oe.ATH.eql_w[Ce];return xe*=c,xe}function _(W,oe,xe,Ce,Se,ye,Ke,ke,He,Fe,We){var at=W.internal_flags;if(He<2)e.fft_long(at,Ce[Se],He,Fe,We),e.fft_short(at,ye[Ke],He,Fe,We);else if(He==2){for(var Be=Gt.BLKSIZE-1;Be>=0;--Be){var nt=Ce[Se+0][Be],it=Ce[Se+1][Be];Ce[Se+0][Be]=(nt+it)*Ku.SQRT2*.5,Ce[Se+1][Be]=(nt-it)*Ku.SQRT2*.5}for(var xt=2;xt>=0;--xt)for(var Be=Gt.BLKSIZE_s-1;Be>=0;--Be){var nt=ye[Ke+0][xt][Be],it=ye[Ke+1][xt][Be];ye[Ke+0][xt][Be]=(nt+it)*Ku.SQRT2*.5,ye[Ke+1][xt][Be]=(nt-it)*Ku.SQRT2*.5}}oe[0]=Ce[Se+0][0],oe[0]*=oe[0];for(var Be=Gt.BLKSIZE/2-1;Be>=0;--Be){var ot=Ce[Se+0][Gt.BLKSIZE/2-Be],tn=Ce[Se+0][Gt.BLKSIZE/2+Be];oe[Gt.BLKSIZE/2-Be]=(ot*ot+tn*tn)*.5}for(var xt=2;xt>=0;--xt){xe[xt][0]=ye[Ke+0][xt][0],xe[xt][0]*=xe[xt][0];for(var Be=Gt.BLKSIZE_s/2-1;Be>=0;--Be){var ot=ye[Ke+0][xt][Gt.BLKSIZE_s/2-Be],tn=ye[Ke+0][xt][Gt.BLKSIZE_s/2+Be];xe[xt][Gt.BLKSIZE_s/2-Be]=(ot*ot+tn*tn)*.5}}{for(var ln=0,Be=11;Be<Gt.HBLKSIZE;Be++)ln+=oe[Be];at.tot_ener[He]=ln}if(W.analysis){for(var Be=0;Be<Gt.HBLKSIZE;Be++)at.pinfo.energy[ke][He][Be]=at.pinfo.energy_save[He][Be],at.pinfo.energy_save[He][Be]=oe[Be];at.pinfo.pe[ke][He]=at.pe[He]}W.athaa_loudapprox==2&&He<2&&(at.loudness_sq[ke][He]=at.loudness_sq_save[He],at.loudness_sq_save[He]=g(oe,at))}var y=8,v=23,E=15,x,A,T,k=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function L(){x=Math.pow(10,(y+1)/16),A=Math.pow(10,(v+1)/16),T=Math.pow(10,E/10)}var I=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],F=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],M=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function D(W,oe,xe,Ce,Se,ye){var Ke;if(oe>W)if(oe<W*A)Ke=oe/W;else return W+oe;else{if(W>=oe*A)return W+oe;Ke=W/oe}if(W+=oe,Ce+3<=6){if(Ke>=x)return W;var ke=0|Ku.FAST_LOG10_X(Ke,16);return W*F[ke]}var ke=0|Ku.FAST_LOG10_X(Ke,16);if(oe=Se.ATH.cb_l[xe]*Se.ATH.adjust,W<T*oe){if(W>oe){var He,Fe;return He=1,ke<=13&&(He=M[ke]),Fe=Ku.FAST_LOG10_X(W/oe,10/15),W*((I[ke]-He)*Fe+He)}return ke>13?W:W*M[ke]}return W*I[ke]}var O=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function z(W,oe,xe){var Ce;if(W<0&&(W=0),oe<0&&(oe=0),W<=0)return oe;if(oe<=0)return W;if(oe>W?Ce=oe/W:Ce=W/oe,-2<=xe&&xe<=2){if(Ce>=x)return W+oe;var Se=0|Ku.FAST_LOG10_X(Ce,16);return(W+oe)*O[Se]}return Ce<A?W+oe:(W<oe&&(W=oe),W)}function q(W,oe){var xe=W.internal_flags;if(xe.channels_out>1){for(var Ce=0;Ce<Gt.SBMAX_l;Ce++){var Se=xe.thm[0].l[Ce],ye=xe.thm[1].l[Ce];xe.thm[0].l[Ce]+=ye*oe,xe.thm[1].l[Ce]+=Se*oe}for(var Ce=0;Ce<Gt.SBMAX_s;Ce++)for(var Ke=0;Ke<3;Ke++){var Se=xe.thm[0].s[Ce][Ke],ye=xe.thm[1].s[Ce][Ke];xe.thm[0].s[Ce][Ke]+=ye*oe,xe.thm[1].s[Ce][Ke]+=Se*oe}}}function G(W){for(var oe=0;oe<Gt.SBMAX_l;oe++)if(!(W.thm[0].l[oe]>1.58*W.thm[1].l[oe]||W.thm[1].l[oe]>1.58*W.thm[0].l[oe])){var xe=W.mld_l[oe]*W.en[3].l[oe],Ce=Math.max(W.thm[2].l[oe],Math.min(W.thm[3].l[oe],xe));xe=W.mld_l[oe]*W.en[2].l[oe];var Se=Math.max(W.thm[3].l[oe],Math.min(W.thm[2].l[oe],xe));W.thm[2].l[oe]=Ce,W.thm[3].l[oe]=Se}for(var oe=0;oe<Gt.SBMAX_s;oe++)for(var ye=0;ye<3;ye++)if(!(W.thm[0].s[oe][ye]>1.58*W.thm[1].s[oe][ye]||W.thm[1].s[oe][ye]>1.58*W.thm[0].s[oe][ye])){var xe=W.mld_s[oe]*W.en[3].s[oe][ye],Ce=Math.max(W.thm[2].s[oe][ye],Math.min(W.thm[3].s[oe][ye],xe));xe=W.mld_s[oe]*W.en[2].s[oe][ye];var Se=Math.max(W.thm[3].s[oe][ye],Math.min(W.thm[2].s[oe][ye],xe));W.thm[2].s[oe][ye]=Ce,W.thm[3].s[oe][ye]=Se}}function K(W,oe,xe){var Ce=oe,Se=Math.pow(10,xe);oe*=2,Ce*=2;for(var ye=0;ye<Gt.SBMAX_l;ye++){var Ke,ke,He,Fe;if(Fe=W.ATH.cb_l[W.bm_l[ye]]*Se,Ke=Math.min(Math.max(W.thm[0].l[ye],Fe),Math.max(W.thm[1].l[ye],Fe)),ke=Math.max(W.thm[2].l[ye],Fe),He=Math.max(W.thm[3].l[ye],Fe),Ke*oe<ke+He){var We=Ke*Ce/(ke+He);ke*=We,He*=We}W.thm[2].l[ye]=Math.min(ke,W.thm[2].l[ye]),W.thm[3].l[ye]=Math.min(He,W.thm[3].l[ye])}Se*=Gt.BLKSIZE_s/Gt.BLKSIZE;for(var ye=0;ye<Gt.SBMAX_s;ye++)for(var at=0;at<3;at++){var Ke,ke,He,Fe;if(Fe=W.ATH.cb_s[W.bm_s[ye]]*Se,Ke=Math.min(Math.max(W.thm[0].s[ye][at],Fe),Math.max(W.thm[1].s[ye][at],Fe)),ke=Math.max(W.thm[2].s[ye][at],Fe),He=Math.max(W.thm[3].s[ye][at],Fe),Ke*oe<ke+He){var We=Ke*oe/(ke+He);ke*=We,He*=We}W.thm[2].s[ye][at]=Math.min(W.thm[2].s[ye][at],ke),W.thm[3].s[ye][at]=Math.min(W.thm[3].s[ye][at],He)}}function te(W,oe,xe,Ce,Se){var ye,Ke,ke=0,He=0;for(ye=Ke=0;ye<Gt.SBMAX_s;++Ke,++ye){for(var Fe=W.bo_s[ye],We=W.npart_s,at=Fe<We?Fe:We;Ke<at;)Jr(oe[Ke]>=0),Jr(xe[Ke]>=0),ke+=oe[Ke],He+=xe[Ke],Ke++;if(W.en[Ce].s[ye][Se]=ke,W.thm[Ce].s[ye][Se]=He,Ke>=We){++ye;break}Jr(oe[Ke]>=0),Jr(xe[Ke]>=0);{var Be=W.PSY.bo_s_weight[ye],nt=1-Be;ke=Be*oe[Ke],He=Be*xe[Ke],W.en[Ce].s[ye][Se]+=ke,W.thm[Ce].s[ye][Se]+=He,ke=nt*oe[Ke],He=nt*xe[Ke]}}for(;ye<Gt.SBMAX_s;++ye)W.en[Ce].s[ye][Se]=0,W.thm[Ce].s[ye][Se]=0}function re(W,oe,xe,Ce){var Se,ye,Ke=0,ke=0;for(Se=ye=0;Se<Gt.SBMAX_l;++ye,++Se){for(var He=W.bo_l[Se],Fe=W.npart_l,We=He<Fe?He:Fe;ye<We;)Jr(oe[ye]>=0),Jr(xe[ye]>=0),Ke+=oe[ye],ke+=xe[ye],ye++;if(W.en[Ce].l[Se]=Ke,W.thm[Ce].l[Se]=ke,ye>=Fe){++Se;break}Jr(oe[ye]>=0),Jr(xe[ye]>=0);{var at=W.PSY.bo_l_weight[Se],Be=1-at;Ke=at*oe[ye],ke=at*xe[ye],W.en[Ce].l[Se]+=Ke,W.thm[Ce].l[Se]+=ke,Ke=Be*oe[ye],ke=Be*xe[ye]}}for(;Se<Gt.SBMAX_l;++Se)W.en[Ce].l[Se]=0,W.thm[Ce].l[Se]=0}function H(W,oe,xe,Ce,Se,ye){var Ke=W.internal_flags,ke,He;for(He=ke=0;He<Ke.npart_s;++He){for(var Fe=0,We=Ke.numlines_s[He],at=0;at<We;++at,++ke){var Be=oe[ye][ke];Fe+=Be}xe[He]=Fe}for(Jr(He==Ke.npart_s),ke=He=0;He<Ke.npart_s;He++){var nt=Ke.s3ind_s[He][0],it=Ke.s3_ss[ke++]*xe[nt];for(++nt;nt<=Ke.s3ind_s[He][1];)it+=Ke.s3_ss[ke]*xe[nt],++ke,++nt;{var xt=s*Ke.nb_s1[Se][He];Ce[He]=Math.min(it,xt)}if(Ke.blocktype_old[Se&1]==Gt.SHORT_TYPE){var xt=o*Ke.nb_s2[Se][He],ot=Ce[He];Ce[He]=Math.min(xt,ot)}Ke.nb_s2[Se][He]=Ke.nb_s1[Se][He],Ke.nb_s1[Se][He]=it,Jr(Ce[He]>=0)}for(;He<=Gt.CBANDS;++He)xe[He]=0,Ce[He]=0}function Y(W,oe,xe,Ce){var Se=W.internal_flags;W.short_blocks==RS.short_block_coupled&&!(oe[0]!=0&&oe[1]!=0)&&(oe[0]=oe[1]=0);for(var ye=0;ye<Se.channels_out;ye++)Ce[ye]=Gt.NORM_TYPE,W.short_blocks==RS.short_block_dispensed&&(oe[ye]=1),W.short_blocks==RS.short_block_forced&&(oe[ye]=0),oe[ye]!=0?(Jr(Se.blocktype_old[ye]!=Gt.START_TYPE),Se.blocktype_old[ye]==Gt.SHORT_TYPE&&(Ce[ye]=Gt.STOP_TYPE)):(Ce[ye]=Gt.SHORT_TYPE,Se.blocktype_old[ye]==Gt.NORM_TYPE&&(Se.blocktype_old[ye]=Gt.START_TYPE),Se.blocktype_old[ye]==Gt.STOP_TYPE&&(Se.blocktype_old[ye]=Gt.SHORT_TYPE)),xe[ye]=Se.blocktype_old[ye],Se.blocktype_old[ye]=Ce[ye]}function Z(W,oe,xe){return xe>=1?W:xe<=0?oe:oe>0?Math.pow(W/oe,xe)*oe:0}var Q=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function ie(W,oe){for(var xe=309.07,Ce=0;Ce<Gt.SBMAX_s-1;Ce++)for(var Se=0;Se<3;Se++){var ye=W.thm.s[Ce][Se];if(ye>0){var Ke=ye*oe,ke=W.en.s[Ce][Se];ke>Ke&&(ke>Ke*1e10?xe+=Q[Ce]*(10*n):xe+=Q[Ce]*Ku.FAST_LOG10(ke/Ke))}}return xe}var ge=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function Te(W,oe){for(var xe=281.0575,Ce=0;Ce<Gt.SBMAX_l-1;Ce++){var Se=W.thm.l[Ce];if(Se>0){var ye=Se*oe,Ke=W.en.l[Ce];Ke>ye&&(Ke>ye*1e10?xe+=ge[Ce]*(10*n):xe+=ge[Ce]*Ku.FAST_LOG10(Ke/ye))}}return xe}function be(W,oe,xe,Ce,Se){var ye,Ke;for(ye=Ke=0;ye<W.npart_l;++ye){var ke=0,He=0,Fe;for(Fe=0;Fe<W.numlines_l[ye];++Fe,++Ke){var We=oe[Ke];ke+=We,He<We&&(He=We)}xe[ye]=ke,Ce[ye]=He,Se[ye]=ke*W.rnumlines_l[ye],Jr(W.rnumlines_l[ye]>=0),Jr(xe[ye]>=0),Jr(Ce[ye]>=0),Jr(Se[ye]>=0)}}function Pe(W,oe,xe,Ce){var Se=k.length-1,ye=0,Ke=xe[ye]+xe[ye+1];if(Ke>0){var ke=oe[ye];ke<oe[ye+1]&&(ke=oe[ye+1]),Jr(W.numlines_l[ye]+W.numlines_l[ye+1]-1>0),Ke=20*(ke*2-Ke)/(Ke*(W.numlines_l[ye]+W.numlines_l[ye+1]-1));var He=0|Ke;He>Se&&(He=Se),Ce[ye]=He}else Ce[ye]=0;for(ye=1;ye<W.npart_l-1;ye++)if(Ke=xe[ye-1]+xe[ye]+xe[ye+1],Ke>0){var ke=oe[ye-1];ke<oe[ye]&&(ke=oe[ye]),ke<oe[ye+1]&&(ke=oe[ye+1]),Jr(W.numlines_l[ye-1]+W.numlines_l[ye]+W.numlines_l[ye+1]-1>0),Ke=20*(ke*3-Ke)/(Ke*(W.numlines_l[ye-1]+W.numlines_l[ye]+W.numlines_l[ye+1]-1));var He=0|Ke;He>Se&&(He=Se),Ce[ye]=He}else Ce[ye]=0;if(Jr(ye==W.npart_l-1),Ke=xe[ye-1]+xe[ye],Ke>0){var ke=oe[ye-1];ke<oe[ye]&&(ke=oe[ye]),Jr(W.numlines_l[ye-1]+W.numlines_l[ye]-1>0),Ke=20*(ke*2-Ke)/(Ke*(W.numlines_l[ye-1]+W.numlines_l[ye]-1));var He=0|Ke;He>Se&&(He=Se),Ce[ye]=He}else Ce[ye]=0;Jr(ye==W.npart_l-1)}var Ge=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(W,oe,xe,Ce,Se,ye,Ke,ke,He,Fe){var We=W.internal_flags,at=Bf([2,Gt.BLKSIZE]),Be=Bf([2,3,Gt.BLKSIZE_s]),nt=za(Gt.CBANDS+1),it=za(Gt.CBANDS+1),xt=za(Gt.CBANDS+2),ot=By(2),tn=By(2),ln,Rt,Vt,_t,Jt,Tn,qt,An,Ln=Bf([2,576]),mr,ns=By(Gt.CBANDS+2),hi=By(Gt.CBANDS+2);for(xFe.fill(hi,0),ln=We.channels_out,W.mode==t.JOINT_STEREO&&(ln=4),W.VBR==CS.vbr_off?mr=We.ResvMax==0?0:We.ResvSize/We.ResvMax*.5:W.VBR==CS.vbr_rh||W.VBR==CS.vbr_mtrh||W.VBR==CS.vbr_mt?mr=.6:mr=1,Rt=0;Rt<We.channels_out;Rt++){var ti=oe[Rt],Fi=xe+576-350-p+192;for(_t=0;_t<576;_t++){var rs,qi;for(rs=ti[Fi+_t+10],qi=0,Jt=0;Jt<(p-1)/2-1;Jt+=2)rs+=Ge[Jt]*(ti[Fi+_t+Jt]+ti[Fi+_t+p-Jt]),qi+=Ge[Jt+1]*(ti[Fi+_t+Jt+1]+ti[Fi+_t+p-Jt-1]);Ln[Rt][_t]=rs+qi}Se[Ce][Rt].en.assign(We.en[Rt]),Se[Ce][Rt].thm.assign(We.thm[Rt]),ln>2&&(ye[Ce][Rt].en.assign(We.en[Rt+2]),ye[Ce][Rt].thm.assign(We.thm[Rt+2]))}for(Rt=0;Rt<ln;Rt++){var is,ss,je=za(12),vt=[0,0,0,0],It=za(12),Ut=1,yt,an=za(Gt.CBANDS),In=za(Gt.CBANDS),_n=[0,0,0,0],Pn=za(Gt.HBLKSIZE),tr=Bf([3,Gt.HBLKSIZE_s]);for(Jr(We.npart_s<=Gt.CBANDS),Jr(We.npart_l<=Gt.CBANDS),_t=0;_t<3;_t++)je[_t]=We.nsPsy.last_en_subshort[Rt][_t+6],Jr(We.nsPsy.last_en_subshort[Rt][_t+4]>0),It[_t]=je[_t]/We.nsPsy.last_en_subshort[Rt][_t+4],vt[0]+=je[_t];if(Rt==2)for(_t=0;_t<576;_t++){var fr,Cn;fr=Ln[0][_t],Cn=Ln[1][_t],Ln[0][_t]=fr+Cn,Ln[1][_t]=fr-Cn}{var yr=Ln[Rt&1],Hr=0;for(_t=0;_t<9;_t++){for(var ds=Hr+64,Lr=1;Hr<ds;Hr++)Lr<Math.abs(yr[Hr])&&(Lr=Math.abs(yr[Hr]));We.nsPsy.last_en_subshort[Rt][_t]=je[_t+3]=Lr,vt[1+_t/3]+=Lr,Lr>je[_t+3-2]?(Jr(je[_t+3-2]>0),Lr=Lr/je[_t+3-2]):je[_t+3-2]>Lr*10?Lr=je[_t+3-2]/(Lr*10):Lr=0,It[_t+3]=Lr}}if(W.analysis){var Gr=It[0];for(_t=1;_t<12;_t++)Gr<It[_t]&&(Gr=It[_t]);We.pinfo.ers[Ce][Rt]=We.pinfo.ers_save[Rt],We.pinfo.ers_save[Rt]=Gr}for(yt=Rt==3?We.nsPsy.attackthre_s:We.nsPsy.attackthre,_t=0;_t<12;_t++)_n[_t/3]==0&&It[_t]>yt&&(_n[_t/3]=_t%3+1);for(_t=1;_t<4;_t++){var ar;vt[_t-1]>vt[_t]?(Jr(vt[_t]>0),ar=vt[_t-1]/vt[_t]):(Jr(vt[_t-1]>0),ar=vt[_t]/vt[_t-1]),ar<1.7&&(_n[_t]=0,_t==1&&(_n[0]=0))}for(_n[0]!=0&&We.nsPsy.lastAttacks[Rt]!=0&&(_n[0]=0),(We.nsPsy.lastAttacks[Rt]==3||_n[0]+_n[1]+_n[2]+_n[3]!=0)&&(Ut=0,_n[1]!=0&&_n[0]!=0&&(_n[1]=0),_n[2]!=0&&_n[1]!=0&&(_n[2]=0),_n[3]!=0&&_n[2]!=0&&(_n[3]=0)),Rt<2?tn[Rt]=Ut:Ut==0&&(tn[0]=tn[1]=0),He[Rt]=We.tot_ener[Rt],ss=Be,is=at,_(W,Pn,tr,is,Rt&1,ss,Rt&1,Ce,Rt,oe,xe),be(We,Pn,nt,an,In),Pe(We,an,In,ns),An=0;An<3;An++){var br,Un;for(H(W,tr,it,xt,Rt,An),te(We,it,xt,Rt,An),qt=0;qt<Gt.SBMAX_s;qt++){if(Un=We.thm[Rt].s[qt][An],Un*=u,_n[An]>=2||_n[An+1]==1){var bi=An!=0?An-1:2,Lr=Z(We.thm[Rt].s[qt][bi],Un,h*mr);Un=Math.min(Un,Lr)}if(_n[An]==1){var bi=An!=0?An-1:2,Lr=Z(We.thm[Rt].s[qt][bi],Un,f*mr);Un=Math.min(Un,Lr)}else if(An!=0&&_n[An-1]==3||An==0&&We.nsPsy.lastAttacks[Rt]==3){var bi=An!=2?An+1:0,Lr=Z(We.thm[Rt].s[qt][bi],Un,f*mr);Un=Math.min(Un,Lr)}br=je[An*3+3]+je[An*3+4]+je[An*3+5],je[An*3+5]*6<br&&(Un*=.5,je[An*3+4]*6<br&&(Un*=.5)),We.thm[Rt].s[qt][An]=Un}}for(We.nsPsy.lastAttacks[Rt]=_n[2],Tn=0,Vt=0;Vt<We.npart_l;Vt++){for(var ai=We.s3ind[Vt][0],Rs=nt[ai]*k[ns[ai]],lo=We.s3_ll[Tn++]*Rs;++ai<=We.s3ind[Vt][1];)Rs=nt[ai]*k[ns[ai]],lo=D(lo,We.s3_ll[Tn++]*Rs,ai,ai-Vt,We);lo*=.158489319246111,We.blocktype_old[Rt&1]==Gt.SHORT_TYPE?xt[Vt]=lo:xt[Vt]=Z(Math.min(lo,Math.min(r*We.nb_1[Rt][Vt],i*We.nb_2[Rt][Vt])),lo,mr),We.nb_2[Rt][Vt]=We.nb_1[Rt][Vt],We.nb_1[Rt][Vt]=lo}for(;Vt<=Gt.CBANDS;++Vt)nt[Vt]=0,xt[Vt]=0;re(We,nt,xt,Rt)}if((W.mode==t.STEREO||W.mode==t.JOINT_STEREO)&&W.interChRatio>0&&q(W,W.interChRatio),W.mode==t.JOINT_STEREO){var Ri;G(We),Ri=W.msfix,Math.abs(Ri)>0&&K(We,Ri,W.ATHlower*We.ATH.adjust)}for(Y(W,tn,Fe,ot),Rt=0;Rt<ln;Rt++){var Mn,Pi=0,Xn,ps;Rt>1?(Mn=ke,Pi=-2,Xn=Gt.NORM_TYPE,(Fe[0]==Gt.SHORT_TYPE||Fe[1]==Gt.SHORT_TYPE)&&(Xn=Gt.SHORT_TYPE),ps=ye[Ce][Rt-2]):(Mn=Ke,Pi=0,Xn=Fe[Rt],ps=Se[Ce][Rt]),Xn==Gt.SHORT_TYPE?Mn[Pi+Rt]=ie(ps,We.masking_lower):Mn[Pi+Rt]=Te(ps,We.masking_lower),W.analysis&&(We.pinfo.pe[Ce][Rt]=Mn[Pi+Rt])}return 0};function Ze(W,oe,xe,Ce,Se,ye,Ke,ke){var He=W.internal_flags;if(Ce<2)e.fft_long(He,Ke[ke],Ce,oe,xe);else if(Ce==2)for(var Fe=Gt.BLKSIZE-1;Fe>=0;--Fe){var We=Ke[ke+0][Fe],at=Ke[ke+1][Fe];Ke[ke+0][Fe]=(We+at)*Ku.SQRT2*.5,Ke[ke+1][Fe]=(We-at)*Ku.SQRT2*.5}ye[0]=Ke[ke+0][0],ye[0]*=ye[0];for(var Fe=Gt.BLKSIZE/2-1;Fe>=0;--Fe){var Be=Ke[ke+0][Gt.BLKSIZE/2-Fe],nt=Ke[ke+0][Gt.BLKSIZE/2+Fe];ye[Gt.BLKSIZE/2-Fe]=(Be*Be+nt*nt)*.5}{for(var it=0,Fe=11;Fe<Gt.HBLKSIZE;Fe++)it+=ye[Fe];He.tot_ener[Ce]=it}if(W.analysis){for(var Fe=0;Fe<Gt.HBLKSIZE;Fe++)He.pinfo.energy[Se][Ce][Fe]=He.pinfo.energy_save[Ce][Fe],He.pinfo.energy_save[Ce][Fe]=ye[Fe];He.pinfo.pe[Se][Ce]=He.pe[Ce]}}function lt(W,oe,xe,Ce,Se,ye,Ke,ke){var He=W.internal_flags;if(Se==0&&Ce<2&&e.fft_short(He,Ke[ke],Ce,oe,xe),Ce==2)for(var Fe=Gt.BLKSIZE_s-1;Fe>=0;--Fe){var We=Ke[ke+0][Se][Fe],at=Ke[ke+1][Se][Fe];Ke[ke+0][Se][Fe]=(We+at)*Ku.SQRT2*.5,Ke[ke+1][Se][Fe]=(We-at)*Ku.SQRT2*.5}ye[Se][0]=Ke[ke+0][Se][0],ye[Se][0]*=ye[Se][0];for(var Fe=Gt.BLKSIZE_s/2-1;Fe>=0;--Fe){var Be=Ke[ke+0][Se][Gt.BLKSIZE_s/2-Fe],nt=Ke[ke+0][Se][Gt.BLKSIZE_s/2+Fe];ye[Se][Gt.BLKSIZE_s/2-Fe]=(Be*Be+nt*nt)*.5}}function pt(W,oe,xe,Ce){var Se=W.internal_flags;W.athaa_loudapprox==2&&xe<2&&(Se.loudness_sq[oe][xe]=Se.loudness_sq_save[xe],Se.loudness_sq_save[xe]=g(Ce,Se))}var ne=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Le(W,oe,xe,Ce,Se,ye,Ke,ke,He,Fe){for(var We=Bf([2,576]),at=W.internal_flags,Be=at.channels_out,nt=W.mode==t.JOINT_STEREO?4:Be,it=0;it<Be;it++){firbuf=oe[it];for(var xt=xe+576-350-p+192,ot=0;ot<576;ot++){var tn,ln;tn=firbuf[xt+ot+10],ln=0;for(var Rt=0;Rt<(p-1)/2-1;Rt+=2)tn+=ne[Rt]*(firbuf[xt+ot+Rt]+firbuf[xt+ot+p-Rt]),ln+=ne[Rt+1]*(firbuf[xt+ot+Rt+1]+firbuf[xt+ot+p-Rt-1]);We[it][ot]=tn+ln}Se[Ce][it].en.assign(at.en[it]),Se[Ce][it].thm.assign(at.thm[it]),nt>2&&(ye[Ce][it].en.assign(at.en[it+2]),ye[Ce][it].thm.assign(at.thm[it+2]))}for(var it=0;it<nt;it++){var Vt=za(12),_t=za(12),Jt=[0,0,0,0],Tn=We[it&1],qt=0,An=it==3?at.nsPsy.attackthre_s:at.nsPsy.attackthre,Ln=1;if(it==2)for(var ot=0,Rt=576;Rt>0;++ot,--Rt){var mr=We[0][ot],ns=We[1][ot];We[0][ot]=mr+ns,We[1][ot]=mr-ns}for(var ot=0;ot<3;ot++)_t[ot]=at.nsPsy.last_en_subshort[it][ot+6],Jr(at.nsPsy.last_en_subshort[it][ot+4]>0),Vt[ot]=_t[ot]/at.nsPsy.last_en_subshort[it][ot+4],Jt[0]+=_t[ot];for(var ot=0;ot<9;ot++){for(var hi=qt+64,ti=1;qt<hi;qt++)ti<Math.abs(Tn[qt])&&(ti=Math.abs(Tn[qt]));at.nsPsy.last_en_subshort[it][ot]=_t[ot+3]=ti,Jt[1+ot/3]+=ti,ti>_t[ot+3-2]?(Jr(_t[ot+3-2]>0),ti=ti/_t[ot+3-2]):_t[ot+3-2]>ti*10?ti=_t[ot+3-2]/(ti*10):ti=0,Vt[ot+3]=ti}for(var ot=0;ot<3;++ot){var Fi=_t[ot*3+3]+_t[ot*3+4]+_t[ot*3+5],rs=1;_t[ot*3+5]*6<Fi&&(rs*=.5,_t[ot*3+4]*6<Fi&&(rs*=.5)),ke[it][ot]=rs}if(W.analysis){for(var qi=Vt[0],ot=1;ot<12;ot++)qi<Vt[ot]&&(qi=Vt[ot]);at.pinfo.ers[Ce][it]=at.pinfo.ers_save[it],at.pinfo.ers_save[it]=qi}for(var ot=0;ot<12;ot++)He[it][ot/3]==0&&Vt[ot]>An&&(He[it][ot/3]=ot%3+1);for(var ot=1;ot<4;ot++){var is=Jt[ot-1],ss=Jt[ot],je=Math.max(is,ss);je<4e4&&is<1.7*ss&&ss<1.7*is&&(ot==1&&He[it][0]<=He[it][ot]&&(He[it][0]=0),He[it][ot]=0)}He[it][0]<=at.nsPsy.lastAttacks[it]&&(He[it][0]=0),(at.nsPsy.lastAttacks[it]==3||He[it][0]+He[it][1]+He[it][2]+He[it][3]!=0)&&(Ln=0,He[it][1]!=0&&He[it][0]!=0&&(He[it][1]=0),He[it][2]!=0&&He[it][1]!=0&&(He[it][2]=0),He[it][3]!=0&&He[it][2]!=0&&(He[it][3]=0)),it<2?Fe[it]=Ln:Ln==0&&(Fe[0]=Fe[1]=0),Ke[it]=at.tot_ener[it]}}function Ve(W,oe,xe){if(xe==0)for(var Ce=0;Ce<W.npart_s;Ce++)W.nb_s2[oe][Ce]=W.nb_s1[oe][Ce],W.nb_s1[oe][Ce]=0}function De(W,oe){for(var xe=0;xe<W.npart_l;xe++)W.nb_2[oe][xe]=W.nb_1[oe][xe],W.nb_1[oe][xe]=0}function Ie(W,oe,xe,Ce){var Se=k.length-1,ye=0,Ke=xe[ye]+xe[ye+1];if(Ke>0){var ke=oe[ye];ke<oe[ye+1]&&(ke=oe[ye+1]),Jr(W.numlines_s[ye]+W.numlines_s[ye+1]-1>0),Ke=20*(ke*2-Ke)/(Ke*(W.numlines_s[ye]+W.numlines_s[ye+1]-1));var He=0|Ke;He>Se&&(He=Se),Ce[ye]=He}else Ce[ye]=0;for(ye=1;ye<W.npart_s-1;ye++)if(Ke=xe[ye-1]+xe[ye]+xe[ye+1],Jr(ye+1<W.npart_s),Ke>0){var ke=oe[ye-1];ke<oe[ye]&&(ke=oe[ye]),ke<oe[ye+1]&&(ke=oe[ye+1]),Jr(W.numlines_s[ye-1]+W.numlines_s[ye]+W.numlines_s[ye+1]-1>0),Ke=20*(ke*3-Ke)/(Ke*(W.numlines_s[ye-1]+W.numlines_s[ye]+W.numlines_s[ye+1]-1));var He=0|Ke;He>Se&&(He=Se),Ce[ye]=He}else Ce[ye]=0;if(Jr(ye==W.npart_s-1),Ke=xe[ye-1]+xe[ye],Ke>0){var ke=oe[ye-1];ke<oe[ye]&&(ke=oe[ye]),Jr(W.numlines_s[ye-1]+W.numlines_s[ye]-1>0),Ke=20*(ke*2-Ke)/(Ke*(W.numlines_s[ye-1]+W.numlines_s[ye]-1));var He=0|Ke;He>Se&&(He=Se),Ce[ye]=He}else Ce[ye]=0;Jr(ye==W.npart_s-1)}function ae(W,oe,xe,Ce,Se,ye){var Ke=W.internal_flags,ke=new float[Gt.CBANDS],He=za(Gt.CBANDS),Fe,We,at,Be=new int[Gt.CBANDS];for(at=We=0;at<Ke.npart_s;++at){var nt=0,it=0,xt=Ke.numlines_s[at];for(Fe=0;Fe<xt;++Fe,++We){var ot=oe[ye][We];nt+=ot,it<ot&&(it=ot)}xe[at]=nt,ke[at]=it,He[at]=nt/xt,Jr(He[at]>=0)}for(Jr(at==Ke.npart_s);at<Gt.CBANDS;++at)ke[at]=0,He[at]=0;for(Ie(Ke,ke,He,Be),We=at=0;at<Ke.npart_s;at++){var tn=Ke.s3ind_s[at][0],ln=Ke.s3ind_s[at][1],Rt,Vt,_t,Jt,Tn;for(Rt=Be[tn],Vt=1,Jt=Ke.s3_ss[We]*xe[tn]*k[Be[tn]],++We,++tn;tn<=ln;)Rt+=Be[tn],Vt+=1,_t=Ke.s3_ss[We]*xe[tn]*k[Be[tn]],Jt=z(Jt,_t,tn-at),++We,++tn;Rt=(1+2*Rt)/(2*Vt),Tn=k[Rt]*.5,Jt*=Tn,Ce[at]=Jt,Ke.nb_s2[Se][at]=Ke.nb_s1[Se][at],Ke.nb_s1[Se][at]=Jt,_t=ke[at],_t*=Ke.minval_s[at],_t*=Tn,Ce[at]>_t&&(Ce[at]=_t),Ke.masking_lower>1&&(Ce[at]*=Ke.masking_lower),Ce[at]>xe[at]&&(Ce[at]=xe[at]),Ke.masking_lower<1&&(Ce[at]*=Ke.masking_lower),Jr(Ce[at]>=0)}for(;at<Gt.CBANDS;++at)xe[at]=0,Ce[at]=0}function ve(W,oe,xe,Ce,Se){var ye=za(Gt.CBANDS),Ke=za(Gt.CBANDS),ke=By(Gt.CBANDS+2),He;be(W,oe,xe,ye,Ke),Pe(W,ye,Ke,ke);var Fe=0;for(He=0;He<W.npart_l;He++){var We,at,Be,nt,it=W.s3ind[He][0],xt=W.s3ind[He][1],ot=0,tn=0;for(ot=ke[it],tn+=1,at=W.s3_ll[Fe]*xe[it]*k[ke[it]],++Fe,++it;it<=xt;)ot+=ke[it],tn+=1,We=W.s3_ll[Fe]*xe[it]*k[ke[it]],nt=z(at,We,it-He),at=nt,++Fe,++it;if(ot=(1+2*ot)/(2*tn),Be=k[ot]*.5,at*=Be,W.blocktype_old[Se&1]==Gt.SHORT_TYPE){var ln=r*W.nb_1[Se][He];ln>0?Ce[He]=Math.min(at,ln):Ce[He]=Math.min(at,xe[He]*f)}else{var Rt=i*W.nb_2[Se][He],Vt=r*W.nb_1[Se][He],ln;Rt<=0&&(Rt=at),Vt<=0&&(Vt=at),W.blocktype_old[Se&1]==Gt.NORM_TYPE?ln=Math.min(Vt,Rt):ln=Vt,Ce[He]=Math.min(at,ln)}W.nb_2[Se][He]=W.nb_1[Se][He],W.nb_1[Se][He]=at,We=ye[He],We*=W.minval_l[He],We*=Be,Ce[He]>We&&(Ce[He]=We),W.masking_lower>1&&(Ce[He]*=W.masking_lower),Ce[He]>xe[He]&&(Ce[He]=xe[He]),W.masking_lower<1&&(Ce[He]*=W.masking_lower),Jr(Ce[He]>=0)}for(;He<Gt.CBANDS;++He)xe[He]=0,Ce[He]=0}function we(W,oe){var xe=W.internal_flags;W.short_blocks==RS.short_block_coupled&&!(oe[0]!=0&&oe[1]!=0)&&(oe[0]=oe[1]=0);for(var Ce=0;Ce<xe.channels_out;Ce++)W.short_blocks==RS.short_block_dispensed&&(oe[Ce]=1),W.short_blocks==RS.short_block_forced&&(oe[Ce]=0)}function pe(W,oe,xe){for(var Ce=W.internal_flags,Se=0;Se<Ce.channels_out;Se++){var ye=Gt.NORM_TYPE;oe[Se]!=0?(Jr(Ce.blocktype_old[Se]!=Gt.START_TYPE),Ce.blocktype_old[Se]==Gt.SHORT_TYPE&&(ye=Gt.STOP_TYPE)):(ye=Gt.SHORT_TYPE,Ce.blocktype_old[Se]==Gt.NORM_TYPE&&(Ce.blocktype_old[Se]=Gt.START_TYPE),Ce.blocktype_old[Se]==Gt.STOP_TYPE&&(Ce.blocktype_old[Se]=Gt.SHORT_TYPE)),xe[Se]=Ce.blocktype_old[Se],Ce.blocktype_old[Se]=ye}}function ze(W,oe,xe,Ce,Se,ye,Ke){for(var ke=ye*2,He=ye>0?Math.pow(10,Se):1,Fe,We,at=0;at<Ke;++at){var Be=W[2][at],nt=W[3][at],it=oe[0][at],xt=oe[1][at],ot=oe[2][at],tn=oe[3][at];if(it<=1.58*xt&&xt<=1.58*it){var ln=xe[at]*nt,Rt=xe[at]*Be;We=Math.max(ot,Math.min(tn,ln)),Fe=Math.max(tn,Math.min(ot,Rt))}else We=ot,Fe=tn;if(ye>0){var Vt,_t,Jt=Ce[at]*He;if(Vt=Math.min(Math.max(it,Jt),Math.max(xt,Jt)),ot=Math.max(We,Jt),tn=Math.max(Fe,Jt),_t=ot+tn,_t>0&&Vt*ke<_t){var Tn=Vt*ke/_t;ot*=Tn,tn*=Tn}We=Math.min(ot,We),Fe=Math.min(tn,Fe)}We>Be&&(We=Be),Fe>nt&&(Fe=nt),oe[2][at]=We,oe[3][at]=Fe}}this.L3psycho_anal_vbr=function(W,oe,xe,Ce,Se,ye,Ke,ke,He,Fe){var We=W.internal_flags,at,Be,nt=za(Gt.HBLKSIZE),it=Bf([3,Gt.HBLKSIZE_s]),xt=Bf([2,Gt.BLKSIZE]),ot=Bf([2,3,Gt.BLKSIZE_s]),tn=Bf([4,Gt.CBANDS]),ln=Bf([4,Gt.CBANDS]),Rt=Bf([4,3]),Vt=.6,_t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Jt=By(2),Tn=W.mode==t.JOINT_STEREO?4:We.channels_out;Le(W,oe,xe,Ce,Se,ye,He,Rt,_t,Jt),we(W,Jt);{for(var qt=0;qt<Tn;qt++){var An=qt&1;at=xt,Ze(W,oe,xe,qt,Ce,nt,at,An),pt(W,Ce,qt,nt),Jt[An]!=0?ve(We,nt,tn[qt],ln[qt],qt):De(We,qt)}Jt[0]+Jt[1]==2&&W.mode==t.JOINT_STEREO&&ze(tn,ln,We.mld_cb_l,We.ATH.cb_l,W.ATHlower*We.ATH.adjust,W.msfix,We.npart_l);for(var qt=0;qt<Tn;qt++){var An=qt&1;Jt[An]!=0&&re(We,tn[qt],ln[qt],qt)}}{for(var Ln=0;Ln<3;Ln++){for(var qt=0;qt<Tn;++qt){var An=qt&1;Jt[An]!=0?Ve(We,qt,Ln):(Be=ot,lt(W,oe,xe,qt,Ln,it,Be,An),ae(W,it,tn[qt],ln[qt],qt,Ln))}Jt[0]+Jt[1]==0&&W.mode==t.JOINT_STEREO&&ze(tn,ln,We.mld_cb_s,We.ATH.cb_s,W.ATHlower*We.ATH.adjust,W.msfix,We.npart_s);for(var qt=0;qt<Tn;++qt){var An=qt&1;Jt[An]==0&&te(We,tn[qt],ln[qt],qt,Ln)}}for(var qt=0;qt<Tn;qt++){var An=qt&1;if(Jt[An]==0)for(var mr=0;mr<Gt.SBMAX_s;mr++){for(var ns=za(3),Ln=0;Ln<3;Ln++){var hi=We.thm[qt].s[mr][Ln];if(hi*=u,_t[qt][Ln]>=2||_t[qt][Ln+1]==1){var ti=Ln!=0?Ln-1:2,Fi=Z(We.thm[qt].s[mr][ti],hi,h*Vt);hi=Math.min(hi,Fi)}else if(_t[qt][Ln]==1){var ti=Ln!=0?Ln-1:2,Fi=Z(We.thm[qt].s[mr][ti],hi,f*Vt);hi=Math.min(hi,Fi)}else if(Ln!=0&&_t[qt][Ln-1]==3||Ln==0&&We.nsPsy.lastAttacks[qt]==3){var ti=Ln!=2?Ln+1:0,Fi=Z(We.thm[qt].s[mr][ti],hi,f*Vt);hi=Math.min(hi,Fi)}hi*=Rt[qt][Ln],ns[Ln]=hi}for(var Ln=0;Ln<3;Ln++)We.thm[qt].s[mr][Ln]=ns[Ln]}}}for(var qt=0;qt<Tn;qt++)We.nsPsy.lastAttacks[qt]=_t[qt][2];pe(W,Jt,Fe);for(var qt=0;qt<Tn;qt++){var rs,qi,is,ss;qt>1?(rs=ke,qi=-2,is=Gt.NORM_TYPE,(Fe[0]==Gt.SHORT_TYPE||Fe[1]==Gt.SHORT_TYPE)&&(is=Gt.SHORT_TYPE),ss=ye[Ce][qt-2]):(rs=Ke,qi=0,is=Fe[qt],ss=Se[Ce][qt]),is==Gt.SHORT_TYPE?rs[qi+qt]=ie(ss,We.masking_lower):rs[qi+qt]=Te(ss,We.masking_lower),W.analysis&&(We.pinfo.pe[Ce][qt]=rs[qi+qt])}return 0};function Je(W,oe){var xe=W,Ce;return xe>=0?Ce=-xe*27:Ce=xe*oe,Ce<=-72?0:Math.exp(Ce*m)}function Xe(W){var oe=0,xe=0;{var Ce=0,Se,ye;for(Ce=0;Je(Ce,W)>1e-20;Ce-=1);for(Se=Ce,ye=0;Math.abs(ye-Se)>1e-12;)Ce=(ye+Se)/2,Je(Ce,W)>0?ye=Ce:Se=Ce;oe=Se}{var Ce=0,Se,ye;for(Ce=0;Je(Ce,W)>1e-20;Ce+=1);for(Se=0,ye=Ce;Math.abs(ye-Se)>1e-12;)Ce=(ye+Se)/2,Je(Ce,W)>0?Se=Ce:ye=Ce;xe=ye}{var Ke=0,ke=1e3,He;for(He=0;He<=ke;++He){var Ce=oe+He*(xe-oe)/ke,Fe=Je(Ce,W);Ke+=Fe}{var We=(ke+1)/(Ke*(xe-oe));return We}}}function tt(W){var oe,xe,Ce,Se;return oe=W,oe>=0?oe*=3:oe*=1.5,oe>=.5&&oe<=2.5?(Se=oe-.5,xe=8*(Se*Se-2*Se)):xe=0,oe+=.474,Ce=15.811389+7.5*oe-17.5*Math.sqrt(1+oe*oe),Ce<=-60?0:(oe=Math.exp((xe+Ce)*m),oe/=.6609193,oe)}function Nt(W){return W<0&&(W=0),W=W*.001,13*Math.atan(.76*W)+3.5*Math.atan(W*W/(7.5*7.5))}function gt(W,oe,xe,Ce,Se,ye,Ke,ke,He,Fe,We,at){var Be=za(Gt.CBANDS+1),nt=ke/(at>15?2*576:384),it=By(Gt.HBLKSIZE),xt;ke/=He;var ot=0,tn=0;for(xt=0;xt<Gt.CBANDS;xt++){var ln,Rt;for(ln=Nt(ke*ot),Be[xt]=ke*ot,Rt=ot;Nt(ke*Rt)-ln<a&&Rt<=He/2;Rt++);for(W[xt]=Rt-ot,tn=xt+1;ot<Rt;)Jr(ot<Gt.HBLKSIZE),it[ot++]=xt;if(ot>He/2){ot=He/2,++xt;break}}Jr(xt<Gt.CBANDS),Be[xt]=ke*ot;for(var Vt=0;Vt<at;Vt++){var _t,Jt,Tn,qt,An;Tn=Fe[Vt],qt=Fe[Vt+1],_t=0|Math.floor(.5+We*(Tn-.5)),_t<0&&(_t=0),Jt=0|Math.floor(.5+We*(qt-.5)),Jt>He/2&&(Jt=He/2),xe[Vt]=(it[_t]+it[Jt])/2,oe[Vt]=it[Jt];var Ln=nt*qt;Ke[Vt]=(Ln-Be[oe[Vt]])/(Be[oe[Vt]+1]-Be[oe[Vt]]),Ke[Vt]<0?Ke[Vt]=0:Ke[Vt]>1&&(Ke[Vt]=1),An=Nt(ke*Fe[Vt]*We),An=Math.min(An,15.5)/15.5,ye[Vt]=Math.pow(10,1.25*(1-Math.cos(Math.PI*An))-2.5)}ot=0;for(var mr=0;mr<tn;mr++){var ns=W[mr],ln,hi;ln=Nt(ke*ot),hi=Nt(ke*(ot+ns-1)),Ce[mr]=.5*(ln+hi),ln=Nt(ke*(ot-.5)),hi=Nt(ke*(ot+ns-.5)),Se[mr]=hi-ln,ot+=ns}return tn}function wt(W,oe,xe,Ce,Se,ye){var Ke=Bf([Gt.CBANDS,Gt.CBANDS]),ke,He=0;if(ye)for(var Fe=0;Fe<oe;Fe++)for(ke=0;ke<oe;ke++){var We=tt(xe[Fe]-xe[ke])*Ce[ke];Ke[Fe][ke]=We*Se[Fe]}else for(ke=0;ke<oe;ke++)for(var at=15+Math.min(21/xe[ke],12),Be=Xe(at),Fe=0;Fe<oe;Fe++){var We=Be*Je(xe[Fe]-xe[ke],at)*Ce[ke];Ke[Fe][ke]=We*Se[Fe]}for(var Fe=0;Fe<oe;Fe++){for(ke=0;ke<oe&&!(Ke[Fe][ke]>0);ke++);for(W[Fe][0]=ke,ke=oe-1;ke>0&&!(Ke[Fe][ke]>0);ke--);W[Fe][1]=ke,He+=W[Fe][1]-W[Fe][0]+1}for(var nt=za(He),it=0,Fe=0;Fe<oe;Fe++)for(ke=W[Fe][0];ke<=W[Fe][1];ke++)nt[it++]=Ke[Fe][ke];return nt}function Re(W){var oe=Nt(W);return oe=Math.min(oe,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*oe))-2.5)}this.psymodel_init=function(W){var oe=W.internal_flags,xe,Ce=!0,Se=13,ye=24,Ke=0,ke=0,He=-8.25,Fe=-4.5,We=za(Gt.CBANDS),at=za(Gt.CBANDS),Be=za(Gt.CBANDS),nt=W.out_samplerate;switch(W.experimentalZ){default:case 0:Ce=!0;break;case 1:Ce=!(W.VBR==CS.vbr_mtrh||W.VBR==CS.vbr_mt);break;case 2:Ce=!1;break;case 3:Se=8,Ke=-1.75,ke=-.0125,He=-8.25,Fe=-2.25;break}for(oe.ms_ener_ratio_old=.25,oe.blocktype_old[0]=oe.blocktype_old[1]=Gt.NORM_TYPE,xe=0;xe<4;++xe){for(var ot=0;ot<Gt.CBANDS;++ot)oe.nb_1[xe][ot]=1e20,oe.nb_2[xe][ot]=1e20,oe.nb_s1[xe][ot]=oe.nb_s2[xe][ot]=1;for(var it=0;it<Gt.SBMAX_l;it++)oe.en[xe].l[it]=1e20,oe.thm[xe].l[it]=1e20;for(var ot=0;ot<3;++ot){for(var it=0;it<Gt.SBMAX_s;it++)oe.en[xe].s[it][ot]=1e20,oe.thm[xe].s[it][ot]=1e20;oe.nsPsy.lastAttacks[xe]=0}for(var ot=0;ot<9;ot++)oe.nsPsy.last_en_subshort[xe][ot]=10}for(oe.loudness_sq_save[0]=oe.loudness_sq_save[1]=0,oe.npart_l=gt(oe.numlines_l,oe.bo_l,oe.bm_l,We,at,oe.mld_l,oe.PSY.bo_l_weight,nt,Gt.BLKSIZE,oe.scalefac_band.l,Gt.BLKSIZE/(2*576),Gt.SBMAX_l),Jr(oe.npart_l<Gt.CBANDS),xe=0;xe<oe.npart_l;xe++){var xt=Ke;We[xe]>=Se&&(xt=ke*(We[xe]-Se)/(ye-Se)+Ke*(ye-We[xe])/(ye-Se)),Be[xe]=Math.pow(10,xt/10),oe.numlines_l[xe]>0?oe.rnumlines_l[xe]=1/oe.numlines_l[xe]:oe.rnumlines_l[xe]=0}oe.s3_ll=wt(oe.s3ind,oe.npart_l,We,at,Be,Ce);var ot=0;for(xe=0;xe<oe.npart_l;xe++){var tn;tn=z$.MAX_VALUE;for(var ln=0;ln<oe.numlines_l[xe];ln++,ot++){var Rt=nt*ot/(1e3*Gt.BLKSIZE),Vt;Vt=this.ATHformula(Rt*1e3,W)-20,Vt=Math.pow(10,.1*Vt),Vt*=oe.numlines_l[xe],tn>Vt&&(tn=Vt)}oe.ATH.cb_l[xe]=tn,tn=-20+We[xe]*20/10,tn>6&&(tn=100),tn<-15&&(tn=-15),tn-=8,oe.minval_l[xe]=Math.pow(10,tn/10)*oe.numlines_l[xe]}for(oe.npart_s=gt(oe.numlines_s,oe.bo_s,oe.bm_s,We,at,oe.mld_s,oe.PSY.bo_s_weight,nt,Gt.BLKSIZE_s,oe.scalefac_band.s,Gt.BLKSIZE_s/384,Gt.SBMAX_s),Jr(oe.npart_s<Gt.CBANDS),ot=0,xe=0;xe<oe.npart_s;xe++){var tn,xt=He;We[xe]>=Se&&(xt=Fe*(We[xe]-Se)/(ye-Se)+He*(ye-We[xe])/(ye-Se)),Be[xe]=Math.pow(10,xt/10),tn=z$.MAX_VALUE;for(var ln=0;ln<oe.numlines_s[xe];ln++,ot++){var Rt=nt*ot/(1e3*Gt.BLKSIZE_s),Vt;Vt=this.ATHformula(Rt*1e3,W)-20,Vt=Math.pow(10,.1*Vt),Vt*=oe.numlines_s[xe],tn>Vt&&(tn=Vt)}oe.ATH.cb_s[xe]=tn,tn=-7+We[xe]*7/12,We[xe]>12&&(tn*=1+Math.log(1+tn)*3.1),We[xe]<12&&(tn*=1+Math.log(1-tn)*2.3),tn<-15&&(tn=-15),tn-=8,oe.minval_s[xe]=Math.pow(10,tn/10)*oe.numlines_s[xe]}oe.s3_ss=wt(oe.s3ind_s,oe.npart_s,We,at,Be,Ce),L(),e.init_fft(oe),oe.decay=Math.exp(-1*n/(l*nt/192));{var _t;_t=d,W.exp_nspsytune&2&&(_t=1),Math.abs(W.msfix)>0&&(_t=W.msfix),W.msfix=_t;for(var Jt=0;Jt<oe.npart_l;Jt++)oe.s3ind[Jt][1]>oe.npart_l-1&&(oe.s3ind[Jt][1]=oe.npart_l-1)}var Tn=576*oe.mode_gr/nt;if(oe.ATH.decay=Math.pow(10,-12/10*Tn),oe.ATH.adjust=.01,oe.ATH.adjustLimit=1,Jr(oe.bo_l[Gt.SBMAX_l-1]<=oe.npart_l),Jr(oe.bo_s[Gt.SBMAX_s-1]<=oe.npart_s),W.ATHtype!=-1){var Rt,qt=W.out_samplerate/Gt.BLKSIZE,An=0;for(Rt=0,xe=0;xe<Gt.BLKSIZE/2;++xe)Rt+=qt,oe.ATH.eql_w[xe]=1/Math.pow(10,this.ATHformula(Rt,W)/10),An+=oe.ATH.eql_w[xe];for(An=1/An,xe=Gt.BLKSIZE/2;--xe>=0;)oe.ATH.eql_w[xe]*=An}{for(var Jt=ot=0;Jt<oe.npart_s;++Jt)for(xe=0;xe<oe.numlines_s[Jt];++xe)++ot;for(var Jt=ot=0;Jt<oe.npart_l;++Jt)for(xe=0;xe<oe.numlines_l[Jt];++xe)++ot}for(ot=0,xe=0;xe<oe.npart_l;xe++){var Rt=nt*(ot+oe.numlines_l[xe]/2)/(1*Gt.BLKSIZE);oe.mld_cb_l[xe]=Re(Rt),ot+=oe.numlines_l[xe]}for(;xe<Gt.CBANDS;++xe)oe.mld_cb_l[xe]=1;for(ot=0,xe=0;xe<oe.npart_s;xe++){var Rt=nt*(ot+oe.numlines_s[xe]/2)/(1*Gt.BLKSIZE_s);oe.mld_cb_s[xe]=Re(Rt),ot+=oe.numlines_s[xe]}for(;xe<Gt.CBANDS;++xe)oe.mld_cb_s[xe]=1;return 0};function se(W,oe){W<-.3&&(W=3410),W/=1e3,W=Math.max(.1,W);var xe=3.64*Math.pow(W,-.8)-6.8*Math.exp(-.6*Math.pow(W-3.4,2))+6*Math.exp(-.15*Math.pow(W-8.7,2))+(.6+.04*oe)*.001*Math.pow(W,4);return xe}this.ATHformula=function(W,oe){var xe;switch(oe.ATHtype){case 0:xe=se(W,9);break;case 1:xe=se(W,-1);break;case 2:xe=se(W,0);break;case 3:xe=se(W,1)+6;break;case 4:xe=se(W,oe.ATHcurve);break;default:xe=se(W,0);break}return xe}}var AFe=TFe,CFe=RC;function RFe(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=CFe.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var kFe=RFe,MFe=Fl(),Gne={};Gne.SFBMAX=MFe.SBMAX_s*3;var zI=Gne,Wne=Mo,OFe=Wne.new_float,Fy=Wne.new_int,O2=zI;function IFe(){this.xr=OFe(576),this.l3_enc=Fy(576),this.scalefac=Fy(O2.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Fy(3),this.subblock_gain=Fy(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Fy(O2.SFBMAX),this.window=Fy(O2.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Fy(4),this.max_nonzero_coeff=0;var t=this;function e(r){return new Int32Array(r)}function n(r){return new Float32Array(r)}this.assign=function(r){t.xr=n(r.xr),t.l3_enc=e(r.l3_enc),t.scalefac=e(r.scalefac),t.xrpow_max=r.xrpow_max,t.part2_3_length=r.part2_3_length,t.big_values=r.big_values,t.count1=r.count1,t.global_gain=r.global_gain,t.scalefac_compress=r.scalefac_compress,t.block_type=r.block_type,t.mixed_block_flag=r.mixed_block_flag,t.table_select=e(r.table_select),t.subblock_gain=e(r.subblock_gain),t.region0_count=r.region0_count,t.region1_count=r.region1_count,t.preflag=r.preflag,t.scalefac_scale=r.scalefac_scale,t.count1table_select=r.count1table_select,t.part2_length=r.part2_length,t.sfb_lmax=r.sfb_lmax,t.sfb_smin=r.sfb_smin,t.psy_lmax=r.psy_lmax,t.sfbmax=r.sfbmax,t.psymax=r.psymax,t.sfbdivide=r.sfbdivide,t.width=e(r.width),t.window=e(r.window),t.count1bits=r.count1bits,t.sfb_partition_table=r.sfb_partition_table.slice(0),t.slen=e(r.slen),t.max_nonzero_coeff=r.max_nonzero_coeff}}var dU=IFe,NFe=Mo,V$=NFe.new_int,PFe=dU;function DFe(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[V$(4),V$(4)];for(var t=0;t<2;t++)for(var e=0;e<2;e++)this.tt[t][e]=new PFe}var LFe=DFe,qne=Mo,VR=qne.System,HR=qne.new_int,$R=Fl();function UFe(t,e,n,r){this.l=HR(1+$R.SBMAX_l),this.s=HR(1+$R.SBMAX_s),this.psfb21=HR(1+$R.PSFB21),this.psfb12=HR(1+$R.PSFB12);var i=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],VR.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),VR.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),VR.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),VR.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Yne=UFe,pU=Mo,I2=pU.new_float,BFe=pU.new_float_n,FFe=pU.new_int,H$=Fl();function jFe(){this.last_en_subshort=BFe([4,9]),this.lastAttacks=FFe(4),this.pefirbuf=I2(19),this.longfact=I2(H$.SBMAX_l),this.shortfact=I2(H$.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var zFe=jFe;function VFe(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var HFe=VFe,mx=Mo,$Fe=mx.new_byte,GFe=mx.new_double,Ff=mx.new_float,jy=mx.new_float_n,Gd=mx.new_int,GR=mx.new_int_n,WFe=LFe,qFe=Yne,YFe=zFe,KFe=HFe,$$=Hne(),aa=Fl(),XFe=zI;wg.MFSIZE=3*1152+aa.ENCDELAY-aa.MDCTDELAY;wg.MAX_HEADER_BUF=256;wg.MAX_BITS_PER_CHANNEL=4095;wg.MAX_BITS_PER_GRANULE=7680;wg.BPC=320;function wg(){var t=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=jy([2,wg.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new WFe,this.ms_ratio=Ff(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Gd(2),this.CurrentStep=Gd(2),this.masking_lower=0,this.bv_scf=Gd(576),this.pseudohalf=Gd(XFe.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*wg.BPC+1),this.itime=GFe(2),this.sideinfo_len=0,this.sb_sample=jy([2,2,18,aa.SBLIMIT]),this.amp_filter=Ff(32);function e(){this.write_timing=0,this.ptr=0,this.buf=$Fe(t)}this.header=new Array(wg.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new qFe,this.minval_l=Ff(aa.CBANDS),this.minval_s=Ff(aa.CBANDS),this.nb_1=jy([4,aa.CBANDS]),this.nb_2=jy([4,aa.CBANDS]),this.nb_s1=jy([4,aa.CBANDS]),this.nb_s2=jy([4,aa.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ff(4),this.loudness_sq=jy([2,2]),this.loudness_sq_save=Ff(2),this.mld_l=Ff(aa.SBMAX_l),this.mld_s=Ff(aa.SBMAX_s),this.bm_l=Gd(aa.SBMAX_l),this.bo_l=Gd(aa.SBMAX_l),this.bm_s=Gd(aa.SBMAX_s),this.bo_s=Gd(aa.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=GR([aa.CBANDS,2]),this.s3ind_s=GR([aa.CBANDS,2]),this.numlines_s=Gd(aa.CBANDS),this.numlines_l=Gd(aa.CBANDS),this.rnumlines_l=Ff(aa.CBANDS),this.mld_cb_l=Ff(aa.CBANDS),this.mld_cb_s=Ff(aa.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ff(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Gd(2),this.nsPsy=new YFe,this.VBR_seek_table=new KFe,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=GR([16,5]),this.bitrate_blockType_Hist=GR([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var n=0;n<this.en.length;n++)this.en[n]=new $$;for(var n=0;n<this.thm.length;n++)this.thm[n]=new $$;for(var n=0;n<this.header.length;n++)this.header[n]=new e}var VI=wg,JFe=Mo,zy=JFe.new_float,Vy=Fl();function ZFe(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=zy(Vy.SBMAX_l),this.s=zy(Vy.SBMAX_s),this.psfb21=zy(Vy.PSFB21),this.psfb12=zy(Vy.PSFB12),this.cb_l=zy(Vy.CBANDS),this.cb_s=zy(Vy.CBANDS),this.eql_w=zy(Vy.BLKSIZE/2)}var QFe=ZFe,Kne=Mo,Xu=Kne.System,G$=Kne.Arrays;ga.STEPS_per_dB=100;ga.MAX_dB=120;ga.GAIN_NOT_ENOUGH_SAMPLES=-24601;ga.GAIN_ANALYSIS_ERROR=0;ga.GAIN_ANALYSIS_OK=1;ga.INIT_GAIN_ANALYSIS_ERROR=0;ga.INIT_GAIN_ANALYSIS_OK=1;ga.YULE_ORDER=10;ga.MAX_ORDER=ga.YULE_ORDER;ga.MAX_SAMP_FREQ=48e3;ga.RMS_WINDOW_TIME_NUMERATOR=1;ga.RMS_WINDOW_TIME_DENOMINATOR=20;ga.MAX_SAMPLES_PER_WINDOW=ga.MAX_SAMP_FREQ*ga.RMS_WINDOW_TIME_NUMERATOR/ga.RMS_WINDOW_TIME_DENOMINATOR+1;function ga(){var t=64.82,e=.95,n=ga.RMS_WINDOW_TIME_NUMERATOR,r=ga.RMS_WINDOW_TIME_DENOMINATOR,i=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(h,f,d,p,m,g){for(;m--!=0;)d[p]=1e-10+h[f+0]*g[0]-d[p-1]*g[1]+h[f-1]*g[2]-d[p-2]*g[3]+h[f-2]*g[4]-d[p-3]*g[5]+h[f-3]*g[6]-d[p-4]*g[7]+h[f-4]*g[8]-d[p-5]*g[9]+h[f-5]*g[10]-d[p-6]*g[11]+h[f-6]*g[12]-d[p-7]*g[13]+h[f-7]*g[14]-d[p-8]*g[15]+h[f-8]*g[16]-d[p-9]*g[17]+h[f-9]*g[18]-d[p-10]*g[19]+h[f-10]*g[20],++p,++f}function a(h,f,d,p,m,g){for(;m--!=0;)d[p]=h[f+0]*g[0]-d[p-1]*g[1]+h[f-1]*g[2]-d[p-2]*g[3]+h[f-2]*g[4],++p,++f}function c(h,f){for(var d=0;d<MAX_ORDER;d++)h.linprebuf[d]=h.lstepbuf[d]=h.loutbuf[d]=h.rinprebuf[d]=h.rstepbuf[d]=h.routbuf[d]=0;switch(0|f){case 48e3:h.reqindex=0;break;case 44100:h.reqindex=1;break;case 32e3:h.reqindex=2;break;case 24e3:h.reqindex=3;break;case 22050:h.reqindex=4;break;case 16e3:h.reqindex=5;break;case 12e3:h.reqindex=6;break;case 11025:h.reqindex=7;break;case 8e3:h.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return h.sampleWindow=0|(f*n+r-1)/r,h.lsum=0,h.rsum=0,h.totsamp=0,G$.ill(h.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(h,f){return c(h,f)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(h.linpre=MAX_ORDER,h.rinpre=MAX_ORDER,h.lstep=MAX_ORDER,h.rstep=MAX_ORDER,h.lout=MAX_ORDER,h.rout=MAX_ORDER,G$.fill(h.B,0),INIT_GAIN_ANALYSIS_OK)};function l(h){return h*h}this.AnalyzeSamples=function(h,f,d,p,m,g,_){var y,v,E,x,A,T,k;if(g==0)return GAIN_ANALYSIS_OK;switch(k=0,A=g,_){case 1:p=f,m=d;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(g<MAX_ORDER?(Xu.arraycopy(f,d,h.linprebuf,MAX_ORDER,g),Xu.arraycopy(p,m,h.rinprebuf,MAX_ORDER,g)):(Xu.arraycopy(f,d,h.linprebuf,MAX_ORDER,MAX_ORDER),Xu.arraycopy(p,m,h.rinprebuf,MAX_ORDER,MAX_ORDER));A>0;){T=A>h.sampleWindow-h.totsamp?h.sampleWindow-h.totsamp:A,k<MAX_ORDER?(y=h.linpre+k,v=h.linprebuf,E=h.rinpre+k,x=h.rinprebuf,T>MAX_ORDER-k&&(T=MAX_ORDER-k)):(y=d+k,v=f,E=m+k,x=p),o(v,y,h.lstepbuf,h.lstep+h.totsamp,T,i[h.reqindex]),o(x,E,h.rstepbuf,h.rstep+h.totsamp,T,i[h.reqindex]),a(h.lstepbuf,h.lstep+h.totsamp,h.loutbuf,h.lout+h.totsamp,T,s[h.reqindex]),a(h.rstepbuf,h.rstep+h.totsamp,h.routbuf,h.rout+h.totsamp,T,s[h.reqindex]),y=h.lout+h.totsamp,v=h.loutbuf,E=h.rout+h.totsamp,x=h.routbuf;for(var L=T%8;L--!=0;)h.lsum+=l(v[y++]),h.rsum+=l(x[E++]);for(L=T/8;L--!=0;)h.lsum+=l(v[y+0])+l(v[y+1])+l(v[y+2])+l(v[y+3])+l(v[y+4])+l(v[y+5])+l(v[y+6])+l(v[y+7]),y+=8,h.rsum+=l(x[E+0])+l(x[E+1])+l(x[E+2])+l(x[E+3])+l(x[E+4])+l(x[E+5])+l(x[E+6])+l(x[E+7]),E+=8;if(A-=T,k+=T,h.totsamp+=T,h.totsamp==h.sampleWindow){var I=ga.STEPS_per_dB*10*Math.log10((h.lsum+h.rsum)/h.totsamp*.5+1e-37),F=I<=0?0:0|I;F>=h.A.length&&(F=h.A.length-1),h.A[F]++,h.lsum=h.rsum=0,Xu.arraycopy(h.loutbuf,h.totsamp,h.loutbuf,0,MAX_ORDER),Xu.arraycopy(h.routbuf,h.totsamp,h.routbuf,0,MAX_ORDER),Xu.arraycopy(h.lstepbuf,h.totsamp,h.lstepbuf,0,MAX_ORDER),Xu.arraycopy(h.rstepbuf,h.totsamp,h.rstepbuf,0,MAX_ORDER),h.totsamp=0}if(h.totsamp>h.sampleWindow)return GAIN_ANALYSIS_ERROR}return g<MAX_ORDER?(Xu.arraycopy(h.linprebuf,g,h.linprebuf,0,MAX_ORDER-g),Xu.arraycopy(h.rinprebuf,g,h.rinprebuf,0,MAX_ORDER-g),Xu.arraycopy(f,d,h.linprebuf,MAX_ORDER-g,g),Xu.arraycopy(p,m,h.rinprebuf,MAX_ORDER-g,g)):(Xu.arraycopy(f,d+g-MAX_ORDER,h.linprebuf,0,MAX_ORDER),Xu.arraycopy(p,m+g-MAX_ORDER,h.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function u(h,f){var d,p=0;for(d=0;d<f;d++)p+=h[d];if(p==0)return GAIN_NOT_ENOUGH_SAMPLES;var m=0|Math.ceil(p*(1-e));for(d=f;d-- >0&&!((m-=h[d])<=0););return t-d/ga.STEPS_per_dB}this.GetTitleGain=function(h){for(var f=u(h.A,h.A.length),d=0;d<h.A.length;d++)h.B[d]+=h.A[d],h.A[d]=0;for(var d=0;d<MAX_ORDER;d++)h.linprebuf[d]=h.lstepbuf[d]=h.loutbuf[d]=h.rinprebuf[d]=h.rstepbuf[d]=h.routbuf[d]=0;return h.totsamp=0,h.lsum=h.rsum=0,f}}var Xne=ga,Jne=Mo,kS=Jne.new_float,W$=Jne.new_int,Ju=Xne;function e7e(){this.linprebuf=kS(Ju.MAX_ORDER*2),this.linpre=0,this.lstepbuf=kS(Ju.MAX_SAMPLES_PER_WINDOW+Ju.MAX_ORDER),this.lstep=0,this.loutbuf=kS(Ju.MAX_SAMPLES_PER_WINDOW+Ju.MAX_ORDER),this.lout=0,this.rinprebuf=kS(Ju.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=kS(Ju.MAX_SAMPLES_PER_WINDOW+Ju.MAX_ORDER),this.rstep=0,this.routbuf=kS(Ju.MAX_SAMPLES_PER_WINDOW+Ju.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=W$(0|Ju.STEPS_per_dB*Ju.MAX_dB),this.B=W$(0|Ju.STEPS_per_dB*Ju.MAX_dB)}var t7e=e7e;function n7e(t){this.bits=t}var Zne=n7e,mU=Mo,q$=mU.new_float,r7e=mU.new_int,Y$=mU.assert,i7e=Zne,K$=Fl(),s7e=zI,o7e=VI;function a7e(t){var e=t;this.quantize=e,this.iteration_loop=function(n,r,i,s){var o=n.internal_flags,a=q$(s7e.SFBMAX),c=q$(576),l=r7e(2),u=0,h,f=o.l3_side,d=new i7e(u);this.quantize.rv.ResvFrameBegin(n,d),u=d.bits;for(var p=0;p<o.mode_gr;p++){h=this.quantize.qupvt.on_pe(n,r,l,u,p,p),o.mode_ext==K$.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,p),this.quantize.qupvt.reduce_side(l,i[p],u,h));for(var m=0;m<o.channels_out;m++){var g,_,y=f.tt[p][m];y.block_type!=K$.SHORT_TYPE?(g=0,_=o.PSY.mask_adjust-g):(g=0,_=o.PSY.mask_adjust_short-g),o.masking_lower=Math.pow(10,_*.1),this.quantize.init_outer_loop(o,y),this.quantize.init_xrpow(o,y,c)&&(this.quantize.qupvt.calc_xmin(n,s[p][m],y,a),this.quantize.outer_loop(n,y,a,c,m,l[m])),this.quantize.iteration_finish_one(o,p,m),Y$(y.part2_3_length<=o7e.MAX_BITS_PER_CHANNEL),Y$(y.part2_3_length<=l[m])}}this.quantize.rv.ResvFrameEnd(o,u)}}var c7e=a7e;function $i(t,e,n,r){this.xlen=t,this.linmax=e,this.table=n,this.hlen=r}var fn={};fn.t1HB=[1,1,1,0];fn.t2HB=[1,2,1,3,1,1,3,2,0];fn.t3HB=[3,2,1,1,1,1,3,2,0];fn.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];fn.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];fn.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];fn.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];fn.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];fn.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];fn.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];fn.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];fn.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];fn.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];fn.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];fn.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];fn.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];fn.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];fn.t1l=[1,4,3,5];fn.t2l=[1,4,7,4,5,7,6,7,8];fn.t3l=[2,3,7,4,4,7,6,7,8];fn.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];fn.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];fn.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];fn.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];fn.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];fn.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];fn.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];fn.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];fn.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];fn.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];fn.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];fn.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];fn.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];fn.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];fn.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];fn.ht=[new $i(0,0,null,null),new $i(2,0,fn.t1HB,fn.t1l),new $i(3,0,fn.t2HB,fn.t2l),new $i(3,0,fn.t3HB,fn.t3l),new $i(0,0,null,null),new $i(4,0,fn.t5HB,fn.t5l),new $i(4,0,fn.t6HB,fn.t6l),new $i(6,0,fn.t7HB,fn.t7l),new $i(6,0,fn.t8HB,fn.t8l),new $i(6,0,fn.t9HB,fn.t9l),new $i(8,0,fn.t10HB,fn.t10l),new $i(8,0,fn.t11HB,fn.t11l),new $i(8,0,fn.t12HB,fn.t12l),new $i(16,0,fn.t13HB,fn.t13l),new $i(0,0,null,fn.t16_5l),new $i(16,0,fn.t15HB,fn.t15l),new $i(1,1,fn.t16HB,fn.t16l),new $i(2,3,fn.t16HB,fn.t16l),new $i(3,7,fn.t16HB,fn.t16l),new $i(4,15,fn.t16HB,fn.t16l),new $i(6,63,fn.t16HB,fn.t16l),new $i(8,255,fn.t16HB,fn.t16l),new $i(10,1023,fn.t16HB,fn.t16l),new $i(13,8191,fn.t16HB,fn.t16l),new $i(4,15,fn.t24HB,fn.t24l),new $i(5,31,fn.t24HB,fn.t24l),new $i(6,63,fn.t24HB,fn.t24l),new $i(7,127,fn.t24HB,fn.t24l),new $i(8,255,fn.t24HB,fn.t24l),new $i(9,511,fn.t24HB,fn.t24l),new $i(11,2047,fn.t24HB,fn.t24l),new $i(13,8191,fn.t24HB,fn.t24l),new $i(0,0,fn.t32HB,fn.t32l),new $i(0,0,fn.t33HB,fn.t33l)];fn.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];fn.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];fn.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];fn.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];fn.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];fn.scfsi_band=[0,6,11,16,21];var gU=fn,N2,X$;function Qne(){if(X$)return N2;X$=1;var t=Yne,e=Mo,n=e.VbrMode,r=e.Float,i=e.Util,s=e.new_float,o=e.new_int,a=e.assert,c=Fl(),l=Zne,u=VI;h.Q_MAX=257,h.Q_MAX2=116,h.LARGE_BITS=1e5,h.IXMAX_VAL=8206;function h(){var f=_U(),d=null,p=null,m=null;this.setModules=function(z,q,G){d=z,p=q,m=G};function g(z){return a(0<=z+h.Q_MAX2&&z<h.Q_MAX),k[z+h.Q_MAX2]}this.IPOW20=function(z){return a(0<=z&&z<h.Q_MAX),L[z]};var _=2220446049250313e-31,y=h.IXMAX_VAL,v=y+2,E=h.Q_MAX,x=h.Q_MAX2;h.LARGE_BITS;var A=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var T=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=T,this.sfBandIndex=[new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var k=s(E+x+1),L=s(E),I=s(v),F=s(v);this.adj43=F;function M(z,q){var G=m.ATHformula(q,z);return G-=A,G=Math.pow(10,G/10+z.ATHlower),G}function D(z){for(var q=z.internal_flags.ATH.l,G=z.internal_flags.ATH.psfb21,K=z.internal_flags.ATH.s,te=z.internal_flags.ATH.psfb12,re=z.internal_flags,H=z.out_samplerate,Y=0;Y<c.SBMAX_l;Y++){var Z=re.scalefac_band.l[Y],Q=re.scalefac_band.l[Y+1];q[Y]=r.MAX_VALUE;for(var ie=Z;ie<Q;ie++){var ge=ie*H/1152,Te=M(z,ge);q[Y]=Math.min(q[Y],Te)}}for(var Y=0;Y<c.PSFB21;Y++){var Z=re.scalefac_band.psfb21[Y],Q=re.scalefac_band.psfb21[Y+1];G[Y]=r.MAX_VALUE;for(var ie=Z;ie<Q;ie++){var ge=ie*H/1152,Te=M(z,ge);G[Y]=Math.min(G[Y],Te)}}for(var Y=0;Y<c.SBMAX_s;Y++){var Z=re.scalefac_band.s[Y],Q=re.scalefac_band.s[Y+1];K[Y]=r.MAX_VALUE;for(var ie=Z;ie<Q;ie++){var ge=ie*H/384,Te=M(z,ge);K[Y]=Math.min(K[Y],Te)}K[Y]*=re.scalefac_band.s[Y+1]-re.scalefac_band.s[Y]}for(var Y=0;Y<c.PSFB12;Y++){var Z=re.scalefac_band.psfb12[Y],Q=re.scalefac_band.psfb12[Y+1];te[Y]=r.MAX_VALUE;for(var ie=Z;ie<Q;ie++){var ge=ie*H/384,Te=M(z,ge);te[Y]=Math.min(te[Y],Te)}te[Y]*=re.scalefac_band.s[13]-re.scalefac_band.s[12]}if(z.noATH){for(var Y=0;Y<c.SBMAX_l;Y++)q[Y]=1e-20;for(var Y=0;Y<c.PSFB21;Y++)G[Y]=1e-20;for(var Y=0;Y<c.SBMAX_s;Y++)K[Y]=1e-20;for(var Y=0;Y<c.PSFB12;Y++)te[Y]=1e-20}re.ATH.floor=10*Math.log10(M(z,-1))}this.iteration_init=function(z){var q=z.internal_flags,G=q.l3_side,K;if(q.iteration_init_init==0){for(q.iteration_init_init=1,G.main_data_begin=0,D(z),I[0]=0,K=1;K<v;K++)I[K]=Math.pow(K,4/3);for(K=0;K<v-1;K++)F[K]=K+1-Math.pow(.5*(I[K]+I[K+1]),.75);for(F[K]=.5,K=0;K<E;K++)L[K]=Math.pow(2,(K-210)*-.1875);for(K=0;K<=E+x;K++)k[K]=Math.pow(2,(K-210-x)*.25);d.huffman_init(q);{var te,re,H,Y;for(K=z.exp_nspsytune>>2&63,K>=32&&(K-=64),te=Math.pow(10,K/4/10),K=z.exp_nspsytune>>8&63,K>=32&&(K-=64),re=Math.pow(10,K/4/10),K=z.exp_nspsytune>>14&63,K>=32&&(K-=64),H=Math.pow(10,K/4/10),K=z.exp_nspsytune>>20&63,K>=32&&(K-=64),Y=H*Math.pow(10,K/4/10),K=0;K<c.SBMAX_l;K++){var Z;K<=6?Z=te:K<=13?Z=re:K<=20?Z=H:Z=Y,q.nsPsy.longfact[K]=Z}for(K=0;K<c.SBMAX_s;K++){var Z;K<=5?Z=te:K<=10?Z=re:K<=11?Z=H:Z=Y,q.nsPsy.shortfact[K]=Z}}}},this.on_pe=function(z,q,G,K,te,re){var H=z.internal_flags,Y=0,Z,Q=o(2),ie,ge=new l(Y),Te=p.ResvMaxBits(z,K,ge,re);Y=ge.bits;var be=Y+Te;for(be>u.MAX_BITS_PER_GRANULE&&(be=u.MAX_BITS_PER_GRANULE),Z=0,ie=0;ie<H.channels_out;++ie)G[ie]=Math.min(u.MAX_BITS_PER_CHANNEL,Y/H.channels_out),Q[ie]=0|G[ie]*q[te][ie]/700-G[ie],Q[ie]>K*3/4&&(Q[ie]=K*3/4),Q[ie]<0&&(Q[ie]=0),Q[ie]+G[ie]>u.MAX_BITS_PER_CHANNEL&&(Q[ie]=Math.max(0,u.MAX_BITS_PER_CHANNEL-G[ie])),Z+=Q[ie];if(Z>Te)for(ie=0;ie<H.channels_out;++ie)Q[ie]=Te*Q[ie]/Z;for(ie=0;ie<H.channels_out;++ie)G[ie]+=Q[ie],Te-=Q[ie];for(Z=0,ie=0;ie<H.channels_out;++ie)Z+=G[ie];if(Z>u.MAX_BITS_PER_GRANULE){var Pe=0;for(ie=0;ie<H.channels_out;++ie)G[ie]*=u.MAX_BITS_PER_GRANULE,G[ie]/=Z,Pe+=G[ie]}return be},this.reduce_side=function(z,q,G,K){a(z[0]+z[1]<=u.MAX_BITS_PER_GRANULE);var te=.33*(.5-q)/.5;te<0&&(te=0),te>.5&&(te=.5);var re=0|te*.5*(z[0]+z[1]);re>u.MAX_BITS_PER_CHANNEL-z[0]&&(re=u.MAX_BITS_PER_CHANNEL-z[0]),re<0&&(re=0),z[1]>=125&&(z[1]-re>125?(z[0]<G&&(z[0]+=re),z[1]-=re):(z[0]+=z[1]-125,z[1]=125)),re=z[0]+z[1],re>K&&(z[0]=K*z[0]/re,z[1]=K*z[1]/re),a(z[0]<=u.MAX_BITS_PER_CHANNEL),a(z[1]<=u.MAX_BITS_PER_CHANNEL),a(z[0]+z[1]<=u.MAX_BITS_PER_GRANULE)},this.athAdjust=function(z,q,G){var K=90.30873362,te=94.82444863,re=i.FAST_LOG10_X(q,10),H=z*z,Y=0;return re-=G,H>1e-20&&(Y=1+i.FAST_LOG10_X(H,10/K)),Y<0&&(Y=0),re*=Y,re+=G+K-te,Math.pow(10,.1*re)},this.calc_xmin=function(z,q,G,K){var te=0,re=z.internal_flags,H,Y=0,Z=0,Q=re.ATH,ie=G.xr,ge=z.VBR==n.vbr_mtrh?1:0,Te=re.masking_lower;for((z.VBR==n.vbr_mtrh||z.VBR==n.vbr_mt)&&(Te=1),H=0;H<G.psy_lmax;H++){var be,Pe,Ge,Ze,lt,pt;z.VBR==n.vbr_rh||z.VBR==n.vbr_mtrh?Pe=athAdjust(Q.adjust,Q.l[H],Q.floor):Pe=Q.adjust*Q.l[H],lt=G.width[H],Ge=Pe/lt,Ze=_,pt=lt>>1,be=0;do{var ne,Le;ne=ie[Y]*ie[Y],be+=ne,Ze+=ne<Ge?ne:Ge,Y++,Le=ie[Y]*ie[Y],be+=Le,Ze+=Le<Ge?Le:Ge,Y++}while(--pt>0);if(be>Pe&&Z++,H==c.SBPSY_l){var Ve=Pe*re.nsPsy.longfact[H];Ze<Ve&&(Ze=Ve)}if(ge!=0&&(Pe=Ze),!z.ATHonly){var De=q.en.l[H];if(De>0){var Ve;Ve=be*q.thm.l[H]*Te/De,ge!=0&&(Ve*=re.nsPsy.longfact[H]),Pe<Ve&&(Pe=Ve)}}ge!=0?K[te++]=Pe:K[te++]=Pe*re.nsPsy.longfact[H]}var Ie=575;if(G.block_type!=c.SHORT_TYPE)for(var ae=576;ae--!=0&&f.EQ(ie[ae],0);)Ie=ae;G.max_nonzero_coeff=Ie;for(var ve=G.sfb_smin;H<G.psymax;ve++,H+=3){var lt,we,pe;for(z.VBR==n.vbr_rh||z.VBR==n.vbr_mtrh?pe=athAdjust(Q.adjust,Q.s[ve],Q.floor):pe=Q.adjust*Q.s[ve],lt=G.width[H],we=0;we<3;we++){var be=0,Pe,Ge,Ze,pt=lt>>1;Ge=pe/lt,Ze=_;do{var ne,Le;ne=ie[Y]*ie[Y],be+=ne,Ze+=ne<Ge?ne:Ge,Y++,Le=ie[Y]*ie[Y],be+=Le,Ze+=Le<Ge?Le:Ge,Y++}while(--pt>0);if(be>pe&&Z++,ve==c.SBPSY_s){var Ve=pe*re.nsPsy.shortfact[ve];Ze<Ve&&(Ze=Ve)}if(ge!=0?Pe=Ze:Pe=pe,!z.ATHonly&&!z.ATHshort){var De=q.en.s[ve][we];if(De>0){var Ve;Ve=be*q.thm.s[ve][we]*Te/De,ge!=0&&(Ve*=re.nsPsy.shortfact[ve]),Pe<Ve&&(Pe=Ve)}}ge!=0?K[te++]=Pe:K[te++]=Pe*re.nsPsy.shortfact[ve]}z.useTemporal&&(K[te-3]>K[te-3+1]&&(K[te-3+1]+=(K[te-3]-K[te-3+1])*re.decay),K[te-3+1]>K[te-3+2]&&(K[te-3+2]+=(K[te-3+1]-K[te-3+2])*re.decay))}return Z};function O(z){this.s=z}this.calc_noise_core=function(z,q,G,K){var te=0,re=q.s,H=z.l3_enc;if(re>z.count1)for(;G--!=0;){var Y;Y=z.xr[re],re++,te+=Y*Y,Y=z.xr[re],re++,te+=Y*Y}else if(re>z.big_values){var Z=s(2);for(Z[0]=0,Z[1]=K;G--!=0;){var Y;Y=Math.abs(z.xr[re])-Z[H[re]],re++,te+=Y*Y,Y=Math.abs(z.xr[re])-Z[H[re]],re++,te+=Y*Y}}else for(;G--!=0;){var Y;Y=Math.abs(z.xr[re])-I[H[re]]*K,re++,te+=Y*Y,Y=Math.abs(z.xr[re])-I[H[re]]*K,re++,te+=Y*Y}return q.s=re,te},this.calc_noise=function(z,q,G,K,te){var re=0,H=0,Y,Z,Q=0,ie=0,ge=0,Te=-20,be=0,Pe=z.scalefac,Ge=0;for(K.over_SSD=0,Y=0;Y<z.psymax;Y++){var Ze=z.global_gain-(Pe[Ge++]+(z.preflag!=0?T[Y]:0)<<z.scalefac_scale+1)-z.subblock_gain[z.window[Y]]*8,lt=0;if(te!=null&&te.step[Y]==Ze)lt=te.noise[Y],be+=z.width[Y],G[re++]=lt/q[H++],lt=te.noise_log[Y];else{var pt=g(Ze);if(Z=z.width[Y]>>1,be+z.width[Y]>z.max_nonzero_coeff){var ne;ne=z.max_nonzero_coeff-be+1,ne>0?Z=ne>>1:Z=0}var Le=new O(be);lt=this.calc_noise_core(z,Le,Z,pt),be=Le.s,te!=null&&(te.step[Y]=Ze,te.noise[Y]=lt),lt=G[re++]=lt/q[H++],lt=i.FAST_LOG10(Math.max(lt,1e-20)),te!=null&&(te.noise_log[Y]=lt)}if(te!=null&&(te.global_gain=z.global_gain),ge+=lt,lt>0){var Ve;Ve=Math.max(0|lt*10+.5,1),K.over_SSD+=Ve*Ve,Q++,ie+=lt}Te=Math.max(Te,lt)}return K.over_count=Q,K.tot_noise=ge,K.over_noise=ie,K.max_noise=Te,Q},this.set_pinfo=function(z,q,G,K,te){var re=z.internal_flags,H,Y,Z,Q,ie,ge=q.scalefac_scale==0?.5:1,Te=q.scalefac,be=s(L3Side.SFBMAX),Pe=s(L3Side.SFBMAX),Ge=new CalcNoiseResult;calc_xmin(z,G,q,be),calc_noise(q,be,Pe,Ge,null);var Ze=0;for(Y=q.sfb_lmax,q.block_type!=c.SHORT_TYPE&&q.mixed_block_flag==0&&(Y=22),H=0;H<Y;H++){var lt=re.scalefac_band.l[H],pt=re.scalefac_band.l[H+1],ne=pt-lt;for(Q=0;Ze<pt;Ze++)Q+=q.xr[Ze]*q.xr[Ze];Q/=ne,ie=1e15,re.pinfo.en[K][te][H]=ie*Q,re.pinfo.xfsf[K][te][H]=ie*be[H]*Pe[H]/ne,G.en.l[H]>0&&!z.ATHonly?Q=Q/G.en.l[H]:Q=0,re.pinfo.thr[K][te][H]=ie*Math.max(Q*G.thm.l[H],re.ATH.l[H]),re.pinfo.LAMEsfb[K][te][H]=0,q.preflag!=0&&H>=11&&(re.pinfo.LAMEsfb[K][te][H]=-ge*T[H]),H<c.SBPSY_l&&(a(Te[H]>=0),re.pinfo.LAMEsfb[K][te][H]-=ge*Te[H])}if(q.block_type==c.SHORT_TYPE)for(Y=H,H=q.sfb_smin;H<c.SBMAX_s;H++)for(var lt=re.scalefac_band.s[H],pt=re.scalefac_band.s[H+1],ne=pt-lt,Le=0;Le<3;Le++){for(Q=0,Z=lt;Z<pt;Z++)Q+=q.xr[Ze]*q.xr[Ze],Ze++;Q=Math.max(Q/ne,1e-20),ie=1e15,re.pinfo.en_s[K][te][3*H+Le]=ie*Q,re.pinfo.xfsf_s[K][te][3*H+Le]=ie*be[Y]*Pe[Y]/ne,G.en.s[H][Le]>0?Q=Q/G.en.s[H][Le]:Q=0,(z.ATHonly||z.ATHshort)&&(Q=0),re.pinfo.thr_s[K][te][3*H+Le]=ie*Math.max(Q*G.thm.s[H][Le],re.ATH.s[H]),re.pinfo.LAMEsfb_s[K][te][3*H+Le]=-2*q.subblock_gain[Le],H<c.SBPSY_s&&(re.pinfo.LAMEsfb_s[K][te][3*H+Le]-=ge*Te[Y]),Y++}re.pinfo.LAMEqss[K][te]=q.global_gain,re.pinfo.LAMEmainbits[K][te]=q.part2_3_length+q.part2_length,re.pinfo.LAMEsfbits[K][te]=q.part2_length,re.pinfo.over[K][te]=Ge.over_count,re.pinfo.max_noise[K][te]=Ge.max_noise*10,re.pinfo.over_noise[K][te]=Ge.over_noise*10,re.pinfo.tot_noise[K][te]=Ge.tot_noise*10,re.pinfo.over_SSD[K][te]=Ge.over_SSD}}return N2=h,N2}var P2,J$;function ere(){if(J$)return P2;J$=1;var t=Mo,e=t.System,n=t.Arrays,r=t.new_int,i=t.assert,s=Fl(),o=gU,a=dU,c=Qne();function l(){var u=null;this.qupvt=null,this.setModules=function(re){this.qupvt=re,u=re};function h(re){this.bits=0|re}var f=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function d(re,H,Y,Z,Q,ie){var ge=.5946/H;for(re=re>>1;re--!=0;)Q[ie++]=ge>Y[Z++]?0:1,Q[ie++]=ge>Y[Z++]?0:1}function p(re,H,Y,Z,Q,ie){re=re>>1;var ge=re%2;for(re=re>>1;re--!=0;){var Te,be,Pe,Ge,Ze,lt,pt,ne;Te=Y[Z++]*H,be=Y[Z++]*H,Ze=0|Te,Pe=Y[Z++]*H,lt=0|be,Ge=Y[Z++]*H,pt=0|Pe,Te+=u.adj43[Ze],ne=0|Ge,be+=u.adj43[lt],Q[ie++]=0|Te,Pe+=u.adj43[pt],Q[ie++]=0|be,Ge+=u.adj43[ne],Q[ie++]=0|Pe,Q[ie++]=0|Ge}if(ge!=0){var Te,be,Ze,lt;Te=Y[Z++]*H,be=Y[Z++]*H,Ze=0|Te,lt=0|be,Te+=u.adj43[Ze],be+=u.adj43[lt],Q[ie++]=0|Te,Q[ie++]=0|be}}function m(re,H,Y,Z,Q){var ie,ge,Te=0,be,Pe=0,Ge=0,Ze=0,lt=H,pt=0,ne=lt,Le=0,Ve=re,De=0;for(be=Q!=null&&Z.global_gain==Q.global_gain,Z.block_type==s.SHORT_TYPE?ge=38:ge=21,ie=0;ie<=ge;ie++){var Ie=-1;if((be||Z.block_type==s.NORM_TYPE)&&(Ie=Z.global_gain-(Z.scalefac[ie]+(Z.preflag!=0?u.pretab[ie]:0)<<Z.scalefac_scale+1)-Z.subblock_gain[Z.window[ie]]*8),i(Z.width[ie]>=0),be&&Q.step[ie]==Ie)Pe!=0&&(p(Pe,Y,Ve,De,ne,Le),Pe=0),Ge!=0&&(d(Ge,Y,Ve,De,ne,Le),Ge=0);else{var ae=Z.width[ie];if(Te+Z.width[ie]>Z.max_nonzero_coeff){var ve;ve=Z.max_nonzero_coeff-Te+1,n.fill(H,Z.max_nonzero_coeff,576,0),ae=ve,ae<0&&(ae=0),ie=ge+1}if(Pe==0&&Ge==0&&(ne=lt,Le=pt,Ve=re,De=Ze),Q!=null&&Q.sfb_count1>0&&ie>=Q.sfb_count1&&Q.step[ie]>0&&Ie>=Q.step[ie]?(Pe!=0&&(p(Pe,Y,Ve,De,ne,Le),Pe=0,ne=lt,Le=pt,Ve=re,De=Ze),Ge+=ae):(Ge!=0&&(d(Ge,Y,Ve,De,ne,Le),Ge=0,ne=lt,Le=pt,Ve=re,De=Ze),Pe+=ae),ae<=0){Ge!=0&&(d(Ge,Y,Ve,De,ne,Le),Ge=0),Pe!=0&&(p(Pe,Y,Ve,De,ne,Le),Pe=0);break}}ie<=ge&&(pt+=Z.width[ie],Ze+=Z.width[ie],Te+=Z.width[ie])}Pe!=0&&(p(Pe,Y,Ve,De,ne,Le),Pe=0),Ge!=0&&(d(Ge,Y,Ve,De,ne,Le),Ge=0)}function g(re,H,Y){var Z=0,Q=0;do{var ie=re[H++],ge=re[H++];Z<ie&&(Z=ie),Q<ge&&(Q=ge)}while(H<Y);return Z<Q&&(Z=Q),Z}function _(re,H,Y,Z,Q,ie){var ge=o.ht[Z].xlen*65536+o.ht[Q].xlen,Te=0,be;do{var Pe=re[H++],Ge=re[H++];Pe!=0&&(Pe>14&&(Pe=15,Te+=ge),Pe*=16),Ge!=0&&(Ge>14&&(Ge=15,Te+=ge),Pe+=Ge),Te+=o.largetbl[Pe]}while(H<Y);return be=Te&65535,Te>>=16,Te>be&&(Te=be,Z=Q),ie.bits+=Te,Z}function y(re,H,Y,Z){var Q=0,ie=o.ht[1].hlen;do{var ge=re[H+0]*2+re[H+1];H+=2,Q+=ie[ge]}while(H<Y);return Z.bits+=Q,1}function v(re,H,Y,Z,Q){var ie=0,ge,Te=o.ht[Z].xlen,be;Z==2?be=o.table23:be=o.table56;do{var Pe=re[H+0]*Te+re[H+1];H+=2,ie+=be[Pe]}while(H<Y);return ge=ie&65535,ie>>=16,ie>ge&&(ie=ge,Z++),Q.bits+=ie,Z}function E(re,H,Y,Z,Q){var ie=0,ge=0,Te=0,be=o.ht[Z].xlen,Pe=o.ht[Z].hlen,Ge=o.ht[Z+1].hlen,Ze=o.ht[Z+2].hlen;do{var lt=re[H+0]*be+re[H+1];H+=2,ie+=Pe[lt],ge+=Ge[lt],Te+=Ze[lt]}while(H<Y);var pt=Z;return ie>ge&&(ie=ge,pt++),ie>Te&&(ie=Te,pt=Z+2),Q.bits+=ie,pt}var x=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function A(re,H,Y,Z){var Q=g(re,H,Y);switch(Q){case 0:return Q;case 1:return y(re,H,Y,Z);case 2:case 3:return v(re,H,Y,x[Q-1],Z);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return E(re,H,Y,x[Q-1],Z);default:if(Q>c.IXMAX_VAL)return Z.bits=c.LARGE_BITS,-1;Q-=15;var ie;for(ie=24;ie<32&&!(o.ht[ie].linmax>=Q);ie++);var ge;for(ge=ie-8;ge<24&&!(o.ht[ge].linmax>=Q);ge++);return _(re,H,Y,ge,ie,Z)}}this.noquant_count_bits=function(re,H,Y){var Z=H.l3_enc,Q=Math.min(576,H.max_nonzero_coeff+2>>1<<1);for(Y!=null&&(Y.sfb_count1=0);Q>1&&!(Z[Q-1]|Z[Q-2]);Q-=2);H.count1=Q;for(var ie=0,ge=0;Q>3;Q-=4){var Te;if(((Z[Q-1]|Z[Q-2]|Z[Q-3]|Z[Q-4])&2147483647)>1)break;Te=((Z[Q-4]*2+Z[Q-3])*2+Z[Q-2])*2+Z[Q-1],ie+=o.t32l[Te],ge+=o.t33l[Te]}var be=ie;if(H.count1table_select=0,ie>ge&&(be=ge,H.count1table_select=1),H.count1bits=be,H.big_values=Q,Q==0)return be;if(H.block_type==s.SHORT_TYPE)ie=3*re.scalefac_band.s[3],ie>H.big_values&&(ie=H.big_values),ge=H.big_values;else if(H.block_type==s.NORM_TYPE){if(ie=H.region0_count=re.bv_scf[Q-2],ge=H.region1_count=re.bv_scf[Q-1],i(ie+ge+2<s.SBPSY_l),ge=re.scalefac_band.l[ie+ge+2],ie=re.scalefac_band.l[ie+1],ge<Q){var Pe=new h(be);H.table_select[2]=A(Z,ge,Q,Pe),be=Pe.bits}}else H.region0_count=7,H.region1_count=s.SBMAX_l-1-7-1,ie=re.scalefac_band.l[8],ge=Q,ie>ge&&(ie=ge);if(ie=Math.min(ie,Q),ge=Math.min(ge,Q),0<ie){var Pe=new h(be);H.table_select[0]=A(Z,0,ie,Pe),be=Pe.bits}if(ie<ge){var Pe=new h(be);H.table_select[1]=A(Z,ie,ge,Pe),be=Pe.bits}if(re.use_best_huffman==2&&(H.part2_3_length=be,best_huffman_divide(re,H),be=H.part2_3_length),Y!=null&&H.block_type==s.NORM_TYPE){for(var Ge=0;re.scalefac_band.l[Ge]<H.big_values;)Ge++;Y.sfb_count1=Ge}return be},this.count_bits=function(re,H,Y,Z){var Q=Y.l3_enc,ie=c.IXMAX_VAL/u.IPOW20(Y.global_gain);if(Y.xrpow_max>ie)return c.LARGE_BITS;if(m(H,Q,u.IPOW20(Y.global_gain),Y,Z),re.substep_shaping&2)for(var ge=0,Te=Y.global_gain+Y.scalefac_scale,be=.634521682242439/u.IPOW20(Te),Pe=0;Pe<Y.sfbmax;Pe++){var Ge=Y.width[Pe];if(re.pseudohalf[Pe]==0)ge+=Ge;else{var Ze;for(Ze=ge,ge+=Ge;Ze<ge;++Ze)Q[Ze]=H[Ze]>=be?Q[Ze]:0}}return this.noquant_count_bits(re,Y,Z)};function T(re,H,Y,Z,Q,ie,ge){for(var Te=H.big_values,be=0;be<=22;be++)Z[be]=c.LARGE_BITS;for(var be=0;be<16;be++){var Pe=re.scalefac_band.l[be+1];if(Pe>=Te)break;var Ge=0,Ze=new h(Ge),lt=A(Y,0,Pe,Ze);Ge=Ze.bits;for(var pt=0;pt<8;pt++){var ne=re.scalefac_band.l[be+pt+2];if(ne>=Te)break;var Le=Ge;Ze=new h(Le);var Ve=A(Y,Pe,ne,Ze);Le=Ze.bits,Z[be+pt]>Le&&(Z[be+pt]=Le,Q[be+pt]=be,ie[be+pt]=lt,ge[be+pt]=Ve)}}}function k(re,H,Y,Z,Q,ie,ge,Te){for(var be=H.big_values,Pe=2;Pe<s.SBMAX_l+1;Pe++){var Ge=re.scalefac_band.l[Pe];if(Ge>=be)break;var Ze=Q[Pe-2]+H.count1bits;if(Y.part2_3_length<=Ze)break;var lt=new h(Ze),pt=A(Z,Ge,be,lt);Ze=lt.bits,!(Y.part2_3_length<=Ze)&&(Y.assign(H),Y.part2_3_length=Ze,Y.region0_count=ie[Pe-2],Y.region1_count=Pe-2-ie[Pe-2],Y.table_select[0]=ge[Pe-2],Y.table_select[1]=Te[Pe-2],Y.table_select[2]=pt)}}this.best_huffman_divide=function(re,H){var Y=new a,Z=H.l3_enc,Q=r(23),ie=r(23),ge=r(23),Te=r(23);if(!(H.block_type==s.SHORT_TYPE&&re.mode_gr==1)){Y.assign(H),H.block_type==s.NORM_TYPE&&(T(re,H,Z,Q,ie,ge,Te),k(re,Y,H,Z,Q,ie,ge,Te));var be=Y.big_values;if(!(be==0||(Z[be-2]|Z[be-1])>1)&&(be=H.count1+2,!(be>576))){Y.assign(H),Y.count1=be;for(var Pe=0,Ge=0;be>Y.big_values;be-=4){var Ze=((Z[be-4]*2+Z[be-3])*2+Z[be-2])*2+Z[be-1];Pe+=o.t32l[Ze],Ge+=o.t33l[Ze]}if(Y.big_values=be,Y.count1table_select=0,Pe>Ge&&(Pe=Ge,Y.count1table_select=1),Y.count1bits=Pe,Y.block_type==s.NORM_TYPE)k(re,Y,H,Z,Q,ie,ge,Te);else{if(Y.part2_3_length=Pe,Pe=re.scalefac_band.l[8],Pe>be&&(Pe=be),Pe>0){var lt=new h(Y.part2_3_length);Y.table_select[0]=A(Z,0,Pe,lt),Y.part2_3_length=lt.bits}if(be>Pe){var lt=new h(Y.part2_3_length);Y.table_select[1]=A(Z,Pe,be,lt),Y.part2_3_length=lt.bits}H.part2_3_length>Y.part2_3_length&&H.assign(Y)}}}};var L=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],I=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],F=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],M=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];l.slen1_tab=F,l.slen2_tab=M;function D(re,H){for(var Y,Z=H.tt[1][re],Q=H.tt[0][re],ie=0;ie<o.scfsi_band.length-1;ie++){for(Y=o.scfsi_band[ie];Y<o.scfsi_band[ie+1]&&!(Q.scalefac[Y]!=Z.scalefac[Y]&&Z.scalefac[Y]>=0);Y++);if(Y==o.scfsi_band[ie+1]){for(Y=o.scfsi_band[ie];Y<o.scfsi_band[ie+1];Y++)Z.scalefac[Y]=-1;H.scfsi[re][ie]=1}}var ge=0,Te=0;for(Y=0;Y<11;Y++)Z.scalefac[Y]!=-1&&(Te++,ge<Z.scalefac[Y]&&(ge=Z.scalefac[Y]));for(var be=0,Pe=0;Y<s.SBPSY_l;Y++)Z.scalefac[Y]!=-1&&(Pe++,be<Z.scalefac[Y]&&(be=Z.scalefac[Y]));for(var ie=0;ie<16;ie++)if(ge<L[ie]&&be<I[ie]){var Ge=F[ie]*Te+M[ie]*Pe;Z.part2_length>Ge&&(Z.part2_length=Ge,Z.scalefac_compress=ie)}}this.best_scalefac_store=function(re,H,Y,Z){var Q=Z.tt[H][Y],ie,ge,Te,be,Pe=0;for(Te=0,ie=0;ie<Q.sfbmax;ie++){var Ge=Q.width[ie];for(Te+=Ge,be=-Ge;be<0&&Q.l3_enc[be+Te]==0;be++);be==0&&(Q.scalefac[ie]=Pe=-2)}if(Q.scalefac_scale==0&&Q.preflag==0){var Ze=0;for(ie=0;ie<Q.sfbmax;ie++)Q.scalefac[ie]>0&&(Ze|=Q.scalefac[ie]);if(!(Ze&1)&&Ze!=0){for(ie=0;ie<Q.sfbmax;ie++)Q.scalefac[ie]>0&&(Q.scalefac[ie]>>=1);Q.scalefac_scale=Pe=1}}if(Q.preflag==0&&Q.block_type!=s.SHORT_TYPE&&re.mode_gr==2){for(ie=11;ie<s.SBPSY_l&&!(Q.scalefac[ie]<u.pretab[ie]&&Q.scalefac[ie]!=-2);ie++);if(ie==s.SBPSY_l){for(ie=11;ie<s.SBPSY_l;ie++)Q.scalefac[ie]>0&&(Q.scalefac[ie]-=u.pretab[ie]);Q.preflag=Pe=1}}for(ge=0;ge<4;ge++)Z.scfsi[Y][ge]=0;for(re.mode_gr==2&&H==1&&Z.tt[0][Y].block_type!=s.SHORT_TYPE&&Z.tt[1][Y].block_type!=s.SHORT_TYPE&&(D(Y,Z),Pe=0),ie=0;ie<Q.sfbmax;ie++)Q.scalefac[ie]==-2&&(Q.scalefac[ie]=0);Pe!=0&&(re.mode_gr==2?this.scale_bitcount(Q):this.scale_bitcount_lsf(re,Q))};function O(re,H){for(var Y=0;Y<H;++Y)if(re[Y]<0)return!1;return!0}var z=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],q=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],G=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(re){var H,Y,Z=0,Q=0,ie,ge=re.scalefac;if(i(O(ge,re.sfbmax)),re.block_type==s.SHORT_TYPE)ie=z,re.mixed_block_flag!=0&&(ie=q);else if(ie=G,re.preflag==0){for(Y=11;Y<s.SBPSY_l&&!(ge[Y]<u.pretab[Y]);Y++);if(Y==s.SBPSY_l)for(re.preflag=1,Y=11;Y<s.SBPSY_l;Y++)ge[Y]-=u.pretab[Y]}for(Y=0;Y<re.sfbdivide;Y++)Z<ge[Y]&&(Z=ge[Y]);for(;Y<re.sfbmax;Y++)Q<ge[Y]&&(Q=ge[Y]);for(re.part2_length=c.LARGE_BITS,H=0;H<16;H++)Z<L[H]&&Q<I[H]&&re.part2_length>ie[H]&&(re.part2_length=ie[H],re.scalefac_compress=H);return re.part2_length==c.LARGE_BITS};var K=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(re,H){var Y,Z,Q,ie,ge,Te,be,Pe,Ge=r(4),Ze=H.scalefac;for(H.preflag!=0?Y=2:Y=0,be=0;be<4;be++)Ge[be]=0;if(H.block_type==s.SHORT_TYPE){Z=1;var lt=u.nr_of_sfb_block[Y][Z];for(Pe=0,Q=0;Q<4;Q++)for(ie=lt[Q]/3,be=0;be<ie;be++,Pe++)for(ge=0;ge<3;ge++)Ze[Pe*3+ge]>Ge[Q]&&(Ge[Q]=Ze[Pe*3+ge])}else{Z=0;var lt=u.nr_of_sfb_block[Y][Z];for(Pe=0,Q=0;Q<4;Q++)for(ie=lt[Q],be=0;be<ie;be++,Pe++)Ze[Pe]>Ge[Q]&&(Ge[Q]=Ze[Pe])}for(Te=!1,Q=0;Q<4;Q++)Ge[Q]>K[Y][Q]&&(Te=!0);if(!Te){var pt,ne,Le,Ve;for(H.sfb_partition_table=u.nr_of_sfb_block[Y][Z],Q=0;Q<4;Q++)H.slen[Q]=te[Ge[Q]];switch(pt=H.slen[0],ne=H.slen[1],Le=H.slen[2],Ve=H.slen[3],Y){case 0:H.scalefac_compress=(pt*5+ne<<4)+(Le<<2)+Ve;break;case 1:H.scalefac_compress=400+(pt*5+ne<<2)+Le;break;case 2:H.scalefac_compress=500+pt*3+ne;break;default:e.err.printf(`intensity stereo not implemented yet
`);break}}if(!Te)for(i(H.sfb_partition_table!=null),H.part2_length=0,Q=0;Q<4;Q++)H.part2_length+=H.slen[Q]*H.sfb_partition_table[Q];return Te};var te=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(re){for(var H=2;H<=576;H+=2){for(var Y=0,Z;re.scalefac_band.l[++Y]<H;);for(Z=f[Y][0];re.scalefac_band.l[Z+1]>H;)Z--;for(Z<0&&(Z=f[Y][0]),re.bv_scf[H-2]=Z,Z=f[Y][1];re.scalefac_band.l[Z+re.bv_scf[H-2]+2]>H;)Z--;Z<0&&(Z=f[Y][1]),re.bv_scf[H-1]=Z}}}return P2=l,P2}var D2,Z$;function _U(){if(Z$)return D2;Z$=1;var t=Mo,e=t.System,n=t.Arrays,r=t.new_byte,i=t.new_float_n,s=t.new_int,o=t.assert,a=ere(),c=gU,l=Fl(),u=VI;h.EQ=function(f,d){return Math.abs(f)>Math.abs(d)?Math.abs(f-d)<=Math.abs(f)*1e-6:Math.abs(f-d)<=Math.abs(d)*1e-6},h.NEQ=function(f,d){return!h.EQ(f,d)};function h(){var f=vU(),d=this,p=32773,m=null,g=null,_=null,y=null;this.setModules=function(H,Y,Z,Q){m=H,g=Y,_=Z,y=Q};var v=null,E=0,x=0,A=0;this.getframebits=function(H){var Y=H.internal_flags,Z;Y.bitrate_index!=0?Z=c.bitrate_table[H.version][Y.bitrate_index]:Z=H.brate;var Q=0|(H.version+1)*72e3*Z/H.out_samplerate+Y.padding;return 8*Q};function T(H){e.arraycopy(H.header[H.w_ptr].buf,0,v,x,H.sideinfo_len),x+=H.sideinfo_len,E+=H.sideinfo_len*8,H.w_ptr=H.w_ptr+1&u.MAX_HEADER_BUF-1}function k(H,Y,Z){for(;Z>0;){var Q;A==0&&(A=8,x++,o(x<f.LAME_MAXMP3BUFFER),o(H.header[H.w_ptr].write_timing>=E),H.header[H.w_ptr].write_timing==E&&T(H),v[x]=0),Q=Math.min(Z,A),Z-=Q,A-=Q,v[x]|=Y>>Z<<A,E+=Q}}function L(H,Y,Z){for(;Z>0;){var Q;A==0&&(A=8,x++,o(x<f.LAME_MAXMP3BUFFER),v[x]=0),Q=Math.min(Z,A),Z-=Q,A-=Q,v[x]|=Y>>Z<<A,E+=Q}}function I(H,Y){var Z=H.internal_flags,Q;if(Y>=8&&(k(Z,76,8),Y-=8),Y>=8&&(k(Z,65,8),Y-=8),Y>=8&&(k(Z,77,8),Y-=8),Y>=8&&(k(Z,69,8),Y-=8),Y>=32){var ie=_.getLameShortVersion();if(Y>=32)for(Q=0;Q<ie.length&&Y>=8;++Q)Y-=8,k(Z,ie.charAt(Q),8)}for(;Y>=1;Y-=1)k(Z,Z.ancillary_flag,1),Z.ancillary_flag^=H.disable_reservoir?0:1}function F(H,Y,Z){for(var Q=H.header[H.h_ptr].ptr;Z>0;){var ie=Math.min(Z,8-(Q&7));Z-=ie,H.header[H.h_ptr].buf[Q>>3]|=Y>>Z<<8-(Q&7)-ie,Q+=ie}H.header[H.h_ptr].ptr=Q}function M(H,Y){H<<=8;for(var Z=0;Z<8;Z++)H<<=1,Y<<=1,(Y^H)&65536&&(Y^=p);return Y}this.CRC_writeheader=function(H,Y){var Z=65535;Z=M(Y[2]&255,Z),Z=M(Y[3]&255,Z);for(var Q=6;Q<H.sideinfo_len;Q++)Z=M(Y[Q]&255,Z);Y[4]=byte(Z>>8),Y[5]=byte(Z&255)};function D(H,Y){var Z=H.internal_flags,Q,ie,ge;if(Q=Z.l3_side,Z.header[Z.h_ptr].ptr=0,n.fill(Z.header[Z.h_ptr].buf,0,Z.sideinfo_len,0),H.out_samplerate<16e3?F(Z,4094,12):F(Z,4095,12),F(Z,H.version,1),F(Z,1,2),F(Z,H.error_protection?0:1,1),F(Z,Z.bitrate_index,4),F(Z,Z.samplerate_index,2),F(Z,Z.padding,1),F(Z,H.extension,1),F(Z,H.mode.ordinal(),2),F(Z,Z.mode_ext,2),F(Z,H.copyright,1),F(Z,H.original,1),F(Z,H.emphasis,2),H.error_protection&&F(Z,0,16),H.version==1){for(o(Q.main_data_begin>=0),F(Z,Q.main_data_begin,9),Z.channels_out==2?F(Z,Q.private_bits,3):F(Z,Q.private_bits,5),ge=0;ge<Z.channels_out;ge++){var Te;for(Te=0;Te<4;Te++)F(Z,Q.scfsi[ge][Te],1)}for(ie=0;ie<2;ie++)for(ge=0;ge<Z.channels_out;ge++){var be=Q.tt[ie][ge];F(Z,be.part2_3_length+be.part2_length,12),F(Z,be.big_values/2,9),F(Z,be.global_gain,8),F(Z,be.scalefac_compress,4),be.block_type!=l.NORM_TYPE?(F(Z,1,1),F(Z,be.block_type,2),F(Z,be.mixed_block_flag,1),be.table_select[0]==14&&(be.table_select[0]=16),F(Z,be.table_select[0],5),be.table_select[1]==14&&(be.table_select[1]=16),F(Z,be.table_select[1],5),F(Z,be.subblock_gain[0],3),F(Z,be.subblock_gain[1],3),F(Z,be.subblock_gain[2],3)):(F(Z,0,1),be.table_select[0]==14&&(be.table_select[0]=16),F(Z,be.table_select[0],5),be.table_select[1]==14&&(be.table_select[1]=16),F(Z,be.table_select[1],5),be.table_select[2]==14&&(be.table_select[2]=16),F(Z,be.table_select[2],5),o(0<=be.region0_count&&be.region0_count<16),o(0<=be.region1_count&&be.region1_count<8),F(Z,be.region0_count,4),F(Z,be.region1_count,3)),F(Z,be.preflag,1),F(Z,be.scalefac_scale,1),F(Z,be.count1table_select,1)}}else for(o(Q.main_data_begin>=0),F(Z,Q.main_data_begin,8),F(Z,Q.private_bits,Z.channels_out),ie=0,ge=0;ge<Z.channels_out;ge++){var be=Q.tt[ie][ge];F(Z,be.part2_3_length+be.part2_length,12),F(Z,be.big_values/2,9),F(Z,be.global_gain,8),F(Z,be.scalefac_compress,9),be.block_type!=l.NORM_TYPE?(F(Z,1,1),F(Z,be.block_type,2),F(Z,be.mixed_block_flag,1),be.table_select[0]==14&&(be.table_select[0]=16),F(Z,be.table_select[0],5),be.table_select[1]==14&&(be.table_select[1]=16),F(Z,be.table_select[1],5),F(Z,be.subblock_gain[0],3),F(Z,be.subblock_gain[1],3),F(Z,be.subblock_gain[2],3)):(F(Z,0,1),be.table_select[0]==14&&(be.table_select[0]=16),F(Z,be.table_select[0],5),be.table_select[1]==14&&(be.table_select[1]=16),F(Z,be.table_select[1],5),be.table_select[2]==14&&(be.table_select[2]=16),F(Z,be.table_select[2],5),o(0<=be.region0_count&&be.region0_count<16),o(0<=be.region1_count&&be.region1_count<8),F(Z,be.region0_count,4),F(Z,be.region1_count,3)),F(Z,be.scalefac_scale,1),F(Z,be.count1table_select,1)}H.error_protection&&CRC_writeheader(Z,Z.header[Z.h_ptr].buf);{var Pe=Z.h_ptr;o(Z.header[Pe].ptr==Z.sideinfo_len*8),Z.h_ptr=Pe+1&u.MAX_HEADER_BUF-1,Z.header[Z.h_ptr].write_timing=Z.header[Pe].write_timing+Y,Z.h_ptr==Z.w_ptr&&e.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function O(H,Y){var Z=c.ht[Y.count1table_select+32],Q,ie=0,ge=Y.big_values,Te=Y.big_values;for(o(Y.count1table_select<2),Q=(Y.count1-Y.big_values)/4;Q>0;--Q){var be=0,Pe=0,Ge;Ge=Y.l3_enc[ge+0],Ge!=0&&(Pe+=8,Y.xr[Te+0]<0&&be++),Ge=Y.l3_enc[ge+1],Ge!=0&&(Pe+=4,be*=2,Y.xr[Te+1]<0&&be++),Ge=Y.l3_enc[ge+2],Ge!=0&&(Pe+=2,be*=2,Y.xr[Te+2]<0&&be++),Ge=Y.l3_enc[ge+3],Ge!=0&&(Pe++,be*=2,Y.xr[Te+3]<0&&be++),ge+=4,Te+=4,k(H,be+Z.table[Pe],Z.hlen[Pe]),ie+=Z.hlen[Pe]}return ie}function z(H,Y,Z,Q,ie){var ge=c.ht[Y],Te=0;if(Y==0)return Te;for(var be=Z;be<Q;be+=2){var Pe=0,Ge=0,Ze=ge.xlen,lt=ge.xlen,pt=0,ne=ie.l3_enc[be],Le=ie.l3_enc[be+1];if(ne!=0&&(ie.xr[be]<0&&pt++,Pe--),Y>15){if(ne>14){var Ve=ne-15;o(Ve<=ge.linmax),pt|=Ve<<1,Ge=Ze,ne=15}if(Le>14){var De=Le-15;o(De<=ge.linmax),pt<<=Ze,pt|=De,Ge+=Ze,Le=15}lt=16}Le!=0&&(pt<<=1,ie.xr[be+1]<0&&pt++,Pe--),ne=ne*lt+Le,Ge-=Pe,Pe+=ge.hlen[ne],k(H,ge.table[ne],Pe),k(H,pt,Ge),Te+=Pe+Ge}return Te}function q(H,Y){var Z=3*H.scalefac_band.s[3];Z>Y.big_values&&(Z=Y.big_values);var Q=z(H,Y.table_select[0],0,Z,Y);return Q+=z(H,Y.table_select[1],Z,Y.big_values,Y),Q}function G(H,Y){var Z,Q,ie,ge;Z=Y.big_values;var Te=Y.region0_count+1;return o(Te<H.scalefac_band.l.length),ie=H.scalefac_band.l[Te],Te+=Y.region1_count+1,o(Te<H.scalefac_band.l.length),ge=H.scalefac_band.l[Te],ie>Z&&(ie=Z),ge>Z&&(ge=Z),Q=z(H,Y.table_select[0],0,ie,Y),Q+=z(H,Y.table_select[1],ie,ge,Y),Q+=z(H,Y.table_select[2],ge,Z,Y),Q}function K(H){var Y,Z,Q,ie,ge=0,Te=H.internal_flags,be=Te.l3_side;if(H.version==1)for(Y=0;Y<2;Y++)for(Z=0;Z<Te.channels_out;Z++){var Pe=be.tt[Y][Z],Ge=a.slen1_tab[Pe.scalefac_compress],Ze=a.slen2_tab[Pe.scalefac_compress];for(ie=0,Q=0;Q<Pe.sfbdivide;Q++)Pe.scalefac[Q]!=-1&&(k(Te,Pe.scalefac[Q],Ge),ie+=Ge);for(;Q<Pe.sfbmax;Q++)Pe.scalefac[Q]!=-1&&(k(Te,Pe.scalefac[Q],Ze),ie+=Ze);o(ie==Pe.part2_length),Pe.block_type==l.SHORT_TYPE?ie+=q(Te,Pe):ie+=G(Te,Pe),ie+=O(Te,Pe),o(ie==Pe.part2_3_length+Pe.part2_length),ge+=ie}else for(Y=0,Z=0;Z<Te.channels_out;Z++){var Pe=be.tt[Y][Z],lt,pt,ne=0;if(o(Pe.sfb_partition_table!=null),ie=0,Q=0,pt=0,Pe.block_type==l.SHORT_TYPE){for(;pt<4;pt++){var Le=Pe.sfb_partition_table[pt]/3,Ve=Pe.slen[pt];for(lt=0;lt<Le;lt++,Q++)k(Te,Math.max(Pe.scalefac[Q*3+0],0),Ve),k(Te,Math.max(Pe.scalefac[Q*3+1],0),Ve),k(Te,Math.max(Pe.scalefac[Q*3+2],0),Ve),ne+=3*Ve}ie+=q(Te,Pe)}else{for(;pt<4;pt++){var Le=Pe.sfb_partition_table[pt],Ve=Pe.slen[pt];for(lt=0;lt<Le;lt++,Q++)k(Te,Math.max(Pe.scalefac[Q],0),Ve),ne+=Ve}ie+=G(Te,Pe)}ie+=O(Te,Pe),o(ie==Pe.part2_3_length),o(ne==Pe.part2_length),ge+=ne+ie}return ge}function te(){this.total=0}function re(H,Y){var Z=H.internal_flags,Q,ie,ge,Te,be;return be=Z.w_ptr,Te=Z.h_ptr-1,Te==-1&&(Te=u.MAX_HEADER_BUF-1),Q=Z.header[Te].write_timing-E,Y.total=Q,Q>=0&&(ie=1+Te-be,Te<be&&(ie=1+Te-be+u.MAX_HEADER_BUF),Q-=ie*8*Z.sideinfo_len),ge=d.getframebits(H),Q+=ge,Y.total+=ge,Y.total%8!=0?Y.total=1+Y.total/8:Y.total=Y.total/8,Y.total+=x+1,Q<0&&e.err.println(`strange error flushing buffer ... 
`),Q}this.flush_bitstream=function(H){var Y=H.internal_flags,Z,Q,ie=Y.h_ptr-1;if(ie==-1&&(ie=u.MAX_HEADER_BUF-1),Z=Y.l3_side,!((Q=re(H,new te))<0)){if(I(H,Q),o(Y.header[ie].write_timing+this.getframebits(H)==E),Y.ResvSize=0,Z.main_data_begin=0,Y.findReplayGain){var ge=m.GetTitleGain(Y.rgdata);o(NEQ(ge,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),Y.RadioGain=Math.floor(ge*10+.5)|0}Y.findPeakSample&&(Y.noclipGainChange=Math.ceil(Math.log10(Y.PeakSample/32767)*20*10)|0,Y.noclipGainChange>0&&(EQ(H.scale,1)||EQ(H.scale,0))?Y.noclipScale=Math.floor(32767/Y.PeakSample*100)/100:Y.noclipScale=-1)}},this.add_dummy_byte=function(H,Y,Z){for(var Q=H.internal_flags,ie;Z-- >0;)for(L(Q,Y,8),ie=0;ie<u.MAX_HEADER_BUF;++ie)Q.header[ie].write_timing+=8},this.format_bitstream=function(H){var Y=H.internal_flags,Z;Z=Y.l3_side;var Q=this.getframebits(H);I(H,Z.resvDrain_pre),D(H,Q);var ie=8*Y.sideinfo_len;if(ie+=K(H),I(H,Z.resvDrain_post),ie+=Z.resvDrain_post,Z.main_data_begin+=(Q-ie)/8,re(H,new te)!=Y.ResvSize&&e.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),Z.main_data_begin*8!=Y.ResvSize&&(e.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*Z.main_data_begin,Y.ResvSize,Z.resvDrain_post,Z.resvDrain_pre,8*Y.sideinfo_len,ie-Z.resvDrain_post-8*Y.sideinfo_len,ie,ie%8,Q),e.err.println("This is a fatal error.  It has several possible causes:"),e.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),e.err.println(" 9%%  Your system is overclocked"),e.err.println(" 1%%  bug in LAME encoding library"),Y.ResvSize=Z.main_data_begin*8),E>1e9){var ge;for(ge=0;ge<u.MAX_HEADER_BUF;++ge)Y.header[ge].write_timing-=E;E=0}return 0},this.copy_buffer=function(H,Y,Z,Q,ie){var ge=x+1;if(ge<=0)return 0;if(Q!=0&&ge>Q)return-1;if(e.arraycopy(v,0,Y,Z,ge),x=-1,A=0,ie!=0){var Te=s(1);if(Te[0]=H.nMusicCRC,y.updateMusicCRC(Te,Y,Z,ge),H.nMusicCRC=Te[0],ge>0&&(H.VBR_seek_table.nBytesWritten+=ge),H.decode_on_the_fly){for(var be=i([2,1152]),Pe=ge,Ge=-1,Ze;Ge!=0;)if(Ge=g.hip_decode1_unclipped(H.hip,Y,Z,Pe,be[0],be[1]),Pe=0,Ge==-1&&(Ge=0),Ge>0){if(H.findPeakSample){for(Ze=0;Ze<Ge;Ze++)be[0][Ze]>H.PeakSample?H.PeakSample=be[0][Ze]:-be[0][Ze]>H.PeakSample&&(H.PeakSample=-be[0][Ze]);if(H.channels_out>1)for(Ze=0;Ze<Ge;Ze++)be[1][Ze]>H.PeakSample?H.PeakSample=be[1][Ze]:-be[1][Ze]>H.PeakSample&&(H.PeakSample=-be[1][Ze])}if(H.findReplayGain&&m.AnalyzeSamples(H.rgdata,be[0],0,be[1],0,Ge,H.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return ge},this.init_bit_stream_w=function(H){v=r(f.LAME_MAXMP3BUFFER),H.h_ptr=H.w_ptr=0,H.header[H.h_ptr].write_timing=0,x=-1,A=0,E=0}}return D2=h,D2}var L2,Q$;function vU(){if(Q$)return L2;Q$=1;var t=Mo,e=t.System,n=t.VbrMode,r=t.ShortBlock,i=t.new_float,s=t.new_int_n,o=t.new_short_n,a=t.assert,c=AFe,l=kFe,u=VI,h=QFe,f=t7e,d=c7e,p=_U(),m=gU,g=Fl();function _(){var y=RC,v=this,E=128*1024;_.V9=410,_.V8=420,_.V7=430,_.V6=440,_.V5=450,_.V4=460,_.V3=470,_.V2=480,_.V1=490,_.V0=500,_.R3MIX=1e3,_.STANDARD=1001,_.EXTREME=1002,_.INSANE=1003,_.STANDARD_FAST=1004,_.EXTREME_FAST=1005,_.MEDIUM=1006,_.MEDIUM_FAST=1007;var x=16384+E;_.LAME_MAXMP3BUFFER=x;var A,T,k,L,I,F=new c,M,D,O;this.enc=new g,this.setModules=function(ae,ve,we,pe,ze,Je,Xe,tt,Nt){A=ae,T=ve,k=we,L=pe,I=ze,M=Je,D=tt,O=Nt,this.enc.setModules(T,F,L,M)};function z(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=i(g.SBMAX_l),this.bo_s_weight=i(g.SBMAX_s)}function q(){this.lowerlimit=0}function G(ae,ve){this.lowpass=ve}var K=4294479419;function te(ae){var ve;return ae.class_id=K,ve=ae.internal_flags=new u,ae.mode=y.NOT_SET,ae.original=1,ae.in_samplerate=44100,ae.num_channels=2,ae.num_samples=-1,ae.bWriteVbrTag=!0,ae.quality=-1,ae.short_blocks=null,ve.subblock_gain=-1,ae.lowpassfreq=0,ae.highpassfreq=0,ae.lowpasswidth=-1,ae.highpasswidth=-1,ae.VBR=n.vbr_off,ae.VBR_q=4,ae.ATHcurve=-1,ae.VBR_mean_bitrate_kbps=128,ae.VBR_min_bitrate_kbps=0,ae.VBR_max_bitrate_kbps=0,ae.VBR_hard_min=0,ve.VBR_min_bitrate=1,ve.VBR_max_bitrate=13,ae.quant_comp=-1,ae.quant_comp_short=-1,ae.msfix=-1,ve.resample_ratio=1,ve.OldValue[0]=180,ve.OldValue[1]=180,ve.CurrentStep[0]=4,ve.CurrentStep[1]=4,ve.masking_lower=1,ve.nsPsy.attackthre=-1,ve.nsPsy.attackthre_s=-1,ae.scale=-1,ae.athaa_type=-1,ae.ATHtype=-1,ae.athaa_loudapprox=-1,ae.athaa_sensitivity=0,ae.useTemporal=null,ae.interChRatio=-1,ve.mf_samples_to_encode=g.ENCDELAY+g.POSTDELAY,ae.encoder_padding=0,ve.mf_size=g.ENCDELAY-g.MDCTDELAY,ae.findReplayGain=!1,ae.decode_on_the_fly=!1,ve.decode_on_the_fly=!1,ve.findReplayGain=!1,ve.findPeakSample=!1,ve.RadioGain=0,ve.AudiophileGain=0,ve.noclipGainChange=0,ve.noclipScale=-1,ae.preset=0,ae.write_id3tag_automatic=!0,0}this.lame_init=function(){var ae=new l;return te(ae),ae.lame_allocated_gfp=1,ae};function re(ae){return ae>1?0:ae<=0?1:Math.cos(Math.PI/2*ae)}this.nearestBitrateFullIndex=function(ae){var ve=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],we=0,pe=0,ze=0,Je=0;Je=ve[16],ze=16,pe=ve[16],we=16;for(var Xe=0;Xe<16;Xe++)if(Math.max(ae,ve[Xe+1])!=ae){Je=ve[Xe+1],ze=Xe+1,pe=ve[Xe],we=Xe;break}return Je-ae>ae-pe?we:ze};function H(ae,ve){var we=44100;return ve>=48e3?we=48e3:ve>=44100?we=44100:ve>=32e3?we=32e3:ve>=24e3?we=24e3:ve>=22050?we=22050:ve>=16e3?we=16e3:ve>=12e3?we=12e3:ve>=11025?we=11025:ve>=8e3&&(we=8e3),ae==-1?we:(ae<=15960&&(we=44100),ae<=15250&&(we=32e3),ae<=11220&&(we=24e3),ae<=9970&&(we=22050),ae<=7230&&(we=16e3),ae<=5420&&(we=12e3),ae<=4510&&(we=11025),ae<=3970&&(we=8e3),ve<we?ve>44100?48e3:ve>32e3?44100:ve>24e3?32e3:ve>22050?24e3:ve>16e3?22050:ve>12e3?16e3:ve>11025?12e3:ve>8e3?11025:8e3:we)}function Y(ae,ve){switch(ae){case 44100:return ve.version=1,0;case 48e3:return ve.version=1,1;case 32e3:return ve.version=1,2;case 22050:return ve.version=0,0;case 24e3:return ve.version=0,1;case 16e3:return ve.version=0,2;case 11025:return ve.version=0,0;case 12e3:return ve.version=0,1;case 8e3:return ve.version=0,2;default:return ve.version=0,-1}}function Z(ae,ve,we){we<16e3&&(ve=2);for(var pe=m.bitrate_table[ve][1],ze=2;ze<=14;ze++)m.bitrate_table[ve][ze]>0&&Math.abs(m.bitrate_table[ve][ze]-ae)<Math.abs(pe-ae)&&(pe=m.bitrate_table[ve][ze]);return pe}function Q(ae,ve,we){we<16e3&&(ve=2);for(var pe=0;pe<=14;pe++)if(m.bitrate_table[ve][pe]>0&&m.bitrate_table[ve][pe]==ae)return pe;return-1}function ie(ae,ve){var we=[new G(8,2e3),new G(16,3700),new G(24,3900),new G(32,5500),new G(40,7e3),new G(48,7500),new G(56,1e4),new G(64,11e3),new G(80,13500),new G(96,15100),new G(112,15600),new G(128,17e3),new G(160,17500),new G(192,18600),new G(224,19400),new G(256,19700),new G(320,20500)],pe=v.nearestBitrateFullIndex(ve);ae.lowerlimit=we[pe].lowpass}function ge(ae){var ve=ae.internal_flags,we=32,pe=-1;if(ve.lowpass1>0){for(var ze=999,Je=0;Je<=31;Je++){var Xe=Je/31;Xe>=ve.lowpass2&&(we=Math.min(we,Je)),ve.lowpass1<Xe&&Xe<ve.lowpass2&&(ze=Math.min(ze,Je))}ze==999?ve.lowpass1=(we-.75)/31:ve.lowpass1=(ze-.75)/31,ve.lowpass2=we/31}if(ve.highpass2>0&&ve.highpass2<.9*(.75/31)&&(ve.highpass1=0,ve.highpass2=0,e.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),ve.highpass2>0){for(var tt=-1,Je=0;Je<=31;Je++){var Xe=Je/31;Xe<=ve.highpass1&&(pe=Math.max(pe,Je)),ve.highpass1<Xe&&Xe<ve.highpass2&&(tt=Math.max(tt,Je))}ve.highpass1=pe/31,tt==-1?ve.highpass2=(pe+.75)/31:ve.highpass2=(tt+.75)/31}for(var Je=0;Je<32;Je++){var Nt,gt,Xe=Je/31;ve.highpass2>ve.highpass1?Nt=re((ve.highpass2-Xe)/(ve.highpass2-ve.highpass1+1e-20)):Nt=1,ve.lowpass2>ve.lowpass1?gt=re((Xe-ve.lowpass1)/(ve.lowpass2-ve.lowpass1+1e-20)):gt=1,ve.amp_filter[Je]=Nt*gt}}function Te(ae){var ve=ae.internal_flags;switch(ae.quality){default:case 9:ve.psymodel=0,ve.noise_shaping=0,ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 8:ae.quality=7;case 7:ve.psymodel=1,ve.noise_shaping=0,ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 6:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 5:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 4:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 3:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=1,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 2:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=1,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 1:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=2,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 0:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=2,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break}}function be(ae){var ve=ae.internal_flags;ae.frameNum=0,ae.write_id3tag_automatic&&D.id3tag_write_v2(ae),ve.bitrate_stereoMode_Hist=s([16,5]),ve.bitrate_blockType_Hist=s([16,6]),ve.PeakSample=0,ae.bWriteVbrTag&&M.InitVbrTag(ae)}this.lame_init_params=function(ae){var ve=ae.internal_flags;if(ve.Class_ID=0,ve.ATH==null&&(ve.ATH=new h),ve.PSY==null&&(ve.PSY=new z),ve.rgdata==null&&(ve.rgdata=new f),ve.channels_in=ae.num_channels,ve.channels_in==1&&(ae.mode=y.MONO),ve.channels_out=ae.mode==y.MONO?1:2,ve.mode_ext=g.MPG_MD_MS_LR,ae.mode==y.MONO&&(ae.force_ms=!1),ae.VBR==n.vbr_off&&ae.VBR_mean_bitrate_kbps!=128&&ae.brate==0&&(ae.brate=ae.VBR_mean_bitrate_kbps),ae.VBR==n.vbr_off||ae.VBR==n.vbr_mtrh||ae.VBR==n.vbr_mt||(ae.free_format=!1),ae.VBR==n.vbr_off&&ae.brate==0&&p.EQ(ae.compression_ratio,0)&&(ae.compression_ratio=11.025),ae.VBR==n.vbr_off&&ae.compression_ratio>0&&(ae.out_samplerate==0&&(ae.out_samplerate=map2MP3Frequency(int(.97*ae.in_samplerate))),ae.brate=0|ae.out_samplerate*16*ve.channels_out/(1e3*ae.compression_ratio),ve.samplerate_index=Y(ae.out_samplerate,ae),ae.free_format||(ae.brate=Z(ae.brate,ae.version,ae.out_samplerate))),ae.out_samplerate!=0&&(ae.out_samplerate<16e3?(ae.VBR_mean_bitrate_kbps=Math.max(ae.VBR_mean_bitrate_kbps,8),ae.VBR_mean_bitrate_kbps=Math.min(ae.VBR_mean_bitrate_kbps,64)):ae.out_samplerate<32e3?(ae.VBR_mean_bitrate_kbps=Math.max(ae.VBR_mean_bitrate_kbps,8),ae.VBR_mean_bitrate_kbps=Math.min(ae.VBR_mean_bitrate_kbps,160)):(ae.VBR_mean_bitrate_kbps=Math.max(ae.VBR_mean_bitrate_kbps,32),ae.VBR_mean_bitrate_kbps=Math.min(ae.VBR_mean_bitrate_kbps,320))),ae.lowpassfreq==0){var we=16e3;switch(ae.VBR){case n.vbr_off:{var pe=new q;ie(pe,ae.brate),we=pe.lowerlimit;break}case n.vbr_abr:{var pe=new q;ie(pe,ae.VBR_mean_bitrate_kbps),we=pe.lowerlimit;break}case n.vbr_rh:{var ze=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=ae.VBR_q&&ae.VBR_q<=9){var Je=ze[ae.VBR_q],Xe=ze[ae.VBR_q+1],tt=ae.VBR_q_frac;we=linear_int(Je,Xe,tt)}else we=19500;break}default:{var ze=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=ae.VBR_q&&ae.VBR_q<=9){var Je=ze[ae.VBR_q],Xe=ze[ae.VBR_q+1],tt=ae.VBR_q_frac;we=linear_int(Je,Xe,tt)}else we=19500}}ae.mode==y.MONO&&(ae.VBR==n.vbr_off||ae.VBR==n.vbr_abr)&&(we*=1.5),ae.lowpassfreq=we|0}if(ae.out_samplerate==0&&(2*ae.lowpassfreq>ae.in_samplerate&&(ae.lowpassfreq=ae.in_samplerate/2),ae.out_samplerate=H(ae.lowpassfreq|0,ae.in_samplerate)),ae.lowpassfreq=Math.min(20500,ae.lowpassfreq),ae.lowpassfreq=Math.min(ae.out_samplerate/2,ae.lowpassfreq),ae.VBR==n.vbr_off&&(ae.compression_ratio=ae.out_samplerate*16*ve.channels_out/(1e3*ae.brate)),ae.VBR==n.vbr_abr&&(ae.compression_ratio=ae.out_samplerate*16*ve.channels_out/(1e3*ae.VBR_mean_bitrate_kbps)),ae.bWriteVbrTag||(ae.findReplayGain=!1,ae.decode_on_the_fly=!1,ve.findPeakSample=!1),ve.findReplayGain=ae.findReplayGain,ve.decode_on_the_fly=ae.decode_on_the_fly,ve.decode_on_the_fly&&(ve.findPeakSample=!0),ve.findReplayGain&&A.InitGainAnalysis(ve.rgdata,ae.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return ae.internal_flags=null,-6;switch(ve.decode_on_the_fly&&!ae.decode_only&&(ve.hip!=null&&O.hip_decode_exit(ve.hip),ve.hip=O.hip_decode_init()),ve.mode_gr=ae.out_samplerate<=24e3?1:2,ae.framesize=576*ve.mode_gr,ae.encoder_delay=g.ENCDELAY,ve.resample_ratio=ae.in_samplerate/ae.out_samplerate,ae.VBR){case n.vbr_mt:case n.vbr_rh:case n.vbr_mtrh:{var Nt=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];ae.compression_ratio=Nt[ae.VBR_q]}break;case n.vbr_abr:ae.compression_ratio=ae.out_samplerate*16*ve.channels_out/(1e3*ae.VBR_mean_bitrate_kbps);break;default:ae.compression_ratio=ae.out_samplerate*16*ve.channels_out/(1e3*ae.brate);break}if(ae.mode==y.NOT_SET&&(ae.mode=y.JOINT_STEREO),ae.highpassfreq>0?(ve.highpass1=2*ae.highpassfreq,ae.highpasswidth>=0?ve.highpass2=2*(ae.highpassfreq+ae.highpasswidth):ve.highpass2=2*ae.highpassfreq,ve.highpass1/=ae.out_samplerate,ve.highpass2/=ae.out_samplerate):(ve.highpass1=0,ve.highpass2=0),ae.lowpassfreq>0?(ve.lowpass2=2*ae.lowpassfreq,ae.lowpasswidth>=0?(ve.lowpass1=2*(ae.lowpassfreq-ae.lowpasswidth),ve.lowpass1<0&&(ve.lowpass1=0)):ve.lowpass1=2*ae.lowpassfreq,ve.lowpass1/=ae.out_samplerate,ve.lowpass2/=ae.out_samplerate):(ve.lowpass1=0,ve.lowpass2=0),ge(ae),ve.samplerate_index=Y(ae.out_samplerate,ae),ve.samplerate_index<0)return ae.internal_flags=null,-1;if(ae.VBR==n.vbr_off){if(ae.free_format)ve.bitrate_index=0;else if(ae.brate=Z(ae.brate,ae.version,ae.out_samplerate),ve.bitrate_index=Q(ae.brate,ae.version,ae.out_samplerate),ve.bitrate_index<=0)return ae.internal_flags=null,-1}else ve.bitrate_index=1;ae.analysis&&(ae.bWriteVbrTag=!1),ve.pinfo!=null&&(ae.bWriteVbrTag=!1),T.init_bit_stream_w(ve);for(var gt=ve.samplerate_index+3*ae.version+6*(ae.out_samplerate<16e3?1:0),wt=0;wt<g.SBMAX_l+1;wt++)ve.scalefac_band.l[wt]=L.sfBandIndex[gt].l[wt];for(var wt=0;wt<g.PSFB21+1;wt++){var Re=(ve.scalefac_band.l[22]-ve.scalefac_band.l[21])/g.PSFB21,se=ve.scalefac_band.l[21]+wt*Re;ve.scalefac_band.psfb21[wt]=se}ve.scalefac_band.psfb21[g.PSFB21]=576;for(var wt=0;wt<g.SBMAX_s+1;wt++)ve.scalefac_band.s[wt]=L.sfBandIndex[gt].s[wt];for(var wt=0;wt<g.PSFB12+1;wt++){var Re=(ve.scalefac_band.s[13]-ve.scalefac_band.s[12])/g.PSFB12,se=ve.scalefac_band.s[12]+wt*Re;ve.scalefac_band.psfb12[wt]=se}ve.scalefac_band.psfb12[g.PSFB12]=192,ae.version==1?ve.sideinfo_len=ve.channels_out==1?21:36:ve.sideinfo_len=ve.channels_out==1?13:21,ae.error_protection&&(ve.sideinfo_len+=2),be(ae),ve.Class_ID=K;{var W;for(W=0;W<19;W++)ve.nsPsy.pefirbuf[W]=700*ve.mode_gr*ve.channels_out;ae.ATHtype==-1&&(ae.ATHtype=4)}switch(a(ae.VBR_q<=9),a(ae.VBR_q>=0),ae.VBR){case n.vbr_mt:ae.VBR=n.vbr_mtrh;case n.vbr_mtrh:{ae.useTemporal==null&&(ae.useTemporal=!1),k.apply_preset(ae,500-ae.VBR_q*10,0),ae.quality<0&&(ae.quality=LAME_DEFAULT_QUALITY),ae.quality<5&&(ae.quality=0),ae.quality>5&&(ae.quality=5),ve.PSY.mask_adjust=ae.maskingadjust,ve.PSY.mask_adjust_short=ae.maskingadjust_short,ae.experimentalY?ve.sfb21_extra=!1:ve.sfb21_extra=ae.out_samplerate>44e3,ve.iteration_loop=new VBRNewIterationLoop(I);break}case n.vbr_rh:{k.apply_preset(ae,500-ae.VBR_q*10,0),ve.PSY.mask_adjust=ae.maskingadjust,ve.PSY.mask_adjust_short=ae.maskingadjust_short,ae.experimentalY?ve.sfb21_extra=!1:ve.sfb21_extra=ae.out_samplerate>44e3,ae.quality>6&&(ae.quality=6),ae.quality<0&&(ae.quality=LAME_DEFAULT_QUALITY),ve.iteration_loop=new VBROldIterationLoop(I);break}default:{var oe;ve.sfb21_extra=!1,ae.quality<0&&(ae.quality=LAME_DEFAULT_QUALITY),oe=ae.VBR,oe==n.vbr_off&&(ae.VBR_mean_bitrate_kbps=ae.brate),k.apply_preset(ae,ae.VBR_mean_bitrate_kbps,0),ae.VBR=oe,ve.PSY.mask_adjust=ae.maskingadjust,ve.PSY.mask_adjust_short=ae.maskingadjust_short,oe==n.vbr_off?ve.iteration_loop=new d(I):ve.iteration_loop=new ABRIterationLoop(I);break}}if(a(ae.scale>=0),ae.VBR!=n.vbr_off){if(ve.VBR_min_bitrate=1,ve.VBR_max_bitrate=14,ae.out_samplerate<16e3&&(ve.VBR_max_bitrate=8),ae.VBR_min_bitrate_kbps!=0&&(ae.VBR_min_bitrate_kbps=Z(ae.VBR_min_bitrate_kbps,ae.version,ae.out_samplerate),ve.VBR_min_bitrate=Q(ae.VBR_min_bitrate_kbps,ae.version,ae.out_samplerate),ve.VBR_min_bitrate<0)||ae.VBR_max_bitrate_kbps!=0&&(ae.VBR_max_bitrate_kbps=Z(ae.VBR_max_bitrate_kbps,ae.version,ae.out_samplerate),ve.VBR_max_bitrate=Q(ae.VBR_max_bitrate_kbps,ae.version,ae.out_samplerate),ve.VBR_max_bitrate<0))return-1;ae.VBR_min_bitrate_kbps=m.bitrate_table[ae.version][ve.VBR_min_bitrate],ae.VBR_max_bitrate_kbps=m.bitrate_table[ae.version][ve.VBR_max_bitrate],ae.VBR_mean_bitrate_kbps=Math.min(m.bitrate_table[ae.version][ve.VBR_max_bitrate],ae.VBR_mean_bitrate_kbps),ae.VBR_mean_bitrate_kbps=Math.max(m.bitrate_table[ae.version][ve.VBR_min_bitrate],ae.VBR_mean_bitrate_kbps)}return ae.tune&&(ve.PSY.mask_adjust+=ae.tune_value_a,ve.PSY.mask_adjust_short+=ae.tune_value_a),Te(ae),a(ae.scale>=0),ae.athaa_type<0?ve.ATH.useAdjust=3:ve.ATH.useAdjust=ae.athaa_type,ve.ATH.aaSensitivityP=Math.pow(10,ae.athaa_sensitivity/-10),ae.short_blocks==null&&(ae.short_blocks=r.short_block_allowed),ae.short_blocks==r.short_block_allowed&&(ae.mode==y.JOINT_STEREO||ae.mode==y.STEREO)&&(ae.short_blocks=r.short_block_coupled),ae.quant_comp<0&&(ae.quant_comp=1),ae.quant_comp_short<0&&(ae.quant_comp_short=0),ae.msfix<0&&(ae.msfix=0),ae.exp_nspsytune=ae.exp_nspsytune|1,ae.internal_flags.nsPsy.attackthre<0&&(ae.internal_flags.nsPsy.attackthre=c.NSATTACKTHRE),ae.internal_flags.nsPsy.attackthre_s<0&&(ae.internal_flags.nsPsy.attackthre_s=c.NSATTACKTHRE_S),a(ae.scale>=0),ae.scale<0&&(ae.scale=1),ae.ATHtype<0&&(ae.ATHtype=4),ae.ATHcurve<0&&(ae.ATHcurve=4),ae.athaa_loudapprox<0&&(ae.athaa_loudapprox=2),ae.interChRatio<0&&(ae.interChRatio=0),ae.useTemporal==null&&(ae.useTemporal=!0),ve.slot_lag=ve.frac_SpF=0,ae.VBR==n.vbr_off&&(ve.slot_lag=ve.frac_SpF=(ae.version+1)*72e3*ae.brate%ae.out_samplerate|0),L.iteration_init(ae),F.psymodel_init(ae),a(ae.scale>=0),0};function Pe(ae,ve){(ae.in_buffer_0==null||ae.in_buffer_nsamples<ve)&&(ae.in_buffer_0=i(ve),ae.in_buffer_1=i(ve),ae.in_buffer_nsamples=ve)}this.lame_encode_flush=function(ae,ve,we,pe){var ze=ae.internal_flags,Je=o([2,1152]),Xe=0,tt,Nt,gt,wt,Re=ze.mf_samples_to_encode-g.POSTDELAY,se=Ge(ae);if(ze.mf_samples_to_encode<1)return 0;for(tt=0,ae.in_samplerate!=ae.out_samplerate&&(Re+=16*ae.out_samplerate/ae.in_samplerate),gt=ae.framesize-Re%ae.framesize,gt<576&&(gt+=ae.framesize),ae.encoder_padding=gt,wt=(Re+gt)/ae.framesize;wt>0&&Xe>=0;){var W=se-ze.mf_size,oe=ae.frameNum;W*=ae.in_samplerate,W/=ae.out_samplerate,W>1152&&(W=1152),W<1&&(W=1),Nt=pe-tt,pe==0&&(Nt=0),Xe=this.lame_encode_buffer(ae,Je[0],Je[1],W,ve,we,Nt),we+=Xe,tt+=Xe,wt-=oe!=ae.frameNum?1:0}if(ze.mf_samples_to_encode=0,Xe<0||(Nt=pe-tt,pe==0&&(Nt=0),T.flush_bitstream(ae),Xe=T.copy_buffer(ze,ve,we,Nt,1),Xe<0))return Xe;if(we+=Xe,tt+=Xe,Nt=pe-tt,pe==0&&(Nt=0),ae.write_id3tag_automatic){if(D.id3tag_write_v1(ae),Xe=T.copy_buffer(ze,ve,we,Nt,0),Xe<0)return Xe;tt+=Xe}return tt},this.lame_encode_buffer=function(ae,ve,we,pe,ze,Je,Xe){var tt=ae.internal_flags,Nt=[null,null];if(tt.Class_ID!=K)return-3;if(pe==0)return 0;Pe(tt,pe),Nt[0]=tt.in_buffer_0,Nt[1]=tt.in_buffer_1;for(var gt=0;gt<pe;gt++)Nt[0][gt]=ve[gt],tt.channels_in>1&&(Nt[1][gt]=we[gt]);return Ze(ae,Nt[0],Nt[1],pe,ze,Je,Xe)};function Ge(ae){var ve=g.BLKSIZE+ae.framesize-g.FFTOFFSET;return ve=Math.max(ve,512+ae.framesize-32),ve}function Ze(ae,ve,we,pe,ze,Je,Xe){var tt=ae.internal_flags,Nt=0,gt,wt,Re,se,W,oe=[null,null],xe=[null,null];if(tt.Class_ID!=K)return-3;if(pe==0)return 0;if(W=T.copy_buffer(tt,ze,Je,Xe,0),W<0)return W;if(Je+=W,Nt+=W,xe[0]=ve,xe[1]=we,p.NEQ(ae.scale,0)&&p.NEQ(ae.scale,1))for(wt=0;wt<pe;++wt)xe[0][wt]*=ae.scale,tt.channels_out==2&&(xe[1][wt]*=ae.scale);if(p.NEQ(ae.scale_left,0)&&p.NEQ(ae.scale_left,1))for(wt=0;wt<pe;++wt)xe[0][wt]*=ae.scale_left;if(p.NEQ(ae.scale_right,0)&&p.NEQ(ae.scale_right,1))for(wt=0;wt<pe;++wt)xe[1][wt]*=ae.scale_right;if(ae.num_channels==2&&tt.channels_out==1)for(wt=0;wt<pe;++wt)xe[0][wt]=.5*(xe[0][wt]+xe[1][wt]),xe[1][wt]=0;se=Ge(ae),oe[0]=tt.mfbuf[0],oe[1]=tt.mfbuf[1];for(var Ce=0;pe>0;){var Se=[null,null],ye=0,Ke=0;Se[0]=xe[0],Se[1]=xe[1];var ke=new pt;if(Ie(ae,oe,Se,Ce,pe,ke),ye=ke.n_in,Ke=ke.n_out,tt.findReplayGain&&!tt.decode_on_the_fly&&A.AnalyzeSamples(tt.rgdata,oe[0],tt.mf_size,oe[1],tt.mf_size,Ke,tt.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(pe-=ye,Ce+=ye,tt.channels_out==2,tt.mf_size+=Ke,a(tt.mf_size<=u.MFSIZE),tt.mf_samples_to_encode<1&&(tt.mf_samples_to_encode=g.ENCDELAY+g.POSTDELAY),tt.mf_samples_to_encode+=Ke,tt.mf_size>=se){var He=Xe-Nt;if(Xe==0&&(He=0),gt=lt(ae,oe[0],oe[1],ze,Je,He),gt<0)return gt;for(Je+=gt,Nt+=gt,tt.mf_size-=ae.framesize,tt.mf_samples_to_encode-=ae.framesize,Re=0;Re<tt.channels_out;Re++)for(wt=0;wt<tt.mf_size;wt++)oe[Re][wt]=oe[Re][wt+ae.framesize]}}return Nt}function lt(ae,ve,we,pe,ze,Je){var Xe=v.enc.lame_encode_mp3_frame(ae,ve,we,pe,ze,Je);return ae.frameNum++,Xe}function pt(){this.n_in=0,this.n_out=0}function ne(){this.num_used=0}function Le(ae,ve){return ve!=0?Le(ve,ae%ve):ae}function Ve(ae,ve,we){var pe=Math.PI*ve;ae/=we,ae<0&&(ae=0),ae>1&&(ae=1);var ze=ae-.5,Je=.42-.5*Math.cos(2*ae*Math.PI)+.08*Math.cos(4*ae*Math.PI);return Math.abs(ze)<1e-9?pe/Math.PI:Je*Math.sin(we*pe*ze)/(Math.PI*we*ze)}function De(ae,ve,we,pe,ze,Je,Xe,tt,Nt){var gt=ae.internal_flags,wt,Re=0,se,W=ae.out_samplerate/Le(ae.out_samplerate,ae.in_samplerate);W>u.BPC&&(W=u.BPC);var oe=Math.abs(gt.resample_ratio-Math.floor(.5+gt.resample_ratio))<1e-4?1:0,xe=1/gt.resample_ratio;xe>1&&(xe=1);var Ce=31;Ce%2==0&&--Ce,Ce+=oe;var Se=Ce+1;if(gt.fill_buffer_resample_init==0){for(gt.inbuf_old[0]=i(Se),gt.inbuf_old[1]=i(Se),wt=0;wt<=2*W;++wt)gt.blackfilt[wt]=i(Se);for(gt.itime[0]=0,gt.itime[1]=0,Re=0;Re<=2*W;Re++){var ye=0,Ke=(Re-W)/(2*W);for(wt=0;wt<=Ce;wt++)ye+=gt.blackfilt[Re][wt]=Ve(wt-Ke,xe,Ce);for(wt=0;wt<=Ce;wt++)gt.blackfilt[Re][wt]/=ye}gt.fill_buffer_resample_init=1}var ke=gt.inbuf_old[Nt];for(se=0;se<pe;se++){var He,Fe;if(He=se*gt.resample_ratio,Re=0|Math.floor(He-gt.itime[Nt]),Ce+Re-Ce/2>=Xe)break;var Ke=He-gt.itime[Nt]-(Re+.5*(Ce%2));Fe=0|Math.floor(Ke*2*W+W+.5);var We=0;for(wt=0;wt<=Ce;++wt){var at=0|wt+Re-Ce/2,Be;Be=at<0?ke[Se+at]:ze[Je+at],We+=Be*gt.blackfilt[Fe][wt]}ve[we+se]=We}if(tt.num_used=Math.min(Xe,Ce+Re-Ce/2),gt.itime[Nt]+=tt.num_used-se*gt.resample_ratio,tt.num_used>=Se)for(wt=0;wt<Se;wt++)ke[wt]=ze[Je+tt.num_used+wt-Se];else{var nt=Se-tt.num_used;for(wt=0;wt<nt;++wt)ke[wt]=ke[wt+tt.num_used];for(Re=0;wt<Se;++wt,++Re)ke[wt]=ze[Je+Re];a(Re==tt.num_used)}return se}function Ie(ae,ve,we,pe,ze,Je){var Xe=ae.internal_flags;if(Xe.resample_ratio<.9999||Xe.resample_ratio>1.0001)for(var tt=0;tt<Xe.channels_out;tt++){var Nt=new ne;Je.n_out=De(ae,ve[tt],Xe.mf_size,ae.framesize,we[tt],pe,ze,Nt,tt),Je.n_in=Nt.num_used}else{Je.n_out=Math.min(ae.framesize,ze),Je.n_in=Je.n_out;for(var gt=0;gt<Je.n_out;++gt)ve[0][Xe.mf_size+gt]=we[0][pe+gt],Xe.channels_out==2&&(ve[1][Xe.mf_size+gt]=we[1][pe+gt])}}}return L2=_,L2}var l7e=Mo,rm=l7e.VbrMode;function u7e(){var t=vU();function e(u,h,f,d,p,m,g,_,y,v,E,x,A,T,k){this.vbr_q=u,this.quant_comp=h,this.quant_comp_s=f,this.expY=d,this.st_lrm=p,this.st_s=m,this.masking_adj=g,this.masking_adj_short=_,this.ath_lower=y,this.ath_curve=v,this.ath_sensitivity=E,this.interch=x,this.safejoint=A,this.sfb21mod=T,this.msfix=k}function n(u,h,f,d,p,m,g,_,y,v,E,x,A,T){this.quant_comp=h,this.quant_comp_s=f,this.safejoint=d,this.nsmsfix=p,this.st_lrm=m,this.st_s=g,this.nsbass=_,this.scale=y,this.masking_adj=v,this.ath_lower=E,this.ath_curve=x,this.interch=A,this.sfscale=T}var r;this.setModules=function(u){r=u};var i=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function o(u,h,f){var d=u.VBR==rm.vbr_rh?i:s,p=u.VBR_q_frac,m=d[h],g=d[h+1],_=m;m.st_lrm=m.st_lrm+p*(g.st_lrm-m.st_lrm),m.st_s=m.st_s+p*(g.st_s-m.st_s),m.masking_adj=m.masking_adj+p*(g.masking_adj-m.masking_adj),m.masking_adj_short=m.masking_adj_short+p*(g.masking_adj_short-m.masking_adj_short),m.ath_lower=m.ath_lower+p*(g.ath_lower-m.ath_lower),m.ath_curve=m.ath_curve+p*(g.ath_curve-m.ath_curve),m.ath_sensitivity=m.ath_sensitivity+p*(g.ath_sensitivity-m.ath_sensitivity),m.interch=m.interch+p*(g.interch-m.interch),m.msfix=m.msfix+p*(g.msfix-m.msfix),l(u,_.vbr_q),f!=0?u.quant_comp=_.quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=_.quant_comp),f!=0?u.quant_comp_short=_.quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=_.quant_comp_s),_.expY!=0&&(u.experimentalY=_.expY!=0),f!=0?u.internal_flags.nsPsy.attackthre=_.st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=_.st_lrm),f!=0?u.internal_flags.nsPsy.attackthre_s=_.st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=_.st_s),f!=0?u.maskingadjust=_.masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=_.masking_adj),f!=0?u.maskingadjust_short=_.masking_adj_short:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=_.masking_adj_short),f!=0?u.ATHlower=-_.ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-_.ath_lower/10),f!=0?u.ATHcurve=_.ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=_.ath_curve),f!=0?u.athaa_sensitivity=_.ath_sensitivity:Math.abs(u.athaa_sensitivity- -1)>0||(u.athaa_sensitivity=_.ath_sensitivity),_.interch>0&&(f!=0?u.interChRatio=_.interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=_.interch)),_.safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|_.safejoint),_.sfb21mod>0&&(u.exp_nspsytune=u.exp_nspsytune|_.sfb21mod<<20),f!=0?u.msfix=_.msfix:Math.abs(u.msfix- -1)>0||(u.msfix=_.msfix),f==0&&(u.VBR_q=h,u.VBR_q_frac=p)}var a=[new n(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new n(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new n(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new n(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new n(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new n(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new n(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new n(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new n(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new n(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new n(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new n(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new n(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new n(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new n(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function c(u,h,f){var d=h,p=r.nearestBitrateFullIndex(h);if(u.VBR=rm.vbr_abr,u.VBR_mean_bitrate_kbps=d,u.VBR_mean_bitrate_kbps=Math.min(u.VBR_mean_bitrate_kbps,320),u.VBR_mean_bitrate_kbps=Math.max(u.VBR_mean_bitrate_kbps,8),u.brate=u.VBR_mean_bitrate_kbps,u.VBR_mean_bitrate_kbps>320&&(u.disable_reservoir=!0),a[p].safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|2),a[p].sfscale>0&&(u.internal_flags.noise_shaping=2),Math.abs(a[p].nsbass)>0){var m=int(a[p].nsbass*4);m<0&&(m+=64),u.exp_nspsytune=u.exp_nspsytune|m<<2}return f!=0?u.quant_comp=a[p].quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=a[p].quant_comp),f!=0?u.quant_comp_short=a[p].quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=a[p].quant_comp_s),f!=0?u.msfix=a[p].nsmsfix:Math.abs(u.msfix- -1)>0||(u.msfix=a[p].nsmsfix),f!=0?u.internal_flags.nsPsy.attackthre=a[p].st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=a[p].st_lrm),f!=0?u.internal_flags.nsPsy.attackthre_s=a[p].st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=a[p].st_s),f!=0?u.scale=a[p].scale:Math.abs(u.scale- -1)>0||(u.scale=a[p].scale),f!=0?u.maskingadjust=a[p].masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=a[p].masking_adj),a[p].masking_adj>0?f!=0?u.maskingadjust_short=a[p].masking_adj*.9:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[p].masking_adj*.9):f!=0?u.maskingadjust_short=a[p].masking_adj*1.1:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[p].masking_adj*1.1),f!=0?u.ATHlower=-a[p].ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-a[p].ath_lower/10),f!=0?u.ATHcurve=a[p].ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=a[p].ath_curve),f!=0?u.interChRatio=a[p].interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=a[p].interch),h}this.apply_preset=function(u,h,f){switch(h){case t.R3MIX:{h=t.V3,u.VBR=rm.vbr_mtrh;break}case t.MEDIUM:{h=t.V4,u.VBR=rm.vbr_rh;break}case t.MEDIUM_FAST:{h=t.V4,u.VBR=rm.vbr_mtrh;break}case t.STANDARD:{h=t.V2,u.VBR=rm.vbr_rh;break}case t.STANDARD_FAST:{h=t.V2,u.VBR=rm.vbr_mtrh;break}case t.EXTREME:{h=t.V0,u.VBR=rm.vbr_rh;break}case t.EXTREME_FAST:{h=t.V0,u.VBR=rm.vbr_mtrh;break}case t.INSANE:return h=320,u.preset=h,c(u,h,f),u.VBR=rm.vbr_off,h}switch(u.preset=h,h){case t.V9:return o(u,9,f),h;case t.V8:return o(u,8,f),h;case t.V7:return o(u,7,f),h;case t.V6:return o(u,6,f),h;case t.V5:return o(u,5,f),h;case t.V4:return o(u,4,f),h;case t.V3:return o(u,3,f),h;case t.V2:return o(u,2,f),h;case t.V1:return o(u,1,f),h;case t.V0:return o(u,0,f),h}return 8<=h&&h<=320?c(u,h,f):(u.preset=0,h)};function l(u,h){var f=0;return 0>h&&(f=-1,h=0),9<h&&(f=-1,h=9),u.VBR_q=h,u.VBR_q_frac=0,f}}var h7e=u7e;function f7e(){this.setModules=function(t,e){}}var d7e=f7e;function p7e(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var m7e=p7e,tre=Mo,eG=tre.new_float,g7e=tre.new_int;function _7e(){this.global_gain=0,this.sfb_count1=0,this.step=g7e(39),this.noise=eG(39),this.noise_log=eG(39)}var v7e=_7e,gx=Mo,$_=gx.System,tG=gx.VbrMode,U2=gx.Util,MS=gx.Arrays,lT=gx.new_float,uT=gx.assert,y7e=d7e,B2=m7e,b7e=v7e,Gi=Fl(),nG=dU,rG=zI;function S7e(){var t;this.rv=null;var e;this.qupvt=null;var n,r=new y7e,i;this.setModules=function(_,y,v,E){t=_,e=y,this.rv=y,n=v,this.qupvt=v,i=E,r.setModules(n,i)},this.ms_convert=function(_,y){for(var v=0;v<576;++v){var E=_.tt[y][0].xr[v],x=_.tt[y][1].xr[v];_.tt[y][0].xr[v]=(E+x)*(U2.SQRT2*.5),_.tt[y][1].xr[v]=(E-x)*(U2.SQRT2*.5)}};function s(_,y,v,E){E=0;for(var x=0;x<=v;++x){var A=Math.abs(_.xr[x]);E+=A,y[x]=Math.sqrt(A*Math.sqrt(A)),y[x]>_.xrpow_max&&(_.xrpow_max=y[x])}return E}this.init_xrpow=function(_,y,v){var E=0,x=0|y.max_nonzero_coeff;if(y.xrpow_max=0,MS.fill(v,x,576,0),E=s(y,v,x,E),E>1e-20){var A=0;_.substep_shaping&2&&(A=1);for(var T=0;T<y.psymax;T++)_.pseudohalf[T]=A;return!0}return MS.fill(y.l3_enc,0,576,0),!1};function o(_,y){var v=_.ATH,E=y.xr;if(y.block_type!=Gi.SHORT_TYPE)for(var x=!1,A=Gi.PSFB21-1;A>=0&&!x;A--){var T=_.scalefac_band.psfb21[A],k=_.scalefac_band.psfb21[A+1],L=n.athAdjust(v.adjust,v.psfb21[A],v.floor);_.nsPsy.longfact[21]>1e-12&&(L*=_.nsPsy.longfact[21]);for(var I=k-1;I>=T;I--)if(Math.abs(E[I])<L)E[I]=0;else{x=!0;break}}else for(var F=0;F<3;F++)for(var x=!1,A=Gi.PSFB12-1;A>=0&&!x;A--){var T=_.scalefac_band.s[12]*3+(_.scalefac_band.s[13]-_.scalefac_band.s[12])*F+(_.scalefac_band.psfb12[A]-_.scalefac_band.psfb12[0]),k=T+(_.scalefac_band.psfb12[A+1]-_.scalefac_band.psfb12[A]),M=n.athAdjust(v.adjust,v.psfb12[A],v.floor);_.nsPsy.shortfact[12]>1e-12&&(M*=_.nsPsy.shortfact[12]);for(var I=k-1;I>=T;I--)if(Math.abs(E[I])<M)E[I]=0;else{x=!0;break}}}this.init_outer_loop=function(_,y){y.part2_3_length=0,y.big_values=0,y.count1=0,y.global_gain=210,y.scalefac_compress=0,y.table_select[0]=0,y.table_select[1]=0,y.table_select[2]=0,y.subblock_gain[0]=0,y.subblock_gain[1]=0,y.subblock_gain[2]=0,y.subblock_gain[3]=0,y.region0_count=0,y.region1_count=0,y.preflag=0,y.scalefac_scale=0,y.count1table_select=0,y.part2_length=0,y.sfb_lmax=Gi.SBPSY_l,y.sfb_smin=Gi.SBPSY_s,y.psy_lmax=_.sfb21_extra?Gi.SBMAX_l:Gi.SBPSY_l,y.psymax=y.psy_lmax,y.sfbmax=y.sfb_lmax,y.sfbdivide=11;for(var v=0;v<Gi.SBMAX_l;v++)y.width[v]=_.scalefac_band.l[v+1]-_.scalefac_band.l[v],y.window[v]=3;if(y.block_type==Gi.SHORT_TYPE){var E=lT(576);y.sfb_smin=0,y.sfb_lmax=0,y.mixed_block_flag!=0&&(y.sfb_smin=3,y.sfb_lmax=_.mode_gr*2+4),y.psymax=y.sfb_lmax+3*((_.sfb21_extra?Gi.SBMAX_s:Gi.SBPSY_s)-y.sfb_smin),y.sfbmax=y.sfb_lmax+3*(Gi.SBPSY_s-y.sfb_smin),y.sfbdivide=y.sfbmax-18,y.psy_lmax=y.sfb_lmax;var x=_.scalefac_band.l[y.sfb_lmax];$_.arraycopy(y.xr,0,E,0,576);for(var v=y.sfb_smin;v<Gi.SBMAX_s;v++)for(var A=_.scalefac_band.s[v],T=_.scalefac_band.s[v+1],k=0;k<3;k++)for(var L=A;L<T;L++)y.xr[x++]=E[3*L+k];for(var I=y.sfb_lmax,v=y.sfb_smin;v<Gi.SBMAX_s;v++)y.width[I]=y.width[I+1]=y.width[I+2]=_.scalefac_band.s[v+1]-_.scalefac_band.s[v],y.window[I]=0,y.window[I+1]=1,y.window[I+2]=2,I+=3}y.count1bits=0,y.sfb_partition_table=n.nr_of_sfb_block[0][0],y.slen[0]=0,y.slen[1]=0,y.slen[2]=0,y.slen[3]=0,y.max_nonzero_coeff=575,MS.fill(y.scalefac,0),o(_,y)};function a(_){this.ordinal=_}a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2);function c(_,y,v,E,x){var A,T=_.CurrentStep[E],k=!1,L=_.OldValue[E],I=a.BINSEARCH_NONE;for(y.global_gain=L,v-=y.part2_length;;){var F;if(A=i.count_bits(_,x,y,null),T==1||A==v)break;A>v?(I==a.BINSEARCH_DOWN&&(k=!0),k&&(T/=2),I=a.BINSEARCH_UP,F=T):(I==a.BINSEARCH_UP&&(k=!0),k&&(T/=2),I=a.BINSEARCH_DOWN,F=-T),y.global_gain+=F,y.global_gain<0&&(y.global_gain=0,k=!0),y.global_gain>255&&(y.global_gain=255,k=!0)}for(uT(y.global_gain>=0),uT(y.global_gain<256);A>v&&y.global_gain<255;)y.global_gain++,A=i.count_bits(_,x,y,null);return _.CurrentStep[E]=L-y.global_gain>=4?4:2,_.OldValue[E]=y.global_gain,y.part2_3_length=A,A}this.trancate_smallspectrums=function(_,y,v,E){var x=lT(rG.SFBMAX);if(!(!(_.substep_shaping&4)&&y.block_type==Gi.SHORT_TYPE||_.substep_shaping&128)){n.calc_noise(y,v,x,new B2,null);for(var T=0;T<576;T++){var A=0;y.l3_enc[T]!=0&&(A=Math.abs(y.xr[T])),E[T]=A}var T=0,k=8;y.block_type==Gi.SHORT_TYPE&&(k=6);do{var L,I,F,M,D=y.width[k];if(T+=D,!(x[k]>=1)&&(MS.sort(E,T-D,D),!BitStream.EQ(E[T-1],0))){L=(1-x[k])*v[k],I=0,M=0;do{var O;for(F=1;M+F<D&&!BitStream.NEQ(E[M+T-D],E[M+T+F-D]);F++);if(O=E[M+T-D]*E[M+T-D]*F,L<O){M!=0&&(I=E[M+T-D-1]);break}L-=O,M+=F}while(M<D);if(!BitStream.EQ(I,0))do Math.abs(y.xr[T-D])<=I&&(y.l3_enc[T-D]=0);while(--D>0)}}while(++k<y.psymax);y.part2_3_length=i.noquant_count_bits(_,y,null)}};function l(_){for(var y=0;y<_.sfbmax;y++)if(_.scalefac[y]+_.subblock_gain[_.window[y]]==0)return!1;return!0}function u(_){return U2.FAST_LOG10(.368+.632*_*_*_)}function h(_,y){for(var v=1e-37,E=0;E<y.psymax;E++)v+=u(_[E]);return Math.max(1e-20,v)}function f(_,y,v,E,x){var A;switch(_){default:case 9:{y.over_count>0?(A=v.over_SSD<=y.over_SSD,v.over_SSD==y.over_SSD&&(A=v.bits<y.bits)):A=v.max_noise<0&&v.max_noise*10+v.bits<=y.max_noise*10+y.bits;break}case 0:A=v.over_count<y.over_count||v.over_count==y.over_count&&v.over_noise<y.over_noise||v.over_count==y.over_count&&BitStream.EQ(v.over_noise,y.over_noise)&&v.tot_noise<y.tot_noise;break;case 8:v.max_noise=h(x,E);case 1:A=v.max_noise<y.max_noise;break;case 2:A=v.tot_noise<y.tot_noise;break;case 3:A=v.tot_noise<y.tot_noise&&v.max_noise<y.max_noise;break;case 4:A=v.max_noise<=0&&y.max_noise>.2||v.max_noise<=0&&y.max_noise<0&&y.max_noise>v.max_noise-.2&&v.tot_noise<y.tot_noise||v.max_noise<=0&&y.max_noise>0&&y.max_noise>v.max_noise-.2&&v.tot_noise<y.tot_noise+y.over_noise||v.max_noise>0&&y.max_noise>-.05&&y.max_noise>v.max_noise-.1&&v.tot_noise+v.over_noise<y.tot_noise+y.over_noise||v.max_noise>0&&y.max_noise>-.1&&y.max_noise>v.max_noise-.15&&v.tot_noise+v.over_noise+v.over_noise<y.tot_noise+y.over_noise+y.over_noise;break;case 5:A=v.over_noise<y.over_noise||BitStream.EQ(v.over_noise,y.over_noise)&&v.tot_noise<y.tot_noise;break;case 6:A=v.over_noise<y.over_noise||BitStream.EQ(v.over_noise,y.over_noise)&&(v.max_noise<y.max_noise||BitStream.EQ(v.max_noise,y.max_noise)&&v.tot_noise<=y.tot_noise);break;case 7:A=v.over_count<y.over_count||v.over_noise<y.over_noise;break}return y.over_count==0&&(A=A&&v.bits<y.bits),A}function d(_,y,v,E,x){var A=_.internal_flags,T;y.scalefac_scale==0?T=1.2968395546510096:T=1.6817928305074292;for(var k=0,L=0;L<y.sfbmax;L++)k<v[L]&&(k=v[L]);var I=A.noise_shaping_amp;switch(I==3&&(x?I=2:I=1),I){case 2:break;case 1:k>1?k=Math.pow(k,.5):k*=.95;break;default:k>1?k=1:k*=.95;break}for(var F=0,L=0;L<y.sfbmax;L++){var M=y.width[L],D;if(F+=M,!(v[L]<k)){if(A.substep_shaping&2&&(A.pseudohalf[L]=A.pseudohalf[L]==0?1:0,A.pseudohalf[L]==0&&A.noise_shaping_amp==2))return;for(y.scalefac[L]++,D=-M;D<0;D++)E[F+D]*=T,E[F+D]>y.xrpow_max&&(y.xrpow_max=E[F+D]);if(A.noise_shaping_amp==2)return}}}function p(_,y){for(var v=1.2968395546510096,E=0,x=0;x<_.sfbmax;x++){var A=_.width[x],T=_.scalefac[x];if(_.preflag!=0&&(T+=n.pretab[x]),E+=A,T&1){T++;for(var k=-A;k<0;k++)y[E+k]*=v,y[E+k]>_.xrpow_max&&(_.xrpow_max=y[E+k])}_.scalefac[x]=T>>1}_.preflag=0,_.scalefac_scale=1}function m(_,y,v){var E,x=y.scalefac;for(E=0;E<y.sfb_lmax;E++)if(x[E]>=16)return!0;for(var A=0;A<3;A++){var T=0,k=0;for(E=y.sfb_lmax+A;E<y.sfbdivide;E+=3)T<x[E]&&(T=x[E]);for(;E<y.sfbmax;E+=3)k<x[E]&&(k=x[E]);if(!(T<16&&k<8)){if(y.subblock_gain[A]>=7)return!0;y.subblock_gain[A]++;var L=_.scalefac_band.l[y.sfb_lmax];for(E=y.sfb_lmax+A;E<y.sfbmax;E+=3){var I,F=y.width[E],M=x[E];if(M=M-(4>>y.scalefac_scale),M>=0){x[E]=M,L+=F*3;continue}x[E]=0;{var D=210+(M<<y.scalefac_scale+1);I=n.IPOW20(D)}L+=F*(A+1);for(var O=-F;O<0;O++)v[L+O]*=I,v[L+O]>y.xrpow_max&&(y.xrpow_max=v[L+O]);L+=F*(3-A-1)}{var I=n.IPOW20(202);L+=y.width[E]*(A+1);for(var O=-y.width[E];O<0;O++)v[L+O]*=I,v[L+O]>y.xrpow_max&&(y.xrpow_max=v[L+O])}}}return!1}function g(_,y,v,E,x){var A=_.internal_flags;d(_,y,v,E,x);var T=l(y);return T?!1:(A.mode_gr==2?T=i.scale_bitcount(y):T=i.scale_bitcount_lsf(A,y),T?(A.noise_shaping>1&&(MS.fill(A.pseudohalf,0),y.scalefac_scale==0?(p(y,E),T=!1):y.block_type==Gi.SHORT_TYPE&&A.subblock_gain>0&&(T=m(A,y,E)||l(y))),T||(A.mode_gr==2?T=i.scale_bitcount(y):T=i.scale_bitcount_lsf(A,y)),!T):!0)}this.outer_loop=function(_,y,v,E,x,A){var T=_.internal_flags,k=new nG,L=lT(576),I=lT(rG.SFBMAX),F=new B2,M,D=new b7e,O=9999999,z=!1,q=!1,G=0;if(c(T,y,A,x,E),T.noise_shaping==0)return 100;n.calc_noise(y,v,I,F,D),F.bits=y.part2_3_length,k.assign(y);var K=0;for($_.arraycopy(E,0,L,0,576);!z;){do{var te=new B2,re,H=255;if(T.substep_shaping&2?re=20:re=3,T.sfb21_extra&&(I[k.sfbmax]>1||k.block_type==Gi.SHORT_TYPE&&(I[k.sfbmax+1]>1||I[k.sfbmax+2]>1))||!g(_,k,I,E,q))break;k.scalefac_scale!=0&&(H=254);var Y=A-k.part2_length;if(Y<=0)break;for(;(k.part2_3_length=i.count_bits(T,E,k,D))>Y&&k.global_gain<=H;)k.global_gain++;if(k.global_gain>H)break;if(F.over_count==0){for(;(k.part2_3_length=i.count_bits(T,E,k,D))>O&&k.global_gain<=H;)k.global_gain++;if(k.global_gain>H)break}if(n.calc_noise(k,v,I,te,D),te.bits=k.part2_3_length,y.block_type!=Gi.SHORT_TYPE?M=_.quant_comp:M=_.quant_comp_short,M=f(M,F,te,k,I)?1:0,M!=0)O=y.part2_3_length,F=te,y.assign(k),K=0,$_.arraycopy(E,0,L,0,576);else if(T.full_outer_loop==0&&(++K>re&&F.over_count==0||T.noise_shaping_amp==3&&q&&K>30||T.noise_shaping_amp==3&&q&&k.global_gain-G>15))break}while(k.global_gain+k.scalefac_scale<255);T.noise_shaping_amp==3?q?z=!0:(k.assign(y),$_.arraycopy(L,0,E,0,576),K=0,G=k.global_gain,q=!0):z=!0}return uT(y.global_gain+y.scalefac_scale<=255),_.VBR==tG.vbr_rh||_.VBR==tG.vbr_mtrh?$_.arraycopy(L,0,E,0,576):T.substep_shaping&1&&trancate_smallspectrums(T,y,v,E),F.over_count},this.iteration_finish_one=function(_,y,v){var E=_.l3_side,x=E.tt[y][v];i.best_scalefac_store(_,y,v,E),_.use_best_huffman==1&&i.best_huffman_divide(_,x),e.ResvAdjust(_,x)},this.VBR_encode_granule=function(_,y,v,E,x,A,T){var k=_.internal_flags,L=new nG,I=lT(576),F=T,M=T+1,D=(T+A)/2,O,z,q=0,G=k.sfb21_extra;uT(F<=LameInternalFlags.MAX_BITS_PER_CHANNEL),MS.fill(L.l3_enc,0);do D>F-42?k.sfb21_extra=!1:k.sfb21_extra=G,z=outer_loop(_,y,v,E,x,D),z<=0?(q=1,M=y.part2_3_length,L.assign(y),$_.arraycopy(E,0,I,0,576),T=M-32,O=T-A,D=(T+A)/2):(A=D+32,O=T-A,D=(T+A)/2,q!=0&&(q=2,y.assign(L),$_.arraycopy(I,0,E,0,576)));while(O>12);k.sfb21_extra=G,q==2&&$_.arraycopy(L.l3_enc,0,y.l3_enc,0,576),uT(y.part2_3_length<=F)},this.get_framebits=function(_,y){var v=_.internal_flags;v.bitrate_index=v.VBR_min_bitrate;var E=t.getframebits(_);v.bitrate_index=1,E=t.getframebits(_);for(var x=1;x<=v.VBR_max_bitrate;x++){v.bitrate_index=x;var A=new MeanBits(E);y[x]=e.ResvFrameBegin(_,A),E=A.bits}},this.VBR_old_prepare=function(_,y,v,E,x,A,T,k,L){var I=_.internal_flags,F,M=0,D=1,O=0;I.bitrate_index=I.VBR_max_bitrate;var z=e.ResvFrameBegin(_,new MeanBits(0))/I.mode_gr;get_framebits(_,A);for(var q=0;q<I.mode_gr;q++){var G=n.on_pe(_,y,k[q],z,q,0);I.mode_ext==Gi.MPG_MD_MS_LR&&(ms_convert(I.l3_side,q),n.reduce_side(k[q],v[q],z,G));for(var K=0;K<I.channels_out;++K){var te=I.l3_side.tt[q][K];te.block_type!=Gi.SHORT_TYPE?(M=1.28/(1+Math.exp(3.5-y[q][K]/300))-.05,F=I.PSY.mask_adjust-M):(M=2.56/(1+Math.exp(3.5-y[q][K]/300))-.14,F=I.PSY.mask_adjust_short-M),I.masking_lower=Math.pow(10,F*.1),init_outer_loop(I,te),L[q][K]=n.calc_xmin(_,E[q][K],te,x[q][K]),L[q][K]!=0&&(D=0),T[q][K]=126,O+=k[q][K]}}for(var q=0;q<I.mode_gr;q++)for(var K=0;K<I.channels_out;K++)O>A[I.VBR_max_bitrate]&&(k[q][K]*=A[I.VBR_max_bitrate],k[q][K]/=O),T[q][K]>k[q][K]&&(T[q][K]=k[q][K]);return D},this.bitpressure_strategy=function(_,y,v,E){for(var x=0;x<_.mode_gr;x++)for(var A=0;A<_.channels_out;A++){for(var T=_.l3_side.tt[x][A],k=y[x][A],L=0,I=0;I<T.psy_lmax;I++)k[L++]*=1+.029*I*I/Gi.SBMAX_l/Gi.SBMAX_l;if(T.block_type==Gi.SHORT_TYPE)for(var I=T.sfb_smin;I<Gi.SBMAX_s;I++)k[L++]*=1+.029*I*I/Gi.SBMAX_s/Gi.SBMAX_s,k[L++]*=1+.029*I*I/Gi.SBMAX_s/Gi.SBMAX_s,k[L++]*=1+.029*I*I/Gi.SBMAX_s/Gi.SBMAX_s;E[x][A]=0|Math.max(v[x][A],.9*E[x][A])}},this.VBR_new_prepare=function(_,y,v,E,x,A){var T=_.internal_flags,k=1,L=0,I=0,F;if(_.free_format){T.bitrate_index=0;var M=new MeanBits(L);F=e.ResvFrameBegin(_,M),L=M.bits,x[0]=F}else{T.bitrate_index=T.VBR_max_bitrate;var M=new MeanBits(L);e.ResvFrameBegin(_,M),L=M.bits,get_framebits(_,x),F=x[T.VBR_max_bitrate]}for(var D=0;D<T.mode_gr;D++){n.on_pe(_,y,A[D],L,D,0),T.mode_ext==Gi.MPG_MD_MS_LR&&ms_convert(T.l3_side,D);for(var O=0;O<T.channels_out;++O){var z=T.l3_side.tt[D][O];T.masking_lower=Math.pow(10,T.PSY.mask_adjust*.1),init_outer_loop(T,z),n.calc_xmin(_,v[D][O],z,E[D][O])!=0&&(k=0),I+=A[D][O]}}for(var D=0;D<T.mode_gr;D++)for(var O=0;O<T.channels_out;O++)I>F&&(A[D][O]*=F,A[D][O]/=I);return k},this.calc_target_bits=function(_,y,v,E,x,A){var T=_.internal_flags,k=T.l3_side,L,I,F,M,D=0;T.bitrate_index=T.VBR_max_bitrate;var O=new MeanBits(D);for(A[0]=e.ResvFrameBegin(_,O),D=O.bits,T.bitrate_index=1,D=t.getframebits(_)-T.sideinfo_len*8,x[0]=D/(T.mode_gr*T.channels_out),D=_.VBR_mean_bitrate_kbps*_.framesize*1e3,T.substep_shaping&1&&(D*=1.09),D/=_.out_samplerate,D-=T.sideinfo_len*8,D/=T.mode_gr*T.channels_out,L=.93+.07*(11-_.compression_ratio)/(11-5.5),L<.9&&(L=.9),L>1&&(L=1),I=0;I<T.mode_gr;I++){var z=0;for(F=0;F<T.channels_out;F++){if(E[I][F]=int(L*D),y[I][F]>700){var q=int((y[I][F]-700)/1.4),G=k.tt[I][F];E[I][F]=int(L*D),G.block_type==Gi.SHORT_TYPE&&q<D/2&&(q=D/2),q>D*3/2?q=D*3/2:q<0&&(q=0),E[I][F]+=q}E[I][F]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(E[I][F]=LameInternalFlags.MAX_BITS_PER_CHANNEL),z+=E[I][F]}if(z>LameInternalFlags.MAX_BITS_PER_GRANULE)for(F=0;F<T.channels_out;++F)E[I][F]*=LameInternalFlags.MAX_BITS_PER_GRANULE,E[I][F]/=z}if(T.mode_ext==Gi.MPG_MD_MS_LR)for(I=0;I<T.mode_gr;I++)n.reduce_side(E[I],v[I],D*T.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(M=0,I=0;I<T.mode_gr;I++)for(F=0;F<T.channels_out;F++)E[I][F]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(E[I][F]=LameInternalFlags.MAX_BITS_PER_CHANNEL),M+=E[I][F];if(M>A[0])for(I=0;I<T.mode_gr;I++)for(F=0;F<T.channels_out;F++)E[I][F]*=A[0],E[I][F]/=M}}var E7e=S7e,x7e=Mo,iG=x7e.assert;function w7e(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(e,n){var r=e.internal_flags,i,s=r.l3_side,o=t.getframebits(e);n.bits=(o-r.sideinfo_len*8)/r.mode_gr;var a=8*256*r.mode_gr-8;e.brate>320?i=8*int(e.brate*1e3/(e.out_samplerate/1152)/8+.5):(i=8*1440,e.strict_ISO&&(i=8*int(32e4/(e.out_samplerate/1152)/8+.5))),r.ResvMax=i-o,r.ResvMax>a&&(r.ResvMax=a),(r.ResvMax<0||e.disable_reservoir)&&(r.ResvMax=0);var c=n.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return c>i&&(c=i),iG(r.ResvMax%8==0),iG(r.ResvMax>=0),s.resvDrain_pre=0,r.pinfo!=null&&(r.pinfo.mean_bits=n.bits/2,r.pinfo.resvsize=r.ResvSize),c},this.ResvMaxBits=function(e,n,r,i){var s=e.internal_flags,o,a=s.ResvSize,c=s.ResvMax;i!=0&&(a+=n),s.substep_shaping&1&&(c*=.9),r.bits=n,a*10>c*9?(o=a-c*9/10,r.bits+=o,s.substep_shaping|=128):(o=0,s.substep_shaping&=127,!e.disable_reservoir&&!(s.substep_shaping&1)&&(r.bits-=.1*n));var l=a<s.ResvMax*6/10?a:s.ResvMax*6/10;return l-=o,l<0&&(l=0),l},this.ResvAdjust=function(e,n){e.ResvSize-=n.part2_3_length+n.part2_length},this.ResvFrameEnd=function(e,n){var r,i=e.l3_side;e.ResvSize+=n*e.mode_gr;var s=0;i.resvDrain_post=0,i.resvDrain_pre=0,(r=e.ResvSize%8)!=0&&(s+=r),r=e.ResvSize-s-e.ResvMax,r>0&&(s+=r);{var o=Math.min(i.main_data_begin*8,s)/8;i.resvDrain_pre+=8*o,s-=8*o,e.ResvSize-=8*o,i.main_data_begin-=o}i.resvDrain_post+=s,e.ResvSize-=s}}var T7e=w7e;function A7e(){var t="http://www.mp3dev.org/",e=3,n=98,r=4,i=0,s=93;this.getLameVersion=function(){return e+"."+n+"."+r},this.getLameShortVersion=function(){return e+"."+n+"."+r},this.getLameVeryShortVersion=function(){return"LAME"+e+"."+n+"r"},this.getPsyVersion=function(){return i+"."+s},this.getLameUrl=function(){return t},this.getLameOsBitness=function(){return"32bits"}}var C7e=A7e,_x=Mo,R7e=_x.System,F2=_x.VbrMode,sG=_x.ShortBlock,k7e=_x.Arrays,WR=_x.new_byte,M7e=_x.assert;RA.NUMTOCENTRIES=100;RA.MAXFRAMESIZE=2880;function RA(){var t,e,n;this.setModules=function(D,O,z){t=D,e=O,n=z};var r=1,i=2,s=4,o=8,a=RA.NUMTOCENTRIES,c=RA.MAXFRAMESIZE,l=a+4+4+4+4+4,u=l+9+1+1+8+1+1+3+1+1+2+4+2+2,h=128,f=64,d=32,p=null,m="Xing",g="Info",_=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function y(D,O){if(D.nVbrNumFrames++,D.sum+=O,D.seen++,!(D.seen<D.want)&&(D.pos<D.size&&(D.bag[D.pos]=D.sum,D.pos++,D.seen=0),D.pos==D.size)){for(var z=1;z<D.size;z+=2)D.bag[z/2]=D.bag[z];D.want*=2,D.pos/=2}}function v(D,O){if(!(D.pos<=0))for(var z=1;z<a;++z){var q=z/a,G,K,te=0|Math.floor(q*D.pos);te>D.pos-1&&(te=D.pos-1),G=D.bag[te],K=D.sum;var re=0|256*G/K;re>255&&(re=255),O[z]=255&re}}this.addVbrFrame=function(D){var O=D.internal_flags,z=Tables.bitrate_table[D.version][O.bitrate_index];M7e(O.VBR_seek_table.bag!=null),y(O.VBR_seek_table,z)};function E(D,O){var z=D[O+0]&255;return z<<=8,z|=D[O+1]&255,z<<=8,z|=D[O+2]&255,z<<=8,z|=D[O+3]&255,z}function x(D,O,z){D[O+0]=255&(z>>24&255),D[O+1]=255&(z>>16&255),D[O+2]=255&(z>>8&255),D[O+3]=255&(z&255)}function A(D,O,z){D[O+0]=255&(z>>8&255),D[O+1]=255&(z&255)}function T(D,O){return new String(D,O,m.length(),p).equals(m)||new String(D,O,g.length(),p).equals(g)}function k(D,O,z){return 255&(D<<O|z&~(-1<<O))}function L(D,O){var z=D.internal_flags;O[0]=k(O[0],8,255),O[1]=k(O[1],3,7),O[1]=k(O[1],1,D.out_samplerate<16e3?0:1),O[1]=k(O[1],1,D.version),O[1]=k(O[1],2,1),O[1]=k(O[1],1,D.error_protection?0:1),O[2]=k(O[2],4,z.bitrate_index),O[2]=k(O[2],2,z.samplerate_index),O[2]=k(O[2],1,0),O[2]=k(O[2],1,D.extension),O[3]=k(O[3],2,D.mode.ordinal()),O[3]=k(O[3],2,z.mode_ext),O[3]=k(O[3],1,D.copyright),O[3]=k(O[3],1,D.original),O[3]=k(O[3],2,D.emphasis),O[0]=255;var q=255&(O[1]&241),G;D.version==1?G=h:D.out_samplerate<16e3?G=d:G=f,D.VBR==F2.vbr_off&&(G=D.brate);var K;D.free_format?K=0:K=255&16*t.BitrateIndex(G,D.version,D.out_samplerate),D.version==1?(O[1]=255&(q|10),q=255&(O[2]&13),O[2]=255&(K|q)):(O[1]=255&(q|2),q=255&(O[2]&13),O[2]=255&(K|q))}this.getVbrTag=function(D){var O=new VBRTagData,z=0;O.flags=0;var q=D[z+1]>>3&1,G=D[z+2]>>2&3,K=D[z+3]>>6&3,te=D[z+2]>>4&15;if(te=Tables.bitrate_table[q][te],D[z+1]>>4==14?O.samprate=Tables.samplerate_table[2][G]:O.samprate=Tables.samplerate_table[q][G],q!=0?K!=3?z+=36:z+=21:K!=3?z+=21:z+=13,!T(D,z))return null;z+=4,O.hId=q;var re=O.flags=E(D,z);if(z+=4,re&r&&(O.frames=E(D,z),z+=4),re&i&&(O.bytes=E(D,z),z+=4),re&s){if(O.toc!=null)for(var H=0;H<a;H++)O.toc[H]=D[z+H];z+=a}O.vbrScale=-1,re&o&&(O.vbrScale=E(D,z),z+=4),O.headersize=(q+1)*72e3*te/O.samprate,z+=21;var Y=D[z+0]<<4;Y+=D[z+1]>>4;var Z=(D[z+1]&15)<<8;return Z+=D[z+2]&255,(Y<0||Y>3e3)&&(Y=-1),(Z<0||Z>3e3)&&(Z=-1),O.encDelay=Y,O.encPadding=Z,O},this.InitVbrTag=function(D){var O=D.internal_flags,z;D.version==1?z=h:D.out_samplerate<16e3?z=d:z=f,D.VBR==F2.vbr_off&&(z=D.brate);var q=(D.version+1)*72e3*z/D.out_samplerate,G=O.sideinfo_len+u;if(O.VBR_seek_table.TotalFrameSize=q,q<G||q>c){D.bWriteVbrTag=!1;return}O.VBR_seek_table.nVbrNumFrames=0,O.VBR_seek_table.nBytesWritten=0,O.VBR_seek_table.sum=0,O.VBR_seek_table.seen=0,O.VBR_seek_table.want=1,O.VBR_seek_table.pos=0,O.VBR_seek_table.bag==null&&(O.VBR_seek_table.bag=new int[400],O.VBR_seek_table.size=400);var K=WR(c);L(D,K);for(var te=O.VBR_seek_table.TotalFrameSize,re=0;re<te;++re)e.add_dummy_byte(D,K[re]&255,1)};function I(D,O){var z=O^D;return O=O>>8^_[z&255],O}this.updateMusicCRC=function(D,O,z,q){for(var G=0;G<q;++G)D[0]=I(O[z+G],D[0])};function F(D,O,z,q,G){var K=D.internal_flags,te=0,re=D.encoder_delay,H=D.encoder_padding,Y=100-10*D.VBR_q-D.quality,Z=n.getLameVeryShortVersion(),Q,ie=0,ge,Te=[1,5,3,2,4,0,3],be=0|(D.lowpassfreq/100+.5>255?255:D.lowpassfreq/100+.5),Pe=0,Ge=0,Ze=0,lt=D.internal_flags.noise_shaping,pt=0,ne=0,Le=0,Ve=0,De=0,Ie=(D.exp_nspsytune&1)!=0,ae=(D.exp_nspsytune&2)!=0,ve=!1,we=!1,pe=D.internal_flags.nogap_total,ze=D.internal_flags.nogap_current,Je=D.ATHtype,Xe=0,tt;switch(D.VBR){case vbr_abr:tt=D.VBR_mean_bitrate_kbps;break;case vbr_off:tt=D.brate;break;default:tt=D.VBR_min_bitrate_kbps}switch(D.VBR.ordinal()<Te.length?Q=Te[D.VBR.ordinal()]:Q=0,ge=16*ie+Q,K.findReplayGain&&(K.RadioGain>510&&(K.RadioGain=510),K.RadioGain<-510&&(K.RadioGain=-510),Ge=8192,Ge|=3072,K.RadioGain>=0?Ge|=K.RadioGain:(Ge|=512,Ge|=-K.RadioGain)),K.findPeakSample&&(Pe=Math.abs(0|K.PeakSample/32767*Math.pow(2,23)+.5)),pe!=-1&&(ze>0&&(we=!0),ze<pe-1&&(ve=!0)),Xe=Je+((Ie?1:0)<<4)+((ae?1:0)<<5)+((ve?1:0)<<6)+((we?1:0)<<7),Y<0&&(Y=0),D.mode){case MONO:pt=0;break;case STEREO:pt=1;break;case DUAL_CHANNEL:pt=2;break;case JOINT_STEREO:D.force_ms?pt=4:pt=3;break;case NOT_SET:default:pt=7;break}D.in_samplerate<=32e3?Le=0:D.in_samplerate==48e3?Le=2:D.in_samplerate>48e3?Le=3:Le=1,(D.short_blocks==sG.short_block_forced||D.short_blocks==sG.short_block_dispensed||D.lowpassfreq==-1&&D.highpassfreq==-1||D.scale_left<D.scale_right||D.scale_left>D.scale_right||D.disable_reservoir&&D.brate<320||D.noATH||D.ATHonly||Je==0||D.in_samplerate<=32e3)&&(ne=1),Ve=lt+(pt<<2)+(ne<<5)+(Le<<6),De=K.nMusicCRC,x(z,q+te,Y),te+=4;for(var Nt=0;Nt<9;Nt++)z[q+te+Nt]=255&Z.charAt(Nt);te+=9,z[q+te]=255&ge,te++,z[q+te]=255&be,te++,x(z,q+te,Pe),te+=4,A(z,q+te,Ge),te+=2,A(z,q+te,Ze),te+=2,z[q+te]=255&Xe,te++,tt>=255?z[q+te]=255:z[q+te]=255&tt,te++,z[q+te]=255&re>>4,z[q+te+1]=255&(re<<4)+(H>>8),z[q+te+2]=255&H,te+=3,z[q+te]=255&Ve,te++,z[q+te++]=0,A(z,q+te,D.preset),te+=2,x(z,q+te,O),te+=4,A(z,q+te,De),te+=2;for(var gt=0;gt<te;gt++)G=I(z[q+gt],G);return A(z,q+te,G),te+=2,te}function M(D){D.seek(0);var O=WR(10);D.readFully(O);var z;return new String(O,"ISO-8859-1").startsWith("ID3")?z=0:z=((O[6]&127)<<21|(O[7]&127)<<14|(O[8]&127)<<7|O[9]&127)+O.length,z}this.getLameTagFrame=function(D,O){var z=D.internal_flags;if(!D.bWriteVbrTag||z.Class_ID!=Lame.LAME_ID||z.VBR_seek_table.pos<=0)return 0;if(O.length<z.VBR_seek_table.TotalFrameSize)return z.VBR_seek_table.TotalFrameSize;k7e.fill(O,0,z.VBR_seek_table.TotalFrameSize,0),L(D,O);var q=WR(a);if(D.free_format)for(var G=1;G<a;++G)q[G]=255&255*G/100;else v(z.VBR_seek_table,q);var K=z.sideinfo_len;D.error_protection&&(K-=2),D.VBR==F2.vbr_off?(O[K++]=255&g.charAt(0),O[K++]=255&g.charAt(1),O[K++]=255&g.charAt(2),O[K++]=255&g.charAt(3)):(O[K++]=255&m.charAt(0),O[K++]=255&m.charAt(1),O[K++]=255&m.charAt(2),O[K++]=255&m.charAt(3)),x(O,K,r+i+s+o),K+=4,x(O,K,z.VBR_seek_table.nVbrNumFrames),K+=4;var te=z.VBR_seek_table.nBytesWritten+z.VBR_seek_table.TotalFrameSize;x(O,K,0|te),K+=4,R7e.arraycopy(q,0,O,K,q.length),K+=q.length,D.error_protection&&e.CRC_writeheader(z,O);for(var re=0,G=0;G<K;G++)re=I(O[G],re);return K+=F(D,te,O,K,re),z.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(D,O){var z=D.internal_flags;if(z.VBR_seek_table.pos<=0||(O.seek(O.length()),O.length()==0))return-1;var q=M(O);O.seek(q);var G=WR(c),K=getLameTagFrame(D,G);return K>G.length?-1:(K<1||O.write(G,0,K),0)}}var O7e=RA,nre=Mo,oG=nre.new_byte,I7e=nre.assert,N7e=vU(),P7e=h7e,D7e=Xne,L7e=Qne(),U7e=E7e,B7e=ere(),F7e=T7e,j7e=RC,z7e=_U();Fl();var V7e=C7e,H7e=O7e;function $7e(){this.setModules=function(t,e){}}function G7e(){this.setModules=function(t,e,n){}}function W7e(){}function q7e(){this.setModules=function(t,e){}}function Y7e(t,e,n){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,e=44100,n=128);var r=new N7e,i=new $7e,s=new D7e,o=new z7e,a=new P7e,c=new L7e,l=new U7e,u=new H7e,h=new V7e,f=new q7e,d=new F7e,p=new B7e,m=new G7e,g=new W7e;r.setModules(s,o,a,c,l,u,h,f,g),o.setModules(s,g,h,u),f.setModules(o,h),a.setModules(r),l.setModules(o,d,c,p),c.setModules(p,d,r.enc.psy),d.setModules(o),p.setModules(c),u.setModules(r,o,h),i.setModules(m,g),m.setModules(h,f,a);var _=r.lame_init();_.num_channels=t,_.in_samplerate=e,_.brate=n,_.mode=j7e.STEREO,_.quality=3,_.bWriteVbrTag=!1,_.disable_reservoir=!0,_.write_id3tag_automatic=!1,r.lame_init_params(_);var y=1152,v=0|1.25*y+7200,E=oG(v);this.encodeBuffer=function(x,A){t==1&&(A=x),I7e(x.length==A.length),x.length>y&&(y=x.length,v=0|1.25*y+7200,E=oG(v));var T=r.lame_encode_buffer(_,x,A,x.length,E,0,v);return new Int8Array(E.subarray(0,T))},this.flush=function(){var x=r.lame_encode_flush(_,E,0,v);return new Int8Array(E.subarray(0,x))}}function ym(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function HI(t){return t.charCodeAt(0)<<24|t.charCodeAt(1)<<16|t.charCodeAt(2)<<8|t.charCodeAt(3)}ym.RIFF=HI("RIFF");ym.WAVE=HI("WAVE");ym.fmt_=HI("fmt ");ym.data=HI("data");ym.readHeader=function(t){var e=new ym,n=t.getUint32(0,!1);if(ym.RIFF==n&&(t.getUint32(4,!0),ym.WAVE==t.getUint32(8,!1)&&ym.fmt_==t.getUint32(12,!1))){var r=t.getUint32(16,!0),i=20;switch(r){case 16:case 18:e.channels=t.getUint16(i+2,!0),e.sampleRate=t.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var s=ym.data,o=0;s!=n&&(n=t.getUint32(i,!1),o=t.getUint32(i+4,!0),s!=n);)i+=o+8;return e.dataLen=o,e.dataOffset=i+8,e}};var K7e=Y7e;async function X7e(t){const e=ii(),n=t.numberOfChannels,r=t.getChannelData(0),i=n>1?t.getChannelData(1):r,s=t.sampleRate,o=r.length,a=new K7e(2,s,128),c=1152,l=[];for(let h=0;h<o;h+=c){l.length%64===0&&zr(qe,e,`encoding chunk (${h}/${o})`);const f=new Int16Array(c),d=new Int16Array(c);for(let m=0;m<c;m++){const g=h+m;g<o&&(f[m]=r[g]<0?r[g]*32768:r[g]*32767,d[m]=i[g]<0?i[g]*32768:i[g]*32767)}const p=a.encodeBuffer(f,d);p.length>0&&l.push(p),l.length%16===0&&await oh(10)}const u=a.flush();return u.length>0&&l.push(u),zr(qe,e,`total chunks ${l.length+1}`),await oh(100),new Uint8Array(l.reduce((h,f)=>{const d=new Uint8Array(h.length+f.length);return d.set(h,0),d.set(f,h.length),d},new Uint8Array(0)))}function J7e(t,e,n,r){const{SOURCE:i,FX:s,FXCHAIN:o}=t;function a(){e.recordedticks=[],e.recordlastpercent=0,e.recordisrendering=0}function c(l){if(e.recordedticks.length){const u=ii(),h=e.recordedticks.map(E=>E[0]),f=Math.min(...h),d=Math.max(...h),p=Math.ceil(d-f+5),m=[];for(let E=0;E<e.recordedticks.length;++E){const[x,A]=e.recordedticks[E];m.push([x-f+.1,A])}const g=i.map(E=>E.getreplay()),_=o.getreplay(),y=s.map(E=>E.getreplay());let v;Qke(async({transport:E})=>{zr(qe,u,"create synth"),await n(),v=r(),zr(qe,u,"synth waiting for setup"),await oh(2e3),v.setplayvolume(80),v.applyreplay(g,_,y),v.synthreplay(m,d),zr(qe,u,"rendering audio"),E.start(0)},p).then(E=>(zr(qe,u,"rendering complete, exporting mp3"),X7e(E))).then(E=>{const x=document.createElement("a");x.href=URL.createObjectURL(new Blob([E],{type:"audio/mp3"})),x.download=`${l||J5()}.mp3`,zr(qe,u,`saving file ${x.download}`),x.click(),v?.destroy()}).catch(E=>{_r(qe,u,"synthrecord",E)})}a()}return{synthrecord:c,synthflush:a}}class yU extends lf{name="AlgoSynth";_operator1;_operator2;_operator3;_operator4;_modulation1;_modulation2;_modulation3;oscillator1;oscillator2;oscillator3;oscillator4;envelope1;envelope2;envelope3;envelope4;frequency;detune;modulationindex1;modulationindex2;modulationindex3;harmonicity1;harmonicity2;harmonicity3;constructor(){const e=Yn(yU.getDefaults(),arguments);switch(super(e),this._operator1=new Ga({context:this.context,oscillator:e.oscillator1,envelope:e.envelope1,volume:-10}),this.oscillator1=this._operator1.oscillator,this.envelope1=this._operator1.envelope,this._operator2=new Ga({context:this.context,oscillator:e.oscillator2,envelope:e.envelope2,volume:-10}),this.oscillator2=this._operator2.oscillator,this.envelope2=this._operator2.envelope,this._operator3=new Ga({context:this.context,oscillator:e.oscillator3,envelope:e.envelope3,volume:-10}),this.oscillator3=this._operator3.oscillator,this.envelope3=this._operator3.envelope,this._operator4=new Ga({context:this.context,oscillator:e.oscillator4,envelope:e.envelope4,onsilence:()=>this.onsilence(this),volume:-10}),this.oscillator4=this._operator4.oscillator,this.envelope4=this._operator4.envelope,this.frequency=new Mi({context:this.context,units:"frequency"}),this.detune=new Mi({context:this.context,value:e.detune,units:"cents"}),this.harmonicity1=new kl({context:this.context,value:e.harmonicity1,minValue:0}),this.harmonicity2=new kl({context:this.context,value:e.harmonicity2,minValue:0}),this.harmonicity3=new kl({context:this.context,value:e.harmonicity3,minValue:0}),this.modulationindex1=new kl({context:this.context,value:e.modulationindex1}),this.modulationindex2=new kl({context:this.context,value:e.modulationindex2}),this.modulationindex3=new kl({context:this.context,value:e.modulationindex3}),this._modulation1=new Vr({context:this.context,gain:0}),this._modulation2=new Vr({context:this.context,gain:0}),this._modulation3=new Vr({context:this.context,gain:0}),this.frequency.chain(this.harmonicity1,this._operator1.frequency),this.frequency.chain(this.harmonicity2,this._operator2.frequency),this.frequency.chain(this.harmonicity3,this._operator3.frequency),this.frequency.connect(this._operator4.frequency),this.frequency.chain(this.modulationindex1,this._modulation1),this.frequency.chain(this.modulationindex2,this._modulation2),this.frequency.chain(this.modulationindex3,this._modulation3),this.detune.fan(this._operator1.detune,this._operator2.detune,this._operator3.detune,this._operator4.detune),e.algorithm){case 0:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 1:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator3.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 2:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator4.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 3:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator4.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator4.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 4:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 5:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator1.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator1.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 6:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency);break}switch(e.algorithm){case 0:case 1:case 2:case 3:this._operator4.connect(this.output);break;case 4:this._operator2.connect(this.output),this._operator4.connect(this.output);break;case 5:case 6:this._operator2.connect(this.output),this._operator3.connect(this.output),this._operator4.connect(this.output);break;case 7:this._operator1.connect(this.output),this._operator2.connect(this.output),this._operator3.connect(this.output),this._operator4.connect(this.output);break}yi(this,["harmonicity1","harmonicity2","harmonicity3","modulationindex1","modulationindex2","modulationindex3","oscillator1","oscillator2","oscillator3","oscillator4","envelope1","envelope2","envelope3","envelope4","frequency","detune"])}static getDefaults(){return Object.assign(lf.getDefaults(),{algorithm:0,harmonicity1:2,harmonicity2:2,harmonicity3:2,modulationindex1:1,modulationindex2:1,modulationindex3:1,oscillator1:Object.assign(kc(Rm.getDefaults(),[...Object.keys(ma.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator2:Object.assign(kc(Rm.getDefaults(),[...Object.keys(ma.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator3:Object.assign(kc(Rm.getDefaults(),[...Object.keys(ma.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator4:Object.assign(kc(Rm.getDefaults(),[...Object.keys(ma.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope1:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope2:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope3:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope4:Object.assign(kc(nl.getDefaults(),Object.keys(Qn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,n){this._operator1._triggerEnvelopeAttack(e,n),this._operator2._triggerEnvelopeAttack(e,n),this._operator3._triggerEnvelopeAttack(e,n),this._operator4._triggerEnvelopeAttack(e,n)}_triggerEnvelopeRelease(e){return this._operator1._triggerEnvelopeRelease(e),this._operator2._triggerEnvelopeRelease(e),this._operator3._triggerEnvelopeRelease(e),this._operator4._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope4.getValueAtTime(e)}dispose(){return super.dispose(),this.harmonicity1.dispose(),this.harmonicity2.dispose(),this.harmonicity3.dispose(),this.modulationindex1.dispose(),this.modulationindex2.dispose(),this.modulationindex3.dispose(),this._operator1.dispose(),this._operator2.dispose(),this._operator3.dispose(),this._operator4.dispose(),this._modulation1?.dispose(),this._modulation2?.dispose(),this._modulation3?.dispose(),this.frequency.dispose(),this.detune.dispose(),this}}var oi=(t=>(t[t.SYNTH=0]="SYNTH",t[t.RETRO_NOISE=1]="RETRO_NOISE",t[t.BUZZ_NOISE=2]="BUZZ_NOISE",t[t.CLANG_NOISE=3]="CLANG_NOISE",t[t.METALLIC_NOISE=4]="METALLIC_NOISE",t[t.BELLS=5]="BELLS",t[t.DOOT=6]="DOOT",t[t.ALGO_SYNTH=7]="ALGO_SYNTH",t))(oi||{});const aG=131072;function Z7e(t){const e=bo().createBuffer(1,aG,bo().sampleRate);let n=1;const r=e.getChannelData(0);for(let i=0;i<aG;i++){t===4?r[i]=(n&1)*4*(Math.random()*14+1)-8:r[i]=(n&1)*2-1;let s=n>>1;if((n+s&1)==1)switch(t){default:case 1:s+=16384;break;case 3:s+=32768;break;case 2:s+=40;break;case 4:s+=60;break}n=s}return e}function cg(t,e){let n,r;function i(){switch(n?.type){case 0:{n.synth.set({...r,envelope:{...r.envelope,attack:.01,decay:.01,sustain:.5,release:.01},oscillator:{...r.oscillator,type:"square"}});break}case 1:{n.synth.set({...r,attack:.01,decay:.01,sustain:.5,release:.01});break}case 5:{n.synth.set({...r,harmonicity:1.5,modulationIndex:30,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.01,decay:3,sustain:.3,release:6},modulationEnvelope:{attack:.5,decay:1,sustain:.2,release:4}});break}case 6:{n.synth.set({...r});break}case 7:{n.synth.set({...r});break}}}function s(){return{type:n?.type,synth:n?.synth.get(),algo:n?.type===7?n?.algo:0}}function o(c){n?.synth.set(c.synth)}function a(){n?.synth.dispose()}switch(t){case 0:return n={type:t,synth:new Ga},r=Ts(n.synth.get()),i(),{source:n,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 1:case 2:case 3:case 4:return n={type:t,synth:new _C({volume:-44,urls:{C4:Z7e(t)}}),filter1:new zE({type:"lowshelf",gain:-32,frequency:440}),filter2:new zE({type:"highshelf",gain:32,frequency:440})},r=Ts(n.synth.get()),i(),{source:n,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 5:return n={type:5,synth:new Q6,sparkle:new e8({volume:-16,envelope:{attack:.001,decay:1.4,release:.321},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5})},r=Ts(n.synth.get()),i(),{source:n,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 6:return n={type:t,synth:new lx},r=Ts(n.synth.get()),i(),{source:n,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 7:return n={type:t,synth:new yU({algorithm:e}),algo:e},r=Ts(n.synth.get()),i(),{source:n,applyreset:i,getreplay:s,setreplay:o,destroy:a}}}function Q7e(t,e,n){const r=[cg(oi.SYNTH,0),cg(oi.SYNTH,0),cg(oi.SYNTH,0),cg(oi.SYNTH,0),cg(oi.SYNTH,0),cg(oi.SYNTH,0),cg(oi.SYNTH,0),cg(oi.SYNTH,0)],i=hFe(),s=[zR(1),zR(2),zR(3),zR(4)];for(let l=0;l<s.length;++l){const u=s[l],h=l<2?t:l<3?e:n;u.sendtofx.connect(h),u.fc.chain(i.fc,h),u.echo.chain(i.echo,h),u.reverb.chain(i.reverb,h),u.autofilter.chain(i.autofilter,h),u.vibrato.chain(i.vibrato,h),u.distortion.chain(i.distortion,h),u.autowah.chain(i.autowah,h)}function o(l){return l<4?Math.floor(l/2):2}function a(l){const u=o(l);if(fe(r[l])){switch(r[l].source.type){case oi.RETRO_NOISE:case oi.BUZZ_NOISE:case oi.CLANG_NOISE:case oi.METALLIC_NOISE:break;default:r[l].source.synth.connect(s[u].sendtofx);break}switch(r[l].source.type){case oi.RETRO_NOISE:case oi.BUZZ_NOISE:case oi.CLANG_NOISE:case oi.METALLIC_NOISE:r[l].source.synth.chain(r[l].source.filter1,r[l].source.filter2,s[u].sendtofx);break;case oi.BELLS:r[l].source.sparkle.connect(s[u].sendtofx);break}}}for(let l=0;l<r.length;++l)a(l);function c(l,u,h){const f=r[l]?.source.type===oi.ALGO_SYNTH?r[l]?.source.algo:0;r[l]?.source.type===u&&f===h||(r[l]?.source.synth.dispose(),r[l]=cg(u,h),a(l))}return{SOURCE:r,FX:s,FXCHAIN:i,mapindextofx:o,connectsource:a,changesource:c}}function rre(t){return t!==null&&typeof t=="object"&&"name"in t&&typeof t.name=="string"}function ire(t){return t!==null&&typeof t=="object"&&"step"in t&&typeof t.step=="number"&&"alt"in t&&typeof t.alt=="number"&&!isNaN(t.step)&&!isNaN(t.alt)}var sre=[0,2,4,-1,1,3,5],ore=sre.map(t=>Math.floor(t*7/12));function are(t){const{step:e,alt:n,oct:r,dir:i=1}=t,s=sre[e]+7*n;if(r===void 0)return[i*s];const o=r-ore[e]-4*n;return[i*s,i*o]}var eje=[3,0,4,1,5,2,6];function tje(t){const[e,n,r]=t,i=eje[nje(e)],s=Math.floor((e+1)/7);if(n===void 0)return{step:i,alt:s,dir:r};const o=n+4*s+ore[i];return{step:i,alt:s,oct:o,dir:r}}function nje(t){const e=(t+1)%7;return e<0?7+e:e}var cG=(t,e)=>Array(Math.abs(e)+1).join(t),p4=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),rje="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",ije="(AA|A|P|M|m|d|dd)([-+]?\\d+)",sje=new RegExp("^"+rje+"|"+ije+"$");function oje(t){const e=sje.exec(`${t}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var lG={};function eO(t){return typeof t=="string"?lG[t]||(lG[t]=aje(t)):ire(t)?eO(lje(t)):rre(t)?eO(t.name):p4}var uG=[0,2,4,5,7,9,11],cre="PMMPPMM";function aje(t){const e=oje(t);if(e[0]==="")return p4;const n=+e[0],r=e[1],i=(Math.abs(n)-1)%7,s=cre[i];if(s==="M"&&r==="P")return p4;const o=s==="M"?"majorable":"perfectable",a=""+n+r,c=n<0?-1:1,l=n===8||n===-8?n:c*(i+1),u=cje(o,r),h=Math.floor((Math.abs(n)-1)/7),f=c*(uG[i]+u+12*h),d=(c*(uG[i]+u)%12+12)%12,p=are({step:i,alt:u,oct:h,dir:c});return{empty:!1,name:a,num:n,q:r,step:i,alt:u,dir:c,type:o,simple:l,semitones:f,chroma:d,coord:p,oct:h}}function cje(t,e){return e==="M"&&t==="majorable"||e==="P"&&t==="perfectable"?0:e==="m"&&t==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(t==="perfectable"?e.length:e.length+1):0}function lje(t){const{step:e,alt:n,oct:r=0,dir:i}=t;if(!i)return"";const s=e+1+7*r,o=s===0?e+1:s,a=i<0?"-":"",c=cre[e]==="M"?"majorable":"perfectable";return a+o+uje(c,n)}function uje(t,e){return e===0?t==="majorable"?"M":"P":e===-1&&t==="majorable"?"m":e>0?cG("A",e):cG("d",t==="perfectable"?e:e+1)}var hG=(t,e)=>Array(Math.abs(e)+1).join(t),lre=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),fG=new Map,hje=t=>"CDEFGAB".charAt(t),fje=t=>t<0?hG("b",-t):hG("#",t),dje=t=>t[0]==="b"?-t.length:t.length;function kA(t){const e=JSON.stringify(t),n=fG.get(e);if(n)return n;const r=typeof t=="string"?vje(t):ire(t)?kA(yje(t)):rre(t)?kA(t.name):lre;return fG.set(e,r),r}var pje=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function mje(t){const e=pje.exec(t);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function gje(t){return kA(tje(t))}var _je=(t,e)=>(t%e+e)%e,j2=[0,2,4,5,7,9,11];function vje(t){const e=mje(t);if(e[0]===""||e[3]!=="")return lre;const n=e[0],r=e[1],i=e[2],s=(n.charCodeAt(0)+3)%7,o=dje(r),a=i.length?+i:void 0,c=are({step:s,alt:o,oct:a}),l=n+r+i,u=n+r,h=(j2[s]+o+120)%12,f=a===void 0?_je(j2[s]+o,12)-1188:j2[s]+o+12*(a+1),d=f>=0&&f<=127?f:null,p=a===void 0?null:Math.pow(2,(f-69)/12)*440;return{empty:!1,acc:r,alt:o,chroma:h,coord:c,freq:p,height:f,letter:n,midi:d,name:l,oct:a,pc:u,step:s}}function yje(t){const{step:e,alt:n,oct:r}=t,i=hje(e);if(!i)return"";const s=i+fje(n);return r||r===0?s+r:s}function ure(t,e){const n=kA(t),r=Array.isArray(e)?e:eO(e).coord;if(n.empty||!r||r.length<2)return"";const i=n.coord,s=i.length===1?[i[0]+r[0]]:[i[0]+r[0],i[1]+r[1]];return gje(s).name}function hre(t,e){const n=e.length,r=(t%n+n)%n;return e.slice(r,n).concat(e.slice(0,r))}var H1={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},fre=t=>Number(t).toString(2).padStart(12,"0"),dG=t=>parseInt(t,2),bje=/^[01]{12}$/;function dre(t){return bje.test(t)}var Sje=t=>typeof t=="number"&&t>=0&&t<=4095,Eje=t=>t&&dre(t.chroma),pG={[H1.chroma]:H1};function pre(t){const e=dre(t)?t:Sje(t)?fre(t):Array.isArray(t)?Cje(t):Eje(t)?t.chroma:H1.chroma;return pG[e]=pG[e]||Aje(e)}var xje=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function wje(t){const e=[];for(let n=0;n<12;n++)t.charAt(n)==="1"&&e.push(xje[n]);return e}function Tje(t){const e=t.split("");return e.map((n,r)=>hre(r,e).join(""))}function Aje(t){const e=dG(t),n=Tje(t).map(dG).filter(s=>s>=2048).sort()[0],r=fre(n),i=wje(t);return{empty:!1,name:"",setNum:e,chroma:t,normalized:r,intervals:i}}function Cje(t){if(t.length===0)return H1.chroma;let e;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<t.length;r++)e=kA(t[r]),e.empty&&(e=eO(t[r])),e.empty||(n[e.chroma]=1);return n.join("")}var Rje=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],kje=Rje;({...H1});var mre=[],Ik={};function Mje(t,e,n){const r=Ije(t),i={...pre(t),name:n||"",quality:r,intervals:t,aliases:e};mre.push(i),i.name&&(Ik[i.name]=i),Ik[i.setNum]=i,Ik[i.chroma]=i,i.aliases.forEach(s=>Oje(i,s))}function Oje(t,e){Ik[e]=t}function Ije(t){const e=n=>t.indexOf(n)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}kje.forEach(([t,e,n])=>Mje(t.split(" "),n.split(" "),e));mre.sort((t,e)=>t.setNum-e.setNum);var Nje=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neapolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5p pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7m pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neapolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neapolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],Pje=Nje,Dje={...H1,intervals:[],aliases:[]},VT={};function Lje(t){return VT[t]||Dje}function Uje(t,e,n=[]){const r={...pre(t),name:e,intervals:t,aliases:n};return VT[r.name]=r,VT[r.setNum]=r,VT[r.chroma]=r,r.aliases.forEach(i=>Bje(r,i)),r}function Bje(t,e){VT[e]=t}Pje.forEach(([t,e,...n])=>Uje(t.split(" "),e,n));var Fje=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],jje=Fje;jje.forEach(([t,e,n])=>void 0);var zje=ure;function Vje(t,e){return zje(t,[0,e])}var bU=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],mG={...H1,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},Hje=bU.map($je),m4={};Hje.forEach(t=>{m4[t.name]=t,t.aliases.forEach(e=>{m4[e]=t})});function gre(t){return typeof t=="string"?m4[t.toLowerCase()]||mG:t&&t.name?gre(t.name):mG}function $je(t){const[e,n,r,i,s,o,a]=t,c=a?[a]:[],l=Number(n).toString(2);return{empty:!1,intervals:Lje(i).intervals,modeNum:e,chroma:l,normalized:l,name:i,setNum:n,alt:r,triad:s,seventh:o,aliases:c}}function _re(t){return(e,n)=>{const r=gre(e);if(r.empty)return[];const i=hre(r.modeNum,t),s=r.intervals.map(o=>ure(n,o));return i.map((o,a)=>s[a]+o)}}_re(bU.map(t=>t[4]));_re(bU.map(t=>t[5]));function Gje(t,e,n,r){const{SOURCE:i,FX:s,FXCHAIN:o,mapindextofx:a}=t,{drum:c}=e;return function(u,h){if(h===null)return;if(n.recordisrendering>0){const g=Math.round(u/n.recordisrendering*100);g!==n.recordlastpercent&&(n.recordlastpercent=g,zr(qe,ii(),`${g}%`))}else n.recordedticks.push([u,h]);const[f,d,p]=h,m=a(f);if(dn(p)&&fe(i[f])&&fe(s[m])){i[f].source.type===oi.BELLS&&(i[f].source.synth.detune.value=au(-3,3),i[f].source.sparkle.triggerAttackRelease(Vje(p,2),d,u)),i[f].source.synth.triggerAttackRelease(p,d,u);const g=i[f].source.synth.toSeconds(d),_="128n",y=i[f].source.synth.toSeconds(_);o.vibrato.depth.rampTo(1,"2n",u),o.vibrato.depth.rampTo(0,_,u+g-y),o.vibrato.frequency.rampTo(5,"4n",u),o.vibrato.frequency.rampTo(1,_,u+g-y)}if(nn(p))switch(p){case 0:c.ticktrigger(u);break;case 1:c.tweettrigger(u);break;case 2:c.cowbelltrigger(d,u);break;case 3:c.claptrigger(d,u);break;case 4:c.hisnaretrigger(d,u);break;case 5:c.hiwoodblocktrigger(d,u);break;case 6:c.lowsnaretrigger(d,u);break;case 7:c.lowtomtrigger(d,u);break;case 8:c.lowwoodblocktrigger(d,u);break;case 9:c.basstrigger(u);break;case-1:r.pacercount--,r.pacercount===0&&(r.pacer.clear(),r.pacertime=-1);break}}}async function vre(){await uFe(),await dFe()}function yre(){const t=pFe(),e=Q7e(t.playvolume,t.bgplayvolume,t.ttsvolume),{SOURCE:n,FX:r,FXCHAIN:i,changesource:s}=e,o={recordedticks:[],recordlastpercent:0,recordisrendering:0},a={pacertime:-1,pacercount:0,pacer:null},c=Gje(e,t,o,a);a.pacer=new vA(c);const{synthrecord:l,synthflush:u}=J7e(e,o,vre,yre);let h=u9;function f(L,I,F){L.forEach((M,D)=>{s(D,M.type,M.algo),n[D].setreplay(M)}),i.setreplay(I),F.forEach((M,D)=>{r[D].setreplay(M)})}function d(L,I,F,M=!0){let D=I;const O=vee(L,I,F,M),z=O[O.length-1];fe(z)&&(D=Math.max(D,z[0]));for(let q=0;q<O.length;++q){const[G,K]=O[q];a.pacer.add(G,K)}return D}function p(L,I){o.recordlastpercent=0,o.recordisrendering=I;for(let F=0;F<L.length;++F){const[M,D]=L[F];a.pacer.add(M,D)}}function m(L){const I=XL(L);a.pacertime===-1&&(a.pacertime=KL().now()),a.pacercount+=I.length;const F=a.pacertime;for(let M=0;M<I.length&&M<n.length;++M){const D=d(M,F,I[M]);a.pacertime=Math.max(a.pacertime,D)}}function g(L,I){const F=XL(L),M=Oc(I||"+0.05").toSeconds();for(let D=0;D<F.length;++D)d(h++,M,F[D],!1),h>=n.length&&(h=u9)}function _(){a.pacer.clear(),a.pacertime=-1,a.pacercount=0}function y(L){_(),KL().bpm.setValueAtTime(L,0),a.pacer=new vA(c),a.pacer.start(0)}function v(L){t.mainvolume.volume.value=ca(L*.25)}function E(L){t.bgplayvolume.volume.value=ca(L)}function x(L){new gC(L).connect(r[3].sendtofx).start(0)}function A(L){t.ttsvolume.volume.value=L}function T(){n.forEach((L,I)=>{const F=L.source.type===oi.ALGO_SYNTH?L.source.algo:0;s(I,oi.SYNTH,F),L.applyreset(),L.source.synth.set({oscillator:{type:"square"}})}),r.forEach(L=>L.applyreset()),i.applyreset()}function k(){n.forEach(L=>L.destroy()),r.forEach(L=>L.destroy()),i.destroy(),t.mainvolume.dispose()}return A(25),v(80),E(100),a.pacer.start(0),i.autofilter.start(),{destroy:k,broadcastdestination:t.broadcastdestination,addplay:m,addbgplay:g,stopplay:_,applyreset:T,applyreplay:f,synthrecord:l,synthflush:u,synthreplay:p,addaudiobuffer:x,setbpm:y,setplayvolume:v,setbgplayvolume:E,setttsvolume:A,SOURCE:n,FX:r,FXCHAIN:i,changesource:s}}function Wje(t,e,n,r){if(e.source.type!==oi.ALGO_SYNTH)return!1;switch(n){case"harmonicity":if(nn(r))return e.source.synth.set({harmonicity1:r,harmonicity2:r,harmonicity3:r}),!0;break;case"harmonicity1":if(nn(r))return e.source.synth.set({harmonicity1:r}),!0;break;case"harmonicity2":if(nn(r))return e.source.synth.set({harmonicity2:r}),!0;break;case"harmonicity3":if(nn(r))return e.source.synth.set({harmonicity3:r}),!0;break;case"modindex":if(nn(r))return e.source.synth.set({modulationindex1:r,modulationindex2:r,modulationindex3:r}),!0;break;case"modindex1":if(nn(r))return e.source.synth.set({modulationindex1:r}),!0;break;case"modindex2":if(nn(r))return e.source.synth.set({modulationindex2:r}),!0;break;case"modindex3":if(nn(r))return e.source.synth.set({modulationindex3:r}),!0;break;case"osc1":if(dn(r))return e.source.synth.set({oscillator1:{type:r}}),!0;break;case"osc2":if(dn(r))return e.source.synth.set({oscillator2:{type:r}}),!0;break;case"osc3":if(dn(r))return e.source.synth.set({oscillator3:{type:r}}),!0;break;case"osc4":if(dn(r))return e.source.synth.set({oscillator4:{type:r}}),!0;break;case"env1":case"envelope1":if(Kn(r)){const[i,s,o,a]=r;return e.source.synth.set({envelope1:{attack:i,decay:s,sustain:o,release:a}}),!0}break;case"env2":case"envelope2":if(Kn(r)){const[i,s,o,a]=r;return e.source.synth.set({envelope2:{attack:i,decay:s,sustain:o,release:a}}),!0}break;case"env3":case"envelope3":if(Kn(r)){const[i,s,o,a]=r;return e.source.synth.set({envelope3:{attack:i,decay:s,sustain:o,release:a}}),!0}break;case"env4":case"envelope4":if(Kn(r)){const[i,s,o,a]=r;return e.source.synth.set({envelope4:{attack:i,decay:s,sustain:o,release:a}}),!0}break}return!1}const qje=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]+/,Yje=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]*/;function Kje(t,e){if(dn(t)){const n=rr(t);if(qje.test(n))return Kn(e);switch(n){case"pwm":case"pulse":case"retro":case"buzz":case"clang":case"metallic":case"bells":case"doot":case"algo0":case"algo1":case"algo2":case"algo3":case"algo4":case"algo5":case"algo6":case"algo7":return!0;default:return Yje.test(n)}}return!1}function gG(t,e,n,r,i){if(!fe(e))return;const s=e.SOURCE[n];if(!fe(s)){_r(qe,t,"synth",`unknown voice ${n}`);return}switch(r){case"restart":{e.applyreset();return}case"vol":case"volume":nn(i)&&(s.source.synth.volume.value=i);return;case"port":case"portamento":if(nn(i))switch(s.source.type){case oi.SYNTH:s.source.synth.portamento=i;break;case oi.ALGO_SYNTH:s.source.synth.portamento=i;break;case oi.RETRO_NOISE:_r(qe,t,"synth","portamento for retro synth not supported");break}return;case"env":case"envelope":if(Kn(i)){const[o,a,c,l]=i;s.source.synth.set({envelope:{attack:o,decay:a,sustain:c,release:l}})}return;default:if(dn(r)){if(Kje(r,i)){switch(r){case"retro":e.changesource(n,oi.RETRO_NOISE,0);break;case"buzz":e.changesource(n,oi.BUZZ_NOISE,0);break;case"clang":e.changesource(n,oi.CLANG_NOISE,0);break;case"metallic":e.changesource(n,oi.METALLIC_NOISE,0);break;case"bells":e.changesource(n,oi.BELLS,0);break;case"doot":e.changesource(n,oi.DOOT,0);break;case"algo0":e.changesource(n,oi.ALGO_SYNTH,0);break;case"algo1":e.changesource(n,oi.ALGO_SYNTH,1);break;case"algo2":e.changesource(n,oi.ALGO_SYNTH,2);break;case"algo3":e.changesource(n,oi.ALGO_SYNTH,3);break;case"algo4":e.changesource(n,oi.ALGO_SYNTH,4);break;case"algo5":e.changesource(n,oi.ALGO_SYNTH,5);break;case"algo6":e.changesource(n,oi.ALGO_SYNTH,6);break;case"algo7":e.changesource(n,oi.ALGO_SYNTH,7);break;default:e.changesource(n,oi.SYNTH,0),s.source.synth.set({oscillator:{type:r}}),Kn(i)&&s.source.synth.set({oscillator:{type:r,partials:i,partialCount:i.length}}),nn(i)&&s.source.synth.set({oscillator:{type:r,partials:[i],partialCount:1}});break}return}switch(s.source.type){case oi.SYNTH:{switch(s.source.synth.get().oscillator.type){case"pwm":switch(r){case"modfreq":case"modulationfrequency":nn(i)&&s.source.synth.set({oscillator:{modulationFrequency:i}});return}break;case"pulse":if(r==="width"){nn(i)&&s.source.synth.set({oscillator:{width:i}});return}break;case"custom":case"sine":case"square":case"triangle":case"sawtooth":if(r==="phase"){nn(i)&&s.source.synth.set({oscillator:{phase:i}});return}break;case"amcustom":case"amsine":case"amsquare":case"amtriangle":case"amsawtooth":switch(r){case"harmonicity":nn(i)&&s.source.synth.set({oscillator:{harmonicity:i}});return;case"modtype":case"modulationtype":dn(i)&&s.source.synth.set({oscillator:{modulationType:i}});return;case"modenv":case"modulationenvelope":if(Kn(i)){const[a,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:a,decay:c,sustain:l,release:u}}})}break}break;case"fmcustom":case"fmsine":case"fmsquare":case"fmtriangle":case"fmsawtooth":switch(r){case"harmonicity":nn(i)&&s.source.synth.set({oscillator:{harmonicity:i}});return;case"modindex":nn(i)&&s.source.synth.set({oscillator:{modulationIndex:i}});return;case"modtype":dn(i)&&s.source.synth.set({oscillator:{modulationType:i}});return;case"modenv":if(Kn(i)){const[a,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:a,decay:c,sustain:l,release:u}}})}break}break;case"fatcustom":case"fatsine":case"fatsquare":case"fattriangle":case"fatsawtooth":switch(r){case"count":nn(i)&&s.source.synth.set({oscillator:{count:i}});return;case"phase":nn(i)&&s.source.synth.set({oscillator:{phase:i}});return;case"spread":nn(i)&&s.source.synth.set({oscillator:{spread:i}});return}break}return}case oi.ALGO_SYNTH:if(Wje(t,s,r,i))return;break}_r(qe,t,"synth",`unknown config ${r}`)}break}}function Xje(t,e,n,r,i){if(!fe(e)||n<0||n>=e.FX.length){_r(qe,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.autofilter;switch(r){case"type":if(dn(i)){s.set({filter:{type:i}});return}break;case"q":if(nn(i)){s.set({filter:{Q:i}});return}break;case"depth":if(nn(i)){s.set({depth:i});return}break;case"frequency":if(nn(i)){s.set({frequency:i});return}break;case"octaves":if(nn(i)){s.set({octaves:i});return}break}_r(qe,t,"kind",`unknown autofilter ${r} or ${i}`)}function Jje(t,e,n,r,i){if(!fe(e))return;if(n<0||n>=e.FX.length){_r(qe,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.autowah;switch(r){case"basefrequency":if(nn(i)){s.set({baseFrequency:i});return}break;case"octaves":if(nn(i)){s.set({octaves:i});return}break;case"sensitivity":if(nn(i)){s.set({sensitivity:i});return}break;case"gain":if(nn(i)){s.set({gain:i});return}break;case"follower":if(nn(i)){s.set({follower:i});return}break}_r(qe,t,"synth",`unknown autowah config ${r} with ${i}`)}function Zje(t,e,n,r,i){if(!fe(e)||n<0||n>=e.FX.length){_r(qe,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.distortion;switch(r){case"distortion":if(nn(i)){s.set({distortion:i});return}break;case"oversample":if(dn(i)){s.set({oversample:i});return}break}_r(qe,t,"kind",`unknown distortion ${r} or ${i}`)}function Qje(t,e,n,r,i){if(!fe(e)||n<0||n>=e.FX.length){_r(qe,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.echo;switch(r){case"delaytime":if(nn(i)){s.set({delayTime:i});return}break;case"feedback":if(nn(i)){s.set({feedback:i});return}break}_r(qe,t,"kind",`unknown echo ${r} or ${i}`)}function e9e(t,e,n,r,i){if(!fe(e)||n<0||n>=e.FX.length){_r(qe,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.fcrush;switch(r){case"rate":if(nn(i)){s.set({rate:i});return}break}_r(qe,t,"kind",`unknown fcrush ${r} or ${i}`)}function t9e(t,e,n,r,i){if(!fe(e)||n<0||n>=e.FX.length){_r(qe,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.reverb;switch(r){case"decay":if(nn(i)){s.set({decay:i});return}break;case"predelay":if(nn(i)){s.set({preDelay:i});return}break}_r(qe,t,"kind",`unknown reverb ${r} or ${i}`)}function n9e(t,e,n,r,i){if(!fe(e))return;if(n<0||n>=e.FX.length){_r(qe,t,"synth",`index ${n} out of bounds`);return}const s=e.FXCHAIN.vibrato;switch(r){case"maxdelay":if(nn(i)){s.set({maxDelay:i});return}break}_r(qe,t,"synth",`unknown vibrato config ${r} with ${i}`)}function z2(t,e,n,r,i,s){if(!fe(e))return;if(n<0||n>=e.FX.length){_r(qe,t,"synth",`index ${n} out of bounds`);return}const o=e.FX[n][r];if(fe(o)){switch(i){case"on":switch(r){case"vibrato":case"autofilter":o.volume.value=ca(50);break;default:o.volume.value=ca(18);break}break;case"off":o.volume.value=ca(0);break;default:if(nn(i))o.volume.value=ca(i);else switch(r){case"fc":case"fcrush":e9e(t,e,n,i,s);break;case"echo":Qje(t,e,n,i,s);break;case"autofilter":Xje(t,e,n,i,s);break;case"reverb":t9e(t,e,n,i,s);break;case"distort":case"distortion":Zje(t,e,n,i,s);break;case"vibrato":n9e(t,e,n,i,s);break;case"autowah":Jje(t,e,n,i,s);break}break}return}_r(qe,t,"synth",`unknown fx ${r}`)}let qR=Promise,bre=t=>{let e=0,n=0,r,i,s,o,a,c=()=>{e--,--n?l():o=s?.()},l=()=>{if(r&&e<t){e++;let u=r;r=r.a,u.p().then(h=>(u.c(h),c()),h=>(u.b(h),c()))}};return a={add(u){let h={p:u},f=new qR((d,p)=>{h.c=d,h.b=p});return r?i=i.a=h:i=r=h,n++,l(),f},done:()=>n?o||(o=new qR(u=>s=u)):qR.resolve(),clear(){for(let u=r;u;u=u.a)u.b(new Error("Queue cleared"));r=i=null,n=e},active:()=>e,size:()=>n,all:u=>qR.all(u.map(h=>a.add(typeof h=="function"?h:()=>h)))}},SU="piper",Sre="";function r9e(t,e){SU=t,Sre=e}function i9e(t){return bo().decodeAudioData(t)}async function Ere(t,e,n){return new Promise(r=>{const i=Ym(Go(),[],s=>{s.target==="heavy:ttsrequest"&&s.data&&i9e(s.data).then(r).catch(console.error),i.disconnect()},qe.session());NEe(i,t,SU,Sre,e,n)})}function s9e(t,e){return new Promise(n=>{const r=Ym(Go(),[],i=>{i.target==="heavy:ttsinfo"&&i.data&&n(i.data),r.disconnect()},qe.session());IEe(r,t,SU,e)})}async function o9e(t,e,n,r){if(r.trim()==="")return;const i=await Ere(t,n,r);fe(i)&&AK(qe,t,e,i)}const xre=bre(1);async function a9e(t,e,n){AK(qe,t,e,n);const r=Math.max(1e3,Math.round(n.duration*1e3));await oh(r)}const wre=bre(1);async function c9e(t,e,n,r){const i=await Ere(t,n,r);xre.add(async()=>{fe(i)&&await a9e(t,e,i)}).catch(console.error)}function l9e(t,e,n,r){wre.add(async()=>{await c9e(t,e,n,r)}).catch(console.error)}function u9e(){xre.clear(),wre.clear()}const h9e=Date.now(),Ma={get value(){return(Date.now()-h9e)/1e3%1e6}},f9e=120;let Tre=0;function Are(t){Tre=f9e/t}const d9e=136;Are(d9e);const vx={get value(){return Tre}};function Lv(t){const e=t.clone();return e.uniforms.time=Ma,e.uniforms.interval=vx,e}let YR=!1,Nk=!1;function kC(){Nk||YR||(YR=!0,UM(new cx({latencyHint:"playback"}),!0),qke().then(()=>{if(!Nk){try{const t=navigator;fe(t.audioSession)&&(t.audioSession.type="playback")}catch{}return vre().then(()=>{YR=!1,Nk=!0,UEe(dg,ii())})}}).catch(t=>{YR=!1,_r(dg,ii(),"audio",t.toString())}))}let nc;function p9e(){return nc?.broadcastdestination}const dg=Ym("synth",[],t=>{if(!dg.session(t)||(Nk&&!fe(nc)&&(nc=yre(),KL().start()),!fe(nc)))return;const e=ii();switch(t.target){case"audioenabled":if(t.player!==e)return;break}const n=Kr.getState().gadget.board;switch(t.target){case"audioenabled":us(dg,t.player,"audio is enabled!"),io(dg,t.player,async()=>{await oh(2e3),dh(dg,t.player,void 0,"text","audio:enabled","")});break;case"bpm":if(Kn(t.data)){const[,r]=t.data;nn(r)&&(nc.setbpm(Math.round(r)),Are(Math.round(r)))}break;case"playvolume":if(Kn(t.data)){const[,r]=t.data;nn(r)&&nc.setplayvolume(r)}break;case"bgplayvolume":if(Kn(t.data)){const[,r]=t.data;nn(r)&&nc.setbgplayvolume(r)}break;case"ttsvolume":if(Kn(t.data)){const[,r]=t.data;nn(r)&&nc.setttsvolume(r)}break;case"audiobuffer":if(Kn(t.data)){const[,r]=t.data;fe(r)&&nc.addaudiobuffer(r)}break;case"play":if(Kn(t.data)){const[r,i]=t.data;(r===""||r===n)&&(i.trim()===""?nc.stopplay():nc.addplay(i))}break;case"bgplay":if(Kn(t.data)){const[r,i,s]=t.data;(r===""||r===n)&&nc.addbgplay(i,s)}break;case"update":if(Kn(t.data)){const[r,i]=t.data;if(r===""||r===n){const s=Object.keys(i.voices).map(Number);for(let a=0;a<s.length;++a){const c=s[a],l=i.voices[c],u=Object.keys(l);for(let h=0;h<u.length;++h){const f=u[h],d=l[f];rr(f)!=="restart"&&gG(t.player,nc,c,f,d??"")}}const o=Object.keys(i.voicefx).map(Number);for(let a=0;a<o.length;++a){const c=o[a],l=i.voicefx[c],u=Object.keys(l);for(let h=0;h<u.length;++h){const f=u[h],d=l[f],p=Object.keys(d);for(let m=0;m<p.length;++m){const g=p[m],_=d[g];rr(g)==="on"?z2(t.player,nc,c,f,_??"",""):z2(t.player,nc,c,f,g,_??"")}}}}}break;case"voice":if(Kn(t.data)){const[,r,i,s]=t.data;gG(t.player,nc,r,i,s)}break;case"voicefx":if(Kn(t.data)){const[,r,i,s,o]=t.data;z2(t.player,nc,r,i,s,o)}break;case"record":dn(t.data)&&nc.synthrecord(t.data);break;case"flush":nc.synthflush();break;case"tts":io(dg,t.player,async()=>{if(Kn(t.data)){const[r,i,s]=t.data;s.trim()!==""&&(r===""||r===n)&&await o9e(t.player,r,i,s)}});break;case"ttsinfo":io(dg,t.player,async()=>{if(Kn(t.data)){const[,r]=t.data,i=await s9e(t.player,r);if(Kn(i))for(let s=0;s<i.length;s++)zr(dg,t.player,`$WHITE${i[s]}`)}});break;case"ttsengine":if(Kn(t.data)){const[,r,i]=t.data;r9e(r,i)}break;case"ttsqueue":if(Kn(t.data)){const[r,i,s]=t.data;s.trim()!==""&&(r===""||r===n)&&l9e(t.player,r,i,s)}break;case"ttsclearqueue":u9e();break}});function tO(){return tO=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},tO.apply(null,arguments)}var m9e=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/n)*Math.atan(Math.sin(2*Math.PI*e*i)/n)},g9e=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function tl(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:g9e,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(t.__damp===void 0&&(t.__damp={}),t.__damp[c]===void 0&&(t.__damp[c]=0),Math.abs(t[e]-n)<=a)return t[e]=n,!1;r=Math.max(1e-4,r);var l=2/r,u=o(l*i),h=t[e]-n,f=n,d=s*r;h=Math.min(Math.max(h,-d),d),n=t[e]-h;var p=(t.__damp[c]+l*h)*i;t.__damp[c]=(t.__damp[c]-l*p)*u;var m=n+(h+p)*u;return f-t[e]>0==m>f&&(m=f,t.__damp[c]=(m-f)/i),t[e]=m,!0}function V2(t,e,n,r,i,s,o,a){return tl(t,e,t[e]+FSe(t[e],n),r,i,s,o,a)}var OS=new zt,_G,vG,yG;function xv(t,e,n,r,i,s,o){return typeof e=="number"?OS.setScalar(e):Array.isArray(e)?OS.set(e[0],e[1],e[2]):OS.copy(e),_G=tl(t,"x",OS.x,n,r,i,s,o),vG=tl(t,"y",OS.y,n,r,i,s,o),yG=tl(t,"z",OS.z,n,r,i,s,o),_G||vG||yG}var hT=new Pm,bG,SG,EG;function g4(t,e,n,r,i,s,o){return Array.isArray(e)?hT.set(e[0],e[1],e[2],e[3]):hT.copy(e),bG=V2(t,"x",hT.x,n,r,i,s,o),SG=V2(t,"y",hT.y,n,r,i,s,o),EG=V2(t,"z",hT.z,n,r,i,s,o),bG||SG||EG}const xG=t=>Symbol.iterator in t,wG=t=>"entries"in t,TG=(t,e)=>{const n=t instanceof Map?t:new Map(t.entries()),r=e instanceof Map?e:new Map(e.entries());if(n.size!==r.size)return!1;for(const[i,s]of n)if(!r.has(i)||!Object.is(s,r.get(i)))return!1;return!0},_9e=(t,e)=>{const n=t[Symbol.iterator](),r=e[Symbol.iterator]();let i=n.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=n.next(),s=r.next()}return!!i.done&&!!s.done};function v9e(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null||Object.getPrototypeOf(t)!==Object.getPrototypeOf(e)?!1:xG(t)&&xG(e)?wG(t)&&wG(e)?TG(t,e):_9e(t,e):TG({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)})}function xh(t){const e=ch.useRef(void 0);return n=>{const r=t(n);return v9e(e.current,r)?e.current:e.current=r}}function Cre(t,e,n){const r=Dc(d=>d.size),i=Dc(d=>d.viewport),s=typeof t=="number"?t:r.width*i.dpr,o=typeof e=="number"?e:r.height*i.dpr,a=(typeof t=="number"?n:t)||{},{samples:c=0,depth:l,...u}=a,h=l??a.depthBuffer,f=Ye.useMemo(()=>{const d=new il(s,o,{minFilter:Ml,magFilter:Ml,type:Av,...u});return h&&(d.depthTexture=new SO(s,o,tp)),d.samples=c,d},[]);return Ye.useLayoutEffect(()=>{f.setSize(s,o),c&&(f.samples=c)},[c,f,s,o]),Ye.useEffect(()=>()=>f.dispose(),[]),f}const y9e=t=>typeof t=="function",b9e=Ye.forwardRef(({envMap:t,resolution:e=256,frames:n=1/0,children:r,makeDefault:i,...s},o)=>{const a=Dc(({set:g})=>g),c=Dc(({camera:g})=>g),l=Dc(({size:g})=>g),u=Ye.useRef(null);Ye.useImperativeHandle(o,()=>u.current,[]);const h=Ye.useRef(null),f=Cre(e);Ye.useLayoutEffect(()=>{s.manual||u.current.updateProjectionMatrix()},[l,s]),Ye.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),Ye.useLayoutEffect(()=>{if(i){const g=c;return a(()=>({camera:u.current})),()=>a(()=>({camera:g}))}},[u,i,a]);let d=0,p=null;const m=y9e(r);return Dg(g=>{m&&(n===1/0||d<n)&&(h.current.visible=!1,g.gl.setRenderTarget(f),p=g.scene.background,t&&(g.scene.background=t),g.gl.render(g.scene,u.current),g.scene.background=p,g.gl.setRenderTarget(null),h.current.visible=!0,d++)}),Ye.createElement(Ye.Fragment,null,Ye.createElement("orthographicCamera",tO({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:u},s),!m&&r),Ye.createElement("group",{ref:h},m&&r(f.texture)))});var Pk={exports:{}},S9e=Pk.exports,AG;function E9e(){return AG||(AG=1,(function(t,e){(function(n,r){t.exports=r()})(S9e,function(){var n=function(){function r(d){return o.appendChild(d.dom),d}function i(d){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===d?"block":"none";s=d}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),i(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,l=0,u=r(new n.Panel("FPS","#0ff","#002")),h=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=r(new n.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:r,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){l++;var d=(performance||Date).now();if(h.update(d-a,200),d>c+1e3&&(u.update(1e3*l/(d-c),100),c=d,l=0,f)){var p=performance.memory;f.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:o,setMode:i}};return n.Panel=function(r,i,s){var o=1/0,a=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,h=48*l,f=3*l,d=2*l,p=3*l,m=15*l,g=74*l,_=30*l,y=document.createElement("canvas");y.width=u,y.height=h,y.style.cssText="width:80px;height:48px";var v=y.getContext("2d");return v.font="bold "+9*l+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=s,v.fillRect(0,0,u,h),v.fillStyle=i,v.fillText(r,f,d),v.fillRect(p,m,g,_),v.fillStyle=s,v.globalAlpha=.9,v.fillRect(p,m,g,_),{dom:y,update:function(E,x){o=Math.min(o,E),a=Math.max(a,E),v.fillStyle=s,v.globalAlpha=1,v.fillRect(0,0,u,m),v.fillStyle=i,v.fillText(c(E)+" "+r+" ("+c(o)+"-"+c(a)+")",f,d),v.drawImage(y,p+l,m,g-l,_,p,m,g-l,_),v.fillRect(p+g-l,m,l,_),v.fillStyle=s,v.globalAlpha=.9,v.fillRect(p+g-l,m,l,c((1-E/x)*_))}}},n})})(Pk)),Pk.exports}var x9e=E9e();const w9e=_u(x9e);function H2(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(l){try{c(r.next(l))}catch(u){s(u)}}function a(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof n?u:new n((function(h){h(u)}))).then(o,a)}c((r=r.apply(t,[])).next())}))}const T9e=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function CG(t){return t=t.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const Rre=typeof window>"u",um=(()=>{if(Rre)return;const{userAgent:t,platform:e,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(t),i=e==="iPad"||e==="MacIntel"&&n>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(t)||r||i,isSafari12:/Version\/12.+Safari/.test(t),isFirefox:/Firefox/.test(t)}})();function A9e(t,e,n){if(!n)return[e];const r=(function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,f=l.createShader(35633),d=l.createShader(35632),p=l.createProgram();if(!(d&&f&&p))return;l.shaderSource(f,u),l.shaderSource(d,h),l.compileShader(f),l.compileShader(d),l.attachShader(p,f),l.attachShader(p,d),l.linkProgram(p),l.detachShader(p,f),l.detachShader(p,d),l.deleteShader(f),l.deleteShader(d),l.useProgram(p);const m=l.createBuffer();l.bindBuffer(34962,m),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const g=l.getAttribLocation(p,"aPosition");l.vertexAttribPointer(g,3,5126,!1,0,0),l.enableVertexAttribArray(g),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const _=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,_),l.deleteProgram(p),l.deleteBuffer(m),_.join("")})(t),i="801621810",s="8016218135",o="80162181161",a=um?.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return r==="80162181255"?c=a.filter((([,,l])=>l>=14)):(c=a.filter((([,l])=>l===r)),c.length||(c=a)),c.map((([l])=>`apple ${l} gpu`))}class RG extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const $2=[],kG=[];function C9e(t,e){if(t===e)return 0;const n=t;t.length>e.length&&(t=e,e=n);let r=t.length,i=e.length;for(;r>0&&t.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let s,o=0;for(;o<r&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,i-=o,r===0)return i;let a,c,l=0,u=0,h=0;for(;u<r;)kG[u]=t.charCodeAt(o+u),$2[u]=++u;for(;h<i;)for(s=e.charCodeAt(o+h),a=h++,l=h,u=0;u<r;u++)c=s===kG[u]?a:a+1,a=$2[u],l=$2[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function R9e(t){return t!=null}const k9e=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>H2(void 0,void 0,void 0,(function*(){const o={};if(Rre)return{tier:0,type:"SSR"};const{isIpad:a=!!um?.isIpad,isMobile:c=!!um?.isMobile,screenSize:l=window.screen,loadBenchmarks:u=(x=>H2(void 0,void 0,void 0,(function*(){const A=yield fetch(`${s}/${x}`).then((T=>T.json()));if(parseInt(A.shift().split(".")[0],10)<4)throw new RG("Detect GPU benchmark data is out of date. Please update to version 4x");return A})))}=n;let{renderer:h}=n;const f=(x,A,T,k,L)=>({device:L,fps:k,gpu:T,isMobile:c,tier:x,type:A});let d,p="";if(h)h=CG(h),d=[h];else{const x=r||(function(T,k=!1){const L={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:k,powerPreference:"high-performance",stencil:!1};T&&delete L.powerPreference;const I=window.document.createElement("canvas"),F=I.getContext("webgl",L)||I.getContext("experimental-webgl",L);return F??void 0})(um?.isSafari12,i);if(!x)return f(0,"WEBGL_UNSUPPORTED");const A=um?.isFirefox?null:x.getExtension("WEBGL_debug_renderer_info");if(h=A?x.getParameter(A.UNMASKED_RENDERER_WEBGL):x.getParameter(x.RENDERER),!h)return f(1,"FALLBACK");p=h,h=CG(h),d=(function(T,k,L){return k==="apple gpu"?A9e(T,k,L):[k]})(x,h,c)}const m=(yield Promise.all(d.map((function(x){var A;return H2(this,void 0,void 0,(function*(){const T=(Z=>{const Q=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const ie of Q)if(Z.includes(ie))return ie})(x);if(!T)return;const k=`${c?"m":"d"}-${T}${a?"-ipad":""}.json`,L=o[k]=(A=o[k])!==null&&A!==void 0?A:u(k);let I;try{I=yield L}catch(Z){if(Z instanceof RG)throw Z;return}const F=(function(Z){var Q;const ie=(Z=Z.replace(/\([^)]+\)/,"")).match(/\d+/)||Z.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(Q=ie?.join("").replace(/\W|amd/g,""))!==null&&Q!==void 0?Q:""})(x);let M=I.filter((([,Z])=>Z===F));M.length||(M=I.filter((([Z])=>Z.includes(x))));const D=M.length;if(D===0)return;const O=x.split(/[.,()\[\]/\s]/g).sort().filter(((Z,Q,ie)=>Q===0||Z!==ie[Q-1])).join(" ");let z,[q,,,,G]=D>1?M.map((Z=>[Z,C9e(O,Z[2])])).sort((([,Z],[,Q])=>Z-Q))[0][0]:M[0],K=Number.MAX_VALUE;const{devicePixelRatio:te}=window,re=l.width*te*l.height*te;for(const Z of G){const[Q,ie]=Z,ge=Q*ie,Te=Math.abs(re-ge);Te<K&&(K=Te,z=Z)}if(!z)return;const[,,H,Y]=z;return[K,H,q,Y]}))})))).filter(R9e).sort((([x=Number.MAX_VALUE,A],[T=Number.MAX_VALUE,k])=>x===T?A-k:x-T));if(!m.length){const x=T9e.find((A=>h.includes(A)));return x?f(0,"BLOCKLISTED",x):f(1,"FALLBACK",`${h} (${p})`)}const[,g,_,y]=m[0];if(g===-1)return f(0,"BLOCKLISTED",_,g,y);const v=c?t:e;let E=0;for(let x=0;x<v.length;x++)g>=v[x]&&(E=x);return f(E,"BENCHMARK",_,g,y)})),M9e=t=>Eq(()=>k9e(t),["useDetectGPU"]);function O9e(t,e){const n=t+"Geometry";return Ye.forwardRef(({args:r,children:i,...s},o)=>{const a=Ye.useRef(null);return Ye.useImperativeHandle(o,()=>a.current),Ye.useLayoutEffect(()=>{e?.(a.current)}),Ye.createElement("mesh",tO({ref:a},s),Ye.createElement(n,{attach:"geometry",args:r}),i)})}const I9e=O9e("plane");var G2=1/1e3,N9e=1e3,P9e=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(t){typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=t)}get delta(){return this._delta*G2}get fixedDelta(){return this._fixedDelta*G2}set fixedDelta(t){this._fixedDelta=t*N9e}get elapsed(){return this._elapsed*G2}update(t){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(t!==void 0?t:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(t){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},D9e=(()=>{const t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),n=new jm;return n.setAttribute("position",new hh(t,3)),n.setAttribute("uv",new hh(e,2)),n})(),wh=class _4{static get fullscreenGeometry(){return D9e}constructor(e="Pass",n=new Jk,r=new EO){this.name=e,this.renderer=null,this.scene=n,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const n=this.fullscreenMaterial;n!==null&&(n.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let n=this.screen;n!==null?n.material=e:(n=new ef(_4.fullscreenGeometry,e),n.frustumCulled=!1,this.scene===null&&(this.scene=new Jk),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,n=$1){}render(e,n,r,i,s){throw new Error("Render method not implemented!")}setSize(e,n){}initialize(e,n,r){}dispose(){for(const e of Object.keys(this)){const n=this[e];(n instanceof il||n instanceof W1||n instanceof hc||n instanceof _4)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},L9e=class extends wh{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,n,r,i){const s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},U9e=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,MC="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",kre=class extends ao{constructor(){super({name:"CopyMaterial",defines:{COLOR_SPACE_CONVERSION:"1",DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new un(null),depthBuffer:new un(null),channelWeights:new un(null),opacity:new un(1)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:U9e,vertexShader:MC}),this.depthFunc=qk}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(t){const e=t!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){const e=t!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}get colorSpaceConversion(){return this.defines.COLOR_SPACE_CONVERSION!==void 0}set colorSpaceConversion(t){this.colorSpaceConversion!==t&&(t?this.defines.COLOR_SPACE_CONVERSION=!0:delete this.defines.COLOR_SPACE_CONVERSION,this.needsUpdate=!0)}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(t){t!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=t):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},Mre=class extends wh{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new kre,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new il(1,1,{minFilter:Ml,magFilter:Ml,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,n,r,i){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,n){n!==void 0&&(this.renderTarget.texture.type=n,n!==ko?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t!==null&&t.outputColorSpace===Bi&&(this.renderTarget.texture.colorSpace=Bi))}},MG=new wi,Ore=class extends wh{constructor(t=!0,e=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,n){this.color=t,this.depth=e,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,n,r,i){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=t.getClearAlpha(),c=s!==null,l=o>=0;c?(t.getClearColor(MG),t.setClearColor(s,l?o:a)):l&&t.setClearAlpha(o),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),c?t.setClearColor(MG,a):l&&t.setClearAlpha(a)}},B9e=class extends wh{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new Ore(!1,!1,!0),this.inverse=!1}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,n,r,i){const s=t.getContext(),o=t.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(t,null):(l.render(t,e),l.render(t,n))),this.renderToScreen?(t.setRenderTarget(null),t.render(a,c)):(t.setRenderTarget(e),t.render(a,c),t.setRenderTarget(n),t.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},Ire=class{constructor(e=null,{depthBuffer:n=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(n,r,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Mre,this.depthTexture=null,this.passes=[],this.timer=new P9e,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const n=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(n.depthBuffer,n.stencilBuffer,n.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const n=e.getSize(new zn),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===ko&&e.outputColorSpace===Bi&&(this.inputBuffer.texture.colorSpace=Bi,this.outputBuffer.texture.colorSpace=Bi,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(n.width,n.height);for(const s of this.passes)s.initialize(e,r,i)}}replaceRenderer(e,n=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),n&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new SO;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=EE,e.type=SE):e.type=pv,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,n,r,i){const s=this.renderer,o=s===null?new zn:s.getDrawingBufferSize(new zn),a={minFilter:Ml,magFilter:Ml,stencilBuffer:n,depthBuffer:e,type:r},c=new il(o.width,o.height,a);return i>0&&(c.samples=i),r===ko&&s!==null&&s.outputColorSpace===Bi&&(c.texture.colorSpace=Bi),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const n of this.passes)n.mainScene=e}setMainCamera(e){for(const n of this.passes)n.mainCamera=e}addPass(e,n){const r=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new zn),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(s.width,s.height),e.initialize(i,o,a),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),n!==void 0?r.splice(n,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of r)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const n=this.passes,r=n.indexOf(e);if(r!==-1&&n.splice(r,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;n.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===n.length&&(e.renderToScreen=!1,n.length>0&&(n[n.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const n=this.renderer,r=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(n,i,s,e,o),u.needsSwap&&(o&&(r.renderToScreen=u.renderToScreen,a=n.getContext(),c=n.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),r.render(n,i,s,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=s,s=l),u instanceof B9e?o=!0:u instanceof L9e&&(o=!1))}setSize(e,n,r){const i=this.renderer,s=i.getSize(new zn);(e===void 0||n===void 0)&&(e=s.width,n=s.height),(s.width!==e||s.height!==n)&&i.setSize(e,n,r);const o=i.getDrawingBufferSize(new zn);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),wh.fullscreenGeometry.dispose()}},du={NONE:0,DEPTH:1,CONVOLUTION:2},Qi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},F9e=class{constructor(){this.shaderParts=new Map([[Qi.FRAGMENT_HEAD,null],[Qi.FRAGMENT_MAIN_UV,null],[Qi.FRAGMENT_MAIN_IMAGE,null],[Qi.VERTEX_HEAD,null],[Qi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=du.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Cg}},W2=!1,OG=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let n;if(e.material.flatShading)switch(e.material.side){case Oa:n=this.materialsFlatShadedDoubleSide;break;case Ic:n=this.materialsFlatShadedBackSide;break;default:n=this.materialsFlatShaded;break}else switch(e.material.side){case Oa:n=this.materialsDoubleSide;break;case Ic:n=this.materialsBackSide;break;default:n=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=n[2]:e.isInstancedMesh?e.material=n[1]:e.material=n[0],++this.meshCount}}}cloneMaterial(t){if(!(t instanceof ao))return t.clone();const e=t.uniforms,n=new Map;for(const i in e){const s=e[i].value;s.isRenderTargetTexture&&(e[i].value=null,n.set(i,s))}const r=t.clone();for(const i of n)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){const e=this.materials=[this.cloneMaterial(t),this.cloneMaterial(t),this.cloneMaterial(t)];for(const n of e)n.uniforms=Object.assign({},t.uniforms),n.side=Ag;e[2].skinning=!0,this.materialsBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=Ic,r}),this.materialsDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=Oa,r}),this.materialsFlatShaded=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=Ic,r}),this.materialsFlatShadedDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=Oa,r})}}render(t,e,n){const r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,W2){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,n);for(const s of i)s[0].material=s[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,n),e.overrideMaterial=i}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return W2}static set workaroundEnabled(t){W2=t}},G_=-1,tf=class extends Pg{constructor(t,e=G_,n=G_,r=1){super(),this.resizable=t,this.baseSize=new zn(1,1),this.preferredSize=new zn(e,n),this.target=this.preferredSize,this.s=r,this.effectiveSize=new zn,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const t=this.baseSize,e=this.preferredSize,n=this.effectiveSize,r=this.scale;e.width!==G_?n.width=e.width:e.height!==G_?n.width=Math.round(e.height*(t.width/Math.max(t.height,1))):n.width=Math.round(t.width*r),e.height!==G_?n.height=e.height:e.width!==G_?n.height=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):n.height=Math.round(t.height*r)}get width(){return this.effectiveSize.width}set width(t){this.preferredWidth=t}get height(){return this.effectiveSize.height}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferredSize.setScalar(G_),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.baseSize.width}set baseWidth(t){this.baseSize.width!==t&&(this.baseSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(t){this.baseWidth=t}get baseHeight(){return this.baseSize.height}set baseHeight(t){this.baseSize.height!==t&&(this.baseSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.baseSize.width!==t||this.baseSize.height!==e)&&(this.baseSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(t){this.preferredSize.width!==t&&(this.preferredSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferredSize.height}set preferredHeight(t){this.preferredSize.height!==t&&(this.preferredSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferredSize.width!==t||this.preferredSize.height!==e)&&(this.preferredSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(t){this.s=t.scale,this.baseSize.set(t.baseWidth,t.baseHeight),this.preferredSize.set(t.preferredWidth,t.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return G_}},di={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},j9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",z9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,src.a*opacity);}",V9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=(dst.rgb+src.rgb)*0.5;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",H9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.xy,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",$9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/max(b,1e-9))),vec3(1.0),step(1.0,a));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",G9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",W9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",q9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=abs(dst.rgb-src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Y9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb/max(src.rgb,1e-9);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",K9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-2.0*dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",X9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb,1.0);vec3 b=min(src.rgb,1.0);vec3 c=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",J9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=step(1.0,dst.rgb+src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Z9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.x,a.yz));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Q9e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",eze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=src.rgb*max(1.0-dst.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",tze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",nze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",rze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb+src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",ize="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(2.0*src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",sze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.xy,b.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",oze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",aze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-abs(1.0-dst.rgb-src.rgb),0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",cze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,opacity);}",lze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=2.0*src.rgb*dst.rgb;vec3 b=1.0-2.0*(1.0-src.rgb)*(1.0-dst.rgb);vec3 c=mix(a,b,step(0.5,dst.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",uze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 c=mix(mix(src2,dst.rgb,step(0.5*dst.rgb,src.rgb)),max(src2-1.0,vec3(0.0)),step(dst.rgb,src2-1.0));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",hze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb*dst.rgb/max(1.0-src.rgb,1e-9),1.0);vec3 c=mix(a,src.rgb,step(1.0,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",fze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.x,b.y,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",dze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-min(dst.rgb*src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",pze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 d=dst.rgb+(src2-1.0);vec3 w=step(0.5,src.rgb);vec3 a=dst.rgb-(1.0-src2)*dst.rgb*(1.0-dst.rgb);vec3 b=mix(d*(sqrt(dst.rgb)-dst.rgb),d*dst.rgb*((16.0*dst.rgb-12.0)*dst.rgb+3.0),w*(1.0-step(0.25,dst.rgb)));vec3 c=mix(a,b,w);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",mze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return src;}",gze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",_ze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=mix(max(1.0-min((1.0-dst.rgb)/(2.0*src.rgb),1.0),0.0),min(dst.rgb/(2.0*(1.0-src.rgb)),1.0),step(0.5,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",vze=new Map([[di.ADD,j9e],[di.ALPHA,z9e],[di.AVERAGE,V9e],[di.COLOR,H9e],[di.COLOR_BURN,$9e],[di.COLOR_DODGE,G9e],[di.DARKEN,W9e],[di.DIFFERENCE,q9e],[di.DIVIDE,Y9e],[di.DST,null],[di.EXCLUSION,K9e],[di.HARD_LIGHT,X9e],[di.HARD_MIX,J9e],[di.HUE,Z9e],[di.INVERT,Q9e],[di.INVERT_RGB,eze],[di.LIGHTEN,tze],[di.LINEAR_BURN,nze],[di.LINEAR_DODGE,rze],[di.LINEAR_LIGHT,ize],[di.LUMINOSITY,sze],[di.MULTIPLY,oze],[di.NEGATION,aze],[di.NORMAL,cze],[di.OVERLAY,lze],[di.PIN_LIGHT,uze],[di.REFLECT,hze],[di.SATURATION,fze],[di.SCREEN,dze],[di.SOFT_LIGHT,pze],[di.SRC,mze],[di.SUBTRACT,gze],[di.VIVID_LIGHT,_ze]]),yze=class extends Pg{constructor(t,e=1){super(),this._blendFunction=t,this.opacity=new un(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this._blendFunction}set blendFunction(t){this._blendFunction=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return vze.get(this.blendFunction)}},od=class extends Pg{constructor(t,e,{attributes:n=du.NONE,blendFunction:r=di.NORMAL,defines:i=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=t,this.renderer=null,this.attributes=n,this.fragmentShader=e,this.vertexShader=a,this.defines=i,this.uniforms=s,this.extensions=o,this.blendMode=new yze(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Cg,this._outputColorSpace=bm}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(t){this._inputColorSpace=t,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t,this.setChanged()}set mainScene(t){}set mainCamera(t){}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=$1){}update(t,e,n){}setSize(t,e){}initialize(t,e,n){}dispose(){for(const t of Object.keys(this)){const e=this[t];(e instanceof il||e instanceof W1||e instanceof hc||e instanceof wh)&&this[t].dispose()}}},OC={MEDIUM:2,LARGE:3,VERY_LARGE:4},bze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Sze="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Eze=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],xze=class extends ao{constructor(t=new qo){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new un(null),texelSize:new un(new qo),scale:new un(1),kernel:new un(0)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:bze,vertexShader:Sze}),this.setTexelSize(t.x,t.y),this.kernelSize=OC.MEDIUM}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.inputBuffer=t}get kernelSequence(){return Eze[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(){return this.uniforms.scale.value}setScale(t){this.uniforms.scale.value=t}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(t){this.uniforms.kernel.value=t}setKernel(t){this.kernel=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e,t*.5,e*.5)}setSize(t,e){const n=1/t,r=1/e;this.uniforms.texelSize.value.set(n,r,n*.5,r*.5)}},Nre=class extends wh{constructor({kernelSize:t=OC.MEDIUM,resolutionScale:e=.5,width:n=tf.AUTO_SIZE,height:r=tf.AUTO_SIZE,resolutionX:i=n,resolutionY:s=r}={}){super("KawaseBlurPass"),this.renderTargetA=new il(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new tf(this,i,s,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new xze,this._blurMaterial.kernelSize=t,this.copyMaterial=new kre}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(t){this._blurMaterial=t}get dithering(){return this.copyMaterial.dithering}set dithering(t){this.copyMaterial.dithering=t}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(t){this.blurMaterial.kernelSize=t}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get scale(){return this.blurMaterial.scale}set scale(t){this.blurMaterial.scale=t}getScale(){return this.blurMaterial.scale}setScale(t){this.blurMaterial.scale=t}getKernelSize(){return this.kernelSize}setKernelSize(t){this.kernelSize=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,n,r,i){const s=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let f=0,d=u.length;f<d;++f){const p=(f&1)===0?a:c;l.kernel=u[f],l.inputBuffer=h.texture,t.setRenderTarget(p),t.render(s,o),h=p}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,t.setRenderTarget(this.renderToScreen?null:n),t.render(s,o)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e);const r=n.width,i=n.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(t,e)}initialize(t,e,n){n!==void 0&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==ko?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):t!==null&&t.outputColorSpace===Bi&&(this.renderTargetA.texture.colorSpace=Bi,this.renderTargetB.texture.colorSpace=Bi))}static get AUTO_SIZE(){return tf.AUTO_SIZE}},wze=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,Tze=class extends ao{constructor(t=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:UA.replace(/\D+/g,"")},uniforms:{inputBuffer:new un(null),threshold:new un(0),smoothing:new un(1),range:new un(null)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:wze,vertexShader:MC}),this.colorOutput=t,this.luminanceRange=e}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get threshold(){return this.uniforms.threshold.value}set threshold(t){this.smoothing>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=t}getThreshold(){return this.threshold}setThreshold(t){this.threshold=t}get smoothing(){return this.uniforms.smoothing.value}set smoothing(t){this.threshold>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=t}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(t){this.smoothing=t}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(t){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(t){return this.colorOutput}setColorOutputEnabled(t){this.colorOutput=t}get useRange(){return this.luminanceRange!==null}set useRange(t){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(t){t!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=t,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(t){this.luminanceRange=t}},Aze=class extends wh{constructor({renderTarget:t,luminanceRange:e,colorOutput:n,resolutionScale:r=1,width:i=tf.AUTO_SIZE,height:s=tf.AUTO_SIZE,resolutionX:o=i,resolutionY:a=s}={}){super("LuminancePass"),this.fullscreenMaterial=new Tze(n,e),this.needsSwap=!1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new il(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new tf(this,o,a,r);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(t,e,n,r,i){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height)}initialize(t,e,n){n!==void 0&&n!==ko&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Cze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Rze="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",kze=class extends ao{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new un(null),texelSize:new un(new zn)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Cze,vertexShader:Rze})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},Mze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Oze="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Ize=class extends ao{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new un(null),supportBuffer:new un(null),texelSize:new un(new zn),radius:new un(.85)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Mze,vertexShader:Oze})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}set supportBuffer(t){this.uniforms.supportBuffer.value=t}get radius(){return this.uniforms.radius.value}set radius(t){this.uniforms.radius.value=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},Nze=class extends wh{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new il(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new kze,this.upsamplingMaterial=new Ize,this.resolution=new zn}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(t){if(this.levels!==t){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let n=0;n<t;++n){const r=e.clone();r.texture.name="Downsampling.Mipmap"+n,this.downsamplingMipmaps.push(r)}this.upsamplingMipmaps.push(e);for(let n=1,r=t-1;n<r;++n){const i=e.clone();i.texture.name="Upsampling.Mipmap"+n,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(t){this.upsamplingMaterial.radius=t}render(t,e,n,r,i){const{scene:s,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=e;this.fullscreenMaterial=a;for(let f=0,d=l.length;f<d;++f){const p=l[f];a.setSize(h.width,h.height),a.inputBuffer=h.texture,t.setRenderTarget(p),t.render(s,o),h=p}this.fullscreenMaterial=c;for(let f=u.length-1;f>=0;--f){const d=u[f];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[f].texture,t.setRenderTarget(d),t.render(s,o),h=d}}setSize(t,e){const n=this.resolution;n.set(t,e);let r=n.width,i=n.height;for(let s=0,o=this.downsamplingMipmaps.length;s<o;++s)r=Math.round(r*.5),i=Math.round(i*.5),this.downsamplingMipmaps[s].setSize(r,i),s<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[s].setSize(r,i)}initialize(t,e,n){if(n!==void 0){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of r)i.texture.type=n;if(n!==ko)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(t!==null&&t.outputColorSpace===Bi)for(const i of r)i.texture.colorSpace=Bi}}dispose(){super.dispose();for(const t of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))t.dispose()}},Pze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=texture2D(map,uv)*intensity;}`,Dze=class extends od{constructor({blendFunction:t=di.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:n=.03,mipmapBlur:r=!0,intensity:i=1,radius:s=.85,levels:o=8,kernelSize:a=OC.LARGE,resolutionScale:c=.5,width:l=tf.AUTO_SIZE,height:u=tf.AUTO_SIZE,resolutionX:h=l,resolutionY:f=u}={}){super("BloomEffect",Pze,{blendFunction:t,uniforms:new Map([["map",new un(null)],["intensity",new un(i)]])}),this.renderTarget=new il(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Nre({kernelSize:a}),this.luminancePass=new Aze({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=n,this.mipmapBlurPass=new Nze,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=s,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const d=this.resolution=new tf(this,h,f,c);d.addEventListener("change",p=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(t){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,n){const r=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(t,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(t,i.renderTarget):this.blurPass.render(t,i.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(t,e):this.blurPass.render(t,e,r)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n),this.luminancePass.setSize(t,e),this.mipmapBlurPass.setSize(t,e)}initialize(t,e,n){this.blurPass.initialize(t,e,n),this.luminancePass.initialize(t,e,n),this.mipmapBlurPass.initialize(t,e,n),n!==void 0&&(this.renderTarget.texture.type=n,t!==null&&t.outputColorSpace===Bi&&(this.renderTarget.texture.colorSpace=Bi))}},iE={RED:0,GREEN:1,BLUE:2,ALPHA:3},EU={DISCARD:0,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},Lze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,KR=class extends ao{constructor(t=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:t?"2":"1"},uniforms:{inputBuffer:new un(null),cocBuffer:new un(null),texelSize:new un(new zn),kernel64:new un(null),kernel16:new un(null),scale:new un(1)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Lze,vertexShader:MC}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set cocBuffer(t){this.uniforms.cocBuffer.value=t}setCoCBuffer(t){this.uniforms.cocBuffer.value=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(t){return this.scale}setScale(t){this.scale=t}generateKernel(){const t=2.39996323,e=new Float64Array(128),n=new Float64Array(32);let r=0,i=0;for(let s=0,o=Math.sqrt(80);s<80;++s){const a=s*t,c=Math.sqrt(s)/o,l=c*Math.cos(a),u=c*Math.sin(a);s%5===0?(n[i++]=l,n[i++]=u):(e[r++]=l,e[r++]=u)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=n}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},Uze=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform mat4 projectionMatrix;uniform mat4 projectionMatrixInverse;uniform float cameraNear;uniform float cameraFar;uniform float focusDistance;uniform float focusRange;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}
#ifdef PERSPECTIVE_CAMERA
#define getViewZ(depth) perspectiveDepthToViewZ(depth, cameraNear, cameraFar)
#else
#define getViewZ(depth) orthographicDepthToViewZ(depth, cameraNear, cameraFar)
#endif
vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(projectionMatrixInverse*clipPosition).xyz;}vec3 getViewPosition(const in vec2 screenPosition,const in float depth){return getViewPosition(screenPosition,depth,getViewZ(depth));}
#define getDistance(viewPosition) length(viewPosition)
void main(){float depth=readDepth(vUv);vec3 viewPosition=getViewPosition(vUv,depth);float distance=getDistance(viewPosition);float signedDistance=distance-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Bze=class extends ao{constructor(t=null){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new un(null),projectionMatrix:new un(null),projectionMatrixInverse:new un(null),cameraNear:new un(.3),cameraFar:new un(1e3),focusDistance:new un(0),focusRange:new un(0)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Uze,vertexShader:MC}),this.uniforms.focalLength=this.uniforms.focusRange,t!==null&&this.copyCameraSettings(t)}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=$1){this.depthBuffer=t,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(t){this.uniforms.focusDistance.value=t}get worldFocusDistance(){return this.focusDistance}set worldFocusDistance(t){this.focusDistance=t}getFocusDistance(t){this.uniforms.focusDistance.value=t}setFocusDistance(t){this.uniforms.focusDistance.value=t}get focalLength(){return this.focusRange}set focalLength(t){this.focusRange=t}get focusRange(){return this.uniforms.focusRange.value}set focusRange(t){this.uniforms.focusRange.value=t}get worldFocusRange(){return this.focusRange}set worldFocusRange(t){this.focusRange=t}getFocalLength(t){return this.focusRange}setFocalLength(t){this.focusRange=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){this.uniforms.projectionMatrix.value=t.projectionMatrix,this.uniforms.projectionMatrixInverse.value=t.projectionMatrixInverse,this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far;const e=this.defines.PERSPECTIVE_CAMERA!==void 0;t instanceof su?e||(this.defines.PERSPECTIVE_CAMERA=!0,this.needsUpdate=!0):e&&(delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Fze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=(mask>0.0)?0.0:1.0;
#else
mask=(mask>0.0)?1.0:0.0;
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,jze=class extends ao{constructor(t=null){super({name:"MaskMaterial",uniforms:{maskTexture:new un(t),inputBuffer:new un(null),strength:new un(1)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Fze,vertexShader:MC}),this.colorChannel=iE.RED,this.maskFunction=EU.DISCARD}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set maskTexture(t){this.uniforms.maskTexture.value=t,delete this.defines.MASK_PRECISION_HIGH,t.type!==ko&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(t){this.maskTexture=t}set colorChannel(t){this.defines.COLOR_CHANNEL=t.toFixed(0),this.needsUpdate=!0}setColorChannel(t){this.colorChannel=t}set maskFunction(t){this.defines.MASK_FUNCTION=t.toFixed(0),this.needsUpdate=!0}setMaskFunction(t){this.maskFunction=t}get inverted(){return this.defines.INVERTED!==void 0}set inverted(t){this.inverted&&!t?delete this.defines.INVERTED:t&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(t){this.inverted=t}get strength(){return this.uniforms.strength.value}set strength(t){this.uniforms.strength.value=t}getStrength(){return this.strength}setStrength(t){this.strength=t}},IS=class extends wh{constructor(t,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=t,this.input=e}setInput(t){this.input=t}render(t,e,n,r,i){const s=this.fullscreenMaterial.uniforms;e!==null&&s!==void 0&&s[this.input]!==void 0&&(s[this.input].value=e.texture),t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}initialize(t,e,n){n!==void 0&&n!==ko&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},zze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
#if MASK_FUNCTION != 1 && MASK_FUNCTION != 2
uniform lowp sampler2D farCoCBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1 || MASK_FUNCTION == 2
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);colorFar.a*=cocNearFar.y;
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,Vze=new zt,Hze=class extends od{constructor(t,{blendFunction:e,worldFocusDistance:n,worldFocusRange:r,focalLength:i,focusDistance:s=n||3,focusRange:o=r||i||2,bokehScale:a=1,resolutionScale:c=.5,width:l,height:u,resolutionX:h=l||tf.AUTO_SIZE,resolutionY:f=u||tf.AUTO_SIZE}={}){super("DepthOfFieldEffect",zze,{blendFunction:e,attributes:du.DEPTH,uniforms:new Map([["nearColorBuffer",new un(null)],["farColorBuffer",new un(null)],["nearCoCBuffer",new un(null)],["farCoCBuffer",new un(null)],["scale",new un(1)]])}),this.camera=t,this.renderTarget=new il(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new IS(new Bze(t));const d=this.cocMaterial;d.focusDistance=s,d.focusRange=o,this.blurPass=new Nre({resolutionScale:c,resolutionX:h,resolutionY:f,kernelSize:OC.MEDIUM}),this.maskPass=new IS(new jze(this.renderTargetCoC.texture));const p=this.maskPass.fullscreenMaterial;p.colorChannel=iE.GREEN,this.maskFunction=EU.MULTIPLY_RGB,this.bokehNearBasePass=new IS(new KR(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new IS(new KR(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new IS(new KR(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new IS(new KR(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const m=this.resolution=new tf(this,h,f,c);m.addEventListener("change",g=>this.setSize(m.baseWidth,m.baseHeight)),this.bokehScale=a}set mainCamera(t){this.camera=t,this.cocMaterial.copyCameraSettings(t)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(t){this.maskFunction!==t&&(this.defines.set("MASK_FUNCTION",t.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=t,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(t){this.bokehNearBasePass.fullscreenMaterial.scale=t,this.bokehNearFillPass.fullscreenMaterial.scale=t,this.bokehFarBasePass.fullscreenMaterial.scale=t,this.bokehFarFillPass.fullscreenMaterial.scale=t,this.maskPass.fullscreenMaterial.strength=t,this.uniforms.get("scale").value=t}getBokehScale(){return this.bokehScale}setBokehScale(t){this.bokehScale=t}getTarget(){return this.target}setTarget(t){this.target=t}calculateFocusDistance(t){return this.camera.getWorldPosition(Vze).distanceTo(t)}setDepthTexture(t,e=$1){this.cocMaterial.depthBuffer=t,this.cocMaterial.depthPacking=e}update(t,e,n){const r=this.renderTarget,i=this.renderTargetCoC,s=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(t,null,i),this.blurPass.render(t,i,s),this.maskPass.render(t,e,o),this.bokehFarBasePass.render(t,o,r),this.bokehFarFillPass.render(t,r,this.renderTargetFar),this.bokehNearBasePass.render(t,e,r),this.bokehNearFillPass.render(t,r,this.renderTargetNear)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e);const r=n.width,i=n.height;this.cocPass.setSize(t,e),this.blurPass.setSize(t,e),this.maskPass.setSize(t,e),this.renderTargetFar.setSize(t,e),this.renderTargetCoC.setSize(t,e),this.renderTargetMasked.setSize(t,e),this.renderTarget.setSize(r,i),this.renderTargetNear.setSize(r,i),this.renderTargetCoCBlurred.setSize(r,i),this.bokehNearBasePass.fullscreenMaterial.setSize(t,e),this.bokehNearFillPass.fullscreenMaterial.setSize(t,e),this.bokehFarBasePass.fullscreenMaterial.setSize(t,e),this.bokehFarFillPass.fullscreenMaterial.setSize(t,e)}initialize(t,e,n){this.cocPass.initialize(t,e,n),this.maskPass.initialize(t,e,n),this.bokehNearBasePass.initialize(t,e,n),this.bokehNearFillPass.initialize(t,e,n),this.bokehFarBasePass.initialize(t,e,n),this.bokehFarFillPass.initialize(t,e,n),this.blurPass.initialize(t,e,ko),t.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),n!==void 0&&(this.renderTarget.texture.type=n,this.renderTargetNear.texture.type=n,this.renderTargetFar.texture.type=n,this.renderTargetMasked.texture.type=n,t!==null&&t.outputColorSpace===Bi&&(this.renderTarget.texture.colorSpace=Bi,this.renderTargetNear.texture.colorSpace=Bi,this.renderTargetFar.texture.colorSpace=Bi,this.renderTargetMasked.texture.colorSpace=Bi))}},nv={DISABLED:0,SPORADIC:1,CONSTANT_MILD:2,CONSTANT_WILD:3};function $ze(t,e,n){const r=new Map([[BA,1],[q4,2],[lu,4]]);let i;if(r.has(e)||console.error("Invalid noise texture format"),n===ko){i=new Uint8Array(t*r.get(e));for(let s=0,o=i.length;s<o;++s)i[s]=Math.random()*255+.5}else{i=new Float32Array(t*r.get(e));for(let s=0,o=i.length;s<o;++s)i[s]=Math.random()}return i}var IG=class extends bO{constructor(t,e,n=BA,r=ko){super($ze(t*e,n,r),t,e,n,r),this.needsUpdate=!0}},Gze="uniform lowp sampler2D perturbationMap;uniform bool active;uniform float columns;uniform float random;uniform vec2 seeds;uniform vec2 distortion;void mainUv(inout vec2 uv){if(active){if(uv.y<distortion.x+columns&&uv.y>distortion.x-columns*random){float sx=clamp(ceil(seeds.x),0.0,1.0);uv.y=sx*(1.0-(uv.y+distortion.y))+(1.0-sx)*distortion.y;}if(uv.x<distortion.y+columns&&uv.x>distortion.y-columns*random){float sy=clamp(ceil(seeds.y),0.0,1.0);uv.x=sy*distortion.x+(1.0-sy)*(1.0-(uv.x+distortion.x));}vec2 normal=texture2D(perturbationMap,uv*random*random).rg;uv+=normal*seeds*(random*0.2);}}",XR="Glitch.Generated";function Zu(t,e){return t+Math.random()*(e-t)}var Wze=class extends od{constructor({chromaticAberrationOffset:t=null,delay:e=new zn(1.5,3.5),duration:n=new zn(.6,1),strength:r=new zn(.3,1),columns:i=.05,ratio:s=.85,perturbationMap:o=null,dtSize:a=64}={}){if(super("GlitchEffect",Gze,{uniforms:new Map([["perturbationMap",new un(null)],["columns",new un(i)],["active",new un(!1)],["random",new un(1)],["seeds",new un(new zn)],["distortion",new un(new zn)]])}),o===null){const c=new IG(a,a,lu);c.name=XR,this.perturbationMap=c}else this.perturbationMap=o;this.time=0,this.distortion=this.uniforms.get("distortion").value,this.delay=e,this.duration=n,this.breakPoint=new zn(Zu(this.delay.x,this.delay.y),Zu(this.duration.x,this.duration.y)),this.strength=r,this.mode=nv.SPORADIC,this.ratio=s,this.chromaticAberrationOffset=t}get seeds(){return this.uniforms.get("seeds").value}get active(){return this.uniforms.get("active").value}isActive(){return this.active}get minDelay(){return this.delay.x}set minDelay(t){this.delay.x=t}getMinDelay(){return this.delay.x}setMinDelay(t){this.delay.x=t}get maxDelay(){return this.delay.y}set maxDelay(t){this.delay.y=t}getMaxDelay(){return this.delay.y}setMaxDelay(t){this.delay.y=t}get minDuration(){return this.duration.x}set minDuration(t){this.duration.x=t}getMinDuration(){return this.duration.x}setMinDuration(t){this.duration.x=t}get maxDuration(){return this.duration.y}set maxDuration(t){this.duration.y=t}getMaxDuration(){return this.duration.y}setMaxDuration(t){this.duration.y=t}get minStrength(){return this.strength.x}set minStrength(t){this.strength.x=t}getMinStrength(){return this.strength.x}setMinStrength(t){this.strength.x=t}get maxStrength(){return this.strength.y}set maxStrength(t){this.strength.y=t}getMaxStrength(){return this.strength.y}setMaxStrength(t){this.strength.y=t}getMode(){return this.mode}setMode(t){this.mode=t}getGlitchRatio(){return 1-this.ratio}setGlitchRatio(t){this.ratio=Math.min(Math.max(1-t,0),1)}get columns(){return this.uniforms.get("columns").value}set columns(t){this.uniforms.get("columns").value=t}getGlitchColumns(){return this.columns}setGlitchColumns(t){this.columns=t}getChromaticAberrationOffset(){return this.chromaticAberrationOffset}setChromaticAberrationOffset(t){this.chromaticAberrationOffset=t}get perturbationMap(){return this.uniforms.get("perturbationMap").value}set perturbationMap(t){const e=this.perturbationMap;e!==null&&e.name===XR&&e.dispose(),t.minFilter=t.magFilter=Il,t.wrapS=t.wrapT=Yk,t.generateMipmaps=!1,this.uniforms.get("perturbationMap").value=t}getPerturbationMap(){return this.perturbationMap}setPerturbationMap(t){this.perturbationMap=t}generatePerturbationMap(t=64){const e=new IG(t,t,lu);return e.name=XR,e}update(t,e,n){const r=this.mode,i=this.breakPoint,s=this.chromaticAberrationOffset,o=this.strength;let a=this.time,c=!1,l=0,u=0,h;r!==nv.DISABLED&&(r===nv.SPORADIC&&(a+=n,h=a>i.x,a>=i.x+i.y&&(i.set(Zu(this.delay.x,this.delay.y),Zu(this.duration.x,this.duration.y)),a=0)),l=Math.random(),this.uniforms.get("random").value=l,h&&l>this.ratio||r===nv.CONSTANT_WILD?(c=!0,l*=o.y*.03,u=Zu(-Math.PI,Math.PI),this.seeds.set(Zu(-o.y,o.y),Zu(-o.y,o.y)),this.distortion.set(Zu(0,1),Zu(0,1))):(h||r===nv.CONSTANT_MILD)&&(c=!0,l*=o.x*.03,u=Zu(-Math.PI,Math.PI),this.seeds.set(Zu(-o.x,o.x),Zu(-o.x,o.x)),this.distortion.set(Zu(0,1),Zu(0,1))),this.time=a),s!==null&&(c?s.set(Math.cos(u),Math.sin(u)).multiplyScalar(l):s.set(0,0)),this.uniforms.get("active").value=c}dispose(){const t=this.perturbationMap;t!==null&&t.name===XR&&t.dispose()}},Pre=class extends wh{constructor(t,e,n=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new Ore,this.overrideMaterialManager=n===null?null:new OG(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){const t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){const e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new OG(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,n,r,i){const s=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=s.background,u=t.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,s,o):t.render(s,o),o.layers.mask=c,s.background=l,t.shadowMap.autoUpdate=u}},qS={DEFAULT:0,ESKIL:1},qze=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*(1.0+time)));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,Yze=class extends od{constructor({blendFunction:t=di.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",qze,{blendFunction:t}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(t){this.premultiply!==t&&(t?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(t){this.premultiply=t}},Kze=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,Xze=class extends od{constructor({blendFunction:t,eskil:e=!1,technique:n=e?qS.ESKIL:qS.DEFAULT,offset:r=.5,darkness:i=.5}={}){super("VignetteEffect",Kze,{blendFunction:t,defines:new Map([["VIGNETTE_TECHNIQUE",n.toFixed(0)]]),uniforms:new Map([["offset",new un(r)],["darkness",new un(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(t){this.technique!==t&&(this.defines.set("VIGNETTE_TECHNIQUE",t.toFixed(0)),this.setChanged())}get eskil(){return this.technique===qS.ESKIL}set eskil(t){this.technique=t?qS.ESKIL:qS.DEFAULT}getTechnique(){return this.technique}setTechnique(t){this.technique=t}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}get darkness(){return this.uniforms.get("darkness").value}set darkness(t){this.uniforms.get("darkness").value=t}getDarkness(){return this.darkness}setDarkness(t){this.darkness=t}},Jze=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Zze="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Qze=class extends ao{constructor(t,e,n,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:UA.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new un(null),depthBuffer:new un(null),resolution:new un(new zn),texelSize:new un(new zn),cameraNear:new un(.3),cameraFar:new un(1e3),aspect:new un(1),time:new un(0)},blending:rl,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),t&&this.setShaderParts(t),e&&this.setDefines(e),n&&this.setUniforms(n),this.copyCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=$1){this.depthBuffer=t,this.depthPacking=e}setShaderData(t){this.setShaderParts(t.shaderParts),this.setDefines(t.defines),this.setUniforms(t.uniforms),this.setExtensions(t.extensions)}setShaderParts(t){return this.fragmentShader=Jze.replace(Qi.FRAGMENT_HEAD,t.get(Qi.FRAGMENT_HEAD)||"").replace(Qi.FRAGMENT_MAIN_UV,t.get(Qi.FRAGMENT_MAIN_UV)||"").replace(Qi.FRAGMENT_MAIN_IMAGE,t.get(Qi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Zze.replace(Qi.VERTEX_HEAD,t.get(Qi.VERTEX_HEAD)||"").replace(Qi.VERTEX_MAIN_SUPPORT,t.get(Qi.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(t){for(const e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(const e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(const e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof su?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){const n=this.uniforms;n.resolution.value.set(t,e),n.texelSize.value.set(1/t,1/e),n.aspect.value=t/e}static get Section(){return Qi}};function NG(t,e,n){for(const r of e){const i="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const o of n.entries())o[1]!==null&&n.set(o[0],o[1].replace(s,i))}}function eVe(t,e,n){let r=e.getFragmentShader(),i=e.getVertexShader();const s=r!==void 0&&/mainImage/.test(r),o=r!==void 0&&/mainUv/.test(r);if(n.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&(n.attributes&du.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=n.shaderParts;let l=c.get(Qi.FRAGMENT_HEAD)||"",u=c.get(Qi.FRAGMENT_MAIN_UV)||"",h=c.get(Qi.FRAGMENT_MAIN_IMAGE)||"",f=c.get(Qi.VERTEX_HEAD)||"",d=c.get(Qi.VERTEX_MAIN_SUPPORT)||"";const p=new Set,m=new Set;if(o&&(u+=`	${t}MainUv(UV);
`,n.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const y=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);d+=`	${t}MainSupport(`,d+=y?`vUv);
`:`);
`;for(const v of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const E of v[1].split(/\s*,\s*/))n.varyings.add(E),p.add(E),m.add(E);for(const v of i.matchAll(a))m.add(v[1])}for(const y of r.matchAll(a))m.add(y[1]);for(const y of e.defines.keys())m.add(y.replace(/\([\w\s,]*\)/g,""));for(const y of e.uniforms.keys())m.add(y);m.delete("while"),m.delete("for"),m.delete("if"),e.uniforms.forEach((y,v)=>n.uniforms.set(t+v.charAt(0).toUpperCase()+v.slice(1),y)),e.defines.forEach((y,v)=>n.defines.set(t+v.charAt(0).toUpperCase()+v.slice(1),y));const g=new Map([["fragment",r],["vertex",i]]);NG(t,m,n.defines),NG(t,m,g),r=g.get("fragment"),i=g.get("vertex");const _=e.blendMode;if(n.blendModes.set(_.blendFunction,_),s){e.inputColorSpace!==null&&e.inputColorSpace!==n.colorSpace&&(h+=e.inputColorSpace===Bi?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==bm?n.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(n.colorSpace=e.inputColorSpace);const y=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${t}MainImage(color0, UV, `,(n.attributes&du.DEPTH)!==0&&y.test(r)&&(h+="depth, ",n.readDepth=!0),h+=`color1);
	`;const v=t+"BlendOpacity";n.uniforms.set(v,_.opacity),h+=`color0 = blend${_.blendFunction}(color0, color1, ${v});

	`,l+=`uniform float ${v};

`}if(l+=r+`
`,i!==null&&(f+=i+`
`),c.set(Qi.FRAGMENT_HEAD,l),c.set(Qi.FRAGMENT_MAIN_UV,u),c.set(Qi.FRAGMENT_MAIN_IMAGE,h),c.set(Qi.VERTEX_HEAD,f),c.set(Qi.VERTEX_MAIN_SUPPORT,d),e.extensions!==null)for(const y of e.extensions)n.extensions.add(y)}}var Dre=class extends wh{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new Qze(null,null,null,t),this.listener=n=>this.handleEvent(n),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(t){for(const e of this.effects)e.mainScene=t}set mainCamera(t){this.fullscreenMaterial.copyCameraSettings(t);for(const e of this.effects)e.mainCamera=t}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){const e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}setEffects(t){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=t.sort((e,n)=>n.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const t=new F9e;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===di.DST)t.attributes|=o.getAttributes()&du.DEPTH;else{if((t.attributes&o.getAttributes()&du.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${o.name})`);eVe("e"+e++,o,t)}let n=t.shaderParts.get(Qi.FRAGMENT_HEAD),r=t.shaderParts.get(Qi.FRAGMENT_MAIN_IMAGE),i=t.shaderParts.get(Qi.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of t.blendModes.values())n+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;(t.attributes&du.DEPTH)!==0?(t.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,t.colorSpace===Bi&&(r+=`color0 = sRGBToLinear(color0);
	`),t.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,t.defines.set("UV","transformedUv")):t.defines.set("UV","vUv"),t.shaderParts.set(Qi.FRAGMENT_HEAD,n),t.shaderParts.set(Qi.FRAGMENT_MAIN_IMAGE,r),t.shaderParts.set(Qi.FRAGMENT_MAIN_UV,i);for(const[o,a]of t.shaderParts)a!==null&&t.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(t)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=$1){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(const n of this.effects)n.setDepthTexture(t,e)}render(t,e,n,r,i){for(const s of this.effects)s.update(t,e,r);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r*this.timeScale,t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(const n of this.effects)n.setSize(t,e)}initialize(t,e,n){this.renderer=t;for(const r of this.effects)r.initialize(t,e,n);this.updateMaterial(),n!==void 0&&n!==ko&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const t of this.effects)t.removeEventListener("change",this.listener),t.dispose()}handleEvent(t){t.type==="change"&&this.recompile()}};function HT(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}new zn;new zn;function Lre(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var jf=function t(e,n,r){var i=this;Lre(this,t),HT(this,"dot2",function(s,o){return i.x*s+i.y*o}),HT(this,"dot3",function(s,o,a){return i.x*s+i.y*o+i.z*a}),this.x=e,this.y=n,this.z=r},tVe=[new jf(1,1,0),new jf(-1,1,0),new jf(1,-1,0),new jf(-1,-1,0),new jf(1,0,1),new jf(-1,0,1),new jf(1,0,-1),new jf(-1,0,-1),new jf(0,1,1),new jf(0,-1,1),new jf(0,1,-1),new jf(0,-1,-1)],PG=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],DG=new Array(512),LG=new Array(512),nVe=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var n=0;n<256;n++){var r;n&1?r=PG[n]^e&255:r=PG[n]^e>>8&255,DG[n]=DG[n+256]=r,LG[n]=LG[n+256]=tVe[r%12]}};nVe(0);function rVe(t){if(typeof t=="number")t=Math.abs(t);else if(typeof t=="string"){var e=t;t=0;for(var n=0;n<e.length;n++)t=(t+(n+1)*(e.charCodeAt(n)%96))%2147483647}return t===0&&(t=311),t}function UG(t){var e=rVe(t);return function(){var n=e*48271%2147483647;return e=n,n/2147483647}}var iVe=function t(e){var n=this;Lre(this,t),HT(this,"seed",0),HT(this,"init",function(r){n.seed=r,n.value=UG(r)}),HT(this,"value",UG(this.seed)),this.init(e)};new iVe(Math.random());const xU=Ye.createContext(null);let sVe=0;const BG=new WeakMap,yx=(t,e)=>function({blendFunction:n=e?.blendFunction,opacity:r=e?.opacity,...i}){let s=BG.get(t);if(!s){const c=`@react-three/postprocessing/${t.name}-${sVe++}`;Iq({[c]:t}),BG.set(t,s=c)}const o=Dc(c=>c.camera),a=ch.useMemo(()=>[...e?.args??[],...i.args??[{...e,...i}]],[JSON.stringify(i)]);return Ee.jsx(s,{camera:o,"blendMode-blendFunction":n,"blendMode-opacity-value":r,...i,args:a})},JR=(t,e)=>{const n=t[e];return ch.useMemo(()=>typeof n=="number"?new zn(n,n):n?new zn(...n):new zn,[n])},wU=Ye.forwardRef(function({blendFunction:t,worldFocusDistance:e,worldFocusRange:n,focusDistance:r,focusRange:i,focalLength:s,bokehScale:o,resolutionScale:a,resolutionX:c,resolutionY:l,width:u,height:h,target:f,depthTexture:d,...p},m){const{camera:g}=Ye.useContext(xU),_=f!=null,y=Ye.useMemo(()=>{const v=new Hze(g,{blendFunction:t,worldFocusDistance:e,worldFocusRange:n,focusDistance:r,focusRange:i,focalLength:s,bokehScale:o,resolutionScale:a,resolutionX:c,resolutionY:l,width:u,height:h});_&&(v.target=new zt),d&&v.setDepthTexture(d.texture,d.packing);const E=v.maskPass;return E.maskFunction=EU.MULTIPLY_RGB_SET_ALPHA,v},[g,t,e,n,r,i,s,o,a,c,l,u,h,_,d]);return Ye.useEffect(()=>()=>{y.dispose()},[y]),Ee.jsx("primitive",{...p,ref:m,object:y,target:f})}),oVe=yx(Dze,{blendFunction:0}),aVe=Ye.forwardRef(function({active:t=!0,...e},n){const r=Dc(l=>l.invalidate),i=JR(e,"delay"),s=JR(e,"duration"),o=JR(e,"strength"),a=JR(e,"chromaticAberrationOffset"),c=Ye.useMemo(()=>new Wze({...e,delay:i,duration:s,strength:o,chromaticAberrationOffset:a}),[i,s,e,o,a]);return Ye.useLayoutEffect(()=>{c.mode=t?e.mode||nv.SPORADIC:nv.DISABLED,r()},[t,c,r,e.mode]),Ye.useEffect(()=>()=>{c.dispose?.()},[c]),Ee.jsx("primitive",{ref:n,object:c,dispose:null})}),cVe=yx(Yze,{blendFunction:5}),lVe=yx(Xze);var ad=typeof window<"u"?window:{screen:{},navigator:{}},XE=(ad.matchMedia||(function(){return{matches:!1}})).bind(ad),uVe={get passive(){return!0}},Ure=function(){};ad.addEventListener&&ad.addEventListener("p",Ure,uVe);ad.removeEventListener&&ad.removeEventListener("p",Ure,!1);var TU="ontouchstart"in ad,hVe="TouchEvent"in ad,fVe=TU||hVe&&XE("(any-pointer: coarse)").matches,FG=(ad.navigator.maxTouchPoints||0)>0||fVe,Bre=ad.navigator.userAgent||"",dVe=XE("(pointer: coarse)").matches&&/iPad|Macintosh/.test(Bre)&&Math.min(ad.screen.width||0,ad.screen.height||0)>=768,Fre=(XE("(pointer: coarse)").matches||!XE("(pointer: fine)").matches&&TU)&&!/Windows.*Firefox/.test(Bre),pVe=XE("(any-pointer: fine)").matches||XE("(any-hover: hover)").matches||dVe||!TU,v4=FG&&(pVe||!Fre)?"hybrid":FG?"touchOnly":"mouseOnly",mVe=v4==="mouseOnly"?"mouse":v4==="touchOnly"||Fre?"touch":"mouse";const gVe=`  
vec3 halftone(vec3 texcolor, vec2 st, float frequency) {
  float n = 0.1 * snoise(st * 200.0); // Fractal noise
  n += 0.05 * snoise(st * 400.0);
  n += 0.025 * snoise(st * 800.0);

  // Perform a rough RGB-to-CMYK conversion
  vec4 cmyk;
  // CMY = 1-RGB
  cmyk.xyz = 1.0 - texcolor;
  // Black generation: K = min(C,M,Y)
  cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); 
  // Grey component replacement: subtract K from CMY
  cmyk.xyz -= cmyk.w; 

  // K based modifier
  float flex = pow(cmyk.w, 3.11);

  // Distance to nearest point in a grid of
  // (frequency x frequency) points over the unit square
  
  float t = 0.1 + 0.1 * n + 0.11 * flex + 0.1 * cmyk.y;

  // K component: 45 degrees screen angle
  vec2 Kst = frequency * mat2(0.707, -0.707, 0.707, 0.707) * st;
  vec2 Kuv = 2.0 * fract(Kst) - 1.0; 
  float k = aastep(0.0, sqrt(cmyk.w) + t - length(Kuv) + n);
  
  // C component: 15 degrees screen angle
  vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966) * st;
  vec2 Cuv = 2.0 * fract(Cst) - 1.0;
  float c = aastep(0.0, sqrt(cmyk.x) + t - length(Cuv) + n);
  
  // M component: -15 degrees screen angle
  vec2 Mst = frequency * mat2(0.966, 0.259, -0.259, 0.966) * st;
  vec2 Muv = 2.0 * fract(Mst) - 1.0;
  float m = aastep(0.0, sqrt(cmyk.y) + t - length(Muv) + n);

  // Y component: 0 degrees screen angle
  vec2 Yst = frequency * st; // 0 deg 
  vec2 Yuv = 2.0 * fract(Yst) - 1.0;
  float y = aastep(0.0, sqrt(cmyk.z) + t - length(Yuv) + n);

  // CMY screen in RGB
  vec3 black = vec3(n + 0.01);
  vec3 rgbscreen = 1.0 - vec3(c,m,y) + n;
  
  // Blend in K for final color
  vec3 factor = mix(rgbscreen, black, 1.1 * k + 0.3 * n);

  // Blend with og color
  return mix(factor, texcolor, 0.777);
}

vec3 halftone(vec3 texcolor, vec2 st) {
  return halftone(texcolor, st, 412.321);
}
`,_Ve=`
float blendLighten(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten(vec3 base, vec3 blend) {
	return vec3(blendLighten(base.r,blend.r),blendLighten(base.g,blend.g),blendLighten(base.b,blend.b));
}

vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
	return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken(vec3 base, vec3 blend) {
	return vec3(blendDarken(base.r,blend.r),blendDarken(base.g,blend.g),blendDarken(base.b,blend.b));
}

vec3 blendDarken(vec3 base, vec3 blend, float opacity) {
	return (blendDarken(base, blend) * opacity + base * (1.0 - opacity));
}
`,vVe=`
float aastep(float threshold, float value) {
  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;
  return smoothstep(threshold-afwidth, threshold+afwidth, value);
}
`,bx=`
//
// Description : Array and textureless GLSL 2D simplex noise function.
//      Author : Ian McEwan, Ashima Arts.
//  Maintainer : ijm
//     Lastmod : 20110822 (ijm)
//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
//               Distributed under the MIT License. See LICENSE file.
//               https://github.com/ashima/webgl-noise
//

vec3 mod289(vec3 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec2 mod289(vec2 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec3 permute(vec3 x) {
  return mod289(((x*34.0)+1.0)*x);
}

float snoise(vec2 v) {
  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)
                     -0.577350269189626,  // -1.0 + 2.0 * C.x
                      0.024390243902439); // 1.0 / 41.0
// First corner
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);

// Other corners
  vec2 i1;
  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0
  //i1.y = 1.0 - i1.x;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  // x0 = x0 - 0.0 + 0.0 * C.xx ;
  // x1 = x0 - i1 + 1.0 * C.xx ;
  // x2 = x0 - 1.0 + 2.0 * C.xx ;
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;

// Permutations
  i = mod289(i); // Avoid truncation effects in permutation
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
    + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;

// Gradients: 41 points uniformly over a line, mapped onto a diamond.
// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

// Normalise gradients implicitly by scaling m
// Approximation of: m *= inversesqrt( a0*a0 + h*h );
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );

// Compute final noise value at P
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}
`,yVe=`
#ifdef ASPECT_CORRECTION
	uniform float scale;
#else
	uniform mat3 uvTransform;
#endif

varying vec2 vUv2;

void mainSupport(const in vec2 uv) {
	#ifdef ASPECT_CORRECTION
		vUv2 = uv * vec2(aspect, 1.0) * scale;
	#else
		vUv2 = (uvTransform * vec3(uv, 1.0)).xy;
	#endif
}
`,bVe=`
uniform float viewheight;
uniform sampler2D splat;

${_Ve}
${vVe}
${bx}
${gVe}

float rectdistance(vec2 uv) {
  vec2 tl = vec2(-1.0);
  vec2 br = vec2(1.0);
  vec2 d = max(tl - uv, uv - br);
  return abs(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)));
}

vec2 bendy(const in vec2 xn, float dn, float sn) {
  // config
  float distortion = 0.0173 + dn; // 0.0173, 0.511
  float scale = 0.991 + sn; // 1.0, 0.7
  // calc
  vec3 xDistorted = vec3((1.0 + vec2(distortion, distortion) * dot(xn, xn)) * xn, 1.0);
  mat3 kk = mat3(
    vec3(1.0, 0.0, 0.0),
    vec3(0.0, 1.0, 0.0),
    vec3(0.0, 0.0, 1.0)
  );
  return (kk * xDistorted).xy * scale;
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
	#ifdef UV_TRANSFORM
		vec4 bright = texture2D(splat, vUv2);
		vec4 dark = texture2D(splat, 1.0 - vUv2);
	#else
		vec4 bright = texture2D(splat, uv);
		vec4 dark = texture2D(splat, 1.0 - uv);
	#endif
  
  float n = 0.1 * snoise(uv.st * 200.0); // Fractal noise
  n += 0.05 * snoise(uv.st * 400.0);
  n += 0.025 * snoise(uv.st * 800.0);

  vec2 xn = 2.0 * (uv.st - 0.5);
  float fz = 0.005;
  vec2 edge = bendy(xn, fz * n, -fz * n);
  vec2 bent = edge.xy * 0.5 + 0.5;

  float edgetime = time * 0.3;
  float edgetime2 = time * 2.0;
  vec2 edgewiggle = vec2(cos(edgetime) * 0.1, sin(edgetime) * 0.096);
  vec2 edgewiggle2 = vec2(cos(edgetime2) * 0.005, sin(edgetime2) * 0.005);
  vec2 edgeshine = vec2(edge.x * 5.0 + 3.5, edge.y - 0.3) + edgewiggle + edgewiggle2;
  vec2 edgeshine2 = vec2(edge.x, edge.y * 2.0 - 0.5) + edgewiggle + edgewiggle2;
  vec2 edgeshine3 = vec2(edge.x * 3.0 - 2.1, edge.y + 0.3) + edgewiggle + edgewiggle2;
  
  float dx = rectdistance(xn);
  float bx = rectdistance(edge);
  float ex = rectdistance(edgeshine);
  float ex2 = rectdistance(edgeshine2);
  float ex3 = rectdistance(edgeshine3);

  // apply shape
  float doot = max(abs(edge.x), abs(edge.y));
  if (doot < 1.0) {
    // display
    outputColor = texture2D(inputBuffer, bent);

    // apply scratches
    outputColor.rgb = blendLighten(outputColor.rgb, bright.rgb, 0.079);
    outputColor.rgb = blendDarken(outputColor.rgb, dark.rgb, 0.0666);

    // apply halftones
    outputColor.rgb = halftone(outputColor.rgb, uv.st);
  
  } else if (doot > 1.004) {
    // display shell
    // rbgb 205 205 193
    vec3 matte = vec3(205.0 / 255.0, 205.0 / 255.0, 193.0 / 255.0);
    vec3 dkmatte = mix(matte, vec3(0.0), 0.5);
    float mx = pow(1.0 - bx, 16.0) + n;
    outputColor = vec4(mix(matte, dkmatte, mx), inputColor.a);

  } else {
    // border
    outputColor = vec4(mix(vec3(0.0), outputColor.rgb, 0.5), inputColor.a);
  }

  // apply reflection shine
  if (doot < 0.98) {
    float vvv = 0.34;
    if (edge.x > -0.9 && edge.x < -0.5 && edge.y > -0.5) {
      float sh = clamp(0.0, vvv, ex + n * 0.333);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(bx * 3.0)) * (6.0 + sin(edgetime));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
    if (edge.y > -0.3 && edge.y < 0.7) {
      float sh = clamp(0.0, vvv, ex2 + n * 0.15);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(dx * 3.0)) * (4.0 + cos(edgetime * 1.5));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
    if (edge.x > 0.4 && edge.y < 0.8) {
      float sh = clamp(0.0, vvv, ex3 + n * 0.25);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(bx * 2.0)) * (3.0 + sin(-edgetime));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
  }

  // apply inner shade
  if (doot >= 0.5 && doot < 1.0) {
    float sh = clamp(0.0, 1.0, 1.0 - bx - 0.7);
    vec3 shade = mix(outputColor.rgb, vec3(0.0), pow(sh, 4.0));
    outputColor = vec4(shade, inputColor.a);
  }

  // apply outer shade
  if (doot >= 0.97) {
    float sh = clamp(0.0, 1.0, bx * 24.0);
    vec3 dkout = mix(vec3(0.0), outputColor.rgb, 0.81);
    vec3 shade = mix(dkout, outputColor.rgb, sh);
    outputColor = vec4(shade, inputColor.a);
  }
}
`;class SVe extends od{constructor({splat:e,viewheight:n}={}){super("CRTShapeEffect",bVe,{blendFunction:di.NORMAL,attributes:du.CONVOLUTION,defines:new Map([["TEXEL","texel"],["TEXTURE_PRECISION_HIGH","1"]]),uniforms:new Map([["splat",new un(e)],["viewheight",new un(n??128)]])})}get splat(){return this.uniforms.get("splat")?.value}set splat(e){const{splat:n,uniforms:r,defines:i}=this,s=r.get("splat"),o=r.get("uvTransform");n!==e&&s&&o&&(s.value=e,o.value=e.matrix,i.delete("TEXTURE_PRECISION_HIGH"),e!==null&&(e.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(yVe)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==ko&&i.set("TEXTURE_PRECISION_HIGH","1"),(n===null||n?.type!==e.type)&&this.setChanged()))}getTexture(){return this.splat}setTexture(e){this.splat=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){return!!this.splat?.matrixAutoUpdate}set uvTransform(e){const n=this.splat;fe(n)&&(n.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,n=e,r=e,i=e){const s="rgba";let o="";(e!==iE.RED||n!==iE.GREEN||r!==iE.BLUE||i!==iE.ALPHA)&&(o=[".",s[e],s[n],s[r],s[i]].join("")),this.defines.set("TEXEL","texel"+o),this.setChanged()}update(){this.splat?.matrixAutoUpdate&&this.splat.updateMatrix()}}const EVe=yx(SVe);function y4(t){const e=new Set;function n(s){vEe(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),BT.invoke(s))}const r=Ym("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){r.disconnect()}return{forward:n,disconnect:i}}function xVe(t){switch(t.target){case"tick":case"tock":case"ready":return!0}return!1}function wVe(t){switch(t.target){case"log":case"chat":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=_v(t.target);switch(e.target){case"vm":case"heavy":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"heavy":case"joinack":case"acklook":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}function TVe(t){switch(t.target){case"tick":case"tock":case"second":return!0}return!1}function b4(t){const e=_v(t.target);switch(e.target){case"vm":case"modem":case"gadgetserver":return!0}switch(e.path){case"sync":case"desync":case"joinack":return!0}return!1}function jG(t){switch(t.target){case"tick":case"tock":return!1;case"second":case"ready":return!0;default:{const e=_v(t.target);return e.target==="heavy"||e.path==="acklook"}}}function AVe(t){return new Worker("/assets/heavyspace-BhUNig3R.js",{name:t?.name})}function CVe(t){return new Worker("/assets/simspace-iXReWxam.js",{name:t?.name})}function RVe(t){return new Worker("/assets/stubspace-7jhWfzVD.js",{name:t?.name})}let im,Wd,S4;function kVe(t=!1){if(fe(Wd))return;yEe(qe),im=new AVe,Wd=t?new RVe:new CVe;const{forward:e,disconnect:n}=y4(s=>{b4(s)&&fe(Wd)&&Wd.postMessage(s),jG(s)&&fe(im)&&im.postMessage(s)});function r(s){const o=s.data;return b4(o)&&fe(Wd)&&Wd.postMessage(o),e(o)}im.addEventListener("message",r);function i(s){const o=s.data;return jG(o)&&fe(im)&&im.postMessage(o),e(o)}Wd.addEventListener("message",i),S4=()=>{n(),fe(im)&&(im.removeEventListener("message",r),im.terminate()),im=void 0,fe(Wd)&&(Wd.removeEventListener("message",i),Wd.terminate()),Wd=void 0}}function MVe(){S4?.(),S4=void 0}function OVe(t,e,n,r){const i=e*n*4;for(let s=0,o=0;s<i;++o)t.image.data[s]=r[o]*255,s+=4;return t.needsUpdate=!0,t}function IVe(t,e){const n=new Uint8Array(4*t*e);return new bO(n,t,e)}const NVe=new ao({transparent:!1,side:Oa,uniforms:{color:{value:new wi(0,0,0)},data:{value:null}},vertexShader:`
      precision highp float;
      varying vec2 vUv;
    
      void main() {
        vec4 mvPosition = vec4(position, 1.0);
        #ifdef USE_INSTANCING
        	mvPosition = instanceMatrix * mvPosition;
        #endif        
        mvPosition = modelViewMatrix * mvPosition;
        gl_Position = projectionMatrix * mvPosition;
        
        vUv = uv;
      }
    `,fragmentShader:`
      precision highp float;
      uniform vec3 color;
      uniform sampler2D data;
  
      varying vec2 vUv;

      // adapted from https://www.shadertoy.com/view/Mlt3z8
      float bayerDither2x2( vec2 v ) {
        return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
      }

      float bayerDither4x4( vec2 v ) {
        vec2 P1 = mod( v, 2.0 );
        vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
        return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
      }

      void main() {
        float alpha = texture2D(data, vUv).r;
        if (alpha < 1.0) {
          vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
          if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
            discard;
          }
        }

        gl_FragColor.rgba = vec4(color.xyz, 1.0);
      }
    `});function PVe(){return Lv(NVe)}const DVe=new ao({transparent:!1,side:Oa,uniforms:{time:Ma,smoothrate:new un(QA),color:{value:new wi(0,0,0)},alpha:{value:1}},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec3 nowposition;
    attribute mat4 lastmatrix;
    
    uniform float smoothrate;
    uniform float time;
  
    varying float vVisible;
  
    void main() {       
      vec4 mvPosition = vec4(position, 1.0);
      
      vec4 mvNowPosition = instanceMatrix * mvPosition;
      vec4 mvLastPosition = lastmatrix * mvPosition;

      float deltaPosition = clamp((time - nowposition.z) * smoothrate, 0.0, 1.0);
      mvPosition = mix(mvLastPosition, mvNowPosition, deltaPosition);

      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
      
      vVisible = visible;
    }
    `,fragmentShader:`
    precision highp float;
    uniform vec3 color;
    uniform float alpha;

    varying float vVisible;

    // adapted from https://www.shadertoy.com/view/Mlt3z8
    float bayerDither2x2( vec2 v ) {
      return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
    }

    float bayerDither4x4( vec2 v ) {
      vec2 P1 = mod( v, 2.0 );
      vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
      return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
    }

    void main() {
      if (vVisible == 0.0) {
        discard;
      }
      if (alpha < 1.0) {
        vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
        if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
          discard;
        }
      }

      gl_FragColor.rgba = vec4(color.xyz, 1.0);
    }
    `});function LVe(){return Lv(DVe)}const iu=[0,1,0],xm=[1,1,0],Xh=[1,0,0],wm=[0,0,0],UVe=new Float32Array([...iu,...Xh,...xm,...iu,...wm,...Xh]),jre=new Float32Array([...iu.slice(0,2),...Xh.slice(0,2),...xm.slice(0,2),...iu.slice(0,2),...wm.slice(0,2),...Xh.slice(0,2)]);function BVe(t,e,n,r,i,s){const o=e*n*4;for(let a=0,c=0;a<o;++c){const l=r[c]??0;t.image.data[a++]=l%yo,t.image.data[a++]=Math.floor(l/yo),t.image.data[a++]=i[c]??16,t.image.data[a++]=s[c]??16}return t.needsUpdate=!0,t}function FVe(t,e){const n=new Uint8Array(4*t*e),r=new bO(n,t,e,yO,ko);return r.internalFormat="RGBA8UI",r}function AU(t,e){const n=t*kn.DRAW_CHAR_WIDTH(),r=e*kn.DRAW_CHAR_HEIGHT();return{position:UVe.map((s,o)=>{switch(o%3){case 0:return s*n;case 1:return s*r;default:return s}}),uv:jre}}const zG=[0,1,1],q2=[1,1,1],ZR=[1,0,1],Y2=[0,0,1],jVe=new Float32Array([...iu,...q2,...xm,...iu,...zG,...q2,...wm,...ZR,...Xh,...wm,...Y2,...ZR,...xm,...ZR,...Xh,...xm,...q2,...ZR,...iu,...Y2,...wm,...iu,...zG,...Y2]),zVe=new Float32Array([...iu.slice(0,2),...Xh.slice(0,2),...xm.slice(0,2),...iu.slice(0,2),...wm.slice(0,2),...Xh.slice(0,2),...iu.slice(0,2),...Xh.slice(0,2),...xm.slice(0,2),...iu.slice(0,2),...wm.slice(0,2),...Xh.slice(0,2),...xm.slice(0,2),...wm.slice(0,2),...iu.slice(0,2),...xm.slice(0,2),...Xh.slice(0,2),...wm.slice(0,2),...iu.slice(0,2),...Xh.slice(0,2),...xm.slice(0,2),...iu.slice(0,2),...wm.slice(0,2),...Xh.slice(0,2)]);function VVe(t,e){const n=t*kn.DRAW_CHAR_WIDTH(),r=e*kn.DRAW_CHAR_HEIGHT();return{position:jVe.map((s,o)=>{switch(o%3){case 0:return s*n;case 1:return s*r;default:return s*r}}),uv:zVe}}const VG=[-.5,0,0],HVe=[.5,0,0],HG=[.5,0,1],$Ve=[-.5,0,1],GVe=new Float32Array([...VG,...HG,...HVe,...VG,...$Ve,...HG]);function WVe(){const t=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT();return{position:GVe.map((r,i)=>{switch(i%3){case 0:return r*t;case 1:return r*e;default:return r*e}}),uv:jre}}const qVe=VE(Y1(J1)),$G=_m(K1(X1)),YVe=new ao({transparent:!1,side:Oa,uniforms:{time:Ma,interval:vx,palette:new un(qVe),map:new un($G),alt:new un($G),data:new un(null),size:new un(new zn),step:new un(new zn),flip:new un(!0)},vertexShader:`
    precision highp float;
    varying vec2 vUv;
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
      vUv = uv;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform usampler2D data;
    uniform vec3 palette[16];
    uniform vec2 size;
    uniform vec2 step;
    uniform bool flip;
    varying vec2 vUv;

    ${bx}

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vUv * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      uvec4 tiledata = texture(data, vUv);
      int colori = int(tiledata.z);
      int bgi = int(tiledata.w);

      vec2 charPosition = mod(vUv, size) / size;
      vec2 uv = vec2(charPosition.x * step.x, charPosition.y * step.y);
      
      vec3 color;
      if (colori > 31) {
        vec3 bg = palette[bgi];
        color = palette[colori - 33];
        float cycle = mod(time * 2.5, interval * 2.0) / interval;
        color = mix(bg, color, cyclefromtime());
      } else {
        color = palette[colori % 16];
      }

      uv.x += step.x * float(tiledata.x);
      uv.y += step.y * float(tiledata.y);
      if (flip) {
        uv.y = 1.0 - uv.y;
      }

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Ft.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function KVe(){return Lv(YVe)}function $I({width:t,height:e,alphas:n}){const[r]=Ye.useState(()=>PVe());Ye.useEffect(()=>{r.uniforms.data.value=IVe(t,e)},[r.uniforms.data,t,e]),Ye.useEffect(()=>{OVe(r.uniforms.data.value,t,e,n)},[r,r.uniforms.data.value,t,e,n]);const{position:i,uv:s}=Ye.useMemo(()=>AU(t,e),[t,e]);return Ee.jsxs("mesh",{children:[Ee.jsx("primitive",{object:r,attach:"material"}),Ee.jsxs("bufferGeometry",{children:[Ee.jsx("bufferAttribute",{attach:"attributes-position",args:[i,3]}),Ee.jsx("bufferAttribute",{attach:"attributes-uv",args:[s,2]})]})]})}function XVe({width:t,height:e,alpha:n}){const r=Ye.useMemo(()=>new Array(t*e).fill(n),[t,e,n]);return Ee.jsx($I,{width:t,height:e,alphas:r})}const fT=new Kce,Hy=new zn;function GI({width:t,height:e,top:n,left:r,right:i,bottom:s,scale:o=.125,alpha:a=.25}){const c=Ye.useMemo(()=>{const l=new Array(t*e);fT.min.x=r,fT.min.y=n,fT.max.x=i,fT.max.y=s,Hy.x=0,Hy.y=0;for(let u=0;u<l.length;++u)l[u]=rq.smootherstep(1-fT.distanceToPoint(Hy)*o,0,1)*a,++Hy.x,Hy.x>=t&&(Hy.x=0,++Hy.y);return l},[t,e,n,r,i,s,o,a]);return Ee.jsx($I,{width:t,height:e,alphas:c})}function GG(){}const JVe=ch.forwardRef(function({args:e,children:n,...r},i){const s=ch.useRef(null);return ch.useImperativeHandle(i,()=>s.current),Ee.jsxs("mesh",{ref:s,...r,children:[Ee.jsx("planeGeometry",{attach:"geometry",args:e}),n]})}),Nm=ch.forwardRef(function({blocking:e=!1,cursor:n="default",x:r=0,y:i=0,z:s=0,width:o=1,height:a=1,opacity:c=1,visible:l=!0,color:u="white",...h},f){const d=o*.5,p=a*.5,m=[(r+d)*kn.DRAW_CHAR_WIDTH(),(i+p)*kn.DRAW_CHAR_HEIGHT(),s];return Ee.jsx(JVe,{ref:f,args:[o*kn.DRAW_CHAR_WIDTH(),a*kn.DRAW_CHAR_HEIGHT()],userData:{blocking:e,cursor:n},onClick:e?GG:void 0,onPointerMove:e?GG:void 0,position:m,...h,children:Ee.jsx("meshBasicMaterial",{color:u,opacity:c,visible:l,transparent:c!==1})})}),ZVe=VE(Y1(J1)),WG=_m(K1(X1));function ip({width:t,height:e,char:n,color:r,bg:i,fliptexture:s=!0,alwaysdefaults:o=!1}){const a=va(y=>y.palettedata),c=va(y=>y.charsetdata),l=va(y=>y.altcharsetdata),u=o?ZVe:a,h=o?WG:c,f=o?WG:l,[d]=Ye.useState(()=>KVe()),{width:p=0,height:m=0}=h?.image??{};Ye.useEffect(()=>{t===0||e===0||(d.uniforms.data.value=FVe(t,e))},[d.uniforms.data,t,e]),Ye.useEffect(()=>{t===0||e===0||BVe(d.uniforms.data.value,t,e,n,r,i)},[d.uniforms.data.value,t,e,n,r,i]),Ye.useEffect(()=>{t===0||e===0||!h||(d.uniforms.map.value=h,d.uniforms.alt.value=f??h,d.uniforms.palette.value=u,d.uniforms.size.value.x=1/t,d.uniforms.size.value.y=1/e,d.uniforms.step.value.x=1/Math.round(p/Yo),d.uniforms.step.value.y=1/Math.round(m/Ia),d.uniforms.flip.value=s,d.needsUpdate=!0)},[u,h,f,d,t,e,p,m,s]);const{position:g,uv:_}=Ye.useMemo(()=>AU(t,e),[t,e]);return Ee.jsxs("mesh",{children:[Ee.jsxs("bufferGeometry",{children:[Ee.jsx("bufferAttribute",{attach:"attributes-position",args:[g,3]}),Ee.jsx("bufferAttribute",{attach:"attributes-uv",args:[_,2]})]}),Ee.jsx("primitive",{object:d,attach:"material"})]})}function lb({store:t,children:e}){return Ee.jsx(K8.Provider,{value:t,children:e})}function ub({width:t,height:e}){const n=Ye.useContext(K8),[r,i,s]=Y8(n,xh(o=>[o.char,o.color,o.bg,o.render]));return t>0&&e>0&&Ee.jsx(ip,{char:r.slice(),color:i.slice(),bg:s.slice(),width:t,height:e})}function CU({x:t,y:e,width:n,height:r,debug:i,...s}){const o=kn.DRAW_CHAR_WIDTH(),a=kn.DRAW_CHAR_HEIGHT();return Ee.jsx(I9e,{...s,args:[n*o,r*a],position:[(t??0)*o+n*o*.5,(e??0)*a+r*a*.5,0],children:Ee.jsx("meshBasicMaterial",{transparent:!0,opacity:i?.7:0,color:"red"})})}function Qu({x:t,y:e,letters:n,onToggle:r}){const i=Bl(),[s,o]=Ye.useState(!1),a=Ye.useCallback(()=>o(!1),[o]);if(i.x=t,i.y=e,ei(s?"$176$176$176$176$176":"$178$178$178$178$178",i,!1),i.x=t,i.y=e+1,ei(s?"$176$177$177$177$176":"$178$177$177$177$178",i,!1),i.x=t,i.y=e+2,ei(s?"$176$176$176$176$176":"$178$178$178$178$178",i,!1),n){const l=$g(n,1e4,1)?.measuredwidth??n.length;i.x=t+Math.round(2.5-l*.5),i.y=e,ei(n,i,!1)}return Ee.jsx(CU,{x:t,y:e,width:5,height:3,onPointerDown:()=>{r(),o(!0)},onPointerUp:a,onPointerLeave:a,onPointerCancel:a})}function QVe({width:t,height:e}){const{keyboardalt:n,keyboardctrl:r,keyboardshift:i}=Jf(),s=t-18,o=t-12,a=t-6,c=1,l=Math.floor(e*.5)-2,u=e-4,h=Math.round(t*.5)-3,f=ii();return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(Qu,{x:0,y:c,letters:r?wA.toUpperCase():wA.toLowerCase(),onToggle:()=>{r?ur(0,Ct.CTRL):xr(0,Ct.CTRL),Jf.setState({keyboardctrl:!r})}}),Ee.jsx(Qu,{x:6,y:c+1,letters:n?"ALT":"alt",onToggle:()=>{n?ur(0,Ct.ALT):xr(0,Ct.ALT),Jf.setState({keyboardalt:!n})}}),Ee.jsx(Qu,{x:12,y:c,letters:i?"SHIFT":"shift",onToggle:()=>{i?ur(0,Ct.SHIFT):xr(0,Ct.SHIFT),Jf.setState({keyboardshift:!i})}}),Ee.jsx(Qu,{x:s,y:c,letters:"tab",onToggle:()=>{xr(0,Ct.MENU_BUTTON),ur(0,Ct.MENU_BUTTON)}}),Ee.jsx(Qu,{x:o,y:c+1,letters:"enter",onToggle:()=>{xr(0,Ct.OK_BUTTON),ur(0,Ct.OK_BUTTON)}}),Ee.jsx(Qu,{x:a,y:c,letters:"esc",onToggle:()=>{xr(0,Ct.CANCEL_BUTTON),ur(0,Ct.CANCEL_BUTTON)}}),Ee.jsx(Qu,{x:1,y:u-1,letters:"?",onToggle:()=>{N1(qe,f)}}),Ee.jsx(Qu,{x:7,y:u,letters:"#",onToggle:()=>{N1(qe,f,"#")}}),Ee.jsx(Qu,{x:13,y:u-1,letters:"c",onToggle:()=>{W5(qe,f,"")}}),Ee.jsx(Qu,{x:a,y:u-1,letters:"$meta+p",onToggle:()=>{K5(qe,f)}}),Ee.jsx(Qu,{x:h,y:c,letters:"$24",onToggle:()=>{xr(0,Ct.MOVE_UP),ur(0,Ct.MOVE_UP)}}),Ee.jsx(Qu,{x:h,y:u,letters:"$25",onToggle:()=>{xr(0,Ct.MOVE_DOWN),ur(0,Ct.MOVE_DOWN)}}),Ee.jsx(Qu,{x:t-5,y:l,letters:"$26",onToggle:()=>{xr(0,Ct.MOVE_RIGHT),ur(0,Ct.MOVE_RIGHT)}}),Ee.jsx(Qu,{x:0,y:l,letters:"$27",onToggle:()=>{xr(0,Ct.MOVE_LEFT),ur(0,Ct.MOVE_LEFT)}})]})}function zre(){ur(0,Ct.MOVE_UP),ur(0,Ct.MOVE_DOWN),ur(0,Ct.MOVE_LEFT),ur(0,Ct.MOVE_RIGHT)}function eHe(t){const{keyboardshift:e,keyboardctrl:n,keyboardalt:r}=Jf.getState();switch(r?xr(0,Ct.ALT):ur(0,Ct.ALT),n?xr(0,Ct.CTRL):ur(0,Ct.CTRL),e?xr(0,Ct.SHIFT):ur(0,Ct.SHIFT),zre(),t){case 0:xr(0,Ct.MOVE_LEFT);break;case 45:xr(0,Ct.MOVE_UP),xr(0,Ct.MOVE_LEFT);break;case 90:xr(0,Ct.MOVE_UP);break;case 135:xr(0,Ct.MOVE_UP),xr(0,Ct.MOVE_RIGHT);break;case 180:xr(0,Ct.MOVE_RIGHT);break;case 225:xr(0,Ct.MOVE_DOWN),xr(0,Ct.MOVE_RIGHT);break;case 270:xr(0,Ct.MOVE_DOWN);break;case 315:xr(0,Ct.MOVE_DOWN),xr(0,Ct.MOVE_LEFT);break;case 360:xr(0,Ct.MOVE_LEFT);break}}const tHe=KE/1e3,dT=new zn,nO=new zt;function K2(t,e){const n=kn.DRAW_CHAR_WIDTH(),r=kn.DRAW_CHAR_HEIGHT(),i=nO.x+n*.5,s=nO.y+r*.5;return{cx:Math.floor(t*.5)+Math.floor(i/n),cy:Math.floor(e*.5)+Math.floor(s/r)}}const nHe=4;function rHe({width:t,height:e,onUp:n,onDrawStick:r}){const[i]=Ye.useState({startx:-1,starty:-1,tipx:-1,tipy:-1,pointerid:-1,inputacc:KE});function s(){i.startx=-1,i.starty=-1,i.tipx=-1,i.tipy=-1,i.pointerid=-1,n(),zre()}return Dg((o,a)=>{if(i.inputacc+=a,i.inputacc>=tHe&&i.pointerid!==-1){i.inputacc=0;const{cx:c,cy:l}=K2(t,e);if(dT.set(i.startx-c,i.starty-l),dT.length()>nHe){const u=z5(uK(dT.angle()),45);eHe(u)}}}),Ee.jsx(CU,{width:t,height:e,onPointerDown:o=>{if(i.pointerid===-1){o.intersections[0].object.worldToLocal(nO.copy(o.intersections[0].point));const{cx:a,cy:c}=K2(t,e);i.startx=a,i.starty=c,i.tipx=-1,i.tipy=-1,i.pointerid=o.pointerId,i.inputacc=KE}},onPointerMove:o=>{if(o.pointerId===i.pointerid&&o.intersections[0]){o.intersections[0].object.worldToLocal(nO.copy(o.intersections[0].point));const{cx:a,cy:c}=K2(t,e);dT.set(i.startx-a,i.starty-c),dT.length()>2&&(i.tipx=a,i.tipy=c,r(i.startx,i.starty,i.tipx,i.tipy))}},onPointerUp:s,onPointerLeave:s,onPointerCancel:s})}const $y=new zn,iHe=177,sHe=Ft.WHITE,oHe=Ft.DKPURPLE,qG="tap to toggle ";function aHe({width:t,height:e,onReset:n}){const r=Bl();LI(r,iHe,sHe,oHe);const i=Math.floor(t*.333),s=Math.round(t*.666);for(let o=1;o<e;++o)for(let a=i;a<=s;++a)$o(r,t,e,a,o,{char:176});for(let o=0;o<t;++o){const a=o-(t-qG.length);$o(r,t,e,o,0,{char:a<0?32:qG.charCodeAt(a),color:Ft.WHITE,bg:Ft.ONCLEAR})}return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx("group",{position:[0,-4*kn.DRAW_CHAR_HEIGHT(),-1],children:Ee.jsx(GI,{width:t,height:5,left:0,top:6,right:t-1,bottom:6,alpha:.45})}),Ee.jsx(CU,{x:0,y:-3,width:t,height:4,onPointerDown:()=>{Jf.setState(o=>({...o,sidebaropen:!o.sidebaropen}))}}),Ee.jsx(QVe,{width:t,height:e}),Ee.jsx(rHe,{width:t,height:e,onUp:n,onDrawStick:(o,a,c,l)=>{for(let d=0;d<11;++d)r.x=o-5,r.y=a-5+d,ei("$dkblue$177$177$177$177$177$177$177$177$177$177$177",r,!1);const u=4;$y.x=c-o,$y.y=l-a;const h=z5(uK($y.angle()),45),f=lK(h);$y.x=Math.cos(f)*u,$y.y=Math.sin(f)*u;for(let d=0;d<3;++d)r.x=o+Math.round($y.x)-1,r.y=a+Math.round($y.y)-1+d,ei("$dkblue$219$219$219",r,!1)}})]})}function cHe({width:t,height:e}){const[n,r]=Ye.useState(0),i=Zm(),s=ab(t,e,32,Ft.WHITE,Ft.DKPURPLE),o={...Hg(t,e,Ft.WHITE,Ft.DKPURPLE),...s.getState()};return i.cols<10||i.rows<10?null:Ee.jsxs(lb,{store:s,children:[Ee.jsx(xC.Provider,{value:o,children:Ee.jsx(aHe,{width:t,height:e,onReset:()=>{r(Math.random())}},n)}),Ee.jsx(ub,{width:t,height:e})]})}const Vre=Ye.createContext({cols:1,rows:1,marginx:1,marginy:1});function Zm(){return Ye.useContext(Vre)}function lHe({children:t}){const{viewport:e}=Dc(),{width:n,height:r}=e.getCurrentViewport(),{saferows:i,islandscape:s,showtouchcontrols:o}=Jf(),a=n/kn.DRAW_CHAR_WIDTH();let c=Math.floor(a);const l=r/kn.DRAW_CHAR_HEIGHT();let u=Math.floor(l);const h=(n-c*kn.DRAW_CHAR_WIDTH())*.5,f=(r-u*kn.DRAW_CHAR_HEIGHT())*.5;let d=0,p=0;const m=Math.round(a);let g=Math.round(l);if(o)if(s)d=5*kn.DRAW_CHAR_WIDTH(),c-=10;else{i<u?u=i:u=u-20;const _=u-1;g-=u,p=_*kn.DRAW_CHAR_HEIGHT()}return Ye.useEffect(()=>{Jf.setState(_=>({..._,insetcols:m,insetrows:g}))},[m,g]),Ee.jsx(Vre.Provider,{value:{cols:c,rows:u,marginx:h,marginy:f},children:c>=10&&u>=10&&Ee.jsx("group",{"scale-x":-1,"rotation-z":Math.PI,children:Ee.jsxs("group",{position:[n*-.5+h,r*-.5+f,0],children:[Ee.jsx("group",{position:[d,0,0],children:t}),o&&Ee.jsx("group",{position:[0,p,3],children:Ee.jsx(cHe,{width:m,height:g},m*g)})]})})})}const Wg=Ye.createContext({sendmessage(){},sendclose(){},didclose(){}}),YG={input:{color:"$white",active:"$yellow"}};function jl(t){return t?YG.input.active:YG.input.color}function RU(t,e){return`vm:${t}:${e}`}function kT(t,e,n=0,r=""){return`${t.substring(0,e)}${r}${t.substring(e+n)}`}function Su(t,e,n){fe(e)&&(n.x=t?1:0,n.y=e,n.disablewrap=!0)}const X_=32,Hre=8,E4=new zt;function uHe(){const t=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),n=Math.floor(E4.x/t),r=Math.floor(E4.y/e);return{x:Math.round(X_*.5+n),y:Math.round(Hre*.5+r)}}function hHe({sidebar:t,chip:e,row:n,label:r,args:i,context:s}){Su(t,n,s);const[o]=[rp(i[0],"")],a=Cv(e,o),l=bC(a)??0,u=ff(),[h,f]=Ye.useState(!1);Ye.useLayoutEffect(()=>{f(!0)},[]);const d=`${l}`.padStart(3,"0"),p=r.trim(),m=s.x-1,g=s.y+2,_=[`$green${p} ${d}
$white`];for(let L=0;L<256;++L)if(L%X_===0&&_.push(`
`),L===l){const I=u?"$green$onwhite":"$white$ongreen";_.push(`${I}$${L}$white$ondkblue`)}else _.push(`$${L}`);_.push(`

`),_.push(`$greenpress C to copy ${d}`),_.push(`

`),_.push(`$greenpress B to copy bits of ${d}`);const y=_.join("");ei(y,s,!0);const v=Ye.useContext(Wg),E=Ye.useCallback(()=>{l>=X_&&cu(a,l-X_)},[a,l]),x=Ye.useCallback(()=>{l>0&&cu(a,l-1)},[a,l]),A=Ye.useCallback(()=>{l<255&&cu(a,l+1)},[a,l]),T=Ye.useCallback(()=>{l<=255-X_&&cu(a,l+X_)},[a,l]),k=Ye.useCallback(()=>{v.sendclose()},[v]);return Ee.jsx("group",{position:[m*kn.DRAW_CHAR_WIDTH(),g*kn.DRAW_CHAR_HEIGHT(),1],children:h&&Ee.jsxs(Dv,{blockhotkeys:!0,children:[Ee.jsx(Nm,{x:1,blocking:!0,visible:!1,cursor:"pointer",width:X_,height:Hre,onClick:L=>{L.intersections[0].object.worldToLocal(E4.copy(L.intersections[0].point));const I=Yf(uHe(),X_);I>=0&&I<=255&&(cu(a,I),v.sendclose())}}),Ee.jsx(xo,{MOVE_LEFT:x,MOVE_UP:E,MOVE_RIGHT:A,MOVE_DOWN:T,OK_BUTTON:k,CANCEL_BUTTON:k,keydown:L=>{switch(L.key.toLowerCase()){case"c":ME(qe,ii(),`${l}`),v.sendclose();break;case"b":{const{charset:F}=va.getState();let M="";const D=hme(F,l);for(let O=0;O<D.length;++O)O%8===0&&(M+=`@char${l} `),M+=D[O]?"X":"-",O%8===7&&(M+=`
`);ME(qe,ii(),M),v.sendclose();break}}}})]})})}const YS=8,$re=2,x4=new zt;function fHe(){const t=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),n=Math.floor(x4.x/t),r=Math.floor(x4.y/e);return{x:Math.round(YS*.5+n),y:Math.round($re*.5+r)}}function dHe(t){switch(t){case"dkyellow":return", brown";case"ltgray":return", ltgrey, gray, grey";case"dkgray":return", dkgrey, ltblack";case"ondkyellow":return", onbrown";case"onltgray":return", onltgrey, ongray, ongrey";case"ondkgray":return", ondkgrey, onltblack";case"bldkyellow":return", blbrown";case"blltgray":return", blltgrey, blgray, blgrey";case"bldkgray":return", bldkgrey, blltblack"}return""}const pHe=[...RE(0,15),...RE(33,48)],mHe=[...RE(0,15),32];function KG({sidebar:t,chip:e,row:n,label:r,args:i,context:s,isbg:o=!1}){Su(t,n,s);const[a]=[rp(i[0],"")],c=Cv(e,a),u=bC(c)??0,h=ff(),[f,d]=Ye.useState(!1);Ye.useLayoutEffect(()=>{d(!0)},[]);const p=o?mHe:pHe,m=p.indexOf(u),g=`${u}`.padStart(2,"0"),_=r.trim(),y=(Ft[u]||Ft[Ft.BLACK]).toLowerCase(),v=dHe(y).padEnd(32," "),E=s.x-1,x=s.y+2,A=[`$green${_} ${g} ${y}${v}
$white`];for(let O=0;O<p.length;++O){O%YS===0&&A.push(`
`);const z=p[O],q=(Ft[z]||Ft[Ft.BLACK]).toLowerCase();if(z===u)if(h){const G=O%16<8?"white":"black";A.push(z>32?"$onwhite$219":`$${G}$219`)}else A.push(`$onblack$${q}$219`);else A.push(`$onblack$${q}$219`)}A.push("$white"),A.push(`

`),A.push(`$greenpress C to copy ${g}`),A.push(`

`),A.push(`$greenpress B to copy bits of ${g}`),ei(A.join(""),s,!0);const T=Ye.useContext(Wg),k=Ye.useCallback(O=>{const z=p[Ci(O,0,p.length-1)];cu(c,z)},[p,c]),L=Ye.useCallback(()=>{k(m-YS)},[k,m]),I=Ye.useCallback(()=>{k(m-1)},[k,m]),F=Ye.useCallback(()=>{k(m+1)},[k,m]),M=Ye.useCallback(()=>{k(m+YS)},[k,m]),D=Ye.useCallback(()=>{T.sendclose()},[T]);return Ee.jsx("group",{position:[E*kn.DRAW_CHAR_WIDTH(),x*kn.DRAW_CHAR_HEIGHT(),1],children:f&&Ee.jsxs(Dv,{blockhotkeys:!0,children:[Ee.jsx(Nm,{x:1,blocking:!0,visible:!1,cursor:"pointer",width:YS,height:$re,onClick:O=>{O.intersections[0].object.worldToLocal(x4.copy(O.intersections[0].point));const z=fHe(),q=Yf(z,YS);q>=0&&q<=16&&(cu(c,q),T.sendclose())}}),Ee.jsx(xo,{MOVE_LEFT:I,MOVE_UP:L,MOVE_RIGHT:F,MOVE_DOWN:M,OK_BUTTON:D,CANCEL_BUTTON:D,keydown:O=>{switch(O.key.toLowerCase()){case"c":ME(qe,ii(),`${u}`),T.sendclose();break;case"b":{if(u!==Ft.ONCLEAR){const q=u<Ft.ONCLEAR?u:u-Ft.BLBLACK,G=va.getState().palettedata?.[q],K=Math.round((G?.r??0)*255),te=Math.round((G?.g??0)*255),re=Math.round((G?.b??0)*255),H=`@color${q} ${K} ${te} ${re}`;ME(qe,ii(),H),T.sendclose()}break}}}})]})})}function gHe({sidebar:t,item:e,row:n,context:r}){Su(t,n,r);const i=yp(r),s=G8(e);if(fe(s)){const o=i.width-3,c=$g(s,o,3)?.measuredwidth??1,l=Ci(Math.floor(o*.5-c*.5),0,o);ei(`${" ".repeat(l)}$WHITE${s}${fe(n)?`
`:""}`,r,!0)}else ei(`${e}${fe(n)?`
`:""}`,r,!0);return null}function _He({sidebar:t,row:e,active:n,label:r,args:i,context:s}){const o=Ye.useContext(Wg),a=Ye.useCallback(()=>{const[,...l]=i;ME(qe,ii(),l.join(" ")),o.sendclose()},[i,o]),c=jl(!!n);return Su(t,e,s),ei(`  $purple$16 $yellowCOPYIT ${c}${r}`,s,!0),n&&Ee.jsx(xo,{OK_BUTTON:a})}function vHe({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){Su(t,n,o);const[a,c,l,u,...h]=s.map(v=>rp(v,"")),f=l||` ${c.toUpperCase()} `,d=jl(r),p=o.x-.25,m=o.y-.25,g=`${o.iseven?"$black$onltgray":"$black$ondkcyan"}${f}${d}$onclear ${i}${fe(n)?`
`:""}`;ei(g,o,!0);const _=Ye.useContext(Wg),y=Ye.useCallback(()=>{_.sendmessage(RU(e,a),h),u||_.sendclose()},[e,_,a,u,h]);return Ee.jsxs("group",{position:[p*kn.DRAW_CHAR_WIDTH(),m*kn.DRAW_CHAR_HEIGHT(),1],children:[Ee.jsx(Nm,{visible:!1,width:f.length+.5,height:1.5,blocking:!0,onClick:y}),r&&Ee.jsx(xo,{OK_BUTTON:y}),c&&Ee.jsx(w1,{hotkey:c,children:y})]})}function yHe({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){Su(t,n,o);const a=s.map(d=>rp(d,"")),[c,...l]=a,u=jl(r);ei(`  $purple$16 ${u}${i}
`,o,!0);const h=Ye.useContext(Wg),f=Ye.useCallback(()=>{h.sendmessage(RU(e,c),l),h.sendclose()},[h,e,c,l]);return r&&Ee.jsx(xo,{OK_BUTTON:f})}const QR=-111111;function bHe({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){Su(t,n,o);const[a,c,l]=[rp(s[0],""),u1(s[1],QR),u1(s[2],QR)];let u,h;c===QR?(u=0,h=31):l===QR?(u=0,h=c):(u=c,h=l);const f=Cv(e,a),d=bC(f),p=d??0,m=ff(),[g,_]=Ye.useState(""),[y,v]=Ye.useState(0),[E,x]=Ye.useState(!1);let A=`${p}`;const T=i.trim(),k=jl(r);E&&(A=m?kT(g,y,1,"$219+"):g),o.writefullwidth=32,ei(` # ${k}${T} $green${A}`,o,!1),o.writefullwidth=void 0;const L=Ye.useCallback(M=>{const D=M.alt?10:1;cu(f,Math.min(h,p+D))},[h,p,f]),I=Ye.useCallback(M=>{const D=M.alt?10:1;cu(f,Math.max(u,p-D))},[u,p,f]),F=Ye.useCallback(()=>{x(M=>{const D=!M;if(D){const O=`${d}`;_(O),v(O.length)}else{const O=parseFloat(g),z=isNaN(O)?0:O;cu(a,Math.min(h,Math.max(u,z)))}return D})},[h,u,g,a,d]);return d!==void 0&&Ee.jsxs(Ee.Fragment,{children:[r&&!E&&Ee.jsx(xo,{MOVE_LEFT:I,MOVE_RIGHT:L,OK_BUTTON:F}),E&&Ee.jsxs(Dv,{blockhotkeys:!0,children:[Ee.jsx(w1,{hotkey:"ctrl+c",children:()=>{console.info("copy")}}),Ee.jsx(w1,{hotkey:"ctrl+v",children:()=>{console.info("paste")}}),Ee.jsx(w1,{hotkey:"ctrl+a",children:()=>{console.info("select all")}}),Ee.jsx(xo,{MOVE_LEFT:()=>{v(M=>Math.max(0,M-1))},MOVE_RIGHT:()=>{v(M=>Math.min(g.length,M+1))},CANCEL_BUTTON:F,OK_BUTTON:F,keydown:M=>{switch(rr(M.key)){case"delete":g.length>0&&_(D=>kT(D,y,1));break;case"backspace":y>0&&(_(D=>kT(D,y-1,1)),v(D=>Math.max(0,D-1)));break}M.key.length===1&&g.length<o.width*.5&&(_(D=>kT(D,y,0,M.key)),v(D=>D+1))}})]})]})}function SHe({sidebar:t,row:e,active:n,label:r,args:i,context:s}){const o=Ye.useCallback(()=>{const[,c,...l]=i,u=l.join(" "),h=ii();setTimeout(()=>{switch(c){case"wiki":io(qe,h,async()=>{const f=await X8(u);oU(h,f)});break;case"inline":window.location.href=u;break;default:window.open(`${c} ${u}`.trim(),"_blank");break}},100)},[i]),a=jl(!!n);return Su(t,e,s),ei(`  $purple$16 $yellowOPENIT ${a}${r}`,s,!0),n&&Ee.jsx(xo,{OK_BUTTON:o})}function EHe({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){Su(t,n,o);const[a,c,l]=[rp(s[0],""),rp(s[1],""),rp(s[2],"")];let u,h;c===""?(u="L ",h=" H"):l===""?(u="L ",h=` ${c}`):(u=`${c} `,h=` ${l}`);const f=0,d=8,p=Cv(e,a),g=bC(p)??0,_=ff(),y=i.trim(),v=jl(r);ei(`$red $29 ${v}${y} `,o,!1);const x=kT("----:----",g,1,`$green${r?_?"$26":"$27":"$4"}${v}`).replaceAll("-","$7").replaceAll(":","$9");ei(`${v}${u}${x}${h} $green${g+1}`,o,!1);const A=Ye.useCallback(k=>{const L=k.alt?10:1;cu(p,Math.min(d,g+L))},[d,g,p]),T=Ye.useCallback(k=>{const L=k.alt?10:1;cu(p,Math.max(f,g-L))},[f,g,p]);return Ee.jsx(Ee.Fragment,{children:r&&Ee.jsx(xo,{MOVE_LEFT:T,MOVE_RIGHT:A})})}function xHe({sidebar:t,row:e,active:n,label:r,args:i,context:s}){const o=Ye.useContext(Wg),a=Ye.useCallback(()=>{const[,...l]=i;o.sendclose(),setTimeout(()=>{W5(qe,ii(),l.join(" "))},1e3)},[i,o]),c=jl(!!n);return Su(t,e,s),ei(`  $purple$16 $cyanRUNIT ${c}${r}`,s,!0),n&&Ee.jsx(xo,{OK_BUTTON:a})}function wHe({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){Su(t,n,o);const[a,...c]=[rp(s[0],""),...s.slice(1)],l=[],u=[];for(let x=0;x<c.length;x+=2)l.push(c[x]),u.push(c[x+1]);const h=Cv(e,a),d=`${bC(h)??0}`;let p=u.indexOf(d);p<0&&(p=0);const m=ff(),g=i.trim(),_=jl(r);ei(`$dkred ? ${_}${g} `,o,!1);const y=r?m?"$26":"$27":"/";ei(`${p+1}$green${y}${_}${u.length}`,o,!1),o.writefullwidth=32,ei(` $green${l[p]}`,o,!1),o.writefullwidth=void 0;const v=Ye.useCallback(()=>{const x=Math.max(0,p-1),A=parseFloat(u[x]);Number.isInteger(A)&&cu(h,A)},[p,h]),E=Ye.useCallback(()=>{const x=Math.min(u.length-1,p+1),A=parseFloat(u[x]);Number.isInteger(A)&&cu(h,A)},[p,h]);return Ee.jsx(Ee.Fragment,{children:r&&Ee.jsx(xo,{MOVE_LEFT:v,MOVE_RIGHT:E})})}function THe({sidebar:t,chip:e,row:n,active:r,label:i,args:s,context:o}){Su(t,n,o);const a=rp(s[0],""),c=Cv(e,a),l=xte(c),u=l?.toJSON()??"",h=ff(),[f,d]=Ye.useState(0),[p,m]=Ye.useState(!1),[g,_]=Ye.useState(void 0),y=`${u} `,v=i.trim(),E=jl(r);ei(`$green $20 ${E}${v} $green`,o,!1);const x=o.x,T=o.y*o.width;o.writefullwidth=32,ei(`${y}`,o,!1),o.writefullwidth=void 0;const k=fe(g),L=o.width-x-2,I=k?Math.min(g,f):f;let F=k?Math.max(g,f):f;k&&(F!==I&&F===f&&--F,fv(x+I+T,x+F+T,15,8,o)),p&&h&&TA(x+f+T,"",o);function M(){fe(l)&&(d(I),_(void 0),l.delete(I,F-I+1))}return Ee.jsxs(Ee.Fragment,{children:[r&&Ee.jsx(xo,{OK_BUTTON:()=>{l&&(m(!0),d(l.length),_(void 0))}}),p&&Ee.jsx(Dv,{blockhotkeys:!0,children:Ee.jsx(xo,{MOVE_LEFT:D=>{D.shift?fe(g)||_(Ci(f-1,0,u.length)):_(void 0),d(O=>Ci(O-1,0,u.length))},MOVE_RIGHT:D=>{D.shift?fe(g)||_(f):_(void 0),d(O=>Ci(O+1,0,u.length))},CANCEL_BUTTON:()=>{m(!1),d(u.length),_(void 0)},OK_BUTTON:()=>m(!1),keydown:D=>{if(!l)return;const{key:O}=D,z=rr(O),q={alt:D.altKey,ctrl:z1?D.metaKey:D.ctrlKey,shift:D.shiftKey},G=l.toJSON();switch(z){case"delete":k?M():G.length>0&&l.delete(f,1);break;case"backspace":k?M():f>0&&(l.delete(f-1,1),d(K=>Math.max(0,K-1)));break;default:if(q.ctrl)switch(z){case"a":_(0),d(G.length);break;case"c":fe(da())&&da().writeText(l.toJSON()).catch(K=>console.error(K));break;case"v":fe(da())&&da().readText().then(K=>{k&&M(),l.insert(f,K),d(f+K.length)}).catch(K=>console.error(K));break;case"x":fe(da())&&da().writeText(l.toJSON()).then(()=>M()).catch(K=>console.error(K));break}else q.alt||D.key.length===1&&G.length<L&&(l.insert(f,D.key),d(K=>K+1));break}}})})]})}function AHe({sidebar:t,row:e,active:n,label:r,args:i,context:s}){const{setviewimage:o}=va(),a=Ye.useCallback(()=>{const[,...l]=i,u=l.join(" ");o(u)},[o,i]),c=jl(!!n);return Su(t,e,s),ei(`  $purple$16 $cyanVIEWIT ${c}${r}`,s,!0),n&&Ee.jsx(xo,{OK_BUTTON:a})}function CHe({chip:t,row:e,active:n,label:r,args:i,context:s}){Su(!1,e,s);const[o]=[rp(i[0],"")],a="z",c=` ${a.toUpperCase()} `,l=jl(n),u=s.x-.25,h=s.y-.25;ei(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${c}${l}$onclear ${r}${fe(e)?`
`:""}`,s,!0);const f=Ye.useContext(Wg),d=Ye.useCallback(()=>{f.sendmessage(RU(t,o),[])},[f,t,o]);return Ee.jsxs("group",{position:[u*kn.DRAW_CHAR_WIDTH(),h*kn.DRAW_CHAR_HEIGHT(),1],children:[Ee.jsx(Nm,{visible:!1,width:c.length+.5,height:1.5,blocking:!0,onClick:d}),n&&Ee.jsx(xo,{OK_BUTTON:d}),Ee.jsx(w1,{hotkey:a,children:d})]})}function RHe({sidebar:t,row:e,item:n,active:r}){const i=ii(),s=Bl();if(Su(t,e,s),s.iseven=s.y%2===0,typeof n=="string")return Ee.jsx(gHe,{sidebar:t,player:i,item:n,row:e,context:s});if(Kn(n)){const[o,a,c,l,...u]=n;if(typeof o!="string"||typeof a!="string"||typeof c!="string")return null;const h={sidebar:t,player:i,chip:o,row:e,active:r,label:a,args:[c,...u],context:s},f=dn(l)?l:"";switch(rr(f)){default:case"hyperlink":return Ee.jsx(yHe,{...h});case"hk":case"hotkey":return Ee.jsx(vHe,{...h});case"rn":case"range":return Ee.jsx(EHe,{...h});case"sl":case"select":return Ee.jsx(wHe,{...h});case"nm":case"number":return Ee.jsx(bHe,{...h});case"tx":case"text":return Ee.jsx(THe,{...h});case"copyit":return Ee.jsx(_He,{...h});case"openit":return Ee.jsx(SHe,{...h});case"viewit":return Ee.jsx(AHe,{...h});case"runit":return Ee.jsx(xHe,{...h});case"zssedit":return Ee.jsx(CHe,{...h});case"charedit":return Ee.jsx(hHe,{...h});case"coloredit":return Ee.jsx(KG,{...h});case"bgedit":return Ee.jsx(KG,{isbg:!0,...h})}}return null}function Gre({inline:t=!1,xmargin:e=1,ymargin:n=1,selected:r=-1,width:i,height:s,color:o,bg:a,text:c}){const l=ab(i,s,0,o,a),u=l.getState(),h={...Hg(i,s,o,a,n,e,i-e-1,s-n),...l.getState(),x:e,y:n};return LI(u,0,o,a),Ee.jsxs(lb,{store:l,children:[Ee.jsx(ub,{width:i,height:s}),Ee.jsx(xC.Provider,{value:h,children:c.map((f,d)=>Ee.jsx(RHe,{row:t?void 0:d,item:f,active:d===r,sidebar:e!==0},d))})]})}const XG=4,kHe=z1?.25:.5;function MHe(t){const e=Ci(t,-XG,XG);return Math.floor(e*kHe)}function kU({debug:t=!1,disabled:e=!1,blocking:n=!0,cursor:r="pointer",x:i=0,y:s=0,width:o=30,height:a=10,children:c,onClick:l,onScroll:u,...h}){return Ee.jsxs("group",{...h,children:[Ee.jsx(Nm,{blocking:n,cursor:r,visible:t,x:i,y:s,width:o,height:a,onClick:l,onWheel:f=>{e||u?.(MHe(f.deltaY))}}),c]})}const OHe=2,IHe=14,Wre=IHe*OHe;function NHe(t){return z5(t,Wre*.5)}function PHe(t,e,n,r,i=1.235){function s(a){return m9e(a,r)}tl(t.userData,e,n,i,r,Wre*12,s),t.position[e]=NHe(t.userData[e]);const o=n-t.position.y;return Math.abs(o)<.1}function DHe({name:t,width:e,height:n,context:r}){const i=ane();for(let c=1;c<e-1;++c)c>2&&c<e-1&&$o(i,e,n,c,1,{char:205,color:15}),$o(i,e,n,c,n-1,{char:205,color:15});$o(i,e,n,e-2,0,{char:196,color:15}),$o(i,e,n,1,0,{char:205,color:15}),$o(i,e,n,2,0,{char:187,color:15}),$o(i,e,n,2,1,{char:200,color:15});for(let c=1;c<n-1;++c)$o(i,e,n,0,c,{char:179,color:15}),$o(i,e,n,e-1,c,{char:179,color:15});for(let c=2;c<n-1;++c)$o(i,e,n,1,c,{char:0,color:15}),$o(i,e,n,e-2,c,{char:0,color:15});$o(i,e,n,0,0,{char:213,color:15}),$o(i,e,n,e-1,0,{char:191,color:15}),$o(i,e,n,e-1,1,{char:181,color:15}),$o(i,e,n,0,n-1,{char:212,color:15}),$o(i,e,n,e-1,n-1,{char:190,color:15});const s=` ${t} `,a=$g(s,e,n)?.x??s.length;return r.x=Math.round(e*.5),r.x-=Math.round(a*.5),r.y++,ei(s,r,!0),null}function LHe({store:t,children:e}){return Ee.jsx(sne.Provider,{value:t,children:e})}function UHe({width:t,height:e}){const n=Ye.useContext(sne),[r]=Y8(n,xh(i=>[i.dither,i.render]));return t>0&&e>0&&Ee.jsx($I,{alphas:r.slice(),width:t,height:e})}function JG({x:t,y:e,color:n,on:r=232,off:i=7,alt:s}){const o=ff(),a=ane(),c=Ye.useRef(0),l=fe(s)?c.current%2===0?r:s:r;return $o(a,a.width,a.height,t,e,{char:o?l:i,color:n}),a.changed(),o&&++c.current,null}function BHe({row:t,width:e,height:n,panelwidth:r,panelheight:i,children:s}){const o=xUe(r,i,0),a=[.001,.05,.1,.2],c=.4,{dither:l}=o.getState();EUe(l);for(let u=0;u<r;++u){b2(l,r,i,u,t,c);for(let h=0;h<a.length;++h){const f=a.length-h;b2(l,r,i,u,t-f,a[h]),b2(l,r,i,u,t+f,a[h])}}return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(ub,{width:e,height:n}),Ee.jsxs("group",{position:[2*kn.DRAW_CHAR_WIDTH(),2*kn.DRAW_CHAR_HEIGHT(),0],children:[Ee.jsx(LHe,{store:o,children:Ee.jsx(UHe,{width:r,height:i})}),s,Ee.jsx(JG,{x:1,y:1}),Ee.jsx(JG,{x:1,y:2+t,on:26,alt:27,off:45,color:12})]})]})}function MU({line:t,color:e,margin:n,y:r,leftedge:i,rightedge:s,context:o}){const a=ff(),l=`$${(Ft[e]??"").toLowerCase()}${t.replaceAll(`
`,"").trim()}`,h=$g(l,1e4,1)?.measuredwidth??1,[f,d]=Ye.useState(0);Ye.useEffect(()=>{d(p=>a?p:(p-1)%h)},[a,h]),o.disablewrap=!0,o.active.leftedge=n,o.active.rightedge=s-n;for(let p=i+n+f;p<=s;p+=h)o.x=p,o.y=r,ei(l,o,!1);return o.active.leftedge=0,o.active.rightedge=s,o.disablewrap=!1,null}function FHe({width:t,height:e,color:n,bg:r,text:i,shouldclose:s}){const{viewport:o}=Dc(),a=t-3,c=e-3,l=ab(t,e,0,n,r),u=Ye.useContext(Wg),h=i.length-1,f=Kr(k=>k.gadget.scrollname??""),d={...Hg(t,e,n,r,0,0,t,e),...l.getState()},[p,m]=Ye.useState(()=>{const k=i.findIndex(L=>Kn(L));return k>=0&&k<=8?k:0});let g=p-Math.floor(c*.5);g=Math.min(i.length-c,g),g=Math.max(0,g);const _=i.slice(g,g+c),y=p-g,v=Ye.useRef(null),E=Ye.useCallback(()=>{s&&u.didclose()},[s,u]),x=Ye.useCallback(k=>{const L=k.ctrl?h:k.alt?10:1;m(I=>Math.max(0,I-L))},[m,h]),A=Ye.useCallback(k=>{const L=k.ctrl?h:k.alt?10:1;m(I=>Math.min(h,I+L))},[m,h]),T=Ye.useCallback(k=>{m(L=>Ci(Math.round(L+k),0,h))},[m,h]);return Ye.useEffect(()=>{if(v.current&&!s){const k=o.height;v.current.position.y=k,v.current.userData.y=k,v.current.userData.vy=0}},[s]),Dg(Ye.useCallback((k,L)=>{if(fe(v.current)){const I=s?e*2*-kn.DRAW_CHAR_HEIGHT():0;PHe(v.current,"y",I,L)&&E()}},[s,E,e])),Ee.jsxs("group",{ref:v,"position-y":1e6,children:[Ee.jsx(kU,{blocking:!0,x:0,y:0,width:t,height:e,onScroll:k=>T(k*.5)}),Ee.jsxs(Dv,{children:[Ee.jsx(xo,{MOVE_UP:x,MOVE_DOWN:A,CANCEL_BUTTON:u.sendclose}),Ee.jsxs(lb,{store:l,children:[Ee.jsx(DHe,{name:f,width:t,height:e,context:d}),Ee.jsx(MU,{margin:3,color:Ft.BLUE,y:0,leftedge:0,rightedge:t,line:`
keys: $whiteup/down$green.SCROLL UP/DOWN 
$whiteesc/cancel$green.CLOSE SCROLL 
$whiteenter$green.ACTION ON SELECTED LINE 
$whitealt+up/down$green.JUMP 10 LINES 
$white$meta+up/down$green.JUMP TOP/BOTTOM $blue
`,context:d}),Ee.jsx(BHe,{row:y,width:t,height:e,panelwidth:a,panelheight:c,children:Ee.jsx(Gre,{width:a,height:c,xmargin:0,ymargin:0,color:n,bg:Ft.ONCLEAR,text:_,selected:y})})]})]})]})}function jHe(){const t=ev(xh(r=>r.pts)),e=ab(bn,Tr,0,Ft.BLBLACK,Ft.ONCLEAR),n=e.getState();LI(n,32,Ft.BLBLACK,Ft.ONCLEAR);for(let r=0;r<t.length;++r){const i=t[r];$o(n,bn,Tr,i.x,i.y,{char:177})}return Ee.jsx("group",{"position-z":100,children:Ee.jsx(lb,{store:e,children:Ee.jsx(ub,{width:bn,height:Tr})})})}const rO=new zt;function ZG(){const t=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),n=Math.floor(rO.x/t),r=Math.floor((rO.y+e*.5)/e);return{x:n,y:Tr*.5+r}}function zHe(){const t=ls(u=>u.inspector),[e,n]=ev(xh(u=>[u.cursor,u.select])),r=vM(e??0,bn),i=vM(n??e??0,bn),s={x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},o={x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)},a=o.x-s.x+1,c=o.y-s.y+1;function l(){nn(ev.getState().cursor)&&mxe(qe,ii(),s,o),ev.setState(()=>({cursor:void 0,select:void 0}))}return Ee.jsxs(Ee.Fragment,{children:[t&&Ee.jsx(Nm,{visible:!0,opacity:0,color:"black",x:0,y:0,z:-1,width:bn,height:Tr,cursor:"pointer",onPointerDown:u=>{u.intersections[0].object.worldToLocal(rO.copy(u.intersections[0].point));const h=ZG();ev.setState(()=>({cursor:Yf(h,bn)}))},onPointerMove:u=>{if(fe(ev.getState().cursor)){u.intersections[0].object.worldToLocal(rO.copy(u.intersections[0].point));const h=ZG();ev.setState(()=>({select:Yf(h,bn)}))}},onPointerUp:l,onPointerOut:l,onPointerCancel:l}),fe(e)&&Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(Nm,{x:s.x+.25,y:s.y+.25,z:100,width:a-.5,height:c-.5,color:"black",opacity:.3}),Ee.jsx(Nm,{x:s.x,y:s.y,z:101,width:a,height:c,color:"white",opacity:.25})]})]})}function VHe(){return ls(e=>e.inspector)&&Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(zHe,{}),Ee.jsx(jHe,{})]})}function OU(t,e){const n=Ye.useMemo(()=>Array.from({length:e},()=>({id:"",x:0,y:0,char:0,color:0,bg:0,stat:0})),[e]),r=Ye.useMemo(()=>{const i={};for(let c=0;c<t.length;++c)i[t[c].id]=t[c];const s=new Set(n.map(c=>c.id));let o=0,a=0;for(let c=0;c<e;++c)if(n[c].id){const l=i[n[c].id];fe(l)?(n[c]={...l},a=Math.max(c,a)):n[c].id=""}else if(o<t.length){for(;s.has(t[o]?.id)===!0;)++o;o<t.length&&(n[c]={...t[o++]},a=Math.max(c,a))}return a},[t,e,n]);return[n,r]}const qre=VE(Y1(J1)),iO=_m(K1(X1)),HHe=new ao({transparent:!1,side:Oa,uniforms:{time:Ma,interval:vx,smoothrate:new un(QA),palette:new un(qre),map:new un(iO),alt:new un(iO),dpr:new un(1),screenwidth:new un(1),screenheight:new un(1),pointSize:new un(new zn),rows:new un(1),step:new un(new zn),size:new un(new zn),pixel:new un(new zn),flip:new un(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec4 display;
    attribute vec3 lastposition;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    ${bx}

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = palette[int(index)];
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      vVisible = visible;

      float deltaPosition = animDelta(lastposition.z, smoothrate, 1.0);
      vec2 animPosition = mix(lastposition.xy, position.xy, deltaPosition);

      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = display.xy;

      animPosition *= pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x -= 1.0;

      vec4 mvPosition = vec4(animPosition, 0.0, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      gl_PointSize = pointSize.y * modelViewMatrix[0][0] * dpr;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 size;
    uniform vec2 pixel;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      float xscale = pointSize.y / pointSize.x;
      float xpadding = (pointSize.y - pointSize.x) / pointSize.y;
      float px = gl_PointCoord.x * xscale - xpadding;      
      if (vVisible == 0.0 || px < 0.0 || px > 1.0) {
        discard;
      }
      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }

      vec2 idx = vec2(px, py) * size * pixel;
      vec2 lookup = vec2(vDisplay.x, rows - vDisplay.y) * step * pixel;
      vec2 uv = lookup + idx + vec2(1.0, 1.0) * pixel;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function $He(){return Lv(HHe)}const GHe=new ao({transparent:!1,side:Oa,uniforms:{time:Ma,interval:vx,smoothrate:new un(QA),palette:new un(qre),map:new un(iO),alt:new un(iO),dpr:new un(1),screenwidth:new un(1),screenheight:new un(1),pointSize:{value:new zn(1,1)},rows:new un(1),step:new un(new zn),size:new un(new zn),pixel:new un(new zn),flip:new un(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec4 display;
    attribute vec3 lastposition;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float screenwidth;
    uniform float screenheight;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    ${bx}

    float PI = radians(180.0);

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      vVisible = visible;

      float deltaPosition = animDelta(lastposition.z, smoothrate, 1.0);
      vec2 animPosition = mix(lastposition.xy, position.xy, deltaPosition);

      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = display.xy;

      animPosition *= pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x -= 1.0;

      // model space
      vec4 mvPosition = vec4(animPosition, 0.0, 1.0);
      #ifdef USE_INSTANCING
        mvPosition = instanceMatrix * mvPosition;
      #endif
      mvPosition = modelViewMatrix * mvPosition;
  
      // transform to screenspace 
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      float fov = 2.0 * atan(1.0 / projectionMatrix[1][1]) * 180.0 / PI;
      float heightOfNearPlane = screenheight / (2.0 * tan(0.5 * fov * PI / 180.0));
      gl_PointSize = (heightOfNearPlane * pointSize.y) / gl_Position.w;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 size;
    uniform vec2 pixel;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      float xscale = pointSize.y / pointSize.x;
      float xpadding = (pointSize.y - pointSize.x) / pointSize.y;
      float px = gl_PointCoord.x * xscale - xpadding;      
      
      if (vVisible == 0.0 || px < 0.0 || px > 1.0) {
        discard;
      }
      
      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }

      vec2 idx = vec2(px, py) * size * pixel;
      vec2 lookup = vec2(vDisplay.x, rows - vDisplay.y) * step * pixel;
      vec2 uv = lookup + idx + vec2(1.0, 1.0) * pixel;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function WHe(){return Lv(GHe)}function MA({sprites:t,scale:e=1,withbillboards:n=!1,limit:r=zm}){const{viewport:i}=Dc(),s=va(G=>G.palettedata),o=va(G=>G.spritecharsetdata),a=va(G=>G.spritealtcharsetdata),c=Ye.useMemo(()=>n?WHe():$He(),[n]),{width:l=0,height:u=0}=o?.image??{};Ye.useEffect(()=>{if(!o)return;const G=Yo+2,K=Ia+2,te=Math.round(u/K);c.uniforms.palette.value=s,c.uniforms.map.value=o,c.uniforms.alt.value=a??o,c.uniforms.dpr.value=e,c.uniforms.screenwidth.value=i.width,c.uniforms.screenheight.value=i.height,c.uniforms.rows.value=te-1,c.uniforms.step.value.x=G,c.uniforms.step.value.y=K,c.uniforms.size.value.x=Yo,c.uniforms.size.value.y=Ia,c.uniforms.pixel.value.x=1/l,c.uniforms.pixel.value.y=1/u,c.uniforms.pointSize.value.x=kn.DRAW_CHAR_WIDTH(),c.uniforms.pointSize.value.y=kn.DRAW_CHAR_HEIGHT(),c.uniforms.flip.value=!1,c.needsUpdate=!0},[s,o,a,c,l,u,i.width,i.height,e]);const[h,f]=Ye.useState(),[d,p]=OU(t,r),m=Ye.useMemo(()=>new Uint8Array(r),[r]),g=Ye.useMemo(()=>new Float32Array(r*3),[r]),_=Ye.useMemo(()=>new Float32Array(r*3),[r]),y=Ye.useMemo(()=>new Float32Array(r*4),[r]),v=Ye.useMemo(()=>new Float32Array(r*2),[r]),E=Ye.useMemo(()=>new Float32Array(r*2),[r]),[x,A]=Ye.useState(),[T,k]=Ye.useState(),[L,I]=Ye.useState(),[F,M]=Ye.useState(),[D,O]=Ye.useState(),[z,q]=Ye.useState();return Ye.useEffect(()=>{if(!(!fe(h)||!fe(x)||!fe(T)||!fe(L)||!fe(F)||!fe(D)||!fe(z))){for(let G=0;G<d.length;++G){const K=d[G];if(K.id)if(x.getX(G)===0)T.setXY(G,K.x,K.y),F.setXYZW(G,K.char%yo,Math.floor(K.char/yo),K.color,K.bg),L.setXYZ(G,K.x,K.y,Ma.value),D.setXY(G,K.color,Ma.value),z.setXY(G,K.bg,Ma.value),x.setX(G,1),x.needsUpdate=!0,T.needsUpdate=!0,F.needsUpdate=!0,L.needsUpdate=!0,D.needsUpdate=!0,z.needsUpdate=!0;else{(T.getX(G)!==K.x||T.getY(G)!==K.y)&&(L.setXYZ(G,T.getX(G),T.getY(G),Ma.value),T.setXY(G,K.x,K.y),L.needsUpdate=!0,T.needsUpdate=!0);const re=K.char%yo,H=Math.floor(K.char/yo);(F.getX(G)!==re||F.getY(G)!==H)&&(F.setXY(G,re,H),F.needsUpdate=!0),F.getZ(G)!==K.color&&(D.setXY(G,F.getZ(G),Ma.value),F.setZ(G,K.color),D.needsUpdate=!0,F.needsUpdate=!0),F.getW(G)!==K.bg&&(z.setXY(G,F.getW(G),Ma.value),F.setW(G,K.bg),z.needsUpdate=!0,F.needsUpdate=!0)}else x.getX(G)&&(x.setX(G,0),x.needsUpdate=!0)}h.computeBoundingBox(),h.computeBoundingSphere()}},[h,t,d,p,x,T,F,L,D,z]),Ee.jsxs("points",{frustumCulled:!1,children:[Ee.jsxs("bufferGeometry",{ref:f,children:[Ee.jsx("bufferAttribute",{ref:A,attach:"attributes-visible",name:"visible",args:[m,1]}),Ee.jsx("bufferAttribute",{ref:k,attach:"attributes-position",name:"position",args:[g,3]}),Ee.jsx("bufferAttribute",{ref:I,attach:"attributes-lastposition",name:"lastpositiona",args:[_,3]}),Ee.jsx("bufferAttribute",{ref:M,attach:"attributes-display",name:"display",args:[y,4]}),Ee.jsx("bufferAttribute",{ref:O,attach:"attributes-lastcolor",name:"lastcolor",args:[v,2]}),Ee.jsx("bufferAttribute",{ref:q,attach:"attributes-lastbg",name:"lastbg",args:[E,2]})]}),Ee.jsx("primitive",{object:c,attach:"material"})]})}function T1({id:t,z:e,from:n}){const r=Kr(xh(i=>i.gadget[n]?.find(s=>s.id===t)));switch(r?.type){default:case Ji.BLANK:case Ji.MEDIA:return null;case Ji.TILES:return Ee.jsx("group",{position:[0,0,e],children:Ee.jsx(ip,{width:r.width,height:r.height,char:r.char,color:r.color,bg:r.bg})},r.id);case Ji.SPRITES:return Ee.jsx("group",{position:[0,0,e],children:Ee.jsx(MA,{sprites:r.sprites})},r.id);case Ji.DITHER:return Ee.jsx("group",{position:[0,0,e],children:Ee.jsx($I,{width:r.width,height:r.height,alphas:r.alphas})},r.id)}}const QG=t=>(t.getAttributes()&du.CONVOLUTION)===du.CONVOLUTION,qHe=Ye.memo(Ye.forwardRef(({children:t,camera:e,width:n,height:r},i)=>{const{gl:s,scene:o}=Dc(),[a]=Ye.useMemo(()=>{const u=new Ire(s,{depthBuffer:!0,stencilBuffer:!1,multisampling:0,frameBufferType:Av});return u.autoRenderToScreen=!1,u.addPass(new Pre(o,e)),[u]},[e,s,o]);Dg((u,h)=>{a.setSize(n,r),a.render(h)},1);const c=Ye.useRef(null);Ye.useLayoutEffect(()=>{const u=[],h=c.current.__r3f;if(h&&a){const f=h.children;for(let d=0;d<f.length;d++){const p=f[d].object;if(p instanceof od){const m=[p];if(!QG(p)){let _=null;for(;(_=f[d+1]?.object)instanceof od&&!QG(_);)m.push(_),d++}const g=new Dre(e,...m);u.push(g)}else p instanceof wh&&u.push(p)}for(const d of u)a?.addPass(d)}return()=>{for(const f of u)a?.removePass(f)}},[a,t,e]);const l=Ye.useMemo(()=>({composer:a,normalPass:null,downSamplingPass:null,resolutionScale:void 0,camera:e,scene:o}),[a,e,o]);return Ye.useImperativeHandle(i,()=>a,[a]),Ee.jsx(xU.Provider,{value:l,children:Ee.jsx("group",{ref:c,children:t})})})),YHe=Ye.forwardRef(function({children:e,fbo:n,...r},i){const[s]=Ye.useState(()=>new Jk);return Ye.useImperativeHandle(i,()=>n,[n]),Ee.jsxs(Ee.Fragment,{children:[Mpe(Ee.jsxs(Ee.Fragment,{children:[e,Ee.jsx("group",{onPointerOver:()=>null})]}),s),Ee.jsx("primitive",{object:n.texture,...r})]})});function KHe({fbo:t,effects:e}){const{mood:n}=va(),[r]=Ye.useState(()=>new Mre(t,!0));return Ye.useEffect(()=>()=>{r.dispose()},[r]),Ee.jsxs(Ee.Fragment,{children:[n.includes("dark")&&Ee.jsxs(Ye.Fragment,{children:[Ee.jsx(aVe,{delay:new zn(10,120),duration:new zn(.1,3),strength:new zn(0,.15),mode:nv.SPORADIC,active:!0,ratio:.5}),Ee.jsx(cVe,{opacity:.5,premultiply:!0,blendFunction:di.DARKEN})]},"mood"),n.includes("bright")&&Ee.jsx(Ye.Fragment,{children:Ee.jsx(oVe,{intensity:.111,mipmapBlur:!1,luminanceThreshold:.5,luminanceSmoothing:.001,kernelSize:OC.VERY_LARGE})},"mood"),e,Ee.jsx("primitive",{object:r,dispose:null})]})}function WI({camera:t,viewwidth:e,viewheight:n,effects:r,children:i}){const{mood:s}=va(),{viewport:o}=Dc(),a=Cre(e*o.dpr,n*o.dpr,{samples:0,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),c=e*.5,l=n*.5;return Ee.jsx(Ee.Fragment,{children:Ee.jsxs("mesh",{position:[c,l,0],children:[Ee.jsx("planeGeometry",{args:[e,n]}),Ee.jsx("meshBasicMaterial",{transparent:!0,children:Ee.jsxs(YHe,{attach:"map",fbo:a,children:[i,Ee.jsx(qHe,{camera:t,width:e,height:n,children:Ee.jsx(KHe,{fbo:a,effects:r})},s)]})})]})})}function XHe({width:t,height:e}){const{viewport:n}=Dc(),r=Zm(),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),o=t*kn.DRAW_CHAR_WIDTH(),a=e*kn.DRAW_CHAR_HEIGHT(),c=Ye.useRef(null),l=Ye.useRef(null),u=Ye.useRef(null),h=Ye.useRef(null),f=Ye.useRef(null),[,d]=Ye.useState(!1);Ye.useLayoutEffect(()=>d(!0),[]),Dg((v,E)=>{if(!c.current||!h.current||!u.current||!l.current||!f.current)return;const x=q1(Kr.getState().gadget.layers??[]),A=.05,T=Kr.getState().gadget.board;fe(c.current.userData.focusx)||(c.current.userData={focusx:x.focusx,focusy:x.focusy,tfocusx:x.focusx,tfocusy:x.focusy,currentboard:T},u.current.scale.setScalar(x.viewscale));const k=c.current.userData??{},L=(k.focusx+.5)*i,I=(k.focusy+.5)*s;xv(u.current.scale,x.viewscale,A,E),xv(l.current.position,[-L,-I,0],A,E);const F=u.current.scale.x,M=bn*i,D=Tr*s;if(o>M*F)k.tfocusx=bn*.5;else{const O=o*.5/(i*F),z=bn-O;k.tfocusx=Ci(x.focusx,O-1,z+.25)}if(a>D*F)k.tfocusy=Tr*.5;else{const O=a*.5/(s*F),z=Tr-O;k.tfocusy=Ci(x.focusy,O-1,z)}T!==k.currentboard?(k.focusx=k.tfocusx,k.focusy=k.tfocusy,k.currentboard=T,l.current.position.set(-((k.focusx+.5)*i),-((k.focusy+.5)*s),0)):(tl(k,"focusx",k.tfocusx,A),tl(k,"focusy",k.tfocusy,A)),h.current.position.x=l.current.position.x,h.current.position.y=l.current.position.y,f.current.scale.setScalar(F)}),Kr(v=>v.gadget.over?.length??0),Kr(v=>v.gadget.under?.length??0),Kr(v=>v.gadget.layers?.length??0);const{over:p=[],under:m=[],layers:g=[]}=Kr.getState().gadget,_=n.width*-.5+r.marginx,y=n.height*.5-r.marginy;return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx("group",{position:[o*.5,a*.5,1],children:Ee.jsx("group",{ref:f,children:Ee.jsx("group",{ref:h,children:Ee.jsx(VHe,{})})})}),Ee.jsx("orthographicCamera",{ref:c,left:o*-.5,right:o*.5,top:a*-.5,bottom:a*.5,near:.1,far:2e3,position:[0,0,1e3],onUpdate:v=>v.updateProjectionMatrix()}),c.current&&Ee.jsx(WI,{camera:c.current,viewwidth:o,viewheight:a,effects:Ee.jsx(Ee.Fragment,{}),children:Ee.jsx("group",{position:[_,y,0],children:Ee.jsx("group",{ref:u,children:Ee.jsxs("group",{ref:l,children:[m.map((v,E)=>Ee.jsx(T1,{from:"under",id:v.id,z:1+E*2},v.id)),g.map((v,E)=>Ee.jsx(T1,{from:"layers",id:v.id,z:1+m.length+E*2},v.id)),p.map((v,E)=>Ee.jsx(T1,{from:"over",id:v.id,z:1+m.length+g.length+E*2},v.id))]})})})})]})}const JHe=`
float qinticIn(float t) {
  return pow(t, 5.0);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, const in float depth, out vec4 outputColor) {
	float viewZ = perspectiveDepthToViewZ(depth, cameraNear, cameraFar);
	float linearDepth = 1.0 - viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);
  float moddedDepth = qinticIn(linearDepth);
  float shade = clamp(moddedDepth, 0.0, 1.0);
  outputColor = vec4(vec3(shade), inputColor.a);
}
`;class ZHe extends od{constructor(){super("DepthFogEffect",JHe,{blendFunction:di.MULTIPLY,attributes:du.DEPTH})}update(){}}const QHe=yx(ZHe),Yre=VE(Y1(J1)),sO=_m(K1(X1)),e$e=new ao({transparent:!1,side:Oa,uniforms:{time:Ma,interval:vx,palette:new un(Yre),map:new un(sO),alt:new un(sO),cols:new un(1),step:new un(new zn)},vertexShader:`
    precision highp float;
    uniform float time;
    uniform float interval;

    varying vec2 vUv;
    varying vec3 vColor;

    void main() {
      vUv = uv;
    
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
        vColor.xyz = instanceColor.xyz;
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform vec3 palette[16];
    uniform vec2 step;
    uniform float cols;

    varying vec2 vUv;
    varying vec3 vColor;

    ${bx}

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(gl_FragCoord.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }
      
    void main() {
      // r = char, g = color, b = bg
      int tc = int(round(cols));
      int ti = int(round(vColor.r));
      float tx = float(ti % tc);
      float ty = floor(float(ti) / cols);

      int colori = int(round(vColor.g));
      int bgi = int(round(vColor.b));

      vec3 color;
      if (colori > 31) {
        vec3 bg = palette[bgi];
        color = palette[colori - 33];
        float cycle = mod(time * 2.5, interval * 2.0) / interval;
        color = mix(bg, color, cyclefromtime());
      } else {
        color = palette[colori % 16];
      }

      vec3 bg = palette[bgi];

      vec2 uv = vUv * step + vec2(tx * step.x, ty * step.y);
      uv.y = 1.0 - uv.y;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Ft.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function t$e(){return Lv(e$e)}const n$e=new ao({transparent:!1,side:Oa,uniforms:{time:Ma,interval:vx,smoothrate:new un(QA),palette:new un(Yre),map:new un(sO),alt:new un(sO),cols:new un(1),step:new un(new zn),flip:new un(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec3 nowposition;
    attribute mat4 lastmatrix;
    attribute vec4 display;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec3 palette[16];

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;
    varying vec2 vUv;

    ${bx}

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(round(index)) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = palette[int(round(index))];
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }
      
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      
      vec4 mvNowPosition = instanceMatrix * mvPosition;
      vec4 mvLastPosition = lastmatrix * mvPosition;

      float deltaPosition = clamp((time - nowposition.z) * smoothrate, 0.0, 1.0);
      mvPosition = mix(mvLastPosition, mvNowPosition, deltaPosition);

      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;

      vUv = uv;
    
      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = vec2(round(display.x), round(display.y));

      vVisible = visible;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform vec3 palette[16];
    uniform vec2 step;
    uniform float cols;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;
    varying vec2 vUv;
      
    void main() {
      if (vVisible == 0.0) {
        discard;
      }

      vec2 uv = vUv * step + vec2(vDisplay.x * step.x, vDisplay.y * step.y);
      if (flip) {
        uv.y = 1.0 - uv.y;
      }

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
      }
      gl_FragColor.a = 1.0;
    }
  `});function r$e(){return Lv(n$e)}const i$e=new ao({transparent:!1,side:Oa,uniforms:{color:{value:new wi(0,0,0)},data:{value:null}},vertexShader:`
    precision highp float;
    varying float vAlpha;
  
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
        vAlpha = instanceColor.x;
        mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
    }
    `,fragmentShader:`
    precision highp float;
    uniform vec3 color;
    uniform sampler2D data;

    varying float vAlpha;

    // adapted from https://www.shadertoy.com/view/Mlt3z8
    float bayerDither2x2( vec2 v ) {
      return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
    }

    float bayerDither4x4( vec2 v ) {
      vec2 P1 = mod( v, 2.0 );
      vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
      return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
    }

    void main() {
      if (vAlpha < 1.0) {
        vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
        if ( bayerDither4x4( ditherCoord ) / 16.0 >= vAlpha ) {
          discard;
        }
      }

      gl_FragColor.rgba = vec4(color.xyz, 1.0);
    }
    `});function s$e(){return Lv(i$e)}const Yh=new Pc;function X2({sprites:t,facing:e,children:n,limit:r=zm}){const i=va(K=>K.palettedata),s=va(K=>K.charsetdata),o=va(K=>K.altcharsetdata),[a]=Ye.useState(()=>r$e()),[c,l]=OU(t,r),{width:u=0,height:h=0}=s?.image??{};Ye.useEffect(()=>{a.uniforms.map.value=s,a.uniforms.alt.value=o??s,a.uniforms.palette.value=i;const K=Math.round(u/Yo),te=Math.round(h/Ia);a.uniforms.cols.value=K,a.uniforms.step.value.x=1/K,a.uniforms.step.value.y=1/te,a.needsUpdate=!0},[i,s,o,a,u,h]);const{position:f,uv:d}=Ye.useMemo(()=>WVe(),[]),[p,m]=Ye.useState(),g=Ye.useMemo(()=>new Uint8Array(r),[r]),_=Ye.useMemo(()=>new Float32Array(r*3),[r]),y=Ye.useMemo(()=>new Float32Array(r*16),[r]),v=Ye.useMemo(()=>new Float32Array(r*4),[r]),E=Ye.useMemo(()=>new Float32Array(r*2),[r]),x=Ye.useMemo(()=>new Float32Array(r*2),[r]),[A,T]=Ye.useState(),[k,L]=Ye.useState(),[I,F]=Ye.useState(),[M,D]=Ye.useState(),[O,z]=Ye.useState(),[q,G]=Ye.useState();return Ye.useEffect(()=>{if(!fe(p)||!fe(A)||!fe(k)||!fe(I)||!fe(M)||!fe(O)||!fe(q))return;const K=kn.DRAW_CHAR_HEIGHT();for(let te=0;te<c.length;++te){const re=c[te];if(re.id){const[H,Y,Z]=n(re.x,re.y);if(A.getX(te)===0)Yh.rotation.set(0,0,e),Yh.position.set(H,Y,Z),Yh.updateMatrix(),p.setMatrixAt(te,Yh.matrix),Yh.position.set(H,Y,Z+K*-.8),Yh.updateMatrix(),I.set(Yh.matrix.toArray(),te*16),k.setXYZ(te,H,Y,Ma.value),M.setXYZW(te,re.char%yo,Math.floor(re.char/yo),re.color,re.bg),O.setXY(te,re.color,Ma.value),q.setXY(te,re.bg,Ma.value),A.setX(te,1),A.needsUpdate=!0,k.needsUpdate=!0,I.needsUpdate=!0,M.needsUpdate=!0,O.needsUpdate=!0,q.needsUpdate=!0,p.instanceMatrix.needsUpdate=!0;else{(k.getX(te)!==H||k.getY(te)!==Y||p.userData.facing!==e)&&(p.getMatrixAt(te,Yh.matrix),I.set(Yh.matrix.toArray(),te*16),k.setXYZ(te,H,Y,Ma.value),Yh.rotation.set(0,0,e),Yh.position.set(H,Y,Z),Yh.updateMatrix(),p.setMatrixAt(te,Yh.matrix),I.needsUpdate=!0,k.needsUpdate=!0,p.instanceMatrix.needsUpdate=!0);const ie=re.char%yo,ge=Math.floor(re.char/yo);(M.getX(te)!==ie||M.getY(te)!==ge)&&(M.setXY(te,ie,ge),M.needsUpdate=!0),M.getZ(te)!==re.color&&(O.setXY(te,M.getZ(te),Ma.value),M.setZ(te,re.color),O.needsUpdate=!0,M.needsUpdate=!0),M.getW(te)!==re.bg&&(q.setXY(te,M.getW(te),Ma.value),M.setW(te,re.bg),q.needsUpdate=!0,M.needsUpdate=!0)}}else A.getX(te)&&(A.setX(te,0),A.needsUpdate=!0)}p.userData.facing=e,p.computeBoundingBox(),p.computeBoundingSphere(),p.visible=!!p.count},[t,c,e,l,p,A,I]),Ee.jsxs("instancedMesh",{ref:m,args:[void 0,void 0,r],children:[Ee.jsxs("bufferGeometry",{children:[Ee.jsx("bufferAttribute",{attach:"attributes-position",args:[f,3]}),Ee.jsx("bufferAttribute",{attach:"attributes-uv",args:[d,2]}),Ee.jsx("instancedBufferAttribute",{ref:T,name:"visible",usage:pg,attach:"attributes-visible",args:[g,1]}),Ee.jsx("instancedBufferAttribute",{ref:L,name:"nowposition",usage:pg,attach:"attributes-nowposition",args:[_,3]}),Ee.jsx("instancedBufferAttribute",{ref:F,name:"lastmatrix",usage:pg,attach:"attributes-lastmatrix",args:[y,16]}),Ee.jsx("instancedBufferAttribute",{ref:D,name:"display",usage:pg,attach:"attributes-display",args:[v,4]}),Ee.jsx("instancedBufferAttribute",{ref:z,name:"lastcolor",usage:pg,attach:"attributes-lastcolor",args:[E,2]}),Ee.jsx("instancedBufferAttribute",{ref:G,name:"lastbg",usage:pg,attach:"attributes-lastbg",args:[x,2]})]}),Ee.jsx("primitive",{object:a,attach:"material"})]})}function IU(t,e,n,r){return{char:t.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return 0}return Math.abs(i)}),color:e.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return Ft.ONCLEAR}return i}),bg:n.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:return Ft.ONCLEAR;case Fn.ISSOLID:return Ft.BLACK}return i})}}function NU(t,e,n,r){return{char:t.map((i,s)=>r[s]===Fn.ISSOLID?Math.abs(i):0),color:e,bg:n.map((i,s)=>r[s]===Fn.ISSOLID?i:Ft.ONCLEAR)}}function PU(t,e,n,r){return{char:t.map((i,s)=>r[s]===Fn.ISSWIM?Math.abs(i):0),color:e,bg:n.map((i,s)=>r[s]===Fn.ISSWIM?i:Ft.ONCLEAR)}}function o$e(t,e,n,r){return{char:t.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return 0}return t[s]<0?0:i}),color:e,bg:n.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return Ft.ONCLEAR}return t[s]<0?Ft.ONCLEAR:i})}}function Kre(t,e,n,r){return{char:t.map((i,s)=>r[s]===Fn.ISSWIM?0:176),color:e.map((i,s)=>r[s]===Fn.ISSWIM?0:Ft.DKGRAY),bg:n.map((i,s)=>r[s]===Fn.ISSWIM?Ft.ONCLEAR:Ft.BLACK)}}function a$e(t,e,n,r){return{char:t.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return 0}return t[s]<0?0:176}),color:e.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return 0}return t[s]<0?0:Ft.DKGRAY}),bg:n.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return Ft.ONCLEAR}return t[s]<0?Ft.ONCLEAR:Ft.BLACK})}}const J2=new Pc,eW=new wi;function DU({width:t,alphas:e,limit:n=zm}){const[r]=Ye.useState(()=>s$e()),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),[o,a]=Ye.useState();Ye.useEffect(()=>{if(!fe(o))return;let l=0;const u=8/14;for(let h=0;h<e.length;++h){const f=vM(h,t),d=e[h];d!==0&&(J2.position.set((f.x+.5)*i-(1-u),(f.y+.5)*s,s*-.5),J2.updateMatrix(),o.setMatrixAt(l,J2.matrix),eW.set(d,0,0),o.setColorAt(l,eW),++l)}o.count=l,o.instanceMatrix.needsUpdate=!0,fe(o.instanceColor)&&(o.instanceColor.needsUpdate=!0),o.computeBoundingBox(),o.computeBoundingSphere(),o.visible=!!o.count},[o,e,t,i,s]);const c=.1;return Ee.jsxs("instancedMesh",{ref:a,args:[void 0,void 0,n],children:[Ee.jsx("boxGeometry",{args:[i-c,s-c,s*2.5]}),Ee.jsx("primitive",{object:r,attach:"material"})]})}const Z2=new Pc,tW=new wi;function km({width:t,char:e,color:n,bg:r,partial:i,limit:s=zm}){const o=va(g=>g.palettedata),a=va(g=>g.charsetdata),c=va(g=>g.altcharsetdata),[l]=Ye.useState(()=>t$e()),{width:u=0,height:h=0}=a?.image??{};Ye.useEffect(()=>{l.uniforms.map.value=a,l.uniforms.alt.value=c??a,l.uniforms.palette.value=o;const g=Math.round(u/Yo),_=Math.round(h/Ia);l.uniforms.cols.value=g,l.uniforms.step.value.x=1/g,l.uniforms.step.value.y=1/_,l.needsUpdate=!0},[o,a,c,l,u,h]);const{position:f,uv:d}=Ye.useMemo(()=>{const g=VVe(1,1);return i&&(g.position=g.position.map((_,y)=>y%3===2?_*i:_),g.uv=g.uv.map((_,y)=>y%2===1?_*i:_)),g},[i]),[p,m]=Ye.useState();return Ye.useEffect(()=>{if(!fe(p))return;const g=kn.DRAW_CHAR_WIDTH(),_=kn.DRAW_CHAR_HEIGHT();let y=0,v=0,E=0;for(let x=0;x<e.length;++x)e[x]===0&&r[x]===Ft.ONCLEAR||(Z2.position.set(y*g,v*_,0),Z2.updateMatrix(),p.setMatrixAt(E,Z2.matrix),tW.set(e[x],n[x],r[x]),p.setColorAt(E,tW),++E),++y,y>=t&&(y=0,++v);p.count=E,p.instanceMatrix.needsUpdate=!0,fe(p.instanceColor)&&(p.instanceColor.needsUpdate=!0),p.computeBoundingBox(),p.computeBoundingSphere(),p.visible=!!p.count},[p,e,n,r,t]),Ee.jsxs("instancedMesh",{ref:m,args:[void 0,void 0,s],children:[Ee.jsxs("bufferGeometry",{children:[Ee.jsx("bufferAttribute",{attach:"attributes-position",args:[f,3]}),Ee.jsx("bufferAttribute",{attach:"attributes-uv",args:[d,2]})]}),Ee.jsx("primitive",{object:l,attach:"material"})]})}const qd=new Pc;function LU({sprites:t,children:e,alpha:n=.5,limit:r=zm}){const[i,s]=Ye.useState(),[o,a]=Ye.useState(),[c,l]=Ye.useState(),[u,h]=Ye.useState(),[f]=Ye.useState(()=>LVe()),[d,p]=OU(t,r);Ye.useLayoutEffect(()=>{f.uniforms.alpha.value=n},[f,n]);const{position:m,uv:g}=Ye.useMemo(()=>AU(1,1),[]),_=Ye.useMemo(()=>new Uint8Array(r),[r]),y=Ye.useMemo(()=>new Float32Array(r*3),[r]),v=Ye.useMemo(()=>new Float32Array(r*16),[r]);return Ye.useEffect(()=>{if(!fe(i)||!fe(o)||!fe(c)||!fe(u))return;const E=8/14;for(let x=0;x<d.length;++x){const A=d[x];if(A.id){const[T,k,L]=e(A.x,A.y);o.getX(x)===0?(qd.scale.set(1,E,1),qd.position.set(T,k,L),qd.updateMatrix(),i.setMatrixAt(x,qd.matrix),u.set(qd.matrix.toArray(),x*16),c.setXYZ(x,T,k,Ma.value),o.setX(x,1),u.needsUpdate=!0,c.needsUpdate=!0,o.needsUpdate=!0,i.instanceMatrix.needsUpdate=!0):(c.getX(x)!==T||c.getY(x)!==k)&&(i.getMatrixAt(x,qd.matrix),u.set(qd.matrix.toArray(),x*16),c.setXYZ(x,T,k,Ma.value),qd.scale.set(1,E,1),qd.position.set(T,k,L),qd.updateMatrix(),i.setMatrixAt(x,qd.matrix),u.needsUpdate=!0,c.needsUpdate=!0,i.instanceMatrix.needsUpdate=!0)}else o.getX(x)&&(o.setX(x,0),o.needsUpdate=!0)}i.computeBoundingBox(),i.computeBoundingSphere(),i.visible=!!i.count},[t,d,p,i,o,c,u]),Ee.jsxs("instancedMesh",{ref:s,args:[void 0,void 0,r],children:[Ee.jsxs("bufferGeometry",{children:[Ee.jsx("bufferAttribute",{attach:"attributes-position",args:[m,3]}),Ee.jsx("bufferAttribute",{attach:"attributes-uv",args:[g,2]}),Ee.jsx("instancedBufferAttribute",{ref:a,name:"visible",usage:pg,attach:"attributes-visible",args:[_,1]}),Ee.jsx("instancedBufferAttribute",{ref:l,name:"nowposition",usage:pg,attach:"attributes-nowposition",args:[y,3]}),Ee.jsx("instancedBufferAttribute",{ref:h,name:"lastmatrix",usage:pg,attach:"attributes-lastmatrix",args:[v,16]})]}),Ee.jsx("primitive",{object:f,attach:"material"})]})}function NS({id:t,z:e,from:n,layers:r,multi:i=!1}){const s=ii(),o=Kr(xh(u=>{if(fe(n))return u.gadget[n]?.find(h=>h.id===t);if(fe(r))return r.find(h=>h.id===t)})),a=kn.DRAW_CHAR_WIDTH(),c=kn.DRAW_CHAR_HEIGHT(),l=q1(Kr.getState().gadget.layers??[]);switch(o?.type){default:case Ji.BLANK:case Ji.MEDIA:return null;case Ji.TILES:{const u=IU(o.char,o.color,o.bg,o.stats),h=NU(o.char,o.color,o.bg,o.stats),f=PU(o.char,o.color,o.bg,o.stats),d=o$e(o.char,o.color,o.bg,o.stats),p=Kre(o.char,o.color,o.bg,o.stats),m=a$e(o.char,o.color,o.bg,o.stats);return Ee.jsx(Ee.Fragment,{children:Ee.jsxs("group",{position:[0,0,e],children:[Ee.jsx(ip,{width:o.width,height:o.height,char:u.char,color:u.color,bg:u.bg}),Ee.jsx("group",{"position-z":c*-.25,children:Ee.jsx(ip,{width:o.width,height:o.height,char:f.char,color:f.color,bg:f.bg})}),!i&&Ee.jsx("group",{"position-z":c*-.25,children:Ee.jsx(km,{width:bn,char:p.char,color:p.color,bg:p.bg,partial:.25})}),Ee.jsx("group",{"position-z":.5,children:Ee.jsx(km,{width:bn,char:h.char,color:h.color,bg:h.bg})}),Ee.jsx("group",{"position-z":c+.5,children:Ee.jsx(ip,{width:o.width,height:o.height,char:d.char,color:d.color,bg:d.bg})}),!i&&Ee.jsxs("group",{"position-z":c+.5,children:[Ee.jsx(km,{width:bn,char:m.char,color:m.color,bg:m.bg,partial:.5}),Ee.jsx(km,{width:bn,char:h.char,color:h.color,bg:h.bg})]})]},o.id)})}case Ji.SPRITES:{const u=.5714285714285714,h=o.sprites.filter(m=>{switch(m.stat){case Fn.ISSWIM:case Fn.ISBULLET:return!1;default:return m.pid!==s}}),f=o.sprites.filter(m=>m.stat===Fn.ISBULLET),d=o.sprites.filter(m=>m.stat===Fn.ISSWIM),p=o.sprites.filter(m=>{switch(m.stat){case Fn.ISSWIM:case Fn.ISGHOST:return!1;default:return m.pid!==s}});return Ee.jsxs("group",{position:[0,0,e],children:[Ee.jsx(X2,{sprites:h,facing:l.facing,children:(m,g)=>[(m+.5)*a,(g+.5)*c,c*-.5]}),Ee.jsx(X2,{sprites:f,facing:l.facing,children:(m,g)=>[(m+.5)*a,(g+.5)*c,c*-.75]}),Ee.jsx(X2,{sprites:d,facing:l.facing,children:(m,g)=>[(m+.5)*a,(g+.5)*c,c*-1.25]}),Ee.jsx(LU,{sprites:p,children:(m,g)=>[m*a,(g+.5-u*.5)*c,c*-.5+.5]})]},o.id)}case Ji.DITHER:return Ee.jsx("group",{position:[0,0,e],children:Ee.jsx(DU,{alphas:o.alphas,width:bn})},o.id)}}function PS(t){switch(t.type){case Ji.TILES:return 0;case Ji.DITHER:return kn.DRAW_CHAR_HEIGHT()+1;case Ji.SPRITES:return kn.DRAW_CHAR_HEIGHT()*.5}return 0}function c$e(t){switch(t){case fc.NEAR:return 25;default:case fc.MID:return 75;case fc.FAR:return 110}}const sE=[],oE=[],aE=[];for(let t=0;t<Tr;++t)for(let e=0;e<bn;++e)e===0||e===bn-1||t===0||t===Tr-1?(sE.push(32),oE.push(Ft.BLACK),aE.push(Ft.BLACK)):(sE.push(0),oE.push(0),aE.push(Ft.ONCLEAR));function l$e({width:t,height:e}){const{viewport:n}=Dc(),r=Zm(),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),o=t*i,a=e*s,c=bn*i,l=Ye.useRef(null),u=Ye.useRef(null),h=Ye.useRef(null),f=Ye.useRef(null),[,d]=Ye.useState(!1);Ye.useLayoutEffect(()=>{d(!0)},[]),Dg((F,M)=>{if(!l.current||!u.current||!h.current||!f.current)return;const D=q1(Kr.getState().gadget.layers??[]),O=.05,z=.111,q=Kr.getState().gadget.board;fe(f.current.userData.focusx)||(f.current.userData={focusx:D.focusx,focusy:D.focusy,lfocusx:D.focusx,lfocusy:D.focusy,facing:D.facing,lfacing:D.facing,sway:0,vsway:0,lean:0,vlean:0,currentboard:q});const G=f.current.userData??{},K=(G.focusx+.5)*i,te=(G.focusy+.5)*s;if(G.lfocusx!==D.focusx||G.lfocusy!==D.focusy){const ge=G.lfocusx-D.focusx,Te=G.lfocusy-D.focusy;switch(Math.round(D.facing/(Math.PI*.5))){default:case 0:G.vsway=Te*7,G.vlean=ge*.02;break;case 1:G.vsway=-ge*7,G.vlean=Te*.02;break;case 2:G.vsway=-Te*7,G.vlean=-ge*.02;break;case 3:G.vsway=ge*7,G.vlean=-Te*.02;break}G.lfocusx=D.focusx,G.lfocusy=D.focusy}if(G.lfacing!==D.facing){let Q=D.facing-G.lfacing;Q<-Math.PI?Q+=Math.PI*2:Q>Math.PI&&(Q+=Math.PI*-2);const ie=.02;G.vlean=Q*ie,G.lfacing=D.facing}xv(l.current.position,[K,-te,512+s*.55],O,M),g4(u.current.rotation,[0,0,Math.PI-D.facing],O,M),g4(f.current.rotation,[Math.PI*-.49,0,G.lean],O,M);const re=1.2,H=Math.sin(G.sway)*re,Y=Math.abs(Math.sin(G.sway)*re);if(xv(f.current.position,[H,0,Y],O,M),G.sway+=G.vsway*M,tl(f.current.userData,"vsway",0,z),tl(f.current.userData,"lean",G.vlean,z),tl(f.current.userData,"vlean",0,z),q!==G.currentboard){G.sway=0,G.vsway=0,G.lean=0,G.vlean=0,G.focusx=D.focusx,G.focusy=D.focusy,G.lfocusx=G.focusx,G.lfocusy=G.focusy,G.currentboard=q;const Q=(G.focusx+.5)*i,ie=(G.focusy+.5)*s;l.current.position.set(Q,-ie,512+s*.5);const ge=Math.sin(G.sway)*re,Te=Math.abs(Math.sin(G.sway)*re);f.current.position.set(ge,0,Te),f.current.rotation.set(Math.PI*-.49,0,G.lean)}else tl(f.current.userData,"focusx",D.focusx,O),tl(f.current.userData,"focusy",D.focusy,O);tl(f.current,"fov",c$e(D.viewscale),O,M),f.current.updateProjectionMatrix();const Z=Ci(o/c,1,10);h.current.position.x=o-c*Z,h.current.position.y=0,h.current.scale.setScalar(Z)}),Kr(F=>F.gadget.over?.length??0),Kr(F=>F.gadget.under?.length??0),Kr(F=>F.gadget.layers?.length??0);const{gadget:p,layercache:m}=Kr.getState(),{over:g=[],under:_=[],layers:y=[]}=p,v=m[p.exiteast]??[],E=m[p.exitwest]??[],x=m[p.exitnorth]??[],A=m[p.exitsouth]??[],T=g.length>0,k=_.length*2+2,L=n.width*-.5+r.marginx,I=n.height*.5-r.marginy;return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx("group",{ref:l,children:Ee.jsx("group",{ref:u,children:Ee.jsx("perspectiveCamera",{ref:f,near:.1,far:3e3,aspect:-o/a,position:[0,s*-.5,0]})})}),Ee.jsx("group",{ref:h,children:_.map((F,M)=>Ee.jsx(T1,{from:"under",id:F.id,z:M*2},F.id))}),Ee.jsx("group",{"position-z":k,children:f.current&&Ee.jsx(WI,{camera:f.current,viewwidth:o,viewheight:a,effects:Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(wU,{worldFocusDistance:200,worldFocusRange:500,bokehScale:3}),Ee.jsx(QHe,{})]}),children:Ee.jsxs("group",{position:[L,I,0],children:[y.map(F=>Ee.jsx(NS,{id:F.id,from:"layers",z:PS(F),multi:T},F.id)),g.map(F=>Ee.jsx(NS,{from:"over",id:F.id,z:PS(F)+s+1,multi:T},F.id)),Ee.jsx("group",{position:[bn*i,0,0],children:v.length?Ee.jsx(Ee.Fragment,{children:v.map(F=>Ee.jsx(NS,{id:F.id,layers:v,z:PS(F),multi:T},F.id))}):Ee.jsx("group",{"scale-z":2,children:Ee.jsx(km,{width:bn,char:sE,color:oE,bg:aE})})}),Ee.jsx("group",{position:[bn*-i,0,0],children:E.length?Ee.jsx(Ee.Fragment,{children:E.map(F=>Ee.jsx(NS,{id:F.id,layers:E,z:PS(F),multi:T},F.id))}):Ee.jsx("group",{"scale-z":2,children:Ee.jsx(km,{width:bn,char:sE,color:oE,bg:aE})})}),Ee.jsx("group",{position:[0,Tr*-s,0],children:x.length?Ee.jsx(Ee.Fragment,{children:x.map(F=>Ee.jsx(NS,{id:F.id,layers:x,z:PS(F),multi:T},F.id))}):Ee.jsx("group",{"scale-z":2,children:Ee.jsx(km,{width:bn,char:sE,color:oE,bg:aE})})}),Ee.jsx("group",{position:[0,Tr*s,0],children:A.length?Ee.jsx(Ee.Fragment,{children:A.map(F=>Ee.jsx(NS,{id:F.id,layers:A,z:PS(F),multi:T},F.id))}):Ee.jsx("group",{"scale-z":2,children:Ee.jsx(km,{width:bn,char:sE,color:oE,bg:aE})})})]})})})]})}function DS({id:t,z:e,from:n,layers:r}){const i=Kr(xh(a=>{if(fe(n))return a.gadget[n]?.find(c=>c.id===t);if(fe(r))return r.find(c=>c.id===t)})),s=kn.DRAW_CHAR_WIDTH(),o=kn.DRAW_CHAR_HEIGHT();switch(i?.type){default:case Ji.BLANK:case Ji.MEDIA:return null;case Ji.TILES:{const a=IU(i.char,i.color,i.bg,i.stats),c=NU(i.char,i.color,i.bg,i.stats),l=PU(i.char,i.color,i.bg,i.stats),u=Kre(i.char,i.color,i.bg,i.stats);return Ee.jsx(Ee.Fragment,{children:Ee.jsxs("group",{position:[0,0,e],children:[Ee.jsx(ip,{width:i.width,height:i.height,char:a.char,color:a.color,bg:a.bg}),Ee.jsx("group",{"position-z":o*-.5,children:Ee.jsx(ip,{width:i.width,height:i.height,char:l.char,color:l.color,bg:l.bg})}),n!=="over"&&Ee.jsx("group",{"position-z":o*-1,children:Ee.jsx(km,{width:bn,char:u.char,color:u.color,bg:u.bg})}),Ee.jsx(km,{width:bn,char:c.char.map(h=>h!==0?219:0),color:c.color,bg:c.bg}),Ee.jsx("group",{"position-z":o+1,children:Ee.jsx(ip,{width:i.width,height:i.height,char:c.char,color:c.color,bg:c.bg})})]},i.id)})}case Ji.SPRITES:{const a=fe(r),c=i.sprites.filter(h=>h.stat!==Fn.ISSWIM&&(!a||!h.pid)),l=i.sprites.filter(h=>h.stat===Fn.ISSWIM&&(!a||!h.pid)),u=c.filter(h=>h.stat!==Fn.ISGHOST);return Ee.jsxs("group",{position:[0,0,e],children:[Ee.jsx(LU,{sprites:u,limit:zm,children:(h,f)=>[h*s,(f+.25)*o,o*-.75+.5]}),Ee.jsx(MA,{sprites:c,scale:1.25}),Ee.jsx("group",{"position-z":o*-1,children:Ee.jsx(MA,{sprites:l,scale:1.25})})]},i.id)}case Ji.DITHER:return Ee.jsx("group",{position:[0,0,e],children:Ee.jsx(DU,{alphas:i.alphas,width:bn})},i.id)}}function LS(t){switch(t.type){case Ji.TILES:return 0;case Ji.DITHER:return kn.DRAW_CHAR_HEIGHT();case Ji.SPRITES:return kn.DRAW_CHAR_HEIGHT()*.75}return 0}function u$e(t){switch(t){case fc.NEAR:return 3;default:case fc.MID:return 1.75;case fc.FAR:return 1}}function h$e({width:t,height:e}){const{viewport:n}=Dc(),r=Zm(),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),o=t*i,a=e*s,c=bn*i,l=Tr*s,u=Ye.useRef(null),h=Ye.useRef(null),f=Ye.useRef(null),d=Ye.useRef(null),p=Ye.useRef(null),[,m]=Ye.useState(!1);Ye.useLayoutEffect(()=>{m(!0)},[]),Dg((M,D)=>{if(!u.current||!h.current||!f.current||!d.current||!p.current)return;const O=q1(Kr.getState().gadget.layers??[]),z=.05,q=Kr.getState().gadget.board;fe(d.current.userData.focusx)||(d.current.userData={focusx:O.focusx,focusy:O.focusy,facing:O.facing,currentboard:q},u.current.scale.setScalar(O.viewscale));const G=d.current.userData??{},K=(G.focusx+.5)*i,te=(G.focusy+.5)*s;switch(xv(u.current.scale,u$e(O.viewscale),z,D),xv(f.current.position,[-K,-te,0],z,D),q!==G.currentboard?(G.focusx=O.focusx,G.focusy=O.focusy,G.currentboard=q,f.current.position.set(-((G.focusx+.5)*i),-((G.focusy+.5)*s),0)):(tl(d.current.userData,"focusx",O.focusx,z),tl(d.current.userData,"focusy",O.focusy,z)),O.viewscale){case fc.NEAR:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1e3,p.current.cocMaterial.worldFocusDistance=1e3;break;default:case fc.MID:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1e3,p.current.cocMaterial.worldFocusDistance=1e3;break;case fc.FAR:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1500,p.current.cocMaterial.worldFocusDistance=1e3;break}d.current.updateProjectionMatrix();const re=Ci(o/c,1,10),H=Ci(a/l,1,10),Y=Math.max(re,H),Z=c*Y,Q=l*Y;h.current.position.x=o-Z,h.current.position.y=a-Q,h.current.scale.setScalar(Y)}),Kr(M=>M.gadget.over?.length??0),Kr(M=>M.gadget.under?.length??0),Kr(M=>M.gadget.layers?.length??0);const{gadget:g,layercache:_}=Kr.getState(),{over:y=[],under:v=[],layers:E=[]}=g,x=_[g.exiteast]??[],A=_[g.exitwest]??[],T=_[g.exitnorth]??[],k=_[g.exitsouth]??[],L=v.length*2+2,I=n.width*-.5+r.marginx,F=n.height*.5-r.marginy;return Ee.jsxs(Ee.Fragment,{children:[Ee.jsxs("group",{"position-z":L,children:[Ee.jsx("orthographicCamera",{ref:d,left:o*-.5,right:o*.5,top:a*-.5,bottom:a*.5,near:.1,far:2e3,position:[0,0,1e3]}),d.current&&Ee.jsx(WI,{camera:d.current,viewwidth:o,viewheight:a,effects:Ee.jsx(Ee.Fragment,{children:Ee.jsx(wU,{ref:p})}),children:Ee.jsx("group",{position:[I,F,-500],children:Ee.jsx("group",{rotation:[Math.PI*.25,0,Math.PI*-.25],children:Ee.jsx("group",{ref:u,children:Ee.jsxs("group",{ref:f,children:[E.map(M=>Ee.jsx(DS,{id:M.id,from:"layers",z:LS(M)},M.id)),y.map(M=>Ee.jsx(DS,{from:"over",id:M.id,z:LS(M)+s+1},M.id)),x.length&&Ee.jsx("group",{position:[bn*i,0,0],children:x.map(M=>Ee.jsx(DS,{id:M.id,layers:x,z:LS(M)},M.id))}),A.length&&Ee.jsx("group",{position:[bn*-i,0,0],children:A.map(M=>Ee.jsx(DS,{id:M.id,layers:A,z:LS(M)},M.id))}),T.length&&Ee.jsx("group",{position:[0,Tr*-s,0],children:T.map(M=>Ee.jsx(DS,{id:M.id,layers:T,z:LS(M)},M.id))}),k.length&&Ee.jsx("group",{position:[0,Tr*s,0],children:k.map(M=>Ee.jsx(DS,{id:M.id,layers:k,z:LS(M)},M.id))})]})})})})})]}),Ee.jsx("group",{ref:h,children:v.map((M,D)=>Ee.jsx(T1,{from:"under",id:M.id,z:D*2},M.id))})]})}const f$e=Y1(J1),d$e=K1(X1);function p$e(){const t=Kr(e=>e.gadget.id);return Ye.useEffect(()=>{const e=Kr.getState().gadget.layers??[];let n=f$e,r=d$e,i;const s=va.getState();for(let o=0;e&&o<e.length;++o){const a=e[o];if(a.type===Ji.MEDIA)switch(a.mime){case"image/palette":Kn(a.media)&&(n=$3(eA,sme,a.media));break;case"image/charset":Kn(a.media)&&(r=$3(yo*Yo,YF*Ia,a.media));break;case"image/altcharset":Kn(a.media)&&(i=$3(yo*Yo,YF*Ia,a.media));break;case"text/mood":dn(a.media)&&s.setmood(a.media);break;case"text/players":dn(a.media);break}s.setpalette(n),s.setcharset(r),s.setaltcharset(i)}},[t]),null}function pT({id:t,z:e,from:n,layers:r}){const i=Kr(xh(a=>{if(fe(n))return a.gadget[n]?.find(c=>c.id===t);if(fe(r))return r.find(c=>c.id===t)})),s=kn.DRAW_CHAR_WIDTH(),o=kn.DRAW_CHAR_HEIGHT();switch(i?.type){default:case Ji.BLANK:case Ji.MEDIA:return null;case Ji.TILES:{const a=IU(i.char,i.color,i.bg,i.stats),c=NU(i.char,i.color,i.bg,i.stats),l=PU(i.char,i.color,i.bg,i.stats);return Ee.jsxs("group",{position:[0,0,e],children:[Ee.jsx(ip,{width:i.width,height:i.height,char:a.char,color:a.color,bg:a.bg}),Ee.jsx("group",{"position-z":o*-.25,children:Ee.jsx(ip,{width:i.width,height:i.height,char:l.char,color:l.color,bg:l.bg})}),Ee.jsx("group",{"position-z":o*.25,children:Ee.jsx(ip,{width:i.width,height:i.height,char:c.char,color:c.color,bg:c.bg})})]},i.id)}case Ji.SPRITES:{const a=fe(r),c=i.sprites.filter(h=>h.stat!==Fn.ISSWIM&&(!a||!h.pid)),l=i.sprites.filter(h=>h.stat===Fn.ISSWIM&&(!a||!h.pid)),u=c.filter(h=>h.stat!==Fn.ISGHOST);return Ee.jsxs("group",{position:[0,0,e],children:[Ee.jsx(LU,{sprites:u,limit:zm,children:(h,f)=>[h*s,(f+.5)*o,o*-.5+.5]}),Ee.jsx(MA,{sprites:c,withbillboards:!0}),Ee.jsx("group",{"position-z":o*-.5,children:Ee.jsx(MA,{sprites:l,withbillboards:!0})})]},i.id)}case Ji.DITHER:return Ee.jsx("group",{position:[0,0,e+1],children:Ee.jsx(DU,{alphas:i.alphas,width:bn})})}}function US(t){switch(t.type){case Ji.TILES:return 0;case Ji.DITHER:return kn.DRAW_CHAR_HEIGHT()+1;case Ji.SPRITES:return kn.DRAW_CHAR_HEIGHT()*.5}return 0}function m$e(t){switch(t){case fc.NEAR:return-128;default:case fc.MID:return 128;case fc.FAR:return 512}}function g$e(t){switch(t){case fc.NEAR:return .888;default:case fc.MID:return .777;case fc.FAR:return .444}}function _$e({width:t,height:e}){const{viewport:n}=Dc(),r=Zm(),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),o=t*i,a=e*s,c=bn*i,l=Tr*s,u=Ye.useRef(null),h=Ye.useRef(null),f=Ye.useRef(null),d=Ye.useRef(null),p=Ye.useRef(null),[,m]=Ye.useState(!1);Ye.useLayoutEffect(()=>{m(!0)},[]),Dg((M,D)=>{if(!u.current||!h.current||!f.current||!d.current||!p.current)return;const O=q1(Kr.getState().gadget.layers??[]),z=.05,q=Kr.getState().gadget.board;fe(d.current.userData.focusx)||(d.current.userData={focusx:O.focusx,focusy:O.focusy,currentboard:q});const G=d.current.userData??{},K=(G.focusx+.5)*i,te=(G.focusy+.5)*s;switch(xv(d.current.position,[0,0,m$e(O.viewscale)],z,D),g4(u.current.rotation,[g$e(O.viewscale),0,0],z,D),xv(f.current.position,[-K,-te,0],z,D),q!==G.currentboard?(G.focusx=O.focusx,G.focusy=O.focusy,G.currentboard=q,f.current.position.set(-((G.focusx+.5)*i),-((G.focusy+.5)*s),0)):(tl(d.current.userData,"focusx",O.focusx,z),tl(d.current.userData,"focusy",O.focusy,z)),O.viewscale){case fc.NEAR:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1200,p.current.cocMaterial.worldFocusDistance=350;break;default:case fc.MID:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1700,p.current.cocMaterial.worldFocusDistance=800;break;case fc.FAR:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1700,p.current.cocMaterial.worldFocusDistance=1100;break}d.current.rotation.z=Math.PI,d.current.updateProjectionMatrix();const re=Ci(o/c,1,10),H=Ci(a/l,1,10),Y=Math.max(re,H),Z=c*Y,Q=l*Y;h.current.position.x=o-Z,h.current.position.y=a-Q,h.current.scale.setScalar(Y)}),Kr(M=>M.gadget.over?.length??0),Kr(M=>M.gadget.under?.length??0),Kr(M=>M.gadget.layers?.length??0);const{gadget:g,layercache:_}=Kr.getState(),{over:y=[],under:v=[],layers:E=[]}=g,x=_[g.exiteast]??[],A=_[g.exitwest]??[],T=_[g.exitnorth]??[],k=_[g.exitsouth]??[],L=v.length*2+2,I=n.width*-.5+r.marginx,F=n.height*.5-r.marginy;return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx("perspectiveCamera",{ref:d,near:.1,far:2e3,aspect:-o/a}),Ee.jsx("group",{"position-z":L,children:d.current&&Ee.jsx(WI,{camera:d.current,viewwidth:o,viewheight:a,effects:Ee.jsx(Ee.Fragment,{children:Ee.jsx(wU,{ref:p})}),children:Ee.jsx("group",{position:[I,F,-1e3],children:Ee.jsx("group",{ref:u,children:Ee.jsxs("group",{ref:f,children:[E.map(M=>Ee.jsx(pT,{id:M.id,from:"layers",z:US(M)},M.id)),y.map(M=>Ee.jsx(T1,{from:"over",id:M.id,z:US(M)+s*1.125},M.id)),x.length&&Ee.jsx("group",{position:[bn*i,0,0],children:x.map(M=>Ee.jsx(pT,{id:M.id,layers:x,z:US(M)},M.id))}),A.length&&Ee.jsx("group",{position:[bn*-i,0,0],children:A.map(M=>Ee.jsx(pT,{id:M.id,layers:A,z:US(M)},M.id))}),T.length&&Ee.jsx("group",{position:[0,Tr*-s,0],children:T.map(M=>Ee.jsx(pT,{id:M.id,layers:T,z:US(M)},M.id))}),k.length&&Ee.jsx("group",{position:[0,Tr*s,0],children:k.map(M=>Ee.jsx(pT,{id:M.id,layers:k,z:US(M)},M.id))})]})})})})}),Ee.jsx("group",{ref:h,children:v.map((M,D)=>Ee.jsx(T1,{from:"under",id:M.id,z:D*2},M.id))})]})}function v$e({width:t,height:e}){const n=ab(t,e,0,Ft.WHITE,Ft.ONCLEAR),r=Kr(s=>s.gadget.tickers),i=Ye.useMemo(()=>({...Hg(t,e,Ft.WHITE,Ft.BLACK),...n.getState()}),[t,e,n]);if(fe(r)){i.x=0,i.y=e-1,i.disablewrap=!0;const s=n.getState();LI(s,0,Ft.WHITE,Ft.ONCLEAR);for(let o=0;o<r.length;++o){const a=r[o];ei(a,i,!1),i.x=0,i.y--}}return Ee.jsx(lb,{store:n,children:Ee.jsx(ub,{width:t,height:e})})}function Gy(t,e,n){let r=0;n.alt&&(r|=l5),n.ctrl&&(r|=u5),n.shift&&(r|=h5),Nl(t)&&NK(qe,t,e,r)}function y$e({width:t,height:e}){const n=ii();Kr(xh(o=>[o.gadget.id,o.gadget.board,o.gadget.layers?.length??0]));const r=Kr(o=>q1(o.gadget.layers??[]).graphics),{board:i,synthstate:s}=Kr.getState().gadget;return Ye.useEffect(()=>{fe(s)&&XEe(qe,n,i,s)},[n,i,s]),Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(xo,{MOVE_LEFT:o=>Gy(n,Ct.MOVE_LEFT,o),MOVE_RIGHT:o=>Gy(n,Ct.MOVE_RIGHT,o),MOVE_UP:o=>Gy(n,Ct.MOVE_UP,o),MOVE_DOWN:o=>Gy(n,Ct.MOVE_DOWN,o),OK_BUTTON:o=>Gy(n,Ct.OK_BUTTON,o),CANCEL_BUTTON:o=>Gy(n,Ct.CANCEL_BUTTON,o),MENU_BUTTON:o=>Gy(n,Ct.MENU_BUTTON,o),keydown:o=>{const a=rr(o.key),c=TC(o),l=ii();switch(a){case"c":W5(qe,l,"");break;case"@":case"2":N1(qe,l,"@");break;case"#":case"3":N1(qe,l,"#");break;case"p":c.ctrl&&K5(qe,l);break;case"a":c.ctrl&&gxe(qe,l);break}}}),Ee.jsx(p$e,{}),r==="flat"&&Ee.jsx(XHe,{width:t,height:e}),r==="mode7"&&Ee.jsx(_$e,{width:t,height:e}),r==="iso"&&Ee.jsx(h$e,{width:t,height:e}),r==="fpv"&&Ee.jsx(l$e,{width:t,height:e}),Ee.jsx("group",{"position-z":512,children:Ee.jsx(v$e,{width:Math.floor(t),height:Math.floor(e)})})]})}function nW({rect:t,shouldclose:e=!1}){switch(t.type){case 0:return Ee.jsx("group",{"position-z":512,children:Ee.jsx(Gre,{width:t.width,height:t.height,color:14,bg:1,text:t.text,ymargin:0})});case 1:return Ee.jsx(FHe,{width:t.width,height:t.height,color:14,bg:1,text:t.text,shouldclose:e});case 2:return Ee.jsx(y$e,{width:t.width,height:t.height})}return null}const BS=20;function b$e(){const t=Zm(),{islandscape:e,sidebaropen:n,showtouchcontrols:r}=Jf(),i=Kr(w$(d=>d.gadget.scroll??[])),s=i.length===0,[o,a]=Ye.useState(!1),c=Kr(w$(d=>d.gadget.sidebar??[]));if(t.cols<10||t.rows<10)return null;const l={name:"main",type:2,x:0,y:0,text:[],width:t.cols,height:t.rows},u=[];if(c.length)if(r)if(e){const d=n?BS+5:BS,p=n?BS:4,m={name:"sidebar",type:0,x:l.x+l.width-p,y:l.y,width:d,height:l.height,text:c};l.width-=p,u.push(m)}else{const p=n?15:4,m={name:"sidebar",type:0,x:0,y:l.y+l.height-p,width:l.width,height:15,text:c};l.height-=p,u.push(m)}else{const d={name:"sidebar",type:0,x:l.x+l.width-BS,y:l.y,width:BS,height:l.height,text:c};l.width-=BS,u.push(d)}const h={name:"scroll",type:1,x:0,y:0,width:Ci(50,40,l.width-2),height:Ci(20,8,l.height-2),text:i};h.x=l.x+Math.floor((l.width-h.width)*.5),h.y=l.y+Math.floor((l.height-h.height)*.5),!s&&!o&&a(!0),u.unshift(l);const f=ii();return Ee.jsxs(Wg.Provider,{value:{sendmessage(d,p){qe.emit(f,d,p)},sendclose(){OEe(qe,f)},didclose(){a(!1)}},children:[Ee.jsx("group",{position:[-kn.DRAW_CHAR_WIDTH(),-kn.DRAW_CHAR_HEIGHT(),-524],children:Ee.jsx(Nm,{visible:!0,color:new wi(.076,.076,0),width:t.cols+2,height:t.rows+2})}),Ee.jsx("group",{position:[0,0,-512],children:u.map(d=>Ee.jsx("group",{position:[d.x*kn.DRAW_CHAR_WIDTH(),d.y*kn.DRAW_CHAR_HEIGHT(),0],children:Ee.jsx(nW,{rect:d})},d.name))}),o&&Ee.jsxs(ch.Fragment,{children:[Ee.jsx("group",{position:[0,0,800],children:Ee.jsx(XVe,{width:t.cols,height:t.rows,alpha:.14})}),Ee.jsx("group",{position:[h.x*kn.DRAW_CHAR_WIDTH(),h.y*kn.DRAW_CHAR_HEIGHT(),900],children:Ee.jsx(nW,{rect:h,shouldclose:s})})]},"scroll")]})}const S$e=250,E$e=249,oO=Ft.BLUE,x$e=Ft.WHITE,w$e=Ft.DKGRAY,UU=Ft.BLACK;function Sx(t){return t?Ft.ONCLEAR:Ft.DKBLUE}function T$e(t){return Math.round(t*.5)}const Xre=Ye.createContext({sendmessage(){}});function Tg(t,e,n,r){const i=yp(r);r.iseven=r.y%2===0,r.active.bg=t?UU:r.reset.bg,r.active.leftedge=i.left,r.active.rightedge=i.right,r.active.topedge=i.top,r.active.bottomedge=i.bottom,r.x=r.active.leftedge+e,r.y=r.active.topedge+n}function t1(t,e,n,r,i,s,o,a){const c=yp(i);i.iseven=i.y%2===0,i.active.color=Ft.WHITE,i.active.bg=i.reset.bg,i.active.leftedge=c.left+s,i.active.rightedge=c.right-s,i.active.topedge=c.top+o,i.active.bottomedge=c.bottom-a,i.x=i.active.leftedge+n,i.y=i.active.topedge+r}function A$e(t){let e=0;return t.split(/\r?\n/).map(r=>{const i=e,s=`${r}
`;return e+=s.length,{start:i,code:s,end:i+r.length}})}function C$e(t){return t.reduce((e,n)=>{const r=n.code.length;return r>e?r:e},0)}function MT(t,e){for(let n=0;n<e.length;++n)if(t<=e[n].end)return n;return e.length-1}function BU({bump:t}){const e=Bl(),n=yp(e),{quickterminal:r}=ls(),i=Sx(r);if(t&&n.top++,r){for(let s=n.top;s<=n.bottom;++s)for(let o=n.left;o<=n.right;++o)$o(e,e.width,e.height,o,s,{char:0,color:oO,bg:i});return null}for(let s=n.top;s<=n.bottom;++s)for(let o=n.left;o<=n.right;++o){let a=0;(o+s)%2===0&&(a=Math.abs(Math.round(Math.cos(o*s*.01)))?S$e:E$e),$o(e,e.width,e.height,o,s,{char:a,color:oO,bg:i})}return null}const Q2=Ft.WHITE,$T=Ft.GREEN,Ra=Ft.YELLOW,R$e=Ft.CYAN,Kh=Ft.DKGREEN,rW=Ft.DKCYAN,k$e=Ft.GREEN,Dk=Ft.DKPURPLE,Jre=Ft.WHITE,M$e=Ft.LTGRAY,O$e=Ft.DKGRAY,iW=Ft.DKRED,I$e=Ft.DKRED,eD=Ft.DKYELLOW,N$e={[oA.tokenTypeIdx??0]:Q2,[HK.tokenTypeIdx??0]:Q2,[$K.tokenTypeIdx??0]:Q2,[P1.tokenTypeIdx??0]:Dk,[mg.tokenTypeIdx??0]:Ra,[aA.tokenTypeIdx??0]:$T,[cA.tokenTypeIdx??0]:R$e,[OE.tokenTypeIdx??0]:I$e,[lA.tokenTypeIdx??0]:Ra,[Q5.tokenTypeIdx??0]:Ra,[_a.tokenTypeIdx??0]:$T,[FT.tokenTypeIdx??0]:$T,[ZS.tokenTypeIdx??0]:Jre,[e6.tokenTypeIdx??0]:Ra,[t6.tokenTypeIdx??0]:Ra,[n6.tokenTypeIdx??0]:Ra,[r6.tokenTypeIdx??0]:Ra,[i6.tokenTypeIdx??0]:Ra,[s6.tokenTypeIdx??0]:Ra,[yM.tokenTypeIdx??0]:eD,[bM.tokenTypeIdx??0]:eD,[SM.tokenTypeIdx??0]:eD,[EM.tokenTypeIdx??0]:Ra,[xM.tokenTypeIdx??0]:Ra,[o6.tokenTypeIdx??0]:Ra,[a6.tokenTypeIdx??0]:Ra,[_1.tokenTypeIdx??0]:Ra,[c6.tokenTypeIdx??0]:Ra,[l6.tokenTypeIdx??0]:Ra,[uA.tokenTypeIdx??0]:Ra,[u6.tokenTypeIdx??0]:Ra,[h6.tokenTypeIdx??0]:Ra,[f6.tokenTypeIdx??0]:k$e,[v1.tokenTypeIdx??0]:Kh,[y1.tokenTypeIdx??0]:rW,[wM.tokenTypeIdx??0]:rW,[b1.tokenTypeIdx??0]:Kh,[d6.tokenTypeIdx??0]:Kh,[p6.tokenTypeIdx??0]:Kh,[m6.tokenTypeIdx??0]:Kh,[g6.tokenTypeIdx??0]:Kh,[_6.tokenTypeIdx??0]:Kh,[v6.tokenTypeIdx??0]:Kh};Ft.DKPURPLE;const P$e=Ft.DKYELLOW,D$e=Ft.DKPURPLE,L$e=Ft.CYAN,U$e=Ft.DKCYAN,B$e=Ft.RED,F$e=Ft.WHITE,j$e=Ft.LTGRAY,z$e=Ft.YELLOW,Zre=new Map;function Yd(t,e){Zre.set(t,e)}function sW(t){const e=[];let n=0;for(let r=0;r<t.length;++r){switch(t[r]){case";":n=0;break;case" ":break;default:n===0&&(n=1);break;case"#":n===0&&(n=2);break}switch(n){case 0:e.push(Ft.LTGRAY);break;case 1:e.push($$e(t[r]));break;case 2:e.push(Ft.CYAN);break}}return e.push(Ft.BLUE),e}function V$e(t){if(t.startsWith("play ")){const e=new Array(5).fill(Kh);return e.push(...sW(t.slice(5))),e}else if(t.startsWith("bgplay ")){const e=new Array(7).fill(Kh);return e.push(...sW(t.slice(7))),e}return Zre.get(t)??Ft.GREEN}const hb=Ft.GREEN,H$e=Ft.DKGREEN,Qm=Ft.PURPLE,fb=Ft.DKCYAN,Qre=Ft.CYAN,eie=Ft.YELLOW,tie=Ft.DKYELLOW,nie=new Map;function ts(t,e){nie.set(t,e)}function $$e(t){return nie.get(t)??Ft.GREEN}function G$e(){const t=Bl(),e=yp(t),[n,r,i]=ls(xh(_=>[_.quickterminal,_.editor.type,_.editor.title])),s=Ft.WHITE,o=Sx(n);for(let _=e.top;_<e.bottom;++_)$o(t,t.width,t.height,e.left,_,{char:179,color:s,bg:o}),$o(t,t.width,t.height,e.right,_,{char:179,color:s,bg:o});t1(!1,!1,0,0,t,0,0,0),ei("$213$205$187",t,!0),t1(!1,!1,t.width-3,0,t,0,0,0),ei("$196$196$191",t,!0);const a="$205".repeat(e.width-2);t1(!1,!1,0,e.height-1,t,0,0,0),ei(`$212${a}$190`,t,!0);const c=ff(),l="$205".repeat(e.width-4);t1(!1,!1,0,1,t,0,0,0),ei(`$179$${c?"7":"232"}$200${l}$181`,t,!0);const h=` ${`$blue[${r}] `}$green${i}$white `,d=$g(h,e.width,e.height)?.measuredwidth??1,p=e.width-2,m=2+Math.round(p*.5)-Math.round(d*.5);t1(!1,!1,m,1,t,0,0,0),ei(h,t,!0);const g=z1?`shift+${wA}+z`:`${wA}+y`;return Ee.jsx(MU,{margin:3,color:Ft.BLUE,y:e.top,leftedge:0,rightedge:e.width-1,line:`
keys: $whiteesc/cancel$green.CLOSE 
$whitetab$green.CHANGE LAYOUT 
$whitehold shift$green.SELECT TEXT 
$whitealt+up/down$green.JUMP 10 LINES 
$whitealt+left/right$green.JUMP 10 COLS 
$white$meta+up/down$green.JUMP TOP/BOTTOM 
$white$meta+left/right$green.JUMP TO START/END OF LINE 
$white$meta+a$green.SELECT ALL 
$white$meta+c$green.COPY 
$white$meta+x$green.CUT 
$white$meta+v$green.PASTE 
$white$meta+z$green.UNDO 
$white${g}$green.REDO 
$white$meta+p$green.RUN SELECTED CODE 
$white$meta+h$green.OPEN HELPSCROLL $blue
    `,context:t})}const oW=32;function W$e({xcursor:t,ycursor:e,xoffset:n,yoffset:r,rows:i,codepage:s}){const o=ff(),a=Bl(),c=Zc(),l=ii(),u=Ye.useRef(void 0),h=yp(a),f=fe(s)?`${s.nodeId.sid}:${s.nodeId.time}`:void 0,d=m3e(f),p=Ye.useRef(void 0),m=fe(s)?s.toJSON():"",g=i.length-1,_=Ye.useCallback(ge=>{let Te=0;for(let Pe=0;Pe<ge.length;Pe++)Te=ge.charCodeAt(Pe)+((Te<<5)-Te);return`hsl(${Math.abs(Te%360)}, 70%, 50%)`},[]);Ye.useEffect(()=>{if(!f||!fe(s)){p.current&&(clearTimeout(p.current),p.current=void 0);return}return p.current&&clearTimeout(p.current),p.current=window.setTimeout(()=>{d3e(l,f,c.cursor,c.select,`User ${l.slice(0,6)}`,_(l))},100),()=>{p.current&&(clearTimeout(p.current),p.current=void 0)}},[f,c.cursor,c.select,l,s,_]);const y=t+1-n,v=e+2-r;if(fe(s)){const ge=u.current?.x!==y||u.current?.y!==v;if(o||ge){const Te=h.left+y,be=h.top+v;if(be>h.top+1&&be<h.bottom&&Te>h.left&&Te<h.right){const Pe=Te+be*a.width;TA(Pe,"",a),fv(Pe,Pe,Ft.WHITE,Ft.DKBLUE,a)}}}if(u.current={x:y,y:v},fe(s)&&d.length>0)for(const ge of d){if(ge.clientId===l)continue;const Te=ge.cursor,be=MT(Te,i),Pe=i[be];if(!Pe)continue;const Ze=Te-Pe.start+1-n,lt=be+2-r,pt=h.left+Ze,ne=h.top+lt;if(ne>h.top+1&&ne<h.bottom&&pt>h.left&&pt<h.right){const Le=pt+ne*a.width;if(TA(Le,"",a),fv(Le,Le,Ft.WHITE,Ft.CYAN,a),fe(ge.select)&&ge.select!==ge.cursor){const Ve=Math.min(ge.cursor,ge.select),De=Math.max(ge.cursor,ge.select),Ie=MT(Ve,i),ae=MT(De,i);for(let ve=Ie;ve<=ae;ve++){const we=i[ve];if(!we)continue;const pe=ve===Ie?Ve-we.start:0,ze=ve===ae?De-we.start:we.code.length;for(let Je=pe;Je<ze;Je++){const Xe=Je+1-n,tt=ve+2-r,Nt=h.left+Xe,gt=h.top+tt;if(gt>h.top+1&&gt<h.bottom&&Nt>h.left&&Nt<h.right){const wt=Nt+gt*a.width;fv(wt,wt,Ft.BLACK,Ft.DKGRAY,a)}}}}}}const E=i[g].end,x=i[e];let A=c.cursor,T=c.cursor,k=!1;fe(c.select)&&(k=!0,A=Math.min(c.cursor,c.select),T=Math.max(c.cursor,c.select),c.cursor!==c.select&&--T);const L=T-A+1,I=k?m.substring(A,T+1):"";function F(ge){ge?fe(c.select)||Zc.setState({select:c.cursor}):Zc.setState({select:void 0})}const M=Ye.useCallback(function(ge){Zc.setState(Te=>{const be=MT(ge,i),Pe=ge-i[be].start,Ge=h.width-8,Ze=h.height-4,lt=Math.round(Ge*.5),pt=Math.round(Ze*.5),ne=Math.round(Ge*.25),Ve=Math.abs(Pe-(Te.xscroll+lt))<ne?Te.xscroll:Pe-lt,De=be-pt,Ie=C$e(i),ae=(Math.round(Ie/oW)+1)*oW,ve=i.length-Ze;return{xscroll:Math.round(Ci(Ve,0,ae)),yscroll:Math.round(Ci(De,0,ve))}})},[i,h.width,h.height]),D=Ye.useCallback(function(ge,Te,be){Q.current=c.cursor,Te>0&&s?.delete(ge,Te),fe(be)&&s?.insert(ge,be);const Pe=ge+(be??"").length;M(Pe),Zc.setState({cursor:Pe,select:void 0})},[s,M,c.cursor]),O=Ye.useCallback(function(ge,Te,be){Q.current=c.cursor,Te>0&&s?.delete(ge,Te),fe(be)&&s?.insert(ge,be);const Pe=ge+(be??"").length;M(Pe),Zc.setState({cursor:Pe})},[s,M,c.cursor]);function z(){if(k){const ge=I.split(`
`);for(let Te=0;Te<ge.length;++Te){const be=ge[Te],Pe=be.trim();Pe.startsWith("'")?ge[Te]=be.replace(/' ?/,""):Pe&&(ge[Te]=`' ${be}`)}D(A,L,ge.join(`
`))}}function q(ge=!0){if(k){const Te=I.split(`
`);for(let be=0;be<Te.length;++be){const Pe=Te[be];ge?Te[be].startsWith(" ")&&(Te[be]=Pe.substring(1)):Te[be]=` ${Pe}`}O(A,L,Te.join(`
`))}}function G(){k&&(M(A),Zc.setState({cursor:A}),D(A,L))}function K(){M(E),Zc.setState({cursor:E,select:void 0})}const te=Ye.useCallback(function(ge){Zc.setState(()=>{const Te=Ci(ge,0,E);return M(Te),{cursor:Te}})},[E,M]),re=Ye.useCallback(function(ge){Zc.setState(()=>{let Te=0;const be=Math.round(e+ge);if(be<0)Te=0;else if(be>g)Te=E;else{const Pe=i[be];Te=Pe.start+Math.min(t,Pe.code.length-1)}return M(Te),{cursor:Te}})},[E,i,g,t,e,M]),H=5,Y=Ye.useRef([]),Z=Ye.useRef([]),Q=Ye.useRef(0),ie=fe(s)?{undo(ge=H){const Te=Math.min(ge,Y.current.length);if(Te<=0)return;const be=[];for(let Ze=0;Ze<Te;Ze++){const lt=Y.current.pop();if(!lt)break;be.push(lt)}const Pe=c.cursor;for(let Ze=be.length-1;Ze>=0;Ze--){const lt=be[Ze],pt=Ze===0?Pe:be[Ze-1].cursorBefore;Z.current.push({...lt,cursorAfter:pt})}for(const Ze of be)VH(Ze.undoPatch);const Ge=be[be.length-1];M(Ge.cursorBefore),Zc.setState({cursor:Ge.cursorBefore,select:void 0})},redo(ge=H){const Te=Math.min(ge,Z.current.length);if(Te<=0)return;const be=zH();let Pe=c.cursor;for(let Ge=0;Ge<Te;Ge++){const Ze=Z.current.pop();if(!Ze)break;let lt;try{lt=be.undo(Ze.undoPatch)}catch{const[ne]=be.rebaseBatch([Ze.patch]);if(!ne)continue;lt=ne}VH(lt);let pt;try{pt=be.undo(lt)}catch{pt=Ze.undoPatch}Y.current.push({patch:lt,undoPatch:pt,cursorBefore:Ze.cursorBefore,cursorAfter:c.cursor}),Pe=Ze.cursorAfter??c.cursor}M(Pe),Zc.setState({cursor:Pe,select:void 0})}}:void 0;return Ye.useEffect(()=>{if(!fe(s))return;const ge=zH(),Te=ge.end.api.onFlush.listen(be=>{if(s3e(be,s.nodeId))try{const Pe=ge.undo(be);Y.current.push({patch:be,undoPatch:Pe,cursorBefore:Q.current}),Z.current=[]}catch{}});return()=>Te()},[s,s?.nodeId?.sid,s?.nodeId?.time]),Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(kU,{blocking:!0,x:h.left,y:h.top,width:h.width,height:h.height,onClick:()=>{document.getElementById("touchtext")?.focus()},onScroll:ge=>re(ge*.75)}),Ee.jsx(xo,{MOVE_LEFT:ge=>{F(ge.shift),ge.ctrl?te(x.start):te(c.cursor-(ge.alt?10:1))},MOVE_RIGHT:ge=>{F(ge.shift),ge.ctrl?te(x.end):te(c.cursor+(ge.alt?10:1))},MOVE_UP:ge=>{F(ge.shift),ge.ctrl?te(0):re(ge.alt?-10:-1)},MOVE_DOWN:ge=>{F(ge.shift),ge.ctrl?te(E):re(ge.alt?10:1)},OK_BUTTON:()=>{if(fe(s)){Q.current=c.cursor,s.insert(c.cursor,`
`);const ge=c.cursor+1;M(ge),Zc.setState({cursor:ge})}},CANCEL_BUTTON:ge=>{ge.shift||ge.alt||ge.ctrl?UT(qe,l):exe(qe,l)},MENU_BUTTON:ge=>{RK(qe,l,!ge.shift)},keydown:ge=>{if(!fe(s))return;const{key:Te}=ge,be=rr(Te),Pe=TC(ge);switch(be){case"delete":k?G():D(c.cursor,1);break;case"backspace":k?G():m.length>0&&D(Math.max(c.cursor-1,0),1);break;default:if(Pe.ctrl)switch(be){case"z":ie&&(z1&&Pe.shift?ie.redo():ie.undo());break;case"y":ie&&!z1&&ie.redo();break;case"a":M(E),Zc.setState({cursor:E,select:0});break;case"c":fe(da())?da().writeText(I).catch(Ge=>_r(qe,l,"clipboard",Ge)):K();break;case"v":fe(da())?da().readText().then(Ge=>{const Ze=Ge.replaceAll("\r","");k?D(A,L,Ze):D(c.cursor,0,Ze)}).catch(Ge=>_r(qe,l,"clipboard",Ge)):K();break;case"x":fe(da())&&k?da().writeText(I).then(()=>G()).catch(Ge=>_r(qe,l,"clipboard",Ge)):K();break;case"p":k?(Am(qe,l,I),us(qe,l,`running $WHITE${I.substring(0,16)}...$BLUE`)):(Am(qe,l,x.code),us(qe,l,`running $WHITE${x.code.substring(0,16)}...$BLUE`));break;case"'":z();break}else if(!Pe.alt){if(ge.key.length===1)if(k)ge.key==="'"?z():ge.key===" "?q(ge.shiftKey):D(A,L,ge.key);else{Q.current=c.cursor;const Ge=c.cursor+ge.key.length;s.insert(c.cursor,ge.key),M(Ge),Zc.setState({cursor:Ge})}}break}}})]})}function aW(t){const[e]=t.substring(1).split(";");return e.split(" ")}let Lk;function Kd(t){const e=K6e(Ute(t));Object.keys(e).filter(r=>!!r).length?Lk=e:console.error(t)}function q$e({ycursor:t,xoffset:e,yoffset:n,rows:r,codepage:i}){const s=ff(),o=Bl(),a=Zc(),{quickterminal:c}=ls(),l=Ye.useMemo(()=>{if(r.length){const g=r[r.length-1];return[...r,{code:"",start:g.end+1,end:g.end+1}]}return[]},[r]);if(!fe(i)){const g=(s?"|":"-").repeat(3);return t1(!1,!1,0,0,o,1,2,1),ei(` ${g} LOADING ${g}`,o,!0),null}const u=o.width-2,h=yp(o);h.right=u-1;let f=a.cursor,d=a.cursor,p=!1;fe(a.select)&&(p=!0,f=Math.min(a.cursor,a.select),d=Math.max(a.cursor,a.select),a.cursor!==a.select&&--d);const m=h.left+1-4;t1(!1,!1,-e,-n,o,1,2,1);for(let g=0;g<l.length;++g){if(o.y<=h.top+1){++o.y;continue}const _=l[g],y=l[g-1],v=g===t,E=g-1===t,x=_.code.replaceAll(`
`,""),A=m-e;o.x=A,o.iseven=o.y%2===0,o.active.color=Ft.WHITE,o.active.bg=v?UU:Sx(c),o.disablewrap=!0,o.active.rightedge=u;const T=`${g+1}`.padStart(3," ");u4(`${g<r.length?T:"   "} ${x} `,o,!1);const k=1+o.y*o.width;Uf(k,h.right,-e-4,-e,M$e,o.active.bg,o),sT(k,h.right,-e+20,-e+20,Ft.DKCYAN,o),sT(k,h.right,-e+36,-e+36,Ft.DKCYAN,o),sT(k,h.right,-e+46,-e+46,Ft.DKCYAN,o);let L=-1;const I=Ci(a.cursor-_.start,1,_.end-_.start);if(fe(_.tokens))for(let M=0;M<_.tokens.length;++M){const D=_.tokens[M];v&&I>=(D.startColumn??1)&&I<=(D.endColumn??1)&&(L=M);const O=(D.startColumn??1)-1-e,z=(D.endColumn??1)-1-e,q=N$e[D.tokenTypeIdx];if(fe(q))switch(q){case Dk:{const G=aW(D.image);switch(NL("",G,!!D.payload).type){case Hn.BOARD:case Hn.LOADER:case Hn.OBJECT:case Hn.TERRAIN:case Hn.CHARSET:case Hn.PALETTE:{Uf(k,h.right,O,z,Dk,o.active.bg,o);break}case Hn.CONST:case Hn.RANGE:case Hn.SELECT:case Hn.NUMBER:case Hn.TEXT:case Hn.HOTKEY:case Hn.COPYIT:case Hn.OPENIT:case Hn.ZSSEDIT:case Hn.CHAREDIT:case Hn.COLOREDIT:{const[te]=G;Uf(k,h.right,O,O+te.length,Dk,o.active.bg,o),G.length>1&&Uf(k,h.right,O+te.length+1,z,Jre,o.active.bg,o);break}default:Uf(k,h.right,O,z,Ft.DKRED,o.active.bg,o);break}break}case Ra:{Uf(k,h.right,O,O,q,o.active.bg,o),O!==z&&Uf(k,h.right,O+1,z,$T,o.active.bg,o);break}case $T:{const G=V$e(D.image);if(Kn(G))for(let K=0;K<G.length;++K)Uf(k,h.right,O+K,z+K,G[K],o.active.bg,o);else Uf(k,h.right,O,z,G,o.active.bg,o);break}default:Uf(k,h.right,O,z,q,o.active.bg,o);break}}if(p&&_.start<=d&&_.end>=f){const M=Math.max(_.start,f)-_.start-e,D=Math.min(_.end,d)-_.start-e,O=h.width-3,z=Math.max(0,M),q=Math.min(O,D);z<=O&&q>=m&&Uf(k,h.right,z,q,x$e,w$e,o)}if(v&&fe(_.tokens)){let M;if(fe(_.asts)){for(let D=0;D<(_.asts?.length??0);++D)_.asts[D].type===Bn.IF&&(M=_.asts[D]);fe(M)||(M=_.asts.find(D=>I<=(D.endColumn??0)))}Lk=void 0;for(let D=L;D>=0;--D){const O=_.tokens[D-1],z=_.tokens[D],q=_.tokens[D+1];switch(z.tokenTypeIdx){case mg.tokenTypeIdx:case y1.tokenTypeIdx:case v1.tokenTypeIdx:case b1.tokenTypeIdx:case P1.tokenTypeIdx:case OE.tokenTypeIdx:case cA.tokenTypeIdx:case lA.tokenTypeIdx:case uA.tokenTypeIdx:case _1.tokenTypeIdx:case aA.tokenTypeIdx:if(z.tokenTypeIdx===_1.tokenTypeIdx&&(!fe(M)||z.startColumn!==M.startColumn))continue;break;default:continue}switch(z.tokenTypeIdx){case mg.tokenTypeIdx:{Kd(`editor:command:${q.image}`);break}case y1.tokenTypeIdx:{Kd("editor:command:do");break}case v1.tokenTypeIdx:{Kd(O.tokenTypeIdx===b1.tokenTypeIdx?"editor:command:elseif":"editor:command:if");break}case b1.tokenTypeIdx:{Kd(q.tokenTypeIdx===v1.tokenTypeIdx?"editor:command:elseif":"editor:command:else");break}case P1.tokenTypeIdx:{const G=aW(z.image),K=NL("",G,!!z.payload);Kd(`editor:stat:${Z_(K.type)}`);break}case OE.tokenTypeIdx:{Kd("editor:label");break}case cA.tokenTypeIdx:{Kd("editor:comment");break}case lA.tokenTypeIdx:{Kd("editor:hyperlink");break}case uA.tokenTypeIdx:{Kd("editor:shorttry");break}case _1.tokenTypeIdx:{Kd("editor:shortgo");break}case aA.tokenTypeIdx:{Kd("editor:text");break}}break}dn(Lk?.desc)&&ei(Lk.desc,o,!1)}const[F]=_.errors??[];if(E&&fe(y.errors)){o.x=A;const[M]=y.errors,D=`${M.message}`.replaceAll(`
`," ");u4(D,o,!1),Uf(k,h.right,0,D.length-1,Ft.WHITE,iW,o)}else if(fe(F)){const M=3+(F.column??1),D=F.length??1;sT(k,h.right,0,2,iW,o),sT(k,h.right,M,M+D-1,O$e,o)}if(++o.y,o.y>=h.bottom)break}return o.disablewrap=!1,o.active.rightedge=o.width,null}function tD(t){switch(t){case"stat":case"text":case"hyperlink":return!1;default:return!0}}ts("a",hb);ts("b",hb);ts("c",hb);ts("d",hb);ts("e",hb);ts("f",hb);ts("g",hb);ts("x",H$e);ts("#",tie);ts("!",tie);ts("y",fb);ts("t",fb);ts("s",fb);ts("i",fb);ts("q",fb);ts("h",fb);ts("w",fb);ts("3",Qre);ts(".",Qre);ts("+",eie);ts("-",eie);ts("0",Qm);ts("1",Qm);ts("2",Qm);ts("p",Qm);ts("4",Qm);ts("5",Qm);ts("6",Qm);ts("7",Qm);ts("8",Qm);ts("9",Qm);ts(";",Ra);function cW(){const t=ii(),[e]=ls(xh(x=>[x.editor])),[n,r,i,s,o,a,c,l,u,h,f]=Kr(xh(x=>[x.zsswords.cli,x.zsswords.loader,x.zsswords.runtime,x.zsswords.flags,x.zsswords.stats,x.zsswords.kinds,x.zsswords.altkinds,x.zsswords.colors,x.zsswords.dirs,x.zsswords.dirmods,x.zsswords.exprs]));Ye.useEffect(()=>{n.filter(tD).forEach(x=>Yd(x,Kh)),r.filter(tD).forEach(x=>Yd(x,Kh)),i.filter(tD).forEach(x=>Yd(x,Kh)),s.forEach(x=>Yd(x,P$e)),o.forEach(x=>Yd(x,D$e)),a.forEach(x=>Yd(x,L$e)),c.forEach(x=>Yd(x,U$e)),l.forEach(x=>Yd(x,B$e)),u.forEach(x=>Yd(x,F$e)),h.forEach(x=>Yd(x,j$e)),f.forEach(x=>Yd(x,z$e))},[n,r,i,s,o,a,c,l,u,h,f]);const d=Zc(),p=xte(PK(e.book,e.path));Ye.useEffect(()=>(_xe(qe,t,e.book,e.path),()=>{vxe(qe,t,e.book,e.path)}),[e.book,e.path,t]);const m=fe(p)?p.toJSON():"",g=A$e(m),_=MT(d.cursor,g),y=d.cursor-g[_].start,v=See(m);if(fe(v.tokens)){let x=!0;for(let A=0;A<v.tokens.length;++A){const T=v.tokens[A];T.tokenTypeIdx===P1.tokenTypeIdx&&(T.payload=x,x=!1);const k=g[(T.startLine??1)-1];fe(k)&&(k.tokens=k.tokens??[],k.tokens.push(T))}}if(v?.ast?.type===Bn.PROGRAM){Uee(v.ast);const x=[];for(let A=1;A<v.ast.lines.length;++A)x.push(v.ast.lines[A]);for(;x.length;){const A=x.pop();if(nn(A?.type)){switch(A.type){case Bn.LINE:case Bn.IF:if(nn(A.startLine)){const k=g[A.startLine-1];k.asts=k.asts??[],k.asts.unshift(A)}break}const T=Dm(A);for(let k=0;k<T.length;++k){const L=T[k],I=A[L];Kn(I)?x.push(...I):typeof I=="object"&&x.push(I)}}}}if(fe(v.errors))for(let x=0;x<v.errors.length;++x){const A=v.errors[x],T=g[(A.line??1)-1];fe(T)&&(T.errors=T.errors??[],T.errors.push(A))}const E={rows:g,xcursor:y,ycursor:_,codepage:p,xoffset:-4+d.xscroll,yoffset:d.yscroll};return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(BU,{bump:!0}),Ee.jsx(G$e,{}),Ee.jsx(q$e,{...E}),Ee.jsx(W$e,{...E})]})}function Y$e(t,e,n,r){const i=t.slice(0,e),s=t.slice(e+n);return`${i}${r??""}${s}`}function K$e(t){const[e,n]=t.split(":"),r=fe(n);return[r?e:"self",r?n:t]}function X$e(t){return Math.max(bn+1,t-1)}function rie(t,e,n){return t.startsWith("!")?1:$g(t,e,n)?.y??1}const J$e=self.SpeechRecognition??self.webkitSpeechRecognition??self.mozSpeechRecognition??self.msSpeechRecognition??self.oSpeechRecognition;class Z$e{recognition;constructor(e,n,r,i=navigator.language){if(!("webkitSpeechRecognition"in window))throw new Error("This browser doesn't support speech recognition. Try Google Chrome.");this.recognition=new J$e,this.recognition.interimResults=!!r,this.recognition.lang=i;let s="";this.recognition.onresult=o=>{let a="";for(let c=o.resultIndex;c<o.results.length;c+=1){const l=o.results[c][0].transcript;o.results[c].isFinal?(s+=l,e(s),s=""):this.recognition.interimResults&&(a+=l,r(a))}},this.recognition.onend=()=>{n()}}startListening(){this.recognition.start()}stopListening(){this.recognition.stop()}}function Q$e({quickterminal:t,voice2text:e,tapeycursor:n,logrowtotalheight:r}){const i=ff(),s=Bl(),o=Ai(),[a]=ls(xh(D=>[D.editor.open])),c=ii(),l=yp(s),u=o.buffer[o.bufferindex];let h=o.xcursor,f=o.xcursor,d=!1;fe(o.xselect)&&fe(o.yselect)&&(d=!0,h=Math.min(o.xcursor,o.xselect),f=Math.max(o.xcursor,o.xselect),o.xcursor!==o.xselect&&--f);const p=f-h+1,m=o.ycursor===0,g=d?u.substring(h,f+1):u,_=Ye.useCallback((D,O,z)=>{o.bufferindex>0&&Ai.setState({bufferindex:0}),o.buffer[0]=Y$e(u,D,O,z),Ai.setState({buffer:o.buffer,xselect:void 0,xcursor:D+(z??"").length})},[u,o.buffer,o.bufferindex]),y=Ye.useCallback(D=>{o.bufferindex>0&&Ai.setState({bufferindex:0}),o.buffer[0]=D,Ai.setState({buffer:o.buffer,xselect:void 0,xcursor:D.length})},[o.buffer,o.bufferindex]),v=l.bottom-l.top-(a?0:2),E=Ye.useCallback(D=>{Ai.setState(O=>{const z=Ci(Math.round(O.ycursor+D),0,r),q=Ci(z-Math.round(v*.5),0,r-v);return{ycursor:z,scroll:q}})},[r,v]);function x(D){const O=o.buffer.length-1,z=Ci(D,0,O);Ai.setState({bufferindex:z,scroll:0,xcursor:o.buffer[z].length,ycursor:0,xselect:void 0,yselect:void 0})}function A(D){D?fe(o.xselect)||Ai.setState({xselect:o.xcursor,yselect:o.ycursor}):Ai.setState({xselect:void 0,yselect:void 0})}function T(){fe(o.xselect)&&(Ai.setState({xcursor:h,xselect:void 0,yselect:void 0}),_(h,p))}const k=Ye.useCallback(()=>{Ai.setState({scroll:0,xcursor:u.length,ycursor:0,xselect:void 0,yselect:void 0})},[u.length]);if(s.reset.bg=Sx(t),!t){Tg(!1,0,0,s);const D="$DKCYANmain:0.88.8 audio tweaks (#620)",O=$g(D,l.width,1);s.x=l.width-(O?.measuredwidth??0)-1,ei(D,s,!0)}const L="$196",F="$205".repeat(l.width-6);Tg(!1,0,l.height-2,s),s.active.color=Ft.WHITE,ei(`  ${L}${F}${L}  `,s,!0);const M=u.padEnd(l.width," ");if(Tg(!1,0,l.height-1,s),s.active.color=Ft.WHITE,u4(M,s,!0),fe(o.xselect)&&fe(o.yselect)&&o.xcursor!==o.xselect){const D=Math.min(o.xcursor,o.xselect),O=Math.min(o.ycursor,o.yselect),z=Math.max(o.xcursor,o.xselect)-1,q=Math.max(o.ycursor,o.yselect);for(let G=O;G<=q;++G){const K=D+(l.bottom-G)*l.width,te=z+(l.bottom-G)*l.width;fv(K,te,15,8,s)}}if(i){const D=l.left+o.xcursor,O=l.top+n;if(O>=l.top&&O<=l.bottom&&D>=l.left&&D<=l.right){const z=D+O*s.width;TA(z,"",s),fv(z,z,Ft.WHITE,s.reset.bg,s)}}return Ye.useEffect(()=>{let D;if(!e||!t)return;const{buffer:O,bufferindex:z}=Ai.getState(),q=O[z];if(q!=="")return;function G(re){y(`${q}${re}`),setTimeout(()=>{const{buffer:H,bufferindex:Y}=Ai.getState(),Z=H[Y],Q=["",Z,...H.slice(1).filter(ie=>ie!==Z)].filter(ie=>ie.includes("#broadcast")===!1);x$(Q).catch(ie=>_r(qe,c,"terminalinput",ie.message)),Ai.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:Q}),Am(qe,c,Z),UT(qe,c)},512)}function K(){}function te(re){y(`${q}${re}`)}try{D=new Z$e(G,K,te),D?.startListening()}catch(re){console.error(re.message)}return()=>{D?.stopListening(),D=void 0}},[]),Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(kU,{blocking:!0,x:l.left,y:l.top,width:l.width,height:l.height,onClick:()=>{document.getElementById("touchtext")?.focus()},onScroll:D=>{A(!1),E(-D)}}),Ee.jsx(xo,{MOVE_LEFT:D=>{A(D.shift),D.ctrl?Ai.setState({xcursor:0}):Ai.setState({xcursor:Ci(o.xcursor-(D.alt?10:1),0,l.right)})},MOVE_RIGHT:D=>{A(D.shift),D.ctrl?Ai.setState({xcursor:m?u.length:l.right}):Ai.setState({xcursor:Ci(o.xcursor+(D.alt?10:1),0,l.right)})},MOVE_UP:D=>{D.ctrl?x(o.bufferindex+1):(A(D.shift),E(D.alt?10:1))},MOVE_DOWN:D=>{D.ctrl?x(o.bufferindex-1):(A(D.shift),E(-(D.alt?10:1)))},OK_BUTTON:()=>{const D=d?g:u;if(D.length)if(m){const{buffer:O}=Ai.getState(),z=["",D,...O.slice(1).filter(q=>q!==D)].filter(q=>q.includes("#broadcast")===!1);x$(z).catch(q=>_r(qe,c,"terminalinput",q.message)),Ai.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:z}),Am(qe,c,D),t&&UT(qe,c)}else k()},CANCEL_BUTTON:()=>{UT(qe,c)},MENU_BUTTON:D=>{RK(qe,c,!D.shift)},keydown:D=>{const{key:O}=D,z=rr(O),q=TC(D);switch(z){case"delete":m?d?T():u.length>0&&_(o.xcursor,1):k();break;case"backspace":m?d?T():o.xcursor>0&&_(o.xcursor-1,1):k();break;default:if(q.ctrl)switch(z){case"p":K5(qe,c);break;case"a":Ai.setState({xselect:0,yselect:0,xcursor:u.length,ycursor:0});break;case"c":m&&fe(da())?da().writeText(g):k();break;case"v":m&&fe(da())?da().readText().then(G=>{try{const te=JSON.parse(G);if(dn(te.exported)&&fe(te.data)){dh(qe,c,void 0,"json",`file:${te.exported}`,JSON.stringify(te));return}}catch(te){console.error(te)}const K=G.replaceAll("\r","");d?_(h,p,K):_(o.xcursor,0,K)}).catch(G=>console.error(G)):k();break;case"x":m&&fe(da())?da().writeText(g).then(()=>T()):k();break}else q.alt||D.key.length===1&&(m&&o.xcursor<=u.length?d?(_(h,p,D.key),Ai.setState({xselect:void 0})):_(o.xcursor,0,D.key):k());break}}})]})}function eGe({active:t,prefix:e,label:n,words:r,y:i}){const s=Bl(),o=Ye.useCallback(()=>{const[,...c]=r;ME(qe,ii(),c.join(" "))},[r]),a=jl(!!t);return Tg(!!t,0,i,s),ei(`${e} $purple$16 $yellowCOPYIT ${a}${n}`,s,!0),t&&Ee.jsx(xo,{OK_BUTTON:o})}function tGe({active:t,prefix:e,label:n,words:r,y:i}){const s=Bl(),o=Ye.useContext(Xre),a=Ye.useCallback(()=>{const[l,...u]=r;setTimeout(()=>{o.sendmessage(l,u)},100)},[r,o]),c=jl(!!t);return Tg(!!t,0,i,s),ei(`${e} $purple$16 ${c}${n}`,s,!0),t&&Ee.jsx(xo,{OK_BUTTON:a})}function nGe({active:t,prefix:e,label:n,words:r,y:i}){const s=Bl(),o=Ye.useCallback(()=>{const[,c,...l]=r,u=l.join(" "),h=ii();setTimeout(()=>{switch(c){case"wiki":io(qe,h,async()=>{const f=await X8(u);oU(h,f)});break;case"inline":window.location.href=u;break;default:window.open(`${c} ${u}`.trim(),"_blank");break}},100)},[r]),a=jl(!!t);return Tg(!!t,0,i,s),ei(`${e} $purple$16 $yellowOPENIT ${a}${n}`,s,!0),t&&Ee.jsx(xo,{OK_BUTTON:o})}function rGe({active:t,prefix:e,label:n,words:r,y:i}){const s=Bl(),o=Ye.useCallback(()=>{const[,...c]=r;N1(qe,ii(),c.join(" "))},[r]),a=jl(!!t);return Tg(!!t,0,i,s),ei(`${e} $purple$16 $CYANRUNIT ${a}${n}`,s,!0),t&&Ee.jsx(xo,{OK_BUTTON:o})}function iGe({active:t,prefix:e,label:n,words:r,y:i}){const s=Bl(),{setviewimage:o}=va(),a=Ye.useCallback(()=>{const[,...l]=r,u=l.join(" ");setTimeout(()=>o(u),100)},[o,r]),c=jl(!!t);return Tg(!!t,0,i,s),ei(`${e} $purple$16 $CYANVIEWIT ${c}${n}`,s,!0),t&&Ee.jsx(xo,{OK_BUTTON:a})}function iie({active:t,text:e,y:n}){const r=Bl(),{quickterminal:i}=ls(),s=yp(r),o=e.startsWith("!");Tg(!!t,0,n,r),r.reset.bg=t?UU:Sx(i),r.active.bottomedge=s.bottom;const a=G8(e);if(fe(a)){const c=s.width-3,u=$g(a,c,3)?.measuredwidth??1,h=Ci(Math.floor(c*.5-u*.5),0,c);ei(`${" ".repeat(h)}$WHITE${a}`,r,!0)}else ei(o?"":e,r,!0);if(o){const[c,...l]=e.slice(1).split("!"),u=`${l.join("!")}`;let h="PRESS ME";const f=[],d=dx(u,!0);for(let _=0;_<d.tokens.length;_++){const y=d.tokens[_];y.tokenType===DI?h=y.image.slice(1):f.push(y.image)}const[p,...m]=f,g={active:t,prefix:c,label:h,words:m,y:n};switch(rr(p)){case"copyit":return Ee.jsx(eGe,{...g,words:f});case"openit":return Ee.jsx(nGe,{...g,words:f});case"viewit":return Ee.jsx(iGe,{...g,words:f});case"runit":return Ee.jsx(rGe,{...g,words:f});default:case"hyperlink":return Ee.jsx(tGe,{...g,words:f});case"hk":case"hotkey":return null;case"rn":case"range":return null;case"sl":case"select":return null;case"nm":case"number":return null;case"tx":case"text":return null;case"zssedit":return null;case"charedit":return null;case"coloredit":return null}}return null}function sGe({active:t,text:e,y:n}){return ff(),Ee.jsx(iie,{active:t,text:e,y:n})}function oGe(){const t=Zm(),e=ls(m=>m.editor.open),n=ls(m=>m.terminal.logs),r=Bl(),i=Ai(m=>m.scroll),s=Ai(m=>m.xcursor),o=Ai(m=>m.ycursor),a=yp(r);Ye.useEffect(()=>{const m=Ai.getState().pan;if(r.width>t.cols){const g=Math.round(t.cols*.5),_=Math.round(t.cols*.75),y=t.cols-_,v=r.width-t.cols,E=s-m;E<y?Ai.setState({pan:Ci(m-g,0,v)}):E>_&&Ai.setState({pan:Ci(m+g,0,v)})}else m!==0&&Ai.setState({pan:0})},[s,t.cols,r.width]);const c=r.width-1,l=n.map(m=>rie(m,c,a.height)),u=a.bottom-a.top-(e?0:2);let h=u+1;const f=l.map(m=>(h-=m,h)),d=a.bottom-o+i,p=n.map((m,g)=>{const _=f[g]+i,y=l[g],v=_+y;return v<0||_<0||_>u?null:[g,m,_,!e&&d>=_&&d<v]}).filter(m=>m!==null);return Ee.jsx(Ee.Fragment,{children:Ee.jsx(xC.Provider,{value:r,children:p.map(([m,g,_,y])=>y?Ee.jsx(sGe,{active:!0,text:g,y:_},m):Ee.jsx(iie,{text:g,y:_},m))})})}function lW(){const t=ii(),e=ls(d=>d.editor.open),n=ls(d=>d.terminal.logs),r=ls(d=>d.quickterminal),[i,s]=Ye.useState(void 0);Ye.useLayoutEffect(()=>{io(qe,ii(),async()=>{const d=await Mk("voice2text");s(d==="on")})},[]);const o=Bl(),a=Ai(),c=yp(o),l=o.width-1,u=n.map(d=>rie(d,l,c.height));let h=0;u.forEach(d=>{h+=d}),++h;const f=c.bottom-a.ycursor+a.scroll;return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(BU,{}),Ee.jsxs(Xre.Provider,{value:{sendmessage(d,p){const[m,g]=K$e(d);if(m==="self"){const _=`#${g} ${p.join(" ")}`;Am(qe,t,_)}else qe.emit(t,`${m}:${g}`,p)}},children:[Ee.jsx(oGe,{}),!e&&i!==void 0&&Ee.jsx(Q$e,{quickterminal:r,voice2text:i,tapeycursor:f,logrowtotalheight:h})]})]})}function ek({quickterminal:t,top:e,left:n,width:r,height:i,children:s}){const o=Sx(t),a=ab(r,i,0,oO,o),c=Ye.useMemo(()=>({...Hg(r,i,oO,o),...a.getState()}),[o,r,i,a]);return Ee.jsxs(lb,{store:a,children:[Ee.jsxs(xC.Provider,{value:c,children:[Ee.jsx(BU,{}),s]}),Ee.jsx("group",{position:[n*kn.DRAW_CHAR_WIDTH(),e*kn.DRAW_CHAR_HEIGHT(),0],children:Ee.jsx(ub,{width:r,height:i})})]})}function aGe({quickterminal:t,top:e,width:n,height:r}){const i=Ai(c=>c.pan),s=ls(c=>c.layout);if(ls(c=>c.editor.open)){if(s===Wf.SPLIT_X){const c=T$e(n);return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(ek,{quickterminal:t,top:e,left:0,width:c,height:r,children:Ee.jsx(cW,{})}),Ee.jsx(ek,{quickterminal:t,top:e,left:c,width:n-c,height:r,children:Ee.jsx(lW,{})})]})}return Ee.jsx(ek,{quickterminal:t,top:e,left:0,width:n,height:r,children:Ee.jsx(cW,{})})}const a=X$e(n);return Ee.jsx(ek,{quickterminal:t,top:e,left:-i,width:a,height:r,children:Ee.jsx(lW,{})})}function cGe(){const t=Zm(),[e,n,r,i]=ls(xh(l=>[l.layout,l.quickterminal,l.terminal.open,l.editor.open]));let s=0,o=t.rows;switch(e){case Wf.TOP:o=Math.floor(t.rows*.5);break;case Wf.BOTTOM:o=Math.ceil(t.rows*.5),s=t.rows-o;break;default:case Wf.FULL:break}if(t.cols<10||t.rows<10)return null;const a=ii(),c=n||r||i;return Ee.jsxs(Ee.Fragment,{children:[c&&Ee.jsx(GI,{width:t.cols,height:t.rows,top:s,left:0,right:t.cols-1,bottom:s+o-1,alpha:n?.666:.333}),c?Ee.jsx(Dv,{blockhotkeys:!0,children:Ee.jsx(aGe,{quickterminal:n,top:s,width:t.cols,height:o})}):Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(w1,{hotkey:"Shift+?",althotkey:"/",children:()=>N1(qe,a)}),Ee.jsx(w1,{hotkey:"`",children:()=>N1(qe,a)})]})]})}const lGe=`
// CRT Emulation
// by Mattias

vec3 sample_(sampler2D tex, vec2 tc) {
	vec3 s = pow(texture2D(tex, tc).rgb, vec3(2.0));
	return s;
}

vec3 blur(sampler2D tex, vec2 tc, float offs) {
	vec4 xoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) * texelSize.x * 0.01;
	vec4 yoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) * texelSize.y * 0.001;
	
	vec3 color = vec3(0.0, 0.0, 0.0);
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.x)) * 0.00366;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.x)) * 0.01465;
	color += sample_(tex, tc + vec2(    0.0, yoffs.x)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.x)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.x)) * 0.00366;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.y)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.y)) * 0.05861;
	color += sample_(tex, tc + vec2(    0.0, yoffs.y)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.y)) * 0.05861;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.y)) * 0.01465;
	
	color += sample_(tex, tc + vec2(xoffs.x, 0.0)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.y, 0.0)) * 0.09524;
	color += sample_(tex, tc + vec2(    0.0, 0.0)) * 0.15018;
	color += sample_(tex, tc + vec2(xoffs.z, 0.0)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.w, 0.0)) * 0.02564;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.z)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.z)) * 0.05861;
	color += sample_(tex, tc + vec2(    0.0, yoffs.z)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.z)) * 0.05861;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.z)) * 0.01465;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.w)) * 0.00366;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.w)) * 0.01465;
	color += sample_(tex, tc + vec2(    0.0, yoffs.w)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.w)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.w)) * 0.00366;

	return color;
}

float rand(vec2 co) {
  float a = 12.9898;
  float b = 78.233;
  float c = 43758.5453;
  float dt = dot(co.xy, vec2(a, b));
  float sn = mod(dt, 3.14);
  return fract(sin(sn) * c);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
  vec3 col;  
  col.r = 1.0 * blur(inputBuffer, vec2(uv.x + 0.0009, uv.y + 0.0009), 1.2).x + 0.005;
  col.g = 1.0 * blur(inputBuffer, vec2(uv.x + 0.000, uv.y - 0.0015), 1.2).y + 0.005;
  col.b = 1.0 * blur(inputBuffer, vec2(uv.x - 0.0015, uv.y + 0.000), 1.2).z + 0.005;  

  col.r += 0.2 * blur(inputBuffer, vec2(uv.x + 0.0009, uv.y + 0.0009), 2.25).x - 0.005;
  col.g += 0.2 * blur(inputBuffer, vec2(uv.x + 0.000, uv.y - 0.0015), 1.75).y - 0.005;
  col.b += 0.2 * blur(inputBuffer, vec2(uv.x - 0.0015, uv.y + 0.000), 1.25).z - 0.005;
  
  float ghs = 0.05;
	float gphase = 0.371 * sin(time * 0.1);
	col.r += ghs * (1.0 - 0.299) * blur(inputBuffer, gphase * vec2(0.01, -0.027) + vec2(uv.x + 0.001, uv.y + 0.001), 7.0).x;
  col.g += ghs * (1.0 - 0.587) * blur(inputBuffer, gphase * vec2(-0.022, -0.02) + vec2(uv.x + 0.000, uv.y - 0.002), 5.0).y;
  col.b += ghs * (1.0 - 0.114) * blur(inputBuffer, gphase * vec2(-0.02, -0.0) + vec2(uv.x - 0.002, uv.y + 0.000), 3.0).z;

  col = clamp(col * 0.4 + 0.6 * col * 1.0, 0.0, 1.0);
	col = mix(col, col * col * col * col * col * col, 0.5) * 3.8;

	float scans = clamp(0.35 + 0.15 * sin(3.5 * (time * 0.125) + uv.y * resolution.y * 1.5), 0.0, 1.0);
	float s = pow(scans, 0.999);
	col = col * vec3(s);

  col *= 1.0 + 0.0015 * sin(500.0 * time);
  col *= 1.0 - 0.15 * vec3(clamp((mod(uv.x * texelSize.x, 2.0) - 1.0) * 2.0, 0.0, 1.0));
	
  col *= vec3(1.0) - 0.25 * vec3(
   rand(uv + 0.0001 * time), 
   rand(uv + 0.0001 * time + 0.3), 
   rand(uv + 0.0001 * time + 0.5));
	col = pow(col, vec3(0.45));

  outputColor = vec4(col.rgb, 1.0);
}
`;class uGe extends od{constructor(){super("ScanlinesEffect",lGe,{blendFunction:di.NORMAL,attributes:du.CONVOLUTION,defines:new Map([]),uniforms:new Map([])})}update(){}}const hGe=yx(uGe),uW=t=>(t.getAttributes()&du.CONVOLUTION)===du.CONVOLUTION,fGe=Ye.memo(Ye.forwardRef(({children:t,width:e,height:n},r)=>{const{gl:i,scene:s,camera:o}=Dc(),[a]=Ye.useMemo(()=>{const u=new Ire(i,{depthBuffer:!0,stencilBuffer:!1,multisampling:0,frameBufferType:Av});return u.addPass(new Pre(s,o)),[u]},[o,i,s]);Dg((u,h)=>{const f=i.autoClear;i.autoClear=!0,a.setSize(e,n),a.render(h),i.autoClear=f},2);const c=Ye.useRef(null);Ye.useLayoutEffect(()=>{const u=[],h=c.current.__r3f;if(h&&a){const f=h.children;for(let d=0;d<f.length;d++){const p=f[d].object;if(p instanceof od){const m=[p];if(!uW(p)){let _=null;for(;(_=f[d+1]?.object)instanceof od&&!uW(_);)m.push(_),d++}const g=new Dre(o,...m);u.push(g)}else p instanceof wh&&u.push(p)}for(const d of u)a?.addPass(d)}return()=>{for(const f of u)a?.removePass(f)}},[a,t,o]);const l=Ye.useMemo(()=>({composer:a,normalPass:null,downSamplingPass:null,resolutionScale:void 0,camera:o,scene:s}),[a,o,s]);return Ye.useImperativeHandle(r,()=>a,[a]),Ee.jsx(xU.Provider,{value:l,children:Ee.jsx("group",{ref:c,children:t})})}));function dGe({context:t}){return Ee.jsx("group",{position:[0,0,999],children:Ee.jsx(ub,{width:t.width,height:t.height})})}function hW({toast:t}){const e=Zm(),n=ab(e.cols,1,0,Ft.GREEN,Ft.ONCLEAR),r={...Hg(e.cols,1,Ft.GREEN,Ft.ONCLEAR,0,0,e.cols-1,1),...n.getState()};if(e.cols<10||e.rows<10)return null;const i=e.cols-1;return Ee.jsx(lb,{store:n,children:t&&Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(MU,{margin:1,color:Ft.YELLOW,y:0,leftedge:0,rightedge:i,line:`${t}$32$19$32`,context:r}),Ee.jsx("group",{position:[0,0,998],children:Ee.jsx(GI,{alpha:.4,width:e.cols,height:10,top:0,left:0,right:i,bottom:0})}),Ee.jsx(dGe,{context:r})]})})}function pGe({url:t,drawwidth:e,drawheight:n}){const r=i5(Wce,t);Ye.useEffect(()=>{r.flipY=!0,nne(r)},[r]);const{width:i=1,height:s=1}=r?.image??{},o=Math.min(e/i,n/s),a=i*o,c=s*o;return Ee.jsxs("mesh",{children:[Ee.jsx("planeGeometry",{args:[a,c]}),Ee.jsx("meshBasicMaterial",{map:r})]})}function mGe(){const t=Zm(),{viewimage:e,setviewimage:n}=va();if(t.cols<10||t.rows<10)return null;const r=t.cols-1,i=t.rows-1,s=(t.cols-4)*kn.DRAW_CHAR_WIDTH(),o=(t.rows-2)*kn.DRAW_CHAR_HEIGHT(),a=t.cols*kn.DRAW_CHAR_WIDTH()*.5,c=t.rows*kn.DRAW_CHAR_HEIGHT()*.5;return e&&Ee.jsxs(Dv,{children:[Ee.jsx(xo,{CANCEL_BUTTON:()=>n("")}),Ee.jsxs("group",{position:[0,0,998],children:[Ee.jsx(GI,{alpha:.4,width:t.cols,height:t.rows,top:0,left:0,right:r,bottom:i}),Ee.jsx("group",{position:[a,c,1],"scale-x":-1,"rotation-z":Math.PI,children:Ee.jsx(Ye.Suspense,{fallback:null,children:Ee.jsx(pGe,{url:e,drawwidth:s,drawheight:o})})})]})]})}var mT={},fW;function gGe(){if(fW)return mT;fW=1,Object.defineProperty(mT,"__esModule",{value:!0}),mT.MsgPackEncoderFast=void 0;const t=y8();let e=class{constructor(r=new t.Writer){this.writer=r}encode(r){return this.writer.reset(),this.writeAny(r),this.writer.flush()}encodeAny(r){this.writeAny(r)}writeAny(r){switch(r){case null:return this.writer.u8(192);case!1:return this.writer.u8(194);case!0:return this.writer.u8(195)}if(r instanceof Array)return this.writeArr(r);switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"object":return this.writeObj(r)}}encodeFloat64(r){this.writeFloat(r)}writeNull(){return this.writer.u8(192)}writeFloat(r){this.writer.u8f64(203,r)}u32(r){const i=this.writer;this.writer.ensureCapacity(5);const s=i.uint8;r<=127?s[i.x++]=r:r<=65535?(s[i.x++]=205,i.view.setUint16(i.x,r),i.x+=2):r<=4294967295?(s[i.x++]=206,i.view.setUint32(i.x,r),i.x+=4):this.writeFloat(r)}n32(r){const i=this.writer;this.writer.ensureCapacity(5);const s=i.uint8;r>=-32?s[i.x++]=256+r:r>=-32768?(s[i.x++]=209,i.view.setInt16(i.x,r),i.x+=2):r>=-2147483648?(s[i.x++]=210,i.view.setInt32(i.x,r),i.x+=4):this.writeFloat(r)}encodeNumber(r){this.writeNumber(r)}writeNumber(r){if(r>>>0===r)return this.u32(r);if(r>>0===r)return this.n32(r);this.writeFloat(r)}writeInteger(r){if(r>=0){if(r<=4294967295)return this.u32(r);if(r>-2147483648)return this.n32(r)}this.writeFloat(r)}writeUInteger(r){if(r<=4294967295)return this.u32(r);this.writeFloat(r)}encodeNull(){this.writer.u8(192)}encodeTrue(){this.writer.u8(195)}encodeFalse(){this.writer.u8(194)}encodeBoolean(r){this.writeBoolean(r)}writeBoolean(r){r?this.writer.u8(195):this.writer.u8(194)}encodeStringHeader(r){this.writeStrHdr(r)}writeStrHdr(r){r<=31?this.writer.u8(160|r):r<=255?this.writer.u16(55552+r):r<=65535?this.writer.u8u16(218,r):this.writer.u8u32(219,r)}encodeString(r){this.writeStr(r)}writeStr(r){const i=this.writer,o=r.length*4;i.ensureCapacity(5+o);const a=i.uint8;let c=i.x;o<=31?i.x++:o<=255?(a[i.x++]=217,c=i.x,i.x++):o<=65535?(a[i.x++]=218,c=i.x,i.x+=2):(a[i.x++]=219,c=i.x,i.x+=4);const l=this.writer.utf8(r);o<=31?a[c]=160|l:o<=255?a[c]=l:o<=65535?i.view.setUint16(c,l):i.view.setUint32(c,l)}encodeAsciiString(r){this.writeAsciiStr(r)}writeAsciiStr(r){this.writeStrHdr(r.length),this.writer.ascii(r)}encodeArrayHeader(r){this.writeArrHdr(r)}encodeArray(r){this.writeArr(r)}writeArrHdr(r){r<=15?this.writer.u8(144|r):r<=65535?this.writer.u8u16(220,r):r<=4294967295&&this.writer.u8u32(221,r)}writeArr(r){const i=r.length;i<=15?this.writer.u8(144|i):i<=65535?this.writer.u8u16(220,i):i<=4294967295&&this.writer.u8u32(221,i);for(let s=0;s<i;s++)this.writeAny(r[s])}encodeObjectHeader(r){this.writeObjHdr(r)}encodeObject(r){this.writeObj(r)}writeObjHdr(r){r<=15?this.writer.u8(128|r):r<=65535?this.writer.u8u16(222,r):r<=4294967295&&this.writer.u8u32(223,r)}writeObj(r){const i=Object.keys(r),s=i.length;this.writeObjHdr(s);for(let o=0;o<s;o++){const a=i[o];this.writeStr(a),this.writeAny(r[a])}}encodeExtHeader(r,i){switch(i){case 1:this.writer.u16(54272|r);break;case 2:this.writer.u16(54528|r);break;case 4:this.writer.u16(54784|r);break;case 8:this.writer.u16(55040|r);break;case 16:this.writer.u16(55296|r);break;default:i<=255?(this.writer.u16(50944|i),this.writer.u8(r)):i<=65535?(this.writer.u8u16(200,i),this.writer.u8(r)):i<=4294967295&&(this.writer.u8u32(201,i),this.writer.u8(r))}}encodeExt(r){const{tag:i,val:s}=r,o=s.length;this.encodeExtHeader(i,o),this.writer.buf(s,o)}encodeBinaryHeader(r){this.writeBinHdr(r)}encodeBinary(r){this.writeBin(r)}writeBinHdr(r){r<=255?this.writer.u16(50176|r):r<=65535?this.writer.u8u16(197,r):r<=4294967295&&this.writer.u8u32(198,r)}writeBin(r){const i=r.length;this.writeBinHdr(i),this.writer.buf(r,i)}};return mT.MsgPackEncoderFast=e,mT}gGe();var On;(function(t){t[t.add=0]="add",t[t.remove=1]="remove",t[t.replace=2]="replace",t[t.copy=3]="copy",t[t.move=4]="move",t[t.test=5]="test",t[t.str_ins=6]="str_ins",t[t.str_del=7]="str_del",t[t.flip=8]="flip",t[t.inc=9]="inc",t[t.split=10]="split",t[t.merge=11]="merge",t[t.extend=12]="extend",t[t.contains=30]="contains",t[t.defined=31]="defined",t[t.ends=32]="ends",t[t.in=33]="in",t[t.less=34]="less",t[t.matches=35]="matches",t[t.more=36]="more",t[t.starts=37]="starts",t[t.undefined=38]="undefined",t[t.test_type=39]="test_type",t[t.test_string=40]="test_string",t[t.test_string_len=41]="test_string_len",t[t.type=42]="type",t[t.and=43]="and",t[t.not=44]="not",t[t.or=45]="or"})(On||(On={}));class df{path;from;constructor(e){this.path=e}}var sr=ate(),nD={},dW;function _Ge(){return dW||(dW=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0;const{isArray:e}=Array,n=Object.keys,r=i=>{if(!i)return i;if(e(i)){const s=[],o=i.length;for(let a=0;a<o;a++)s.push((0,t.clone)(i[a]));return s}else if(typeof i=="object"){const s=n(i),o=s.length,a={};for(let c=0;c<o;c++){const l=s[c];a[l]=(0,t.clone)(i[l])}return a}return i};t.clone=r})(nD)),nD}var FU=_Ge();class jU extends df{value;constructor(e,n){super(e),this.value=n}op(){return"add"}code(){return On.add}apply(e){const{val:n,key:r,obj:i}=sr.find(e,this.path),s=FU.clone(this.value);if(!i)e=s;else if(typeof r=="string")i[r]=s;else{const o=i.length;if(r<o)i.splice(r,0,s);else{if(r>o)throw new Error("INVALID_INDEX");i.push(s)}}return{doc:e,old:n}}toJson(e){return{op:"add",path:sr.formatJsonPointer(this.path),value:this.value}}toCompact(e,n){return[n?"add":On.add,this.path,this.value]}}class sie extends df{oldValue;constructor(e,n){super(e),this.oldValue=n}op(){return"remove"}code(){return On.remove}apply(e){const n=sr.find(e,this.path);if(n.val===void 0)throw new Error("NOT_FOUND");return sr.isObjectReference(n)?delete n.obj[n.key]:sr.isArrayReference(n)?n.val!==void 0&&n.obj.splice(n.key,1):e=null,{doc:e,old:n.val}}toJson(e){const n={op:"remove",path:sr.formatJsonPointer(this.path)};return this.oldValue!==void 0&&(n.oldValue=this.oldValue),n}toCompact(e,n){const r=n?"remove":On.remove;return this.oldValue===void 0?[r,this.path]:[r,this.path,this.oldValue]}}class vGe extends df{value;oldValue;constructor(e,n,r){super(e),this.value=n,this.oldValue=r}op(){return"replace"}code(){return On.replace}apply(e){const n=sr.find(e,this.path);if(n.val===void 0)throw new Error("NOT_FOUND");const r=FU.clone(this.value);return sr.isObjectReference(n)||sr.isArrayReference(n)?n.obj[n.key]=r:e=r,{doc:e,old:n.val}}toJson(e){const n={op:"replace",path:sr.formatJsonPointer(this.path),value:this.value};return this.oldValue!==void 0&&(n.oldValue=this.oldValue),n}toCompact(e,n){const r=n?"replace":On.replace;return this.oldValue===void 0?[r,this.path,this.value]:[r,this.path,this.value,this.oldValue]}}class yGe extends df{from;constructor(e,n){super(e),this.from=n}op(){return"move"}code(){return On.move}apply(e){const n=new sie(sr.toPath(this.from),void 0).apply(e);return new jU(this.path,n.old).apply(n.doc)}toJson(e){return{op:"move",path:sr.formatJsonPointer(this.path),from:sr.formatJsonPointer(this.from)}}toCompact(e,n){return[n?"move":On.move,this.path,this.from]}}class bGe extends df{from;constructor(e,n){super(e),this.from=n}op(){return"copy"}code(){return On.copy}apply(e){const{val:n}=sr.find(e,this.from);if(n===void 0)throw new Error("NOT_FOUND");return new jU(this.path,FU.clone(n)).apply(e)}toJson(e){return{op:"copy",path:sr.formatJsonPointer(this.path),from:sr.formatJsonPointer(this.from)}}toCompact(e,n){return[n?"copy":On.copy,this.path,this.from]}}class Eu extends df{apply(e){if(!this.test(e))throw new Error("TEST");return{doc:e}}}var oie=ute();class SGe extends Eu{value;not;constructor(e,n,r){super(e),this.value=n,this.not=r}op(){return"test"}code(){return On.test}test(e){const{val:n}=sr.find(e,this.path);if(n===void 0)return!!this.not;const r=oie.deepEqual(n,this.value);return this.not?!r:r}toJson(e){const n={op:"test",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.not&&(n.not=this.not),n}toCompact(e,n){const r=e?this.path.slice(e.path.length):this.path,i=n?"test":On.test;return this.not?[i,r,this.value,1]:[i,r,this.value]}}class EGe extends df{op(){return"flip"}code(){return On.flip}apply(e){const n=sr.find(e,this.path);return n.obj?n.obj[n.key]=!n.val:e=!n.val,{doc:e,old:n.val}}toJson(e){return{op:"flip",path:sr.formatJsonPointer(this.path)}}toCompact(e,n){return[n?"flip":On.flip,this.path]}}class xGe extends df{inc;constructor(e,n){super(e),this.inc=n}op(){return"inc"}code(){return On.inc}apply(e){const n=sr.find(e,this.path),r=this.inc+Number(n.val);return n.obj?n.obj[n.key]=r:e=r,{doc:e,old:n.val}}toJson(e){return{op:"inc",path:sr.formatJsonPointer(this.path),inc:this.inc}}toCompact(e,n){return[n?"inc":On.inc,this.path,this.inc]}}class wGe extends df{pos;str;constructor(e,n,r){super(e),this.pos=n,this.str=r}op(){return"str_ins"}code(){return On.str_ins}apply(e){const{val:n,key:r,obj:i}=sr.find(e,this.path);if(typeof n!="string"){if(n!==void 0)throw new Error("NOT_A_STRING");if(this.pos!==0)throw new Error("POS")}const s=typeof n=="string"?n:"",o=Math.min(this.pos,s.length),a=s.slice(0,o),c=s.slice(o),l=a+this.str+c;return i?i[r]=l:e=l,{doc:e,old:n}}toJson(e){return{op:"str_ins",path:sr.formatJsonPointer(this.path),pos:this.pos,str:this.str}}toCompact(e,n){return[n?"str_ins":On.str_ins,this.path,this.pos,this.str]}}class pW extends df{pos;str;len;constructor(e,n,r,i){super(e),this.pos=n,this.str=r,this.len=i}op(){return"str_del"}code(){return On.str_del}deleteLength(){return typeof this.str=="string"?this.str.length:this.len}apply(e){const{val:n,key:r,obj:i}=sr.find(e,this.path);if(typeof n!="string")throw new Error("NOT_A_STRING");const s=n.length,o=Math.min(this.pos,n.length),a=Math.min(o,s),c=this.str!==void 0?this.str.length:this.len,l=Math.min(o+c,s),u=n.slice(0,a),h=n.substr(l),f=u+h;return i?i[r]=f:e=f,{doc:e,old:n}}toJson(e){return typeof this.str=="string"?{op:"str_del",path:sr.formatJsonPointer(this.path),pos:this.pos,str:this.str}:{op:"str_del",path:sr.formatJsonPointer(this.path),pos:this.pos,len:this.len}}toCompact(e,n){const r=n?"str_del":On.str_del;return typeof this.str=="string"?[r,this.path,this.pos,this.str]:[r,this.path,this.pos,0,this.len]}}const{isArray:TGe}=Array,w4=t=>!!t&&typeof t=="object"&&typeof t.text=="string",T4=t=>!!t&&typeof t=="object"&&TGe(t.children),AGe=(t,e)=>{const n=new RegExp(t,e?"i":void 0);return r=>n.test(r)};class CGe extends df{pos;props;constructor(e,n,r){super(e),this.pos=n,this.props=r}op(){return"split"}code(){return On.split}apply(e){const n=sr.find(e,this.path);if(n.val===void 0)throw new Error("NOT_FOUND");const r=this.split(n.val);return sr.isObjectReference(n)?n.obj[n.key]=r:sr.isArrayReference(n)?(n.obj[n.key]=r[0],n.obj.splice(n.key+1,0,r[1])):e=r,{doc:e,old:n.val}}split(e){if(typeof e=="string"){const{pos:n,props:r}=this,i=e.slice(0,n),s=e.slice(n);return r?[{...r,text:i},{...r,text:s}]:[i,s]}else if(w4(e)){const{pos:n,props:r}=this,i=e.text.slice(0,n),s=e.text.slice(n);return[{...e,...r,text:i},{...e,...r,text:s}]}else if(T4(e)){const{pos:n,props:r}=this,i=e.children.slice(0,n),s=e.children.slice(n);return[{...e,...r,children:i},{...e,...r,children:s}]}else if(typeof e=="number"){const{pos:n}=this;return[n,e-n]}else return[e,e]}toJson(e){const n={op:"split",path:sr.formatJsonPointer(this.path),pos:this.pos};return this.props&&(n.props=this.props),n}toCompact(e,n){const r=n?"split":On.split;return this.props?[r,this.path,this.pos,this.props]:[r,this.path,this.pos]}}class RGe extends df{pos;props;constructor(e,n,r){super(e),this.pos=n,this.props=r}op(){return"merge"}code(){return On.merge}apply(e){const n=sr.find(e,this.path);if(!sr.isArrayReference(n))throw new Error("INVALID_TARGET");if(n.key<=0)throw new Error("INVALID_KEY");const r=n.obj[n.key-1],i=n.obj[n.key],s=this.merge(r,i);return n.obj[n.key-1]=s,n.obj.splice(n.key,1),{doc:e,old:[r,i]}}merge(e,n){return typeof e=="string"&&typeof n=="string"||typeof e=="number"&&typeof n=="number"?e+n:w4(e)&&w4(n)?{...e,...n,text:e.text+n.text}:T4(e)&&T4(n)?{...e,...n,children:[...e.children,...n.children]}:[e,n]}toJson(e){const n={op:"merge",path:sr.formatJsonPointer(this.path),pos:this.pos};return this.props&&(n.props=this.props),n}toCompact(e,n){const r=n?"merge":On.merge;return this.props?[r,this.path,this.pos,this.props]:[r,this.path,this.pos]}}const{isArray:kGe}=Array;class MGe extends df{props;deleteNull;constructor(e,n,r){super(e),this.props=n,this.deleteNull=r}op(){return"extend"}code(){return On.extend}apply(e){const n=sr.find(e,this.path);return sr.isArrayReference(n)?n.val!==void 0&&(n.obj[n.key]=this.extend(n.val)):sr.isObjectReference(n)?n.obj[n.key]=this.extend(n.val):e=this.extend(e),{doc:e}}extend(e){if(kGe(e)||typeof e!="object"||!e)return e;for(const[n,r]of Object.entries(this.props)){if(n==="__proto__")throw new Error("NO_PROTO");if(r===null&&this.deleteNull){delete e[n];continue}e[n]=r}return e}toJson(e){const n={op:"extend",path:sr.formatJsonPointer(this.path),props:this.props};return this.deleteNull&&(n.deleteNull=this.deleteNull),n}toCompact(e,n){const r=n?"extend":On.extend;return this.deleteNull?[r,this.path,this.props,1]:[r,this.path,this.props]}}class OGe extends Eu{op(){return"defined"}code(){return On.defined}test(e){const{val:n}=sr.find(e,this.path);return n!==void 0}toJson(e){return{op:"defined",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path)}}toCompact(e,n){return[n?"defined":On.defined,e?this.path.slice(e.path.length):this.path]}}class IGe extends Eu{op(){return"undefined"}code(){return On.undefined}test(e){try{const{val:n}=sr.find(e,this.path);return n===void 0}catch(n){if(n.message==="NOT_FOUND")return!0;throw n}}toJson(e){return{op:"undefined",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path)}}toCompact(e,n){return[n?"undefined":On.undefined,e?this.path.slice(e.path.length):this.path]}}const{isArray:NGe}=Array;class PGe extends Eu{type;constructor(e,n){super(e),this.type=n}op(){return"test_type"}code(){return On.test_type}test(e){const{val:n}=sr.find(e,this.path);return n===null?this.type.indexOf("null")>-1:NGe(n)?this.type.indexOf("array")>-1:this.type.indexOf(typeof n)>-1||typeof n=="number"&&n===Math.round(n)&&this.type.indexOf("integer")>-1}toJson(e){return{op:"test_type",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),type:this.type}}toCompact(e,n){return[n?"test_type":On.test_type,e?this.path.slice(e.path.length):this.path,this.type]}}class DGe extends Eu{pos;str;not;constructor(e,n,r,i){super(e),this.pos=n,this.str=r,this.not=i}op(){return"test_string"}code(){return On.test_string}test(e){const{val:n}=sr.find(e,this.path);if(typeof n!="string")return!1;const r=n.length,i=Math.min(this.pos,r),s=Math.min(this.pos+this.str.length,r),o=n.substring(i,s)===this.str;return this.not?!o:o}toJson(e){const n={op:"test_string",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),pos:this.pos,str:this.str};return this.not&&(n.not=this.not),n}toCompact(e,n){const r=n?"test_string":On.test_string,i=e?this.path.slice(e.path.length):this.path;return this.not?[r,i,this.pos,this.str,1]:[r,i,this.pos,this.str]}}class LGe extends Eu{len;not;constructor(e,n,r){super(e),this.len=n,this.not=r}op(){return"test_string_len"}code(){return On.test_string_len}test(e){const{val:n}=sr.find(e,this.path);if(typeof n!="string")return!1;const i=n.length>=this.len;return this.not?!i:i}toJson(e){const n={op:"test_string_len",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),len:this.len};return this.not&&(n.not=this.not),n}toCompact(e,n){const r=n?"test_string_len":On.test_string_len,i=e?this.path.slice(e.path.length):this.path;return this.not?[r,i,this.len,1]:[r,i,this.len]}}class UGe extends Eu{value;ignore_case;constructor(e,n,r){super(e),this.value=n,this.ignore_case=r}op(){return"contains"}code(){return On.contains}test(e){const{val:n}=sr.find(e,this.path);if(typeof n!="string")return!1;const r=this.ignore_case?n.toLowerCase():n,i=this.ignore_case?this.value.toLowerCase():this.value;return r.indexOf(i)>-1}toJson(e){const n={op:"contains",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(n.ignore_case=this.ignore_case),n}toCompact(e,n){const r=n?"contains":On.contains;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class BGe extends Eu{value;ignore_case;constructor(e,n,r){super(e),this.value=n,this.ignore_case=r}op(){return"ends"}code(){return On.ends}test(e){const{val:n}=sr.find(e,this.path);if(typeof n!="string")return!1;const r=this.ignore_case?n.toLowerCase():n,i=this.ignore_case?this.value.toLowerCase():this.value;return r.endsWith(i)}toJson(e){const n={op:"ends",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(n.ignore_case=this.ignore_case),n}toCompact(e,n){const r=n?"ends":On.ends;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class FGe extends Eu{value;ignore_case;constructor(e,n,r){super(e),this.value=n,this.ignore_case=r}op(){return"starts"}code(){return On.starts}test(e){const{val:n}=sr.find(e,this.path);if(typeof n!="string")return!1;const r=this.ignore_case?n.toLowerCase():n,i=this.ignore_case?this.value.toLowerCase():this.value;return r.startsWith(i)}toJson(e){const n={op:"starts",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(n.ignore_case=this.ignore_case),n}toCompact(e,n){const r=n?"starts":On.starts;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class jGe extends Eu{value;constructor(e,n){super(e),this.value=n}op(){return"in"}code(){return On.in}test(e){const{val:n}=sr.find(e,this.path);for(const r of this.value)if(oie.deepEqual(n,r))return!0;return!1}toJson(e){return{op:"in",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,n){return[n?"in":On.in,e?this.path.slice(e.path.length):this.path,this.value]}}class zGe extends Eu{value;constructor(e,n){super(e),this.value=n}op(){return"less"}code(){return On.less}test(e){const{val:n}=sr.find(e,this.path);return typeof n!="number"?!1:n<this.value}toJson(e){return{op:"less",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,n){return[n?"less":On.less,e?this.path.slice(e.path.length):this.path,this.value]}}class VGe extends Eu{value;constructor(e,n){super(e),this.value=n}op(){return"more"}code(){return On.more}test(e){const{val:n}=sr.find(e,this.path);return typeof n!="number"?!1:n>this.value}toJson(e){return{op:"more",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,n){return[n?"more":On.more,e?this.path.slice(e.path.length):this.path,this.value]}}class zU extends Eu{ops;constructor(e,n){super(e),this.ops=n}}class HGe extends zU{ops;constructor(e,n){super(e,n),this.ops=n}op(){return"and"}code(){return On.and}test(e){for(const n of this.ops)if(!n.test(e))return!1;return!0}toJson(e){return{op:"and",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,n){return[n?"and":On.and,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,n))]}}class $Ge extends zU{ops;constructor(e,n){super(e,n),this.ops=n}op(){return"or"}code(){return On.or}test(e){for(const n of this.ops)if(n.test(e))return!0;return!1}toJson(e){return{op:"or",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,n){return[n?"or":On.or,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,n))]}}class GGe extends zU{ops;constructor(e,n){super(e,n),this.ops=n}op(){return"not"}code(){return On.not}test(e){for(const n of this.ops)if(n.test(e))return!1;return!0}toJson(e){return{op:"not",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,n){return[n?"not":On.not,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,n))]}}class WGe extends Eu{value;ignore_case;matcher;constructor(e,n,r,i){super(e),this.value=n,this.ignore_case=r,this.matcher=i(n,r)}op(){return"matches"}code(){return On.matches}test(e){const{val:n}=sr.find(e,this.path);return typeof n!="string"?!1:this.matcher(n)}toJson(e){const n={op:"matches",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(n.ignore_case=this.ignore_case),n}toCompact(e,n){const r=n?"matches":On.matches;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}const{isArray:qGe}=Array;class YGe extends Eu{value;constructor(e,n){super(e),this.value=n}op(){return"type"}code(){return On.type}test(e){const{val:n}=sr.find(e,this.path);return n===null?this.value==="null":qGe(n)?this.value==="array":typeof n===this.value||typeof n=="number"&&n===Math.round(n)&&this.value==="integer"}toJson(e){return{op:"type",path:sr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,n){return[n?"type":On.type,e?this.path.slice(e.path.length):this.path,this.value]}}var gT={},mW;function KGe(){if(mW)return gT;mW=1,Object.defineProperty(gT,"__esModule",{value:!0}),gT.MsgPackDecoderFast=void 0;const t=ys,e=x8(),n=t.__importDefault(Zee()),r=S8();let i=class{constructor(o=new e.Reader,a=n.default){this.reader=o,this.keyDecoder=a}decode(o){return this.reader.reset(o),this.readAny()}read(o){return this.reader.reset(o),this.readAny()}val(){return this.readAny()}readAny(){const o=this.reader,a=o.u8();if(a>=224)return a-256;if(a<=191)return a<144?a<=127?a:this.obj(a&15):a<160?this.arr(a&15):o.utf8(a&31);if(a<=208)return a<=200?a<=196?a<=194?a===194?!1:a===192?null:void 0:a===196?o.buf(o.u8()):!0:a<=198?a===198?o.buf(o.u32()):o.buf(o.u16()):a===200?this.ext(o.u16()):this.ext(o.u8()):a<=204?a<=202?a===202?o.f32():this.ext(o.u32()):a===204?o.u8():o.f64():a<=206?a===206?o.u32():o.u16():a===208?o.i8():o.u32()*4294967296+o.u32();if(a<=216)return a<=212?a<=210?a===210?o.i32():o.i16():a===212?this.ext(1):o.i32()*4294967296+o.u32():a<=214?a===214?this.ext(4):this.ext(2):a===216?this.ext(16):this.ext(8);switch(a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32());case 220:return this.arr(o.u16());case 221:return this.arr(o.u32());case 222:return this.obj(o.u16());case 223:return this.obj(o.u32())}}str(){const o=this.reader,a=o.u8();if(a>>5===5)return o.utf8(a&31);switch(a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32())}}obj(o){const a={};for(let c=0;c<o;c++){const l=this.key();if(l==="__proto__")throw 6;a[l]=this.readAny()}return a}key(){const o=this.reader,a=o.view.getUint8(o.x);if(a>=160&&a<=191){const c=a&31,l=this.keyDecoder.decode(o.uint8,o.x+1,c);return o.x+=1+c,l}else if(a===217){const c=o.view.getUint8(o.x+1);if(c<32){const l=this.keyDecoder.decode(o.uint8,o.x+2,c);return o.x+=2+c,l}}switch(o.x++,a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32());default:return""}}arr(o){const a=[];for(let c=0;c<o;c++)a.push(this.readAny());return a}ext(o){const a=this.reader,c=a.u8(),l=a.x+o,u=a.uint8.subarray(a.x,l);return a.x=l,new r.JsonPackExtension(c,u)}back(o){this.reader.x-=o}};return gT.MsgPackDecoderFast=i,gT}var XGe=KGe();class JGe extends XGe.MsgPackDecoderFast{options;constructor(e){super(),this.options=e}decode(e){return this.reader.reset(e),this.decodePatch()}decodePatch(){const e=this.decodeArrayHeader(),n=[];for(let r=0;r<e;r++)n.push(this.decodeOp(void 0));return n}decodeOp(e){const n=this.decodeArrayHeader();switch(this.reader.u8()){case On.add:{const i=this.decodeArray(),s=this.val();return new jU(i,s)}case On.and:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new HGe(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case On.contains:{const i=this.decodePath(e),s=this.decodeString(),o=n>3;return new UGe(i,s,o)}case On.copy:{const i=this.decodeArray(),s=this.decodeArray();return new bGe(i,s)}case On.defined:{const i=this.decodePath(e);return new OGe(i)}case On.ends:{const i=this.decodePath(e),s=this.decodeString(),o=n>3;return new BGe(i,s,o)}case On.extend:{const i=this.decodeArray(),s=this.decodeObject(),o=n>3;return new MGe(i,s,o)}case On.flip:{const i=this.decodeArray();return new EGe(i)}case On.in:{const i=this.decodePath(e),s=this.decodeArray();return new jGe(i,s)}case On.inc:{const i=this.decodePath(e),s=this.val();return new xGe(i,s)}case On.less:{const i=this.decodePath(e),s=this.val();return new zGe(i,s)}case On.matches:{const i=this.decodePath(e),s=this.decodeString(),o=n>3;return new WGe(i,s,o,this.options.createMatcher||AGe)}case On.merge:{const i=n>3,s=this.decodeArray(),o=this.val(),a=i?this.decodeObject():null;return new RGe(s,o,a)}case On.more:{const i=this.decodePath(e),s=this.val();return new VGe(i,s)}case On.move:{const i=this.decodeArray(),s=this.decodeArray();return new yGe(i,s)}case On.not:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new GGe(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case On.or:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new $Ge(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case On.remove:{const i=this.decodeArray(),o=n>2?this.val():void 0;return new sie(i,o)}case On.replace:{const i=this.decodeArray(),s=this.val(),a=n>3?this.val():void 0;return new vGe(i,s,a)}case On.split:{const i=this.decodeArray(),s=this.val(),a=n>3?this.decodeObject():null;return new CGe(i,s,a)}case On.starts:{const i=n>3,s=this.decodePath(e),o=this.decodeString();return new FGe(s,o,i)}case On.str_del:{const i=n<5,s=this.decodeArray(),o=this.val();if(i){const a=this.decodeString();return new pW(s,o,a,void 0)}else{this.reader.u8();const a=this.val();return new pW(s,o,void 0,a)}}case On.str_ins:{const i=this.decodeArray(),s=this.val(),o=this.decodeString();return new wGe(i,s,o)}case On.test:{const i=n>3,s=this.decodePath(e),o=this.val();return new SGe(s,o,i)}case On.test_string:{const i=n>4,s=this.decodePath(e),o=this.val(),a=this.decodeString();return new DGe(s,o,a,i)}case On.test_string_len:{const i=n>3,s=this.decodePath(e),o=this.val();return new LGe(s,o,i)}case On.test_type:{const i=this.decodePath(e),s=this.decodeArray();return new PGe(i,s)}case On.type:{const i=this.decodePath(e),s=this.decodeString();return new YGe(i,s)}case On.undefined:{const i=this.decodePath(e);return new IGe(i)}}throw new Error("OP_UNKNOWN")}decodePath(e){const n=this.decodeArray();return e?[...e.path,...n]:n}decodeObject(){const e=this.reader,n=e.u8();return n<=191?this.obj(n&15):n===222?this.obj(e.u16()):this.obj(e.u32())}decodeArray(){const e=this.reader,n=e.u8();return n<159?this.arr(n&15):n===220?this.arr(e.u16()):this.arr(e.u32())}decodeArrayHeader(){const e=this.reader,n=e.u8();return n<159?n&15:n===220?e.u16():e.u32()}decodeString(){const e=this.reader,n=e.u8();return n<=191?e.utf8(n&31):n===217?e.utf8(e.u8()):n===218?e.utf8(e.u16()):e.utf8(e.u32())}}function ZGe(t){const e=[],n=t.length;for(let r=0;r<n;r++)e.push(t[r].toJson());return e}var aie=(t=>(t[t.id=0]="id",t[t.x=1]="x",t[t.y=2]="y",t[t.char=3]="char",t[t.color=4]="color",t[t.bg=5]="bg",t[t.stat=6]="stat",t[t.pid=7]="pid",t))(aie||{});function QGe(t){return Z5(t,aie)}var cie=(t=>(t[t.id=0]="id",t[t.type=1]="type",t[t.tag=2]="tag",t[t.width=3]="width",t[t.height=4]="height",t[t.char=5]="char",t[t.color=6]="color",t[t.bg=7]="bg",t[t.stats=8]="stats",t[t.sprites=9]="sprites",t[t.alphas=10]="alphas",t[t.mime=11]="mime",t[t.media=12]="media",t[t.focusx=13]="focusx",t[t.focusy=14]="focusy",t[t.focusid=15]="focusid",t[t.viewscale=16]="viewscale",t[t.graphics=17]="graphics",t[t.facing=18]="facing",t))(cie||{});function eWe(t){return Z5(t,cie,{sprites:e=>e.map(QGe)})}var lie=(t=>(t[t.id=0]="id",t[t.board=1]="board",t[t.over=2]="over",t[t.under=3]="under",t[t.layers=4]="layers",t[t.tickers=5]="tickers",t[t.scrollname=6]="scrollname",t[t.scroll=7]="scroll",t[t.sidebar=8]="sidebar",t[t.synthstate=9]="synthstate",t))(lie||{});function gW(t){return Z5(t,lie,{layers:e=>e.map(eWe)})}const tWe=new JGe({}),_W=Ym("gadgetclient",[],t=>{if(!_W.session(t)||t.player!==ii())return;const{desync:e}=Kr.getState();switch(t.target){case"paint":{const n=gW(t.data);Kr.setState({desync:!1,gadget:n,slim:t.data});break}case"patch":e||Kr.setState(n=>{let r;try{const i=tWe.decode(t.data),s=ZGe(i),o=AO(Ts(n.slim),s,!0,!0),a=gW(o.newDocument);return{...n,gadget:a,layercache:{...n.layercache,[a?.board??""]:a?.layers??[]},slim:o.newDocument}}catch(i){r=i}return fe(r)?(_W.reply(t,"desync"),{...n,desync:!0}):n});break}}),VU=Object.prototype.toString.call(typeof sf<"u"?sf:0)==="[object process]";var W_,Ar;(function(t){t[t.CRITICAL=0]="CRITICAL",t[t.ERROR=1]="ERROR",t[t.WARNING=2]="WARNING",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t[t.TRACE=7]="TRACE"})(Ar||(Ar={}));function HU(t){if(typeof t=="number"){if(Object.prototype.hasOwnProperty.call(Ar,t))return t;var e=Object.keys(Ar).map(function(r){return parseInt(r,10)}).filter(function(r){return!isNaN(r)&&r<t});return e.length?Math.max.apply(Math,e):Ar.WARNING}var n=t.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(Ar,n))throw new Error("Unknown log level string: ".concat(t));return Ar[n]}var nWe=VU?console.log.bind(console):console.debug.bind(console),uie=(W_={},W_[Ar.CRITICAL]=console.error.bind(console),W_[Ar.ERROR]=console.error.bind(console),W_[Ar.WARNING]=console.warn.bind(console),W_[Ar.INFO]=console.info.bind(console),W_[Ar.DEBUG]=nWe.bind(console),W_[Ar.TRACE]=console.trace.bind(console),W_);function Uv(t){return function(e,n){Object.defineProperty(e,n,{get:function(){},set:function(r){Object.defineProperty(this,n,{value:r,writable:!0,enumerable:t})},enumerable:t})}}function A4(t){return oo(this,void 0,Promise,function(){return cC(this,function(e){switch(e.label){case 0:return typeof t!="function"?[3,2]:[4,t()];case 1:return[2,e.sent()];case 2:return[2,t]}})})}function rWe(t){return typeof t=="function"?t():t}function hie(t){var e,n,r;return cC(this,function(i){switch(i.label){case 0:e=0,n=1,i.label=1;case 1:return e<t?[4,e]:[3,3];case 2:return i.sent(),r=ib([n,e+n],2),e=r[0],n=r[1],[3,1];case 3:return[4,t];case 4:return i.sent(),[3,3];case 5:return[2]}})}function tk(t,e){return Object.assign.apply(Object,_A([{}],ib(t.map(e)),!1))}function C4(t,e){Object.entries(t).forEach(function(n){var r=ib(n,2),i=r[0],s=r[1];return e(s,i)})}function fie(t){return t==null}function OA(t,e){return fie(t)?null:e(t)}function die(t,e){return fie(t)?void 0:e(t)}function iWe(t){return oo(this,void 0,Promise,function(){return cC(this,function(e){switch(e.label){case 0:return[4,new Promise(function(n){return setTimeout(n,t)})];case 1:return e.sent(),[2]}})})}function R4(){var t,e,n=new Promise(function(r,i){t=r,e=i});return{promise:n,resolve:t,reject:e}}function sWe(t,e,n){if(typeof t=="number"&&(t=t.toString()),e=e-t.length,e<=0)return t;n===void 0&&(n=" ");var r="";do(e&1)===1&&(r+=n),e>>=1,e&&(n+=n);while(e);return r+t}function A1(t,e,n){var r=t.split(e);return r.length<=n?r:_A(_A([],ib(r.slice(0,n-1)),!1),[r.slice(n-1).join(e)],!1)}var oWe={},rD,iD,aO=typeof sf>"u"?[]:(iD=(rD=oWe.LOGGING)===null||rD===void 0?void 0:rD.split(";").map(function(t){var e=t.split("=",2),n=e[0],r=e[1];return r?[n==="default"?void 0:n.split(":"),HU(r)]:null}).filter(function(t){return!!t}).sort(function(t,e){var n,r,i=t[0],s=e[0];return((n=s?.length)!==null&&n!==void 0?n:0)-((r=i?.length)!==null&&r!==void 0?r:0)}))!==null&&iD!==void 0?iD:[],sD=aO.findIndex(function(t){var e=t[0];return!e}),pie=void 0;sD!==-1&&(pie=aO[sD][1],aO.splice(sD));function aWe(t,e){return e.length<=t.length&&e.every(function(n,r){return n===t[r]})}function mie(t){for(var e=t.split(":"),n=0,r=aO;n<r.length;n++){var i=r[n],s=i[0],o=i[1];if(aWe(e,s))return o}return pie}var gie=(function(){function t(e){var n=e.name,r=e.minLevel,i=e.emoji,s=i===void 0?!1:i,o=e.colors,a=e.timestamps,c=a===void 0?VU:a,l,u;this._name=n,this._minLevel=(u=(l=die(r,function(h){return HU(h)}))!==null&&l!==void 0?l:mie(n))!==null&&u!==void 0?u:Ar.WARNING,this._emoji=s,this._colors=o,this._timestamps=c}return t.prototype.crit=function(e){this.log(Ar.CRITICAL,e)},t.prototype.error=function(e){this.log(Ar.ERROR,e)},t.prototype.warn=function(e){this.log(Ar.WARNING,e)},t.prototype.info=function(e){this.log(Ar.INFO,e)},t.prototype.debug=function(e){this.log(Ar.DEBUG,e)},t.prototype.trace=function(e){this.log(Ar.TRACE,e)},t})(),cWe=(function(t){eI(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){if(!(n>this._minLevel)){var i=uie[n],s="[".concat(this._name,"] ").concat(r);this._timestamps&&(s="[".concat(new Date().toISOString(),"] ").concat(r)),i(s)}},e})(gie),lWe=(function(){function t(e){var n=e.name,r=e.minLevel,i=e.custom,s;this._minLevel=(s=die(r,function(o){return HU(o)}))!==null&&s!==void 0?s:mie(n),this._override=typeof i=="function"?{log:i}:i}return t.prototype.log=function(e,n){this._shouldLog(e)&&this._override.log(e,n)},t.prototype.crit=function(e){this._override.crit?this._shouldLog(Ar.CRITICAL)&&this._override.crit(e):this.log(Ar.CRITICAL,e)},t.prototype.error=function(e){this._override.error?this._shouldLog(Ar.ERROR)&&this._override.error(e):this.log(Ar.ERROR,e)},t.prototype.warn=function(e){this._override.warn?this._shouldLog(Ar.WARNING)&&this._override.warn(e):this.log(Ar.WARNING,e)},t.prototype.info=function(e){this._override.info?this._shouldLog(Ar.INFO)&&this._override.info(e):this.log(Ar.INFO,e)},t.prototype.debug=function(e){this._override.debug?this._shouldLog(Ar.DEBUG)&&this._override.debug(e):this.log(Ar.DEBUG,e)},t.prototype.trace=function(e){this._override.trace?this._shouldLog(Ar.TRACE)&&this._override.trace(e):this.log(Ar.TRACE,e)},t.prototype._shouldLog=function(e){return this._minLevel===void 0||this._minLevel>=e},t})(),q_,Y_,K_,uWe=(q_={},q_[Ar.CRITICAL]="",q_[Ar.ERROR]="",q_[Ar.WARNING]=" ",q_[Ar.INFO]=" ",q_[Ar.DEBUG]="",q_[Ar.TRACE]="",q_),hWe={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},fWe={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function qI(t,e,n){return function(r){return"\x1B[".concat(t,"m").concat(n?n(r):r,"\x1B[").concat(e,"m")}}function Tm(t){return qI(hWe[t],39)}function _T(t,e){return qI(fWe[t],49,e)}var dWe=(Y_={},Y_[Ar.CRITICAL]=Tm("red"),Y_[Ar.ERROR]=Tm("redBright"),Y_[Ar.WARNING]=Tm("yellow"),Y_[Ar.INFO]=Tm("blue"),Y_[Ar.DEBUG]=Tm("magenta"),Y_[Ar.TRACE]=qI(0,0),Y_),vW=(K_={},K_[Ar.CRITICAL]=_T("bgRed",Tm("white")),K_[Ar.ERROR]=_T("bgRedBright",Tm("white")),K_[Ar.WARNING]=_T("bgYellow",Tm("black")),K_[Ar.INFO]=_T("bgBlue",Tm("white")),K_[Ar.DEBUG]=_T("bgMagenta",Tm("black")),K_[Ar.TRACE]=qI(7,27),K_),pWe=(function(t){eI(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){var i,s,o;if(!(n>this._minLevel)){var a=uie[n],c="";if(this._timestamps&&(c+="[".concat(new Date().toISOString(),"] ")),this._emoji){var l=uWe[n];c+="".concat(l," ")}var u=(o=(i=this._colors)!==null&&i!==void 0?i:(s=sf.stdout)===null||s===void 0?void 0:s.isTTY)!==null&&o!==void 0?o:!0;u?c+="".concat(vW[n](this._name)," ").concat(vW[n](Ar[n])," ").concat(dWe[n](r)):c+="[".concat(this._name,":").concat(Ar[n].toLowerCase(),"] ").concat(r),a(c)}},e})(gie);function YI(t){return t.custom?new lWe(t):VU?new pWe(t):new cWe(t)}let _ie=class extends Error{constructor(...e){var n;super(...e),Object.setPrototypeOf(this,new.target.prototype),(n=Error.captureStackTrace)===null||n===void 0||n.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}};class cO extends _ie{}class vie extends _ie{}class mWe{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=YI({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i,this._partitionKeyCallback=s}async request(e,n){return await new Promise((r,i)=>{var s,o;if(this._destroyed){i(new cO("Rate limiter was destroyed"));return}const a={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n?.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"},c=this._partitionKeyCallback(e),l=(o=this._usedFromBucket.get(c))!==null&&o!==void 0?o:0;if(l>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{const u=this._getPartitionedQueue(c);u.push(a),l+u.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${u.length}`):this._logger.info(`Enqueueing request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused; queue size is ${u.length}`);break}case"null":{a.resolve(null),this._paused?this._logger.info(`Returning null for request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{a.reject(new vie(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${c?`partition ${c}`:"default partition"} was reached`}`));break}default:throw new Error("this should never happen")}else this._runRequest(a,c)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach(e=>{clearTimeout(e)});for(const e of this._partitionedQueue.values())for(const n of e)n.reject(new cO("Rate limiter was destroyed"));this._partitionedQueue.clear()}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const n=[];return this._partitionedQueue.set(e,n),n}async _runRequest(e,n){var r;const i=this._getPartitionedQueue(n);this._logger.debug(`doing a request for ${n?`partition ${n}`:"default partition"}, new queue length is ${i.length}`),this._usedFromBucket.set(n,((r=this._usedFromBucket.get(n))!==null&&r!==void 0?r:0)+1);const{req:s,resolve:o,reject:a}=e;try{o(await this._callback(s))}catch(c){a(c)}finally{const c=setTimeout(()=>{this._counterTimers.delete(c);const l=this._usedFromBucket.get(n)-1;this._usedFromBucket.set(n,l),i.length&&l<this._bucketSize&&this._runNextRequest(n)},this._timeFrame);this._counterTimers.add(c)}}_runNextRequest(e){if(this._paused)return;const r=this._getPartitionedQueue(e).shift();r&&this._runRequest(r,e)}}class k4{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i}){this._queue=[],this._usedFromBucket=0,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=YI({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i}async request(e,n){return await new Promise((r,i)=>{var s;if(this._destroyed){i(new cO("Rate limiter was destroyed"));return}const o={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n?.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(o.limitReachedBehavior){case"enqueue":{this._queue.push(o),this._usedFromBucket+this._queue.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`):this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{o.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused?this._logger.info("Returning null for request because the rate limiter is paused"):this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{o.reject(new vie(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw new Error("this should never happen")}else this._runRequest(o)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach(e=>{clearTimeout(e)});for(const e of this._queue)e.reject(new cO("Rate limiter was destroyed"));this._queue=[]}async _runRequest(e){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;const{req:n,resolve:r,reject:i}=e;try{r(await this._callback(n))}catch(s){i(s)}finally{const s=setTimeout(()=>{this._counterTimers.delete(s),this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize&&this._runNextRequest()},this._timeFrame);this._counterTimers.add(s)}}_runNextRequest(){if(this._paused)return;const e=this._queue.shift();e&&this._runRequest(e)}}class gWe extends k4{constructor(e,n){super({...n,async doRequest(r,i){return await e.request(r,i)}})}}class _We{constructor(e,n,r,i=!1){this.owner=e,this.event=n,this.listener=r,this._internal=i}unbind(){this.owner.removeListener(this)}}class IC{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,n){return this._addListener(!1,e,n)}addListener(e,n){return this._addListener(!1,e,n)}removeListener(e,n){this._removeListener(!1,e,n)}registerEvent(){const e=n=>this.addListener(e,n);return e}emit(e,...n){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...n);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...n)}registerInternalEvent(){const e=n=>this.addInternalListener(e,n);return e}addInternalListener(e,n){return this._addListener(!0,e,n)}removeInternalListener(e,n){this._removeListener(!0,e,n)}_addListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;return i.has(n)?i.get(n).push(r):i.set(n,[r]),new _We(this,n,r,e)}_removeListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;if(!n)i.clear();else if(typeof n=="object"){const s=n;this._removeListener(s._internal,s.event,s.listener)}else{const s=n;if(i.has(s))if(r){const o=i.get(s);let a=0;for(;(a=o.indexOf(r))!==-1;)o.splice(a,1)}else i.delete(s)}}}const vWe=6e4;function yWe(t){return OA(t.expiresIn,e=>t.obtainmentTimestamp+e*1e3-vWe)}function Uk(t){return OA(yWe(t),e=>Date.now()>e)??!1}const n1=Symbol("twurpleRawData");class bWe{[n1];constructor(e){this[n1]=e}}var SWe={};function EWe(){try{return SWe.TWURPLE_MOCK_API_PORT??null}catch{try{return null}catch{return null}}}function yie(t){if(!t)return"";const e=new URLSearchParams;for(const[r,i]of Object.entries(t))if(i===null)e.append(r,"");else if(Array.isArray(i))for(const s of i)e.append(r,s.toString());else i!==void 0&&e.append(r,i.toString());const n=e.toString();return n?`?${n}`:""}class db extends Error{constructor(e,n){super(e,n),Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace?.(this,new.target.constructor)}get name(){return this.constructor.name}}function bie(t,e,n){return r=>{const i=function(){return`[${e}#${this[n]} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class yW extends db{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}function lg(t){return typeof t=="string"?t:typeof t=="number"?t.toString(10):t.id}class Sie extends db{_statusCode;_url;_method;_body;constructor(e,n,r,i,s,o){super(`Encountered HTTP status code ${e}: ${n}

URL: ${r}
Method: ${i}
Body:
${!o&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=i,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function xWe(t,e){if(!t.ok){const n=t.headers.get("Content-Type")==="application/json",r=n?JSON.stringify(await t.json(),null,2):await t.text(),i=yie(e.query),s=`${e.url}${i}`;throw new Sie(t.status,t.statusText,s,e.method??"GET",r,n)}}async function wWe(t){if(t.status===204)return;const e=await t.text();if(e)return JSON.parse(e)}function TWe(t,e){const n=EWe();switch(e){case"helix":{const r=t.replace(/^\//,"");return n?r==="eventsub/subscriptions"?`http://localhost:${n}/${r}`:`http://localhost:${n}/mock/${r}`:`https://api.twitch.tv/helix/${r}`}case"auth":{const r=t.replace(/^\//,"");return n?`http://localhost:${n}/auth/${r}`:`https://id.twitch.tv/oauth2/${r}`}case"custom":return t;default:return t}}async function AWe(t,e,n,r,i={}){const s=t.type??"helix",o=TWe(t.url,s),a=yie(t.query),c=new Headers({Accept:"application/json"});let l;t.jsonBody&&(l=JSON.stringify(t.jsonBody),c.append("Content-Type","application/json")),e&&s!=="auth"&&c.append("Client-ID",e),n&&c.append("Authorization",`${s==="helix"?"Bearer":"OAuth"} ${n}`);const u={...i,method:t.method??"GET",headers:c,body:l};return await fetch(`${o}${a}`,u)}async function KI(t,e,n,r,i={}){const s=await AWe(t,e,n,r,i);return await xWe(s,t),await wWe(s)}class mE extends db{constructor(e){super("Invalid token supplied",e)}}class Bk extends db{}function CWe(t,e,n,r){return{grant_type:"authorization_code",client_id:t,client_secret:e,code:n,redirect_uri:r}}function RWe(t,e){return{grant_type:"client_credentials",client_id:t,client_secret:e}}function kWe(t,e,n){return{grant_type:"refresh_token",client_id:t,client_secret:e,refresh_token:n}}let M4=class extends bWe{_obtainmentDate;constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[n1].client_id}get userId(){return this[n1].user_id??null}get userName(){return this[n1].login??null}get scopes(){return this[n1].scopes}get expiryDate(){return OA(this[n1].expires_in,e=>new Date(this._obtainmentDate.getTime()+e*1e3))}};M4=Vs([bie("auth","TokenInfo","clientId")],M4);function $U(t){return{accessToken:t.access_token,refreshToken:t.refresh_token||null,scope:t.scope??[],expiresIn:t.expires_in??null,obtainmentTimestamp:Date.now()}}async function MWe(t,e,n,r){return $U(await KI({type:"auth",url:"token",method:"POST",query:CWe(t,e,n,r)}))}async function OWe(t,e){return $U(await KI({type:"auth",url:"token",method:"POST",query:RWe(t,e)}))}async function bW(t,e,n){return $U(await KI({type:"auth",url:"token",method:"POST",query:kWe(t,e,n)}))}async function IA(t,e){try{const n=await KI({type:"auth",url:"validate"},e,t);return new M4(n)}catch(n){throw n instanceof Sie&&n.statusCode===401?new mE({cause:n}):n}}const IWe=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function NWe(t,e){if(e?.length){const n=new Set(t.flatMap(r=>[r,...IWe.get(r)??[]]));if(e.every(r=>!n.has(r))){const r=e.join(", ");throw new Error(`This token does not have any of the requested scopes (${r}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function Fk(t,e){for(const n of e)NWe(t,n)}async function PWe(t,e,n,r,i){if(i?.length||!n){const s=await IA(e,t);if(!s.userId)throw new Error("Trying to use an app access token as a user access token");const o=r??s.scopes;return i&&Fk(o,i.filter(a=>!!a)),[o,s.userId]}return[r,n]}class SW{_executor;_newTokenScopeSets=[];_newTokenPromise=null;_queuedScopeSets=[];_queueExecutor=null;_queuePromise=null;constructor(e){this._executor=e}async fetch(...e){const n=e.filter(o=>!!o);if(this._newTokenPromise){if(!n.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...n):this._queuedScopeSets=[...n],!this._queuePromise){const{promise:o,resolve:a,reject:c}=R4();this._queuePromise=o,this._queueExecutor=async()=>{if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{a(await this._executor(this._newTokenScopeSets))}catch(l){c(l)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],this._queueExecutor?.()}}}}return await this._queuePromise}this._newTokenScopeSets=[...n];const{promise:r,resolve:i,reject:s}=R4();this._newTokenPromise=r;try{i(await this._executor(this._newTokenScopeSets))}catch(o){s(o)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],this._queueExecutor?.()}return await r}}class EW extends db{userId;constructor(e){super(`The user context for the user ${e} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class DWe extends db{userId;constructor(e){super(`User ${e} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class LWe extends db{intent;constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}let wv=class extends IC{_clientId;_clientSecret;_redirectUri;_userAccessTokens=new Map;_userTokenFetchers=new Map;_intentToUserId=new Map;_userIdToIntents=new Map;_cachedRefreshFailures=new Set;_appAccessToken;_appTokenFetcher;_appImpliedScopes;onRefresh=this.registerEvent();onRefreshFailure=this.registerEvent();constructor(e){super(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=e.appImpliedScopes??[],this._appTokenFetcher=new SW(async n=>await this._fetchAppToken(n))}addUser(e,n,r){const i=lg(e);if(!n.refreshToken)throw new Error(`Trying to add user ${i} without refresh token`);this._cachedRefreshFailures.delete(i),this._userAccessTokens.set(i,{...n,userId:i}),this._userTokenFetchers.has(i)||this._userTokenFetchers.set(i,new SW(async s=>await this._fetchUserToken(i,s))),r&&this.addIntentsToUser(e,r)}async addUserForToken(e,n){let r=null;if(e.accessToken&&!Uk(e))try{const a=await IA(e.accessToken);r=[e,a]}catch(a){if(!(a instanceof mE))throw a}if(!r){if(!e.refreshToken)throw new mE;const a=await bW(this._clientId,this._clientSecret,e.refreshToken),c=await IA(a.accessToken);this.emit(this.onRefresh,c.userId,a),r=[a,c]}const[i,s]=r;if(!s.userId)throw new Bk("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const o=i.scope?i:{...i,scope:s.scopes};return this.addUser(s.userId,o,n),s.userId}async addUserForCode(e,n){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const r=await MWe(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(r,n)}hasUser(e){return this._userTokenFetchers.has(lg(e))}removeUser(e){const n=lg(e);if(this._userIdToIntents.has(n)){const r=this._userIdToIntents.get(n);for(const i of r)this._intentToUserId.delete(i);this._userIdToIntents.delete(n)}this._userAccessTokens.delete(n),this._userTokenFetchers.delete(n),this._cachedRefreshFailures.delete(n)}addIntentsToUser(e,n){const r=lg(e);if(!this._userAccessTokens.has(r))throw new Error("Trying to add intents to a user that was not added to this provider");for(const i of n)this._intentToUserId.has(i)&&this._userIdToIntents.get(this._intentToUserId.get(i)).delete(i),this._intentToUserId.set(i,r),this._userIdToIntents.has(r)?this._userIdToIntents.get(r).add(i):this._userIdToIntents.set(r,new Set([i]))}getIntentsForUser(e){const n=lg(e);return this._userIdToIntents.has(n)?Array.from(this._userIdToIntents.get(n)):[]}removeIntents(e){for(const n of e)if(this._intentToUserId.has(n)){const r=this._intentToUserId.get(n);this._userIdToIntents.get(r)?.delete(n),this._intentToUserId.delete(n)}}async refreshAccessTokenForUser(e){const n=lg(e);if(this._cachedRefreshFailures.has(n))throw new EW(n);const r=this._userAccessTokens.get(n);if(!r)throw new Error("Trying to refresh token for user that was not added to the provider");const i=await this._refreshUserTokenWithCallback(n,r.refreshToken);return this._checkIntermediateUserRemoval(n),this._userAccessTokens.set(n,{...i,userId:n}),this.emit(this.onRefresh,n,i),{...i,userId:n}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new LWe(e);const n=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(n)}get clientId(){return this._clientId}getCurrentScopesForUser(e){const n=this._userAccessTokens.get(lg(e));if(!n)throw new Error("Trying to get scopes for user that was not added to the provider");return n.scope??[]}async getAccessTokenForUser(e,...n){const r=lg(e),i=this._userTokenFetchers.get(r);if(!i)return null;if(this._cachedRefreshFailures.has(r))throw new EW(r);return Fk(this.getCurrentScopesForUser(r),n.filter(Boolean)),await i.fetch(...n)}async getAccessTokenForIntent(e,...n){if(!this._intentToUserId.has(e))return null;const r=this._intentToUserId.get(e),i=await this.getAccessTokenForUser(r,...n);if(!i)throw new yW(`Found intent ${e} corresponding to user ID ${r} but no token was found`);return{...i,userId:r}}async getAnyAccessToken(e){if(e){const n=lg(e);if(this._userAccessTokens.has(n)){const r=await this.getAccessTokenForUser(n);if(!r)throw new yW(`Token for user ID ${n} exists but nothing was returned by getAccessTokenForUser`);return{...r,userId:n}}}return await this.getAppAccessToken()}async getAppAccessToken(e=!1){return e&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(n=>[n]))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new DWe(e)}async _fetchUserToken(e,n){const r=this._userAccessTokens.get(e);if(!r)throw new Error("Trying to get token for user that was not added to the provider");if(r.accessToken&&!Uk(r))try{if(r.scope)return Fk(r.scope,n),r;const[s=[]]=await PWe(this._clientId,r.accessToken,e,r.scope,n),o={...r,scope:s};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,o),o}catch(s){if(!(s instanceof mE))throw s}this._checkIntermediateUserRemoval(e);const i=await this.refreshAccessTokenForUser(e);return Fk(i.scope,n),i}async _refreshUserTokenWithCallback(e,n){try{return await bW(this.clientId,this._clientSecret,n)}catch(r){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e,r),r}}async _fetchAppToken(e){if(e.length>0)for(const n of e)if(this._appImpliedScopes.length){if(n.every(r=>!this._appImpliedScopes.includes(r)))throw new Error(`One of the scopes ${n.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw new Error(`One of the scopes ${n.join(", ")} requested but the client credentials flow does not support scopes`);return!this._appAccessToken||Uk(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await OWe(this._clientId,this._clientSecret)}};Vs([Uv(!1)],wv.prototype,"_clientSecret",void 0);Vs([Uv(!1)],wv.prototype,"_userAccessTokens",void 0);Vs([Uv(!1)],wv.prototype,"_userTokenFetchers",void 0);Vs([Uv(!1)],wv.prototype,"_appAccessToken",void 0);Vs([Uv(!1)],wv.prototype,"_appTokenFetcher",void 0);wv=Vs([bie("auth","RefreshingAuthProvider","clientId")],wv);function GU(t,e,n){return r=>{const i=n?function(){return`[${e}#${this[n]} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`}:function(){return`[${e} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class UWe extends IC{constructor({lineBased:e,logger:n,additionalOptions:r}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=e??!1,this._logger=n,this._additionalOptions=r}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r
`))}assumeExternalDisconnect(){var e;(e=this._logger)===null||e===void 0||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var n,r;if(!this._lineBased){this.emit(this.onReceive,e);return}const i=e.split(`\r
`);if(this._currentLine+=(n=i.shift())!==null&&n!==void 0?n:"",i.length){this.emit(this.onReceive,this._currentLine),this._currentLine=(r=i.pop())!==null&&r!==void 0?r:"";for(const s of i)this.emit(this.onReceive,s)}}}class BWe{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}class FWe extends IC{constructor(e,n,r={}){var i;super(),this._type=e,this._target=n,this._config=r,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(i=r.retryLimit)!==null&&i!==void 0?i:1/0,this._logger=r.logger}get isConnected(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnected)!==null&&n!==void 0?n:!1}get isConnecting(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnecting)!==null&&n!==void 0?n:this._connecting}get hasSocket(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.hasSocket)!==null&&n!==void 0?n:!1}sendLine(e){var n;(n=this._currentConnection)===null||n===void 0||n.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if((e=this._logger)===null||e===void 0||e.trace(`PersistentConnection disconnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const n=this._currentConnection;this._currentConnection=void 0,n.disconnect()}}assumeExternalDisconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("PersistentConnection assumeExternalDisconnect"),(n=this._currentConnection)===null||n===void 0||n.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(e=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(e=!1){var n,r;(n=this._logger)===null||n===void 0||n.trace(`PersistentConnection tryConnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;(r=this._retryTimerGenerator)!==null&&r!==void 0||(this._retryTimerGenerator=hie(120));const s=this._currentConnection=new this._type(rWe(this._target),this._config);s.onReceive(o=>this.emit(this.onReceive,o)),s.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),s.onDisconnect((o,a)=>{var c,l,u;if(this.emit(this.onDisconnect,o,a),o)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,s.disconnect(),this._currentConnection===s&&(this._currentConnection=void 0),this._previousConnection===s&&(this._previousConnection=void 0);else if(this._connecting){if((c=this._logger)===null||c===void 0||c.debug(`Connection error caught: ${(l=a?.message)!==null&&l!==void 0?l:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const h=this._retryTimerGenerator.next().value;h!==0&&((u=this._logger)===null||u===void 0||u.info(`Retrying in ${h} seconds`)),setTimeout(()=>{var f;this._connecting&&((f=this._logger)===null||f===void 0||f.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())},h*1e3)}else this._reconnect()}),s.connect()}_reconnect(e=!1){e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}var KS=null;typeof WebSocket<"u"?KS=WebSocket:typeof MozWebSocket<"u"?KS=MozWebSocket:typeof a1<"u"?KS=a1.WebSocket||a1.MozWebSocket:typeof window<"u"?KS=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(KS=self.WebSocket||self.MozWebSocket);class jWe extends UWe{constructor(e,n){if(super(n),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else if(e.url)this._url=e.url;else throw new Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(e){var n;(n=this._socket)===null||n===void 0||n.send(e)}connect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new KS(this._url,(n=this._additionalOptions)===null||n===void 0?void 0:n.wsOptions),this._socket.onopen=()=>{var r;(r=this._logger)===null||r===void 0||r.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:r})=>{this.receiveRaw(r.toString())},this._socket.onerror=r=>{var i;(i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onError message:${r.message}`)},this._socket.onclose=r=>{var i;const s=this._connected,o=this._connecting;if((i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onClose wasConnected:${s.toString()} wasConnecting:${o.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${r.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const a=new Error(`[${r.code}] ${r.reason}`);this.emit(this.onDisconnect,!1,a),this.emit(this.onEnd,!1,a)}this.clearSocket()}}disconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(n=this._socket)===null||n===void 0||n.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}function GT(t){var e,n,r;if(Array.isArray(t)){for(n=Array(e=t.length);e--;)n[e]=(r=t[e])&&typeof r=="object"?GT(r):r;return n}if(Object.prototype.toString.call(t)==="[object Object]"){n={};for(e in t)e==="__proto__"?Object.defineProperty(n,e,{value:GT(t[e]),configurable:!0,enumerable:!0,writable:!0}):n[e]=(r=t[e])&&typeof r=="object"?GT(r):r;return n}return t}const zWe={name:"away-notify"};class lO extends Error{constructor(e,n,r){super(`command "${e}" expected ${n} or more parameters, got ${r}`),this._command=e,this._expectedParams=n,this._actualParams=r,Object.setPrototypeOf(this,lO.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lO)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class uO extends Error{constructor(e,n,r,i){var s;super(`required parameter "${n}" did not validate against ${(s=r.type)!==null&&s!==void 0?s:"regex"} validation: "${i}"`),this._command=e,this._paramName=n,this._paramSpec=r,this._givenValue=i,Object.setPrototypeOf(this,uO.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,uO)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const gE={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var oD={exports:{}},xW;function VWe(){return xW||(xW=1,(function(t){t.exports=e=>{if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},t.exports.default=t.exports})(oD)),oD.exports}var HWe=VWe();const $We=_u(HWe);function O4(t,e="#&"){return new RegExp(`^[${$We(e)}][^ \b\0
\r,]+$`).test(t)}const wW={0:"\0",n:`
`,r:"\r","":""};function TW(t){if(!t.startsWith("")||(t=t.substring(1),t.endsWith("")&&(t=t.slice(0,-1)),!t))return!1;t=t.replace(/\x10(.)/,(r,i)=>i in wW?wW[i]:"");let[e,n=""]=A1(t," ",2);return e=e?e.toUpperCase():"",{command:e,params:n}}const GWe={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function WWe(t){return t.replace(/[\\;\n\r ]/g,e=>`\\${GWe[e]}`)}function qWe(t){let e=`${t.nick}`;return t.user&&(e+=`!${t.user}`),t.host&&(e+=`@${t.host}`),e}function YWe(t,e,n,r,i=gE,s=!1){const o=new t(t.COMMAND,void 0,{serverProperties:i}),a={};if(o._paramSpec&&C4(o._paramSpec,(c,l)=>{if(!(s&&c.noServer)&&!(!s&&c.noClient)){if(l in e){const u=e[l];if(u!==void 0){if(t.checkParam(u,c,i))a[l]={value:u,trailing:!!c.trailing};else if(!c.optional)throw new Error(`required parameter "${l}" did not suit requirements: "${u}"`)}}if(!(l in a)&&!c.optional)throw new Error(`required parameter "${l}" not found in command "${t.COMMAND}"`)}}),o._parsedParams=a,o._paramSpec)for(const c of Object.keys(o._paramSpec))Object.defineProperty(o,c,{get(){var l,u;return(u=(l=this._parsedParams)===null||l===void 0?void 0:l[c])===null||u===void 0?void 0:u.value}});return o._initPrefixAndTags(n,r),o}class cn{static checkParam(e,n,r=gE){return!(n.type==="channel"&&!O4(e,r.channelTypes)||n.type==="channelList"&&!e.split(",").every(s=>O4(s,r.channelTypes))||n.match&&!n.match.test(e))}constructor(e,{params:n,tags:r,prefix:i,rawLine:s}={},{serverProperties:o=gE,isServer:a=!1,shouldParseParams:c=!0}={},l){this._params=[],this._serverProperties=gE,this._paramSpec=l,this._command=e,this._params=n,this._tags=r??new Map,this._prefix=i,this._serverProperties=o,this._raw=s,c&&this.parseParams(a)}getMinParamCount(e=!1){return this._paramSpec?Object.values(this._paramSpec).filter(n=>n.noServer&&e||n.noClient&&!e?!1:!n.optional).length:0}get paramCount(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.length)!==null&&n!==void 0?n:0}prefixToString(){return this._prefix?qWe(this._prefix):""}tagsToString(){return[...this._tags.entries()].map(([e,n])=>n?`${e}=${WWe(n)}`:e).join(";")}toString(e=!1,n=!1){const i=[n?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const o=this.prefixToString();o&&i.unshift(`:${o}`)}const s=this.tagsToString();return s&&i.unshift(`@${s}`),i.join(" ")}_initPrefixAndTags(e,n){this._prefix=e,n&&(this._tags=n)}parseParams(e=!1){if(this._params){let n=this.getMinParamCount(e);if(n>this._params.length)throw new lO(this._command,n,this._params.length);const r=this._paramSpec;if(!r)return;let i=0;const s={};for(const[o,a]of Object.entries(r)){if(a.noServer&&e||a.noClient&&!e)continue;if(this._params.length-i<=n){if(a.optional)continue;if(this._params.length-i!==n)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let c=this._params[i];if(!c){if(a.optional)break;throw new Error("unexpected parameter underflow")}if(a.rest){const l=[];for(;this._params[i]&&!this._params[i].trailing;)l.push(this._params[i].value),++i;if(!l.length){if(a.optional)continue;throw new Error(`no parameters left for required rest parameter "${o}"`)}c={value:l.join(" "),trailing:!1}}if(cn.checkParam(c.value,a))s[o]={...c},a.optional||--n,a.rest||++i;else if(!a.optional)throw new uO(this._command,o,a,c.value);if(a.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const o of Object.keys(this._paramSpec))Object.defineProperty(this,o,{get(){var a,c;return(c=(a=this._parsedParams)===null||a===void 0?void 0:a[o])===null||c===void 0?void 0:c.value}})}}get rawParamValues(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>r.value))!==null&&n!==void 0?n:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map(n=>{var r;const i=(r=this._parsedParams)===null||r===void 0?void 0:r[n];if(i)return(i.trailing?":":"")+i.value}).filter(n=>n!==void 0)].join(" ")}_buildCommandFromRawParams(){var e,n;return[this._command,...(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>`${r.trailing?":":""}${r.value}`))!==null&&n!==void 0?n:[]].join(" ")}}cn.COMMAND="";cn.SUPPORTS_CAPTURE=!1;class Eie extends cn{constructor(e,n,r){super(e,n,r,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}Eie.COMMAND="BATCH";const KWe={name:"batch",messageTypes:[Eie],usesTags:!0},XWe={name:"cap-notify"};class xie extends cn{constructor(e,n,r){super(e,n,r,{newUser:{},newHost:{}})}}xie.COMMAND="CHGHOST";const JWe={name:"chghost",messageTypes:[xie]},ZWe={name:"invite-notify"};class wie extends cn{}wie.COMMAND="ACK";const QWe={name:"labeled-response",messageTypes:[wie],usesTags:!0},eqe={name:"message-tags",usesTags:!0},tqe={name:"multi-prefix"},nqe=Object.freeze(Object.defineProperty({__proto__:null,AwayNotify:zWe,Batch:KWe,CapNotify:XWe,ChgHost:JWe,InviteNotify:ZWe,LabeledResponse:QWe,MessageTags:eqe,MultiPrefix:tqe},Symbol.toStringTag,{value:"Module"}));class rqe{constructor(e,n,...r){this._client=e,this._originalMessage=n,this._messages=[],this._endEventHandlers=new Map,this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const n=this._client.on(e,()=>this.end());this._endEventHandlers.set(e,n)}async promise(){return this._promise||(this._promise=new Promise(e=>{this._promiseResolve=e})),await this._promise}collect(e){return this._originalMessage._acceptsInReplyCollection(e)?(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0):!1}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach(e=>{this._client.removeListener(e)}),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class WU extends cn{constructor(e,n,r){super(e,n,r,{password:{}})}}WU.COMMAND="PASS";class WT extends cn{constructor(e,n,r){super(e,n,r,{nick:{}})}}WT.COMMAND="NICK";class qU extends cn{constructor(e,n,r){super(e,n,r,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}qU.COMMAND="USER";class Tie extends cn{constructor(e,n,r){super(e,n,r,{name:{},password:{}})}}Tie.COMMAND="OPER";class YU extends cn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}YU.COMMAND="QUIT";class Aie extends cn{constructor(e,n,r){super(e,n,r,{server:{},reason:{trailing:!0}})}}Aie.COMMAND="SQUIT";class NA extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},key:{optional:!0}})}}NA.COMMAND="JOIN";class PA extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}PA.COMMAND="PART";class hO extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,hO.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hO)}get char(){return this._char}}class Cie extends cn{constructor(e,n,r){super(e,n,r,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return O4(this.target,this._serverProperties.channelTypes)}separate(){const e=[],n=this.modes;if(!n)throw new Error("can't separate a channel mode request, just set actions");const r=n.split(" "),i=r.shift();let s="add";for(const o of i){let a=s;switch(o){case"+":{s="add";break}case"-":{s="remove";break}default:{let c=!1,l=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(o)||this._serverProperties.supportedChannelModes.prefix.includes(o))c=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(o))s==="add"&&(c=!0);else if(this._serverProperties.supportedChannelModes.list.includes(o))r.length?c=!0:a="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(o))throw new hO(o)}else l=this._serverProperties.supportedUserModes.includes(o);if(c&&!r.length)continue;e.push({prefix:this._prefix,action:a,letter:o,param:c?r.shift():void 0,known:l})}}}return e}}Cie.COMMAND="MODE";class Rie extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}Rie.COMMAND="TOPIC";class NC extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channelList",optional:!0}})}}NC.COMMAND="NAMES";NC.SUPPORTS_CAPTURE=!0;class kie extends cn{constructor(e,n,r){super(e,n,r,{channel:{optional:!0},server:{optional:!0}})}}kie.COMMAND="LIST";class Mie extends cn{constructor(e,n,r){super(e,n,r,{target:{},channel:{type:"channel"}})}}Mie.COMMAND="INVITE";class Oie extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}Oie.COMMAND="KICK";class Iie extends cn{constructor(e,n,r){super(e,n,r,{server:{optional:!0}})}}Iie.COMMAND="TIME";class DA extends cn{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}DA.COMMAND="PRIVMSG";class XI extends cn{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}XI.COMMAND="NOTICE";class JI extends cn{constructor(e,n,r){super(e,n,r,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}JI.COMMAND="WHO";class Nie extends cn{constructor(e,n,r){super(e,n,r,{server:{optional:!0},nickMask:{}})}}Nie.COMMAND="WHOIS";class Pie extends cn{constructor(e,n,r){super(e,n,r,{nick:{},count:{optional:!0},server:{optional:!0}})}}Pie.COMMAND="WHOWAS";class Die extends cn{constructor(e,n,r){super(e,n,r,{target:{},reason:{trailing:!0,optional:!0}})}}Die.COMMAND="KILL";class fO extends cn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}fO.COMMAND="PING";class dO extends cn{constructor(e,n,r){super(e,n,r,{server:{noClient:!0},text:{trailing:!0}})}}dO.COMMAND="PONG";class Lie extends cn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}Lie.COMMAND="ERROR";class Uie extends cn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}Uie.COMMAND="AWAY";class Bie extends cn{}Bie.COMMAND="REHASH";class Fie extends cn{}Fie.COMMAND="RESTART";class jie extends cn{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}jie.COMMAND="WALLOPS";class zie extends cn{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}zie.COMMAND="USERHOST";class Vie extends cn{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}Vie.COMMAND="ISON";class $f extends cn{constructor(e,n,r){super(e,n,r,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof $f))return!1;switch(this.subCommand){case"ACK":case"NAK":return e.subCommand==="REQ"&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof $f))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}$f.COMMAND="CAP";$f.SUPPORTS_CAPTURE=!0;class Hie extends cn{constructor(e,n,r){super(e,n,r,{target:{}})}}Hie.COMMAND="TAGMSG";const $ie=Object.freeze(Object.defineProperty({__proto__:null,Away:Uie,CapabilityNegotiation:$f,ChannelInvite:Mie,ChannelJoin:NA,ChannelKick:Oie,ChannelList:kie,ChannelPart:PA,ClientQuit:YU,ErrorMessage:Lie,IsOnQuery:Vie,Kill:Die,Mode:Cie,Names:NC,NickChange:WT,Notice:XI,OperLogin:Tie,Password:WU,Ping:fO,Pong:dO,PrivateMessage:DA,Rehash:Bie,Restart:Fie,ServerQuit:Aie,TagMessage:Hie,Time:Iie,Topic:Rie,UserHostQuery:zie,UserRegistration:qU,Wallops:jie,WhoIsQuery:Nie,WhoQuery:JI,WhoWasQuery:Pie},Symbol.toStringTag,{value:"Module"}));class KU extends cn{constructor(e,n,r){super(e,n,r,{me:{},welcomeText:{trailing:!0}})}}KU.COMMAND="001";class Gie extends cn{constructor(e,n,r){super(e,n,r,{me:{},yourHost:{trailing:!0}})}}Gie.COMMAND="002";class Wie extends cn{constructor(e,n,r){super(e,n,r,{me:{},createdText:{trailing:!0}})}}Wie.COMMAND="003";class XU extends cn{constructor(e,n,r){super(e,n,r,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}XU.COMMAND="004";class JU extends cn{constructor(e,n,r){super(e,n,r,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}JU.COMMAND="005";class qie extends cn{constructor(e,n,r){super(e,n,r,{me:{},modes:{}})}}qie.COMMAND="221";class Yie extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},text:{trailing:!0}})}}Yie.COMMAND="301";class Kie extends cn{constructor(e,n,r){super(e,n,r,{me:{},hosts:{trailing:!0}})}}Kie.COMMAND="302";class Xie extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Xie.COMMAND="305";class Jie extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Jie.COMMAND="306";class Zie extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}Zie.COMMAND="311";class Qie extends cn{constructor(e,n,r){super(e,n,r,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof JI}endsResponseTo(){return!0}}Qie.COMMAND="315";class ese extends cn{constructor(e,n,r){super(e,n,r,{me:{},nickMask:{},suffix:{trailing:!0}})}}ese.COMMAND="318";class tse extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channels:{trailing:!0}})}}tse.COMMAND="319";class nse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}nse.COMMAND="322";class rse extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}rse.COMMAND="323";class ise extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}ise.COMMAND="324";class sse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}sse.COMMAND="331";class ose extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}ose.COMMAND="332";class ase extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},who:{},ts:{}})}}ase.COMMAND="333";class cse extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"}})}}cse.COMMAND="341";class lse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}lse.COMMAND="348";class use extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}use.COMMAND="349";class hse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof JI}}hse.COMMAND="352";class fse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof NC}}fse.COMMAND="353";class dse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof NC}endsResponseTo(){return!0}}dse.COMMAND="366";class pse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}pse.COMMAND="367";class mse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}mse.COMMAND="368";class gse extends cn{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}gse.COMMAND="372";class _se extends cn{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}_se.COMMAND="375";class ZU extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}ZU.COMMAND="376";class vse extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}vse.COMMAND="381";class yse extends cn{constructor(e,n,r){super(e,n,r,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}yse.COMMAND="391";class bse extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}}bse.COMMAND="401";class Sse extends cn{constructor(e,n,r){super(e,n,r,{me:{},server:{},suffix:{trailing:!0}})}}Sse.COMMAND="402";class Ese extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}Ese.COMMAND="403";class xse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}xse.COMMAND="404";class wse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}wse.COMMAND="405";class Tse extends cn{constructor(e,n,r){super(e,n,r,{me:{},subCommand:{},suffix:{trailing:!0}})}}Tse.COMMAND="410";class Ase extends cn{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}Ase.COMMAND="421";class QU extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}QU.COMMAND="422";class Cse extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Cse.COMMAND="431";class Rse extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Rse.COMMAND="432";class kse extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}kse.COMMAND="433";class Mse extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Mse.COMMAND="436";class Ose extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Ose.COMMAND="441";class Ise extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Ise.COMMAND="442";class Nse extends cn{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Nse.COMMAND="443";class Pse extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Pse.COMMAND="451";class Dse extends cn{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}}Dse.COMMAND="461";class eB extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}eB.COMMAND="462";class Lse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Lse.COMMAND="471";class Use extends cn{constructor(e,n,r){super(e,n,r,{me:{},char:{},suffix:{trailing:!0}})}}Use.COMMAND="472";class Bse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Bse.COMMAND="473";class Fse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Fse.COMMAND="474";class jse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}jse.COMMAND="475";class zse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}zse.COMMAND="479";class Vse extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Vse.COMMAND="481";class Hse extends cn{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}Hse.COMMAND="482";class $se extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}$se.COMMAND="491";class Gse extends cn{constructor(e,n,r){super(e,n,r,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}Gse.COMMAND="501";class Wse extends cn{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Wse.COMMAND="502";const qse=Object.freeze(Object.defineProperty({__proto__:null,Error401NoSuchNick:bse,Error402NoSuchServer:Sse,Error403NoSuchChannel:Ese,Error404CanNotSendToChan:xse,Error405TooManyChannels:wse,Error410InvalidCapCmd:Tse,Error421UnknownCommand:Ase,Error422NoMotd:QU,Error431NoNickNameGiven:Cse,Error432ErroneusNickname:Rse,Error433NickNameInUse:kse,Error436NickCollision:Mse,Error441UserNotInChannel:Ose,Error442NotOnChannel:Ise,Error443UserOnChannel:Nse,Error451NotRegistered:Pse,Error461NeedMoreParams:Dse,Error462AlreadyRegistered:eB,Error471ChannelIsFull:Lse,Error472UnknownMode:Use,Error473InviteOnlyChan:Bse,Error474BannedFromChan:Fse,Error475BadChannelKey:jse,Error479BadChanName:zse,Error481NoPrivileges:Vse,Error482ChanOpPrivsNeeded:Hse,Error491NoOperHost:$se,Error501UmodeUnknownFlag:Gse,Error502UsersDontMatch:Wse,Reply001Welcome:KU,Reply002YourHost:Gie,Reply003Created:Wie,Reply004ServerInfo:XU,Reply005Isupport:JU,Reply221UmodeIs:qie,Reply301Away:Yie,Reply302UserHost:Kie,Reply305UnAway:Xie,Reply306NowAway:Jie,Reply311WhoisUser:Zie,Reply315EndOfWho:Qie,Reply318EndOfWhois:ese,Reply319WhoisChannels:tse,Reply322List:nse,Reply323ListEnd:rse,Reply324ChannelModeIs:ise,Reply331NoTopic:sse,Reply332Topic:ose,Reply333TopicWhoTime:ase,Reply341Inviting:cse,Reply348ExceptList:lse,Reply349EndOfExceptList:use,Reply352WhoReply:hse,Reply353NamesReply:fse,Reply366EndOfNames:dse,Reply367BanList:pse,Reply368EndOfBanList:mse,Reply372Motd:gse,Reply375MotdStart:_se,Reply376EndOfMotd:ZU,Reply381YoureOper:vse,Reply391Time:yse},Symbol.toStringTag,{value:"Module"})),iqe=new Map([...Object.values($ie),...Object.values(qse)].map(t=>[t.COMMAND,t]));function sqe(t){const[e,n]=A1(t,"!",2);if(n){const[r,i]=A1(n,"@",2);return i?{nick:e,user:r,host:i}:{nick:e,host:r}}return{nick:e}}const AW={":":";",n:`
`,r:"\r",s:" "};function oqe(t){const e=new Map,n=t.split(";");for(const r of n){const[i,s]=A1(r,"=",2);i!==""&&e.set(i,s?s.replace(/\\(.?)/g,(o,a)=>Object.prototype.hasOwnProperty.call(AW,a)?AW[a]:a):"")}return e}function aqe(t,e=gE,n=iqe,r=!1,i=[],s=!0){const o=t.split(" ");let a,c;const l=[];let u,h;for(;o.length;){if([a]=o,a.startsWith("@")&&!u&&!c&&!h)u=oqe(a.slice(1));else if(a.startsWith(":"))if(!h&&!c)a.length>1&&(h=sqe(a.slice(1)));else{l.push({value:o.join(" ").slice(1),trailing:!0});break}else c?l.push({value:a,trailing:!1}):c=a.toUpperCase();o.shift()}if(u||(u=new Map),!c)throw new Error(`line without command received: ${t}`);s&&(s=!i.includes(c));let f=cn;return n.has(c)&&(f=n.get(c)),new f(c,{params:l,tags:u,prefix:h,rawLine:t},{serverProperties:e,isServer:r,shouldParseParams:s})}class Yse extends IC{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=GT(gE),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:n,credentials:r,channels:i,channelTypes:s,webSocket:o,logger:a={}}=e;this._options=e;const{pingOnInactivity:c=60,pingTimeout:l=10}=n;this._pingOnInactivity=c,this._pingTimeout=l,this._currentNick=r.nick,this._logger=YI({name:"ircv3",emoji:!0,...a}),this.registerCoreMessageTypes();const{hostName:u,secure:h,reconnect:f=!0}=n,d={hostName:u,port:this.port,secure:h},p={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},m=o?jWe:BWe;f?this._connection=new FWe(m,d,p):this._connection=new m(p,this._logger,e.connectionOptions);for(const g of Object.values(nqe))this.addCapability(g);this.addInternalListener(this.onRegister,async()=>{const g=this._hasRegisteredBefore,_=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const y=g&&this._options.rejoinChannelsOnReconnect?_:await A4(i);if(y)for(const v of y)this.join(v)}),this.onTypedMessage($f,async({subCommand:g,capabilities:_})=>{const y=_.split(" ");switch(g.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${y.join(", ")}`);const v=tk(y,x=>{if(!x)return{};const[A,T]=A1(x,"=",2);return{[A]:{name:A,param:T||!0}}});for(const[x,A]of Object.entries(v))this._serverCapabilities.set(x,A);const E=Object.keys(v);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([x])=>E.includes(x)).map(([,x])=>x));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${y.join(", ")}`);for(const v of y)this._serverCapabilities.delete(v),this._negotiatedCapabilities.delete(v)}}}),this.onTypedMessage(fO,({text:g})=>{this.sendMessage(dO,{text:g})}),this.onTypedMessage(KU,({me:g})=>this._handleReceivedClientNick(g)),this.onTypedMessage(XU,({userModes:g})=>{g&&(this._serverProperties.supportedUserModes=g)}),this.onTypedMessage(JU,({supports:g})=>{const _=tk(g.split(" "),y=>{const[v,E]=A1(y,"=",2);return{[v]:E||!0}});this._supportedFeatures={...this._supportedFeatures,..._}}),this.onTypedMessage(ZU,({me:g})=>{this._registered||(this._handleReceivedClientNick(g),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(QU,({me:g})=>{this._registered||(this._handleReceivedClientNick(g),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(eB,({me:g})=>{this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(g),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(DA,g=>{var _;const{target:y,text:v}=g,E=TW(v),x=(_=g.prefix)===null||_===void 0?void 0:_.nick;E?E.command==="ACTION"?this.emit(this.onAction,y,x,E.params,g):this.emit(this.onCtcp,y,x,E.command,E.params,g):this.emit(this.onPrivmsg,y,x,v,g)}),this.onTypedMessage(WT,g=>{var _;const{nick:y}=g,v=(_=g.prefix)===null||_===void 0?void 0:_.nick;v===this._currentNick&&(this._currentNick=y),this.emit(this.onNickChange,v,y,g)}),this.onTypedMessage(XI,g=>{var _;const{target:y,text:v}=g,E=TW(v),x=(_=g.prefix)===null||_===void 0?void 0:_.nick;E&&this.emit(this.onCtcpReply,y,x,E.command,E.params,g),this.emit(this.onNotice,y,x,v,g)}),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(NA,({channel:g,prefix:_})=>{_?.nick===this._currentNick&&this.acknowledgeJoin(g)}),this.onTypedMessage(PA,g=>{var _;((_=g.prefix)===null||_===void 0?void 0:_.nick)===this._currentNick&&(this._currentChannels.delete(g.channel),this._channelsFromLastRegister.delete(g.channel))}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=r.nick,this._userName=r.userName,this._realName=r.realName,s&&(this._serverProperties.channelTypes=s)}receiveLine(e){var n;this._logger.debug(`Received message: ${e}`);let r;try{r=aqe(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(i){this._logger.error(`Error parsing message: ${i.message}`),this._logger.trace((n=i.stack)!==null&&n!==void 0?n:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify(r)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,r),this._handleEvents(r)}get serverProperties(){return GT(this._serverProperties)}get port(){const{webSocket:e,connection:{port:n,secure:r}}=this._options;return n||(e?r?443:80:r?6697:6667)}pingCheck(){const e=Date.now(),n=e.toString(),r=this.onTypedMessage(dO,i=>{const{text:s}=i;s===n&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(r))});this._pingTimeoutTimer=setTimeout(()=>{this.removeMessageListener(r),this._options.connection.reconnect===!1?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()},this._pingTimeout*1e3),this.sendMessage(fO,{text:n})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){e.COMMAND!==""&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const n of Object.values(e.messageTypes))this.registerMessageType(n)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,n,r){this._events.has(e)||this._events.set(e,new Map);const i=this._events.get(e);if(!r)do r=`${e}:${sWe(Math.random()*1e4,4,"0")}`;while(i.has(r));return i.set(r,n),r}onTypedMessage(e,n,r){return this.onNamedMessage(e.COMMAND,n,r)}removeMessageListener(e){const[n]=e.split(":");this._events.has(n)&&this._events.get(n).delete(e)}createMessage(e,n,r){const i=r?new Map(Object.entries(r)):void 0;return YWe(e,n,void 0,i,this.serverProperties)}sendMessage(e,n,r){this.send(this.createMessage(e,n,r))}async sendMessageAndCaptureReply(e,n){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const r=this.createMessage(e,n),i=this.collect(r).promise();return this.send(r),await i}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e,...n){const r=new rqe(this,e,...n);return this._collectors.push(r),r}stopCollect(e){this._collectors.splice(this._collectors.findIndex(n=>n===e),1)}join(e,n){this.sendMessage(NA,{channel:e,key:n})}part(e){this.sendMessage(PA,{channel:e})}quit(e){this.sendMessage(YU,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,n,r={}){this.sendMessage(DA,{target:e,text:n},r)}sendCtcp(e,n,r){this.say(e,`${n.toUpperCase()} ${r}`)}action(e,n){this.sendCtcp(e,"ACTION",n)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(WT,{nick:e}))}registerCoreMessageTypes(){C4($ie,e=>{this.registerMessageType(e)}),C4(qse,e=>{this.registerMessageType(e)})}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter(n=>n.length).map(async n=>await this._negotiateCapabilities(n)))}async _negotiateCapabilities(e){const n=tk(e,o=>({[o.name]:o})),i=(await this.sendMessageAndCaptureReply($f,{subCommand:"REQ",capabilities:e.map(o=>o.name).join(" ")})).shift();if(!i)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(i instanceof $f))throw new Error(`capability negotiation failed unexpectedly with "${i.command}" command`);const s=i.capabilities.split(" ").filter(o=>o);if(i.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${s.join(", ")}`);const o=s.map(a=>n[a]);for(const a of o){const c=this._clientCapabilities.get(a.name);c.param=a.param,this._negotiatedCapabilities.set(c.name,c)}return o}return this._logger.warn(`Failed to negotiate capabilities: ${s.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect(async()=>{var e,n;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[r]=await Promise.all([A4(this._options.credentials.password),this.sendMessageAndCaptureReply($f,{subCommand:"LS",version:"302"}).then(async i=>{if(!i.length||!(i[0]instanceof $f))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const s=i.map(a=>tk(a.capabilities.split(" "),c=>{if(!c)return{};const[l,u]=A1(c,"=",2);return{[l]:{name:l,param:u||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...s))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const o=s.map(a=>{const c=Object.keys(a);return Array.from(this._clientCapabilities.entries()).filter(([l])=>c.includes(l)).map(([,l])=>l)});return await this._negotiateCapabilityBatch(o)}).then(()=>{this.sendMessage($f,{subCommand:"END"})})]);r&&this.sendMessage(WU,{password:r}),this.sendMessage(WT,{nick:this._desiredNick}),this.sendMessage(qU,{user:(e=this._userName)!==null&&e!==void 0?e:this._desiredNick,mode:"8",unused:"*",realName:(n=this._realName)!==null&&n!==void 0?n:this._desiredNick})}catch(r){this.emit(this.onPasswordError,r),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive(e=>{this.receiveLine(e)}),this._connection.onDisconnect((e,n)=>{var r;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const i=(r=this._options.connection.reconnect)!==null&&r!==void 0?r:!0,s=n?`Disconnected unexpectedly: ${n.message}`:"Disconnected unexpectedly";i?this._logger.warn(`${s}; trying to reconnect`):this._logger.error(s)}this.emit(this.onDisconnect,e,n)}),this._connection.onEnd(e=>{e||this._logger.warn("No further retries will be made")}))}_handleReceivedClientNick(e){this._currentNick!==e&&(this._currentNick!==""&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some(r=>r.collect(e));const n=this._events.get(e.constructor.COMMAND);if(n)for(const r of n.values())r(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1e3):this._pingCheckTimer=void 0}}Vs([Uv(!1)],Yse.prototype,"_options",void 0);class tB extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return(e=this._tags.get("target-user-id"))!==null&&e!==void 0?e:null}}tB.COMMAND="CLEARCHAT";class Kse extends cn{}Kse.COMMAND="RECONNECT";class nB extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}nB.COMMAND="ROOMSTATE";function cqe(t){switch(typeof t){case"undefined":return"";case"object":{if(t===null)return"";if("cacheKey"in t)return t.cacheKey;const e=JSON.stringify(t);if(e!=="{}")return e}default:return t.toString()}}function Xse(t,e,n){return[t,...e.map(cqe)].join("/")+(n?"/":"")}const ug=Symbol("cache");function lqe(t){var e,n;return n=class extends t{constructor(){super(...arguments),this[e]=new Map}getFromCache(r){if(this._cleanCache(),this[ug].has(r)){const i=this[ug].get(r);if(i)return i.value}}setCache(r,i,s){this[ug].set(r,{value:i,expires:Date.now()+s*1e3})}removeFromCache(r,i){const s=this._getInternalCacheKey(r,i);i?this[ug].forEach((o,a)=>{a.startsWith(s)&&this[ug].delete(a)}):this[ug].delete(s)}_cleanCache(){const r=Date.now();this[ug].forEach((i,s)=>{i.expires<r&&this[ug].delete(s)})}_getInternalCacheKey(r,i){if(typeof r=="string"){let s=r;return s.endsWith("/")||(s+="/"),s}else{const s=r.shift();return Xse(s,r,i)}}},e=ug,n}function Jse(t=1/0){return function(e,n,r){if(r.get){const i=r.get;r.get=function(){const s=Xse(n,[]),o=this.getFromCache(s);if(o)return o;const a=i.call(this);return this.setCache(s,a,t),a}}return r}}var jk;let Tv=jk=class{constructor(e,n){this._userName=e.toLowerCase(),this._userData=n?new Map(n):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map(n=>{const r=n.indexOf("/");return r===-1?[n,""]:[n.slice(0,r),n.slice(r+1)]})):new Map}get userName(){return this._userName}get displayName(){var e;return(e=this._userData.get("display-name"))!==null&&e!==void 0?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return jk._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return jk._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){const e=this._userData.get("vip");return e!=null&&e!=="0"}get isArtist(){return this.badges.has("artist-badge")}};Vs([Uv(!1)],Tv.prototype,"_userData",void 0);Vs([Jse()],Tv.prototype,"badges",null);Vs([Jse()],Tv.prototype,"badgeInfo",null);Tv=jk=Vs([lqe,GU("chat","ChatUser","userId")],Tv);function rB(t){return t?new Map(t.split("/").map(e=>{const[n,r]=e.split(":",2);return r?[n,r.split(",")]:null}).filter(e=>e!==null)):new Map}class iB extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new Tv(this._tags.get("login"),this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get emoteOffsets(){return rB(this._tags.get("emotes"))}}iB.COMMAND="USERNOTICE";class Zse extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}Zse.COMMAND="USERSTATE";class sB extends cn{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}get userInfo(){return new Tv(this._prefix.nick,this._tags)}get emoteOffsets(){return rB(this._tags.get("emotes"))}}sB.COMMAND="WHISPER";const uqe={name:"twitch.tv/commands",messageTypes:[tB,Kse,nB,iB,Zse,sB]},hqe={name:"twitch.tv/membership"};class oB extends cn{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}oB.COMMAND="CLEARMSG";class Qse extends cn{}Qse.COMMAND="GLOBALUSERSTATE";const fqe={name:"twitch.tv/tags",messageTypes:[Qse,oB]},dqe=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"];let pO=class extends DA{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new Tv(this._prefix.nick,this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return!!this._tags.get("custom-reward-id")}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return(e=this._tags.get("reply-parent-msg-id"))!==null&&e!==void 0?e:null}get parentMessageText(){var e;return(e=this._tags.get("reply-parent-msg-body"))!==null&&e!==void 0?e:null}get parentMessageUserId(){var e;return(e=this._tags.get("reply-parent-user-id"))!==null&&e!==void 0?e:null}get parentMessageUserName(){var e;return(e=this._tags.get("reply-parent-user-login"))!==null&&e!==void 0?e:null}get parentMessageUserDisplayName(){var e;return(e=this._tags.get("reply-parent-display-name"))!==null&&e!==void 0?e:null}get threadMessageId(){var e;return(e=this._tags.get("reply-thread-parent-msg-id"))!==null&&e!==void 0?e:null}get threadMessageUserId(){var e;return(e=this._tags.get("reply-thread-parent-user-id"))!==null&&e!==void 0?e:null}get bits(){var e;return Number((e=this._tags.get("bits"))!==null&&e!==void 0?e:0)}get emoteOffsets(){return rB(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return OA(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return OA(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){const e=this.hypeChatAmount;return e?e/10**this.hypeChatDecimalPlaces:null}get hypeChatCurrency(){var e;return(e=this._tags.get("pinned-chat-paid-currency"))!==null&&e!==void 0?e:null}get hypeChatLevel(){const e=this._tags.get("pinned-chat-paid-level");return e?dqe.indexOf(e)+1:null}get hypeChatIsSystemMessage(){const e=this._tags.get("pinned-chat-paid-is-system-message");return e?!!Number(e):null}};pO=Vs([GU("chat","ChatMessage","id")],pO);function pqe(t){return t instanceof pO?t.tags.get("id"):t}function CW(t,e){if(t.length<=e)return[t];t=t.trim();const n=[];let r=0,i=e;for(;r<t.length;){let s=t.lastIndexOf(" ",i);(s===-1||s<=r||t.length-r+1<=e)&&(s=r+e);const o=t.slice(r,s).trim();o.length&&n.push(o),r=s+(t[s]===" "?1:0),i=r+e}return n}const mqe=/^[a-z0-9][a-z0-9_]{0,24}$/;function rc(t){const e=t.replace(/^#/,"").toLowerCase();if(!mqe.test(e))throw new Error(`"${e}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return e}function nk(t){return`#${rc(t)}`}var I4;let mO=I4=class extends IC{constructor(e={}){var n,r,i,s,o,a,c;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new Bk("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new Yse({connection:{hostName:(n=e.hostName)!==null&&n!==void 0?n:!((r=e.webSocket)!==null&&r!==void 0)||r?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(i=e.ssl)!==null&&i!==void 0?i:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(s=e.webSocket)!==null&&s!==void 0?s:!0,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((l,u)=>{var h,f,d,p;(h=this._messageRateLimiter)===null||h===void 0||h.clear(),(f=this._messageRateLimiter)===null||f===void 0||f.pause(),(d=this._joinRateLimiter)===null||d===void 0||d.clear(),(p=this._joinRateLimiter)===null||p===void 0||p.pause(),this.emit(this.onDisconnect,l,u)}),this._ircClient.registerMessageType(pO),this._chatLogger=YI({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...(o=e.authIntents)!==null&&o!==void 0?o:[],"chat"],this._isAlwaysMod=(a=e.isAlwaysMod)!==null&&a!==void 0?a:!1,this._botLevel=(c=e.botLevel)!==null&&c!==void 0?c:"none",this._ircClient.addCapability(fqe),this._ircClient.addCapability(uqe),e.requestMembershipEvents&&this._ircClient.addCapability(hqe),this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{var l,u;(l=this._messageRateLimiter)===null||l===void 0||l.resume(),(u=this._joinRateLimiter)===null||u===void 0||u.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const h=await A4(e.channels);h&&await Promise.all(h.map(async f=>{var d;try{await this.join(f)}catch(p){this._chatLogger.warn(`Failed to join configured channel ${f}; original message: ${(d=p?.message)!==null&&d!==void 0?d:p}`)}}))}),this._ircClient.onPasswordError(l=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${l.message}`),this.emit(this.onTokenFetchFailure,l)}),this._ircClient.onPrivmsg((l,u,h,f)=>{u!=="jtv"&&this.emit(this.onMessage,rc(l),u,h,f)}),this._ircClient.onAction((l,u,h,f)=>{this.emit(this.onAction,rc(l),u,h,f)}),this.addInternalListener(this._onJoinResult,(l,u,h)=>{h?this.emit(this.onJoinFailure,rc(l),h):this._ircClient.acknowledgeJoin(l)}),this._ircClient.onTypedMessage(tB,l=>{const{channel:u,user:h,tags:f}=l,d=rc(u);if(h){const p=f.get("ban-duration");p===void 0?this.emit(this.onBan,d,h,l):this.emit(this.onTimeout,d,h,Number(p),l)}else this.emit(this.onChatClear,d,l)}),this._ircClient.onTypedMessage(oB,l=>{const{channel:u,targetMessageId:h}=l;this.emit(this.onMessageRemove,rc(u),h,l)}),this._ircClient.onTypedMessage(NA,({prefix:l,channel:u})=>{this.emit(this.onJoin,rc(u),l.nick)}),this._ircClient.onTypedMessage(PA,({prefix:l,channel:u})=>{this.emit(this.onPart,rc(u),l.nick)}),this._ircClient.onTypedMessage(nB,({channel:l,tags:u})=>{let h=!1;if(u.has("subs-only")&&u.has("slow")&&(this.emit(this._onJoinResult,l,u),h=!0),!h){const f=rc(l);if(u.has("slow")){const d=Number(u.get("slow"));d?this.emit(this.onSlow,f,!0,d):this.emit(this.onSlow,f,!1)}if(u.has("followers-only")){const d=Number(u.get("followers-only"));d===-1?this.emit(this.onFollowersOnly,f,!1):this.emit(this.onFollowersOnly,f,!0,d)}}}),this._ircClient.onTypedMessage(iB,l=>{const{channel:u,text:h,tags:f}=l,d=f.get("msg-id"),p=rc(u);switch(d){case"sub":case"resub":{const m=d==="sub"?this.onSub:this.onResub,g=f.get("msg-param-sub-plan"),_=f.get("msg-param-streak-months"),y={userId:f.get("user-id"),displayName:f.get("display-name"),plan:g,planName:f.get("msg-param-sub-plan-name"),isPrime:g==="Prime",months:Number(f.get("msg-param-cumulative-months")),streak:_?Number(_):void 0,message:h};if(f.get("msg-param-was-gifted")==="true"){const E=f.get("msg-param-anon-gift")==="true",x=Number(f.get("msg-param-gift-months")),A=Number(f.get("msg-param-gift-month-being-redeemed"));E?y.originalGiftInfo={anonymous:!0,duration:x,redeemedMonth:A}:y.originalGiftInfo={anonymous:!1,duration:x,redeemedMonth:A,userId:f.get("msg-param-gifter-id"),userName:f.get("msg-param-gifter-login"),userDisplayName:f.get("msg-param-gifter-name")}}this.emit(m,p,f.get("login"),y,l);break}case"subgift":{const m=f.get("msg-param-sub-plan"),g=f.get("login"),_=g==="ananonymousgifter",y={userId:f.get("msg-param-recipient-id"),displayName:f.get("msg-param-recipient-display-name"),gifter:_?void 0:g,gifterUserId:_?void 0:f.get("user-id"),gifterDisplayName:_?void 0:f.get("display-name"),gifterGiftCount:_?void 0:Number(f.get("msg-param-sender-count")),giftDuration:Number(f.get("msg-param-gift-months")),plan:m,planName:f.get("msg-param-sub-plan-name"),isPrime:m==="Prime",months:Number(f.get("msg-param-months"))};this.emit(this.onSubGift,p,f.get("msg-param-recipient-user-name"),y,l);break}case"submysterygift":{const m=f.get("login"),g=m==="ananonymousgifter",_={gifter:g?void 0:m,gifterUserId:g?void 0:f.get("user-id"),gifterDisplayName:g?void 0:f.get("display-name"),gifterGiftCount:g?void 0:Number(f.get("msg-param-sender-count")),count:Number(f.get("msg-param-mass-gift-count")),plan:f.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,p,f.get("login"),_,l);break}case"primepaidupgrade":{const m={userId:f.get("user-id"),displayName:f.get("display-name"),plan:f.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,p,f.get("login"),m,l);break}case"giftpaidupgrade":{const m={userId:f.get("user-id"),displayName:f.get("display-name"),gifter:f.get("msg-param-sender-login"),gifterDisplayName:f.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,p,f.get("login"),m,l);break}case"standardpayforward":{const m=f.get("msg-param-prior-gifter-anonymous")==="true",g={userId:f.get("user-id"),displayName:f.get("display-name"),originalGifterUserId:m?void 0:f.get("msg-param-prior-gifter-id"),originalGifterDisplayName:m?void 0:f.get("msg-param-prior-gifter-display-name"),recipientUserId:f.get("msg-param-recipient-id"),recipientDisplayName:f.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,p,f.get("login"),g,l);break}case"communitypayforward":{const m=f.get("msg-param-prior-gifter-anonymous")==="true",g={userId:f.get("user-id"),displayName:f.get("display-name"),originalGifterUserId:m?void 0:f.get("msg-param-prior-gifter-id"),originalGifterDisplayName:m?void 0:f.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,p,f.get("login"),g,l);break}case"primecommunitygiftreceived":{const m={name:f.get("msg-param-gift-name"),gifter:f.get("login"),gifterDisplayName:f.get("display-name")};this.emit(this.onPrimeCommunityGift,p,f.get("msg-param-recipient"),m,l);break}case"raid":{const m={displayName:f.get("msg-param-displayName"),viewerCount:Number(f.get("msg-param-viewerCount"))};this.emit(this.onRaid,p,f.get("login"),m,l);break}case"unraid":{this.emit(this.onRaidCancel,p,l);break}case"ritual":{const m={ritualName:f.get("msg-param-ritual-name"),message:h};this.emit(this.onRitual,p,f.get("login"),m,l);break}case"bitsbadgetier":{const m={displayName:f.get("display-name"),threshold:Number(f.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,p,f.get("login"),m,l);break}case"extendsub":{const m={userId:f.get("user-id"),displayName:f.get("display-name"),plan:f.get("msg-param-sub-plan"),months:Number(f.get("msg-param-cumulative-months")),endMonth:Number(f.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,p,f.get("login"),m,l);break}case"rewardgift":{const m={domain:f.get("msg-param-domain"),gifterId:f.get("user-id"),gifterDisplayName:f.get("display-name"),count:Number(f.get("msg-param-selected-count")),gifterGiftCount:Number(f.get("msg-param-total-reward-count")),triggerType:f.get("msg-param-trigger-type")};this.emit(this.onRewardGift,p,f.get("login"),m,l);break}case"announcement":{const m={color:f.get("msg-param-color")};this.emit(this.onAnnouncement,p,f.get("login"),m,l);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${d}`)}}),this._ircClient.onTypedMessage(sB,l=>{this.emit(this.onWhisper,l.prefix.nick,l.text,l)}),this._ircClient.onTypedMessage(XI,async({target:l,text:u,tags:h})=>{const f=h.get("msg-id");switch(f){case"emote_only_on":{this.emit(this.onEmoteOnly,rc(l),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,rc(l),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,l,void 0,f);break}case"r9k_on":{this.emit(this.onUniqueChat,rc(l),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,rc(l),!1);break}case"subs_on":{this.emit(this.onSubsOnly,rc(l),!0);break}case"subs_off":{this.emit(this.onSubsOnly,rc(l),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,rc(l),u);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,rc(l),u);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,rc(l),f);break}case void 0:{if(u==="Login authentication failed"||u==="Improperly formatted AUTH"||u==="Invalid NICK"){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=hie(120),this._authRetryCount=0);const d=this._authRetryTimer.next().value,p=++this._authRetryCount;this.emit(this.onAuthenticationFailure,u,p),d!==0&&this._chatLogger.info(`Retrying authentication in ${d} seconds`),await iWe(d*1e3),this._ircClient.reconnect()}break}default:f.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${f}'`)}})}connect(){this._authProvider||this._ircClient.changeNick(I4._generateJustinfanNick()),this._initializeRateLimiters(),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,n,r={},i){const s={};r.replyTo&&(s["reply-parent-msg-id"]=pqe(r.replyTo));const o=CW(n,500);await Promise.all(o.map(async a=>await this._messageRateLimiter.request({type:"say",channel:nk(e),text:a,tags:s},i)))}async action(e,n,r){const i=CW(n,490);await Promise.all(i.map(async s=>await this._messageRateLimiter.request({type:"action",channel:nk(e),text:s},r)))}async join(e){await this._joinRateLimiter.request(nk(e))}part(e){this._ircClient.part(nk(e))}quit(){var e,n,r,i;(n=(e=this._messageRateLimiter)===null||e===void 0?void 0:e.destroy)===null||n===void 0||n.call(e),(i=(r=this._joinRateLimiter)===null||r===void 0?void 0:r.destroy)===null||i===void 0||i.call(r),this._messageRateLimiter=void 0,this._joinRateLimiter=void 0,this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,n;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!Uk(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const r=this._getNecessaryScopes();let i,s=!1;for(const o of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(o,r),!this._authToken)continue;s=!0;const a=await IA(this._authToken.accessToken);if(!a.userName)throw new Bk("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}catch(a){a instanceof mE?i=a:this._chatLogger.error(`Retrieving an access token failed: ${a.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await((n=(e=this._authProvider).refreshAccessTokenForIntent)===null||n===void 0?void 0:n.call(e,o)),this._authToken){const a=await IA(this._authToken.accessToken);if(!a.userName)throw new Bk("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}}catch(a){a instanceof mE?i=a:this._chatLogger.error(`Refreshing the access token failed: ${a.message}`)}}throw this._authVerified=!1,i??new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof wv?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}_initializeRateLimiters(){const e=async({type:r,text:i,channel:s,tags:o})=>{r==="say"?this._ircClient.say(s,i,o):this._ircClient.action(s,i)},n=async r=>{const{promise:i,resolve:s,reject:o}=R4();let a;const c=this.addInternalListener(this._onJoinResult,(l,u,h)=>{l===r&&(clearTimeout(a),h?o(h):s(),this.removeListener(c))});a=setTimeout(()=>{this.removeListener(c),this.emit(this._onJoinResult,r,void 0,"twurple_timeout"),o(new Error(`Did not receive a reply to join ${r} in time; assuming that the join failed`))},1e4),this._ircClient.join(r),await i};if(this._isAlwaysMod)this._messageRateLimiter=new k4({bucketSize:this._botLevel==="verified"?7500:100,timeFrame:32e3,doRequest:e});else{let r=20;this._botLevel==="verified"?r=7500:this._botLevel==="known"&&(r=50),this._messageRateLimiter=new gWe(new mWe({bucketSize:1,timeFrame:1200,logger:{minLevel:Ar.ERROR},doRequest:e,getPartitionKey:({channel:i})=>i}),{bucketSize:r,timeFrame:32e3})}this._joinRateLimiter=new k4({bucketSize:this._botLevel==="verified"?2e3:20,timeFrame:11e3,doRequest:n}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause()}};Vs([Uv(!1)],mO.prototype,"_authProvider",void 0);mO=I4=Vs([GU("chat","ChatClient")],mO);var aD={exports:{}},RW;function gqe(){return RW||(RW=1,(function(t,e){(function(n,r){t.exports=r()})(self,(()=>(()=>{var n={2505:(o,a,c)=>{o.exports=c(8015)},5592:(o,a,c)=>{var l=c(9516),u=c(7522),h=c(3948),f=c(9106),d=c(9615),p=c(2012),m=c(4202),g=c(4896),_=c(5845),y=c(8563),v=c(5656);o.exports=function(E){return new Promise((function(x,A){var T,k=E.data,L=E.headers,I=E.responseType;function F(){E.cancelToken&&E.cancelToken.unsubscribe(T),E.signal&&E.signal.removeEventListener("abort",T)}l.isFormData(k)&&l.isStandardBrowserEnv()&&delete L["Content-Type"];var M=new XMLHttpRequest;if(E.auth){var D=E.auth.username||"",O=E.auth.password?unescape(encodeURIComponent(E.auth.password)):"";L.Authorization="Basic "+btoa(D+":"+O)}var z=d(E.baseURL,E.url);function q(){if(M){var te="getAllResponseHeaders"in M?p(M.getAllResponseHeaders()):null,re={data:I&&I!=="text"&&I!=="json"?M.response:M.responseText,status:M.status,statusText:M.statusText,headers:te,config:E,request:M};u((function(H){x(H),F()}),(function(H){A(H),F()}),re),M=null}}if(M.open(E.method.toUpperCase(),f(z,E.params,E.paramsSerializer),!0),M.timeout=E.timeout,"onloadend"in M?M.onloadend=q:M.onreadystatechange=function(){M&&M.readyState===4&&(M.status!==0||M.responseURL&&M.responseURL.indexOf("file:")===0)&&setTimeout(q)},M.onabort=function(){M&&(A(new _("Request aborted",_.ECONNABORTED,E,M)),M=null)},M.onerror=function(){A(new _("Network Error",_.ERR_NETWORK,E,M,M)),M=null},M.ontimeout=function(){var te=E.timeout?"timeout of "+E.timeout+"ms exceeded":"timeout exceeded",re=E.transitional||g;E.timeoutErrorMessage&&(te=E.timeoutErrorMessage),A(new _(te,re.clarifyTimeoutError?_.ETIMEDOUT:_.ECONNABORTED,E,M)),M=null},l.isStandardBrowserEnv()){var G=(E.withCredentials||m(z))&&E.xsrfCookieName?h.read(E.xsrfCookieName):void 0;G&&(L[E.xsrfHeaderName]=G)}"setRequestHeader"in M&&l.forEach(L,(function(te,re){k===void 0&&re.toLowerCase()==="content-type"?delete L[re]:M.setRequestHeader(re,te)})),l.isUndefined(E.withCredentials)||(M.withCredentials=!!E.withCredentials),I&&I!=="json"&&(M.responseType=E.responseType),typeof E.onDownloadProgress=="function"&&M.addEventListener("progress",E.onDownloadProgress),typeof E.onUploadProgress=="function"&&M.upload&&M.upload.addEventListener("progress",E.onUploadProgress),(E.cancelToken||E.signal)&&(T=function(te){M&&(A(!te||te&&te.type?new y:te),M.abort(),M=null)},E.cancelToken&&E.cancelToken.subscribe(T),E.signal&&(E.signal.aborted?T():E.signal.addEventListener("abort",T))),k||(k=null);var K=v(z);K&&["http","https","file"].indexOf(K)===-1?A(new _("Unsupported protocol "+K+":",_.ERR_BAD_REQUEST,E)):M.send(k)}))}},8015:(o,a,c)=>{var l=c(9516),u=c(9012),h=c(5155),f=c(5343),d=(function p(m){var g=new h(m),_=u(h.prototype.request,g);return l.extend(_,h.prototype,g),l.extend(_,g),_.create=function(y){return p(f(m,y))},_})(c(7412));d.Axios=h,d.CanceledError=c(8563),d.CancelToken=c(3191),d.isCancel=c(3864),d.VERSION=c(9641).version,d.toFormData=c(6440),d.AxiosError=c(5845),d.Cancel=d.CanceledError,d.all=function(p){return Promise.all(p)},d.spread=c(7980),d.isAxiosError=c(5019),o.exports=d,o.exports.default=d},3191:(o,a,c)=>{var l=c(8563);function u(h){if(typeof h!="function")throw new TypeError("executor must be a function.");var f;this.promise=new Promise((function(p){f=p}));var d=this;this.promise.then((function(p){if(d._listeners){var m,g=d._listeners.length;for(m=0;m<g;m++)d._listeners[m](p);d._listeners=null}})),this.promise.then=function(p){var m,g=new Promise((function(_){d.subscribe(_),m=_})).then(p);return g.cancel=function(){d.unsubscribe(m)},g},h((function(p){d.reason||(d.reason=new l(p),f(d.reason))}))}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.prototype.subscribe=function(h){this.reason?h(this.reason):this._listeners?this._listeners.push(h):this._listeners=[h]},u.prototype.unsubscribe=function(h){if(this._listeners){var f=this._listeners.indexOf(h);f!==-1&&this._listeners.splice(f,1)}},u.source=function(){var h;return{token:new u((function(f){h=f})),cancel:h}},o.exports=u},8563:(o,a,c)=>{var l=c(5845);function u(h){l.call(this,h??"canceled",l.ERR_CANCELED),this.name="CanceledError"}c(9516).inherits(u,l,{__CANCEL__:!0}),o.exports=u},3864:o=>{o.exports=function(a){return!(!a||!a.__CANCEL__)}},5155:(o,a,c)=>{var l=c(9516),u=c(9106),h=c(3471),f=c(4490),d=c(5343),p=c(9615),m=c(4841),g=m.validators;function _(y){this.defaults=y,this.interceptors={request:new h,response:new h}}_.prototype.request=function(y,v){typeof y=="string"?(v=v||{}).url=y:v=y||{},(v=d(this.defaults,v)).method?v.method=v.method.toLowerCase():this.defaults.method?v.method=this.defaults.method.toLowerCase():v.method="get";var E=v.transitional;E!==void 0&&m.assertOptions(E,{silentJSONParsing:g.transitional(g.boolean),forcedJSONParsing:g.transitional(g.boolean),clarifyTimeoutError:g.transitional(g.boolean)},!1);var x=[],A=!0;this.interceptors.request.forEach((function(D){typeof D.runWhen=="function"&&D.runWhen(v)===!1||(A=A&&D.synchronous,x.unshift(D.fulfilled,D.rejected))}));var T,k=[];if(this.interceptors.response.forEach((function(D){k.push(D.fulfilled,D.rejected)})),!A){var L=[f,void 0];for(Array.prototype.unshift.apply(L,x),L=L.concat(k),T=Promise.resolve(v);L.length;)T=T.then(L.shift(),L.shift());return T}for(var I=v;x.length;){var F=x.shift(),M=x.shift();try{I=F(I)}catch(D){M(D);break}}try{T=f(I)}catch(D){return Promise.reject(D)}for(;k.length;)T=T.then(k.shift(),k.shift());return T},_.prototype.getUri=function(y){y=d(this.defaults,y);var v=p(y.baseURL,y.url);return u(v,y.params,y.paramsSerializer)},l.forEach(["delete","get","head","options"],(function(y){_.prototype[y]=function(v,E){return this.request(d(E||{},{method:y,url:v,data:(E||{}).data}))}})),l.forEach(["post","put","patch"],(function(y){function v(E){return function(x,A,T){return this.request(d(T||{},{method:y,headers:E?{"Content-Type":"multipart/form-data"}:{},url:x,data:A}))}}_.prototype[y]=v(),_.prototype[y+"Form"]=v(!0)})),o.exports=_},5845:(o,a,c)=>{var l=c(9516);function u(d,p,m,g,_){Error.call(this),this.message=d,this.name="AxiosError",p&&(this.code=p),m&&(this.config=m),g&&(this.request=g),_&&(this.response=_)}l.inherits(u,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var h=u.prototype,f={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(d){f[d]={value:d}})),Object.defineProperties(u,f),Object.defineProperty(h,"isAxiosError",{value:!0}),u.from=function(d,p,m,g,_,y){var v=Object.create(h);return l.toFlatObject(d,v,(function(E){return E!==Error.prototype})),u.call(v,d.message,p,m,g,_),v.name=d.name,y&&Object.assign(v,y),v},o.exports=u},3471:(o,a,c)=>{var l=c(9516);function u(){this.handlers=[]}u.prototype.use=function(h,f,d){return this.handlers.push({fulfilled:h,rejected:f,synchronous:!!d&&d.synchronous,runWhen:d?d.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(h){this.handlers[h]&&(this.handlers[h]=null)},u.prototype.forEach=function(h){l.forEach(this.handlers,(function(f){f!==null&&h(f)}))},o.exports=u},9615:(o,a,c)=>{var l=c(9137),u=c(4680);o.exports=function(h,f){return h&&!l(f)?u(h,f):f}},4490:(o,a,c)=>{var l=c(9516),u=c(2881),h=c(3864),f=c(7412),d=c(8563);function p(m){if(m.cancelToken&&m.cancelToken.throwIfRequested(),m.signal&&m.signal.aborted)throw new d}o.exports=function(m){return p(m),m.headers=m.headers||{},m.data=u.call(m,m.data,m.headers,m.transformRequest),m.headers=l.merge(m.headers.common||{},m.headers[m.method]||{},m.headers),l.forEach(["delete","get","head","post","put","patch","common"],(function(g){delete m.headers[g]})),(m.adapter||f.adapter)(m).then((function(g){return p(m),g.data=u.call(m,g.data,g.headers,m.transformResponse),g}),(function(g){return h(g)||(p(m),g&&g.response&&(g.response.data=u.call(m,g.response.data,g.response.headers,m.transformResponse))),Promise.reject(g)}))}},5343:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){h=h||{};var f={};function d(v,E){return l.isPlainObject(v)&&l.isPlainObject(E)?l.merge(v,E):l.isPlainObject(E)?l.merge({},E):l.isArray(E)?E.slice():E}function p(v){return l.isUndefined(h[v])?l.isUndefined(u[v])?void 0:d(void 0,u[v]):d(u[v],h[v])}function m(v){if(!l.isUndefined(h[v]))return d(void 0,h[v])}function g(v){return l.isUndefined(h[v])?l.isUndefined(u[v])?void 0:d(void 0,u[v]):d(void 0,h[v])}function _(v){return v in h?d(u[v],h[v]):v in u?d(void 0,u[v]):void 0}var y={url:m,method:m,data:m,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:_};return l.forEach(Object.keys(u).concat(Object.keys(h)),(function(v){var E=y[v]||p,x=E(v);l.isUndefined(x)&&E!==_||(f[v]=x)})),f}},7522:(o,a,c)=>{var l=c(5845);o.exports=function(u,h,f){var d=f.config.validateStatus;f.status&&d&&!d(f.status)?h(new l("Request failed with status code "+f.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(f.status/100)-4],f.config,f.request,f)):u(f)}},2881:(o,a,c)=>{var l=c(9516),u=c(7412);o.exports=function(h,f,d){var p=this||u;return l.forEach(d,(function(m){h=m.call(p,h,f)})),h}},7412:(o,a,c)=>{var l=c(9516),u=c(7018),h=c(5845),f=c(4896),d=c(6440),p={"Content-Type":"application/x-www-form-urlencoded"};function m(y,v){!l.isUndefined(y)&&l.isUndefined(y["Content-Type"])&&(y["Content-Type"]=v)}var g,_={transitional:f,adapter:((typeof XMLHttpRequest<"u"||typeof sf<"u"&&Object.prototype.toString.call(sf)==="[object process]")&&(g=c(5592)),g),transformRequest:[function(y,v){if(u(v,"Accept"),u(v,"Content-Type"),l.isFormData(y)||l.isArrayBuffer(y)||l.isBuffer(y)||l.isStream(y)||l.isFile(y)||l.isBlob(y))return y;if(l.isArrayBufferView(y))return y.buffer;if(l.isURLSearchParams(y))return m(v,"application/x-www-form-urlencoded;charset=utf-8"),y.toString();var E,x=l.isObject(y),A=v&&v["Content-Type"];if((E=l.isFileList(y))||x&&A==="multipart/form-data"){var T=this.env&&this.env.FormData;return d(E?{"files[]":y}:y,T&&new T)}return x||A==="application/json"?(m(v,"application/json"),(function(k,L,I){if(l.isString(k))try{return(L||JSON.parse)(k),l.trim(k)}catch(F){if(F.name!=="SyntaxError")throw F}return(I||JSON.stringify)(k)})(y)):y}],transformResponse:[function(y){var v=this.transitional||_.transitional,E=v&&v.silentJSONParsing,x=v&&v.forcedJSONParsing,A=!E&&this.responseType==="json";if(A||x&&l.isString(y)&&y.length)try{return JSON.parse(y)}catch(T){if(A)throw T.name==="SyntaxError"?h.from(T,h.ERR_BAD_RESPONSE,this,null,this.response):T}return y}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c(1534)},validateStatus:function(y){return y>=200&&y<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],(function(y){_.headers[y]={}})),l.forEach(["post","put","patch"],(function(y){_.headers[y]=l.merge(p)})),o.exports=_},4896:o=>{o.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},9641:o=>{o.exports={version:"0.27.2"}},9012:o=>{o.exports=function(a,c){return function(){for(var l=new Array(arguments.length),u=0;u<l.length;u++)l[u]=arguments[u];return a.apply(c,l)}}},9106:(o,a,c)=>{var l=c(9516);function u(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}o.exports=function(h,f,d){if(!f)return h;var p;if(d)p=d(f);else if(l.isURLSearchParams(f))p=f.toString();else{var m=[];l.forEach(f,(function(_,y){_!=null&&(l.isArray(_)?y+="[]":_=[_],l.forEach(_,(function(v){l.isDate(v)?v=v.toISOString():l.isObject(v)&&(v=JSON.stringify(v)),m.push(u(y)+"="+u(v))})))})),p=m.join("&")}if(p){var g=h.indexOf("#");g!==-1&&(h=h.slice(0,g)),h+=(h.indexOf("?")===-1?"?":"&")+p}return h}},4680:o=>{o.exports=function(a,c){return c?a.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):a}},3948:(o,a,c)=>{var l=c(9516);o.exports=l.isStandardBrowserEnv()?{write:function(u,h,f,d,p,m){var g=[];g.push(u+"="+encodeURIComponent(h)),l.isNumber(f)&&g.push("expires="+new Date(f).toGMTString()),l.isString(d)&&g.push("path="+d),l.isString(p)&&g.push("domain="+p),m===!0&&g.push("secure"),document.cookie=g.join("; ")},read:function(u){var h=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9137:o=>{o.exports=function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}},5019:(o,a,c)=>{var l=c(9516);o.exports=function(u){return l.isObject(u)&&u.isAxiosError===!0}},4202:(o,a,c)=>{var l=c(9516);o.exports=l.isStandardBrowserEnv()?(function(){var u,h=/(msie|trident)/i.test(navigator.userAgent),f=document.createElement("a");function d(p){var m=p;return h&&(f.setAttribute("href",m),m=f.href),f.setAttribute("href",m),{href:f.href,protocol:f.protocol?f.protocol.replace(/:$/,""):"",host:f.host,search:f.search?f.search.replace(/^\?/,""):"",hash:f.hash?f.hash.replace(/^#/,""):"",hostname:f.hostname,port:f.port,pathname:f.pathname.charAt(0)==="/"?f.pathname:"/"+f.pathname}}return u=d(window.location.href),function(p){var m=l.isString(p)?d(p):p;return m.protocol===u.protocol&&m.host===u.host}})():function(){return!0}},7018:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){l.forEach(u,(function(f,d){d!==h&&d.toUpperCase()===h.toUpperCase()&&(u[h]=f,delete u[d])}))}},1534:o=>{o.exports=null},2012:(o,a,c)=>{var l=c(9516),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];o.exports=function(h){var f,d,p,m={};return h&&l.forEach(h.split(`
`),(function(g){if(p=g.indexOf(":"),f=l.trim(g.substr(0,p)).toLowerCase(),d=l.trim(g.substr(p+1)),f){if(m[f]&&u.indexOf(f)>=0)return;m[f]=f==="set-cookie"?(m[f]?m[f]:[]).concat([d]):m[f]?m[f]+", "+d:d}})),m}},5656:o=>{o.exports=function(a){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return c&&c[1]||""}},7980:o=>{o.exports=function(a){return function(c){return a.apply(null,c)}}},6440:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){h=h||new FormData;var f=[];function d(p){return p===null?"":l.isDate(p)?p.toISOString():l.isArrayBuffer(p)||l.isTypedArray(p)?typeof Blob=="function"?new Blob([p]):js.from(p):p}return(function p(m,g){if(l.isPlainObject(m)||l.isArray(m)){if(f.indexOf(m)!==-1)throw Error("Circular reference detected in "+g);f.push(m),l.forEach(m,(function(_,y){if(!l.isUndefined(_)){var v,E=g?g+"."+y:y;if(_&&!g&&typeof _=="object"){if(l.endsWith(y,"{}"))_=JSON.stringify(_);else if(l.endsWith(y,"[]")&&(v=l.toArray(_)))return void v.forEach((function(x){!l.isUndefined(x)&&h.append(E,d(x))}))}p(_,E)}})),f.pop()}else h.append(g,d(m))})(u),h}},4841:(o,a,c)=>{var l=c(9641).version,u=c(5845),h={};["object","boolean","number","function","string","symbol"].forEach((function(d,p){h[d]=function(m){return typeof m===d||"a"+(p<1?"n ":" ")+d}}));var f={};h.transitional=function(d,p,m){function g(_,y){return"[Axios v"+l+"] Transitional option '"+_+"'"+y+(m?". "+m:"")}return function(_,y,v){if(d===!1)throw new u(g(y," has been removed"+(p?" in "+p:"")),u.ERR_DEPRECATED);return p&&!f[y]&&(f[y]=!0,console.warn(g(y," has been deprecated since v"+p+" and will be removed in the near future"))),!d||d(_,y,v)}},o.exports={assertOptions:function(d,p,m){if(typeof d!="object")throw new u("options must be an object",u.ERR_BAD_OPTION_VALUE);for(var g=Object.keys(d),_=g.length;_-- >0;){var y=g[_],v=p[y];if(v){var E=d[y],x=E===void 0||v(E,y,d);if(x!==!0)throw new u("option "+y+" must be "+x,u.ERR_BAD_OPTION_VALUE)}else if(m!==!0)throw new u("Unknown option "+y,u.ERR_BAD_OPTION)}},validators:h}},9516:(o,a,c)=>{var l,u=c(9012),h=Object.prototype.toString,f=(l=Object.create(null),function(M){var D=h.call(M);return l[D]||(l[D]=D.slice(8,-1).toLowerCase())});function d(M){return M=M.toLowerCase(),function(D){return f(D)===M}}function p(M){return Array.isArray(M)}function m(M){return M===void 0}var g=d("ArrayBuffer");function _(M){return M!==null&&typeof M=="object"}function y(M){if(f(M)!=="object")return!1;var D=Object.getPrototypeOf(M);return D===null||D===Object.prototype}var v=d("Date"),E=d("File"),x=d("Blob"),A=d("FileList");function T(M){return h.call(M)==="[object Function]"}var k=d("URLSearchParams");function L(M,D){if(M!=null)if(typeof M!="object"&&(M=[M]),p(M))for(var O=0,z=M.length;O<z;O++)D.call(null,M[O],O,M);else for(var q in M)Object.prototype.hasOwnProperty.call(M,q)&&D.call(null,M[q],q,M)}var I,F=(I=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(M){return I&&M instanceof I});o.exports={isArray:p,isArrayBuffer:g,isBuffer:function(M){return M!==null&&!m(M)&&M.constructor!==null&&!m(M.constructor)&&typeof M.constructor.isBuffer=="function"&&M.constructor.isBuffer(M)},isFormData:function(M){var D="[object FormData]";return M&&(typeof FormData=="function"&&M instanceof FormData||h.call(M)===D||T(M.toString)&&M.toString()===D)},isArrayBufferView:function(M){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(M):M&&M.buffer&&g(M.buffer)},isString:function(M){return typeof M=="string"},isNumber:function(M){return typeof M=="number"},isObject:_,isPlainObject:y,isUndefined:m,isDate:v,isFile:E,isBlob:x,isFunction:T,isStream:function(M){return _(M)&&T(M.pipe)},isURLSearchParams:k,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:L,merge:function M(){var D={};function O(G,K){y(D[K])&&y(G)?D[K]=M(D[K],G):y(G)?D[K]=M({},G):p(G)?D[K]=G.slice():D[K]=G}for(var z=0,q=arguments.length;z<q;z++)L(arguments[z],O);return D},extend:function(M,D,O){return L(D,(function(z,q){M[q]=O&&typeof z=="function"?u(z,O):z})),M},trim:function(M){return M.trim?M.trim():M.replace(/^\s+|\s+$/g,"")},stripBOM:function(M){return M.charCodeAt(0)===65279&&(M=M.slice(1)),M},inherits:function(M,D,O,z){M.prototype=Object.create(D.prototype,z),M.prototype.constructor=M,O&&Object.assign(M.prototype,O)},toFlatObject:function(M,D,O){var z,q,G,K={};D=D||{};do{for(q=(z=Object.getOwnPropertyNames(M)).length;q-- >0;)K[G=z[q]]||(D[G]=M[G],K[G]=!0);M=Object.getPrototypeOf(M)}while(M&&(!O||O(M,D))&&M!==Object.prototype);return D},kindOf:f,kindOfTest:d,endsWith:function(M,D,O){M=String(M),(O===void 0||O>M.length)&&(O=M.length),O-=D.length;var z=M.indexOf(D,O);return z!==-1&&z===O},toArray:function(M){if(!M)return null;var D=M.length;if(m(D))return null;for(var O=new Array(D);D-- >0;)O[D]=M[D];return O},isTypedArray:F,isFileList:A}},6880:function(o){o.exports=(function(a){var c={};function l(u){if(c[u])return c[u].exports;var h=c[u]={i:u,l:!1,exports:{}};return a[u].call(h.exports,h,h.exports,l),h.l=!0,h.exports}return l.m=a,l.c=c,l.d=function(u,h,f){l.o(u,h)||Object.defineProperty(u,h,{enumerable:!0,get:f})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,h){if(1&h&&(u=l(u)),8&h||4&h&&typeof u=="object"&&u&&u.__esModule)return u;var f=Object.create(null);if(l.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:u}),2&h&&typeof u!="string")for(var d in u)l.d(f,d,(function(p){return u[p]}).bind(null,d));return f},l.n=function(u){var h=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(h,"a",h),h},l.o=function(u,h){return Object.prototype.hasOwnProperty.call(u,h)},l.p="",l(l.s=90)})({17:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=l(18),h=(function(){function f(){}return f.getFirstMatch=function(d,p){var m=p.match(d);return m&&m.length>0&&m[1]||""},f.getSecondMatch=function(d,p){var m=p.match(d);return m&&m.length>1&&m[2]||""},f.matchAndReturnConst=function(d,p,m){if(d.test(p))return m},f.getWindowsVersionName=function(d){switch(d){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},f.getMacOSVersionName=function(d){var p=d.split(".").splice(0,2).map((function(m){return parseInt(m,10)||0}));if(p.push(0),p[0]===10)switch(p[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},f.getAndroidVersionName=function(d){var p=d.split(".").splice(0,2).map((function(m){return parseInt(m,10)||0}));if(p.push(0),!(p[0]===1&&p[1]<5))return p[0]===1&&p[1]<6?"Cupcake":p[0]===1&&p[1]>=6?"Donut":p[0]===2&&p[1]<2?"Eclair":p[0]===2&&p[1]===2?"Froyo":p[0]===2&&p[1]>2?"Gingerbread":p[0]===3?"Honeycomb":p[0]===4&&p[1]<1?"Ice Cream Sandwich":p[0]===4&&p[1]<4?"Jelly Bean":p[0]===4&&p[1]>=4?"KitKat":p[0]===5?"Lollipop":p[0]===6?"Marshmallow":p[0]===7?"Nougat":p[0]===8?"Oreo":p[0]===9?"Pie":void 0},f.getVersionPrecision=function(d){return d.split(".").length},f.compareVersions=function(d,p,m){m===void 0&&(m=!1);var g=f.getVersionPrecision(d),_=f.getVersionPrecision(p),y=Math.max(g,_),v=0,E=f.map([d,p],(function(x){var A=y-f.getVersionPrecision(x),T=x+new Array(A+1).join(".0");return f.map(T.split("."),(function(k){return new Array(20-k.length).join("0")+k})).reverse()}));for(m&&(v=y-Math.min(g,_)),y-=1;y>=v;){if(E[0][y]>E[1][y])return 1;if(E[0][y]===E[1][y]){if(y===v)return 0;y-=1}else if(E[0][y]<E[1][y])return-1}},f.map=function(d,p){var m,g=[];if(Array.prototype.map)return Array.prototype.map.call(d,p);for(m=0;m<d.length;m+=1)g.push(p(d[m]));return g},f.find=function(d,p){var m,g;if(Array.prototype.find)return Array.prototype.find.call(d,p);for(m=0,g=d.length;m<g;m+=1){var _=d[m];if(p(_,m))return _}},f.assign=function(d){for(var p,m,g=d,_=arguments.length,y=new Array(_>1?_-1:0),v=1;v<_;v++)y[v-1]=arguments[v];if(Object.assign)return Object.assign.apply(Object,[d].concat(y));var E=function(){var x=y[p];typeof x=="object"&&x!==null&&Object.keys(x).forEach((function(A){g[A]=x[A]}))};for(p=0,m=y.length;p<m;p+=1)E();return d},f.getBrowserAlias=function(d){return u.BROWSER_ALIASES_MAP[d]},f.getBrowserTypeByAlias=function(d){return u.BROWSER_MAP[d]||""},f})();c.default=h,a.exports=c.default},18:function(a,c,l){c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(91))&&u.__esModule?u:{default:u},f=l(18);function d(m,g){for(var _=0;_<g.length;_++){var y=g[_];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}var p=(function(){function m(){}var g,_,y;return m.getParser=function(v,E){if(E===void 0&&(E=!1),typeof v!="string")throw new Error("UserAgent should be a string");return new h.default(v,E)},m.parse=function(v){return new h.default(v).getResult()},g=m,y=[{key:"BROWSER_MAP",get:function(){return f.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return f.ENGINE_MAP}},{key:"OS_MAP",get:function(){return f.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return f.PLATFORMS_MAP}}],(_=null)&&d(g.prototype,_),y&&d(g,y),m})();c.default=p,a.exports=c.default},91:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=m(l(92)),h=m(l(93)),f=m(l(94)),d=m(l(95)),p=m(l(17));function m(_){return _&&_.__esModule?_:{default:_}}var g=(function(){function _(v,E){if(E===void 0&&(E=!1),v==null||v==="")throw new Error("UserAgent parameter can't be empty");this._ua=v,this.parsedResult={},E!==!0&&this.parse()}var y=_.prototype;return y.getUA=function(){return this._ua},y.test=function(v){return v.test(this._ua)},y.parseBrowser=function(){var v=this;this.parsedResult.browser={};var E=p.default.find(u.default,(function(x){if(typeof x.test=="function")return x.test(v);if(x.test instanceof Array)return x.test.some((function(A){return v.test(A)}));throw new Error("Browser's test function is not valid")}));return E&&(this.parsedResult.browser=E.describe(this.getUA())),this.parsedResult.browser},y.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},y.getBrowserName=function(v){return v?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},y.getBrowserVersion=function(){return this.getBrowser().version},y.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},y.parseOS=function(){var v=this;this.parsedResult.os={};var E=p.default.find(h.default,(function(x){if(typeof x.test=="function")return x.test(v);if(x.test instanceof Array)return x.test.some((function(A){return v.test(A)}));throw new Error("Browser's test function is not valid")}));return E&&(this.parsedResult.os=E.describe(this.getUA())),this.parsedResult.os},y.getOSName=function(v){var E=this.getOS().name;return v?String(E).toLowerCase()||"":E||""},y.getOSVersion=function(){return this.getOS().version},y.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},y.getPlatformType=function(v){v===void 0&&(v=!1);var E=this.getPlatform().type;return v?String(E).toLowerCase()||"":E||""},y.parsePlatform=function(){var v=this;this.parsedResult.platform={};var E=p.default.find(f.default,(function(x){if(typeof x.test=="function")return x.test(v);if(x.test instanceof Array)return x.test.some((function(A){return v.test(A)}));throw new Error("Browser's test function is not valid")}));return E&&(this.parsedResult.platform=E.describe(this.getUA())),this.parsedResult.platform},y.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},y.getEngineName=function(v){return v?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},y.parseEngine=function(){var v=this;this.parsedResult.engine={};var E=p.default.find(d.default,(function(x){if(typeof x.test=="function")return x.test(v);if(x.test instanceof Array)return x.test.some((function(A){return v.test(A)}));throw new Error("Browser's test function is not valid")}));return E&&(this.parsedResult.engine=E.describe(this.getUA())),this.parsedResult.engine},y.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},y.getResult=function(){return p.default.assign({},this.parsedResult)},y.satisfies=function(v){var E=this,x={},A=0,T={},k=0;if(Object.keys(v).forEach((function(q){var G=v[q];typeof G=="string"?(T[q]=G,k+=1):typeof G=="object"&&(x[q]=G,A+=1)})),A>0){var L=Object.keys(x),I=p.default.find(L,(function(q){return E.isOS(q)}));if(I){var F=this.satisfies(x[I]);if(F!==void 0)return F}var M=p.default.find(L,(function(q){return E.isPlatform(q)}));if(M){var D=this.satisfies(x[M]);if(D!==void 0)return D}}if(k>0){var O=Object.keys(T),z=p.default.find(O,(function(q){return E.isBrowser(q,!0)}));if(z!==void 0)return this.compareVersion(T[z])}},y.isBrowser=function(v,E){E===void 0&&(E=!1);var x=this.getBrowserName().toLowerCase(),A=v.toLowerCase(),T=p.default.getBrowserTypeByAlias(A);return E&&T&&(A=T.toLowerCase()),A===x},y.compareVersion=function(v){var E=[0],x=v,A=!1,T=this.getBrowserVersion();if(typeof T=="string")return v[0]===">"||v[0]==="<"?(x=v.substr(1),v[1]==="="?(A=!0,x=v.substr(2)):E=[],v[0]===">"?E.push(1):E.push(-1)):v[0]==="="?x=v.substr(1):v[0]==="~"&&(A=!0,x=v.substr(1)),E.indexOf(p.default.compareVersions(T,x,A))>-1},y.isOS=function(v){return this.getOSName(!0)===String(v).toLowerCase()},y.isPlatform=function(v){return this.getPlatformType(!0)===String(v).toLowerCase()},y.isEngine=function(v){return this.getEngineName(!0)===String(v).toLowerCase()},y.is=function(v,E){return E===void 0&&(E=!1),this.isBrowser(v,E)||this.isOS(v)||this.isPlatform(v)},y.some=function(v){var E=this;return v===void 0&&(v=[]),v.some((function(x){return E.is(x)}))},_})();c.default=g,a.exports=c.default},92:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=/version\/(\d+(\.?_?\d+)+)/i,d=[{test:[/googlebot/i],describe:function(p){var m={name:"Googlebot"},g=h.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/opera/i],describe:function(p){var m={name:"Opera"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/opr\/|opios/i],describe:function(p){var m={name:"Opera"},g=h.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/SamsungBrowser/i],describe:function(p){var m={name:"Samsung Internet for Android"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/Whale/i],describe:function(p){var m={name:"NAVER Whale Browser"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/MZBrowser/i],describe:function(p){var m={name:"MZ Browser"},g=h.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/focus/i],describe:function(p){var m={name:"Focus"},g=h.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/swing/i],describe:function(p){var m={name:"Swing"},g=h.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/coast/i],describe:function(p){var m={name:"Opera Coast"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(p){var m={name:"Opera Touch"},g=h.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/yabrowser/i],describe:function(p){var m={name:"Yandex Browser"},g=h.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/ucbrowser/i],describe:function(p){var m={name:"UC Browser"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/Maxthon|mxios/i],describe:function(p){var m={name:"Maxthon"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/epiphany/i],describe:function(p){var m={name:"Epiphany"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/puffin/i],describe:function(p){var m={name:"Puffin"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/sleipnir/i],describe:function(p){var m={name:"Sleipnir"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/k-meleon/i],describe:function(p){var m={name:"K-Meleon"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/micromessenger/i],describe:function(p){var m={name:"WeChat"},g=h.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/qqbrowser/i],describe:function(p){var m={name:/qqbrowserlite/i.test(p)?"QQ Browser Lite":"QQ Browser"},g=h.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/msie|trident/i],describe:function(p){var m={name:"Internet Explorer"},g=h.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/\sedg\//i],describe:function(p){var m={name:"Microsoft Edge"},g=h.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/edg([ea]|ios)/i],describe:function(p){var m={name:"Microsoft Edge"},g=h.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/vivaldi/i],describe:function(p){var m={name:"Vivaldi"},g=h.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/seamonkey/i],describe:function(p){var m={name:"SeaMonkey"},g=h.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/sailfish/i],describe:function(p){var m={name:"Sailfish"},g=h.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,p);return g&&(m.version=g),m}},{test:[/silk/i],describe:function(p){var m={name:"Amazon Silk"},g=h.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/phantom/i],describe:function(p){var m={name:"PhantomJS"},g=h.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/slimerjs/i],describe:function(p){var m={name:"SlimerJS"},g=h.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var m={name:"BlackBerry"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var m={name:"WebOS Browser"},g=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/bada/i],describe:function(p){var m={name:"Bada"},g=h.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/tizen/i],describe:function(p){var m={name:"Tizen"},g=h.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/qupzilla/i],describe:function(p){var m={name:"QupZilla"},g=h.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/firefox|iceweasel|fxios/i],describe:function(p){var m={name:"Firefox"},g=h.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/electron/i],describe:function(p){var m={name:"Electron"},g=h.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/MiuiBrowser/i],describe:function(p){var m={name:"Miui"},g=h.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/chromium/i],describe:function(p){var m={name:"Chromium"},g=h.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/chrome|crios|crmo/i],describe:function(p){var m={name:"Chrome"},g=h.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/GSA/i],describe:function(p){var m={name:"Google Search"},g=h.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:function(p){var m=!p.test(/like android/i),g=p.test(/android/i);return m&&g},describe:function(p){var m={name:"Android Browser"},g=h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/playstation 4/i],describe:function(p){var m={name:"PlayStation 4"},g=h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/safari|applewebkit/i],describe:function(p){var m={name:"Safari"},g=h.default.getFirstMatch(f,p);return g&&(m.version=g),m}},{test:[/.*/i],describe:function(p){var m=p.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:h.default.getFirstMatch(m,p),version:h.default.getSecondMatch(m,p)}}}];c.default=d,a.exports=c.default},93:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:[/Roku\/DVP/],describe:function(p){var m=h.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,p);return{name:f.OS_MAP.Roku,version:m}}},{test:[/windows phone/i],describe:function(p){var m=h.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.WindowsPhone,version:m}}},{test:[/windows /i],describe:function(p){var m=h.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,p),g=h.default.getWindowsVersionName(m);return{name:f.OS_MAP.Windows,version:m,versionName:g}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(p){var m={name:f.OS_MAP.iOS},g=h.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,p);return g&&(m.version=g),m}},{test:[/macintosh/i],describe:function(p){var m=h.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,p).replace(/[_\s]/g,"."),g=h.default.getMacOSVersionName(m),_={name:f.OS_MAP.MacOS,version:m};return g&&(_.versionName=g),_}},{test:[/(ipod|iphone|ipad)/i],describe:function(p){var m=h.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,p).replace(/[_\s]/g,".");return{name:f.OS_MAP.iOS,version:m}}},{test:function(p){var m=!p.test(/like android/i),g=p.test(/android/i);return m&&g},describe:function(p){var m=h.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,p),g=h.default.getAndroidVersionName(m),_={name:f.OS_MAP.Android,version:m};return g&&(_.versionName=g),_}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var m=h.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,p),g={name:f.OS_MAP.WebOS};return m&&m.length&&(g.version=m),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var m=h.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,p)||h.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,p)||h.default.getFirstMatch(/\bbb(\d+)/i,p);return{name:f.OS_MAP.BlackBerry,version:m}}},{test:[/bada/i],describe:function(p){var m=h.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.Bada,version:m}}},{test:[/tizen/i],describe:function(p){var m=h.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.Tizen,version:m}}},{test:[/linux/i],describe:function(){return{name:f.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:f.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(p){var m=h.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.PlayStation4,version:m}}}];c.default=d,a.exports=c.default},94:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(p){var m=h.default.getFirstMatch(/(can-l01)/i,p)&&"Nova",g={type:f.PLATFORMS_MAP.mobile,vendor:"Huawei"};return m&&(g.model=m),g}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet}}},{test:function(p){var m=p.test(/ipod|iphone/i),g=p.test(/like (ipod|iphone)/i);return m&&!g},describe:function(p){var m=h.default.getFirstMatch(/(ipod|iphone)/i,p);return{type:f.PLATFORMS_MAP.mobile,vendor:"Apple",model:m}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName(!0)==="blackberry"},describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(p){return p.getBrowserName(!0)==="bada"},describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName()==="windows phone"},describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(p){var m=Number(String(p.getOSVersion()).split(".")[0]);return p.getOSName(!0)==="android"&&m>=3},describe:function(){return{type:f.PLATFORMS_MAP.tablet}}},{test:function(p){return p.getOSName(!0)==="android"},describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getOSName(!0)==="macos"},describe:function(){return{type:f.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(p){return p.getOSName(!0)==="windows"},describe:function(){return{type:f.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="linux"},describe:function(){return{type:f.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="playstation 4"},describe:function(){return{type:f.PLATFORMS_MAP.tv}}},{test:function(p){return p.getOSName(!0)==="roku"},describe:function(){return{type:f.PLATFORMS_MAP.tv}}}];c.default=d,a.exports=c.default},95:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:function(p){return p.getBrowserName(!0)==="microsoft edge"},describe:function(p){if(/\sedg\//i.test(p))return{name:f.ENGINE_MAP.Blink};var m=h.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,p);return{name:f.ENGINE_MAP.EdgeHTML,version:m}}},{test:[/trident/i],describe:function(p){var m={name:f.ENGINE_MAP.Trident},g=h.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:function(p){return p.test(/presto/i)},describe:function(p){var m={name:f.ENGINE_MAP.Presto},g=h.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:function(p){var m=p.test(/gecko/i),g=p.test(/like gecko/i);return m&&!g},describe:function(p){var m={name:f.ENGINE_MAP.Gecko},g=h.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:f.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(p){var m={name:f.ENGINE_MAP.WebKit},g=h.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,p);return g&&(m.version=g),m}}];c.default=d,a.exports=c.default}})},228:o=>{var a=Object.prototype.hasOwnProperty,c="~";function l(){}function u(p,m,g){this.fn=p,this.context=m,this.once=g||!1}function h(p,m,g,_,y){if(typeof g!="function")throw new TypeError("The listener must be a function");var v=new u(g,_||p,y),E=c?c+m:m;return p._events[E]?p._events[E].fn?p._events[E]=[p._events[E],v]:p._events[E].push(v):(p._events[E]=v,p._eventsCount++),p}function f(p,m){--p._eventsCount==0?p._events=new l:delete p._events[m]}function d(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(c=!1)),d.prototype.eventNames=function(){var p,m,g=[];if(this._eventsCount===0)return g;for(m in p=this._events)a.call(p,m)&&g.push(c?m.slice(1):m);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(p)):g},d.prototype.listeners=function(p){var m=c?c+p:p,g=this._events[m];if(!g)return[];if(g.fn)return[g.fn];for(var _=0,y=g.length,v=new Array(y);_<y;_++)v[_]=g[_].fn;return v},d.prototype.listenerCount=function(p){var m=c?c+p:p,g=this._events[m];return g?g.fn?1:g.length:0},d.prototype.emit=function(p,m,g,_,y,v){var E=c?c+p:p;if(!this._events[E])return!1;var x,A,T=this._events[E],k=arguments.length;if(T.fn){switch(T.once&&this.removeListener(p,T.fn,void 0,!0),k){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,m),!0;case 3:return T.fn.call(T.context,m,g),!0;case 4:return T.fn.call(T.context,m,g,_),!0;case 5:return T.fn.call(T.context,m,g,_,y),!0;case 6:return T.fn.call(T.context,m,g,_,y,v),!0}for(A=1,x=new Array(k-1);A<k;A++)x[A-1]=arguments[A];T.fn.apply(T.context,x)}else{var L,I=T.length;for(A=0;A<I;A++)switch(T[A].once&&this.removeListener(p,T[A].fn,void 0,!0),k){case 1:T[A].fn.call(T[A].context);break;case 2:T[A].fn.call(T[A].context,m);break;case 3:T[A].fn.call(T[A].context,m,g);break;case 4:T[A].fn.call(T[A].context,m,g,_);break;default:if(!x)for(L=1,x=new Array(k-1);L<k;L++)x[L-1]=arguments[L];T[A].fn.apply(T[A].context,x)}}return!0},d.prototype.on=function(p,m,g){return h(this,p,m,g,!1)},d.prototype.once=function(p,m,g){return h(this,p,m,g,!0)},d.prototype.removeListener=function(p,m,g,_){var y=c?c+p:p;if(!this._events[y])return this;if(!m)return f(this,y),this;var v=this._events[y];if(v.fn)v.fn!==m||_&&!v.once||g&&v.context!==g||f(this,y);else{for(var E=0,x=[],A=v.length;E<A;E++)(v[E].fn!==m||_&&!v[E].once||g&&v[E].context!==g)&&x.push(v[E]);x.length?this._events[y]=x.length===1?x[0]:x:f(this,y)}return this},d.prototype.removeAllListeners=function(p){var m;return p?(m=c?c+p:p,this._events[m]&&f(this,m)):(this._events=new l,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=c,d.EventEmitter=d,o.exports=d},8954:function(o){var a;a=()=>(()=>{var c={228:h=>{var f=Object.prototype.hasOwnProperty,d="~";function p(){}function m(v,E,x){this.fn=v,this.context=E,this.once=x||!1}function g(v,E,x,A,T){if(typeof x!="function")throw new TypeError("The listener must be a function");var k=new m(x,A||v,T),L=d?d+E:E;return v._events[L]?v._events[L].fn?v._events[L]=[v._events[L],k]:v._events[L].push(k):(v._events[L]=k,v._eventsCount++),v}function _(v,E){--v._eventsCount==0?v._events=new p:delete v._events[E]}function y(){this._events=new p,this._eventsCount=0}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(d=!1)),y.prototype.eventNames=function(){var v,E,x=[];if(this._eventsCount===0)return x;for(E in v=this._events)f.call(v,E)&&x.push(d?E.slice(1):E);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(v)):x},y.prototype.listeners=function(v){var E=d?d+v:v,x=this._events[E];if(!x)return[];if(x.fn)return[x.fn];for(var A=0,T=x.length,k=new Array(T);A<T;A++)k[A]=x[A].fn;return k},y.prototype.listenerCount=function(v){var E=d?d+v:v,x=this._events[E];return x?x.fn?1:x.length:0},y.prototype.emit=function(v,E,x,A,T,k){var L=d?d+v:v;if(!this._events[L])return!1;var I,F,M=this._events[L],D=arguments.length;if(M.fn){switch(M.once&&this.removeListener(v,M.fn,void 0,!0),D){case 1:return M.fn.call(M.context),!0;case 2:return M.fn.call(M.context,E),!0;case 3:return M.fn.call(M.context,E,x),!0;case 4:return M.fn.call(M.context,E,x,A),!0;case 5:return M.fn.call(M.context,E,x,A,T),!0;case 6:return M.fn.call(M.context,E,x,A,T,k),!0}for(F=1,I=new Array(D-1);F<D;F++)I[F-1]=arguments[F];M.fn.apply(M.context,I)}else{var O,z=M.length;for(F=0;F<z;F++)switch(M[F].once&&this.removeListener(v,M[F].fn,void 0,!0),D){case 1:M[F].fn.call(M[F].context);break;case 2:M[F].fn.call(M[F].context,E);break;case 3:M[F].fn.call(M[F].context,E,x);break;case 4:M[F].fn.call(M[F].context,E,x,A);break;default:if(!I)for(O=1,I=new Array(D-1);O<D;O++)I[O-1]=arguments[O];M[F].fn.apply(M[F].context,I)}}return!0},y.prototype.on=function(v,E,x){return g(this,v,E,x,!1)},y.prototype.once=function(v,E,x){return g(this,v,E,x,!0)},y.prototype.removeListener=function(v,E,x,A){var T=d?d+v:v;if(!this._events[T])return this;if(!E)return _(this,T),this;var k=this._events[T];if(k.fn)k.fn!==E||A&&!k.once||x&&k.context!==x||_(this,T);else{for(var L=0,I=[],F=k.length;L<F;L++)(k[L].fn!==E||A&&!k[L].once||x&&k[L].context!==x)&&I.push(k[L]);I.length?this._events[T]=I.length===1?I[0]:I:_(this,T)}return this},y.prototype.removeAllListeners=function(v){var E;return v?(E=d?d+v:v,this._events[E]&&_(this,E)):(this._events=new p,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=d,y.EventEmitter=y,h.exports=y},1549:(h,f,d)=>{var p=d(2032),m=d(3862),g=d(6721),_=d(2749),y=d(5749);function v(E){var x=-1,A=E==null?0:E.length;for(this.clear();++x<A;){var T=E[x];this.set(T[0],T[1])}}v.prototype.clear=p,v.prototype.delete=m,v.prototype.get=g,v.prototype.has=_,v.prototype.set=y,h.exports=v},79:(h,f,d)=>{var p=d(3702),m=d(80),g=d(4739),_=d(8655),y=d(1175);function v(E){var x=-1,A=E==null?0:E.length;for(this.clear();++x<A;){var T=E[x];this.set(T[0],T[1])}}v.prototype.clear=p,v.prototype.delete=m,v.prototype.get=g,v.prototype.has=_,v.prototype.set=y,h.exports=v},8223:(h,f,d)=>{var p=d(6110)(d(9325),"Map");h.exports=p},3661:(h,f,d)=>{var p=d(3040),m=d(7670),g=d(289),_=d(4509),y=d(2949);function v(E){var x=-1,A=E==null?0:E.length;for(this.clear();++x<A;){var T=E[x];this.set(T[0],T[1])}}v.prototype.clear=p,v.prototype.delete=m,v.prototype.get=g,v.prototype.has=_,v.prototype.set=y,h.exports=v},7217:(h,f,d)=>{var p=d(79),m=d(1420),g=d(938),_=d(3605),y=d(9817),v=d(945);function E(x){var A=this.__data__=new p(x);this.size=A.size}E.prototype.clear=m,E.prototype.delete=g,E.prototype.get=_,E.prototype.has=y,E.prototype.set=v,h.exports=E},1873:(h,f,d)=>{var p=d(9325).Symbol;h.exports=p},7828:(h,f,d)=>{var p=d(9325).Uint8Array;h.exports=p},1033:h=>{h.exports=function(f,d,p){switch(p.length){case 0:return f.call(d);case 1:return f.call(d,p[0]);case 2:return f.call(d,p[0],p[1]);case 3:return f.call(d,p[0],p[1],p[2])}return f.apply(d,p)}},695:(h,f,d)=>{var p=d(8096),m=d(2428),g=d(6449),_=d(3656),y=d(361),v=d(7167),E=Object.prototype.hasOwnProperty;h.exports=function(x,A){var T=g(x),k=!T&&m(x),L=!T&&!k&&_(x),I=!T&&!k&&!L&&v(x),F=T||k||L||I,M=F?p(x.length,String):[],D=M.length;for(var O in x)!A&&!E.call(x,O)||F&&(O=="length"||L&&(O=="offset"||O=="parent")||I&&(O=="buffer"||O=="byteLength"||O=="byteOffset")||y(O,D))||M.push(O);return M}},7805:(h,f,d)=>{var p=d(3360),m=d(5288);h.exports=function(g,_,y){(y!==void 0&&!m(g[_],y)||y===void 0&&!(_ in g))&&p(g,_,y)}},6547:(h,f,d)=>{var p=d(3360),m=d(5288),g=Object.prototype.hasOwnProperty;h.exports=function(_,y,v){var E=_[y];g.call(_,y)&&m(E,v)&&(v!==void 0||y in _)||p(_,y,v)}},6025:(h,f,d)=>{var p=d(5288);h.exports=function(m,g){for(var _=m.length;_--;)if(p(m[_][0],g))return _;return-1}},3360:(h,f,d)=>{var p=d(3243);h.exports=function(m,g,_){g=="__proto__"&&p?p(m,g,{configurable:!0,enumerable:!0,value:_,writable:!0}):m[g]=_}},9344:(h,f,d)=>{var p=d(3805),m=Object.create,g=(function(){function _(){}return function(y){if(!p(y))return{};if(m)return m(y);_.prototype=y;var v=new _;return _.prototype=void 0,v}})();h.exports=g},6649:(h,f,d)=>{var p=d(3221)();h.exports=p},2552:(h,f,d)=>{var p=d(1873),m=d(659),g=d(9350),_=p?p.toStringTag:void 0;h.exports=function(y){return y==null?y===void 0?"[object Undefined]":"[object Null]":_&&_ in Object(y)?m(y):g(y)}},7534:(h,f,d)=>{var p=d(2552),m=d(346);h.exports=function(g){return m(g)&&p(g)=="[object Arguments]"}},5083:(h,f,d)=>{var p=d(1882),m=d(7296),g=d(3805),_=d(7473),y=/^\[object .+?Constructor\]$/,v=Function.prototype,E=Object.prototype,x=v.toString,A=E.hasOwnProperty,T=RegExp("^"+x.call(A).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");h.exports=function(k){return!(!g(k)||m(k))&&(p(k)?T:y).test(_(k))}},4901:(h,f,d)=>{var p=d(2552),m=d(294),g=d(346),_={};_["[object Float32Array]"]=_["[object Float64Array]"]=_["[object Int8Array]"]=_["[object Int16Array]"]=_["[object Int32Array]"]=_["[object Uint8Array]"]=_["[object Uint8ClampedArray]"]=_["[object Uint16Array]"]=_["[object Uint32Array]"]=!0,_["[object Arguments]"]=_["[object Array]"]=_["[object ArrayBuffer]"]=_["[object Boolean]"]=_["[object DataView]"]=_["[object Date]"]=_["[object Error]"]=_["[object Function]"]=_["[object Map]"]=_["[object Number]"]=_["[object Object]"]=_["[object RegExp]"]=_["[object Set]"]=_["[object String]"]=_["[object WeakMap]"]=!1,h.exports=function(y){return g(y)&&m(y.length)&&!!_[p(y)]}},2903:(h,f,d)=>{var p=d(3805),m=d(5527),g=d(181),_=Object.prototype.hasOwnProperty;h.exports=function(y){if(!p(y))return g(y);var v=m(y),E=[];for(var x in y)(x!="constructor"||!v&&_.call(y,x))&&E.push(x);return E}},5250:(h,f,d)=>{var p=d(7217),m=d(7805),g=d(6649),_=d(2824),y=d(3805),v=d(7241),E=d(4974);h.exports=function x(A,T,k,L,I){A!==T&&g(T,(function(F,M){if(I||(I=new p),y(F))_(A,T,M,k,x,L,I);else{var D=L?L(E(A,M),F,M+"",A,T,I):void 0;D===void 0&&(D=F),m(A,M,D)}}),v)}},2824:(h,f,d)=>{var p=d(7805),m=d(3290),g=d(1961),_=d(3007),y=d(5529),v=d(2428),E=d(6449),x=d(3693),A=d(3656),T=d(1882),k=d(3805),L=d(1331),I=d(7167),F=d(4974),M=d(9884);h.exports=function(D,O,z,q,G,K,te){var re=F(D,z),H=F(O,z),Y=te.get(H);if(Y)p(D,z,Y);else{var Z=K?K(re,H,z+"",D,O,te):void 0,Q=Z===void 0;if(Q){var ie=E(H),ge=!ie&&A(H),Te=!ie&&!ge&&I(H);Z=H,ie||ge||Te?E(re)?Z=re:x(re)?Z=_(re):ge?(Q=!1,Z=m(H,!0)):Te?(Q=!1,Z=g(H,!0)):Z=[]:L(H)||v(H)?(Z=re,v(re)?Z=M(re):k(re)&&!T(re)||(Z=y(H))):Q=!1}Q&&(te.set(H,Z),G(Z,H,q,K,te),te.delete(H)),p(D,z,Z)}}},9302:(h,f,d)=>{var p=d(3488),m=d(6757),g=d(2865);h.exports=function(_,y){return g(m(_,y,p),_+"")}},9570:(h,f,d)=>{var p=d(7334),m=d(3243),g=d(3488),_=m?function(y,v){return m(y,"toString",{configurable:!0,enumerable:!1,value:p(v),writable:!0})}:g;h.exports=_},8096:h=>{h.exports=function(f,d){for(var p=-1,m=Array(f);++p<f;)m[p]=d(p);return m}},7301:h=>{h.exports=function(f){return function(d){return f(d)}}},9653:(h,f,d)=>{var p=d(7828);h.exports=function(m){var g=new m.constructor(m.byteLength);return new p(g).set(new p(m)),g}},3290:(h,f,d)=>{h=d.nmd(h);var p=d(9325),m=f&&!f.nodeType&&f,g=m&&h&&!h.nodeType&&h,_=g&&g.exports===m?p.Buffer:void 0,y=_?_.allocUnsafe:void 0;h.exports=function(v,E){if(E)return v.slice();var x=v.length,A=y?y(x):new v.constructor(x);return v.copy(A),A}},1961:(h,f,d)=>{var p=d(9653);h.exports=function(m,g){var _=g?p(m.buffer):m.buffer;return new m.constructor(_,m.byteOffset,m.length)}},3007:h=>{h.exports=function(f,d){var p=-1,m=f.length;for(d||(d=Array(m));++p<m;)d[p]=f[p];return d}},1791:(h,f,d)=>{var p=d(6547),m=d(3360);h.exports=function(g,_,y,v){var E=!y;y||(y={});for(var x=-1,A=_.length;++x<A;){var T=_[x],k=v?v(y[T],g[T],T,y,g):void 0;k===void 0&&(k=g[T]),E?m(y,T,k):p(y,T,k)}return y}},5481:(h,f,d)=>{var p=d(9325)["__core-js_shared__"];h.exports=p},999:(h,f,d)=>{var p=d(9302),m=d(6800);h.exports=function(g){return p((function(_,y){var v=-1,E=y.length,x=E>1?y[E-1]:void 0,A=E>2?y[2]:void 0;for(x=g.length>3&&typeof x=="function"?(E--,x):void 0,A&&m(y[0],y[1],A)&&(x=E<3?void 0:x,E=1),_=Object(_);++v<E;){var T=y[v];T&&g(_,T,v,x)}return _}))}},3221:h=>{h.exports=function(f){return function(d,p,m){for(var g=-1,_=Object(d),y=m(d),v=y.length;v--;){var E=y[f?v:++g];if(p(_[E],E,_)===!1)break}return d}}},3243:(h,f,d)=>{var p=d(6110),m=(function(){try{var g=p(Object,"defineProperty");return g({},"",{}),g}catch{}})();h.exports=m},4840:(h,f,d)=>{var p=typeof d.g=="object"&&d.g&&d.g.Object===Object&&d.g;h.exports=p},2651:(h,f,d)=>{var p=d(4218);h.exports=function(m,g){var _=m.__data__;return p(g)?_[typeof g=="string"?"string":"hash"]:_.map}},6110:(h,f,d)=>{var p=d(5083),m=d(392);h.exports=function(g,_){var y=m(g,_);return p(y)?y:void 0}},8879:(h,f,d)=>{var p=d(4335)(Object.getPrototypeOf,Object);h.exports=p},659:(h,f,d)=>{var p=d(1873),m=Object.prototype,g=m.hasOwnProperty,_=m.toString,y=p?p.toStringTag:void 0;h.exports=function(v){var E=g.call(v,y),x=v[y];try{v[y]=void 0;var A=!0}catch{}var T=_.call(v);return A&&(E?v[y]=x:delete v[y]),T}},392:h=>{h.exports=function(f,d){return f?.[d]}},2032:(h,f,d)=>{var p=d(1042);h.exports=function(){this.__data__=p?p(null):{},this.size=0}},3862:h=>{h.exports=function(f){var d=this.has(f)&&delete this.__data__[f];return this.size-=d?1:0,d}},6721:(h,f,d)=>{var p=d(1042),m=Object.prototype.hasOwnProperty;h.exports=function(g){var _=this.__data__;if(p){var y=_[g];return y==="__lodash_hash_undefined__"?void 0:y}return m.call(_,g)?_[g]:void 0}},2749:(h,f,d)=>{var p=d(1042),m=Object.prototype.hasOwnProperty;h.exports=function(g){var _=this.__data__;return p?_[g]!==void 0:m.call(_,g)}},5749:(h,f,d)=>{var p=d(1042);h.exports=function(m,g){var _=this.__data__;return this.size+=this.has(m)?0:1,_[m]=p&&g===void 0?"__lodash_hash_undefined__":g,this}},5529:(h,f,d)=>{var p=d(9344),m=d(8879),g=d(5527);h.exports=function(_){return typeof _.constructor!="function"||g(_)?{}:p(m(_))}},361:h=>{var f=/^(?:0|[1-9]\d*)$/;h.exports=function(d,p){var m=typeof d;return!!(p=p??9007199254740991)&&(m=="number"||m!="symbol"&&f.test(d))&&d>-1&&d%1==0&&d<p}},6800:(h,f,d)=>{var p=d(5288),m=d(4894),g=d(361),_=d(3805);h.exports=function(y,v,E){if(!_(E))return!1;var x=typeof v;return!!(x=="number"?m(E)&&g(v,E.length):x=="string"&&v in E)&&p(E[v],y)}},4218:h=>{h.exports=function(f){var d=typeof f;return d=="string"||d=="number"||d=="symbol"||d=="boolean"?f!=="__proto__":f===null}},7296:(h,f,d)=>{var p,m=d(5481),g=(p=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+p:"";h.exports=function(_){return!!g&&g in _}},5527:h=>{var f=Object.prototype;h.exports=function(d){var p=d&&d.constructor;return d===(typeof p=="function"&&p.prototype||f)}},3702:h=>{h.exports=function(){this.__data__=[],this.size=0}},80:(h,f,d)=>{var p=d(6025),m=Array.prototype.splice;h.exports=function(g){var _=this.__data__,y=p(_,g);return!(y<0||(y==_.length-1?_.pop():m.call(_,y,1),--this.size,0))}},4739:(h,f,d)=>{var p=d(6025);h.exports=function(m){var g=this.__data__,_=p(g,m);return _<0?void 0:g[_][1]}},8655:(h,f,d)=>{var p=d(6025);h.exports=function(m){return p(this.__data__,m)>-1}},1175:(h,f,d)=>{var p=d(6025);h.exports=function(m,g){var _=this.__data__,y=p(_,m);return y<0?(++this.size,_.push([m,g])):_[y][1]=g,this}},3040:(h,f,d)=>{var p=d(1549),m=d(79),g=d(8223);h.exports=function(){this.size=0,this.__data__={hash:new p,map:new(g||m),string:new p}}},7670:(h,f,d)=>{var p=d(2651);h.exports=function(m){var g=p(this,m).delete(m);return this.size-=g?1:0,g}},289:(h,f,d)=>{var p=d(2651);h.exports=function(m){return p(this,m).get(m)}},4509:(h,f,d)=>{var p=d(2651);h.exports=function(m){return p(this,m).has(m)}},2949:(h,f,d)=>{var p=d(2651);h.exports=function(m,g){var _=p(this,m),y=_.size;return _.set(m,g),this.size+=_.size==y?0:1,this}},1042:(h,f,d)=>{var p=d(6110)(Object,"create");h.exports=p},181:h=>{h.exports=function(f){var d=[];if(f!=null)for(var p in Object(f))d.push(p);return d}},6009:(h,f,d)=>{h=d.nmd(h);var p=d(4840),m=f&&!f.nodeType&&f,g=m&&h&&!h.nodeType&&h,_=g&&g.exports===m&&p.process,y=(function(){try{return g&&g.require&&g.require("util").types||_&&_.binding&&_.binding("util")}catch{}})();h.exports=y},9350:h=>{var f=Object.prototype.toString;h.exports=function(d){return f.call(d)}},4335:h=>{h.exports=function(f,d){return function(p){return f(d(p))}}},6757:(h,f,d)=>{var p=d(1033),m=Math.max;h.exports=function(g,_,y){return _=m(_===void 0?g.length-1:_,0),function(){for(var v=arguments,E=-1,x=m(v.length-_,0),A=Array(x);++E<x;)A[E]=v[_+E];E=-1;for(var T=Array(_+1);++E<_;)T[E]=v[E];return T[_]=y(A),p(g,this,T)}}},9325:(h,f,d)=>{var p=d(4840),m=typeof self=="object"&&self&&self.Object===Object&&self,g=p||m||Function("return this")();h.exports=g},4974:h=>{h.exports=function(f,d){if((d!=="constructor"||typeof f[d]!="function")&&d!="__proto__")return f[d]}},2865:(h,f,d)=>{var p=d(9570),m=d(1811)(p);h.exports=m},1811:h=>{var f=Date.now;h.exports=function(d){var p=0,m=0;return function(){var g=f(),_=16-(g-m);if(m=g,_>0){if(++p>=800)return arguments[0]}else p=0;return d.apply(void 0,arguments)}}},1420:(h,f,d)=>{var p=d(79);h.exports=function(){this.__data__=new p,this.size=0}},938:h=>{h.exports=function(f){var d=this.__data__,p=d.delete(f);return this.size=d.size,p}},3605:h=>{h.exports=function(f){return this.__data__.get(f)}},9817:h=>{h.exports=function(f){return this.__data__.has(f)}},945:(h,f,d)=>{var p=d(79),m=d(8223),g=d(3661);h.exports=function(_,y){var v=this.__data__;if(v instanceof p){var E=v.__data__;if(!m||E.length<199)return E.push([_,y]),this.size=++v.size,this;v=this.__data__=new g(E)}return v.set(_,y),this.size=v.size,this}},7473:h=>{var f=Function.prototype.toString;h.exports=function(d){if(d!=null){try{return f.call(d)}catch{}try{return d+""}catch{}}return""}},7334:h=>{h.exports=function(f){return function(){return f}}},5288:h=>{h.exports=function(f,d){return f===d||f!=f&&d!=d}},3488:h=>{h.exports=function(f){return f}},2428:(h,f,d)=>{var p=d(7534),m=d(346),g=Object.prototype,_=g.hasOwnProperty,y=g.propertyIsEnumerable,v=p((function(){return arguments})())?p:function(E){return m(E)&&_.call(E,"callee")&&!y.call(E,"callee")};h.exports=v},6449:h=>{var f=Array.isArray;h.exports=f},4894:(h,f,d)=>{var p=d(1882),m=d(294);h.exports=function(g){return g!=null&&m(g.length)&&!p(g)}},3693:(h,f,d)=>{var p=d(4894),m=d(346);h.exports=function(g){return m(g)&&p(g)}},3656:(h,f,d)=>{h=d.nmd(h);var p=d(9325),m=d(9935),g=f&&!f.nodeType&&f,_=g&&h&&!h.nodeType&&h,y=_&&_.exports===g?p.Buffer:void 0,v=(y?y.isBuffer:void 0)||m;h.exports=v},1882:(h,f,d)=>{var p=d(2552),m=d(3805);h.exports=function(g){if(!m(g))return!1;var _=p(g);return _=="[object Function]"||_=="[object GeneratorFunction]"||_=="[object AsyncFunction]"||_=="[object Proxy]"}},294:h=>{h.exports=function(f){return typeof f=="number"&&f>-1&&f%1==0&&f<=9007199254740991}},3805:h=>{h.exports=function(f){var d=typeof f;return f!=null&&(d=="object"||d=="function")}},346:h=>{h.exports=function(f){return f!=null&&typeof f=="object"}},1331:(h,f,d)=>{var p=d(2552),m=d(8879),g=d(346),_=Function.prototype,y=Object.prototype,v=_.toString,E=y.hasOwnProperty,x=v.call(Object);h.exports=function(A){if(!g(A)||p(A)!="[object Object]")return!1;var T=m(A);if(T===null)return!0;var k=E.call(T,"constructor")&&T.constructor;return typeof k=="function"&&k instanceof k&&v.call(k)==x}},7167:(h,f,d)=>{var p=d(4901),m=d(7301),g=d(6009),_=g&&g.isTypedArray,y=_?m(_):p;h.exports=y},7241:(h,f,d)=>{var p=d(695),m=d(2903),g=d(4894);h.exports=function(_){return g(_)?p(_,!0):m(_)}},6924:(h,f,d)=>{var p=d(5250),m=d(999)((function(g,_,y,v){p(g,_,y,v)}));h.exports=m},9935:h=>{h.exports=function(){return!1}},9884:(h,f,d)=>{var p=d(1791),m=d(7241);h.exports=function(g){return p(g,m(g))}},4355:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CriteriaInputs=f.BooleanComparisonSchema=void 0;var p=d(4713);f.BooleanComparisonSchema={comparison:{type:"string",required:!0},format:{type:"string",required:!0},value:{type:"string",required:!1}};var m=(function(){function g(_){this.inputs=_}return g.prototype.matches=function(_,y){if(y.length===0)return{success:!0,matched:!1};var v=this.inputs[_];if(v===void 0)return{success:!0,matched:!1};for(var E=0,x=y;E<x.length;E++){var A=x[E],T=this.matchSingleFilter(_,v,A);if(!T.success)return T;if(T.matched)return{success:!0,matched:!0}}return{success:!0,matched:!1}},g.prototype.matchSingleFilter=function(_,y,v){return this.isPrimitiveFilter(v)?this.matchPrimitive(y,v):this.isComparatorFilter(v)?this.matchComparator(_,y,v):{success:!1,error:"Invalid filter type for property ".concat(_)}},g.prototype.matchPrimitive=function(_,y){return typeof _!=typeof y?{success:!0,matched:!1}:typeof _=="string"&&typeof y=="string"?{success:!0,matched:(0,p.matchesWithWildcard)(_,y)}:{success:!0,matched:_===y}},g.prototype.matchComparator=function(_,y,v){var E=v.comparison,x=v.format,A=v.value;return this.isValidComparisonOperator(E)?x==="semver"?this.matchSemverComparator(y,E,A):x==="number"?this.matchNumberComparator(y,E,A):{success:!1,error:"Unknown comparator format: ".concat(x)}:{success:!1,error:"Invalid comparison operator: ".concat(E)}},g.prototype.matchSemverComparator=function(_,y,v){if(typeof _!="string")return{success:!1,error:"Input value must be string for semver comparison"};var E=(0,p.compareSemvers)(_,v);return E===void 0?{success:!1,error:'Invalid semver: input="'.concat(_,'", filter="').concat(v,'"')}:{success:!0,matched:this.evaluateComparison(E,y)}},g.prototype.matchNumberComparator=function(_,y,v){if(typeof _!="number")return{success:!1,error:"Input value must be number for number comparison"};var E,x=parseFloat(v);return isNaN(x)?{success:!1,error:"Invalid number in filter: ".concat(v)}:(E=_<x?-1:_>x?1:0,{success:!0,matched:this.evaluateComparison(E,y)})},g.prototype.evaluateComparison=function(_,y){switch(y){case"<":return _<0;case"<=":return _<=0;case">":return _>0;case">=":return _>=0;case"==":return _===0;case"!=":return _!==0;default:return!1}},g.prototype.isPrimitiveFilter=function(_){return typeof _=="string"||typeof _=="number"||typeof _=="boolean"},g.prototype.isComparatorFilter=function(_){return typeof _=="object"&&_!==null&&"comparison"in _&&"format"in _&&"value"in _},g.prototype.isValidComparisonOperator=function(_){return["<","<=",">",">=","==","!="].includes(_)},g})();f.CriteriaInputs=m},5185:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CriteriaParser=f.DeviceConfigCriteriaConfigSchema=f.DeviceConfigCriteriaSchema=f.DeviceConfigRulesSchema=void 0;var p=d(4293);f.DeviceConfigRulesSchema={},f.DeviceConfigCriteriaSchema={version:{type:"number",required:!0},rules:{type:"object",required:!0,config:{schema:f.DeviceConfigRulesSchema}}},f.DeviceConfigCriteriaConfigSchema={criteria:{type:"object",required:!0,config:{schema:f.DeviceConfigCriteriaSchema}},payload:{type:"object",required:!0,config:{schema:{}}}};var m=(function(){function g(){}return Object.defineProperty(g,"CURRENT_VERSION",{get:function(){return this.SUPPORTED_VERSION},enumerable:!1,configurable:!0}),g.evaluateCriteria=function(_,y){if(!_.criteria)return(0,p.err)("Missing criteria object");var v=_.criteria;if(v.version!==this.SUPPORTED_VERSION)return(0,p.ok)({matched:!1});if(!v.rules)return(0,p.err)("Missing rules in criteria");var E=v.rules;if(Object.keys(E).length===0)return(0,p.ok)({matched:!0,payload:_.payload});for(var x=0,A=Object.entries(E);x<A.length;x++){var T=A[x],k=T[0],L=T[1],I=y.matches(k,L);if(!I.success)return(0,p.err)(I.error||"Match evaluation failed");if(!I.matched)return(0,p.ok)({matched:!1})}return(0,p.ok)({matched:!0,payload:_.payload})},g.matchingPayloads=function(_,y){for(var v=[],E=[],x=0,A=_;x<A.length;x++){var T=A[x],k=this.evaluateCriteria(T,y);k.ok?k.value.matched&&k.value.payload!==void 0&&v.push(k.value.payload):E.push(k.error)}return E.length>0?(0,p.err)(E):(0,p.ok)({payloads:v})},g.matches=function(_,y,v){return v.matches(_,y)},g.SUPPORTED_VERSION=1,g})();f.CriteriaParser=m},4713:(h,f)=>{function d(p){if(p&&typeof p=="string"){var m=p.split("+")[0];if(m){var g=m.split("-"),_=g[0],y=g.slice(1);if(_){var v=_.split(".");if(!(v.length===0||v.length>3||v.some((function(M){return M===""||!/^\d+$/.test(M)})))){var E=v.map((function(M){return parseInt(M,10)})),x=E[0],A=x===void 0?0:x,T=E[1],k=T===void 0?0:T,L=E[2],I={major:A,minor:k,patch:L===void 0?0:L};if(y.length>0){var F=y.join("-");F&&(I.prerelease=F.split("."))}return I}}}}}Object.defineProperty(f,"__esModule",{value:!0}),f.compareSemvers=f.parseSemver=f.matchesWithWildcard=void 0,f.matchesWithWildcard=function(p,m){if(m==="*")return!0;if(m.endsWith("*")){var g=m.slice(0,-1);return p.indexOf(g)===0}return p===m},f.parseSemver=d,f.compareSemvers=function(p,m){var g=d(p),_=d(m);if(g&&_){if(g.major!==_.major)return g.major>_.major?1:-1;if(g.minor!==_.minor)return g.minor>_.minor?1:-1;if(g.patch!==_.patch)return g.patch>_.patch?1:-1;var y=g.prerelease&&g.prerelease.length>0,v=_.prerelease&&_.prerelease.length>0;if(y&&!v)return-1;if(!y&&v)return 1;if(!y&&!v)return 0;for(var E=g.prerelease,x=_.prerelease,A=Math.max(E.length,x.length),T=0;T<A;T++){var k=E[T],L=x[T];if(k===void 0)return-1;if(L===void 0)return 1;var I=/^\d+$/.test(k),F=/^\d+$/.test(L);if(I&&F){var M=parseInt(k,10),D=parseInt(L,10);if(M!==D)return M>D?1:-1}else{if(I&&!F)return-1;if(!I&&F)return 1;if(k!==L)return k>L?1:-1}}return 0}}},6270:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigRulesSchema=f.DeviceConfigCriteriaSchema=f.DeviceConfigCriteriaConfigSchema=f.CriteriaParser=f.BooleanComparisonSchema=f.CriteriaInputs=f.compareSemvers=f.parseSemver=f.matchesWithWildcard=void 0;var p=d(4713);Object.defineProperty(f,"matchesWithWildcard",{enumerable:!0,get:function(){return p.matchesWithWildcard}}),Object.defineProperty(f,"parseSemver",{enumerable:!0,get:function(){return p.parseSemver}}),Object.defineProperty(f,"compareSemvers",{enumerable:!0,get:function(){return p.compareSemvers}});var m=d(4355);Object.defineProperty(f,"CriteriaInputs",{enumerable:!0,get:function(){return m.CriteriaInputs}}),Object.defineProperty(f,"BooleanComparisonSchema",{enumerable:!0,get:function(){return m.BooleanComparisonSchema}});var g=d(5185);Object.defineProperty(f,"CriteriaParser",{enumerable:!0,get:function(){return g.CriteriaParser}}),Object.defineProperty(f,"DeviceConfigCriteriaConfigSchema",{enumerable:!0,get:function(){return g.DeviceConfigCriteriaConfigSchema}}),Object.defineProperty(f,"DeviceConfigCriteriaSchema",{enumerable:!0,get:function(){return g.DeviceConfigCriteriaSchema}}),Object.defineProperty(f,"DeviceConfigRulesSchema",{enumerable:!0,get:function(){return g.DeviceConfigRulesSchema}})},7094:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DefaultClock=f.DefaultStorage=f.DefaultAnalytics=f.DefaultTrace=f.getDefaultConfigRefreshOptions=f.getDefaultCommonAnalytics=f.DEFAULT_INITIAL_DELAY_SECONDS=f.DEFAULT_HTTP_TIMEOUT_SECONDS=f.DEFAULT_STOP_REFRESH_AFTER_SECONDS=f.DEFAULT_MAX_AGE_CACHE_SECONDS=f.DEFAULT_RETRY_INTERVAL_SECONDS=f.DEFAULT_RETRY_COUNT=f.DEFAULT_REFRESH_INTERVAL_SECONDS=f.STORAGE_PREFIX_KEY=f.ENCODING_BASE64=f.STATE_KEY=f.DATA_KEY=void 0;var p=d(3259),m=d(4811);f.DATA_KEY="data",f.STATE_KEY="state",f.ENCODING_BASE64="base64",f.STORAGE_PREFIX_KEY="amazon_ivs_device_config_v1_",f.DEFAULT_REFRESH_INTERVAL_SECONDS=(0,p.minutesToSeconds)(15),f.DEFAULT_RETRY_COUNT=3,f.DEFAULT_RETRY_INTERVAL_SECONDS=10,f.DEFAULT_MAX_AGE_CACHE_SECONDS=(0,p.daysToSeconds)(3),f.DEFAULT_STOP_REFRESH_AFTER_SECONDS=(0,p.hoursToSeconds)(2),f.DEFAULT_HTTP_TIMEOUT_SECONDS=15,f.DEFAULT_INITIAL_DELAY_SECONDS=5,f.getDefaultCommonAnalytics=function(){return{client_sdk:"unknown",env:m.DeviceConfigEnv.PROD}},f.getDefaultConfigRefreshOptions=function(){return{refreshIntervalSeconds:f.DEFAULT_REFRESH_INTERVAL_SECONDS,retryCount:f.DEFAULT_RETRY_COUNT,retryIntervalSeconds:f.DEFAULT_RETRY_INTERVAL_SECONDS,maxCacheAgeSeconds:f.DEFAULT_MAX_AGE_CACHE_SECONDS,stopRefreshAfterSeconds:f.DEFAULT_STOP_REFRESH_AFTER_SECONDS,canRefreshNow:function(){return!0}}};var g=(function(){function E(x){this.enableConsoleLog=x}return E.prototype.onTrace=function(x){this.enableConsoleLog&&console.log("DeviceConfig trace: "+x)},E})();f.DefaultTrace=g;var _=(function(){function E(x){this.enableConsoleLog=x}return E.prototype.onValue=function(x){this.enableConsoleLog&&console.log("DeviceConfig analytics value:  ".concat(x))},E.prototype.onError=function(x){this.enableConsoleLog&&console.error("DeviceConfig analytics error: ".concat(x))},E.prototype.onTrace=function(x){this.enableConsoleLog&&console.log("DeviceConfig analytics trace: ".concat(x))},E.prototype.onAssignment=function(x){this.enableConsoleLog&&console.log("DeviceConfig analytics assignment: ".concat(x))},E})();f.DefaultAnalytics=_;var y=(function(){function E(x,A){this.prefix=x,this.storage=A}return E.prototype.getJson=function(x){var A=this.prefix+"_"+x;try{var T=this.storage.getItem(A);if(T)return JSON.parse(T)}catch(k){console.error("Error getting local storage key ".concat(A)+k)}return null},E.prototype.setJson=function(x,A){var T=this.prefix+"_"+x;try{this.storage.setItem(T,JSON.stringify(A))}catch(k){console.error("Error setting local storage key ".concat(T,": ")+k)}},E})();f.DefaultStorage=y;var v=(function(){function E(){}return E.prototype.getMillis=function(){return Date.now()},E})();f.DefaultClock=v},9225:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BucketAssignmentManager=f.PERCENTAGE_SUM_TOLERANCE=void 0;var p=d(8177),m=d(4293),g=d(5234);f.PERCENTAGE_SUM_TOLERANCE=.001;var _=(function(){function y(){}return y.prototype.roll=function(v){var E=(0,p.getSecureRandom)();return E.method!==p.SecureRandomMethod.CRYPTO_RANDOM_VALUES&&v.push({type:g.RolloutWarningType.NON_IDEAL_RANDOM_GENERATED,context:{details:E.method}}),E.value},y.prototype.assignVariant=function(v,E){var x=[],A=this.validateRollout(v,x);return A.ok?E&&v["rollout-id"]===E.rolloutId?(0,m.ok)({variant:E.assignedVariant,shouldUpdateState:!1,warnings:x}):v["force-redistribute"]?this.performInitialAssignment(v,x):E?this.performStickyAssignment(v,E,x):this.performInitialAssignment(v,x):A},y.prototype.validateRollout=function(v,E){var x=v.variants;if(x.length===0)return(0,m.err)("Empty variants array");var A=this.calculateTotalPercentage(x,E);return Math.abs(A-1)>f.PERCENTAGE_SUM_TOLERANCE?(0,m.err)("Variant percentages don't sum to 1.0 within ".concat(f.PERCENTAGE_SUM_TOLERANCE," tolerance (got ").concat(A,")")):(0,m.ok)(v)},y.prototype.calculateTotalPercentage=function(v,E){return v.reduce((function(x,A){var T=Object.values(A);return T.length>1&&E.push({type:g.RolloutWarningType.UNEXPECTED_VARIANT_PROPERTIES,context:{details:"Found more than 1 value for variant: ".concat(T)}}),x+T[0]}),0)},y.prototype.performInitialAssignment=function(v,E){var x=this.roll(E),A=this.selectVariantFromRoll(v.variants,x);return(0,m.ok)({variant:A,shouldUpdateState:!0,warnings:E})},y.prototype.performStickyAssignment=function(v,E,x){var A=E.assignedVariant,T=E.rolloutConfig,k=this.getVariantPercentage(v.variants,A),L=this.getVariantPercentage(T.variants,A);if(!k.ok)return this.performInitialAssignment(v,x);var I=k.value;if(!L.ok||I>=L.value)return L.ok||x.push({type:g.RolloutWarningType.PREVIOUS_VARIANT_NOT_FOUND,context:{details:"Previous variant not found: ".concat(A)}}),(0,m.ok)({variant:A,shouldUpdateState:!0,warnings:x});var F=I/L.value;if(this.roll(x)<=F)return(0,m.ok)({variant:A,shouldUpdateState:!0,warnings:x});var M=this.calculateFreeCapacity(v.variants,T.variants),D=this.roll(x),O=this.selectVariantFromRoll(M,D);return(0,m.ok)({variant:O,shouldUpdateState:!0,warnings:x})},y.prototype.getVariantPercentage=function(v,E){for(var x=0,A=v;x<A.length;x++){var T=A[x];if(T[E]!==void 0)return(0,m.ok)(T[E])}return(0,m.err)("variant not found")},y.prototype.selectVariantFromRoll=function(v,E){for(var x=0,A=0,T=v;A<T.length;A++){var k=T[A],L=Object.entries(k)[0],I=L[0];if(E<=(x+=L[1]))return I}return Object.keys(v[v.length-1])[0]},y.prototype.calculateFreeCapacity=function(v,E){for(var x,A=[],T=0,k=v;T<k.length;T++){var L=k[T],I=Object.entries(L)[0],F=I[0],M=I[1],D=this.getVariantPercentage(E,F),O=0;D.ok&&(O=D.value),M>O&&A.push(((x={})[F]=M-O,x))}return A},y})();f.BucketAssignmentManager=_},5234:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RolloutManager=f.RolloutWarningType=void 0;var p,m=d(2570),g=d(9225),_=d(8177),y=d(4293);(function(E){E.STORAGE_INITIAL_LOAD_FAILED="STORAGE_INITIAL_LOAD_FAILED",E.STORAGE_INITIAL_LOAD_VERSION_MISMATCH="STORAGE_INITIAL_LOAD_VERSION_MISMATCH",E.STORAGE_INITIAL_SAVE_FAILED="STORAGE_INITIAL_SAVE_FAILED",E.STORAGE_SAVE_FAILED="STORAGE_SAVE_FAILED",E.UNEXPECTED_VARIANT_PROPERTIES="UNEXPECTED_VARIANT_PROPERTIES",E.PREVIOUS_VARIANT_NOT_FOUND="PREVIOUS_VARIANT_NOT_FOUND",E.NON_IDEAL_UUID_GENERATED="NON_IDEAL_UUID_GENERATED",E.NON_IDEAL_RANDOM_GENERATED="NON_IDEAL_RANDOM_GENERATED"})(p||(f.RolloutWarningType=p={}));var v=(function(){function E(x){this.rolloutStateManager=new m.LocalStorageRolloutStateManager(x),this.bucketAssignmentManager=new g.BucketAssignmentManager}return E.prototype.getVariantAssignment=function(x){var A=[],T=x["feature-id"],k=this.rolloutStateManager.getRolloutState(T),L=k.state,I=k.warnings;A.push.apply(A,I);var F=this.bucketAssignmentManager.assignVariant(x,L);if(!F.ok)return(0,y.err)(F.error);A.push.apply(A,F.value.warnings);var M=L?.trackingId;if(!M){var D=(0,_.generateUuid)(),O=D.value,z=D.method;M=O,z!==_.UuidMethod.CRYPTO_RANDOM_UUID&&A.push({type:p.NON_IDEAL_UUID_GENERATED,context:{details:z}})}if(F.value.shouldUpdateState){var q={rolloutId:x["rollout-id"],assignedVariant:F.value.variant,rolloutConfig:x,trackingId:M},G=this.rolloutStateManager.setRolloutState(T,q);A.push.apply(A,G.warnings)}return(0,y.ok)({variant:F.value.variant,featureId:T,rolloutId:x["rollout-id"],trackingId:M,warnings:A})},E})();f.RolloutManager=v},7974:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigRolloutSchema=f.DeviceConfigRolloutVariantSchema=void 0,f.DeviceConfigRolloutVariantSchema={},f.DeviceConfigRolloutSchema={variants:{type:"array",required:!0,items:{type:"object",required:!0,config:{schema:f.DeviceConfigRolloutVariantSchema}}},"feature-id":{type:"string",required:!0},"rollout-id":{type:"number",required:!0},"force-redistribute":{type:"boolean",required:!1},version:{type:"number",required:!0}}},2570:function(h,f,d){var p=this&&this.__spreadArray||function(_,y,v){if(v||arguments.length===2)for(var E,x=0,A=y.length;x<A;x++)!E&&x in y||(E||(E=Array.prototype.slice.call(y,0,x)),E[x]=y[x]);return _.concat(E||Array.prototype.slice.call(y))};Object.defineProperty(f,"__esModule",{value:!0}),f.LocalStorageRolloutStateManager=f.DEVICE_CONFIG_STORAGE_VERSION=void 0;var m=d(5234);f.DEVICE_CONFIG_STORAGE_VERSION=1;var g=(function(){function _(y){this.storageKey=(function(A){return"_amazon_ivs_dc_".concat(A,"_b8e4f7c1")})(y);var v=this.loadStorage(),E=v.storage,x=v.warnings;this.storage=E,this.loadWarnings=x}return _.prototype.getRolloutState=function(y){var v;return{state:((v=this.storage.features[y])===null||v===void 0?void 0:v.rolloutState)||null,warnings:p([],this.loadWarnings,!0)}},_.prototype.setRolloutState=function(y,v){return this.storage.features[y]||(this.storage.features[y]={}),this.storage.features[y].rolloutState=v,this.saveStorage()},_.prototype.loadStorage=function(){var y=[];try{var v=localStorage.getItem(this.storageKey);if(v){var E=JSON.parse(v);if(typeof E=="object"){if(E.version===f.DEVICE_CONFIG_STORAGE_VERSION)return{storage:E,warnings:y};y.push({type:m.RolloutWarningType.STORAGE_INITIAL_LOAD_VERSION_MISMATCH,context:{details:"Expected version ".concat(f.DEVICE_CONFIG_STORAGE_VERSION,", but got ").concat(E.version)}})}}}catch(A){y.push({type:m.RolloutWarningType.STORAGE_INITIAL_LOAD_FAILED,context:{error:A}})}var x={version:f.DEVICE_CONFIG_STORAGE_VERSION,features:{}};try{localStorage.setItem(this.storageKey,JSON.stringify(x))}catch(A){y.push({type:m.RolloutWarningType.STORAGE_INITIAL_SAVE_FAILED,context:{error:A}})}return{storage:x,warnings:y}},_.prototype.saveStorage=function(){try{return localStorage.setItem(this.storageKey,JSON.stringify(this.storage)),{warnings:[]}}catch(y){return{warnings:[{type:m.RolloutWarningType.STORAGE_SAVE_FAILED,context:{error:y}}]}}},_})();f.LocalStorageRolloutStateManager=g},3259:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.daysToSeconds=f.hoursToSeconds=f.minutesToSeconds=f.secondsToMillis=f.createPropertyMap=void 0;var p=d(4811);f.createPropertyMap=function(m){return new Map(Object.entries(m).map((function(g){var _=g[0],y=g[1];return[_,new p.Property(_,typeof y=="string"?p.ValueType.STRING:typeof y=="number"?p.ValueType.NUMBER:typeof y=="boolean"?p.ValueType.BOOLEAN:p.ValueType.JSON,typeof y=="string"?y:void 0,typeof y=="number"?y:void 0,typeof y=="boolean"?y:void 0,typeof y=="object"?JSON.stringify(y):void 0,_)]})))},f.secondsToMillis=function(m){return 1e3*m},f.minutesToSeconds=function(m){return 60*m},f.hoursToSeconds=function(m){return 60*m*60},f.daysToSeconds=function(m){return 60*m*60*24}},3723:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.WindowPropertyOverrider=void 0;var p=d(3259);f.WindowPropertyOverrider=function(m){return{getPropertyOverride:function(g){var _,y,v;if(((y=m?.AMAZON_IVS_DEVICE_CONFIG)===null||y===void 0?void 0:y.enableOverrides)===!0&&((v=m.AMAZON_IVS_DEVICE_CONFIG.propertyOverrides)===null||v===void 0?void 0:v[g])!==void 0){var E=m.AMAZON_IVS_DEVICE_CONFIG.propertyOverrides;return(0,p.createPropertyMap)((_={},_[g]=E[g],_)).get(g)}}}}},1743:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(v,E,x,A){A===void 0&&(A=x);var T=Object.getOwnPropertyDescriptor(E,x);T&&!("get"in T?!E.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return E[x]}}),Object.defineProperty(v,A,T)}:function(v,E,x,A){A===void 0&&(A=x),v[A]=E[x]}),m=this&&this.__setModuleDefault||(Object.create?function(v,E){Object.defineProperty(v,"default",{enumerable:!0,value:E})}:function(v,E){v.default=E}),g=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var E={};if(v!=null)for(var x in v)x!=="default"&&Object.prototype.hasOwnProperty.call(v,x)&&p(E,v,x);return m(E,v),E};Object.defineProperty(f,"__esModule",{value:!0}),f.validateSchemaAndReturn=f.validateSchema=void 0;var _=g(d(4293));function y(v,E){var x;if(v==null)return _.err("value is undefined or null");if(typeof v!="object")return _.err("value is not an object");for(var A=v,T=0,k=Object.entries(E);T<k.length;T++){var L=k[T],I=L[0],F=L[1];if(F.type==="object"){if(F.required&&!(I in A))return _.err("".concat(I," is required in schema"));if(A[I]&&!(z=y(A[I],(x=F?.config)===null||x===void 0?void 0:x.schema)).ok)return _.err("".concat(I," ").concat(z.error))}else if(F.type==="array"){if(F.required&&!(I in A))return _.err("".concat(I," is required in schema"));if(I in A){if(!Array.isArray(A[I]))return _.err("".concat(I," is not an array"));if(F.items)for(var M=0,D=A[I];M<D.length;M++){var O=D[M];if(F.items.type==="string"||F.items.type==="number"||F.items.type==="boolean"){if(typeof O!==F.items.type)return _.err("".concat(O," in ").concat(I," is not an ").concat(F.items.type))}else if(F.items.type==="object"&&F.items.config){var z;if(!(z=y(O,F.items.config.schema)).ok)return z}}}}else{if(F.required&&!(I in A))return _.err("".concat(I," is required in schema"));if(I in A&&typeof A[I]!==F.type)return _.err("".concat(I," is not of type ").concat(F.type))}}return _.ok(!0)}f.validateSchema=y,f.validateSchemaAndReturn=function(v,E){var x=y(v,E);return x.ok?_.ok(v):_.err(x.error)}},3840:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.validateSchema=void 0;var p=d(1743);Object.defineProperty(f,"validateSchema",{enumerable:!0,get:function(){return p.validateSchema}})},4811:function(h,f,d){var p,m=this&&this.__extends||(p=function(x,A){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,k){T.__proto__=k}||function(T,k){for(var L in k)Object.prototype.hasOwnProperty.call(k,L)&&(T[L]=k[L])},p(x,A)},function(x,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function T(){this.constructor=x}p(x,A),x.prototype=A===null?Object.create(A):(T.prototype=A.prototype,new T)});Object.defineProperty(f,"__esModule",{value:!0}),f.HttpError=f.StateHolder=f.Property=f.ValueType=f.DeviceConfigEnv=void 0;var g,_,y=d(7094);(function(x){x.BETA="beta",x.PROD="prod",x.CUSTOM="custom"})(g||(f.DeviceConfigEnv=g={})),(function(x){x[x.STRING=0]="STRING",x[x.NUMBER=1]="NUMBER",x[x.BOOLEAN=2]="BOOLEAN",x[x.JSON=3]="JSON"})(_||(f.ValueType=_={})),f.Property=function(x,A,T,k,L,I,F,M){switch(this.name=x,this.type=A,this.valueString=T,this.valueNumber=k,this.valueBoolean=L,this.valueJson=I,this.valueAnalytics=F,this.type){case _.STRING:M===y.ENCODING_BASE64&&T&&(this.valueString=atob(T));break;case _.JSON:M===y.ENCODING_BASE64&&I&&(this.valueJson=atob(I))}};var v=(function(){function x(A,T){var k;this.storage=A,this.key=T,this.state=(k=A.getJson(T))!==null&&k!==void 0?k:{}}return x.prototype.getState=function(){return this.state},x.prototype.setState=function(A){Object.assign(this.state,A),this.storage.setJson(this.key,this.state)},x})();f.StateHolder=v;var E=(function(x){function A(T){return x.call(this,T)||this}return m(A,x),A})(Error);f.HttpError=E},363:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(D){for(var O,z=1,q=arguments.length;z<q;z++)for(var G in O=arguments[z])Object.prototype.hasOwnProperty.call(O,G)&&(D[G]=O[G]);return D},p.apply(this,arguments)},m=this&&this.__spreadArray||function(D,O,z){if(z||arguments.length===2)for(var q,G=0,K=O.length;G<K;G++)!q&&G in O||(q||(q=Array.prototype.slice.call(O,0,G)),q[G]=O[G]);return D.concat(q||Array.prototype.slice.call(O))};Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigPropertyHolder=f.DeviceConfigManager=void 0;var g=d(4478),_=d(6270),y=d(4355),v=d(7094),E=d(3259),x=d(1743),A=d(3723),T=d(5234),k=d(7974),L=d(4811),I=(function(){function D(O,z){var q,G,K,te;if(!z.fileKey)throw new Error("options.fileKey cannot be empty");var re=(q=z.clock)!==null&&q!==void 0?q:new v.DefaultClock,H=re.getMillis();switch(this.context=O,this.fileKey=z.fileKey,this.env=z.standardEnv,z.standardEnv){case L.DeviceConfigEnv.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case L.DeviceConfigEnv.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case L.DeviceConfigEnv.CUSTOM:if(!z.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=z.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(z.standardEnv))}this.trace=(G=z.trace)!==null&&G!==void 0?G:new v.DefaultTrace(z.enableConsoleLog),this.fetch=(K=z.fetch)!==null&&K!==void 0?K:new M(O),this.storage=new v.DefaultStorage(v.STORAGE_PREFIX_KEY+z.fileKey,O.localStorage),this.state=new L.StateHolder(this.storage,v.STATE_KEY),this.refresh=p(p({},(0,v.getDefaultConfigRefreshOptions)()),z.refresh),this.emitMetrics=z.emitMetrics,this.analyticsProperties=(te=z.analyticsProperties)!==null&&te!==void 0?te:(0,v.getDefaultCommonAnalytics)(),this.enableConsoleLog=z.enableConsoleLog,this.clock=re,this.isInitialRefreshDone=!1;var Y=0,Z=this.state.getState();Z&&Z.fetchServer===this.fetchServer&&Z.lastFetchWhenMs&&(Y=Z.lastFetchWhenMs);var Q,ie=re.getMillis(),ge=(ie-Y)/1e3;if(ge<=this.refresh.maxCacheAgeSeconds){var Te=this.storage.getJson(v.DATA_KEY);Te&&Te.fetchServer===this.fetchServer&&this.setData(Te.json)}this.lastUseMs=ie,ge>=this.refresh.refreshIntervalSeconds||Y==0?Q=0:(Q=Math.round(this.refresh.refreshIntervalSeconds-ge),this.isInitialRefreshDone=!0),Q<5&&(Q=v.DEFAULT_INITIAL_DELAY_SECONDS),this.trace.onTrace("Will start refresh in "+Q+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*Q);var be=re.getMillis();this.initialLoadTime=be-H}return D.getInstance=function(O,z){try{if(!(O.fetch&&O.setTimeout&&O.clearTimeout&&O.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(q){return void console.error("Error checking for context properties "+q)}if(this.gInstance){if(this.gInstance.fileKey!=z.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(z.fileKey));return this.gInstance}return this.gInstance=new D(O,z),this.gInstance},D.prototype.getConfigurationHolder=function(O){var z,q,G,K=this.clock.getMillis();this.lastUseMs=K;var te=(z=O.analytics)!==null&&z!==void 0?z:new v.DefaultAnalytics(this.enableConsoleLog),re=0,H=this.state.getState();return H&&H.fetchServer===this.fetchServer&&H.lastFetchWhenMs&&(re=H.lastFetchWhenMs),(K-re)/1e3<=this.refresh.maxCacheAgeSeconds?new F(te,this.analyticsProperties,this.properties,re,this.clock,this.fileKey,(q=this.enableConsoleLog)!==null&&q!==void 0&&q):new F(te,this.analyticsProperties,void 0,0,this.clock,this.fileKey,(G=this.enableConsoleLog)!==null&&G!==void 0&&G)},D.prototype.getFetchUrl=function(){var O="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),z=new URL(O);return z.searchParams.set("version","1.0"),z},D.clearInstance=function(){var O;(O=this.gInstance)===null||O===void 0||O.clearInstanceImpl(),this.gInstance=void 0},D.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},D.prototype.startRefresh=function(){var O=this;this.trace.onTrace("Starting refresh request"),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds);var z=this.clock.getMillis();if((z-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds)this.trace.onTrace("Will not refresh due to refresh timeout");else if(!this.isInitialRefreshDone||this.refresh.canRefreshNow()){this.isInitialRefreshDone=!0;var q={};this.fetchData().then((function(G){O.processResponse(G,q,z),O.emitMetricsImpl(q)})).catch((function(G){O.exceptionMetrics(q,G),O.emitMetricsImpl(q),O.trace.onTrace("Fetch error: "+G),O.refresh.retryCount>0&&O.scheduleRetry(1)}))}else this.trace.onTrace("Will not refresh due to callback having returned false")},D.prototype.fetchData=function(){var O=this.getFetchUrl(),z=new Headers,q=this.state.getState();return q.fetchServer===this.fetchServer&&(q.lastFetchWhenFullMs&&this.clock.getMillis()-q.lastFetchWhenFullMs>1e3*(0,E.hoursToSeconds)(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&q.lastFetchEtagHeader&&z.set("If-None-Match",q.lastFetchEtagHeader)),this.fetch.fetchUrl(O,z)},D.prototype.processResponse=function(O,z,q){var G={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},K=O.headers.get("etag");if(K&&(G.lastFetchEtagHeader=K),O.status<300&&O.json)if(this.setData(O.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(v.DATA_KEY,{fetchServer:this.fetchServer,json:O.json});var te=this.clock.getMillis();G.lastFetchWhenFullMs=te,this.state.setState(G),z.success_new_data_count=1,z.fetch_duration_average=Math.max(0,te-q)}else z.fail_invalid_data_count=1;else{if(O.status!==304){var re="Unexpected http fetch status: "+O.status;throw this.trace.onTrace(re),new L.HttpError(re)}this.trace.onTrace("Server said no change in data"),te=this.clock.getMillis(),G.lastFetchWhenMs=te,this.state.setState(G),z.success_no_change_count=1,z.fetch_duration_average=Math.max(0,te-q)}},D.prototype.scheduleRetry=function(O){var z=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var q=O*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout((function(){z.retryTask=void 0,z.fetchRetry(O)}),1e3*q)},D.prototype.fetchRetry=function(O){var z=this;this.trace.onTrace("Starting retry request ".concat(O,"..."));var q={},G=this.clock.getMillis();this.fetchData().then((function(K){z.processResponse(K,q,G),z.emitMetricsImpl(q)})).catch((function(K){z.exceptionMetrics(q,K),z.emitMetricsImpl(q),z.trace.onTrace("Fetch error: "+K),z.refresh.retryCount>O&&z.scheduleRetry(O+1)}))},D.prototype.setData=function(O){if(!O)return!1;if(O.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var z=O.properties;if(!z||!Array.isArray(z))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var q=new Map,G=0,K=z;G<K.length;G++){var te=K[G];if(te.name&&te.type&&this.isValidValueType(te.type)){if(te.value_string&&typeof te.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof te.value_string);continue}if(te.value_number&&typeof te.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof te.value_number);continue}if(te.value_boolean&&typeof te.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof te.value_boolean);continue}if(te.value_json&&typeof te.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof te.value_json);continue}if(te.value_analytics&&typeof te.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof te.value_analytics);continue}var re=new L.Property(te.name,this.parseValueType(te.type),te.value_string,te.value_number,te.value_boolean,te.value_json,te.value_analytics,te.encoding);q.set(re.name,re)}}return q.size!=0&&(this.properties=q,!0)},D.prototype.isValidValueType=function(O){return O==="string"||O==="number"||O==="boolean"||O=="json"},D.prototype.parseValueType=function(O){switch(O){case"string":return L.ValueType.STRING;case"number":return L.ValueType.NUMBER;case"boolean":return L.ValueType.BOOLEAN;case"json":return L.ValueType.JSON;default:throw new Error("Unsupported value type ".concat(O))}},D.prototype.emitMetricsImpl=function(O){var z,q,G,K,te,re,H=p(p({},this.analyticsProperties),{initial_load_time:this.initialLoadTime,fetch_attempt_count:1,fetch_duration_average:(z=O.fetch_duration_average)!==null&&z!==void 0?z:0,success_no_change_count:(q=O.success_no_change_count)!==null&&q!==void 0?q:0,success_new_data_count:(G=O.success_new_data_count)!==null&&G!==void 0?G:0,fail_exception_count:(K=O.fail_exception_count)!==null&&K!==void 0?K:0,fail_http_error_count:(te=O.fail_http_error_count)!==null&&te!==void 0?te:0,fail_invalid_data_count:(re=O.fail_invalid_data_count)!==null&&re!==void 0?re:0});this.emitMetrics(H)},D.prototype.exceptionMetrics=function(O,z){z instanceof L.HttpError||typeof z?.message=="string"&&z.message.indexOf("http error")===0?O.fail_http_error_count=1:O.fail_exception_count=1},D})();f.DeviceConfigManager=I;var F=(function(){function D(O,z,q,G,K,te,re){re===void 0&&(re=!1);var H=this;this.emitValue=function(Y,Z){H.analytics.onValue(p(p({},H.analyticsProperties),{key_name:Y,value:"".concat(Z),fetched_seconds_ago:H.getFetchedSecondsAgo()}))},this.emitTrace=function(Y,Z){H.analytics.onTrace(p(p({},H.analyticsProperties),{key_name:Y,message:Z}))},this.emitError=function(Y,Z){H.analytics.onError(p(p({},H.analyticsProperties),{key_name:Y,message:Z}))},this.emitAssignment=function(Y){var Z=Y.warnings.map((function(Q){return Q.type})).join(",");H.analytics.onAssignment(p(p({},H.analyticsProperties),{assignment:Y.variant,feature_id:Y.featureId,rollout_id:Y.rolloutId,tracking_id:Y.trackingId,warnings:Z}))},this.analytics=O,this.analyticsProperties=z,this.properties=q,this.dataFetchedWhenMs=G,this.clock=K,this.fileKey=te,this.enableConsoleLog=re,this.overrider=(0,A.WindowPropertyOverrider)(window)}return D.prototype.getSize=function(){return this.properties?this.properties.size:-1},D.prototype.getProperty=function(O){var z=this.overrider.getPropertyOverride(O);if(z)return this.debugLog("Using override for key: ".concat(O)),z;if(this.properties){var q=this.properties.get(O);if(q)return q;this.emitError(O,"No property exists for key name")}else this.emitTrace(O,"No properties, local cache is expired")},D.prototype.getStringValue=function(O){var z,q,G=this.getProperty(O);if(G){if(G.type===L.ValueType.STRING){var K=(z=G.valueString)!==null&&z!==void 0?z:"";return this.emitValue(G.name,(q=G.valueAnalytics)!==null&&q!==void 0?q:K),K}this.emitError(G.name,"Type is not a string")}},D.prototype.getNumberValue=function(O){var z,q,G=this.getProperty(O);if(G){if(G.type===L.ValueType.NUMBER){var K=(z=G.valueNumber)!==null&&z!==void 0?z:0;return this.emitValue(G.name,(q=G.valueAnalytics)!==null&&q!==void 0?q:K),K}this.emitError(G.name,"Type is not a number")}},D.prototype.getBooleanValue=function(O){var z,q,G=this.getProperty(O);if(G){if(G.type===L.ValueType.BOOLEAN){var K=(z=G.valueBoolean)!==null&&z!==void 0&&z;return this.emitValue(G.name,(q=G.valueAnalytics)!==null&&q!==void 0?q:K),K}this.emitError(G.name,"Type is not a boolean")}},D.prototype.getJsonValue=function(O){var z,q,G=this.getProperty(O);if(G)if(G.type===L.ValueType.JSON){var K=(z=G.valueAnalytics)!==null&&z!==void 0?z:"",te=G.valueJson;if(te)try{var re=JSON.parse(te);return this.emitValue(G.name,(q=G.valueAnalytics)!==null&&q!==void 0?q:re),re}catch{return void this.emitError(G.name,"JSON parse error")}else this.emitValue(G.name,K)}else this.emitError(G.name,"Type is not JSON")},D.prototype.getResolvedConfigForPropertyKey=function(O){var z=O.key,q=O.context,G=O.schema,K=O.trace,te=K!==void 0&&K,re=this.getJsonValue(z);if(re!==void 0)if(re.length!==0){for(var H=[],Y=0,Z=re;Y<Z.length;Y++){var Q=Z[Y];(lt=(0,x.validateSchema)(Q,_.DeviceConfigCriteriaConfigSchema)).ok?H.push(Q):this.emitError(z,"Criteria structure invalid: ".concat(lt.error))}for(var ie=new y.CriteriaInputs(q),ge=[],Te=0,be=H;Te<be.length;Te++)Q=be[Te],(lt=_.CriteriaParser.evaluateCriteria(Q,ie)).ok?lt.value.matched&&ge.push(lt.value.payload):this.emitError(z,lt.error);if(ge.length!==0){for(var Pe=[],Ge=0,Ze=ge;Ge<Ze.length;Ge++){var lt;Q=Ze[Ge],(lt=(0,x.validateSchema)(Q,G)).ok?Pe.push(Q):this.emitError(z,"Payload structure invalid: ".concat(lt.error))}var pt=g.mergeConfigs.apply(void 0,m([{}],Pe,!1)),ne=JSON.stringify(pt);return this.emitValue(z,"Resolved: ".concat(ne)),pt}if(te){var Le=H.length;this.emitTrace(z,"No matches from ".concat(Le," payloads"))}}else te&&this.emitTrace(z,"No payloads exist for key")},D.prototype.getResolvedExperimentForPropertyKeys=function(O){for(var z=O.keys,q=O.context,G=O.trace,K=G!==void 0&&G,te={},re=new T.RolloutManager(this.fileKey),H=0,Y=z;H<Y.length;H++){var Z=Y[H];te[Z]=this.processExperimentKey(Z,q,K,re)}return te},D.prototype.processExperimentKey=function(O,z,q,G){var K=this.getJsonValue(O);if(K!==void 0)if(K.length!==0){for(var te=[],re=0,H=K;re<H.length;re++){var Y=H[re],Z=(0,x.validateSchema)(Y,_.DeviceConfigCriteriaConfigSchema);Z.ok?te.push(Y):this.emitError(O,"Criteria structure invalid: ".concat(Z.error))}var Q=this.getMatchedCriteria(te,z,O),ie=this.validateMatchedPayloads(Q,O),ge=this.selectPayload(ie);if(ge){var Te=G.getVariantAssignment(ge);if(Te.ok){var be=Te.value;return this.emitAssignment(be),q&&this.emitTrace(O,"Experiment variant assigned: ".concat(be.variant)),be}this.emitError(O,"Experiment assignment failed: ".concat(Te.error))}else q&&this.emitTrace(O,"No matching criteria from ".concat(te.length," experiment payloads"))}else q&&this.emitTrace(O,"No experiment payloads exist for key")},D.prototype.getMatchedCriteria=function(O,z,q){for(var G=new y.CriteriaInputs(z),K=[],te=0,re=O;te<re.length;te++){var H=re[te],Y=_.CriteriaParser.evaluateCriteria(H,G);Y.ok?Y.value.matched&&K.push(Y.value.payload):this.emitError(q,Y.error)}return K},D.prototype.validateMatchedPayloads=function(O,z){for(var q=[],G=0,K=O;G<K.length;G++){var te=K[G];if(te){var re=(0,x.validateSchemaAndReturn)(te,k.DeviceConfigRolloutSchema);re.ok?q.push(re.value):this.emitError(z,"Rollout payload invalid: ".concat(re.error))}}return q},D.prototype.selectPayload=function(O){return O.length>0?O[0]:void 0},D.prototype.getFetchedSecondsAgo=function(){if(this.dataFetchedWhenMs)return(this.clock.getMillis()-this.dataFetchedWhenMs)/1e3},D.prototype.debugLog=function(O){this.enableConsoleLog&&console.log("[DeviceConfig] ".concat(O))},D})();f.DeviceConfigPropertyHolder=F;var M=(function(){function D(O){this.context=O}return D.prototype.fetchUrl=function(O,z){var q=this,G={headers:z,cache:"no-store"},K=null;if(typeof AbortController<"u"){var te=new AbortController;K=this.context.setTimeout((function(){return te.abort()}),1e3*v.DEFAULT_HTTP_TIMEOUT_SECONDS),G.signal=te.signal}return new Promise((function(re,H){q.context.fetch(O,G).then((function(Y){if(Y.status>=400)H(new L.HttpError("http error ".concat(Y.status,", ").concat(Y.statusText)));else{var Z={status:Y.status,headers:Y.headers};Y.json().then((function(Q){Z.json=Q,re(Z)})).catch((function(){re(Z)}))}})).catch((function(Y){H(Y)})).finally((function(){K&&q.context.clearTimeout(K)}))}))},D})()},3864:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,_,y,v){v===void 0&&(v=y);var E=Object.getOwnPropertyDescriptor(_,y);E&&!("get"in E?!_.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return _[y]}}),Object.defineProperty(g,v,E)}:function(g,_,y,v){v===void 0&&(v=y),g[v]=_[y]}),m=this&&this.__exportStar||function(g,_){for(var y in g)y==="default"||Object.prototype.hasOwnProperty.call(_,y)||p(_,g,y)};Object.defineProperty(f,"__esModule",{value:!0}),m(d(363),f),m(d(4811),f),m(d(7094),f),m(d(3259),f),m(d(3840),f),m(d(6270),f)},9456:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,_,y,v){v===void 0&&(v=y);var E=Object.getOwnPropertyDescriptor(_,y);E&&!("get"in E?!_.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return _[y]}}),Object.defineProperty(g,v,E)}:function(g,_,y,v){v===void 0&&(v=y),g[v]=_[y]}),m=this&&this.__exportStar||function(g,_){for(var y in g)y==="default"||Object.prototype.hasOwnProperty.call(_,y)||p(_,g,y)};Object.defineProperty(f,"__esModule",{value:!0}),m(d(8903),f)},8903:function(h,f,d){var p=this&&this.__spreadArray||function(_,y,v){if(v||arguments.length===2)for(var E,x=0,A=y.length;x<A;x++)!E&&x in y||(E||(E=Array.prototype.slice.call(y,0,x)),E[x]=y[x]);return _.concat(E||Array.prototype.slice.call(y))};Object.defineProperty(f,"__esModule",{value:!0}),f.TypedEmitter=void 0;var m=d(228),g=(function(){function _(y){var v;this.emitter=new m.EventEmitter,this.propagateErrors=(v=y?.propagateErrors)!==null&&v!==void 0&&v}return _.prototype.on=function(y,v){v.call=this.wrapCall(y,v),this.emitter.on(y,v)},_.prototype.off=function(y,v){this.emitter.off(y,v)},_.prototype.emit=function(y){for(var v,E=[],x=1;x<arguments.length;x++)E[x-1]=arguments[x];(v=this.emitter).emit.apply(v,p([y],E,!1))},_.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},_.prototype.wrapCall=function(y,v){var E=this;return function(x){for(var A=[],T=1;T<arguments.length;T++)A[T-1]=arguments[T];if(E.propagateErrors)v.apply(x,A);else try{v.apply(x,A)}catch(I){var k="Error in callback for ".concat(y),L=v.name;return L&&(k+=" for function ".concat(L)),void console.error(k,I)}}},_})();f.TypedEmitter=g},5987:function(h,f,d){var p,m=this&&this.__extends||(p=function(A,T){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,L){k.__proto__=L}||function(k,L){for(var I in L)Object.prototype.hasOwnProperty.call(L,I)&&(k[I]=L[I])},p(A,T)},function(A,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function k(){this.constructor=A}p(A,T),A.prototype=T===null?Object.create(T):(k.prototype=T.prototype,new k)}),g=this&&this.__createBinding||(Object.create?function(A,T,k,L){L===void 0&&(L=k);var I=Object.getOwnPropertyDescriptor(T,k);I&&!("get"in I?!T.__esModule:I.writable||I.configurable)||(I={enumerable:!0,get:function(){return T[k]}}),Object.defineProperty(A,L,I)}:function(A,T,k,L){L===void 0&&(L=k),A[L]=T[k]}),_=this&&this.__setModuleDefault||(Object.create?function(A,T){Object.defineProperty(A,"default",{enumerable:!0,value:T})}:function(A,T){A.default=T}),y=this&&this.__importStar||function(A){if(A&&A.__esModule)return A;var T={};if(A!=null)for(var k in A)k!=="default"&&Object.prototype.hasOwnProperty.call(A,k)&&g(T,A,k);return _(T,A),T};Object.defineProperty(f,"__esModule",{value:!0}),f.createFsm=f.FsmWildcardState=f.RejectedTransitionError=f.InvalidStateTransitionError=void 0;var v=y(d(4293)),E=(function(A){function T(k,L){var I=A.call(this,"Invalid transition from '".concat(L,"' via event '").concat(k,"'"))||this;return I.name="InvalidStateTransitionError",I}return m(T,A),T})(Error);f.InvalidStateTransitionError=E;var x=(function(A){function T(k,L,I){var F=A.call(this,"Transition from '".concat(L,"' via event '").concat(k,"' was rejected for: ").concat(I))||this;return F.name="RejectedTransitionError",F}return m(T,A),T})(Error);f.RejectedTransitionError=x,f.FsmWildcardState="*",f.createFsm=function(A){var T,k=A.transitions,L=A.callbacks,I=A.initialState,F=function(M){var D,O=(D=k[M])===null||D===void 0?void 0:D.from;return!!O&&(typeof O=="string"?O===f.FsmWildcardState:O.includes(I))};return{canTransition:F,transition:function(M,D){var O,z,q,G,K,te;if(!F(M))return v.err(new E(String(I),String(M)));var re=k[M];return re.shouldTransition===void 0||re.shouldTransition(I)?((z=(O=L?.[I])===null||O===void 0?void 0:O.onExiting)===null||z===void 0||z.call(O),(q=L?.onStateExiting)===null||q===void 0||q.call(L,I),T=I,I=re.to,(K=(G=L?.[I])===null||G===void 0?void 0:G.onChanged)===null||K===void 0||K.call(G,T,D),(te=L?.onStateChanged)===null||te===void 0||te.call(L,T,I,D),v.ok(I)):v.err(new x(String(I),String(M),"shouldTransition returned false"))},previousState:function(){return T},currentState:function(){return I}}}},8156:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,_,y,v){v===void 0&&(v=y);var E=Object.getOwnPropertyDescriptor(_,y);E&&!("get"in E?!_.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return _[y]}}),Object.defineProperty(g,v,E)}:function(g,_,y,v){v===void 0&&(v=y),g[v]=_[y]}),m=this&&this.__exportStar||function(g,_){for(var y in g)y==="default"||Object.prototype.hasOwnProperty.call(_,y)||p(_,g,y)};Object.defineProperty(f,"__esModule",{value:!0}),f.VERSION=void 0,f.VERSION="0.10.0",m(d(3864),f),m(d(9456),f),m(d(5987),f),m(d(9266),f),m(d(6925),f)},6925:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,_,y,v){v===void 0&&(v=y);var E=Object.getOwnPropertyDescriptor(_,y);E&&!("get"in E?!_.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return _[y]}}),Object.defineProperty(g,v,E)}:function(g,_,y,v){v===void 0&&(v=y),g[v]=_[y]}),m=this&&this.__exportStar||function(g,_){for(var y in g)y==="default"||Object.prototype.hasOwnProperty.call(_,y)||p(_,g,y)};Object.defineProperty(f,"__esModule",{value:!0}),m(d(6166),f),m(d(7612),f),m(d(7056),f),m(d(8139),f),m(d(3877),f)},6166:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(A){for(var T,k=1,L=arguments.length;k<L;k++)for(var I in T=arguments[k])Object.prototype.hasOwnProperty.call(T,I)&&(A[I]=T[I]);return A},p.apply(this,arguments)},m=this&&this.__spreadArray||function(A,T,k){if(k||arguments.length===2)for(var L,I=0,F=T.length;I<F;I++)!L&&I in T||(L||(L=Array.prototype.slice.call(T,0,I)),L[I]=T[I]);return A.concat(L||Array.prototype.slice.call(T))};Object.defineProperty(f,"__esModule",{value:!0}),f.getLogConfig=f.setLogConfig=f.setLogConfigByLevel=f.extractLogConfig=void 0;var g=d(7612),_=d(7056),y=d(8139),v=d(4478),E={enabled:!1,levels:{debug:!0,log:!0,info:!0,warn:!0,error:!0},targets:[(0,_.createConsoleLogTarget)()],categories:{}},x=Object.keys(E);f.extractLogConfig=function(A){var T={};if(Object.keys(A).some((function(M){return x.includes(M)}))){for(var k=0,L=x;k<L.length;k++){var I=L[k];if(A[I]!==void 0){var F=A[I];T[I]=F}}return T}},f.setLogConfigByLevel=function(A){var T=A.enabled||E.enabled,k=A.targets||E.targets,L={debug:!1,log:!1,info:!1,warn:!1,error:!1},I=function(F,M){for(var D=0,O=F;D<O.length;D++){var z=O[D];L[z]=M}};switch(A.level){case"debug":I(["debug","log","info","warn","error"],T);break;case"log":I(["log","info","warn","error"],T);break;case"info":I(["info","warn","error"],!0);break;case"warn":I(["warn","error"],!0);break;case"error":I(["error"],!0)}(0,f.setLogConfig)({enabled:T,levels:L,targets:k})},f.setLogConfig=function(A){var T=(0,v.mergeConfigs)(E,A);T&&(E=T,g.defaultLogEmitter.emit(y.LogEventType.CONFIG_UPDATED,E))},f.getLogConfig=function(){return{enabled:E.enabled,levels:p({},E.levels),targets:m([],E.targets,!0),categories:p({},E.categories)}}},7612:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.defaultLogEmitter=void 0;var p=d(9456);f.defaultLogEmitter=new p.TypedEmitter({})},7056:function(h,f,d){var p=this&&this.__spreadArray||function(g,_,y){if(y||arguments.length===2)for(var v,E=0,x=_.length;E<x;E++)!v&&E in _||(v||(v=Array.prototype.slice.call(_,0,E)),v[E]=_[E]);return g.concat(v||Array.prototype.slice.call(_))};Object.defineProperty(f,"__esModule",{value:!0}),f.createEventLogTarget=f.createConsoleLogTarget=void 0;var m=d(8139);f.createConsoleLogTarget=function(){return{handleMessage:function(g){for(var _=[],y=1;y<arguments.length;y++)_[y-1]=arguments[y];console[g].apply(console,_)}}},f.createEventLogTarget=function(g){return{handleMessage:function(_){for(var y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];g.emit.apply(g,p([m.LogEventType.MESSAGE_LOGGED,_],y,!1))}}}},8139:(h,f)=>{var d;Object.defineProperty(f,"__esModule",{value:!0}),f.LogEventType=void 0,(function(p){p.CONFIG_UPDATED="logConfigUpdated",p.MESSAGE_LOGGED="messageLogged"})(d||(f.LogEventType=d={}))},3877:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(x){for(var A,T=1,k=arguments.length;T<k;T++)for(var L in A=arguments[T])Object.prototype.hasOwnProperty.call(A,L)&&(x[L]=A[L]);return x},p.apply(this,arguments)},m=this&&this.__spreadArray||function(x,A,T){if(T||arguments.length===2)for(var k,L=0,I=A.length;L<I;L++)!k&&L in A||(k||(k=Array.prototype.slice.call(A,0,L)),k[L]=A[L]);return x.concat(k||Array.prototype.slice.call(A))};Object.defineProperty(f,"__esModule",{value:!0}),f.createLogger=void 0;var g=d(4478),_=d(6166),y=d(7612),v=d(8139),E=function(x,A){return(0,g.mergeConfigs)(x,A)||x};f.createLogger=function(x){var A=x.name,T=x.category,k=x.parent,L=(0,_.extractLogConfig)(x)||{},I=E((0,_.getLogConfig)(),L);y.defaultLogEmitter.on(v.LogEventType.CONFIG_UPDATED,(function(z){I=E(z,L||{})}));var F=function(z){for(var q=[],G=1;G<arguments.length;G++)q[G-1]=arguments[G];if(k&&!k.canLog(z)||!D(z))return!1;for(var K=M(),te=new Date().toTimeString().split(" ")[0],re=m(["".concat(te," - (").concat(K,")")],q,!0),H=0,Y=I.targets;H<Y.length;H++){var Z=Y[H];Z.handleMessage.apply(Z,m([z],re,!1))}return!0},M=function(){return k?"".concat(k.getName()," | ").concat(A):A},D=function(z){return!(!I.enabled||!I.levels[z]||I.targets.length===0||T!==void 0&&!I.categories[T])},O={debug:function(){for(var z=[],q=0;q<arguments.length;q++)z[q]=arguments[q];return F.apply(void 0,m(["debug"],z,!1))},log:function(){for(var z=[],q=0;q<arguments.length;q++)z[q]=arguments[q];return F.apply(void 0,m(["log"],z,!1))},info:function(){for(var z=[],q=0;q<arguments.length;q++)z[q]=arguments[q];return F.apply(void 0,m(["info"],z,!1))},warn:function(){for(var z=[],q=0;q<arguments.length;q++)z[q]=arguments[q];return F.apply(void 0,m(["warn"],z,!1))},error:function(){for(var z=[],q=0;q<arguments.length;q++)z[q]=arguments[q];return F.apply(void 0,m(["error"],z,!1))},getName:M,canLog:D,getChildLogger:function(z){return(0,f.createLogger)(p(p({},z),{parent:O}))},setConfig:function(z){I=E(I,L=z)}};return O}},8177:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(T,k,L,I){I===void 0&&(I=L);var F=Object.getOwnPropertyDescriptor(k,L);F&&!("get"in F?!k.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return k[L]}}),Object.defineProperty(T,I,F)}:function(T,k,L,I){I===void 0&&(I=L),T[I]=k[L]}),m=this&&this.__setModuleDefault||(Object.create?function(T,k){Object.defineProperty(T,"default",{enumerable:!0,value:k})}:function(T,k){T.default=k}),g=this&&this.__importStar||function(T){if(T&&T.__esModule)return T;var k={};if(T!=null)for(var L in T)L!=="default"&&Object.prototype.hasOwnProperty.call(T,L)&&p(k,T,L);return m(k,T),k},_=this&&this.__awaiter||function(T,k,L,I){return new(L||(L=Promise))((function(F,M){function D(q){try{z(I.next(q))}catch(G){M(G)}}function O(q){try{z(I.throw(q))}catch(G){M(G)}}function z(q){var G;q.done?F(q.value):(G=q.value,G instanceof L?G:new L((function(K){K(G)}))).then(D,O)}z((I=I.apply(T,k||[])).next())}))},y=this&&this.__generator||function(T,k){var L,I,F,M,D={label:0,sent:function(){if(1&F[0])throw F[1];return F[1]},trys:[],ops:[]};return M={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(M[Symbol.iterator]=function(){return this}),M;function O(z){return function(q){return(function(G){if(L)throw new TypeError("Generator is already executing.");for(;M&&(M=0,G[0]&&(D=0)),D;)try{if(L=1,I&&(F=2&G[0]?I.return:G[0]?I.throw||((F=I.return)&&F.call(I),0):I.next)&&!(F=F.call(I,G[1])).done)return F;switch(I=0,F&&(G=[2&G[0],F.value]),G[0]){case 0:case 1:F=G;break;case 4:return D.label++,{value:G[1],done:!1};case 5:D.label++,I=G[1],G=[0];continue;case 7:G=D.ops.pop(),D.trys.pop();continue;default:if(!((F=(F=D.trys).length>0&&F[F.length-1])||G[0]!==6&&G[0]!==2)){D=0;continue}if(G[0]===3&&(!F||G[1]>F[0]&&G[1]<F[3])){D.label=G[1];break}if(G[0]===6&&D.label<F[1]){D.label=F[1],F=G;break}if(F&&D.label<F[2]){D.label=F[2],D.ops.push(G);break}F[2]&&D.ops.pop(),D.trys.pop();continue}G=k.call(T,D)}catch(K){G=[6,K],I=0}finally{L=F=0}if(5&G[0])throw G[1];return{value:G[0]?G[1]:void 0,done:!0}})([z,q])}}};Object.defineProperty(f,"__esModule",{value:!0}),f.generateUuid=f.getSecureRandom=f.UuidMethod=f.SecureRandomMethod=f.hashProperty=void 0;var v,E,x=g(d(4293));function A(){if(typeof crypto<"u"&&crypto.getRandomValues)try{var T=new Uint32Array(1);return crypto.getRandomValues(T),{value:T[0]/4294967296,method:v.CRYPTO_RANDOM_VALUES}}catch{}return{value:Math.random(),method:v.MATH_RANDOM}}f.hashProperty=function(T){return _(void 0,void 0,void 0,(function(){var k,L,I,F,M;return y(this,(function(D){switch(D.label){case 0:if(typeof crypto>"u")return[2,x.err("WebCrypto is unsupported, skipping hash")];if(typeof(crypto==null?void 0:crypto.subtle.digest)!="function")return[2,x.err("WebCrypto subtle.digest does not exist, possible insecure origin")];D.label=1;case 1:return D.trys.push([1,3,,4]),k=new TextEncoder().encode(T),[4,crypto.subtle.digest("SHA-256",k)];case 2:return L=D.sent(),I=Array.from(new Uint8Array(L)),F=I.map((function(O){return O.toString(16).padStart(2,"0")})).join(""),[2,x.ok({key:T,hash:F})];case 3:return M=D.sent(),[2,x.err("Unable to hash rule: ".concat(M))];case 4:return[2]}}))}))},(function(T){T.CRYPTO_RANDOM_VALUES="crypto-random-values",T.MATH_RANDOM="math-random"})(v||(f.SecureRandomMethod=v={})),(function(T){T.CRYPTO_RANDOM_UUID="crypto-random-uuid",T.MANUAL_CRYPTO_RANDOM_VALUES="manual-crypto-random-values",T.MANUAL_MATH_RANDOM="manual-math-random"})(E||(f.UuidMethod=E={})),f.getSecureRandom=A,f.generateUuid=function(){if(typeof crypto<"u"&&crypto.randomUUID)try{return{value:crypto.randomUUID(),method:E.CRYPTO_RANDOM_UUID}}catch{}for(var T="0123456789abcdef",k="",L=E.MANUAL_CRYPTO_RANDOM_VALUES,I=0;I<36;I++)if(I===8||I===13||I===18||I===23)k+="-";else if(I===14)k+="4";else if(I===19)(F=A()).method===v.MATH_RANDOM&&(L=E.MANUAL_MATH_RANDOM),k+=T[Math.floor(4*F.value)+8];else{var F;(F=A()).method===v.MATH_RANDOM&&(L=E.MANUAL_MATH_RANDOM),k+=T[Math.floor(16*F.value)]}return{value:k,method:L}}},9266:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(g,_,y,v){v===void 0&&(v=y);var E=Object.getOwnPropertyDescriptor(_,y);E&&!("get"in E?!_.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return _[y]}}),Object.defineProperty(g,v,E)}:function(g,_,y,v){v===void 0&&(v=y),g[v]=_[y]}),m=this&&this.__exportStar||function(g,_){for(var y in g)y==="default"||Object.prototype.hasOwnProperty.call(_,y)||p(_,g,y)};Object.defineProperty(f,"__esModule",{value:!0}),m(d(8177),f),m(d(3012),f),m(d(4293),f)},4478:function(h,f,d){var p=this&&this.__spreadArray||function(y,v,E){if(E||arguments.length===2)for(var x,A=0,T=v.length;A<T;A++)!x&&A in v||(x||(x=Array.prototype.slice.call(v,0,A)),x[A]=v[A]);return y.concat(x||Array.prototype.slice.call(v))},m=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(f,"__esModule",{value:!0}),f.mergeConfigs=void 0;var g=m(d(6924)),_=function(y,v){if(Array.isArray(y))return v};f.mergeConfigs=function(y){for(var v=[],E=1;E<arguments.length;E++)v[E-1]=arguments[E];var x=v.map((function(A){return A==null||typeof A!="object"})).filter(Boolean).length>0;if(typeof y=="object"&&!x)return g.default.apply(void 0,p(p([{},y],v,!1),[_],!1))}},4293:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.getErr=f.getOk_or=f.getOk=f.isNotOk=f.isOk=f.err=f.ok=void 0,f.ok=function(d){return{ok:!0,value:d}},f.err=function(d){return{ok:!1,error:d}},f.isOk=function(d){return d.ok===!0},f.isNotOk=function(d){return!(0,f.isOk)(d)},f.getOk=function(d){if(d.ok===!0)return d.value},f.getOk_or=function(d,p){return d.ok===!0?d.value:p},f.getErr=function(d){if(d.ok!==!0)return d.error}},3012:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.timedThrottle=void 0,f.timedThrottle=function(d,p){var m=0;return function(){for(var g=[],_=0;_<arguments.length;_++)g[_]=arguments[_];var y=Date.now();y-m>=p&&(m=y,d.apply(this,g))}}}},l={};function u(h){var f=l[h];if(f!==void 0)return f.exports;var d=l[h]={id:h,loaded:!1,exports:{}};return c[h].call(d.exports,d,d.exports,u),d.loaded=!0,d.exports}return u.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),u.nmd=h=>(h.paths=[],h.children||(h.children=[]),h),u(8156)})(),o.exports=a()},1549:(o,a,c)=>{var l=c(2032),u=c(3862),h=c(6721),f=c(2749),d=c(5749);function p(m){var g=-1,_=m==null?0:m.length;for(this.clear();++g<_;){var y=m[g];this.set(y[0],y[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},79:(o,a,c)=>{var l=c(3702),u=c(80),h=c(4739),f=c(8655),d=c(1175);function p(m){var g=-1,_=m==null?0:m.length;for(this.clear();++g<_;){var y=m[g];this.set(y[0],y[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},8223:(o,a,c)=>{var l=c(6110)(c(9325),"Map");o.exports=l},3661:(o,a,c)=>{var l=c(3040),u=c(7670),h=c(289),f=c(4509),d=c(2949);function p(m){var g=-1,_=m==null?0:m.length;for(this.clear();++g<_;){var y=m[g];this.set(y[0],y[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},7217:(o,a,c)=>{var l=c(79),u=c(1420),h=c(938),f=c(3605),d=c(9817),p=c(945);function m(g){var _=this.__data__=new l(g);this.size=_.size}m.prototype.clear=u,m.prototype.delete=h,m.prototype.get=f,m.prototype.has=d,m.prototype.set=p,o.exports=m},1873:(o,a,c)=>{var l=c(9325).Symbol;o.exports=l},7828:(o,a,c)=>{var l=c(9325).Uint8Array;o.exports=l},1033:o=>{o.exports=function(a,c,l){switch(l.length){case 0:return a.call(c);case 1:return a.call(c,l[0]);case 2:return a.call(c,l[0],l[1]);case 3:return a.call(c,l[0],l[1],l[2])}return a.apply(c,l)}},695:(o,a,c)=>{var l=c(8096),u=c(2428),h=c(6449),f=c(3656),d=c(361),p=c(7167),m=Object.prototype.hasOwnProperty;o.exports=function(g,_){var y=h(g),v=!y&&u(g),E=!y&&!v&&f(g),x=!y&&!v&&!E&&p(g),A=y||v||E||x,T=A?l(g.length,String):[],k=T.length;for(var L in g)!_&&!m.call(g,L)||A&&(L=="length"||E&&(L=="offset"||L=="parent")||x&&(L=="buffer"||L=="byteLength"||L=="byteOffset")||d(L,k))||T.push(L);return T}},7805:(o,a,c)=>{var l=c(3360),u=c(5288);o.exports=function(h,f,d){(d!==void 0&&!u(h[f],d)||d===void 0&&!(f in h))&&l(h,f,d)}},6547:(o,a,c)=>{var l=c(3360),u=c(5288),h=Object.prototype.hasOwnProperty;o.exports=function(f,d,p){var m=f[d];h.call(f,d)&&u(m,p)&&(p!==void 0||d in f)||l(f,d,p)}},6025:(o,a,c)=>{var l=c(5288);o.exports=function(u,h){for(var f=u.length;f--;)if(l(u[f][0],h))return f;return-1}},3360:(o,a,c)=>{var l=c(3243);o.exports=function(u,h,f){h=="__proto__"&&l?l(u,h,{configurable:!0,enumerable:!0,value:f,writable:!0}):u[h]=f}},9344:(o,a,c)=>{var l=c(3805),u=Object.create,h=(function(){function f(){}return function(d){if(!l(d))return{};if(u)return u(d);f.prototype=d;var p=new f;return f.prototype=void 0,p}})();o.exports=h},6649:(o,a,c)=>{var l=c(3221)();o.exports=l},2552:(o,a,c)=>{var l=c(1873),u=c(659),h=c(9350),f=l?l.toStringTag:void 0;o.exports=function(d){return d==null?d===void 0?"[object Undefined]":"[object Null]":f&&f in Object(d)?u(d):h(d)}},7534:(o,a,c)=>{var l=c(2552),u=c(346);o.exports=function(h){return u(h)&&l(h)=="[object Arguments]"}},5083:(o,a,c)=>{var l=c(1882),u=c(7296),h=c(3805),f=c(7473),d=/^\[object .+?Constructor\]$/,p=Function.prototype,m=Object.prototype,g=p.toString,_=m.hasOwnProperty,y=RegExp("^"+g.call(_).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(v){return!(!h(v)||u(v))&&(l(v)?y:d).test(f(v))}},4901:(o,a,c)=>{var l=c(2552),u=c(294),h=c(346),f={};f["[object Float32Array]"]=f["[object Float64Array]"]=f["[object Int8Array]"]=f["[object Int16Array]"]=f["[object Int32Array]"]=f["[object Uint8Array]"]=f["[object Uint8ClampedArray]"]=f["[object Uint16Array]"]=f["[object Uint32Array]"]=!0,f["[object Arguments]"]=f["[object Array]"]=f["[object ArrayBuffer]"]=f["[object Boolean]"]=f["[object DataView]"]=f["[object Date]"]=f["[object Error]"]=f["[object Function]"]=f["[object Map]"]=f["[object Number]"]=f["[object Object]"]=f["[object RegExp]"]=f["[object Set]"]=f["[object String]"]=f["[object WeakMap]"]=!1,o.exports=function(d){return h(d)&&u(d.length)&&!!f[l(d)]}},2903:(o,a,c)=>{var l=c(3805),u=c(5527),h=c(181),f=Object.prototype.hasOwnProperty;o.exports=function(d){if(!l(d))return h(d);var p=u(d),m=[];for(var g in d)(g!="constructor"||!p&&f.call(d,g))&&m.push(g);return m}},5250:(o,a,c)=>{var l=c(7217),u=c(7805),h=c(6649),f=c(2824),d=c(3805),p=c(7241),m=c(4974);o.exports=function g(_,y,v,E,x){_!==y&&h(y,(function(A,T){if(x||(x=new l),d(A))f(_,y,T,v,g,E,x);else{var k=E?E(m(_,T),A,T+"",_,y,x):void 0;k===void 0&&(k=A),u(_,T,k)}}),p)}},2824:(o,a,c)=>{var l=c(7805),u=c(3290),h=c(1961),f=c(3007),d=c(5529),p=c(2428),m=c(6449),g=c(3693),_=c(3656),y=c(1882),v=c(3805),E=c(1331),x=c(7167),A=c(4974),T=c(9884);o.exports=function(k,L,I,F,M,D,O){var z=A(k,I),q=A(L,I),G=O.get(q);if(G)l(k,I,G);else{var K=D?D(z,q,I+"",k,L,O):void 0,te=K===void 0;if(te){var re=m(q),H=!re&&_(q),Y=!re&&!H&&x(q);K=q,re||H||Y?m(z)?K=z:g(z)?K=f(z):H?(te=!1,K=u(q,!0)):Y?(te=!1,K=h(q,!0)):K=[]:E(q)||p(q)?(K=z,p(z)?K=T(z):v(z)&&!y(z)||(K=d(q))):te=!1}te&&(O.set(q,K),M(K,q,F,D,O),O.delete(q)),l(k,I,K)}}},9302:(o,a,c)=>{var l=c(3488),u=c(6757),h=c(2865);o.exports=function(f,d){return h(u(f,d,l),f+"")}},9570:(o,a,c)=>{var l=c(7334),u=c(3243),h=c(3488),f=u?function(d,p){return u(d,"toString",{configurable:!0,enumerable:!1,value:l(p),writable:!0})}:h;o.exports=f},8096:o=>{o.exports=function(a,c){for(var l=-1,u=Array(a);++l<a;)u[l]=c(l);return u}},7301:o=>{o.exports=function(a){return function(c){return a(c)}}},9653:(o,a,c)=>{var l=c(7828);o.exports=function(u){var h=new u.constructor(u.byteLength);return new l(h).set(new l(u)),h}},3290:(o,a,c)=>{o=c.nmd(o);var l=c(9325),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,f=h&&h.exports===u?l.Buffer:void 0,d=f?f.allocUnsafe:void 0;o.exports=function(p,m){if(m)return p.slice();var g=p.length,_=d?d(g):new p.constructor(g);return p.copy(_),_}},1961:(o,a,c)=>{var l=c(9653);o.exports=function(u,h){var f=h?l(u.buffer):u.buffer;return new u.constructor(f,u.byteOffset,u.length)}},3007:o=>{o.exports=function(a,c){var l=-1,u=a.length;for(c||(c=Array(u));++l<u;)c[l]=a[l];return c}},1791:(o,a,c)=>{var l=c(6547),u=c(3360);o.exports=function(h,f,d,p){var m=!d;d||(d={});for(var g=-1,_=f.length;++g<_;){var y=f[g],v=p?p(d[y],h[y],y,d,h):void 0;v===void 0&&(v=h[y]),m?u(d,y,v):l(d,y,v)}return d}},5481:(o,a,c)=>{var l=c(9325)["__core-js_shared__"];o.exports=l},999:(o,a,c)=>{var l=c(9302),u=c(6800);o.exports=function(h){return l((function(f,d){var p=-1,m=d.length,g=m>1?d[m-1]:void 0,_=m>2?d[2]:void 0;for(g=h.length>3&&typeof g=="function"?(m--,g):void 0,_&&u(d[0],d[1],_)&&(g=m<3?void 0:g,m=1),f=Object(f);++p<m;){var y=d[p];y&&h(f,y,p,g)}return f}))}},3221:o=>{o.exports=function(a){return function(c,l,u){for(var h=-1,f=Object(c),d=u(c),p=d.length;p--;){var m=d[a?p:++h];if(l(f[m],m,f)===!1)break}return c}}},3243:(o,a,c)=>{var l=c(6110),u=(function(){try{var h=l(Object,"defineProperty");return h({},"",{}),h}catch{}})();o.exports=u},4840:(o,a,c)=>{var l=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;o.exports=l},2651:(o,a,c)=>{var l=c(4218);o.exports=function(u,h){var f=u.__data__;return l(h)?f[typeof h=="string"?"string":"hash"]:f.map}},6110:(o,a,c)=>{var l=c(5083),u=c(392);o.exports=function(h,f){var d=u(h,f);return l(d)?d:void 0}},8879:(o,a,c)=>{var l=c(4335)(Object.getPrototypeOf,Object);o.exports=l},659:(o,a,c)=>{var l=c(1873),u=Object.prototype,h=u.hasOwnProperty,f=u.toString,d=l?l.toStringTag:void 0;o.exports=function(p){var m=h.call(p,d),g=p[d];try{p[d]=void 0;var _=!0}catch{}var y=f.call(p);return _&&(m?p[d]=g:delete p[d]),y}},392:o=>{o.exports=function(a,c){return a?.[c]}},2032:(o,a,c)=>{var l=c(1042);o.exports=function(){this.__data__=l?l(null):{},this.size=0}},3862:o=>{o.exports=function(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}},6721:(o,a,c)=>{var l=c(1042),u=Object.prototype.hasOwnProperty;o.exports=function(h){var f=this.__data__;if(l){var d=f[h];return d==="__lodash_hash_undefined__"?void 0:d}return u.call(f,h)?f[h]:void 0}},2749:(o,a,c)=>{var l=c(1042),u=Object.prototype.hasOwnProperty;o.exports=function(h){var f=this.__data__;return l?f[h]!==void 0:u.call(f,h)}},5749:(o,a,c)=>{var l=c(1042);o.exports=function(u,h){var f=this.__data__;return this.size+=this.has(u)?0:1,f[u]=l&&h===void 0?"__lodash_hash_undefined__":h,this}},5529:(o,a,c)=>{var l=c(9344),u=c(8879),h=c(5527);o.exports=function(f){return typeof f.constructor!="function"||h(f)?{}:l(u(f))}},361:o=>{var a=/^(?:0|[1-9]\d*)$/;o.exports=function(c,l){var u=typeof c;return!!(l=l??9007199254740991)&&(u=="number"||u!="symbol"&&a.test(c))&&c>-1&&c%1==0&&c<l}},6800:(o,a,c)=>{var l=c(5288),u=c(4894),h=c(361),f=c(3805);o.exports=function(d,p,m){if(!f(m))return!1;var g=typeof p;return!!(g=="number"?u(m)&&h(p,m.length):g=="string"&&p in m)&&l(m[p],d)}},4218:o=>{o.exports=function(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}},7296:(o,a,c)=>{var l,u=c(5481),h=(l=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";o.exports=function(f){return!!h&&h in f}},5527:o=>{var a=Object.prototype;o.exports=function(c){var l=c&&c.constructor;return c===(typeof l=="function"&&l.prototype||a)}},3702:o=>{o.exports=function(){this.__data__=[],this.size=0}},80:(o,a,c)=>{var l=c(6025),u=Array.prototype.splice;o.exports=function(h){var f=this.__data__,d=l(f,h);return!(d<0)&&(d==f.length-1?f.pop():u.call(f,d,1),--this.size,!0)}},4739:(o,a,c)=>{var l=c(6025);o.exports=function(u){var h=this.__data__,f=l(h,u);return f<0?void 0:h[f][1]}},8655:(o,a,c)=>{var l=c(6025);o.exports=function(u){return l(this.__data__,u)>-1}},1175:(o,a,c)=>{var l=c(6025);o.exports=function(u,h){var f=this.__data__,d=l(f,u);return d<0?(++this.size,f.push([u,h])):f[d][1]=h,this}},3040:(o,a,c)=>{var l=c(1549),u=c(79),h=c(8223);o.exports=function(){this.size=0,this.__data__={hash:new l,map:new(h||u),string:new l}}},7670:(o,a,c)=>{var l=c(2651);o.exports=function(u){var h=l(this,u).delete(u);return this.size-=h?1:0,h}},289:(o,a,c)=>{var l=c(2651);o.exports=function(u){return l(this,u).get(u)}},4509:(o,a,c)=>{var l=c(2651);o.exports=function(u){return l(this,u).has(u)}},2949:(o,a,c)=>{var l=c(2651);o.exports=function(u,h){var f=l(this,u),d=f.size;return f.set(u,h),this.size+=f.size==d?0:1,this}},1042:(o,a,c)=>{var l=c(6110)(Object,"create");o.exports=l},181:o=>{o.exports=function(a){var c=[];if(a!=null)for(var l in Object(a))c.push(l);return c}},6009:(o,a,c)=>{o=c.nmd(o);var l=c(4840),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,f=h&&h.exports===u&&l.process,d=(function(){try{var p=h&&h.require&&h.require("util").types;return p||f&&f.binding&&f.binding("util")}catch{}})();o.exports=d},9350:o=>{var a=Object.prototype.toString;o.exports=function(c){return a.call(c)}},4335:o=>{o.exports=function(a,c){return function(l){return a(c(l))}}},6757:(o,a,c)=>{var l=c(1033),u=Math.max;o.exports=function(h,f,d){return f=u(f===void 0?h.length-1:f,0),function(){for(var p=arguments,m=-1,g=u(p.length-f,0),_=Array(g);++m<g;)_[m]=p[f+m];m=-1;for(var y=Array(f+1);++m<f;)y[m]=p[m];return y[f]=d(_),l(h,this,y)}}},9325:(o,a,c)=>{var l=c(4840),u=typeof self=="object"&&self&&self.Object===Object&&self,h=l||u||Function("return this")();o.exports=h},4974:o=>{o.exports=function(a,c){if((c!=="constructor"||typeof a[c]!="function")&&c!="__proto__")return a[c]}},2865:(o,a,c)=>{var l=c(9570),u=c(1811)(l);o.exports=u},1811:o=>{var a=Date.now;o.exports=function(c){var l=0,u=0;return function(){var h=a(),f=16-(h-u);if(u=h,f>0){if(++l>=800)return arguments[0]}else l=0;return c.apply(void 0,arguments)}}},1420:(o,a,c)=>{var l=c(79);o.exports=function(){this.__data__=new l,this.size=0}},938:o=>{o.exports=function(a){var c=this.__data__,l=c.delete(a);return this.size=c.size,l}},3605:o=>{o.exports=function(a){return this.__data__.get(a)}},9817:o=>{o.exports=function(a){return this.__data__.has(a)}},945:(o,a,c)=>{var l=c(79),u=c(8223),h=c(3661);o.exports=function(f,d){var p=this.__data__;if(p instanceof l){var m=p.__data__;if(!u||m.length<199)return m.push([f,d]),this.size=++p.size,this;p=this.__data__=new h(m)}return p.set(f,d),this.size=p.size,this}},7473:o=>{var a=Function.prototype.toString;o.exports=function(c){if(c!=null){try{return a.call(c)}catch{}try{return c+""}catch{}}return""}},7334:o=>{o.exports=function(a){return function(){return a}}},5288:o=>{o.exports=function(a,c){return a===c||a!=a&&c!=c}},3488:o=>{o.exports=function(a){return a}},2428:(o,a,c)=>{var l=c(7534),u=c(346),h=Object.prototype,f=h.hasOwnProperty,d=h.propertyIsEnumerable,p=l((function(){return arguments})())?l:function(m){return u(m)&&f.call(m,"callee")&&!d.call(m,"callee")};o.exports=p},6449:o=>{var a=Array.isArray;o.exports=a},4894:(o,a,c)=>{var l=c(1882),u=c(294);o.exports=function(h){return h!=null&&u(h.length)&&!l(h)}},3693:(o,a,c)=>{var l=c(4894),u=c(346);o.exports=function(h){return u(h)&&l(h)}},3656:(o,a,c)=>{o=c.nmd(o);var l=c(9325),u=c(9935),h=a&&!a.nodeType&&a,f=h&&o&&!o.nodeType&&o,d=f&&f.exports===h?l.Buffer:void 0,p=(d?d.isBuffer:void 0)||u;o.exports=p},1882:(o,a,c)=>{var l=c(2552),u=c(3805);o.exports=function(h){if(!u(h))return!1;var f=l(h);return f=="[object Function]"||f=="[object GeneratorFunction]"||f=="[object AsyncFunction]"||f=="[object Proxy]"}},294:o=>{o.exports=function(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=9007199254740991}},3805:o=>{o.exports=function(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}},346:o=>{o.exports=function(a){return a!=null&&typeof a=="object"}},1331:(o,a,c)=>{var l=c(2552),u=c(8879),h=c(346),f=Function.prototype,d=Object.prototype,p=f.toString,m=d.hasOwnProperty,g=p.call(Object);o.exports=function(_){if(!h(_)||l(_)!="[object Object]")return!1;var y=u(_);if(y===null)return!0;var v=m.call(y,"constructor")&&y.constructor;return typeof v=="function"&&v instanceof v&&p.call(v)==g}},7167:(o,a,c)=>{var l=c(4901),u=c(7301),h=c(6009),f=h&&h.isTypedArray,d=f?u(f):l;o.exports=d},7241:(o,a,c)=>{var l=c(695),u=c(2903),h=c(4894);o.exports=function(f){return h(f)?l(f,!0):u(f)}},2543:function(o,a,c){var l;o=c.nmd(o),(function(){var u,h="Expected a function",f="__lodash_hash_undefined__",d="__lodash_placeholder__",p=16,m=32,g=64,_=128,y=256,v=1/0,E=9007199254740991,x=NaN,A=4294967295,T=[["ary",_],["bind",1],["bindKey",2],["curry",8],["curryRight",p],["flip",512],["partial",m],["partialRight",g],["rearg",y]],k="[object Arguments]",L="[object Array]",I="[object Boolean]",F="[object Date]",M="[object Error]",D="[object Function]",O="[object GeneratorFunction]",z="[object Map]",q="[object Number]",G="[object Object]",K="[object Promise]",te="[object RegExp]",re="[object Set]",H="[object String]",Y="[object Symbol]",Z="[object WeakMap]",Q="[object ArrayBuffer]",ie="[object DataView]",ge="[object Float32Array]",Te="[object Float64Array]",be="[object Int8Array]",Pe="[object Int16Array]",Ge="[object Int32Array]",Ze="[object Uint8Array]",lt="[object Uint8ClampedArray]",pt="[object Uint16Array]",ne="[object Uint32Array]",Le=/\b__p \+= '';/g,Ve=/\b(__p \+=) '' \+/g,De=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ie=/&(?:amp|lt|gt|quot|#39);/g,ae=/[&<>"']/g,ve=RegExp(Ie.source),we=RegExp(ae.source),pe=/<%-([\s\S]+?)%>/g,ze=/<%([\s\S]+?)%>/g,Je=/<%=([\s\S]+?)%>/g,Xe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,Nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gt=/[\\^$.*+?()[\]{}|]/g,wt=RegExp(gt.source),Re=/^\s+/,se=/\s/,W=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oe=/\{\n\/\* \[wrapped with (.+)\] \*/,xe=/,? & /,Ce=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Se=/[()=,{}\[\]\/\s]/,ye=/\\(\\)?/g,Ke=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ke=/\w*$/,He=/^[-+]0x[0-9a-f]+$/i,Fe=/^0b[01]+$/i,We=/^\[object .+?Constructor\]$/,at=/^0o[0-7]+$/i,Be=/^(?:0|[1-9]\d*)$/,nt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,it=/($^)/,xt=/['\n\r\u2028\u2029\\]/g,ot="\\ud800-\\udfff",tn="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ln="\\u2700-\\u27bf",Rt="a-z\\xdf-\\xf6\\xf8-\\xff",Vt="A-Z\\xc0-\\xd6\\xd8-\\xde",_t="\\ufe0e\\ufe0f",Jt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Tn="[']",qt="["+ot+"]",An="["+Jt+"]",Ln="["+tn+"]",mr="\\d+",ns="["+ln+"]",hi="["+Rt+"]",ti="[^"+ot+Jt+mr+ln+Rt+Vt+"]",Fi="\\ud83c[\\udffb-\\udfff]",rs="[^"+ot+"]",qi="(?:\\ud83c[\\udde6-\\uddff]){2}",is="[\\ud800-\\udbff][\\udc00-\\udfff]",ss="["+Vt+"]",je="\\u200d",vt="(?:"+hi+"|"+ti+")",It="(?:"+ss+"|"+ti+")",Ut="(?:['](?:d|ll|m|re|s|t|ve))?",yt="(?:['](?:D|LL|M|RE|S|T|VE))?",an="(?:"+Ln+"|"+Fi+")?",In="["+_t+"]?",_n=In+an+("(?:"+je+"(?:"+[rs,qi,is].join("|")+")"+In+an+")*"),Pn="(?:"+[ns,qi,is].join("|")+")"+_n,tr="(?:"+[rs+Ln+"?",Ln,qi,is,qt].join("|")+")",fr=RegExp(Tn,"g"),Cn=RegExp(Ln,"g"),yr=RegExp(Fi+"(?="+Fi+")|"+tr+_n,"g"),Hr=RegExp([ss+"?"+hi+"+"+Ut+"(?="+[An,ss,"$"].join("|")+")",It+"+"+yt+"(?="+[An,ss+vt,"$"].join("|")+")",ss+"?"+vt+"+"+Ut,ss+"+"+yt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",mr,Pn].join("|"),"g"),ds=RegExp("["+je+ot+tn+_t+"]"),Lr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Gr=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ar=-1,br={};br[ge]=br[Te]=br[be]=br[Pe]=br[Ge]=br[Ze]=br[lt]=br[pt]=br[ne]=!0,br[k]=br[L]=br[Q]=br[I]=br[ie]=br[F]=br[M]=br[D]=br[z]=br[q]=br[G]=br[te]=br[re]=br[H]=br[Z]=!1;var Un={};Un[k]=Un[L]=Un[Q]=Un[ie]=Un[I]=Un[F]=Un[ge]=Un[Te]=Un[be]=Un[Pe]=Un[Ge]=Un[z]=Un[q]=Un[G]=Un[te]=Un[re]=Un[H]=Un[Y]=Un[Ze]=Un[lt]=Un[pt]=Un[ne]=!0,Un[M]=Un[D]=Un[Z]=!1;var bi={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ai=parseFloat,Rs=parseInt,lo=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g,Ri=typeof self=="object"&&self&&self.Object===Object&&self,Mn=lo||Ri||Function("return this")(),Pi=a&&!a.nodeType&&a,Xn=Pi&&o&&!o.nodeType&&o,ps=Xn&&Xn.exports===Pi,al=ps&&lo.process,ms=(function(){try{var Bt=Xn&&Xn.require&&Xn.require("util").types;return Bt||al&&al.binding&&al.binding("util")}catch{}})(),Bc=ms&&ms.isArrayBuffer,e0=ms&&ms.isDate,qg=ms&&ms.isMap,Yg=ms&&ms.isRegExp,Kg=ms&&ms.isSet,bp=ms&&ms.isTypedArray;function ya(Bt,en,sn){switch(sn.length){case 0:return Bt.call(en);case 1:return Bt.call(en,sn[0]);case 2:return Bt.call(en,sn[0],sn[1]);case 3:return Bt.call(en,sn[0],sn[1],sn[2])}return Bt.apply(en,sn)}function _b(Bt,en,sn,Vn){for(var kr=-1,Si=Bt==null?0:Bt.length;++kr<Si;){var ho=Bt[kr];en(Vn,ho,sn(ho),Bt)}return Vn}function Fc(Bt,en){for(var sn=-1,Vn=Bt==null?0:Bt.length;++sn<Vn&&en(Bt[sn],sn,Bt)!==!1;);return Bt}function Bv(Bt,en){for(var sn=Bt==null?0:Bt.length;sn--&&en(Bt[sn],sn,Bt)!==!1;);return Bt}function Xg(Bt,en){for(var sn=-1,Vn=Bt==null?0:Bt.length;++sn<Vn;)if(!en(Bt[sn],sn,Bt))return!1;return!0}function cl(Bt,en){for(var sn=-1,Vn=Bt==null?0:Bt.length,kr=0,Si=[];++sn<Vn;){var ho=Bt[sn];en(ho,sn,Bt)&&(Si[kr++]=ho)}return Si}function Sp(Bt,en){return!!(Bt!=null&&Bt.length)&&vc(Bt,en,0)>-1}function t0(Bt,en,sn){for(var Vn=-1,kr=Bt==null?0:Bt.length;++Vn<kr;)if(sn(en,Bt[Vn]))return!0;return!1}function bs(Bt,en){for(var sn=-1,Vn=Bt==null?0:Bt.length,kr=Array(Vn);++sn<Vn;)kr[sn]=en(Bt[sn],sn,Bt);return kr}function gc(Bt,en){for(var sn=-1,Vn=en.length,kr=Bt.length;++sn<Vn;)Bt[kr+sn]=en[sn];return Bt}function pf(Bt,en,sn,Vn){var kr=-1,Si=Bt==null?0:Bt.length;for(Vn&&Si&&(sn=Bt[++kr]);++kr<Si;)sn=en(sn,Bt[kr],kr,Bt);return sn}function _c(Bt,en,sn,Vn){var kr=Bt==null?0:Bt.length;for(Vn&&kr&&(sn=Bt[--kr]);kr--;)sn=en(sn,Bt[kr],kr,Bt);return sn}function jc(Bt,en){for(var sn=-1,Vn=Bt==null?0:Bt.length;++sn<Vn;)if(en(Bt[sn],sn,Bt))return!0;return!1}var mf=Jg("length");function xu(Bt,en,sn){var Vn;return sn(Bt,(function(kr,Si,ho){if(en(kr,Si,ho))return Vn=Si,!1})),Vn}function Th(Bt,en,sn,Vn){for(var kr=Bt.length,Si=sn+(Vn?1:-1);Vn?Si--:++Si<kr;)if(en(Bt[Si],Si,Bt))return Si;return-1}function vc(Bt,en,sn){return en==en?(function(Vn,kr,Si){for(var ho=Si-1,Vl=Vn.length;++ho<Vl;)if(Vn[ho]===kr)return ho;return-1})(Bt,en,sn):Th(Bt,n0,sn)}function hr(Bt,en,sn,Vn){for(var kr=sn-1,Si=Bt.length;++kr<Si;)if(Vn(Bt[kr],en))return kr;return-1}function n0(Bt){return Bt!=Bt}function Fv(Bt,en){var sn=Bt==null?0:Bt.length;return sn?r0(Bt,en)/sn:x}function Jg(Bt){return function(en){return en==null?u:en[Bt]}}function Ah(Bt){return function(en){return Bt==null?u:Bt[en]}}function Zg(Bt,en,sn,Vn,kr){return kr(Bt,(function(Si,ho,Vl){sn=Vn?(Vn=!1,Si):en(sn,Si,ho,Vl)})),sn}function r0(Bt,en){for(var sn,Vn=-1,kr=Bt.length;++Vn<kr;){var Si=en(Bt[Vn]);Si!==u&&(sn=sn===u?Si:sn+Si)}return sn}function Da(Bt,en){for(var sn=-1,Vn=Array(Bt);++sn<Bt;)Vn[sn]=en(sn);return Vn}function i0(Bt){return Bt&&Bt.slice(0,xn(Bt)+1).replace(Re,"")}function yc(Bt){return function(en){return Bt(en)}}function Qg(Bt,en){return bs(en,(function(sn){return Bt[sn]}))}function wu(Bt,en){return Bt.has(en)}function uo(Bt,en){for(var sn=-1,Vn=Bt.length;++sn<Vn&&vc(en,Bt[sn],0)>-1;);return sn}function jv(Bt,en){for(var sn=Bt.length;sn--&&vc(en,Bt[sn],0)>-1;);return sn}var e_=Ah({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),ll=Ah({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ks(Bt){return"\\"+bi[Bt]}function Jo(Bt){return ds.test(Bt)}function zv(Bt){var en=-1,sn=Array(Bt.size);return Bt.forEach((function(Vn,kr){sn[++en]=[kr,Vn]})),sn}function vb(Bt,en){return function(sn){return Bt(en(sn))}}function zl(Bt,en){for(var sn=-1,Vn=Bt.length,kr=0,Si=[];++sn<Vn;){var ho=Bt[sn];ho!==en&&ho!==d||(Bt[sn]=d,Si[kr++]=sn)}return Si}function Oo(Bt){var en=-1,sn=Array(Bt.size);return Bt.forEach((function(Vn){sn[++en]=Vn})),sn}function Hs(Bt){var en=-1,sn=Array(Bt.size);return Bt.forEach((function(Vn){sn[++en]=[Vn,Vn]})),sn}function ul(Bt){return Jo(Bt)?(function(en){for(var sn=yr.lastIndex=0;yr.test(en);)++sn;return sn})(Bt):mf(Bt)}function ba(Bt){return Jo(Bt)?(function(en){return en.match(yr)||[]})(Bt):(function(en){return en.split("")})(Bt)}function xn(Bt){for(var en=Bt.length;en--&&se.test(Bt.charAt(en)););return en}var Vv=Ah({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),s0=(function Bt(en){var sn,Vn=(en=en==null?Mn:s0.defaults(Mn.Object(),en,s0.pick(Mn,Gr))).Array,kr=en.Date,Si=en.Error,ho=en.Function,Vl=en.Math,Wr=en.Object,t_=en.RegExp,yb=en.String,zc=en.TypeError,o0=Vn.prototype,a0=ho.prototype,ld=Wr.prototype,ud=en["__core-js_shared__"],c0=a0.toString,Yi=ld.hasOwnProperty,l0=0,n_=(sn=/[^.]+$/.exec(ud&&ud.keys&&ud.keys.IE_PROTO||""))?"Symbol(src)_1."+sn:"",u0=ld.toString,bb=c0.call(Wr),hl=Mn._,Ep=t_("^"+c0.call(Yi).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fl=ps?en.Buffer:u,Ms=en.Symbol,xp=en.Uint8Array,ji=fl?fl.allocUnsafe:u,wp=vb(Wr.getPrototypeOf,Wr),h0=Wr.create,Tp=ld.propertyIsEnumerable,hd=o0.splice,Tu=Ms?Ms.isConcatSpreadable:u,fd=Ms?Ms.iterator:u,gf=Ms?Ms.toStringTag:u,Hl=(function(){try{var C=fi(Wr,"defineProperty");return C({},"",{}),C}catch{}})(),dl=en.clearTimeout!==Mn.clearTimeout&&en.clearTimeout,f0=kr&&kr.now!==Mn.Date.now&&kr.now,Sb=en.setTimeout!==Mn.setTimeout&&en.setTimeout,Ap=Vl.ceil,d0=Vl.floor,Cp=Wr.getOwnPropertySymbols,r_=fl?fl.isBuffer:u,dd=en.isFinite,i_=o0.join,s_=vb(Wr.keys,Wr),$s=Vl.max,qr=Vl.min,Eb=kr.now,Ex=en.parseInt,p0=Vl.random,wn=o0.reverse,hn=fi(en,"DataView"),Sn=fi(en,"Map"),pd=fi(en,"Promise"),$r=fi(en,"Set"),Cr=fi(en,"WeakMap"),Sa=fi(Wr,"create"),Au=Cr&&new Cr,_f={},Rp=Cd(hn),md=Cd(Sn),m0=Cd(pd),g0=Cd($r),Hv=Cd(Cr),kp=Ms?Ms.prototype:u,vf=kp?kp.valueOf:u,o_=kp?kp.toString:u;function Ue(C){if(Zs(C)&&!Ur(C)&&!(C instanceof ci)){if(C instanceof Wa)return C;if(Yi.call(C,"__wrapped__"))return Rb(C)}return new Wa(C)}var Ch=(function(){function C(){}return function(B){if(!gs(B))return{};if(h0)return h0(B);C.prototype=B;var J=new C;return C.prototype=u,J}})();function yf(){}function Wa(C,B){this.__wrapped__=C,this.__actions__=[],this.__chain__=!!B,this.__index__=0,this.__values__=u}function ci(C){this.__wrapped__=C,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=A,this.__views__=[]}function $l(C){var B=-1,J=C==null?0:C.length;for(this.clear();++B<J;){var _e=C[B];this.set(_e[0],_e[1])}}function Os(C){var B=-1,J=C==null?0:C.length;for(this.clear();++B<J;){var _e=C[B];this.set(_e[0],_e[1])}}function Cu(C){var B=-1,J=C==null?0:C.length;for(this.clear();++B<J;){var _e=C[B];this.set(_e[0],_e[1])}}function fo(C){var B=-1,J=C==null?0:C.length;for(this.__data__=new Cu;++B<J;)this.add(C[B])}function Vc(C){var B=this.__data__=new Os(C);this.size=B.size}function Ru(C,B){var J=Ur(C),_e=!J&&Wc(C),Oe=!J&&!_e&&kf(C),$e=!J&&!_e&&!Oe&&Vu(C),ct=J||_e||Oe||$e,ft=ct?Da(C.length,yb):[],kt=ft.length;for(var Wt in C)!B&&!Yi.call(C,Wt)||ct&&(Wt=="length"||Oe&&(Wt=="offset"||Wt=="parent")||$e&&(Wt=="buffer"||Wt=="byteLength"||Wt=="byteOffset")||wo(Wt,kt))||ft.push(Wt);return ft}function bf(C){var B=C.length;return B?C[E0(0,B-1)]:u}function Rh(C,B){return P0(Xs(C),Mh(B,0,C.length))}function Io(C){return P0(Xs(C))}function Mp(C,B,J){(J!==u&&!Gc(C[B],J)||J===u&&!(B in C))&&Zo(C,B,J)}function La(C,B,J){var _e=C[B];Yi.call(C,B)&&Gc(_e,J)&&(J!==u||B in C)||Zo(C,B,J)}function _0(C,B){for(var J=C.length;J--;)if(Gc(C[J][0],B))return J;return-1}function kh(C,B,J,_e){return Mu(C,(function(Oe,$e,ct){B(_e,Oe,J(Oe),ct)})),_e}function Op(C,B){return C&&Ec(B,To(B),C)}function Zo(C,B,J){B=="__proto__"&&Hl?Hl(C,B,{configurable:!0,enumerable:!0,value:J,writable:!0}):C[B]=J}function a_(C,B){for(var J=-1,_e=B.length,Oe=Vn(_e),$e=C==null;++J<_e;)Oe[J]=$e?u:Za(C,B[J]);return Oe}function Mh(C,B,J){return C==C&&(J!==u&&(C=C<=J?C:J),B!==u&&(C=C>=B?C:B)),C}function Qo(C,B,J,_e,Oe,$e){var ct,ft=1&B,kt=2&B,Wt=4&B;if(J&&(ct=Oe?J(C,_e,Oe,$e):J(C)),ct!==u)return ct;if(!gs(C))return C;var Yt=Ur(C);if(Yt){if(ct=(function(Ht){var mn=Ht.length,ir=new Ht.constructor(mn);return mn&&typeof Ht[0]=="string"&&Yi.call(Ht,"index")&&(ir.index=Ht.index,ir.input=Ht.input),ir})(C),!ft)return Xs(C,ct)}else{var rn=xa(C),Gn=rn==D||rn==O;if(kf(C))return wf(C,ft);if(rn==G||rn==k||Gn&&!Oe){if(ct=kt||Gn?{}:M0(C),!ft)return kt?(function(Ht,mn){return Ec(Ht,Gl(Ht),mn)})(C,(function(Ht,mn){return Ht&&Ec(mn,Lo(mn),Ht)})(ct,C)):(function(Ht,mn){return Ec(Ht,y_(Ht),mn)})(C,Op(ct,C))}else{if(!Un[rn])return Oe?C:{};ct=(function(Ht,mn,ir){var Rn=Ht.constructor;switch(mn){case Q:return Iu(Ht);case I:case F:return new Rn(+Ht);case ie:return(function(Er,si){var nr=si?Iu(Er.buffer):Er.buffer;return new Er.constructor(nr,Er.byteOffset,Er.byteLength)})(Ht,ir);case ge:case Te:case be:case Pe:case Ge:case Ze:case lt:case pt:case ne:return Sd(Ht,ir);case z:return new Rn;case q:case H:return new Rn(Ht);case te:return(function(Er){var si=new Er.constructor(Er.source,ke.exec(Er));return si.lastIndex=Er.lastIndex,si})(Ht);case re:return new Rn;case Y:return gr=Ht,vf?Wr(vf.call(gr)):{}}var gr})(C,rn,ft)}}$e||($e=new Vc);var pn=$e.get(C);if(pn)return pn;$e.set(C,ct),zu(C)?C.forEach((function(Ht){ct.add(Qo(Ht,B,J,Ht,C,$e))})):fy(C)&&C.forEach((function(Ht,mn){ct.set(mn,Qo(Ht,B,J,mn,C,$e))}));var Nn=Yt?u:(Wt?kt?na:Ba:kt?Lo:To)(C);return Fc(Nn||C,(function(Ht,mn){Nn&&(Ht=C[mn=Ht]),La(ct,mn,Qo(Ht,B,J,mn,C,$e))})),ct}function qa(C,B,J){var _e=J.length;if(C==null)return!_e;for(C=Wr(C);_e--;){var Oe=J[_e],$e=B[Oe],ct=C[Oe];if(ct===u&&!(Oe in C)||!$e(ct))return!1}return!0}function ku(C,B,J){if(typeof C!="function")throw new zc(h);return Uh((function(){C.apply(u,J)}),B)}function gd(C,B,J,_e){var Oe=-1,$e=Sp,ct=!0,ft=C.length,kt=[],Wt=B.length;if(!ft)return kt;J&&(B=bs(B,yc(J))),_e?($e=t0,ct=!1):B.length>=200&&($e=wu,ct=!1,B=new fo(B));e:for(;++Oe<ft;){var Yt=C[Oe],rn=J==null?Yt:J(Yt);if(Yt=_e||Yt!==0?Yt:0,ct&&rn==rn){for(var Gn=Wt;Gn--;)if(B[Gn]===rn)continue e;kt.push(Yt)}else $e(B,rn,_e)||kt.push(Yt)}return kt}Ue.templateSettings={escape:pe,evaluate:ze,interpolate:Je,variable:"",imports:{_:Ue}},Ue.prototype=yf.prototype,Ue.prototype.constructor=Ue,Wa.prototype=Ch(yf.prototype),Wa.prototype.constructor=Wa,ci.prototype=Ch(yf.prototype),ci.prototype.constructor=ci,$l.prototype.clear=function(){this.__data__=Sa?Sa(null):{},this.size=0},$l.prototype.delete=function(C){var B=this.has(C)&&delete this.__data__[C];return this.size-=B?1:0,B},$l.prototype.get=function(C){var B=this.__data__;if(Sa){var J=B[C];return J===f?u:J}return Yi.call(B,C)?B[C]:u},$l.prototype.has=function(C){var B=this.__data__;return Sa?B[C]!==u:Yi.call(B,C)},$l.prototype.set=function(C,B){var J=this.__data__;return this.size+=this.has(C)?0:1,J[C]=Sa&&B===u?f:B,this},Os.prototype.clear=function(){this.__data__=[],this.size=0},Os.prototype.delete=function(C){var B=this.__data__,J=_0(B,C);return!(J<0)&&(J==B.length-1?B.pop():hd.call(B,J,1),--this.size,!0)},Os.prototype.get=function(C){var B=this.__data__,J=_0(B,C);return J<0?u:B[J][1]},Os.prototype.has=function(C){return _0(this.__data__,C)>-1},Os.prototype.set=function(C,B){var J=this.__data__,_e=_0(J,C);return _e<0?(++this.size,J.push([C,B])):J[_e][1]=B,this},Cu.prototype.clear=function(){this.size=0,this.__data__={hash:new $l,map:new(Sn||Os),string:new $l}},Cu.prototype.delete=function(C){var B=po(this,C).delete(C);return this.size-=B?1:0,B},Cu.prototype.get=function(C){return po(this,C).get(C)},Cu.prototype.has=function(C){return po(this,C).has(C)},Cu.prototype.set=function(C,B){var J=po(this,C),_e=J.size;return J.set(C,B),this.size+=J.size==_e?0:1,this},fo.prototype.add=fo.prototype.push=function(C){return this.__data__.set(C,f),this},fo.prototype.has=function(C){return this.__data__.has(C)},Vc.prototype.clear=function(){this.__data__=new Os,this.size=0},Vc.prototype.delete=function(C){var B=this.__data__,J=B.delete(C);return this.size=B.size,J},Vc.prototype.get=function(C){return this.__data__.get(C)},Vc.prototype.has=function(C){return this.__data__.has(C)},Vc.prototype.set=function(C,B){var J=this.__data__;if(J instanceof Os){var _e=J.__data__;if(!Sn||_e.length<199)return _e.push([C,B]),this.size=++J.size,this;J=this.__data__=new Cu(_e)}return J.set(C,B),this.size=J.size,this};var Mu=Lp(Is),v0=Lp(Ip,!0);function y0(C,B){var J=!0;return Mu(C,(function(_e,Oe,$e){return J=!!B(_e,Oe,$e)})),J}function _d(C,B,J){for(var _e=-1,Oe=C.length;++_e<Oe;){var $e=C[_e],ct=B($e);if(ct!=null&&(ft===u?ct==ct&&!Ss(ct):J(ct,ft)))var ft=ct,kt=$e}return kt}function wr(C,B){var J=[];return Mu(C,(function(_e,Oe,$e){B(_e,Oe,$e)&&J.push(_e)})),J}function Ki(C,B,J,_e,Oe){var $e=-1,ct=C.length;for(J||(J=ny),Oe||(Oe=[]);++$e<ct;){var ft=C[$e];B>0&&J(ft)?B>1?Ki(ft,B-1,J,_e,Oe):gc(Oe,ft):_e||(Oe[Oe.length]=ft)}return Oe}var c_=Pu(),Ya=Pu(!0);function Is(C,B){return C&&c_(C,B,To)}function Ip(C,B){return C&&Ya(C,B,To)}function b0(C,B){return cl(B,(function(J){return vl(C[J])}))}function bc(C,B){for(var J=0,_e=(B=xf(B,C)).length;C!=null&&J<_e;)C=C[ju(B[J++])];return J&&J==_e?C:u}function $v(C,B,J){var _e=B(C);return Ur(C)?_e:gc(_e,J(C))}function Ea(C){return C==null?C===u?"[object Undefined]":"[object Null]":gf&&gf in Wr(C)?(function(B){var J=Yi.call(B,gf),_e=B[gf];try{B[gf]=u;var Oe=!0}catch{}var $e=u0.call(B);return Oe&&(J?B[gf]=_e:delete B[gf]),$e})(C):(function(B){return u0.call(B)})(C)}function Ou(C,B){return C>B}function Np(C,B){return C!=null&&Yi.call(C,B)}function xb(C,B){return C!=null&&B in Wr(C)}function l_(C,B,J){for(var _e=J?t0:Sp,Oe=C[0].length,$e=C.length,ct=$e,ft=Vn($e),kt=1/0,Wt=[];ct--;){var Yt=C[ct];ct&&B&&(Yt=bs(Yt,yc(B))),kt=qr(Yt.length,kt),ft[ct]=!J&&(B||Oe>=120&&Yt.length>=120)?new fo(ct&&Yt):u}Yt=C[0];var rn=-1,Gn=ft[0];e:for(;++rn<Oe&&Wt.length<kt;){var pn=Yt[rn],Nn=B?B(pn):pn;if(pn=J||pn!==0?pn:0,!(Gn?wu(Gn,Nn):_e(Wt,Nn,J))){for(ct=$e;--ct;){var Ht=ft[ct];if(!(Ht?wu(Ht,Nn):_e(C[ct],Nn,J)))continue e}Gn&&Gn.push(Nn),Wt.push(pn)}}return Wt}function Oh(C,B,J){var _e=(C=Fu(C,B=xf(B,C)))==null?C:C[ju(mo(B))];return _e==null?u:ya(_e,C,J)}function S0(C){return Zs(C)&&Ea(C)==k}function vd(C,B,J,_e,Oe){return C===B||(C==null||B==null||!Zs(C)&&!Zs(B)?C!=C&&B!=B:(function($e,ct,ft,kt,Wt,Yt){var rn=Ur($e),Gn=Ur(ct),pn=rn?L:xa($e),Nn=Gn?L:xa(ct),Ht=(pn=pn==k?G:pn)==G,mn=(Nn=Nn==k?G:Nn)==G,ir=pn==Nn;if(ir&&kf($e)){if(!kf(ct))return!1;rn=!0,Ht=!1}if(ir&&!Ht)return Yt||(Yt=new Vc),rn||Vu($e)?ey($e,ct,ft,kt,Wt,Yt):(function(nr,jn,Ti,Ls,wa,os,Bo){switch(Ti){case ie:if(nr.byteLength!=jn.byteLength||nr.byteOffset!=jn.byteOffset)return!1;nr=nr.buffer,jn=jn.buffer;case Q:return!(nr.byteLength!=jn.byteLength||!os(new xp(nr),new xp(jn)));case I:case F:case q:return Gc(+nr,+jn);case M:return nr.name==jn.name&&nr.message==jn.message;case te:case H:return nr==jn+"";case z:var zi=zv;case re:var qu=1&Ls;if(zi||(zi=Oo),nr.size!=jn.size&&!qu)return!1;var Kc=Bo.get(nr);if(Kc)return Kc==jn;Ls|=2,Bo.set(nr,jn);var Us=ey(zi(nr),zi(jn),Ls,wa,os,Bo);return Bo.delete(nr),Us;case Y:if(vf)return vf.call(nr)==vf.call(jn)}return!1})($e,ct,pn,ft,kt,Wt,Yt);if(!(1&ft)){var Rn=Ht&&Yi.call($e,"__wrapped__"),gr=mn&&Yi.call(ct,"__wrapped__");if(Rn||gr){var Er=Rn?$e.value():$e,si=gr?ct.value():ct;return Yt||(Yt=new Vc),Wt(Er,si,ft,kt,Yt)}}return ir?(Yt||(Yt=new Vc),(function(nr,jn,Ti,Ls,wa,os){var Bo=1&Ti,zi=Ba(nr),qu=zi.length,Kc=Ba(jn),Us=Kc.length;if(qu!=Us&&!Bo)return!1;for(var Id=qu;Id--;){var Kl=zi[Id];if(!(Bo?Kl in jn:Yi.call(jn,Kl)))return!1}var go=os.get(nr),_o=os.get(jn);if(go&&_o)return go==jn&&_o==nr;var Ta=!0;os.set(nr,jn),os.set(jn,nr);for(var as=Bo;++Id<qu;){var Xl=nr[Kl=zi[Id]],Jl=jn[Kl];if(Ls)var K0=Bo?Ls(Jl,Xl,Kl,jn,nr,os):Ls(Xl,Jl,Kl,nr,jn,os);if(!(K0===u?Xl===Jl||wa(Xl,Jl,Ti,Ls,os):K0)){Ta=!1;break}as||(as=Kl=="constructor")}if(Ta&&!as){var Nd=nr.constructor,Nf=jn.constructor;Nd==Nf||!("constructor"in nr)||!("constructor"in jn)||typeof Nd=="function"&&Nd instanceof Nd&&typeof Nf=="function"&&Nf instanceof Nf||(Ta=!1)}return os.delete(nr),os.delete(jn),Ta})($e,ct,ft,kt,Wt,Yt)):!1})(C,B,J,_e,vd,Oe))}function Sf(C,B,J,_e){var Oe=J.length,$e=Oe,ct=!_e;if(C==null)return!$e;for(C=Wr(C);Oe--;){var ft=J[Oe];if(ct&&ft[2]?ft[1]!==C[ft[0]]:!(ft[0]in C))return!1}for(;++Oe<$e;){var kt=(ft=J[Oe])[0],Wt=C[kt],Yt=ft[1];if(ct&&ft[2]){if(Wt===u&&!(kt in C))return!1}else{var rn=new Vc;if(_e)var Gn=_e(Wt,Yt,kt,C,B,rn);if(!(Gn===u?vd(Yt,Wt,3,_e,rn):Gn))return!1}}return!0}function Gv(C){return!(!gs(C)||(B=C,n_&&n_ in B))&&(vl(C)?Ep:We).test(Cd(C));var B}function wb(C){return typeof C=="function"?C:C==null?_s:typeof C=="object"?Ur(C)?h_(C[0],C[1]):qv(C):Wp(C)}function u_(C){if(!O0(C))return s_(C);var B=[];for(var J in Wr(C))Yi.call(C,J)&&J!="constructor"&&B.push(J);return B}function Wv(C){if(!gs(C))return(function(Oe){var $e=[];if(Oe!=null)for(var ct in Wr(Oe))$e.push(ct);return $e})(C);var B=O0(C),J=[];for(var _e in C)(_e!="constructor"||!B&&Yi.call(C,_e))&&J.push(_e);return J}function Ef(C,B){return C<B}function Ih(C,B){var J=-1,_e=Ja(C)?Vn(C.length):[];return Mu(C,(function(Oe,$e,ct){_e[++J]=B(Oe,$e,ct)})),_e}function qv(C){var B=ra(C);return B.length==1&&B[0][2]?Uu(B[0][0],B[0][1]):function(J){return J===C||Sf(J,C,B)}}function h_(C,B){return jp(C)&&Af(B)?Uu(ju(C),B):function(J){var _e=Za(J,C);return _e===u&&_e===B?Qa(J,C):vd(B,_e,3)}}function yd(C,B,J,_e,Oe){C!==B&&c_(B,(function($e,ct){if(Oe||(Oe=new Vc),gs($e))(function(kt,Wt,Yt,rn,Gn,pn,Nn){var Ht=zp(kt,Yt),mn=zp(Wt,Yt),ir=Nn.get(mn);if(ir)return void Mp(kt,Yt,ir);var Rn=pn?pn(Ht,mn,Yt+"",kt,Wt,Nn):u,gr=Rn===u;if(gr){var Er=Ur(mn),si=!Er&&kf(mn),nr=!Er&&!si&&Vu(mn);Rn=mn,Er||si||nr?Ur(Ht)?Rn=Ht:Js(Ht)?Rn=Xs(Ht):si?(gr=!1,Rn=wf(mn,!0)):nr?(gr=!1,Rn=Sd(mn,!0)):Rn=[]:Wl(mn)||Wc(mn)?(Rn=Ht,Wc(Ht)?Rn=Gb(Ht):gs(Ht)&&!vl(Ht)||(Rn=M0(mn))):gr=!1}gr&&(Nn.set(mn,Rn),Gn(Rn,mn,rn,pn,Nn),Nn.delete(mn)),Mp(kt,Yt,Rn)})(C,B,ct,J,yd,_e,Oe);else{var ft=_e?_e(zp(C,ct),$e,ct+"",C,B,Oe):u;ft===u&&(ft=$e),Mp(C,ct,ft)}}),Lo)}function f_(C,B){var J=C.length;if(J)return wo(B+=B<0?J:0,J)?C[B]:u}function Pp(C,B,J){B=B.length?bs(B,(function($e){return Ur($e)?function(ct){return bc(ct,$e.length===1?$e[0]:$e)}:$e})):[_s];var _e=-1;B=bs(B,yc(vr()));var Oe=Ih(C,(function($e,ct,ft){var kt=bs(B,(function(Wt){return Wt($e)}));return{criteria:kt,index:++_e,value:$e}}));return(function($e,ct){var ft=$e.length;for($e.sort(ct);ft--;)$e[ft]=$e[ft].value;return $e})(Oe,(function($e,ct){return(function(ft,kt,Wt){for(var Yt=-1,rn=ft.criteria,Gn=kt.criteria,pn=rn.length,Nn=Wt.length;++Yt<pn;){var Ht=Ed(rn[Yt],Gn[Yt]);if(Ht)return Yt>=Nn?Ht:Ht*(Wt[Yt]=="desc"?-1:1)}return ft.index-kt.index})($e,ct,J)}))}function Yv(C,B,J){for(var _e=-1,Oe=B.length,$e={};++_e<Oe;){var ct=B[_e],ft=bc(C,ct);J(ft,ct)&&x0($e,xf(ct,C),ft)}return $e}function Nh(C,B,J,_e){var Oe=_e?hr:vc,$e=-1,ct=B.length,ft=C;for(C===B&&(B=Xs(B)),J&&(ft=bs(C,yc(J)));++$e<ct;)for(var kt=0,Wt=B[$e],Yt=J?J(Wt):Wt;(kt=Oe(ft,Yt,kt,_e))>-1;)ft!==C&&hd.call(ft,kt,1),hd.call(C,kt,1);return C}function d_(C,B){for(var J=C?B.length:0,_e=J-1;J--;){var Oe=B[J];if(J==_e||Oe!==$e){var $e=Oe;wo(Oe)?hd.call(C,Oe,1):Xv(C,Oe)}}return C}function E0(C,B){return C+d0(p0()*(B-C+1))}function Qt(C,B){var J="";if(!C||B<1||B>E)return J;do B%2&&(J+=C),(B=d0(B/2))&&(C+=C);while(B);return J}function Xr(C,B){return I0(Bu(C,B,_s),C+"")}function xx(C){return bf(wc(C))}function Tb(C,B){var J=wc(C);return P0(J,Mh(B,0,J.length))}function x0(C,B,J,_e){if(!gs(C))return C;for(var Oe=-1,$e=(B=xf(B,C)).length,ct=$e-1,ft=C;ft!=null&&++Oe<$e;){var kt=ju(B[Oe]),Wt=J;if(kt==="__proto__"||kt==="constructor"||kt==="prototype")return C;if(Oe!=ct){var Yt=ft[kt];(Wt=_e?_e(Yt,kt,ft):u)===u&&(Wt=gs(Yt)?Yt:wo(B[Oe+1])?[]:{})}La(ft,kt,Wt),ft=ft[kt]}return C}var Kv=Au?function(C,B){return Au.set(C,B),C}:_s,wx=Hl?function(C,B){return Hl(C,"toString",{configurable:!0,enumerable:!1,value:zh(B),writable:!0})}:_s;function bd(C){return P0(wc(C))}function Ka(C,B,J){var _e=-1,Oe=C.length;B<0&&(B=-B>Oe?0:Oe+B),(J=J>Oe?Oe:J)<0&&(J+=Oe),Oe=B>J?0:J-B>>>0,B>>>=0;for(var $e=Vn(Oe);++_e<Oe;)$e[_e]=C[_e+B];return $e}function Ns(C,B){var J;return Mu(C,(function(_e,Oe,$e){return!(J=B(_e,Oe,$e))})),!!J}function Dp(C,B,J){var _e=0,Oe=C==null?_e:C.length;if(typeof B=="number"&&B==B&&Oe<=2147483647){for(;_e<Oe;){var $e=_e+Oe>>>1,ct=C[$e];ct!==null&&!Ss(ct)&&(J?ct<=B:ct<B)?_e=$e+1:Oe=$e}return Oe}return Xa(C,B,_s,J)}function Xa(C,B,J,_e){var Oe=0,$e=C==null?0:C.length;if($e===0)return 0;for(var ct=(B=J(B))!=B,ft=B===null,kt=Ss(B),Wt=B===u;Oe<$e;){var Yt=d0((Oe+$e)/2),rn=J(C[Yt]),Gn=rn!==u,pn=rn===null,Nn=rn==rn,Ht=Ss(rn);if(ct)var mn=_e||Nn;else mn=Wt?Nn&&(_e||Gn):ft?Nn&&Gn&&(_e||!pn):kt?Nn&&Gn&&!pn&&(_e||!Ht):!pn&&!Ht&&(_e?rn<=B:rn<B);mn?Oe=Yt+1:$e=Yt}return qr($e,4294967294)}function Ph(C,B){for(var J=-1,_e=C.length,Oe=0,$e=[];++J<_e;){var ct=C[J],ft=B?B(ct):ct;if(!J||!Gc(ft,kt)){var kt=ft;$e[Oe++]=ct===0?0:ct}}return $e}function Rr(C){return typeof C=="number"?C:Ss(C)?x:+C}function ea(C){if(typeof C=="string")return C;if(Ur(C))return bs(C,ea)+"";if(Ss(C))return o_?o_.call(C):"";var B=C+"";return B=="0"&&1/C==-1/0?"-0":B}function Hc(C,B,J){var _e=-1,Oe=Sp,$e=C.length,ct=!0,ft=[],kt=ft;if(J)ct=!1,Oe=t0;else if($e>=200){var Wt=B?null:Ab(C);if(Wt)return Oo(Wt);ct=!1,Oe=wu,kt=new fo}else kt=B?[]:ft;e:for(;++_e<$e;){var Yt=C[_e],rn=B?B(Yt):Yt;if(Yt=J||Yt!==0?Yt:0,ct&&rn==rn){for(var Gn=kt.length;Gn--;)if(kt[Gn]===rn)continue e;B&&kt.push(rn),ft.push(Yt)}else Oe(kt,rn,J)||(kt!==ft&&kt.push(rn),ft.push(Yt))}return ft}function Xv(C,B){return(C=Fu(C,B=xf(B,C)))==null||delete C[ju(mo(B))]}function w0(C,B,J,_e){return x0(C,B,J(bc(C,B)),_e)}function No(C,B,J,_e){for(var Oe=C.length,$e=_e?Oe:-1;(_e?$e--:++$e<Oe)&&B(C[$e],$e,C););return J?Ka(C,_e?0:$e,_e?$e+1:Oe):Ka(C,_e?$e+1:0,_e?Oe:$e)}function Dh(C,B){var J=C;return J instanceof ci&&(J=J.value()),pf(B,(function(_e,Oe){return Oe.func.apply(Oe.thisArg,gc([_e],Oe.args))}),J)}function T0(C,B,J){var _e=C.length;if(_e<2)return _e?Hc(C[0]):[];for(var Oe=-1,$e=Vn(_e);++Oe<_e;)for(var ct=C[Oe],ft=-1;++ft<_e;)ft!=Oe&&($e[Oe]=gd($e[Oe]||ct,C[ft],B,J));return Hc(Ki($e,1),B,J)}function Sc(C,B,J){for(var _e=-1,Oe=C.length,$e=B.length,ct={};++_e<Oe;){var ft=_e<$e?B[_e]:u;J(ct,C[_e],ft)}return ct}function Zt(C){return Js(C)?C:[]}function Sr(C){return typeof C=="function"?C:_s}function xf(C,B){return Ur(C)?C:jp(C,B)?[C]:Cb(Fr(C))}var Ua=Xr;function $c(C,B,J){var _e=C.length;return J=J===u?_e:J,!B&&J>=_e?C:Ka(C,B,J)}var p_=dl||function(C){return Mn.clearTimeout(C)};function wf(C,B){if(B)return C.slice();var J=C.length,_e=ji?ji(J):new C.constructor(J);return C.copy(_e),_e}function Iu(C){var B=new C.constructor(C.byteLength);return new xp(B).set(new xp(C)),B}function Sd(C,B){var J=B?Iu(C.buffer):C.buffer;return new C.constructor(J,C.byteOffset,C.length)}function Ed(C,B){if(C!==B){var J=C!==u,_e=C===null,Oe=C==C,$e=Ss(C),ct=B!==u,ft=B===null,kt=B==B,Wt=Ss(B);if(!ft&&!Wt&&!$e&&C>B||$e&&ct&&kt&&!ft&&!Wt||_e&&ct&&kt||!J&&kt||!Oe)return 1;if(!_e&&!$e&&!Wt&&C<B||Wt&&J&&Oe&&!_e&&!$e||ft&&J&&Oe||!ct&&Oe||!kt)return-1}return 0}function A0(C,B,J,_e){for(var Oe=-1,$e=C.length,ct=J.length,ft=-1,kt=B.length,Wt=$s($e-ct,0),Yt=Vn(kt+Wt),rn=!_e;++ft<kt;)Yt[ft]=B[ft];for(;++Oe<ct;)(rn||Oe<$e)&&(Yt[J[Oe]]=C[Oe]);for(;Wt--;)Yt[ft++]=C[Oe++];return Yt}function m_(C,B,J,_e){for(var Oe=-1,$e=C.length,ct=-1,ft=J.length,kt=-1,Wt=B.length,Yt=$s($e-ft,0),rn=Vn(Yt+Wt),Gn=!_e;++Oe<Yt;)rn[Oe]=C[Oe];for(var pn=Oe;++kt<Wt;)rn[pn+kt]=B[kt];for(;++ct<ft;)(Gn||Oe<$e)&&(rn[pn+J[ct]]=C[Oe++]);return rn}function Xs(C,B){var J=-1,_e=C.length;for(B||(B=Vn(_e));++J<_e;)B[J]=C[J];return B}function Ec(C,B,J,_e){var Oe=!J;J||(J={});for(var $e=-1,ct=B.length;++$e<ct;){var ft=B[$e],kt=_e?_e(J[ft],C[ft],ft,J,C):u;kt===u&&(kt=C[ft]),Oe?Zo(J,ft,kt):La(J,ft,kt)}return J}function Tf(C,B){return function(J,_e){var Oe=Ur(J)?_b:kh,$e=B?B():{};return Oe(J,C,vr(_e,2),$e)}}function Nu(C){return Xr((function(B,J){var _e=-1,Oe=J.length,$e=Oe>1?J[Oe-1]:u,ct=Oe>2?J[2]:u;for($e=C.length>3&&typeof $e=="function"?(Oe--,$e):u,ct&&Po(J[0],J[1],ct)&&($e=Oe<3?u:$e,Oe=1),B=Wr(B);++_e<Oe;){var ft=J[_e];ft&&C(B,ft,_e,$e)}return B}))}function Lp(C,B){return function(J,_e){if(J==null)return J;if(!Ja(J))return C(J,_e);for(var Oe=J.length,$e=B?Oe:-1,ct=Wr(J);(B?$e--:++$e<Oe)&&_e(ct[$e],$e,ct)!==!1;);return J}}function Pu(C){return function(B,J,_e){for(var Oe=-1,$e=Wr(B),ct=_e(B),ft=ct.length;ft--;){var kt=ct[C?ft:++Oe];if(J($e[kt],kt,$e)===!1)break}return B}}function Up(C){return function(B){var J=Jo(B=Fr(B))?ba(B):u,_e=J?J[0]:B.charAt(0),Oe=J?$c(J,1).join(""):B.slice(1);return _e[C]()+Oe}}function xd(C){return function(B){return pf(Yc(sa(B).replace(fr,"")),C,"")}}function wd(C){return function(){var B=arguments;switch(B.length){case 0:return new C;case 1:return new C(B[0]);case 2:return new C(B[0],B[1]);case 3:return new C(B[0],B[1],B[2]);case 4:return new C(B[0],B[1],B[2],B[3]);case 5:return new C(B[0],B[1],B[2],B[3],B[4]);case 6:return new C(B[0],B[1],B[2],B[3],B[4],B[5]);case 7:return new C(B[0],B[1],B[2],B[3],B[4],B[5],B[6])}var J=Ch(C.prototype),_e=C.apply(J,B);return gs(_e)?_e:J}}function Jv(C){return function(B,J,_e){var Oe=Wr(B);if(!Ja(B)){var $e=vr(J,3);B=To(B),J=function(ft){return $e(Oe[ft],ft,Oe)}}var ct=C(B,J,_e);return ct>-1?Oe[$e?B[ct]:ct]:u}}function Bp(C){return ta((function(B){var J=B.length,_e=J,Oe=Wa.prototype.thru;for(C&&B.reverse();_e--;){var $e=B[_e];if(typeof $e!="function")throw new zc(h);if(Oe&&!ct&&gi($e)=="wrapper")var ct=new Wa([],!0)}for(_e=ct?_e:J;++_e<J;){var ft=gi($e=B[_e]),kt=ft=="wrapper"?ml($e):u;ct=kt&&gl(kt[0])&&kt[1]==424&&!kt[4].length&&kt[9]==1?ct[gi(kt[0])].apply(ct,kt[3]):$e.length==1&&gl($e)?ct[ft]():ct.thru($e)}return function(){var Wt=arguments,Yt=Wt[0];if(ct&&Wt.length==1&&Ur(Yt))return ct.plant(Yt).value();for(var rn=0,Gn=J?B[rn].apply(this,Wt):Yt;++rn<J;)Gn=B[rn].call(this,Gn);return Gn}}))}function dr(C,B,J,_e,Oe,$e,ct,ft,kt,Wt){var Yt=B&_,rn=1&B,Gn=2&B,pn=24&B,Nn=512&B,Ht=Gn?u:wd(C);return function mn(){for(var ir=arguments.length,Rn=Vn(ir),gr=ir;gr--;)Rn[gr]=arguments[gr];if(pn)var Er=Td(mn),si=(function(Ls,wa){for(var os=Ls.length,Bo=0;os--;)Ls[os]===wa&&++Bo;return Bo})(Rn,Er);if(_e&&(Rn=A0(Rn,_e,Oe,pn)),$e&&(Rn=m_(Rn,$e,ct,pn)),ir-=si,pn&&ir<Wt){var nr=zl(Rn,Er);return Qv(C,B,dr,mn.placeholder,J,Rn,nr,ft,kt,Wt-ir)}var jn=rn?J:this,Ti=Gn?jn[C]:C;return ir=Rn.length,ft?Rn=(function(Ls,wa){for(var os=Ls.length,Bo=qr(wa.length,os),zi=Xs(Ls);Bo--;){var qu=wa[Bo];Ls[Bo]=wo(qu,os)?zi[qu]:u}return Ls})(Rn,ft):Nn&&ir>1&&Rn.reverse(),Yt&&kt<ir&&(Rn.length=kt),this&&this!==Mn&&this instanceof mn&&(Ti=Ht||wd(Ti)),Ti.apply(jn,Rn)}}function Zv(C,B){return function(J,_e){return(function(Oe,$e,ct,ft){return Is(Oe,(function(kt,Wt,Yt){$e(ft,ct(kt),Wt,Yt)})),ft})(J,C,B(_e),{})}}function C0(C,B){return function(J,_e){var Oe;if(J===u&&_e===u)return B;if(J!==u&&(Oe=J),_e!==u){if(Oe===u)return _e;typeof J=="string"||typeof _e=="string"?(J=ea(J),_e=ea(_e)):(J=Rr(J),_e=Rr(_e)),Oe=C(J,_e)}return Oe}}function pl(C){return ta((function(B){return B=bs(B,yc(vr())),Xr((function(J){var _e=this;return C(B,(function(Oe){return ya(Oe,_e,J)}))}))}))}function Du(C,B){var J=(B=B===u?" ":ea(B)).length;if(J<2)return J?Qt(B,C):B;var _e=Qt(B,Ap(C/ul(B)));return Jo(B)?$c(ba(_e),0,C).join(""):_e.slice(0,C)}function g_(C){return function(B,J,_e){return _e&&typeof _e!="number"&&Po(B,J,_e)&&(J=_e=u),B=yl(B),J===u?(J=B,B=0):J=yl(J),(function(Oe,$e,ct,ft){for(var kt=-1,Wt=$s(Ap(($e-Oe)/(ct||1)),0),Yt=Vn(Wt);Wt--;)Yt[ft?Wt:++kt]=Oe,Oe+=ct;return Yt})(B,J,_e=_e===u?B<J?1:-1:yl(_e),C)}}function R0(C){return function(B,J){return typeof B=="string"&&typeof J=="string"||(B=bl(B),J=bl(J)),C(B,J)}}function Qv(C,B,J,_e,Oe,$e,ct,ft,kt,Wt){var Yt=8&B;B|=Yt?m:g,4&(B&=~(Yt?g:m))||(B&=-4);var rn=[C,B,Oe,Yt?$e:u,Yt?ct:u,Yt?u:$e,Yt?u:ct,ft,kt,Wt],Gn=J.apply(u,rn);return gl(C)&&Ad(Gn,rn),Gn.placeholder=_e,N0(Gn,C,B)}function __(C){var B=Vl[C];return function(J,_e){if(J=bl(J),(_e=_e==null?0:qr(Br(_e),292))&&dd(J)){var Oe=(Fr(J)+"e").split("e");return+((Oe=(Fr(B(Oe[0]+"e"+(+Oe[1]+_e)))+"e").split("e"))[0]+"e"+(+Oe[1]-_e))}return B(J)}}var Ab=$r&&1/Oo(new $r([,-0]))[1]==v?function(C){return new $r(C)}:Vh;function k0(C){return function(B){var J=xa(B);return J==z?zv(B):J==re?Hs(B):(function(_e,Oe){return bs(Oe,(function($e){return[$e,_e[$e]]}))})(B,C(B))}}function Lu(C,B,J,_e,Oe,$e,ct,ft){var kt=2&B;if(!kt&&typeof C!="function")throw new zc(h);var Wt=_e?_e.length:0;if(Wt||(B&=-97,_e=Oe=u),ct=ct===u?ct:$s(Br(ct),0),ft=ft===u?ft:Br(ft),Wt-=Oe?Oe.length:0,B&g){var Yt=_e,rn=Oe;_e=Oe=u}var Gn=kt?u:ml(C),pn=[C,B,J,_e,Oe,Yt,rn,$e,ct,ft];if(Gn&&(function(Ht,mn){var ir=Ht[1],Rn=mn[1],gr=ir|Rn,Er=gr<131,si=Rn==_&&ir==8||Rn==_&&ir==y&&Ht[7].length<=mn[8]||Rn==384&&mn[7].length<=mn[8]&&ir==8;if(!Er&&!si)return Ht;1&Rn&&(Ht[2]=mn[2],gr|=1&ir?0:4);var nr=mn[3];if(nr){var jn=Ht[3];Ht[3]=jn?A0(jn,nr,mn[4]):nr,Ht[4]=jn?zl(Ht[3],d):mn[4]}(nr=mn[5])&&(jn=Ht[5],Ht[5]=jn?m_(jn,nr,mn[6]):nr,Ht[6]=jn?zl(Ht[5],d):mn[6]),(nr=mn[7])&&(Ht[7]=nr),Rn&_&&(Ht[8]=Ht[8]==null?mn[8]:qr(Ht[8],mn[8])),Ht[9]==null&&(Ht[9]=mn[9]),Ht[0]=mn[0],Ht[1]=gr})(pn,Gn),C=pn[0],B=pn[1],J=pn[2],_e=pn[3],Oe=pn[4],!(ft=pn[9]=pn[9]===u?kt?0:C.length:$s(pn[9]-Wt,0))&&24&B&&(B&=-25),B&&B!=1)Nn=B==8||B==p?(function(Ht,mn,ir){var Rn=wd(Ht);return function gr(){for(var Er=arguments.length,si=Vn(Er),nr=Er,jn=Td(gr);nr--;)si[nr]=arguments[nr];var Ti=Er<3&&si[0]!==jn&&si[Er-1]!==jn?[]:zl(si,jn);return(Er-=Ti.length)<ir?Qv(Ht,mn,dr,gr.placeholder,u,si,Ti,u,u,ir-Er):ya(this&&this!==Mn&&this instanceof gr?Rn:Ht,this,si)}})(C,B,ft):B!=m&&B!=33||Oe.length?dr.apply(u,pn):(function(Ht,mn,ir,Rn){var gr=1&mn,Er=wd(Ht);return function si(){for(var nr=-1,jn=arguments.length,Ti=-1,Ls=Rn.length,wa=Vn(Ls+jn),os=this&&this!==Mn&&this instanceof si?Er:Ht;++Ti<Ls;)wa[Ti]=Rn[Ti];for(;jn--;)wa[Ti++]=arguments[++nr];return ya(os,gr?ir:this,wa)}})(C,B,J,_e);else var Nn=(function(Ht,mn,ir){var Rn=1&mn,gr=wd(Ht);return function Er(){return(this&&this!==Mn&&this instanceof Er?gr:Ht).apply(Rn?ir:this,arguments)}})(C,B,J);return N0((Gn?Kv:Ad)(Nn,pn),C,B)}function Fp(C,B,J,_e){return C===u||Gc(C,ld[J])&&!Yi.call(_e,J)?B:C}function v_(C,B,J,_e,Oe,$e){return gs(C)&&gs(B)&&($e.set(B,C),yd(C,B,u,v_,$e),$e.delete(B)),C}function Tx(C){return Wl(C)?u:C}function ey(C,B,J,_e,Oe,$e){var ct=1&J,ft=C.length,kt=B.length;if(ft!=kt&&!(ct&&kt>ft))return!1;var Wt=$e.get(C),Yt=$e.get(B);if(Wt&&Yt)return Wt==B&&Yt==C;var rn=-1,Gn=!0,pn=2&J?new fo:u;for($e.set(C,B),$e.set(B,C);++rn<ft;){var Nn=C[rn],Ht=B[rn];if(_e)var mn=ct?_e(Ht,Nn,rn,B,C,$e):_e(Nn,Ht,rn,C,B,$e);if(mn!==u){if(mn)continue;Gn=!1;break}if(pn){if(!jc(B,(function(ir,Rn){if(!wu(pn,Rn)&&(Nn===ir||Oe(Nn,ir,J,_e,$e)))return pn.push(Rn)}))){Gn=!1;break}}else if(Nn!==Ht&&!Oe(Nn,Ht,J,_e,$e)){Gn=!1;break}}return $e.delete(C),$e.delete(B),Gn}function ta(C){return I0(Bu(C,u,Ib),C+"")}function Ba(C){return $v(C,To,y_)}function na(C){return $v(C,Lo,Gl)}var ml=Au?function(C){return Au.get(C)}:Vh;function gi(C){for(var B=C.name+"",J=_f[B],_e=Yi.call(_f,B)?J.length:0;_e--;){var Oe=J[_e],$e=Oe.func;if($e==null||$e==C)return Oe.name}return B}function Td(C){return(Yi.call(Ue,"placeholder")?Ue:C).placeholder}function vr(){var C=Ue.iteratee||I_;return C=C===I_?wb:C,arguments.length?C(arguments[0],arguments[1]):C}function po(C,B){var J,_e,Oe=C.__data__;return((_e=typeof(J=B))=="string"||_e=="number"||_e=="symbol"||_e=="boolean"?J!=="__proto__":J===null)?Oe[typeof B=="string"?"string":"hash"]:Oe.map}function ra(C){for(var B=To(C),J=B.length;J--;){var _e=B[J],Oe=C[_e];B[J]=[_e,Oe,Af(Oe)]}return B}function fi(C,B){var J=(function(_e,Oe){return _e==null?u:_e[Oe]})(C,B);return Gv(J)?J:u}var y_=Cp?function(C){return C==null?[]:(C=Wr(C),cl(Cp(C),(function(B){return Tp.call(C,B)})))}:xs,Gl=Cp?function(C){for(var B=[];C;)gc(B,y_(C)),C=wp(C);return B}:xs,xa=Ea;function ty(C,B,J){for(var _e=-1,Oe=(B=xf(B,C)).length,$e=!1;++_e<Oe;){var ct=ju(B[_e]);if(!($e=C!=null&&J(C,ct)))break;C=C[ct]}return $e||++_e!=Oe?$e:!!(Oe=C==null?0:C.length)&&Gs(Oe)&&wo(ct,Oe)&&(Ur(C)||Wc(C))}function M0(C){return typeof C.constructor!="function"||O0(C)?{}:Ch(wp(C))}function ny(C){return Ur(C)||Wc(C)||!!(Tu&&C&&C[Tu])}function wo(C,B){var J=typeof C;return!!(B=B??E)&&(J=="number"||J!="symbol"&&Be.test(C))&&C>-1&&C%1==0&&C<B}function Po(C,B,J){if(!gs(J))return!1;var _e=typeof B;return!!(_e=="number"?Ja(J)&&wo(B,J.length):_e=="string"&&B in J)&&Gc(J[B],C)}function jp(C,B){if(Ur(C))return!1;var J=typeof C;return!(J!="number"&&J!="symbol"&&J!="boolean"&&C!=null&&!Ss(C))||tt.test(C)||!Xe.test(C)||B!=null&&C in Wr(B)}function gl(C){var B=gi(C),J=Ue[B];if(typeof J!="function"||!(B in ci.prototype))return!1;if(C===J)return!0;var _e=ml(J);return!!_e&&C===_e[0]}(hn&&xa(new hn(new ArrayBuffer(1)))!=ie||Sn&&xa(new Sn)!=z||pd&&xa(pd.resolve())!=K||$r&&xa(new $r)!=re||Cr&&xa(new Cr)!=Z)&&(xa=function(C){var B=Ea(C),J=B==G?C.constructor:u,_e=J?Cd(J):"";if(_e)switch(_e){case Rp:return ie;case md:return z;case m0:return K;case g0:return re;case Hv:return Z}return B});var Lh=ud?vl:Od;function O0(C){var B=C&&C.constructor;return C===(typeof B=="function"&&B.prototype||ld)}function Af(C){return C==C&&!gs(C)}function Uu(C,B){return function(J){return J!=null&&J[C]===B&&(B!==u||C in Wr(J))}}function Bu(C,B,J){return B=$s(B===u?C.length-1:B,0),function(){for(var _e=arguments,Oe=-1,$e=$s(_e.length-B,0),ct=Vn($e);++Oe<$e;)ct[Oe]=_e[B+Oe];Oe=-1;for(var ft=Vn(B+1);++Oe<B;)ft[Oe]=_e[Oe];return ft[B]=J(ct),ya(C,this,ft)}}function Fu(C,B){return B.length<2?C:bc(C,Ka(B,0,-1))}function zp(C,B){if((B!=="constructor"||typeof C[B]!="function")&&B!="__proto__")return C[B]}var Ad=Vp(Kv),Uh=Sb||function(C,B){return Mn.setTimeout(C,B)},I0=Vp(wx);function N0(C,B,J){var _e=B+"";return I0(C,(function(Oe,$e){var ct=$e.length;if(!ct)return Oe;var ft=ct-1;return $e[ft]=(ct>1?"& ":"")+$e[ft],$e=$e.join(ct>2?", ":" "),Oe.replace(W,`{
/* [wrapped with `+$e+`] */
`)})(_e,(function(Oe,$e){return Fc(T,(function(ct){var ft="_."+ct[0];$e&ct[1]&&!Sp(Oe,ft)&&Oe.push(ft)})),Oe.sort()})((function(Oe){var $e=Oe.match(oe);return $e?$e[1].split(xe):[]})(_e),J)))}function Vp(C){var B=0,J=0;return function(){var _e=Eb(),Oe=16-(_e-J);if(J=_e,Oe>0){if(++B>=800)return arguments[0]}else B=0;return C.apply(u,arguments)}}function P0(C,B){var J=-1,_e=C.length,Oe=_e-1;for(B=B===u?_e:B;++J<B;){var $e=E0(J,Oe),ct=C[$e];C[$e]=C[J],C[J]=ct}return C.length=B,C}var Cb=(function(C){var B=F0(C,(function(_e){return J.size===500&&J.clear(),_e})),J=B.cache;return B})((function(C){var B=[];return C.charCodeAt(0)===46&&B.push(""),C.replace(Nt,(function(J,_e,Oe,$e){B.push(Oe?$e.replace(ye,"$1"):_e||J)})),B}));function ju(C){if(typeof C=="string"||Ss(C))return C;var B=C+"";return B=="0"&&1/C==-1/0?"-0":B}function Cd(C){if(C!=null){try{return c0.call(C)}catch{}try{return C+""}catch{}}return""}function Rb(C){if(C instanceof ci)return C.clone();var B=new Wa(C.__wrapped__,C.__chain__);return B.__actions__=Xs(C.__actions__),B.__index__=C.__index__,B.__values__=C.__values__,B}var kb=Xr((function(C,B){return Js(C)?gd(C,Ki(B,1,Js,!0)):[]})),Mb=Xr((function(C,B){var J=mo(B);return Js(J)&&(J=u),Js(C)?gd(C,Ki(B,1,Js,!0),vr(J,2)):[]})),b_=Xr((function(C,B){var J=mo(B);return Js(J)&&(J=u),Js(C)?gd(C,Ki(B,1,Js,!0),u,J):[]}));function Ob(C,B,J){var _e=C==null?0:C.length;if(!_e)return-1;var Oe=J==null?0:Br(J);return Oe<0&&(Oe=$s(_e+Oe,0)),Th(C,vr(B,3),Oe)}function ry(C,B,J){var _e=C==null?0:C.length;if(!_e)return-1;var Oe=_e-1;return J!==u&&(Oe=Br(J),Oe=J<0?$s(_e+Oe,0):qr(Oe,_e-1)),Th(C,vr(B,3),Oe,!0)}function Ib(C){return C!=null&&C.length?Ki(C,1):[]}function Nb(C){return C&&C.length?C[0]:u}var Ax=Xr((function(C){var B=bs(C,Zt);return B.length&&B[0]===C[0]?l_(B):[]})),Pb=Xr((function(C){var B=mo(C),J=bs(C,Zt);return B===mo(J)?B=u:J.pop(),J.length&&J[0]===C[0]?l_(J,vr(B,2)):[]})),Db=Xr((function(C){var B=mo(C),J=bs(C,Zt);return(B=typeof B=="function"?B:u)&&J.pop(),J.length&&J[0]===C[0]?l_(J,u,B):[]}));function mo(C){var B=C==null?0:C.length;return B?C[B-1]:u}var iy=Xr(S_);function S_(C,B){return C&&C.length&&B&&B.length?Nh(C,B):C}var Cx=ta((function(C,B){var J=C==null?0:C.length,_e=a_(C,B);return d_(C,bs(B,(function(Oe){return wo(Oe,J)?+Oe:Oe})).sort(Ed)),_e}));function E_(C){return C==null?C:wn.call(C)}var Lb=Xr((function(C){return Hc(Ki(C,1,Js,!0))})),Ub=Xr((function(C){var B=mo(C);return Js(B)&&(B=u),Hc(Ki(C,1,Js,!0),vr(B,2))})),sy=Xr((function(C){var B=mo(C);return B=typeof B=="function"?B:u,Hc(Ki(C,1,Js,!0),u,B)}));function D0(C){if(!C||!C.length)return[];var B=0;return C=cl(C,(function(J){if(Js(J))return B=$s(J.length,B),!0})),Da(B,(function(J){return bs(C,Jg(J))}))}function Bb(C,B){if(!C||!C.length)return[];var J=D0(C);return B==null?J:bs(J,(function(_e){return ya(B,u,_e)}))}var Rx=Xr((function(C,B){return Js(C)?gd(C,B):[]})),kx=Xr((function(C){return T0(cl(C,Js))})),x_=Xr((function(C){var B=mo(C);return Js(B)&&(B=u),T0(cl(C,Js),vr(B,2))})),Hp=Xr((function(C){var B=mo(C);return B=typeof B=="function"?B:u,T0(cl(C,Js),u,B)})),$p=Xr(D0),Gp=Xr((function(C){var B=C.length,J=B>1?C[B-1]:u;return J=typeof J=="function"?(C.pop(),J):u,Bb(C,J)}));function Cf(C){var B=Ue(C);return B.__chain__=!0,B}function Bh(C,B){return B(C)}var Rf=ta((function(C){var B=C.length,J=B?C[0]:0,_e=this.__wrapped__,Oe=function($e){return a_($e,C)};return!(B>1||this.__actions__.length)&&_e instanceof ci&&wo(J)?((_e=_e.slice(J,+J+(B?1:0))).__actions__.push({func:Bh,args:[Oe],thisArg:u}),new Wa(_e,this.__chain__).thru((function($e){return B&&!$e.length&&$e.push(u),$e}))):this.thru(Oe)})),w_=Tf((function(C,B,J){Yi.call(C,J)?++C[J]:Zo(C,J,1)})),Mx=Jv(Ob),Ox=Jv(ry);function L0(C,B){return(Ur(C)?Fc:Mu)(C,vr(B,3))}function Fb(C,B){return(Ur(C)?Bv:v0)(C,vr(B,3))}var Ix=Tf((function(C,B,J){Yi.call(C,J)?C[J].push(B):Zo(C,J,[B])})),U0=Xr((function(C,B,J){var _e=-1,Oe=typeof B=="function",$e=Ja(C)?Vn(C.length):[];return Mu(C,(function(ct){$e[++_e]=Oe?ya(B,ct,J):Oh(ct,B,J)})),$e})),jb=Tf((function(C,B,J){Zo(C,J,B)}));function Fh(C,B){return(Ur(C)?bs:Ih)(C,vr(B,3))}var zb=Tf((function(C,B,J){C[J?0:1].push(B)}),(function(){return[[],[]]})),Vb=Xr((function(C,B){if(C==null)return[];var J=B.length;return J>1&&Po(C,B[0],B[1])?B=[]:J>2&&Po(B[0],B[1],B[2])&&(B=[B[0]]),Pp(C,Ki(B,1),[])})),B0=f0||function(){return Mn.Date.now()};function oy(C,B,J){return B=J?u:B,B=C&&B==null?C.length:B,Lu(C,_,u,u,u,u,B)}function ay(C,B){var J;if(typeof B!="function")throw new zc(h);return C=Br(C),function(){return--C>0&&(J=B.apply(this,arguments)),C<=1&&(B=u),J}}var T_=Xr((function(C,B,J){var _e=1;if(J.length){var Oe=zl(J,Td(T_));_e|=m}return Lu(C,_e,B,J,Oe)})),A_=Xr((function(C,B,J){var _e=3;if(J.length){var Oe=zl(J,Td(A_));_e|=m}return Lu(B,_e,C,J,Oe)}));function cy(C,B,J){var _e,Oe,$e,ct,ft,kt,Wt=0,Yt=!1,rn=!1,Gn=!0;if(typeof C!="function")throw new zc(h);function pn(Rn){var gr=_e,Er=Oe;return _e=Oe=u,Wt=Rn,ct=C.apply(Er,gr)}function Nn(Rn){var gr=Rn-kt;return kt===u||gr>=B||gr<0||rn&&Rn-Wt>=$e}function Ht(){var Rn=B0();if(Nn(Rn))return mn(Rn);ft=Uh(Ht,(function(gr){var Er=B-(gr-kt);return rn?qr(Er,$e-(gr-Wt)):Er})(Rn))}function mn(Rn){return ft=u,Gn&&_e?pn(Rn):(_e=Oe=u,ct)}function ir(){var Rn=B0(),gr=Nn(Rn);if(_e=arguments,Oe=this,kt=Rn,gr){if(ft===u)return(function(Er){return Wt=Er,ft=Uh(Ht,B),Yt?pn(Er):ct})(kt);if(rn)return p_(ft),ft=Uh(Ht,B),pn(kt)}return ft===u&&(ft=Uh(Ht,B)),ct}return B=bl(B)||0,gs(J)&&(Yt=!!J.leading,$e=(rn="maxWait"in J)?$s(bl(J.maxWait)||0,B):$e,Gn="trailing"in J?!!J.trailing:Gn),ir.cancel=function(){ft!==u&&p_(ft),Wt=0,_e=kt=Oe=ft=u},ir.flush=function(){return ft===u?ct:mn(B0())},ir}var ly=Xr((function(C,B){return ku(C,1,B)})),Hb=Xr((function(C,B,J){return ku(C,bl(B)||0,J)}));function F0(C,B){if(typeof C!="function"||B!=null&&typeof B!="function")throw new zc(h);var J=function(){var _e=arguments,Oe=B?B.apply(this,_e):_e[0],$e=J.cache;if($e.has(Oe))return $e.get(Oe);var ct=C.apply(this,_e);return J.cache=$e.set(Oe,ct)||$e,ct};return J.cache=new(F0.Cache||Cu),J}function j0(C){if(typeof C!="function")throw new zc(h);return function(){var B=arguments;switch(B.length){case 0:return!C.call(this);case 1:return!C.call(this,B[0]);case 2:return!C.call(this,B[0],B[1]);case 3:return!C.call(this,B[0],B[1],B[2])}return!C.apply(this,B)}}F0.Cache=Cu;var Do=Ua((function(C,B){var J=(B=B.length==1&&Ur(B[0])?bs(B[0],yc(vr())):bs(Ki(B,1),yc(vr()))).length;return Xr((function(_e){for(var Oe=-1,$e=qr(_e.length,J);++Oe<$e;)_e[Oe]=B[Oe].call(this,_e[Oe]);return ya(C,this,_e)}))})),z0=Xr((function(C,B){var J=zl(B,Td(z0));return Lu(C,m,u,B,J)})),$b=Xr((function(C,B){var J=zl(B,Td($b));return Lu(C,g,u,B,J)})),_l=ta((function(C,B){return Lu(C,y,u,u,u,B)}));function Gc(C,B){return C===B||C!=C&&B!=B}var V0=R0(Ou),uy=R0((function(C,B){return C>=B})),Wc=S0((function(){return arguments})())?S0:function(C){return Zs(C)&&Yi.call(C,"callee")&&!Tp.call(C,"callee")},Ur=Vn.isArray,Nx=Bc?yc(Bc):function(C){return Zs(C)&&Ea(C)==Q};function Ja(C){return C!=null&&Gs(C.length)&&!vl(C)}function Js(C){return Zs(C)&&Ja(C)}var kf=r_||Od,Px=e0?yc(e0):function(C){return Zs(C)&&Ea(C)==F};function hy(C){if(!Zs(C))return!1;var B=Ea(C);return B==M||B=="[object DOMException]"||typeof C.message=="string"&&typeof C.name=="string"&&!Wl(C)}function vl(C){if(!gs(C))return!1;var B=Ea(C);return B==D||B==O||B=="[object AsyncFunction]"||B=="[object Proxy]"}function C_(C){return typeof C=="number"&&C==Br(C)}function Gs(C){return typeof C=="number"&&C>-1&&C%1==0&&C<=E}function gs(C){var B=typeof C;return C!=null&&(B=="object"||B=="function")}function Zs(C){return C!=null&&typeof C=="object"}var fy=qg?yc(qg):function(C){return Zs(C)&&xa(C)==z};function dy(C){return typeof C=="number"||Zs(C)&&Ea(C)==q}function Wl(C){if(!Zs(C)||Ea(C)!=G)return!1;var B=wp(C);if(B===null)return!0;var J=Yi.call(B,"constructor")&&B.constructor;return typeof J=="function"&&J instanceof J&&c0.call(J)==bb}var H0=Yg?yc(Yg):function(C){return Zs(C)&&Ea(C)==te},zu=Kg?yc(Kg):function(C){return Zs(C)&&xa(C)==re};function jh(C){return typeof C=="string"||!Ur(C)&&Zs(C)&&Ea(C)==H}function Ss(C){return typeof C=="symbol"||Zs(C)&&Ea(C)==Y}var Vu=bp?yc(bp):function(C){return Zs(C)&&Gs(C.length)&&!!br[Ea(C)]},R_=R0(Ef),$0=R0((function(C,B){return C<=B}));function G0(C){if(!C)return[];if(Ja(C))return jh(C)?ba(C):Xs(C);if(fd&&C[fd])return(function(J){for(var _e,Oe=[];!(_e=J.next()).done;)Oe.push(_e.value);return Oe})(C[fd]());var B=xa(C);return(B==z?zv:B==re?Oo:wc)(C)}function yl(C){return C?(C=bl(C))===v||C===-1/0?17976931348623157e292*(C<0?-1:1):C==C?C:0:C===0?C:0}function Br(C){var B=yl(C),J=B%1;return B==B?J?B-J:B:0}function k_(C){return C?Mh(Br(C),0,A):0}function bl(C){if(typeof C=="number")return C;if(Ss(C))return x;if(gs(C)){var B=typeof C.valueOf=="function"?C.valueOf():C;C=gs(B)?B+"":B}if(typeof C!="string")return C===0?C:+C;C=i0(C);var J=Fe.test(C);return J||at.test(C)?Rs(C.slice(2),J?2:8):He.test(C)?x:+C}function Gb(C){return Ec(C,Lo(C))}function Fr(C){return C==null?"":ea(C)}var Wb=Nu((function(C,B){if(O0(B)||Ja(B))Ec(B,To(B),C);else for(var J in B)Yi.call(B,J)&&La(C,J,B[J])})),qb=Nu((function(C,B){Ec(B,Lo(B),C)})),Rd=Nu((function(C,B,J,_e){Ec(B,Lo(B),C,_e)})),Dx=Nu((function(C,B,J,_e){Ec(B,To(B),C,_e)})),Lx=ta(a_),Ux=Xr((function(C,B){C=Wr(C);var J=-1,_e=B.length,Oe=_e>2?B[2]:u;for(Oe&&Po(B[0],B[1],Oe)&&(_e=1);++J<_e;)for(var $e=B[J],ct=Lo($e),ft=-1,kt=ct.length;++ft<kt;){var Wt=ct[ft],Yt=C[Wt];(Yt===u||Gc(Yt,ld[Wt])&&!Yi.call(C,Wt))&&(C[Wt]=$e[Wt])}return C})),W0=Xr((function(C){return C.push(u,v_),ya(ia,u,C)}));function Za(C,B,J){var _e=C==null?u:bc(C,B);return _e===u?J:_e}function Qa(C,B){return C!=null&&ty(C,B,xb)}var Yb=Zv((function(C,B,J){B!=null&&typeof B.toString!="function"&&(B=u0.call(B)),C[B]=J}),zh(_s)),Bx=Zv((function(C,B,J){B!=null&&typeof B.toString!="function"&&(B=u0.call(B)),Yi.call(C,B)?C[B].push(J):C[B]=[J]}),vr),py=Xr(Oh);function To(C){return Ja(C)?Ru(C):u_(C)}function Lo(C){return Ja(C)?Ru(C,!0):Wv(C)}var ec=Nu((function(C,B,J){yd(C,B,J)})),ia=Nu((function(C,B,J,_e){yd(C,B,J,_e)})),Oi=ta((function(C,B){var J={};if(C==null)return J;var _e=!1;B=bs(B,(function($e){return $e=xf($e,C),_e||(_e=$e.length>1),$e})),Ec(C,na(C),J),_e&&(J=Qo(J,7,Tx));for(var Oe=B.length;Oe--;)Xv(J,B[Oe]);return J})),M_=ta((function(C,B){return C==null?{}:(function(J,_e){return Yv(J,_e,(function(Oe,$e){return Qa(J,$e)}))})(C,B)}));function kd(C,B){if(C==null)return{};var J=bs(na(C),(function(_e){return[_e]}));return B=vr(B),Yv(C,J,(function(_e,Oe){return B(_e,Oe[0])}))}var qc=k0(To),xc=k0(Lo);function wc(C){return C==null?[]:Qg(C,To(C))}var Hu=xd((function(C,B,J){return B=B.toLowerCase(),C+(J?ql(B):B)}));function ql(C){return Yl(Fr(C).toLowerCase())}function sa(C){return(C=Fr(C))&&C.replace(nt,e_).replace(Cn,"")}var q0=xd((function(C,B,J){return C+(J?"-":"")+B.toLowerCase()})),Mf=xd((function(C,B,J){return C+(J?" ":"")+B.toLowerCase()})),O_=Up("toLowerCase"),Uo=xd((function(C,B,J){return C+(J?"_":"")+B.toLowerCase()})),li=xd((function(C,B,J){return C+(J?" ":"")+Yl(B)})),_i=xd((function(C,B,J){return C+(J?" ":"")+B.toUpperCase()})),Yl=Up("toUpperCase");function Yc(C,B,J){return C=Fr(C),(B=J?u:B)===u?(function(_e){return Lr.test(_e)})(C)?(function(_e){return _e.match(Hr)||[]})(C):(function(_e){return _e.match(Ce)||[]})(C):C.match(B)||[]}var Of=Xr((function(C,B){try{return ya(C,u,B)}catch(J){return hy(J)?J:new Si(J)}})),oa=ta((function(C,B){return Fc(B,(function(J){J=ju(J),Zo(C,J,T_(C[J],C))})),C}));function zh(C){return function(){return C}}var $u=Bp(),Kb=Bp(!0);function _s(C){return C}function I_(C){return wb(typeof C=="function"?C:Qo(C,1))}var Ps=Xr((function(C,B){return function(J){return Oh(J,C,B)}})),N_=Xr((function(C,B){return function(J){return Oh(C,J,B)}}));function Es(C,B,J){var _e=To(B),Oe=b0(B,_e);J!=null||gs(B)&&(Oe.length||!_e.length)||(J=B,B=C,C=this,Oe=b0(B,To(B)));var $e=!(gs(J)&&"chain"in J&&!J.chain),ct=vl(C);return Fc(Oe,(function(ft){var kt=B[ft];C[ft]=kt,ct&&(C.prototype[ft]=function(){var Wt=this.__chain__;if($e||Wt){var Yt=C(this.__wrapped__);return(Yt.__actions__=Xs(this.__actions__)).push({func:kt,args:arguments,thisArg:C}),Yt.__chain__=Wt,Yt}return kt.apply(C,gc([this.value()],arguments))})})),C}function Vh(){}var Y0=pl(bs),P_=pl(Xg),Md=pl(jc);function Wp(C){return jp(C)?Jg(ju(C)):(function(B){return function(J){return bc(J,B)}})(C)}var my=g_(),Gu=g_(!0);function xs(){return[]}function Od(){return!1}var Ds=C0((function(C,B){return C+B}),0),Tc=__("ceil"),gy=C0((function(C,B){return C/B}),1),If=__("floor"),Hh,Qs=C0((function(C,B){return C*B}),1),Ws=__("round"),Wu=C0((function(C,B){return C-B}),0);return Ue.after=function(C,B){if(typeof B!="function")throw new zc(h);return C=Br(C),function(){if(--C<1)return B.apply(this,arguments)}},Ue.ary=oy,Ue.assign=Wb,Ue.assignIn=qb,Ue.assignInWith=Rd,Ue.assignWith=Dx,Ue.at=Lx,Ue.before=ay,Ue.bind=T_,Ue.bindAll=oa,Ue.bindKey=A_,Ue.castArray=function(){if(!arguments.length)return[];var C=arguments[0];return Ur(C)?C:[C]},Ue.chain=Cf,Ue.chunk=function(C,B,J){B=(J?Po(C,B,J):B===u)?1:$s(Br(B),0);var _e=C==null?0:C.length;if(!_e||B<1)return[];for(var Oe=0,$e=0,ct=Vn(Ap(_e/B));Oe<_e;)ct[$e++]=Ka(C,Oe,Oe+=B);return ct},Ue.compact=function(C){for(var B=-1,J=C==null?0:C.length,_e=0,Oe=[];++B<J;){var $e=C[B];$e&&(Oe[_e++]=$e)}return Oe},Ue.concat=function(){var C=arguments.length;if(!C)return[];for(var B=Vn(C-1),J=arguments[0],_e=C;_e--;)B[_e-1]=arguments[_e];return gc(Ur(J)?Xs(J):[J],Ki(B,1))},Ue.cond=function(C){var B=C==null?0:C.length,J=vr();return C=B?bs(C,(function(_e){if(typeof _e[1]!="function")throw new zc(h);return[J(_e[0]),_e[1]]})):[],Xr((function(_e){for(var Oe=-1;++Oe<B;){var $e=C[Oe];if(ya($e[0],this,_e))return ya($e[1],this,_e)}}))},Ue.conforms=function(C){return(function(B){var J=To(B);return function(_e){return qa(_e,B,J)}})(Qo(C,1))},Ue.constant=zh,Ue.countBy=w_,Ue.create=function(C,B){var J=Ch(C);return B==null?J:Op(J,B)},Ue.curry=function C(B,J,_e){var Oe=Lu(B,8,u,u,u,u,u,J=_e?u:J);return Oe.placeholder=C.placeholder,Oe},Ue.curryRight=function C(B,J,_e){var Oe=Lu(B,p,u,u,u,u,u,J=_e?u:J);return Oe.placeholder=C.placeholder,Oe},Ue.debounce=cy,Ue.defaults=Ux,Ue.defaultsDeep=W0,Ue.defer=ly,Ue.delay=Hb,Ue.difference=kb,Ue.differenceBy=Mb,Ue.differenceWith=b_,Ue.drop=function(C,B,J){var _e=C==null?0:C.length;return _e?Ka(C,(B=J||B===u?1:Br(B))<0?0:B,_e):[]},Ue.dropRight=function(C,B,J){var _e=C==null?0:C.length;return _e?Ka(C,0,(B=_e-(B=J||B===u?1:Br(B)))<0?0:B):[]},Ue.dropRightWhile=function(C,B){return C&&C.length?No(C,vr(B,3),!0,!0):[]},Ue.dropWhile=function(C,B){return C&&C.length?No(C,vr(B,3),!0):[]},Ue.fill=function(C,B,J,_e){var Oe=C==null?0:C.length;return Oe?(J&&typeof J!="number"&&Po(C,B,J)&&(J=0,_e=Oe),(function($e,ct,ft,kt){var Wt=$e.length;for((ft=Br(ft))<0&&(ft=-ft>Wt?0:Wt+ft),(kt=kt===u||kt>Wt?Wt:Br(kt))<0&&(kt+=Wt),kt=ft>kt?0:k_(kt);ft<kt;)$e[ft++]=ct;return $e})(C,B,J,_e)):[]},Ue.filter=function(C,B){return(Ur(C)?cl:wr)(C,vr(B,3))},Ue.flatMap=function(C,B){return Ki(Fh(C,B),1)},Ue.flatMapDeep=function(C,B){return Ki(Fh(C,B),v)},Ue.flatMapDepth=function(C,B,J){return J=J===u?1:Br(J),Ki(Fh(C,B),J)},Ue.flatten=Ib,Ue.flattenDeep=function(C){return C!=null&&C.length?Ki(C,v):[]},Ue.flattenDepth=function(C,B){return C!=null&&C.length?Ki(C,B=B===u?1:Br(B)):[]},Ue.flip=function(C){return Lu(C,512)},Ue.flow=$u,Ue.flowRight=Kb,Ue.fromPairs=function(C){for(var B=-1,J=C==null?0:C.length,_e={};++B<J;){var Oe=C[B];_e[Oe[0]]=Oe[1]}return _e},Ue.functions=function(C){return C==null?[]:b0(C,To(C))},Ue.functionsIn=function(C){return C==null?[]:b0(C,Lo(C))},Ue.groupBy=Ix,Ue.initial=function(C){return C!=null&&C.length?Ka(C,0,-1):[]},Ue.intersection=Ax,Ue.intersectionBy=Pb,Ue.intersectionWith=Db,Ue.invert=Yb,Ue.invertBy=Bx,Ue.invokeMap=U0,Ue.iteratee=I_,Ue.keyBy=jb,Ue.keys=To,Ue.keysIn=Lo,Ue.map=Fh,Ue.mapKeys=function(C,B){var J={};return B=vr(B,3),Is(C,(function(_e,Oe,$e){Zo(J,B(_e,Oe,$e),_e)})),J},Ue.mapValues=function(C,B){var J={};return B=vr(B,3),Is(C,(function(_e,Oe,$e){Zo(J,Oe,B(_e,Oe,$e))})),J},Ue.matches=function(C){return qv(Qo(C,1))},Ue.matchesProperty=function(C,B){return h_(C,Qo(B,1))},Ue.memoize=F0,Ue.merge=ec,Ue.mergeWith=ia,Ue.method=Ps,Ue.methodOf=N_,Ue.mixin=Es,Ue.negate=j0,Ue.nthArg=function(C){return C=Br(C),Xr((function(B){return f_(B,C)}))},Ue.omit=Oi,Ue.omitBy=function(C,B){return kd(C,j0(vr(B)))},Ue.once=function(C){return ay(2,C)},Ue.orderBy=function(C,B,J,_e){return C==null?[]:(Ur(B)||(B=B==null?[]:[B]),Ur(J=_e?u:J)||(J=J==null?[]:[J]),Pp(C,B,J))},Ue.over=Y0,Ue.overArgs=Do,Ue.overEvery=P_,Ue.overSome=Md,Ue.partial=z0,Ue.partialRight=$b,Ue.partition=zb,Ue.pick=M_,Ue.pickBy=kd,Ue.property=Wp,Ue.propertyOf=function(C){return function(B){return C==null?u:bc(C,B)}},Ue.pull=iy,Ue.pullAll=S_,Ue.pullAllBy=function(C,B,J){return C&&C.length&&B&&B.length?Nh(C,B,vr(J,2)):C},Ue.pullAllWith=function(C,B,J){return C&&C.length&&B&&B.length?Nh(C,B,u,J):C},Ue.pullAt=Cx,Ue.range=my,Ue.rangeRight=Gu,Ue.rearg=_l,Ue.reject=function(C,B){return(Ur(C)?cl:wr)(C,j0(vr(B,3)))},Ue.remove=function(C,B){var J=[];if(!C||!C.length)return J;var _e=-1,Oe=[],$e=C.length;for(B=vr(B,3);++_e<$e;){var ct=C[_e];B(ct,_e,C)&&(J.push(ct),Oe.push(_e))}return d_(C,Oe),J},Ue.rest=function(C,B){if(typeof C!="function")throw new zc(h);return Xr(C,B=B===u?B:Br(B))},Ue.reverse=E_,Ue.sampleSize=function(C,B,J){return B=(J?Po(C,B,J):B===u)?1:Br(B),(Ur(C)?Rh:Tb)(C,B)},Ue.set=function(C,B,J){return C==null?C:x0(C,B,J)},Ue.setWith=function(C,B,J,_e){return _e=typeof _e=="function"?_e:u,C==null?C:x0(C,B,J,_e)},Ue.shuffle=function(C){return(Ur(C)?Io:bd)(C)},Ue.slice=function(C,B,J){var _e=C==null?0:C.length;return _e?(J&&typeof J!="number"&&Po(C,B,J)?(B=0,J=_e):(B=B==null?0:Br(B),J=J===u?_e:Br(J)),Ka(C,B,J)):[]},Ue.sortBy=Vb,Ue.sortedUniq=function(C){return C&&C.length?Ph(C):[]},Ue.sortedUniqBy=function(C,B){return C&&C.length?Ph(C,vr(B,2)):[]},Ue.split=function(C,B,J){return J&&typeof J!="number"&&Po(C,B,J)&&(B=J=u),(J=J===u?A:J>>>0)?(C=Fr(C))&&(typeof B=="string"||B!=null&&!H0(B))&&!(B=ea(B))&&Jo(C)?$c(ba(C),0,J):C.split(B,J):[]},Ue.spread=function(C,B){if(typeof C!="function")throw new zc(h);return B=B==null?0:$s(Br(B),0),Xr((function(J){var _e=J[B],Oe=$c(J,0,B);return _e&&gc(Oe,_e),ya(C,this,Oe)}))},Ue.tail=function(C){var B=C==null?0:C.length;return B?Ka(C,1,B):[]},Ue.take=function(C,B,J){return C&&C.length?Ka(C,0,(B=J||B===u?1:Br(B))<0?0:B):[]},Ue.takeRight=function(C,B,J){var _e=C==null?0:C.length;return _e?Ka(C,(B=_e-(B=J||B===u?1:Br(B)))<0?0:B,_e):[]},Ue.takeRightWhile=function(C,B){return C&&C.length?No(C,vr(B,3),!1,!0):[]},Ue.takeWhile=function(C,B){return C&&C.length?No(C,vr(B,3)):[]},Ue.tap=function(C,B){return B(C),C},Ue.throttle=function(C,B,J){var _e=!0,Oe=!0;if(typeof C!="function")throw new zc(h);return gs(J)&&(_e="leading"in J?!!J.leading:_e,Oe="trailing"in J?!!J.trailing:Oe),cy(C,B,{leading:_e,maxWait:B,trailing:Oe})},Ue.thru=Bh,Ue.toArray=G0,Ue.toPairs=qc,Ue.toPairsIn=xc,Ue.toPath=function(C){return Ur(C)?bs(C,ju):Ss(C)?[C]:Xs(Cb(Fr(C)))},Ue.toPlainObject=Gb,Ue.transform=function(C,B,J){var _e=Ur(C),Oe=_e||kf(C)||Vu(C);if(B=vr(B,4),J==null){var $e=C&&C.constructor;J=Oe?_e?new $e:[]:gs(C)&&vl($e)?Ch(wp(C)):{}}return(Oe?Fc:Is)(C,(function(ct,ft,kt){return B(J,ct,ft,kt)})),J},Ue.unary=function(C){return oy(C,1)},Ue.union=Lb,Ue.unionBy=Ub,Ue.unionWith=sy,Ue.uniq=function(C){return C&&C.length?Hc(C):[]},Ue.uniqBy=function(C,B){return C&&C.length?Hc(C,vr(B,2)):[]},Ue.uniqWith=function(C,B){return B=typeof B=="function"?B:u,C&&C.length?Hc(C,u,B):[]},Ue.unset=function(C,B){return C==null||Xv(C,B)},Ue.unzip=D0,Ue.unzipWith=Bb,Ue.update=function(C,B,J){return C==null?C:w0(C,B,Sr(J))},Ue.updateWith=function(C,B,J,_e){return _e=typeof _e=="function"?_e:u,C==null?C:w0(C,B,Sr(J),_e)},Ue.values=wc,Ue.valuesIn=function(C){return C==null?[]:Qg(C,Lo(C))},Ue.without=Rx,Ue.words=Yc,Ue.wrap=function(C,B){return z0(Sr(B),C)},Ue.xor=kx,Ue.xorBy=x_,Ue.xorWith=Hp,Ue.zip=$p,Ue.zipObject=function(C,B){return Sc(C||[],B||[],La)},Ue.zipObjectDeep=function(C,B){return Sc(C||[],B||[],x0)},Ue.zipWith=Gp,Ue.entries=qc,Ue.entriesIn=xc,Ue.extend=qb,Ue.extendWith=Rd,Es(Ue,Ue),Ue.add=Ds,Ue.attempt=Of,Ue.camelCase=Hu,Ue.capitalize=ql,Ue.ceil=Tc,Ue.clamp=function(C,B,J){return J===u&&(J=B,B=u),J!==u&&(J=(J=bl(J))==J?J:0),B!==u&&(B=(B=bl(B))==B?B:0),Mh(bl(C),B,J)},Ue.clone=function(C){return Qo(C,4)},Ue.cloneDeep=function(C){return Qo(C,5)},Ue.cloneDeepWith=function(C,B){return Qo(C,5,B=typeof B=="function"?B:u)},Ue.cloneWith=function(C,B){return Qo(C,4,B=typeof B=="function"?B:u)},Ue.conformsTo=function(C,B){return B==null||qa(C,B,To(B))},Ue.deburr=sa,Ue.defaultTo=function(C,B){return C==null||C!=C?B:C},Ue.divide=gy,Ue.endsWith=function(C,B,J){C=Fr(C),B=ea(B);var _e=C.length,Oe=J=J===u?_e:Mh(Br(J),0,_e);return(J-=B.length)>=0&&C.slice(J,Oe)==B},Ue.eq=Gc,Ue.escape=function(C){return(C=Fr(C))&&we.test(C)?C.replace(ae,ll):C},Ue.escapeRegExp=function(C){return(C=Fr(C))&&wt.test(C)?C.replace(gt,"\\$&"):C},Ue.every=function(C,B,J){var _e=Ur(C)?Xg:y0;return J&&Po(C,B,J)&&(B=u),_e(C,vr(B,3))},Ue.find=Mx,Ue.findIndex=Ob,Ue.findKey=function(C,B){return xu(C,vr(B,3),Is)},Ue.findLast=Ox,Ue.findLastIndex=ry,Ue.findLastKey=function(C,B){return xu(C,vr(B,3),Ip)},Ue.floor=If,Ue.forEach=L0,Ue.forEachRight=Fb,Ue.forIn=function(C,B){return C==null?C:c_(C,vr(B,3),Lo)},Ue.forInRight=function(C,B){return C==null?C:Ya(C,vr(B,3),Lo)},Ue.forOwn=function(C,B){return C&&Is(C,vr(B,3))},Ue.forOwnRight=function(C,B){return C&&Ip(C,vr(B,3))},Ue.get=Za,Ue.gt=V0,Ue.gte=uy,Ue.has=function(C,B){return C!=null&&ty(C,B,Np)},Ue.hasIn=Qa,Ue.head=Nb,Ue.identity=_s,Ue.includes=function(C,B,J,_e){C=Ja(C)?C:wc(C),J=J&&!_e?Br(J):0;var Oe=C.length;return J<0&&(J=$s(Oe+J,0)),jh(C)?J<=Oe&&C.indexOf(B,J)>-1:!!Oe&&vc(C,B,J)>-1},Ue.indexOf=function(C,B,J){var _e=C==null?0:C.length;if(!_e)return-1;var Oe=J==null?0:Br(J);return Oe<0&&(Oe=$s(_e+Oe,0)),vc(C,B,Oe)},Ue.inRange=function(C,B,J){return B=yl(B),J===u?(J=B,B=0):J=yl(J),(function(_e,Oe,$e){return _e>=qr(Oe,$e)&&_e<$s(Oe,$e)})(C=bl(C),B,J)},Ue.invoke=py,Ue.isArguments=Wc,Ue.isArray=Ur,Ue.isArrayBuffer=Nx,Ue.isArrayLike=Ja,Ue.isArrayLikeObject=Js,Ue.isBoolean=function(C){return C===!0||C===!1||Zs(C)&&Ea(C)==I},Ue.isBuffer=kf,Ue.isDate=Px,Ue.isElement=function(C){return Zs(C)&&C.nodeType===1&&!Wl(C)},Ue.isEmpty=function(C){if(C==null)return!0;if(Ja(C)&&(Ur(C)||typeof C=="string"||typeof C.splice=="function"||kf(C)||Vu(C)||Wc(C)))return!C.length;var B=xa(C);if(B==z||B==re)return!C.size;if(O0(C))return!u_(C).length;for(var J in C)if(Yi.call(C,J))return!1;return!0},Ue.isEqual=function(C,B){return vd(C,B)},Ue.isEqualWith=function(C,B,J){var _e=(J=typeof J=="function"?J:u)?J(C,B):u;return _e===u?vd(C,B,u,J):!!_e},Ue.isError=hy,Ue.isFinite=function(C){return typeof C=="number"&&dd(C)},Ue.isFunction=vl,Ue.isInteger=C_,Ue.isLength=Gs,Ue.isMap=fy,Ue.isMatch=function(C,B){return C===B||Sf(C,B,ra(B))},Ue.isMatchWith=function(C,B,J){return J=typeof J=="function"?J:u,Sf(C,B,ra(B),J)},Ue.isNaN=function(C){return dy(C)&&C!=+C},Ue.isNative=function(C){if(Lh(C))throw new Si("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Gv(C)},Ue.isNil=function(C){return C==null},Ue.isNull=function(C){return C===null},Ue.isNumber=dy,Ue.isObject=gs,Ue.isObjectLike=Zs,Ue.isPlainObject=Wl,Ue.isRegExp=H0,Ue.isSafeInteger=function(C){return C_(C)&&C>=-9007199254740991&&C<=E},Ue.isSet=zu,Ue.isString=jh,Ue.isSymbol=Ss,Ue.isTypedArray=Vu,Ue.isUndefined=function(C){return C===u},Ue.isWeakMap=function(C){return Zs(C)&&xa(C)==Z},Ue.isWeakSet=function(C){return Zs(C)&&Ea(C)=="[object WeakSet]"},Ue.join=function(C,B){return C==null?"":i_.call(C,B)},Ue.kebabCase=q0,Ue.last=mo,Ue.lastIndexOf=function(C,B,J){var _e=C==null?0:C.length;if(!_e)return-1;var Oe=_e;return J!==u&&(Oe=(Oe=Br(J))<0?$s(_e+Oe,0):qr(Oe,_e-1)),B==B?(function($e,ct,ft){for(var kt=ft+1;kt--;)if($e[kt]===ct)return kt;return kt})(C,B,Oe):Th(C,n0,Oe,!0)},Ue.lowerCase=Mf,Ue.lowerFirst=O_,Ue.lt=R_,Ue.lte=$0,Ue.max=function(C){return C&&C.length?_d(C,_s,Ou):u},Ue.maxBy=function(C,B){return C&&C.length?_d(C,vr(B,2),Ou):u},Ue.mean=function(C){return Fv(C,_s)},Ue.meanBy=function(C,B){return Fv(C,vr(B,2))},Ue.min=function(C){return C&&C.length?_d(C,_s,Ef):u},Ue.minBy=function(C,B){return C&&C.length?_d(C,vr(B,2),Ef):u},Ue.stubArray=xs,Ue.stubFalse=Od,Ue.stubObject=function(){return{}},Ue.stubString=function(){return""},Ue.stubTrue=function(){return!0},Ue.multiply=Qs,Ue.nth=function(C,B){return C&&C.length?f_(C,Br(B)):u},Ue.noConflict=function(){return Mn._===this&&(Mn._=hl),this},Ue.noop=Vh,Ue.now=B0,Ue.pad=function(C,B,J){C=Fr(C);var _e=(B=Br(B))?ul(C):0;if(!B||_e>=B)return C;var Oe=(B-_e)/2;return Du(d0(Oe),J)+C+Du(Ap(Oe),J)},Ue.padEnd=function(C,B,J){C=Fr(C);var _e=(B=Br(B))?ul(C):0;return B&&_e<B?C+Du(B-_e,J):C},Ue.padStart=function(C,B,J){C=Fr(C);var _e=(B=Br(B))?ul(C):0;return B&&_e<B?Du(B-_e,J)+C:C},Ue.parseInt=function(C,B,J){return J||B==null?B=0:B&&(B=+B),Ex(Fr(C).replace(Re,""),B||0)},Ue.random=function(C,B,J){if(J&&typeof J!="boolean"&&Po(C,B,J)&&(B=J=u),J===u&&(typeof B=="boolean"?(J=B,B=u):typeof C=="boolean"&&(J=C,C=u)),C===u&&B===u?(C=0,B=1):(C=yl(C),B===u?(B=C,C=0):B=yl(B)),C>B){var _e=C;C=B,B=_e}if(J||C%1||B%1){var Oe=p0();return qr(C+Oe*(B-C+ai("1e-"+((Oe+"").length-1))),B)}return E0(C,B)},Ue.reduce=function(C,B,J){var _e=Ur(C)?pf:Zg,Oe=arguments.length<3;return _e(C,vr(B,4),J,Oe,Mu)},Ue.reduceRight=function(C,B,J){var _e=Ur(C)?_c:Zg,Oe=arguments.length<3;return _e(C,vr(B,4),J,Oe,v0)},Ue.repeat=function(C,B,J){return B=(J?Po(C,B,J):B===u)?1:Br(B),Qt(Fr(C),B)},Ue.replace=function(){var C=arguments,B=Fr(C[0]);return C.length<3?B:B.replace(C[1],C[2])},Ue.result=function(C,B,J){var _e=-1,Oe=(B=xf(B,C)).length;for(Oe||(Oe=1,C=u);++_e<Oe;){var $e=C==null?u:C[ju(B[_e])];$e===u&&(_e=Oe,$e=J),C=vl($e)?$e.call(C):$e}return C},Ue.round=Ws,Ue.runInContext=Bt,Ue.sample=function(C){return(Ur(C)?bf:xx)(C)},Ue.size=function(C){if(C==null)return 0;if(Ja(C))return jh(C)?ul(C):C.length;var B=xa(C);return B==z||B==re?C.size:u_(C).length},Ue.snakeCase=Uo,Ue.some=function(C,B,J){var _e=Ur(C)?jc:Ns;return J&&Po(C,B,J)&&(B=u),_e(C,vr(B,3))},Ue.sortedIndex=function(C,B){return Dp(C,B)},Ue.sortedIndexBy=function(C,B,J){return Xa(C,B,vr(J,2))},Ue.sortedIndexOf=function(C,B){var J=C==null?0:C.length;if(J){var _e=Dp(C,B);if(_e<J&&Gc(C[_e],B))return _e}return-1},Ue.sortedLastIndex=function(C,B){return Dp(C,B,!0)},Ue.sortedLastIndexBy=function(C,B,J){return Xa(C,B,vr(J,2),!0)},Ue.sortedLastIndexOf=function(C,B){if(C!=null&&C.length){var J=Dp(C,B,!0)-1;if(Gc(C[J],B))return J}return-1},Ue.startCase=li,Ue.startsWith=function(C,B,J){return C=Fr(C),J=J==null?0:Mh(Br(J),0,C.length),B=ea(B),C.slice(J,J+B.length)==B},Ue.subtract=Wu,Ue.sum=function(C){return C&&C.length?r0(C,_s):0},Ue.sumBy=function(C,B){return C&&C.length?r0(C,vr(B,2)):0},Ue.template=function(C,B,J){var _e=Ue.templateSettings;J&&Po(C,B,J)&&(B=u),C=Fr(C),B=Rd({},B,_e,Fp);var Oe,$e,ct=Rd({},B.imports,_e.imports,Fp),ft=To(ct),kt=Qg(ct,ft),Wt=0,Yt=B.interpolate||it,rn="__p += '",Gn=t_((B.escape||it).source+"|"+Yt.source+"|"+(Yt===Je?Ke:it).source+"|"+(B.evaluate||it).source+"|$","g"),pn="//# sourceURL="+(Yi.call(B,"sourceURL")?(B.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ar+"]")+`
`;C.replace(Gn,(function(mn,ir,Rn,gr,Er,si){return Rn||(Rn=gr),rn+=C.slice(Wt,si).replace(xt,ks),ir&&(Oe=!0,rn+=`' +
__e(`+ir+`) +
'`),Er&&($e=!0,rn+=`';
`+Er+`;
__p += '`),Rn&&(rn+=`' +
((__t = (`+Rn+`)) == null ? '' : __t) +
'`),Wt=si+mn.length,mn})),rn+=`';
`;var Nn=Yi.call(B,"variable")&&B.variable;if(Nn){if(Se.test(Nn))throw new Si("Invalid `variable` option passed into `_.template`")}else rn=`with (obj) {
`+rn+`
}
`;rn=($e?rn.replace(Le,""):rn).replace(Ve,"$1").replace(De,"$1;"),rn="function("+(Nn||"obj")+`) {
`+(Nn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Oe?", __e = _.escape":"")+($e?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+rn+`return __p
}`;var Ht=Of((function(){return ho(ft,pn+"return "+rn).apply(u,kt)}));if(Ht.source=rn,hy(Ht))throw Ht;return Ht},Ue.times=function(C,B){if((C=Br(C))<1||C>E)return[];var J=A,_e=qr(C,A);B=vr(B),C-=A;for(var Oe=Da(_e,B);++J<C;)B(J);return Oe},Ue.toFinite=yl,Ue.toInteger=Br,Ue.toLength=k_,Ue.toLower=function(C){return Fr(C).toLowerCase()},Ue.toNumber=bl,Ue.toSafeInteger=function(C){return C?Mh(Br(C),-9007199254740991,E):C===0?C:0},Ue.toString=Fr,Ue.toUpper=function(C){return Fr(C).toUpperCase()},Ue.trim=function(C,B,J){if((C=Fr(C))&&(J||B===u))return i0(C);if(!C||!(B=ea(B)))return C;var _e=ba(C),Oe=ba(B);return $c(_e,uo(_e,Oe),jv(_e,Oe)+1).join("")},Ue.trimEnd=function(C,B,J){if((C=Fr(C))&&(J||B===u))return C.slice(0,xn(C)+1);if(!C||!(B=ea(B)))return C;var _e=ba(C);return $c(_e,0,jv(_e,ba(B))+1).join("")},Ue.trimStart=function(C,B,J){if((C=Fr(C))&&(J||B===u))return C.replace(Re,"");if(!C||!(B=ea(B)))return C;var _e=ba(C);return $c(_e,uo(_e,ba(B))).join("")},Ue.truncate=function(C,B){var J=30,_e="...";if(gs(B)){var Oe="separator"in B?B.separator:Oe;J="length"in B?Br(B.length):J,_e="omission"in B?ea(B.omission):_e}var $e=(C=Fr(C)).length;if(Jo(C)){var ct=ba(C);$e=ct.length}if(J>=$e)return C;var ft=J-ul(_e);if(ft<1)return _e;var kt=ct?$c(ct,0,ft).join(""):C.slice(0,ft);if(Oe===u)return kt+_e;if(ct&&(ft+=kt.length-ft),H0(Oe)){if(C.slice(ft).search(Oe)){var Wt,Yt=kt;for(Oe.global||(Oe=t_(Oe.source,Fr(ke.exec(Oe))+"g")),Oe.lastIndex=0;Wt=Oe.exec(Yt);)var rn=Wt.index;kt=kt.slice(0,rn===u?ft:rn)}}else if(C.indexOf(ea(Oe),ft)!=ft){var Gn=kt.lastIndexOf(Oe);Gn>-1&&(kt=kt.slice(0,Gn))}return kt+_e},Ue.unescape=function(C){return(C=Fr(C))&&ve.test(C)?C.replace(Ie,Vv):C},Ue.uniqueId=function(C){var B=++l0;return Fr(C)+B},Ue.upperCase=_i,Ue.upperFirst=Yl,Ue.each=L0,Ue.eachRight=Fb,Ue.first=Nb,Es(Ue,(Hh={},Is(Ue,(function(C,B){Yi.call(Ue.prototype,B)||(Hh[B]=C)})),Hh),{chain:!1}),Ue.VERSION="4.17.21",Fc(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(C){Ue[C].placeholder=Ue})),Fc(["drop","take"],(function(C,B){ci.prototype[C]=function(J){J=J===u?1:$s(Br(J),0);var _e=this.__filtered__&&!B?new ci(this):this.clone();return _e.__filtered__?_e.__takeCount__=qr(J,_e.__takeCount__):_e.__views__.push({size:qr(J,A),type:C+(_e.__dir__<0?"Right":"")}),_e},ci.prototype[C+"Right"]=function(J){return this.reverse()[C](J).reverse()}})),Fc(["filter","map","takeWhile"],(function(C,B){var J=B+1,_e=J==1||J==3;ci.prototype[C]=function(Oe){var $e=this.clone();return $e.__iteratees__.push({iteratee:vr(Oe,3),type:J}),$e.__filtered__=$e.__filtered__||_e,$e}})),Fc(["head","last"],(function(C,B){var J="take"+(B?"Right":"");ci.prototype[C]=function(){return this[J](1).value()[0]}})),Fc(["initial","tail"],(function(C,B){var J="drop"+(B?"":"Right");ci.prototype[C]=function(){return this.__filtered__?new ci(this):this[J](1)}})),ci.prototype.compact=function(){return this.filter(_s)},ci.prototype.find=function(C){return this.filter(C).head()},ci.prototype.findLast=function(C){return this.reverse().find(C)},ci.prototype.invokeMap=Xr((function(C,B){return typeof C=="function"?new ci(this):this.map((function(J){return Oh(J,C,B)}))})),ci.prototype.reject=function(C){return this.filter(j0(vr(C)))},ci.prototype.slice=function(C,B){C=Br(C);var J=this;return J.__filtered__&&(C>0||B<0)?new ci(J):(C<0?J=J.takeRight(-C):C&&(J=J.drop(C)),B!==u&&(J=(B=Br(B))<0?J.dropRight(-B):J.take(B-C)),J)},ci.prototype.takeRightWhile=function(C){return this.reverse().takeWhile(C).reverse()},ci.prototype.toArray=function(){return this.take(A)},Is(ci.prototype,(function(C,B){var J=/^(?:filter|find|map|reject)|While$/.test(B),_e=/^(?:head|last)$/.test(B),Oe=Ue[_e?"take"+(B=="last"?"Right":""):B],$e=_e||/^find/.test(B);Oe&&(Ue.prototype[B]=function(){var ct=this.__wrapped__,ft=_e?[1]:arguments,kt=ct instanceof ci,Wt=ft[0],Yt=kt||Ur(ct),rn=function(ir){var Rn=Oe.apply(Ue,gc([ir],ft));return _e&&Gn?Rn[0]:Rn};Yt&&J&&typeof Wt=="function"&&Wt.length!=1&&(kt=Yt=!1);var Gn=this.__chain__,pn=!!this.__actions__.length,Nn=$e&&!Gn,Ht=kt&&!pn;if(!$e&&Yt){ct=Ht?ct:new ci(this);var mn=C.apply(ct,ft);return mn.__actions__.push({func:Bh,args:[rn],thisArg:u}),new Wa(mn,Gn)}return Nn&&Ht?C.apply(this,ft):(mn=this.thru(rn),Nn?_e?mn.value()[0]:mn.value():mn)})})),Fc(["pop","push","shift","sort","splice","unshift"],(function(C){var B=o0[C],J=/^(?:push|sort|unshift)$/.test(C)?"tap":"thru",_e=/^(?:pop|shift)$/.test(C);Ue.prototype[C]=function(){var Oe=arguments;if(_e&&!this.__chain__){var $e=this.value();return B.apply(Ur($e)?$e:[],Oe)}return this[J]((function(ct){return B.apply(Ur(ct)?ct:[],Oe)}))}})),Is(ci.prototype,(function(C,B){var J=Ue[B];if(J){var _e=J.name+"";Yi.call(_f,_e)||(_f[_e]=[]),_f[_e].push({name:B,func:J})}})),_f[dr(u,2).name]=[{name:"wrapper",func:u}],ci.prototype.clone=function(){var C=new ci(this.__wrapped__);return C.__actions__=Xs(this.__actions__),C.__dir__=this.__dir__,C.__filtered__=this.__filtered__,C.__iteratees__=Xs(this.__iteratees__),C.__takeCount__=this.__takeCount__,C.__views__=Xs(this.__views__),C},ci.prototype.reverse=function(){if(this.__filtered__){var C=new ci(this);C.__dir__=-1,C.__filtered__=!0}else(C=this.clone()).__dir__*=-1;return C},ci.prototype.value=function(){var C=this.__wrapped__.value(),B=this.__dir__,J=Ur(C),_e=B<0,Oe=J?C.length:0,$e=(function(si,nr,jn){for(var Ti=-1,Ls=jn.length;++Ti<Ls;){var wa=jn[Ti],os=wa.size;switch(wa.type){case"drop":si+=os;break;case"dropRight":nr-=os;break;case"take":nr=qr(nr,si+os);break;case"takeRight":si=$s(si,nr-os)}}return{start:si,end:nr}})(0,Oe,this.__views__),ct=$e.start,ft=$e.end,kt=ft-ct,Wt=_e?ft:ct-1,Yt=this.__iteratees__,rn=Yt.length,Gn=0,pn=qr(kt,this.__takeCount__);if(!J||!_e&&Oe==kt&&pn==kt)return Dh(C,this.__actions__);var Nn=[];e:for(;kt--&&Gn<pn;){for(var Ht=-1,mn=C[Wt+=B];++Ht<rn;){var ir=Yt[Ht],Rn=ir.iteratee,gr=ir.type,Er=Rn(mn);if(gr==2)mn=Er;else if(!Er){if(gr==1)continue e;break e}}Nn[Gn++]=mn}return Nn},Ue.prototype.at=Rf,Ue.prototype.chain=function(){return Cf(this)},Ue.prototype.commit=function(){return new Wa(this.value(),this.__chain__)},Ue.prototype.next=function(){this.__values__===u&&(this.__values__=G0(this.value()));var C=this.__index__>=this.__values__.length;return{done:C,value:C?u:this.__values__[this.__index__++]}},Ue.prototype.plant=function(C){for(var B,J=this;J instanceof yf;){var _e=Rb(J);_e.__index__=0,_e.__values__=u,B?Oe.__wrapped__=_e:B=_e;var Oe=_e;J=J.__wrapped__}return Oe.__wrapped__=C,B},Ue.prototype.reverse=function(){var C=this.__wrapped__;if(C instanceof ci){var B=C;return this.__actions__.length&&(B=new ci(this)),(B=B.reverse()).__actions__.push({func:Bh,args:[E_],thisArg:u}),new Wa(B,this.__chain__)}return this.thru(E_)},Ue.prototype.toJSON=Ue.prototype.valueOf=Ue.prototype.value=function(){return Dh(this.__wrapped__,this.__actions__)},Ue.prototype.first=Ue.prototype.head,fd&&(Ue.prototype[fd]=function(){return this}),Ue})();Mn._=s0,(l=(function(){return s0}).call(a,c,a,o))===u||(o.exports=l)}).call(this)},5364:(o,a,c)=>{var l=c(5250),u=c(999)((function(h,f,d){l(h,f,d)}));o.exports=u},9935:o=>{o.exports=function(){return!1}},9884:(o,a,c)=>{var l=c(1791),u=c(7241);o.exports=function(h){return l(h,u(h))}},5602:o=>{var a=o.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var l="candidate:%s %d %s %d %s %d typ %s";return l+=c.raddr!=null?" raddr %s rport %d":"%v%v",l+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(l+=" generation %d"),l+=c["network-id"]!=null?" network-id %d":"%v",l+=c["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var l="ssrc:%d";return c.attribute!=null&&(l+=" %s",c.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var l="mediaclk:";return l+=c.id!=null?"id=%s %s":"%v%s",l+=c.mediaClockValue!=null?"=%s":"",l+=c.rateNumerator!=null?" rate=%s":"",l+=c.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(a).forEach((function(c){a[c].forEach((function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")}))}))},7363:(o,a,c)=>{var l=c(5020),u=c(3804);a.M9=u,a.qg=l.parse,a.Sl=l.parseParams,l.parseFmtpConfig,l.parsePayloads,l.parseRemoteCandidates,l.parseImageAttributes,l.parseSimulcastStreamList},5020:(o,a,c)=>{var l=function(p){return String(Number(p))===p?Number(p):p},u=function(p,m,g){var _=p.name&&p.names;p.push&&!m[p.push]?m[p.push]=[]:_&&!m[p.name]&&(m[p.name]={});var y=p.push?{}:_?m[p.name]:m;(function(v,E,x,A){if(A&&!x)E[A]=l(v[1]);else for(var T=0;T<x.length;T+=1)v[T+1]!=null&&(E[x[T]]=l(v[T+1]))})(g.match(p.reg),y,p.names,p.name),p.push&&m[p.push].push(y)},h=c(5602),f=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(p){var m={},g=[],_=m;return p.split(/(\r\n|\r|\n)/).filter(f).forEach((function(y){var v=y[0],E=y.slice(2);v==="m"&&(g.push({rtp:[],fmtp:[]}),_=g[g.length-1]);for(var x=0;x<(h[v]||[]).length;x+=1){var A=h[v][x];if(A.reg.test(E))return u(A,_,E)}})),m.media=g,m};var d=function(p,m){var g=m.split(/=(.+)/,2);return g.length===2?p[g[0]]=l(g[1]):g.length===1&&m.length>1&&(p[g[0]]=void 0),p};a.parseParams=function(p){return p.split(/;\s?/).reduce(d,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(p){return p.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(p){for(var m=[],g=p.split(" ").map(l),_=0;_<g.length;_+=3)m.push({component:g[_],ip:g[_+1],port:g[_+2]});return m},a.parseImageAttributes=function(p){return p.split(" ").map((function(m){return m.substring(1,m.length-1).split(",").reduce(d,{})}))},a.parseSimulcastStreamList=function(p){return p.split(";").map((function(m){return m.split(",").map((function(g){var _,y=!1;return g[0]!=="~"?_=l(g):(_=l(g.substring(1,g.length)),y=!0),{scid:_,paused:y}}))}))}},3804:(o,a,c)=>{var l=c(5602),u=/%[sdv%]/g,h=function(m){var g=1,_=arguments,y=_.length;return m.replace(u,(function(v){if(g>=y)return v;var E=_[g];switch(g+=1,v){case"%%":return"%";case"%s":return String(E);case"%d":return Number(E);case"%v":return""}}))},f=function(m,g,_){var y=[m+"="+(g.format instanceof Function?g.format(g.push?_:_[g.name]):g.format)];if(g.names)for(var v=0;v<g.names.length;v+=1){var E=g.names[v];g.name?y.push(_[g.name][E]):y.push(_[g.names[v]])}else y.push(_[g.name]);return h.apply(null,y)},d=["v","o","s","i","u","e","p","c","b","t","r","z","a"],p=["i","c","b","a"];o.exports=function(m,g){g=g||{},m.version==null&&(m.version=0),m.name==null&&(m.name=" "),m.media.forEach((function(E){E.payloads==null&&(E.payloads="")}));var _=g.outerOrder||d,y=g.innerOrder||p,v=[];return _.forEach((function(E){l[E].forEach((function(x){x.name in m&&m[x.name]!=null?v.push(f(E,x,m)):x.push in m&&m[x.push]!=null&&m[x.push].forEach((function(A){v.push(f(E,x,A))}))}))})),m.media.forEach((function(E){v.push(f("m",l.m[0],E)),y.forEach((function(x){l[x].forEach((function(A){A.name in E&&E[A.name]!=null?v.push(f(x,A,E)):A.push in E&&E[A.push]!=null&&E[A.push].forEach((function(T){v.push(f(x,A,T))}))}))}))})),v.join(`\r
`)+`\r
`}},7963:o=>{const a={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};a.localCName=a.generateIdentifier(),a.splitLines=function(c){return c.trim().split(`
`).map((l=>l.trim()))},a.splitSections=function(c){return c.split(`
m=`).map(((l,u)=>(u>0?"m="+l:l).trim()+`\r
`))},a.getDescription=function(c){const l=a.splitSections(c);return l&&l[0]},a.getMediaSections=function(c){const l=a.splitSections(c);return l.shift(),l},a.matchPrefix=function(c,l){return a.splitLines(c).filter((u=>u.indexOf(l)===0))},a.parseCandidate=function(c){let l;l=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" ");const u={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let h=8;h<l.length;h+=2)switch(l[h]){case"raddr":u.relatedAddress=l[h+1];break;case"rport":u.relatedPort=parseInt(l[h+1],10);break;case"tcptype":u.tcpType=l[h+1];break;case"ufrag":u.ufrag=l[h+1],u.usernameFragment=l[h+1];break;default:u[l[h]]===void 0&&(u[l[h]]=l[h+1])}return u},a.writeCandidate=function(c){const l=[];l.push(c.foundation);const u=c.component;u==="rtp"?l.push(1):u==="rtcp"?l.push(2):l.push(u),l.push(c.protocol.toUpperCase()),l.push(c.priority),l.push(c.address||c.ip),l.push(c.port);const h=c.type;return l.push("typ"),l.push(h),h!=="host"&&c.relatedAddress&&c.relatedPort&&(l.push("raddr"),l.push(c.relatedAddress),l.push("rport"),l.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(l.push("ufrag"),l.push(c.usernameFragment||c.ufrag)),"candidate:"+l.join(" ")},a.parseIceOptions=function(c){return c.substring(14).split(" ")},a.parseRtpMap=function(c){let l=c.substring(9).split(" ");const u={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),u.name=l[0],u.clockRate=parseInt(l[1],10),u.channels=l.length===3?parseInt(l[2],10):1,u.numChannels=u.channels,u},a.writeRtpMap=function(c){let l=c.payloadType;c.preferredPayloadType!==void 0&&(l=c.preferredPayloadType);const u=c.channels||c.numChannels||1;return"a=rtpmap:"+l+" "+c.name+"/"+c.clockRate+(u!==1?"/"+u:"")+`\r
`},a.parseExtmap=function(c){const l=c.substring(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1],attributes:l.slice(2).join(" ")}},a.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+(c.attributes?" "+c.attributes:"")+`\r
`},a.parseFmtp=function(c){const l={};let u;const h=c.substring(c.indexOf(" ")+1).split(";");for(let f=0;f<h.length;f++)u=h[f].trim().split("="),l[u[0].trim()]=u[1];return l},a.writeFmtp=function(c){let l="",u=c.payloadType;if(c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){const h=[];Object.keys(c.parameters).forEach((f=>{c.parameters[f]!==void 0?h.push(f+"="+c.parameters[f]):h.push(f)})),l+="a=fmtp:"+u+" "+h.join(";")+`\r
`}return l},a.parseRtcpFb=function(c){const l=c.substring(c.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},a.writeRtcpFb=function(c){let l="",u=c.payloadType;return c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach((h=>{l+="a=rtcp-fb:"+u+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`})),l},a.parseSsrcMedia=function(c){const l=c.indexOf(" "),u={ssrc:parseInt(c.substring(7,l),10)},h=c.indexOf(":",l);return h>-1?(u.attribute=c.substring(l+1,h),u.value=c.substring(h+1)):u.attribute=c.substring(l+1),u},a.parseSsrcGroup=function(c){const l=c.substring(13).split(" ");return{semantics:l.shift(),ssrcs:l.map((u=>parseInt(u,10)))}},a.getMid=function(c){const l=a.matchPrefix(c,"a=mid:")[0];if(l)return l.substring(6)},a.parseFingerprint=function(c){const l=c.substring(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},a.getDtlsParameters=function(c,l){return{role:"auto",fingerprints:a.matchPrefix(c+l,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(c,l){let u="a=setup:"+l+`\r
`;return c.fingerprints.forEach((h=>{u+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`})),u},a.parseCryptoLine=function(c){const l=c.substring(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},a.writeCryptoLine=function(c){return"a=crypto:"+c.tag+" "+c.cryptoSuite+" "+(typeof c.keyParams=="object"?a.writeCryptoKeyParams(c.keyParams):c.keyParams)+(c.sessionParams?" "+c.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(c){if(c.indexOf("inline:")!==0)return null;const l=c.substring(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(c){return c.keyMethod+":"+c.keySalt+(c.lifeTime?"|"+c.lifeTime:"")+(c.mkiValue&&c.mkiLength?"|"+c.mkiValue+":"+c.mkiLength:"")},a.getCryptoParameters=function(c,l){return a.matchPrefix(c+l,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(c,l){const u=a.matchPrefix(c+l,"a=ice-ufrag:")[0],h=a.matchPrefix(c+l,"a=ice-pwd:")[0];return u&&h?{usernameFragment:u.substring(12),password:h.substring(10)}:null},a.writeIceParameters=function(c){let l="a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`;return c.iceLite&&(l+=`a=ice-lite\r
`),l},a.parseRtpParameters=function(c){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=a.splitLines(c)[0].split(" ");l.profile=u[2];for(let f=3;f<u.length;f++){const d=u[f],p=a.matchPrefix(c,"a=rtpmap:"+d+" ")[0];if(p){const m=a.parseRtpMap(p),g=a.matchPrefix(c,"a=fmtp:"+d+" ");switch(m.parameters=g.length?a.parseFmtp(g[0]):{},m.rtcpFeedback=a.matchPrefix(c,"a=rtcp-fb:"+d+" ").map(a.parseRtcpFb),l.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(m.name.toUpperCase())}}}a.matchPrefix(c,"a=extmap:").forEach((f=>{l.headerExtensions.push(a.parseExtmap(f))}));const h=a.matchPrefix(c,"a=rtcp-fb:* ").map(a.parseRtcpFb);return l.codecs.forEach((f=>{h.forEach((d=>{f.rtcpFeedback.find((p=>p.type===d.type&&p.parameter===d.parameter))||f.rtcpFeedback.push(d)}))})),l},a.writeRtpDescription=function(c,l){let u="";u+="m="+c+" ",u+=l.codecs.length>0?"9":"0",u+=" "+(l.profile||"UDP/TLS/RTP/SAVPF")+" ",u+=l.codecs.map((f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType)).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach((f=>{u+=a.writeRtpMap(f),u+=a.writeFmtp(f),u+=a.writeRtcpFb(f)}));let h=0;return l.codecs.forEach((f=>{f.maxptime>h&&(h=f.maxptime)})),h>0&&(u+="a=maxptime:"+h+`\r
`),l.headerExtensions&&l.headerExtensions.forEach((f=>{u+=a.writeExtmap(f)})),u},a.parseRtpEncodingParameters=function(c){const l=[],u=a.parseRtpParameters(c),h=u.fecMechanisms.indexOf("RED")!==-1,f=u.fecMechanisms.indexOf("ULPFEC")!==-1,d=a.matchPrefix(c,"a=ssrc:").map((y=>a.parseSsrcMedia(y))).filter((y=>y.attribute==="cname")),p=d.length>0&&d[0].ssrc;let m;const g=a.matchPrefix(c,"a=ssrc-group:FID").map((y=>y.substring(17).split(" ").map((v=>parseInt(v,10)))));g.length>0&&g[0].length>1&&g[0][0]===p&&(m=g[0][1]),u.codecs.forEach((y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let v={ssrc:p,codecPayloadType:parseInt(y.parameters.apt,10)};p&&m&&(v.rtx={ssrc:m}),l.push(v),h&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:p,mechanism:f?"red+ulpfec":"red"},l.push(v))}})),l.length===0&&p&&l.push({ssrc:p});let _=a.matchPrefix(c,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,l.forEach((y=>{y.maxBitrate=_}))),l},a.parseRtcpParameters=function(c){const l={},u=a.matchPrefix(c,"a=ssrc:").map((d=>a.parseSsrcMedia(d))).filter((d=>d.attribute==="cname"))[0];u&&(l.cname=u.value,l.ssrc=u.ssrc);const h=a.matchPrefix(c,"a=rtcp-rsize");l.reducedSize=h.length>0,l.compound=h.length===0;const f=a.matchPrefix(c,"a=rtcp-mux");return l.mux=f.length>0,l},a.writeRtcpParameters=function(c){let l="";return c.reducedSize&&(l+=`a=rtcp-rsize\r
`),c.mux&&(l+=`a=rtcp-mux\r
`),c.ssrc!==void 0&&c.cname&&(l+="a=ssrc:"+c.ssrc+" cname:"+c.cname+`\r
`),l},a.parseMsid=function(c){let l;const u=a.matchPrefix(c,"a=msid:");if(u.length===1)return l=u[0].substring(7).split(" "),{stream:l[0],track:l[1]};const h=a.matchPrefix(c,"a=ssrc:").map((f=>a.parseSsrcMedia(f))).filter((f=>f.attribute==="msid"));return h.length>0?(l=h[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},a.parseSctpDescription=function(c){const l=a.parseMLine(c),u=a.matchPrefix(c,"a=max-message-size:");let h;u.length>0&&(h=parseInt(u[0].substring(19),10)),isNaN(h)&&(h=65536);const f=a.matchPrefix(c,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:l.fmt,maxMessageSize:h};const d=a.matchPrefix(c,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:h}}},a.writeSctpDescription=function(c,l){let u=[];return u=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&u.push("a=max-message-size:"+l.maxMessageSize+`\r
`),u.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(c,l,u){let h;const f=l!==void 0?l:2;return h=c||a.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+h+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(c,l){const u=a.splitLines(c);for(let h=0;h<u.length;h++)switch(u[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[h].substring(2)}return l?a.getDirection(l):"sendrecv"},a.getKind=function(c){return a.splitLines(c)[0].split(" ")[0].substring(2)},a.isRejected=function(c){return c.split(" ",2)[1]==="0"},a.parseMLine=function(c){const l=a.splitLines(c)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},a.parseOLine=function(c){const l=a.matchPrefix(c,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},a.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;const l=a.splitLines(c);for(let u=0;u<l.length;u++)if(l[u].length<2||l[u].charAt(1)!=="=")return!1;return!0},o.exports=a},5512:o=>{o.exports=function(a,c,l,u){var h=self||window;try{try{var f;try{f=new h.Blob([a])}catch{(f=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(a),f=f.getBlob()}var d=h.URL||h.webkitURL,p=d.createObjectURL(f),m=new h[c](p,l);return d.revokeObjectURL(p),m}catch{return new h[c]("data:application/javascript,".concat(encodeURIComponent(a)),l)}}catch{if(!u)throw Error("Inline worker is not supported");return new h[c](u,l)}}},8630:(o,a,c)=>{var l;(function(u){(function(){var h=typeof globalThis=="object"?globalThis:typeof c.g=="object"?c.g:typeof self=="object"?self:typeof this=="object"?this:(function(){try{return Function("return this;")()}catch{}})()||(function(){try{return(0,eval)("(function() { return this; })()")}catch{}})(),f=d(u);function d(p,m){return function(g,_){Object.defineProperty(p,g,{configurable:!0,writable:!0,value:_}),m&&m(g,_)}}h.Reflect!==void 0&&(f=d(h.Reflect,f)),(function(p,m){var g=Object.prototype.hasOwnProperty,_=typeof Symbol=="function",y=_&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",v=_&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",E=typeof Object.create=="function",x={__proto__:[]}instanceof Array,A=!E&&!x,T={create:E?function(){return at(Object.create(null))}:x?function(){return at({__proto__:null})}:function(){return at({})},has:A?function(Be,nt){return g.call(Be,nt)}:function(Be,nt){return nt in Be},get:A?function(Be,nt){return g.call(Be,nt)?Be[nt]:void 0}:function(Be,nt){return Be[nt]}},k=Object.getPrototypeOf(Function),L=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:He(),I=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Fe(),F=typeof WeakMap=="function"?WeakMap:We(),M=_?Symbol.for("@reflect-metadata:registry"):void 0,D=Se(),O=ye(D);function z(Be,nt,it,xt){if(Le(it)){if(!Je(Be))throw new TypeError;if(!tt(nt))throw new TypeError;return ie(Be,nt)}if(!Je(Be))throw new TypeError;if(!Ie(nt))throw new TypeError;if(!Ie(xt)&&!Le(xt)&&!Ve(xt))throw new TypeError;return Ve(xt)&&(xt=void 0),ge(Be,nt,it=ze(it),xt)}function q(Be,nt){function it(xt,ot){if(!Ie(xt))throw new TypeError;if(!Le(ot)&&!Nt(ot))throw new TypeError;Ze(Be,nt,xt,ot)}return it}function G(Be,nt,it,xt){if(!Ie(it))throw new TypeError;return Le(xt)||(xt=ze(xt)),Ze(Be,nt,it,xt)}function K(Be,nt,it){if(!Ie(nt))throw new TypeError;return Le(it)||(it=ze(it)),Te(Be,nt,it)}function te(Be,nt,it){if(!Ie(nt))throw new TypeError;return Le(it)||(it=ze(it)),be(Be,nt,it)}function re(Be,nt,it){if(!Ie(nt))throw new TypeError;return Le(it)||(it=ze(it)),Pe(Be,nt,it)}function H(Be,nt,it){if(!Ie(nt))throw new TypeError;return Le(it)||(it=ze(it)),Ge(Be,nt,it)}function Y(Be,nt){if(!Ie(Be))throw new TypeError;return Le(nt)||(nt=ze(nt)),lt(Be,nt)}function Z(Be,nt){if(!Ie(Be))throw new TypeError;return Le(nt)||(nt=ze(nt)),pt(Be,nt)}function Q(Be,nt,it){if(!Ie(nt))throw new TypeError;if(Le(it)||(it=ze(it)),!Ie(nt))throw new TypeError;Le(it)||(it=ze(it));var xt=ke(nt,it,!1);return!Le(xt)&&xt.OrdinaryDeleteMetadata(Be,nt,it)}function ie(Be,nt){for(var it=Be.length-1;it>=0;--it){var xt=(0,Be[it])(nt);if(!Le(xt)&&!Ve(xt)){if(!tt(xt))throw new TypeError;nt=xt}}return nt}function ge(Be,nt,it,xt){for(var ot=Be.length-1;ot>=0;--ot){var tn=(0,Be[ot])(nt,it,xt);if(!Le(tn)&&!Ve(tn)){if(!Ie(tn))throw new TypeError;xt=tn}}return xt}function Te(Be,nt,it){if(be(Be,nt,it))return!0;var xt=xe(nt);return!Ve(xt)&&Te(Be,xt,it)}function be(Be,nt,it){var xt=ke(nt,it,!1);return!Le(xt)&&we(xt.OrdinaryHasOwnMetadata(Be,nt,it))}function Pe(Be,nt,it){if(be(Be,nt,it))return Ge(Be,nt,it);var xt=xe(nt);return Ve(xt)?void 0:Pe(Be,xt,it)}function Ge(Be,nt,it){var xt=ke(nt,it,!1);if(!Le(xt))return xt.OrdinaryGetOwnMetadata(Be,nt,it)}function Ze(Be,nt,it,xt){ke(it,xt,!0).OrdinaryDefineOwnMetadata(Be,nt,it,xt)}function lt(Be,nt){var it=pt(Be,nt),xt=xe(Be);if(xt===null)return it;var ot=lt(xt,nt);if(ot.length<=0)return it;if(it.length<=0)return ot;for(var tn=new I,ln=[],Rt=0,Vt=it;Rt<Vt.length;Rt++){var _t=Vt[Rt];tn.has(_t)||(tn.add(_t),ln.push(_t))}for(var Jt=0,Tn=ot;Jt<Tn.length;Jt++)_t=Tn[Jt],tn.has(_t)||(tn.add(_t),ln.push(_t));return ln}function pt(Be,nt){var it=ke(Be,nt,!1);return it?it.OrdinaryOwnMetadataKeys(Be,nt):[]}function ne(Be){if(Be===null)return 1;switch(typeof Be){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Be===null?1:6;default:return 6}}function Le(Be){return Be===void 0}function Ve(Be){return Be===null}function De(Be){return typeof Be=="symbol"}function Ie(Be){return typeof Be=="object"?Be!==null:typeof Be=="function"}function ae(Be,nt){switch(ne(Be)){case 0:case 1:case 2:case 3:case 4:case 5:return Be}var it="string",xt=wt(Be,y);if(xt!==void 0){var ot=xt.call(Be,it);if(Ie(ot))throw new TypeError;return ot}return ve(Be)}function ve(Be,nt){var it,xt;{var ot=Be.toString;if(Xe(ot)&&!Ie(xt=ot.call(Be))||Xe(it=Be.valueOf)&&!Ie(xt=it.call(Be)))return xt}throw new TypeError}function we(Be){return!!Be}function pe(Be){return""+Be}function ze(Be){var nt=ae(Be);return De(nt)?nt:pe(nt)}function Je(Be){return Array.isArray?Array.isArray(Be):Be instanceof Object?Be instanceof Array:Object.prototype.toString.call(Be)==="[object Array]"}function Xe(Be){return typeof Be=="function"}function tt(Be){return typeof Be=="function"}function Nt(Be){switch(ne(Be)){case 3:case 4:return!0;default:return!1}}function gt(Be,nt){return Be===nt||Be!=Be&&nt!=nt}function wt(Be,nt){var it=Be[nt];if(it!=null){if(!Xe(it))throw new TypeError;return it}}function Re(Be){var nt=wt(Be,v);if(!Xe(nt))throw new TypeError;var it=nt.call(Be);if(!Ie(it))throw new TypeError;return it}function se(Be){return Be.value}function W(Be){var nt=Be.next();return!nt.done&&nt}function oe(Be){var nt=Be.return;nt&&nt.call(Be)}function xe(Be){var nt=Object.getPrototypeOf(Be);if(typeof Be!="function"||Be===k||nt!==k)return nt;var it=Be.prototype,xt=it&&Object.getPrototypeOf(it);if(xt==null||xt===Object.prototype)return nt;var ot=xt.constructor;return typeof ot!="function"||ot===Be?nt:ot}function Ce(){var Be,nt,it,xt;Le(M)||m.Reflect===void 0||M in m.Reflect||typeof m.Reflect.defineMetadata!="function"||(Be=Ke(m.Reflect));var ot=new F,tn={registerProvider:ln,getProvider:Vt,setProvider:Jt};return tn;function ln(Tn){if(!Object.isExtensible(tn))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Be===Tn:break;case Le(nt):nt=Tn;break;case nt===Tn:break;case Le(it):it=Tn;break;case it===Tn:break;default:xt===void 0&&(xt=new I),xt.add(Tn)}}function Rt(Tn,qt){if(!Le(nt)){if(nt.isProviderFor(Tn,qt))return nt;if(!Le(it)){if(it.isProviderFor(Tn,qt))return nt;if(!Le(xt))for(var An=Re(xt);;){var Ln=W(An);if(!Ln)return;var mr=se(Ln);if(mr.isProviderFor(Tn,qt))return oe(An),mr}}}if(!Le(Be)&&Be.isProviderFor(Tn,qt))return Be}function Vt(Tn,qt){var An,Ln=ot.get(Tn);return Le(Ln)||(An=Ln.get(qt)),Le(An)&&(Le(An=Rt(Tn,qt))||(Le(Ln)&&(Ln=new L,ot.set(Tn,Ln)),Ln.set(qt,An))),An}function _t(Tn){if(Le(Tn))throw new TypeError;return nt===Tn||it===Tn||!Le(xt)&&xt.has(Tn)}function Jt(Tn,qt,An){if(!_t(An))throw new Error("Metadata provider not registered.");var Ln=Vt(Tn,qt);if(Ln!==An){if(!Le(Ln))return!1;var mr=ot.get(Tn);Le(mr)&&(mr=new L,ot.set(Tn,mr)),mr.set(qt,An)}return!0}}function Se(){var Be;return!Le(M)&&Ie(m.Reflect)&&Object.isExtensible(m.Reflect)&&(Be=m.Reflect[M]),Le(Be)&&(Be=Ce()),!Le(M)&&Ie(m.Reflect)&&Object.isExtensible(m.Reflect)&&Object.defineProperty(m.Reflect,M,{enumerable:!1,configurable:!1,writable:!1,value:Be}),Be}function ye(Be){var nt=new F,it={isProviderFor:function(_t,Jt){var Tn=nt.get(_t);return!Le(Tn)&&Tn.has(Jt)},OrdinaryDefineOwnMetadata:ln,OrdinaryHasOwnMetadata:ot,OrdinaryGetOwnMetadata:tn,OrdinaryOwnMetadataKeys:Rt,OrdinaryDeleteMetadata:Vt};return D.registerProvider(it),it;function xt(_t,Jt,Tn){var qt=nt.get(_t),An=!1;if(Le(qt)){if(!Tn)return;qt=new L,nt.set(_t,qt),An=!0}var Ln=qt.get(Jt);if(Le(Ln)){if(!Tn)return;if(Ln=new L,qt.set(Jt,Ln),!Be.setProvider(_t,Jt,it))throw qt.delete(Jt),An&&nt.delete(_t),new Error("Wrong provider for target.")}return Ln}function ot(_t,Jt,Tn){var qt=xt(Jt,Tn,!1);return!Le(qt)&&we(qt.has(_t))}function tn(_t,Jt,Tn){var qt=xt(Jt,Tn,!1);if(!Le(qt))return qt.get(_t)}function ln(_t,Jt,Tn,qt){xt(Tn,qt,!0).set(_t,Jt)}function Rt(_t,Jt){var Tn=[],qt=xt(_t,Jt,!1);if(Le(qt))return Tn;for(var An=Re(qt.keys()),Ln=0;;){var mr=W(An);if(!mr)return Tn.length=Ln,Tn;var ns=se(mr);try{Tn[Ln]=ns}catch(hi){try{oe(An)}finally{throw hi}}Ln++}}function Vt(_t,Jt,Tn){var qt=xt(Jt,Tn,!1);if(Le(qt)||!qt.delete(_t))return!1;if(qt.size===0){var An=nt.get(Jt);Le(An)||(An.delete(Tn),An.size===0&&nt.delete(An))}return!0}}function Ke(Be){var nt=Be.defineMetadata,it=Be.hasOwnMetadata,xt=Be.getOwnMetadata,ot=Be.getOwnMetadataKeys,tn=Be.deleteMetadata,ln=new F;return{isProviderFor:function(Rt,Vt){var _t=ln.get(Rt);return!(Le(_t)||!_t.has(Vt))||!!ot(Rt,Vt).length&&(Le(_t)&&(_t=new I,ln.set(Rt,_t)),_t.add(Vt),!0)},OrdinaryDefineOwnMetadata:nt,OrdinaryHasOwnMetadata:it,OrdinaryGetOwnMetadata:xt,OrdinaryOwnMetadataKeys:ot,OrdinaryDeleteMetadata:tn}}function ke(Be,nt,it){var xt=D.getProvider(Be,nt);if(!Le(xt))return xt;if(it){if(D.setProvider(Be,nt,O))return O;throw new Error("Illegal state.")}}function He(){var Be={},nt=[],it=(function(){function ln(Rt,Vt,_t){this._index=0,this._keys=Rt,this._values=Vt,this._selector=_t}return ln.prototype["@@iterator"]=function(){return this},ln.prototype[v]=function(){return this},ln.prototype.next=function(){var Rt=this._index;if(Rt>=0&&Rt<this._keys.length){var Vt=this._selector(this._keys[Rt],this._values[Rt]);return Rt+1>=this._keys.length?(this._index=-1,this._keys=nt,this._values=nt):this._index++,{value:Vt,done:!1}}return{value:void 0,done:!0}},ln.prototype.throw=function(Rt){throw this._index>=0&&(this._index=-1,this._keys=nt,this._values=nt),Rt},ln.prototype.return=function(Rt){return this._index>=0&&(this._index=-1,this._keys=nt,this._values=nt),{value:Rt,done:!0}},ln})();return(function(){function ln(){this._keys=[],this._values=[],this._cacheKey=Be,this._cacheIndex=-2}return Object.defineProperty(ln.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ln.prototype.has=function(Rt){return this._find(Rt,!1)>=0},ln.prototype.get=function(Rt){var Vt=this._find(Rt,!1);return Vt>=0?this._values[Vt]:void 0},ln.prototype.set=function(Rt,Vt){var _t=this._find(Rt,!0);return this._values[_t]=Vt,this},ln.prototype.delete=function(Rt){var Vt=this._find(Rt,!1);if(Vt>=0){for(var _t=this._keys.length,Jt=Vt+1;Jt<_t;Jt++)this._keys[Jt-1]=this._keys[Jt],this._values[Jt-1]=this._values[Jt];return this._keys.length--,this._values.length--,gt(Rt,this._cacheKey)&&(this._cacheKey=Be,this._cacheIndex=-2),!0}return!1},ln.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Be,this._cacheIndex=-2},ln.prototype.keys=function(){return new it(this._keys,this._values,xt)},ln.prototype.values=function(){return new it(this._keys,this._values,ot)},ln.prototype.entries=function(){return new it(this._keys,this._values,tn)},ln.prototype["@@iterator"]=function(){return this.entries()},ln.prototype[v]=function(){return this.entries()},ln.prototype._find=function(Rt,Vt){if(!gt(this._cacheKey,Rt)){this._cacheIndex=-1;for(var _t=0;_t<this._keys.length;_t++)if(gt(this._keys[_t],Rt)){this._cacheIndex=_t;break}}return this._cacheIndex<0&&Vt&&(this._cacheIndex=this._keys.length,this._keys.push(Rt),this._values.push(void 0)),this._cacheIndex},ln})();function xt(ln,Rt){return ln}function ot(ln,Rt){return Rt}function tn(ln,Rt){return[ln,Rt]}}function Fe(){return(function(){function Be(){this._map=new L}return Object.defineProperty(Be.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Be.prototype.has=function(nt){return this._map.has(nt)},Be.prototype.add=function(nt){return this._map.set(nt,nt),this},Be.prototype.delete=function(nt){return this._map.delete(nt)},Be.prototype.clear=function(){this._map.clear()},Be.prototype.keys=function(){return this._map.keys()},Be.prototype.values=function(){return this._map.keys()},Be.prototype.entries=function(){return this._map.entries()},Be.prototype["@@iterator"]=function(){return this.keys()},Be.prototype[v]=function(){return this.keys()},Be})()}function We(){var Be=16,nt=T.create(),it=xt();return(function(){function Vt(){this._key=xt()}return Vt.prototype.has=function(_t){var Jt=ot(_t,!1);return Jt!==void 0&&T.has(Jt,this._key)},Vt.prototype.get=function(_t){var Jt=ot(_t,!1);return Jt!==void 0?T.get(Jt,this._key):void 0},Vt.prototype.set=function(_t,Jt){return ot(_t,!0)[this._key]=Jt,this},Vt.prototype.delete=function(_t){var Jt=ot(_t,!1);return Jt!==void 0&&delete Jt[this._key]},Vt.prototype.clear=function(){this._key=xt()},Vt})();function xt(){var Vt;do Vt="@@WeakMap@@"+Rt();while(T.has(nt,Vt));return nt[Vt]=!0,Vt}function ot(Vt,_t){if(!g.call(Vt,it)){if(!_t)return;Object.defineProperty(Vt,it,{value:T.create()})}return Vt[it]}function tn(Vt,_t){for(var Jt=0;Jt<_t;++Jt)Vt[Jt]=255*Math.random()|0;return Vt}function ln(Vt){if(typeof Uint8Array=="function"){var _t=new Uint8Array(Vt);return typeof crypto<"u"?crypto.getRandomValues(_t):typeof msCrypto<"u"?msCrypto.getRandomValues(_t):tn(_t,Vt),_t}return tn(new Array(Vt),Vt)}function Rt(){var Vt=ln(Be);Vt[6]=79&Vt[6]|64,Vt[8]=191&Vt[8]|128;for(var _t="",Jt=0;Jt<Be;++Jt){var Tn=Vt[Jt];Jt!==4&&Jt!==6&&Jt!==8||(_t+="-"),Tn<16&&(_t+="0"),_t+=Tn.toString(16).toLowerCase()}return _t}}function at(Be){return Be.__=void 0,delete Be.__,Be}p("decorate",z),p("metadata",q),p("defineMetadata",G),p("hasMetadata",K),p("hasOwnMetadata",te),p("getMetadata",re),p("getOwnMetadata",H),p("getMetadataKeys",Y),p("getOwnMetadataKeys",Z),p("deleteMetadata",Q)})(f,h),h.Reflect===void 0&&(h.Reflect=u)})()})(l||(l={}))}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={id:o,loaded:!1,exports:{}};return n[o].call(c.exports,c,c.exports,i),c.loaded=!0,c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.nmd=o=>(o.paths=[],o.children||(o.children=[]),o);var s={};return(()=>{i.r(s),i.d(s,{BASIC_FULL_HD_LANDSCAPE:()=>br,BASIC_FULL_HD_PORTRAIT:()=>Un,BASIC_LANDSCAPE:()=>Gr,BASIC_PORTRAIT:()=>ar,BroadcastClientError:()=>ye,BroadcastClientEvents:()=>_c,ConnectionState:()=>hr,Errors:()=>u,InitialLayerPreference:()=>ba,JitterBufferMinDelay:()=>Ms,LOG_LEVEL:()=>W,LocalStageStream:()=>wa,LocalStageStreamEvents:()=>gr,LogLevels:()=>W,RemoteStageStream:()=>Id,RemoteStageStreamEvents:()=>ir,SIMULCAST_DUPLICATE_LAYERS_CONFIGURED:()=>Vb,SIMULCAST_LAYER_CONFIGURATION_CONFLICT:()=>ly,SIMULCAST_LAYER_INPUT_FRAMERATE_INSUFFICIENT:()=>j0,SIMULCAST_LAYER_INPUT_RESOLUTION_INSUFFICIENT:()=>F0,SIMULCAST_LAYER_INVALID_TYPE:()=>Fh,SIMULCAST_LAYER_ORIENTATION_MISMATCH:()=>Hb,SIMULCAST_MAX_LAYERS_EXCEEDED:()=>zb,SIMULCAST_MAX_LAYER_BITRATE_EXCEEDED:()=>B0,SIMULCAST_MAX_LAYER_DIMENSIONS_EXCEEDED:()=>A_,SIMULCAST_MAX_LAYER_FRAMERATE_EXCEEDED:()=>ay,SIMULCAST_MIN_LAYER_BITRATE_EXCEEDED:()=>oy,SIMULCAST_MIN_LAYER_DIMENSIONS_EXCEEDED:()=>cy,SIMULCAST_MIN_LAYER_FRAMERATE_EXCEEDED:()=>T_,SIMULCAST_UNSUPPORTED:()=>jb,STAGE_MAX_AUDIO_BITRATE_KBPS:()=>Vp,STAGE_MAX_AUDIO_BITRATE_KBPS_DEFAULT:()=>P0,STAGE_MAX_BITRATE:()=>Uu,STAGE_MAX_FRAMERATE:()=>Fu,STAGE_MAX_RESOLUTION:()=>Ad,STAGE_MIN_AUDIO_BITRATE_KBPS:()=>N0,STAGE_MIN_BITRATE:()=>Af,STAGE_MIN_FRAMERATE:()=>Bu,STAGE_MIN_RESOLUTION:()=>zp,STANDARD_LANDSCAPE:()=>bi,STANDARD_PORTRAIT:()=>ai,SimulcastLayerPresets:()=>jp,Stage:()=>D_,StageConnectionState:()=>Oi,StageErrorCategory:()=>J,StageErrorCode:()=>_e,StageEvents:()=>cr,StageLeftReason:()=>qp,StageParticipantPublishState:()=>jn,StageParticipantSubscribeState:()=>Ti,StageStream:()=>si,StageStreamLayerSelectedReason:()=>Rn,StreamType:()=>wr,SubscribeType:()=>Ws,__version:()=>E0,create:()=>d_,default:()=>Dd,isSupported:()=>se});var o={};i.r(o),i.d(o,{fixNegotiationNeeded:()=>te,shimAddTrackRemoveTrack:()=>G,shimAddTrackRemoveTrackWithNative:()=>q,shimGetDisplayMedia:()=>I,shimGetSendersWithDtmf:()=>D,shimGetStats:()=>O,shimGetUserMedia:()=>L,shimMediaStream:()=>F,shimOnTrack:()=>M,shimPeerConnection:()=>K,shimSenderReceiverGetStats:()=>z});var a={};i.r(a),i.d(a,{shimAddTransceiver:()=>be,shimCreateAnswer:()=>Ze,shimCreateOffer:()=>Ge,shimGetDisplayMedia:()=>H,shimGetParameters:()=>Pe,shimGetUserMedia:()=>re,shimOnTrack:()=>Y,shimPeerConnection:()=>Z,shimRTCDataChannel:()=>Te,shimReceiverGetStats:()=>ie,shimRemoveStream:()=>ge,shimSenderGetStats:()=>Q});var c={};i.r(c),i.d(c,{shimAudioContext:()=>ve,shimCallbacksAPI:()=>ne,shimConstraints:()=>Ve,shimCreateOfferLegacy:()=>ae,shimGetUserMedia:()=>Le,shimLocalStreamsAPI:()=>lt,shimRTCIceServerUrls:()=>De,shimRemoteStreamsAPI:()=>pt,shimTrackEventTransceiver:()=>Ie});var l={};i.r(l),i.d(l,{removeExtmapAllowMixed:()=>gt,shimAddIceCandidateNullOrEmpty:()=>wt,shimConnectionState:()=>Nt,shimMaxMessageSize:()=>Xe,shimParameterlessSetLocalDescription:()=>Re,shimRTCIceCandidate:()=>ze,shimRTCIceCandidateRelayProtocol:()=>Je,shimSendThrowTypeError:()=>tt});var u={};i.r(u),i.d(u,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Be,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>at,ADD_DEVICE_CONSTRAINTS_ERROR:()=>xt,ADD_DEVICE_DEVICE_ERROR:()=>Fe,ADD_DEVICE_NAME_EXISTS_ERROR:()=>We,ADD_DEVICE_NAME_MISSING_ERROR:()=>nt,ADD_DEVICE_UNSUPPORTED:()=>it,BROADCAST_CONFIGURATION_ERROR:()=>Ln,BROADCAST_ERROR:()=>Ke,CAMERA_ERROR:()=>ke,CLIENT_INVALID_ERROR:()=>rs,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>_t,FAILED_TO_ADD_IMAGE_ERROR:()=>Jt,INGEST_ENDPOINT_TYPE_ERROR:()=>ns,INGEST_ENDPOINT_URL_ERROR:()=>hi,INPUT_ERROR:()=>He,INVALID_STREAM_KEY:()=>An,LOGGER_TYPE_ERROR:()=>Fi,LOG_LEVEL_TYPE_ERROR:()=>ti,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>qi,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>is,PEER_CONNECTION_ERROR:()=>qt,PEER_SETUP_ERROR:()=>Tn,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>ot,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>tn,STAGE_TOKEN_TYPE_ERROR:()=>je,STAGE_WHIP_OVERRIDE_ERROR:()=>vt,STREAM_CONFIGURATION_ERROR:()=>mr,STREAM_KEY_INVALID_CHAR_ERROR:()=>ss,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Rt,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>ln,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>Vt});var h={};i.r(h),i.d(h,{BASIC_FULL_HD_LANDSCAPE:()=>br,BASIC_FULL_HD_PORTRAIT:()=>Un,BASIC_LANDSCAPE:()=>Gr,BASIC_PORTRAIT:()=>ar,BroadcastClientError:()=>ye,BroadcastClientEvents:()=>_c,ConnectionState:()=>hr,Errors:()=>u,LOG_LEVEL:()=>W,LogLevels:()=>W,STANDARD_LANDSCAPE:()=>bi,STANDARD_PORTRAIT:()=>ai,__version:()=>E0,create:()=>d_,isSupported:()=>se});let f=!0,d=!0;function p(P,w,R){const U=P.match(w);return U&&U.length>=R&&parseInt(U[R],10)}function m(P,w,R){if(!P.RTCPeerConnection)return;const U=P.RTCPeerConnection.prototype,j=U.addEventListener;U.addEventListener=function(X,ue){if(X!==w)return j.apply(this,arguments);const me=ce=>{const de=R(ce);de&&(ue.handleEvent?ue.handleEvent(de):ue(de))};return this._eventMap=this._eventMap||{},this._eventMap[w]||(this._eventMap[w]=new Map),this._eventMap[w].set(ue,me),j.apply(this,[X,me])};const $=U.removeEventListener;U.removeEventListener=function(X,ue){if(X!==w||!this._eventMap||!this._eventMap[w])return $.apply(this,arguments);if(!this._eventMap[w].has(ue))return $.apply(this,arguments);const me=this._eventMap[w].get(ue);return this._eventMap[w].delete(ue),this._eventMap[w].size===0&&delete this._eventMap[w],Object.keys(this._eventMap).length===0&&delete this._eventMap,$.apply(this,[X,me])},Object.defineProperty(U,"on"+w,{get(){return this["_on"+w]},set(X){this["_on"+w]&&(this.removeEventListener(w,this["_on"+w]),delete this["_on"+w]),X&&this.addEventListener(w,this["_on"+w]=X)},enumerable:!0,configurable:!0})}function g(P){return typeof P!="boolean"?new Error("Argument type: "+typeof P+". Please use a boolean."):(f=P,P?"adapter.js logging disabled":"adapter.js logging enabled")}function _(P){return typeof P!="boolean"?new Error("Argument type: "+typeof P+". Please use a boolean."):(d=!P,"adapter.js deprecation warnings "+(P?"disabled":"enabled"))}function y(){if(typeof window=="object"){if(f)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function v(P,w){d&&console.warn(P+" is deprecated, please use "+w+" instead.")}function E(P){return Object.prototype.toString.call(P)==="[object Object]"}function x(P){return E(P)?Object.keys(P).reduce((function(w,R){const U=E(P[R]),j=U?x(P[R]):P[R],$=U&&!Object.keys(j).length;return j===void 0||$?w:Object.assign(w,{[R]:j})}),{}):P}function A(P,w,R){w&&!R.has(w.id)&&(R.set(w.id,w),Object.keys(w).forEach((U=>{U.endsWith("Id")?A(P,P.get(w[U]),R):U.endsWith("Ids")&&w[U].forEach((j=>{A(P,P.get(j),R)}))})))}function T(P,w,R){const U=R?"outbound-rtp":"inbound-rtp",j=new Map;if(w===null)return j;const $=[];return P.forEach((X=>{X.type==="track"&&X.trackIdentifier===w.id&&$.push(X)})),$.forEach((X=>{P.forEach((ue=>{ue.type===U&&ue.trackId===X.id&&A(P,ue,j)}))})),j}const k=y;function L(P,w){const R=P&&P.navigator;if(!R.mediaDevices)return;const U=function(X){if(typeof X!="object"||X.mandatory||X.optional)return X;const ue={};return Object.keys(X).forEach((me=>{if(me==="require"||me==="advanced"||me==="mediaSource")return;const ce=typeof X[me]=="object"?X[me]:{ideal:X[me]};ce.exact!==void 0&&typeof ce.exact=="number"&&(ce.min=ce.max=ce.exact);const de=function(Ae,Me){return Ae?Ae+Me.charAt(0).toUpperCase()+Me.slice(1):Me==="deviceId"?"sourceId":Me};if(ce.ideal!==void 0){ue.optional=ue.optional||[];let Ae={};typeof ce.ideal=="number"?(Ae[de("min",me)]=ce.ideal,ue.optional.push(Ae),Ae={},Ae[de("max",me)]=ce.ideal,ue.optional.push(Ae)):(Ae[de("",me)]=ce.ideal,ue.optional.push(Ae))}ce.exact!==void 0&&typeof ce.exact!="number"?(ue.mandatory=ue.mandatory||{},ue.mandatory[de("",me)]=ce.exact):["min","max"].forEach((Ae=>{ce[Ae]!==void 0&&(ue.mandatory=ue.mandatory||{},ue.mandatory[de(Ae,me)]=ce[Ae])}))})),X.advanced&&(ue.optional=(ue.optional||[]).concat(X.advanced)),ue},j=function(X,ue){if(w.version>=61)return ue(X);if((X=JSON.parse(JSON.stringify(X)))&&typeof X.audio=="object"){const me=function(ce,de,Ae){de in ce&&!(Ae in ce)&&(ce[Ae]=ce[de],delete ce[de])};me((X=JSON.parse(JSON.stringify(X))).audio,"autoGainControl","googAutoGainControl"),me(X.audio,"noiseSuppression","googNoiseSuppression"),X.audio=U(X.audio)}if(X&&typeof X.video=="object"){let me=X.video.facingMode;me=me&&(typeof me=="object"?me:{ideal:me});const ce=w.version<66;if(me&&(me.exact==="user"||me.exact==="environment"||me.ideal==="user"||me.ideal==="environment")&&(!R.mediaDevices.getSupportedConstraints||!R.mediaDevices.getSupportedConstraints().facingMode||ce)){let de;if(delete X.video.facingMode,me.exact==="environment"||me.ideal==="environment"?de=["back","rear"]:me.exact!=="user"&&me.ideal!=="user"||(de=["front"]),de)return R.mediaDevices.enumerateDevices().then((Ae=>{let Me=(Ae=Ae.filter((rt=>rt.kind==="videoinput"))).find((rt=>de.some((bt=>rt.label.toLowerCase().includes(bt)))));return!Me&&Ae.length&&de.includes("back")&&(Me=Ae[Ae.length-1]),Me&&(X.video.deviceId=me.exact?{exact:Me.deviceId}:{ideal:Me.deviceId}),X.video=U(X.video),k("chrome: "+JSON.stringify(X)),ue(X)}))}X.video=U(X.video)}return k("chrome: "+JSON.stringify(X)),ue(X)},$=function(X){return w.version>=64?X:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[X.name]||X.name,message:X.message,constraint:X.constraint||X.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(R.getUserMedia=(function(X,ue,me){j(X,(ce=>{R.webkitGetUserMedia(ce,ue,(de=>{me&&me($(de))}))}))}).bind(R),R.mediaDevices.getUserMedia){const X=R.mediaDevices.getUserMedia.bind(R.mediaDevices);R.mediaDevices.getUserMedia=function(ue){return j(ue,(me=>X(me).then((ce=>{if(me.audio&&!ce.getAudioTracks().length||me.video&&!ce.getVideoTracks().length)throw ce.getTracks().forEach((de=>{de.stop()})),new DOMException("","NotFoundError");return ce}),(ce=>Promise.reject($(ce))))))}}}function I(P,w){P.navigator.mediaDevices&&"getDisplayMedia"in P.navigator.mediaDevices||P.navigator.mediaDevices&&(typeof w=="function"?P.navigator.mediaDevices.getDisplayMedia=function(R){return w(R).then((U=>{const j=R.video&&R.video.width,$=R.video&&R.video.height,X=R.video&&R.video.frameRate;return R.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:U,maxFrameRate:X||3}},j&&(R.video.mandatory.maxWidth=j),$&&(R.video.mandatory.maxHeight=$),P.navigator.mediaDevices.getUserMedia(R)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function F(P){P.MediaStream=P.MediaStream||P.webkitMediaStream}function M(P){if(typeof P=="object"&&P.RTCPeerConnection&&!("ontrack"in P.RTCPeerConnection.prototype)){Object.defineProperty(P.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(R){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=R)},enumerable:!0,configurable:!0});const w=P.RTCPeerConnection.prototype.setRemoteDescription;P.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=R=>{R.stream.addEventListener("addtrack",(U=>{let j;j=P.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((X=>X.track&&X.track.id===U.track.id)):{track:U.track};const $=new Event("track");$.track=U.track,$.receiver=j,$.transceiver={receiver:j},$.streams=[R.stream],this.dispatchEvent($)})),R.stream.getTracks().forEach((U=>{let j;j=P.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((X=>X.track&&X.track.id===U.id)):{track:U};const $=new Event("track");$.track=U,$.receiver=j,$.transceiver={receiver:j},$.streams=[R.stream],this.dispatchEvent($)}))},this.addEventListener("addstream",this._ontrackpoly)),w.apply(this,arguments)}}else m(P,"track",(w=>(w.transceiver||Object.defineProperty(w,"transceiver",{value:{receiver:w.receiver}}),w)))}function D(P){if(typeof P=="object"&&P.RTCPeerConnection&&!("getSenders"in P.RTCPeerConnection.prototype)&&"createDTMFSender"in P.RTCPeerConnection.prototype){const w=function(j,$){return{track:$,get dtmf(){return this._dtmf===void 0&&($.kind==="audio"?this._dtmf=j.createDTMFSender($):this._dtmf=null),this._dtmf},_pc:j}};if(!P.RTCPeerConnection.prototype.getSenders){P.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const j=P.RTCPeerConnection.prototype.addTrack;P.RTCPeerConnection.prototype.addTrack=function(X,ue){let me=j.apply(this,arguments);return me||(me=w(this,X),this._senders.push(me)),me};const $=P.RTCPeerConnection.prototype.removeTrack;P.RTCPeerConnection.prototype.removeTrack=function(X){$.apply(this,arguments);const ue=this._senders.indexOf(X);ue!==-1&&this._senders.splice(ue,1)}}const R=P.RTCPeerConnection.prototype.addStream;P.RTCPeerConnection.prototype.addStream=function(j){this._senders=this._senders||[],R.apply(this,[j]),j.getTracks().forEach(($=>{this._senders.push(w(this,$))}))};const U=P.RTCPeerConnection.prototype.removeStream;P.RTCPeerConnection.prototype.removeStream=function(j){this._senders=this._senders||[],U.apply(this,[j]),j.getTracks().forEach(($=>{const X=this._senders.find((ue=>ue.track===$));X&&this._senders.splice(this._senders.indexOf(X),1)}))}}else if(typeof P=="object"&&P.RTCPeerConnection&&"getSenders"in P.RTCPeerConnection.prototype&&"createDTMFSender"in P.RTCPeerConnection.prototype&&P.RTCRtpSender&&!("dtmf"in P.RTCRtpSender.prototype)){const w=P.RTCPeerConnection.prototype.getSenders;P.RTCPeerConnection.prototype.getSenders=function(){const R=w.apply(this,[]);return R.forEach((U=>U._pc=this)),R},Object.defineProperty(P.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function O(P){if(!P.RTCPeerConnection)return;const w=P.RTCPeerConnection.prototype.getStats;P.RTCPeerConnection.prototype.getStats=function(){const[R,U,j]=arguments;if(arguments.length>0&&typeof R=="function")return w.apply(this,arguments);if(w.length===0&&(arguments.length===0||typeof R!="function"))return w.apply(this,[]);const $=function(ue){const me={};return ue.result().forEach((ce=>{const de={id:ce.id,timestamp:ce.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[ce.type]||ce.type};ce.names().forEach((Ae=>{de[Ae]=ce.stat(Ae)})),me[de.id]=de})),me},X=function(ue){return new Map(Object.keys(ue).map((me=>[me,ue[me]])))};if(arguments.length>=2){const ue=function(me){U(X($(me)))};return w.apply(this,[ue,R])}return new Promise(((ue,me)=>{w.apply(this,[function(ce){ue(X($(ce)))},me])})).then(U,j)}}function z(P){if(!(typeof P=="object"&&P.RTCPeerConnection&&P.RTCRtpSender&&P.RTCRtpReceiver))return;if(!("getStats"in P.RTCRtpSender.prototype)){const R=P.RTCPeerConnection.prototype.getSenders;R&&(P.RTCPeerConnection.prototype.getSenders=function(){const j=R.apply(this,[]);return j.forEach(($=>$._pc=this)),j});const U=P.RTCPeerConnection.prototype.addTrack;U&&(P.RTCPeerConnection.prototype.addTrack=function(){const j=U.apply(this,arguments);return j._pc=this,j}),P.RTCRtpSender.prototype.getStats=function(){const j=this;return this._pc.getStats().then(($=>T($,j.track,!0)))}}if(!("getStats"in P.RTCRtpReceiver.prototype)){const R=P.RTCPeerConnection.prototype.getReceivers;R&&(P.RTCPeerConnection.prototype.getReceivers=function(){const U=R.apply(this,[]);return U.forEach((j=>j._pc=this)),U}),m(P,"track",(U=>(U.receiver._pc=U.srcElement,U))),P.RTCRtpReceiver.prototype.getStats=function(){const U=this;return this._pc.getStats().then((j=>T(j,U.track,!1)))}}if(!("getStats"in P.RTCRtpSender.prototype)||!("getStats"in P.RTCRtpReceiver.prototype))return;const w=P.RTCPeerConnection.prototype.getStats;P.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof P.MediaStreamTrack){const R=arguments[0];let U,j,$;return this.getSenders().forEach((X=>{X.track===R&&(U?$=!0:U=X)})),this.getReceivers().forEach((X=>(X.track===R&&(j?$=!0:j=X),X.track===R))),$||U&&j?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):U?U.getStats():j?j.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return w.apply(this,arguments)}}function q(P){P.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(($=>this._shimmedLocalStreams[$][0]))};const w=P.RTCPeerConnection.prototype.addTrack;P.RTCPeerConnection.prototype.addTrack=function($,X){if(!X)return w.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const ue=w.apply(this,arguments);return this._shimmedLocalStreams[X.id]?this._shimmedLocalStreams[X.id].indexOf(ue)===-1&&this._shimmedLocalStreams[X.id].push(ue):this._shimmedLocalStreams[X.id]=[X,ue],ue};const R=P.RTCPeerConnection.prototype.addStream;P.RTCPeerConnection.prototype.addStream=function($){this._shimmedLocalStreams=this._shimmedLocalStreams||{},$.getTracks().forEach((me=>{if(this.getSenders().find((ce=>ce.track===me)))throw new DOMException("Track already exists.","InvalidAccessError")}));const X=this.getSenders();R.apply(this,arguments);const ue=this.getSenders().filter((me=>X.indexOf(me)===-1));this._shimmedLocalStreams[$.id]=[$].concat(ue)};const U=P.RTCPeerConnection.prototype.removeStream;P.RTCPeerConnection.prototype.removeStream=function($){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[$.id],U.apply(this,arguments)};const j=P.RTCPeerConnection.prototype.removeTrack;P.RTCPeerConnection.prototype.removeTrack=function($){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},$&&Object.keys(this._shimmedLocalStreams).forEach((X=>{const ue=this._shimmedLocalStreams[X].indexOf($);ue!==-1&&this._shimmedLocalStreams[X].splice(ue,1),this._shimmedLocalStreams[X].length===1&&delete this._shimmedLocalStreams[X]})),j.apply(this,arguments)}}function G(P,w){if(!P.RTCPeerConnection)return;if(P.RTCPeerConnection.prototype.addTrack&&w.version>=65)return q(P);const R=P.RTCPeerConnection.prototype.getLocalStreams;P.RTCPeerConnection.prototype.getLocalStreams=function(){const me=R.apply(this);return this._reverseStreams=this._reverseStreams||{},me.map((ce=>this._reverseStreams[ce.id]))};const U=P.RTCPeerConnection.prototype.addStream;P.RTCPeerConnection.prototype.addStream=function(me){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},me.getTracks().forEach((ce=>{if(this.getSenders().find((de=>de.track===ce)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[me.id]){const ce=new P.MediaStream(me.getTracks());this._streams[me.id]=ce,this._reverseStreams[ce.id]=me,me=ce}U.apply(this,[me])};const j=P.RTCPeerConnection.prototype.removeStream;function $(me,ce){let de=ce.sdp;return Object.keys(me._reverseStreams||[]).forEach((Ae=>{const Me=me._reverseStreams[Ae],rt=me._streams[Me.id];de=de.replace(new RegExp(rt.id,"g"),Me.id)})),new RTCSessionDescription({type:ce.type,sdp:de})}P.RTCPeerConnection.prototype.removeStream=function(me){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},j.apply(this,[this._streams[me.id]||me]),delete this._reverseStreams[this._streams[me.id]?this._streams[me.id].id:me.id],delete this._streams[me.id]},P.RTCPeerConnection.prototype.addTrack=function(me,ce){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const de=[].slice.call(arguments,1);if(de.length!==1||!de[0].getTracks().find((Me=>Me===me)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((Me=>Me.track===me)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Ae=this._streams[ce.id];if(Ae)Ae.addTrack(me),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const Me=new P.MediaStream([me]);this._streams[ce.id]=Me,this._reverseStreams[Me.id]=ce,this.addStream(Me)}return this.getSenders().find((Me=>Me.track===me))},["createOffer","createAnswer"].forEach((function(me){const ce=P.RTCPeerConnection.prototype[me],de={[me](){const Ae=arguments;return arguments.length&&typeof arguments[0]=="function"?ce.apply(this,[Me=>{const rt=$(this,Me);Ae[0].apply(null,[rt])},Me=>{Ae[1]&&Ae[1].apply(null,Me)},arguments[2]]):ce.apply(this,arguments).then((Me=>$(this,Me)))}};P.RTCPeerConnection.prototype[me]=de[me]}));const X=P.RTCPeerConnection.prototype.setLocalDescription;P.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(me,ce){let de=ce.sdp;return Object.keys(me._reverseStreams||[]).forEach((Ae=>{const Me=me._reverseStreams[Ae],rt=me._streams[Me.id];de=de.replace(new RegExp(Me.id,"g"),rt.id)})),new RTCSessionDescription({type:ce.type,sdp:de})})(this,arguments[0]),X.apply(this,arguments)):X.apply(this,arguments)};const ue=Object.getOwnPropertyDescriptor(P.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(P.RTCPeerConnection.prototype,"localDescription",{get(){const me=ue.get.apply(this);return me.type===""?me:$(this,me)}}),P.RTCPeerConnection.prototype.removeTrack=function(me){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!me._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(me._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let ce;this._streams=this._streams||{},Object.keys(this._streams).forEach((de=>{this._streams[de].getTracks().find((Ae=>me.track===Ae))&&(ce=this._streams[de])})),ce&&(ce.getTracks().length===1?this.removeStream(this._reverseStreams[ce.id]):ce.removeTrack(me.track),this.dispatchEvent(new Event("negotiationneeded")))}}function K(P,w){!P.RTCPeerConnection&&P.webkitRTCPeerConnection&&(P.RTCPeerConnection=P.webkitRTCPeerConnection),P.RTCPeerConnection&&w.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(R){const U=P.RTCPeerConnection.prototype[R],j={[R](){return arguments[0]=new(R==="addIceCandidate"?P.RTCIceCandidate:P.RTCSessionDescription)(arguments[0]),U.apply(this,arguments)}};P.RTCPeerConnection.prototype[R]=j[R]}))}function te(P,w){m(P,"negotiationneeded",(R=>{const U=R.target;if(!(w.version<72||U.getConfiguration&&U.getConfiguration().sdpSemantics==="plan-b")||U.signalingState==="stable")return R}))}function re(P,w){const R=P&&P.navigator,U=P&&P.MediaStreamTrack;if(R.getUserMedia=function(j,$,X){v("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),R.mediaDevices.getUserMedia(j).then($,X)},!(w.version>55&&"autoGainControl"in R.mediaDevices.getSupportedConstraints())){const j=function(X,ue,me){ue in X&&!(me in X)&&(X[me]=X[ue],delete X[ue])},$=R.mediaDevices.getUserMedia.bind(R.mediaDevices);if(R.mediaDevices.getUserMedia=function(X){return typeof X=="object"&&typeof X.audio=="object"&&(X=JSON.parse(JSON.stringify(X)),j(X.audio,"autoGainControl","mozAutoGainControl"),j(X.audio,"noiseSuppression","mozNoiseSuppression")),$(X)},U&&U.prototype.getSettings){const X=U.prototype.getSettings;U.prototype.getSettings=function(){const ue=X.apply(this,arguments);return j(ue,"mozAutoGainControl","autoGainControl"),j(ue,"mozNoiseSuppression","noiseSuppression"),ue}}if(U&&U.prototype.applyConstraints){const X=U.prototype.applyConstraints;U.prototype.applyConstraints=function(ue){return this.kind==="audio"&&typeof ue=="object"&&(ue=JSON.parse(JSON.stringify(ue)),j(ue,"autoGainControl","mozAutoGainControl"),j(ue,"noiseSuppression","mozNoiseSuppression")),X.apply(this,[ue])}}}}function H(P,w){P.navigator.mediaDevices&&"getDisplayMedia"in P.navigator.mediaDevices||P.navigator.mediaDevices&&(P.navigator.mediaDevices.getDisplayMedia=function(R){if(!R||!R.video){const U=new DOMException("getDisplayMedia without video constraints is undefined");return U.name="NotFoundError",U.code=8,Promise.reject(U)}return R.video===!0?R.video={mediaSource:w}:R.video.mediaSource=w,P.navigator.mediaDevices.getUserMedia(R)})}function Y(P){typeof P=="object"&&P.RTCTrackEvent&&"receiver"in P.RTCTrackEvent.prototype&&!("transceiver"in P.RTCTrackEvent.prototype)&&Object.defineProperty(P.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Z(P,w){if(typeof P!="object"||!P.RTCPeerConnection&&!P.mozRTCPeerConnection)return;!P.RTCPeerConnection&&P.mozRTCPeerConnection&&(P.RTCPeerConnection=P.mozRTCPeerConnection),w.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(j){const $=P.RTCPeerConnection.prototype[j],X={[j](){return arguments[0]=new(j==="addIceCandidate"?P.RTCIceCandidate:P.RTCSessionDescription)(arguments[0]),$.apply(this,arguments)}};P.RTCPeerConnection.prototype[j]=X[j]}));const R={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},U=P.RTCPeerConnection.prototype.getStats;P.RTCPeerConnection.prototype.getStats=function(){const[j,$,X]=arguments;return U.apply(this,[j||null]).then((ue=>{if(w.version<53&&!$)try{ue.forEach((me=>{me.type=R[me.type]||me.type}))}catch(me){if(me.name!=="TypeError")throw me;ue.forEach(((ce,de)=>{ue.set(de,Object.assign({},ce,{type:R[ce.type]||ce.type}))}))}return ue})).then($,X)}}function Q(P){if(typeof P!="object"||!P.RTCPeerConnection||!P.RTCRtpSender||P.RTCRtpSender&&"getStats"in P.RTCRtpSender.prototype)return;const w=P.RTCPeerConnection.prototype.getSenders;w&&(P.RTCPeerConnection.prototype.getSenders=function(){const U=w.apply(this,[]);return U.forEach((j=>j._pc=this)),U});const R=P.RTCPeerConnection.prototype.addTrack;R&&(P.RTCPeerConnection.prototype.addTrack=function(){const U=R.apply(this,arguments);return U._pc=this,U}),P.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ie(P){if(typeof P!="object"||!P.RTCPeerConnection||!P.RTCRtpSender||P.RTCRtpSender&&"getStats"in P.RTCRtpReceiver.prototype)return;const w=P.RTCPeerConnection.prototype.getReceivers;w&&(P.RTCPeerConnection.prototype.getReceivers=function(){const R=w.apply(this,[]);return R.forEach((U=>U._pc=this)),R}),m(P,"track",(R=>(R.receiver._pc=R.srcElement,R))),P.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ge(P){P.RTCPeerConnection&&!("removeStream"in P.RTCPeerConnection.prototype)&&(P.RTCPeerConnection.prototype.removeStream=function(w){v("removeStream","removeTrack"),this.getSenders().forEach((R=>{R.track&&w.getTracks().includes(R.track)&&this.removeTrack(R)}))})}function Te(P){P.DataChannel&&!P.RTCDataChannel&&(P.RTCDataChannel=P.DataChannel)}function be(P){if(typeof P!="object"||!P.RTCPeerConnection)return;const w=P.RTCPeerConnection.prototype.addTransceiver;w&&(P.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let R=arguments[1]&&arguments[1].sendEncodings;R===void 0&&(R=[]),R=[...R];const U=R.length>0;U&&R.forEach(($=>{if("rid"in $&&!/^[a-z0-9]{0,16}$/i.test($.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in $&&!(parseFloat($.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in $&&!(parseFloat($.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const j=w.apply(this,arguments);if(U){const{sender:$}=j,X=$.getParameters();(!("encodings"in X)||X.encodings.length===1&&Object.keys(X.encodings[0]).length===0)&&(X.encodings=R,$.sendEncodings=R,this.setParametersPromises.push($.setParameters(X).then((()=>{delete $.sendEncodings})).catch((()=>{delete $.sendEncodings}))))}return j})}function Pe(P){if(typeof P!="object"||!P.RTCRtpSender)return;const w=P.RTCRtpSender.prototype.getParameters;w&&(P.RTCRtpSender.prototype.getParameters=function(){const R=w.apply(this,arguments);return"encodings"in R||(R.encodings=[].concat(this.sendEncodings||[{}])),R})}function Ge(P){if(typeof P!="object"||!P.RTCPeerConnection)return;const w=P.RTCPeerConnection.prototype.createOffer;P.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>w.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):w.apply(this,arguments)}}function Ze(P){if(typeof P!="object"||!P.RTCPeerConnection)return;const w=P.RTCPeerConnection.prototype.createAnswer;P.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>w.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):w.apply(this,arguments)}}function lt(P){if(typeof P=="object"&&P.RTCPeerConnection){if("getLocalStreams"in P.RTCPeerConnection.prototype||(P.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in P.RTCPeerConnection.prototype)){const w=P.RTCPeerConnection.prototype.addTrack;P.RTCPeerConnection.prototype.addStream=function(R){this._localStreams||(this._localStreams=[]),this._localStreams.includes(R)||this._localStreams.push(R),R.getAudioTracks().forEach((U=>w.call(this,U,R))),R.getVideoTracks().forEach((U=>w.call(this,U,R)))},P.RTCPeerConnection.prototype.addTrack=function(R,...U){return U&&U.forEach((j=>{this._localStreams?this._localStreams.includes(j)||this._localStreams.push(j):this._localStreams=[j]})),w.apply(this,arguments)}}"removeStream"in P.RTCPeerConnection.prototype||(P.RTCPeerConnection.prototype.removeStream=function(w){this._localStreams||(this._localStreams=[]);const R=this._localStreams.indexOf(w);if(R===-1)return;this._localStreams.splice(R,1);const U=w.getTracks();this.getSenders().forEach((j=>{U.includes(j.track)&&this.removeTrack(j)}))})}}function pt(P){if(typeof P=="object"&&P.RTCPeerConnection&&("getRemoteStreams"in P.RTCPeerConnection.prototype||(P.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in P.RTCPeerConnection.prototype))){Object.defineProperty(P.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(R){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=R),this.addEventListener("track",this._onaddstreampoly=U=>{U.streams.forEach((j=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(j))return;this._remoteStreams.push(j);const $=new Event("addstream");$.stream=j,this.dispatchEvent($)}))})}});const w=P.RTCPeerConnection.prototype.setRemoteDescription;P.RTCPeerConnection.prototype.setRemoteDescription=function(){const R=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(U){U.streams.forEach((j=>{if(R._remoteStreams||(R._remoteStreams=[]),R._remoteStreams.indexOf(j)>=0)return;R._remoteStreams.push(j);const $=new Event("addstream");$.stream=j,R.dispatchEvent($)}))}),w.apply(R,arguments)}}}function ne(P){if(typeof P!="object"||!P.RTCPeerConnection)return;const w=P.RTCPeerConnection.prototype,R=w.createOffer,U=w.createAnswer,j=w.setLocalDescription,$=w.setRemoteDescription,X=w.addIceCandidate;w.createOffer=function(me,ce){const de=arguments.length>=2?arguments[2]:arguments[0],Ae=R.apply(this,[de]);return ce?(Ae.then(me,ce),Promise.resolve()):Ae},w.createAnswer=function(me,ce){const de=arguments.length>=2?arguments[2]:arguments[0],Ae=U.apply(this,[de]);return ce?(Ae.then(me,ce),Promise.resolve()):Ae};let ue=function(me,ce,de){const Ae=j.apply(this,[me]);return de?(Ae.then(ce,de),Promise.resolve()):Ae};w.setLocalDescription=ue,ue=function(me,ce,de){const Ae=$.apply(this,[me]);return de?(Ae.then(ce,de),Promise.resolve()):Ae},w.setRemoteDescription=ue,ue=function(me,ce,de){const Ae=X.apply(this,[me]);return de?(Ae.then(ce,de),Promise.resolve()):Ae},w.addIceCandidate=ue}function Le(P){const w=P&&P.navigator;if(w.mediaDevices&&w.mediaDevices.getUserMedia){const R=w.mediaDevices,U=R.getUserMedia.bind(R);w.mediaDevices.getUserMedia=j=>U(Ve(j))}!w.getUserMedia&&w.mediaDevices&&w.mediaDevices.getUserMedia&&(w.getUserMedia=(function(R,U,j){w.mediaDevices.getUserMedia(R).then(U,j)}).bind(w))}function Ve(P){return P&&P.video!==void 0?Object.assign({},P,{video:x(P.video)}):P}function De(P){if(!P.RTCPeerConnection)return;const w=P.RTCPeerConnection;P.RTCPeerConnection=function(R,U){if(R&&R.iceServers){const j=[];for(let $=0;$<R.iceServers.length;$++){let X=R.iceServers[$];X.urls===void 0&&X.url?(v("RTCIceServer.url","RTCIceServer.urls"),X=JSON.parse(JSON.stringify(X)),X.urls=X.url,delete X.url,j.push(X)):j.push(R.iceServers[$])}R.iceServers=j}return new w(R,U)},P.RTCPeerConnection.prototype=w.prototype,"generateCertificate"in w&&Object.defineProperty(P.RTCPeerConnection,"generateCertificate",{get:()=>w.generateCertificate})}function Ie(P){typeof P=="object"&&P.RTCTrackEvent&&"receiver"in P.RTCTrackEvent.prototype&&!("transceiver"in P.RTCTrackEvent.prototype)&&Object.defineProperty(P.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ae(P){const w=P.RTCPeerConnection.prototype.createOffer;P.RTCPeerConnection.prototype.createOffer=function(R){if(R){R.offerToReceiveAudio!==void 0&&(R.offerToReceiveAudio=!!R.offerToReceiveAudio);const U=this.getTransceivers().find(($=>$.receiver.track.kind==="audio"));R.offerToReceiveAudio===!1&&U?U.direction==="sendrecv"?U.setDirection?U.setDirection("sendonly"):U.direction="sendonly":U.direction==="recvonly"&&(U.setDirection?U.setDirection("inactive"):U.direction="inactive"):R.offerToReceiveAudio!==!0||U||this.addTransceiver("audio",{direction:"recvonly"}),R.offerToReceiveVideo!==void 0&&(R.offerToReceiveVideo=!!R.offerToReceiveVideo);const j=this.getTransceivers().find(($=>$.receiver.track.kind==="video"));R.offerToReceiveVideo===!1&&j?j.direction==="sendrecv"?j.setDirection?j.setDirection("sendonly"):j.direction="sendonly":j.direction==="recvonly"&&(j.setDirection?j.setDirection("inactive"):j.direction="inactive"):R.offerToReceiveVideo!==!0||j||this.addTransceiver("video",{direction:"recvonly"})}return w.apply(this,arguments)}}function ve(P){typeof P!="object"||P.AudioContext||(P.AudioContext=P.webkitAudioContext)}var we=i(7963),pe=i.n(we);function ze(P){if(!P.RTCIceCandidate||P.RTCIceCandidate&&"foundation"in P.RTCIceCandidate.prototype)return;const w=P.RTCIceCandidate;P.RTCIceCandidate=function(R){if(typeof R=="object"&&R.candidate&&R.candidate.indexOf("a=")===0&&((R=JSON.parse(JSON.stringify(R))).candidate=R.candidate.substring(2)),R.candidate&&R.candidate.length){const U=new w(R),j=pe().parseCandidate(R.candidate);for(const $ in j)$ in U||Object.defineProperty(U,$,{value:j[$]});return U.toJSON=function(){return{candidate:U.candidate,sdpMid:U.sdpMid,sdpMLineIndex:U.sdpMLineIndex,usernameFragment:U.usernameFragment}},U}return new w(R)},P.RTCIceCandidate.prototype=w.prototype,m(P,"icecandidate",(R=>(R.candidate&&Object.defineProperty(R,"candidate",{value:new P.RTCIceCandidate(R.candidate),writable:"false"}),R)))}function Je(P){!P.RTCIceCandidate||P.RTCIceCandidate&&"relayProtocol"in P.RTCIceCandidate.prototype||m(P,"icecandidate",(w=>{if(w.candidate){const R=pe().parseCandidate(w.candidate.candidate);R.type==="relay"&&(w.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[R.priority>>24])}return w}))}function Xe(P,w){if(!P.RTCPeerConnection)return;"sctp"in P.RTCPeerConnection.prototype||Object.defineProperty(P.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const R=P.RTCPeerConnection.prototype.setRemoteDescription;P.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,w.browser==="chrome"&&w.version>=76){const{sdpSemantics:U}=this.getConfiguration();U==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if((function(U){if(!U||!U.sdp)return!1;const j=pe().splitSections(U.sdp);return j.shift(),j.some(($=>{const X=pe().parseMLine($);return X&&X.kind==="application"&&X.protocol.indexOf("SCTP")!==-1}))})(arguments[0])){const U=(function(me){const ce=me.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(ce===null||ce.length<2)return-1;const de=parseInt(ce[1],10);return de!=de?-1:de})(arguments[0]),j=(function(me){let ce=65536;return w.browser==="firefox"&&(ce=w.version<57?me===-1?16384:2147483637:w.version<60?w.version===57?65535:65536:2147483637),ce})(U),$=(function(me,ce){let de=65536;w.browser==="firefox"&&w.version===57&&(de=65535);const Ae=pe().matchPrefix(me.sdp,"a=max-message-size:");return Ae.length>0?de=parseInt(Ae[0].substring(19),10):w.browser==="firefox"&&ce!==-1&&(de=2147483637),de})(arguments[0],U);let X;X=j===0&&$===0?Number.POSITIVE_INFINITY:j===0||$===0?Math.max(j,$):Math.min(j,$);const ue={};Object.defineProperty(ue,"maxMessageSize",{get:()=>X}),this._sctp=ue}return R.apply(this,arguments)}}function tt(P){if(!P.RTCPeerConnection||!("createDataChannel"in P.RTCPeerConnection.prototype))return;function w(U,j){const $=U.send;U.send=function(){const X=arguments[0],ue=X.length||X.size||X.byteLength;if(U.readyState==="open"&&j.sctp&&ue>j.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+j.sctp.maxMessageSize+" bytes)");return $.apply(U,arguments)}}const R=P.RTCPeerConnection.prototype.createDataChannel;P.RTCPeerConnection.prototype.createDataChannel=function(){const U=R.apply(this,arguments);return w(U,this),U},m(P,"datachannel",(U=>(w(U.channel,U.target),U)))}function Nt(P){if(!P.RTCPeerConnection||"connectionState"in P.RTCPeerConnection.prototype)return;const w=P.RTCPeerConnection.prototype;Object.defineProperty(w,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(w,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(R){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),R&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=R)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((R=>{const U=w[R];w[R]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=j=>{const $=j.target;if($._lastConnectionState!==$.connectionState){$._lastConnectionState=$.connectionState;const X=new Event("connectionstatechange",j);$.dispatchEvent(X)}return j},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),U.apply(this,arguments)}}))}function gt(P,w){if(!P.RTCPeerConnection||w.browser==="chrome"&&w.version>=71||w.browser==="safari"&&w.version>=605)return;const R=P.RTCPeerConnection.prototype.setRemoteDescription;P.RTCPeerConnection.prototype.setRemoteDescription=function(U){if(U&&U.sdp&&U.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const j=U.sdp.split(`
`).filter(($=>$.trim()!=="a=extmap-allow-mixed")).join(`
`);P.RTCSessionDescription&&U instanceof P.RTCSessionDescription?arguments[0]=new P.RTCSessionDescription({type:U.type,sdp:j}):U.sdp=j}return R.apply(this,arguments)}}function wt(P,w){if(!P.RTCPeerConnection||!P.RTCPeerConnection.prototype)return;const R=P.RTCPeerConnection.prototype.addIceCandidate;R&&R.length!==0&&(P.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(w.browser==="chrome"&&w.version<78||w.browser==="firefox"&&w.version<68||w.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():R.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Re(P,w){if(!P.RTCPeerConnection||!P.RTCPeerConnection.prototype)return;const R=P.RTCPeerConnection.prototype.setLocalDescription;R&&R.length!==0&&(P.RTCPeerConnection.prototype.setLocalDescription=function(){let U=arguments[0]||{};if(typeof U!="object"||U.type&&U.sdp)return R.apply(this,arguments);if(U={type:U.type,sdp:U.sdp},!U.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":U.type="offer";break;default:U.type="answer"}return U.sdp||U.type!=="offer"&&U.type!=="answer"?R.apply(this,[U]):(U.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((j=>R.apply(this,[j])))})}(function({window:P}={},w={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const R=y,U=(function($){const X={browser:null,version:null};if($===void 0||!$.navigator||!$.navigator.userAgent)return X.browser="Not a browser.",X;const{navigator:ue}=$;if(ue.mozGetUserMedia)X.browser="firefox",X.version=p(ue.userAgent,/Firefox\/(\d+)\./,1);else if(ue.webkitGetUserMedia||$.isSecureContext===!1&&$.webkitRTCPeerConnection)X.browser="chrome",X.version=p(ue.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!$.RTCPeerConnection||!ue.userAgent.match(/AppleWebKit\/(\d+)\./))return X.browser="Not a supported browser.",X;X.browser="safari",X.version=p(ue.userAgent,/AppleWebKit\/(\d+)\./,1),X.supportsUnifiedPlan=$.RTCRtpTransceiver&&"currentDirection"in $.RTCRtpTransceiver.prototype}return X})(P),j={browserDetails:U,commonShim:l,extractVersion:p,disableLog:g,disableWarnings:_,sdp:we};switch(U.browser){case"chrome":if(!o||!K||!w.shimChrome)return R("Chrome shim is not included in this adapter release."),j;if(U.version===null)return R("Chrome shim can not determine version, not shimming."),j;R("adapter.js shimming chrome."),j.browserShim=o,wt(P,U),Re(P),L(P,U),F(P),K(P,U),M(P),G(P,U),D(P),O(P),z(P),te(P,U),ze(P),Je(P),Nt(P),Xe(P,U),tt(P),gt(P,U);break;case"firefox":if(!a||!Z||!w.shimFirefox)return R("Firefox shim is not included in this adapter release."),j;R("adapter.js shimming firefox."),j.browserShim=a,wt(P,U),Re(P),re(P,U),Z(P,U),Y(P),ge(P),Q(P),ie(P),Te(P),be(P),Pe(P),Ge(P),Ze(P),ze(P),Nt(P),Xe(P,U),tt(P);break;case"safari":if(!c||!w.shimSafari)return R("Safari shim is not included in this adapter release."),j;R("adapter.js shimming safari."),j.browserShim=c,wt(P,U),Re(P),De(P),ae(P),ne(P),lt(P),pt(P),Ie(P),Le(P),ve(P),ze(P),Je(P),Xe(P,U),tt(P),gt(P,U);break;default:R("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),i(8630);const se=()=>typeof RTCPeerConnection=="function";var W,oe;(function(P){P[P.TRACE=0]="TRACE",P[P.DEBUG=1]="DEBUG",P[P.INFO=2]="INFO",P[P.WARN=3]="WARN",P[P.ERROR=4]="ERROR",P[P.SILENT=5]="SILENT"})(W||(W={})),(function(P){P.TIME="Time",P.WEBRTC="WebRTC",P.EMITTER="Emitter",P.MEDIA="Media",P.SUBSCRIPTION="StageSubscription",P.PUBLICATION="StagePublication",P.CONNECTION="StageConnection",P.SOCKET="StageSocket",P.BROADCAST_STAGE_CLIENT="BroadcastStageClient",P.STAGE="Stage",P.REMOTE_PARTICIPANT="RemoteParticipant",P.LOCAL_PARTICIPANT="LocalParticipant",P.CONFIGURATION="Configuration",P.REMOTE_PLAYBACK="RemotePlaybackController",P.REMOTE_STAGE_STREAM="RemoteStageStream"})(oe||(oe={}));const xe=12e4,Ce=3e5,Se="no-rid";class ye extends Error{constructor({name:w,message:R,code:U,details:j,cause:$,params:X}){super(R),Error.captureStackTrace&&Error.captureStackTrace(this,ye),this.name=w||"BroadcastClientError",this.message=R,this.code=U,this.details=j,this.cause=$,this.params=X}}const Ke={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},ke={name:"CameraError",code:2e3,message:"Camera could not be captured"},He={name:"InputError",code:3e3,message:"Input could not be attached"},Fe={name:"AddDeviceError",code:4e3,message:"Device is missing"},We={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},at={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},Be={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},nt={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},it={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},xt={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},ot={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},tn={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},ln={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},Rt={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},Vt={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},_t={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},Jt={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},Tn={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},qt={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},An={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},Ln={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},mr={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},ns={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},hi={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},ti={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},Fi={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},rs={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},qi={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},is={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},ss={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},je={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},vt={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var It,Ut,yt,an,In,_n,Pn,tr,fr,Cn=function(P,w,R,U){if(typeof w=="function"?P!==w||!U:!w.has(P))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?U:R==="a"?U.call(P):U?U.value:w.get(P)},yr=function(P,w,R,U,j){if(typeof w=="function"?P!==w||!0:!w.has(P))throw new TypeError("Cannot write private member to an object whose class did not declare it");return w.set(P,R),R};const Hr=1920,ds=1080,Lr=W.ERROR,Gr={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},ar={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},br={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},Un={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},bi={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},ai={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},Rs={reconnect:!1,timeout:xe};function lo(P){var w,R;if(typeof P!="string"&&P!==void 0)throw new ye(ns);if(P){if(P.startsWith("https"))return P;{const U=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(P);if(((w=U?.groups)===null||w===void 0?void 0:w.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(R=U?.groups)===null||R===void 0?void 0:R.id)return`https://${U.groups.id}.webrtc.live-video.net:4443`;throw new ye(hi)}}return""}class Ri{constructor(w,R,U=Gr,j,$=Rs){this.LOG_LEVEL=W,this.BASIC_LANDSCAPE=Gr,this.BASIC_PORTRAIT=ar,this.BASIC_FULL_HD_LANDSCAPE=br,this.BASIC_FULL_HD_PORTRAIT=Un,this.STANDARD_LANDSCAPE=bi,this.STANDARD_PORTRAIT=ai,It.set(this,void 0),Ut.set(this,void 0),yt.set(this,Gr),an.set(this,void 0),In.set(this,Rs),_n.set(this,(X=>{if(!X)throw new ye(Object.assign(Object.assign({},mr),{details:"missing stream configuration"}));if(!(X.maxBitrate<=8500&&X.maxBitrate>=200))throw new ye(Object.assign(Object.assign({},mr),{details:"maxBitrate must be between 200 and 8500"}));if(!(X.maxFramerate<=60&&X.maxFramerate>=10))throw new ye(Object.assign(Object.assign({},mr),{details:"maxFramerate must be between 10 and 60"}));const ue=X.maxResolution.width,me=X.maxResolution.height;if(ue>Hr||me>Hr||ue<160||me<160||ue===Hr&&me>ds||me===Hr&&ue>ds)throw new ye(Object.assign(Object.assign({},mr),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))})),Pn.set(this,(X=>{if(!X)return;const ue=Number(X),me=Number.isInteger(ue),ce=ue>=W.TRACE,de=ue<=W.SILENT;if(!me||!ce||!de)throw new ye(ti)})),tr.set(this,(X=>{if(X&&typeof X!="object")throw new ye(Fi)})),fr.set(this,(X=>{if(!X)return;if(typeof X!="object"||typeof X.reconnect!="boolean")throw new ye(qi);const{timeout:ue}=X;if(ue!==void 0&&(Number.isNaN(ue)||typeof ue!="number"||ue<1e4||ue>Ce))throw new ye(is)})),Cn(this,tr,"f").call(this,j),Cn(this,Pn,"f").call(this,R),Cn(this,_n,"f").call(this,U),yr(this,It,w),yr(this,Ut,R),yr(this,yt,U),yr(this,an,j),yr(this,In,$)}get ingestEndpoint(){return Cn(this,It,"f")}set ingestEndpoint(w){yr(this,It,lo(w))}get streamConfig(){return Cn(this,yt,"f")}set streamConfig(w){Cn(this,_n,"f").call(this,w),yr(this,yt,w)}get logLevel(){return Cn(this,Ut,"f")}set logLevel(w){Cn(this,Pn,"f").call(this,w),yr(this,Ut,w)}get logger(){return Cn(this,an,"f")}set logger(w){Cn(this,tr,"f").call(this,w),yr(this,an,w)}get networkReconnectConfig(){return Cn(this,In,"f")}set networkReconnectConfig(w){Cn(this,fr,"f").call(this,w),yr(this,In,w)}}It=new WeakMap,Ut=new WeakMap,yt=new WeakMap,an=new WeakMap,In=new WeakMap,_n=new WeakMap,Pn=new WeakMap,tr=new WeakMap,fr=new WeakMap;var Mn,Pi=i(228);(function(P){P.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",P.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",P.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",P.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",P.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",P.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",P.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",P.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",P.PUBLISH="ivs_broadcast_multihost_publish",P.UNPUBLISH="ivs_broadcast_multihost_unpublish",P.SUBSCRIBE="ivs_broadcast_multihost_subscribe",P.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",P.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",P.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",P.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",P.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",P.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",P.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",P.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",P.FIRST_FRAME="ivs_broadcast_multihost_first_frame",P.JOIN="ivs_broadcast_multihost_join",P.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",P.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",P.JOIN_ENDED="ivs_broadcast_multihost_join_ended",P.LEAVE="ivs_broadcast_multihost_leave",P.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",P.SERVER_REQUEST="ivs_broadcast_multihost_server_request",P.TRACE="ivs_broadcast_stage_trace",P.ERROR="ivs_broadcast_error",P.MINUTE="ivs_broadcast_multihost_minute",P.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",P.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",P.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",P.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",P.EDP_PONG="ivs_broadcast_multihost_edp_rtt",P.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",P.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",P.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",P.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",P.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state",P.SELECTED_PAIR_CHANGE="ivs_broadcast_webrtc_selected_pair_change",P.ANALYTICS_HEALTH_REPORT="ivs_broadcast_analytics_health_report",P.DEVCONF_ERROR="ivs_devconf_error",P.DEVCONF_OPS_METRICS="ivs_devconf_ops_metrics",P.DEVCONF_TRACE="ivs_devconf_trace",P.DEVCONF_VALUE="ivs_devconf_value",P.DEVCONF_ROLLOUT_ASSIGNMENT="ivs_devconf_rollout_assignment"})(Mn||(Mn={}));class Xn{constructor(w,R,U,j){this.event=w,this.properties={client_time:new Date().toISOString(),customer_id:R.customerId,device_software:window.navigator.userAgent,multihost_id:R.stageARN,participant_id:R.participantID,participant_user_id:R.userID,platform:"web",sdk_version:"1.31.1",stage_arn:R.stageARN,trace_id:U.value},R.attrGsRole&&(this.properties.token_attribute_0=R.attrGsRole),R.attrGsSessionId&&(this.properties.token_attribute_1=R.attrGsSessionId),this.critical=j}}class ps extends Xn{constructor(w){super(Mn.ERROR,w.token,w.traceId,!0),Object.assign(this.properties,{code:w.code,tag:w.tag,description:w.message,remote_participant_id:w.remoteParticipantId,request_uuid:w.requestUUID,is_nominal:w.nominal,is_fatal:w.fatal,details:w.details,location:w.location,event_count:w.count})}}function al(P){const w=window.IVS_CLIENT_OVERRIDES;return typeof w=="object"?w[P]:P==="logLevel"?window.STAGES_LOG_LEVEL:P==="appLabel"?window.IVS_APP_LABEL:P==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function ms(P){const w=al(P);if(typeof w=="string")return w}function Bc(P){const w=al(P);if(typeof w=="boolean")return w}function e0(P){const w=al(P);if(typeof w=="number")return w;if(typeof w=="string"){const R=parseFloat(w);if(!isNaN(R))return R}}function qg(){const P=al("logLevel");if(typeof P=="number"&&Object.values(W).includes(P))return P}function Yg(){const P=ms("appLabel");if(P!==void 0)return P.substring(0,64)}function Kg(){return Bc("disableXdp")}function bp(){return Bc("preferMainProfile")}function ya(){return Bc("enableInitialLayerOnSdp")}function _b(){return Bc("disableAudioRtcpRsize")}var Fc=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};function Bv(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(P=>{const w=16*Math.random()|0;return(P==="x"?w:3&w|8).toString(16)}))}function Xg(P,w=R=>{}){Fc(this,void 0,void 0,(function*(){try{yield P()}catch(R){w(R)}}))}var cl=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};function Sp(P,w,R={},U=""){return cl(this,void 0,void 0,(function*(){const j=new XMLHttpRequest;return j.open(P,w,!0),R&&Object.keys(R).forEach(($=>{R.hasOwnProperty($)&&j.setRequestHeader($,R[$])})),new Promise((($,X)=>{j.onreadystatechange=()=>{j.readyState===4&&(j.status>=200&&j.status<300?$(j.responseText):X(new Error(`Ingest ${P} ${w} responded ${j.status}
${j.responseText}`)))},j.send(U)}))}))}function t0(P){const w=Date.now();for(const U of P)U.properties.batch_time_millis=w;var R;return{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:`data=${R=JSON.stringify(P),btoa(encodeURIComponent(R).replace(/%([0-9A-F]{2})/g,((U,j)=>String.fromCharCode(+`0x${j}`))))}`}}class bs{send(w,R=!1){return cl(this,void 0,void 0,(function*(){const{currentEndpoint:U}=Io,{headers:j,body:$}=t0(w),X="eventSenderResult",ue=w.length;if(R){const me=navigator.sendBeacon(U,$);Io.trackEvent({type:X,success:me,count:ue})}else Xg((()=>cl(this,void 0,void 0,(function*(){yield Sp("POST",U,j,$),Io.trackEvent({type:X,success:!0,count:ue})}))),(()=>{Io.trackEvent({type:X,success:!1,count:ue})}))}))}}var gc=i(2505),pf=i.n(gc);const _c={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},jc="connectionStateChange",mf="sdpNegotiated",xu="clientError",Th="seiMessageReceived",vc="transformError";var hr;(function(P){P.CLOSED="closed",P.COMPLETED="completed",P.CONNECTED="connected",P.CONNECTING="connecting",P.DISCONNECTED="disconnected",P.FAILED="failed",P.IDLE="idle",P.NEW="new",P.NONE="none"})(hr||(hr={}));var n0=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};function Fv(P,w){return n0(this,void 0,void 0,(function*(){P.validateStatus=U=>U>=200&&U<300||U===403;const R=yield pf()(P);if(R.status===403){if(R.data.code===2003)throw new gc.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",P,R.request,R);return P.url===R.request.responseURL?(P.validateStatus=U=>U>=200&&U<300,pf()(P)):(P.url=R.request.responseURL,w<5?Fv(P,w+1):(P.validateStatus=U=>U>=200&&U<300,pf()(P)))}return R}))}function Jg(P){return n0(this,void 0,void 0,(function*(){return Fv(P,0)}))}function Ah(){}function Zg(P){switch(P){case"new":return hr.NEW;case"closed":return hr.CLOSED;case"disconnected":return hr.DISCONNECTED;case"failed":return hr.FAILED;case"idle":return hr.IDLE;case"checking":case"connecting":return hr.CONNECTING;case"completed":case"connected":return hr.CONNECTED;default:throw new Error(`unknown connecion state: ${P}`)}}function r0(P,w,R){let U=document.createElement(w);const j=()=>{U&&(U.removeEventListener("loadeddata",$),U.removeEventListener("error",j),U.srcObject=null,U.src="",U=null)},$=()=>{j(),R(w)};return U.addEventListener("loadeddata",$),U.addEventListener("error",j),U.srcObject=P,j}class Da{constructor(){this.emitter=new Pi}hasListenersFor(w){return this.emitter.listenerCount(w)>0}on(w,R,U){R.call=(function(j,$){return function(X,...ue){try{$.apply(X,ue)}catch(me){let ce=`Error in callback for ${j}`;const de=$.name;return de&&(ce+=` for function ${de}`),void console.error(`${ce}
`,me)}}})(w,R),this.emitter.on(w,R,U)}off(w,R,U){this.emitter.off(w,R,U)}emit(w,...R){this.emitter.emit(w,...R)}removeAllListeners(){this.emitter.removeAllListeners()}}const i0="https://broadcast.stats.live-video.net/";class yc{constructor({totalEvents:w,totalEventsLost:R,windowedEvents:U,windowedEventsLost:j,currentEndpoint:$}){this.transformProperties=(ue,me,ce,de,Ae)=>({total_events:ue,total_events_lost:me,windowed_events:ce,windowed_events_lost:de,current_endpoint:Ae??i0});const X=this.transformProperties(w,R,U,j,$);this.data={event:Mn.ANALYTICS_HEALTH_REPORT,properties:Object.assign({},X)}}}const Qg={totalEvents:0,totalEventsSent:0,totalEventsLost:0,windowedEvents:0,windowedEventsSent:0,windowedEventsLost:0};var wu,uo;(function(P){P.ANALYTICS_EVENT="ANALYTICS_EVENT"})(wu||(wu={}));class jv extends Da{constructor(){super(),this.eventSenderMetrics=Object.assign({},Qg),this.scheduleHealthReport=()=>{this.reportTimer=window.setTimeout(this.onHealthReportInterval,6e4)},this.onHealthReportInterval=()=>{const w=Object.assign({},this.eventSenderMetrics);if(this.eventSenderMetrics.windowedEvents===0?this.emptyWindows++:this.emptyWindows=0,this.emptyWindows>3)return window.clearTimeout(this.reportTimer),void(this.reportTimer=void 0);this.postHealthReport(w),this.eventSenderMetrics.windowedEvents=0,this.eventSenderMetrics.windowedEventsSent=0,this.eventSenderMetrics.windowedEventsLost=0,this.scheduleHealthReport()},this.emptyWindows=0}trackEventSendResult(w){const{count:R,success:U}=w;this.eventSenderMetrics.totalEvents+=R,this.eventSenderMetrics.windowedEvents+=R,U?(this.eventSenderMetrics.totalEventsSent+=R,this.eventSenderMetrics.windowedEventsSent+=R):(this.eventSenderMetrics.totalEventsLost+=R,this.eventSenderMetrics.windowedEventsLost+=R),this.isHealthReportScheduled()||this.scheduleHealthReport()}isHealthReportScheduled(){return typeof this.reportTimer=="number"}postHealthReport(w){const R=new yc(w);this.emit(wu.ANALYTICS_EVENT,R)}}(function(P){P[P.EXCELLENT=4]="EXCELLENT",P[P.GOOD=3]="GOOD",P[P.NORMAL=2]="NORMAL",P[P.POOR=1]="POOR",P[P.DOWN=0]="DOWN"})(uo||(uo={}));var e_,ll,ks,Jo;(function(P){P.NETWORK_QUALITY_CHANGE="networkQualityChange"})(e_||(e_={}));class zv extends Da{constructor(){super(),this.lastNetworkStatus={},this.networkAssessment={networkQuality:uo.NORMAL,reason:"no-data"},this.checkNetworkStatus=()=>{var w,R;const U=(w=navigator?.connection)!==null&&w!==void 0?w:{},j={downlink:U.downlink,effectiveType:U.effectiveType,rtt:U.rtt,isOnline:(R=navigator.onLine)===null||R===void 0||R};if(!this.isChangedNetworkStatus(this.lastNetworkStatus,j))return;this.lastNetworkStatus=j;const $=this.networkAssessment,X=(function(ue){const{rtt:me,downlink:ce,isOnline:de}=ue;if(!de)return{networkQuality:uo.DOWN,reason:"offline"};if(typeof me!="number"||typeof ce!="number")return{networkQuality:uo.NORMAL,reason:"no-data"};let Ae=0;me>800?Ae+=2:me>300&&(Ae+=1),ce<2.5?Ae+=2:ce<5&&(Ae+=1);const Me="score";switch(Ae){case 4:return{networkQuality:uo.POOR,reason:Me};case 0:return{networkQuality:uo.EXCELLENT,reason:Me};default:return{networkQuality:Ae<=2?uo.GOOD:uo.NORMAL,reason:Me}}})(j);$.networkQuality!==X.networkQuality&&this.emit(e_.NETWORK_QUALITY_CHANGE,$.networkQuality,X.networkQuality),this.networkAssessment=X},this.getNetworkQuality=()=>this.networkAssessment.networkQuality,this.setupWindowListeners(),this.checkNetworkStatus()}setupWindowListeners(){window.addEventListener("online",(()=>{this.checkNetworkStatus()})),window.addEventListener("offline",(()=>{this.checkNetworkStatus()})),window.navigator.connection&&window.navigator.connection.addEventListener("change",(()=>{this.checkNetworkStatus()}))}isChangedNetworkStatus(w,R){const{downlink:U,effectiveType:j,rtt:$,isOnline:X}=R;return w.effectiveType!==j||w.downlink!==U||w.rtt!==$||w.isOnline!==X}}(function(P){P.ANALYTICS_EVENT="ANALYTICS_EVENT",P.REFRESH="REFRESH"})(ll||(ll={})),(function(P){P.IDLE="idle",P.ACTIVATING="activating",P.ACTIVE="active",P.REFRESHING="refreshing",P.PAUSED="paused",P.DESTROYED="destroyed"})(ks||(ks={})),(function(P){P.INITIALIZE="initialize",P.REFRESH="refresh",P.ACTIVATE="activate",P.PAUSE="pause",P.DESTROY="destroy"})(Jo||(Jo={}));const vb={[Jo.INITIALIZE]:{from:[ks.IDLE],to:ks.ACTIVATING},[Jo.REFRESH]:{from:[ks.ACTIVATING,ks.ACTIVE,ks.PAUSED],to:ks.REFRESHING},[Jo.ACTIVATE]:{from:[ks.ACTIVATING,ks.REFRESHING,ks.PAUSED],to:ks.ACTIVE},[Jo.PAUSE]:{from:[ks.REFRESHING,ks.ACTIVE],to:ks.PAUSED},[Jo.DESTROY]:{from:[ks.ACTIVE,ks.PAUSED],to:ks.DESTROYED}};var zl,Oo;(function(P){P.STAGE_CONFIGURATION="stage_configuration",P.STAGE_SUBSCRIBE_CONFIGURATION="stage_subscribe_configuration",P.STAGE_LOCAL_STREAM_CONFIGURATION="stage_local_stream_configuration",P.BROADCAST_CONFIGURATION="broadcast_configuration"})(zl||(zl={})),(function(P){P.RT="real_time",P.LL="low_latency"})(Oo||(Oo={}));var Hs,ul,ba,xn=i(8954);class Vv{constructor(w,R){this.transformProperties=(j,$)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:$});const U=this.transformProperties(w,R);this.data={event:Hs.CONGESTION_TIME,properties:U}}}class s0{constructor(w,R,U){this.transformProperties=($,X,ue)=>({duration:($.getTime()-(X?.getTime()||0))/1e3,ecn_negotiated:!1,ingest_session_id:ue});const j=this.transformProperties(w,R,U);this.data={event:Hs.CONNECTION_ESTABLISHED,properties:j}}}class Bt{constructor(w,R){this.transformProperties=(j,$)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:$});const U=this.transformProperties(w,R);this.data={event:Hs.CONNECTION_RTT,properties:U}}}class en{constructor(w){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_ERROR,properties:w}}}class sn{constructor(w){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_OPS_METRICS,properties:w}}}class Vn{constructor(w){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_ROLLOUT_ASSIGNMENT,properties:w}}}class kr{constructor(w){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_TRACE,properties:w}}}class Si{constructor(w){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_VALUE,properties:w}}}class ho{constructor(w){this.transformProperties=U=>{var j;return{is_fatal:(j=U.isFatal)!==null&&j!==void 0&&j,value:U.value,code:U.code,description:U.description}};const R=this.transformProperties(w);this.data={event:Hs.ERROR,properties:R}}}class Vl{constructor(w,R){this.transformProperties=(j,$)=>({type:j,input_device_id:$.deviceId,position:$.facingMode||"unknown"});const U=this.transformProperties(w,R);this.data={event:Hs.INPUT_DEVICE_ATTACHED,properties:U}}}class Wr{constructor(w,R){this.transformProperties=(j,$)=>({type:j,input_device_id:$.deviceId,position:$.facingMode||"unknown"});const U=this.transformProperties(w,R);this.data={event:Hs.INPUT_DEVICE_DETACHED,properties:U}}}class t_{constructor(w,R){this.transformProperties=(j,$)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:$});const U=this.transformProperties(w,R);this.data={event:Hs.MEASURED_BITRATE,properties:U}}}class yb{constructor(w,R){this.transformProperties=(j,$)=>({minutes_logged:Math.round((j.timestamp-$)/6e4)});const U=this.transformProperties(w,R);this.data={event:Hs.MINUTE_BROADCAST,properties:U}}}class zc{constructor(w,R){this.transformProperties=(j,$)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:$});const U=this.transformProperties(w,R);this.data={event:Hs.RECOMMENDED_BITRATE,properties:U}}}class o0{constructor(w){this.transformProperties=U=>({codec:U.mimeType,bitrate:0,sample_rate:U.clockRate,channel_count:U.channels});const R=this.transformProperties(w);this.data={event:Hs.SESSION_AUDIO_ENCODER_CONFIGURED,properties:R}}}class a0{constructor(w){this.transformProperties=U=>({codec:"audio",bitrate:32e3,sample_rate:U.sampleRate,channel_count:U.channelCount});const R=this.transformProperties(w);this.data={event:Hs.SESSION_AUDIO_PROPERTIES,properties:R}}}class ld{constructor(w,R,U){this.transformProperties=($,X,ue)=>({codec:ue.mimeType,codec_profile:X.profile,codec_level:X.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:$.width,height:$.height,bframe_count:0,target_fps:$.frameRate});const j=this.transformProperties(w,R,U);this.data={event:Hs.SESSION_VIDEO_ENCODER_CONFIGURED,properties:j}}}class ud{constructor(w){this.transformProperties=U=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:U.width,height:U.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:U.frameRate});const R=this.transformProperties(w);this.data={event:Hs.SESSION_VIDEO_PROPERTIES,properties:R}}}class c0{constructor(w,R){this.transformProperties=(j,$)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:$});const U=this.transformProperties(w,R);this.data={event:Hs.SOURCE_AUDIO_LATENCY,properties:U}}}class Yi{constructor(w,R){this.transformProperties=(j,$)=>({sum:j.sum,median:j.median(),min:j.min,max:j.max,p90:j.percentile(.9),event_count:j.data.length,period:$});const U=this.transformProperties(w,R);this.data={event:Hs.SOURCE_VIDEO_LATENCY,properties:U}}}class l0{constructor(w,R){this.transformProperties=({protocol:j,hostname:$,port:X},ue)=>({protocol:j,endpoint_host:$,endpoint_port:X,reason:ue});const U=this.transformProperties(w,R);this.data={event:Hs.START_BROADCAST,properties:U}}}class n_{constructor(w){this.transformProperties=({protocol:U,hostname:j,port:$})=>({protocol:U,endpoint_host:j,endpoint_port:$});const R=this.transformProperties(w);this.data={event:Hs.STOP_BROADCAST,properties:R}}}class u0{constructor(w){this.transformProperties=U=>({bytes_sent:U.bytesSent,header_bytes_sent:U.headerBytesSent,nack_count:U.nackCount,packets_sent:U.packetsSent,retransmitted_bytes_sent:U.retransmittedBytesSent,retransmitted_packets_sent:U.retransmittedPacketsSent});const R=this.transformProperties(w);this.data={event:Hs.WEBRTC_AUDIO_STATS,properties:R}}}class bb{constructor(w){this.transformProperties=U=>({bytes_sent:U.bytesSent,fir_count:U.firCount,frames_encoded:U.framesEncoded,frames_sent:U.framesSent,header_bytes_sent:U.headerBytesSent,huge_frames_sent:U.hugeFramesSent,key_frames_encoded:U.keyFramesEncoded,nack_count:U.nackCount,packets_sent:U.packetsSent,pli_count:U.pliCount,quality_limitation_reason:U.qualityLimitationReason,quality_limitation_resolution_changes:U.qualityLimitationResolutionChanges,retransmitted_bytes_sent:U.retransmittedBytesSent,retransmitted_packets_sent:U.retransmittedPacketsSent,total_encode_time:U.totalEncodeTime,total_encoded_bytes_target:U.totalEncodedBytesTarget,total_packet_send_delay:U.totalPacketSendDelay});const R=this.transformProperties(w);this.data={event:Hs.WEBRTC_VIDEO_STATS,properties:R}}}(function(P){P.START_BROADCAST="ivs_broadcast_start_broadcast",P.STOP_BROADCAST="ivs_broadcast_stop_broadcast",P.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",P.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",P.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",P.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",P.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",P.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",P.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",P.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",P.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",P.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",P.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",P.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",P.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",P.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",P.CONGESTION_TIME="ivs_broadcast_congestion_time",P.BUFFER_DURATION="ivs_broadcast_buffer_duration",P.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",P.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",P.CONNECTION_RTT="ivs_broadcast_connection_rtt",P.ERROR="ivs_broadcast_error"})(Hs||(Hs={})),(function(P){P.USER_INITIATED="user-initiated",P.NETWORK_DISCONNECT="network-disconnect"})(ul||(ul={})),(function(P){P.LOWEST_QUALITY="lowest_quality",P.HIGHEST_QUALITY="highest_quality"})(ba||(ba={}));var hl,Ep,fl,Ms;(function(P){P.HI="hi",P.MID="mid",P.LOW="low"})(hl||(hl={})),(function(P){P.PORTRAIT="portrait",P.LANDSCAPE="landscape"})(Ep||(Ep={})),(function(P){P.VIDEO="video",P.AUDIO="audio"})(fl||(fl={})),(function(P){P.DEFAULT="default",P.LOW="low",P.MEDIUM="medium",P.HIGH="high"})(Ms||(Ms={}));const xp={jitterBuffer:{type:"object",required:!1,config:{schema:{minDelayWhenPublishing:{type:"number",required:!1},minDelayWhenSubscribeOnly:{type:"number",required:!1}}}},inBandMessaging:{type:"object",required:!1,config:{schema:{enabled:{type:"boolean",required:!1}}}},simulcast:{type:"object",required:!1,config:{schema:{initialLayerPreference:{type:"string",required:!1},layerPollingEnabled:{type:"boolean",required:!1},layerPollingIntervalMs:{type:"number",required:!1}}}}};var ji=i(2543);const wp=(function(){if(typeof URLSearchParams<"u"){const R=new URLSearchParams(window.location.search);return{get:U=>R.get(U),has:U=>R.has(U)}}const P=window.location.search.slice(1),w={};return P&&P.split("&").forEach((R=>{const[U,j]=R.split("=");w[decodeURIComponent(U)]=decodeURIComponent(j||"")})),{get:R=>{var U;return(U=w[R])!==null&&U!==void 0?U:null},has:R=>R in w}})();var h0,Tp;const hd=wp.get("ivs_dc_cnf_env")===xn.DeviceConfigEnv.BETA?xn.DeviceConfigEnv.BETA:xn.DeviceConfigEnv.PROD,Tu=xn.DEFAULT_REFRESH_INTERVAL_SECONDS,fd=hd===xn.DeviceConfigEnv.BETA?10:Tu,gf="broadcast-web-v1",Hl=((Tp=(h0=window.location)===null||h0===void 0?void 0:h0.hostname)===null||Tp===void 0?void 0:Tp.indexOf("localhost"))>-1,dl=`amazon_ivs_device_config_v1_${gf}_context`,f0=()=>({[Oo.RT]:{customerIds:[],hosts:[]},[Oo.LL]:{customerIds:[],hosts:[]}});var Sb=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};const Ap=P=>{let w=(0,ji.merge)(f0(),P);const R=(()=>{try{const j=localStorage.getItem(dl);return j===null?xn.err("Key does not exist"):xn.ok(JSON.parse(j))}catch(j){return xn.err(`Error while parsing: ${j}`)}})();if(!R.ok)return w;const U=R.value;return w=Cp(Oo.RT,U[Oo.RT],w),w=Cp(Oo.LL,U[Oo.LL],w),w},d0=(P,w)=>P.hash===w.hash&&P.key===w.key,Cp=(P,w,R)=>{const U=Object.keys(R[P]);for(const j of U)R[P][j]=(0,ji.uniqWith)([...w[j],...R[P][j]],d0);return R},r_=(P,w,R)=>{const U=(0,ji.cloneDeep)(P??{}),j=Object.assign(Object.assign({},U),{cFilter:U.customerId,hFilter:U.host});for(const $ of R[w].customerIds)$.key===P.customerId&&(j.cFilter=$.hash);for(const $ of R[w].hosts)$.key===P.host&&(j.hFilter=$.hash);return j},dd=P=>P?{customer_id:P.customerId,session_id:P.sessionId}:{};var i_;(function(P){P.EXPERIMENT_FOOBAR="experiment_foobar"})(i_||(i_={}));var s_=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class $s extends Da{constructor(w){var R,U;super(),this.onStateChanged=(j,$)=>{this.logger.log(`[onStateChanged] From ${j} to ${$}`)},this.handleRefresh=()=>{this.logger.log("[handleRefresh] Starting refresh trigger");const j=this.fsm.currentState()===ks.ACTIVATING||this.fsm.currentState()===ks.ACTIVE;return j?(this.logger.log("[handleRefresh] Starting refresh"),this.fsm.transition(Jo.REFRESH)):this.logger.log("[handleRefresh] Skipping refresh due to inactive state"),j},this.onMetricsEmitted=j=>{this.fsm.currentState()!==ks.ACTIVATING&&this.fsm.currentState()!==ks.REFRESHING||this.fsm.transition(Jo.ACTIVATE);const $=new sn(Object.assign({},j));this.emit(ll.ANALYTICS_EVENT,$),this.emit(ll.REFRESH)},this.onConfigValue=(j,$)=>{const X=new Si(Object.assign(Object.assign({},j),dd($)));this.emit(ll.ANALYTICS_EVENT,X)},this.onConfigError=(j,$)=>{const X=new en(Object.assign(Object.assign({},j),dd($)));this.emit(ll.ANALYTICS_EVENT,X)},this.onConfigTrace=(j,$)=>{const X=new kr(Object.assign(Object.assign({},j),dd($)));this.emit(ll.ANALYTICS_EVENT,X)},this.onConfigAssignment=(j,$)=>{const X=new Vn(Object.assign(Object.assign({},j),dd($)));this.emit(ll.ANALYTICS_EVENT,X)},this.cacheContextForSource=(j,$)=>s_(this,void 0,void 0,(function*(){const X=yield(ue=>Sb(void 0,void 0,void 0,(function*(){const me={customerIds:[],hosts:[]};if(ue.customerId){const ce=yield(0,xn.hashProperty)(ue.customerId);if(!ce.ok)return xn.err(`customerId: ${ce.error}`);me.customerIds.push(ce.value)}if(ue.host){const ce=yield(0,xn.hashProperty)(ue.host);if(!ce.ok)return xn.err(`host: ${ce.error}`);me.hosts.push(ce.value)}return xn.ok(me)})))($);X.ok?(this.context=Cp(j,X.value,this.context),(ue=>{try{const me=JSON.stringify(ue);return localStorage.setItem(dl,me),xn.ok(void 0)}catch(me){return xn.err(`Error while storing: ${me}`)}})(this.context)):this.logger.error("[cacheContextForSource] ",X.error)})),this.disableConfigRefresh=()=>{this.fsm.transition(Jo.PAUSE)},this.enableConfigRefresh=()=>{this.fsm.transition(Jo.ACTIVATE)},this.logger=(U={name:"GlobalConfigManager"},(0,xn.createLogger)(U)),this.logger.setConfig({enabled:!0,levels:{debug:!1,log:Hl,info:Hl,error:Hl,warn:Hl}}),this.context=Ap(f0()),this.overrides=Object.assign(Object.assign({},{refreshIntervalSeconds:fd}),w),this.fsm=(0,xn.createFsm)({initialState:ks.IDLE,transitions:vb,callbacks:{onStateChanged:this.onStateChanged}}),this.manager=xn.DeviceConfigManager.getInstance(window,{fileKey:(R=ms("fileKey"))!==null&&R!==void 0?R:gf,standardEnv:hd,refresh:{refreshIntervalSeconds:this.overrides.refreshIntervalSeconds,canRefreshNow:this.handleRefresh},fetch:this.overrides.refreshRequestHook,trace:{onTrace:j=>{this.logger.log("[onTrace] ",j)}},emitMetrics:this.onMetricsEmitted,analyticsProperties:{env:hd,client_sdk:"broadcast-web"},enableConsoleLog:Hl}),this.fsm.transition(Jo.INITIALIZE)}get state(){return this.fsm.currentState()}resolveExperimentsForSource(w,R){const U=r_(R,w,this.context),j=this.getResolvedExperiments([i_.EXPERIMENT_FOOBAR],U);this.logger.info("[resolveExperimentContext]",j)}getRemoteStageSubscribeConfiguration(w){const R=r_(w,Oo.RT,this.context);return this.getRemoteConfigurationForProperty(zl.STAGE_SUBSCRIBE_CONFIGURATION,R,xp)}getConfigurationHolder(w){var R;return(R=this.manager)===null||R===void 0?void 0:R.getConfigurationHolder({analytics:{onValue:U=>{this.onConfigValue(U,w)},onError:U=>{this.onConfigError(U,w)},onTrace:U=>{this.onConfigTrace(U,w)},onAssignment:U=>{this.onConfigAssignment(U,w)}}})}getRemoteConfigurationForProperty(w,R,U){const j=this.getConfigurationHolder(R);if(j)return j.getResolvedConfigForPropertyKey({key:w,context:R,schema:U,trace:Hl});this.logger.error("[getRemoteConfigurationForProperty] No config manager is present")}getResolvedExperiments(w,R){const U=this.getConfigurationHolder(R);if(U)return U.getResolvedExperimentForPropertyKeys({keys:w,context:R,trace:Hl});this.logger.error("[getResolvedExperiments] No config manager is present")}}var qr=i(6880),Eb=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};function Ex(P){return Eb(this,void 0,void 0,(function*(){const w=ue=>{let me="";return ue.architecture=="x86"&&ue.bitness=="64"?me="; Win64; x64":ue.architecture=="arm"?me="; ARM":ue.wow64===!0&&(me="; WOW64"),`Windows NT ${(function(ce){const de=new Map([["0.3.0","6.3"],["0.2.0","6.2"],["0.1.0","6.1"]]),Ae=ce??"";return de.has(Ae)?de.get(Ae):"10.0"})(ue.platformVersion)}${me}`},R=navigator.userAgentData;if(!R)return Promise.resolve(void 0);let U,j,$=!1;const X=new RegExp("AppleWebKit/537.36 \\(KHTML, like Gecko\\) (?:SamsungBrowser/[\\d.]+ )?Chrome/[\\d.]+ (Mobile )?Safari/537.36(?: Edg[A]?/[\\d.]+)?");return R.brands.forEach((ue=>{ue.brand=="Chromium"?($=X.test(navigator.userAgent),U=parseFloat(ue.version)):ue.brand=="Samsung Internet"?j={brand:"Samsung Internet",version:ue.version}:ue.brand=="Microsoft Edge"&&(j={brand:"Microsoft Edge",version:ue.version})})),!$||U&&U<100?Promise.resolve(void 0):new Promise((ue=>{R.getHighEntropyValues(P).then((me=>{var ce,de,Ae,Me,rt;let bt={platform:(ce=navigator.userAgentData)===null||ce===void 0?void 0:ce.platform,version:U},ht=Object.assign(bt,me);ht=(et=>(et.architecture||(et.architecture="x86"),et.bitness||(et.bitness="64"),et.model||(et.model=""),et.platform||(et.platform="Windows"),et.platformVersion||(et.platformVersion="10.0"),et.wow64||(et.wow64=!1),et))(ht);let dt="Mozilla/5.0 (";if(["Chrome OS","Chromium OS"].includes((de=ht?.platform)!==null&&de!==void 0?de:"")?dt+=(et=>{let st="";return et.bitness=="64"?et.architecture=="x86"?st="x86_64":et.architecture=="arm"&&(st="aarch64"):et.architecture=="arm"&&et.bitness=="32"&&(st="armv7l"),st==""?`X11; CrOS ${et.platformVersion}`:`X11; CrOS ${st} ${et.platformVersion}`})(ht):ht.platform=="Windows"?dt+=w(ht):ht.platform=="macOS"?dt+=(et=>{var st;let Ot="Macintosh; Intel Mac OS X ",En=(st=et.platformVersion)!==null&&st!==void 0?st:"";return En.indexOf(".")>-1&&(En=En.split(".").join("_")),Ot+=En,Ot})(ht):ht.platform=="Android"?dt+=(et=>{let st="Linux; Android ";return st+=et.platformVersion,et.model&&(st+="; ",st+=et.model),st})(ht):dt+="X11; Linux x86_64",dt+=") AppleWebKit/537.36 (KHTML, like Gecko) Chrome/",dt+=p0((Ae=ht?.fullVersionList)!==null&&Ae!==void 0?Ae:[],bt.version,j),R.mobile&&(dt+=" Mobile"),dt+=" Safari/537.36",j?.brand==="Samsung Internet"){const et=p0((Me=ht?.fullVersionList)!==null&&Me!==void 0?Me:[],void 0,j);dt=dt.replace(" Safari/537.36",` SamsungBrowser/${et} Safari/537.36`)}else if(j?.brand==="Microsoft Edge"){const et=p0((rt=ht?.fullVersionList)!==null&&rt!==void 0?rt:[],void 0,j);dt+=` ${R.mobile?"EdgA":"Edg"}/${et}`}ue(dt)})).catch((()=>{ue(void 0)}))}))}))}function p0(P,w,R){var U,j;return R?((U=P?.find(($=>$.brand===R.brand)))===null||U===void 0?void 0:U.version)||`${R.version}.0.0.0`:((j=P?.find(($=>$.brand=="Google Chrome")))===null||j===void 0?void 0:j.version)||`${w}.0.0.0`}const wn="model",hn="type",Sn="vendor",pd="console",$r="mobile",Cr="tablet",Sa="smarttv",Au="wearable",_f="embedded",Rp="Amazon",md="Apple",m0="ASUS",g0="Google",Hv="Huawei",kp="LG",vf="Microsoft",o_="Motorola",Ue="Samsung",Ch="Sharp",yf="Sony",Wa="Xiaomi",ci="Zebra",$l=(P,w)=>{if(typeof P=="string")return P=P.replace(/^\s\s*/,""),w===void 0?P:P.substring(0,500)},Os=function(P,w){let R,U,j,$,X,ue,me=0;for(;w&&me<w.length&&!X;){const ce=w[me],de=w[me+1];for(R=U=0;R<ce.length&&!X&&ce[R];){const Ae=ce[R++];if(X=typeof Ae.exec=="function"?Ae.exec(P):void 0,X)for(j=0;j<de.length;j++)ue=X[++U],$=de[j],typeof $=="object"&&$.length>0?$.length===2?typeof $[1]=="function"?this[$[0]]=$[1].call(this,ue):this[$[0]]=$[1]:$.length===3?typeof $[1]!="function"||$[1].exec&&$[1].test?this[$[0]]=typeof ue=="string"?ue.replace($[1],$[2]):void 0:this[$[0]]=ue?$[1].call(this,ue,$[2]):void 0:$.length===4&&$[0]!==void 0&&(this[$[0]]=ue?$[3].call(this,ue.replace($[1],$[2])):void 0):this[$]=ue||void 0}me+=2}},Cu={device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[wn,[Sn,Ue],[hn,Cr]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[wn,[Sn,Ue],[hn,$r]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[wn,[Sn,md],[hn,$r]],[/\((ipad);[-\w),; ]+apple/i,/applecoremedia\/[\w.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[wn,[Sn,md],[hn,Cr]],[/(macintosh);/i],[wn,[Sn,md]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[wn,[Sn,Ch],[hn,$r]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[wn,[Sn,Hv],[hn,Cr]],[/(?:huawei|honor)([-\w ]+)[;)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[wn,[Sn,Hv],[hn,$r]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[wn,/_/g," "],[Sn,Wa],[hn,$r]],[/oid[^)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[wn,/_/g," "],[Sn,Wa],[hn,Cr]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[wn,[Sn,"OPPO"],[hn,$r]],[/\b(opd2\d{3}a?) bui/i],[wn,[Sn,"OPPO"],[hn,Cr]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at]?)(?: bui|;|\))/i],[wn,[Sn,"Vivo"],[hn,$r]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[wn,[Sn,"Realme"],[hn,$r]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w() ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[wn,[Sn,o_],[hn,$r]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[wn,[Sn,o_],[hn,Cr]],[/((?=lg)?[vl]k-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[wn,[Sn,kp],[hn,Cr]],[/(lm(?:-?f100[nv]?|-[\w.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[wn,[Sn,kp],[hn,$r]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[wn,[Sn,"Lenovo"],[hn,Cr]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w.]*)/i],[[wn,/_/g," "],[Sn,"Nokia"],[hn,$r]],[/(pixel c)\b/i],[wn,[Sn,g0],[hn,Cr]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[wn,[Sn,g0],[hn,$r]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[wn,[Sn,yf],[hn,$r]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[wn,"Xperia Tablet"],[Sn,yf],[hn,Cr]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[wn,[Sn,"OnePlus"],[hn,$r]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[wn,[Sn,Rp],[hn,Cr]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[wn,/(.+)/g,"Fire Phone $1"],[Sn,Rp],[hn,$r]],[/(playbook);[-\w),; ]+(rim)/i],[wn,Sn,[hn,Cr]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[wn,[Sn,"BlackBerry"],[hn,$r]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[wn,[Sn,m0],[hn,Cr]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[wn,[Sn,m0],[hn,$r]],[/(nexus 9)/i],[wn,[Sn,"HTC"],[hn,Cr]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[Sn,[wn,/_/g," "],[hn,$r]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[wn,[Sn,"Acer"],[hn,Cr]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[wn,[Sn,"Meizu"],[hn,$r]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[wn,[Sn,"Ulefone"],[hn,$r]],[/(blackberry|benq|palm(?=-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[Sn,wn,[hn,$r]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[Sn,wn,[hn,Cr]],[/(surface duo)/i],[wn,[Sn,vf],[hn,Cr]],[/droid [\d.]+; (fp\du?)(?: b|\))/i],[wn,[Sn,"Fairphone"],[hn,$r]],[/(u304aa)/i],[wn,[Sn,"AT&T"],[hn,$r]],[/\bsie-(\w*)/i],[wn,[Sn,"Siemens"],[hn,$r]],[/\b(rct\w+) b/i],[wn,[Sn,"RCA"],[hn,Cr]],[/\b(venue[\d ]{2,7}) b/i],[wn,[Sn,"Dell"],[hn,Cr]],[/\b(q(?:mv|ta)\w+) b/i],[wn,[Sn,"Verizon"],[hn,Cr]],[/\b(?:barnes[& ]+noble |bn[rt])([\w+ ]*) b/i],[wn,[Sn,"Barnes & Noble"],[hn,Cr]],[/\b(tm\d{3}\w+) b/i],[wn,[Sn,"NuVision"],[hn,Cr]],[/\b(k88) b/i],[wn,[Sn,"ZTE"],[hn,Cr]],[/\b(nx\d{3}j) b/i],[wn,[Sn,"ZTE"],[hn,$r]],[/\b(gen\d{3}) b.+49h/i],[wn,[Sn,"Swiss"],[hn,$r]],[/\b(zur\d{3}) b/i],[wn,[Sn,"Swiss"],[hn,Cr]],[/\b((zeki)?tb.*\b) b/i],[wn,[Sn,"Zeki"],[hn,Cr]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[Sn,"Dragon Touch"],wn,[hn,Cr]],[/\b(ns-?\w{0,9}) b/i],[wn,[Sn,"Insignia"],[hn,Cr]],[/\b((nxa|next)-?\w{0,9}) b/i],[wn,[Sn,"NextBook"],[hn,Cr]],[/\b(xtreme_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[Sn,"Voice"],wn,[hn,$r]],[/\b(lvtel-)?(v1[12]) b/i],[[Sn,"LvTel"],wn,[hn,$r]],[/\b(ph-1) /i],[wn,[Sn,"Essential"],[hn,$r]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[wn,[Sn,"Envizen"],[hn,Cr]],[/\b(trio[-\w. ]+) b/i],[wn,[Sn,"MachSpeed"],[hn,Cr]],[/\btu_(1491) b/i],[wn,[Sn,"Rotor"],[hn,Cr]],[/(shield[\w ]+) b/i],[wn,[Sn,"Nvidia"],[hn,Cr]],[/(sprint) (\w+)/i],[Sn,wn,[hn,$r]],[/(kin\.[onetw]{3})/i],[[wn,/\./g," "],[Sn,vf],[hn,$r]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[wn,[Sn,ci],[hn,Cr]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[wn,[Sn,ci],[hn,$r]],[/smart-tv.+(samsung)/i],[Sn,[hn,Sa]],[/hbbtv.+maple;(\d+)/i],[[wn,/^/,"SmartTV"],[Sn,Ue],[hn,Sa]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[Sn,kp],[hn,Sa]],[/(apple) ?tv/i],[Sn,[wn,md+" TV"],[hn,Sa]],[/crkey/i],[[wn,"Chromecast"],[Sn,g0],[hn,Sa]],[/droid.+aft(\w+)( bui|\))/i],[wn,[Sn,Rp],[hn,Sa]],[/\(dtv[);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[wn,[Sn,Ch],[hn,Sa]],[/(bravia[\w ]+)( bui|\))/i],[wn,[Sn,yf],[hn,Sa]],[/(mitv-\w{5}) bui/i],[wn,[Sn,Wa],[hn,Sa]],[/Hbbtv.*(technisat) (.*);/i],[Sn,wn,[hn,Sa]],[/\b(roku)[\dx]*[)/]((?:dvp-)?[\d.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w+ ]*; *([\w\d][^;]*);([^;]*)/i],[[Sn,$l],[wn,$l],[hn,Sa]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[hn,Sa]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[Sn,wn,[hn,pd]],[/droid.+; (shield) bui/i],[wn,[Sn,"Nvidia"],[hn,pd]],[/(playstation [345portablevi]+)/i],[wn,[Sn,yf],[hn,pd]],[/\b(xbox(?: one)?(?!; xbox))[); ]/i],[wn,[Sn,vf],[hn,pd]],[/((pebble))app/i],[Sn,wn,[hn,Au]],[/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i],[wn,[Sn,md],[hn,Au]],[/droid.+; (glass) \d/i],[wn,[Sn,g0],[hn,Au]],[/droid.+; (wt63?0{2,3})\)/i],[wn,[Sn,ci],[hn,Au]],[/(quest( \d| pro)?)/i],[wn,[Sn,"Facebook"],[hn,Au]],[/(tesla)(?: qtcarbrowser|\/[-\w.]+)/i],[Sn,[hn,_f]],[/(aeobc)\b/i],[wn,[Sn,Rp],[hn,_f]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[wn,[hn,$r]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[wn,[hn,Cr]],[/\b((tablet|tab)[;/]|focus\/\d(?!.+mobile))/i],[[hn,Cr]],[/(phone|mobile(?:[;/]| [ \w/.]*safari)|pda(?=.+windows ce))/i],[[hn,$r]],[/(android[-\w. ]{0,9});.+buil/i],[wn,[Sn,"Generic"]]]};var fo=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};function Vc(P){const{globalSessionId:w,userAgent:R}=P,U=R??navigator.userAgent,j=qr.getParser(U),$=(function(ue){const me=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(ue)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(ue)||/^(\d+)$/.exec(ue)||[];return{major:parseInt(me[1],10)||0,minor:parseInt(me[2],10)||0,patch:parseInt(me[3],10)||0}})(String(j.getBrowserVersion())),X=(ue=>{var me;const ce={};return ce[Sn]=void 0,ce[wn]=void 0,ce[hn]=void 0,Os.call(ce,(me=ue??navigator.userAgent)!==null&&me!==void 0?me:"",Cu.device),ce})(U);return{browser:navigator.appVersion,browser_family:j.getBrowserName().toLowerCase(),browser_version:`${$.major}.${$.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:j.getOSName(),os_version:String(j.getOSVersion()),platform:"web",global_session_id:w,sdk_version:"1.31.1",user_agent:U,is_backgrounded:document?.visibilityState==="hidden",device_model:X.model,device_manufacturer:X.vendor,device_os_version:String(j.getOSVersion()),device_software:U}}function Ru(P){return fo(this,void 0,void 0,(function*(){const w=yield(function(R=["architecture","bitness","model","platformVersion","fullVersionList"]){return Eb(this,void 0,void 0,(function*(){try{const U=yield Ex(R);return U??navigator.userAgent}catch{return navigator.userAgent}}))})();return Vc(Object.assign(Object.assign({},P),{userAgent:w}))}))}var bf=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class Rh{constructor(){this.globalSessionId=Bv(),this.currentGlobalEndpoint=i0,this.signalInternalUsage=()=>{this.usageReferences>0?this.configManager.enableConfigRefresh():this.configManager.disableConfigRefresh()},this.markSdkUsage=()=>{this.usageReferences++,this.signalInternalUsage()},this.removeSdkUsage=()=>{this.usageReferences=Math.max(0,this.usageReferences-1),this.signalInternalUsage()},this.usageReferences=0,this.healthReporter=new jv,this.networkMonitor=new zv,this.configManager=new $s,this.healthReporter.on(wu.ANALYTICS_EVENT,(w=>{this.trackGlobalEvent(w)})),this.configManager.on(ll.ANALYTICS_EVENT,(w=>{this.trackGlobalEvent(w)})),this.configManager.on(ll.REFRESH,(()=>{this.signalInternalUsage()})),this.globalProperties=Vc({globalSessionId:this.globalSessionId}),Ru({globalSessionId:this.globalSessionId}).then((w=>{this.globalProperties=Object.assign(Object.assign({},this.globalProperties),w)})).catch(Ah)}updateGlobalProperties(){this.globalProperties=Object.assign(Object.assign({},this.globalProperties),{is_backgrounded:document?.visibilityState==="hidden"})}trackGlobalEvent(w){const R=this.getGlobalProperties();w.data.properties=Object.assign(Object.assign(Object.assign({},R),w.data.properties),{client_time:new Date().toISOString(),current_endpoint:this.currentEndpoint});const{headers:U,body:j}=t0([w.data]);Xg((()=>bf(this,void 0,void 0,(function*(){yield Sp("POST",this.currentEndpoint,U,j)}))))}enrichContext(w){var R,U;return Object.assign({appLabel:(R=Yg())!==null&&R!==void 0?R:"default",customerId:this.globalProperties.customer_id,host:this.globalProperties.host,browserFamily:this.globalProperties.browser_family,browserVersion:this.globalProperties.browser_version,osName:this.globalProperties.os_name,osVersion:this.globalProperties.os_version,userAgent:this.globalProperties.user_agent,sdkVersion:this.globalProperties.sdk_version,sessionId:(U=w.sessionId)!==null&&U!==void 0?U:""},w)}getGlobalSessionId(){return this.globalSessionId}getGlobalProperties(){return this.updateGlobalProperties(),this.globalProperties}set currentEndpoint(w){this.currentGlobalEndpoint=w}get currentEndpoint(){var w;return!((w=window.IVS_CLIENT_OVERRIDES)===null||w===void 0)&&w.analyticsPostUrl?window.IVS_CLIENT_OVERRIDES.analyticsPostUrl:this.currentGlobalEndpoint}trackEvent(w){w.type==="eventSenderResult"&&this.healthReporter.trackEventSendResult(w)}getNetworkQuality(){return this.networkMonitor.getNetworkQuality()}cacheRealTimeContext(w){const R=this.enrichContext(w);this.configManager.cacheContextForSource(Oo.RT,R).catch(Ah)}cacheLowLatencyContext(w){const R=this.enrichContext(w);this.configManager.cacheContextForSource(Oo.LL,R).catch(Ah)}resolveExperimentsForRealTimeContext(w){const R=this.enrichContext(w);this.configManager.resolveExperimentsForSource(Oo.RT,R)}getRemoteSubscribeConfig(w){const R=this.enrichContext(w);return this.configManager.getRemoteStageSubscribeConfiguration(R)}}window.IVS_CLIENT_GLOBAL_STATE||(window.IVS_CLIENT_GLOBAL_STATE={}),window.IVS_CLIENT_GLOBAL_STATE.session||(window.IVS_CLIENT_GLOBAL_STATE.session=new Rh);const Io=window.IVS_CLIENT_GLOBAL_STATE.session;function Mp(P){if(!P)throw new Error("eventSender is not defined")}class La{constructor(){this.sharedProperties={},this.eventSender={},this.queuedEvents=[],this.genSessionId();const w=Yg();this.eventSender=new bs,this.initSharedProperties({appLabel:w}),this.errorReports=new Map}start(){this.flushInterval||(this.flushInterval=window.setInterval((()=>{this.queueAggregateErrors({force:!1}),this.flushEvents()}),1e3))}stop(w){let R=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,this.queueAggregateErrors({force:!0}),w&&(this.queuedEvents=this.queuedEvents.filter((U=>U.critical)),R=!0),this.flushEvents(R),this.genSessionId()}trackEvent(w,R=!1){let U=this.sharedProperties;R&&(U={global_session_id:this.sharedProperties.global_session_id,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version,is_backgrounded:this.sharedProperties.is_backgrounded}),document?.visibilityState==="hidden"&&(U.is_backgrounded=!0),"data"in w?(w.data.properties=Object.assign({},U,w.data.properties),this.queuedEvents.push(w.data)):(w.properties=Object.assign({},U,w.properties),this.queuedEvents.push(w))}trackEventNoSharedProps(w){this.trackEvent(w,!0)}trackErrorAndThrow(w){throw this.trackError(w),w}trackError(w){const R=`${w.code}${w.fatal}${w.nominal}${w.tag}${w.traceId.value}`,U=this.errorReports.get(R),j={error:w,queuedAt:Date.now(),count:0};return U?(U.count===0&&(U.error=w),U.count+=1,U.queuedAt+6e4<=Date.now()?(this.trackErrorReportIfNeeded(U),void this.errorReports.set(R,j)):void 0):(this.errorReports.set(R,j),void this.trackEvent(new ps(w)))}queueAggregateErrors({force:w=!1}){this.errorReports.forEach(((R,U)=>{const j=R.queuedAt+6e4;!w&&j>Date.now()||(this.trackErrorReportIfNeeded(R),this.errorReports.delete(U))}))}trackErrorReportIfNeeded(w){if(w.count===0)return;const R=w.error;R.count=w.count,this.trackEvent(new ps(R))}batchEvents(w){Mp(this.eventSender);const R=w.map((U=>(U.data.properties=Object.assign({},this.sharedProperties,U.data.properties),U.data)));this.eventSender.send(R)}initSharedProperties({appLabel:w}){const R=Io.getGlobalProperties();this.sharedProperties=Object.assign(Object.assign({},R),{session_id:this.sessionId}),w&&(this.sharedProperties.app_label=w)}genSessionId(){this.sessionId=Bv(),this.sharedProperties.session_id=this.sessionId}flushEvents(w=!1){Mp(this.eventSender),this.queuedEvents.length>0&&this.eventSender.send(this.queuedEvents,w),this.queuedEvents=[]}getSessionId(){return this.sessionId}}const _0={[W.INFO]:"#528bff",[W.WARN]:"#ffb31a",[W.DEBUG]:"#00f593",[W.ERROR]:"#ff4f4d",[W.TRACE]:"",[W.SILENT]:"",[oe.TIME]:"#53535f",[oe.WEBRTC]:"#0e9bd8",[oe.SUBSCRIPTION]:"#ffc400",[oe.CONNECTION]:"#ff5edb",[oe.SOCKET]:"#8585ff",[oe.EMITTER]:"#adadb8",[oe.LOCAL_PARTICIPANT]:"#1DD21D",[oe.STAGE]:"#EC9806",[oe.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},kh=({label:P})=>`background: ${_0[P]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,Op=Object.entries(W),Zo=(P,w,R)=>{const U=kh({label:P}),[j]=Op.find((([,bt])=>bt===Number(P)))||[],$=`%c${j}`,X=kh({label:w}),ue=`%c${w}`,me=kh({label:oe.TIME}),ce=`%c[${new Date().toISOString()}]`,de=kh({label:"details"}),Ae=`%c[${R}]`,Me=[ce,$,ue],rt=[me,U,X];return R&&(Me.push(Ae),rt.push(de)),[Me.join(""),...rt]},a_={debug(P){console.groupCollapsed(...Zo(W.DEBUG,P.scope,P.label)),console.debug(P.msg,Object.assign(Object.assign({},P),{level:"debug"})),console.groupEnd()},info(P){console.groupCollapsed(...Zo(W.INFO,P.scope,P.label)),console.info(P.msg,Object.assign(Object.assign({},P),{level:"info"})),console.groupEnd()},warn(P){console.groupCollapsed(...Zo(W.WARN,P.scope,P.label)),console.warn(P.msg,Object.assign(Object.assign({},P),{level:"warn"})),console.groupEnd()},error(P){console.groupCollapsed(...Zo(W.ERROR,P.scope,P.label)),console.error(P),console.groupEnd()}};var Mh=function(P,w){var R={};for(var U in P)Object.prototype.hasOwnProperty.call(P,U)&&w.indexOf(U)<0&&(R[U]=P[U]);if(P!=null&&typeof Object.getOwnPropertySymbols=="function"){var j=0;for(U=Object.getOwnPropertySymbols(P);j<U.length;j++)w.indexOf(U[j])<0&&Object.prototype.propertyIsEnumerable.call(P,U[j])&&(R[U[j]]=P[U[j]])}return R};Object.entries(W);class Qo{constructor(w=Lr,R=a_){this.logLevel=w,this.loggerInstance=R}debug(w){var R,U;this.logLevel>W.DEBUG||(U=(R=this.loggerInstance).debug)===null||U===void 0||U.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{level:"debug"}))))}info(w){var R,U;this.logLevel>W.INFO||(U=(R=this.loggerInstance).info)===null||U===void 0||U.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{level:"info"}))))}warn(w){var R,U;this.logLevel>W.WARN||(U=(R=this.loggerInstance).warn)===null||U===void 0||U.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{level:"warn"}))))}error(w){var R,U,{err:j}=w,$=Mh(w,["err"]);this.logLevel>W.ERROR||(U=(R=this.loggerInstance).error)===null||U===void 0||U.call(R,Object.assign({err:j},$))}}class qa{constructor(w,R){this.logger=w,this.scope=R}debug(w){var R,U;(U=(R=this.logger).debug)===null||U===void 0||U.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{scope:this.scope}))))}info(w){var R,U;(U=(R=this.logger).info)===null||U===void 0||U.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{scope:this.scope}))))}warn(w){var R,U;(U=(R=this.logger).warn)===null||U===void 0||U.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},w),{scope:this.scope}))))}error(w){var R,U,{err:j}=w,$=Mh(w,["err"]);(U=(R=this.logger).error)===null||U===void 0||U.call(R,Object.assign(Object.assign({err:j},$),{scope:this.scope}))}unwrap(){return this.logger}}class ku{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(w){(this.min===0||w<this.min)&&(this.min=w),w>=this.max&&(this.max=w),this.data.push(w),this.sum+=w}median(){this.data.sort();const w=this.data.length>>1;return this.data.length%2==0?this.data[w-1]+this.data[w]>>1:this.data[w]}percentile(w){if(this.data.length===0)return 0;if(w<=0)return this.data[0];if(w>=1)return this.data[this.data.length-1];const R=(this.data.length-1)*w,U=Math.floor(R),j=U+1,$=R%1;return j>=this.data.length?this.data[U]:this.data[U]*(1-$)+this.data[j]*$}}var gd=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class Mu{constructor(w,R,U,j){this.peerClient=w,this.broadcastCanvasManager=R,this.analyticsTracker=j,this.logger=new qa(U,oe.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval((()=>{this.collectSamples()}),1e3),this.trackSamplesTimerId=window.setInterval((()=>{this.trackSamples()}),3e4),this.trackPeerConnectionStatsTimerId=window.setInterval((()=>{this.trackPeerConnectionStats()}),6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return gd(this,void 0,void 0,(function*(){(yield this.peerClient.getReports()).forEach((w=>{if(w.type==="outbound-rtp")switch(w.kind){case"audio":this.analyticsTracker.trackEvent(new u0(w));break;case"video":{const R=new bb(w),U=new yb(w,this.startTimestamp);this.analyticsTracker.batchEvents([R,U]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:w.kind})}}))}))}collectSamples(){return gd(this,void 0,void 0,(function*(){let w=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach((U=>{switch(U.type){case"candidate-pair":U.nominated&&(this.rttSamples.push(U.currentRoundTripTime),this.recommendedBitrateSamples.push(U.availableOutgoingBitrate));break;case"outbound-rtp":w+=U.bytesSent||0,this.startTimestamp===0&&U.kind==="video"&&(this.startTimestamp=U.timestamp)}}));const R=8*Math.round(w-this.previousBytesSent);this.previousBytesSent=w,this.measuredBitrateSamples.push(R)}))}trackSamples(){const R=new c0(this.audioLatencySamples,30),U=new Yi(this.videoLatencySamples,30),j=new Vv(this.congestionTimeSamples,30),$=new t_(this.measuredBitrateSamples,30),X=new zc(this.recommendedBitrateSamples,30),ue=new Bt(this.rttSamples,30);this.analyticsTracker.batchEvents([R,U,j,$,X,ue]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new ku,this.videoLatencySamples=new ku,this.congestionTimeSamples=new ku,this.measuredBitrateSamples=new ku,this.recommendedBitrateSamples=new ku,this.rttSamples=new ku}}const v0=P=>{const w=$=>{var X;return!((X=$.deviceId)===null||X===void 0)&&X.startsWith("web-contents-media-stream")?"tab":void 0},R=$=>{var X;return!((X=$.deviceId)===null||X===void 0)&&X.startsWith("window")&&$.displaySurface==="window"?"window":void 0},U=$=>{var X;return!((X=$.deviceId)===null||X===void 0)&&X.startsWith("screen")&&$.displaySurface==="monitor"?"screen":void 0};return(w(j=P)||R(j)||U(j)?void 0:"camera")||U(P)||R(P)||w(P)||"unknown";var j};function y0(P,w){return P.find((R=>R.kind===w))}function _d(P){return P?.readyState==="live"}var wr;(function(P){P.VIDEO="video",P.AUDIO="audio"})(wr||(wr={}));class Ki{constructor(){this.mediaTracks=new Map([[wr.VIDEO,void 0],[wr.AUDIO,void 0]])}setTrack(w,R){this.mediaTracks.set(w,R)}getTrack(w){return this.mediaTracks.get(w)}}class c_{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(w){return w?(w.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map((R=>R.trim())).filter(Boolean).forEach((R=>{const U=R.split("=");if(U.length===2)switch(U[0]){case"level-asymmetry-allowed":U[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":U[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(U[1]),this.level=this.getLevelFromId(U[1])}})),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(w){const R=w.substr(0,2),U=w.substr(2,2);switch(R.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return U==="00"?"high 10":"high 10 intra";case"7a":return U==="00"?"high 42":"high 42 intra";case"f4":return U==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(w){return parseInt(w.substr(4,2),16)}}function Ya(P){return btoa(JSON.stringify(P))}var Is,Ip=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};(function(P){P.IDLE="idle",P.EXECUTING="executing",P.RECONNECTING="reconnecting"})(Is||(Is={}));class b0{constructor(w,R=12e4,U,j){this.state=Is.IDLE,this.failureCallback=()=>{},this.peerClient=w,this.timeout=R,this.logger=U,this.emitter=j}onFailure(w){this.failureCallback=w}setStartConfig(w,R){this.ingestEndpoint=w,this.streamKey=R}execute(){const{id:w}=this;this.state===Is.IDLE&&(this.state=Is.EXECUTING,this.emitter.emit(_c.CONNECTION_STATE_CHANGE,hr.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:w}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(w){this.timeoutTimerId=window.setTimeout((()=>{this.state!==Is.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(_c.CONNECTION_STATE_CHANGE,hr.FAILED),this.failureCallback())}),w)}stop(){this.state=Is.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return Ip(this,void 0,void 0,(function*(){if(this.ingestEndpoint&&this.streamKey){const w=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),w===hr.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(R){throw this.logger.error({err:R}),R}}}))}isActive(){return this.state!==Is.IDLE}}class bc extends b0{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let w=5e3;const R=()=>Ip(this,void 0,void 0,(function*(){if(this.state===Is.EXECUTING)try{this.state=Is.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:w}),this.state=Is.EXECUTING,this.currentTimeoutId=window.setTimeout(R,w),w*=2}}));this.currentTimeoutId=window.setTimeout(R,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class $v extends b0{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>Ip(this,void 0,void 0,(function*(){if(navigator.onLine&&this.state===Is.EXECUTING){this.state=Is.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=Is.EXECUTING}}}))}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class Ea{static create(w,R=Rs,U,j){const{reconnect:$,timeout:X}=R;if($){const ue=qr.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(ue)&&navigator.connection?new $v(w,X,U,j):new bc(w,X,U,j)}}}var Ou,Np=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))},xb=function(P,w,R,U){if(typeof w=="function"?P!==w||!U:!w.has(P))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?U:R==="a"?U.call(P):U?U.value:w.get(P)};const l_=P=>!!P;function Oh(P){if(!P)throw new Error("PeerConnection is not defined")}const S0={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class vd{constructor(w,R,U,j,$){this.config=w,this.emitter=R,this.mediaStreamManager=U,this.analyticsTracker=$,this.establishConnection=(X,ue)=>Np(this,void 0,void 0,(function*(){var me,ce,de;Oh(this.peerConnection);try{const Ae=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(Ae),yield this.sendSetupRequest(X,ue,Ae)}catch(Ae){if(Ae instanceof Error){(me=(de=Ae).code)!==null&&me!==void 0||(de.code=Tn.code);const Me=new ye(Object.assign(Object.assign({},Tn),{name:Ae.name,message:Ae.message,code:Ae?.code,cause:Ae}));throw!((ce=this.reconnectStrategy)===null||ce===void 0)&&ce.isActive()||this.handleError(Ae.code,Ae.message),this.stop(),Me}}})),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var X;if(!this.peerConnection)return hr.NONE;const ue=(X=this.reconnectStrategy)===null||X===void 0?void 0:X.isActive(),me=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(me){case"new":return hr.NEW;case"closed":return hr.CLOSED;case"disconnected":return ue?hr.CONNECTING:hr.DISCONNECTED;case"failed":return ue?hr.CONNECTING:hr.FAILED;case"idle":return hr.IDLE;case"checking":case"connecting":return hr.CONNECTING;case"completed":case"connected":return hr.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:me}),hr.IDLE}},this.onConnectionStateChange=()=>{var X;const ue=this.getConnectionState();switch(ue){case hr.CONNECTED:{this.emitter.emit(_c.CONNECTION_STATE_CHANGE,ue);const me=new Date;this.analyticsTracker.trackEvent(new s0(me,this.connectionStartDate,this.ingestSessionId));const ce=this.mediaStreamManager.getTrack(wr.AUDIO),de=this.mediaStreamManager.getTrack(wr.VIDEO);if(de){const Ae=de.getSettings();this.analyticsTracker.trackEvent(new ud(Ae))}if(ce){const Ae=ce.getSettings();this.analyticsTracker.trackEvent(new a0(Ae))}(((X=this.peerConnection)===null||X===void 0?void 0:X.getSenders())||[]).forEach((Ae=>{var Me;(((Me=Ae.getParameters())===null||Me===void 0?void 0:Me.codecs)||[]).forEach((rt=>{var bt;switch((bt=Ae.track)===null||bt===void 0?void 0:bt.kind){case"video":{if(!de)break;const ht=new c_().extractVideoSdpFmtpLine(rt.sdpFmtpLine),dt=de.getSettings();this.analyticsTracker.trackEvent(new ld(dt,ht,rt));break}case"audio":if(!ce)break;this.analyticsTracker.trackEvent(new o0(rt))}}))}));break}case hr.CONNECTING:this.emitter.emit(_c.CONNECTION_STATE_CHANGE,ue),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case hr.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(_c.CONNECTION_STATE_CHANGE,ue),this.handleTerminalConnectionFailure());break;case hr.DISCONNECTED:this.emitter.emit(_c.CONNECTION_STATE_CHANGE,ue),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(_c.CONNECTION_STATE_CHANGE,ue)}},this.handleLocalDescription=X=>Np(this,void 0,void 0,(function*(){var ue;return(ue=this.peerConnection)===null||ue===void 0?void 0:ue.setLocalDescription(X)})),Ou.set(this,(X=>{if(typeof X!="string")throw new ye(ns);try{new URL(X)}catch{throw new ye(hi)}})),this.logger=new qa(j,oe.WEBRTC),this.createReconnectStrategy(w)}start(w,R){var U;return Np(this,void 0,void 0,(function*(){xb(this,Ou,"f").call(this,w);const j=[this.mediaStreamManager.getTrack(wr.VIDEO),this.mediaStreamManager.getTrack(wr.AUDIO)].filter(l_);if(this.createPeerConnection(),this.addTracks({tracks:j}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(w,R),yield this.establishConnection(w,R),!((U=this.reconnectStrategy)===null||U===void 0)&&U.isActive()){const $=new URL(w);this.analyticsTracker.trackEvent(new l0({protocol:"webrtc",hostname:$.hostname,port:$.port},ul.NETWORK_DISCONNECT))}}))}stop(){var w,R,U,j;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[hr.NEW,hr.CONNECTING,hr.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(_c.CONNECTION_STATE_CHANGE,hr.CLOSED),(w=this.peerConnection)===null||w===void 0||w.close(),(R=this.peerConnection)===null||R===void 0||R.removeEventListener("connectionstatechange",this.onConnectionStateChange),(U=this.peerConnection)===null||U===void 0||U.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(j=this.reconnectStrategy)===null||j===void 0||j.stop()}addTracks(w){var R;if(Oh(this.peerConnection),!w)return;const U=this.peerConnection.getSenders().map(($=>{var X;return(X=$.track)===null||X===void 0?void 0:X.id})),j=w.tracks.filter(($=>!U.includes($.id)));for(const $ of j)(R=this.peerConnection)===null||R===void 0||R.addTrack($)}getReports(){var w;return Np(this,void 0,void 0,(function*(){try{const R=(yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats())||[],U=[];return R.forEach((j=>{U.push(j)})),U}catch{return[]}}))}sendSetupRequest(w,R,U){var j;return Np(this,void 0,void 0,(function*(){const $=yield fetch(`${w}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:Ya(U),streamKey:R},this.config.streamConfig))});if(!$.ok)throw(function(ue){let me=new ye(Object.assign({},Tn));return ue?.code===1007&&(me=new ye(Object.assign({},An))),ue?.message&&(me.message=ue.message),me})(yield $.json());const X=yield $.json();X?.answer&&(yield(j=this.peerConnection)===null||j===void 0?void 0:j.setRemoteDescription((function(ue){return JSON.parse(atob(ue))})(X.answer)),this.ingestSessionId=X.ingestSessionId)}))}handleTerminalConnectionFailure(){const w=new ye(qt);this.handleError(w.code,w.message)}handleError(w,R){this.analyticsTracker.trackEvent(new ho({code:w,description:R,isFatal:!0})),this.emitter.emit(_c.ERROR,{code:w,message:R})}createPeerConnection(){var w;const R=this.getConnectionState(),U=R!==hr.NONE,j=R!==hr.CLOSED,$=(w=this.reconnectStrategy)===null||w===void 0?void 0:w.isActive();U&&j&&!$||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval((()=>{const X=this.getConnectionState();if(this.reconnectStrategy&&X===hr.DISCONNECTED&&this.disconnectionStartDate){const ue=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:ue}),ue>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else X===hr.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)}),1e3),this.peerConnection=new RTCPeerConnection(S0),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(w){if(this.reconnectStrategy=Ea.create(this,w.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const R=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:R})}}}Ou=new WeakMap;var Sf,Gv,wb=i(5364);(function(P){P.CONFIG="config",P.UPDATE="update",P.START="start",P.STOP="stop"})(Sf||(Sf={})),(function(P){P.VIDEO_SEND="video/send",P.VIDEO_RECEIVE="video/receive",P.INSERT_SEI="insertSei"})(Gv||(Gv={}));var u_=i(5512),Wv=i.n(u_);function Ef(){return Wv()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var i,t;!function(i){i.CONFIG="config",i.UPDATE="update",i.START="start",i.STOP="stop"}(i||(i={})),function(i){i.VIDEO_SEND="video/send",i.VIDEO_RECEIVE="video/receive",i.INSERT_SEI="insertSei"}(t||(t={}));const s=self;const n=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(i){this.config=Object.assign(Object.assign({},this.config),i),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{s.postMessage({type:i.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};s.addEventListener("message",(function(t){var s;if(null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.type)switch(t.data.type){case i.CONFIG:n.setConfig(t.data.payload||{});break;case i.START:n.start();break;case i.STOP:n.stop()}}))})();`,"Worker",void 0,void 0)}var Ih=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class qv{constructor(w,R,U){this.config=w,this.mediaStreamManager=R,this.analyticsTracker=U,this.handleWorkerEvent=ue=>{var me;((me=ue.data)===null||me===void 0?void 0:me.type)===Sf.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new Ef,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const j=this.compositeEl.getContext("2d");if(j===null)throw new ye(Object.assign({},Ke));this.compositeContext=j,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const $=y0(this.compositeStream.getTracks(),wr.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const X=y0(this.audioDestination.stream.getTracks(),wr.AUDIO);$&&this.mediaStreamManager.setTrack(wr.VIDEO,$),X&&this.mediaStreamManager.setTrack(wr.AUDIO,X),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:Sf.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(w){this.previewElement=w;const{width:R,height:U}=this.config.streamConfig.maxResolution;this.previewElement.width=R,this.previewElement.height=U,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const w=this.audioContext.createConstantSource(),R=this.audioContext.createGain();R.gain.value=.001,w.connect(R),R.connect(this.audioDestination),w.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const w=document.body,R=["touchstart","touchend","mousedown","keydown"],U=()=>{R.forEach(($=>{w.removeEventListener($,j)}))},j=()=>{this.audioContext.resume().then(U)};R.forEach(($=>{w.addEventListener($,j,!1)}))}getTracks(){return[this.mediaStreamManager.getTrack(wr.VIDEO),this.mediaStreamManager.getTrack(wr.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(wr.VIDEO)}getAudioInputDevice(w){if(typeof w!="string")return;const R=this.mixer.audio.find((U=>{if(U.name===w)return U.source}));return R?.source}getVideoInputDevice(w){if(typeof w=="string")return this.mixer.video.find((R=>R.name===w))}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(w,R,U){var j;return Ih(this,void 0,void 0,(function*(){if(typeof w!="object")throw new ye(Object.assign({},Fe));if(!R||typeof R!="string")throw new ye(Object.assign({},nt));if(this.mixer.video.some((Me=>Me.name===R)))throw new ye(Object.assign({},We));if(!U)throw new ye(Object.assign({},at));if(typeof U.index!="number")throw new ye(Object.assign({},Be));const $=(function(){const Me=document.createElement("video");return Me.autoplay=!0,Me.muted=!0,Me.setAttribute("playsinline",""),Me.setAttribute("webkit-playsinline",""),Me})(),X=w.getVideoTracks(),[ue]=X;if(!X.length)throw new ye(Object.assign({},ke));const me=ue.getConstraints(),ce=wb({},me,{frameRate:this.config.streamConfig.maxFramerate});try{yield ue.applyConstraints(ce)}catch(Me){let rt="Unknown constraints error";Me instanceof Error&&(rt=Me.message),this.analyticsTracker.trackEvent(new ho({description:`${xt.message}: ${rt}`,isFatal:!1,code:xt.code}))}const de=()=>Ih(this,void 0,void 0,(function*(){let Me=0;for(;Me<5;)try{return void(yield $.play())}catch(rt){if(!(rt instanceof Error))throw new Error("unknown error trying to add video to broadcast");Me++,yield new Promise((bt=>setTimeout(bt,150)))}throw new Error("Error playing video, tries exceeded")})),Ae=new MediaStream([ue]);$.srcObject=Ae;try{yield de();const Me={name:R,element:$,position:U,source:Ae,render:!0},rt=((j=ue.getSettings)===null||j===void 0?void 0:j.call(ue))||{};this.analyticsTracker.trackEvent(new Vl(v0(rt),rt)),this.mixer.video.push(Me)}catch(Me){throw new ye(Object.assign(Object.assign({},ke),{cause:Me}))}}))}addImageSource(w,R,U){var j;return Ih(this,void 0,void 0,(function*(){if(!w)throw new ye(Object.assign({},Fe));if(!R||typeof R!="string")throw new ye(Object.assign({},nt));if(w.tagName==="image")throw new ye(Object.assign({},it));if(this.mixer.video.some((X=>X.name===R)))throw new ye(Object.assign({},We));if(!U)throw new ye(Object.assign({},at));if(typeof U.index!="number")throw new ye(Object.assign({},Be));if(w instanceof Image){const X=(j=w.src)===null||j===void 0?void 0:j.slice();try{const ue=w.src?new URL(w.src):{};if(ue.host&&ue.hostname){const me=yield fetch(w.src).then((de=>Ih(this,void 0,void 0,(function*(){return de.blob()})))),ce=yield new Promise((de=>{const Ae=new FileReader;Ae.onload=()=>{de(Ae.result)},Ae.readAsDataURL(me)}));w.src=ce}}catch{throw new ye(Object.assign(Object.assign({},Jt),{params:{details:`Image URL: ${X}`}}))}}const $={name:R,element:w,position:U,render:!0};this.mixer.video.push($)}))}addAudioInputDevice(w,R){return Ih(this,void 0,void 0,(function*(){if(typeof w!="object")throw new ye(Object.assign({},Fe));if(!R||typeof R!="string")throw new ye(Object.assign({},nt));if(this.mixer.audio.some((ue=>ue.name===R)))throw new ye(Object.assign({},We));const U=w.getAudioTracks();if(!U.length)throw new ye(Object.assign({},He));const j=this.audioContext.createMediaStreamSource(new MediaStream(U)),$=this.audioContext.createGain();$.gain.value=1,j.connect($),$.connect(this.audioDestination);const X={name:R,source:w,audioTrackSource:j,gainNode:$};this.analyticsTracker.trackEvent(new Vl("audio",{deviceId:w.id})),this.mixer.audio.push(X)}))}removeImage(w){const R=this.mixer.video.findIndex((U=>U.name===w));if(R<0)throw new ye(Object.assign({},tn));this.mixer.video.splice(R,1)}removeVideoInputDevice(w){var R;const U=this.removeDevice(w,this.mixer.video);if(!U)throw new ye(Object.assign({},ot));{const j=y0(U.source.getTracks(),wr.VIDEO);if(!j)throw new ye(Object.assign({},ot));U.element.srcObject=null,j.stop();const $=((R=j?.getSettings)===null||R===void 0?void 0:R.call(j))||{};this.analyticsTracker.trackEvent(new Wr(v0($),$))}}removeAudioInputDevice(w){const R=this.removeDevice(w,this.mixer.audio);if(R?.audioTrackSource){for(const U of R.source.getTracks())U.stop(),this.analyticsTracker.trackEvent(new Wr("audio",{deviceId:U.id}));R.gainNode.disconnect(this.audioDestination)}else if(!R)throw new ye(Object.assign({},ot))}updateVideoDeviceComposition(w,R){if(!w||typeof w!="string")throw new ye(Object.assign({},Vt));if(!R)throw new ye(Object.assign({},ln));if(typeof R.index!="number")throw new ye(Object.assign({},Rt));this.mixer.video.forEach(((U,j)=>{U.name===w&&(U.position=R)}))}exchangeVideoDevicePositions(w,R){const U=this.getVideoInputDevice(w),j=this.getVideoInputDevice(R);if(!U)throw new ye(Object.assign(Object.assign({},_t),{params:{details:`device with name: "${w}" not found`}}));if(!j)throw new ye(Object.assign(Object.assign({},_t),{params:{details:`device with name: "${R}" not found`}}));const $=Object.assign({},U.position),X=Object.assign({},j.position);for(const ue of this.mixer.video)ue.name===w&&(h_(X.x)?ue.position=Object.assign(Object.assign({},ue.position),X):ue.position={index:X.index}),ue.name===R&&(h_($.x)?ue.position=Object.assign(Object.assign({},ue.position),$):ue.position={index:$.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:Sf.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:Sf.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var w;return((w=this.mediaStreamManager.getTrack(wr.VIDEO))===null||w===void 0?void 0:w.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach((w=>{w.render=!1}))}enableVideo(){this.mixer.video.forEach((w=>{w.render=!0}))}disableAudio(){this.mixer.audio.forEach((w=>{w.audioTrackSource&&(w.gainNode.gain.value=0)}))}enableAudio(){this.mixer.audio.forEach((w=>{w.audioTrackSource&&(w.gainNode.gain.value=1)}))}getDrawRegion(w,R,U){var j,$,X,ue;let me=(j=w.position.x)!==null&&j!==void 0?j:0,ce=($=w.position.y)!==null&&$!==void 0?$:0;const de=(X=w.position.width)!==null&&X!==void 0?X:R-me,Ae=(ue=w.position.height)!==null&&ue!==void 0?ue:U-ce,Me=de/Ae;let rt=w.element.width,bt=w.element.height;w.element instanceof HTMLVideoElement&&(rt=w.element.videoWidth,bt=w.element.videoHeight);const ht=rt/bt;let dt=de,et=Ae;return ht>Me?(dt=de,et=2*Math.round(de/ht/2),ce+=(Ae-et)/2):ht<Me&&(et=Ae,dt=2*Math.round(Ae*ht/2),me+=(de-dt)/2),{x:me,y:ce,width:dt,height:et}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const w=this.mixer.video.filter((R=>R.render));w.sort(((R,U)=>R.position.index-U.position.index));for(const R of w){const{x:U,y:j,width:$,height:X}=this.getDrawRegion(R,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(R.element,U,j,$,X)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(wr.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(w,R){const U=R.findIndex((j=>($=>$.name===w)(j)));if(!(U<0))return R.splice(U,1)[0]}shouldMix(w){if(w.getTime()<this.nextMix)return!1;for(;this.nextMix<=w.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function h_(P){return Number.isSafeInteger(P)}var yd,f_,Pp=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))},Yv=function(P,w,R,U){if(typeof w=="function"?P!==w||!U:!w.has(P))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?U:R==="a"?U.call(P):U?U.value:w.get(P)};class Nh{constructor(w){this.config=w,yd.add(this),this.emitter=new Pi,this.isValid=!0,this.emitter.on(_c.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new La,this.mediaStreamManager=new Ki;const R=new Qo(w.logLevel,w.logger);this.peerClient=new vd(this.config,this.emitter,this.mediaStreamManager,R,this.analyticsTracker),this.broadcastCanvasManager=new qv(w,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new Mu(this.peerClient,this.broadcastCanvasManager,R,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(Nh.prototype).forEach((U=>{this[U]=new Proxy(this[U],{apply:(j,$,X)=>{if(!$.isValid)throw new ye(Object.assign({},rs));return Reflect.apply(j,$,X)}})})),window.addEventListener("beforeunload",(()=>{this.analyticsTracker.stop(!0)}))}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(w,R){return Pp(this,void 0,void 0,(function*(){Io.markSdkUsage(),Yv(this,yd,"m",f_).call(this,w);const U=lo(R||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(U,w),this.emitter.emit(_c.ACTIVE_STATE_CHANGE,!0),this.url=new URL(U),this.url&&this.analyticsTracker.trackEvent(new l0({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},ul.USER_INITIATED))}))}stopBroadcast(){var w,R,U;this.url&&this.analyticsTracker.trackEvent(new n_({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(w=this.peerStatsTracker)===null||w===void 0||w.stop(),(R=this.peerClient)===null||R===void 0||R.stop(),(U=this.emitter)===null||U===void 0||U.emit(_c.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(w,R,U){return Pp(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addVideoInputDevice(w,R,U)}))}addImageSource(w,R,U){return Pp(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addImageSource(w,R,U)}))}addAudioInputDevice(w,R){return Pp(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addAudioInputDevice(w,R)}))}removeVideoInputDevice(w){this.broadcastCanvasManager.removeVideoInputDevice(w)}removeAudioInputDevice(w){this.broadcastCanvasManager.removeAudioInputDevice(w)}removeImage(w){this.broadcastCanvasManager.removeImage(w)}updateVideoDeviceComposition(w,R){this.broadcastCanvasManager.updateVideoDeviceComposition(w,R)}exchangeVideoDevicePositions(w,R){this.broadcastCanvasManager.exchangeVideoDevicePositions(w,R)}getAudioInputDevice(w){return this.broadcastCanvasManager.getAudioInputDevice(w)}getVideoInputDevice(w){return this.broadcastCanvasManager.getVideoInputDevice(w)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(w,R){this.emitter.on(w,R)}off(w,R){this.emitter.off(w,R)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(w){this.broadcastCanvasManager.attachPreview(w)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function d_(P){return new Nh((function(w){const R=new Ri;return R.streamConfig=w.streamConfig,R.ingestEndpoint=w.ingestEndpoint,R.logger=w.logger,R.logLevel=w.logLevel,R.networkReconnectConfig=w.networkReconnectConfig,R})(P))}yd=new WeakSet,f_=function(P){if(typeof P!="string"||!/^[a-zA-Z0-9_-]+$/.test(P))throw new ye(ss)};const E0="1.31.1";var Qt;(function(P){P.PUBLISH="publish",P.SUBSCRIBE="subscribe",P.JOIN="join",P.LEAVE="leave"})(Qt||(Qt={}));const Xr=2,xx="X-Stages-Options",Tb="cap";class x0 extends Xn{constructor(w){super(Mn.LEAVE,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.LEAVE,event_endpoint:w.eventEndpoint,whip_endpoint:w.whipEndpoint,reason:w.reason}),this.critical=!0}}function Kv(P){const w="0123456789abcdef";let R="";for(let U=0;U<P;U+=1)R+=w.charAt(Math.floor(16*Math.random()));return R}class wx{constructor(){const w=Kv;this.value=`${w(8)}-${w(4)}-${w(4)}-${w(4)}-${w(12)}`}}function bd(){return new wx}class Ka{constructor(){const w=(Date.now()/1e3|0).toString(16);this.value=`1-${w}-${Kv(24)}`}}function Ns(){return new Ka}var Dp,Xa,Ph;(function(P){P.MESSAGE="message",P.RESPONSE="response"})(Dp||(Dp={})),(function(P){P.STAGE_DELETED="STAGE_DELETED",P.PARTICIPANT_DISCONNECTED="PARTICIPANT_DISCONNECTED",P.TOKEN_INVALID="TOKEN_INVALID",P.TOKEN_EXPIRED="TOKEN_EXPIRED",P.TOKEN_INVALID_SIGNATURE="TOKEN_INVALID_SIGNATURE",P.TOKEN_MISSING="TOKEN_MISSING",P.INTERNAL="INTERNAL",P.BAD_REQUEST="BAD_REQUEST"})(Xa||(Xa={})),(function(P){P[P.BAD_REQUEST=400]="BAD_REQUEST",P[P.UNAUTHORIZED=401]="UNAUTHORIZED",P[P.FORBIDDEN=403]="FORBIDDEN",P[P.NOT_FOUND=404]="NOT_FOUND",P[P.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR"})(Ph||(Ph={}));class Rr extends ye{constructor({token:w,traceId:R,code:U,tag:j,location:$,message:X,details:ue,remoteParticipantId:me,requestUUID:ce,fatal:de,nominal:Ae,action:Me,count:rt=1}){super({name:"StageClientError",message:X,code:U}),Error.captureStackTrace&&Error.captureStackTrace(this,Rr),this.action=Me,this.token=w,this.traceId=R,this.code=U,this.tag=j,this.location=$,this.message=X,this.details=ue,this.remoteParticipantId=me,this.requestUUID=ce,this.fatal=de,this.nominal=Ae,this.count=rt}}const ea="signalling_session",Hc="webrtc_sink",Xv="webrtc_unsink",w0="webrtc_source";function No(P,w){switch(P){case Qt.PUBLISH:return Hc;case Qt.SUBSCRIBE:return`webrtc_source:${w}`;default:return"unknown"}}function Dh(P,w){var R,U,j,$;const X={code:P.code,message:`${P.message}: ${w.name} ${w.message}`,fatal:(R=P.fatal)!==null&&R!==void 0&&R,nominal:(U=P.nominal)!==null&&U!==void 0&&U};return w instanceof Rr&&(X.fatal=(j=w.fatal)!==null&&j!==void 0&&j,X.nominal=($=w.nominal)!==null&&$!==void 0&&$),X}function T0(P,w){if(P===0)return Zt.UNKNOWN_SERVER_ERROR;if(!(P<400))if(P>=400&&P<=403)switch(w){case Sc.TokenExpired:return Zt.EXPIRED_TOKEN;case Sc.NoPermissions:return Zt.TOKEN_PERMISSIONS_DENIED;case Sc.StageAtCapacity:return Zt.STAGE_AT_CAPACITY;case Sc.NoMatchingCodec:return Zt.NO_MATCHING_CODEC;default:return Zt.UNKNOWN_SERVER_ERROR}else{if(P===404)return w===Sc.RemoteStreamNotFound?Zt.REMOTE_STREAM_NOT_FOUND:Zt.UNKNOWN_SERVER_ERROR;if(P===412)return w===Sc.AbortedMHCPError?Zt.MHCP_ABORTED:Zt.UNKNOWN_SERVER_ERROR;if(P===429)return w===Sc.StageAuthThrottled?Zt.STAGE_AUTH_THROTTLED:Zt.WHIP_TOO_MANY_REQUESTS;if(P!==500)return Zt.UNKNOWN_SERVER_ERROR;switch(w){case Sc.InternalMHCPError:return Zt.INTERNAL_MHCP_ERROR;case Sc.UnreachableMHCP:return Zt.UNREACHABLE_MHCP;case Sc.InvalidSessionStatus:return Zt.INVALID_SESSION_STATUS;default:return Zt.INTERNAL_SERVER_ERROR}}}var Sc;(function(P){P[P.Unspecified=2001]="Unspecified",P[P.TokenExpired=2002]="TokenExpired",P[P.NoPermissions=2003]="NoPermissions",P[P.RemoteStreamNotFound=2004]="RemoteStreamNotFound",P[P.StageAtCapacity=2005]="StageAtCapacity",P[P.InternalMHCPError=2006]="InternalMHCPError",P[P.UncategorizedMHCPError=2007]="UncategorizedMHCPError",P[P.UnreachableMHCP=2008]="UnreachableMHCP",P[P.InvalidSessionStatus=2010]="InvalidSessionStatus",P[P.PostWithoutOptions=2011]="PostWithoutOptions",P[P.AbortedMHCPError=2012]="AbortedMHCPError",P[P.StageAuthThrottled=2013]="StageAuthThrottled",P[P.NoMatchingCodec=2014]="NoMatchingCodec"})(Sc||(Sc={}));const Zt={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},STAGE_DELETED:{code:1037,message:"Stage has been deleted",fatal:!0,nominal:!0},PARTICIPANT_DISCONNECTED:{code:1038,message:"Participant has been disconnected",fatal:!0,nominal:!0},JOIN_SERVER_INTERNAL_ERROR:{code:1039,message:"Internal server error during join",fatal:!1,nominal:!1},JOIN_SERVER_BAD_REQUEST:{code:1040,message:"Bad request during join",fatal:!0,nominal:!1},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message"},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},SEI_INSERT_NOT_PUBLISHING_VIDEO:{code:1460,message:"SEI failed to insert due to not publishing video",fatal:!1,nominal:!0},SEI_INSERT_INBAND_NOT_ENABLED:{code:1461,message:"SEI failed to insert due to in-band messaging not being enabled",fatal:!1,nominal:!0},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var Sr;(function(P){P.UNPUBLISH="unpublish",P.UNSUBSCRIBE="unsubscribe",P.UNLOAD="unload",P.CONNECTION_FAIL="connection fail",P.REASSIGNMENT="reassignment"})(Sr||(Sr={}));const xf="stageJoined",Ua="stageParticipantJoined",$c="stageParticipantLeft",p_="stageParticipantKicked",wf="stageParticipantUpdated",Iu="localPublishingChanged",Sd="stageRefresh",Ed="stateChange",A0="error",m_="reassignmentRequest",Xs="incompatibleCodecs",Ec="connectionStateChange",Tf="mediaStreamCreated",Nu="mediaStreamRemoved",Lp="error",Pu="stageStreamSeiMessageReceived",Up="transformError",xd="reassignmentStarted",wd="reassignmentSuccess",Jv="reassignmentFailed",Bp="open",dr="closed",Zv="messageParseError",C0="refresh",pl="error",Du="stageStateMessage",g_="sdpAnswer",R0="disconnectMessage",Qv="reassignmentMessage",__="incompatibleCodecs",Ab="ssu";function k0(P){return R=(function(U){return U.replace(/-/g,"+").replace(/_/g,"/").padEnd(U.length+(4-U.length%4)%4,"=")})(P),window.atob(R);var R}class Lu{constructor(w,R){var U;this.analyticsTracker=R,this.rawToken=w;const j=w.split(".");if(j.length!==3)throw Error(`Token format incorrect. length: ${j.length}`);try{this.header=JSON.parse(k0(j[0]))}catch(ue){const me=ue instanceof Error?`: ${ue.message}`:"";throw Error(`Error parsing Stage Token header${me}`)}try{this.claims=JSON.parse(k0(j[1]))}catch(ue){const me=ue instanceof Error?`: ${ue.message}`:"";throw Error(`Error parsing Stage Token claims${me}`)}this.signature=j[2];const{claims:$}=this;this.stageARN=$.resource,this.customerId=(U=(function(ue){if(ue.indexOf("arn:aws:")<0)return;const me=ue.split(":");return me.length>=5?me[4]:void 0})(this.stageARN))!==null&&U!==void 0?U:"unknown",this.participantID=$.jti,this.eventsURL=$.events_url,this.whipURL=ms("whipUrl")||$.whip_url,this.userID=$.user_id,this.expirationTime=$.exp,this.topic=$.topic,this.parseVersionFlags($.version);const{attributes:X}=$;X&&(this.attrGsRole=X.gs_role,this.attrGsSessionId=X.gs_session_id)}getPublishEndpoint(){let w="";return this.whipURL&&this.participantID&&(w=`${this.whipURL}/publish/${this.participantID}`),w}getSubscribeEndpoint(w){let R="";return this.whipURL&&(R=`${this.whipURL}/subscribe/${w}`),R}assertTokenIsUnexpired(w,R,U,j){Bc("disableTokenValidation")||(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new Rr(Object.assign(Object.assign({},Zt.EXPIRED_TOKEN),{action:Qt.JOIN,location:U,tag:R,token:this,traceId:w,remoteParticipantId:j,message:Zt.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(w){if(!w)return;const R=w.split(".");R.length===2&&(this.versionFlags=parseInt(R[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||!!(this.versionFlags&Xr)}}function Fp(P,w){return new Lu(P,w)}var v_;(function(P){P.PUBLISH="publish",P.SUBSCRIBE="subscribe"})(v_||(v_={}));class Tx{constructor(w,R){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=w,this.trailing=!(R&&R.skipTrailing)}invoke(w,...R){return this.throttled?(this.trailingFn=w,this.trailingFnArgs=R,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),w(...R),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}class ey extends Xn{constructor(w,R,U,j,$,X,ue,me){super(Mn.SERVER_REQUEST,R,ue,!0),Object.assign(this.properties,{action:w,http_method:j,remote_participant_id:X,request_uuid:$,url:U,transport:me})}}const ta="draft-ietf-wish-whip-04";class Ba extends Xn{constructor(w,R,U,j,$){super(Mn.TRACE,w,R,!1),Object.assign(this.properties,{action:j,message:U,remote_participant_id:$})}}class na extends Xn{constructor(w,R,U,j,$){super(Mn.CONNECTION_STATE,R,U,!1),Object.assign(this.properties,{action:w,remote_participant_id:$,state:j})}}class ml extends Xn{constructor(w,R,U,j,$){super(Mn.ICE_GATHERING_STATE,R,U,!1),Object.assign(this.properties,{action:w,remote_participant_id:$,state:j})}}var gi;(function(P){P.POST="post",P.CONNECTED="connected",P.ICE_GATHERING="icegathering",P.SDP_EXCHANGE="sdpExchange",P.SET_REMOTE_DESC="setRemoteDesc",P.PEER_CONNECTION="peerConnection"})(gi||(gi={}));const Td="start",vr="stop";class po{constructor(w,R){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=w,this.traceId=R}markActionStart(){this.markStart(gi.CONNECTED)}markPostStart(){this.markStart(gi.POST)}markPostStop(){this.markStop(gi.POST),this.postDuration=this.measure(gi.POST)}markIceGatheringStart(){this.markStart(gi.ICE_GATHERING)}markIceGatheringStop(){this.markStop(gi.ICE_GATHERING),this.timeToCandidate=this.measure(gi.ICE_GATHERING)}markActionStop(){this.markStop(gi.CONNECTED),this.timeToConnected=this.measure(gi.CONNECTED),this.markStop(gi.PEER_CONNECTION),this.peerConnectionDuration=this.measure(gi.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(gi.SET_REMOTE_DESC)}markSetRemoteDescStop(){const w=gi.SET_REMOTE_DESC;this.markStop(w),this.setRemoteDescDuration=this.measure(w),this.markStart(gi.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(gi.SDP_EXCHANGE)}markSdpExchangeStop(){const w=gi.SDP_EXCHANGE;this.markStop(w),this.sdpExchangeDuration=this.measure(w)}setTransport(w){this.sdpExchangeTransport=w}markStart(w){this.marks[`${this.namespace}.${w}.${Td}`]=performance.now()}markStop(w){this.marks[`${this.namespace}.${w}.${vr}`]=performance.now()}measure(w){const R=`${this.namespace}.${w}.${Td}`,U=`${this.namespace}.${w}.${vr}`,j=this.marks[R],$=this.marks[U];return j===void 0||$===void 0?0:$-j}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:w,postDuration:R,timeToCandidate:U,timeToConnected:j,sdpExchangeDuration:$,sdpExchangeTransport:X,setRemoteDescDuration:ue,peerConnectionDuration:me}=this;return{optionsDuration:w,postDuration:R,timeToCandidate:U,timeToConnected:j,sdpExchangeDuration:$,sdpExchangeTransport:X,setRemoteDescDuration:ue,peerConnectionDuration:me}}resetMeasurements(w){this.traceId=w,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var ra=i(7363);class fi{constructor(w){this.sdp=w}static splitLines(w){return w.trim().split(`
`).map((R=>R.trim()))}static splitSections(w){return w.split(`
m=`).map(((R,U)=>(U>0?`m=${R}`:R).trim()+fi.CRLF))}getUniqueRtpHeaderExtensionId(w){const R=[];for(const j of w)if(/^a=extmap:/.test(j.trim())){const $=+j.split("a=extmap:")[1].split(" ")[0];R.includes($)||R.push($)}R.sort(((j,$)=>j-$));let U=0;for(const j of R){if(j-U>1)return U+1;U=j}return U===14?-1:U+1}withVideoLayersAllocationRtpHeaderExtension(w){const R="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",U=w?w.getRtpHeaderExtensionId(R):-1,j=U===-1?this.getUniqueRtpHeaderExtensionId(fi.splitLines(this.sdp)):U,$=fi.splitSections(this.sdp),X=[];for(let me of $){if(/^m=video/.test(me)&&fi.getRtpHeaderExtensionIdInSection(me,R)===-1){const ce=fi.splitLines(me),de=[];if(j===-1||this.hasRtpHeaderExtensionId(j)){X.push(me);continue}for(const Ae of ce)if(de.push(Ae),/^a=sendrecv/.test(Ae.trim())){const Me=`a=extmap:${j} ${R}`;de.push(Me)}me=de.join(fi.CRLF)+fi.CRLF}else if(U!==-1&&/^m=video/.test(me)&&fi.getRtpHeaderExtensionIdInSection(me,R)!==U){const ce=fi.splitLines(me),de=[];for(const Ae of ce){if(/^a=extmap:/.test(Ae.trim())&&Ae.split("a=extmap:")[1].split(" ")[1]===R){if(!this.hasRtpHeaderExtensionId(U)){const Me=`a=extmap:${U} ${R}`;de.push(Me)}continue}de.push(Ae)}me=de.join(fi.CRLF)+fi.CRLF}X.push(me)}const ue=X.join("");return new fi(ue)}withOpusAudioConfig(w,R){const U=ra.qg(this.sdp);for(const j of U.media)if(j.type==="audio"){const{payload:$}=j.rtp.find((ce=>ce.codec==="opus"));if(!$)continue;let X=j.fmtp.find((ce=>ce.payload===$));X||(X={payload:$,config:""});const ue=ra.Sl(X.config);if(ue.maxaveragebitrate=w,typeof R=="boolean"){const ce=R?1:0;ue["sprop-stereo"]=ce,ue.stereo=ce}let me="";for(const ce of Object.keys(ue))me+=`${ce}=${ue[ce]}; `;X.config=me.trim()}return new fi(ra.M9(U))}withoutAudioRtcpRSize(){var w;const R=ra.qg(this.sdp);for(const U of R.media){if(U.type!=="audio")continue;const j=_b()!==void 0,$=(w=_b())!==null&&w!==void 0&&w;j&&(U.rtcpRsize=$?void 0:"rtcp-rsize")}return new fi(ra.M9(R))}withFilteredCandidates(w){const R=ra.qg(this.sdp);return R.media.forEach((U=>{const j=U.candidates;if(j){const $=j.filter((X=>X.transport===w));U.candidates=$}})),new fi(ra.M9(R))}static getRtpHeaderExtensionIdInSection(w,R){const U=fi.splitLines(w);for(const j of U)if(/^a=extmap:/.test(j.trim())){const $=j.split("a=extmap:")[1].split(" "),X=+$[0];if($[1]===R)return X}return-1}getRtpHeaderExtensionId(w){const R=fi.splitSections(this.sdp);for(const U of R)if(/^m=video/.test(U)){const j=fi.getRtpHeaderExtensionIdInSection(U,w);if(j!==-1)return j}return-1}hasRtpHeaderExtensionId(w){const R=fi.splitLines(this.sdp);for(const U of R)if(/^a=extmap:/.test(U.trim())&&+U.split("a=extmap:")[1].split(" ")[0]===w)return!0;return!1}hasAudioNacksEnabled(){var w,R,U;return((U=(R=((w=ra.qg(this.sdp).media.filter((j=>j.type==="audio"))[0])!==null&&w!==void 0?w:{}).rtcpFb)===null||R===void 0?void 0:R.filter((j=>j.type==="nack")))!==null&&U!==void 0?U:[]).length>0}}function y_(P){const{config:w}=P;return[{maxBitrate:w.maxBitrateBps}]}fi.CRLF=`\r
`,fi.rfc7587LowestBitrate=6e3,fi.rfc7587HighestBitrate=51e4;function Gl(P){return 1e3*P}const xa=(P,...w)=>{const R=w.map((U=>typeof U!="object")).filter(Boolean).length>0;if(typeof P=="object"&&!R)return(0,ji.merge)({},P,...w)},ty=P=>M0(P),M0=P=>(0,ji.cloneDeep)(P),ny=P=>{switch(P){case ba.HIGHEST_QUALITY:return"highest";case ba.LOWEST_QUALITY:default:return"lowest"}},wo=P=>Object.freeze(P),Po=Object.freeze({DEFAULT_1080:wo({maxBitrateKbps:2500,maxFramerate:30,width:1920,height:1080}),INACTIVE:wo({maxBitrateKbps:0,maxFramerate:0,width:0,height:0})}),jp=Object.freeze({DEFAULT_720:wo({maxBitrateKbps:2500,maxFramerate:30,width:1280,height:720}),DEFAULT_540:wo({maxBitrateKbps:1400,maxFramerate:15,width:960,height:540}),DEFAULT_480:wo({maxBitrateKbps:1100,maxFramerate:15,width:854,height:480}),DEFAULT_360:wo({maxBitrateKbps:600,maxFramerate:15,width:640,height:360}),DEFAULT_270:wo({maxBitrateKbps:350,maxFramerate:15,width:480,height:270}),DEFAULT_180:wo({maxBitrateKbps:150,maxFramerate:15,width:320,height:180}),DEFAULT_160:wo({maxBitrateKbps:120,maxFramerate:15,width:284,height:160})}),gl=Object.freeze({HI:wo(Object.assign({},jp.DEFAULT_720)),MID:wo(Object.assign(Object.assign({},jp.DEFAULT_360),{maxBitrateKbps:700,maxFramerate:20})),LOW:wo(Object.assign(Object.assign({},jp.DEFAULT_180),{maxBitrateKbps:200,maxFramerate:15}))}),Lh=P=>({rid:P,active:!1,scaleFactor:O0(P),maxBitrateBps:Gl(Po.INACTIVE.maxBitrateKbps),maxFramerate:Po.INACTIVE.maxFramerate,width:Po.INACTIVE.width,height:Po.INACTIVE.height}),O0=P=>{switch(P){case hl.HI:return 1;case hl.MID:return 2;case hl.LOW:return 4;default:return 1}},Af=50,Uu=2500,Bu=10,Fu=30,zp=160,Ad=1280,Uh=720*Ad,I0=16/9,N0=12,Vp=128,P0=64,Cb={[Ms.DEFAULT]:0,[Ms.LOW]:50,[Ms.MEDIUM]:150,[Ms.HIGH]:250},ju={[Ms.DEFAULT]:0,[Ms.LOW]:100,[Ms.MEDIUM]:200,[Ms.HIGH]:300};function Cd(P){const{outbound:w,remoteInbound:R,networkQuality:U}=P;return{networkQuality:U,nackCount:w.nackCount,packetsSent:w.packetsSent,packetsLost:R?.packetsLost,retransmittedPacketsSent:w.retransmittedPacketsSent,bytesSent:w.bytesSent,headerBytesSent:w.headerBytesSent,retransmittedBytesSent:w.retransmittedBytesSent,totalPacketSendDelay:w.totalPacketSendDelay}}function Rb(P){var w,R,U;const{outbound:j,remoteInbound:$,networkQuality:X}=P;return{networkQuality:X,nackCount:j.nackCount,packetsSent:j.packetsSent,packetsLost:$?.packetsLost,retransmittedPacketsSent:j.retransmittedPacketsSent,bytesSent:j.bytesSent,headerBytesSent:j.headerBytesSent,retransmittedBytesSent:j.retransmittedBytesSent,totalPacketSendDelay:j.totalPacketSendDelay,firCount:j.firCount,pliCount:j.pliCount,framesEncoded:j.framesEncoded,keyFramesEncoded:j.keyFramesEncoded,totalEncodeTime:j.totalEncodeTime,totalEncodedBytesTarget:j.totalEncodedBytesTarget,framesSent:j.framesSent,hugeFramesSent:j.hugeFramesSent,active:((w=j.framesPerSecond)!==null&&w!==void 0?w:0)!==0,qualityLimitationReason:j.qualityLimitationReason,qualityLimitationResolutionChanges:j.qualityLimitationResolutionChanges,qualityLimitationCpuDuration:(R=j.qualityLimitationDurations)===null||R===void 0?void 0:R.cpu,qualityLimitationBandwidthDuration:(U=j.qualityLimitationDurations)===null||U===void 0?void 0:U.bandwidth,frameWidth:j.frameWidth,frameHeight:j.frameHeight,framesPerSecond:j.framesPerSecond,rid:j.rid,ssrc:j.ssrc}}function kb(P,w){const R=new Map,U=new Map;for(const j of w.values())if(j.kind===P&&j.type==="outbound-rtp"&&j.ssrc){const $=j.rid||Se;U.set(j.ssrc,$);let X=R.get($);X||(X={},R.set($,X)),X.outbound=j}for(const j of w.values())if(j.kind===P&&j.type==="remote-inbound-rtp"&&j.ssrc){const $=U.get(j.ssrc)||Se,X=R.get($);X&&(X.remoteInbound=j)}return R}function Mb(P,w){const R=new Map;for(const U of w.values())if(U.kind===P&&U.type==="inbound-rtp"){const j=U.rid||Se;R.set(j,{inbound:U})}return R}function b_(P,w){return P!==uo.DOWN&&w!=null?w:P}const Ob=(P,w)=>{const R=[],U=Io.getNetworkQuality(),j=kb("audio",P);for(const $ of j.values())if($.outbound){const X=$.outbound.rid||Se,ue=b_(U,w.get(X)),me=Cd({outbound:$.outbound,remoteInbound:$.remoteInbound,networkQuality:ue});R.push(me)}if(R.length)return R},ry=(P,w)=>{const R=[],U=Io.getNetworkQuality(),j=kb("video",P);for(const $ of j.values())if($.outbound){const X=$.outbound.rid||Se,ue=Rb({outbound:$.outbound,remoteInbound:$.remoteInbound});if(ue.active){const me=b_(U,w.get(X));ue.networkQuality=me}R.push(ue)}if(R.length)return R},Ib=(P,w)=>{const R=[],U=Io.getNetworkQuality(),j=Mb("audio",P);for(const X of j.values())if(X.inbound){const ue=X.inbound.id;if(!ue)continue;const me=b_(U,w.get(ue)),ce={networkQuality:($={inbound:X.inbound,networkQuality:me}).networkQuality,nackCount:$.inbound.nackCount,packetsReceived:$.inbound.packetsReceived,packetsLost:$.inbound.packetsLost,packetsDiscarded:$.inbound.packetsDiscarded,bytesReceived:$.inbound.bytesReceived,headerBytesReceived:$.inbound.headerBytesReceived,jitterBufferDelay:$.inbound.jitterBufferDelay,jitterBufferEmittedCount:$.inbound.jitterBufferEmittedCount,jitter:$.inbound.jitter,totalSamplesReceived:$.inbound.totalSamplesReceived,concealedSamples:$.inbound.concealedSamples,silentConcealedSamples:$.inbound.silentConcealedSamples,concealmentEvents:$.inbound.concealmentEvents,insertedSamplesForDeceleration:$.inbound.insertedSamplesForDeceleration,removedSamplesForAcceleration:$.inbound.removedSamplesForAcceleration,audioLevel:$.inbound.audioLevel};R.push(ce)}var $;if(R.length)return R},Nb=(P,w)=>{const R=[],U=Io.getNetworkQuality(),j=Mb("video",P);for(const X of j.values())if(X.inbound){const ue=X.inbound.id;if(!ue)continue;const me={networkQuality:($={inbound:X.inbound,networkQuality:b_(U,w.get(ue))}).networkQuality,nackCount:$.inbound.nackCount,packetsReceived:$.inbound.packetsReceived,packetsLost:$.inbound.packetsLost,packetsDiscarded:$.inbound.packetsDiscarded,bytesReceived:$.inbound.bytesReceived,headerBytesReceived:$.inbound.headerBytesReceived,jitterBufferDelay:$.inbound.jitterBufferDelay,jitterBufferEmittedCount:$.inbound.jitterBufferEmittedCount,jitter:$.inbound.jitter,pliCount:$.inbound.pliCount,firCount:$.inbound.firCount,framesReceived:$.inbound.framesReceived,framesDecoded:$.inbound.framesDecoded,keyFramesDecoded:$.inbound.keyFramesDecoded,framesDropped:$.inbound.framesDropped,totalDecodeTime:$.inbound.totalDecodeTime,totalInterFrameDelay:$.inbound.totalInterFrameDelay,totalSquaredInterFrameDelay:$.inbound.totalSquaredInterFrameDelay,pauseCount:$.inbound.pauseCount,totalPausesDuration:$.inbound.totalPausesDuration,freezeCount:$.inbound.freezeCount,totalFreezesDuration:$.inbound.totalFreezesDuration,frameWidth:$.inbound.frameWidth,frameHeight:$.inbound.frameHeight,framesPerSecond:$.inbound.framesPerSecond,ssrc:$.inbound.ssrc};R.push(me)}var $;if(R.length)return R};var Ax=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};const Pb="H264",Db=P=>{const w=P?.split("/");if(w?.length===2)return w[1]},mo=(P,w)=>{const R=Db(P);if(P===void 0||R===void 0)return;const U={mimeSubtype:R};if(w){const j=($=>{const X=$.split(";"),ue=new Map;for(const me of X){const[ce,de]=me.split("=");ue.set(ce,de)}return ue})(w);switch(R){case Pb:{const $=j.get("profile-level-id");$&&((X,ue)=>{if(ue.length<6)return;const me=ue.substring(0,4),ce=parseInt(ue.substring(4,6),16);X.profile=me,X.level=ce})(U,$);break}case"H265":(($,X)=>{const ue=X.get("profile-id")||"0",me=X.get("tier-flag")||"0",ce=parseInt(X.get("level-id")||"0",10),de=[me,ue].join("_");$.profile=de,$.level=ce})(U,j)}}return U},iy=(P,w)=>P.sort(((R,U)=>{if(Db(R.mimeType)===Pb){const j=mo(R.mimeType,R.sdpFmtpLine);if(j?.profile===w)return-1}return 0})),S_=(P,w)=>{var R;const U=mo(P.mimeType,P.sdpFmtpLine);return U?.mimeSubtype.toLowerCase()===w.mime.toLowerCase()&&((R=U?.profile)===null||R===void 0?void 0:R.toLowerCase().indexOf(w.config.toLowerCase()))===0},Cx=(P,w)=>w.filter((R=>!R.mimeType.endsWith("rtx"))).filter((R=>R.mimeType.indexOf("packetization-mode=0")===-1)).find((R=>P.reduce(((U,j)=>U&&S_(R,j)===!1),!0)));class E_ extends Xn{constructor(w,R,U,j,$,X,ue,me,ce){var de,Ae;super(Mn.PUBLISHED_VIDEO_STATS,w,R,!1),Object.assign(this.properties,Object.assign({action:Qt.PUBLISH,node:(de=U?.node)!==null&&de!==void 0?de:"",cluster:(Ae=U?.cluster)!==null&&Ae!==void 0?Ae:""},((Me,rt,bt,ht,dt,et)=>{var st,Ot,En,Dn,Jn,b,S,N,V,ee,le,Ne,Qe,St,Lt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,mt,Mt,on,$n,Pr,er,pr,ki,Or,qs;const Xc=(Ot=(st=Me?.qualityLimitationDurations)===null||st===void 0?void 0:st.cpu)!==null&&Ot!==void 0?Ot:0,Zl=(Dn=(En=Me?.qualityLimitationDurations)===null||En===void 0?void 0:En.bandwidth)!==null&&Dn!==void 0?Dn:0,Jc=Math.max((Jn=Me?.bytesSent)!==null&&Jn!==void 0?Jn:0,0),$h=8*Jc/(et??1),Yu=Math.max((b=rt?.packetsLost)!==null&&b!==void 0?b:0,0),Gh=Math.max((S=Me?.packetsSent)!==null&&S!==void 0?S:0,0),Pf=Yu/Math.max(Gh,1),El=mo(ht?.mimeType,ht?.sdpFmtpLine);return{active:!!Me?.framesPerSecond&&Me.framesPerSecond!==0,bytes_sent:Jc,codec_mime_type:El?.mimeSubtype,codec_profile:El?.profile,codec_level:El?.level,configured_bitrate:dt?.max_bitrate,connection_bandwidth:(V=(N=bt?.candidatePair)===null||N===void 0?void 0:N.availableOutgoingBitrate)!==null&&V!==void 0?V:0,encode_bitrate:$h,encoder_implementation:(ee=Me?.encoderImplementation)!==null&&ee!==void 0?ee:"unknown",fir_count:(le=Me?.firCount)!==null&&le!==void 0?le:0,fraction_packets_lost:Pf,frame_height:Math.max((Ne=Me?.frameHeight)!==null&&Ne!==void 0?Ne:0,0),frame_width:Math.max((Qe=Me?.frameWidth)!==null&&Qe!==void 0?Qe:0,0),frames_encoded:(St=Me?.framesEncoded)!==null&&St!==void 0?St:0,frames_per_second:Math.max((Lt=Me?.framesPerSecond)!==null&&Lt!==void 0?Lt:0,0),frames_sent:(Kt=Me?.framesSent)!==null&&Kt!==void 0?Kt:0,header_bytes_sent:(Xt=Me?.headerBytesSent)!==null&&Xt!==void 0?Xt:0,huge_frames_sent:(vn=Me?.hugeFramesSent)!==null&&vn!==void 0?vn:0,key_frames_encoded:(Zn=Me?.keyFramesEncoded)!==null&&Zn!==void 0?Zn:0,nack_count:(Nr=Me?.nackCount)!==null&&Nr!==void 0?Nr:0,packets_lost:Yu,packets_sent:Gh,power_efficient_encoder:(Vi=Me?.powerEfficientEncoder)!==null&&Vi!==void 0&&Vi,pli_count:(Hi=Me?.pliCount)!==null&&Hi!==void 0?Hi:0,quality_limitation_reason:(Tt=Me?.qualityLimitationReason)!==null&&Tt!==void 0?Tt:"none",quality_limitation_resolution_changes:(mt=Me?.qualityLimitationResolutionChanges)!==null&&mt!==void 0?mt:0,quality_limitation_cpu_duration:Xc,quality_limitation_bandwidth_duration:Zl,retransmitted_bytes_sent:(Mt=Me?.retransmittedBytesSent)!==null&&Mt!==void 0?Mt:0,retransmitted_packets_sent:(on=Me?.retransmittedPacketsSent)!==null&&on!==void 0?on:0,rid:($n=Me?.rid)!==null&&$n!==void 0?$n:Se,scalability_mode:(Pr=Me?.scalabilityMode)!==null&&Pr!==void 0?Pr:"unknown",target_bitrate:Math.max((er=Me?.targetBitrate)!==null&&er!==void 0?er:0,0),total_encode_time:(pr=Me?.totalEncodeTime)!==null&&pr!==void 0?pr:0,total_encoded_bytes_target:(ki=Me?.totalEncodedBytesTarget)!==null&&ki!==void 0?ki:0,total_packet_send_delay:(Or=Me?.totalPacketSendDelay)!==null&&Or!==void 0?Or:0,protocol:(qs=bt?.localCandidate)===null||qs===void 0?void 0:qs.protocol}})(j,$,X,ue,me,ce)))}}class Lb extends Xn{constructor(w,R,U,j,$,X,ue,me,ce,de,Ae,Me){var rt,bt,ht,dt;super(Mn.PUBLISHED_VIDEO_STATS_WINDOW,w,R,!1);const et=Math.max(((rt=j?.timestamp)!==null&&rt!==void 0?rt:0)-((bt=$?.timestamp)!==null&&bt!==void 0?bt:0),0);Object.assign(this.properties,Object.assign({action:Qt.PUBLISH,node:(ht=U?.node)!==null&&ht!==void 0?ht:"",cluster:(dt=U?.cluster)!==null&&dt!==void 0?dt:"",window_size_ms:et},((st,Ot,En,Dn,Jn,b,S,N,V,ee)=>{var le,Ne,Qe,St,Lt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,mt,Mt,on,$n,Pr,er,pr,ki,Or,qs,Xc,Zl,Jc,$h,Yu,Gh,Pf,El,Yp,X0,Ld,Kp,J0,Xp,Jp,Z0,Zp,Qp,em,Jb,Zb,Qb,eS,Fx,jx,zx,Vx,vy,tS,Hx,tm;const QI=(Ne=(le=st?.qualityLimitationDurations)===null||le===void 0?void 0:le.cpu)!==null&&Ne!==void 0?Ne:0,PC=(St=(Qe=Ot?.qualityLimitationDurations)===null||Qe===void 0?void 0:Qe.cpu)!==null&&St!==void 0?St:0,DC=(Kt=(Lt=st?.qualityLimitationDurations)===null||Lt===void 0?void 0:Lt.bandwidth)!==null&&Kt!==void 0?Kt:0,Goe=(vn=(Xt=Ot?.qualityLimitationDurations)===null||Xt===void 0?void 0:Xt.bandwidth)!==null&&vn!==void 0?vn:0,fB=Math.max(((Zn=st?.bytesSent)!==null&&Zn!==void 0?Zn:0)-((Nr=Ot?.bytesSent)!==null&&Nr!==void 0?Nr:0),0),dB=typeof N!="number"?1:N/1e3,Woe=8*fB/dB,pB=Math.max(((Vi=En?.packetsLost)!==null&&Vi!==void 0?Vi:0)-((Hi=Dn?.packetsLost)!==null&&Hi!==void 0?Hi:0),0),mB=Math.max(((Tt=st?.packetsSent)!==null&&Tt!==void 0?Tt:0)-((mt=Ot?.packetsSent)!==null&&mt!==void 0?mt:0),0),qoe=pB/Math.max(mB,1),nS=mo(b?.mimeType,b?.sdpFmtpLine),Yoe=8*(ee||0)/dB;return{active:!!st?.framesPerSecond&&st?.framesPerSecond!==0,bytes_sent:fB,codec_mime_type:nS?.mimeSubtype,codec_profile:nS?.profile,codec_level:nS?.level,configured_bitrate:S?.max_bitrate,connection_bandwidth:(on=(Mt=Jn?.candidatePair)===null||Mt===void 0?void 0:Mt.availableOutgoingBitrate)!==null&&on!==void 0?on:0,encode_bitrate:Woe,encoder_implementation:($n=st?.encoderImplementation)!==null&&$n!==void 0?$n:"unknown",fir_count:Math.max(((Pr=st?.firCount)!==null&&Pr!==void 0?Pr:0)-((er=Ot?.firCount)!==null&&er!==void 0?er:0),0),fraction_packets_lost:qoe,frame_height:Math.max((pr=st?.frameHeight)!==null&&pr!==void 0?pr:0,0),frame_width:Math.max((ki=st?.frameWidth)!==null&&ki!==void 0?ki:0,0),frames_encoded:Math.max(((Or=st?.framesEncoded)!==null&&Or!==void 0?Or:0)-((qs=Ot?.framesEncoded)!==null&&qs!==void 0?qs:0),0),frames_per_second:Math.max((Xc=st?.framesPerSecond)!==null&&Xc!==void 0?Xc:0,0),frames_sent:Math.max(((Zl=st?.framesSent)!==null&&Zl!==void 0?Zl:0)-((Jc=Ot?.framesSent)!==null&&Jc!==void 0?Jc:0),0),header_bytes_sent:Math.max((($h=st?.headerBytesSent)!==null&&$h!==void 0?$h:0)-((Yu=Ot?.headerBytesSent)!==null&&Yu!==void 0?Yu:0),0),huge_frames_sent:Math.max(((Gh=st?.hugeFramesSent)!==null&&Gh!==void 0?Gh:0)-((Pf=Ot?.hugeFramesSent)!==null&&Pf!==void 0?Pf:0),0),key_frames_encoded:Math.max(((El=st?.keyFramesEncoded)!==null&&El!==void 0?El:0)-((Yp=Ot?.keyFramesEncoded)!==null&&Yp!==void 0?Yp:0),0),nack_count:Math.max(((X0=st?.nackCount)!==null&&X0!==void 0?X0:0)-((Ld=Ot?.nackCount)!==null&&Ld!==void 0?Ld:0),0),packets_lost:pB,packets_sent:mB,power_efficient_encoder:(Kp=st?.powerEfficientEncoder)!==null&&Kp!==void 0&&Kp,pli_count:Math.max(((J0=st?.pliCount)!==null&&J0!==void 0?J0:0)-((Xp=Ot?.pliCount)!==null&&Xp!==void 0?Xp:0),0),quality_limitation_reason:(Jp=st?.qualityLimitationReason)!==null&&Jp!==void 0?Jp:"none",quality_limitation_resolution_changes:Math.max(((Z0=st?.qualityLimitationResolutionChanges)!==null&&Z0!==void 0?Z0:0)-((Zp=Ot?.qualityLimitationResolutionChanges)!==null&&Zp!==void 0?Zp:0),0),quality_limitation_cpu_duration:Math.max(QI-PC,0),quality_limitation_bandwidth_duration:Math.max(DC-Goe,0),retransmitted_bytes_sent:Math.max(((Qp=st?.retransmittedBytesSent)!==null&&Qp!==void 0?Qp:0)-((em=Ot?.retransmittedBytesSent)!==null&&em!==void 0?em:0),0),rid:(Jb=st?.rid)!==null&&Jb!==void 0?Jb:Se,retransmitted_packets_sent:Math.max(((Zb=st?.retransmittedPacketsSent)!==null&&Zb!==void 0?Zb:0)-((Qb=Ot?.retransmittedPacketsSent)!==null&&Qb!==void 0?Qb:0),0),scalability_mode:(eS=st?.scalabilityMode)!==null&&eS!==void 0?eS:"unknown",target_bitrate:Math.max((Fx=st?.targetBitrate)!==null&&Fx!==void 0?Fx:0,0),total_encode_time:Math.max(((jx=st?.totalEncodeTime)!==null&&jx!==void 0?jx:0)-((zx=Ot?.totalEncodeTime)!==null&&zx!==void 0?zx:0),0),total_encoded_bytes_target:Math.max(((Vx=st?.totalEncodedBytesTarget)!==null&&Vx!==void 0?Vx:0)-((vy=Ot?.totalEncodedBytesTarget)!==null&&vy!==void 0?vy:0),0),total_packet_send_delay:Math.max(((tS=st?.totalPacketSendDelay)!==null&&tS!==void 0?tS:0)-((Hx=Ot?.totalPacketSendDelay)!==null&&Hx!==void 0?Hx:0),0),sei_write_count:V,sei_bytes_sent:ee,sei_bitrate:Yoe,protocol:(tm=Jn?.localCandidate)===null||tm===void 0?void 0:tm.protocol}})(j,$,X,ue,me,ce,de,et,Ae,Me)))}}class Ub extends Xn{constructor(w,R,U,j,$,X,ue,me,ce,de){var Ae,Me;super(Mn.PUBLISHED_AUDIO_STATS,w,R,!1),Object.assign(this.properties,Object.assign({action:Qt.PUBLISH,node:(Ae=U?.node)!==null&&Ae!==void 0?Ae:"",cluster:(Me=U?.cluster)!==null&&Me!==void 0?Me:""},((rt,bt,ht,dt,et,st,Ot)=>{var En,Dn,Jn,b,S,N,V,ee,le,Ne,Qe,St,Lt;const Kt=Math.max((En=rt?.bytesSent)!==null&&En!==void 0?En:0,0),Xt=8*Kt/(st??1),vn=Math.max((Dn=bt?.packetsLost)!==null&&Dn!==void 0?Dn:0,0),Zn=Math.max((Jn=rt?.packetsSent)!==null&&Jn!==void 0?Jn:0,0),Nr=vn/Math.max(Zn,1),Vi=mo(dt?.mimeType,dt?.sdpFmtpLine);return{audio_nacks_enabled:(b=Ot?.audioNacks)!==null&&b!==void 0&&b,bytes_sent:Kt,codec_mime_type:Vi?.mimeSubtype,configured_bitrate:(S=et?.max_audio_bitrate_bps)!==null&&S!==void 0?S:0,connection_bandwidth:(V=(N=ht?.candidatePair)===null||N===void 0?void 0:N.availableOutgoingBitrate)!==null&&V!==void 0?V:0,encode_bitrate:Xt,fraction_packets_lost:Nr,header_bytes_sent:(ee=rt?.headerBytesSent)!==null&&ee!==void 0?ee:0,nack_count:(le=rt?.nackCount)!==null&&le!==void 0?le:0,packets_lost:vn,packets_sent:Zn,retransmitted_bytes_sent:(Ne=rt?.retransmittedBytesSent)!==null&&Ne!==void 0?Ne:0,retransmitted_packets_sent:(Qe=rt?.retransmittedPacketsSent)!==null&&Qe!==void 0?Qe:0,target_bitrate:(St=rt?.targetBitrate)!==null&&St!==void 0?St:0,protocol:(Lt=ht?.localCandidate)===null||Lt===void 0?void 0:Lt.protocol}})(j,$,X,ue,me,ce,de)))}}class sy extends Xn{constructor(w,R,U,j,$,X,ue,me,ce,de,Ae){var Me,rt,bt,ht;super(Mn.PUBLISHED_AUDIO_STATS_WINDOW,w,R,!1);const dt=Math.max(((Me=j?.timestamp)!==null&&Me!==void 0?Me:0)-((rt=$?.timestamp)!==null&&rt!==void 0?rt:0),0);Object.assign(this.properties,Object.assign({action:Qt.PUBLISH,node:(bt=U?.node)!==null&&bt!==void 0?bt:"",cluster:(ht=U?.cluster)!==null&&ht!==void 0?ht:"",window_size_ms:dt},((et,st,Ot,En,Dn,Jn,b,S,N)=>{var V,ee,le,Ne,Qe,St,Lt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,mt,Mt,on,$n,Pr,er,pr;const ki=Math.max(((V=et?.bytesSent)!==null&&V!==void 0?V:0)-((ee=st?.bytesSent)!==null&&ee!==void 0?ee:0),0),Or=8*ki/(typeof S!="number"?1:S/1e3),qs=Math.max(((le=Ot?.packetsLost)!==null&&le!==void 0?le:0)-((Ne=En?.packetsLost)!==null&&Ne!==void 0?Ne:0),0),Xc=Math.max(((Qe=et?.packetsSent)!==null&&Qe!==void 0?Qe:0)-((St=st?.packetsSent)!==null&&St!==void 0?St:0),0),Zl=qs/Math.max(Xc,1),Jc=mo(Jn?.mimeType,Jn?.sdpFmtpLine);return{audio_nacks_enabled:(Lt=N?.audioNacks)!==null&&Lt!==void 0&&Lt,bytes_sent:ki,codec_mime_type:Jc?.mimeSubtype,configured_bitrate:(Kt=b?.max_audio_bitrate_bps)!==null&&Kt!==void 0?Kt:0,connection_bandwidth:(vn=(Xt=Dn?.candidatePair)===null||Xt===void 0?void 0:Xt.availableOutgoingBitrate)!==null&&vn!==void 0?vn:0,encode_bitrate:Or,fraction_packets_lost:Zl,header_bytes_sent:Math.max(((Zn=et?.headerBytesSent)!==null&&Zn!==void 0?Zn:0)-((Nr=st?.headerBytesSent)!==null&&Nr!==void 0?Nr:0),0),nack_count:Math.max(((Vi=et?.nackCount)!==null&&Vi!==void 0?Vi:0)-((Hi=st?.nackCount)!==null&&Hi!==void 0?Hi:0),0),packets_lost:qs,packets_sent:Math.max(((Tt=et?.packetsSent)!==null&&Tt!==void 0?Tt:0)-((mt=st?.packetsSent)!==null&&mt!==void 0?mt:0),0),retransmitted_bytes_sent:Math.max(((Mt=et?.retransmittedBytesSent)!==null&&Mt!==void 0?Mt:0)-((on=st?.retransmittedBytesSent)!==null&&on!==void 0?on:0),0),retransmitted_packets_sent:Math.max((($n=et?.retransmittedPacketsSent)!==null&&$n!==void 0?$n:0)-((Pr=st?.retransmittedPacketsSent)!==null&&Pr!==void 0?Pr:0),0),target_bitrate:Math.max((er=et?.targetBitrate)!==null&&er!==void 0?er:0,0),protocol:(pr=Dn?.localCandidate)===null||pr===void 0?void 0:pr.protocol}})(j,$,X,ue,me,ce,de,dt,Ae)))}}class D0 extends Xn{constructor(w,R,U,j,$,X,ue,me){var ce,de;super(Mn.SUBSCRIBED_VIDEO_STATS,w,R,!1),Object.assign(this.properties,Object.assign({action:Qt.SUBSCRIBE,node:(ce=j?.node)!==null&&ce!==void 0?ce:"",cluster:(de=j?.cluster)!==null&&de!==void 0?de:"",remote_participant_id:U},((Ae,Me,rt,bt)=>{var ht,dt,et,st,Ot,En,Dn,Jn,b,S,N,V,ee,le,Ne,Qe,St,Lt,Kt,Xt,vn,Zn,Nr,Vi;let Hi=0;Ae?.jitterBufferDelay&&Ae?.jitterBufferEmittedCount&&Ae.jitterBufferEmittedCount>0&&(Hi=Ae.jitterBufferDelay/Ae.jitterBufferEmittedCount);const Tt=bt??1,mt=Math.max((ht=Ae?.bytesReceived)!==null&&ht!==void 0?ht:0,0),Mt=8*mt/Tt;let on=0;Ae?.totalDecodeTime&&Ae?.framesDecoded&&(on=Ae.totalDecodeTime/Math.max(Ae?.framesDecoded,1));const $n=Math.max((dt=Ae?.packetsLost)!==null&&dt!==void 0?dt:0,0),Pr=Math.max((et=Ae?.packetsReceived)!==null&&et!==void 0?et:0,0),er=$n/Math.max(Pr+$n,1),pr=mo(rt?.mimeType,rt?.sdpFmtpLine);return{bytes_received:mt,codec_mime_type:pr?.mimeSubtype,codec_profile:pr?.profile,codec_level:pr?.level,connection_bandwidth:(Ot=(st=Me?.candidatePair)===null||st===void 0?void 0:st.availableIncomingBitrate)!==null&&Ot!==void 0?Ot:0,decode_bitrate:Mt,decoder_implementation:(En=Ae?.decoderImplementation)!==null&&En!==void 0?En:"unknown",fir_count:Math.max((Dn=Ae?.firCount)!==null&&Dn!==void 0?Dn:0,0),fraction_packets_lost:er,frame_decode_time_avg:on,frame_height:Math.max((Jn=Ae?.frameHeight)!==null&&Jn!==void 0?Jn:0,0),frame_width:Math.max((b=Ae?.frameWidth)!==null&&b!==void 0?b:0,0),frames_decoded:Math.max((S=Ae?.framesDecoded)!==null&&S!==void 0?S:0,0),frames_dropped:Math.max((N=Ae?.framesDropped)!==null&&N!==void 0?N:0,0),frames_received:Math.max((V=Ae?.framesReceived)!==null&&V!==void 0?V:0,0),freeze_count:Math.max((ee=Ae?.freezeCount)!==null&&ee!==void 0?ee:0,0),frames_rendered:Math.max((le=Ae?.framesRendered)!==null&&le!==void 0?le:0,0),frames_per_second:Math.max((Ne=Ae?.framesPerSecond)!==null&&Ne!==void 0?Ne:0,0),header_bytes_received:Math.max((Qe=Ae?.headerBytesReceived)!==null&&Qe!==void 0?Qe:0,0),jitter_buffer_delay_avg:Hi,key_frames_decoded:Math.max((St=Ae?.keyFramesDecoded)!==null&&St!==void 0?St:0,0),nack_count:Math.max((Lt=Ae?.nackCount)!==null&&Lt!==void 0?Lt:0,0),packets_discarded:Math.max((Kt=Ae?.packetsDiscarded)!==null&&Kt!==void 0?Kt:0,0),packets_lost:$n,packets_received:Pr,pause_count:Math.max((Xt=Ae?.pauseCount)!==null&&Xt!==void 0?Xt:0,0),pli_count:Math.max((vn=Ae?.pliCount)!==null&&vn!==void 0?vn:0,0),power_efficient_decoder:(Zn=Ae?.powerEfficientDecoder)!==null&&Zn!==void 0&&Zn,total_freezes_duration:Math.max((Nr=Ae?.totalFreezesDuration)!==null&&Nr!==void 0?Nr:0,0),total_pauses_duration:Math.max((Vi=Ae?.totalPausesDuration)!==null&&Vi!==void 0?Vi:0,0)}})($,X,ue,me)))}}class Bb extends Xn{constructor(w,R,U,j,$,X,ue,me,ce,de,Ae){var Me,rt,bt,ht;super(Mn.SUBSCRIBED_VIDEO_STATS_WINDOW,w,R,!1);const dt=Math.max(((Me=$?.timestamp)!==null&&Me!==void 0?Me:0)-((rt=X?.timestamp)!==null&&rt!==void 0?rt:0),0);Object.assign(this.properties,Object.assign({action:Qt.SUBSCRIBE,node:(bt=j?.node)!==null&&bt!==void 0?bt:"",cluster:(ht=j?.cluster)!==null&&ht!==void 0?ht:"",window_size_ms:dt,remote_participant_id:U},((et,st,Ot,En,Dn,Jn,b,S)=>{var N,V,ee,le,Ne,Qe,St,Lt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,mt,Mt,on,$n,Pr,er,pr,ki,Or,qs,Xc,Zl,Jc,$h,Yu,Gh,Pf,El,Yp,X0,Ld,Kp,J0,Xp,Jp,Z0,Zp,Qp,em;let Jb=0,Zb=0;if(et?.jitterBufferEmittedCount&&st?.jitterBufferEmittedCount&&et.jitterBufferEmittedCount>st.jitterBufferEmittedCount){et?.jitterBufferDelay&&st?.jitterBufferDelay&&(Jb=(et.jitterBufferDelay-st.jitterBufferDelay)/(et.jitterBufferEmittedCount-st.jitterBufferEmittedCount));const PC=st?.jitterBufferMinimumDelay,DC=et?.jitterBufferMinimumDelay;PC&&DC&&(Zb=(DC-PC)/(et.jitterBufferEmittedCount-st.jitterBufferEmittedCount))}const Qb=Math.max(((N=et?.bytesReceived)!==null&&N!==void 0?N:0)-((V=st?.bytesReceived)!==null&&V!==void 0?V:0),0),eS=typeof Dn!="number"?1:Dn/1e3,Fx=8*Qb/eS,jx=Math.max(((ee=et?.totalDecodeTime)!==null&&ee!==void 0?ee:0)-((le=st?.totalDecodeTime)!==null&&le!==void 0?le:0),0),zx=Math.max(((Ne=et?.framesDecoded)!==null&&Ne!==void 0?Ne:0)-((Qe=st?.framesDecoded)!==null&&Qe!==void 0?Qe:0),0),Vx=jx/Math.max(zx,1),vy=Math.max(((St=et?.packetsLost)!==null&&St!==void 0?St:0)-((Lt=st?.packetsLost)!==null&&Lt!==void 0?Lt:0),0),tS=Math.max(((Kt=et?.packetsReceived)!==null&&Kt!==void 0?Kt:0)-((Xt=st?.packetsReceived)!==null&&Xt!==void 0?Xt:0),0),Hx=vy/Math.max(tS+vy,1),tm=mo(En?.mimeType,En?.sdpFmtpLine),QI=8*(S||0)/eS;return{bytes_received:Qb,codec_mime_type:tm?.mimeSubtype,codec_profile:tm?.profile,codec_level:tm?.level,connection_bandwidth:(Zn=(vn=Ot?.candidatePair)===null||vn===void 0?void 0:vn.availableIncomingBitrate)!==null&&Zn!==void 0?Zn:0,decode_bitrate:Fx,decoder_implementation:(Nr=et?.decoderImplementation)!==null&&Nr!==void 0?Nr:"unknown",fir_count:Math.max(((Vi=et?.firCount)!==null&&Vi!==void 0?Vi:0)-((Hi=st?.firCount)!==null&&Hi!==void 0?Hi:0),0),fraction_packets_lost:Hx,frame_decode_time_avg:Vx,frame_height:Math.max((Tt=et?.frameHeight)!==null&&Tt!==void 0?Tt:0,0),frame_width:Math.max((mt=et?.frameWidth)!==null&&mt!==void 0?mt:0,0),frames_decoded:Math.max(((Mt=et?.framesDecoded)!==null&&Mt!==void 0?Mt:0)-((on=st?.framesDecoded)!==null&&on!==void 0?on:0),0),frames_dropped:Math.max((($n=et?.framesDropped)!==null&&$n!==void 0?$n:0)-((Pr=st?.framesDropped)!==null&&Pr!==void 0?Pr:0),0),frames_received:Math.max(((er=et?.framesReceived)!==null&&er!==void 0?er:0)-((pr=st?.framesReceived)!==null&&pr!==void 0?pr:0),0),freeze_count:Math.max(((ki=et?.freezeCount)!==null&&ki!==void 0?ki:0)-((Or=st?.freezeCount)!==null&&Or!==void 0?Or:0),0),frames_rendered:Math.max((qs=et?.framesRendered)!==null&&qs!==void 0?qs:0,0),frames_per_second:Math.max((Xc=et?.framesPerSecond)!==null&&Xc!==void 0?Xc:0,0),header_bytes_received:Math.max(((Zl=et?.headerBytesReceived)!==null&&Zl!==void 0?Zl:0)-((Jc=st?.headerBytesReceived)!==null&&Jc!==void 0?Jc:0),0),configured_jitter_buffer_min_delay_ms:Jn??0,jitter_buffer_min_obtainable_delay:Zb,jitter_buffer_delay_avg:Jb,key_frames_decoded:Math.max((($h=et?.keyFramesDecoded)!==null&&$h!==void 0?$h:0)-((Yu=st?.keyFramesDecoded)!==null&&Yu!==void 0?Yu:0),0),nack_count:Math.max(((Gh=et?.nackCount)!==null&&Gh!==void 0?Gh:0)-((Pf=st?.nackCount)!==null&&Pf!==void 0?Pf:0),0),packets_discarded:Math.max(((El=et?.packetsDiscarded)!==null&&El!==void 0?El:0)-((Yp=st?.packetsDiscarded)!==null&&Yp!==void 0?Yp:0),0),packets_lost:vy,packets_received:tS,pause_count:Math.max(((X0=et?.pauseCount)!==null&&X0!==void 0?X0:0)-((Ld=st?.pauseCount)!==null&&Ld!==void 0?Ld:0),0),pli_count:Math.max(((Kp=et?.pliCount)!==null&&Kp!==void 0?Kp:0)-((J0=st?.pliCount)!==null&&J0!==void 0?J0:0),0),power_efficient_decoder:(Xp=et?.powerEfficientDecoder)!==null&&Xp!==void 0&&Xp,total_freezes_duration:Math.max(((Jp=et?.totalFreezesDuration)!==null&&Jp!==void 0?Jp:0)-((Z0=st?.totalFreezesDuration)!==null&&Z0!==void 0?Z0:0),0),total_pauses_duration:Math.max(((Zp=et?.totalPausesDuration)!==null&&Zp!==void 0?Zp:0)-((Qp=st?.totalPausesDuration)!==null&&Qp!==void 0?Qp:0),0),sei_read_count:b,sei_bytes_received:S,sei_bitrate:QI,protocol:(em=Ot?.localCandidate)===null||em===void 0?void 0:em.protocol}})($,X,ue,me,dt,ce,de,Ae)))}}class Rx extends Xn{constructor(w,R,U,j,$,X,ue,me,ce){var de,Ae;super(Mn.SUBSCRIBED_AUDIO_STATS,w,R,!1),Object.assign(this.properties,Object.assign({action:Qt.SUBSCRIBE,node:(de=j?.node)!==null&&de!==void 0?de:"",cluster:(Ae=j?.cluster)!==null&&Ae!==void 0?Ae:"",remote_participant_id:U},((Me,rt,bt,ht,dt)=>{var et,st,Ot,En,Dn,Jn,b,S,N,V,ee,le,Ne,Qe,St,Lt,Kt,Xt;let vn=0;Me?.jitterBufferDelay&&Me?.jitterBufferEmittedCount&&Me.jitterBufferEmittedCount>0&&(vn=Me.jitterBufferDelay/Me.jitterBufferEmittedCount);const Zn=ht??1,Nr=Math.max((et=Me?.bytesReceived)!==null&&et!==void 0?et:0,0),Vi=8*Nr/Zn,Hi=Math.max((st=Me?.packetsLost)!==null&&st!==void 0?st:0,0),Tt=Math.max((Ot=Me?.packetsReceived)!==null&&Ot!==void 0?Ot:0,0),mt=Hi/Math.max(Tt+Hi,1),Mt=Math.max((En=Me?.concealedSamples)!==null&&En!==void 0?En:0,0),on=Math.max((Dn=Me?.totalSamplesReceived)!==null&&Dn!==void 0?Dn:0,0),$n=Mt/Math.max(on,1),Pr=mo(bt?.mimeType,bt?.sdpFmtpLine);return{audio_level:(Jn=Me?.audioLevel)!==null&&Jn!==void 0?Jn:0,audio_nacks_enabled:(b=dt?.audioNacks)!==null&&b!==void 0&&b,bytes_received:Nr,codec_mime_type:Pr?.mimeSubtype,connection_bandwidth:(N=(S=rt?.candidatePair)===null||S===void 0?void 0:S.availableIncomingBitrate)!==null&&N!==void 0?N:0,concealed_samples:Mt,concealment_events:Math.max((V=Me?.concealmentEvents)!==null&&V!==void 0?V:0,0),silent_concealed_samples:Math.max((ee=Me?.silentConcealedSamples)!==null&&ee!==void 0?ee:0,0),decode_bitrate:Vi,fraction_audio_concealed:$n,fraction_packets_lost:mt,header_bytes_received:Math.max((le=Me?.headerBytesReceived)!==null&&le!==void 0?le:0,0),inserted_samples_for_deceleration:Math.max((Ne=Me?.insertedSamplesForDeceleration)!==null&&Ne!==void 0?Ne:0,0),jitter_buffer_delay_avg:vn,packets_discarded:Math.max((Qe=Me?.packetsDiscarded)!==null&&Qe!==void 0?Qe:0,0),retransmitted_packets_received:Math.max((St=Me?.retransmittedPacketsReceived)!==null&&St!==void 0?St:0,0),retransmitted_bytes_received:Math.max((Lt=Me?.retransmittedBytesReceived)!==null&&Lt!==void 0?Lt:0,0),packets_lost:Hi,packets_received:Tt,nack_count:Math.max((Kt=Me?.nackCount)!==null&&Kt!==void 0?Kt:0,0),removed_samples_for_acceleration:Math.max((Xt=Me?.removedSamplesForAcceleration)!==null&&Xt!==void 0?Xt:0,0),total_samples_received:on}})($,X,ue,me,ce)))}}class kx extends Xn{constructor(w,R,U,j,$,X,ue,me,ce,de){var Ae,Me,rt,bt;super(Mn.SUBSCRIBED_AUDIO_STATS_WINDOW,w,R,!1);const ht=Math.max(((Ae=$?.timestamp)!==null&&Ae!==void 0?Ae:0)-((Me=X?.timestamp)!==null&&Me!==void 0?Me:0),0);Object.assign(this.properties,Object.assign({action:Qt.SUBSCRIBE,window_size_ms:ht,node:(rt=j?.node)!==null&&rt!==void 0?rt:"",cluster:(bt=j?.cluster)!==null&&bt!==void 0?bt:"",remote_participant_id:U},((dt,et,st,Ot,En,Dn,Jn)=>{var b,S,N,V,ee,le,Ne,Qe,St,Lt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,mt,Mt,on,$n,Pr,er,pr,ki,Or,qs,Xc,Zl,Jc,$h,Yu;let Gh=0,Pf=0;if(dt?.jitterBufferEmittedCount&&et?.jitterBufferEmittedCount&&dt.jitterBufferEmittedCount>et.jitterBufferEmittedCount){dt?.jitterBufferDelay&&et?.jitterBufferDelay&&(Gh=(dt.jitterBufferDelay-et.jitterBufferDelay)/(dt.jitterBufferEmittedCount-et.jitterBufferEmittedCount));const Qp=et?.jitterBufferMinimumDelay,em=dt?.jitterBufferMinimumDelay;Qp&&em&&(Pf=(em-Qp)/(dt.jitterBufferEmittedCount-et.jitterBufferEmittedCount))}const El=typeof En!="number"?1:En/1e3,Yp=Math.max(((b=dt?.bytesReceived)!==null&&b!==void 0?b:0)-((S=et?.bytesReceived)!==null&&S!==void 0?S:0),0),X0=8*Yp/El,Ld=Math.max(((N=dt?.packetsLost)!==null&&N!==void 0?N:0)-((V=et?.packetsLost)!==null&&V!==void 0?V:0),0),Kp=Math.max(((ee=dt?.packetsReceived)!==null&&ee!==void 0?ee:0)-((le=et?.packetsReceived)!==null&&le!==void 0?le:0),0),J0=Ld/Math.max(Kp+Ld,1),Xp=Math.max(((Ne=dt?.concealedSamples)!==null&&Ne!==void 0?Ne:0)-((Qe=et?.concealedSamples)!==null&&Qe!==void 0?Qe:0),0),Jp=Math.max(((St=dt?.totalSamplesReceived)!==null&&St!==void 0?St:0)-((Lt=et?.totalSamplesReceived)!==null&&Lt!==void 0?Lt:0),0),Z0=Xp/Math.max(Jp,1),Zp=mo(Ot?.mimeType,Ot?.sdpFmtpLine);return{audio_level:(Kt=dt?.audioLevel)!==null&&Kt!==void 0?Kt:0,audio_nacks_enabled:(Xt=Dn?.audioNacks)!==null&&Xt!==void 0&&Xt,bytes_received:Yp,codec_mime_type:Zp?.mimeSubtype,connection_bandwidth:(Zn=(vn=st?.candidatePair)===null||vn===void 0?void 0:vn.availableIncomingBitrate)!==null&&Zn!==void 0?Zn:0,decode_bitrate:X0,concealed_samples:Xp,concealment_events:Math.max(((Nr=dt?.concealmentEvents)!==null&&Nr!==void 0?Nr:0)-((Vi=et?.concealmentEvents)!==null&&Vi!==void 0?Vi:0),0),silent_concealed_samples:Math.max(((Hi=dt?.silentConcealedSamples)!==null&&Hi!==void 0?Hi:0)-((Tt=et?.silentConcealedSamples)!==null&&Tt!==void 0?Tt:0),0),fraction_audio_concealed:Z0,fraction_packets_lost:J0,header_bytes_received:Math.max(((mt=dt?.headerBytesReceived)!==null&&mt!==void 0?mt:0)-((Mt=et?.headerBytesReceived)!==null&&Mt!==void 0?Mt:0),0),inserted_samples_for_deceleration:Math.max(((on=dt?.insertedSamplesForDeceleration)!==null&&on!==void 0?on:0)-(($n=et?.insertedSamplesForDeceleration)!==null&&$n!==void 0?$n:0),0),configured_jitter_buffer_min_delay_ms:Jn??0,jitter_buffer_min_obtainable_delay:Pf,jitter_buffer_delay_avg:Gh,packets_discarded:Math.max(((Pr=dt?.packetsDiscarded)!==null&&Pr!==void 0?Pr:0)-((er=et?.packetsDiscarded)!==null&&er!==void 0?er:0),0),packets_lost:Ld,packets_received:Kp,nack_count:Math.max(((pr=dt?.nackCount)!==null&&pr!==void 0?pr:0)-((ki=et?.nackCount)!==null&&ki!==void 0?ki:0),0),removed_samples_for_acceleration:Math.max(((Or=dt?.removedSamplesForAcceleration)!==null&&Or!==void 0?Or:0)-((qs=et?.removedSamplesForAcceleration)!==null&&qs!==void 0?qs:0),0),retransmitted_packets_received:Math.max(((Xc=dt?.retransmittedPacketsReceived)!==null&&Xc!==void 0?Xc:0)-((Zl=et?.retransmittedPacketsReceived)!==null&&Zl!==void 0?Zl:0),0),retransmitted_bytes_received:Math.max(((Jc=dt?.retransmittedBytesReceived)!==null&&Jc!==void 0?Jc:0)-(($h=et?.retransmittedBytesReceived)!==null&&$h!==void 0?$h:0),0),total_samples_received:Jp,protocol:(Yu=st?.localCandidate)===null||Yu===void 0?void 0:Yu.protocol}})($,X,ue,me,ht,ce,de)))}}class x_ extends Xn{constructor(w,R,U,j,$=Qt.PUBLISH,X=!1,ue=""){super(Mn.SIMULCAST_LAYER_INFO,w,R,!1),Object.assign(this.properties,{rid:U,active:j,selected:X,source:$===Qt.PUBLISH?"publisher":"subscriber",remote_participant_id:ue})}}const Hp=P=>{console.warn(`[IVS Stages] ${P}`)};var $p,Gp,Cf;(function(P){P.Mobile="mobile",P.Tablet="tablet",P.Desktop="desktop",P.Tv="tv"})($p||($p={})),(function(P){P.IOS="iOS",P.MacOS="macOS",P.Windows="Windows",P.Android="Android"})(Gp||(Gp={})),(function(P){P.Safari="Safari",P.Firefox="Firefox",P.Chrome="Chrome",P.IE="Internet Explorer",P.Edge="Microsoft Edge"})(Cf||(Cf={}));const Bh=(function(P){const w=Rf(P);return{platform:{isMobile:w_($p.Mobile,w),isTablet:w_($p.Tablet,w),isDesktop:w_($p.Desktop,w),isTv:w_($p.Tv,w)},os:{name:Ox(w),version:Mx(w),isIOS:L0(Gp.IOS,w),isMacOS:L0(Gp.MacOS,w),isWindows:L0(Gp.Windows,w),isAndroid:L0(Gp.Android,w)},browser:{name:Ix(w),version:Fb(w),isSafari:U0(Cf.Safari,w),isFirefox:U0(Cf.Firefox,w),isChrome:U0(Cf.Chrome,w),isIE:U0(Cf.IE,w),isEdge:U0(Cf.Edge,w)}}})(window.navigator.userAgent);function Rf(P){try{return qr.getParser(P||window.navigator.userAgent)}catch{}}function w_(P,w){return()=>(w||(w=Rf()),!(!w||w.getPlatformType(!0)!==P.toLowerCase()))}function Mx(P){return()=>(P||(P=Rf()),P&&P.getOSVersion()||"")}function Ox(P){return()=>(P||(P=Rf()),P&&P.getOSName()||"")}function L0(P,w){return()=>(w||(w=Rf()),!(!w||w.getOSName(!0)!==P.toLowerCase()))}function Fb(P){return()=>(P||(P=Rf()),P&&P.getBrowserVersion()||"")}function Ix(P){return()=>(P||(P=Rf()),P&&P.getBrowserName()||"")}function U0(P,w){return()=>(w||(w=Rf()),!(!w||w.getBrowserName().toLowerCase()!==P.toLowerCase()))}const jb={name:"SimulcastUnsupported",message:`Simulcast is only supported on Chromium browsers at bitrates over ${gl.MID.maxBitrateKbps}Kbps`,code:100},Fh={name:"SimulcastLayerInvalidType",message:"Layer configuration is invalid: ",code:101},zb={name:"SimulcastMaxLayersExceeded",message:"No more than 3 simulcast layers may be configured",code:102},Vb={name:"SimulcastDuplicateLayersConfigured",message:"Two duplicate layers are configured. At minimum bitrate, framerate, or dimensions must differ",code:103},B0={name:"SimulcastMaxLayerBitrateExceeded",message:`maxBitrateKbps cannot exceed ${Uu} Kbps`,code:105},oy={name:"SimulcastMinLayerBitrateExceeded",message:`maxBitrateKbps cannot be less than ${Af} Kbps`,code:106},ay={name:"SimulcastMaxLayerFramerateExceeded",message:`maxFramerate cannot exceed ${Fu} fps`,code:107},T_={name:"SimulcastMinLayerFramerateExceeded",message:`maxFramerate cannot be less than ${Bu} fps`,code:108},A_={name:"SimulcastMaxLayerDimensionsExceeded",message:`dimensions cannot exceed max resolution of ${Ad}x720`,code:109},cy={name:"SimulcastMinLayerDimensionsExceeded",message:`width or height cannot be lower than ${zp}`,code:110},ly={name:"SimulcastLayerConfigurationConflict",message:"Layer configuration conflict: ",code:111},Hb={name:"SimulcastLayerOrientationMismatch",message:"Layer orientation different from input video track: ",code:112},F0={name:"SimulcastLayerInputResolutionInsufficient",message:"Input video resolution is lower than the configured layer: ",code:113},j0={name:"SimulcastLayerInputFramerateInsufficient",message:"Input video framerate is lower than the configured layer: ",code:114};class Do extends Error{constructor({name:w,message:R,code:U,details:j,cause:$,params:X}){super(R),Error.captureStackTrace&&Error.captureStackTrace(this,Do),this.name=w,this.message=R,this.code=U,this.details=j,this.cause=$,this.params=X}}const z0=P=>({rid:P.rid,active:P.active,scaleResolutionDownBy:P.scaleFactor,maxBitrate:P.maxBitrateBps,maxFramerate:P.maxFramerate}),$b=(P,w)=>P.width*P.height>w.width*w.height||P.maxBitrateKbps>w.maxBitrateKbps||P.maxFramerate>w.maxFramerate?1:_l(P,w)?0:-1,_l=(P,w)=>{if(typeof P!="object"||typeof w!="object")return!1;const R=Object.keys(P);for(const U of R)if(P[U]!==w[U])return!1;return!0},Gc=P=>{const{width:w,height:R}=V0(P);return w*R},V0=P=>{const{height:w,width:R}=P;let U=Ad/I0,j=Ad;return w!==void 0&&(U=w),R!==void 0&&(j=R),w&&!R&&(j=w*I0),!w&&R&&(U=R/I0),{height:U,width:j}},uy=P=>{const{width:w,height:R}=P;return w/R>=1?Ep.LANDSCAPE:Ep.PORTRAIT},Wc=(P,w,R)=>{var U;const j=(U=P.getSettings().frameRate)!==null&&U!==void 0?U:Fu;return Object.assign(Object.assign({},R),{active:!0,height:w.height,width:w.width,maxBitrateBps:Gl(w.maxBitrateKbps),maxFramerate:Math.min(w.maxFramerate,j),scaleFactor:Ur(w,P)})},Ur=(P,w)=>{const R=Gc(w.getSettings()),U=Gc(P);if(U>=R)return 1;const j=1/Math.sqrt(U/R);return Math.max(j,1)},Nx=P=>{if(typeof P!="object"){const w=Object.assign({},Fh);throw w.message+=" is not an object",new Do(w)}},Ja=(P,w)=>{if(typeof P!="number"){const R=Object.assign({},Fh);throw R.message+="maxBitrateKbps is not a number",new Do(R)}if(P<Af)throw new Do(Object.assign({},oy));if(P>Uu)throw new Do(Object.assign({},B0));if(w&&P>w){const R=Object.assign({},ly);throw R.message+=`maxBitrateKbps cannot be greater than stage maxVideoBitrateKbps of ${w}`,new Do(R)}},Js=(P,w)=>{if(typeof P!="number"){const R=Object.assign({},Fh);throw R.message+="maxFramerate is not a number",new Do(R)}if(P<Bu)throw new Do(Object.assign({},T_));if(P>Fu)throw new Do(Object.assign({},ay));if(w&&P>w){const R=Object.assign({},ly);throw R.message+=`maxFramerate cannot be greater than stage maxFramerate of ${w} `,new Do(R)}},kf=(P,w)=>{var R;if(typeof P!="number"||typeof w!="number"){const $=Object.assign({},Fh);throw $.message+="width and height must be numbers",new Do($)}if(P<zp||w<zp)throw new Do(Object.assign({},cy));const U=(R=Bc("enable1080pResolution"))!==null&&R!==void 0&&R,j=U?1920:Ad;if(P>j||w>j)throw new Do(Object.assign({},A_));if(P*w>(U?2073600:Uh))throw new Do(Object.assign({},A_))},Px=(P,w)=>{const R=V0(w.getSettings()),U=uy(R);U!==uy(P)&&Hp(`${Hb.message}forcing orientation to ${U}`)},hy=(P,w)=>{var R,U,j,$,X;let ue=(0,ji.cloneDeep)(w);const me=(R=ue.simulcast)!==null&&R!==void 0?R:{},ce=!Bh.browser.isChrome()&&!Bh.browser.isEdge(),de=(j=(U=P.getSettings())===null||U===void 0?void 0:U.displaySurface)!==null&&j!==void 0&&j,Ae=($=ue.maxVideoBitrateKbps)!==null&&$!==void 0?$:Uu,Me=!(Array.isArray((X=w.simulcast)===null||X===void 0?void 0:X.layers)||!w.maxVideoBitrateKbps)&&Ae<gl.MID.maxBitrateKbps;if(typeof me.enabled=="boolean"&&me.enabled&&(ce||de||Me)){ue.simulcast={enabled:!1};const{name:rt,message:bt}=jb;Hp(`${rt}${bt}, disabling the feature`)}return ue=((rt,bt)=>{var ht,dt;const et=bt,st=(ht=bt.simulcast)===null||ht===void 0?void 0:ht.layers;if(st===void 0)return et;if(!Array.isArray(st)){const Ot=Object.assign({},Fh);throw Ot.message+=" layers is not an array",new Do(Ot)}if(st.length===0)return(dt=et.simulcast)===null||dt===void 0||delete dt.layers,et;if(st.length>3)throw new Do(Object.assign({},zb));if((0,ji.uniqWith)(st,_l).length!==st.length)throw new Do(Object.assign({},Vb));for(const Ot of st)Nx(Ot),Ja(Ot.maxBitrateKbps,bt.maxVideoBitrateKbps),Js(Ot.maxFramerate,bt.maxFramerate),kf(Ot.width,Ot.height),Px(Ot,rt);return et})(P,ue),ue};function vl(P){return P.track.kind===fl.AUDIO}function C_(P){return P.track.kind===fl.VIDEO&&typeof P.config=="object"}function Gs(P){if(P!==void 0&&(P<Af||P>Uu))throw new Error(`Stage bitrate must be a number between ${Af} kbps and ${Uu} kbps inclusive`)}function gs(P){return P!==void 0&&("maxBitrate"in P||"maxVideoBitrateKbps"in P||"maxFramerate"in P||"simulcast"in P||"inBandMessaging"in P||"minBitrate"in P)}function Zs(P,w){if(w===void 0)return w;let R=(0,ji.cloneDeep)(w);return gs(R)?(R.maxBitrate!==void 0&&(R.maxVideoBitrateKbps=R.maxBitrate,Hp("maxBitrate is deprecated in favor of maxVideoBitrateKbps")),R=hy(P,R),Gs(R.maxVideoBitrateKbps),Gs(R.minBitrate),(function(U){if(U!==void 0&&(U>Fu||U<Bu))throw new Error(`Stage framerate must be between ${Bu} fps and ${Fu} fps inclusive`)})(R.maxFramerate),(function(U){if(U!==void 0){if(typeof U!="object")throw new Error("In-band messaging config must be an object");if(typeof U.enabled!="boolean")throw new Error("In-band messaging config enabled property must be a boolean")}})(R.inBandMessaging)):((function(U){if(U!==void 0&&(U<N0||U>Vp))throw new Error(`Stage audio bitrate must be between ${N0} Kbps and ${Vp} Kbps inclusive`)})(R.maxAudioBitrateKbps),(function(U){if(U!==void 0&&typeof U!="boolean")throw new Error("Stage stereo prop must be a boolean")})(R.stereo)),R}const fy=(P,w,R)=>{var U;const j={[hl.HI]:Lh(hl.HI),[hl.MID]:Lh(hl.MID),[hl.LOW]:Lh(hl.LOW)},$=w.simulcast,X=R?.simulcast;let ue=$.layers.sort($b);const me=(U=X?.layers)!==null&&U!==void 0?U:[],ce=ue.length,de=me.length;return ue=ue.map((Ae=>{((rt,bt)=>{const{width:ht,height:dt}=V0(bt.getSettings()),{width:et,height:st}=rt;if(et*st>ht*dt){const Ot=`forcing layer of ${et}x${st} to the input dimensions ${ht}x${dt}`,{name:En,message:Dn}=F0;Hp(`${En}${Dn}${Ot}`)}})(Ae,P),((rt,bt)=>{var ht;const dt=(ht=bt.getSettings().frameRate)!==null&&ht!==void 0?ht:Fu,et=rt.maxFramerate;if(et>dt){const st=`forcing layer of ${et}fps to the input framerate of ${dt}`,{name:Ot,message:En}=j0;Hp(`${Ot}${En}${st}`)}})(Ae,P);let Me=((rt,bt)=>{const{maxVideoBitrateKbps:ht}=bt,dt=rt;return ht&&rt.maxBitrateKbps>ht&&(dt.maxBitrateKbps=ht),dt})(Ae,w);return Me=((rt,bt)=>{const{maxFramerate:ht}=bt,dt=rt;return ht&&rt.maxFramerate>ht&&(dt.maxFramerate=ht),dt})(Ae,w),Me})),(de===0||de===3)&&ce===3?(j.hi=Wc(P,ue[2],j.hi),j.mid=Wc(P,ue[1],j.mid),j.low=Wc(P,ue[0],j.low),xn.ok(j)):de===1&&ce===1?(j.hi=Wc(P,ue[0],j.hi),xn.ok(j)):de===2&&ce===2?(j.hi=Wc(P,ue[1],j.hi),j.low=Wc(P,ue[0],j.low),xn.ok(j)):xn.err(null)},dy=(P,w,R)=>{const U=w.simulcast,j=w.inBandMessaging,$=Gl(w.minBitrate),X=Gl(w.maxVideoBitrateKbps),ue=w.maxFramerate;let me=[{maxBitrate:X,maxFramerate:ue}];const ce=fy(P,w,R??{});return U.enabled&&ce.ok&&(me=(de=>{const{hi:Ae,mid:Me,low:rt}=de;return[z0(rt),z0(Me),z0(Ae)]})(ce.value)),{track:P,config:{minBitrateBps:$,maxBitrateBps:X,maxFramerate:ue,inBandMessagingEnabled:j.enabled,simulcastEnabled:U.enabled,simulcastLayers:ce.ok?ce.value:void 0,encodingLayers:me}}},Wl=P=>{const w=P.mediaStreamTrack,R=P.normalizedConfig;let U={};const j=P.validatedExternalConfig;return gs(j)&&(U=j),(function($){return $.kind===fl.AUDIO})(w)?(($,X)=>{const ue={maxBitrateBps:Gl(X.maxAudioBitrateKbps)},me=X?.stereo;return typeof me=="boolean"&&(ue.stereo=me),{track:$,config:ue}})(w,R):dy(w,R,U)},H0=(P,w)=>{const R={minBitrate:Af,maxBitrate:Uu,maxVideoBitrateKbps:Uu,maxFramerate:Fu,simulcast:{enabled:!1,layers:[Object.assign({},gl.HI),Object.assign({},gl.MID),Object.assign({},gl.LOW)]},maxAudioBitrateKbps:P0,stereo:!1,inBandMessaging:{enabled:!1}},U=(0,ji.cloneDeep)(w),j=Object.assign(Object.assign({},R),U);return gs(U)&&(U.simulcast&&(j.simulcast=Object.assign(Object.assign({},R.simulcast),U.simulcast)),U.inBandMessaging&&(j.inBandMessaging=Object.assign(Object.assign({},R.inBandMessaging),U.inBandMessaging))),j},zu=(P,w)=>{if(typeof P=="number")return P;const R=w?Cb:ju;return R[P]!==void 0?R[P]:0};class jh extends Xn{constructor(w,R,U,j){super(Mn.MULTIHOST_CONFIGURATION,w,R,!1),Object.assign(this.properties,Object.assign(Object.assign({},U),{action:j}))}}class Ss extends Xn{constructor(w,R,U,j,$){super(Mn.MULTIHOST_SUBSCRIBE_CONFIGURATION,w,R,!1);const X={trigger:U,remote_participant_id:j,min_delay_when_publishing:zu($.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:zu($.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:$.inBandMessaging.enabled,simulcast_initial_layer_preference:$.simulcast.initialLayerPreference,simulcast_layer_poll_interval_ms:$.simulcast.layerPollingIntervalMs,simulcast_layer_poll_enabled:$.simulcast.layerPollingEnabled};Object.assign(this.properties,X)}}var Vu=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class R_{constructor(w,R,U,j,$){this.analyticsTracker=$,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new fi(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=R_.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.seiStats={seiReadCnt:0,seiBytesRead:0,seiWriteCnt:0,seiBytesWritten:0},this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0},this.vidNetworkQualityMap=new Map,this.audioNetworkQualityMap=new Map,this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case hr.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case hr.FAILED:this.flushStats()}},this.action=w,this.token=R,this.traceId=U,this.identifier=j}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:Gl(Vp),hi_video_layer:"",mid_video_layer:"",low_video_layer:""}}set sdpAnswer(w){try{this.sdp=new fi(w),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(w,R=!1){this.peerConnection=w,this.simulcastEnabled=R,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var w;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(w=this.peerConnection)===null||w===void 0||w.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(w){this.sfuResource=w}updateMultihostConfiguration(w,R){var U,j,$,X,ue,me,ce,de,Ae;return Vu(this,void 0,void 0,(function*(){if(this.action!==Qt.PUBLISH||!this.peerConnection)return;const Me=R_.defaultMultihostConfiguration();if(R){const rt=this.peerConnection.getSenders().filter((dt=>dt.track!==null&&dt.track.kind==="video"));let bt="unknown";rt.length>0&&(yield rt[0].getStats()).forEach((dt=>{if(dt.type==="codec"&&(Me.video_codec=dt.mimeType,dt.sdpFmtpLine)){const et=dt.sdpFmtpLine.match(/profile-level-id=([a-f0-9]+)/);et&&et.length>0&&(bt=et[1])}}));const ht=R.track.getSettings();Me.width=(U=ht.width)!==null&&U!==void 0?U:0,Me.height=(j=ht.height)!==null&&j!==void 0?j:0,Me.target_fps=($=ht.frameRate)!==null&&$!==void 0?$:0,R.config?(Me.max_bitrate=R.config.maxBitrateBps,Me.min_bitrate=R.config.minBitrateBps,Me.enable_simulcast=R.config.simulcastEnabled):(Me.max_bitrate=Gl(Uu),Me.min_bitrate=Gl(Af),Me.enable_simulcast=!1),R.config.simulcastEnabled&&(Me.hi_video_layer=this.mapLayerToMetric(bt,(X=R.config.simulcastLayers)===null||X===void 0?void 0:X.hi),Me.mid_video_layer=this.mapLayerToMetric(bt,(ue=R.config.simulcastLayers)===null||ue===void 0?void 0:ue.mid),Me.low_video_layer=this.mapLayerToMetric(bt,(me=R.config.simulcastLayers)===null||me===void 0?void 0:me.low))}if(w){const rt=w.track.getSettings();Me.auto_gain=(ce=rt.autoGainControl)!==null&&ce!==void 0&&ce,Me.echo_cancellation=(de=rt.echoCancellation)!==null&&de!==void 0&&de,Me.noise_suppression=(Ae=rt.noiseSuppression)!==null&&Ae!==void 0&&Ae,Me.max_audio_bitrate_bps=w.config.maxBitrateBps,Me.stereo=w.config.stereo}(0,ji.isEqual)(Me,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new jh(this.token,this.traceId,Me,this.action)),this.multihostConfiguration=Me)}))}resetTransformers(w,R){this.senderVideoTransformer=R,this.receiveVideoTransformer=w,this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0}}getStats(w){var R;return Vu(this,void 0,void 0,(function*(){const U=yield(R=this.peerConnection)===null||R===void 0?void 0:R.getStats(w),{action:j}=this;if(U)if(w.kind==="audio"){if(j===Qt.PUBLISH)return{action:j,rawReport:U,stats:Ob(U,this.audioNetworkQualityMap)};if(j===Qt.SUBSCRIBE)return{action:j,rawReport:U,stats:Ib(U,this.audioNetworkQualityMap)}}else{if(j===Qt.PUBLISH)return{action:j,rawReport:U,stats:ry(U,this.vidNetworkQualityMap)};if(j===Qt.SUBSCRIBE)return{action:j,rawReport:U,stats:Nb(U,this.vidNetworkQualityMap)}}}))}mapLayerToMetric(w,R){return!R||!R.active?"":`${`${R.height}x${R.width}`}_${`${R.maxFramerate}fps`}_${R.maxBitrateBps/1e3+"kbps"}_${w}`}updateJitterBufferMinDelay(w){this.jitterBufferMinDelayInMs=w}setupIntervals(){this.action===Qt.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(w,R){return setInterval(w.bind(this),R)}getConnectionState(){var w;if(!this.peerConnection)return hr.NONE;const R=(w=this.peerConnection.connectionState)!==null&&w!==void 0?w:this.peerConnection.iceConnectionState;try{return Zg(R)}catch{return hr.IDLE}}pollSimulcastLayers(){var w;return Vu(this,void 0,void 0,(function*(){if(this.getConnectionState()===hr.CONNECTED){const R=yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats();if(!R)return;R.forEach((U=>{var j;if(U.type==="outbound-rtp"){const $=((j=U.framesPerSecond)!==null&&j!==void 0?j:0)!==0;switch(U.rid){case"low":$!==this.simulcastState.low&&(this.simulcastState.low=$,this.analyticsTracker.trackEventNoSharedProps(new x_(this.token,this.traceId,U.rid,$)));break;case"mid":$!==this.simulcastState.mid&&(this.simulcastState.mid=$,this.analyticsTracker.trackEventNoSharedProps(new x_(this.token,this.traceId,U.rid,$)));break;case"hi":$!==this.simulcastState.hi&&(this.simulcastState.hi=$,this.analyticsTracker.trackEventNoSharedProps(new x_(this.token,this.traceId,U.rid,$)))}}}))}}))}flushStats(){var w;return Vu(this,void 0,void 0,(function*(){const R=yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats();R&&(this.action===Qt.PUBLISH?this.uploadPublisherStats(R):this.action===Qt.SUBSCRIBE&&this.uploadSubscriberStats(R))}))}uploadStats(){var w;return Vu(this,void 0,void 0,(function*(){if(this.getConnectionState()===hr.CONNECTED){const R=yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats();if(!R)return;this.action===Qt.PUBLISH?this.uploadPublisherStats(R):this.action===Qt.SUBSCRIBE&&this.uploadSubscriberStats(R)}}))}uploadPublisherStats(w){var R,U;const j={audio:{},video:[],candidateStats:{}},$=new Map,X=(Date.now()-this.connectionStartedTimestamp)/1e3,ue=Object.assign({},this.multihostConfiguration),{seiWriteCnt:me,seiBytesWritten:ce}=this.updateAndDiffSeiPublishStatsSinceLastUpdate((R=this.senderVideoTransformer)===null||R===void 0?void 0:R.getSenderStats());if(this.seiStats.seiWriteCnt+=me,this.seiStats.seiBytesWritten+=ce,w.forEach((de=>{if(de.type==="outbound-rtp"){const Ae=w.get(de.remoteId),Me=this.prevRemoteInboundStats.get(de.remoteId);switch(Ae&&this.prevRemoteInboundStats.set(Ae.id,Ae),de.kind){case"audio":j.audio=this.updateOutboundAudio(de),j.audio.remoteInbound=Ae,j.audio.prevRemoteInbound=Me,j.audio.codec=$.get(de.codecId);break;case"video":j.video.push(Object.assign({},this.updateOutboundVideo(de),{remoteInbound:Ae,prevRemoteInbound:Me,codec:$.get(de.codecId)}))}}de.type==="candidate-pair"&&de.nominated&&(j.candidateStats.candidatePair=de,j.candidateStats.localCandidate=w.get(de.localCandidateId),j.candidateStats.remoteCandidate=w.get(de.remoteCandidate)),de.type==="codec"&&$.set(de.id,de)})),j.video.forEach((de=>{var Ae,Me;const{outbound:rt,prevOutbound:bt}=de;if(!rt)return;const ht=(Me=(Ae=de.outbound)===null||Ae===void 0?void 0:Ae.rid)!==null&&Me!==void 0?Me:Se;this.updateNetworkQualityPublish(ht,this.vidNetworkQualityMap,rt,bt)})),j.audio.outbound){const de=(U=j.audio.outbound.rid)!==null&&U!==void 0?U:Se;this.updateNetworkQualityPublish(de,this.audioNetworkQualityMap,j.audio.outbound,j.audio.prevOutbound)}this.analyticsTracker.trackEventNoSharedProps(new Ub(this.token,this.traceId,this.sfuResource,j.audio.outbound,j.audio.remoteInbound,j.candidateStats,j.audio.codec,ue,X,this.sdpFeatures)),j.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new sy(this.token,this.traceId,this.sfuResource,j.audio.outbound,j.audio.prevOutbound,j.audio.remoteInbound,j.audio.prevRemoteInbound,j.candidateStats,j.audio.codec,ue,this.sdpFeatures)),j.video.forEach((de=>{this.analyticsTracker.trackEventNoSharedProps(new E_(this.token,this.traceId,this.sfuResource,de.outbound,de.remoteInbound,j.candidateStats,de.codec,ue,X)),de.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Lb(this.token,this.traceId,this.sfuResource,de.outbound,de.prevOutbound,de.remoteInbound,de.prevRemoteInbound,j.candidateStats,de.codec,ue,this.seiStats.seiWriteCnt,this.seiStats.seiBytesWritten))}))}updateNetworkQualityPublish(w,R,U,j){var $,X,ue,me;let ce=0;const de=Io.getNetworkQuality(),Ae=($=U.packetsSent)!==null&&$!==void 0?$:0,Me=(X=U.nackCount)!==null&&X!==void 0?X:0;if(j)if(de===uo.DOWN)R.set(w,uo.DOWN);else{ce=(Me-((ue=j?.nackCount)!==null&&ue!==void 0?ue:0))/(Ae-((me=j?.packetsSent)!==null&&me!==void 0?me:0));const rt=this.convertLostRatioToQuality(ce);R.set(w,rt)}else R.set(w,de)}updateNetworkQualitySubscribe(w,R,U){var j,$,X,ue;let me=0;const ce=Io.getNetworkQuality(),de=(j=R?.packetsReceived)!==null&&j!==void 0?j:0,Ae=($=R?.nackCount)!==null&&$!==void 0?$:0;if(!R)return;const Me=R.id;if(Me)if(U)if(ce===uo.DOWN)w.set(Me,uo.DOWN);else{me=(Ae-((X=U?.nackCount)!==null&&X!==void 0?X:0))/(de-((ue=U?.packetsReceived)!==null&&ue!==void 0?ue:0));const rt=this.convertLostRatioToQuality(me);w.set(Me,rt)}else w.set(Me,ce)}uploadSubscriberStats(w){var R,U;const j={audio:{},video:{},candidateStats:{}},$=new Map,X=(Date.now()-this.connectionStartedTimestamp)/1e3,ue=(R=this.jitterBufferMinDelayInMs)!==null&&R!==void 0?R:0,{seiReadCnt:me,seiBytesRead:ce}=this.updateAndDiffSeiSubscribeStatsSinceLastUpdate((U=this.receiveVideoTransformer)===null||U===void 0?void 0:U.getReceiverStats());this.seiStats.seiReadCnt+=me,this.seiStats.seiBytesRead+=ce,w.forEach((de=>{if(de.type==="inbound-rtp")switch(de.kind){case"audio":j.audio=this.updateInboundAudio(de),j.audio.codec=$.get(de.codecId),this.updateNetworkQualitySubscribe(this.audioNetworkQualityMap,j.audio.inbound,j.audio.prevInbound);break;case"video":j.video=this.updateInboundVideo(de),j.video.codec=$.get(de.codecId),this.updateNetworkQualitySubscribe(this.vidNetworkQualityMap,j.video.inbound,j.video.prevInbound)}de.type==="candidate-pair"&&de.nominated&&(j.candidateStats.candidatePair=de,j.candidateStats.localCandidate=w.get(de.localCandidateId),j.candidateStats.remoteCandidate=w.get(de.remoteCandidate)),de.type==="codec"&&$.set(de.id,de)})),this.analyticsTracker.trackEventNoSharedProps(new Rx(this.token,this.traceId,this.identifier,this.sfuResource,j.audio.inbound,j.candidateStats,j.audio.codec,X,this.sdpFeatures)),j.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new kx(this.token,this.traceId,this.identifier,this.sfuResource,j.audio.inbound,j.audio.prevInbound,j.candidateStats,j.audio.codec,this.sdpFeatures,ue)),this.analyticsTracker.trackEventNoSharedProps(new D0(this.token,this.traceId,this.identifier,this.sfuResource,j.video.inbound,j.candidateStats,j.video.codec,X)),j.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new Bb(this.token,this.traceId,this.identifier,this.sfuResource,j.video.inbound,j.video.prevInbound,j.candidateStats,j.video.codec,ue,this.seiStats.seiReadCnt,this.seiStats.seiBytesRead))}updateAndDiffSeiSubscribeStatsSinceLastUpdate(w){const R=this.prevVideoReceiverTransformerStats;if(!w)return{seiReadCnt:R.seiReadCnt,seiBytesRead:R.seiBytesRead};const U=w.seiReadCnt-R.seiReadCnt,j=w.seiBytesRead-R.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:w.seiReadCnt,seiBytesRead:w.seiBytesRead},{seiReadCnt:U,seiBytesRead:j}}updateAndDiffSeiPublishStatsSinceLastUpdate(w){const R=this.prevVideoSenderTransformerStats;if(!w)return{seiWriteCnt:R.seiWriteCnt,seiBytesWritten:R.seiBytesWritten};const U=w.seiWriteCnt-R.seiWriteCnt,j=w.seiBytesWritten-R.seiBytesWritten;return this.prevVideoSenderTransformerStats={seiWriteCnt:w.seiWriteCnt,seiBytesWritten:w.seiBytesWritten},{seiWriteCnt:U,seiBytesWritten:j}}updateOutboundAudio(w){const R=w,U=this.prevOutboundAudioStats,j=w.id===U?.id?U:void 0;return this.prevOutboundAudioStats=w,{outbound:R,prevOutbound:j}}updateInboundAudio(w){const R=w,U=this.prevInboundAudioStats,j=w.id===U?.id?U:void 0;return this.prevInboundAudioStats=w,{inbound:R,prevInbound:j}}updateInboundVideo(w){const R=w,U=this.prevInboundVideoStats.get(Se),j=w.id===U?.id?U:void 0;return this.prevInboundVideoStats.set(Se,w),{inbound:R,prevInbound:j}}updateOutboundVideo(w){const R=w,U=this.getPrevOutboundVideo(w),j=w.id===U?.id?U:void 0;return this.setPrevVideoStat(w),{outbound:R,prevOutbound:j}}getPrevOutboundVideo(w){return this.simulcastEnabled&&w.rid&&this.prevOutboundVideoStats.has(w.rid)?this.prevOutboundVideoStats.get(w.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(Se)?this.prevOutboundVideoStats.get(Se):void 0}setPrevVideoStat(w){this.simulcastEnabled&&w.rid?this.prevOutboundVideoStats.set(w.rid,w):this.simulcastEnabled||this.prevOutboundVideoStats.set(Se,w)}convertLostRatioToQuality(w){return w<=0?uo.EXCELLENT:w<=.01?uo.GOOD:w<=.03?uo.NORMAL:w<=.1?uo.POOR:uo.DOWN}}class $0 extends Xn{constructor(w,R,U,j,$){super(Mn.MINUTE,w,R,!1),Object.assign(this.properties,{action:j?Qt.PUBLISH:Qt.SUBSCRIBE,is_publishing:j,minutes_logged:U,subscribed_number:$})}}class G0 extends Xn{constructor(w){super(Mn.PUBLISH,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.PUBLISH,remote_participant_id:w.token.participantID})}}class yl extends Xn{constructor(w){super(Mn.UNPUBLISH,w.token,w.traceId,!0),Object.assign(this.properties,{action:Qt.PUBLISH,remote_participant_id:w.token.participantID})}}class Br extends Xn{constructor(w){var R,U,j,$;super(Mn.SUBSCRIBE,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:w.subscribedId,subscribed_id:w.subscribedId,is_edp_connected:w.isEdpConnected,is_reassignment:w.isReassignment,node:(U=(R=w.preAttemptSfuResource)===null||R===void 0?void 0:R.node)!==null&&U!==void 0?U:"",cluster:($=(j=w.preAttemptSfuResource)===null||j===void 0?void 0:j.cluster)!==null&&$!==void 0?$:""})}}class k_ extends Xn{constructor(w){super(Mn.UNSUBSCRIBE,w.token,w.traceId,!0),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:w.unsubscribedId,unsubscribed_id:w.unsubscribedId})}}class bl extends Xn{constructor(w){var R,U,j,$;super(Mn.PUBLISH_STARTED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.PUBLISH,options_duration:w.optionsDuration,post_duration:w.postDuration,remote_participant_id:w.token.participantID,time_to_candidate:w.timeToCandidate,total_duration:w.totalDuration,edp_initial_connect_duration:w.edpInitialConnectDuration,edp_initial_connect_retry_times:w.edpInitialConnectRetries,edp_initial_state_duration:w.edpInitialStateDuration,edp_state_update_count:w.edpStateUpdateCount,sdp_exchange_duration:w.sdpExchangeDuration,sdp_exchange_transport:w.sdpExchangeTransport,set_remote_desc_duration:w.setRemoteDescDuration,peer_connection_duration:w.peerConnectionDuration,node:(U=(R=w.sfuResource)===null||R===void 0?void 0:R.node)!==null&&U!==void 0?U:"",cluster:($=(j=w.sfuResource)===null||j===void 0?void 0:j.cluster)!==null&&$!==void 0?$:"",publish_retry_times:w.publishRetries,total_duration_with_retries:w.totalDurationWithRetries,protocol:w.protocol})}}class Gb extends Xn{constructor(w){super(Mn.PUBLISH_FAILED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.PUBLISH,code:w.code,message:w.message,fatal:w.fatal,nominal:w.nominal,protocol:w.protocol})}}class Fr extends Xn{constructor(w){super(Mn.PUBLISH_ENDED,w.token,w.traceId,!0),Object.assign(this.properties,{action:Qt.PUBLISH,remote_participant_id:w.token.participantID,unpublish_successful:w.isUnpublishSuccessful,reason:w.reason,protocol:w.protocol})}}class Wb extends Xn{constructor(w){var R,U,j,$;super(Mn.SUBSCRIBE_STARTED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.SUBSCRIBE,options_duration:w.optionsDuration,post_duration:w.postDuration,remote_participant_id:w.remoteParticipantId,time_to_candidate:w.timeToCandidate,total_duration:w.totalDuration,edp_initial_connect_duration:w.edpInitialConnectDuration,edp_initial_connect_retry_times:w.edpInitialConnectRetries,edp_initial_state_duration:w.edpInitialStateDuration,edp_initial_state_publishing_count:w.edpInitialStatePublishingCount,edp_state_update_count:w.edpStateUpdateCount,sdp_exchange_duration:w.sdpExchangeDuration,sdp_exchange_transport:w.sdpExchangeTransport,set_remote_desc_duration:w.setRemoteDescDuration,peer_connection_duration:w.peerConnectionDuration,node:(U=(R=w.sfuResource)===null||R===void 0?void 0:R.node)!==null&&U!==void 0?U:"",cluster:($=(j=w.sfuResource)===null||j===void 0?void 0:j.cluster)!==null&&$!==void 0?$:"",total_duration_with_retries:w.totalDurationWithRetries,subscribe_retry_times:w.subscribeRetryTimes,is_reassignment:w.isReassignment,protocol:w.protocol})}}class qb extends Xn{constructor(w){super(Mn.SUBSCRIBE_FAILED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:w.remoteParticipantId,code:w.code,message:w.message,fatal:w.fatal,nominal:w.nominal,is_reassignment:w.isReassignment,protocol:w.protocol})}}class Rd extends Xn{constructor(w){super(Mn.SUBSCRIBE_ENDED,w.token,w.traceId,!0),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:w.remoteParticipantId,unsubscribe_successful:w.isUnsubscribeSuccessful,reason:w.reason,protocol:w.protocol}),this.critical=!0}}class Dx extends Xn{constructor(w){super(Mn.STATE_UPDATED,w.token,w.traceId,!1),Object.assign(this.properties,{audio_muted:w.isAudioMuted,is_disconnected:w.isDisconnected,is_publishing:w.isPublishing,other_participant_id:w.otherParticipantId,other_participant_user_id:w.otherParticipantUserId,video_stopped:w.isVideoStopped})}}class Lx extends Xn{constructor(w){var R,U,j,$,X;super(Mn.FIRST_FRAME,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:w.remoteParticipantId,edp_initial_connect_duration:w.edpInitialConnectDuration,edp_initial_connect_retry_times:w.edpInitialConnectRetries,edp_initial_state_duration:w.edpInitialStateDuration,edp_initial_state_publishing_count:w.edpInitialStatePublishingCount,edp_state_update_count:w.edpStateUpdateCount,sdp_exchange_duration:w.sdpExchangeDuration,sdp_exchange_transport:w.sdpExchangeTransport,set_remote_desc_duration:w.setRemoteDescDuration,peer_connection_duration:w.peerConnectionDuration,node:(U=(R=w.sfuResource)===null||R===void 0?void 0:R.node)!==null&&U!==void 0?U:"",cluster:($=(j=w.sfuResource)===null||j===void 0?void 0:j.cluster)!==null&&$!==void 0?$:"",video_was_paused:w.videoWasPaused,first_frame_duration:w.firstFrameDuration,total_duration_with_retries:w.totalDurationWithRetries,subscribe_retry_times:w.subscribeRetryTimes,media_type:w.mediaType,configured_jitter_buffer_min_delay_ms:(X=w.currentJitterBufferMinDelayInMs)!==null&&X!==void 0?X:0,protocol:w.protocol})}}class Ux extends Xn{constructor(w){super(Mn.EDP_PONG,w.token,w.traceId,!1),Object.assign(this.properties,{event_endpoint:w.eventEndpoint,protocol:w.protocol,edp_rtt:w.edpRttMs})}}class W0 extends Xn{constructor(w){super(Mn.JOIN,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.JOIN,event_endpoint:w.eventEndpoint,whip_endpoint:w.whipEndpoint})}}class Za extends Xn{constructor(w){super(Mn.JOIN_ATTEMPT,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.JOIN,event_endpoint:w.eventEndpoint,whip_endpoint:w.whipEndpoint})}}class Qa extends Xn{constructor(w){super(Mn.JOIN_ATTEMPT_FAILED,w.token,w.traceId,!1),Object.assign(this.properties,{action:Qt.JOIN,event_endpoint:w.eventEndpoint,whip_endpoint:w.whipEndpoint,code:w.code,message:w.message,fatal:w.fatal,nominal:w.nominal,connect_retry_times:w.retryCnt})}}class Yb extends Xn{constructor(w){super(Mn.EDP_DISCONNECTED,w.token,w.traceId,!1),Object.assign(this.properties,{event_endpoint:w.eventEndpoint,protocol:w.protocol}),this.critical=!0}}class Bx extends Xn{constructor(w){super(Mn.EDP_CONNECTED,w.token,w.traceId,!1),Object.assign(this.properties,{event_endpoint:w.eventEndpoint,protocol:w.protocol,connect_retry_times:w.numRetries}),this.critical=!0}}class py{constructor(w,R,U){this.token=w,this.analyticsTracker=U,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.maxConnectRetries=6,this.connectionAttempts=0,this.latestSequenceNumber=0,this.nextConnectionAttemptId=0,this.connectTimeoutId=0,this.latestPingTimestamp=0,this.pingIntervalId=0,this.pongTimeoutId=0,this.pingIntervalMs=15e3,this.pongTimeoutMs=3e4,this.attemptConnect=ue=>{this.latestSequenceNumber=0,this.traceId=ue||Ns(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:me,rawToken:ce}=this.token;this.connecting=!0,this.closing=!1;try{const de=encodeURIComponent(this.traceId.value),Ae=`topic=${me}/publishers`,Me=`traceid=${de}`,rt="error_over_ws=1",bt=`${this.addr}?${rt}&${Ae}&${Me}`;this.socket=this.createWebSocket(bt,ce),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(de){const Ae=de instanceof Error?de.message:void 0,Me=this.createError(Zt.EVENT_PLANE_WS_CREATE_FAILED,Ae);this.trackJoinFailed(Me,this.getRetryCount()),this.emitter.emit(pl,Me)}},this.triggerSocketOpen=ue=>{this.clearConnectionAttemptTimeouts();const me=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(me),this.emitter.emit(Bp,{retryCnt:me,traceId:this.traceId,initialStageState:ue}),this.pingIntervalId=window.setInterval(this.ping,this.pingIntervalMs)},this.ping=()=>{var ue;if(this.logger.debug({msg:`${this.id}sending PING`}),!this.isSocketOpen()){const me=`${this.id} attempting to ping an unopened socket`;return this.logger.warn({msg:me}),void this.traceJoinOp(me)}this.latestPingTimestamp=performance.now(),this.pongTimeoutId===0&&(this.pongTimeoutId=window.setTimeout(this.pongTimedOut,this.pongTimeoutMs)),(ue=this.socket)===null||ue===void 0||ue.send(JSON.stringify({type:"PING"}))},this.pongTimedOut=()=>{if(!this.isSocketOpen()){const me=`${this.id} attempting pong timeout on an unopened socket`;return this.logger.warn({msg:me}),void this.traceJoinOp(me)}this.logger.debug({msg:`${this.id} Pong timed out!`}),this.clearPingPongTracking();const ue=this.createError(Zt.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(pl,ue)},this.beforeUnload=()=>{this.emitter.emit(dr,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(ue,me,ce,de,Ae,Me,rt,bt)=>{var ht;const dt={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:me,requestId:de,traceId:ce,platform:"web",sdk:"1.31.1",whipVersion:ta,content:ue,contentType:"application/sdp"}};Ae&&(dt.payload.forceNode=Ae),Me&&(dt.payload.assignmentToken=Me),rt&&(dt.payload.multiCodec=rt);const et=ya()===void 0,st=ya()||et;bt&&st&&(dt.payload.initialLayerPref=ny(bt)),(ht=this.socket)===null||ht===void 0||ht.send(JSON.stringify(dt))},this.checkNonFatalRetriesLimit=ue=>{if(ue.fatal||this.connectionAttempts<=this.maxConnectRetries)return xn.ok(!0);this.logger.debug({msg:`${this.id} maximum non-fatal retries of ${this.maxConnectRetries} exceeded`});const me=this.createError(Zt.JOIN_TIMED_OUT);return xn.err(me)},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackSocketError=ue=>{this.connecting&&this.trackJoinFailed(ue,this.getRetryCount()),this.analyticsTracker.trackError(ue)},this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new Yb({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.traceJoinOp=ue=>{this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,this.traceId,ue,Qt.JOIN))},this.logger=new qa(R,oe.SOCKET),this.emitter=new Pi.EventEmitter,this.traceId=Ns(),this.id=`[${bd().value}] `;const j=e0("socketPingMs");j!==void 0&&(this.pingIntervalMs=j);const $=e0("socketPongMs");$!==void 0&&(this.pongTimeoutMs=$);const X=e0("socketConnectMaxRetries");X!==void 0&&(this.maxConnectRetries=X),window.addEventListener("beforeunload",this.beforeUnload)}connect(w,R,U=!1){this.close(),this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=w,this.traceId=R,U&&!this.connecting&&(window.clearTimeout(this.connectTimeoutId),this.connectTimeoutId=window.setTimeout(this.connectTimedOut.bind(this),12e3)),this.attemptConnect(R)}send(w){var R;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(w)}`}),this.logger.debug({msg:`${this.id}isReady called`}),this.isSocketOpen()?(R=this.socket)===null||R===void 0||R.send(JSON.stringify(w)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const w=this.connecting,R=this.isSocketOpen(),U=this.socket&&this.socket.readyState===this.socket.CLOSING,j=this.getRetryCount();if(this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.connectionAttempts=0,this.socket){if(this.cleanupWebSocket(),R&&this.isStateMessageReceived())this.trackJoinEnded(),this.emitter.emit(dr,"intentional-close");else if(w&&!U){const $=this.createError(Zt.OPERATION_ABORTED);this.trackJoinFailed($,j),this.analyticsTracker.trackError($),this.emitter.emit(pl,$)}}}markSocketAsClosed(){this.closing=!0,this.connecting=!1}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(w,R){return new WebSocket(w,R)}cleanupWebSocket(){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,this.socket=void 0)}createError(w,R){return new Rr(Object.assign({action:Qt.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:ea,details:R},w))}on(w,R){this.emitter.on(w,R)}off(w,R){this.emitter.off(w,R)}onMessage(w){this.logger.debug({msg:`${this.id}received message: ${w.data}`});try{const R=JSON.parse(w.data);switch(R.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const U=R.payload.sequenceNumber;U>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&this.connectTimeoutId>0?(this.triggerSocketOpen(R),window.setTimeout((()=>{this.emitter.emit(Du,R)}))):this.emitter.emit(Du,R),this.latestSequenceNumber=U);break}case"PONG":window.clearTimeout(this.pongTimeoutId),this.pongTimeoutId=0,this.analyticsTracker.trackEventNoSharedProps(new Ux({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp}));break;case"REFRESH":this.emitter.emit(C0);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(g_,R.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(R0,R.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(Qv,R.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit(__,R.payload);break;case"aws:ivs:SSU":this.emitter.emit(Ab,R.payload);break;case"aws:ivs:JOIN_ERROR":this.handleJoinError(R.payload);break;default:(0,ji.noop)()}}catch(R){this.logger.debug({msg:`onMessage JSON Parse error: ${R}`}),this.emitter.emit(Zv,R)}}onError(w){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(w)}`})}onClose(w){if(this.logger.debug({msg:`${this.id} onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.clearPingPongTracking(),this.closing)return void(this.closing=!1);if(this.windowUnloading)return;const R=`code: ${w?.code}, reason: ${w?.reason}, wasClean: ${w?.wasClean}`;if(this.connecting){const j=this.createError(Zt.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,R);return void this.handleSocketError(j)}this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(dr,"unknown");const U=this.createError(Zt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,R);this.trackJoinEnded(),this.emitter.emit(pl,U)}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),this.connectTimeoutId=window.setTimeout(this.triggerSocketOpen,12e3)}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttemptId),window.clearTimeout(this.connectTimeoutId),this.nextConnectionAttemptId=0,this.connectTimeoutId=0}clearConnectionAttempts(){this.connectionAttempts=0}connectTimedOut(){this.connecting=!1,this.logger.debug({msg:`${this.id} Connect timed out!`});const w=this.createError(Zt.JOIN_TIMED_OUT);this.isSocketConnecting()&&this.trackJoinFailed(w,this.getRetryCount()),this.emitter.emit(pl,w),this.close()}clearPingPongTracking(){window.clearInterval(this.pingIntervalId),window.clearTimeout(this.pongTimeoutId),this.pingIntervalId=0,this.pongTimeoutId=0}handleJoinError(w){const R=(function(j){var $,X;let ue;switch(j.code){case Xa.TOKEN_EXPIRED:ue=Zt.EXPIRED_TOKEN;break;case Xa.TOKEN_INVALID:case Xa.TOKEN_INVALID_SIGNATURE:case Xa.TOKEN_MISSING:ue=Zt.MALFORMED_TOKEN;break;case Xa.STAGE_DELETED:ue=Zt.STAGE_DELETED;break;case Xa.PARTICIPANT_DISCONNECTED:ue=Zt.PARTICIPANT_DISCONNECTED;break;case Xa.INTERNAL:ue=Zt.JOIN_SERVER_INTERNAL_ERROR;break;case Xa.BAD_REQUEST:ue=Zt.JOIN_SERVER_BAD_REQUEST;break;default:ue=Object.assign(Object.assign({},Zt.JOIN_FAILURE),{message:j.message||Zt.JOIN_FAILURE.message})}return Object.assign(Object.assign({},ue),{fatal:($=j.fatal)!==null&&$!==void 0?$:ue.fatal,nominal:(X=j.nominal)!==null&&X!==void 0?X:ue.nominal})})(w),U=this.createError(R,`JOIN_ERROR: ${w.code}`);this.logger.debug({msg:`${this.id} received JOIN_ERROR: ${JSON.stringify(w)}`}),this.handleSocketError(U)}handleSocketError(w){const R=this.checkNonFatalRetriesLimit(w);let U=w;R.ok||(U=R.error,U.details=`Timeout triggered by ${w.code}`),this.trackSocketError(U),this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.cleanupWebSocket(),U.fatal?(this.clearConnectionAttempts(),this.emitter.emit(pl,U)):this.queueExponentialBackoffRetry()}queueExponentialBackoffRetry(){let w=Math.pow(2,this.connectionAttempts-1);w>32&&(w=32),this.logger.debug({msg:`${this.id} reconnecting in ${w} seconds`}),window.clearTimeout(this.nextConnectionAttemptId),this.nextConnectionAttemptId=window.setTimeout(this.attemptConnect,1e3*w)}isSocketConnecting(){return this.socket&&this.socket.readyState===this.socket.CONNECTING}isSocketOpen(){return this.socket&&this.socket.readyState===this.socket.OPEN}isStateMessageReceived(){return this.latestSequenceNumber!==0}trackJoinStarted(w){this.analyticsTracker.trackEventNoSharedProps(new Bx({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:w,protocol:this.protocol,traceId:this.traceId}))}trackJoinAttempt(w){const{token:R,traceId:U}=this;this.analyticsTracker.trackEvent(new Za({token:R,eventEndpoint:R?.eventsURL||"",whipEndpoint:R?.whipURL||"",traceId:U}))}trackJoinFailed(w,R){const{token:U,traceId:j,code:$,message:X,fatal:ue,nominal:me}=w;this.analyticsTracker.trackEvent(new Qa({token:U,eventEndpoint:U.eventsURL,whipEndpoint:U.whipURL,traceId:j,code:$,message:X,fatal:ue,nominal:me,retryCnt:R}))}}var To=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))},Lo,ec,ia,Oi;(function(P){P.SDP_EXCHANGE="xdp",P.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(Lo||(Lo={})),(function(P){P.USER_INITIATED="user-initiated",P.CLIENT_RECONNECT="reconnect",P.TOKEN_REUSED="token-reused",P.UNKNOWN="unknown",P.PARTICIPANT_DISCONNECTED="participant-disconnected",P.STAGE_DELETED="stage-deleted",P.TOKEN_EXPIRED="token-expired"})(ec||(ec={})),(function(P){P[P.NOT_CONNECTED=0]="NOT_CONNECTED",P[P.CONNECTION_LOST=1]="CONNECTION_LOST",P[P.TIMEDOUT=2]="TIMEDOUT",P[P.ABORTED=3]="ABORTED",P[P.INVALID_MESSAGE=4]="INVALID_MESSAGE",P[P.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"})(ia||(ia={})),(function(P){P.DISCONNECTED="disconnected",P.CONNECTING="connecting",P.CONNECTED="connected",P.ERRORED="errored"})(Oi||(Oi={}));class M_ extends Da{constructor(w,R,U){super(),this.token=w,this.nonScopedLogger=R,this.analyticsTracker=U,this.participants=new Map,this.disconnected=[],this.state={value:Oi.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(j,$)=>{this.logger.debug({msg:"onConnecting",context:j,event:$}),j.connectStartTime=performance.now();const X=$.type==="RECONNECT";X&&this.stageSocket.close();const{eventsURL:ue}=this.token;this.emit(Ed,Oi.CONNECTING),this.state.value=Oi.CONNECTING;const me=!X;this.stageSocket.connect(ue,this.traceId,me)},this.onConnected=(j,$)=>{this.logger.debug({msg:"onConnected",context:j,event:$}),j.hasConnected=!0,this.emit(xf),this.emit(Ed,Oi.CONNECTED),this.state.value=Oi.CONNECTED},this.onDisconnected=(j,$)=>{this.logger.debug({msg:"onDisconnected",context:j}),this.state.value=Oi.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),j.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(Ed,Oi.DISCONNECTED,$)},this.onErrored=(j,$)=>{var X;this.logger.error({msg:"Connection failure occurred",err:$.payload.error}),this.emit(Ed,Oi.ERRORED),this.emit(A0,$.payload.error),this.state.value=Oi.ERRORED;const ue=$.payload.error;if(ue instanceof Rr&&ue.fatal&&(!((X=ue.details)===null||X===void 0)&&X.includes("JOIN_ERROR"))&&j.hasConnected){const me=this.mapJoinErrorCodeToDisconnectReason(ue);this.processStateUpdate({type:"DISCONNECT",reason:me})}else j.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=j=>{const $=this.state.value,X=this.state.context;switch($){case Oi.DISCONNECTED:j.type==="CONNECT"&&this.onConnecting(X,j);break;case Oi.CONNECTING:j.type==="RECONNECT"?this.onConnecting(X,j):j.type==="DISCONNECT"?this.onDisconnected(X,j.reason):j.type==="CONNECT_SUCCESS"?this.onConnected(X,j):j.type==="ERROR"&&this.onErrored(X,j);break;case Oi.CONNECTED:j.type==="RECONNECT"?this.onConnecting(X,j):j.type==="DISCONNECT"?this.onDisconnected(X,j.reason):j.type==="ERROR"&&this.onErrored(X,j);break;case Oi.ERRORED:j.type==="RECONNECT"?this.onConnecting(X,j):j.type==="DISCONNECT"&&this.onDisconnected(X,j.reason)}},this.measureConnect=(j,$)=>{const X=this.stats.edpConnectCount,ue=X+1,me=performance.now(),ce=me-$;return Object.assign(this.stats,{edpConnectCount:ue,edpConnectDuration:ce}),X===0&&Object.assign(this.stats,{edpInitialStartConnectTime:$,edpInitialFinishConnectTime:me,edpInitialConnectDuration:ce,edpInitialConnectRetries:j}),this.stats},this.measureStateUpdate=j=>{const{edpInitialFinishConnectTime:$}=this.stats,X=this.stats.edpStateUpdateCount,ue=X+1;return Object.assign(this.stats,{edpStateUpdateCount:ue}),X===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-$,edpInitialStatePublishingCount:j}),this.stats},this.trackMessageParseError=j=>{this.logger.error({msg:"Message Parse Error occurred",err:j.err});const $=new Rr({token:j.token,traceId:j.traceId,code:Zt.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:j.tag,location:j.location,message:j.message,details:j.err.message});this.analyticsTracker.trackEvent(new ps($))},this.trackStageSocketMessageParseError=(j,$,X)=>{this.trackMessageParseError({token:j,traceId:$,tag:ea,location:"StageConnection.onMessage",message:Zt.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:X})},this.trackStageStateMessageParseError=(j,$,X,ue)=>{this.trackMessageParseError({token:j,traceId:$,tag:ea,location:"StageConnection.onStageStateMessage",message:ue,err:X})},this.onDisconnectMessage=j=>{this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,this.traceId,`DISCONNECT message received: ${j.code}:${j.reason}`,Qt.JOIN));let $=ec.UNKNOWN;if(j.code==="PARTICIPANT_DISCONNECTED")$=ec.PARTICIPANT_DISCONNECTED;else if(j.code==="STAGE_DELETED")$=ec.STAGE_DELETED;else if(j.code==="TOKEN_REUSED"&&($=ec.TOKEN_REUSED,Bc("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${j.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:$})},this.onReassignmentMessage=j=>{this.emit(m_,j)},this.onIncompatibleCodecsMessage=j=>{this.emit(Xs,j)},this.onSsuMessage=j=>{var $;const X=window.atob(($=j.A)!==null&&$!==void 0?$:"").trim();X&&X.startsWith("http")?Io.currentEndpoint=X:this.logger.warn({msg:"SSU Url invalid"})},this.onStageStateMessage=(j,$,X)=>{var ue,me;this.logger.debug({msg:"State Stage Message occurred",state:X});const ce=X.payload,de=(ue=ce.participants)!==null&&ue!==void 0?ue:[],Ae=(me=ce.disconnected)!==null&&me!==void 0?me:[],Me=[],rt=[];this.measureStateUpdate(de.length),this.enableFeaturesBasedOnServerFeatures(ce.serverFeatures||[]);const bt=(ht,dt)=>{this.analyticsTracker.trackEventNoSharedProps(new Dx({token:j,otherParticipantId:ht.id,otherParticipantUserId:ht.userId,isAudioMuted:ht.audioMuted,isVideoStopped:ht.videoStopped,isPublishing:ht.isPublishing,isDisconnected:dt,traceId:$}))};this.participants.forEach((ht=>{const dt=de.find((et=>et.id===ht.id));if(dt){let et=!0,st=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach((Ot=>{et=et&&dt[Ot.toString()]===ht[Ot.toString()],et||(ht[Ot.toString()]=dt[Ot.toString()],st=!0)})),Object.keys(ht.attributes).forEach((Ot=>{et=et&&dt.attributes[Ot]===ht.attributes[Ot],et||(ht.attributes=dt.attributes,st=!0)})),st&&(bt(ht,!1),this.emit(wf,dt))}else rt.push(ht)})),de.forEach((ht=>{this.participants.get(ht.id)||Me.push(ht)})),rt.forEach((ht=>{this.participants.delete(ht.id),bt(ht,!0),this.emit($c,ht)})),Me.forEach((ht=>{this.participants.set(ht.id,ht),bt(ht,!1),this.emit(Ua,ht)})),Ae.forEach((ht=>{this.disconnected.find((dt=>dt.id===ht.id))||(this.disconnected.push(ht),ht.status==="KICKED"&&this.emit(p_,ht))})),this.disconnected=Ae},this.nonScopedLogger=R,this.logger=new qa(R,oe.CONNECTION),this.stageSocket=new py(w,this.nonScopedLogger,U),this.token=w,this.traceId=Ns()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(w){return To(this,void 0,void 0,(function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:w}),this.traceId=w,this.state.value!==Oi.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:ec.CLIENT_RECONNECT})),new Promise(((R,U)=>{this.stageSocket.on(Bp,(j=>{var $,X;const{retryCnt:ue,initialStageState:me}=j;me&&this.enableFeaturesBasedOnServerFeatures((X=($=me.payload)===null||$===void 0?void 0:$.serverFeatures)!==null&&X!==void 0?X:[]),this.traceId=j.traceId||Ns(),this.measureConnect(ue,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),R(this.traceId)})),this.stageSocket.on(pl,(j=>{U(j),this.processStateUpdate({type:"ERROR",payload:{error:j}})})),this.stageSocket.on(C0,(()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit(Sd),this.processStateUpdate({type:"RECONNECT"})})),this.stageSocket.on(Du,(j=>this.onStageStateMessage(this.token,this.traceId,j))),this.stageSocket.on(Zv,(j=>this.trackStageSocketMessageParseError(this.token,this.traceId,j))),this.stageSocket.on(R0,this.onDisconnectMessage),this.stageSocket.on(Qv,this.onReassignmentMessage),this.stageSocket.on(__,this.onIncompatibleCodecsMessage),this.stageSocket.on(Ab,this.onSsuMessage),this.stageSocket.on(dr,(j=>{this.stopStageMinuteLoggedInterval()})),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:w}})}))}))}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:ec.USER_INITIATED}),this.traceId}getParticipant(w){return this.participants.get(w)}listConnectedParticipants(){const w=[];return this.participants.forEach((R=>{R.subscribed&&w.push(R)})),w}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(w,R){this.stageSocket.send({audioMuted:w,type:"SET_STATE",version:"0",videoStopped:R})}setStagePublishing(w){this.isStagePublishing=w,this.emit(Iu,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(w,R){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new $0(w,R,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval((()=>{this.analyticsTracker.trackEvent(new $0(w,R??Ns(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++}),6e4))}stopStageMinuteLoggedInterval(w=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),w&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(w){const R=(X,ue)=>{this.trackStageStateMessageParseError(this.token,this.traceId,ue,`Could not parse "${X}" from the Eevee server features list`)},U=w.includes(Lo.SDP_EXCHANGE);this.features.sdpExchange!==U&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${U}`}),this.features.sdpExchange=U);const j=w.find((X=>X.indexOf(Lo.JITTER_BUFFER_MIN_DELAY_MS)!==-1)),$=X=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${X}`}),this.features.jitterBufferMinDelayInMs=X};if(j!==void 0)try{const X=j.split("=")[1],ue=parseInt(X,10);if(isNaN(ue))throw new Error("Unable to parse - result is NaN");if(ue<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===ue||$(ue)}catch(X){R(j,X),$(void 0)}else $(void 0)}mapJoinErrorCodeToDisconnectReason(w){switch(w.code){case Zt.PARTICIPANT_DISCONNECTED.code:return ec.PARTICIPANT_DISCONNECTED;case Zt.STAGE_DELETED.code:return ec.STAGE_DELETED;case Zt.EXPIRED_TOKEN.code:return ec.TOKEN_EXPIRED;default:return ec.UNKNOWN}}isConnected(){return this.state.value===Oi.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(w,R,U,j,$,X,ue,me,ce){return To(this,void 0,void 0,(function*(){return this.isConnected()?new Promise(((de,Ae)=>{const Me=window.setTimeout((()=>{rt(),Ae(ia.TIMEDOUT)}),12e3),rt=()=>{window.clearTimeout(Me),this.stageSocket.off(g_,bt),this.stageSocket.off(pl,ht)},bt=dt=>{dt.requestId===j&&(rt(),de(dt))},ht=()=>{rt(),Ae(ia.CONNECTION_LOST)};$?.addEventListener("abort",(()=>{rt(),Ae(ia.ABORTED)})),this.stageSocket.on(g_,bt),this.stageSocket.on(pl,ht),this.stageSocket.sendSdpOffer(w,R,U,j,X,ue,me,ce)})):Promise.reject(ia.NOT_CONNECTED)}))}}class kd{constructor(w){this.token=w}}const qc=new RegExp("^(?:[a-z+]+:)?//","i");function xc(P){return qc.test(P)}function wc({sdpExchangeTransport:P,serverHttpResponse:w,serverErrorCode:R}){return`sdpExchangeTransport: ${P}, serverHttpResponse: ${w}, serverErrorCode: ${R}`}var Hu=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};const ql={[ia.ABORTED]:Zt.OPERATION_ABORTED,[ia.NOT_CONNECTED]:Zt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[ia.CONNECTION_LOST]:Zt.XDP_CONNECTION_LOST,[ia.TIMEDOUT]:Zt.XDP_TIMEOUT,[ia.INVALID_MESSAGE]:Zt.XDP_INVALID_ANSWER_MSG,[ia.UNEXPECTED_ERROR]:Zt.XDP_UNEXPECTED_ERROR};class sa extends kd{constructor(w,R,U,j){super(w),this.token=w,this.stageConnection=R,this.contextData=U,this.analyticsTracker=j}exchange(w){return Hu(this,void 0,void 0,(function*(){const R=bd(),{action:U}=this.contextData,{sdpOffer:j,url:$,traceId:X,forceNode:ue,assignmentToken:me,multiCodec:ce,abortController:de,initialLayerPreference:Ae}=w;let Me;this.trackAttempt($,R,X);try{Me=yield this.stageConnection.exchangeSdp(j,$,X.value,R.value,de?.signal,ue,me,ce,Ae)}catch(En){if(typeof En=="number")throw this.createClientSideErrorFromReasonCode(En,X,R,U)}if(!Me)return;const{httpStatusCode:rt,errorCode:bt,location:ht,content:dt,sessionDeleteLink:et,subscriberControlLink:st,videoLayersLink:Ot}=Me;if(rt>=200&&rt<300)return{sdpAnswer:dt,url:$,location:ht,sessionDeleteLink:et,mediaControls:st,layerControls:Ot};throw this.createServerSideError(X,R,rt,bt,U)}))}trackAttempt(w,R,U){const{remoteParticipantId:j,action:$}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new ey($,this.token,w,"POST",R.value,j,U,"xdp"))}createServerSideError(w,R,U,j,$){const X=this.baseErrorProps(w,R);let ue=T0(U,j);return ue||(ue=Zt.UNKNOWN_SERVER_ERROR),new Rr(Object.assign(Object.assign(Object.assign({action:$},X),ue),{details:wc({sdpExchangeTransport:"xdp",serverHttpResponse:U,serverErrorCode:j})}))}baseErrorProps(w,R){const{remoteParticipantId:U,action:j}=this.contextData;return{token:this.token,traceId:w,tag:No(j,U),location:"EdpSdpExchanger.exchange",requestUUID:R,remoteParticipantId:U}}createClientSideErrorFromReasonCode(w,R,U,j){const $=this.baseErrorProps(R,U),X=ql[w];return new Rr(X?Object.assign(Object.assign({action:j},$),X):Object.assign(Object.assign({action:j},$),Zt.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}var q0=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class Mf extends kd{constructor(w,R,U){super(w),this.contextData=R,this.analyticsTracker=U}exchange(w){var R,U,j;return q0(this,void 0,void 0,(function*(){const $=bd(),{token:X}=this,{action:ue,remoteParticipantId:me}=this.contextData,{sdpOffer:ce,url:de,traceId:Ae,forceNode:Me,assignmentToken:rt,multiCodec:bt,abortController:ht,initialLayerPreference:dt}=w;try{const st="POST",Ot="http";this.analyticsTracker.trackEventNoSharedProps(new ey(ue,X,de,st,$.value,me,Ae,Ot));const En={data:ce,headers:{Authorization:`Bearer ${X.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":$.value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":Ae.value,"X-Stages-WHIP-Version":ta,[xx]:(et=JSON.stringify({[Tb]:["sau"]}),btoa(et).replace(/[^A-Za-z0-9+/]/g,""))},method:st,responseType:"text",url:de,signal:ht?.signal,params:{}};Me&&(En.params.force_node=Me),rt&&(En.params.assignment_token=rt),bt&&(En.params.multi_codec=!0);const Dn=ya()===void 0,Jn=ya()||Dn;dt&&En.headers&&Jn&&(En.headers["X-Stages-Initial-Layer-Pref"]=ny(dt));const{data:b,headers:S,request:N}=yield Jg(En),V=this.parseWhipResource(de,S.location,S.link);return{url:N.responseURL,sdpAnswer:b,location:V?.location,sessionDeleteLink:V?.sessionDeleteLink,mediaControls:V?.mediaControls,layerControls:V?.layerControls}}catch(st){if(pf().isCancel(st))throw new Rr(Object.assign(Object.assign({},Dh(Zt.OPERATION_ABORTED,st)),{action:ue,token:X,traceId:Ae,tag:No(ue,me),location:"StagePeerClient.start",requestUUID:$,remoteParticipantId:me}));const Ot=Number((R=st?.response)===null||R===void 0?void 0:R.status)||-1,En=((j=(U=st?.response)===null||U===void 0?void 0:U.data)===null||j===void 0?void 0:j.code)||-1,Dn=(function(Jn,b){var S;return Jn instanceof gc.AxiosError&&Jn.response&&typeof Jn.response.status=="number"?Jn instanceof gc.AxiosError&&Jn.code==="ERR_NETWORK"?Zt.NETWORK_FAILURE:T0(Number(Jn.response.status),(S=Jn.response.data)===null||S===void 0?void 0:S.code)||b:b})(st,Zt.WHIP_POST_FAILURE);throw new Rr(Object.assign(Object.assign({},Dh(Dn,st)),{action:ue,token:X,traceId:Ae,tag:No(ue,me),details:wc({sdpExchangeTransport:"http",serverHttpResponse:Ot,serverErrorCode:En}),location:"StagePeerClient.start",requestUUID:$,remoteParticipantId:me}))}var et}))}parseWhipResource(w,R,U){const j=new URL(w);let $;return $=(function(X,ue,me){if(!me)return X;if(X||(X={}),xc(me))return X.location=me,X;const ce=ue.port?`:${ue.port}`:"";return X.location=`${ue.protocol}//${ue.hostname}${ce}${me}`,X})($,j,R),$=(function(X,ue,me){if(!me)return X;X||(X={});const ce=X;return me.split(",").forEach((de=>{const Ae=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(de);if(Ae?.length!==3)return;let Me;if(xc(Ae[1]))Me=Ae[1];else{const rt=ue.port?`:${ue.port}`:"";Me=`${ue.protocol}//${ue.hostname}${rt}${Ae[1]}`}switch(Ae[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":ce.sessionDeleteLink=Me;break;case"urn:ietf:params:whep:core:playback-controls":ce.mediaControls=Me;break;case"urn:ietf:params:whep:ext:core:layer":ce.layerControls=Me;break;default:return}})),ce})($,j,U),$}getTransport(){return"http"}}function O_(P){const{connection:w,token:R,action:U,identifier:j,tracker:$}=P,X=w&&w.supportsSdpExchange()&&w.isConnected(),ue=U===Qt.SUBSCRIBE&&X&&!Kg()&&!Bc("disableXdpSubscribe"),me=U===Qt.PUBLISH&&X&&!Kg()&&!Bc("disableXdpPublish");return ue||me?new sa(R,w,{action:U,remoteParticipantId:j},$):new Mf(R,{action:U,remoteParticipantId:j},$)}function Uo({stageErrorValue:P,action:w,token:R,traceId:U,tag:j,identifier:$,details:X}){return new Rr(Object.assign(Object.assign({},P),{token:R,traceId:U,location:"peer-client",tag:j,action:w,remoteParticipantId:$,details:X}))}var li;function _i(P){var w;return!((w=P?.sender)===null||w===void 0)&&w.createEncodedStreams?li.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?li.ENCODED_TRANSFORMS:li.NONE}function Yl(P){var w;return!((w=P?.receiver)===null||w===void 0)&&w.createEncodedStreams?li.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?li.ENCODED_TRANSFORMS:li.NONE}function Yc(){return Wv()(`/*! For license information please see transform.worker.worker.js.LICENSE.txt */
(()=>{"use strict";const e=new Uint8Array([158,80,78,165,238,90,79,2,148,159,176,51,163,118,141,162]);var t;!function(e){e.VIDEO_SEND="video/send",e.VIDEO_RECEIVE="video/receive",e.INSERT_SEI="insertSei"}(t||(t={}));function n(t,n){const{transformerId:s,type:r,payloads:a}=n;let o=[];if("sei"===n.type){const{value:n,messages:s}=function(t,n){function s(e,t,n){return n+t.length<=e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function r(e,t){const n=function(e,t){return new Uint8Array([0,0,1,6,5,...t,...e])}(e,function(e){const t=[];for(;e>=255;)t.push(255),e-=255;return t.push(e),new Uint8Array(t)}(t.length+e.length)),s=function(e){const t=[...e];let n=3;for(;n<t.length-2;)0!==t[n]||0!==t[n+1]||0!==t[n+2]&&1!==t[n+2]&&2!==t[n+2]&&3!==t[n+2]?n+=1:(t.splice(n+2,0,3),n+=3);return t}(new Uint8Array([...n,...t,128]));return new Uint8Array(s)}function a(e,n){const r=function(e){const t=new DataView(e);for(let e=0;e<t.byteLength-4;e++)if(s(t,[0,0,1],e)){const n=31&t.getUint8(e+3);if(n>=1&&n<=5)return e}return-1}(t.data);if(r>=0){const e=new ArrayBuffer(t.data.byteLength+n.byteLength),s=new Uint8Array(e);return s.set(new Uint8Array(t.data.slice(0,r)),0),s.set(n,r),s.set(new Uint8Array(t.data.slice(r)),r+n.byteLength),e}return e}return function(){const s=[];for(let o=0;o<n.length;o+=1){const i=r(e,new Uint8Array(n[o]));t.data=a(t.data,i),s.push({uuid:e,payload:n[o]})}return{value:t,messages:s}}()}(t,a||[]);t=n,o=s}return{success:!0,frame:t,transformerId:s,type:r,seiResult:o}}const s=function(){let e=[];const t=new Map;return{add:({payload:t,repeatCount:n})=>(e.push({payload:t,repeatCount:n}),!0),poll(n){t.has(n)||t.set(n,[]),t.size>0&&(t.forEach((t=>{t.push(...e)})),e=[]);const s=t.get(n)||[],r=s.filter((e=>e.repeatCount>0)).map((e=>Object.assign(Object.assign({},e),{repeatCount:e.repeatCount-1})));return t.set(n,r),s}}}(),r=e=>(t,r)=>{try{const a=t.getMetadata().synchronizationSource,o=(s?s.poll(a):[]).map((e=>e.payload)),i=n(t,Object.assign(Object.assign({},e),{payloads:o}));r.enqueue(i.frame),self.postMessage(Object.assign({success:i.success,seiResult:i.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}},a=e=>(t,n)=>{try{const s=function(e,t){const{type:n,transformerId:s}=t;if("sei"===n){const t=function(e){function t(e,t,n){return n+t.length<e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function n(e){const t=[];let n=0;for(;n<e.length;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(t.push(e[n]),t.push(e[n+1]),n+=3):(t.push(e[n]),n+=1);return new Uint8Array(t)}function s(e){let t=2;const n=e.byteLength;for(;t<n;){let s=0;for(;t<n&&255===e[t];)s+=255,t++;s+=e[t],t++;const r=Math.min(t+s,n),a=new Uint8Array(e.slice(t,r));return{uuid:a.slice(0,16),payload:a.slice(16)}}}return{messages:function(e){const r=new DataView(e.data),a=[];let o=0;if(!t(r,[0,0,1],0)&&!t(r,[0,0,0,1],0))return[];for(;o<r.byteLength-5;)if(t(r,[0,0,1],o)){const i=o+3;o=i;const c=31&r.getUint8(o),u=31&r.getUint8(o+1);if(6===c&&5===u){for(;o<r.byteLength&&!t(r,[0,0,1],o);)o++;const c=o,u=s(n(new Uint8Array(e.data.slice(i,c))));u&&a.push(Object.assign({},u))}else o++}else o++;return a}(e),frame:e}}(e),{frame:r,messages:a}=t;return{success:!0,frame:r,type:n,transformerId:s,seiResult:a}}return{success:!0,frame:e,transformerId:s,type:n}}(t,e);n.enqueue(s.frame),self.postMessage(Object.assign({success:s.success,seiResult:s.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}};function o(e,t,n,s){const o=new TransformStream({transform:"video/send"===e?r(t):a(t)});n.pipeThrough(o).pipeTo(s)}const i=self;i.addEventListener("message",(function(e){var n,r,a;if(!(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.operation)||!(null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.transformerId))return;const{operation:i,transformerId:c}=e.data;switch(i){case t.VIDEO_SEND:case t.VIDEO_RECEIVE:o(i,{method:i,transformerId:c,type:"sei"},e.data.readable,e.data.writable);break;case t.INSERT_SEI:s.add({payload:e.data.payload,repeatCount:null!==(a=e.data.repeatCount)&&void 0!==a?a:0})}})),i.addEventListener("rtctransform",(function(e){const t=e.transformer;if(!t)return;o(t.options.method,t.options,t.readable,t.writable)}))})();`,"Worker",void 0,void 0)}(function(P){P.NONE="none",P.ENCODED_TRANSFORMS="encodedTransforms",P.INSERTABLE_STREAMS="insertableStreams"})(li||(li={}));const Of=(()=>{const P={};return{getWorker:w=>(P[w]||(P[w]=new Yc),P[w]),destroy:w=>{var R;(R=P[w])===null||R===void 0||R.terminate(),P[w]=void 0}}})();var oa;(function(P){P.NOT_PUBLISHING_VIDEO="NOT_PUBLISHING_VIDEO",P.INBAND_MESSAGING_NOT_ENABLED="INBAND_MESSAGING_NOT_ENABLED",P.INVALID_REPEAT_COUNT="INVALID_REPEAT_COUNT",P.PAYLOAD_SIZE_INVALID="PAYLOAD_SIZE_INVALID",P.PAYLOAD_RATE_EXCEEDED="PAYLOAD_RATE_EXCEEDED",P.INVALID_TRACK_TYPE="INVALID_TRACK_TYPE"})(oa||(oa={}));class zh{constructor(w){this.maxFramerate=w,this.queued=[]}validateMessagePayload(w,R){if(w.byteLength<=0)return xn.err(oa.PAYLOAD_SIZE_INVALID);if(R<0||R>30)return xn.err(oa.INVALID_REPEAT_COUNT);if(w.byteLength>1024)return xn.err(oa.PAYLOAD_SIZE_INVALID);this.queued=this.trimPastPayloads(this.queued,1e3);const{before:U,after:j}=this.getPayloadSums(this.queued);if(U+w.byteLength>10240||j+w.byteLength*Math.max(1,R)>10240)return xn.err(oa.PAYLOAD_RATE_EXCEEDED);if(this.queued.push({byteLength:w.byteLength,timestamp:Date.now()}),R>0){const $=1e3/this.maxFramerate;let X=Date.now()+$;for(let ue=0;ue<R;ue+=1)this.queued.push({byteLength:w.byteLength,timestamp:X}),X+=$}return xn.ok(!0)}trimPastPayloads(w,R){const U=Date.now()-R;return w.filter((j=>j.timestamp>U))}getPayloadSums(w){const R=Date.now();return w.reduce(((U,j)=>{const{before:$,after:X}=U;return j.timestamp<=R?{before:$+j.byteLength,after:X}:{before:$,after:X+j.byteLength}}),{before:0,after:0})}}const $u="seiMessageReceived",Kb="error";var _s;(function(P){P.CREATED="created",P.INITIALIZED="initialized",P.DESTROYED="destroyed"})(_s||(_s={}));class I_ extends Da{constructor(w){super(),this.sessionId=w,this.state=_s.CREATED,this.transformerId=bd().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=R=>{this.onTransformResult(R.data)}}initializeInsertableStreams(w){var R,U;this.worker=Of.getWorker(this.sessionId);const j=w.receiver.createEncodedStreams(),{readable:$,writable:X}=j;(R=this.worker)===null||R===void 0||R.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:$,writable:X},[$,X]),(U=this.worker)===null||U===void 0||U.addEventListener("message",this.onMessage)}initializeEncodedTransforms(w){var R;this.worker=Of.getWorker(this.sessionId);const U={method:"video/receive",type:"sei",transformerId:this.transformerId};w.receiver.transform=new RTCRtpScriptTransform(this.worker,U),(R=this.worker)===null||R===void 0||R.addEventListener("message",this.onMessage)}initialize(w,R){if(this.state!==_s.CREATED)return!1;const U=Yl(w);if(U===li.NONE)return!1;if(R&&U===li.INSERTABLE_STREAMS)this.initializeInsertableStreams(w);else{if(R||U!==li.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(w)}return this.transceiver=w,this.state=_s.INITIALIZED,!0}onTransceiverAdd(w){return this.initialize(w,!0)}onTrackEvent(w){return w.track.kind==="video"&&this.initialize(w.transceiver,!1)}static isSupported(w){return Yl(w)!==li.NONE}onTransformResult(w){return w.transformerId===this.transformerId&&(w.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!w.seiResult&&(w.seiResult.forEach((R=>{const{payload:U,uuid:j}=R;this.updateReadStats(R),this.emit($u,{uuid:j,payload:U})})),w.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(w,Zt.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(w,Zt.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(w){this.seiReadCnt++,this.seiBytesRead+=w.payload.byteLength}getReceiverStats(){const{seiBytesRead:w,seiReadCnt:R}=this;return{seiReadCnt:R,seiBytesRead:w}}onError(w,R){const{type:U}=w;this.emit(Kb,{type:U,stageErrorValue:R})}destroy(){var w,R;this.state!==_s.DESTROYED&&(this.removeAllListeners(),(w=this.worker)===null||w===void 0||w.removeEventListener("message",this.onMessage),!((R=this.transceiver)===null||R===void 0)&&R.receiver&&(this.transceiver.receiver.transform=null),this.state=_s.DESTROYED)}getState(){return this.state}}class Ps{constructor(w){this.sessionId=w,this.state=_s.CREATED,this.transformerId=bd().value,this.seiWriteCnt=0,this.seiBytesWritten=0,this.onMessage=R=>{this.onTransformResult(R.data)}}initializeInsertableStreams(w,R){var U,j;this.worker=Of.getWorker(this.sessionId);const $=w.sender.createEncodedStreams(),{readable:X,writable:ue}=$;(U=this.worker)===null||U===void 0||U.postMessage({operation:"video/send",transformerId:this.transformerId,readable:X,writable:ue},[X,ue]),(j=this.worker)===null||j===void 0||j.addEventListener("message",this.onMessage)}initializeEncodedTransforms(w,R){var U;this.worker=Of.getWorker(this.sessionId);const j={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:R};w.sender.transform=new RTCRtpScriptTransform(this.worker,j),(U=this.worker)===null||U===void 0||U.addEventListener("message",this.onMessage)}initialize(w){var R;if(this.state!==_s.CREATED)return!1;const U=_i(w);if(U===li.NONE)return!1;const j=w.sender.getParameters(),$=((R=j?.encodings)===null||R===void 0?void 0:R.length)||1;if(U===li.INSERTABLE_STREAMS)this.initializeInsertableStreams(w,$);else{if(U!==li.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(w,$)}return this.transceiver=w,this.state=_s.INITIALIZED,!0}static isSupported(w){return _i(w)!==li.NONE}sendSeiMessage(w,R){var U;return this.state===_s.INITIALIZED&&this.transceiver?((U=this.worker)===null||U===void 0||U.postMessage({operation:"insertSei",transformerId:this.transformerId,payload:w,repeatCount:R}),xn.ok(!0)):xn.err(oa.NOT_PUBLISHING_VIDEO)}onTransceiverAdd(w){return this.initialize(w)}onTrackEvent(w){return!1}onTransformResult(w){return w.transformerId===this.transformerId&&(w.success&&this.updateSendStats(w),w.success)}updateSendStats(w){w.seiResult&&w.seiResult.forEach((R=>{this.seiWriteCnt++,this.seiBytesWritten+=R.payload.byteLength}))}getSenderStats(){const{seiBytesWritten:w,seiWriteCnt:R}=this;return{seiWriteCnt:R,seiBytesWritten:w}}destroy(){var w;this.state!==_s.DESTROYED&&(!((w=this.transceiver)===null||w===void 0)&&w.receiver&&(this.transceiver.receiver.transform=null),this.state=_s.DESTROYED)}getState(){return this.state}}class N_ extends Xn{constructor(w,R,U,j,$,X,ue,me,ce){super(Mn.SELECTED_PAIR_CHANGE,R,U,!1),Object.assign(this.properties,{action:w,protocol:j,local_type:$,local_addr:X,remote_addr:ue,local_candidate_priority:me,remote_participant_id:ce})}}var Es=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};let Vh=null;class Y0 extends Da{constructor(w,R,U,j,$,X,ue,me,ce){var de;if(super(),this.analyticsTracker=X,this.subscribeConfig=ce,this.sfuResource={node:"",cluster:""},this.protocol="",this.incompatibleCodecs=new Set,this.connect=({audioOnly:Ae=!1,traceId:Me,iceRestartOptions:rt})=>Es(this,void 0,void 0,(function*(){const{token:bt,tag:ht,identifier:dt,action:et}=this,st=!!rt,Ot=new AbortController;let En,Dn,Jn;this.abortController=Ot,this.traceId=Me,this.protocol="",this.perfTracker.resetMeasurements(Me);const b=()=>{En&&this.off(xu,En),Dn&&this.off(jc,Dn)},S=new Promise(((N,V)=>{const ee=(function({action:Qe,token:St,traceId:Lt,tag:Kt,identifier:Xt}){const vn=Qe===Qt.SUBSCRIBE?Zt.SUBSCRIBE_TIMED_OUT:Zt.PUBLISH_TIMED_OUT;return new Rr(Object.assign(Object.assign({},vn),{action:Qe,token:St,traceId:Lt,tag:Kt,location:"connect",remoteParticipantId:Xt}))})({action:et,token:bt,traceId:Me,tag:ht,identifier:dt}),le=(function({action:Qe,token:St,traceId:Lt,tag:Kt}){const Xt=Zt.OPERATION_ABORTED;return new Rr(Object.assign(Object.assign({},Xt),{token:St,traceId:Lt,location:"peer-client.connect",tag:Kt,action:Qe}))})({action:et,token:bt,traceId:Me,tag:ht}),Ne=setTimeout((()=>{this.stop(),this.analyticsTracker.trackError(ee),V(ee)}),1e4);En=Qe=>{clearTimeout(Ne),st||this.stop(),V(Qe)},Dn=Qe=>{if(Qe===hr.CONNECTED)clearTimeout(Ne),N();else if(Qe===hr.FAILED){const St=(function({action:Lt,token:Kt,traceId:Xt,tag:vn}){return new Rr(Object.assign(Object.assign({},Zt.PEER_CONNECTION_NETWORK_FAILURE),{token:Kt,traceId:Xt,location:"peer-client.connect",tag:vn,action:Lt}))})({action:et,token:bt,traceId:Me,tag:ht});clearTimeout(Ne),V(St)}},this.on(xu,En),this.on(jc,Dn),Jn=()=>{clearTimeout(Ne)},Ot.signal.aborted&&(clearTimeout(Ne),V(le)),Ot.signal.addEventListener("abort",(()=>{clearTimeout(Ne),V(le)}))}));try{const N=yield Promise.all([Es(this,void 0,void 0,(function*(){st||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(Ae));const ee=rt?.assignmentToken,le=rt?.nodeOverride;return yield this.exchangeSdp({iceRestart:st,nodeOverride:le,assignmentToken:ee,abortController:Ot}),this.mediaStream})),S]);this.statsReporter.traceId=Me;const V=N[0];if(this.abortController=void 0,!st&&et===Qt.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(ee){this.logger.error({err:ee,msg:"error syncing transceivers"})}return{mediaStream:V}}catch(N){throw Jn&&Jn(),N}finally{b()}})),this.disconnect=(Ae=!1)=>Es(this,void 0,void 0,(function*(){var Me;const{token:rt,action:bt}=this;(Me=this.abortController)===null||Me===void 0||Me.abort(),this.stop(),this.protocol="",Ae?this.cleanup(bt,rt.participantID,rt,Ae):yield this.cleanup(bt,rt.participantID,rt,Ae)})),this.resetTransformers=()=>{var Ae,Me;(Ae=this.videoSenderTransformer)===null||Ae===void 0||Ae.destroy(),this.videoSenderTransformer=this.createVideoSenderTransformer(),(Me=this.videoReceiverTransformer)===null||Me===void 0||Me.destroy(),this.videoReceiverTransformer=this.createVideoReceiverTransformer(),this.statsReporter.resetTransformers(this.videoReceiverTransformer,this.videoSenderTransformer)},this.onTrack=Ae=>{var Me,rt;const{token:bt,action:ht,traceId:dt,identifier:et}=this;this.trace(bt,dt,`onTrack: ${Ae.track.kind}`,ht,et),this.sendInBandMessagingEnabled&&((Me=this.videoSenderTransformer)===null||Me===void 0||Me.onTrackEvent(Ae)),this.receiveInBandMessagingEnabled&&((rt=this.videoReceiverTransformer)===null||rt===void 0||rt.onTrackEvent(Ae))},this.onIceGatheringStateChange=()=>{var Ae,Me,rt;const{token:bt,action:ht,traceId:dt,identifier:et}=this;if(((Ae=this.peerConnection)===null||Ae===void 0?void 0:Ae.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((Me=this.peerConnection)===null||Me===void 0?void 0:Me.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const st=this.peerConnection.iceGatheringState,Ot=new ml(ht,bt,dt,st,et);this.analyticsTracker.trackEventNoSharedProps(Ot)}this.trace(bt,dt,`ICE gathering state change: ${(rt=this.peerConnection)===null||rt===void 0?void 0:rt.iceGatheringState}`,ht,et)},this.onSelectedCandidatePairChange=()=>{var Ae,Me,rt,bt,ht,dt,et,st,Ot,En,Dn,Jn,b,S;const{token:N,action:V,traceId:ee,identifier:le}=this,Ne=(Me=(Ae=this.peerConnection)===null||Ae===void 0?void 0:Ae.getReceivers()[0].transport)===null||Me===void 0?void 0:Me.iceTransport,Qe=Ne?.getSelectedCandidatePair();if(Qe){const{local:St,remote:Lt}=Qe,Kt=`Selected candidate pair change (local, remote): ${St?.candidate}, ${Lt?.candidate}`;this.logger.debug({msg:Kt});const Xt=new N_(V,N,ee,(bt=(rt=Qe.local)===null||rt===void 0?void 0:rt.protocol)!==null&&bt!==void 0?bt:"",(dt=(ht=Qe.local)===null||ht===void 0?void 0:ht.type)!==null&&dt!==void 0?dt:"",(st=(et=Qe.local)===null||et===void 0?void 0:et.address)!==null&&st!==void 0?st:"",(En=(Ot=Qe.remote)===null||Ot===void 0?void 0:Ot.address)!==null&&En!==void 0?En:"",(Jn=(Dn=Qe.local)===null||Dn===void 0?void 0:Dn.priority)!==null&&Jn!==void 0?Jn:0,le);this.analyticsTracker.trackEvent(Xt),this.protocol=(S=(b=Qe.local)===null||b===void 0?void 0:b.protocol)!==null&&S!==void 0?S:""}},this.onIceCandidate=Ae=>Es(this,void 0,void 0,(function*(){var Me,rt;const{identifier:bt,action:ht,traceId:dt}=this,et=(Me=Ae.target.localDescription)===null||Me===void 0?void 0:Me.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,dt,`ice candidate: hasRelay = ${et}, candidate = ${(rt=Ae.candidate)===null||rt===void 0?void 0:rt.candidate}`,ht,bt))})),this.onMute=()=>Es(this,void 0,void 0,(function*(){const{token:Ae,action:Me,traceId:rt,identifier:bt}=this;this.trace(Ae,rt,"Track has muted",Me,bt)})),this.onUnMute=()=>Es(this,void 0,void 0,(function*(){const{token:Ae,action:Me,traceId:rt,identifier:bt}=this;this.trace(Ae,rt,"Track has unmuted",Me,bt)})),this.fetchAndSetRemoteDescription=Ae=>Es(this,void 0,void 0,(function*(){var Me,rt,bt,ht;const dt=(rt=(Me=this.peerConnection)===null||Me===void 0?void 0:Me.localDescription)===null||rt===void 0?void 0:rt.sdp;dt||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:et,traceId:st,action:Ot,identifier:En,tag:Dn}=this,{endpointURL:Jn,nodeOverride:b,assignmentToken:S,multiCodec:N,abortController:V}=Ae;let ee;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{const Lt=O_({connection:this.stageConnection,action:Ot,token:et,identifier:this.identifier,tracker:this.analyticsTracker});this.perfTracker.setTransport(Lt.getTransport());const Kt=b||ms("node")||ms("dataPlaneEndpoint");ee=yield Lt.exchange({sdpOffer:dt,url:Jn,traceId:st,forceNode:Kt,assignmentToken:S,multiCodec:N,abortController:V,initialLayerPreference:(bt=this.simulcastSubscribeConfig)===null||bt===void 0?void 0:bt.initialLayerPreference})}catch(Lt){let Kt=Lt;Kt instanceof Rr||(Kt=new Rr(Object.assign(Object.assign({},Zt.UNEXPECTED_ERROR),{action:Ot,token:et,traceId:st,tag:Dn,details:Lt instanceof Error?Lt.message:"",location:"sdp-exchange"}))),Kt instanceof Rr&&(this.analyticsTracker.trackError(Kt),this.emit(xu,Kt))}if(this.perfTracker.markSdpExchangeStop(),!ee)return;const{location:le,sessionDeleteLink:Ne,mediaControls:Qe}=ee;let St=ee.sdpAnswer;try{St=this.mungeSdpAnswer(St),ee.sdpAnswer=St}catch(Lt){this.logger.error({err:Lt,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=St,this.emit(mf,ee),le&&(this.whipResource={location:le,sessionDeleteLink:Ne,mediaControls:Qe},this.sfuResource=(function(Lt){const Kt=Lt.match(/https:\/\/([^/]+)\//);if(Kt){const Xt=Kt[1].split(".");if(Xt[0].includes("video-rtx"))return{node:`${Xt[0]}.${Xt[1]}`,cluster:Xt[1]}}})(le)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(ht=this.peerConnection)===null||ht===void 0?void 0:ht.setRemoteDescription({sdp:St,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(Lt){const Kt=new Rr(Object.assign(Object.assign({},Zt.SET_ANSWER_FAILURE),{action:Ot,token:et,traceId:st,tag:No(Ot,En),location:"setRemoteDescription",remoteParticipantId:En,details:Lt instanceof Error?Lt.message:""}));this.analyticsTracker.trackError(Kt),this.emit(xu,Kt)}})),this.cleanup=(Ae,Me,rt,bt=!1)=>Es(this,void 0,void 0,(function*(){var ht,dt,et;const st=bd();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,this.closeFailedPeerConnections(),!(!((ht=this.whipResource)===null||ht===void 0)&&ht.location))return this.trace(rt,this.traceId,"whipResource location not known, exiting cleanup",Ae,Me),void this.analyticsTracker.trackError(new Rr(Object.assign(Object.assign({},Zt.WHIP_URL_MISSING),{action:Ae,token:rt,traceId:this.traceId,tag:No(Ae,Me),location:Ae===Qt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:st,remoteParticipantId:Me})));let Ot=this.whipResource.location;if(this.trace(rt,this.traceId,`use hostnamecachedurl: ${Ot}`,Ae,Me),bt){if(!((et=this.whipResource)===null||et===void 0)&&et.sessionDeleteLink){Ot=this.whipResource.sessionDeleteLink,this.trace(rt,this.traceId,`DELETE via session-delete beacon path: ${Ot}`,Ae,Me);try{navigator.sendBeacon(Ot,JSON.stringify({authorization:rt.rawToken}))}catch(En){this.analyticsTracker.trackErrorAndThrow(new Rr(Object.assign(Object.assign({},Dh(Zt.WHIP_DELETE_FAILURE,En)),{action:Ae,token:rt,traceId:this.traceId,tag:No(Ae,Me),location:Qt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:st,remoteParticipantId:Me})))}}}else try{yield pf().delete(Ot,{headers:{Authorization:`Bearer ${rt.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":st.value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":ta}})}catch(En){((dt=En.response)===null||dt===void 0?void 0:dt.status)===404?this.trace(rt,this.traceId,`DELETE returned 404, ignoring, action = ${Ae}, uuid = ${st.value}`,Ae,Me):this.analyticsTracker.trackErrorAndThrow(new Rr(Object.assign(Object.assign({},Dh(Zt.WHIP_DELETE_FAILURE,En)),{action:Ae,token:rt,traceId:this.traceId,tag:No(Ae,Me),location:Qt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:st,remoteParticipantId:Me})))}})),this.getConnectionState=()=>{if(!this.peerConnection)return hr.NONE;const Ae=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return Zg(Ae)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:Ae}),hr.IDLE}},this.onIceCandidateError=Ae=>{const{token:Me,traceId:rt,tag:bt}=this;if(Ae.errorCode!==701){const ht=new Rr(Object.assign(Object.assign({},Zt.ICE_CANDIDATE_ERROR),{action:this.action,token:Me,traceId:rt,tag:bt,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(ht),this.emit(xu,ht)}},this.onIceConnectionStateChange=()=>{var Ae,Me;const{token:rt,traceId:bt,action:ht,identifier:dt}=this;this.trace(rt,bt,`ICE connection state change: ${(Ae=this.peerConnection)===null||Ae===void 0?void 0:Ae.iceConnectionState}`,ht,dt),((Me=this.peerConnection)===null||Me===void 0?void 0:Me.iceConnectionState)==="checking"&&this.peerConnection.getTransceivers().forEach((({receiver:et,sender:st})=>{[et,st].forEach((Ot=>{var En,Dn;(Dn=(En=Ot?.transport)===null||En===void 0?void 0:En.iceTransport)===null||Dn===void 0||Dn.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)}))})),this.onConnectionStateChange()},this.createVideoSenderTransformer=()=>new Ps(this.analyticsTracker.getSessionId()),this.createVideoReceiverTransformer=()=>{const Ae=new I_(this.analyticsTracker.getSessionId()),{token:Me,tag:rt,identifier:bt,action:ht,traceId:dt}=this;Ae.on($u,(Ot=>{this.emit(Th,Ot)}));const et=(function(Ot,En){let Dn=0;return function(...Jn){const b=Date.now();b-Dn>=En&&(Dn=b,Ot(...Jn))}})((Ot=>{const En=`Transform error occurred: ${Ot.type}`,Dn=Uo({traceId:dt,token:Me,tag:rt,identifier:bt,action:ht,details:En,stageErrorValue:Zt.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:Dn,msg:"Error encountered when transforming receiver",error:Ot})}),1e3),st=Ot=>{const En=`Too many errors occurred: ${Ot.type}`,Dn=Uo({traceId:dt,token:Me,tag:rt,identifier:bt,action:ht,details:En,stageErrorValue:Zt.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:Dn,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:Ot}),Ae.destroy(),this.analyticsTracker.trackError(Dn),this.emit(vc,Dn)};return Ae.on(Kb,(Ot=>{Ot.stageErrorValue.code!==Zt.TRANSFORM_TOO_MANY_ERRORS.code?et(Ot):st(Ot)})),Ae},this.onConnectionStateChange=()=>{if(this.peerConnection){const Me=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:rt,traceId:bt,identifier:ht,action:dt}=this,et=new na(dt,rt,bt,Me,ht);this.analyticsTracker.trackEventNoSharedProps(et),this.trace(rt,bt,`connection state change: ${Me}`,dt,ht)}const Ae=this.getConnectionState();switch(Ae){case hr.CONNECTED:this.closeFailedPeerConnections(),this.perfTracker.markActionStop(),this.emit(jc,Ae),this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream);break;case hr.FAILED:this.storeFailedPeerConnection(this.peerConnection),this.destroyPeerConnection({closeConnection:!1}),this.emit(jc,Ae),this.handleConnectionFailure();break;default:this.emit(jc,Ae)}},this.onIncompatibleCodecs=Ae=>Es(this,void 0,void 0,(function*(){if(Ae.forEach((bt=>{let ht=!1;this.incompatibleCodecs.forEach((dt=>{dt.config===bt.config&&dt.mime===bt.mime&&(ht=!0)})),ht||this.incompatibleCodecs.add(bt)})),this.peerConnection)try{yield(Me=this.peerConnection,rt=[...this.incompatibleCodecs],Ax(void 0,void 0,void 0,(function*(){var bt;for(const ht of Me.getSenders()){const dt=ht.getParameters();if(dt.codecs.length>1){const et=dt.codecs[0];let st=!1;for(const Ot of rt)S_(et,Ot)&&(st=!0);if(st){const Ot=Cx(rt,dt.codecs);(bt=dt.encodings)===null||bt===void 0||bt.forEach((En=>{En.active&&(En.codec=Ot)})),yield ht.setParameters(dt)}}}})))}catch(bt){const{token:ht,action:dt,traceId:et,identifier:st}=this,Ot=new Rr(Object.assign(Object.assign({},Zt.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:dt,token:ht,traceId:et,tag:No(dt,st),location:"onIncompatibleCodecs",remoteParticipantId:st,details:bt instanceof Error?bt.message:""}));this.analyticsTracker.trackError(Ot),this.emit(xu,Ot)}var Me,rt})),this.token=w,this.logger=new qa(R,oe.WEBRTC),this.action=U,this.tag=j,this.traceId=$,U===Qt.SUBSCRIBE&&!ue)throw new Error("Subscribe action provided without subscriber Id");this.jitterBufferConfig=ce?.jitterBuffer,this.simulcastSubscribeConfig=ce?.simulcast,this.subscriberId=ue,this.stageConnection=me,this.failedPeerConnections=[],this.receiveInBandMessagingEnabled=!!(!((de=this.subscribeConfig)===null||de===void 0)&&de.inBandMessaging.enabled),this.perfTracker=new po(this.action,this.traceId),this.statsReporter=new R_(U,w,$,this.identifier,this.analyticsTracker),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var w,R;return(R=(w=this.videoTransceiver)===null||w===void 0?void 0:w.mid)!==null&&R!==void 0?R:null}toggleStageConnectionListeners(w){var R,U;w?(R=this.stageConnection)===null||R===void 0||R.on(Iu,this.handlePublishingChangedBinding):(U=this.stageConnection)===null||U===void 0||U.off(Iu,this.handlePublishingChangedBinding)}updateSubscribeConfig(w){var R,U;if(this.jitterBufferConfig=w.jitterBuffer,this.simulcastSubscribeConfig=w.simulcast,this.action===Qt.SUBSCRIBE){const j=w.inBandMessaging.enabled;this.receiveInBandMessagingEnabled!==j&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for receiver"})}this.applyJitterBufferMinDelayConditionally((U=(R=this.stageConnection)===null||R===void 0?void 0:R.getIsStagePublishing())!==null&&U!==void 0&&U)}verifyOrUpdateTransceiverSync(){var w,R;return Es(this,void 0,void 0,(function*(){if(this.publishVideoStream){const U=this.getTransceiverForKind("video");U?this.publishVideoStream.track.id!==((w=U.sender.track)===null||w===void 0?void 0:w.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishVideoStream)):this.logger.warn({msg:"missing transceiver for video"})}if(this.publishAudioStream){const U=this.getTransceiverForKind("audio");U?this.publishAudioStream.track.id!==((R=U.sender.track)===null||R===void 0?void 0:R.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishAudioStream)):this.logger.warn({msg:"missing transceiver for audio"})}}))}start(){return Es(this,void 0,void 0,(function*(){const{token:w,action:R,traceId:U,identifier:j}=this;R!==Qt.PUBLISH||w.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new Rr(Object.assign(Object.assign({},Dh(Zt.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:R,token:w,traceId:U,tag:No(R,j),location:"StagePeerClient.start",remoteParticipantId:j})));const $=(function({action:X,identifier:ue,token:me,analyticsTracker:ce}){let de="";const Ae=Fp(me,ce);switch(X){case Qt.PUBLISH:de=Ae.getPublishEndpoint();break;case Qt.SUBSCRIBE:ue&&(de=Ae.getSubscribeEndpoint(ue))}return de})({action:R,identifier:j,token:w.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.endpointURL=$,this.createPeerConnection(),this.trace(w,U,"peer connection created",R,j)}catch(X){const ue=new Rr(Object.assign(Object.assign({action:R},Dh(Zt.CREATE_PEER_CONNECTION_FAILURE,X)),{token:w,traceId:U,tag:No(R,j),location:"StagePeerClient.start",remoteParticipantId:j}));R===Qt.PUBLISH&&this.emit(jc,hr.FAILED),this.emit(xu,ue),this.analyticsTracker.trackErrorAndThrow(ue)}}))}mungeSdpOffer(w,R,U){if(U.simulcastEnabled&&(w=new fi(w).withVideoLayersAllocationRtpHeaderExtension().sdp),R===Qt.SUBSCRIBE)w=new fi(w).withOpusAudioConfig(Gl(Vp),!0).sdp;else if(R===Qt.PUBLISH&&U.audioConfig){const{maxBitrateBps:j,stereo:$}=U.audioConfig;w=new fi(w).withOpusAudioConfig(j,$).sdp}return w}mungeSdpAnswer(w){Bh.browser.isFirefox()&&this.publishAudioStream&&this.action===Qt.PUBLISH&&(w=new fi(w).withOpusAudioConfig(this.publishAudioStream.config.maxBitrateBps,void 0).sdp);const R=Bh.browser.isChrome()||Bh.browser.isEdge();this.action===Qt.SUBSCRIBE&&R&&(w=new fi(w).withoutAudioRtcpRSize().sdp);const U=(function(){const j=ms("subscribeForceIceProtocol");if(j==="tcp"||j==="udp")return j})();return this.action===Qt.SUBSCRIBE&&U&&(w=new fi(w).withFilteredCandidates(U).sdp),w}createPeerConnection(){var w;this.logger.debug({msg:"setting up peer connection"}),this.peerConnection&&(this.logger.debug({msg:"peer connection is already established, cleaning up previous connection"}),this.destroyPeerConnection({closeConnection:!1})),this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,(w=this.publishVideoStream)===null||w===void 0?void 0:w.config.simulcastEnabled),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute)}destroyPeerConnection(w){var R,U,j,$,X,ue,me,ce,de;this.statsReporter.stop(),(R=this.peerConnection)===null||R===void 0||R.removeEventListener("connectionstatechange",this.onConnectionStateChange),(U=this.peerConnection)===null||U===void 0||U.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(j=this.peerConnection)===null||j===void 0||j.removeEventListener("icecandidateerror",this.onIceCandidateError),($=this.peerConnection)===null||$===void 0||$.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(X=this.peerConnection)===null||X===void 0||X.removeEventListener("icecandidate",this.onIceCandidate),(ue=this.peerConnection)===null||ue===void 0||ue.removeEventListener("track",this.onTrack),(me=this.peerConnection)===null||me===void 0||me.removeEventListener("mute",this.onMute),(ce=this.peerConnection)===null||ce===void 0||ce.removeEventListener("unmute",this.onUnMute),(w.closeConnection||this.action===Qt.PUBLISH)&&((de=this.peerConnection)===null||de===void 0||de.close()),this.peerConnection=void 0}closeFailedPeerConnections(){for(const w of this.failedPeerConnections)w?.close();this.failedPeerConnections=[]}storeFailedPeerConnection(w){w&&this.action!==Qt.PUBLISH&&this.failedPeerConnections.push(w)}stop(){var w,R;(w=this.videoReceiverTransformer)===null||w===void 0||w.destroy(),(R=this.videoSenderTransformer)===null||R===void 0||R.destroy(),this.destroyPeerConnection({closeConnection:!0})}getTransceiverForKind(w){if(!this.peerConnection)return;const R=this.peerConnection.getTransceivers();return w==="audio"?R.find((U=>U.mid==="0")):w==="video"?R.find((U=>U.mid==="1")):void 0}removeTrack(w){return Es(this,void 0,void 0,(function*(){if(w==="audio"||w==="video")if(this.peerConnection)try{const R=this.getTransceiverForKind(w);if(!R)return void this.logger.warn({msg:`tried removing track type ${w} but couldn't find transceiver`});yield R.sender.replaceTrack(null),w===fl.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0,yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(R){this.logger.warn({msg:"error replacing track",err:R})}else w===fl.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:w})}))}replaceOrUpdateStream(w){return Es(this,void 0,void 0,(function*(){if(w.track){if(vl(w)?this.publishAudioStream=w:C_(w)&&(this.publishVideoStream=w),this.peerConnection)try{const R=this.getTransceiverForKind(w.track.kind);if(!R)return void this.logger.warn({msg:`tried replacing track type ${w.track.kind} but couldn't find transceiver`,track:w.track});if(C_(w)){const U=R.sender.getParameters(),j=w.config.encodingLayers;U.encodings=U.encodings.map(($=>{var X;const ue=(X=$.rid)!==null&&X!==void 0?X:"",me=j.find((ce=>{var de;return((de=ce.rid)!==null&&de!==void 0?de:"")===ue}));return me?Object.assign(Object.assign({},$),me):$})),yield R.sender.setParameters(U)}else if(vl(w)){const U=R.sender.getParameters(),j=y_(w)[0];U.encodings=U.encodings.map(($=>Object.assign(Object.assign({},$),j))),yield R.sender.setParameters(U)}yield R.sender.replaceTrack(w.track),yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(R){this.logger.warn({msg:"error replacing track",err:R})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateStream with no track"})}))}initializePeerConnection(w=!1){var R,U,j,$,X,ue,me,ce;return Es(this,void 0,void 0,(function*(){const{traceId:de,token:Ae,action:Me,identifier:rt}=this;Oh(this.peerConnection),this.resetTransformers();let bt=new MediaStream;if(Me===Qt.PUBLISH){this.publishAudioStream||(this.publishAudioStream={track:this.getSilentAudio(),config:{maxBitrateBps:Gl(N0),stereo:!1}});const ht=this.peerConnection.getTransceivers(),dt=[];ht.forEach((b=>{var S;dt.concat((S=b.sender.track)===null||S===void 0?void 0:S.id)})),bt=new MediaStream([this.publishAudioStream.track,(R=this.publishVideoStream)===null||R===void 0?void 0:R.track].filter((b=>!!b&&!dt.includes(b.id))));const et=bt.getAudioTracks()[0]||"audio",st=bt.getVideoTracks()[0]||"video",Ot={direction:"sendonly",streams:[bt],sendEncodings:y_(this.publishAudioStream)},En={direction:"sendrecv",streams:[bt],sendEncodings:(U=this.publishVideoStream)===null||U===void 0?void 0:U.config.encodingLayers};this.peerConnection.addTransceiver(et,Ot),this.trace(Ae,de,`track added, type: ${et.kind||et}`,Me,rt);const Dn=this.peerConnection.addTransceiver(st,En);this.trace(Ae,de,`track added, type: ${st.kind||st}`,Me,rt);const Jn=!!(!(($=(j=this.publishVideoStream)===null||j===void 0?void 0:j.config)===null||$===void 0)&&$.inBandMessagingEnabled);this.sendInBandMessagingEnabled===void 0?this.sendInBandMessagingEnabled=Jn:this.sendInBandMessagingEnabled!==Jn&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for sender"}),this.sendInBandMessagingEnabled&&!Ps.isSupported(Dn)?this.handleTransformNotSupported():this.sendInBandMessagingEnabled&&((X=this.videoSenderTransformer)===null||X===void 0||X.onTransceiverAdd(Dn))}else Me===Qt.SUBSCRIBE&&(Ae.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(Ae,de,"track added, type: audio",Me,rt),w||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(Ae,de,"track added, type: video",Me,rt),this.receiveInBandMessagingEnabled&&!I_.isSupported(this.videoTransceiver)?this.handleTransformNotSupported():this.receiveInBandMessagingEnabled&&((ue=this.videoReceiverTransformer)===null||ue===void 0||ue.onTransceiverAdd(this.videoTransceiver))),this.peerConnection.getTransceivers().forEach((ht=>{ht.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),bt?.addTrack(ht.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})})),this.applyJitterBufferMinDelayConditionally((ce=(me=this.stageConnection)===null||me===void 0?void 0:me.getIsStagePublishing())!==null&&ce!==void 0&&ce));return bt}))}handlePublishingChanged(w){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${w}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===Qt.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(w)}applyJitterBufferMinDelayConditionally(w){const R=this.currentJitterBufferMinDelayInMs,U=this.calcJitterBufferMinDelay(w,this.jitterBufferConfig);if(w){if(R===void 0||R>U){const j=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${U}`;this.logger.debug({msg:j}),this.trace(this.token,this.traceId,j,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(U)}}else if(R===void 0||U!==R){const j=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${U}`;this.logger.debug({msg:j}),this.trace(this.token,this.traceId,j,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(U)}}calcJitterBufferMinDelay(w,R){var U,j,$;let X=0;if(!(()=>{const ue=RTCRtpReceiver.prototype;return!(!ue||typeof ue!="object")&&("jitterBufferTarget"in ue||"playoutDelayHint"in ue)})())return 0;if(w)X=zu((U=R?.minDelayWhenPublishing)!==null&&U!==void 0?U:Ms.DEFAULT,w);else{X=zu((j=R?.minDelayWhenSubscribeOnly)!==null&&j!==void 0?j:Ms.DEFAULT,w);const ue=($=this.stageConnection)===null||$===void 0?void 0:$.jitterBufferMinDelayInMs();R?.minDelayWhenSubscribeOnly===Ms.DEFAULT&&ue!==void 0&&(X=ue,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${X}`}))}return X}applyAndTrackJitterBufferMinDelay(w){var R,U;this.currentJitterBufferMinDelayInMs=w,this.statsReporter.updateJitterBufferMinDelay(w),w!==void 0&&((U=(R=this.peerConnection)===null||R===void 0?void 0:R.getTransceivers())===null||U===void 0||U.forEach((j=>{j.receiver&&this.applyJitterBufferMinDelay(j.receiver,w)})))}applyJitterBufferMinDelay(w,R){let U="Unable to set jitter buffer min delay";if("jitterBufferTarget"in w)U=`setting jitterBufferTarget to: ${R} for track: ${w.track.kind}`,this.logger.debug({msg:U}),w.jitterBufferTarget=R;else if("playoutDelayHint"in w){const j=R/1e3;U=`setting playoutDelayHint to: ${R} for track: ${w.track.kind}`,this.logger.debug({msg:U}),w.playoutDelayHint=j}else this.logger.warn({msg:U});this.trace(this.token,this.traceId,U,this.action,this.identifier)}exchangeSdp(w){var R,U,j;return Es(this,void 0,void 0,(function*(){const{traceId:$,token:X,action:ue,identifier:me,tag:ce,endpointURL:de}=this,{iceRestart:Ae=!1,nodeOverride:Me,assignmentToken:rt,abortController:bt}=w;let ht;this.logger.debug({msg:`Exchanging SDP: ${$.value}, iceRestart=${Ae}, nodeOverride=${Me}, assignmentToken=${rt}`}),Oh(this.peerConnection),ue===Qt.PUBLISH&&bp()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),((et,st)=>{var Ot,En;const Dn=(Ot=RTCRtpReceiver.getCapabilities("video"))===null||Ot===void 0?void 0:Ot.codecs;if(!Dn)return;let Jn=Dn;Jn=iy(Dn,"42e0"),st.preferMainProfile&&(Jn=iy(Dn,"4d00")),(En=et.getTransceivers().find((b=>b.receiver.track.kind==="video")))===null||En===void 0||En.setCodecPreferences(Jn)})(this.peerConnection,{preferMainProfile:bp()}));try{this.trace(X,$,"Creating offer",ue,me),ht=yield this.peerConnection.createOffer({iceRestart:Ae})}catch(et){const st=new Rr(Object.assign(Object.assign({},Dh(Zt.CREATE_OFFER_FAILURE,et)),{action:ue,token:X,traceId:$,tag:ce,location:"exchangeSdp",remoteParticipantId:me}));this.emit(xu,st),this.analyticsTracker.trackErrorAndThrow(st)}ht.sdp&&(ht.sdp=this.mungeSdpOffer(ht.sdp,ue,{simulcastEnabled:(U=(R=this.publishVideoStream)===null||R===void 0?void 0:R.config.simulcastEnabled)!==null&&U!==void 0&&U,audioConfig:(j=this.publishAudioStream)===null||j===void 0?void 0:j.config})),this.trace(X,$,"Setting local description",ue,me),yield this.peerConnection.setLocalDescription(ht),this.trace(X,$,"local description set",ue,me),de||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const dt=ue===Qt.PUBLISH&&bp()||ue===Qt.SUBSCRIBE&&Bc("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:de,nodeOverride:Me,assignmentToken:rt,multiCodec:dt,abortController:bt})}))}getReports(){var w;return Es(this,void 0,void 0,(function*(){try{const R=(yield(w=this.peerConnection)===null||w===void 0?void 0:w.getStats())||[],U=[];return R.forEach((j=>{U.push(j)})),U}catch{return[]}}))}requestRTCStats(w){return Es(this,void 0,void 0,(function*(){if(this.peerConnection)return this.statsReporter.getStats(w)}))}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:w,tag:R,identifier:U,action:j,traceId:$}=this,X=Uo({traceId:$,token:w,tag:R,identifier:U,action:j,stageErrorValue:Zt.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:X,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(X),this.emit(vc,X)}handleConnectionFailure(){return Es(this,void 0,void 0,(function*(){const{token:w,traceId:R,tag:U}=this;this.analyticsTracker.trackError(new Rr(Object.assign(Object.assign({},Zt.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:w,traceId:R,tag:U,location:"onIceCandidateError",remoteParticipantId:this.identifier})))}))}getSilentAudio(){Vh||(Vh=new AudioContext);const w=Vh.createOscillator(),R=Vh.createGain();w.connect(R);const U=Vh.createMediaStreamDestination();return R.connect(U),R.gain.value=0,w.start(),U.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}getProtocol(){return this.protocol}initStreamsToPublish(w){this.publishVideoStream=w.find(C_),this.publishAudioStream=w.find(vl)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var w,R;return this.calcJitterBufferMinDelay((R=(w=this.stageConnection)===null||w===void 0?void 0:w.getIsStagePublishing())!==null&&R!==void 0&&R,this.jitterBufferConfig)}trace(w,R,U,j,$){this.analyticsTracker.trackEventNoSharedProps(new Ba(w,R,U,j,$))}sendSeiMessage(w,R){const U=this.getTransceiverForKind("video");return this.videoSenderTransformer&&this.sendInBandMessagingEnabled?this.action===Qt.PUBLISH&&U?this.videoSenderTransformer.sendSeiMessage(w,R):xn.err(oa.NOT_PUBLISHING_VIDEO):xn.err(oa.INBAND_MESSAGING_NOT_ENABLED)}}const P_=Qt.SUBSCRIBE;class Md{constructor(w,R,U){this.analyticsTracker=w,this.token=R,this.remoteId=U,this.action=P_}trackAttempt({stageConnectionStats:w,isReassignment:R=!1,traceIdOverride:U,preAttemptSfuResource:j}){const{action:$,analyticsTracker:X,token:ue,remoteId:me}=this,ce=U||Ns();return X.trackEvent(new Br({token:this.token,subscribedId:this.remoteId,traceId:ce,isEdpConnected:w.isConnected,isReassignment:R,preAttemptSfuResource:j})),{getTraceId:()=>ce,trackSubscribeStarted({totalDurationWithRetries:de,retryTimes:Ae,sfuResource:Me,peerClientPerfStats:rt,protocol:bt}){const{optionsDuration:ht,postDuration:dt,timeToCandidate:et,timeToConnected:st,sdpExchangeDuration:Ot,sdpExchangeTransport:En,setRemoteDescDuration:Dn,peerConnectionDuration:Jn}=rt,{edpInitialConnectDuration:b,edpInitialConnectRetries:S,edpInitialStateDuration:N,edpInitialStatePublishingCount:V,edpStateUpdateCount:ee}=w;X.trackEvent(new Wb({token:ue,traceId:ce,remoteParticipantId:me,optionsDuration:ht,postDuration:dt,timeToCandidate:et,totalDuration:st,edpInitialConnectDuration:b,edpInitialConnectRetries:S,edpInitialStateDuration:N,edpInitialStatePublishingCount:V,edpStateUpdateCount:ee,sdpExchangeDuration:Ot,sdpExchangeTransport:En,setRemoteDescDuration:Dn,peerConnectionDuration:Jn,sfuResource:Me,totalDurationWithRetries:de,subscribeRetryTimes:Ae,isReassignment:R,protocol:bt}))},trackSubscribeFirstFrame:({peerClientPerfStats:de,totalDurationWithRetries:Ae,sfuResource:Me,retryTimes:rt,currentJitterBufferMinDelayInMs:bt,mediaType:ht,firstFrameDuration:dt,protocol:et})=>{const{sdpExchangeDuration:st,sdpExchangeTransport:Ot,setRemoteDescDuration:En,peerConnectionDuration:Dn}=de,{edpInitialConnectDuration:Jn,edpInitialConnectRetries:b,edpInitialStateDuration:S,edpInitialStatePublishingCount:N,edpStateUpdateCount:V}=w;this.analyticsTracker.trackEvent(new Lx({token:this.token,traceId:ce,remoteParticipantId:me,edpInitialConnectDuration:Jn,edpInitialConnectRetries:b,edpInitialStateDuration:S,edpInitialStatePublishingCount:N,edpStateUpdateCount:V,sdpExchangeDuration:st,sdpExchangeTransport:Ot,setRemoteDescDuration:En,peerConnectionDuration:Dn,videoWasPaused:!1,firstFrameDuration:dt,mediaType:ht,sfuResource:Me,totalDurationWithRetries:Ae,subscribeRetryTimes:rt,currentJitterBufferMinDelayInMs:bt,protocol:et}))},trackSubscribeFailed(de,Ae,Me){const rt=((dt,et,st)=>{if(dt instanceof Rr)return dt;let Ot="";return dt instanceof gc.AxiosError&&(Ot+=`AxiosError - ${dt.code}`),new Rr(Object.assign(Object.assign(Object.assign({},Zt.SUBSCRIBE_FAILURE),{action:P_,token:et,traceId:st,tag:w0,location:"subscribe",details:`${Ot} ${dt?.message}`}),{fatal:!0}))})(de,ue,ce);X.trackEvent(new qb({token:ue,traceId:ce,remoteParticipantId:me,code:rt.code,message:rt.message,fatal:rt.fatal,nominal:rt.nominal,isReassignment:R,protocol:Ae}));const{isConnected:bt}=w,ht=new Rr(Object.assign(Object.assign({},Zt.SUBSCRIBE_FAILURE),{action:$,token:ue,traceId:ce,tag:No(Qt.SUBSCRIBE,me),location:"subscribe",remoteParticipantId:me,isEdpConnected:bt,details:Me}));return de instanceof Rr&&(ht.fatal=de.fatal,ht.nominal=de.nominal,ht.location=`subscribe > ${de.location}`),X.trackError(ht),rt},trackUnsubscribe:()=>{X.trackEvent(new k_({token:ue,unsubscribedId:me,traceId:ce}))},trackEndSucceeded:(de,Ae)=>{X.trackEvent(new Rd({token:ue,traceId:ce,remoteParticipantId:me,isUnsubscribeSuccessful:!0,reason:de,protocol:Ae}))},trackEndFailed:(de,Ae)=>{const Me=new Rr(Object.assign(Object.assign({},Zt.UNSUBSCRIBE_FAILURE),{token:ue,traceId:ce,tag:No(Qt.SUBSCRIBE,me),location:"unsubscribe",remoteParticipantId:me}));return de!==Sr.UNLOAD&&de!==Sr.UNSUBSCRIBE||X.trackError(Me),X.trackEvent(new Rd({token:ue,traceId:ce,remoteParticipantId:me,isUnsubscribeSuccessful:!0,reason:de,protocol:Ae})),Me}}}}class Wp extends Xn{constructor(w,R,U,j,$,X){super(Mn.PLAYBACK_LAYER_REQUEST,w,R,!1),Object.assign(this.properties,{media_type:U,remote_participant_id:j,track_id:$,layer_id:X})}}class my extends Xn{constructor(w,R,U,j,$,X=1){super(Mn.PLAYBACK_LAYER_STATE,w,R,!1),Object.assign(this.properties,{media_type:U,remote_participant_id:j,track_id:$,request_count:X})}}var Gu,xs,Od,Ds;(function(P){P.PAUSE="pause",P.PLAY="play"})(Gu||(Gu={})),(function(P){P.IDLE="idle",P.ACTIVE="active",P.ERRORED="errored",P.DESTROYED="destroyed"})(xs||(xs={})),(function(P){P.SUCCESS="success"})(Od||(Od={})),(function(P){P.FAILED="failed",P.DESTROYED="destroyed",P.THROTTLED="throttled"})(Ds||(Ds={}));var Tc=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class gy{constructor(w){this.state=xs.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>Tc(this,void 0,void 0,(function*(){return this.state!==xs.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(Gu.PAUSE)})),this.startVideo=()=>Tc(this,void 0,void 0,(function*(){return this.state!==xs.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(Gu.PLAY)})),this.setLayer=R=>Tc(this,void 0,void 0,(function*(){return this.state!==xs.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(R)})),this.unsetLayer=()=>Tc(this,void 0,void 0,(function*(){return this.state!==xs.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()})),this.getLayers=()=>Tc(this,void 0,void 0,(function*(){return this.state!==xs.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()})),this.sendPlaybackRequest=R=>Tc(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,xn.err)(Ds.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,xn.err)(Ds.FAILED);this.logger.info({msg:`Sending ${R} request to ${this.playbackEndpoint}`});const U=R===Gu.PAUSE?{pause:[this.mid]}:{play:[this.mid]},j=this.createPostWhepRequest(U);return fetch(this.playbackEndpoint,j).then(($=>{if($.status>=300){const X=new Error(`Error sending media controls request: ${$.status}:${$.statusText}`);return this.logger.error({err:X}),(0,xn.err)(Ds.FAILED)}return this.logger.debug({msg:`Request to ${R} was successful: ${$.status}`}),(0,xn.ok)(Od.SUCCESS)})).catch(($=>(this.logger.error({err:$,msg:"Error sending media controls request"}),(0,xn.err)(Ds.FAILED))))})),this.sendLayerRequest=R=>Tc(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,xn.err)(Ds.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,xn.err)(Ds.FAILED);const U=typeof R=="string",j=U?{mediaId:this.mid,encodingId:R}:{},$=U?`set : ${R}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${$} at ${this.layersEndpoint}`});const X=this.createPostWhepRequest(j);return this.trackLayerRequest(R??"auto"),fetch(this.layersEndpoint,X).then((ue=>this.state===xs.DESTROYED?(0,xn.err)(Ds.DESTROYED):ue.status>=300?this.handleLayerRequestError(ue.status,ue.statusText):(this.logger.debug({msg:`Request to ${$} was successful: ${ue.status}`}),(0,xn.ok)(Od.SUCCESS)))).catch((ue=>this.handleLayerRequestError(0,ue.message)))})),this.sendLayerStateRequest=()=>Tc(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,xn.err)(Ds.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,xn.err)(Ds.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const R=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,R).then((U=>Tc(this,void 0,void 0,(function*(){var j;if(this.state===xs.DESTROYED)return(0,xn.err)(Ds.DESTROYED);if(U.status>=300)return this.handleLayerStateRequestError(U.status,U.statusText);const $=yield U.json(),X=(j=$?.layers)!==null&&j!==void 0?j:[],ue=JSON.stringify(X,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${ue}`}),(0,xn.ok)(X)})))).catch((U=>this.handleLayerStateRequestError(0,U.message)))})),this.logger=new qa(w.logger,oe.REMOTE_PLAYBACK),this.token=w.token,this.traceId=w.traceId,this.analyticsTracker=w.analyticsTracker,this.remoteParticipantId=w.remoteParticipantId}set mediaId(w){if(this.state!==xs.DESTROYED){if(this.mid=w,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=xs.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=xs.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(w){var R,U;if(this.state!==xs.DESTROYED){if(this.playbackEndpoint=(R=w.playback)!==null&&R!==void 0?R:null,this.layersEndpoint=(U=w.layers)!==null&&U!==void 0?U:null,!this.playbackEndpoint||!this.layersEndpoint){const j={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(j,null)}`}),void(this.state=xs.IDLE)}this.mid&&(this.state=xs.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=xs.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(w="command"){this.logger.info({msg:`skipping ${w}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(w){return w===xs.DESTROYED?(0,xn.err)(Ds.DESTROYED):(0,xn.err)(Ds.FAILED)}createPostWhepRequest(w){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(w)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var w,R;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":bd().value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(R=(w=this.traceId)===null||w===void 0?void 0:w.value)!==null&&R!==void 0?R:"","X-Stages-WHIP-Version":ta}}trackLayerRequest(w){var R;this.analyticsTracker.trackEventNoSharedProps(new Wp(this.token,this.traceId,wr.VIDEO,this.remoteParticipantId,(R=this.mid)!==null&&R!==void 0?R:"unknown",w))}trackLayerStateRequest(w=1){var R;this.analyticsTracker.trackEventNoSharedProps(new my(this.token,this.traceId,wr.VIDEO,this.remoteParticipantId,(R=this.mid)!==null&&R!==void 0?R:"unknown",w))}handleLayerRequestError(w,R){const U=`sendLayerRequest failed for reason: ${w} ${R}`;let j,$;return w===429?(j=Ds.THROTTLED,$=Zt.WHEP_SET_LAYER_REQUEST_THROTTLED):(j=Ds.FAILED,$=Zt.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError($,U),(0,xn.err)(j)}handleLayerStateRequestError(w,R){const U=`sendLayerStateRequest failed for reason: ${w} ${R}`;let j,$;return w===429?(j=Ds.THROTTLED,$=Zt.WHEP_GET_LAYER_STATE_THROTTLED):(j=Ds.FAILED,$=Zt.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError($,U),(0,xn.err)(j)}trackRequestError(w,R){const U=new Error(R);this.logger.error({err:U}),w.message=R;const j=this.createError(w);this.analyticsTracker.trackError(j)}createError(w,R){return new Rr(Object.assign({action:Qt.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:w0,details:R},w))}}var If,Hh,Qs,Ws,Wu=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))},C=function(P,w,R,U){if(typeof w=="function"?P!==w||!U:!w.has(P))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?U:R==="a"?U.call(P):U?U.value:w.get(P)};(function(P){P.DISCONNECTED="disconnected",P.CONNECTING="connecting",P.CONNECTED="connected",P.ERRORED="errored"})(Qs||(Qs={})),(function(P){P.NONE="none",P.AUDIO_ONLY="audio_only",P.AUDIO_VIDEO="audio_video"})(Ws||(Ws={}));class B extends Da{constructor(w,R,U,j,$,X,ue){super(),this.id=w,this.token=R,this.stageConnection=U,this.nonScopedLogger=j,this.analyticsTracker=$,this.desiredSubscribeType=X,If.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:Qs.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new Tx(1e3),this.cleanupFirstFrameTracking=Ah,this.actualSubscribeType=Ws.NONE,this.action=Qt.SUBSCRIBE,this.updateDesiredSubscribeType=ce=>{this.desiredSubscribeType=ce,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=ce=>{this.peerClient.updateSubscribeConfig(ce)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const ce=this.actualSubscribeType,de=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${de}`}),this.subscriptionState.connectionState===Qs.CONNECTED&&de!==Ws.NONE&&ce!==de&&this.applyVideoControlsBySubscribeType(de,ce)},this.onParticipantUpdated=ce=>{C(this,If,"m",Hh).call(this,ce)&&(this.logger.debug({msg:"onParticipantUpdated",participant:ce}),this.processStateUpdate({isTargetPublishing:ce.isPublishing}))},this.onParticipantJoined=ce=>{C(this,If,"m",Hh).call(this,ce)&&(this.logger.debug({msg:"onParticipantJoined",participant:ce}),this.processStateUpdate({isTargetPublishing:ce.isPublishing}))},this.onParticipantLeft=ce=>{C(this,If,"m",Hh).call(this,ce)&&(this.logger.debug({msg:"onParticipantLeft",participant:ce}),this.processStateUpdate({isTargetPublishing:!1}))},this.onPeerClientConnectionStateChange=ce=>{const de=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${ce}`,state:ce,targetParticipant:de}),this.processStateUpdate({peerClientState:ce})},this.onPeerClientTransformError=ce=>{this.emit(Up,ce)},this.onSdpNegotiated=ce=>{this.remotePlaybackController.endpoints={playback:ce.mediaControls,layers:ce.layerControls}},this.seiMessageHandler=ce=>{this.emit(Pu,ce)},this.requestRTCStats=ce=>Wu(this,void 0,void 0,(function*(){return this.peerClient.requestRTCStats(ce)})),this.trySubscribe=ce=>Wu(this,void 0,void 0,(function*(){var de,Ae;if(this.logger.debug({msg:`Subscribe attempt started: ${ce}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==Qs.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:Qs.CONNECTING}));const Me=this.stageConnection.getConnectionStats(),rt=this.peerClient.getExpectedJitterBufferMinDelayInMs(),bt=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:Me,preAttemptSfuResource:bt});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:ht}=yield this.subscribe(this.attemptTracker.getTraceId()),dt=performance.now()-this.startConnectingTimestamp,et=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const st=this.failedRetries;this.attemptToActualizeSubscribeType();const Ot=this.peerClient.getActionMeasurements(),En=this.peerClient.getProtocol();if(this.attemptTracker.trackSubscribeStarted({sfuResource:et,totalDurationWithRetries:dt,retryTimes:st,peerClientPerfStats:Ot,protocol:En}),ht){this.cleanupFirstFrameTracking();const Dn=this.actualSubscribeType,Jn=this.attemptTracker,b=(S,N)=>{Jn.trackSubscribeFirstFrame({peerClientPerfStats:Ot,sfuResource:et,totalDurationWithRetries:dt,retryTimes:st,currentJitterBufferMinDelayInMs:rt,mediaType:N,firstFrameDuration:S,protocol:En})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:ht,subscribeType:Dn,callback:b})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,ht&&this.emit(Tf,ht,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(ht){const dt=(Ae=(de=this.peerClient)===null||de===void 0?void 0:de.getProtocol())!==null&&Ae!==void 0?Ae:"",et=this.attemptTracker.trackSubscribeFailed(ht,dt);this.logger.error({log:"Subscribe attempt failed",err:ht}),this.onTrySubscribeFailure(et,ce)}return!1}));const me=Ns();this.peerClient=new Y0(R,this.nonScopedLogger,this.action,No(this.action,w),me,$,w,U,ue),this.logger=new qa(j,oe.SUBSCRIPTION),this.subscribeTracker=new Md(this.analyticsTracker,R,w),this.remotePlaybackController=new gy({token:R,analyticsTracker:$,traceId:me,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(w,R){try{w===Ws.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch((U=>{this.logger.error({err:U,msg:"Remote playback request to stop video failed"})})):w===Ws.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch((U=>{this.logger.error({err:U,msg:"Remote playback request to start video failed"})})),this.actualSubscribeType=w,this.logger.debug({msg:`Desired subscribe type actualized from ${R} to ${w}.`})}catch(U){this.logger.error({err:U,msg:`Error updating subscribe type from ${R} to ${w}.`})}}processStateUpdate(w){const R=this.previousSignalState,U=Object.assign({},R,w);if(!this.isSubscriptionActive)return void this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"});U.isTargetPublishing?w.peerClientState===hr.CONNECTED?this.updateState({connectionState:Qs.CONNECTED,subscribeInProgress:!0}):w.peerClientState===hr.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(Sr.CONNECTION_FAIL,this.peerClient.getProtocol()),this.updateState({subscribeInProgress:!1}),this.emit(Nu)):(R.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:Qs.DISCONNECTED}));const j=!R.isTargetPublishing&&w.isTargetPublishing,$=this.subscriptionState.connectionState===Qs.CONNECTED&&w.peerClientState===hr.FAILED;(j||$)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,w)}onTrySubscribeFailure(w,R){this.logger.debug({msg:"Changing/keeping state FAILED"});const U=w.fatal,j=w.code===Zt.OPERATION_ABORTED.code,$=this.failedRetries<=4;if(!j&&!U&&$){const X=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${X}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout((()=>Wu(this,void 0,void 0,(function*(){this.throttledTrySubscribe(R)}))),X)}else this.updateState({connectionState:Qs.ERRORED}),this.emit(Lp,w),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(jc,this.onPeerClientConnectionStateChange),this.peerClient.on(mf,this.onSdpNegotiated),this.peerClient.on(Th,this.seiMessageHandler),this.peerClient.on(vc,this.onPeerClientTransformError),this.stageConnection.on(wf,this.onParticipantUpdated),this.stageConnection.on(Ua,this.onParticipantJoined),this.stageConnection.on($c,this.onParticipantLeft),this.stageConnection.on(p_,this.onParticipantLeft);let w=!0;if(this.stageConnection.isConnected()){const R=this.stageConnection.getParticipant(this.id);w=!!R?.isPublishing}this.processStateUpdate({isTargetPublishing:w})}throttledTrySubscribe(w){return this.throttler.invoke(this.trySubscribe,w)}updateState(w){w.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=w.subscribeInProgress),w.connectionState&&this.subscriptionState.connectionState!==w.connectionState&&(this.subscriptionState.connectionState=w.connectionState,this.emit(Ec,this.subscriptionState.connectionState))}stop(w=!1){this.peerClient.off(jc,this.onPeerClientConnectionStateChange),this.peerClient.off(vc,this.onPeerClientTransformError),this.peerClient.off(mf,this.onSdpNegotiated),this.peerClient.off(Th,this.seiMessageHandler),this.unsubscribe(w),this.throttler.clear(),this.stageConnection.off(wf,this.onParticipantUpdated),this.stageConnection.off(Ua,this.onParticipantJoined),this.stageConnection.off($c,this.onParticipantLeft),this.stageConnection.off(p_,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:Qs.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(w,R){return Wu(this,void 0,void 0,(function*(){const{token:U,id:j}=this;U.assertTokenIsUnexpired(w,No(Qt.SUBSCRIBE,j),"subscribe",j);const{mediaStream:$}=yield this.peerClient.connect({audioOnly:R,traceId:w});return{peerClient:this.peerClient,mediaStream:$}}))}unsubscribe(w=!1){return Wu(this,void 0,void 0,(function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===Qs.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const R=w?Sr.UNLOAD:Sr.UNSUBSCRIBE,U=this.peerClient.getProtocol();try{w?this.peerClient.disconnect(w):yield this.peerClient.disconnect(w),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(R,U)}catch{this.attemptTracker.trackEndFailed(R,U)}}))}triggerIceRestart(w){var R;return Wu(this,void 0,void 0,(function*(){const U=this.stageConnection.getConnectionStats(),j=this.peerClient.getSfuResource(),$=this.subscribeTracker.trackAttempt({stageConnectionStats:U,isReassignment:!0,traceIdOverride:w.traceId,preAttemptSfuResource:j}),X=performance.now();try{this.emit(xd),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:w,traceId:w.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const ue=performance.now()-X,me=this.peerClient.getSfuResource(),ce=this.peerClient.getActionMeasurements();(R=this.attemptTracker)===null||R===void 0||R.trackEndSucceeded(Sr.REASSIGNMENT,this.peerClient.getProtocol()),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),$.trackSubscribeStarted({totalDurationWithRetries:ue,sfuResource:me,retryTimes:0,peerClientPerfStats:ce,protocol:this.peerClient.getProtocol()}),this.emit(wd)}catch(ue){this.emit(Jv),this.logger.error({msg:"ICE restart attempt failed",err:ue});const me=this.peerClient.getSfuResource(),ce=$.trackSubscribeFailed(ue,this.peerClient.getProtocol(),`iceRestart=true, startNode=${j.node}, endNode=${me?.node}`);throw ce.code===Zt.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(ce,"ice restart timeout"),ue}}))}measureFirstFrameDuration({mediaStream:w,subscribeType:R,callback:U}){const j=performance.now(),$=me=>{const ce=performance.now()-j;U(ce,me),me==="audio"?ue():X()};let X=Ah,ue=Ah;return R!==Ws.AUDIO_ONLY&&(X=(function(me,ce){return r0(me,"video",ce)})(w,$)),ue=(function(me,ce){return r0(me,"audio",ce)})(w,$),()=>{X(),ue()}}}var J,_e;If=new WeakSet,Hh=function(P){return P.id===this.id},(function(P){P.JOIN_ERROR="JOIN_ERROR",P.PUBLISH_ERROR="PUBLISH_ERROR",P.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"})(J||(J={})),(function(P){P[P.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",P[P.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",P[P.TIMEOUT=3]="TIMEOUT",P[P.FAILED=4]="FAILED",P[P.CANCELED=5]="CANCELED",P[P.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",P[P.CODEC_MISMATCH=7]="CODEC_MISMATCH",P[P.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED",P[P.STAGE_DELETED=9]="STAGE_DELETED",P[P.PARTICIPANT_DISCONNECTED=10]="PARTICIPANT_DISCONNECTED"})(_e||(_e={}));const Oe={[_e.TOKEN_MALFORMED]:"Token is malformed",[_e.TOKEN_EXPIRED]:"Token expired and is no longer valid",[_e.TIMEOUT]:"Operation timed out",[_e.FAILED]:"Operation failed",[_e.CANCELED]:"Operation canceled",[_e.STAGE_AT_CAPACITY]:"Stage at capacity",[_e.CODEC_MISMATCH]:"Client codec is not supported",[_e.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation",[_e.STAGE_DELETED]:"Stage has been deleted, unable to join",[_e.PARTICIPANT_DISCONNECTED]:"Participant has been disconnected, unable to join"},$e={[Zt.EXPIRED_TOKEN.code]:_e.TOKEN_EXPIRED,[Zt.MALFORMED_TOKEN.code]:_e.TOKEN_MALFORMED,[Zt.JOIN_SERVER_BAD_REQUEST.code]:_e.FAILED,[Zt.TOKEN_PERMISSIONS_DENIED.code]:_e.TOKEN_NOT_ALLOWED,[Zt.OPERATION_ABORTED.code]:_e.CANCELED,[Zt.JOIN_TIMED_OUT.code]:_e.TIMEOUT,[Zt.STAGE_DELETED.code]:_e.STAGE_DELETED,[Zt.PARTICIPANT_DISCONNECTED.code]:_e.PARTICIPANT_DISCONNECTED,[Zt.EVENT_PLANE_WS_CREATE_FAILED.code]:_e.FAILED,[Zt.PUBLISH_TIMED_OUT.code]:_e.TIMEOUT,[Zt.PUBLISH_FAILURE.code]:_e.FAILED,[Zt.SUBSCRIBE_TIMED_OUT.code]:_e.TIMEOUT,[Zt.SUBSCRIBE_FAILURE.code]:_e.FAILED,[Zt.STAGE_AT_CAPACITY.code]:_e.STAGE_AT_CAPACITY,[Zt.NO_MATCHING_CODEC.code]:_e.CODEC_MISMATCH,[Zt.NETWORK_FAILURE.code]:_e.FAILED,[Zt.INTERNAL_SERVER_ERROR.code]:_e.FAILED,[Zt.REMOTE_STREAM_NOT_FOUND.code]:_e.FAILED,[Zt.INTERNAL_MHCP_ERROR.code]:_e.FAILED,[Zt.UNREACHABLE_MHCP.code]:_e.FAILED,[Zt.INVALID_SESSION_STATUS.code]:_e.FAILED,[Zt.MHCP_ABORTED.code]:_e.FAILED,[Zt.EVENT_PLANE_PONG_TIMEOUT.code]:_e.FAILED,[Zt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:_e.FAILED},ct={[Zt.SEI_INSERT_NOT_PUBLISHING_VIDEO.code]:"SEI insert failed due to not publishing video",[Zt.SEI_INSERT_INBAND_NOT_ENABLED.code]:"SEI insert failed due to in-band messaging not being enabled for the stage stream"};class ft extends Error{constructor(w,R,U){super(),this.code=w,this.category=R,this.message=U,this.name="StageError",this.errorDetails=[],this.message=`[${R}] ${U}`}addDetails(w){this.errorDetails.push(w)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var kt,Wt,Yt;function rn(P,w){let R;if(P instanceof Rr){if(w===J.JOIN_ERROR&&(P.code===Zt.EVENT_PLANE_PONG_TIMEOUT.code||P.code===Zt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code))return;const U=$e[P.code];U&&(R=(function(j,$,X){var ue,me,ce;const de=Oe[j],Ae=new ft(j,$,de);return Ae.addDetails({stageErrorMessage:de,stageErrorCode:j,stageErrorCategory:$,stageArn:(ue=X.token)===null||ue===void 0?void 0:ue.stageARN,traceId:(me=X.traceId)===null||me===void 0?void 0:me.value,causeCode:X.code,causeDetails:X.details,causeMessage:X.message,causeLocation:X.location,participantId:(ce=X.token)===null||ce===void 0?void 0:ce.participantID,timeUTC:new Date().toISOString()}),Ae})(U,w,P))}return R}(function(P){P.ERROR="error"})(kt||(kt={}));class Gn extends Da{constructor(w){super(),this.logger=w,this.handleError=(R,U,j=!0)=>{const $=(function(ue){let me;return ue instanceof Rr&&(me=ct[ue.code]),me})(R),X=rn(R,U);if($&&this.logger.warn({msg:$}),X)return j&&this.emit(kt.ERROR,X),X}}}(function(P){P.INTERNAL="internal",P.REMOTE="remote",P.API="api"})(Wt||(Wt={})),(function(P){P.ADDITIVE="additive",P.REPLACE="replace"})(Yt||(Yt={}));class pn{constructor(w){this.logger=new qa(w.logger,oe.CONNECTION),this.subscribeConfig={defaults:w.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(w,R,U,j=Yt.REPLACE){R=(de=>{const Ae=M0(de);if(Ae.jitterBuffer!==void 0){const Me=rt=>{if(typeof rt=="number"){if(rt<0)return 0;if(rt>4e3)return 4e3}return rt};Ae.jitterBuffer.minDelayWhenPublishing!==void 0&&(Ae.jitterBuffer.minDelayWhenPublishing=Me(Ae.jitterBuffer.minDelayWhenPublishing)),Ae.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(Ae.jitterBuffer.minDelayWhenSubscribeOnly=Me(Ae.jitterBuffer.minDelayWhenSubscribeOnly))}return Ae})(R),this.subscribeConfig.participants[w]===void 0&&(this.subscribeConfig.participants[w]={internalOverrides:{},apiOverrides:{},remoteOverrides:{},lastMerged:this.subscribeConfig.defaults});const $=this.subscribeConfig.participants[w];switch(U){case Wt.INTERNAL:$.internalOverrides=this.handleSubscribeConfigLevelMerging($.internalOverrides,R,j);break;case Wt.REMOTE:$.remoteOverrides=this.handleSubscribeConfigLevelMerging($.remoteOverrides,R,j);break;case Wt.API:$.apiOverrides=this.handleSubscribeConfigLevelMerging($.apiOverrides,R,j);break;default:(function(de){throw new Error(`Unknown case kind: ${de}`)})(U)}const X=xa(this.subscribeConfig.defaults,$.internalOverrides,$.remoteOverrides,$.apiOverrides);if(X===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${w} | ${$}, ${R}`}),!1;const ue=(me=$.lastMerged,ce=X,(typeof me=="object"&&typeof ce=="object"&&(0,ji.isEqual)(me,ce))===!1);var me,ce;return $.lastMerged=X,this.subscribeConfig.participants[w]=$,ue}handleExternalSubscribeConfigUpdate(w,R,U,j=Yt.REPLACE){const $=(X=>{const ue={};return typeof X!="object"?xn.err(new Error("Invalid input")):(X.jitterBuffer!==void 0&&(ue.jitterBuffer={},X.jitterBuffer.minDelay!==void 0&&(ue.jitterBuffer.minDelayWhenSubscribeOnly=X.jitterBuffer.minDelay)),X.inBandMessaging!==void 0&&(ue.inBandMessaging={enabled:X.inBandMessaging.enabled===!0}),X.simulcast!==void 0&&(ue.simulcast={},X.simulcast.initialLayerPreference!==void 0&&(ue.simulcast.initialLayerPreference=X.simulcast.initialLayerPreference)),xn.ok(ue))})(R);return $.ok===!0&&this.handleSubscribeConfigUpdate(w,$.value,U,j)}handleSubscribeConfigLevelMerging(w,R,U){if(U===Yt.REPLACE)return R;{const j=xa(w,R);return j===void 0?(this.logger.warn({msg:`Unable to merge '${w}' and '${R}' with type ${U}`}),w):j}}getSubscribeConfigSnapshot(w){return this.subscribeConfig.participants[w]===void 0?ty(this.subscribeConfig.defaults):ty(this.subscribeConfig.participants[w].lastMerged)}}class Nn extends Xn{constructor(w){super(Mn.REASSIGNMENT_REQUEST,w.token,w.traceId,!1),Object.assign(this.properties,{target_local_participant_id:w.targetLocalParticipantId,target_remote_participant_id:w.targetRemoteParticipantId}),this.critical=!0}}var Ht,mn,ir,Rn,gr,Er=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class si extends Da{constructor(w,R){super(),this.setGetStats=U=>{this._getInternalStats=U},this.getStats=()=>Er(this,void 0,void 0,(function*(){return this.requestRTCStats()})),this.requestRTCStats=()=>Er(this,void 0,void 0,(function*(){if(!this._getInternalStats)return;const U=yield this._getInternalStats(this.mediaStreamTrack);return U?U.rawReport:void 0})),this._getInternalStats=R,this.id=w.id,this.isMuted=!w.enabled,this.mediaStreamTrack=w,this.streamType=this.mediaStreamTrack.kind==="audio"?wr.AUDIO:wr.VIDEO}cleanup(){this.removeAllListeners(),this._getInternalStats=void 0}}(function(P){P.IDLE="IDLE",P.INITIALIZING="INITIALIZING",P.ACTIVE="ACTIVE",P.CONTROLS_PAUSED="CONTROLS_PAUSED",P.DESTROYED="DESTROYED"})(Ht||(Ht={})),(function(P){P.LAYERS_CHANGED="LAYERS_CHANGED",P.LAYER_SELECTED="LAYER_SELECTED",P.ADAPTION_CHANGED="ADAPTION_CHANGED"})(mn||(mn={})),(function(P){P.LAYERS_CHANGED="LAYERS_CHANGED",P.LAYER_SELECTED="LAYER_SELECTED",P.ADAPTION_CHANGED="ADAPTION_CHANGED"})(ir||(ir={})),(function(P){P.UNAVAILABLE="unavailable",P.SELECTED="selected"})(Rn||(Rn={})),(function(P){P.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged",P.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST="localStreamInsertSeiMsgRequest"})(gr||(gr={}));var nr,jn,Ti,Ls=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class wa extends si{constructor(w,R){super(w),this.setMuted=U=>{U!==this.isMuted&&(this.mediaStreamTrack.enabled=!U,this.isMuted=U,this.emit(gr.LOCAL_STREAM_MUTE_CHANGED,this))},this.insertSeiMessage=(U,j)=>Ls(this,void 0,void 0,(function*(){let $;if(this.streamType==="audio")$=oa.INVALID_TRACK_TYPE;else if(this.mediaConfig.inBandMessaging.enabled){const X=this.validator.validateMessagePayload(U,j?.repeatCount||0);$=xn.getErr(X)}else $=oa.INBAND_MESSAGING_NOT_ENABLED;$?console.warn(`Unable to insert SEI message due to ${$}`):this.emit(gr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this,U,j)})),this.requestQualityStats=()=>Ls(this,void 0,void 0,(function*(){if(!this._getInternalStats)return;const U=yield this._getInternalStats(this.mediaStreamTrack);return U?U.stats:void 0})),this.validatedExternalConfig=Zs(w,R),this.normalizedConfig=H0(0,this.validatedExternalConfig),this.mediaConfig=(0,ji.cloneDeep)(this.normalizedConfig),this.validator=new zh(Fu)}}class os{constructor(w,R){this.strategy=w,this.logger=R}setStrategy(w){this.strategy=w}hasStrategy(w){return this.strategy[w]!==void 0}stageStreamsToPublish(){let w=[];try{w=this.strategy.stageStreamsToPublish(),w=w.filter((j=>j instanceof wa))}catch(j){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:j}),console.error("Error executing stageStreamsToPublish",j),xn.err(j)}let R=0,U=0;for(const j of w)j.mediaStreamTrack.kind==="audio"?R++:j.mediaStreamTrack.kind==="video"&&U++;if(R>1||U>1){const j=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return xn.err(j)}return xn.ok(w)}shouldPublishParticipant(w){try{return xn.ok(this.strategy.shouldPublishParticipant(w))}catch(R){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:R}),console.error("Error executing shouldPublishParticipant",R),xn.err(R)}}shouldSubscribeToParticipant(w){try{return xn.ok(this.strategy.shouldSubscribeToParticipant(w))}catch(R){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:R}),console.error("Error executing shouldSubscribeToParticipant",R),xn.err(R)}}subscribeConfiguration(w){var R,U;try{return xn.ok((U=(R=this.strategy).subscribeConfiguration)===null||U===void 0?void 0:U.call(R,w))}catch(j){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:j}),console.error("Error executing subscribeConfiguration",j),xn.err(j)}}preferredLayerForStream(w,R){var U,j;try{return xn.ok((j=(U=this.strategy).preferredLayerForStream)===null||j===void 0?void 0:j.call(U,w,R))}catch($){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:$}),console.error("Error executing preferredLayerForStream",$),xn.err($)}}}class Bo extends Da{constructor(w,R){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=jn.NOT_PUBLISHED,this.logger=R,this.info=w,this.audioMuted=w.audioMuted,this.videoStopped=w.videoStopped}}(function(P){P.PUBLISH="publish",P.SUBSCRIBE="subscribe"})(nr||(nr={})),(function(P){P.NOT_PUBLISHED="not_published",P.ATTEMPTING_PUBLISH="attempting_publish",P.PUBLISHED="published",P.ERRORED="errored"})(jn||(jn={})),(function(P){P.NOT_SUBSCRIBED="not_subscribed",P.ATTEMPTING_SUBSCRIBE="attempting_subscribe",P.SUBSCRIBED="subscribed",P.ERRORED="errored"})(Ti||(Ti={}));function zi(P){return P.map((w=>w.remote))}function qu(P){return{label:P.encodingId,bitrateBps:1e3*P.bitrate,width:P.width,height:P.height,framesPerSecond:P.framesPerSecond,selected:P.selected}}function Kc(P,w){const R=P.width*P.height,U=w.width*w.height;return R>U||P.bitrateBps>w.bitrateBps||P.framesPerSecond>w.framesPerSecond?1:R===U&&P.bitrateBps===w.bitrateBps&&P.framesPerSecond===w.framesPerSecond?0:-1}var Us=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class Id extends Da{constructor(w){var R,U,j;super(),this.onAdaptionChanged=$=>{this.emit(ir.ADAPTION_CHANGED,$)},this.onLayersChanged=$=>{this.emit(ir.LAYERS_CHANGED,$)},this.onLayerSelected=($,X)=>{this.emit(ir.LAYER_SELECTED,$,X)},this.setGetStats=()=>{},this.requestRTCStats=()=>Us(this,void 0,void 0,(function*(){var $;return($=this.internalStream)===null||$===void 0?void 0:$.requestRTCStats()})),this.requestQualityStats=()=>Us(this,void 0,void 0,(function*(){if(this.internalStream)try{const $=yield this.internalStream.getInternalStats();return $?$.stats:void 0}catch{return}})),this.getStats=()=>Us(this,void 0,void 0,(function*(){var $;return($=this.internalStream)===null||$===void 0?void 0:$.requestRTCStats()})),this.setMuted=$=>{var X;(X=this.internalStream)===null||X===void 0||X.setMuted($)},this.getLayers=()=>{var $,X;return(X=($=this.internalStream)===null||$===void 0?void 0:$.layers)!==null&&X!==void 0?X:this.cachedLayers},this.getSelectedLayer=()=>{var $,X;return(X=($=this.internalStream)===null||$===void 0?void 0:$.selectedLayer)!==null&&X!==void 0?X:this.cachedSelectedLayer},this.getLowestQualityLayer=()=>{var $,X;return(X=($=this.internalStream)===null||$===void 0?void 0:$.lowestQualityLayer)!==null&&X!==void 0?X:this.cachedLowestLowestLayer},this.getHighestQualityLayer=()=>{var $,X;return(X=($=this.internalStream)===null||$===void 0?void 0:$.highestQualityLayer)!==null&&X!==void 0?X:this.cachedHighestQualityLayer},this.internalStream=w,this.cachedId=this.internalStream.id,this.cachedParticipantInfo=(0,ji.cloneDeep)(this.internalStream.participantInfo),this.cachedStreamType=this.internalStream.streamType,this.cachedMediaStreamTrack=(j=(U=(R=this.internalStream.mediaStreamTrack).clone)===null||U===void 0?void 0:U.call(R))!==null&&j!==void 0?j:{},this.cachedIsMuted=this.internalStream.isMuted,this.cachedIsAdapting=this.internalStream.isAdapting,this.cachedLayers=this.internalStream.layers,this.updateCachedStreamData(),this.internalStream.on(mn.ADAPTION_CHANGED,this.onAdaptionChanged),this.internalStream.on(mn.LAYERS_CHANGED,this.onLayersChanged),this.internalStream.on(mn.LAYER_SELECTED,this.onLayerSelected)}updateCachedStreamData(){var w,R,U,j,$;this.cachedLayers=(R=(w=this.internalStream)===null||w===void 0?void 0:w.layers)!==null&&R!==void 0?R:[],this.cachedHighestQualityLayer=(U=this.internalStream)===null||U===void 0?void 0:U.highestQualityLayer,this.cachedLowestLowestLayer=(j=this.internalStream)===null||j===void 0?void 0:j.lowestQualityLayer,this.cachedSelectedLayer=($=this.internalStream)===null||$===void 0?void 0:$.selectedLayer}get id(){var w,R;return(R=(w=this.internalStream)===null||w===void 0?void 0:w.id)!==null&&R!==void 0?R:this.cachedId}get participantInfo(){var w,R;return(R=(w=this.internalStream)===null||w===void 0?void 0:w.participantInfo)!==null&&R!==void 0?R:this.cachedParticipantInfo}get streamType(){var w,R;return(R=(w=this.internalStream)===null||w===void 0?void 0:w.streamType)!==null&&R!==void 0?R:this.cachedStreamType}get mediaStreamTrack(){var w,R;return(R=(w=this.internalStream)===null||w===void 0?void 0:w.mediaStreamTrack)!==null&&R!==void 0?R:this.cachedMediaStreamTrack}get isMuted(){var w,R;return(R=(w=this.internalStream)===null||w===void 0?void 0:w.isMuted)!==null&&R!==void 0?R:this.cachedIsMuted}set isMuted(w){var R;(R=this.internalStream)===null||R===void 0||R.setMuted(w)}get isAdapting(){var w,R;return(R=(w=this.internalStream)===null||w===void 0?void 0:w.isAdapting)!==null&&R!==void 0?R:this.cachedIsAdapting}cleanup(){var w,R,U;this.updateCachedStreamData(),(w=this.internalStream)===null||w===void 0||w.off(mn.ADAPTION_CHANGED,this.onAdaptionChanged),(R=this.internalStream)===null||R===void 0||R.off(mn.LAYERS_CHANGED,this.onLayersChanged),(U=this.internalStream)===null||U===void 0||U.off(mn.LAYER_SELECTED,this.onLayerSelected),this.internalStream=void 0,this.removeAllListeners()}}var Kl,go,_o=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class Ta extends si{constructor({track:w,info:R,getStats:U,remotePlaybackController:j,analyticsTracker:$,token:X,subscribeConfig:ue}){super(w,U),this.hasRemoteListenersForLayerEvents=()=>{const ce=this.remote;return ce.hasListenersFor(ir.ADAPTION_CHANGED)||ce.hasListenersFor(ir.LAYERS_CHANGED)||ce.hasListenersFor(ir.LAYER_SELECTED)},this.setMuted=ce=>{this.isMuted=ce,this.mediaStreamTrack.enabled=!ce},this.setLayer=ce=>{const de=(0,ji.cloneDeep)(ce);if(this.queueLayerUpdateForValidState(de))return void this.logger.debug({msg:`setLayer:${de} queued, skipping for now`});const Ae=(function(rt,bt){if(!rt)return(0,xn.ok)(void 0);const ht=typeof rt=="string"?rt:rt.label,dt=bt.filter((et=>et.label===ht))[0];return dt?(0,xn.ok)(dt):(0,xn.err)(`Provided layer with id ${ht} does not exist`)})(de,this._layers);if(!Ae.ok){const rt=Ae.error;return void this.logger.error({err:rt,msg:"Unable to select layer, skipping selection"})}const Me=Ae.value;if(this.isNextUpdateAdaptionOnly(Me))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(Me)||this.isAdapting?Me&&(this.logger.warn({msg:`setLayer:${JSON.stringify(Me)} `}),this.handleManualUpdate(Me)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=Ht.INITIALIZING,this.prevState=Ht.IDLE,this.analyticsTracker=$,this.token=X,this.id=w.id,this.info=R,this.mediaStreamTrack=w,this.remotePlaybackController=j,this.layerPollingIntervalId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this.subscribeConfig=ue,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const me=qg();this.logger=new qa(new Qo(me),oe.REMOTE_STAGE_STREAM),this.streamType===wr.AUDIO?this.isMuted=R.audioMuted:this.isMuted=R.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers(!0)}transitionStateTo(w){this.state!==w&&(this.prevState=this.state,this.state=w)}initializeLayerPolling(){_d(this.mediaStreamTrack)?this.streamType!==wr.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingIntervalId!==null&&clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=setInterval((()=>{this.pollInternalLayers()}),this.subscribeConfig.simulcast.layerPollingIntervalMs)):this.logger.debug({msg:"Skipping initializing polling for audio streams"}):this.logger.debug({msg:"Skipping initializing polling, media track is not active"})}startLayerPolling(){this.layerPollingIntervalId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingIntervalId!==null?(clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(w=!1){if(!_d(this.mediaStreamTrack))return void this.pauseControls();if(this.streamType===wr.AUDIO)return this.logger.debug({msg:"Skipping layer poll request for audio stream"}),void this.transitionStateTo(Ht.ACTIVE);const R=!this.hasRemoteListenersForLayerEvents(),U=!this.subscribeConfig.simulcast.layerPollingEnabled;!w&&R&&U?this.logger.debug({msg:"Skipping layer request due to no listeners"}):this.remotePlaybackController.getLayers().then((j=>{if(this.isStateValidForLayerUpdates()){if(!j.ok)throw Error(j.error);this.updateInternalLayersFromRemote(j.value),this.transitionStateTo(Ht.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})})).catch((j=>{this.logger.error({err:j,msg:"Error calling getLayers, returning current layers"})}))}updateInternalLayersFromRemote(w){const R=this._layers,U=w.map(qu).sort(Kc),j=!(0,ji.isEqual)(U,R);this._layers=U;const $=this._selectedLayer,X=this._layers.filter((me=>me.selected))[0],ue=!(0,ji.isEqual)(X,$);$&&($.selected=!1),this._selectedLayer=X,ue&&(this.trackLayerUpdate($),this.trackLayerUpdate(X)),this.isCommandQueueEmpty()&&(j&&this.emitLayersChanged(),ue&&this.emitLayerSelected(X))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const w=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${w}`});for(const R of this.commandMap.keys()){const U=this.commandMap.get(R);U?.()}this.commandMap.clear()}queueLayerUpdateForValidState(w){if(!w)return this.commandMap.delete("setLayer"),!1;if(this.state===Ht.INITIALIZING){const R=this.setLayer.bind(this,w);return this.commandMap.set("setLayer",R),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const w=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then((R=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(w,`Stream in invalid state: ${this.state}`);R.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(w,R.error)})).catch((()=>{}))}resetAdaptionStateOnError(w,R){this._isAdapting=w,this.emitAdaptionChanged(),this.logger.error({err:R,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(w){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const R=this._isAdapting,U=this._selectedLayer;U&&(U.selected=!1),this._isAdapting=!1,this._selectedLayer=w,w.selected=!0,R!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(w,U),this.trackLayerUpdate(U),this.trackLayerUpdate(w),this.emitLayersChanged(),this.emitLayerSelected(w),this.remotePlaybackController.setLayer(w.label).then((j=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const $=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(R,$),void this.resetLayerOnError(U,w,$)}if(!j.ok){const $=j.error;return this.resetAdaptionStateOnError(R,$),void this.resetLayerOnError(U,w,$)}this.logger.debug({msg:`Layer successfully selected: ${w.label}`})})).catch((()=>{}))}applyExistingControlState(){var w;this._isAdapting?this.remotePlaybackController.unsetLayer().then((()=>{})).catch((()=>{})):!((w=this._selectedLayer)===null||w===void 0)&&w.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then((()=>{})).catch((()=>{}))}resetLayerOnError(w,R,U){R&&(R.selected=!1),w&&(w.selected=!0),this._selectedLayer=w,this.logger.error({err:U,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(w,R),this.emitLayersChanged(),w!==null&&this.emitLayerSelected(w,Rn.UNAVAILABLE),this.trackLayerUpdate(R),this.trackLayerUpdate(w)}updateLocalLayerStateBeforeRemote(w,R){this._layers=this._layers.map((U=>U.label===w?.label?w:U.label===R?.label?R:U)).sort(Kc)}trackLayerUpdate(w){var R,U;this.analyticsTracker.trackEventNoSharedProps(new x_(this.token,Ns(),(R=w?.label)!==null&&R!==void 0?R:"auto",!0,Qt.SUBSCRIBE,(U=w?.selected)!==null&&U!==void 0&&U,this.info.id))}isNextUpdateAdaptionOnly(w){return w===void 0&&this.isFirstLayerUpdate()||w===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(w){var R;return((R=this._selectedLayer)===null||R===void 0?void 0:R.label)===w?.label}isStateValidForLayerUpdates(){return this.state===Ht.ACTIVE||this.state===Ht.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(w,R=Rn.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(w,null,2)}`}),this.emit(mn.LAYER_SELECTED,(0,ji.cloneDeep)(w),R)}emitLayersChanged(){this.emit(mn.LAYERS_CHANGED,(0,ji.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(mn.ADAPTION_CHANGED,this._isAdapting)}get remote(){const w=this.weakRemoteMap.get(this.weakRemoteKey);if(w)return w;const R=new Id(this);return this.weakRemoteMap.set(this.weakRemoteKey,R),R}get participantInfo(){return(0,ji.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,ji.cloneDeep)(this._layers)}get selectedLayer(){var w;return(0,ji.cloneDeep)((w=this._selectedLayer)!==null&&w!==void 0?w:void 0)}get highestQualityLayer(){return(0,ji.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,ji.cloneDeep)(this.layers[0])}getInternalStats(){return _o(this,void 0,void 0,(function*(){if(this._getInternalStats)return this._getInternalStats(this.mediaStreamTrack)}))}pauseControls(){this.transitionStateTo(Ht.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(Ht.ACTIVE)}updateSubscribeConfig(w){const R=this.subscribeConfig;this.subscribeConfig=w,R.simulcast.layerPollingIntervalMs!==w.simulcast.layerPollingIntervalMs&&this.isStateValidForLayerUpdates()&&this.initializeLayerPolling()}cleanup(){this.transitionStateTo(Ht.DESTROYED),super.cleanup(),this.weakRemoteMap.delete(this.weakRemoteKey),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(P){P.STATE_CHANGE="stateChange",P.MEDIA_STREAM_ADDED="mediaStreamAdded",P.MEDIA_STREAM_REMOVED="mediaStreamRemoved",P.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",P.ERROR="error"})(Kl||(Kl={})),(function(P){P.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",P.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"})(go||(go={}));const as=Object.assign(Object.assign({},Kl),go);var Xl;(function(P){P.PUBLICATION_STATE_CHANGE="publicationStateChange"})(Xl||(Xl={}));const Jl=Object.assign(Object.assign({},Kl),Xl);var K0=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class Nd extends Bo{constructor(w,R,U,j,$,X,ue,me=!1){super(w,new qa(j,oe.REMOTE_PARTICIPANT)),this.subscribeState=Ti.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=ce=>{this.logger.debug({msg:"subscriptionStateChange",state:ce}),ce===Qs.DISCONNECTED?this.updateSubscriptionState(Ti.NOT_SUBSCRIBED):ce===Qs.CONNECTED?this.updateSubscriptionState(Ti.SUBSCRIBED):ce===Qs.CONNECTING?this.updateSubscriptionState(Ti.ATTEMPTING_SUBSCRIBE):ce===Qs.ERRORED?(this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams(),this.updateSubscriptionState(Ti.ERRORED)):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:ce})},this.onSubscriptionStreamRemoved=()=>{this.logger.debug({msg:"onSubscriptionStreamRemoved"}),this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams()},this.onSubscriptionStreamCreated=(ce,de)=>{this.logger.debug({msg:"onSubscriptionStreamCreated",stream:ce}),this.pruneInactiveStreams();let Ae=ce.getTracks().map((Me=>{const rt=new Ta({track:Me,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:de,analyticsTracker:this.analyticsTracker,token:this.token,subscribeConfig:this.subscribeConfig});return this.streams.push(rt),rt}));this.subscription.getDesiredSubscribeType()===Ws.AUDIO_ONLY&&(Ae=Ae.filter((Me=>Me.streamType!==wr.VIDEO))),this.emit(as.MEDIA_STREAM_ADDED,Ae)},this.onSubscriptionError=ce=>{this.emit(as.ERROR,ce)},this.onSubscriptionSeiMessageReceived=ce=>{this.emit(as.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,ce)},this.onSubscriptionTransformError=ce=>{this.emit(as.ERROR,ce)},this.onSubscriptionReassignmentStart=()=>{for(const ce of this.streams)ce.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const ce of this.streams)ce.resumeControls()},this.updateSubscribeStateIfNecessary=(ce,de)=>{if(!this.info.capabilities.has(nr.SUBSCRIBE))return;de!==void 0&&(this.subscribeConfig=de,this.subscription.updateSubscribeConfig(de),this.streams.forEach((rt=>{rt.updateSubscribeConfig(de)})));const Ae=ce!==Ws.NONE&&this.publishState===jn.PUBLISHED,Me=this.subscribeState!==Ti.NOT_SUBSCRIBED&&this.subscribeState!==Ti.ERRORED;if(Ae&&!Me)this.subscription.updateDesiredSubscribeType(ce),this.subscribe();else if(!Ae&&Me)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(ce);else if(this.subscribeState===Ti.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==ce)try{ce===Ws.AUDIO_ONLY?this.emit(as.MEDIA_STREAM_REMOVED,this.filterStreamsByType(this.streams,wr.VIDEO)):ce===Ws.AUDIO_VIDEO&&this.emit(as.MEDIA_STREAM_ADDED,this.filterStreamsByType(this.streams,wr.VIDEO)),this.subscription.updateDesiredSubscribeType(ce)}catch(rt){this.logger.error({err:rt,msg:"error updating subscribe type"})}},this.updatePublishState=ce=>{const de=ce&&this.publishState===jn.PUBLISHED,Ae=!ce&&this.publishState===jn.NOT_PUBLISHED;return!de&&!Ae&&(this.info.isPublishing=ce,this.publishState=ce?jn.PUBLISHED:jn.NOT_PUBLISHED,!0)},this.updateStreamState=(ce,de)=>{this.audioMuted!==ce&&(this.audioMuted=ce,this.info.audioMuted=ce,this.updateStreamMuteState(wr.AUDIO,ce)),this.videoStopped!==de&&(this.videoStopped=de,this.info.videoStopped=de,this.updateStreamMuteState(wr.VIDEO,de))},this.updateStreamMuteState=(ce,de)=>{const Ae=this.filterStreamsByType(this.streams,ce),Me=Ae[Ae.length-1];if(!Me){const rt=`state update received for ${this.info.id} for non-existent ${ce} stream`;return this.logger.warn({msg:rt}),void this.traceRemoteParticipantMsg(rt)}Me.setMuted(de),this.emit(as.MEDIA_STREAM_MUTE_CHANGED,Me)},this.cleanup=()=>{this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==Ti.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=ue,this.token=R,this.subscribeConfig=X,this.createSubscription=()=>{const ce=new B(w.id,R,U,j,ue,$,X);return ce.on(Ec,this.onSubscriptionStateChange),ce.on(Tf,this.onSubscriptionStreamCreated),ce.on(Nu,this.onSubscriptionStreamRemoved),ce.on(Lp,this.onSubscriptionError),ce.on(Pu,this.onSubscriptionSeiMessageReceived),ce.on(Up,this.onSubscriptionTransformError),ce.on(xd,this.onSubscriptionReassignmentStart),ce.on(wd,this.onSubscriptionReassignmentDone),ce.on(Jv,this.onSubscriptionReassignmentDone),ce},this.subscription=this.createSubscription(),me&&(this.publishState=jn.PUBLISHED)}updateSubscriptionState(w){w!==this.subscribeState&&(this.subscribeState=w,this.emit(as.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}pruneInactiveStreams(){const w=[];this.streams=this.streams.filter(($=>!!_d($.mediaStreamTrack)||(w.push($),!1)));const R=w.length;if(R===0)return;const U=this.filterStreamsByType(w,wr.AUDIO).length,j=R-U;this.traceRemoteParticipantMsg(`Pruning inactive streams (${U} audio, ${j} video)`),this.emitStreamsRemoved(w),w.forEach(($=>{$.remote.cleanup(),$.cleanup()}))}filterStreamsByType(w,R){return w.filter((U=>U.streamType===R))}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(Ti.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===Ti.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off(Ec,this.onSubscriptionStateChange),this.subscription.off(Tf,this.onSubscriptionStreamCreated),this.subscription.off(Nu,this.onSubscriptionStreamRemoved),this.subscription.off(Lp,this.onSubscriptionError),this.subscription.off(Up,this.onSubscriptionTransformError);const w=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),this.emitStreamsRemovedByType(w),this.updateSubscriptionState(Ti.NOT_SUBSCRIBED),this.cleanupStreams()}emitStreamsRemovedByType(w){switch(w){case Ws.AUDIO_VIDEO:this.emitStreamsRemoved(this.streams);break;case Ws.AUDIO_ONLY:this.emitStreamsRemoved(this.filterStreamsByType(this.streams,wr.AUDIO));case Ws.NONE:}}emitStreamsRemoved(w){this.emit(as.MEDIA_STREAM_REMOVED,w)}cleanupStreams(){this.streams.length!==0&&(this.logger.debug({msg:"Cleaning up streams due to internal removal"}),this.streams.forEach((w=>{w.remote.cleanup(),w.cleanup()})),this.streams=[])}traceRemoteParticipantMsg(w){this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,Ns(),w,Qt.SUBSCRIBE,this.info.id))}triggerIceRestart(w){return K0(this,void 0,void 0,(function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(w)}finally{this.reassigning=!1}}))}}const Nf=Qt.PUBLISH;function _y(P,w,R){return new Rr(Object.assign(Object.assign({},P),{token:w,traceId:R,location:"stage-publication.sendSeiMessage",tag:Hc,action:Qt.PUBLISH}))}class Xb{constructor(w,R){this.analyticsTracker=w,this.token=R,this.action=Nf,this.traceId=Ns()}trackPublish(w){const{action:R,traceId:U,analyticsTracker:j,token:$}=this;return j.trackEvent(new G0({token:$,traceId:U})),{getTraceId:()=>U,trackPublishStarted({totalDurationWithRetries:X,retryTimes:ue,sfuResource:me,peerClientPerfStats:ce,protocol:de}){const{optionsDuration:Ae,postDuration:Me,timeToCandidate:rt,timeToConnected:bt,sdpExchangeDuration:ht,sdpExchangeTransport:dt,setRemoteDescDuration:et,peerConnectionDuration:st}=ce,{edpInitialConnectDuration:Ot,edpInitialConnectRetries:En,edpInitialStateDuration:Dn,edpStateUpdateCount:Jn}=w;j.trackEvent(new bl({token:$,traceId:U,optionsDuration:Ae,postDuration:Me,timeToCandidate:rt,totalDuration:bt,edpInitialConnectDuration:Ot,edpInitialConnectRetries:En,edpInitialStateDuration:Dn,edpStateUpdateCount:Jn,sdpExchangeDuration:ht,sdpExchangeTransport:dt,setRemoteDescDuration:et,peerConnectionDuration:st,publishRetries:ue,totalDurationWithRetries:X,sfuResource:me,protocol:de}))},trackPublishFailed(X,ue){const me=((de,Ae,Me)=>{if(de instanceof Rr)return de;let rt="";return de instanceof gc.AxiosError&&(rt+=`AxiosError - ${de.code}`),new Rr(Object.assign(Object.assign(Object.assign({},Zt.PUBLISH_FAILURE),{action:Nf,token:Ae,traceId:Me,tag:Hc,location:"publish",details:`${rt} ${de.message}`}),{fatal:!0}))})(X,$,U);j.trackEvent(new Gb({token:$,traceId:U,code:me.code,message:me.message,fatal:me.fatal,nominal:me.nominal,protocol:ue}));const ce=new Rr(Object.assign(Object.assign({},Zt.PUBLISH_FAILURE),{action:R,token:$,traceId:U,tag:Hc,location:"publish"}));return X instanceof Rr&&(ce.fatal=X.fatal,ce.nominal=X.nominal,ce.location=`publish > ${X.location}`),j.trackError(ce),me},trackUnpublish:()=>{j.trackEvent(new yl({token:$,traceId:U}))},trackEndSucceeded:(X,ue)=>{j.trackEvent(new Fr({token:$,isUnpublishSuccessful:!0,traceId:U,reason:X,protocol:ue}))},trackEndFailed:(X,ue)=>{const me=new Rr(Object.assign(Object.assign({},Zt.UNPUBLISH_FAILURE),{token:$,traceId:U,tag:Xv,location:"unpublish"}));return X!==Sr.UNLOAD&&X!==Sr.UNPUBLISH||this.analyticsTracker.trackError(me),j.trackEvent(new Fr({token:$,isUnpublishSuccessful:!1,traceId:U,reason:X,protocol:ue})),me},createSeiNotPublishingVideoError:()=>_y(Zt.SEI_INSERT_NOT_PUBLISHING_VIDEO,$,U),createSeiInBandMessagingNotEnabledError:()=>_y(Zt.SEI_INSERT_INBAND_NOT_ENABLED,$,U)}}}var Fo,Sl,Yr=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};(function(P){P.DISCONNECTED="disconnected",P.CONNECTING="connecting",P.CONNECTED="connected",P.ERRORED="errored"})(Fo||(Fo={})),(function(P){P.STATE_CHANGE="stateChange",P.ERROR="error",P.TRANSFORM_ERROR="transformError"})(Sl||(Sl={}));class ws extends Da{constructor(w,R,U,j){super(),this.token=w,this.stageConnection=R,this.nonScopedLogger=U,this.analyticsTracker=j,this.streamsToPublish=[],this.publicationState=Fo.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=Qt.PUBLISH,this.start=$=>{this.publicationState===Fo.DISCONNECTED||this.publicationState===Fo.ERRORED?(this.streamsToPublish=$,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=$=>Yr(this,void 0,void 0,(function*(){return this.peerClient.requestRTCStats($)})),this.stop=($=!1)=>Yr(this,void 0,void 0,(function*(){this.peerClient.off(jc,this.onPeerClientConnectionStateChange),this.peerClient.off(vc,this.onPeerClientTransformError),yield this.unpublish($),this.updateState(Fo.DISCONNECTED)})),this.processStateUpdate=$=>{const{publicationState:X}=this;X===Fo.DISCONNECTED||X===Fo.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(Fo.CONNECTING),this.tryPublish()):X===Fo.CONNECTING?$===hr.CONNECTED&&this.updateState(Fo.CONNECTED):X===Fo.CONNECTED&&$===hr.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(Sr.CONNECTION_FAIL,this.peerClient.getProtocol()),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(Fo.CONNECTING),this.tryPublish()))},this.updateState=$=>{this.publicationState=$,this.emit(Sl.STATE_CHANGE,$)},this.tryPublish=()=>Yr(this,void 0,void 0,(function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const $=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish($);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.streamsToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const X=this.peerClient.getSfuResource(),ue=this.latestPubAttemptNum-1,me=performance.now()-this.startConnectingTimestamp,ce=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:X,totalDurationWithRetries:me,retryTimes:ue,peerClientPerfStats:ce,protocol:this.peerClient.getProtocol()}),this.latestPubAttemptNum=0}catch(X){this.logger.error({msg:"publish failed!",err:X});const ue=this.attemptTracker.trackPublishFailed(X,this.peerClient.getProtocol()),me=ue.code===Zt.OPERATION_ABORTED.code,ce=ue.fatal,de=this.latestPubAttemptNum===4;if(me)return;if(ce||de)return this.logger.error({msg:`Stopping attempts: isFatal=${ce}, isLastAttempt=${de}`,err:X}),this.updateState(Fo.ERRORED),void this.emit(Sl.ERROR,ue);const Ae=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${Ae}ms`}),this.nextAttemptTimerId=window.setTimeout((()=>{this.tryPublish()}),Ae)}}})),this.publish=($,X)=>Yr(this,void 0,void 0,(function*(){this.peerClient.initStreamsToPublish($),yield this.peerClient.connect({audioOnly:!1,traceId:X})})),this.unpublish=($=!1)=>Yr(this,void 0,void 0,(function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===Fo.DISCONNECTED||this.publicationState===Fo.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const X=$?Sr.UNLOAD:Sr.UNPUBLISH,ue=this.peerClient.getProtocol();try{$?this.peerClient.disconnect($):yield this.peerClient.disconnect($),this.attemptTracker.trackEndSucceeded(X,ue)}catch{this.attemptTracker.trackEndFailed(X,ue)}})),this.replaceOrUpdateStream=$=>Yr(this,void 0,void 0,(function*(){this.streamsToPublish.find((X=>X.track.kind===$.track.kind))?this.streamsToPublish=this.streamsToPublish.map((X=>X.track.kind===$.track.kind?$:X)):this.streamsToPublish.push($),yield this.peerClient.replaceOrUpdateStream($)})),this.onPeerClientConnectionStateChange=$=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${$}`,state:$}),this.processStateUpdate($)},this.onPeerClientTransformError=$=>{this.emit(Sl.TRANSFORM_ERROR,$)},this.onIncompatibleCodecs=$=>Yr(this,void 0,void 0,(function*(){yield this.peerClient.onIncompatibleCodecs($)})),this.sendSeiMessage=($,X)=>{if(this.publicationState!==Fo.CONNECTED)return this.attemptTracker&&this.emit(Sl.ERROR,this.attemptTracker.createSeiNotPublishingVideoError()),xn.err(oa.NOT_PUBLISHING_VIDEO);const ue=this.peerClient.sendSeiMessage($,X),me=xn.getErr(ue);return me&&this.attemptTracker&&(me===oa.INBAND_MESSAGING_NOT_ENABLED?this.emit(Sl.ERROR,this.attemptTracker.createSeiInBandMessagingNotEnabledError()):me===oa.NOT_PUBLISHING_VIDEO&&this.emit(Sl.ERROR,this.attemptTracker.createSeiNotPublishingVideoError())),ue},this.peerClient=new Y0(w,this.nonScopedLogger,this.action,No(this.action),Ns(),this.analyticsTracker,void 0,R,void 0),this.logger=new qa(U,oe.PUBLICATION),this.peerClient.on(jc,this.onPeerClientConnectionStateChange),this.peerClient.on(vc,this.onPeerClientTransformError),this.publishTracker=new Xb(this.analyticsTracker,this.token)}removeTrack(w){return Yr(this,void 0,void 0,(function*(){this.streamsToPublish=this.streamsToPublish.filter((R=>R.track.kind!==w)),yield this.peerClient.removeTrack(w)}))}}var cr,Ei=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};class cs extends Bo{constructor(w,R,U,j,$){super(w,new qa(U,oe.LOCAL_PARTICIPANT)),this.onPublicationStateChange=X=>{switch(this.logger.debug({msg:"publicationStateChange",state:X}),X){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(jn.PUBLISHED);break;case"connecting":this.updatePublishState(jn.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(jn.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:X})}},this.onPublicationError=X=>{this.emit(Jl.ERROR,X)},this.updatePublishState=X=>{this.info.isPublishing=X===jn.PUBLISHED,this.publishState=X,this.emit(Jl.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=X=>{X.streamType===wr.AUDIO&&(this.audioMuted=X.isMuted,this.info.audioMuted=X.isMuted),X.streamType===wr.VIDEO&&(this.videoStopped=X.isMuted,this.info.videoStopped=X.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(Jl.MEDIA_STREAM_MUTE_CHANGED,X)},this.handleInsertSeiMsgRequest=(X,ue,me)=>{this.sendSeiMessage(ue,me?.repeatCount)},this.publish=X=>{this.logger.debug({msg:"publish"}),X.forEach((me=>{me&&(this.setupStreamListeners(me),me.streamType===wr.AUDIO?(this.audioStream=me,this.audioMuted=!me.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):me.streamType===wr.VIDEO&&(this.videoStream=me,this.videoStopped=!me.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),me.setGetStats(this.publication.requestRTCStats))})),this.connection.emitStageState(this.audioMuted,this.videoStopped);const ue=X.map((me=>Wl(me)));this.publication.start(ue)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==jn.NOT_PUBLISHED&&this.publishState!==jn.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=X=>Ei(this,void 0,void 0,(function*(){yield this.publication.onIncompatibleCodecs(X)})),this.sendSeiMessage=(X,ue=0)=>this.publication.sendSeiMessage(X,ue),this.sendSeiMessageString=(X,ue=0)=>{const me=new TextEncoder().encode(X);return this.publication.sendSeiMessage(me,ue)},this.connection=j,this.createPublication=()=>{const X=new ws(R,j,U,$);return X.on(Sl.STATE_CHANGE,this.onPublicationStateChange),X.on(Sl.ERROR,this.onPublicationError),X.on(Sl.TRANSFORM_ERROR,this.onPublicationError),X},this.publication=this.createPublication()}setupStreamListeners(w){w.on(gr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),w.streamType===wr.VIDEO&&w.on(gr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleInsertSeiMsgRequest)}removeTrack(w){var R,U,j;w.streamType===wr.AUDIO?((R=this.audioStream)===null||R===void 0||R.off(gr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):w.streamType===wr.VIDEO&&((U=this.videoStream)===null||U===void 0||U.off(gr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),(j=this.videoStream)===null||j===void 0||j.off(gr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(w.streamType)}replaceOrAddTrack(w){return Ei(this,void 0,void 0,(function*(){this.setupStreamListeners(w),w.setGetStats(this.publication.requestRTCStats),w.streamType===wr.AUDIO?(this.audioStream=w,this.audioMuted=!w.mediaStreamTrack.enabled):w.streamType===wr.VIDEO&&(this.videoStream=w,this.videoStopped=!w.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const R=Wl(w);yield this.publication.replaceOrUpdateStream(R)}))}unpublish(){if(this.publishState===jn.NOT_PUBLISHED||this.publishState===jn.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off(Sl.STATE_CHANGE,this.onPublicationStateChange),this.publication.off(Sl.ERROR,this.onPublicationError),this.publication.off(Sl.TRANSFORM_ERROR,this.onPublicationError);const w=[this.audioStream,this.videoStream].filter((R=>!!R));w.forEach((R=>{R.cleanup()})),this.audioStream=void 0,this.videoStream=void 0,this.emit(Jl.MEDIA_STREAM_REMOVED,w),this.updatePublishState(jn.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(P){P.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",P.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",P.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",P.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",P.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",P.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",P.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",P.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",P.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",P.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",P.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",P.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",P.ERROR="error",P.STAGE_LEFT="stageLeft"})(cr||(cr={}));var tc=function(P,w,R,U){return new(R||(R=Promise))((function(j,$){function X(ce){try{me(U.next(ce))}catch(de){$(de)}}function ue(ce){try{me(U.throw(ce))}catch(de){$(de)}}function me(ce){var de;ce.done?j(ce.value):(de=ce.value,de instanceof R?de:new R((function(Ae){Ae(de)}))).then(X,ue)}me((U=U.apply(P,[])).next())}))};const Pd=P=>!!P;class D_ extends Da{constructor(w,R){super(),this.connectionState=Oi.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=($,X)=>{var ue,me;if(this.connectionState=$,$===Oi.ERRORED&&(this.connectionStateErrored=!0),$===Oi.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==jn.NOT_PUBLISHED&&this.stageConnection.emitStageState((ue=this.localParticipant)===null||ue===void 0?void 0:ue.audioMuted,(me=this.localParticipant)===null||me===void 0?void 0:me.videoStopped),$===Oi.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),$===Oi.DISCONNECTED){if(X&&X!==ec.CLIENT_RECONNECT&&X!==ec.USER_INITIATED){let ce=qp.UNKNOWN;(function(de){return Object.values(qp).includes(de)})(X)?ce=X:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${X}`}),this.cleanup(ce)}}else this.emit(cr.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var $;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,($=this.joinTraceId)!==null&&$!==void 0?$:new Ka,"reusing local participant from repeat join",Qt.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const $=(function(X){var ue,me;const ce=new Set;return X.token.claims.capabilities.allow_publish&&ce.add(nr.PUBLISH),X.token.claims.capabilities.allow_subscribe&&ce.add(nr.SUBSCRIBE),{id:X.token.participantID,userId:(ue=X.token.userID)!==null&&ue!==void 0?ue:"",attributes:(me=X.token.claims.attributes)!==null&&me!==void 0?me:{},capabilities:ce,isLocal:!0,userInfo:{},videoStopped:X.videoStopped,audioMuted:X.audioMuted,isPublishing:X.isPublishing}})({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new cs($,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(Jl.PUBLICATION_STATE_CHANGE,(X=>{this.onPublishStateChanged(this.localParticipant.info,X)})),this.localParticipant.on(Jl.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(Jl.MEDIA_STREAM_MUTE_CHANGED,(X=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,X):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})})),this.localParticipant.on(Jl.ERROR,(X=>{this.errorManager.handleError(X,J.PUBLISH_ERROR)})),this.emit(cr.STAGE_PARTICIPANT_JOINED,$)},this.onRemoteParticipantJoined=$=>{if($.id===this.token.participantID)return;const X=(function(de){return{id:de.id,userId:de.userId,attributes:de.attributes,capabilities:new Set([nr.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:de.videoStopped,audioMuted:de.audioMuted,isPublishing:de.isPublishing}})($);if(this.participants.has(X.id))return void this.logger.warn({msg:"Remote participant already tracked"});let ue=Ws.NONE;X.capabilities.has(nr.SUBSCRIBE)&&(ue=xn.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(X),ue),this.updateManagerWithExternalSubscribeConfig(X,"joined"));const me=this.configManager.getSubscribeConfigSnapshot(X.id),ce=new Nd(X,this.token,this.stageConnection,this.logger.unwrap(),ue,me,this.analyticsTracker,$.isPublishing);this.participants.set(X.id,ce),this.setupRemoteParticipantListeners(ce),this.emit(cr.STAGE_PARTICIPANT_JOINED,ce.info),ce.updateSubscribeStateIfNecessary(ue)},this.setupRemoteParticipantListeners=$=>{$.on(as.SUBSCRIPTION_STATE_CHANGE,(X=>{this.onParticipantSubscribeStateChanged($.info.id,X)})),$.on(as.MEDIA_STREAM_ADDED,(X=>{const ue=this.participants.get($.info.id);if(ue){for(const me of X)this.setupRemoteParticipantStreamEvents(ue.info,me);this.emit(cr.STAGE_PARTICIPANT_STREAMS_ADDED,ue.info,zi(X)),this.updateStreamLayerForParticipantInfo($.info,$.streams)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})})),$.on(as.MEDIA_STREAM_REMOVED,(X=>{const ue=this.participants.get($.info.id);ue?this.emit(cr.STAGE_PARTICIPANT_STREAMS_REMOVED,ue.info,zi(X)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})})),$.on(as.MEDIA_STREAM_MUTE_CHANGED,(X=>{this.onStreamMuteChange($.info,X.remote)})),$.on(as.ERROR,(X=>{this.errorManager.handleError(X,J.SUBSCRIBE_ERROR)})),$.on(as.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,(X=>{this.onSeiMessageReceived($.info,X)}))},this.onRemoteParticipantLeft=$=>{if(this.connectionState!==Oi.CONNECTED)return;const X=this.participants.get($);X?(X.participantLeave(),X.unsubscribe(),X.cleanup(),this.participants.delete($),this.emitParticipantLeave(X.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=$=>{this.emit(cr.STAGE_PARTICIPANT_LEFT,$)},this.onRemoteParticipantStateChanged=$=>{const X=this.participants.get($.id);if(!X)return void this.logger.warn({msg:"Remote participant updated but not tracked"});X.updatePublishState($.isPublishing)&&this.onPublishStateChanged(X.info,X.publishState),X.updateStreamState($.audioMuted,$.videoStopped);const ue=this.strategyWrapper.shouldSubscribeToParticipant(X.info);if(xn.isNotOk(ue))return;this.updateManagerWithExternalSubscribeConfig(X.info,"updated");const me=this.configManager.getSubscribeConfigSnapshot(X.info.id),ce=xn.getOk_or(ue,Ws.NONE);X.updateSubscribeStateIfNecessary(ce,me)},this.onPublishStateChanged=($,X)=>{this.emit(cr.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,$,X)},this.onParticipantSubscribeStateChanged=($,X)=>{const ue=this.participants.get($);ue?this.emit(cr.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,ue.info,X):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=$=>{this.localParticipant&&this.emit(cr.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,$)},this.onLocalStreamsRemoved=$=>{this.localParticipant&&this.emit(cr.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,$)},this.onStreamMuteChange=($,X)=>{this.emit(cr.STAGE_STREAM_MUTE_CHANGED,$,X)},this.onSeiMessageReceived=($,X)=>{this.emit(cr.STAGE_STREAM_SEI_MESSAGE_RECEIVED,$,X)},this.leave=()=>{this.cleanup(qp.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var $;this.participants.forEach((X=>{X.quickUnsubscribe()})),($=this.localParticipant)===null||$===void 0||$.quickUnpublish(),this.stageConnection.disconnect(),this.emit(cr.STAGE_CONNECTION_STATE_CHANGED,Oi.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=$=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new x0({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:$})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const X=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(X);const ue=this.participants.entries();for(const[me,ce]of ue)ce.unsubscribe(),this.participants.delete(me),ce.cleanup(),this.emitParticipantLeave(ce.info);Of.destroy(this.analyticsTracker.getSessionId()),this.stageConnection.disconnect(),this.emit(cr.STAGE_CONNECTION_STATE_CHANGED,Oi.DISCONNECTED),this.emit(cr.STAGE_LEFT,$),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach(($=>{if($.info.capabilities.has(nr.SUBSCRIBE)){const X=this.strategyWrapper.shouldSubscribeToParticipant($.info);if(xn.isNotOk(X))return;const ue=xn.getOk_or(X,Ws.NONE);this.updateManagerWithExternalSubscribeConfig($.info,"updated");const me=this.configManager.getSubscribeConfigSnapshot($.info.id);$.updateSubscribeStateIfNecessary(ue,me),this.updateStreamLayerForParticipantInfo($.info,$.streams)}})),this.updateStreamsToPublishIfNecessary()},this.updateManagerWithExternalSubscribeConfig=($,X)=>{var ue;const me=xn.getOk(this.strategyWrapper.subscribeConfiguration($)),ce=xn.getOk(this.getRemoteSubscribeConfiguration()),de=this.getInternalSubscribeOverrides(),Ae=$.id;let Me=!1;me&&(Me=this.configManager.handleExternalSubscribeConfigUpdate(Ae,me,Wt.API));let rt=!1;ce&&(rt=this.configManager.handleSubscribeConfigUpdate(Ae,ce,Wt.REMOTE));let bt=!1;if(de&&(bt=this.configManager.handleSubscribeConfigUpdate(Ae,de,Wt.INTERNAL)),Me||bt||rt){const ht=this.configManager.getSubscribeConfigSnapshot(Ae);this.analyticsTracker.trackEventNoSharedProps(new Ss(this.token,(ue=this.joinTraceId)!==null&&ue!==void 0?ue:Ns(),X==="joined"?"initial":"ad-hoc",Ae,ht))}},this.getRemoteSubscribeConfiguration=()=>{const $=Io.getRemoteSubscribeConfig({customerId:this.token.customerId,sessionId:this.analyticsTracker.getSessionId()});return $?xn.ok($):xn.err("No payload found")},this.updateStreamsToPublishIfNecessary=()=>{var $;if(!this.localParticipant||!(!(($=this.localParticipant)===null||$===void 0)&&$.info.capabilities.has(nr.PUBLISH)))return;const X=this.localParticipant.publishState!==jn.NOT_PUBLISHED&&this.localParticipant.publishState!==jn.ERRORED,ue=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(xn.isNotOk(ue))return;let me=xn.getOk_or(ue,!1);if(!X&&!me)return;if(X&&!me)return void this.localParticipant.unpublish();const ce=this.strategyWrapper.stageStreamsToPublish();if(xn.isNotOk(ce)){const Ae=xn.getErr(ce);if(Ae instanceof Error&&Ae.cause==="UserStrategy")throw Ae;return}const de=xn.getOk_or(ce,[]);me=me&&de.length>0,!X&&me?(this.localParticipant.publish(de),this.onLocalStreamsAdded(de)):this.syncTracksToPublish(de)},this.syncTracksToPublish=$=>{var X;if(!this.localParticipant)return;const ue=this.localParticipant.audioStream,me=this.localParticipant.videoStream,{updates:ce,streamsToAdd:de,streamsToRemove:Ae}=this.determineStreamUpdates(ue,me,$);if(ce.length){for(const Me of ce)Me.newStream?(X=this.localParticipant)===null||X===void 0||X.replaceOrAddTrack(Me.newStream):Me.oldStream&&this.localParticipant.removeTrack(Me.oldStream);Ae.length!==0&&this.onLocalStreamsRemoved(Ae),de.length!==0&&this.onLocalStreamsAdded(de)}},this.determineStreamUpdates=($,X,ue=[])=>{const me=[],ce=ue.slice(0,2);if(ce.sort(((Me,rt)=>Me.streamType===wr.AUDIO?-1:1)),ce.length===0)$&&me.push({oldStream:$}),X&&me.push({oldStream:X});else if(ce.length===1){const Me=ce[0];Me.streamType===wr.AUDIO?X&&me.push({oldStream:X}):Me.streamType===wr.VIDEO&&$&&me.push({oldStream:$})}ce.forEach((Me=>{var rt,bt;Me.streamType===wr.AUDIO?$?$.id===Me.id&&(0,ji.isEqual)($.mediaConfig,Me.mediaConfig)||(!!(!((rt=$.mediaConfig)===null||rt===void 0)&&rt.stereo)!=!!(!((bt=Me.mediaConfig)===null||bt===void 0)&&bt.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),me.push({oldStream:$,newStream:Me})):me.push({newStream:Me}):Me.streamType===wr.VIDEO&&(X?X.id===Me.id&&(0,ji.isEqual)(X.mediaConfig,Me.mediaConfig)||me.push({oldStream:X,newStream:Me}):me.push({newStream:Me}))}));const de=me.map((Me=>Me.newStream)).filter(Pd),Ae=me.map((Me=>Me.oldStream)).filter(Pd);return{updates:me,streamsToAdd:de,streamsToRemove:Ae}},this.onReassignmentMessage=$=>tc(this,void 0,void 0,(function*(){if(Bc("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!Bh.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const X=Ns();this.trackReassignmentRequest($,X);const ue=this.participants.get($.remoteParticipantId),me=this.token.participantID,ce=(function(de,{localParticipantId:Ae,remoteParticipant:Me}){const{participantId:rt}=de;if(Ae!==rt)return xn.err(Object.assign(Object.assign({},Zt.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${rt}`}));if(!Me)return xn.err(Object.assign(Object.assign({},Zt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${Me}`}));if(Me.isReassigning())return xn.err(Zt.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const bt=Me.subscription.peerClient.getConnectionState();return[hr.CONNECTED,hr.DISCONNECTED].includes(bt)?xn.ok(Me):xn.err(Object.assign(Object.assign({},Zt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${bt}`}))})($,{localParticipantId:me,remoteParticipant:ue});if(!ce.ok)this.trackReassignmentRequestRejected(ce.error,X);else try{const{token:de,nodeOverride:Ae}=$;yield ce.value.triggerIceRestart({assignmentToken:de,traceId:X,nodeOverride:Ae})}catch(de){this.logger.error({msg:"Reassignment failed.",err:de})}})),this.onIncompatibleCodecsMessage=$=>tc(this,void 0,void 0,(function*(){var X;yield(X=this.localParticipant)===null||X===void 0?void 0:X.onIncompatibleCodecs($.codecs)})),this.analyticsTracker=new La;const U=qg();this.logger=new qa(new Qo(U),oe.STAGE),this.strategyWrapper=new os(R,this.logger),this.configManager=new pn({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:Ms.DEFAULT,minDelayWhenSubscribeOnly:Ms.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:ba.LOWEST_QUALITY,layerPollingEnabled:!0,layerPollingIntervalMs:3e3}}}),this.errorManager=new Gn(this.logger.unwrap());try{this.token=Fp(w,this.analyticsTracker)}catch($){const X=new Rr(Object.assign({action:Qt.JOIN,token:w,traceId:Ns(),tag:ea,location:"Stage.constructor"},Zt.MALFORMED_TOKEN));throw $ instanceof Error&&(X.details=$.message),this.errorManager.handleError(X,J.JOIN_ERROR)||$}const j={customerId:this.token.customerId,sessionId:this.analyticsTracker.getSessionId()};Io.cacheRealTimeContext(j),Io.resolveExperimentsForRealTimeContext(j),this.stageConnection=new M_(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(Ed,((w,R)=>{this.onConnectionStateChanged(w,R)})),this.stageConnection.on(Ua,(w=>{this.onRemoteParticipantJoined(w)})),this.stageConnection.on($c,(w=>{this.onRemoteParticipantLeft(w.id)})),this.stageConnection.on(wf,(w=>{var R;w.id!==((R=this.localParticipant)===null||R===void 0?void 0:R.info.id)&&this.onRemoteParticipantStateChanged(w)})),this.stageConnection.on(m_,(w=>tc(this,void 0,void 0,(function*(){yield this.onReassignmentMessage(w)})))),this.stageConnection.on(Xs,(w=>tc(this,void 0,void 0,(function*(){yield this.onIncompatibleCodecsMessage(w)})))),this.stageConnection.on(A0,(w=>{w instanceof Rr&&this.analyticsTracker.trackError(w),this.errorManager.handleError(w,J.JOIN_ERROR)})),this.errorManager.on(kt.ERROR,(w=>{this.emit(cr.ERROR,w)}))}setupRemoteParticipantStreamEvents(w,R){const U=R.remote;R.on(mn.ADAPTION_CHANGED,(j=>{this.emit(cr.STAGE_STREAM_ADAPTION_CHANGED,w,U,j)})),R.on(mn.LAYERS_CHANGED,(j=>{this.emit(cr.STAGE_STREAM_LAYERS_CHANGED,w,U,j),this.updateStreamLayerForParticipantInfo(w,[R])})),R.on(mn.LAYER_SELECTED,((j,$)=>{this.emit(cr.STAGE_STREAM_LAYER_SELECTED,w,U,j,$)})),R.layers.length>0&&(this.emit(cr.STAGE_STREAM_LAYERS_CHANGED,w,U,U.getLayers()),this.emit(cr.STAGE_STREAM_LAYER_SELECTED,w,U,U.getSelectedLayer(),Rn.SELECTED))}join(){return tc(this,void 0,void 0,(function*(){Io.markSdkUsage(),this.analyticsTracker.start(),this.joinTraceId=Ns(),this.analyticsTracker.trackEvent(new W0({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(Ns(),ea,"join")}catch(w){throw this.errorManager.handleError(w,J.JOIN_ERROR)||w}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===Oi.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(w){throw this.logger.error({err:w,msg:"error joining stage"}),this.errorManager.handleError(w,J.JOIN_ERROR,!1)||w}}))}replaceStrategy(w){this.strategyWrapper.setStrategy(w),this.refreshStrategy()}getInternalSubscribeOverrides(){const w=this.strategyWrapper.hasStrategy("preferredLayerForStream"),R=this.hasListenersFor(cr.STAGE_STREAM_LAYERS_CHANGED)||this.hasListenersFor(cr.STAGE_STREAM_ADAPTION_CHANGED)||this.hasListenersFor(cr.STAGE_STREAM_LAYER_SELECTED);return{simulcast:{layerPollingEnabled:w||R}}}updateStreamLayerForParticipantInfo(w,R){R.forEach((U=>{if(U.streamType==="audio")return;const j=this.strategyWrapper.preferredLayerForStream(w,U.remote),$=xn.getOk_or(j,void 0);U.setLayer($)}))}trackReassignmentRequestRejected(w,R){const{token:U}=this,j=new Rr(Object.assign(Object.assign({},w),{token:U,action:Qt.JOIN,traceId:R,tag:w0,location:"publish"}));this.logger.error({err:j,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(j)}trackReassignmentRequest(w,R){const{token:U}=this;this.analyticsTracker.trackEvent(new Nn({token:U,traceId:R,targetLocalParticipantId:w.participantId,targetRemoteParticipantId:w.remoteParticipantId}))}}var qp;(function(P){P.UNKNOWN="unknown",P.USER_INITIATED="user-initiated",P.TOKEN_REUSED="token-reused",P.PARTICIPANT_DISCONNECTED="participant-disconnected",P.STAGE_DELETED="stage-deleted"})(qp||(qp={}));const Dd=h})(),s})()))})(aD)),aD.exports}var _qe=gqe();const FS=_u(_qe);class vqe{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return yqe(e).buffer}}function yqe(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t){const s=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);n.set(s,r),r+=i.byteLength}return n}function eoe(t){return new bqe(t).unpack()}function toe(t){const e=new Sqe,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class bqe{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,i="",s,o;for(;r<e;)s=n[r],s<160?(o=s,r++):(s^192)<32?(o=(s&31)<<6|n[r+1]&63,r+=2):(s^224)<16?(o=(s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(s&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),i+=String.fromCodePoint(o);return this.index+=e,i}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const i=this.unpack();n[i]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(n===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(i-20)+n*2**(i-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class Sqe{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=i=>{if(i<n){const s=this.pack(e[i]);return s instanceof Promise?s.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,s=Math.floor(i*2**52),o=2**32,a=n<<31|r+1023<<20|s/o&1048575,c=s%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=s=>{if(s<n.length){const o=n[s];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>i(s+1))}return i(s+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new vqe,this._textEncoder=new TextEncoder}}let noe=!0,roe=!0;function OT(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function pb(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function Eqe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(noe=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function xqe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(roe=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function ioe(){if(typeof window=="object"){if(noe)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function aB(t,e){roe&&console.warn(t+" is deprecated, please use "+e+" instead.")}function wqe(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(OT(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(OT(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(OT(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=OT(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function kW(t){return Object.prototype.toString.call(t)==="[object Object]"}function soe(t){return kW(t)?Object.keys(t).reduce(function(e,n){const r=kW(t[n]),i=r?soe(t[n]):t[n],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[n]:i})},{}):t}function N4(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?N4(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{N4(t,t.get(i),n)})}))}function MW(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&N4(t,a,i)})}),i}const OW=ioe;function ooe(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,d){return f?f+d.charAt(0).toUpperCase()+d.slice(1):d==="deviceId"?"sourceId":d};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",l)]=u.ideal,c.optional.push(f),f={},f[h("max",l)]=u.ideal,c.optional.push(f)):(f[h("",l)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,l)]=u[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(p=>p.kind==="videoinput");let d=f.find(p=>h.some(m=>p.label.toLowerCase().includes(m)));return!d&&f.length&&h.includes("back")&&(d=f[f.length-1]),d&&(a.video.deviceId=l.exact?{exact:d.deviceId}:{ideal:d.deviceId}),a.video=r(a.video),OW("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return OW("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,u=>{n.webkitGetUserMedia(u,c,h=>{l&&l(s(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function aoe(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function coe(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else pb(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function loe(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function uoe(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>MW(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),pb(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>MW(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function hoe(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function foe(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return hoe(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(d=>d.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[h.id];if(p)p.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new t.MediaStream([u]);this._streams[h.id]=m,this._reverseStreams[m.id]=h,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function s(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const d=l._reverseStreams[f],p=l._streams[d.id];h=h.replace(new RegExp(p.id,"g"),d.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const d=l._reverseStreams[f],p=l._streams[d.id];h=h.replace(new RegExp(d.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],h={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[p=>{const m=s(this,p);f[0].apply(null,[m])},p=>{f[1]&&f[1].apply(null,p)},arguments[2]]):u.apply(this,arguments).then(p=>s(this,p))}};t.RTCPeerConnection.prototype[l]=h[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(m=>u.track===m)&&(f=this._streams[d])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function P4(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function doe(t,e){pb(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const IW=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:doe,shimAddTrackRemoveTrack:foe,shimAddTrackRemoveTrackWithNative:hoe,shimGetSendersWithDtmf:loe,shimGetUserMedia:ooe,shimMediaStream:aoe,shimOnTrack:coe,shimPeerConnection:P4,shimSenderReceiverGetStats:uoe},Symbol.toStringTag,{value:"Module"}));function poe(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){aB("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function Tqe(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function moe(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function D4(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function goe(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function _oe(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),pb(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function voe(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){aB("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function yoe(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function boe(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Soe(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Eoe(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function xoe(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const NW=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:boe,shimCreateAnswer:xoe,shimCreateOffer:Eoe,shimGetDisplayMedia:Tqe,shimGetParameters:Soe,shimGetUserMedia:poe,shimOnTrack:moe,shimPeerConnection:D4,shimRTCDataChannel:yoe,shimReceiverGetStats:_oe,shimRemoveStream:voe,shimSenderGetStats:goe},Symbol.toStringTag,{value:"Module"}));function woe(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function Toe(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function Aoe(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f};let a=function(c,l,u){const h=i.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,u){const h=s.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,u){const h=o.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=a}function Coe(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(Roe(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function Roe(t){return t&&t.video!==void 0?Object.assign({},t,{video:soe(t.video)}):t}function koe(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(aB("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Moe(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ooe(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Ioe(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const PW=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Ioe,shimCallbacksAPI:Aoe,shimConstraints:Roe,shimCreateOfferLegacy:Ooe,shimGetUserMedia:Coe,shimLocalStreamsAPI:woe,shimRTCIceServerUrls:koe,shimRemoteStreamsAPI:Toe,shimTrackEventTransceiver:Moe},Symbol.toStringTag,{value:"Module"}));var cD={exports:{}},DW;function Aqe(){return DW||(DW=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(p=>parseInt(p,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let d={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&l&&(d.rtx={ssrc:l}),r.push(d),s&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(d))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-2e3*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(cD)),cD.exports}var Noe=Aqe();const _E=_u(Noe),Cqe=Xoe({__proto__:null,default:_E},[Noe]);function zk(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=_E.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,pb(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function L4(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||pb(t,"icecandidate",e=>{if(e.candidate){const n=_E.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Vk(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=_E.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=_E.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=_E.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),u=s(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function Hk(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},pb(t,"datachannel",r=>(e(r.channel,r.target),r))}function U4(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function B4(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function $k(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Gk(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const Rqe=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:B4,shimAddIceCandidateNullOrEmpty:$k,shimConnectionState:U4,shimMaxMessageSize:Vk,shimParameterlessSetLocalDescription:Gk,shimRTCIceCandidate:zk,shimRTCIceCandidateRelayProtocol:L4,shimSendThrowTypeError:Hk},Symbol.toStringTag,{value:"Module"}));function kqe({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=ioe,r=wqe(t),i={browserDetails:r,commonShim:Rqe,extractVersion:OT,disableLog:Eqe,disableWarnings:xqe,sdp:Cqe};switch(r.browser){case"chrome":if(!IW||!P4||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=IW,$k(t,r),Gk(t),ooe(t,r),aoe(t),P4(t,r),coe(t),foe(t,r),loe(t),uoe(t),doe(t,r),zk(t),L4(t),U4(t),Vk(t,r),Hk(t),B4(t,r);break;case"firefox":if(!NW||!D4||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=NW,$k(t,r),Gk(t),poe(t,r),D4(t,r),moe(t),voe(t),goe(t),_oe(t),yoe(t),boe(t),Soe(t),Eoe(t),xoe(t),zk(t),U4(t),Vk(t,r),Hk(t);break;case"safari":if(!PW||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=PW,$k(t,r),Gk(t),koe(t),Ooe(t),Aoe(t),woe(t),Toe(t),Moe(t),Coe(t),Ioe(t),zk(t),L4(t),Vk(t,r),Hk(t),B4(t,r);break;default:n("Unsupported browser!");break}return i}const LW=kqe({window:typeof window>"u"?void 0:window});function mb(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class Poe{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let s=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:s,data:c,total:i};n.push(l),o=a,s++}return this._dataCount++,n}}}function Mqe(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.byteLength;return n}const lD=LW.default||LW,vT=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return lD.browserDetails.browser}getVersion(){return lD.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=lD.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},Oqe=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),Doe=()=>Math.random().toString(36).slice(2),UW={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class Iqe extends Poe{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(i){i.target&&n(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=UW,this.browser=vT.getBrowser(),this.browserVersion=vT.getVersion(),this.pack=toe,this.unpack=eoe,this.supports=(function(){const n={browser:vT.isBrowserSupported(),webRTC:vT.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(UW),n.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!i.ordered;try{i.binaryType="blob",n.binaryBlob=!vT.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return n})(),this.validateId=Oqe,this.randomToken=Doe}}const eh=new Iqe,Nqe="PeerJS: ";class Pqe{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[Nqe,...n];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var lr=new Pqe,cB={},Dqe=Object.prototype.hasOwnProperty,gu="~";function LA(){}Object.create&&(LA.prototype=Object.create(null),new LA().__proto__||(gu=!1));function Lqe(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function Loe(t,e,n,r,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var s=new Lqe(n,r||t,i),o=gu?gu+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],s]:t._events[o].push(s):(t._events[o]=s,t._eventsCount++),t}function Wk(t,e){--t._eventsCount===0?t._events=new LA:delete t._events[e]}function Ll(){this._events=new LA,this._eventsCount=0}Ll.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)Dqe.call(n,r)&&e.push(gu?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};Ll.prototype.listeners=function(e){var n=gu?gu+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o};Ll.prototype.listenerCount=function(e){var n=gu?gu+e:e,r=this._events[n];return r?r.fn?1:r.length:0};Ll.prototype.emit=function(e,n,r,i,s,o){var a=gu?gu+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,i),!0;case 5:return c.fn.call(c.context,n,r,i,s),!0;case 6:return c.fn.call(c.context,n,r,i,s,o),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var f=c.length,d;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,i);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c[h].fn.apply(c[h].context,u)}}return!0};Ll.prototype.on=function(e,n,r){return Loe(this,e,n,r,!1)};Ll.prototype.once=function(e,n,r){return Loe(this,e,n,r,!0)};Ll.prototype.removeListener=function(e,n,r,i){var s=gu?gu+e:e;if(!this._events[s])return this;if(!n)return Wk(this,s),this;var o=this._events[s];if(o.fn)o.fn===n&&(!i||o.once)&&(!r||o.context===r)&&Wk(this,s);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==n||i&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[s]=c.length===1?c[0]:c:Wk(this,s)}return this};Ll.prototype.removeAllListeners=function(e){var n;return e?(n=gu?gu+e:e,this._events[n]&&Wk(this,n)):(this._events=new LA,this._eventsCount=0),this};Ll.prototype.off=Ll.prototype.removeListener;Ll.prototype.addListener=Ll.prototype.on;Ll.prefixed=gu;Ll.EventEmitter=Ll;cB=Ll;var gb={};mb(gb,"ConnectionType",()=>dv);mb(gb,"PeerErrorType",()=>Ha);mb(gb,"BaseConnectionErrorType",()=>F4);mb(gb,"DataConnectionErrorType",()=>lB);mb(gb,"SerializationType",()=>ZI);mb(gb,"SocketEventType",()=>ov);mb(gb,"ServerMessageType",()=>Rl);var dv=(function(t){return t.Data="data",t.Media="media",t})({}),Ha=(function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t})({}),F4=(function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t})({}),lB=(function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t})({}),ZI=(function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t})({}),ov=(function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t})({}),Rl=(function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t})({});const Uoe="1.5.5";class Uqe extends cB.EventEmitter{constructor(e,n,r,i,s,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+n+":"+r+i+"peerjs?key="+s}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+Uoe),this._disconnected=!1,this._socket.onmessage=i=>{let s;try{s=JSON.parse(i.data),lr.log("Server message received:",s)}catch{lr.log("Invalid server message",i.data);return}this.emit(ov.Message,s)},this._socket.onclose=i=>{this._disconnected||(lr.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(ov.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),lr.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){lr.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:Rl.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(ov.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class Boe{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===dv.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,i={ordered:!!e.reliable},s=n.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){lr.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;lr.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(lr.log(`Received ICE candidates for ${n}:`,o.candidate),s.socket.send({type:Rl.Candidate,payload:{candidate:o.candidate,type:i,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":lr.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(F4.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":lr.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(F4.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":lr.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},lr.log("Listening for data channel"),e.ondatachannel=o=>{lr.log("Received data channel");const a=o.channel;s.getConnection(n,r)._initializeDataChannel(a)},lr.log("Listening for remote stream"),e.ontrack=o=>{lr.log("Received remote stream");const a=o.streams[0],c=s.getConnection(n,r);if(c.type===dv.Media){const l=c;this._addStreamToMediaConnection(a,l)}}}cleanup(){lr.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);lr.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),lr.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===dv.Data){const s=this.connection;i={...i,label:s.label,reliable:s.reliable,serialization:s.serialization}}n.socket.send({type:Rl.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Ha.WebRTC,i),lr.log("Failed to setLocalDescription, ",i))}}catch(r){n.emitError(Ha.WebRTC,r),lr.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();lr.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),lr.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:Rl.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){n.emitError(Ha.WebRTC,i),lr.log("Failed to setLocalDescription, ",i)}}catch(r){n.emitError(Ha.WebRTC,r),lr.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,i=this.connection.provider;lr.log("Setting remote description",n);const s=this;try{await r.setRemoteDescription(n),lr.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await s._makeAnswer()}catch(o){i.emitError(Ha.WebRTC,o),lr.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){lr.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),lr.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(Ha.WebRTC,n),lr.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(lr.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return lr.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){lr.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class Foe extends cB.EventEmitter{emitError(e,n){lr.error("Error:",n),this.emit("error",new Bqe(`${e}`,n))}}class Bqe extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class joe extends Foe{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}class gO extends joe{static#e=this.ID_PREFIX="mc_";get type(){return dv.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||gO.ID_PREFIX+eh.randomToken(),this._negotiator=new Boe(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{lr.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{lr.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){lr.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case Rl.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case Rl.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:lr.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){lr.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class Fqe{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:i,path:s,key:o}=this._options,a=new URL(`${n}://${r}:${i}${s}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",Uoe),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){lr.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==eh.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===eh.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw lr.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}class _O extends joe{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return dv.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||_O.ID_PREFIX+Doe(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new Boe(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{lr.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{lr.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{lr.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(lB.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case Rl.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case Rl.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:lr.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}}class uB extends _O{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>_O.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return lr.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class uD extends uB{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new Poe,this.serialization=ZI.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=eoe(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const i=Mqe(r.data);this._handleDataMessage({data:i})}}_send(e,n){const r=toe(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);lr.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class jqe extends uB{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=ZI.None}}class zqe extends uB{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=eh.chunkedMTU){this.emitError(lB.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=ZI.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class hB extends Foe{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:jqe,json:zqe,binary:uD,"binary-utf8":uD,default:uD},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:eh.CLOUD_HOST,port:eh.CLOUD_PORT,path:"/",key:hB.DEFAULT_KEY,token:eh.randomToken(),config:eh.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==eh.CLOUD_HOST?this._options.secure=eh.isSecure():this._options.host==eh.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&lr.setLogFunction(this._options.logFunction),lr.logLevel=this._options.debug||0,this._api=new Fqe(n),this._socket=this._createServerConnection(),!eh.supports.audioVideo&&!eh.supports.data){this._delayedAbort(Ha.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!eh.validateId(r)){this._delayedAbort(Ha.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(Ha.ServerError,i))}_createServerConnection(){const e=new Uqe(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(ov.Message,n=>{this._handleMessage(n)}),e.on(ov.Error,n=>{this._abort(Ha.SocketError,n)}),e.on(ov.Disconnected,()=>{this.disconnected||(this.emitError(Ha.Network,"Lost connection to server."),this.disconnect())}),e.on(ov.Close,()=>{this.disconnected||this._abort(Ha.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,i=e.src;switch(n){case Rl.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Rl.Error:this._abort(Ha.ServerError,r.msg);break;case Rl.IdTaken:this._abort(Ha.UnavailableID,`ID "${this.id}" is taken`);break;case Rl.InvalidKey:this._abort(Ha.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Rl.Leave:lr.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case Rl.Expire:this.emitError(Ha.PeerUnavailable,`Could not connect to peer ${i}`);break;case Rl.Offer:{const s=r.connectionId;let o=this.getConnection(i,s);if(o&&(o.close(),lr.warn(`Offer received for existing Connection ID:${s}`)),r.type===dv.Media){const c=new gO(i,this,{connectionId:s,_payload:r,metadata:r.metadata});o=c,this._addConnection(i,o),this.emit("call",c)}else if(r.type===dv.Data){const c=new this._serializers[r.serialization](i,this,{connectionId:s,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(i,o),this.emit("connection",c)}else{lr.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(s);for(const c of a)o.handleMessage(c);break}default:{if(!r){lr.warn(`You received a malformed message from ${i} of type ${n}`);return}const s=r.connectionId,o=this.getConnection(i,s);o&&o.peerConnection?o.handleMessage(e):s?this._storeMessage(s,e):lr.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){lr.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Ha.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){lr.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Ha.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){lr.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new gO(e,this,{...r,_stream:n});return this._addConnection(e,i),i}_addConnection(e,n){lr.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===n)return i;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){lr.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(lr.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;lr.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)lr.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)lr.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(Ha.ServerError,n))}}var Vqe=hB;async function Hqe(){return bne("netid")}async function zoe(t){return Sne("netid",t)}let cE="";function $qe(){return cE}let el;function Gqe(){return el?.id===cE}function Voe(t){return jxe(t)}function BW(t){const e=ii();let n;function r(){n=y4(o=>{fe(el)&&wVe(o)&&xVe(o)===!1&&t.send(o)})}function i(){n=y4(o=>{fe(el)&&b4(o)&&TVe(o)===!1&&t.send(o)}),axe(qe,e)}function s(){t.open&&(us(qe,e,`connection ${t.peer} open`),Gqe()?r():i())}t.on("open",s),t.on("close",()=>{n?.disconnect(),fe(el)&&us(qe,e,`disconnection from ${t.peer}`)}),t.on("data",o=>{const a=o;fe(el)&&n?.forward({...a,session:qe.session()})}),t.on("error",o=>{_r(qe,e,"netterminal",`dataconnection ${t.peer} - ${JSON.stringify(o)}`)}),s()}function Hoe(t,e){cE=t,oxe(qe,ii(),cE);const n=ii(),r=e??t;el=new Vqe(r,{debug:2,host:"terminal.zed.cafe"}),window.addEventListener("unload",()=>{el?.disconnect(),el=void 0}),us(qe,n,`netterminal for ${r}`),el.on("open",()=>{if(us(qe,n,"connected to netterminal"),t!==r){us(qe,n,`joining topic ${cE}`);const i=el?.connect(t,{reliable:!0});fe(i)&&BW(i)}else us(qe,n,`hosting topic ${cE}`)}),el.on("connection",BW),el.on("disconnected",()=>{_r(qe,n,"netterminal","lost connection to netterminal"),setTimeout(()=>{_r(qe,n,"netterminal","retrying the connection to netterminal"),el?.reconnect()},5e3)}),el.on("error",i=>{switch(i.type){case"disconnected":case"peer-unavailable":return;case"invalid-id":case"unavailable-id":io(qe,n,async()=>{await zoe(()=>"")});return}_r(qe,n,"netterminal",`${el?.id} - ${JSON.stringify(i)}`)})}async function FW(){const t=ii();if(fe(el)){us(qe,t,"netterminal already active");return}let e=await Hqe();e=(e??"")||t,await zoe(()=>e??"");const n=Voe(e);Hoe(n)}function Wqe(t){const e=ii();if(fe(el)){us(qe,e,"netterminal already active");return}const n=Voe(e);Hoe(t,n)}let sm,Cl;async function qqe(t,e,n,r,i,s){let o;switch(rr(i)){case"get":{o=await fetch(r);break}case"post:json":{const l=[];for(let u=0;u<s.length;u+=2)l.push([s[u],s[u+1]]);o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(nme(l))});break}}if(!o?.ok)return;const a=`fetch:${n}`,[c]=(o.headers.get("content-type")??"").split(";");switch(c){case"text/plain":{const l=await o.text();dh(qe,t,e,"text",a,l);break}case"application/json":{const l=await o.json();dh(qe,t,e,"json",a,l);break}case"application/octet-stream":{const l=await o.arrayBuffer();dh(qe,t,e,"binary",a,new Uint8Array(l));break}}}function jW(){const t=`${location.origin}/join/#${$qe()}`;return fe(da())&&da().writeText(t).catch(e=>console.error(e)),t}function Yqe(t){const e=/(?:https?|ftp):\/\/[\n\S]+/g;return t.replace(e,"")}function zW(t){let e=t.text;const n=[...t.emoteOffsets.values()];for(let r=0;r<n.length;++r){const i=n[r].reverse();for(let s=0;s<i.length;++s){const[o,a]=i[s].split("-").map(parseFloat);e=e.substring(0,o)+e.substring(a+1)}}return Yqe(e)}const Ys=Ym("bridge",[],t=>{if(!Ys.session(t))return;const e=ii();switch(t.target){default:if(t.player!==e)return;break}switch(t.target){case"fetch":if(Kn(t.data)){const[n,r,i,s,o]=t.data;io(qe,t.player,async()=>{await qqe(t.player,n,r,i,s,o)})}break;case"start":io(Ys,t.player,async()=>{await FW(),kEe(qe,t.player,!!t.data)});break;case"tab":io(Ys,t.player,async()=>{await FW(),REe(qe,t.player)});break;case"tabopen":{const n=jW();window.open(n,"_blank","noopener,noreferrer");break}case"join":dn(t.data)&&Wqe(t.data);break;case"showjoincode":{const n=jW();t.data?c4(Ys,t.player,n,"secret join url",!1):c4(Ys,t.player,n,n);break}case"chatstart":fe(sm)?_r(Ys,t.player,"bridge","chat is already started"):dn(t.data)&&(us(Ys,t.player,`connecting to ${t.data}`),sm=new mO({channels:[t.data]}),sm.connect(),sm.onConnect(()=>{us(Ys,t.player,"connected")}),sm.onDisconnect(()=>{us(Ys,t.player,"disconnected")}),sm.onMessage((n,r,i,s)=>{const o=zW(s);dh(Ys,t.player,void 0,"text",`chat:message:${t.data}`,`${r}:${o}`)}),sm.onAction((n,r,i,s)=>{const o=zW(s);dh(Ys,t.player,void 0,"text",`chat:action:${t.data}`,`${r}:${o}`)}));break;case"chatstop":fe(sm)?(sm.quit(),sm=void 0,us(Ys,t.player,"chat stopped")):_r(Ys,t.player,"bridge","chat is already stoped");break;case"streamstart":io(Ys,t.player,async()=>{if(fe(Cl))_r(Ys,t.player,"bridge","stream is already open");else{const r=window.innerHeight>window.innerWidth?FS.STANDARD_PORTRAIT:FS.STANDARD_LANDSCAPE;Cl=FS.create({streamConfig:{...r,maxFramerate:60}}),Cl.on(FS.BroadcastClientEvents.ACTIVE_STATE_CHANGE,function(o){console.info({activestate:o})}),Cl.on(FS.BroadcastClientEvents.CONNECTION_STATE_CHANGE,function(o){us(Ys,t.player,o)}),Cl.on(FS.BroadcastClientEvents.ERROR,function(o){_r(Ys,t.player,"bridge",o),Cl=void 0});const i=document.querySelector("canvas");if(fe(i))await Cl.addImageSource(i,"video",{index:1});else{_r(Ys,t.player,"video","unabled to find canvas element"),Cl=void 0;return}const s=p9e();if(fe(s))await Cl.addAudioInputDevice(s.stream,"audio");else{_r(Ys,t.player,"video","unable create media audio node destination"),Cl=void 0;return}us(Ys,t.player,"created client")}dn(t.data)&&fe(Cl)&&(Sv(Ys,t.player,"broadcasting in"),ih(Ys,t.player,"3","..."),await oh(1e3),ih(Ys,t.player,"2","..."),await oh(1e3),ih(Ys,t.player,"1","..."),await oh(1e3),Sv(Ys,t.player,"GOING LIVE"),await Cl.startBroadcast(t.data,"https://g.webrtc.live-video.net:4443"))});break;case"streamstop":fe(Cl)?(Cl.stopBroadcast(),Cl.delete(),Cl=void 0,us(Ys,t.player,"stream stopped")):_r(Ys,t.player,"bridge","stream already stopped");break}});function Kqe(){const{viewport:t}=Dc(),{width:e,height:n}=t.getCurrentViewport();Ye.useEffect(()=>(kVe(zte()),()=>{MVe()}),[]);const[r]=Ye.useState(()=>new w9e);Ye.useEffect(()=>{if(!ame)return;document.body.appendChild(r.dom),r.showPanel(0),r.dom.style.cssText="position:fixed;bottom:0;left:0;z-index:2;";const E=Npe(()=>r.begin()),x=Ppe(()=>r.end());return()=>{document.body.removeChild(r.dom),E(),x()}},[r]);const i=M9e({benchmarksURL:"/benchmarks-min"}),[s,o]=Ye.useState(!1),[a,c]=Ye.useState(!1),[l,u]=Ye.useState(!1);Ye.useLayoutEffect(()=>{io(qe,ii(),async()=>{await Mk("lowrez")==="on"&&o(!0),await Mk("crt")==="on"&&c(!0),await Mk("scanlines")==="on"&&u(!0)})},[]);const h=Math.min(e,n),f=s||h<600;kn.DRAW_CHAR_SCALE=f?1:2;const d=e>n,p=v4==="touchOnly"||mVe==="touch",m=!f&&!p&&a===!0&&i&&(i.tier>2||i.gpu?.includes("apple gpu"))&&!i.isMobile;Ye.useEffect(()=>{Jf.setState(E=>({...E,islowrez:f,islandscape:d,showtouchcontrols:p}))},[f,d,p]);const{toast:g}=ls(),[_,y]=Ye.useState(Qte),v=Ye.useRef(null);return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(b9e,{ref:v,makeDefault:!0,near:1,far:2e3,position:[0,0,1e3]}),Ee.jsx(Dv,{children:Ee.jsxs(lHe,{children:[Ee.jsx(b$e,{}),Ee.jsx(cGe,{}),Ee.jsx(hW,{toast:g}),Ee.jsx(mGe,{}),_&&Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(Nm,{blocking:!0,opacity:.5,color:"black",cursor:"pointer",width:Math.ceil(e/kn.DRAW_CHAR_WIDTH()),height:Math.ceil(n/kn.DRAW_CHAR_HEIGHT()),onClick:()=>y(!1)}),Ee.jsx(hW,{toast:"Click to un-mute"})]})]})}),Ee.jsx(fGe,{width:e,height:n,children:Ee.jsx(Ee.Fragment,{children:m&&Ee.jsxs(Ee.Fragment,{children:[l&&Ee.jsx(hGe,{}),Ee.jsx(lVe,{technique:qS.ESKIL,offset:.89,darkness:.911}),Ee.jsx(EVe,{viewheight:n})]})})})]})}Qte||window.addEventListener("keyup",()=>{kC()});window.addEventListener("click",()=>{kC()});window.addEventListener("dragover",t=>{t.preventDefault()});window.addEventListener("contextmenu",t=>{kC(),t.preventDefault()});window.addEventListener("paste",t=>{if(!t.clipboardData?.files.length)return;kC(),t.preventDefault(),[...t.clipboardData.files].forEach(n=>dh(qe,ii(),void 0,"file",`file:${n.name}`,n))});window.addEventListener("drop",t=>{kC(),t.preventDefault(),t.dataTransfer?.items?[...t.dataTransfer.items].forEach(n=>{if(n.kind==="file"){const r=n.getAsFile();fe(r)&&dh(qe,ii(),void 0,"file",r.name,r)}}):[...t.dataTransfer?.files??[]].forEach(n=>dh(qe,ii(),void 0,"file",n.name,n))});document.addEventListener("DOMContentLoaded",()=>{let t,e=!1;document.body.style.cursor="none",document.body.addEventListener("mousemove",()=>{e||(document.body.style.cursor="",clearTimeout(t),t=setTimeout(()=>{document.body.style.cursor="none",e=!0,setTimeout(()=>{e=!1},200)},3e3))})});function Xqe(){return Jf(e=>e.active)&&Ee.jsx(Kqe,{})}Iq({Mesh:ef,OrthographicCamera:EO,Group:bT,PlaneGeometry:jA,MeshBasicMaterial:Z4,BufferAttribute:hh,BufferGeometry:jm,Points:Fce,BoxGeometry:QE,PerspectiveCamera:su,InstancedMesh:Dce,InstancedBufferAttribute:XD});const $oe=t=>({...Dpe(t),filter:e=>{const n=e.filter(o=>!!o.object.visible),r=n.findIndex(o=>o.object.userData.blocking),i=r===-1?n:n.slice(0,r+1);let s="default";return i.some(o=>o.object.userData.cursor?(s=o.object.userData.cursor,!0):!1),document.querySelectorAll("html, body").forEach(o=>{o.style.cursor=s}),i}}),j4=Cpe(document.getElementById("frame"));function Jqe(){const t=window.innerWidth,e=window.innerHeight,n=sj(t),r=sj(e),i=window.visualViewport?Math.min(e,window.visualViewport.height):e,s=Math.floor(i/kn.DRAW_CHAR_HEIGHT());Jf.setState({saferows:s}),j4.configure({size:{left:0,top:0,width:n,height:r},events:$oe,dpr:1,flat:!0,linear:!0,shadows:!1,gl:{alpha:!0,stencil:!1,antialias:!1,preserveDrawingBuffer:!0}}).catch(console.error)}const yT=Bpe(Jqe,256);function Zqe(){try{const t=document.createElement("canvas"),e=t.getContext("webgl")??t.getContext("experimental-webgl");return!!(window.WebGLRenderingContext&&e)}catch{return!1}}function Qqe(){const t=document.getElementById("frame");if(!t)return;t.style.display="none";const e=document.createElement("div");e.id="webgl-required",e.innerHTML=`
    <p>WebGL is not enabled or not supported in your browser.</p>
    <p><a href="https://get.webgl.org" target="_blank" rel="noopener noreferrer">Check WebGL support at get.webgl.org</a></p>
  `,document.body.appendChild(e)}async function eYe(){if(!Zqe()){Qqe();return}await j4.configure({events:$oe,dpr:1,flat:!0,linear:!0,shadows:!1,gl:{alpha:!0,stencil:!1,antialias:!1,preserveDrawingBuffer:!0}}),window.addEventListener("resize",yT),yT(),window.visualViewport&&(window.visualViewport.addEventListener("resize",yT),window.visualViewport.addEventListener("scroll",yT)),yT(),j4.render(Ee.jsx(Xqe,{}))}eYe().catch(console.error)});export default tYe();

var uU=Object.defineProperty;var hU=($r,Sn,pn)=>Sn in $r?uU($r,Sn,{enumerable:!0,configurable:!0,writable:!0,value:pn}):$r[Sn]=pn;var Ot=($r,Sn,pn)=>hU($r,typeof Sn!="symbol"?Sn+"":Sn,pn);(function(){"use strict";const $r=new Set,Sn={emit(e,t,n,r,i){Sn.invoke(sw(e,t,n,r,i))},invoke(e){switch(e.target){}$r.forEach(t=>t.handle(e))},connect(e){$r.add(e)},disconnect(e){$r.delete(e)}};var pn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function kb(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var gd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(pn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(gd);var Ab=gd.exports,yd=eo(Ab),_d={};(function(e){var t=pn&&pn.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var f=0,d=l.length,p;f<d;f++)(p||!(f in l))&&(p||(p=Array.prototype.slice.call(l,0,f)),p[f]=l[f]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,f=u.capitalize,d=f===void 0?!0:f,p=u.adjectiveCount,g=p===void 0?1:p,E=u.addAdverb,w=E===void 0?!1:E,v=t(t(t([],t([],Array(g),!0).map(function(A){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),w?[n(e.adverbs)]:[],!0);return d&&(v=v.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),v.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(d?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,g=p===void 0?"":p;return r(e.adjectives).length*h+h*g.length+r(e.nouns).length+g.length+r(e.verbs).length+(d?r(e.adverbs).length+g.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,g=p===void 0?"":p;return i(e.adjectives).length*h+h*g.length+i(e.nouns).length+g.length+i(e.verbs).length+(d?i(e.adverbs).length+g.length:0)}e.minLength=c,e.default=s})(_d);var xb=eo(_d);const Sb="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Rb=e=>crypto.getRandomValues(new Uint8Array(e)),Ib=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},bd=(e,t=21)=>Ib(e,t,Rb),Ob=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=Sb[n[e]&63];return t};var wd="abcdefghijklmnopqrstuvwxyz",Ed="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Td="0123456789",Nb="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Cb="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const Lb=Td,Mb=wd,Ub=Ed;var Pb=Lb+Mb+Ub,Ml={lowercase:wd,uppercase:Ed,numbers:Td,nolookalikes:Nb,nolookalikesSafe:Cb,alphanumeric:Pb};function Te(){return`sid_${Ob(12).replaceAll("-",".")}`}bd(Ml.numbers,4),bd(`${Ml.numbers}${Ml.lowercase}`,16);function Ul(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function Bb(){return xb({capitalize:!1,adjectiveCount:1})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Fb=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Db=Object.prototype.hasOwnProperty;function Pl(e,t){return Db.call(e,t)}function Bl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Pl(e,i)&&r.push(i);return r}function mn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Fl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Bi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function vd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Dl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Dl(e[t]))return!0}else if(typeof e=="object"){for(var r=Bl(e),i=r.length,s=0;s<i;s++)if(Dl(e[r[s]]))return!0}}return!1}function kd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Ad=function(e){Fb(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,kd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=kd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),ve=Ad,$b=mn,ps={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=pa(n,this.path);r&&(r=mn(r));var i=Fi(n,{op:"remove",path:this.from}).removed;return Fi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=pa(n,this.from);return Fi(n,{op:"add",path:this.path,value:mn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:no(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},jb={add:function(e,t,n){return Fl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:ps.move,copy:ps.copy,test:ps.test,_get:ps._get};function pa(e,t){if(t=="")return e;var n={op:"_get",path:t};return Fi(e,n),n.value}function Fi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):ma(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=pa(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=no(e,t.value),o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=mn(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=ma;;){if(d=c[l],d&&d.indexOf("~")!=-1&&(d=vd(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=c.slice(0,l).join("/"):l==h-1&&(f=t.path),f!==void 0&&p(t,0,e,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!Fl(d))throw new ve("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Fl(d)&&(d=~~d)}if(l>=h){if(n&&t.op==="add"&&d>u.length)throw new ve("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=jb[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=ps[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[d],n&&l<h&&(!u||typeof u!="object"))throw new ve("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function $l(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=mn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Fi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function zb(e,t,n){var r=Fi(e,t);if(r.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function ma(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new ve("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(ps[e.op]){if(typeof e.path!="string")throw new ve("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ve('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ve("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Dl(e.value))throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ve("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new ve("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=xd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ve("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function xd(e,t,n){try{if(!Array.isArray(e))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)$l(mn(t),mn(e),n||!0);else{n=n||ma;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof ve)return i;throw i}}function no(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!no(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!no(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Kb=Object.freeze({__proto__:null,JsonPatchError:ve,_areEquals:no,applyOperation:Fi,applyPatch:$l,applyReducer:zb,deepClone:$b,getValueByPointer:pa,validate:xd,validator:ma});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var jl=new WeakMap,Wb=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Gb=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Hb(e){return jl.get(e)}function Yb(e,t){return e.observers.get(t)}function Vb(e,t){e.observers.delete(t.callback)}function qb(e,t){t.unobserve()}function Jb(e,t){var n=[],r,i=Hb(e);if(!i)i=new Wb(e),jl.set(e,i);else{var s=Yb(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=mn(e),t){r.callback=t,r.next=null;var o=function(){zl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){zl(r),clearTimeout(r.next),Vb(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new Gb(t,r)),r}function zl(e,t){t===void 0&&(t=!1);var n=jl.get(e.object);Kl(n.value,e.object,e.patches,"",t),e.patches.length&&$l(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Kl(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Bl(t),o=Bl(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(Pl(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Kl(l,h,n,r+"/"+Bi(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+Bi(u),value:mn(l)}),n.push({op:"replace",path:r+"/"+Bi(u),value:mn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Bi(u),value:mn(l)}),n.push({op:"remove",path:r+"/"+Bi(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!Pl(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+Bi(u),value:mn(t[u])})}}}function Sd(e,t,n){n===void 0&&(n=!1);var r=[];return Kl(e,t,r,"",n),r}var Xb=Object.freeze({__proto__:null,compare:Sd,generate:zl,observe:Jb,unobserve:qb});Object.assign({},Kb,Xb,{JsonPatchError:Ad,deepClone:mn,escapePathComponent:Bi,unescapePathComponent:vd});var Zb=typeof Element<"u",Qb=typeof Map=="function",tw=typeof Set=="function",ew=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function ga(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!ga(e[r],t[r]))return!1;return!0}var s;if(Qb&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!ga(r.value[1],t.get(r.value[0])))return!1;return!0}if(tw&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(ew&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(Zb&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!ga(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var nw=function(t,n){try{return ga(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},rw=eo(nw);function T(e){return e!=null}const Wl=Object.keys;function dr(e){return mn(e)}function iw(e){return typeof e=="boolean"}function Lt(e){return typeof e=="number"&&isNaN(e)===!1}function kt(e){return typeof e=="string"}function Xt(e){return Array.isArray(e)}function Gl(e){return e}var Ut=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Ut||{}),jt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(jt||{}),Pn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Pn||{}),yt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(yt||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Dt(e){return e.toLowerCase().trim()}function sw(e,t,n,r,i){return{session:e,id:Te(),target:t,sender:n,data:r,player:i}}function ro(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function ms(e,t=[],n=Gl,r=""){const i=Te(),s=Dt(e),o=t.map(Dt);let a=r;const c={id(){return i},name(){return e},session(u){return T(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){Sn.emit(a,u,i,l,h)},reply(u,l,h,f){c.emit(`${u.sender}:${l}`,h,f)},replynext(u,l,h,f){setTimeout(()=>c.emit(`${u.sender}:${l}`,h,f),64)},handle(u){const{target:l,path:h}=ro(u.target),f=Dt(l);!a&&f==="ready"&&(a=u.session),f==="bridge"&&T(u.session)&&(a=u.session),o.findIndex(d=>d==="all"||d===f)!==-1&&n(u),(i===l||f==="all"||s===f)&&n({...u,target:h})}};return Sn.connect(c),c}function ow(e){return T(e)&&typeof e=="object"&&kt(e.id)&&kt(e.target)&&kt(e.sender)}function se(e,t,n,r){const i=r??"";return e.emit(`error:${t}`,n,i),Aw(e,n,i)}function aw(e,t,n){e.emit("broadcast:startstream",t,n)}function cw(e,t){e.emit("broadcast:stopstream",void 0,t)}function lw(e,t,n){e.emit("chat:connect",t,n)}function uw(e,t){e.emit("chat:disconnect",void 0,t)}function hw(e,t,n){e.emit("gadgetclient:paint",t,n)}function fw(e,t,n){e.emit("gadgetclient:patch",t,n)}function dw(e,t,n,r,i,s,o){e.emit("network:fetch",[t,n,r,i,s],o)}function pw(e,t){e.emit("network:start",void 0,t)}function mw(e){e.emit("ready")}function Hl(e,t){e.emit("register:loginready",!0,t)}function gw(e,t,n,r){e.emit("register:savemem",[t,n],r)}function yw(e,t){e.emit("register:dev",void 0,t)}function _w(e,t){e.emit("register:share",void 0,t)}function bw(e,t){e.emit("register:nuke",void 0,t)}function ww(e,t,n){e.emit("synth:tts",[t,n])}function Ew(e,t,n){e.emit("synth:play",[t,n])}function Tw(e,t){e.emit("synth:bpm",t)}function Rd(e,t){e.emit("synth:mainvolume",t)}function Id(e,t){e.emit("synth:drumvolume",t)}function Od(e,t){e.emit("synth:ttsvolume",t)}function Yl(e,t,n,r){e.emit("synth:voice",[t,n,r])}function vw(e,t,n,r,i){e.emit("synth:voicefx",[t,n,r,i])}function Bn(e,...t){return e.emit("tape:info",t),!0}function Nd(e,...t){return e.emit("tape:debug",t),!0}function kw(e,t,n){e.emit("tape:inspector",t,n)}function Aw(e,...t){return e.emit("tape:error",t),!1}function Cd(e,t,n,r,i,s){e.emit("tape:editor:open",[t,n,r,i],s)}function Ld(e,t){e.emit("vm:logout",void 0,t)}function ya(e,t){return`${e}:${t.join(":")}`}function Md(e,t,n){e.emit("vm:flush",t,n)}function xw(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function Sw(e,t){return{filename:e,json:t}}function Rw(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Vl(e,t,n,r,i,s){let o;switch(n){case"file":o=i;break;case"text":o=xw(r,i);break;case"json":o=Sw(r,i);break;case"binary":o=Rw(r,i);break}setTimeout(()=>{e.emit("vm:loader",[t,n,r,o],s)},1)}function Iw(e){const t=new Set;function n(s){ow(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Sn.invoke(s))}const r=ms("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Sn.disconnect(r)}return{forward:n,disconnect:i}}const ql=66.666,_a=Math.round(1e3/ql),Ow=3;function Nw(e){return new Promise(t=>setTimeout(t,e))}const Jl=ms("clock");let Xl=0,ba=0,Zl=0,Ud=performance.now();function Pd(){const e=performance.now(),t=e-Ud;Zl+=t,Zl>=ql&&(Zl%=ql,Jl.emit("tick",ba),Jl.emit("tock",ba),++Xl,++ba,Xl>=_a&&(Xl%=_a,Jl.emit("second",ba))),Ud=e,setTimeout(Pd,2)}Pd();function io(){return io=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},io.apply(this,arguments)}function Cw(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ql(e,t)}function Ql(e,t){return Ql=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Ql(e,t)}function Lw(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Bd=function(){function e(n){this.trigger=n,this.observing=new Map}var t=e.prototype;return t.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},t.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[Pe].connections.iterate.delete(r),i.byKey.forEach(function(o){s[Pe].connections.byKey.get(o).delete(r)})}),this.observing.clear()},e}(),Di=[],wa=function(e){Cw(t,e);function t(r,i,s){var o;if(o=e.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){Di.push(Lw(o));try{o.func()}finally{Di.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=t.prototype;return n._trigger=function(){if(Di.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},t}(Bd);function Fd(){return!!Di.length}function Dd(){return Di.length?Di[Di.length-1]:void 0}function Mw(e,t,n){var r=io({name:"unnamed",fireImmediately:!0},n),i=new wa(e,r,t);return i}var Ea=0;function $d(){return Ea>0}function tu(e){Ea++;try{return e()}finally{Ea--,Ea===0&&Pw()}}var eu=!1;function jd(){return eu}function zd(e){eu=!0;try{e()}finally{eu=!1}}function Uw(e){return function(){return zd(e)}}var nu=[];function Pw(){var e=[].concat(nu);nu=[],Kd(e)}function Kd(e){var t=new Set;e.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[Pe].connections.iterate.forEach(function(i){t.add(i)}),(r=n.observable[Pe].connections.byKey.get(n.key))==null||r.forEach(function(i){t.add(i)})}),t.forEach(function(n){n.trigger()})}function Ta(e){if($d()){nu.push(e);return}Kd([e])}function Wd(e,t){if(e.type==="iterate")e.observable[Pe].connections.iterate.add(t);else{var n=e.observable[Pe].connections.byKey.get(e.key);n||(n=new Set,e.observable[Pe].connections.byKey.set(e.key,n)),n.add(t)}}function va(e,t){if(!jd()){var n=Dd();n&&(Wd(e,n),n.registerConnection(e)),t&&(Wd(e,t),t.registerConnection(e))}}var ru=Symbol("$skipreactive"),Pe=Symbol("$reactive"),Fn=Symbol("$reactiveproxy");function so(e,t){return!!(e&&e[Fn]&&e[Fn].implicitObserver===t)}function iu(e){return e[ru]=!0,e}function Gd(e){return!!(e&&!so(e)&&e[Pe])}function su(e,t,n){if(n===void 0&&(n=!1),e[ru]||so(e,t))return e;var r=Bw(e,n);if(!t)return r;var i=r[Pe].proxiesWithImplicitObserver.get(t);if(!i){var s={implicitObserver:t};Object.setPrototypeOf(s,Hd),i=new Proxy(r[Pe].raw,s),r[Pe].proxiesWithImplicitObserver.set(t,i)}return i}var oo=su;function Bw(e,t){if(t===void 0&&(t=!1),so(e))return e;if(Gd(e))return e[Pe].proxy;if(e[Pe]||e[Fn])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:e,proxiesWithImplicitObserver:new Map,shallow:t};Object.defineProperty(e,Pe,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(e,Hd);return n.proxy=r,r}var Hd={has:function(t,n){var r=Reflect.has(t,n);return typeof n=="symbol"||va({observable:t,key:n,type:"has"},this.implicitObserver),r},get:function(t,n,r){if(n===Fn)return{implicitObserver:this.implicitObserver};var i=Reflect.get(t,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(t)?va({observable:t,type:"iterate"},this.implicitObserver):va({observable:t,key:n,type:"get"},this.implicitObserver),Gd(i))return su(i,this.implicitObserver);if(t[Pe].shallow)return i;if(typeof i=="object"&&i!==null&&!so(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(t,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(Fd()||this.implicitObserver))return su(i,this.implicitObserver)}return i},ownKeys:function(t){return va({observable:t,type:"iterate"},this.implicitObserver),Reflect.ownKeys(t)},set:function(t,n,r,i){return tu(function(){if(typeof n=="symbol")return Reflect.set(t,n,r,i);var s=Object.hasOwnProperty.call(t,n),o=Reflect.get(t,n,i),a=Reflect.set(t,n,r,i);if(!s)Ta({observable:t,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(t)){if(!(o<r))for(var c=r+1;c<=o;c++)Ta({observable:t,key:""+(c-1),oldValue:void 0,type:"delete"})}else Ta({observable:t,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(t,n){return tu(function(){if(typeof n=="symbol")return Reflect.deleteProperty(t,n);var r=Object.hasOwnProperty.call(t,n),i=Reflect.get(t,n),s=Reflect.deleteProperty(t,n);return r&&Ta({observable:t,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(t){throw new Error("Dynamic observable objects cannot be frozen")}};function Fw(e,t){var n=io({name:"unnamed",fireImmediately:!0},t),r=new wa(e,n);return r}function Dw(e,t,n){var r=io({name:"unnamed",fireImmediately:!0},n),i=new wa(function(){e(t)},r);return t=oo(t,i),r.fireImmediately&&i.trigger(),i}var Yd=function(){function e(){this._observable=oo({_key:1})}var t=e.prototype;return t.reportObserved=function(r){return oo(this._observable,r)._key},t.reportChanged=function(){this._observable._key++},e}();function $w(e,t,n){return new Yd}var jw=Object.freeze({__proto__:null,$reactive:Pe,$reactiveproxy:Fn,$skipreactive:ru,Atom:Yd,Observer:Bd,Reaction:wa,autorun:Fw,autorunAsync:Dw,createAtom:$w,hasRunningReaction:Fd,isActionRunning:$d,isReactive:so,isTrackingDisabled:jd,markRaw:iu,reaction:Mw,reactive:oo,runInAction:tu,runningReaction:Dd,untracked:zd,untrackedCB:Uw});const gs=globalThis||void 0||self,Zn=()=>new Map,ou=e=>{const t=Zn();return e.forEach((n,r)=>{t.set(r,n)}),t},pi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},zw=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},Kw=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},ys=()=>new Set,au=e=>e[e.length-1],Ww=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},mi=Array.from,Gw=Array.isArray;class Hw{constructor(){this._observers=Zn()}on(t,n){return pi(this._observers,t,ys).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return mi((this._observers.get(t)||Zn()).values()).forEach(r=>r(...n))}destroy(){this._observers=Zn()}}const gi=Math.floor,ka=Math.abs,Vd=(e,t)=>e<t?e:t,$i=(e,t)=>e>t?e:t,qd=e=>e!==0?e<0:1/e<0,Jd=1,Xd=2,cu=4,lu=8,ao=32,jr=64,Rn=128,Aa=31,uu=63,ji=127,Yw=2147483647,Zd=Number.MAX_SAFE_INTEGER,Vw=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&gi(e)===e),qw=e=>e.toLowerCase(),Jw=/^\s*/g,Xw=e=>e.replace(Jw,""),Zw=/([A-Z])/g,Qd=(e,t)=>Xw(e.replace(Zw,n=>`${t}${qw(n)}`)),Qw=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},co=typeof TextEncoder<"u"?new TextEncoder:null,tE=co?e=>co.encode(e):Qw;let lo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});lo&&lo.decode(new Uint8Array).length===1&&(lo=null);class uo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const yi=()=>new uo,eE=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Qn=e=>{const t=new Uint8Array(eE(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},nE=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array($i(n,t)*2),e.cpos=0)},Ge=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},hu=Ge,Bt=(e,t)=>{for(;t>ji;)Ge(e,Rn|ji&t),t=gi(t/128);Ge(e,ji&t)},fu=(e,t)=>{const n=qd(t);for(n&&(t=-t),Ge(e,(t>uu?Rn:0)|(n?jr:0)|uu&t),t=gi(t/64);t>0;)Ge(e,(t>ji?Rn:0)|ji&t),t=gi(t/128)},du=new Uint8Array(3e4),rE=du.length/3,iE=(e,t)=>{if(t.length<rE){const n=co.encodeInto(t,du).written||0;Bt(e,n);for(let r=0;r<n;r++)Ge(e,du[r])}else Qe(e,tE(t))},sE=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;Bt(e,r);for(let i=0;i<r;i++)Ge(e,n.codePointAt(i))},_s=co&&co.encodeInto?iE:sE,xa=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=Vd(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array($i(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},Qe=(e,t)=>{Bt(e,t.byteLength),xa(e,t)},pu=(e,t)=>{nE(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},oE=(e,t)=>pu(e,4).setFloat32(0,t,!1),aE=(e,t)=>pu(e,8).setFloat64(0,t,!1),cE=(e,t)=>pu(e,8).setBigInt64(0,t,!1),tp=new DataView(new ArrayBuffer(4)),lE=e=>(tp.setFloat32(0,e),tp.getFloat32(0)===e),ho=(e,t)=>{switch(typeof t){case"string":Ge(e,119),_s(e,t);break;case"number":Vw(t)&&ka(t)<=Yw?(Ge(e,125),fu(e,t)):lE(t)?(Ge(e,124),oE(e,t)):(Ge(e,123),aE(e,t));break;case"bigint":Ge(e,122),cE(e,t);break;case"object":if(t===null)Ge(e,126);else if(Gw(t)){Ge(e,117),Bt(e,t.length);for(let n=0;n<t.length;n++)ho(e,t[n])}else if(t instanceof Uint8Array)Ge(e,116),Qe(e,t);else{Ge(e,118);const n=Object.keys(t);Bt(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];_s(e,i),ho(e,t[i])}}break;case"boolean":Ge(e,t?120:121);break;default:Ge(e,127)}};class ep extends uo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&Bt(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const np=e=>{e.count>0&&(fu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&Bt(e.encoder,e.count-2))};class Sa{constructor(){this.encoder=new uo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(np(this),this.count=1,this.s=t)}toUint8Array(){return np(this),Qn(this.encoder)}}const rp=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);fu(e.encoder,t),e.count>1&&Bt(e.encoder,e.count-2)}};class mu{constructor(){this.encoder=new uo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(rp(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return rp(this),Qn(this.encoder)}}class uE{constructor(){this.sarr=[],this.s="",this.lensE=new Sa}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new uo;return this.sarr.push(this.s),this.s="",_s(t,this.sarr.join("")),xa(t,this.lensE.toUint8Array()),Qn(t)}}const _i=e=>new Error(e),pr=()=>{throw _i("Method unimplemented")},mr=()=>{throw _i("Unexpected case")},ip=_i("Unexpected end of array"),sp=_i("Integer out of Range");class Ra{constructor(t){this.arr=t,this.pos=0}}const zi=e=>new Ra(e),hE=e=>e.pos!==e.arr.length,fE=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},nn=e=>fE(e,Ft(e)),bs=e=>e.arr[e.pos++],Ft=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&ji)*n,n*=128,i<Rn)return t;if(t>Zd)throw sp}throw ip},gu=e=>{let t=e.arr[e.pos++],n=t&uu,r=64;const i=(t&jr)>0?-1:1;if(!(t&Rn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&ji)*r,r*=128,t<Rn)return i*n;if(n>Zd)throw sp}throw ip},ws=lo?e=>lo.decode(nn(e)):e=>{let t=Ft(e);if(t===0)return"";{let n=String.fromCodePoint(bs(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(bs(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},yu=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},dE=[e=>{},e=>null,gu,e=>yu(e,4).getFloat32(0,!1),e=>yu(e,8).getFloat64(0,!1),e=>yu(e,8).getBigInt64(0,!1),e=>!1,e=>!0,ws,e=>{const t=Ft(e),n={};for(let r=0;r<t;r++){const i=ws(e);n[i]=fo(e)}return n},e=>{const t=Ft(e),n=[];for(let r=0;r<t;r++)n.push(fo(e));return n},nn],fo=e=>dE[127-bs(e)](e);class op extends Ra{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),hE(this)?this.count=Ft(this)+1:this.count=-1),this.count--,this.s}}class Ia extends Ra{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=gu(this);const t=qd(this.s);this.count=1,t&&(this.s=-this.s,this.count=Ft(this)+2)}return this.count--,this.s}}class _u extends Ra{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=gu(this),n=t&1;this.diff=gi(t/2),this.count=1,n&&(this.count=Ft(this)+2)}return this.s+=this.diff,this.count--,this.s}}class pE{constructor(t){this.decoder=new Ia(t),this.str=ws(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const mE=crypto.getRandomValues.bind(crypto),ap=()=>mE(new Uint32Array(1))[0],gE="10000000-1000-4000-8000"+-1e11,yE=()=>gE.replace(/[018]/g,e=>(e^ap()&15>>e/4).toString(16)),cp=e=>new Promise(e);Promise.all.bind(Promise);var lp={},Oa={};Oa.byteLength=wE,Oa.toByteArray=TE,Oa.fromByteArray=AE;for(var gr=[],Dn=[],_E=typeof Uint8Array<"u"?Uint8Array:Array,bu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Es=0,bE=bu.length;Es<bE;++Es)gr[Es]=bu[Es],Dn[bu.charCodeAt(Es)]=Es;Dn[45]=62,Dn[95]=63;function up(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function wE(e){var t=up(e),n=t[0],r=t[1];return(n+r)*3/4-r}function EE(e,t,n){return(t+n)*3/4-n}function TE(e){var t,n=up(e),r=n[0],i=n[1],s=new _E(EE(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=Dn[e.charCodeAt(c)]<<18|Dn[e.charCodeAt(c+1)]<<12|Dn[e.charCodeAt(c+2)]<<6|Dn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Dn[e.charCodeAt(c)]<<2|Dn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=Dn[e.charCodeAt(c)]<<10|Dn[e.charCodeAt(c+1)]<<4|Dn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function vE(e){return gr[e>>18&63]+gr[e>>12&63]+gr[e>>6&63]+gr[e&63]}function kE(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(vE(r));return i.join("")}function AE(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(kE(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(gr[t>>2]+gr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(gr[t>>10]+gr[t>>4&63]+gr[t<<2&63]+"=")),i.join("")}var wu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */wu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+e[t+h],h+=f,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(d?-1:1)*o*Math.pow(2,s-r)},wu.write=function(e,t,n,r,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=f/c:t+=f*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+d]=o&255,d+=p,o/=256,u-=8);e[n+d-p]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Oa,n=wu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const k=new s(1),m={foo:function(){return 42}};return Object.setPrototypeOf(m,s.prototype),Object.setPrototypeOf(k,m),k.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(k){if(k>i)throw new RangeError('The value "'+k+'" is invalid for option "size"');const m=new s(k);return Object.setPrototypeOf(m,l.prototype),m}function l(k,m,y){if(typeof k=="number"){if(typeof m=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(k)}return h(k,m,y)}l.poolSize=8192;function h(k,m,y){if(typeof k=="string")return g(k,m);if(o.isView(k))return w(k);if(k==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof k);if(ft(k,o)||k&&ft(k.buffer,o)||typeof a<"u"&&(ft(k,a)||k&&ft(k.buffer,a)))return v(k,m,y);if(typeof k=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const S=k.valueOf&&k.valueOf();if(S!=null&&S!==k)return l.from(S,m,y);const F=A(k);if(F)return F;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof k[Symbol.toPrimitive]=="function")return l.from(k[Symbol.toPrimitive]("string"),m,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof k)}l.from=function(k,m,y){return h(k,m,y)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function f(k){if(typeof k!="number")throw new TypeError('"size" argument must be of type number');if(k<0)throw new RangeError('The value "'+k+'" is invalid for option "size"')}function d(k,m,y){return f(k),k<=0?u(k):m!==void 0?typeof y=="string"?u(k).fill(m,y):u(k).fill(m):u(k)}l.alloc=function(k,m,y){return d(k,m,y)};function p(k){return f(k),u(k<0?0:O(k)|0)}l.allocUnsafe=function(k){return p(k)},l.allocUnsafeSlow=function(k){return p(k)};function g(k,m){if((typeof m!="string"||m==="")&&(m="utf8"),!l.isEncoding(m))throw new TypeError("Unknown encoding: "+m);const y=L(k,m)|0;let S=u(y);const F=S.write(k,m);return F!==y&&(S=S.slice(0,F)),S}function E(k){const m=k.length<0?0:O(k.length)|0,y=u(m);for(let S=0;S<m;S+=1)y[S]=k[S]&255;return y}function w(k){if(ft(k,s)){const m=new s(k);return v(m.buffer,m.byteOffset,m.byteLength)}return E(k)}function v(k,m,y){if(m<0||k.byteLength<m)throw new RangeError('"offset" is outside of buffer bounds');if(k.byteLength<m+(y||0))throw new RangeError('"length" is outside of buffer bounds');let S;return m===void 0&&y===void 0?S=new s(k):y===void 0?S=new s(k,m):S=new s(k,m,y),Object.setPrototypeOf(S,l.prototype),S}function A(k){if(l.isBuffer(k)){const m=O(k.length)|0,y=u(m);return y.length===0||k.copy(y,0,0,m),y}if(k.length!==void 0)return typeof k.length!="number"||vt(k.length)?u(0):E(k);if(k.type==="Buffer"&&Array.isArray(k.data))return E(k.data)}function O(k){if(k>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return k|0}function U(k){return+k!=k&&(k=0),l.alloc(+k)}l.isBuffer=function(m){return m!=null&&m._isBuffer===!0&&m!==l.prototype},l.compare=function(m,y){if(ft(m,s)&&(m=l.from(m,m.offset,m.byteLength)),ft(y,s)&&(y=l.from(y,y.offset,y.byteLength)),!l.isBuffer(m)||!l.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(m===y)return 0;let S=m.length,F=y.length;for(let Z=0,nt=Math.min(S,F);Z<nt;++Z)if(m[Z]!==y[Z]){S=m[Z],F=y[Z];break}return S<F?-1:F<S?1:0},l.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(m,y){if(!Array.isArray(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return l.alloc(0);let S;if(y===void 0)for(y=0,S=0;S<m.length;++S)y+=m[S].length;const F=l.allocUnsafe(y);let Z=0;for(S=0;S<m.length;++S){let nt=m[S];if(ft(nt,s))Z+nt.length>F.length?(l.isBuffer(nt)||(nt=l.from(nt)),nt.copy(F,Z)):s.prototype.set.call(F,nt,Z);else if(l.isBuffer(nt))nt.copy(F,Z);else throw new TypeError('"list" argument must be an Array of Buffers');Z+=nt.length}return F};function L(k,m){if(l.isBuffer(k))return k.length;if(o.isView(k)||ft(k,o))return k.byteLength;if(typeof k!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof k);const y=k.length,S=arguments.length>2&&arguments[2]===!0;if(!S&&y===0)return 0;let F=!1;for(;;)switch(m){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ot(k).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return pt(k).length;default:if(F)return S?-1:ot(k).length;m=(""+m).toLowerCase(),F=!0}}l.byteLength=L;function N(k,m,y){let S=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,m>>>=0,y<=m))return"";for(k||(k="utf8");;)switch(k){case"hex":return K(this,m,y);case"utf8":case"utf-8":return j(this,m,y);case"ascii":return ht(this,m,y);case"latin1":case"binary":return G(this,m,y);case"base64":return X(this,m,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,m,y);default:if(S)throw new TypeError("Unknown encoding: "+k);k=(k+"").toLowerCase(),S=!0}}l.prototype._isBuffer=!0;function D(k,m,y){const S=k[m];k[m]=k[y],k[y]=S}l.prototype.swap16=function(){const m=this.length;if(m%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<m;y+=2)D(this,y,y+1);return this},l.prototype.swap32=function(){const m=this.length;if(m%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<m;y+=4)D(this,y,y+3),D(this,y+1,y+2);return this},l.prototype.swap64=function(){const m=this.length;if(m%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<m;y+=8)D(this,y,y+7),D(this,y+1,y+6),D(this,y+2,y+5),D(this,y+3,y+4);return this},l.prototype.toString=function(){const m=this.length;return m===0?"":arguments.length===0?j(this,0,m):N.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(m){if(!l.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m?!0:l.compare(this,m)===0},l.prototype.inspect=function(){let m="";const y=e.INSPECT_MAX_BYTES;return m=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(m+=" ... "),"<Buffer "+m+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(m,y,S,F,Z){if(ft(m,s)&&(m=l.from(m,m.offset,m.byteLength)),!l.isBuffer(m))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof m);if(y===void 0&&(y=0),S===void 0&&(S=m?m.length:0),F===void 0&&(F=0),Z===void 0&&(Z=this.length),y<0||S>m.length||F<0||Z>this.length)throw new RangeError("out of range index");if(F>=Z&&y>=S)return 0;if(F>=Z)return-1;if(y>=S)return 1;if(y>>>=0,S>>>=0,F>>>=0,Z>>>=0,this===m)return 0;let nt=Z-F,Pt=S-y;const ye=Math.min(nt,Pt),pe=this.slice(F,Z),_e=m.slice(y,S);for(let ie=0;ie<ye;++ie)if(pe[ie]!==_e[ie]){nt=pe[ie],Pt=_e[ie];break}return nt<Pt?-1:Pt<nt?1:0};function P(k,m,y,S,F){if(k.length===0)return-1;if(typeof y=="string"?(S=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=F?0:k.length-1),y<0&&(y=k.length+y),y>=k.length){if(F)return-1;y=k.length-1}else if(y<0)if(F)y=0;else return-1;if(typeof m=="string"&&(m=l.from(m,S)),l.isBuffer(m))return m.length===0?-1:et(k,m,y,S,F);if(typeof m=="number")return m=m&255,typeof s.prototype.indexOf=="function"?F?s.prototype.indexOf.call(k,m,y):s.prototype.lastIndexOf.call(k,m,y):et(k,[m],y,S,F);throw new TypeError("val must be string, number or Buffer")}function et(k,m,y,S,F){let Z=1,nt=k.length,Pt=m.length;if(S!==void 0&&(S=String(S).toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(k.length<2||m.length<2)return-1;Z=2,nt/=2,Pt/=2,y/=2}function ye(_e,ie){return Z===1?_e[ie]:_e.readUInt16BE(ie*Z)}let pe;if(F){let _e=-1;for(pe=y;pe<nt;pe++)if(ye(k,pe)===ye(m,_e===-1?0:pe-_e)){if(_e===-1&&(_e=pe),pe-_e+1===Pt)return _e*Z}else _e!==-1&&(pe-=pe-_e),_e=-1}else for(y+Pt>nt&&(y=nt-Pt),pe=y;pe>=0;pe--){let _e=!0;for(let ie=0;ie<Pt;ie++)if(ye(k,pe+ie)!==ye(m,ie)){_e=!1;break}if(_e)return pe}return-1}l.prototype.includes=function(m,y,S){return this.indexOf(m,y,S)!==-1},l.prototype.indexOf=function(m,y,S){return P(this,m,y,S,!0)},l.prototype.lastIndexOf=function(m,y,S){return P(this,m,y,S,!1)};function dt(k,m,y,S){y=Number(y)||0;const F=k.length-y;S?(S=Number(S),S>F&&(S=F)):S=F;const Z=m.length;S>Z/2&&(S=Z/2);let nt;for(nt=0;nt<S;++nt){const Pt=parseInt(m.substr(nt*2,2),16);if(vt(Pt))return nt;k[y+nt]=Pt}return nt}function M(k,m,y,S){return _t(ot(m,k.length-y),k,y,S)}function R(k,m,y,S){return _t(ut(m),k,y,S)}function _(k,m,y,S){return _t(pt(m),k,y,S)}function B(k,m,y,S){return _t(q(m,k.length-y),k,y,S)}l.prototype.write=function(m,y,S,F){if(y===void 0)F="utf8",S=this.length,y=0;else if(S===void 0&&typeof y=="string")F=y,S=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(S)?(S=S>>>0,F===void 0&&(F="utf8")):(F=S,S=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Z=this.length-y;if((S===void 0||S>Z)&&(S=Z),m.length>0&&(S<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");F||(F="utf8");let nt=!1;for(;;)switch(F){case"hex":return dt(this,m,y,S);case"utf8":case"utf-8":return M(this,m,y,S);case"ascii":case"latin1":case"binary":return R(this,m,y,S);case"base64":return _(this,m,y,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,m,y,S);default:if(nt)throw new TypeError("Unknown encoding: "+F);F=(""+F).toLowerCase(),nt=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(k,m,y){return m===0&&y===k.length?t.fromByteArray(k):t.fromByteArray(k.slice(m,y))}function j(k,m,y){y=Math.min(k.length,y);const S=[];let F=m;for(;F<y;){const Z=k[F];let nt=null,Pt=Z>239?4:Z>223?3:Z>191?2:1;if(F+Pt<=y){let ye,pe,_e,ie;switch(Pt){case 1:Z<128&&(nt=Z);break;case 2:ye=k[F+1],(ye&192)===128&&(ie=(Z&31)<<6|ye&63,ie>127&&(nt=ie));break;case 3:ye=k[F+1],pe=k[F+2],(ye&192)===128&&(pe&192)===128&&(ie=(Z&15)<<12|(ye&63)<<6|pe&63,ie>2047&&(ie<55296||ie>57343)&&(nt=ie));break;case 4:ye=k[F+1],pe=k[F+2],_e=k[F+3],(ye&192)===128&&(pe&192)===128&&(_e&192)===128&&(ie=(Z&15)<<18|(ye&63)<<12|(pe&63)<<6|_e&63,ie>65535&&ie<1114112&&(nt=ie))}}nt===null?(nt=65533,Pt=1):nt>65535&&(nt-=65536,S.push(nt>>>10&1023|55296),nt=56320|nt&1023),S.push(nt),F+=Pt}return tt(S)}const ct=4096;function tt(k){const m=k.length;if(m<=ct)return String.fromCharCode.apply(String,k);let y="",S=0;for(;S<m;)y+=String.fromCharCode.apply(String,k.slice(S,S+=ct));return y}function ht(k,m,y){let S="";y=Math.min(k.length,y);for(let F=m;F<y;++F)S+=String.fromCharCode(k[F]&127);return S}function G(k,m,y){let S="";y=Math.min(k.length,y);for(let F=m;F<y;++F)S+=String.fromCharCode(k[F]);return S}function K(k,m,y){const S=k.length;(!m||m<0)&&(m=0),(!y||y<0||y>S)&&(y=S);let F="";for(let Z=m;Z<y;++Z)F+=ae[k[Z]];return F}function bt(k,m,y){const S=k.slice(m,y);let F="";for(let Z=0;Z<S.length-1;Z+=2)F+=String.fromCharCode(S[Z]+S[Z+1]*256);return F}l.prototype.slice=function(m,y){const S=this.length;m=~~m,y=y===void 0?S:~~y,m<0?(m+=S,m<0&&(m=0)):m>S&&(m=S),y<0?(y+=S,y<0&&(y=0)):y>S&&(y=S),y<m&&(y=m);const F=this.subarray(m,y);return Object.setPrototypeOf(F,l.prototype),F};function st(k,m,y){if(k%1!==0||k<0)throw new RangeError("offset is not uint");if(k+m>y)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(m,y,S){m=m>>>0,y=y>>>0,S||st(m,y,this.length);let F=this[m],Z=1,nt=0;for(;++nt<y&&(Z*=256);)F+=this[m+nt]*Z;return F},l.prototype.readUintBE=l.prototype.readUIntBE=function(m,y,S){m=m>>>0,y=y>>>0,S||st(m,y,this.length);let F=this[m+--y],Z=1;for(;y>0&&(Z*=256);)F+=this[m+--y]*Z;return F},l.prototype.readUint8=l.prototype.readUInt8=function(m,y){return m=m>>>0,y||st(m,1,this.length),this[m]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(m,y){return m=m>>>0,y||st(m,2,this.length),this[m]|this[m+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(m,y){return m=m>>>0,y||st(m,2,this.length),this[m]<<8|this[m+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(m,y){return m=m>>>0,y||st(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+this[m+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]*16777216+(this[m+1]<<16|this[m+2]<<8|this[m+3])},l.prototype.readBigUInt64LE=Mt(function(m){m=m>>>0,Q(m,"offset");const y=this[m],S=this[m+7];(y===void 0||S===void 0)&&C(m,this.length-8);const F=y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24,Z=this[++m]+this[++m]*2**8+this[++m]*2**16+S*2**24;return BigInt(F)+(BigInt(Z)<<BigInt(32))}),l.prototype.readBigUInt64BE=Mt(function(m){m=m>>>0,Q(m,"offset");const y=this[m],S=this[m+7];(y===void 0||S===void 0)&&C(m,this.length-8);const F=y*2**24+this[++m]*2**16+this[++m]*2**8+this[++m],Z=this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+S;return(BigInt(F)<<BigInt(32))+BigInt(Z)}),l.prototype.readIntLE=function(m,y,S){m=m>>>0,y=y>>>0,S||st(m,y,this.length);let F=this[m],Z=1,nt=0;for(;++nt<y&&(Z*=256);)F+=this[m+nt]*Z;return Z*=128,F>=Z&&(F-=Math.pow(2,8*y)),F},l.prototype.readIntBE=function(m,y,S){m=m>>>0,y=y>>>0,S||st(m,y,this.length);let F=y,Z=1,nt=this[m+--F];for(;F>0&&(Z*=256);)nt+=this[m+--F]*Z;return Z*=128,nt>=Z&&(nt-=Math.pow(2,8*y)),nt},l.prototype.readInt8=function(m,y){return m=m>>>0,y||st(m,1,this.length),this[m]&128?(255-this[m]+1)*-1:this[m]},l.prototype.readInt16LE=function(m,y){m=m>>>0,y||st(m,2,this.length);const S=this[m]|this[m+1]<<8;return S&32768?S|4294901760:S},l.prototype.readInt16BE=function(m,y){m=m>>>0,y||st(m,2,this.length);const S=this[m+1]|this[m]<<8;return S&32768?S|4294901760:S},l.prototype.readInt32LE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},l.prototype.readInt32BE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},l.prototype.readBigInt64LE=Mt(function(m){m=m>>>0,Q(m,"offset");const y=this[m],S=this[m+7];(y===void 0||S===void 0)&&C(m,this.length-8);const F=this[m+4]+this[m+5]*2**8+this[m+6]*2**16+(S<<24);return(BigInt(F)<<BigInt(32))+BigInt(y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24)}),l.prototype.readBigInt64BE=Mt(function(m){m=m>>>0,Q(m,"offset");const y=this[m],S=this[m+7];(y===void 0||S===void 0)&&C(m,this.length-8);const F=(y<<24)+this[++m]*2**16+this[++m]*2**8+this[++m];return(BigInt(F)<<BigInt(32))+BigInt(this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+S)}),l.prototype.readFloatLE=function(m,y){return m=m>>>0,y||st(m,4,this.length),n.read(this,m,!0,23,4)},l.prototype.readFloatBE=function(m,y){return m=m>>>0,y||st(m,4,this.length),n.read(this,m,!1,23,4)},l.prototype.readDoubleLE=function(m,y){return m=m>>>0,y||st(m,8,this.length),n.read(this,m,!0,52,8)},l.prototype.readDoubleBE=function(m,y){return m=m>>>0,y||st(m,8,this.length),n.read(this,m,!1,52,8)};function at(k,m,y,S,F,Z){if(!l.isBuffer(k))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>F||m<Z)throw new RangeError('"value" argument is out of bounds');if(y+S>k.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(m,y,S,F){if(m=+m,y=y>>>0,S=S>>>0,!F){const Pt=Math.pow(2,8*S)-1;at(this,m,y,S,Pt,0)}let Z=1,nt=0;for(this[y]=m&255;++nt<S&&(Z*=256);)this[y+nt]=m/Z&255;return y+S},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(m,y,S,F){if(m=+m,y=y>>>0,S=S>>>0,!F){const Pt=Math.pow(2,8*S)-1;at(this,m,y,S,Pt,0)}let Z=S-1,nt=1;for(this[y+Z]=m&255;--Z>=0&&(nt*=256);)this[y+Z]=m/nt&255;return y+S},l.prototype.writeUint8=l.prototype.writeUInt8=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,1,255,0),this[y]=m&255,y+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,2,65535,0),this[y]=m&255,this[y+1]=m>>>8,y+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,2,65535,0),this[y]=m>>>8,this[y+1]=m&255,y+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,4,4294967295,0),this[y+3]=m>>>24,this[y+2]=m>>>16,this[y+1]=m>>>8,this[y]=m&255,y+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,4,4294967295,0),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4};function Ct(k,m,y,S,F){rt(m,S,F,k,y,7);let Z=Number(m&BigInt(4294967295));k[y++]=Z,Z=Z>>8,k[y++]=Z,Z=Z>>8,k[y++]=Z,Z=Z>>8,k[y++]=Z;let nt=Number(m>>BigInt(32)&BigInt(4294967295));return k[y++]=nt,nt=nt>>8,k[y++]=nt,nt=nt>>8,k[y++]=nt,nt=nt>>8,k[y++]=nt,y}function Jt(k,m,y,S,F){rt(m,S,F,k,y,7);let Z=Number(m&BigInt(4294967295));k[y+7]=Z,Z=Z>>8,k[y+6]=Z,Z=Z>>8,k[y+5]=Z,Z=Z>>8,k[y+4]=Z;let nt=Number(m>>BigInt(32)&BigInt(4294967295));return k[y+3]=nt,nt=nt>>8,k[y+2]=nt,nt=nt>>8,k[y+1]=nt,nt=nt>>8,k[y]=nt,y+8}l.prototype.writeBigUInt64LE=Mt(function(m,y=0){return Ct(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Mt(function(m,y=0){return Jt(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(m,y,S,F){if(m=+m,y=y>>>0,!F){const ye=Math.pow(2,8*S-1);at(this,m,y,S,ye-1,-ye)}let Z=0,nt=1,Pt=0;for(this[y]=m&255;++Z<S&&(nt*=256);)m<0&&Pt===0&&this[y+Z-1]!==0&&(Pt=1),this[y+Z]=(m/nt>>0)-Pt&255;return y+S},l.prototype.writeIntBE=function(m,y,S,F){if(m=+m,y=y>>>0,!F){const ye=Math.pow(2,8*S-1);at(this,m,y,S,ye-1,-ye)}let Z=S-1,nt=1,Pt=0;for(this[y+Z]=m&255;--Z>=0&&(nt*=256);)m<0&&Pt===0&&this[y+Z+1]!==0&&(Pt=1),this[y+Z]=(m/nt>>0)-Pt&255;return y+S},l.prototype.writeInt8=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,1,127,-128),m<0&&(m=255+m+1),this[y]=m&255,y+1},l.prototype.writeInt16LE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,2,32767,-32768),this[y]=m&255,this[y+1]=m>>>8,y+2},l.prototype.writeInt16BE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,2,32767,-32768),this[y]=m>>>8,this[y+1]=m&255,y+2},l.prototype.writeInt32LE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,4,2147483647,-2147483648),this[y]=m&255,this[y+1]=m>>>8,this[y+2]=m>>>16,this[y+3]=m>>>24,y+4},l.prototype.writeInt32BE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4},l.prototype.writeBigInt64LE=Mt(function(m,y=0){return Ct(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Mt(function(m,y=0){return Jt(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Nt(k,m,y,S,F,Z){if(y+S>k.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function It(k,m,y,S,F){return m=+m,y=y>>>0,F||Nt(k,m,y,4),n.write(k,m,y,S,23,4),y+4}l.prototype.writeFloatLE=function(m,y,S){return It(this,m,y,!0,S)},l.prototype.writeFloatBE=function(m,y,S){return It(this,m,y,!1,S)};function re(k,m,y,S,F){return m=+m,y=y>>>0,F||Nt(k,m,y,8),n.write(k,m,y,S,52,8),y+8}l.prototype.writeDoubleLE=function(m,y,S){return re(this,m,y,!0,S)},l.prototype.writeDoubleBE=function(m,y,S){return re(this,m,y,!1,S)},l.prototype.copy=function(m,y,S,F){if(!l.isBuffer(m))throw new TypeError("argument should be a Buffer");if(S||(S=0),!F&&F!==0&&(F=this.length),y>=m.length&&(y=m.length),y||(y=0),F>0&&F<S&&(F=S),F===S||m.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(S<0||S>=this.length)throw new RangeError("Index out of range");if(F<0)throw new RangeError("sourceEnd out of bounds");F>this.length&&(F=this.length),m.length-y<F-S&&(F=m.length-y+S);const Z=F-S;return this===m&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,S,F):s.prototype.set.call(m,this.subarray(S,F),y),Z},l.prototype.fill=function(m,y,S,F){if(typeof m=="string"){if(typeof y=="string"?(F=y,y=0,S=this.length):typeof S=="string"&&(F=S,S=this.length),F!==void 0&&typeof F!="string")throw new TypeError("encoding must be a string");if(typeof F=="string"&&!l.isEncoding(F))throw new TypeError("Unknown encoding: "+F);if(m.length===1){const nt=m.charCodeAt(0);(F==="utf8"&&nt<128||F==="latin1")&&(m=nt)}}else typeof m=="number"?m=m&255:typeof m=="boolean"&&(m=Number(m));if(y<0||this.length<y||this.length<S)throw new RangeError("Out of range index");if(S<=y)return this;y=y>>>0,S=S===void 0?this.length:S>>>0,m||(m=0);let Z;if(typeof m=="number")for(Z=y;Z<S;++Z)this[Z]=m;else{const nt=l.isBuffer(m)?m:l.from(m,F),Pt=nt.length;if(Pt===0)throw new TypeError('The value "'+m+'" is invalid for argument "value"');for(Z=0;Z<S-y;++Z)this[Z+y]=nt[Z%Pt]}return this};const $t={};function ge(k,m,y){$t[k]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:m.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${k}]`,this.stack,delete this.name}get code(){return k}set code(F){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:F,writable:!0})}toString(){return`${this.name} [${k}]: ${this.message}`}}}ge("ERR_BUFFER_OUT_OF_BOUNDS",function(k){return k?`${k} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ge("ERR_INVALID_ARG_TYPE",function(k,m){return`The "${k}" argument must be of type number. Received type ${typeof m}`},TypeError),ge("ERR_OUT_OF_RANGE",function(k,m,y){let S=`The value of "${k}" is out of range.`,F=y;return Number.isInteger(y)&&Math.abs(y)>2**32?F=Se(String(y)):typeof y=="bigint"&&(F=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(F=Se(F)),F+="n"),S+=` It must be ${m}. Received ${F}`,S},RangeError);function Se(k){let m="",y=k.length;const S=k[0]==="-"?1:0;for(;y>=S+4;y-=3)m=`_${k.slice(y-3,y)}${m}`;return`${k.slice(0,y)}${m}`}function b(k,m,y){Q(m,"offset"),(k[m]===void 0||k[m+y]===void 0)&&C(m,k.length-(y+1))}function rt(k,m,y,S,F,Z){if(k>y||k<m){const nt=typeof m=="bigint"?"n":"";let Pt;throw m===0||m===BigInt(0)?Pt=`>= 0${nt} and < 2${nt} ** ${(Z+1)*8}${nt}`:Pt=`>= -(2${nt} ** ${(Z+1)*8-1}${nt}) and < 2 ** ${(Z+1)*8-1}${nt}`,new $t.ERR_OUT_OF_RANGE("value",Pt,k)}b(S,F,Z)}function Q(k,m){if(typeof k!="number")throw new $t.ERR_INVALID_ARG_TYPE(m,"number",k)}function C(k,m,y){throw Math.floor(k)!==k?(Q(k,y),new $t.ERR_OUT_OF_RANGE("offset","an integer",k)):m<0?new $t.ERR_BUFFER_OUT_OF_BOUNDS:new $t.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${m}`,k)}const I=/[^+/0-9A-Za-z-_]/g;function W(k){if(k=k.split("=")[0],k=k.trim().replace(I,""),k.length<2)return"";for(;k.length%4!==0;)k=k+"=";return k}function ot(k,m){m=m||1/0;let y;const S=k.length;let F=null;const Z=[];for(let nt=0;nt<S;++nt){if(y=k.charCodeAt(nt),y>55295&&y<57344){if(!F){if(y>56319){(m-=3)>-1&&Z.push(239,191,189);continue}else if(nt+1===S){(m-=3)>-1&&Z.push(239,191,189);continue}F=y;continue}if(y<56320){(m-=3)>-1&&Z.push(239,191,189),F=y;continue}y=(F-55296<<10|y-56320)+65536}else F&&(m-=3)>-1&&Z.push(239,191,189);if(F=null,y<128){if((m-=1)<0)break;Z.push(y)}else if(y<2048){if((m-=2)<0)break;Z.push(y>>6|192,y&63|128)}else if(y<65536){if((m-=3)<0)break;Z.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((m-=4)<0)break;Z.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Z}function ut(k){const m=[];for(let y=0;y<k.length;++y)m.push(k.charCodeAt(y)&255);return m}function q(k,m){let y,S,F;const Z=[];for(let nt=0;nt<k.length&&!((m-=2)<0);++nt)y=k.charCodeAt(nt),S=y>>8,F=y%256,Z.push(F),Z.push(S);return Z}function pt(k){return t.toByteArray(W(k))}function _t(k,m,y,S){let F;for(F=0;F<S&&!(F+y>=m.length||F>=k.length);++F)m[F+y]=k[F];return F}function ft(k,m){return k instanceof m||k!=null&&k.constructor!=null&&k.constructor.name!=null&&k.constructor.name===m.name}function vt(k){return k!==k}const ae=function(){const k="0123456789abcdef",m=new Array(256);for(let y=0;y<16;++y){const S=y*16;for(let F=0;F<16;++F)m[S+F]=k[y]+k[F]}return m}();function Mt(k){return typeof BigInt>"u"?xn:k}function xn(){throw new Error("BigInt not supported")}})(lp);const Je=lp.Buffer;function xE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var hp={exports:{}},Re=hp.exports={},yr,_r;function Eu(){throw new Error("setTimeout has not been defined")}function Tu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?yr=setTimeout:yr=Eu}catch{yr=Eu}try{typeof clearTimeout=="function"?_r=clearTimeout:_r=Tu}catch{_r=Tu}})();function fp(e){if(yr===setTimeout)return setTimeout(e,0);if((yr===Eu||!yr)&&setTimeout)return yr=setTimeout,setTimeout(e,0);try{return yr(e,0)}catch{try{return yr.call(null,e,0)}catch{return yr.call(this,e,0)}}}function SE(e){if(_r===clearTimeout)return clearTimeout(e);if((_r===Tu||!_r)&&clearTimeout)return _r=clearTimeout,clearTimeout(e);try{return _r(e)}catch{try{return _r.call(null,e)}catch{return _r.call(this,e)}}}var zr=[],Ts=!1,Ki,Na=-1;function RE(){!Ts||!Ki||(Ts=!1,Ki.length?zr=Ki.concat(zr):Na=-1,zr.length&&dp())}function dp(){if(!Ts){var e=fp(RE);Ts=!0;for(var t=zr.length;t;){for(Ki=zr,zr=[];++Na<t;)Ki&&Ki[Na].run();Na=-1,t=zr.length}Ki=null,Ts=!1,SE(e)}}Re.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];zr.push(new pp(e,t)),zr.length===1&&!Ts&&fp(dp)};function pp(e,t){this.fun=e,this.array=t}pp.prototype.run=function(){this.fun.apply(null,this.array)},Re.title="browser",Re.browser=!0,Re.env={},Re.argv=[],Re.version="",Re.versions={};function Kr(){}Re.on=Kr,Re.addListener=Kr,Re.once=Kr,Re.off=Kr,Re.removeListener=Kr,Re.removeAllListeners=Kr,Re.emit=Kr,Re.prependListener=Kr,Re.prependOnceListener=Kr,Re.listeners=function(e){return[]},Re.binding=function(e){throw new Error("process.binding is not supported")},Re.cwd=function(){return"/"},Re.chdir=function(e){throw new Error("process.chdir is not supported")},Re.umask=function(){return 0};var IE=hp.exports;const Wr=xE(IE),mp=e=>e===void 0?null:e;class OE{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let gp=new OE,NE=!0;try{typeof localStorage<"u"&&localStorage&&(gp=localStorage,NE=!1)}catch{}const CE=gp,LE=Object.assign,ME=Object.keys,UE=(e,t)=>{for(const n in e)t(e[n],n)},yp=e=>ME(e).length,PE=e=>{for(const t in e)return!1;return!0},BE=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},FE=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),DE=(e,t)=>e===t||yp(e)===yp(t)&&BE(e,(n,r)=>(n!==void 0||FE(t,r))&&t[r]===n),$E=Object.freeze,_p=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&_p(e[t])}return $E(e)},vu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&vu(e,t,n+1)}},jE=e=>e,zE=(e,t)=>t.includes(e);var bp={};const po=typeof Wr<"u"&&Wr.release&&/node|io\.js/.test(Wr.release.name)&&Object.prototype.toString.call(typeof Wr<"u"?Wr:0)==="[object process]";let br;const KE=()=>{if(br===void 0)if(po){br=Zn();const e=Wr.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&br.set(t,""),t=r):t!==null&&(br.set(t,r),t=null)}t!==null&&br.set(t,"")}else typeof location=="object"?(br=Zn(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");br.set(`--${Qd(t,"-")}`,n),br.set(`-${Qd(t,"-")}`,n)}})):br=Zn();return br},ku=e=>KE().has(e),Ca=e=>mp(po?bp[e.toUpperCase().replaceAll("-","_")]:CE.getItem(e)),wp=e=>ku("--"+e)||Ca(e)!==null;wp("production");const WE=po&&zE(bp.FORCE_COLOR,["true","1","2"])||!ku("--no-colors")&&!wp("no-color")&&(!po||Wr.stdout.isTTY)&&(!po||ku("--color")||Ca("COLORTERM")!==null||(Ca("TERM")||"").includes("color")),GE=e=>new Uint8Array(e),HE=e=>{const t=GE(e.byteLength);return t.set(e),t};class YE{constructor(t,n){this.left=t,this.right=n}}const Gr=(e,t)=>new YE(e,t);typeof DOMParser<"u"&&new DOMParser;const VE=e=>zw(e,(t,n)=>`${n}:${t};`).join(""),Hr=Symbol,Ep=Hr(),Tp=Hr(),qE=Hr(),JE=Hr(),XE=Hr(),vp=Hr(),ZE=Hr(),Au=Hr(),QE=Hr(),tT=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},eT={[Ep]:Gr("font-weight","bold"),[Tp]:Gr("font-weight","normal"),[qE]:Gr("color","blue"),[XE]:Gr("color","green"),[JE]:Gr("color","grey"),[vp]:Gr("color","red"),[ZE]:Gr("color","purple"),[Au]:Gr("color","orange"),[QE]:Gr("color","black")},kp=WE?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Zn();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=eT[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=VE(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:tT,nT=(...e)=>{console.log(...kp(e)),Ap.forEach(t=>t.print(e))},rT=(...e)=>{console.warn(...kp(e)),e.unshift(Au),Ap.forEach(t=>t.print(e))},Ap=ys(),xp=e=>({[Symbol.iterator](){return this},next:e}),iT=(e,t)=>xp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),xu=(e,t)=>xp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Su{constructor(t,n){this.clock=t,this.len=n}}class mo{constructor(){this.clients=new Map}}const Sp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Gp(e,s,a.clock,a.len,n)}}),sT=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=gi((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},Rp=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&sT(n,t.clock)!==null},Ru=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=$i(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},oT=e=>{const t=new mo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)Ww(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Ru(t),t},La=(e,t,n,r)=>{pi(e.clients,t,()=>[]).push(new Su(n,r))},aT=()=>new mo,cT=e=>{const t=aT();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new Su(a,c))}}i.length>0&&t.clients.set(r,i)}),t},vs=(e,t)=>{Bt(e.restEncoder,t.clients.size),mi(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),Bt(e.restEncoder,n);const i=r.length;Bt(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Iu=e=>{const t=new mo,n=Ft(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Ft(e.restDecoder),s=Ft(e.restDecoder);if(s>0){const o=pi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Su(e.readDsClock(),e.readDsLen()))}}return t},Ip=(e,t,n)=>{const r=new mo,i=Ft(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Ft(e.restDecoder),a=Ft(e.restDecoder),c=n.clients.get(o)||[],u=He(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<u){u<f&&La(r,o,u,f-u);let d=tr(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,Ha(t,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,Ha(t,p,f-p.id.clock)),p.delete(t))}else La(r,o,h,f-h)}}if(r.clients.size>0){const s=new Wi;return Bt(s.restEncoder,0),vs(s,r),s.toUint8Array()}return null},Op=ap;class Yr extends Hw{constructor({guid:t=yE(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Op(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new zp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=cp(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>cp(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&ce(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(mi(this.subdocs).map(t=>t.guid))}transact(t,n=null){return ce(this,t,n)}get(t,n=ke){const r=pi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==ke&&i!==n)if(i===ke){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,wr)}getText(t=""){return this.get(t,er)}getMap(t=""){return this.get(t,Er)}getXmlElement(t=""){return this.get(t,Vr)}getXmlFragment(t=""){return this.get(t,Tr)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,mi(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Yr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,ce(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Np{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Ft(this.restDecoder)}readDsLen(){return Ft(this.restDecoder)}}class Cp extends Np{readLeftID(){return Gt(Ft(this.restDecoder),Ft(this.restDecoder))}readRightID(){return Gt(Ft(this.restDecoder),Ft(this.restDecoder))}readClient(){return Ft(this.restDecoder)}readInfo(){return bs(this.restDecoder)}readString(){return ws(this.restDecoder)}readParentInfo(){return Ft(this.restDecoder)===1}readTypeRef(){return Ft(this.restDecoder)}readLen(){return Ft(this.restDecoder)}readAny(){return fo(this.restDecoder)}readBuf(){return HE(nn(this.restDecoder))}readJSON(){return JSON.parse(ws(this.restDecoder))}readKey(){return ws(this.restDecoder)}}class lT{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ft(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Ft(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class ks extends lT{constructor(t){super(t),this.keys=[],Ft(t),this.keyClockDecoder=new _u(nn(t)),this.clientDecoder=new Ia(nn(t)),this.leftClockDecoder=new _u(nn(t)),this.rightClockDecoder=new _u(nn(t)),this.infoDecoder=new op(nn(t),bs),this.stringDecoder=new pE(nn(t)),this.parentInfoDecoder=new op(nn(t),bs),this.typeRefDecoder=new Ia(nn(t)),this.lenDecoder=new Ia(nn(t))}readLeftID(){return new As(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new As(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return fo(this.restDecoder)}readBuf(){return nn(this.restDecoder)}readJSON(){return fo(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Lp{constructor(){this.restEncoder=yi()}toUint8Array(){return Qn(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){Bt(this.restEncoder,t)}writeDsLen(t){Bt(this.restEncoder,t)}}class go extends Lp{writeLeftID(t){Bt(this.restEncoder,t.client),Bt(this.restEncoder,t.clock)}writeRightID(t){Bt(this.restEncoder,t.client),Bt(this.restEncoder,t.clock)}writeClient(t){Bt(this.restEncoder,t)}writeInfo(t){hu(this.restEncoder,t)}writeString(t){_s(this.restEncoder,t)}writeParentInfo(t){Bt(this.restEncoder,t?1:0)}writeTypeRef(t){Bt(this.restEncoder,t)}writeLen(t){Bt(this.restEncoder,t)}writeAny(t){ho(this.restEncoder,t)}writeBuf(t){Qe(this.restEncoder,t)}writeJSON(t){_s(this.restEncoder,JSON.stringify(t))}writeKey(t){_s(this.restEncoder,t)}}class Mp{constructor(){this.restEncoder=yi(),this.dsCurrVal=0}toUint8Array(){return Qn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,Bt(this.restEncoder,n)}writeDsLen(t){t===0&&mr(),Bt(this.restEncoder,t-1),this.dsCurrVal+=t}}class Wi extends Mp{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new mu,this.clientEncoder=new Sa,this.leftClockEncoder=new mu,this.rightClockEncoder=new mu,this.infoEncoder=new ep(hu),this.stringEncoder=new uE,this.parentInfoEncoder=new ep(hu),this.typeRefEncoder=new Sa,this.lenEncoder=new Sa}toUint8Array(){const t=yi();return Bt(t,0),Qe(t,this.keyClockEncoder.toUint8Array()),Qe(t,this.clientEncoder.toUint8Array()),Qe(t,this.leftClockEncoder.toUint8Array()),Qe(t,this.rightClockEncoder.toUint8Array()),Qe(t,Qn(this.infoEncoder)),Qe(t,this.stringEncoder.toUint8Array()),Qe(t,Qn(this.parentInfoEncoder)),Qe(t,this.typeRefEncoder.toUint8Array()),Qe(t,this.lenEncoder.toUint8Array()),xa(t,Qn(this.restEncoder)),Qn(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){ho(this.restEncoder,t)}writeBuf(t){Qe(this.restEncoder,t)}writeJSON(t){ho(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const uT=(e,t,n,r)=>{r=$i(r,t[0].id.clock);const i=tr(t,r);Bt(e.restEncoder,t.length-i),e.writeClient(n),Bt(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Ou=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{He(t,s)>i&&r.set(s,i)}),Ua(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Bt(e.restEncoder,r.size),mi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{uT(e,t.clients.get(i),i,s)})},hT=(e,t)=>{const n=Zn(),r=Ft(e.restDecoder);for(let i=0;i<r;i++){const s=Ft(e.restDecoder),o=new Array(s),a=e.readClient();let c=Ft(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Aa&l){case 0:{const h=e.readLen();o[u]=new In(Gt(a,c),h),c+=h;break}case 10:{const h=Ft(e.restDecoder);o[u]=new $n(Gt(a,c),h),c+=h;break}default:{const h=(l&(jr|Rn))===0,f=new Fe(Gt(a,c),null,(l&Rn)===Rn?e.readLeftID():null,null,(l&jr)===jr?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&ao)===ao?e.readString():null,g0(e,l));o[u]=f,c+=f.length}}}}return n},fT=(e,t,n)=>{const r=[];let i=mi(n.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=n.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=n.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new zp,c=new Map,u=(d,p)=>{const g=c.get(d);(g==null||g>p)&&c.set(d,p)};let l=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,g=n.get(p);g?(g.i--,a.clients.set(p,g.refs.slice(g.i)),n.delete(p),g.i=0,g.refs=[]):a.clients.set(p,[d]),i=i.filter(E=>E!==p)}r.length=0};for(;;){if(l.constructor!==$n){const p=pi(h,l.id.client,()=>He(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{const g=l.getMissing(e,t);if(g!==null){r.push(l);const E=n.get(g)||{refs:[],i:0};if(E.refs.length===E.i)u(g,He(t,g)),f();else{l=E.refs[E.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const d=new Wi;return Ou(d,a,new Map),Bt(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},dT=(e,t)=>Ou(e,t.doc.store,t.beforeState),pT=(e,t,n,r=new ks(e))=>ce(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=hT(r,o),u=fT(i,a,c),l=a.pendingStructs;if(l){for(const[f,d]of l.missing)if(d<He(a,f)){s=!0;break}if(u){for(const[f,d]of u.missing){const p=l.missing.get(f);(p==null||p>d)&&l.missing.set(f,d)}l.update=Ba([l.update,u.update])}}else a.pendingStructs=u;const h=Ip(r,i,a);if(a.pendingDs){const f=new ks(zi(a.pendingDs));Ft(f.restDecoder);const d=Ip(f,i,a);h&&d?a.pendingDs=Ba([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,Up(i.doc,f)}},n,!1),Up=(e,t,n,r=ks)=>{const i=zi(t);pT(i,e,n,new r(i))},mT=(e,t,n)=>Up(e,t,n,Cp),gT=(e,t,n=new Map)=>{Ou(e,t.store,n),vs(e,cT(t.store))},yT=(e,t=new Uint8Array([0]),n=new Wi)=>{const r=Pp(t);gT(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(CT(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===go)return OT(i.map((s,o)=>o===0?s:MT(s)));if(n.constructor===Wi)return Ba(i)}return i[0]},_T=(e,t)=>yT(e,t,new go),bT=e=>{const t=new Map,n=Ft(e.restDecoder);for(let r=0;r<n;r++){const i=Ft(e.restDecoder),s=Ft(e.restDecoder);t.set(i,s)}return t},Pp=e=>bT(new Np(zi(e))),Bp=(e,t)=>(Bt(e.restEncoder,t.size),mi(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Bt(e.restEncoder,n),Bt(e.restEncoder,r)}),e),wT=(e,t)=>Bp(e,Ua(t.store)),ET=(e,t=new Mp)=>(e instanceof Map?Bp(t,e):wT(t,e),t.toUint8Array()),TT=e=>ET(e,new Lp);class vT{constructor(){this.l=[]}}const Fp=()=>new vT,Dp=(e,t)=>e.l.push(t),$p=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},jp=(e,t,n)=>vu(e.l,[t,n]);class As{constructor(t,n){this.client=t,this.clock=n}}const Ma=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Gt=(e,t)=>new As(e,t),kT=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw mr()},xs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Rp(t.ds,e.id),Nu=(e,t)=>{const n=pi(e.meta,Nu,ys),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<He(r,s)&&bi(e,Gt(s,i))}),Sp(e,t.ds,i=>{}),n.add(t))};class zp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ua=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},He=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Kp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw mr()}n.push(t)},tr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=gi(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=gi((n+r)/2)}throw mr()},Cu=(e,t)=>{const n=e.clients.get(t.client);return n[tr(n,t.clock)]},Lu=(e,t,n)=>{const r=tr(t,n),i=t[r];return i.id.clock<n&&i instanceof Fe?(t.splice(r+1,0,Ha(e,i,n-i.id.clock)),r+1):r},bi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Lu(e,n,t.clock)]},Wp=(e,t,n)=>{const r=t.clients.get(n.client),i=tr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==In&&r.splice(i+1,0,Ha(e,s,n.clock-s.id.clock+1)),s},AT=(e,t,n)=>{const r=e.clients.get(t.id.client);r[tr(r,t.id.clock)]=n},Gp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Lu(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Lu(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class xT{constructor(t,n,r){this.doc=t,this.deleteSet=new mo,this.beforeState=Ua(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Hp=(e,t)=>t.deleteSet.clients.size===0&&!Kw(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Ru(t.deleteSet),dT(e,t),vs(e,t.deleteSet),!0),Yp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&pi(e.changed,t,ys).add(n)},Pa=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Fe&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},ST=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=tr(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof Fe&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},RT=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Vd(i.length-1,1+tr(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Pa(i,c)}})},Vp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Ru(s),n.afterState=Ua(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),jp(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),vu(a,[]),n._needFormattingCleanup&&VT(n)}finally{r.gc&&ST(s,i,r.gcFilter),RT(s,i),n.afterState.forEach((l,h)=>{const f=n.beforeState.get(h)||0;if(f!==l){const d=i.clients.get(h),p=$i(tr(d,f),1);for(let g=d.length-1;g>=p;)g-=1+Pa(d,g)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:f}=o[l].id,d=i.clients.get(h),p=tr(d,f);p+1<d.length&&Pa(d,p+1)>1||p>0&&Pa(d,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(nT(Au,Ep,"[yjs] ",Tp,vp,"Changed the client-id because another client seems to be using it."),r.clientID=Op()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new go;Hp(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new Wi;Hp(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Vp(e,t+1)}}},ce=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new xT(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Vp(i,0)}}return o};function*IT(e){const t=Ft(e.restDecoder);for(let n=0;n<t;n++){const r=Ft(e.restDecoder),i=e.readClient();let s=Ft(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Ft(e.restDecoder);yield new $n(Gt(i,s),c),s+=c}else if(Aa&a){const c=(a&(jr|Rn))===0,u=new Fe(Gt(i,s),null,(a&Rn)===Rn?e.readLeftID():null,null,(a&jr)===jr?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&ao)===ao?e.readString():null,g0(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new In(Gt(i,s),c),s+=c}}}}class Mu{constructor(t,n){this.gen=IT(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===$n);return this.curr}}class Uu{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const OT=e=>Ba(e,Cp,go),NT=(e,t)=>{if(e.constructor===In){const{client:n,clock:r}=e.id;return new In(Gt(n,r+t),e.length-t)}else if(e.constructor===$n){const{client:n,clock:r}=e.id;return new $n(Gt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Fe(Gt(r,i+t),null,Gt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Ba=(e,t=ks,n=Wi)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(zi(l)));let i=r.map(l=>new Mu(l,!0)),s=null;const o=new n,a=new Uu(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===$n?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)wi(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===$n)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{wi(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new $n(Gt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===$n?s.struct.length-=p:f=NT(f,p)),s.struct.mergeWith(f)||(wi(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==$n;f=l.next())wi(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(wi(a,s.struct,s.offset),s=null),Pu(a);const c=r.map(l=>Iu(l)),u=oT(c);return vs(o,u),o.toUint8Array()},CT=(e,t,n=ks,r=Wi)=>{const i=Pp(t),s=new r,o=new Uu(s),a=new n(zi(e)),c=new Mu(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===$n){c.next();continue}if(l.id.clock+l.length>f)for(wi(o,l,$i(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)wi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}Pu(o);const u=Iu(a);return vs(s,u),s.toUint8Array()},qp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Qn(e.encoder.restEncoder)}),e.encoder.restEncoder=yi(),e.written=0)},wi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&qp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),Bt(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Pu=e=>{qp(e);const t=e.encoder.restEncoder;Bt(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];Bt(t,r.written),xa(t,r.restEncoder)}},LT=(e,t,n,r)=>{const i=new n(zi(e)),s=new Mu(i,!1),o=new r,a=new Uu(o);for(let u=s.curr;u!==null;u=s.next())wi(a,t(u),0);Pu(a);const c=Iu(i);return vs(o,c),o.toUint8Array()},MT=e=>LT(e,jE,ks,go),Jp="You must not compute changes after the event-handler fired.";class Fa{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=UT(this.currentTarget,this.target))}deletes(t){return Rp(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw _i(Jp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=au(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=au(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=au(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw _i(Jp);const n=this.target,r=ys(),i=ys(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const UT=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},tn=()=>{rT("Invalid access: Add Yjs type to a document before reading data.")},Xp=80;let Bu=0;class PT{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Bu++}}const BT=e=>{e.timestamp=Bu++},Zp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Bu++},FT=(e,t,n)=>{if(e.length>=Xp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Zp(r,t,n),r}else{const r=new PT(t,n);return e.push(r),r}},Da=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>ka(t-s.index)<ka(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,BT(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ka(n.index-i)<r.parent.length/Xp?(Zp(n,r,i),n):FT(e._searchMarker,r,i)},yo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=$i(t,i.index+n))}},$a=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;pi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;jp(r._eH,n,t)};class ke{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Fp(),this._dEH=Fp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw pr()}clone(){throw pr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Dp(this._eH,t)}observeDeep(t){Dp(this._dEH,t)}unobserve(t){$p(this._eH,t)}unobserveDeep(t){$p(this._dEH,t)}toJSON(){}}const Qp=(e,t,n)=>{e.doc??tn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},t0=e=>{e.doc??tn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},_o=(e,t)=>{let n=0,r=e._start;for(e.doc??tn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},e0=(e,t)=>{const n=[];return _o(e,(r,i)=>{n.push(t(r,i,e))}),n},DT=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},n0=(e,t)=>{e.doc??tn();const n=Da(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},ja=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new Fe(Gt(o,He(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Yi(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new Fe(Gt(o,He(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new bo(new Uint8Array(h))),i.integrate(e,0);break;case Yr:i=new Fe(Gt(o,He(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Eo(h)),i.integrate(e,0);break;default:if(h instanceof ke)i=new Fe(Gt(o,He(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new qr(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},r0=()=>_i("Length exceeded!"),i0=(e,t,n,r)=>{if(n>t._length)throw r0();if(n===0)return t._searchMarker&&yo(t._searchMarker,n,r.length),ja(e,t,null,r);const i=n,s=Da(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&bi(e,Gt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&yo(t._searchMarker,i,r.length),ja(e,t,o,r)},$T=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return ja(e,t,i,n)},s0=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=Da(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&bi(e,Gt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&bi(e,Gt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw r0();t._searchMarker&&yo(t._searchMarker,i,-s+r)},za=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Fu=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new Yi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Yi([r]);break;case Uint8Array:a=new bo(r);break;case Yr:a=new Eo(r);break;default:if(r instanceof ke)a=new qr(r);else throw new Error("Unexpected content type")}new Fe(Gt(o,He(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Du=(e,t)=>{e.doc??tn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},o0=e=>{const t={};return e.doc??tn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},a0=(e,t)=>{e.doc??tn();const n=e._map.get(t);return n!==void 0&&!n.deleted},jT=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&xs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},Ka=e=>(e.doc??tn(),iT(e._map.entries(),t=>!t[1].deleted));class zT extends Fa{}class wr extends ke{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new wr;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new wr}clone(){const t=new wr;return t.insert(0,this.toArray().map(n=>n instanceof ke?n.clone():n)),t}get length(){return this.doc??tn(),this._length}_callObserver(t,n){super._callObserver(t,n),$a(this,t,new zT(this,t))}insert(t,n){this.doc!==null?ce(this.doc,r=>{i0(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?ce(this.doc,n=>{$T(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?ce(this.doc,r=>{s0(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return n0(this,t)}toArray(){return t0(this)}slice(t=0,n=this.length){return Qp(this,t,n)}toJSON(){return this.map(t=>t instanceof ke?t.toJSON():t)}map(t){return e0(this,t)}forEach(t){_o(this,t)}[Symbol.iterator](){return DT(this)}_write(t){t.writeTypeRef(dv)}}const KT=e=>new wr;class WT extends Fa{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Er extends ke{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Er}clone(){const t=new Er;return this.forEach((n,r)=>{t.set(r,n instanceof ke?n.clone():n)}),t}_callObserver(t,n){$a(this,t,new WT(this,t,n))}toJSON(){this.doc??tn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof ke?i.toJSON():i}}),t}get size(){return[...Ka(this)].length}keys(){return xu(Ka(this),t=>t[0])}values(){return xu(Ka(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return xu(Ka(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??tn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ce(this.doc,n=>{za(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?ce(this.doc,r=>{Fu(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Du(this,t)}has(t){return a0(this,t)}clear(){this.doc!==null?ce(this.doc,t=>{this.forEach(function(n,r,i){za(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(pv)}}const GT=e=>new Er,Ei=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&DE(e,t);class $u{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&mr(),this.right.content.constructor){case Be:this.right.deleted||Ss(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const c0=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Be:t.right.deleted||Ss(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&bi(e,Gt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Wa=(e,t,n,r)=>{const i=new Map,s=r?Da(t,n):null;if(s){const o=new $u(s.p.left,s.p,s.index,i);return c0(e,o,n-s.index)}else{const o=new $u(null,t._start,0,i);return c0(e,o,n)}},l0=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Be&&Ei(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new Fe(Gt(s,He(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new Be(a,o));l.integrate(e,0),n.right=l,n.forward()})},Ss=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},u0=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Be&&Ei(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},h0=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!Ei(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new Fe(Gt(s,He(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new Be(a,c)),n.right.integrate(e,0),n.forward()}}return o},ju=(e,t,n,r,i)=>{n.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=e.doc,o=s.clientID;u0(n,i);const a=h0(e,t,n,i),c=r.constructor===String?new vr(r):r instanceof ke?new qr(r):new Hi(r);let{left:u,right:l,index:h}=n;t._searchMarker&&yo(t._searchMarker,n.index,c.getLength()),l=new Fe(Gt(o,He(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),l0(e,t,n,a)},f0=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;u0(n,i);const a=h0(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Be));){if(!n.right.deleted)switch(n.right.content.constructor){case Be:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(Ei(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&bi(e,Gt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Fe(Gt(o,He(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new vr(c)),n.right.integrate(e,0),n.forward()}l0(e,t,n,a)},d0=(e,t,n,r,i)=>{let s=t;const o=Zn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Be){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case Be:{const{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!t.deleted&&Ss(i,u);break}}}t=t.right}return a},HT=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Be){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},YT=e=>{let t=0;return ce(e.doc,n=>{let r=e._start,i=e._start,s=Zn();const o=ou(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Be:Ss(o,i.content);break;default:t+=d0(n,r,i,s,o),s=ou(o),r=i;break}i=i.right}}),t},VT=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Gp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Be&&o.constructor!==In&&t.add(o.parent)})}ce(n,r=>{Sp(e,e.deleteSet,i=>{if(i instanceof In||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Be?t.add(s):HT(r,i)});for(const i of t)YT(i)})},p0=(e,t,n)=>{const r=n,i=ou(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case qr:case Hi:case vr:n<t.right.length&&bi(e,Gt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&d0(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&yo(o._searchMarker,t.index,-r+n),t};class qT extends Fa{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];ce(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((p,g)=>{p!==null&&(d.attributes[g]=p)}))),u="";break;case"retain":l>0&&(d={retain:l},PE(c)||(d.attributes=LE({},c))),l=0;break}d&&n.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case qr:case Hi:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case vr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case Be:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=i.get(d)??null;Ei(g,p)?p!==null&&o.delete(r):(a==="retain"&&f(),Ei(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const g=i.get(d)??null;Ei(g,p)||(a==="retain"&&f(),c[d]=g)}else if(!o.deleted){s.set(d,p);const g=c[d];g!==void 0&&(Ei(g,p)?g!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),Ss(i,o.content));break}}o=o.right}for(f();n.length>0;){const d=n[n.length-1];if(d.retain!==void 0&&d.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class er extends ke{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??tn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new er}clone(){const t=new er;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new qT(this,t,n);$a(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??tn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===vr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?ce(this.doc,r=>{const i=new $u(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ju(r,this,i,a,o.attributes||{})}else o.retain!==void 0?f0(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&p0(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??tn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let f=!1;s.forEach((p,g)=>{f=!0,h[g]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const l=()=>{for(;c!==null;){if(xs(c,t)||n!==void 0&&xs(c,n))switch(c.content.constructor){case vr:{const h=s.get("ychange");t!==void 0&&!xs(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!xs(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case qr:case Hi:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case Be:xs(c,t)&&(u(),Ss(s,c.content));break}c=c.right}u()};return t||n?ce(o,h=>{t&&Nu(h,t),n&&Nu(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?ce(i,s=>{const o=Wa(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),ju(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?ce(i,s=>{const o=Wa(s,this,t,!r);ju(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?ce(r,i=>{p0(i,Wa(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?ce(i,s=>{const o=Wa(s,this,t,!1);o.right!==null&&f0(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?ce(this.doc,n=>{za(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?ce(this.doc,r=>{Fu(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Du(this,t)}getAttributes(){return o0(this)}_write(t){t.writeTypeRef(mv)}}const JT=e=>new er;class zu{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??tn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Vr||n.constructor===Tr)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Tr extends ke{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Tr}clone(){const t=new Tr;return t.insert(0,this.toArray().map(n=>n instanceof ke?n.clone():n)),t}get length(){return this.doc??tn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new zu(this,t)}querySelector(t){t=t.toUpperCase();const r=new zu(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),mi(new zu(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){$a(this,t,new QT(this,n,t))}toString(){return e0(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),_o(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?ce(this.doc,r=>{i0(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)ce(this.doc,r=>{const i=t&&t instanceof ke?t._item:t;ja(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw _i("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?ce(this.doc,r=>{s0(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return t0(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return n0(this,t)}slice(t=0,n=this.length){return Qp(this,t,n)}forEach(t){_o(this,t)}_write(t){t.writeTypeRef(yv)}}const XT=e=>new Tr;class Vr extends Tr{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Vr(this.nodeName)}clone(){const t=new Vr(this.nodeName),n=this.getAttributes();return UE(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof ke?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?ce(this.doc,n=>{za(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?ce(this.doc,r=>{Fu(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Du(this,t)}hasAttribute(t){return a0(this,t)}getAttributes(t){return t?jT(this,t):o0(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return _o(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(gv),t.writeKey(this.nodeName)}}const ZT=e=>new Vr(e.readKey());class QT extends Fa{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Rs extends Er{constructor(t){super(),this.hookName=t}_copy(){return new Rs(this.hookName)}clone(){const t=new Rs(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(_v),t.writeKey(this.hookName)}}const tv=e=>new Rs(e.readKey());class Gi extends er{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Gi}clone(){const t=new Gi;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(bv)}}const ev=e=>new Gi;class Ku{constructor(t,n){this.id=t,this.length=n}get deleted(){throw pr()}mergeWith(t){return!1}write(t,n,r){throw pr()}integrate(t,n){throw pr()}}const nv=0;class In extends Ku{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Kp(t.doc.store,this)}write(t,n){t.writeInfo(nv),t.writeLen(this.length-n)}getMissing(t,n){return null}}class bo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new bo(this.content)}splice(t){throw pr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const rv=e=>new bo(e.readBuf());class wo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new wo(this.len)}splice(t){const n=new wo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){La(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const iv=e=>new wo(e.readLen()),m0=(e,t)=>new Yr({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Eo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Eo(m0(this.doc.guid,this.opts))}splice(t){throw pr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const sv=e=>new Eo(m0(e.readString(),e.readAny()));class Hi{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Hi(this.embed)}splice(t){throw pr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const ov=e=>new Hi(e.readJSON());class Be{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Be(this.key,this.value)}splice(t){throw pr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const av=e=>new Be(e.readKey(),e.readJSON());class Ga{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ga(this.arr)}splice(t){const n=new Ga(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const cv=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Ga(n)},lv=Ca("node_env")==="development";class Yi{constructor(t){this.arr=t,lv&&_p(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Yi(this.arr)}splice(t){const n=new Yi(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const uv=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Yi(n)};class vr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new vr(this.str)}splice(t){const n=new vr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const hv=e=>new vr(e.readString()),fv=[KT,GT,JT,ZT,XT,tv,ev],dv=0,pv=1,mv=2,gv=3,yv=4,_v=5,bv=6;class qr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new qr(this.type._copy())}splice(t){throw pr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const wv=e=>new qr(fv[e.readTypeRef()](e)),Ha=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Fe(Gt(r,i+n),t,Gt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Gt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Fe extends Ku{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Xd:0}set marker(t){(this.info&lu)>0!==t&&(this.info^=lu)}get marker(){return(this.info&lu)>0}get keep(){return(this.info&Jd)>0}set keep(t){this.keep!==t&&(this.info^=Jd)}get countable(){return(this.info&Xd)>0}get deleted(){return(this.info&cu)>0}set deleted(t){this.deleted!==t&&(this.info^=cu)}markDeleted(){this.info|=cu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=He(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=He(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===As&&this.id.client!==this.parent.client&&this.parent.clock>=He(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Wp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=bi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===In||this.right&&this.right.constructor===In)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Fe&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Fe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===As){const r=Cu(n,this.parent);r.constructor===In?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Wp(t,t.doc.store,Gt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Ma(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Ma(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Cu(t.doc.store,i.origin)))s.has(Cu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Kp(t.doc.store,this),this.content.integrate(t,this),Yp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new In(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Gt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ma(t.origin,this.lastId)&&this.right===t&&Ma(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),La(t.deleteSet,this.id.client,this.id.clock,this.length),Yp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw mr();this.content.gc(t),n?AT(t,this,new In(this.id,this.length)):this.content=new wo(this.length)}write(t,n){const r=n>0?Gt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Aa|(r===null?0:Rn)|(i===null?0:jr)|(s===null?0:ao);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=kT(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===As?(t.writeParentInfo(!1),t.writeLeftID(a)):mr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const g0=(e,t)=>Ev[t&Aa](e),Ev=[()=>{mr()},iv,cv,rv,hv,ov,av,wv,uv,sv,()=>{mr()}],Tv=10;class $n extends Ku{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){mr()}write(t,n){t.writeInfo(Tv),Bt(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const y0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof gs<"u"?gs:{},_0="__ $YJS$ __";y0[_0]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),y0[_0]=!0;let Wu,Gu,vv=e=>e();function kv(e,t){if(Gu)return Gu(e,t);vv(e)}function Vi(e,t,n){if(Wu)return Wu.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function Av(e){Wu=function(t,n,r){const i=e.createAtom(t);return n&&n(),i},Gu=(t,n)=>e.reaction(t,n,{fireImmediately:!1})}const b0=new WeakSet;function xv(e){if(b0.has(e))return e;b0.add(e);let t;const n=new Map;function r(){if(!t){const h=f=>{(f.changes.added.size||f.changes.deleted.size||f.changes.keys.size||f.changes.delta.length)&&t.reportChanged()};t=Vi("map",()=>{e.observe(h)},()=>{e.unobserve(h)})}t.reportObserved(e._implicitObserver)}function i(h){let f=n.get(h);if(!f){const d=p=>{f.reportChanged()};f=Vi(h+"",()=>{e.observe(d)},()=>{e.unobserve(d)}),n.set(h,f)}f.reportObserved(e._implicitObserver)}const s=e.get;e.get=function(h){if(typeof h!="number")throw new Error("unexpected");return i(h),Reflect.apply(s,this,arguments)};function o(h){const f=e[h];e[h]=function(){return r(),Reflect.apply(f,this,arguments)}}function a(h){let f=e,d=Object.getOwnPropertyDescriptor(f,h);if(d||(f=Object.getPrototypeOf(f),d=Object.getOwnPropertyDescriptor(f,h)),d||(f=Object.getPrototypeOf(f),d=Object.getOwnPropertyDescriptor(f,h)),!d)throw new Error("property not found");const p=d.get;d.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(e,h,d)}function c(h,f){let d=e,p=Object.getOwnPropertyDescriptor(d,h);if(p||(d=Object.getPrototypeOf(d),p=Object.getOwnPropertyDescriptor(d,h)),p||(d=Object.getPrototypeOf(d),p=Object.getOwnPropertyDescriptor(d,h)),!p)throw new Error("property not found");Object.defineProperty(e,f,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const u=e.push;e.push=function(h){this._disableTracking=!0;const f=u.call(this,h);return this._disableTracking=!1,f};const l=e.slice;return e.slice=function(h,f){this._disableTracking=!0;const d=l.call(this,h,f);return this._disableTracking=!1,d},e}const w0=new WeakSet;function Sv(e){if(w0.has(e))return e;w0.add(e);let t;function n(){if(!t){let s=Array.from(e.share.keys());const o=a=>{const c=Array.from(e.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,t.reportChanged())};t=Vi("map",()=>{e.on("beforeObserverCalls",o)},()=>{e.off("beforeObserverCalls",o)})}t.reportObserved(e._implicitObserver)}const r=e.get;e.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return Ya(o),o};function i(s){const o=e[s];let a;e[s]=function(){let c,u=arguments;return n(),a&&a.removeObservers(),a=kv(()=>(c=Reflect.apply(o,e,u),c),()=>t.reportChanged()),c}}return i("toJSON"),Object.defineProperty(e,"keys",{get:()=>(n(),Object.keys(e.share))}),e}const E0=new WeakSet;function Rv(e){if(E0.has(e))return e;E0.add(e);let t;const n=new Map;function r(){if(!t){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&t.reportChanged()};t=Vi("map",()=>{e.observe(a)},()=>{e.unobserve(a)})}t.reportObserved(e._implicitObserver)}function i(a){let c=n.get(a);if(!c){const u=l=>{l.keysChanged.has(a)&&(l.changes.added.size||l.changes.deleted.size||l.changes.keys.size||l.changes.delta.length)&&c.reportChanged()};c=Vi(a,()=>{e.observe(u)},()=>{e.unobserve(u)}),n.set(a,c)}c.reportObserved(e._implicitObserver)}const s=e.get;e.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=e[a];e[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),e}const T0=new WeakSet;function v0(e){if(T0.has(e))return e;T0.add(e);let t;const n=i=>{t.reportChanged()};t=Vi("text",()=>{e.observe(n)},()=>{e.unobserve(n)});function r(i){const s=e[i];e[i]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),e}const k0=new WeakSet;function A0(e){if(k0.has(e))return e;k0.add(e);let t;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&t.reportChanged()};t=Vi("xml",()=>{e.observe(n)},()=>{e.unobserve(n)});function r(s){const o=e[s];e[s]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=e,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(e,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),e}function Ya(e){return e instanceof Gi||e instanceof er?v0(e):e instanceof wr?xv(e):e instanceof Er?Rv(e):e instanceof Yr||Object.prototype.hasOwnProperty.call(e,"autoLoad")?Sv(e):e instanceof Tr||e instanceof Vr?A0(e):e}function x0(e){e.share.forEach(t=>{t.constructor!==ke&&Ya(t)})}function S0(e,t){for(let r=e.length-1;r>=t;r--){let i=e[r];if(!i.deleted){var n;if(i instanceof In)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof ke&&Ya(s)})}}}const R0=new WeakSet;function Iv(e){R0.has(e)||(R0.add(e),Ya(e),e.store.clients.forEach(t=>{t&&S0(t,0)}),x0(e),e.on("beforeObserverCalls",t=>{x0(e),t.afterState.forEach((n,r)=>{const i=t.beforeState.get(r)||0;if(i!==n){const s=t.doc.store.clients.get(r);if(!s)return;const o=tr(s,i);S0(s,o)}})}))}class To{constructor(t){this.value=void 0,this.value=t}}function Ov(e){return ArrayBuffer.isView(e)?new To(e):new To(Object.freeze(e))}function Nv(e){const t=function(){var a;let c=(a=this[Fn])==null?void 0:a.implicitObserver;return e._implicitObserver=c,e.slice.bind(e).apply(e,arguments).map(l=>{const h=Va(l,c);return c&&typeof h=="object"?oo(h,c):h})},n=function(a){return a.map(c=>{const u=Hu(c);let l=qi(u)||u;if(l instanceof To&&(l=l.value),l instanceof ke&&l.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return l})},r=function(){return[].findIndex.apply(t.apply(this),arguments)},i={slice:t,unshift:(...o)=>(e.unshift(n(o)),e.lengthUntracked),push:(...o)=>(e.push(n(o)),e.lengthUntracked),insert:e.insert.bind(e),toJSON:e.toJSON.bind(e),forEach:function(){return[].forEach.apply(t.apply(this),arguments)},every:function(){return[].every.apply(t.apply(this),arguments)},filter:function(){return[].filter.apply(t.apply(this),arguments)},find:function(){return[].find.apply(t.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(t.apply(this),arguments)},includes:function(){return[].includes.apply(t.apply(this),arguments)},map:function(){return[].map.apply(t.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>Pv(a,o))},splice:function(){let o=arguments[0]<0?e.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),u=t.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return e.doc?e.doc.transact(()=>{e.delete(o,a),e.insert(o,n(c))}):(e.delete(o,a),e.insert(o,n(c))),u}},s=[];for(let o in i)s[o]=i[o];return s}function vo(e){if(typeof e=="string"&&e.trim().length){const t=Number(e);if(Number.isInteger(t))return t}return e}function I0(e,t=new wr){if(t[Pe])throw new Error("unexpected");const n=Nv(t),r=new Proxy(n,{set:(i,s,o)=>{throw typeof vo(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=vo(s);if(a===qa)return t;if(typeof a=="number"){let l;if(o&&o[Fn]){var c;l=(c=o[Fn])==null?void 0:c.implicitObserver,t._implicitObserver=l}let h=t.get(a);return h=Va(h,l),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const l=t.slice();return Reflect.get(l,a)}return a==="length"?t.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=vo(s);if(typeof o!="number")throw new Error;return o<t.lengthUntracked&&o>=0?(t.delete(o),!0):!1},has:(i,s)=>{const o=vo(s);return typeof o!="number"?Reflect.has(i,o):o<t.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=vo(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<t.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<t.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,e),r}function O0(e,t=new Er){if(t[Pe])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=Hu(s);let a=qi(o)||o;if(a instanceof To&&(a=a.value),a instanceof ke&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return t.set(i,a),!0},get:(r,i,s)=>{if(i===qa)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[Fn]){var a;o=(a=s[Fn])==null?void 0:a.implicitObserver,t._implicitObserver=o}let c=t.get(i);return c=Va(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return t.has(i)?(t.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&t.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.keys())});ko.set(t,n);for(let r in e)n[r]=e[r];return n}function Cv(e){return e instanceof ke}const ko=new WeakMap;function Va(e,t){if(Cv(e)){if(e._implicitObserver=t,e instanceof wr||e instanceof Er){if(!ko.has(e)){const n=Hu(e);ko.set(e,n)}e=ko.get(e)}else if(e instanceof Vr||e instanceof Tr||e instanceof Gi||e instanceof Rs||e instanceof er)iu(e),e.__v_skip=!0;else throw new Error("unknown YType");return e}else{if(e===null)return null;if(typeof e=="object")return Ov(e)}return e}function Hu(e){if(e==null)return e;if(e=qi(e)||e,e instanceof wr)return I0([],e);if(e instanceof Er)return O0({},e);if(typeof e=="string")return e;if(Array.isArray(e))return I0(e);if(e instanceof Vr||e instanceof Tr||e instanceof Gi||e instanceof Rs)return e;if(e instanceof er)return e;if(typeof e=="object")return e instanceof To?e:O0(e);if(typeof e=="number"||typeof e=="boolean")return e;throw new Error("invalid")}function Lv(e){for(let[t,n]of Object.entries(e))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function N0(e,t,n){let r=t[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?e.getXmlFragment(n):r==="text"?e.getText(n):Array.isArray(r)?e.getArray(n):e.getMap(n)}function Mv(e,t){if(e[Pe])throw new Error("unexpected");Lv(t);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===qa)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[Fn]){var a;o=(a=s[Fn])==null?void 0:a.implicitObserver,e._implicitObserver=o}if(i==="toJSON"){for(let l of Object.keys(t))N0(e,t,l);return Reflect.get(e,i)}let c=N0(e,t,i);return c=Va(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&e.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.share.keys())});return ko.set(e,n),n}Av(jw);const qa=Symbol("INTERNAL_SYMBOL");function C0(e,t){const n=qi(e)||e;if(!n)throw new Error("not a valid synced object");return n instanceof Yr?(n.on("update",t),()=>{n.off("update",t)}):(n.observeDeep(t),()=>{n.unobserveDeep(t)})}function Uv(e){const t=qi(e);if(!(t instanceof Yr))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return t}function qi(e){if(typeof e!="object"||e===null)return;const t=e[qa];return t&&(iu(t),t.__v_skip=!0),t}function Pv(e,t){if(e===t)return!0;if(typeof e=="object"&&typeof t=="object"){const n=qi(e),r=qi(t);return!n||!r?!1:n===r}return!1}function Bv(e,t=new Yr){return Iv(t),Mv(t,e)}var zt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ao=Symbol.for("react.element"),Fv=Symbol.for("react.portal"),Dv=Symbol.for("react.fragment"),$v=Symbol.for("react.strict_mode"),jv=Symbol.for("react.profiler"),zv=Symbol.for("react.provider"),Kv=Symbol.for("react.context"),Wv=Symbol.for("react.forward_ref"),Gv=Symbol.for("react.suspense"),Hv=Symbol.for("react.memo"),Yv=Symbol.for("react.lazy"),L0=Symbol.iterator;function Vv(e){return e===null||typeof e!="object"?null:(e=L0&&e[L0]||e["@@iterator"],typeof e=="function"?e:null)}var M0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},U0=Object.assign,P0={};function Is(e,t,n){this.props=e,this.context=t,this.refs=P0,this.updater=n||M0}Is.prototype.isReactComponent={},Is.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Is.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function B0(){}B0.prototype=Is.prototype;function Yu(e,t,n){this.props=e,this.context=t,this.refs=P0,this.updater=n||M0}var Vu=Yu.prototype=new B0;Vu.constructor=Yu,U0(Vu,Is.prototype),Vu.isPureReactComponent=!0;var F0=Array.isArray,D0=Object.prototype.hasOwnProperty,qu={current:null},$0={key:!0,ref:!0,__self:!0,__source:!0};function j0(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)D0.call(t,r)&&!$0.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ao,type:e,key:s,ref:o,props:i,_owner:qu.current}}function qv(e,t){return{$$typeof:Ao,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Ju(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ao}function Jv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var z0=/\/+/g;function Xu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Jv(""+e.key):t.toString(36)}function Ja(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Ao:case Fv:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+Xu(o,0):r,F0(i)?(n="",e!=null&&(n=e.replace(z0,"$&/")+"/"),Ja(i,t,n,"",function(u){return u})):i!=null&&(Ju(i)&&(i=qv(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(z0,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",F0(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+Xu(s,a);o+=Ja(s,t,n,c,i)}else if(c=Vv(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+Xu(s,a++),o+=Ja(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Xa(e,t,n){if(e==null)return e;var r=[],i=0;return Ja(e,r,"","",function(s){return t.call(n,s,i++)}),r}function Xv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var rn={current:null},Za={transition:null},Zv={ReactCurrentDispatcher:rn,ReactCurrentBatchConfig:Za,ReactCurrentOwner:qu};function K0(){throw Error("act(...) is not supported in production builds of React.")}zt.Children={map:Xa,forEach:function(e,t,n){Xa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Xa(e,function(){t++}),t},toArray:function(e){return Xa(e,function(t){return t})||[]},only:function(e){if(!Ju(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},zt.Component=Is,zt.Fragment=Dv,zt.Profiler=jv,zt.PureComponent=Yu,zt.StrictMode=$v,zt.Suspense=Gv,zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zv,zt.act=K0,zt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=U0({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=qu.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)D0.call(t,c)&&!$0.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ao,type:e.type,key:i,ref:s,props:r,_owner:o}},zt.createContext=function(e){return e={$$typeof:Kv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:zv,_context:e},e.Consumer=e},zt.createElement=j0,zt.createFactory=function(e){var t=j0.bind(null,e);return t.type=e,t},zt.createRef=function(){return{current:null}},zt.forwardRef=function(e){return{$$typeof:Wv,render:e}},zt.isValidElement=Ju,zt.lazy=function(e){return{$$typeof:Yv,_payload:{_status:-1,_result:e},_init:Xv}},zt.memo=function(e,t){return{$$typeof:Hv,type:e,compare:t===void 0?null:t}},zt.startTransition=function(e){var t=Za.transition;Za.transition={};try{e()}finally{Za.transition=t}},zt.unstable_act=K0,zt.useCallback=function(e,t){return rn.current.useCallback(e,t)},zt.useContext=function(e){return rn.current.useContext(e)},zt.useDebugValue=function(){},zt.useDeferredValue=function(e){return rn.current.useDeferredValue(e)},zt.useEffect=function(e,t){return rn.current.useEffect(e,t)},zt.useId=function(){return rn.current.useId()},zt.useImperativeHandle=function(e,t,n){return rn.current.useImperativeHandle(e,t,n)},zt.useInsertionEffect=function(e,t){return rn.current.useInsertionEffect(e,t)},zt.useLayoutEffect=function(e,t){return rn.current.useLayoutEffect(e,t)},zt.useMemo=function(e,t){return rn.current.useMemo(e,t)},zt.useReducer=function(e,t,n){return rn.current.useReducer(e,t,n)},zt.useRef=function(e){return rn.current.useRef(e)},zt.useState=function(e){return rn.current.useState(e)},zt.useSyncExternalStore=function(e,t,n){return rn.current.useSyncExternalStore(e,t,n)},zt.useTransition=function(){return rn.current.useTransition()},zt.version="18.3.1";const Zu=0,W0=1,G0=2,Qv=(e,t)=>{Bt(e,Zu);const n=TT(t);Qe(e,n)},H0=(e,t,n)=>{Bt(e,W0),Qe(e,_T(t,n))},tk=(e,t,n)=>H0(t,n,nn(e)),Y0=(e,t,n)=>{try{mT(t,nn(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},ek=(e,t)=>{Bt(e,G0),Qe(e,t)},nk=Y0,rk=(e,t,n,r)=>{const i=Ft(e);switch(i){case Zu:tk(e,t,n);break;case W0:Y0(e,n,r);break;case G0:nk(e,n,r);break;default:throw new Error("Unknown message type")}return i},Jr=Bv({shared:[]});function Qa(e,t,n){return e.find(r=>r.key===t&&r.type===n)}function V0(e,t,n){const r=Qa(Jr.shared,e,t);T(r)||Jr.shared.push({key:e,type:t,value:n})}function ik(e,t){V0(e,0,t)}function Qu(e,t){const n=new er(t);V0(e,1,n)}function sk(e,t){const n=Qa(Jr.shared,e,0);if(T(n)){n.value=t;return}Jr.shared.push({key:e,type:0,value:t})}function ok(e,t){const n=new er(t),r=Qa(Jr.shared,e,1);if(T(r)){r.value=n;return}Jr.shared.push({key:e,type:1,value:n})}function q0(e,t,n){let r;function i(){const o=Qa(Jr.shared,e,t);T(o)&&(s(),r=C0(o,()=>n(o.value)))}const s=C0(Jr.shared,i);return i(),()=>r==null?void 0:r()}function ak(e,t){return q0(e,0,t)}function J0(e,t){return q0(e,1,n=>t(n.toJSON()))}function tc(e){return Qn(e)}let X0=!1;const Ti=Uv(Jr),jn=ms("modem",["second"],e=>{if(jn.session(e))switch(e.target){case"second":!X0&&e.data%2===0&&jn.emit("modem:join");break;case"join":if(e.sender!==jn.id()){jn.reply(e,"joinack");const t=yi();Qv(t,Ti),jn.reply(e,"sync",tc(t));const n=yi();H0(n,Ti),jn.reply(e,"sync",tc(n))}break;case"joinack":e.sender!==jn.id()&&(X0=!0);break;case"sync":{if(e.sender!==jn.id()&&T(e.data))try{const t=zi(e.data),n=yi();rk(t,n,Ti,jn)===Zu&&jn.emit("modem:sync",tc(n))}catch(t){se(jn,"sync",t.message)}break}}});function Z0(e){const t=yi();ek(t,e),jn.emit("modem:sync",tc(t))}Ti.on("update",Z0),Ti.on("destroy",()=>{Ti==null||Ti.off("update",Z0)});const th=14,ec=3,nc=8,rc=14,ic=16,ck=16,lk=16;function sc(e,t){return new Array(e).fill(t)}function uk(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:sc(s,0),color:sc(s,0),bg:sc(s,i)}}function hk(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Ut.ONCLEAR}}function fk(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function dk(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:sc(s,i)}}function pk(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function mk(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function Q0(e,t){return`${e}:${t}`}const gk=1,yk=16,_k=256;var sn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(sn||{});const oc={},Os={};function eh(){return{id:Te(),layers:[],scroll:[],sidebar:[]}}const bk=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),wk=new Set(["tx","text"]),Ek={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},tm={};let em=e=>{let t=tm[e];return T(t)||(tm[e]=t=eh()),t};function Tk(e){em=e}function on(e){return em(e)}function nh(e){return T(oc[e])||(oc[e]=[]),oc[e]}function vk(e){const t=on(e);t.scroll=[]}function kk(e,t,n){Object.values(Os).forEach(r=>{if(r[t]!==void 0){const i=Q0(e.id(),t);Lt(n)&&sk(i,n),kt(n)&&ok(i,n)}})}function kr(e){const t=nh(e);return oc[e]=[],t}function le(e,t){nh(e).push(t)}function ee(e,t,n,r,i=()=>0,s=Gl){const o=[t,n,...r],a=Dt(`${o[3]}`);if(bk.has(a)){const c=`${o[2]}`;Os[t]=Os[t]??{};const u=i(c)??Ek[a];if(Os[t][c]===void 0){const l=Q0(t,c);Lt(u)&&ik(l,u),kt(u)&&Qu(l,u),wk.has(a)?Os[t][c]=J0(l,h=>{T(h)&&h!==i(c)&&s(c,h)}):Os[t][c]=ak(l,h=>{T(h)&&h!==i(c)&&s(c,h)})}}nh(e).push(o)}var nm={exports:{}},rh={exports:{}},rm;function Ak(){return rm||(rm=1,function(e,t){(function(n,r){e.exports=r()})(pn,function(){function n(g){return!isNaN(parseFloat(g))&&isFinite(g)}function r(g){return g.charAt(0).toUpperCase()+g.substring(1)}function i(g){return function(){return this[g]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(g){if(g)for(var E=0;E<l.length;E++)g[l[E]]!==void 0&&this["set"+r(l[E])](g[l[E]])}h.prototype={getArgs:function(){return this.args},setArgs:function(g){if(Object.prototype.toString.call(g)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=g},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(g){if(g instanceof h)this.evalOrigin=g;else if(g instanceof Object)this.evalOrigin=new h(g);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var g=this.getFileName()||"",E=this.getLineNumber()||"",w=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?g?"[eval] ("+g+":"+E+":"+w+")":"[eval]:"+E+":"+w:v?v+" ("+g+":"+E+":"+w+")":g+":"+E+":"+w}},h.fromString=function(E){var w=E.indexOf("("),v=E.lastIndexOf(")"),A=E.substring(0,w),O=E.substring(w+1,v).split(","),U=E.substring(v+1);if(U.indexOf("@")===0)var L=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),N=L[1],D=L[2],P=L[3];return new h({functionName:A,args:O||void 0,fileName:N,lineNumber:D||void 0,columnNumber:P||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=function(g){return function(E){this[g]=!!E}}(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=function(g){return function(E){if(!n(E))throw new TypeError(g+" must be a Number");this[g]=Number(E)}}(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(g){return function(E){this[g]=String(E)}}(a[p]);return h})}(rh)),rh.exports}(function(e,t){(function(n,r){e.exports=r(Ak())})(pn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,g=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:g,lineNumber:d[1],columnNumber:d[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=l.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],f=2,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],f=0,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,g;d.match(/\(([^)]*)\)/)&&(g=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var E=g===void 0||g==="[arguments not available]"?void 0:g.split(",");return new r({functionName:p,args:E,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:l})},this)}}})})(nm);var xk=nm.exports,Sk=eo(xk);const Ar=!!JSON.parse("false"),Rk=!!JSON.parse("false");JSON.parse("false");const Ik=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Xr={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return nc*Xr.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return rc*Xr.DRAW_CHAR_SCALE}},H=ms("SOFTWARE");function nr(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Ok(e,t){return e%t}function Nk(e,t){return Math.floor(e/t)}function Ck(e,t){return{x:Ok(e,t),y:Nk(e,t)}}function ac(e,t){return e.x+e.y*t}function im(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function ih(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}function Lk(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let u=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const l=2*u;l>-o&&(u-=o,e+=a),l<s&&(u+=s,t+=c),i.push({x:e,y:t})}return i}function sm(e,t,n,r,i){e.push({x:t+r,y:n+i}),e.push({x:t-r,y:n+i}),e.push({x:t+r,y:n-i}),e.push({x:t-r,y:n-i})}function Mk(e,t,n){const r=[];let i=5-4*n,s=0,o=n,a=(-2*n+5)*4,c=3*4;for(;s<=o;)sm(r,e,t,s,o),sm(r,e,t,o,s),i>0?(i+=a,o-=1,s+=1,a+=4*4,c+=2*2):(i+=c,s+=1,a+=2*4,c+=2*4);return r}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const om="170",Uk="",cc="srgb",am="srgb-linear",cm="linear",sh="srgb";function Pk(e,t,n){return Math.max(t,Math.min(n,e))}class xo{constructor(t=0,n=0){xo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Pk(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class So{constructor(t,n,r,i,s,o,a,c,u){So.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],f=r[2],d=r[5],p=r[8],g=i[0],E=i[3],w=i[6],v=i[1],A=i[4],O=i[7],U=i[2],L=i[5],N=i[8];return s[0]=o*g+a*v+c*U,s[3]=o*E+a*A+c*L,s[6]=o*w+a*O+c*N,s[1]=u*g+l*v+h*U,s[4]=u*E+l*A+h*L,s[7]=u*w+l*O+h*N,s[2]=f*g+d*v+p*U,s[5]=f*E+d*A+p*L,s[8]=f*w+d*O+p*N,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=a*c-l*s,d=u*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return t[0]=h*g,t[1]=(i*u-l*r)*g,t[2]=(a*r-i*o)*g,t[3]=f*g,t[4]=(l*n-i*c)*g,t[5]=(i*s-a*n)*g,t[6]=d*g,t[7]=(r*c-u*n)*g,t[8]=(o*n-r*s)*g,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(oh.makeScale(t,n)),this}rotate(t){return this.premultiply(oh.makeRotation(-t)),this}translate(t,n){return this.premultiply(oh.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const oh=new So,Bk={enabled:!0,workingColorSpace:am,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===sh&&(e.r=ah(e.r),e.g=ah(e.g),e.b=ah(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===sh&&(e.r=ch(e.r),e.g=ch(e.g),e.b=ch(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Uk?cm:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function ah(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function ch(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const lm=[.64,.33,.3,.6,.15,.06],um=[.2126,.7152,.0722],hm=[.3127,.329],fm=new So().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),dm=new So().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Bk.define({[am]:{primaries:lm,whitePoint:hm,transfer:cm,toXYZ:fm,fromXYZ:dm,luminanceCoefficients:um,workingColorSpaceConfig:{unpackColorSpace:cc},outputColorSpaceConfig:{drawingBufferColorSpace:cc}},[cc]:{primaries:lm,whitePoint:hm,transfer:sh,toXYZ:fm,fromXYZ:dm,luminanceCoefficients:um,outputColorSpaceConfig:{drawingBufferColorSpace:cc}}}),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:om}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=om),new xo,new xo;function On(e,t,n){return Math.max(t,Math.min(n,e))}const Fk=yd("089fad0j9awfem09wavefc09uwaef");function Dk(){return Fk()}function $k(e){return yd(e)()}function Ro(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Dk()*i)}function jk(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor($k(e)*s)}function lh(e,t,n){typeof e!="number"&&(e=0,t=0,n=1),typeof t!="number"&&(t=e,e=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function zk(e){return e[Ro(0,e.length-1)]}function Kk(e,t){return t[jk(e,0,t.length-1)]}function vi(...e){return zk(e.flat())}function pm(e,...t){return Kk(e,t.flat())}function Wk(e){return[...new Set(e)].filter(T)}function Gk(e){return T(e)&&e<Ut.ONBLACK?e:void 0}function Hk(e){return T(e)&&e>Ut.WHITE&&e<Ut.ONCLEAR?e-Ut.ONBLACK:void 0}const lc={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function gn(e){return Xt(e)&&gm(e[0])}function mm(e){return gn(e)&&e[0].startsWith("ON")}function gm(e){return T(Ut[e])&&kt(e)}function uh(e){if(kt(e))return lc[Dt(e)]}function ym(e){return e.map(t=>Ut[t]).find(t=>T(t)&&t<Ut.ONBLACK)}function Yk(e){return e.map(t=>Ut[t]).find(t=>T(t)&&t>=Ut.ONBLACK)}function _m(e){if(gn(e))return e;if(gm(e))return[e];const t=uh(e);if(T(t))return[t]}function bm(e){const t=x.words[e],n=_m(t);if(gn(n))return[n,e+1];const[r,i]=qe(e),s=_m(r);return gn(s)?[s,i]:[void 0,e]}function uc(e){const t=[];let n=e;const[r,i]=bm(e);if(gn(r)&&(t.push(...r),n=i),gn(t)&&!mm(t)){const[s,o]=bm(i);mm(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function wm(e){const t={};return e.every(n=>{const r=Ut[n];T(r)&&(r<Ut.ONBLACK?t.color=r:t.bg=r-Ut.ONBLACK)}),t}function Ns(e){return Xt(e)&&typeof e[0]=="string"}function Em(e){const t=x.words[e];if(Ns(t))return[t,e+1];const[n,r]=uc(e),[i,s]=qe(r,!1);return kt(i)?[[i,n],s]:[void 0,e]}function hc(e){if(!Ns(e))return;const[t]=e;return t}function Tm(e){if(!Ns(e))return;const[,t]=e,n=T(t)?ym(t):void 0;return T(n)?n:void 0}function vm(e){if(!Ns(e))return;const[,t]=e,n=T(t)?Yk(t):void 0;return T(n)?n:void 0}const oe=60,an=25;var xt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(xt||{});function hh(e,t){const n=e??jt.ISWALK,r=t??jt.ISWALK;switch(n){case jt.ISWALK:return r!==jt.ISWALK;case jt.ISSWIM:return r!==jt.ISSWIM;case jt.ISSOLID:return!0;case jt.ISBULLET:return r!==jt.ISWALK&&r!==jt.ISSWIM}}function fc(e,t,n){const r=e==null?void 0:e.objects[n];if(T(r))return r;if(T(t)){const i=Io(e,"player"),s={x:t.x??0,y:t.y??0};Am(s,i)}}function Io(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(T)}function km(e,t){const n=hc(t),r=Tm(t),i=vm(t);return e.filter(s=>{var o,a,c;return!(T(n)&&Dt((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||T(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Ut.WHITE)!==r||T(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Ut.BLACK)!==i)}).filter(T)}function fh(e,t){return T(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(T(i))return i;const s=Io(e,Dt(n));if(s.length)return s}else if(na(n)&&n.x>=0&&n.x<oe&&n.y>=0&&n.y<an){const i=n.x+n.y*oe,s=(r=e.lookup)==null?void 0:r[i];return T(s)?e.objects[s]:e.terrain[i]}}).flat().filter(T):[]}function Am(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var dh;try{dh=new TextDecoder}catch{}var mt,zn,$=0,ue={},Ht,ki,Kn=0,xr=0,Ye,Zr,yn=[],Kt,xm={useRecords:!1,mapsAsObjects:!0};class Sm{}const Rm=new Sm;Rm.name="MessagePack 0xC1";var Ai=!1,Im=2,Om;try{new Function("")}catch{Im=1/0}class Oo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(mt)return Km(()=>(_h(),this?this.unpack(t,n):Oo.prototype.unpack.call(xm,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Je<"u"?Je.from(t):new Uint8Array(t)),typeof n=="object"?(zn=n.end||t.length,$=n.start||0):($=0,zn=n>-1?n:t.length),xr=0,ki=null,Ye=null,mt=t;try{Kt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw mt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Oo){if(ue=this,this.structures)return Ht=this.structures,dc(n);(!Ht||Ht.length>0)&&(Ht=[])}else ue=xm,(!Ht||Ht.length>0)&&(Ht=[]);return dc(n)}unpackMultiple(t,n){let r,i=0;try{Ai=!0;let s=t.length,o=this?this.unpack(t,s):pc.unpack(t,s);if(n){if(n(o,i,$)===!1)return;for(;$<s;)if(i=$,n(dc(),i,$)===!1)return}else{for(r=[o];$<s;)i=$,r.push(dc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Ai=!1,_h()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function dc(e){try{if(!ue.trusted&&!Ai){let n=Ht.sharedLength||0;n<Ht.length&&(Ht.length=n)}let t;if(ue.randomAccessStructure&&mt[$]<64&&mt[$]>=32&&Om?(t=Om(mt,$,zn,ue),mt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),$=zn):t=Ie(),Ye&&($=Ye.postBundlePosition,Ye=null),Ai&&(Ht.restoreStructures=null),$==zn)Ht&&Ht.restoreStructures&&Nm(),Ht=null,mt=null,Zr&&(Zr=null);else{if($>zn)throw new Error("Unexpected end of MessagePack data");if(!Ai){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Ht&&Ht.restoreStructures&&Nm(),_h(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||$>zn)&&(t.incomplete=!0),t}}function Nm(){for(let e in Ht.restoreStructures)Ht[e]=Ht.restoreStructures[e];Ht.restoreStructures=null}function Ie(){let e=mt[$++];if(e<160)if(e<128){if(e<64)return e;{let t=Ht[e&63]||ue.getStructures&&Lm()[e&63];return t?(t.read||(t.read=ph(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,ue.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Dm();r==="__proto__"&&(r="__proto_"),t[r]=Ie()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ie(),Ie());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ie();return ue.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(xr>=$)return ki.slice($-Kn,($+=t)-Kn);if(xr==0&&zn<140){let n=t<16?gh(t):Pm(t);if(n!=null)return n}return mh(t)}else{let t;switch(e){case 192:return null;case 193:return Ye?(t=Ie(),t>0?Ye[1].slice(Ye.position1,Ye.position1+=t):Ye[0].slice(Ye.position0,Ye.position0-=t)):Rm;case 194:return!1;case 195:return!0;case 196:if(t=mt[$++],t===void 0)throw new Error("Unexpected end of buffer");return yh(t);case 197:return t=Kt.getUint16($),$+=2,yh(t);case 198:return t=Kt.getUint32($),$+=4,yh(t);case 199:return Ji(mt[$++]);case 200:return t=Kt.getUint16($),$+=2,Ji(t);case 201:return t=Kt.getUint32($),$+=4,Ji(t);case 202:if(t=Kt.getFloat32($),ue.useFloat32>2){let n=bh[(mt[$]&127)<<1|mt[$+1]>>7];return $+=4,(n*t+(t>0?.5:-.5)>>0)/n}return $+=4,t;case 203:return t=Kt.getFloat64($),$+=8,t;case 204:return mt[$++];case 205:return t=Kt.getUint16($),$+=2,t;case 206:return t=Kt.getUint32($),$+=4,t;case 207:return ue.int64AsType==="number"?(t=Kt.getUint32($)*4294967296,t+=Kt.getUint32($+4)):ue.int64AsType==="string"?t=Kt.getBigUint64($).toString():ue.int64AsType==="auto"?(t=Kt.getBigUint64($),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Kt.getBigUint64($),$+=8,t;case 208:return Kt.getInt8($++);case 209:return t=Kt.getInt16($),$+=2,t;case 210:return t=Kt.getInt32($),$+=4,t;case 211:return ue.int64AsType==="number"?(t=Kt.getInt32($)*4294967296,t+=Kt.getUint32($+4)):ue.int64AsType==="string"?t=Kt.getBigInt64($).toString():ue.int64AsType==="auto"?(t=Kt.getBigInt64($),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Kt.getBigInt64($),$+=8,t;case 212:if(t=mt[$++],t==114)return jm(mt[$++]&63);{let n=yn[t];if(n)return n.read?($++,n.read(Ie())):n.noBuffer?($++,n()):n(mt.subarray($,++$));throw new Error("Unknown extension "+t)}case 213:return t=mt[$],t==114?($++,jm(mt[$++]&63,mt[$++])):Ji(2);case 214:return Ji(4);case 215:return Ji(8);case 216:return Ji(16);case 217:return t=mt[$++],xr>=$?ki.slice($-Kn,($+=t)-Kn):qk(t);case 218:return t=Kt.getUint16($),$+=2,xr>=$?ki.slice($-Kn,($+=t)-Kn):Jk(t);case 219:return t=Kt.getUint32($),$+=4,xr>=$?ki.slice($-Kn,($+=t)-Kn):Xk(t);case 220:return t=Kt.getUint16($),$+=2,Mm(t);case 221:return t=Kt.getUint32($),$+=4,Mm(t);case 222:return t=Kt.getUint16($),$+=2,Um(t);case 223:return t=Kt.getUint32($),$+=4,Um(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const Vk=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function ph(e,t){function n(){if(n.count++>Im){let i=e.read=new Function("r","return function(){return "+(ue.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":Vk.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ie);return e.highByte===0&&(e.read=Cm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Ie()}return ue.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Cm(t,n):n}const Cm=(e,t)=>function(){let n=mt[$++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Ht[r]||Lm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=ph(i,e)),i.read()};function Lm(){let e=Km(()=>(mt=null,ue.getStructures()));return Ht=ue._mergeStructures(e,Ht)}var mh=No,qk=No,Jk=No,Xk=No;function No(e){let t;if(e<16&&(t=gh(e)))return t;if(e>64&&dh)return dh.decode(mt.subarray($,$+=e));const n=$+e,r=[];for(t="";$<n;){const i=mt[$++];if(!(i&128))r.push(i);else if((i&224)===192){const s=mt[$++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=mt[$++]&63,o=mt[$++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=mt[$++]&63,o=mt[$++]&63,a=mt[$++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Ve.apply(String,r),r.length=0)}return r.length>0&&(t+=Ve.apply(String,r)),t}function Mm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ie();return ue.freezeData?Object.freeze(t):t}function Um(e){if(ue.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Dm();r==="__proto__"&&(r="__proto_"),t[r]=Ie()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ie(),Ie());return t}}var Ve=String.fromCharCode;function Pm(e){let t=$,n=new Array(e);for(let r=0;r<e;r++){const i=mt[$++];if((i&128)>0){$=t;return}n[r]=i}return Ve.apply(String,n)}function gh(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[$++];if((t&128)>1){$-=1;return}return Ve(t)}}else{let t=mt[$++],n=mt[$++];if((t&128)>0||(n&128)>0){$-=2;return}if(e<3)return Ve(t,n);let r=mt[$++];if((r&128)>0){$-=3;return}return Ve(t,n,r)}else{let t=mt[$++],n=mt[$++],r=mt[$++],i=mt[$++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){$-=4;return}if(e<6){if(e===4)return Ve(t,n,r,i);{let s=mt[$++];if((s&128)>0){$-=5;return}return Ve(t,n,r,i,s)}}else if(e<8){let s=mt[$++],o=mt[$++];if((s&128)>0||(o&128)>0){$-=6;return}if(e<7)return Ve(t,n,r,i,s,o);let a=mt[$++];if((a&128)>0){$-=7;return}return Ve(t,n,r,i,s,o,a)}else{let s=mt[$++],o=mt[$++],a=mt[$++],c=mt[$++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){$-=8;return}if(e<10){if(e===8)return Ve(t,n,r,i,s,o,a,c);{let u=mt[$++];if((u&128)>0){$-=9;return}return Ve(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=mt[$++],l=mt[$++];if((u&128)>0||(l&128)>0){$-=10;return}if(e<11)return Ve(t,n,r,i,s,o,a,c,u,l);let h=mt[$++];if((h&128)>0){$-=11;return}return Ve(t,n,r,i,s,o,a,c,u,l,h)}else{let u=mt[$++],l=mt[$++],h=mt[$++],f=mt[$++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){$-=12;return}if(e<14){if(e===12)return Ve(t,n,r,i,s,o,a,c,u,l,h,f);{let d=mt[$++];if((d&128)>0){$-=13;return}return Ve(t,n,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=mt[$++],p=mt[$++];if((d&128)>0||(p&128)>0){$-=14;return}if(e<15)return Ve(t,n,r,i,s,o,a,c,u,l,h,f,d,p);let g=mt[$++];if((g&128)>0){$-=15;return}return Ve(t,n,r,i,s,o,a,c,u,l,h,f,d,p,g)}}}}}function Bm(){let e=mt[$++],t;if(e<192)t=e-160;else switch(e){case 217:t=mt[$++];break;case 218:t=Kt.getUint16($),$+=2;break;case 219:t=Kt.getUint32($),$+=4;break;default:throw new Error("Expected string")}return No(t)}function yh(e){return ue.copyBuffers?Uint8Array.prototype.slice.call(mt,$,$+=e):mt.subarray($,$+=e)}function Ji(e){let t=mt[$++];if(yn[t]){let n;return yn[t](mt.subarray($,n=$+=e),r=>{$=r;try{return Ie()}finally{$=n}})}else throw new Error("Unknown extension type "+t)}var Fm=new Array(4096);function Dm(){let e=mt[$++];if(e>=160&&e<192){if(e=e-160,xr>=$)return ki.slice($-Kn,($+=e)-Kn);if(!(xr==0&&zn<180))return mh(e)}else return $--,$m(Ie());let t=(e<<5^(e>1?Kt.getUint16($):e>0?mt[$]:0))&4095,n=Fm[t],r=$,i=$+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Kt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=mt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return $=r,n.string;i-=3,r=$}for(n=[],Fm[t]=n,n.bytes=e;r<i;)s=Kt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=mt[r++],n.push(s);let a=e<16?gh(e):Pm(e);return a!=null?n.string=a:n.string=mh(e)}function $m(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const jm=(e,t)=>{let n=Ie().map($m),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Ht[e];return i&&(i.isShared||Ai)&&((Ht.restoreStructures||(Ht.restoreStructures=[]))[e]=i),Ht[e]=n,n.read=ph(n,r),n.read()};yn[0]=()=>{},yn[0].noBuffer=!0,yn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let Zk={Error,TypeError,ReferenceError};yn[101]=()=>{let e=Ie();return(Zk[e[0]]||Error)(e[1],{cause:e[2]})},yn[105]=e=>{if(ue.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Kt.getUint32($-4);Zr||(Zr=new Map);let n=mt[$],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Zr.set(t,i);let s=Ie();return i.used?Object.assign(r,s):(i.target=s,s)},yn[112]=e=>{if(ue.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Kt.getUint32($-4),n=Zr.get(t);return n.used=!0,n.target},yn[115]=()=>new Set(Ie());const zm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let Qk=typeof globalThis=="object"?globalThis:window;yn[116]=e=>{let t=e[0],n=zm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new Qk[n](Uint8Array.prototype.slice.call(e,1).buffer)},yn[120]=()=>{let e=Ie();return new RegExp(e[0],e[1])};const tA=[];yn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=$;return $+=t-e.length,Ye=tA,Ye=[Bm(),Bm()],Ye.position0=0,Ye.position1=0,Ye.postBundlePosition=$,$=n,Ie()},yn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Km(e){let t=zn,n=$,r=Kn,i=xr,s=ki,o=Zr,a=Ye,c=new Uint8Array(mt.slice(0,zn)),u=Ht,l=Ht.slice(0,Ht.length),h=ue,f=Ai,d=e();return zn=t,$=n,Kn=r,xr=i,ki=s,Zr=o,Ye=a,mt=c,Ai=f,Ht=u,Ht.splice(0,Ht.length,...l),ue=h,Kt=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),d}function _h(){mt=null,Zr=null,Ht=null}const bh=new Array(147);for(let e=0;e<256;e++)bh[e]=+("1e"+Math.floor(45.15-e*.30103));var pc=new Oo({useRecords:!1});const eA=pc.unpack;pc.unpackMultiple,pc.unpack;let nA=new Float32Array(1);new Uint8Array(nA.buffer,0,4);let mc;try{mc=new TextEncoder}catch{}let wh,Wm;const gc=typeof Je<"u",yc=gc?function(e){return Je.allocUnsafeSlow(e)}:Uint8Array,Gm=gc?Je:Uint8Array,Hm=gc?4294967296:2144337920;let V,Co,he,z=0,cn,be=null,rA;const iA=21760,sA=/[\u0080-\uFFFF]/,Cs=Symbol("record-id");class oA extends Oo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Gm.prototype.utf8Write?function(R,_){return V.utf8Write(R,_,V.byteLength-_)}:mc&&mc.encodeInto?function(R,_){return mc.encodeInto(R,V.subarray(_)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=l>32||h+l>64,d=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],E=0,w=0;this.pack=this.encode=function(R,_){if(V||(V=new yc(8192),he=V.dataView||(V.dataView=new DataView(V.buffer,0,8192)),z=0),cn=V.length-10,cn-z<2048?(V=new yc(V.length),he=V.dataView||(V.dataView=new DataView(V.buffer,0,V.length)),cn=V.length-10,z=0):z=z+7&2147483640,n=z,_&dA&&(z+=_&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof R!="string"?(be=[],be.size=1/0):be=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let X=i.sharedLength||0;if(X>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let j=0;j<X;j++){let ct=i[j];if(!ct)continue;let tt,ht=i.transitions;for(let G=0,K=ct.length;G<K;G++){let bt=ct[G];tt=ht[bt],tt||(tt=ht[bt]=Object.create(null)),ht=tt}ht[Cs]=j+64}this.lastNamedStructuresLength=X}c||(i.nextId=X+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&R&&R.constructor&&R.constructor===Object?M(R):O(R);let X=be;if(be&&qm(n,O,0),s&&s.idsToInsert){let j=s.idsToInsert.sort((G,K)=>G.offset>K.offset?1:-1),ct=j.length,tt=-1;for(;X&&ct>0;){let G=j[--ct].offset+n;G<X.stringsPosition+n&&tt===-1&&(tt=0),G>X.position+n?tt>=0&&(tt+=6):(tt>=0&&(he.setUint32(X.position+n,he.getUint32(X.position+n)+tt),tt=-1),X=X.previous,ct++)}tt>=0&&X&&he.setUint32(X.position+n,he.getUint32(X.position+n)+tt),z+=j.length*6,z>cn&&P(z),a.offset=z;let ht=cA(V.subarray(n,z),j);return s=null,ht}return a.offset=z,_&hA?(V.start=n,V.end=z,V):V.subarray(n,z)}catch(X){throw B=X,X}finally{if(i&&(v(),r&&a.saveStructures)){let X=i.sharedLength||0,j=V.subarray(n,z),ct=lA(i,a);if(!B)return a.saveStructures(ct,ct.isCompatible)===!1?a.pack(R,_):(a.lastNamedStructuresLength=X,V.length>1073741824&&(V=null),j)}V.length>1073741824&&(V=null),_&fA&&(z=n)}};const v=()=>{w<10&&w++;let R=i.sharedLength||0;if(i.length>R&&!c&&(i.length=R),E>1e4)i.transitions=null,w=0,E=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let _=0,B=g.length;_<B;_++)g[_][Cs]=0;g=[]}},A=R=>{var _=R.length;_<16?V[z++]=144|_:_<65536?(V[z++]=220,V[z++]=_>>8,V[z++]=_&255):(V[z++]=221,he.setUint32(z,_),z+=4);for(let B=0;B<_;B++)O(R[B])},O=R=>{z>cn&&(V=P(z));var _=typeof R,B;if(_==="string"){let X=R.length;if(be&&X>=4&&X<4096){if((be.size+=X)>iA){let ht,G=(be[0]?be[0].length*3+be[1].length:0)+10;z+G>cn&&(V=P(z+G));let K;be.position?(K=be,V[z]=200,z+=3,V[z++]=98,ht=z-n,z+=4,qm(n,O,0),he.setUint16(ht+n-3,z-n-ht)):(V[z++]=214,V[z++]=98,ht=z-n,z+=4),be=["",""],be.previous=K,be.size=0,be.position=ht}let tt=sA.test(R);be[tt?0:1]+=R,V[z++]=193,O(tt?-X:X);return}let j;X<32?j=1:X<256?j=2:X<65536?j=3:j=5;let ct=X*3;if(z+ct>cn&&(V=P(z+ct)),X<64||!o){let tt,ht,G,K=z+j;for(tt=0;tt<X;tt++)ht=R.charCodeAt(tt),ht<128?V[K++]=ht:ht<2048?(V[K++]=ht>>6|192,V[K++]=ht&63|128):(ht&64512)===55296&&((G=R.charCodeAt(tt+1))&64512)===56320?(ht=65536+((ht&1023)<<10)+(G&1023),tt++,V[K++]=ht>>18|240,V[K++]=ht>>12&63|128,V[K++]=ht>>6&63|128,V[K++]=ht&63|128):(V[K++]=ht>>12|224,V[K++]=ht>>6&63|128,V[K++]=ht&63|128);B=K-z-j}else B=o(R,z+j);B<32?V[z++]=160|B:B<256?(j<2&&V.copyWithin(z+2,z+1,z+1+B),V[z++]=217,V[z++]=B):B<65536?(j<3&&V.copyWithin(z+3,z+2,z+2+B),V[z++]=218,V[z++]=B>>8,V[z++]=B&255):(j<5&&V.copyWithin(z+5,z+3,z+3+B),V[z++]=219,he.setUint32(z,B),z+=4),z+=B}else if(_==="number")if(R>>>0===R)R<32||R<128&&this.useRecords===!1||R<64&&!this.randomAccessStructure?V[z++]=R:R<256?(V[z++]=204,V[z++]=R):R<65536?(V[z++]=205,V[z++]=R>>8,V[z++]=R&255):(V[z++]=206,he.setUint32(z,R),z+=4);else if(R>>0===R)R>=-32?V[z++]=256+R:R>=-128?(V[z++]=208,V[z++]=R+256):R>=-32768?(V[z++]=209,he.setInt16(z,R),z+=2):(V[z++]=210,he.setInt32(z,R),z+=4);else{let X;if((X=this.useFloat32)>0&&R<4294967296&&R>=-2147483648){V[z++]=202,he.setFloat32(z,R);let j;if(X<4||(j=R*bh[(V[z]&127)<<1|V[z+1]>>7])>>0===j){z+=4;return}else z--}V[z++]=203,he.setFloat64(z,R),z+=8}else if(_==="object"||_==="function")if(!R)V[z++]=192;else{if(s){let j=s.get(R);if(j){if(!j.id){let ct=s.idsToInsert||(s.idsToInsert=[]);j.id=ct.push(j)}V[z++]=214,V[z++]=112,he.setUint32(z,j.id),z+=4;return}else s.set(R,{offset:z-n})}let X=R.constructor;if(X===Object)D(R);else if(X===Array)A(R);else if(X===Map)if(this.mapAsEmptyObject)V[z++]=128;else{B=R.size,B<16?V[z++]=128|B:B<65536?(V[z++]=222,V[z++]=B>>8,V[z++]=B&255):(V[z++]=223,he.setUint32(z,B),z+=4);for(let[j,ct]of R)O(j),O(ct)}else{for(let j=0,ct=wh.length;j<ct;j++){let tt=Wm[j];if(R instanceof tt){let ht=wh[j];if(ht.write){ht.type&&(V[z++]=212,V[z++]=ht.type,V[z++]=0);let at=ht.write.call(this,R);at===R?Array.isArray(R)?A(R):D(R):O(at);return}let G=V,K=he,bt=z;V=null;let st;try{st=ht.pack.call(this,R,at=>(V=G,G=null,z+=at,z>cn&&P(z),{target:V,targetView:he,position:z-at}),O)}finally{G&&(V=G,he=K,z=bt,cn=V.length-10)}st&&(st.length+z>cn&&P(st.length+z),z=aA(st,V,z,ht.type));return}}if(Array.isArray(R))A(R);else{if(R.toJSON){const j=R.toJSON();if(j!==R)return O(j)}if(_==="function")return O(this.writeFunction&&this.writeFunction(R));D(R)}}}else if(_==="boolean")V[z++]=R?195:194;else if(_==="bigint"){if(R<BigInt(1)<<BigInt(63)&&R>=-(BigInt(1)<<BigInt(63)))V[z++]=211,he.setBigInt64(z,R);else if(R<BigInt(1)<<BigInt(64)&&R>0)V[z++]=207,he.setBigUint64(z,R);else if(this.largeBigIntToFloat)V[z++]=203,he.setFloat64(z,Number(R));else{if(this.largeBigIntToString)return O(R.toString());if(this.useBigIntExtension&&R<BigInt(2)**BigInt(1023)&&R>-(BigInt(2)**BigInt(1023))){V[z++]=199,z++,V[z++]=66;let X=[],j;do{let ct=R&BigInt(255);j=(ct&BigInt(128))===(R<BigInt(0)?BigInt(128):BigInt(0)),X.push(ct),R>>=BigInt(8)}while(!((R===BigInt(0)||R===BigInt(-1))&&j));V[z-2]=X.length;for(let ct=X.length;ct>0;)V[z++]=Number(X[--ct]);return}else throw new RangeError(R+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}z+=8}else if(_==="undefined")this.encodeUndefinedAsNil?V[z++]=192:(V[z++]=212,V[z++]=0,V[z++]=0);else throw new Error("Unknown type: "+_)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?R=>{let _;if(this.skipValues){_=[];for(let j in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(j))&&!this.skipValues.includes(R[j])&&_.push(j)}else _=Object.keys(R);let B=_.length;B<16?V[z++]=128|B:B<65536?(V[z++]=222,V[z++]=B>>8,V[z++]=B&255):(V[z++]=223,he.setUint32(z,B),z+=4);let X;if(this.coercibleKeyAsNumber)for(let j=0;j<B;j++){X=_[j];let ct=Number(X);O(isNaN(ct)?X:ct),O(R[X])}else for(let j=0;j<B;j++)O(X=_[j]),O(R[X])}:R=>{V[z++]=222;let _=z-n;z+=2;let B=0;for(let X in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(X))&&(O(X),O(R[X]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');V[_+++n]=B>>8,V[_+n]=B&255},L=this.useRecords===!1?U:t.progressiveRecords&&!f?R=>{let _,B=i.transitions||(i.transitions=Object.create(null)),X=z++-n,j;for(let ct in R)if(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(ct)){if(_=B[ct],_)B=_;else{let tt=Object.keys(R),ht=B;B=i.transitions;let G=0;for(let K=0,bt=tt.length;K<bt;K++){let st=tt[K];_=B[st],_||(_=B[st]=Object.create(null),G++),B=_}X+n+1==z?(z--,et(B,tt,G)):dt(B,tt,X,G),j=!0,B=ht[ct]}O(R[ct])}if(!j){let ct=B[Cs];ct?V[X+n]=ct:dt(B,Object.keys(R),X,0)}}:R=>{let _,B=i.transitions||(i.transitions=Object.create(null)),X=0;for(let ct in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(ct))&&(_=B[ct],_||(_=B[ct]=Object.create(null),X++),B=_);let j=B[Cs];j?j>=96&&f?(V[z++]=((j-=96)&31)+96,V[z++]=j>>5):V[z++]=j:et(B,B.__keys__||Object.keys(R),X);for(let ct in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(ct))&&O(R[ct])},N=typeof this.useRecords=="function"&&this.useRecords,D=N?R=>{N(R)?L(R):U(R)}:L,P=R=>{let _;if(R>16777216){if(R-n>Hm)throw new Error("Packed buffer would be larger than maximum buffer size");_=Math.min(Hm,Math.round(Math.max((R-n)*(R>67108864?1.25:2),4194304)/4096)*4096)}else _=(Math.max(R-n<<2,V.length-1)>>12)+1<<12;let B=new yc(_);return he=B.dataView||(B.dataView=new DataView(B.buffer,0,_)),R=Math.min(R,V.length),V.copy?V.copy(B,0,n,R):B.set(V.slice(n,R)),z-=n,n=0,cn=B.length-10,V=B},et=(R,_,B)=>{let X=i.nextId;X||(X=64),X<d&&this.shouldShareStructure&&!this.shouldShareStructure(_)?(X=i.nextOwnId,X<p||(X=d),i.nextOwnId=X+1):(X>=p&&(X=d),i.nextId=X+1);let j=_.highByte=X>=96&&f?X-96>>5:-1;R[Cs]=X,R.__keys__=_,i[X-64]=_,X<d?(_.isShared=!0,i.sharedLength=X-63,r=!0,j>=0?(V[z++]=(X&31)+96,V[z++]=j):V[z++]=X):(j>=0?(V[z++]=213,V[z++]=114,V[z++]=(X&31)+96,V[z++]=j):(V[z++]=212,V[z++]=114,V[z++]=X),B&&(E+=w*B),g.length>=h&&(g.shift()[Cs]=0),g.push(R),O(_))},dt=(R,_,B,X)=>{let j=V,ct=z,tt=cn,ht=n;V=Co,z=0,n=0,V||(Co=V=new yc(8192)),cn=V.length-10,et(R,_,X),Co=V;let G=z;if(V=j,z=ct,cn=tt,n=ht,G>1){let K=z+G-1;K>cn&&P(K);let bt=B+n;V.copyWithin(bt+G,bt+1,z),V.set(Co.slice(0,G),bt),z=K}else V[B+n]=Co[0]},M=R=>{let _=rA(R,V,n,z,i,P,(B,X,j)=>{if(j)return r=!0;z=X;let ct=V;return O(B),v(),ct!==V?{position:z,targetView:he,target:V}:z},this);if(_===0)return D(R);z=_}}useBuffer(t){V=t,V.dataView||(V.dataView=new DataView(V.buffer,V.byteOffset,V.byteLength)),z=0}set position(t){z=t}get position(){return z}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Wm=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Sm],wh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Ym(e,16,t):Vm(gc?Je.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Gm&&this.moreTypes?Ym(e,zm.indexOf(n.name),t):Vm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Ym(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Vm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function aA(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function cA(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function qm(e,t,n){if(be.length>0){he.setUint32(be.position+e,z+n-be.position-e),be.stringsPosition=z-e;let r=be;be=null,t(r[0]),t(r[1])}}function lA(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Jm=new oA({useRecords:!1});const uA=Jm.pack;Jm.pack;const hA=512,fA=1024,dA=2048;function Xi(){return null}function Lo(e,t,n={}){if(!T(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];T(c)&&(a=c(a));const u=t[o];T(u)&&(o=u),a!==null&&r.push(o,a)}return r}function Mo(e,t,n={}){if(T(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];T(a)&&(s=a);const c=n[s];T(c)&&(o=c(o)),r[s]=o}return r}catch(r){se(H,"binary",r.message)}}function pA(e){try{const t=dr(e);return uA(t)}catch(t){se(H,"binary",t.message)}}function mA(e){try{return eA(e)}catch(t){se(H,"binary",t.message)}}function Xm(){return{id:Te()}}var Eh=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e))(Eh||{});function _c(e){return Lo(e,Eh,{category:Xi,kinddata:Xi})}function bc(e){return Mo(e,Eh)}function Th(e){var t;return((t=e==null?void 0:e.id)==null?void 0:t.length)??!1}function wc(e,t){if(!T(e)||!gn(t))return;const{color:n,bg:r}=wm(t);T(n)&&(e.color=n),T(r)&&(e.bg=r)}function Uo(e){var t;return Dt((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function Zm(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function Qm(e){const t=Math.floor(e.length/ec);if(t*ec!==e.length){se(H,"size","wrong number of bytes for a palette");return}const n=Zm(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function gA(e,t){return e&1<<t?255:0}function tg(e){const t=Math.floor(e.length/th);if(t*th!==e.length){se(H,"size","wrong number of bytes for a charset");return}const n=Math.ceil(t/ic),r=nc*ic,i=Zm(r,rc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*rc+a,l=e[c];for(let h=0;h<nc;++h){const f=s*nc+h;i.bits[f+u*r]=gA(l,7-h)}++a,a===rc&&(a=0,++s,s===ic&&(s=0,++o))}return i}const yA=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),_A=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);var eg=typeof gs=="object"&&gs&&gs.Object===Object&&gs,bA=typeof self=="object"&&self&&self.Object===Object&&self,Sr=eg||bA||Function("return this")(),Wn=Sr.Symbol,ng=Object.prototype,wA=ng.hasOwnProperty,EA=ng.toString,Po=Wn?Wn.toStringTag:void 0;function TA(e){var t=wA.call(e,Po),n=e[Po];try{e[Po]=void 0;var r=!0}catch{}var i=EA.call(e);return r&&(t?e[Po]=n:delete e[Po]),i}var vA=Object.prototype,kA=vA.toString;function AA(e){return kA.call(e)}var xA="[object Null]",SA="[object Undefined]",rg=Wn?Wn.toStringTag:void 0;function xi(e){return e==null?e===void 0?SA:xA:rg&&rg in Object(e)?TA(e):AA(e)}function rr(e){return e!=null&&typeof e=="object"}var RA="[object Symbol]";function Ec(e){return typeof e=="symbol"||rr(e)&&xi(e)==RA}function Tc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var qt=Array.isArray,IA=1/0,ig=Wn?Wn.prototype:void 0,sg=ig?ig.toString:void 0;function og(e){if(typeof e=="string")return e;if(qt(e))return Tc(e,og)+"";if(Ec(e))return sg?sg.call(e):"";var t=e+"";return t=="0"&&1/e==-IA?"-0":t}var OA=/\s/;function NA(e){for(var t=e.length;t--&&OA.test(e.charAt(t)););return t}var CA=/^\s+/;function LA(e){return e&&e.slice(0,NA(e)+1).replace(CA,"")}function Gn(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var ag=NaN,MA=/^[-+]0x[0-9a-f]+$/i,UA=/^0b[01]+$/i,PA=/^0o[0-7]+$/i,BA=parseInt;function FA(e){if(typeof e=="number")return e;if(Ec(e))return ag;if(Gn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Gn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=LA(e);var n=UA.test(e);return n||PA.test(e)?BA(e.slice(2),n?2:8):MA.test(e)?ag:+e}var cg=1/0,DA=17976931348623157e292;function $A(e){if(!e)return e===0?e:0;if(e=FA(e),e===cg||e===-cg){var t=e<0?-1:1;return t*DA}return e===e?e:0}function vc(e){var t=$A(e),n=t%1;return t===t?n?t-n:t:0}function Ls(e){return e}var jA="[object AsyncFunction]",zA="[object Function]",KA="[object GeneratorFunction]",WA="[object Proxy]";function Qr(e){if(!Gn(e))return!1;var t=xi(e);return t==zA||t==KA||t==jA||t==WA}var vh=Sr["__core-js_shared__"],lg=function(){var e=/[^.]+$/.exec(vh&&vh.keys&&vh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function GA(e){return!!lg&&lg in e}var HA=Function.prototype,YA=HA.toString;function Zi(e){if(e!=null){try{return YA.call(e)}catch{}try{return e+""}catch{}}return""}var VA=/[\\^$.*+?()[\]{}|]/g,qA=/^\[object .+?Constructor\]$/,JA=Function.prototype,XA=Object.prototype,ZA=JA.toString,QA=XA.hasOwnProperty,tx=RegExp("^"+ZA.call(QA).replace(VA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ex(e){if(!Gn(e)||GA(e))return!1;var t=Qr(e)?tx:qA;return t.test(Zi(e))}function nx(e,t){return e==null?void 0:e[t]}function Qi(e,t){var n=nx(e,t);return ex(n)?n:void 0}var kh=Qi(Sr,"WeakMap"),ug=Object.create,rx=function(){function e(){}return function(t){if(!Gn(t))return{};if(ug)return ug(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function ix(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function De(){}function sx(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var ox=800,ax=16,cx=Date.now;function lx(e){var t=0,n=0;return function(){var r=cx(),i=ax-(r-n);if(n=r,i>0){if(++t>=ox)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function ux(e){return function(){return e}}var kc=function(){try{var e=Qi(Object,"defineProperty");return e({},"",{}),e}catch{}}(),hx=kc?function(e,t){return kc(e,"toString",{configurable:!0,enumerable:!1,value:ux(t),writable:!0})}:Ls,fx=lx(hx);function hg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function fg(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function dx(e){return e!==e}function px(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function Ah(e,t,n){return t===t?px(e,t,n):fg(e,dx,n)}function dg(e,t){var n=e==null?0:e.length;return!!n&&Ah(e,t,0)>-1}var mx=9007199254740991,gx=/^(?:0|[1-9]\d*)$/;function Ac(e,t){var n=typeof e;return t=t??mx,!!t&&(n=="number"||n!="symbol"&&gx.test(e))&&e>-1&&e%1==0&&e<t}function xh(e,t,n){t=="__proto__"&&kc?kc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Bo(e,t){return e===t||e!==e&&t!==t}var yx=Object.prototype,_x=yx.hasOwnProperty;function xc(e,t,n){var r=e[t];(!(_x.call(e,t)&&Bo(r,n))||n===void 0&&!(t in e))&&xh(e,t,n)}function Sh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?xh(n,a,c):xc(n,a,c)}return n}var pg=Math.max;function bx(e,t,n){return t=pg(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=pg(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),ix(e,this,a)}}function Rh(e,t){return fx(bx(e,t,Ls),e+"")}var wx=9007199254740991;function Ih(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=wx}function Rr(e){return e!=null&&Ih(e.length)&&!Qr(e)}function mg(e,t,n){if(!Gn(n))return!1;var r=typeof t;return(r=="number"?Rr(n)&&Ac(t,n.length):r=="string"&&t in n)?Bo(n[t],e):!1}function Ex(e){return Rh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&mg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var Tx=Object.prototype;function Fo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Tx;return e===n}function vx(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var kx="[object Arguments]";function gg(e){return rr(e)&&xi(e)==kx}var yg=Object.prototype,Ax=yg.hasOwnProperty,xx=yg.propertyIsEnumerable,Sc=gg(function(){return arguments}())?gg:function(e){return rr(e)&&Ax.call(e,"callee")&&!xx.call(e,"callee")};function Sx(){return!1}var _g=typeof exports=="object"&&exports&&!exports.nodeType&&exports,bg=_g&&typeof module=="object"&&module&&!module.nodeType&&module,Rx=bg&&bg.exports===_g,wg=Rx?Sr.Buffer:void 0,Ix=wg?wg.isBuffer:void 0,Do=Ix||Sx,Ox="[object Arguments]",Nx="[object Array]",Cx="[object Boolean]",Lx="[object Date]",Mx="[object Error]",Ux="[object Function]",Px="[object Map]",Bx="[object Number]",Fx="[object Object]",Dx="[object RegExp]",$x="[object Set]",jx="[object String]",zx="[object WeakMap]",Kx="[object ArrayBuffer]",Wx="[object DataView]",Gx="[object Float32Array]",Hx="[object Float64Array]",Yx="[object Int8Array]",Vx="[object Int16Array]",qx="[object Int32Array]",Jx="[object Uint8Array]",Xx="[object Uint8ClampedArray]",Zx="[object Uint16Array]",Qx="[object Uint32Array]",me={};me[Gx]=me[Hx]=me[Yx]=me[Vx]=me[qx]=me[Jx]=me[Xx]=me[Zx]=me[Qx]=!0,me[Ox]=me[Nx]=me[Kx]=me[Cx]=me[Wx]=me[Lx]=me[Mx]=me[Ux]=me[Px]=me[Bx]=me[Fx]=me[Dx]=me[$x]=me[jx]=me[zx]=!1;function t2(e){return rr(e)&&Ih(e.length)&&!!me[xi(e)]}function Rc(e){return function(t){return e(t)}}var Eg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,$o=Eg&&typeof module=="object"&&module&&!module.nodeType&&module,e2=$o&&$o.exports===Eg,Oh=e2&&eg.process,Si=function(){try{var e=$o&&$o.require&&$o.require("util").types;return e||Oh&&Oh.binding&&Oh.binding("util")}catch{}}(),Tg=Si&&Si.isTypedArray,Nh=Tg?Rc(Tg):t2,n2=Object.prototype,r2=n2.hasOwnProperty;function vg(e,t){var n=qt(e),r=!n&&Sc(e),i=!n&&!r&&Do(e),s=!n&&!r&&!i&&Nh(e),o=n||r||i||s,a=o?vx(e.length,String):[],c=a.length;for(var u in e)(t||r2.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Ac(u,c)))&&a.push(u);return a}function kg(e,t){return function(n){return e(t(n))}}var i2=kg(Object.keys,Object),s2=Object.prototype,o2=s2.hasOwnProperty;function Ag(e){if(!Fo(e))return i2(e);var t=[];for(var n in Object(e))o2.call(e,n)&&n!="constructor"&&t.push(n);return t}function Hn(e){return Rr(e)?vg(e):Ag(e)}var a2=Object.prototype,c2=a2.hasOwnProperty,_n=Ex(function(e,t){if(Fo(t)||Rr(t)){Sh(t,Hn(t),e);return}for(var n in t)c2.call(t,n)&&xc(e,n,t[n])});function l2(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var u2=Object.prototype,h2=u2.hasOwnProperty;function f2(e){if(!Gn(e))return l2(e);var t=Fo(e),n=[];for(var r in e)r=="constructor"&&(t||!h2.call(e,r))||n.push(r);return n}function xg(e){return Rr(e)?vg(e,!0):f2(e)}var d2=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p2=/^\w*$/;function Ch(e,t){if(qt(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Ec(e)?!0:p2.test(e)||!d2.test(e)||t!=null&&e in Object(t)}var jo=Qi(Object,"create");function m2(){this.__data__=jo?jo(null):{},this.size=0}function g2(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var y2="__lodash_hash_undefined__",_2=Object.prototype,b2=_2.hasOwnProperty;function w2(e){var t=this.__data__;if(jo){var n=t[e];return n===y2?void 0:n}return b2.call(t,e)?t[e]:void 0}var E2=Object.prototype,T2=E2.hasOwnProperty;function v2(e){var t=this.__data__;return jo?t[e]!==void 0:T2.call(t,e)}var k2="__lodash_hash_undefined__";function A2(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=jo&&t===void 0?k2:t,this}function ts(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ts.prototype.clear=m2,ts.prototype.delete=g2,ts.prototype.get=w2,ts.prototype.has=v2,ts.prototype.set=A2;function x2(){this.__data__=[],this.size=0}function Ic(e,t){for(var n=e.length;n--;)if(Bo(e[n][0],t))return n;return-1}var S2=Array.prototype,R2=S2.splice;function I2(e){var t=this.__data__,n=Ic(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():R2.call(t,n,1),--this.size,!0}function O2(e){var t=this.__data__,n=Ic(t,e);return n<0?void 0:t[n][1]}function N2(e){return Ic(this.__data__,e)>-1}function C2(e,t){var n=this.__data__,r=Ic(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function ti(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ti.prototype.clear=x2,ti.prototype.delete=I2,ti.prototype.get=O2,ti.prototype.has=N2,ti.prototype.set=C2;var zo=Qi(Sr,"Map");function L2(){this.size=0,this.__data__={hash:new ts,map:new(zo||ti),string:new ts}}function M2(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Oc(e,t){var n=e.__data__;return M2(t)?n[typeof t=="string"?"string":"hash"]:n.map}function U2(e){var t=Oc(this,e).delete(e);return this.size-=t?1:0,t}function P2(e){return Oc(this,e).get(e)}function B2(e){return Oc(this,e).has(e)}function F2(e,t){var n=Oc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function ei(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ei.prototype.clear=L2,ei.prototype.delete=U2,ei.prototype.get=P2,ei.prototype.has=B2,ei.prototype.set=F2;var D2="Expected a function";function Lh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(D2);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Lh.Cache||ei),n}Lh.Cache=ei;var $2=500;function j2(e){var t=Lh(e,function(r){return n.size===$2&&n.clear(),r}),n=t.cache;return t}var z2=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,K2=/\\(\\)?/g,W2=j2(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(z2,function(n,r,i,s){t.push(i?s.replace(K2,"$1"):r||n)}),t});function Sg(e){return e==null?"":og(e)}function Nc(e,t){return qt(e)?e:Ch(e,t)?[e]:W2(Sg(e))}var G2=1/0;function Ko(e){if(typeof e=="string"||Ec(e))return e;var t=e+"";return t=="0"&&1/e==-G2?"-0":t}function Mh(e,t){t=Nc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Ko(t[n++])];return n&&n==r?e:void 0}function H2(e,t,n){var r=e==null?void 0:Mh(e,t);return r===void 0?n:r}function Uh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Rg=Wn?Wn.isConcatSpreadable:void 0;function Y2(e){return qt(e)||Sc(e)||!!(Rg&&e&&e[Rg])}function Ph(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=Y2),i||(i=[]);++s<o;){var a=e[s];n(a)?Uh(i,a):r||(i[i.length]=a)}return i}function Nn(e){var t=e==null?0:e.length;return t?Ph(e):[]}var Ig=kg(Object.getPrototypeOf,Object);function Bh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function V2(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Bh(e,t,n)}var q2="\\ud800-\\udfff",J2="\\u0300-\\u036f",X2="\\ufe20-\\ufe2f",Z2="\\u20d0-\\u20ff",Q2=J2+X2+Z2,tS="\\ufe0e\\ufe0f",eS="\\u200d",nS=RegExp("["+eS+q2+Q2+tS+"]");function Og(e){return nS.test(e)}function rS(e){return e.split("")}var Ng="\\ud800-\\udfff",iS="\\u0300-\\u036f",sS="\\ufe20-\\ufe2f",oS="\\u20d0-\\u20ff",aS=iS+sS+oS,cS="\\ufe0e\\ufe0f",lS="["+Ng+"]",Fh="["+aS+"]",Dh="\\ud83c[\\udffb-\\udfff]",uS="(?:"+Fh+"|"+Dh+")",Cg="[^"+Ng+"]",Lg="(?:\\ud83c[\\udde6-\\uddff]){2}",Mg="[\\ud800-\\udbff][\\udc00-\\udfff]",hS="\\u200d",Ug=uS+"?",Pg="["+cS+"]?",fS="(?:"+hS+"(?:"+[Cg,Lg,Mg].join("|")+")"+Pg+Ug+")*",dS=Pg+Ug+fS,pS="(?:"+[Cg+Fh+"?",Fh,Lg,Mg,lS].join("|")+")",mS=RegExp(Dh+"(?="+Dh+")|"+pS+dS,"g");function gS(e){return e.match(mS)||[]}function yS(e){return Og(e)?gS(e):rS(e)}function _S(e){return function(t){t=Sg(t);var n=Og(t)?yS(t):void 0,r=n?n[0]:t.charAt(0),i=n?V2(n,1).join(""):t.slice(1);return r[e]()+i}}var Bg=_S("toUpperCase");function bS(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function wS(){this.__data__=new ti,this.size=0}function ES(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function TS(e){return this.__data__.get(e)}function vS(e){return this.__data__.has(e)}var kS=200;function AS(e,t){var n=this.__data__;if(n instanceof ti){var r=n.__data__;if(!zo||r.length<kS-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ei(r)}return n.set(e,t),this.size=n.size,this}function Ir(e){var t=this.__data__=new ti(e);this.size=t.size}Ir.prototype.clear=wS,Ir.prototype.delete=ES,Ir.prototype.get=TS,Ir.prototype.has=vS,Ir.prototype.set=AS;function xS(e,t){return e&&Sh(t,Hn(t),e)}var Fg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Dg=Fg&&typeof module=="object"&&module&&!module.nodeType&&module,SS=Dg&&Dg.exports===Fg,$g=SS?Sr.Buffer:void 0,jg=$g?$g.allocUnsafe:void 0;function RS(e,t){var n=e.length,r=jg?jg(n):new e.constructor(n);return e.copy(r),r}function $h(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function zg(){return[]}var IS=Object.prototype,OS=IS.propertyIsEnumerable,Kg=Object.getOwnPropertySymbols,jh=Kg?function(e){return e==null?[]:(e=Object(e),$h(Kg(e),function(t){return OS.call(e,t)}))}:zg;function NS(e,t){return Sh(e,jh(e),t)}var CS=Object.getOwnPropertySymbols,LS=CS?function(e){for(var t=[];e;)Uh(t,jh(e)),e=Ig(e);return t}:zg;function Wg(e,t,n){var r=t(e);return qt(e)?r:Uh(r,n(e))}function zh(e){return Wg(e,Hn,jh)}function MS(e){return Wg(e,xg,LS)}var Kh=Qi(Sr,"DataView"),Wh=Qi(Sr,"Promise"),Ms=Qi(Sr,"Set"),Gg="[object Map]",US="[object Object]",Hg="[object Promise]",Yg="[object Set]",Vg="[object WeakMap]",qg="[object DataView]",PS=Zi(Kh),BS=Zi(zo),FS=Zi(Wh),DS=Zi(Ms),$S=Zi(kh),Yn=xi;(Kh&&Yn(new Kh(new ArrayBuffer(1)))!=qg||zo&&Yn(new zo)!=Gg||Wh&&Yn(Wh.resolve())!=Hg||Ms&&Yn(new Ms)!=Yg||kh&&Yn(new kh)!=Vg)&&(Yn=function(e){var t=xi(e),n=t==US?e.constructor:void 0,r=n?Zi(n):"";if(r)switch(r){case PS:return qg;case BS:return Gg;case FS:return Hg;case DS:return Yg;case $S:return Vg}return t});var jS=Object.prototype,zS=jS.hasOwnProperty;function KS(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&zS.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Cc=Sr.Uint8Array;function WS(e){var t=new e.constructor(e.byteLength);return new Cc(t).set(new Cc(e)),t}function GS(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var HS=/\w*$/;function YS(e){var t=new e.constructor(e.source,HS.exec(e));return t.lastIndex=e.lastIndex,t}var Jg=Wn?Wn.prototype:void 0,Xg=Jg?Jg.valueOf:void 0;function VS(e){return Xg?Object(Xg.call(e)):{}}function qS(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var JS="[object Boolean]",XS="[object Date]",ZS="[object Map]",QS="[object Number]",tR="[object RegExp]",eR="[object Set]",nR="[object String]",rR="[object Symbol]",iR="[object ArrayBuffer]",sR="[object DataView]",oR="[object Float32Array]",aR="[object Float64Array]",cR="[object Int8Array]",lR="[object Int16Array]",uR="[object Int32Array]",hR="[object Uint8Array]",fR="[object Uint8ClampedArray]",dR="[object Uint16Array]",pR="[object Uint32Array]";function mR(e,t,n){var r=e.constructor;switch(t){case iR:return WS(e);case JS:case XS:return new r(+e);case sR:return GS(e);case oR:case aR:case cR:case lR:case uR:case hR:case fR:case dR:case pR:return qS(e);case ZS:return new r;case QS:case nR:return new r(e);case tR:return YS(e);case eR:return new r;case rR:return VS(e)}}function gR(e){return typeof e.constructor=="function"&&!Fo(e)?rx(Ig(e)):{}}var yR="[object Map]";function _R(e){return rr(e)&&Yn(e)==yR}var Zg=Si&&Si.isMap,bR=Zg?Rc(Zg):_R,wR="[object Set]";function ER(e){return rr(e)&&Yn(e)==wR}var Qg=Si&&Si.isSet,TR=Qg?Rc(Qg):ER,ty="[object Arguments]",vR="[object Array]",kR="[object Boolean]",AR="[object Date]",xR="[object Error]",ey="[object Function]",SR="[object GeneratorFunction]",RR="[object Map]",IR="[object Number]",ny="[object Object]",OR="[object RegExp]",NR="[object Set]",CR="[object String]",LR="[object Symbol]",MR="[object WeakMap]",UR="[object ArrayBuffer]",PR="[object DataView]",BR="[object Float32Array]",FR="[object Float64Array]",DR="[object Int8Array]",$R="[object Int16Array]",jR="[object Int32Array]",zR="[object Uint8Array]",KR="[object Uint8ClampedArray]",WR="[object Uint16Array]",GR="[object Uint32Array]",fe={};fe[ty]=fe[vR]=fe[UR]=fe[PR]=fe[kR]=fe[AR]=fe[BR]=fe[FR]=fe[DR]=fe[$R]=fe[jR]=fe[RR]=fe[IR]=fe[ny]=fe[OR]=fe[NR]=fe[CR]=fe[LR]=fe[zR]=fe[KR]=fe[WR]=fe[GR]=!0,fe[xR]=fe[ey]=fe[MR]=!1;function Lc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!Gn(e))return e;var a=qt(e);if(a)return o=KS(e),sx(e,o);var c=Yn(e),u=c==ey||c==SR;if(Do(e))return RS(e);if(c==ny||c==ty||u&&!i)return o=u?{}:gR(e),NS(e,xS(o,e));if(!fe[c])return i?e:{};o=mR(e,c),s||(s=new Ir);var l=s.get(e);if(l)return l;s.set(e,o),TR(e)?e.forEach(function(d){o.add(Lc(d,t,n,d,e,s))}):bR(e)&&e.forEach(function(d,p){o.set(p,Lc(d,t,n,p,e,s))});var h=zh,f=a?void 0:h(e);return hg(f||e,function(d,p){f&&(p=d,d=e[p]),xc(o,p,Lc(d,t,n,p,e,s))}),o}var HR=4;function Xe(e){return Lc(e,HR)}function Wo(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var YR="__lodash_hash_undefined__";function VR(e){return this.__data__.set(e,YR),this}function qR(e){return this.__data__.has(e)}function Us(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new ei;++t<n;)this.add(e[t])}Us.prototype.add=Us.prototype.push=VR,Us.prototype.has=qR;function ry(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Gh(e,t){return e.has(t)}var JR=1,XR=2;function iy(e,t,n,r,i,s){var o=n&JR,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,f=!0,d=n&XR?new Us:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],g=t[h];if(r)var E=o?r(g,p,h,t,e,s):r(p,g,h,e,t,s);if(E!==void 0){if(E)continue;f=!1;break}if(d){if(!ry(t,function(w,v){if(!Gh(d,v)&&(p===w||i(p,w,n,r,s)))return d.push(v)})){f=!1;break}}else if(!(p===g||i(p,g,n,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}function ZR(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Hh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var QR=1,tI=2,eI="[object Boolean]",nI="[object Date]",rI="[object Error]",iI="[object Map]",sI="[object Number]",oI="[object RegExp]",aI="[object Set]",cI="[object String]",lI="[object Symbol]",uI="[object ArrayBuffer]",hI="[object DataView]",sy=Wn?Wn.prototype:void 0,Yh=sy?sy.valueOf:void 0;function fI(e,t,n,r,i,s,o){switch(n){case hI:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case uI:return!(e.byteLength!=t.byteLength||!s(new Cc(e),new Cc(t)));case eI:case nI:case sI:return Bo(+e,+t);case rI:return e.name==t.name&&e.message==t.message;case oI:case cI:return e==t+"";case iI:var a=ZR;case aI:var c=r&QR;if(a||(a=Hh),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=tI,o.set(e,t);var l=iy(a(e),a(t),r,i,s,o);return o.delete(e),l;case lI:if(Yh)return Yh.call(e)==Yh.call(t)}return!1}var dI=1,pI=Object.prototype,mI=pI.hasOwnProperty;function gI(e,t,n,r,i,s){var o=n&dI,a=zh(e),c=a.length,u=zh(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in t:mI.call(t,f)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var g=!0;s.set(e,t),s.set(t,e);for(var E=o;++h<c;){f=a[h];var w=e[f],v=t[f];if(r)var A=o?r(v,w,f,t,e,s):r(w,v,f,e,t,s);if(!(A===void 0?w===v||i(w,v,n,r,s):A)){g=!1;break}E||(E=f=="constructor")}if(g&&!E){var O=e.constructor,U=t.constructor;O!=U&&"constructor"in e&&"constructor"in t&&!(typeof O=="function"&&O instanceof O&&typeof U=="function"&&U instanceof U)&&(g=!1)}return s.delete(e),s.delete(t),g}var yI=1,oy="[object Arguments]",ay="[object Array]",Mc="[object Object]",_I=Object.prototype,cy=_I.hasOwnProperty;function bI(e,t,n,r,i,s){var o=qt(e),a=qt(t),c=o?ay:Yn(e),u=a?ay:Yn(t);c=c==oy?Mc:c,u=u==oy?Mc:u;var l=c==Mc,h=u==Mc,f=c==u;if(f&&Do(e)){if(!Do(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Ir),o||Nh(e)?iy(e,t,n,r,i,s):fI(e,t,c,n,r,i,s);if(!(n&yI)){var d=l&&cy.call(e,"__wrapped__"),p=h&&cy.call(t,"__wrapped__");if(d||p){var g=d?e.value():e,E=p?t.value():t;return s||(s=new Ir),i(g,E,n,r,s)}}return f?(s||(s=new Ir),gI(e,t,n,r,i,s)):!1}function Vh(e,t,n,r,i){return e===t?!0:e==null||t==null||!rr(e)&&!rr(t)?e!==e&&t!==t:bI(e,t,n,r,Vh,i)}var wI=1,EI=2;function TI(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Ir,h;if(!(h===void 0?Vh(u,c,wI|EI,r,l):h))return!1}}return!0}function ly(e){return e===e&&!Gn(e)}function vI(e){for(var t=Hn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,ly(i)]}return t}function uy(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function kI(e){var t=vI(e);return t.length==1&&t[0][2]?uy(t[0][0],t[0][1]):function(n){return n===e||TI(n,e,t)}}function AI(e,t){return e!=null&&t in Object(e)}function hy(e,t,n){t=Nc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=Ko(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Ih(i)&&Ac(o,i)&&(qt(e)||Sc(e)))}function xI(e,t){return e!=null&&hy(e,t,AI)}var SI=1,RI=2;function II(e,t){return Ch(e)&&ly(t)?uy(Ko(e),t):function(n){var r=H2(n,e);return r===void 0&&r===t?xI(n,e):Vh(t,r,SI|RI)}}function OI(e){return function(t){return t==null?void 0:t[e]}}function NI(e){return function(t){return Mh(t,e)}}function CI(e){return Ch(e)?OI(Ko(e)):NI(e)}function Or(e){return typeof e=="function"?e:e==null?Ls:typeof e=="object"?qt(e)?II(e[0],e[1]):kI(e):CI(e)}function LI(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function MI(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var UI=MI();function PI(e,t){return e&&UI(e,t,Hn)}function BI(e,t){return function(n,r){if(n==null)return n;if(!Rr(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var es=BI(PI);function FI(e,t,n,r){return es(e,function(i,s,o){t(r,i,n(i),o)}),r}function DI(e,t){return function(n,r){var i=qt(n)?LI:FI,s=t?t():{};return i(n,e,Or(r),s)}}var fy=Object.prototype,$I=fy.hasOwnProperty,qh=Rh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&mg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=xg(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Bo(l,fy[u])&&!$I.call(e,u))&&(e[u]=s[u])}return e});function dy(e){return rr(e)&&Rr(e)}var jI=200;function zI(e,t,n,r){var i=-1,s=dg,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=jI&&(s=Gh,o=!1,t=new Us(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var Uc=Rh(function(e,t){return dy(e)?zI(e,Ph(t,1,dy,!0)):[]});function Ps(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function Ze(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:vc(t),Bh(e,t<0?0:t,r)):[]}function Go(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:vc(t),t=r-t,Bh(e,0,t<0?0:t)):[]}function KI(e){return typeof e=="function"?e:Ls}function St(e,t){var n=qt(e)?hg:es;return n(e,KI(t))}function WI(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function GI(e,t){var n=!0;return es(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function ir(e,t,n){var r=qt(e)?WI:GI;return r(e,Or(t))}function py(e,t){var n=[];return es(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function Vn(e,t){var n=qt(e)?$h:py;return n(e,Or(t))}function HI(e){return function(t,n,r){var i=Object(t);if(!Rr(t)){var s=Or(n);t=Hn(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var YI=Math.max;function VI(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:vc(n);return i<0&&(i=YI(r+i,0)),fg(e,Or(t),i)}var Bs=HI(VI);function sr(e){return e&&e.length?e[0]:void 0}function qI(e,t){var n=-1,r=Rr(e)?Array(e.length):[];return es(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function Et(e,t){var n=qt(e)?Tc:qI;return n(e,Or(t))}function qn(e,t){return Ph(Et(e,t))}var JI=Object.prototype,XI=JI.hasOwnProperty,my=DI(function(e,t,n){XI.call(e,n)?e[n].push(t):xh(e,n,[t])}),ZI=Object.prototype,QI=ZI.hasOwnProperty;function tO(e,t){return e!=null&&QI.call(e,t)}function At(e,t){return e!=null&&hy(e,t,tO)}var eO="[object String]";function bn(e){return typeof e=="string"||!qt(e)&&rr(e)&&xi(e)==eO}function nO(e,t){return Tc(t,function(n){return e[n]})}function Ne(e){return e==null?[]:nO(e,Hn(e))}var rO=Math.max;function ln(e,t,n,r){e=Rr(e)?e:Ne(e),n=n&&!r?vc(n):0;var i=e.length;return n<0&&(n=rO(i+n,0)),bn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Ah(e,t,n)>-1}function gy(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return Ah(e,t,i)}var iO="[object Map]",sO="[object Set]",oO=Object.prototype,aO=oO.hasOwnProperty;function de(e){if(e==null)return!0;if(Rr(e)&&(qt(e)||typeof e=="string"||typeof e.splice=="function"||Do(e)||Nh(e)||Sc(e)))return!e.length;var t=Yn(e);if(t==iO||t==sO)return!e.size;if(Fo(e))return!Ag(e).length;for(var n in e)if(aO.call(e,n))return!1;return!0}var cO="[object RegExp]";function lO(e){return rr(e)&&xi(e)==cO}var yy=Si&&Si.isRegExp,ni=yy?Rc(yy):lO;function ri(e){return e===void 0}var uO="Expected a function";function hO(e){if(typeof e!="function")throw new TypeError(uO);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function fO(e,t,n,r){if(!Gn(e))return e;t=Nc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Ko(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=Gn(l)?l:Ac(t[i+1])?[]:{})}xc(a,c,u),a=a[c]}return e}function dO(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Mh(e,o);n(a,o)&&fO(s,Nc(o,e),a)}return s}function or(e,t){if(e==null)return{};var n=Tc(MS(e),function(r){return[r]});return t=Or(t),dO(e,n,function(r,i){return t(r,i[0])})}function pO(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function wn(e,t,n){var r=qt(e)?bS:pO,i=arguments.length<3;return r(e,Or(t),n,i,es)}function Pc(e,t){var n=qt(e)?$h:py;return n(e,hO(Or(t)))}function mO(e,t){var n;return es(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Jh(e,t,n){var r=qt(e)?ry:mO;return r(e,Or(t))}var gO=1/0,yO=Ms&&1/Hh(new Ms([,-0]))[1]==gO?function(e){return new Ms(e)}:De,_O=200;function bO(e,t,n){var r=-1,i=dg,s=e.length,o=!0,a=[],c=a;if(s>=_O){var u=yO(e);if(u)return Hh(u);o=!1,i=Gh,c=new Us}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Bc(e){return e&&e.length?bO(e):[]}function Xh(e){console&&console.error&&console.error(`Error: ${e}`)}function _y(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function by(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function wy(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function wO(e){return EO(e)?e.LABEL:e.name}function EO(e){return bn(e.LABEL)&&e.LABEL!==""}class Nr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),St(this.definition,n=>{n.accept(t)})}}class En extends Nr{constructor(t){super([]),this.idx=1,_n(this,or(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class Fs extends Nr{constructor(t){super(t.definition),this.orgText="",_n(this,or(t,n=>n!==void 0))}}class Tn extends Nr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,_n(this,or(t,n=>n!==void 0))}}class vn extends Nr{constructor(t){super(t.definition),this.idx=1,_n(this,or(t,n=>n!==void 0))}}class Cr extends Nr{constructor(t){super(t.definition),this.idx=1,_n(this,or(t,n=>n!==void 0))}}class Lr extends Nr{constructor(t){super(t.definition),this.idx=1,_n(this,or(t,n=>n!==void 0))}}class $e extends Nr{constructor(t){super(t.definition),this.idx=1,_n(this,or(t,n=>n!==void 0))}}class ar extends Nr{constructor(t){super(t.definition),this.idx=1,_n(this,or(t,n=>n!==void 0))}}class cr extends Nr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,_n(this,or(t,n=>n!==void 0))}}class we{constructor(t){this.idx=1,_n(this,or(t,n=>n!==void 0))}accept(t){t.visit(this)}}function TO(e){return Et(e,Fc)}function Fc(e){function t(n){return Et(n,Fc)}if(e instanceof En){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return bn(e.label)&&(n.label=e.label),n}else{if(e instanceof Tn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof vn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Cr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Lr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Fc(new we({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof ar)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Fc(new we({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof $e)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof cr)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof we){const n={type:"Terminal",name:e.terminalType.name,label:wO(e.terminalType),idx:e.idx};bn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=ni(r)?r.source:r),n}else{if(e instanceof Fs)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class ns{visit(t){const n=t;switch(n.constructor){case En:return this.visitNonTerminal(n);case Tn:return this.visitAlternative(n);case vn:return this.visitOption(n);case Cr:return this.visitRepetitionMandatory(n);case Lr:return this.visitRepetitionMandatoryWithSeparator(n);case ar:return this.visitRepetitionWithSeparator(n);case $e:return this.visitRepetition(n);case cr:return this.visitAlternation(n);case we:return this.visitTerminal(n);case Fs:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function vO(e){return e instanceof Tn||e instanceof vn||e instanceof $e||e instanceof Cr||e instanceof Lr||e instanceof ar||e instanceof we||e instanceof Fs}function Dc(e,t=[]){return e instanceof vn||e instanceof $e||e instanceof ar?!0:e instanceof cr?Jh(e.definition,r=>Dc(r,t)):e instanceof En&&ln(t,e)?!1:e instanceof Nr?(e instanceof En&&t.push(e),ir(e.definition,r=>Dc(r,t))):!1}function kO(e){return e instanceof cr}function Mr(e){if(e instanceof En)return"SUBRULE";if(e instanceof vn)return"OPTION";if(e instanceof cr)return"OR";if(e instanceof Cr)return"AT_LEAST_ONE";if(e instanceof Lr)return"AT_LEAST_ONE_SEP";if(e instanceof ar)return"MANY_SEP";if(e instanceof $e)return"MANY";if(e instanceof we)return"CONSUME";throw Error("non exhaustive match")}class $c{walk(t,n=[]){St(t.definition,(r,i)=>{const s=Ze(t.definition,i+1);if(r instanceof En)this.walkProdRef(r,s,n);else if(r instanceof we)this.walkTerminal(r,s,n);else if(r instanceof Tn)this.walkFlat(r,s,n);else if(r instanceof vn)this.walkOption(r,s,n);else if(r instanceof Cr)this.walkAtLeastOne(r,s,n);else if(r instanceof Lr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof ar)this.walkManySep(r,s,n);else if(r instanceof $e)this.walkMany(r,s,n);else if(r instanceof cr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new vn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=Ey(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new vn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=Ey(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);St(t.definition,s=>{const o=new Tn({definition:[s]});this.walk(o,i)})}}function Ey(e,t,n){return[new vn({definition:[new we({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function Ho(e){if(e instanceof En)return Ho(e.referencedRule);if(e instanceof we)return SO(e);if(vO(e))return AO(e);if(kO(e))return xO(e);throw Error("non exhaustive match")}function AO(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Dc(s),t=t.concat(Ho(s)),r=r+1,i=n.length>r;return Bc(t)}function xO(e){const t=Et(e.definition,n=>Ho(n));return Bc(Nn(t))}function SO(e){return[e.terminalType]}const Ty="_~IN~_";class RO extends $c{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=OO(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Tn({definition:s}),a=Ho(o);this.follows[i]=a}}function IO(e){const t={};return St(e,n=>{const r=new RO(n).startWalking();_n(t,r)}),t}function OO(e,t){return e.name+t+Ty}function Rt(e){return e.charCodeAt(0)}function Zh(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function Yo(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function Ds(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function NO(){throw Error("Internal Error - Should never get here!")}function vy(e){return e.type==="Character"}const jc=[];for(let e=Rt("0");e<=Rt("9");e++)jc.push(e);const zc=[Rt("_")].concat(jc);for(let e=Rt("a");e<=Rt("z");e++)zc.push(e);for(let e=Rt("A");e<=Rt("Z");e++)zc.push(e);const ky=[Rt(" "),Rt("\f"),Rt(`
`),Rt("\r"),Rt("	"),Rt("\v"),Rt("	"),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt(""),Rt("\u2028"),Rt("\u2029"),Rt(""),Rt(""),Rt(""),Rt("\uFEFF")],CO=/[0-9a-fA-F]/,Kc=/[0-9]/,LO=/[1-9]/;class MO{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Yo(r,"global");break;case"i":Yo(r,"ignoreCase");break;case"m":Yo(r,"multiLine");break;case"u":Yo(r,"unicode");break;case"y":Yo(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Ds(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return NO()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;Ds(n);break}if(!(t===!0&&n===void 0)&&Ds(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),Ds(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Rt(`
`),Rt("\r"),Rt("\u2028"),Rt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=jc;break;case"D":t=jc,n=!0;break;case"s":t=ky;break;case"S":t=ky,n=!0;break;case"w":t=zc;break;case"W":t=zc,n=!0;break}if(Ds(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Rt("\f");break;case"n":t=Rt(`
`);break;case"r":t=Rt("\r");break;case"t":t=Rt("	");break;case"v":t=Rt("\v");break}if(Ds(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Rt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Rt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Rt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,vy(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,vy(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else Zh(r.value,t),t.push(Rt("-")),Zh(i.value,t)}else Zh(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Rt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(LO.test(t)===!1)throw Error("Expecting a positive integer");for(;Kc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Kc.test(t)===!1)throw Error("Expecting an integer");for(;Kc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Rt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Kc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(CO.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Qh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Wc={};const UO=new MO;function Gc(e){const t=e.toString();if(Wc.hasOwnProperty(t))return Wc[t];{const n=UO.pattern(t);return Wc[t]=n,n}}function PO(){Wc={}}const Ay="Complement Sets are not supported for first char optimization",Hc=`Unable to use "first char" lexer optimizations:
`;function BO(e,t=!1){try{const n=Gc(e);return tf(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Ay)t&&_y(`${Hc}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Xh(`${Hc}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function tf(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)tf(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Yc(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(Ay);St(o.value,c=>{if(typeof c=="number")Yc(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Yc(l,t,n);else{for(let l=u.from;l<=u.to&&l<qo;l++)Yc(l,t,n);if(u.to>=qo){const l=u.from>=qo?u.from:qo,h=u.to,f=Ri(l),d=Ri(h);for(let p=f;p<=d;p++)t[p]=p}}}});break;case"Group":tf(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&ef(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ne(t)}function Yc(e,t,n){const r=Ri(e);t[r]=r,n===!0&&FO(e,t)}function FO(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Ri(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Ri(i.charCodeAt(0));t[s]=s}}}function xy(e,t){return Bs(e.value,n=>{if(typeof n=="number")return ln(t,n);{const r=n;return Bs(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function ef(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?qt(e.value)?ir(e.value,ef):ef(e.value):!1}class DO extends Qh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){ln(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?xy(t,this.targetCharCodes)===void 0&&(this.found=!0):xy(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function nf(e,t){if(t instanceof RegExp){const n=Gc(t),r=new DO(e);return r.visit(n),r.found}else return Bs(t,n=>ln(e,n.charCodeAt(0)))!==void 0}const rs="PATTERN",Vo="defaultMode",Vc="modes";let Sy=typeof new RegExp("(?:)").sticky=="boolean";function $O(e,t){t=qh(t,{useSticky:Sy,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,A)=>A()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{lN()});let r;n("Reject Lexer.NA",()=>{r=Pc(e,v=>v[rs]===je.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Et(r,v=>{const A=v[rs];if(ni(A)){const O=A.source;return O.length===1&&O!=="^"&&O!=="$"&&O!=="."&&!A.ignoreCase?O:O.length===2&&O[0]==="\\"&&!ln(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],O[1])?O[1]:t.useSticky?Iy(A):Ry(A)}else{if(Qr(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const O=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(O);return t.useSticky?Iy(U):Ry(U)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=Et(r,v=>v.tokenTypeIdx),a=Et(r,v=>{const A=v.GROUP;if(A!==je.SKIPPED){if(bn(A))return A;if(ri(A))return!1;throw Error("non exhaustive match")}}),c=Et(r,v=>{const A=v.LONGER_ALT;if(A)return qt(A)?Et(A,U=>gy(r,U)):[gy(r,A)]}),u=Et(r,v=>v.PUSH_MODE),l=Et(r,v=>At(v,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const v=Cy(t.lineTerminatorCharacters);h=Et(r,A=>!1),t.positionTracking!=="onlyOffset"&&(h=Et(r,A=>At(A,"LINE_BREAKS")?!!A.LINE_BREAKS:Ny(A,v)===!1&&nf(v,A.PATTERN)))});let f,d,p,g;n("Misc Mapping #2",()=>{f=Et(r,Oy),d=Et(s,oN),p=wn(r,(v,A)=>{const O=A.GROUP;return bn(O)&&O!==je.SKIPPED&&(v[O]=[]),v},{}),g=Et(s,(v,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:f[A],short:d[A],group:a[A],push:u[A],pop:l[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let E=!0,w=[];return t.safeMode||n("First Char Optimization",()=>{w=wn(r,(v,A,O)=>{if(typeof A.PATTERN=="string"){const U=A.PATTERN.charCodeAt(0),L=Ri(U);rf(v,L,g[O])}else if(qt(A.START_CHARS_HINT)){let U;St(A.START_CHARS_HINT,L=>{const N=typeof L=="string"?L.charCodeAt(0):L,D=Ri(N);U!==D&&(U=D,rf(v,D,g[O]))})}else if(ni(A.PATTERN))if(A.PATTERN.unicode)E=!1,t.ensureOptimizations&&Xh(`${Hc}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=BO(A.PATTERN,t.ensureOptimizations);de(U)&&(E=!1),St(U,L=>{rf(v,L,g[O])})}else t.ensureOptimizations&&Xh(`${Hc}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),E=!1;return v},[])}),{emptyGroups:p,patternIdxToConfig:g,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:E}}function jO(e,t){let n=[];const r=KO(e);n=n.concat(r.errors);const i=WO(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(zO(s)),n=n.concat(ZO(s)),n=n.concat(QO(s,t)),n=n.concat(tN(s)),n}function zO(e){let t=[];const n=Vn(e,r=>ni(r[rs]));return t=t.concat(HO(n)),t=t.concat(qO(n)),t=t.concat(JO(n)),t=t.concat(XO(n)),t=t.concat(YO(n)),t}function KO(e){const t=Vn(e,i=>!At(i,rs)),n=Et(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ae.MISSING_PATTERN,tokenTypes:[i]})),r=Uc(e,t);return{errors:n,valid:r}}function WO(e){const t=Vn(e,i=>{const s=i[rs];return!ni(s)&&!Qr(s)&&!At(s,"exec")&&!bn(s)}),n=Et(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ae.INVALID_PATTERN,tokenTypes:[i]})),r=Uc(e,t);return{errors:n,valid:r}}const GO=/[^\\][$]/;function HO(e){class t extends Qh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Vn(e,i=>{const s=i.PATTERN;try{const o=Gc(s),a=new t;return a.visit(o),a.found}catch{return GO.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ae.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function YO(e){const t=Vn(e,r=>r.PATTERN.test(""));return Et(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ae.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const VO=/[^\\[][\^]|^\^/;function qO(e){class t extends Qh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Vn(e,i=>{const s=i.PATTERN;try{const o=Gc(s),a=new t;return a.visit(o),a.found}catch{return VO.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ae.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function JO(e){const t=Vn(e,r=>{const i=r[rs];return i instanceof RegExp&&(i.multiline||i.global)});return Et(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ae.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function XO(e){const t=[];let n=Et(e,s=>wn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!ln(t,a)&&a.PATTERN!==je.NA&&(t.push(a),o.push(a)),o),[]));n=Wo(n);const r=Vn(n,s=>s.length>1);return Et(r,s=>{const o=Et(s,c=>c.name);return{message:`The same RegExp pattern ->${sr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ae.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function ZO(e){const t=Vn(e,r=>{if(!At(r,"GROUP"))return!1;const i=r.GROUP;return i!==je.SKIPPED&&i!==je.NA&&!bn(i)});return Et(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ae.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function QO(e,t){const n=Vn(e,i=>i.PUSH_MODE!==void 0&&!ln(t,i.PUSH_MODE));return Et(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ae.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function tN(e){const t=[],n=wn(e,(r,i,s)=>{const o=i.PATTERN;return o===je.NA||(bn(o)?r.push({str:o,idx:s,tokenType:i}):ni(o)&&nN(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return St(e,(r,i)=>{St(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&eN(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Ae.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function eN(e,t){if(ni(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(Qr(t))return t(e,0,[],{});if(At(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function nN(e){return Bs([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Ry(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Iy(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function rN(e,t,n){const r=[];return At(e,Vo)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Vo+`> property in its definition
`,type:Ae.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),At(e,Vc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Vc+`> property in its definition
`,type:Ae.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),At(e,Vc)&&At(e,Vo)&&!At(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Vo}: <${e.defaultMode}>which does not exist
`,type:Ae.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),At(e,Vc)&&St(e.modes,(i,s)=>{St(i,(o,a)=>{if(ri(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ae.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(At(o,"LONGER_ALT")){const c=qt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];St(c,u=>{!ri(u)&&!ln(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ae.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function iN(e,t,n){const r=[];let i=!1;const s=Wo(Nn(Ne(e.modes))),o=Pc(s,c=>c[rs]===je.NA),a=Cy(n);return t&&St(o,c=>{const u=Ny(c,a);if(u!==!1){const h={message:cN(c,u),type:u.issue,tokenType:c};r.push(h)}else At(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):nf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ae.NO_LINE_BREAKS_FLAGS}),r}function sN(e){const t={},n=Hn(e);return St(n,r=>{const i=e[r];if(qt(i))t[r]=[];else throw Error("non exhaustive match")}),t}function Oy(e){const t=e.PATTERN;if(ni(t))return!1;if(Qr(t))return!0;if(At(t,"exec"))return!0;if(bn(t))return!1;throw Error("non exhaustive match")}function oN(e){return bn(e)&&e.length===1?e.charCodeAt(0):!1}const aN={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Ny(e,t){if(At(e,"LINE_BREAKS"))return!1;if(ni(e.PATTERN)){try{nf(t,e.PATTERN)}catch(n){return{issue:Ae.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(bn(e.PATTERN))return!1;if(Oy(e))return{issue:Ae.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function cN(e,t){if(t.issue===Ae.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Ae.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Cy(e){return Et(e,n=>bn(n)?n.charCodeAt(0):n)}function rf(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const qo=256;let qc=[];function Ri(e){return e<qo?e:qc[e]}function lN(){if(de(qc)){qc=new Array(65536);for(let e=0;e<65536;e++)qc[e]=e>255?255+~~(e/255):e}}function Jo(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function Jc(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let Ly=1;const My={};function Xo(e){const t=uN(e);hN(t),dN(t),fN(t),St(t,n=>{n.isParent=n.categoryMatches.length>0})}function uN(e){let t=Xe(e),n=e,r=!0;for(;r;){n=Wo(Nn(Et(n,s=>s.CATEGORIES)));const i=Uc(n,t);t=t.concat(i),de(i)?r=!1:n=i}return t}function hN(e){St(e,t=>{Py(t)||(My[Ly]=t,t.tokenTypeIdx=Ly++),By(t)&&!qt(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),By(t)||(t.CATEGORIES=[]),pN(t)||(t.categoryMatches=[]),mN(t)||(t.categoryMatchesMap={})})}function fN(e){St(e,t=>{t.categoryMatches=[],St(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(My[r].tokenTypeIdx)})})}function dN(e){St(e,t=>{Uy([],t)})}function Uy(e,t){St(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),St(t.CATEGORIES,n=>{const r=e.concat(t);ln(r,n)||Uy(r,n)})}function Py(e){return At(e,"tokenTypeIdx")}function By(e){return At(e,"CATEGORIES")}function pN(e){return At(e,"categoryMatches")}function mN(e){return At(e,"categoryMatchesMap")}function gN(e){return At(e,"tokenTypeIdx")}const yN={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Ae;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ae||(Ae={}));const Zo={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:yN,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Zo);let je=class{constructor(t,n=Zo){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=by(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=_n({},Zo,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Zo.lineTerminatorsPattern)this.config.lineTerminatorsPattern=aN;else if(this.config.lineTerminatorCharacters===Zo.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),qt(t)?i={modes:{defaultMode:Xe(t)},defaultMode:Vo}:(s=!1,i=Xe(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(rN(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(iN(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},St(i.modes,(a,c)=>{i.modes[c]=Pc(a,u=>ri(u))});const o=Hn(i.modes);if(St(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(jO(a,o))}),de(this.lexerDefinitionErrors)){Xo(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=$O(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=_n({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!de(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Et(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}St(this.lexerDefinitionWarning,a=>{_y(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Sy?(this.chopInput=Ls,this.match=this.matchWithTest):(this.updateLastIndex=De,this.match=this.matchWithExec),s&&(this.handleModes=De),this.trackStartLines===!1&&(this.computeNewColumn=Ls),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=De),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=wn(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!de(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{PO()}),this.TRACE_INIT("toFastProperties",()=>{wy(this)})})}tokenize(t,n=this.defaultMode){if(!de(this.lexerDefinitionErrors)){const i=Et(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,f,d,p,g,E,w;const v=t,A=v.length;let O=0,U=0;const L=this.hasCustom?0:Math.floor(t.length/10),N=new Array(L),D=[];let P=this.trackStartLines?1:void 0,et=this.trackStartLines?1:void 0;const dt=sN(this.emptyGroups),M=this.trackStartLines,R=this.config.lineTerminatorsPattern;let _=0,B=[],X=[];const j=[],ct=[];Object.freeze(ct);let tt;function ht(){return B}function G(Ct){const Jt=Ri(Ct),Nt=X[Jt];return Nt===void 0?ct:Nt}const K=Ct=>{if(j.length===1&&Ct.tokenType.PUSH_MODE===void 0){const Jt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ct);D.push({offset:Ct.startOffset,line:Ct.startLine,column:Ct.startColumn,length:Ct.image.length,message:Jt})}else{j.pop();const Jt=Ps(j);B=this.patternIdxToConfig[Jt],X=this.charCodeToPatternIdxToConfig[Jt],_=B.length;const Nt=this.canModeBeOptimized[Jt]&&this.config.safeMode===!1;X&&Nt?tt=G:tt=ht}};function bt(Ct){j.push(Ct),X=this.charCodeToPatternIdxToConfig[Ct],B=this.patternIdxToConfig[Ct],_=B.length,_=B.length;const Jt=this.canModeBeOptimized[Ct]&&this.config.safeMode===!1;X&&Jt?tt=G:tt=ht}bt.call(this,n);let st;const at=this.config.recoveryEnabled;for(;O<A;){c=null;const Ct=v.charCodeAt(O),Jt=tt(Ct),Nt=Jt.length;for(r=0;r<Nt;r++){st=Jt[r];const It=st.pattern;u=null;const re=st.short;if(re!==!1?Ct===re&&(c=It):st.isCustom===!0?(w=It.exec(v,O,N,dt),w!==null?(c=w[0],w.payload!==void 0&&(u=w.payload)):c=null):(this.updateLastIndex(It,O),c=this.match(It,t,O)),c!==null){if(a=st.longerAlt,a!==void 0){const $t=a.length;for(s=0;s<$t;s++){const ge=B[a[s]],Se=ge.pattern;if(l=null,ge.isCustom===!0?(w=Se.exec(v,O,N,dt),w!==null?(o=w[0],w.payload!==void 0&&(l=w.payload)):o=null):(this.updateLastIndex(Se,O),o=this.match(Se,t,O)),o&&o.length>c.length){c=o,u=l,st=ge;break}}}break}}if(c!==null){if(h=c.length,f=st.group,f!==void 0&&(d=st.tokenTypeIdx,p=this.createTokenInstance(c,O,d,st.tokenType,P,et,h),this.handlePayload(p,u),f===!1?U=this.addToken(N,U,p):dt[f].push(p)),t=this.chopInput(t,h),O=O+h,et=this.computeNewColumn(et,h),M===!0&&st.canLineTerminator===!0){let It=0,re,$t;R.lastIndex=0;do re=R.test(c),re===!0&&($t=R.lastIndex-1,It++);while(re===!0);It!==0&&(P=P+It,et=h-$t,this.updateTokenEndLineColumnLocation(p,f,$t,It,P,et,h))}this.handleModes(st,K,bt,p)}else{const It=O,re=P,$t=et;let ge=at===!1;for(;ge===!1&&O<A;)for(t=this.chopInput(t,1),O++,i=0;i<_;i++){const Se=B[i],b=Se.pattern,rt=Se.short;if(rt!==!1?v.charCodeAt(O)===rt&&(ge=!0):Se.isCustom===!0?ge=b.exec(v,O,N,dt)!==null:(this.updateLastIndex(b,O),ge=b.exec(t)!==null),ge===!0)break}if(g=O-It,et=this.computeNewColumn(et,g),E=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,It,g,re,$t),D.push({offset:It,line:re,column:$t,length:g,message:E}),at===!1)break}}return this.hasCustom||(N.length=U),{tokens:N,groups:dt,errors:D}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};je.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",je.NA=/NOT_APPLICABLE/;function Qo(e){return Fy(e)?e.LABEL:e.name}function Fy(e){return bn(e.LABEL)&&e.LABEL!==""}const _N="parent",Dy="categories",$y="label",jy="group",zy="push_mode",Ky="pop_mode",Wy="longer_alt",Gy="line_breaks",Hy="start_chars_hint";function Cn(e){return bN(e)}function bN(e){const t=e.pattern,n={};if(n.name=e.name,ri(t)||(n.PATTERN=t),At(e,_N))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return At(e,Dy)&&(n.CATEGORIES=e[Dy]),Xo([n]),At(e,$y)&&(n.LABEL=e[$y]),At(e,jy)&&(n.GROUP=e[jy]),At(e,Ky)&&(n.POP_MODE=e[Ky]),At(e,zy)&&(n.PUSH_MODE=e[zy]),At(e,Wy)&&(n.LONGER_ALT=e[Wy]),At(e,Gy)&&(n.LINE_BREAKS=e[Gy]),At(e,Hy)&&(n.START_CHARS_HINT=e[Hy]),n}const is=Cn({name:"EOF",pattern:je.NA});Xo([is]);function Xc(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function wN(e,t){return Jo(e,t)}const Yy={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${Fy(e)?`--> ${Qo(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+sr(t).image+"'";if(r)return s+r+a;{const c=wn(e,(f,d)=>f.concat(d),[]),u=Et(c,f=>`[${Et(f,d=>Qo(d)).join(", ")}]`),h=`one of these possible Token sequences:
${Et(u,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+sr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Et(e,u=>`[${Et(u,l=>Qo(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Yy);const EN={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},ss={buildDuplicateFoundError(e,t){function n(l){return l instanceof we?l.terminalType.name:l instanceof En?l.nonTerminalName:""}const r=e.name,i=sr(t),s=i.idx,o=Mr(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Et(e.prefixPath,i=>Qo(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Et(e.prefixPath,i=>Qo(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Mr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=Et(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof Fs?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function TN(e,t){const n=new vN(e,t);return n.resolveRefs(),n.errors}class vN extends ns{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){St(Ne(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:un.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class kN extends $c{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Xe(this.path.ruleStack).reverse(),this.occurrenceStack=Xe(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){de(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class AN extends kN{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Tn({definition:i});this.possibleTokTypes=Ho(s),this.found=!0}}}class Zc extends $c{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class xN extends Zc{walkMany(t,n,r){if(t.idx===this.occurrence){const i=sr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof we&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class Vy extends Zc{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=sr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof we&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class SN extends Zc{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=sr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof we&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class qy extends Zc{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=sr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof we&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function sf(e,t,n=[]){n=Xe(n);let r=[],i=0;function s(a){return a.concat(Ze(e,i+1))}function o(a){const c=sf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Tn)return o(a.definition);if(a instanceof En)return o(a.definition);if(a instanceof vn)r=o(a.definition);else if(a instanceof Cr){const c=a.definition.concat([new $e({definition:a.definition})]);return o(c)}else if(a instanceof Lr){const c=[new Tn({definition:a.definition}),new $e({definition:[new we({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof ar){const c=a.definition.concat([new $e({definition:[new we({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof $e){const c=a.definition.concat([new $e({definition:a.definition})]);r=o(c)}else{if(a instanceof cr)return St(a.definition,c=>{de(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof we)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Ze(e,i)}),r}function Jy(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!de(h);){const f=h.pop();if(f===o){a&&Ps(h).idx<=u&&h.pop();continue}const d=f.def,p=f.idx,g=f.ruleStack,E=f.occurrenceStack;if(de(d))continue;const w=d[0];if(w===i){const v={idx:p,def:Ze(d),ruleStack:Go(g),occurrenceStack:Go(E)};h.push(v)}else if(w instanceof we)if(p<c-1){const v=p+1,A=t[v];if(n(A,w.terminalType)){const O={idx:v,def:Ze(d),ruleStack:g,occurrenceStack:E};h.push(O)}}else if(p===c-1)l.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:g,occurrenceStack:E}),a=!0;else throw Error("non exhaustive match");else if(w instanceof En){const v=Xe(g);v.push(w.nonTerminalName);const A=Xe(E);A.push(w.idx);const O={idx:p,def:w.definition.concat(s,Ze(d)),ruleStack:v,occurrenceStack:A};h.push(O)}else if(w instanceof vn){const v={idx:p,def:Ze(d),ruleStack:g,occurrenceStack:E};h.push(v),h.push(o);const A={idx:p,def:w.definition.concat(Ze(d)),ruleStack:g,occurrenceStack:E};h.push(A)}else if(w instanceof Cr){const v=new $e({definition:w.definition,idx:w.idx}),A=w.definition.concat([v],Ze(d)),O={idx:p,def:A,ruleStack:g,occurrenceStack:E};h.push(O)}else if(w instanceof Lr){const v=new we({terminalType:w.separator}),A=new $e({definition:[v].concat(w.definition),idx:w.idx}),O=w.definition.concat([A],Ze(d)),U={idx:p,def:O,ruleStack:g,occurrenceStack:E};h.push(U)}else if(w instanceof ar){const v={idx:p,def:Ze(d),ruleStack:g,occurrenceStack:E};h.push(v),h.push(o);const A=new we({terminalType:w.separator}),O=new $e({definition:[A].concat(w.definition),idx:w.idx}),U=w.definition.concat([O],Ze(d)),L={idx:p,def:U,ruleStack:g,occurrenceStack:E};h.push(L)}else if(w instanceof $e){const v={idx:p,def:Ze(d),ruleStack:g,occurrenceStack:E};h.push(v),h.push(o);const A=new $e({definition:w.definition,idx:w.idx}),O=w.definition.concat([A],Ze(d)),U={idx:p,def:O,ruleStack:g,occurrenceStack:E};h.push(U)}else if(w instanceof cr)for(let v=w.definition.length-1;v>=0;v--){const A=w.definition[v],O={idx:p,def:A.definition.concat(Ze(d)),ruleStack:g,occurrenceStack:E};h.push(O),h.push(o)}else if(w instanceof Tn)h.push({idx:p,def:w.definition.concat(Ze(d)),ruleStack:g,occurrenceStack:E});else if(w instanceof Fs)h.push(RN(w,p,g,E));else throw Error("non exhaustive match")}return l}function RN(e,t,n,r){const i=Xe(n);i.push(e.name);const s=Xe(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var xe;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(xe||(xe={}));function Xy(e){if(e instanceof vn||e==="Option")return xe.OPTION;if(e instanceof $e||e==="Repetition")return xe.REPETITION;if(e instanceof Cr||e==="RepetitionMandatory")return xe.REPETITION_MANDATORY;if(e instanceof Lr||e==="RepetitionMandatoryWithSeparator")return xe.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof ar||e==="RepetitionWithSeparator")return xe.REPETITION_WITH_SEPARATOR;if(e instanceof cr||e==="Alternation")return xe.ALTERNATION;throw Error("non exhaustive match")}function IN(e,t,n,r,i,s){const o=af(e,t,n),a=e_(o)?Jc:Jo;return s(o,r,a,i)}function ON(e,t,n,r,i,s){const o=cf(e,t,i,n),a=e_(o)?Jc:Jo;return s(o[0],a,r)}function NN(e,t,n,r){const i=e.length,s=ir(e,o=>ir(o,a=>a.length===1));if(t)return function(o){const a=Et(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let f=0;f<l;f++){const d=u[f],p=d.length;for(let g=0;g<p;g++){const E=this.LA(g+1);if(n(E,d[g])===!1)continue t}return c}}};if(s&&!r){const o=Et(e,c=>Nn(c)),a=wn(o,(c,u,l)=>(St(u,h=>{At(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),St(h.categoryMatches,f=>{At(c,f)||(c[f]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,l[f])===!1)continue t}return o}}}}function CN(e,t,n){const r=ir(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Nn(e);if(s.length===1&&de(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=wn(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,St(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class LN extends $c{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,xe.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,xe.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,xe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,xe.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,xe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Zy extends ns{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,xe.OPTION)}visitRepetition(t){this.checkIsTarget(t,xe.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,xe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,xe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,xe.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,xe.ALTERNATION)}}function Qy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function of(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function MN(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function t_(e,t){const n=Et(e,o=>sf([o],1)),r=Qy(n.length),i=Et(n,o=>{const a={};return St(o,c=>{const u=of(c.partialPath);St(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=Qy(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,f=u[l].suffixDef,d=of(h);if(MN(i,d,c)||de(f)||h.length===t){const g=r[c];if(lf(g,h)===!1){g.push(h);for(let E=0;E<d.length;E++){const w=d[E];i[c][w]=!0}}}else{const g=sf(f,o+1,h);s[c]=s[c].concat(g),St(g,E=>{const w=of(E.partialPath);St(w,v=>{i[c][v]=!0})})}}}}return r}function af(e,t,n,r){const i=new Zy(e,xe.ALTERNATION,r);return t.accept(i),t_(i.result,n)}function cf(e,t,n,r){const i=new Zy(e,n);t.accept(i);const s=i.result,a=new LN(t,e,n).startWalking(),c=new Tn({definition:s}),u=new Tn({definition:a});return t_([c,u],r)}function lf(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function UN(e,t){return e.length<t.length&&ir(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function e_(e){return ir(e,t=>ir(t,n=>ir(n,r=>de(r.categoryMatches))))}function PN(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Et(t,n=>Object.assign({type:un.CUSTOM_LOOKAHEAD_VALIDATION},n))}function BN(e,t,n,r){const i=qn(e,c=>FN(c,n)),s=JN(e,t,n),o=qn(e,c=>HN(c,n)),a=qn(e,c=>jN(c,e,r,n));return i.concat(s,o,a)}function FN(e,t){const n=new $N;e.accept(n);const r=n.allProductions,i=my(r,DN),s=or(i,a=>a.length>1);return Et(Ne(s),a=>{const c=sr(a),u=t.buildDuplicateFoundError(e,a),l=Mr(c),h={message:u,type:un.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},f=n_(c);return f&&(h.parameter=f),h})}function DN(e){return`${Mr(e)}_#_${e.idx}_#_${n_(e)}`}function n_(e){return e instanceof we?e.terminalType.name:e instanceof En?e.nonTerminalName:""}class $N extends ns{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function jN(e,t,n,r){const i=[];if(wn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:un.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function zN(e,t,n){const r=[];let i;return ln(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:un.INVALID_RULE_OVERRIDE,ruleName:e})),r}function r_(e,t,n,r=[]){const i=[],s=Qc(t.definition);if(de(s))return[];{const o=e.name;ln(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:un.LEFT_RECURSION,ruleName:o});const c=Uc(s,r.concat([e])),u=qn(c,l=>{const h=Xe(r);return h.push(l),r_(e,l,n,h)});return i.concat(u)}}function Qc(e){let t=[];if(de(e))return t;const n=sr(e);if(n instanceof En)t.push(n.referencedRule);else if(n instanceof Tn||n instanceof vn||n instanceof Cr||n instanceof Lr||n instanceof ar||n instanceof $e)t=t.concat(Qc(n.definition));else if(n instanceof cr)t=Nn(Et(n.definition,s=>Qc(s.definition)));else if(!(n instanceof we))throw Error("non exhaustive match");const r=Dc(n),i=e.length>1;if(r&&i){const s=Ze(e);return t.concat(Qc(s))}else return t}class uf extends ns{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function KN(e,t){const n=new uf;e.accept(n);const r=n.alternations;return qn(r,s=>{const o=Go(s.definition);return qn(o,(a,c)=>{const u=Jy([a],[],Jo,1);return de(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:un.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function WN(e,t,n){const r=new uf;e.accept(r);let i=r.alternations;return i=Pc(i,o=>o.ignoreAmbiguities===!0),qn(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=af(a,e,c,o),l=VN(u,o,e,n),h=qN(u,o,e,n);return l.concat(h)})}class GN extends ns{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function HN(e,t){const n=new uf;e.accept(n);const r=n.alternations;return qn(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:un.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function YN(e,t,n){const r=[];return St(e,i=>{const s=new GN;i.accept(s);const o=s.allProductions;St(o,a=>{const c=Xy(a),u=a.maxLookahead||t,l=a.idx,f=cf(l,i,c,u)[0];if(de(Nn(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:un.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function VN(e,t,n,r){const i=[],s=wn(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||St(c,l=>{const h=[u];St(e,(f,d)=>{u!==d&&lf(f,l)&&t.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!lf(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return Et(s,a=>{const c=Et(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:un.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function qN(e,t,n,r){const i=wn(e,(o,a,c)=>{const u=Et(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return Wo(qn(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=Vn(i,f=>t.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&UN(f.path,u));return Et(l,f=>{const d=[f.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:d,prefixPath:f.path}),type:un.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function JN(e,t,n){const r=[],i=Et(t,s=>s.name);return St(e,s=>{const o=s.name;if(ln(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:un.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function XN(e){const t=qh(e,{errMsgProvider:EN}),n={};return St(e.rules,r=>{n[r.name]=r}),TN(n,t.errMsgProvider)}function ZN(e){return e=qh(e,{errMsgProvider:ss}),BN(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const i_="MismatchedTokenException",s_="NoViableAltException",o_="EarlyExitException",a_="NotAllInputParsedException",c_=[i_,s_,o_,a_];Object.freeze(c_);function tl(e){return ln(c_,e.name)}class el extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class l_ extends el{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=i_}}class QN extends el{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=s_}}class tC extends el{constructor(t,n){super(t,n),this.name=a_}}class eC extends el{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=o_}}const hf={},u_="InRuleRecoveryException";class nC extends Error{constructor(t){super(t),this.name=u_}}class rC{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=At(t,"recoveryEnabled")?t.recoveryEnabled:ii.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=iC)}getTokenToInsert(t){const n=Xc(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:f,ruleName:this.getCurrRuleFullName()}),p=new l_(d,u,this.LA(0));p.resyncedTokens=Go(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new nC("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||de(n))return!1;const r=this.LA(1);return Bs(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return ln(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Bs(t,s=>wN(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return hf;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Et(t,(r,i)=>i===0?hf:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Et(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Nn(t)}getFollowSetFromFollowKey(t){if(t===hf)return[is];const n=t.ruleName+t.idxInCallingRule+Ty+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,is)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Go(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=Xe(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Et(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function iC(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=is,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const sC=4,Ii=8,h_=1<<Ii,f_=2<<Ii,ff=3<<Ii,df=4<<Ii,pf=5<<Ii,nl=6<<Ii;function mf(e,t,n){return n|t|e}class oC{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:ii.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(de(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return qn(t,n=>r_(n,n,ss))}validateEmptyOrAlternatives(t){return qn(t,n=>KN(n,ss))}validateAmbiguousAlternationAlternatives(t,n){return qn(t,r=>WN(r,n,ss))}validateSomeNonEmptyLookaheadPath(t,n){return YN(t,n,ss)}buildLookaheadForAlternation(t){return IN(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,NN)}buildLookaheadForOptional(t){return ON(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Xy(t.prodType),CN)}}class aC{initLooksAhead(t){this.dynamicTokensEnabled=At(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:ii.dynamicTokensEnabled,this.maxLookahead=At(t,"maxLookahead")?t.maxLookahead:ii.maxLookahead,this.lookaheadStrategy=At(t,"lookaheadStrategy")?t.lookaheadStrategy:new oC({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){St(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=lC(n);St(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Mr(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=mf(this.fullRuleNameToShort[n.name],h_,u.idx);this.setLaFuncCache(f,h)})}),St(i,u=>{this.computeLookaheadFunc(n,u.idx,ff,"Repetition",u.maxLookahead,Mr(u))}),St(s,u=>{this.computeLookaheadFunc(n,u.idx,f_,"Option",u.maxLookahead,Mr(u))}),St(o,u=>{this.computeLookaheadFunc(n,u.idx,df,"RepetitionMandatory",u.maxLookahead,Mr(u))}),St(a,u=>{this.computeLookaheadFunc(n,u.idx,nl,"RepetitionMandatoryWithSeparator",u.maxLookahead,Mr(u))}),St(c,u=>{this.computeLookaheadFunc(n,u.idx,pf,"RepetitionWithSeparator",u.maxLookahead,Mr(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=mf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return mf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class cC extends ns{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const rl=new cC;function lC(e){rl.reset(),e.accept(rl);const t=rl.dslMethods;return rl.reset(),t}function d_(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function p_(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function uC(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function hC(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const fC="name";function m_(e,t){Object.defineProperty(e,fC,{enumerable:!1,configurable:!0,writable:!1,value:t})}function dC(e,t){const n=Hn(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function pC(e,t){const n=function(){};m_(n,e+"BaseSemantics");const r={visit:function(i,s){if(qt(i)&&(i=i[0]),!ri(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=gC(this,t);if(!de(i)){const s=Et(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function mC(e,t,n){const r=function(){};m_(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return St(t,s=>{i[s]=dC}),r.prototype=i,r.prototype.constructor=r,r}var gf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(gf||(gf={}));function gC(e,t){return yC(e,t)}function yC(e,t){const n=Vn(t,i=>Qr(e[i])===!1),r=Et(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:gf.MISSING_METHOD,methodName:i}));return Wo(r)}class _C{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=At(t,"nodeLocationTracking")?t.nodeLocationTracking:ii.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=De,this.cstFinallyStateUpdate=De,this.cstPostTerminal=De,this.cstPostNonTerminal=De,this.cstPostRule=De;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=p_,this.setNodeLocationFromNode=p_,this.cstPostRule=De,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=De,this.setNodeLocationFromNode=De,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=d_,this.setNodeLocationFromNode=d_,this.cstPostRule=De,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=De,this.setNodeLocationFromNode=De,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=De,this.setNodeLocationFromNode=De,this.cstPostRule=De,this.setInitialNodeLocation=De;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];uC(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];hC(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(ri(this.baseCstVisitorConstructor)){const t=pC(this.className,Hn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ri(this.baseCstVisitorWithDefaultsConstructor)){const t=mC(this.className,Hn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class bC{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):ol}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?ol:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class wC{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=al){if(ln(this.definedRulesNames,t)){const o={message:ss.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:un.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=al){const i=zN(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(tl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return TO(Ne(this.gastProductionsCache))}}class EC{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Jc,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},At(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(qt(t)){if(de(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(qt(t))this.tokensMap=wn(t,(s,o)=>(s[o.name]=o,s),{});else if(At(t,"modes")&&ir(Nn(Ne(t.modes)),gN)){const s=Nn(Ne(t.modes)),o=Bc(s);this.tokensMap=wn(o,(a,c)=>(a[c.name]=c,a),{})}else if(Gn(t))this.tokensMap=Xe(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=is;const r=At(t,"modes")?Nn(Ne(t.modes)):Ne(t),i=ir(r,s=>de(s.categoryMatches));this.tokenMatcher=i?Jc:Jo,Xo(Ne(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=At(r,"resyncEnabled")?r.resyncEnabled:al.resyncEnabled,s=At(r,"recoveryValueFunc")?r.recoveryValueFunc:al.recoveryValueFunc,o=this.ruleShortNameIdx<<sC+Ii;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(tl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(f_,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(df,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,xe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,df,t,SN)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(nl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,qy],a,nl,t,qy)}else throw this.raiseEarlyExitException(t,xe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(ff,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,ff,t,xN,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(pf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Vy],a,pf,t,Vy)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,nl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(h_,n),i=qt(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new tC(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw tl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new l_(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===u_?r:s}}else throw r}saveRecogState(){const t=this.errors,n=Xe(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),is)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class TC{initErrorHandler(t){this._errors=[],this.errorMessageProvider=At(t,"errorMessageProvider")?t.errorMessageProvider:ii.errorMessageProvider}SAVE_ERROR(t){if(tl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Xe(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Xe(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=cf(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new eC(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=af(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new QN(c,this.LA(1),a))}}class vC{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(ri(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Jy([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=sr(t.ruleStack),i=this.getGAstProductions()[n];return new AN(i,t).startWalking()}}const il={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(il);const g_=!0,y_=Math.pow(2,Ii)-1,__=Cn({name:"RECORDING_PHASE_TOKEN",pattern:je.NA});Xo([__]);const b_=Xc(__,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(b_);const kC={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class AC{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return ol}topLevelRuleRecord(t,n){try{const r=new Fs({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return ta.call(this,vn,t,n)}atLeastOneInternalRecord(t,n){ta.call(this,Cr,n,t)}atLeastOneSepFirstInternalRecord(t,n){ta.call(this,Lr,n,t,g_)}manyInternalRecord(t,n){ta.call(this,$e,n,t)}manySepFirstInternalRecord(t,n){ta.call(this,ar,n,t,g_)}orInternalRecord(t,n){return xC.call(this,t,n)}subruleInternalRecord(t,n,r){if(sl(n),!t||At(t,"ruleName")===!1){const a=new Error(`<SUBRULE${w_(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Ps(this.recordingProdStack),s=t.ruleName,o=new En({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?kC:il}consumeInternalRecord(t,n,r){if(sl(n),!Py(t)){const o=new Error(`<CONSUME${w_(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Ps(this.recordingProdStack),s=new we({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),b_}}function ta(e,t,n,r=!1){sl(n);const i=Ps(this.recordingProdStack),s=Qr(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),At(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),il}function xC(e,t){sl(t);const n=Ps(this.recordingProdStack),r=qt(e)===!1,i=r===!1?e:e.DEF,s=new cr({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});At(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Jh(i,a=>Qr(a.GATE));return s.hasPredicates=o,n.definition.push(s),St(i,a=>{const c=new Tn({definition:[]});s.definition.push(c),At(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:At(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),il}function w_(e){return e===0?"":`${e}`}function sl(e){if(e<0||e>y_){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${y_+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class SC{initPerformanceTracer(t){if(At(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=ii.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=by(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function RC(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const ol=Xc(is,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(ol);const ii=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Yy,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),al=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var un;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(un||(un={}));let yf=class Eb{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{wy(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),St(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=XN({rules:Ne(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(de(r)&&this.skipValidations===!1){const i=ZN({rules:Ne(this.gastProductionsCache),tokenTypes:Ne(this.tokensMap),errMsgProvider:ss,grammarName:n}),s=PN({lookaheadStrategy:this.lookaheadStrategy,rules:Ne(this.gastProductionsCache),tokenTypes:Ne(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),de(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=IO(Ne(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ne(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ne(this.gastProductionsCache))})),!Eb.DEFER_DEFINITION_ERRORS_HANDLING&&!de(this.definitionErrors))throw t=Et(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),At(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=At(n,"skipValidations")?n.skipValidations:ii.skipValidations}};yf.DEFER_DEFINITION_ERRORS_HANDLING=!1,RC(yf,[rC,aC,_C,bC,EC,wC,TC,vC,AC,SC]);class IC extends yf{constructor(t,n=ii){const r=Xe(n);r.outputCst=!0,super(t,r)}}function OC(e){const t=new NC,n=Ne(e);return Et(n,r=>t.visitRule(r))}class NC extends ns{visitRule(t){const n=this.visitEach(t.definition),r=my(n,s=>s.propertyName),i=Et(r,(s,o)=>{const a=!Jh(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=Et(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:cl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:cl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:cl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:cl(t)}]}visitEachAndOverrideWith(t,n){return Et(this.visitEach(t),r=>_n({},r,n))}visitEach(t){return Nn(Et(t,n=>this.visit(n)))}}function cl(e){return e instanceof En?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function CC(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Nn(Et(e,r=>LC(r)))),t.includeVisitorInterface&&(n=n.concat(BC(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function LC(e){const t=MC(e),n=UC(e);return[t,n]}function MC(e){const t=T_(e.name),n=_f(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function UC(e){return`export type ${_f(e.name)} = {
  ${Et(e.properties,n=>PC(n)).join(`
  `)}
};`}function PC(e){const t=DC(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function BC(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Et(t,n=>FC(n)).join(`
  `)}
}`}function FC(e){const t=_f(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function DC(e){if(qt(e)){const t=Bc(Et(e,r=>E_(r)));return"("+wn(t,(r,i)=>r+" | "+i)+")"}else return E_(e)}function E_(e){return e.kind==="token"?"IToken":T_(e.name)}function T_(e){return Bg(e)+"CstNode"}function _f(e){return Bg(e)+"CstChildren"}const $C={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function jC(e,t){const n=Object.assign(Object.assign({},$C),t),r=OC(e);return CC(r,n)}const bf=lh(32,126).map(e=>String.fromCharCode(e));function Wt(e){return Cn({...e,name:`token_${e.name}`})}function lr(e,t=!1){return Wt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:hn,group:je.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:hn})}const ea=Wt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),zC=Wt({name:"whitespace",pattern:/ +/,group:je.SKIPPED}),KC=Wt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:je.SKIPPED}),wf=Wt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),$s=Wt({name:"command",pattern:/#/,start_chars_hint:["#"]});let v_=!1;function WC(e,t,n){if(!v_)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==ea)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const k_=Wt({name:"text",pattern:WC,line_breaks:!1,start_chars_hint:bf.filter(e=>"@#/?':!".includes(e)===!1)}),A_=Wt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),x_=Wt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),S_=Wt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),R_=Wt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),hn=Wt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:bf}),I_=Wt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),O_=Wt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),N_=Wt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:hn}),C_=Wt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:hn}),L_=Wt({name:"islessthan",pattern:/<|below/,longer_alt:hn}),M_=Wt({name:"isgreaterthan",pattern:/>|above/,longer_alt:hn}),U_=Wt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:hn}),P_=Wt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:hn}),Ef=Wt({name:"or",pattern:/or/i,longer_alt:hn}),Tf=Wt({name:"not",pattern:/not/i,longer_alt:hn}),vf=Wt({name:"and",pattern:/and/i,longer_alt:hn}),kf=Wt({name:"plus",pattern:/\+/}),Af=Wt({name:"minus",pattern:/-/}),B_=Wt({name:"power",pattern:/\*\*/}),F_=Wt({name:"multiply",pattern:/\*/}),xf=Wt({name:"divide",pattern:/\//}),D_=Wt({name:"moddivide",pattern:/%/}),$_=Wt({name:"floordivide",pattern:/%%/}),j_=Wt({name:"query",pattern:/\?/}),z_=Wt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),K_=Wt({name:"rparen",pattern:/\)/,pop_mode:!0}),W_=Wt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:bf,longer_alt:hn}),Sf=lr("if"),ll=lr("do"),GC=lr("to",!0),Rf=lr("done"),HC=lr("then",!0),If=lr("else"),G_=lr("while"),H_=lr("repeat"),Y_=lr("waitfor"),V_=Wt({name:"foreach",pattern:/foreach|for/,longer_alt:hn}),q_=lr("break"),J_=lr("continue");function X_(e){return[...e,O_,N_,C_,U_,L_,P_,M_,Ef,Tf,vf,kf,Af,B_,F_,xf,$_,D_,j_,z_,K_,I_,hn]}const Z_=X_([k_,wf,W_,$s,A_,x_,S_,R_,ea,zC,q_,J_,Rf,ll,If,V_,Sf,H_,HC,GC,Y_,G_]),YC=new je({defaultMode:"use_newlines",modes:{use_newlines:Z_,ignore_newlines:X_([KC])}},{skipValidations:!Ar,ensureOptimizations:Ar});function Q_(e){v_=!0;const t=YC.tokenize(e||` 
`),[n]=(Xt(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(Xc(ea,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function VC(e,t,n=!0){if(n){const[r,...i]=t;switch(Dt(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:[]};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Dt(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function Ln(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var Of=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Of||{});function t1(e){return Lo(e,Of,{bits:t=>Array.from(t)})}function e1(e){return Mo(e,Of,{bits:t=>new Uint8Array(t)})}function qC(e,t){return{id:Te(),code:e,...t}}var Nf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Nf||{});function JC(e){return Lo(e,Nf,{board:y4,object:_c,terrain:_c,charset:t1,palette:t1,stats:Xi})}function XC(e){return Mo(e,Nf,{board:_4,object:bc,terrain:bc,charset:e1,palette:e1})}function ul(e){const t={...os(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function ZC(e){return T(e)?(e.stats=void 0,os(e)):{}}function n1(e){const t=Q_(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===wf){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),u=a.split(" "),l=VC(kt(c)?c:"",u,r),h=Dt(l.values.join(" "));switch(r=!1,l.type){case wt.LOADER:n.type=xt.LOADER,n.name=h;break;case wt.BOARD:n.type=xt.BOARD,n.name=h;break;case wt.OBJECT:n.type=xt.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=xt.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=xt.CHARSET,n.name=h;break;case wt.PALETTE:n.type=xt.PALETTE,n.name=h;break;case wt.CONST:{const[f,d]=l.values;if(kt(f)){const p=Dt(f);if(kt(d)){const g=parseFloat(d);n[p]=Lt(g)?g:d}else Lt(d)?n[p]=d:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[f,...d]=l.values;if(kt(f)){const p=Dt(f);n[p]=[Ln(l.type),...d]}break}}}}return n}function os(e){var t;return T(e)?(T((t=e.stats)==null?void 0:t.type)||(e.stats=n1(e.code),T(e.stats.type)||(e.stats.type=xt.OBJECT)),e.stats):{}}function r1(e){switch(e){default:case xt.ERROR:return"error";case xt.LOADER:return Ln(wt.LOADER);case xt.BOARD:return Ln(wt.BOARD);case xt.OBJECT:return Ln(wt.OBJECT);case xt.TERRAIN:return Ln(wt.TERRAIN);case xt.CHARSET:return Ln(wt.CHARSET);case xt.PALETTE:return Ln(wt.PALETTE)}}function js(e){return os(e).type??xt.ERROR}function hl(e){return r1(js(e))}function si(e){return os(e).name??""}function i1(e,t){return os(e)[t]}function Cf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!Xt(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalkable":t.collision=jt.ISWALK;break;case"isswim":case"isswimable":t.collision=jt.ISSWIM;break;case"issolid":t.collision=jt.ISSOLID;break;case"isbullet":t.collision=jt.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function Oi(e){if(T(e))switch(js(e)){default:return;case xt.ERROR:return e.code??"";case xt.LOADER:return e.code??"";case xt.BOARD:{T(e.board)||(e.board=g4()),e.board.id=e.id;const t=ul(e);return e.board.isdark=t.isdark??e.board.isdark?1:0,e.board.startx=t.startx??e.board.startx,e.board.starty=t.starty??e.board.starty,e.board.over=t.over??e.board.over,e.board.under=t.under??e.board.under,e.board.exitnorth=t.exitnorth??e.board.exitnorth,e.board.exitsouth=t.exitsouth??e.board.exitsouth,e.board.exitwest=t.exitwest??e.board.exitwest,e.board.exiteast=t.exiteast??e.board.exiteast,e.board.timelimit=t.timelimit??e.board.timelimit,e.board.restartonzap=t.restartonzap??e.board.restartonzap,e.board.maxplayershots=t.maxplayershots??e.board.maxplayershots,e.board}case xt.OBJECT:return T(e.object)||(e.object=Xm()),e.object.name=si(e),e.object.category=Pn.ISOBJECT,Cf(ul(e),e.object),e.object;case xt.TERRAIN:return T(e.terrain)||(e.terrain=Xm()),e.terrain.name=si(e),e.terrain.category=Pn.ISTERRAIN,Cf(ul(e),e.terrain),e.terrain;case xt.PALETTE:return T(e.palette)||(e.palette=Qm(_A)),e.palette;case xt.CHARSET:return T(e.charset)||(e.charset=tg(yA)),e.charset}}function s1(e){return{id:Te(),name:Bb(),timestamp:0,activelist:[],pages:e,flags:{}}}var Lf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e))(Lf||{});function QC(e){return Lo(e,Lf,{pages:t=>t.map(JC)})}function t4(e){return Mo(e,Lf,{pages:t=>t.map(XC)})}function zs(e,t){if(!T(e))return;const n=Dt(t);return e.pages.find(i=>i.id===t||n===si(i))}function oi(e,t,n){if(!T(e))return;const r=Dt(n);return e.pages.find(s=>js(s)===t&&(s.id===n||r===si(s)))}function Mf(e,t,n){let r=oi(e,t,n);if(!T(r)){const i=r1(t);r=qC(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),n4(e,r)}return r}function e4(e,t){return T(e)?e.pages.filter(n=>js(n)===t):[]}function Uf(e,t,n){return T(e)?e.pages.filter(r=>js(r)===t).filter(r=>{const i=os(r);return T(i[n])}):[]}function n4(e,t){if(!T(e)||!T(t))return!1;const n=zs(e,t.id);return T(n)?!1:(e.pages.push(t),!0)}function r4(e,t){const n=zs(e,t);if(T(e)&&T(n)){const r=Dt(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==si(i)),n}}function Ni(e,t){if(T(t)&&T(t.kind))return T(t.kinddata)||(t.kinddata=T(t.id)?fl(e,t.kind):a1(e,t.kind)),t.kinddata}function o1(e,t,n){const r=Ni(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function Pf(e,t,n,r,i){const s=Ni(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function fl(e,t){const n=t??"",r=oi(e,xt.OBJECT,n);if(T(r)){const i=Oi(r);return{...dr(i),name:n,code:r.code}}}function a1(e,t){const n=t??"",r=oi(e,xt.TERRAIN,n);if(T(r)){const i=Oi(r);return{...dr(i),name:n,code:r.code}}}function Ks(e,t){const n=zs(e,t);return Oi(n)}function ai(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function c1(e,t){e&&delete e.flags[t]}function l1(e,t,n){const r=ai(e,t);return r==null?void 0:r[n]}function i4(e,t,n,r){const i=ai(e,t);return i&&(i[n]=r),r}function as(e,t){const n=l1(e,t,"board");return Ks(e,kt(n)?n:"")}function s4(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function dl(e,t,n){if(!T(e))return;i4(e,t,"board",n);const r=Ks(e,n);T(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function o4(e,t,n,r){if(!T(e))return;const i=as(e,t);if(!T(i))return;const s=Jn(i,t);if(!Th(s)||!(s!=null&&s.id))return;const o=Ks(e,n);if(!T(o)||(Ur(e,o),Ff(e,o,jt.ISWALK,r)))return;delete i.objects[s.id];const a=cs(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=cs(o,s);o.lookup&&(o.lookup[c]=s.id),dl(e,t,o.id)}function a4(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=l1(e,r,"board");return kt(i)?i:""});return Wk(n)}function Bf(e){return a4(e).map(n=>Ks(e,n)).filter(T)}function Ff(e,t,n,r){if(!T(e)||!T(t)||!T(t.lookup)||r.x<0||r.x>=oe||r.y<0||r.y>=an)return!0;const i=r.x+r.y*oe,s=Jn(t,t.lookup[i]??"404");if(T(s))return!0;const o=t.terrain[i];if(T(o)){const a=Ni(e,o),c=o.collision??(a==null?void 0:a.collision);return hh(n,c)}return!1}function c4(e,t,n,r){const i=Jn(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=o1(e,i,"collision");return Ff(e,t,a,r)}function u1(e,t,n,r){var l,h;const i=Jn(t,(n==null?void 0:n.id)??"");if(!T(e)||!T(t)||!T(i)||!T(i.x)||!T(i.y)||!T(t.lookup)||r.x<0||r.x>=oe||r.y<0||r.y>=an)return{kind:"edge",collision:jt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=cs(t,i),o=cs(t,r),a=i.collision??((l=i==null?void 0:i.kinddata)==null?void 0:l.collision)??jt.ISWALK,c=Jn(t,t.lookup[o]??"");if(T(c))return{...c};const u=t.terrain[o];if(T(u)){const f=u.collision??((h=u==null?void 0:u.kinddata)==null?void 0:h.collision)??jt.ISWALK;if(hh(a,f))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,T(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function pl(e,t,n,r){var s;if(!T(e)||!T(t)||!T(t.named)||!T(n))return;const i=Dt(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function l4(e,t,n){if(!(!T(e)||!T(t)||!T(t.lookup)||!T(n==null?void 0:n.id))&&!T(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*oe]=n.id}}function Ur(e,t){var a;if(!T(e)||!T(t)||T(t.lookup)&&T(t.named))return;const n=new Array(oe*an).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const u=i[c];if(T(u.x)&&T(u.y)&&T(u.id)&&!T(u.removed)){u.category=Pn.ISOBJECT,n[u.x+u.y*oe]=u.id;const l=Dt(u.name??((a=u.kinddata)==null?void 0:a.name)??"");r[l]||(r[l]=new Set),r[l].add(u.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const u=t.terrain[c];if(T(u)){u.x=s,u.y=o,u.category=Pn.ISTERRAIN;const l=Uo(u);r[l]||(r[l]=new Set),r[l].add(c)}++s,s>=oe&&(s=0,++o)}t.lookup=n,t.named=r}function Ci(e,t,n,r){if(!T(n)||Uo(n)==="player")return!1;const i=n.id??"",s=n.x??0,o=n.y??0;return i?(n.removed=r,Df(e,t,n)):li(t,{x:s,y:o}),!0}function Df(e,t,n){var r;if(T(e)&&T(t)&&T(n==null?void 0:n.id)){if(T(t.lookup)&&T(n.x)&&T(n.y)){const s=n.x+n.y*oe;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Uo(n);T((r=t.named)==null?void 0:r[i])&&T(n.id)&&t.named[i].delete(n.id)}}function u4(e,t,n){const r=[];if(!T(e)||!T(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];T(o.id)&&T(o.removed)&&n-o.removed>_a*5&&(r.push(o.id),v1(t,o.id))}return r}function h4(e,t,n){const r=[];if(!T(e)||!T(t))return r;t.lookup=void 0,Ur(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!T(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Ni(e,a),u=a.code??(c==null?void 0:c.code)??"";!u||a.stopped||r.push({id:a.id,type:xt.OBJECT,code:u,object:a,terrain:void 0})}const s=u4(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:xt.ERROR,code:"",object:void 0,terrain:void 0});return r}function f4(e,t,n,r){if(T(e)&&T(t)&&T(n)){const[i,s]=n,o=fl(e,i);if(T(o)&&T(o.name)){const a=Wf(t,r,i);return wc(a,s),pl(e,t,a),a}}}function ml(e,t,n,r){if(T(e)&&T(t)&&T(n)){const[i,s]=n,o=a1(e,i);if(T(o)){const c=w4(t,r,i);if(T(c)){T(s)&&wc(c,s);const u=ac(r,oe);return pl(e,t,c,u),c}}const a=fl(e,i);if(T(a)&&T(a.name)){const c=Wf(t,r,i);if(T(c))return T(s)&&wc(c,s),l4(e,t,c),pl(e,t,c),c}}}const h1={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Pr(e){return Xt(e)&&f1(e[0])}function f1(e){return T(Pn[e])&&kt(e)}function d1(e){if(kt(e))return h1[Dt(e)]}function p1(e){if(Pr(e))return e;if(f1(e))return[e];const t=d1(e);if(T(t))return[t]}function gl(e){const t=x.words[e],n=p1(t);if(Pr(n))return[n,e+1];const[r,i]=qe(e),s=p1(r);return Pr(s)?[s,i]:[void 0,e]}const m1={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};jt.ISSOLID,jt.ISWALK,jt.ISSWIM,jt.ISBULLET,jt.ISWALK,jt.ISSWIM;function ci(e){return Xt(e)&&$f(e[0])}function $f(e){return T(jt[e])&&kt(e)}function d4(e){if(kt(e))return m1[Dt(e)]}function g1(e){const t=x.words[e];if(ci(t))return[t,e+1];if($f(t))return[[t],e+1];const[n,r]=qe(e);return ci(n)?[n,r]:$f(n)?[[n],r]:[void 0,e]}function qe(e,t=!0){var i,s,o,a,c;const n=x.words[e],r=e+1;if(d1(n)){const[u,l]=gl(e);if(T(u))return[u,l]}if(d4(n)){const[u,l]=g1(e);if(T(u))return[u,l]}if(uh(n)){const[u,l]=uc(e);if(T(u))return[u,l]}if(kt(n)&&Dt(n)==="rnd"){const[u,l]=qe(r),[h,f]=qe(l);return Lt(u)&&Lt(h)?[Ro(u,h),f]:Lt(u)?[Ro(0,u),l]:[Ro(0,1),r]}if(b1(n)){const[u,l]=jf(e);if(T(u))return[u,l]}if(!T(n))return[void 0,e];if(Lt(n)||Xt(n))return[n,r];if(kt(n)){const u=Dt(n);if(t){const l=(i=x.get)==null?void 0:i.call(x,n);if(T(l))return[l,r]}switch(u){case"aligned":case"alligned":{const l=fc(x.board,x.element,x.elementfocus);return!T(x.element)||!T(l)?[0,r]:[x.element.x===l.x||x.element.y===l.y?1:0,r]}case"contact":{const l=fc(x.board,x.element,x.elementfocus);if(!T(x.element)||!T(l))return[0,r];const h=(l.x??0)-(((s=x.element)==null?void 0:s.x)??0),f=(l.y??0)-(((o=x.element)==null?void 0:o.y)??0);return[h===0&&Math.abs(f)<2||f===0&&Math.abs(h)<2?1:0,r]}case"blocked":{const[l,h]=it(x.words,r,[J.DIR]);return[c4(x.book,x.board,x.element,l)?1:0,h]}case"any":{const[l,h]=it(x.words,r,[J.KIND]),f=hc(l)??"",d=Io(x.board,f);return[km(d,l).length?1:0,h]}case"rnd":return[Ro(0,1),r];case"abs":{const[l,h]=it(x.words,r,[J.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=it(x.words,r,[J.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=it(x.words,r,[J.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=it(x.words,r,[J.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,f,d]=it(x.words,r,[J.NUMBER,J.NUMBER,J.NUMBER]);return[On(l,h,f),d]}case"min":{const l=[];for(let h=r;h<x.words.length;){const[f,d]=qe(h);Xt(f)&&!ur(f)&&!Pr(f)&&!ci(f)&&!gn(f)&&l.push(...f),h=d,l.push(f)}return[Math.min(...l),x.words.length]}case"max":{const l=[];for(let h=r;h<x.words.length;){const[f,d]=qe(h);Xt(f)&&!ur(f)&&!Pr(f)&&!ci(f)&&!gn(f)&&l.push(...f),h=d,l.push(f)}return[Math.max(...l),x.words.length]}case"pick":{const l=[];for(let h=r;h<x.words.length;){const[f,d]=qe(h);Xt(f)&&!ur(f)&&!Pr(f)&&!ci(f)&&!gn(f)&&l.push(...f),h=d,l.push(f)}return[vi(l),x.words.length]}case"pickwith":{const l=[],[h,f]=it(x.words,r,[J.STRING]);for(let d=f;d<x.words.length;){const[p,g]=qe(d);Xt(p)&&!ur(p)&&!Pr(p)&&!ci(p)&&!gn(p)&&l.push(...p),d=g,l.push(p)}return[pm(h,l),x.words.length]}case"range":{const[l,h,f,d]=it(x.words,r,[J.NUMBER,J.MAYBE_NUMBER,J.MAYBE_NUMBER]);return[lh(l,h,f),d]}case"run":{const[l,h]=it(x.words,r,[J.NAME]);return Nl(l),[(a=x.get)==null?void 0:a.call(x,"arg"),h]}case"runwith":{const[l,h,f]=it(x.words,r,[J.ANY,J.NAME]);return T(x.element)&&(x.element.arg=l),Nl(h),[(c=x.get)==null?void 0:c.call(x,"arg"),f]}}}return[n,r]}function na(e){return T(e)&&T(e.x)&&T(e.y)}function ze(e,t){switch(t){case yt.NORTH:--e.y;break;case yt.SOUTH:++e.y;break;case yt.WEST:--e.x;break;case yt.EAST:++e.x;break}return e}function Li(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return yt.WEST;if(n>0)return yt.EAST;if(r<0)return yt.NORTH;if(r>0)return yt.SOUTH}const y1={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function ur(e){return Xt(e)&&_1(e[0])}function _1(e){return T(yt[e])&&kt(e)}function p4(e){const t=yt[e];return T(t)?t:yt.IDLE}function b1(e){if(kt(e))return y1[Dt(e)]}function w1(e){if(ur(e))return e;if(_1(e))return[e];const t=b1(e);if(T(t))return[t]}function E1(e){const t=x.words[e],n=w1(t);if(ur(n))return[n,e+1];const[r,i]=qe(e),s=w1(r);return ur(s)?[s,i]:[void 0,e]}function jf(e){const t=[];let[n,r]=E1(e);for(;ur(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=it(x.words,r,[J.NUMBER,J.NUMBER]);t.push(o,a),r=c}const[i,s]=E1(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function m4(){return new Array(oe*an).map(()=>{})}function g4(e=Gl){const t={terrain:m4(),objects:{},id:""};return e(t)}var zf=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e))(zf||{});function y4(e){return Lo(e,zf,{terrain:t=>t.map(_c),objects:t=>Object.values(t).map(_c),id:Xi,named:Xi,lookup:Xi,codepage:Xi})}function _4(e){return Mo(e,zf,{terrain:t=>t.map(bc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=bc(t[r]);T(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function cs(e,t){return!T(e)||!T(t==null?void 0:t.x)||!T(t==null?void 0:t.y)||t.x<0||t.x>=oe||t.y<0||t.y>=an?-1:t.x+t.y*oe}function Br(e,t){const n=cs(e,t);if(n<0||!T(e==null?void 0:e.lookup))return;const r=Jn(e,e.lookup[n]??"");return T(r)?r:e.terrain[n]}function b4(e,t){const n=Jn(e,t);if(T(n))return n;const r=parseFloat(t),i=Ck(isNaN(r)?-1:r,oe);return T1(e,i.x,i.y)}function T1(e,t,n){return(t>=0&&t<oe)??(n>=0&&n<an)?e==null?void 0:e.terrain[t+n*oe]:void 0}function li(e,t){if(!T(e)||!T(t)||!T(t.x)||!T(t.y)||t.x<0||t.x>=oe||t.y<0||t.y>=an)return;const n=dr(t),r=t.x+t.y*oe;return e.terrain[r]=n,e.terrain[r]}function Kf(e,t){if(!T(e)||!T(t))return;const n=dr(t);return n.id=n.id??Te(),e.objects[n.id]=n,e.objects[n.id]}function w4(e,t,n){return li(e,{...t,kind:n})}function Wf(e,t,n,r){return Kf(e,{...t,kind:n,id:r})}function Jn(e,t){if(e)return e.objects[t]}function Gf(e,t,n,r,i){if(!T(e)||!T(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=Li(o,s),c=oe-1,u=an-1;for(let l=0;l<r.length;++l){const h=p4(r[l]);switch(h){case yt.IDLE:break;case yt.NORTH:case yt.SOUTH:case yt.WEST:case yt.EAST:ze(s,h);break;case yt.BY:{const[f,d]=r.slice(l+1);Lt(f)&&Lt(d)&&(s.x=On(s.x+f,0,c),s.y=On(s.y+d,0,u)),l+=2;break}case yt.AT:{const[f,d]=r.slice(l+1);Lt(f)&&Lt(d)&&(s.x=On(f,0,c),s.y=On(d,0,u)),l+=2;break}case yt.FLOW:ze(s,a);break;case yt.SEEK:{const f=E4(e,t,n);na(f)&&ze(s,Li(i,f));break}case yt.RNDNS:ze(s,vi(yt.NORTH,yt.SOUTH));break;case yt.RNDNE:ze(s,vi(yt.NORTH,yt.EAST));break;case yt.RND:ze(s,vi(yt.NORTH,yt.SOUTH,yt.WEST,yt.EAST));break;case yt.CW:case yt.CCW:case yt.OPP:case yt.RNDP:{const f=Gf(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case yt.CW:switch(Li(i,f)){case yt.NORTH:ze(s,yt.EAST);break;case yt.SOUTH:ze(s,yt.WEST);break;case yt.EAST:ze(s,yt.SOUTH);break;case yt.WEST:ze(s,yt.NORTH);break}break;case yt.CCW:switch(Li(i,f)){case yt.NORTH:ze(s,yt.WEST);break;case yt.SOUTH:ze(s,yt.EAST);break;case yt.EAST:ze(s,yt.NORTH);break;case yt.WEST:ze(s,yt.SOUTH);break}break;case yt.OPP:switch(Li(i,f)){case yt.NORTH:ze(s,yt.SOUTH);break;case yt.SOUTH:ze(s,yt.NORTH);break;case yt.EAST:ze(s,yt.WEST);break;case yt.WEST:ze(s,yt.EAST);break}break;case yt.RNDP:switch(Li(i,f)){case yt.NORTH:case yt.SOUTH:s.x+=vi(-1,1);break;case yt.WEST:case yt.EAST:s.y+=vi(-1,1);break}break}break}}}return s}function v1(e,t){return T(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function E4(e,t,n){if(!T(e)||!T(t))return;const r=e.objects[n];if(T(r))return r;if(na(t))return Am(t,Io(e,"player"))}const x={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementpt:{x:0,y:0},elementisplayer:!1,elementfocus:"",words:[],get:void 0};var J=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(J||{});function Ce(e,t,n){throw console.info(n,x.element,x.elementid,x.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function it(e,t,n){var o,a;const r=x.words;x.words=e;const i=[];let s=t;for(let c=0;c<n.length;++c)switch(n[c]){case 0:{const[u,l]=gl(s);Pr(u)||Ce("terrain or object",u,e),s=l,i.push(u);break}case 1:{const[u,l]=g1(s);ci(u)||Ce("solid, walk, swim, bullet, walkable or swimmable",u,e),s=l,i.push(u);break}case 2:{const[u,l]=uc(s);gn(u)||Ce("color",u,e),s=l,i.push(u);break}case 3:{const[u,l]=Em(s);Ns(u)?(s=l,i.push(u)):Ce("kind",u,e);break}case 4:{const[u,l]=jf(s);if(ur(u)){const h={x:x.elementpt.x,y:x.elementpt.y},f=T(x.board)&&T(x.element)?Gf(x.board,x.element,x.elementfocus,u,h):h;s=l,i.push(f)}else Ce("direction",u,e);break}case 5:{const u=x.words[s];kt(u)||Ce("string",u,e),++s,i.push(u);break}case 6:{const[u,l]=qe(s);if(kt(u)){const h=parseFloat(u);Lt(h)?i.push(h):Ce("number",u,e)}else Lt(u)?i.push(u):Ce("number",u,e);s=l;break}case 7:{const[u,l]=qe(s);kt(u)||Ce("string",u,e),s=l,i.push(u);break}case 8:{const[u,l]=qe(s,!1);let h=u;if(kt(h)){const f=parseFloat(h);Lt(f)&&(h=f)}else Lt(h)||Ce("number or string",h,e);s=l,i.push(h);break}case 9:{const[u,l]=gl(s);u!==void 0&&!Pr(u)&&Ce("optional terrain or object",u,e),s=l,i.push(u);break}case 10:{const[u,l]=gl(s);u!==void 0&&!ci(u)&&Ce("optional solid, walk, swim, bullet, walkable or swimmable",u,e),s=l,i.push(u);break}case 11:{const[u,l]=uc(s);u!==void 0&&!gn(u)&&Ce("optional color",u,e),s=l,i.push(u);break}case 12:{const[u,l]=Em(s);u!==void 0&&!Ns(u)&&Ce("optional kind",u,e),s=l,i.push(u);break}case 13:{const[u,l]=jf(s);if(ur(u)){const h=((o=x.element)==null?void 0:o.x)??0,f=((a=x.element)==null?void 0:a.y)??0,d={x:h,y:f},p=x.board?Gf(x.board,x.element,x.elementfocus,u,d):d;s=l,i.push(p)}else u===void 0?(s=l,i.push(void 0)):Ce("optional direction",u,e);break}case 14:{const u=x.words[s];u!==void 0&&!kt(u)&&Ce("optional string",u,e),++s,i.push(u);break}case 15:{const[u,l]=qe(s);if(kt(u)){const h=parseFloat(u);Lt(h)?i.push(h):Ce("optional number",u,e)}else Lt(u)||u===void 0?i.push(u):Ce("optional number",u,e);s=l;break}case 16:{const[u,l]=qe(s);u!==void 0&&!kt(u)&&Ce("optional string",u,e),s=l,i.push(u);break}case 17:{const[u,l]=qe(s,!1);let h=u;if(kt(h)){const f=parseFloat(h);Lt(f)&&(h=f)}else h!==void 0&&!Lt(h)&&Ce("number or string",h,e);s=l,i.push(h);break}case 18:{const[u,l]=qe(s);s=l,i.push(u);break}}return x.words=r,[...i,s]}const T4=["echo","reverb","chorus","phaser","distortion","vibrato"];function k1(e,t){const[n]=it(e,0,[J.STRING]);Ew(H,n,t)}function ui(e,t){const[n,r]=it(t,0,[J.NUMBER_OR_STRING]);if(Lt(n))Yl(H,e,"volume",n);else if(T4.includes(Dt(n))){const[i,s]=it(t,r,[J.NUMBER_OR_STRING,J.MAYBE_NUMBER_OR_STRING]);vw(H,e,n,i,s)}else{const[i]=it(t,r,[J.MAYBE_NUMBER_OR_STRING]);if(Lt(i)){const s=t.length-r,o=new Array(s).fill(J.NUMBER),a=it(t,r,o).slice(0,s),c=a.length===1?a[0]:a;Yl(H,e,n,c)}else{const[s]=it(t,r,[J.MAYBE_NUMBER_OR_STRING]);Yl(H,e,n,s)}}}const v4=nr().command("bpm",(e,t)=>{const[n]=it(t,0,[J.NUMBER]);return Tw(H,n),0}).command("mainvol",(e,t)=>{const[n]=it(t,0,[J.NUMBER]);return Rd(H,n),0}).command("mainvolume",(e,t)=>{const[n]=it(t,0,[J.NUMBER]);return Rd(H,n),0}).command("drumvol",(e,t)=>{const[n]=it(t,0,[J.NUMBER]);return Id(H,n),0}).command("drumvolume",(e,t)=>{const[n]=it(t,0,[J.NUMBER]);return Id(H,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[J.NUMBER]);return Od(H,n),0}).command("ttsvolume",(e,t)=>{const[n]=it(t,0,[J.NUMBER]);return Od(H,n),0}).command("play",(e,t)=>(k1(t,!1),0)).command("bgplay",(e,t)=>(k1(t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)ui(n,t);return 0}).command("synth1",(e,t)=>(ui(0,t),0)).command("synth2",(e,t)=>(ui(1,t),0)).command("synth3",(e,t)=>(ui(2,t),0)).command("synth4",(e,t)=>(ui(3,t),0)).command("synth5",(e,t)=>(ui(4,t),0)).command("synth6",(e,t)=>(ui(5,t),0)).command("synth7",(e,t)=>(ui(6,t),0)).command("synth8",(e,t)=>(ui(7,t),0)),k4=lh(32,126).map(e=>String.fromCharCode(e)),A4=Cn({name:"Whitespace",pattern:/ +/}),x4=Cn({name:"WhitespaceSkipped",pattern:/ +/,group:je.SKIPPED}),Hf=Cn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),A1=Cn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:k4}),Yf=Cn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Vf=Cn({name:"EscapedDollar",pattern:"$$"}),qf=Cn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Jf=Cn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),x1=Cn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function S4(e,t=""){return Cn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const S1=Object.keys(lc).map(e=>S4(`\\$(${e})`,e)),R4=[A4,Hf,...S1,Yf,A1,Jf,Vf,x1,qf],I4=new je(R4,{skipValidations:!Ar,ensureOptimizations:Ar}),O4=new je([x4,Hf,...S1,Yf,A1,Jf,Vf,x1,qf],{skipValidations:!Ar,ensureOptimizations:Ar});function Xf(e,t=!1){return t?O4.tokenize(e):I4.tokenize(e)}function Zf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function R1(e){e.active={...e.reset}}function I1(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Vf:s("$");break;case Jf:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case Yf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Hf:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=lc[u],h=Gk(Ut[l]),f=Hk(Ut[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):T(h)?t.active.color=h:T(f)?t.active.bg=f:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(T(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){R1(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;C4(l,l+u.length,t.active.color,t.active.bg,t),N4(l,u,t)}}}function O1(e,t,n){const r=Xf(e);r.tokens&&(I1(r.tokens,t),n&&R1(t),t.changed())}function N1(e,t,n){const r=Xf(e);if(!r.tokens)return;const i=Zf(t,n,Ut.WHITE,Ut.BLACK);return i.measureonly=!0,I1(r.tokens,i),i.x>0&&++i.y,i}function N4(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function C4(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function C1(e,t,n){if(!na(x.element))return 0;const[r,i]=it(t,0,[J.DIR,J.MAYBE_KIND]),s=i??["bullet"],o=f4(x.book,x.board,s,{x:x.element.x,y:x.element.y});if(T(o)){o.arg=n,o.collision=jt.ISBULLET,o.destructible=1,o.stepx=r.x-x.element.x,o.stepy=r.y-x.element.y;const a=Ni(x.book,o),c=o.code??(a==null?void 0:a.code)??"";db(x.book,x.board,o,c,1),(o.x!==x.element.x||o.y!==x.element.y)&&e.bucket(o.id)}return e.yield(),0}const L4=nr().command("board",(e,t)=>{if(!T(x.book))return 0;const[n,r,i]=it(t,0,[J.NAME,J.MAYBE_NUMBER,J.MAYBE_NUMBER]),s=Uf(x.book,xt.BOARD,n);if(s.length){const o=vi(...s);T(o)&&o4(x.book,x.elementfocus,o.id,{x:r??Math.round(oe*.5),y:i??Math.round(an*.5)})}return 0}).command("edge",(e,t)=>{if(!T(x.book)||!T(x.board)||!T(x.element))return 0;const[n,r]=it(t,0,[J.DIR,J.NAME]),i=Uf(x.book,xt.BOARD,r);if(i.length){const s=Li(x.elementpt,n),o=vi(...i);switch(s){case yt.NORTH:x.board.exitnorth=o.id;break;case yt.SOUTH:x.board.exitsouth=o.id;break;case yt.WEST:x.board.exitwest=o.id;break;case yt.EAST:x.board.exiteast=o.id;break}}return 0}).command("shove",(e,t)=>{if(!T(x.book)||!T(x.board))return 0;Ur(x.book,x.board);const[n,r]=it(t,0,[J.DIR,J.DIR]),i=Br(x.board,n);return Th(i)&&ud(e,x.book,x.board,i,r),0}).command("duplicate",()=>(!T(x.book)||!T(x.board),0)).command("replace",(e,t)=>{if(!T(x.book)||!T(x.board))return 0;Ur(x.book,x.board);const[n,r]=it(t,0,[J.DIR,J.KIND]),i=Br(x.board,n);return Th(i)&&Ci(x.book,x.board,i,x.timestamp),ml(x.book,x.board,r,n),0}).command("write",(e,t)=>{var u;if(!T(x.book)||!T(x.board))return 0;Ur(x.book,x.board);const[n,r,i]=it(t,0,[J.DIR,J.COLOR,J.STRING]),{color:s,bg:o}=wm(r),a=((u=N1(i,256,1))==null?void 0:u.measuredwidth)??1,c=Zf(256,1,s??Ut.WHITE,o??Ut.ONCLEAR);O1(i,c,!1);for(let l=0;l<a;++l){const h=li(x.board,{x:n.x+l,y:n.y,char:c.char[l],color:c.color[l],bg:c.bg[l]});if(T(h)){const f=(h.x??0)+(h.y??0)*oe;pl(x.book,x.board,h,f)}}return 0}).command("change",(e,t)=>{if(!T(x.book)||!T(x.board))return 0;Ur(x.book,x.board);const[n,r]=it(t,0,[J.KIND,J.KIND]);Ur(x.book,x.board);const i=hc(n)??"",s=Io(x.board,i),o=km(s,n),a=hc(r),c=Tm(r),u=vm(r);return o.forEach(l=>{if(Uo(l)===a)T(c)&&(l.color=c),T(u)&&(l.bg=u);else{if(T(l.id)&&Ci(x.book,x.board,l,x.timestamp)){l.stopped=1;return}na(l)&&ml(x.book,x.board,r,l)}}),0}).command("put",(e,t)=>{if(!T(x.book)||!T(x.board)||!T(x.element))return 0;Ur(x.book,x.board);const[n,r]=it(t,0,[J.DIR,J.KIND]),i=Br(x.board,n);if((i==null?void 0:i.category)===Pn.ISOBJECT&&(i!=null&&i.pushable)){const o=ze(n,Li(x.elementpt,n));u1(x.book,x.board,i,o)}return Ff(x.book,x.board,jt.ISWALK,n)||ml(x.book,x.board,r,n),0}).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[J.ANY]);return C1(e,t.slice(r),n)}).command("shoot",C1),M4=navigator.userAgent.includes("Mac")?"cmd":"ctrl",Mi="$dkpurple",U4="$196",P4="$205";function fn(e,t){return`$${e}${t}$blue`}function L1(e,t){return`$${e}${t}$ondkblue`}function ne(e,t){Bn(e,t)}function B4(e,t){const n=U4.repeat(t);ne(e,`${Mi}${n}`)}function Qf(e,t){const n=P4.repeat(t);ne(e,`${Mi}${n}`)}function ra(e,t){ne(e,`${Mi} ${" ".repeat(t.length)} `),B4(e,t.length+2),ne(e,`${Mi} $white${t} `),Qf(e,t.length+2)}function hi(e,t){ne(e,`${Mi} ${" ".repeat(t.length)} `),ne(e,`${Mi} $gray${t} `),Qf(e,t.length+2)}function Zt(e,t,n){ne(e,`${Mi} $white${t} $blue${n}`)}function Qt(e,t){ne(e,`${Mi}$blue${t}`)}function F4(e,t,n){ne(e,`!openit ${t};${n}`)}function Ws(e=""){Md(H,e,ha())}const D4=nr().command("send",(e,t)=>{const[n,r]=it(t,0,[J.NAME,J.ANY]);switch(n){case"helpmenu":ra(H,"H E L P"),F4(H,"https://github.com/goldbuick/zed-software-system/wiki","open help wiki"),ne(H,""),Zt(H,"#help controls","zss controls and inputs"),ne(H,"!helpcontrols;read help controls"),ne(H,""),Zt(H,"#help text","text formatting"),ne(H,"!helptext;read help text"),ne(H,""),Zt(H,"#help developer","developer commands"),ne(H,"!helpdeveloper;read help developer"),ne(H,""),Zt(H,"#help player","player settings"),ne(H,"!helpplayer;read help player"),hi(H,"keyboard input"),Zt(H,"?","open console"),Zt(H,"esc","close console"),Zt(H,"tab","move console"),Zt(H,"up / down arrow keys","navigate console items"),Zt(H,"left / right arrow keys","change console items"),Zt(H,"enter","interact with console items"),Zt(H,"alt + arrow keys","skip words and console lines"),Zt(H,`${M4} + up / down arrow keys`,"input history");break;case"helpcontrols":ra(H,"zss controls and inputs"),hi(H,"keyboard input"),Zt(H,"arrow keys","move"),Zt(H,"shift + arrow keys","shoot"),Zt(H,"enter","ok / accept"),Zt(H,"escape","cancel / close"),Zt(H,"tab","menu / action"),hi(H,"mouse input"),Qt(H,"todo ???"),hi(H,"controller input"),Zt(H,"left stick","move"),Zt(H,"right stick","aim"),Zt(H,"a","ok / accept"),Zt(H,"b","cancel / close"),Zt(H,"y","menu / action"),Zt(H,"x","shoot"),Zt(H,"triggers","shoot");break;case"helptext":ra(H,"text formatting"),hi(H,"typography"),Qt(H,"plain text"),Qt(H,"$centering text"),Qt(H,'"\\"@quoted strings for special chars\\""'),Qt(H,"$$0-255 for ascii chars $159$176$240"),Qt(H,`use color names like ${fn("red","$$red")} to change foreground color`),Qt(H,`use color names like ${L1("ongreen","$$ongreen")} to change background color`),Qt(H,`use clear ${L1("onclear","to change background to")} transparent`),hi(H,"hyperlinks"),Qt(H,`${fn("white",'"!hotkey"')} message shortcut;${fn("gray","Label")}`),Qt(H,`${fn("white",'"!range"')} flag [labelmin] [labelmax];${fn("gray","Input Label")}`),Qt(H,`${fn("white",'"!select"')} flag ...list of values;${fn("gray","Input Label")}`),Qt(H,`${fn("white",'"!number"')} flag [minvalue] [maxvalue];${fn("gray","Input Label")}`),Qt(H,`${fn("white",'"!text"')} flag;${fn("gray","Input Label")}`),Qt(H,`${fn("white",'"!copyit"')} flag;${fn("gray","Input Label")}`),Qt(H,`${fn("white",'"!openit"')} flag;${fn("gray","Input Label")}`);break;case"helpdeveloper":ra(H,"developer commands"),Zt(H,"#books","list books in memory"),Zt(H,"#pages","list pages in opened book"),Zt(H,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),Zt(H,"#trash","list books and pages from open book you can delete"),Zt(H,"#save","flush state to register");break;case"helpplayer":ra(H,"player settings"),Qt(H,"todo");break;default:Bn(H,`${n} ${r??""}`);break}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(An),s=i.join(" ");switch(Dt(r)){case Ln(wt.LOADER):n=Pi(Vt.CONTENT,s,xt.LOADER);break;default:n=Pi(Vt.CONTENT,[r,...i].join(" "),xt.OBJECT);break;case Ln(wt.BOARD):n=Pi(Vt.CONTENT,s,xt.BOARD);break;case Ln(wt.OBJECT):n=Pi(Vt.CONTENT,s,xt.OBJECT);break;case Ln(wt.TERRAIN):n=Pi(Vt.CONTENT,s,xt.TERRAIN);break;case Ln(wt.CHARSET):n=Pi(Vt.CONTENT,s,xt.CHARSET);break;case Ln(wt.PALETTE):n=Pi(Vt.CONTENT,s,xt.PALETTE);break}return T(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(An).join(" ");return Bn(H,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=An(n),s=r.map(An).join(" ");return Bn(H,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[J.MAYBE_NAME]),r=ub(n);return T(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[J.NAME]),r=Ui(n);return T(r)?(Qt(H,`opened [book] ${r.name}`),Il(Vt.MAIN,r.id),e.command("pages")):se(H,"bookopen",`book ${n} not found`,x.elementfocus),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[J.NAME]),r=Me(Vt.MAIN),i=Ui(n);return T(i)&&(r===i&&Il(Vt.MAIN,""),kM(n),Qt(H,`trashed [book] ${i.name}`),Ws(),e.command("pages")),0}).command("pageopen",(e,t)=>{const[n]=it(t,0,[J.NAME]),r=Mn(Vt.MAIN);if(!T(r))return 0;const i=zs(r,n);if(T(i)){const s=si(i),o=hl(i);Qt(H,`opened [${o}] ${s}`),Qu(ya(r.id,[i.id]),i.code);const a=hl(i);Cd(H,r.id,[i.id],a,`${s} - ${r.name}`,x.elementfocus)}else se(H,"pageopen",`page ${n} not found`,x.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[J.NAME]),r=Mn(Vt.MAIN),i=r4(r,n);if(T(n)){const s=si(i),o=hl(i);Qt(H,`trashed [${o}] ${s}`),Ws(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(An).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{hi(H,"books");const e=Me(Vt.MAIN);Zt(H,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=Me(Vt.CONTENT);Zt(H,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Qf(H,7);const n=Rl();return n.length?n.forEach(r=>{ne(H,`!bookopen ${r.id};${r.name}`)}):Qt(H,"no books found"),ne(H,"!bookcreate;create a new book"),0}).command("pages",()=>{hi(H,"pages");const e=Mn(Vt.MAIN);return T(e)&&(Zt(H,"main",`${e.name} $GREEN${e.id}`),e.pages.length?e.pages.forEach(t=>{const n=si(t),r=hl(t);ne(H,`!pageopen ${t.id};[${r}] ${n}`)}):(ne(H,""),Qt(H,"no pages found"),Qt(H,"use @ to create a page"),Qt(H,"@board name of board"),Qt(H,"@object name of object"),Qt(H,"@terrain name of terrain"),Qt(H,"You can omit the type and it will default to object"),Qt(H,"@object name of object"),Qt(H,"@name of object"))),0}).command("trash",()=>{hi(H,"$REDTRASH"),Qt(H,"books");const e=Rl();e.length&&(e.forEach(n=>{ne(H,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),ne(H,""));const t=Me(Vt.MAIN);return T(t)&&(Qt(H,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=si(n);ne(H,`!pagetrash ${n.id};$REDTRASH ${r}`)}),ne(H,"")),0}).command("dev",()=>(Ws(),yw(H,x.elementfocus),0)).command("share",()=>(Ws(),_w(H,x.elementfocus),0)).command("save",()=>(Ws(),0)).command("savewith",(e,t)=>{const[n]=it(t,0,[J.NAME]);return Ws(n),0}).command("nuke",()=>(bw(H,x.elementfocus),0)).command("gadget",()=>(kw(H,void 0,x.elementfocus),0)).command("joincode",()=>(pw(H,x.elementfocus),0)).command("twitchchat",(e,t)=>{const[n]=it(t,0,[J.NAME]);switch(Dt(n)){default:lw(H,n,x.elementfocus);break;case"close":uw(H,x.elementfocus);break}return 0}).command("twitchbroadcast",(e,t)=>{const[n]=it(t,0,[J.NAME]);switch(Dt(n)){default:aw(H,n,x.elementfocus);break;case"stop":cw(H,x.elementfocus);break}return 0});function $4(e){const t=h1[e];if(T(t))return t;const n=m1[e];if(T(n))return n;const r=lc[e];if(T(r))return r;const i=y1[e];if(T(i))return i}const j4=nr({get(e,t){const n=$4(t);return T(n)?[!0,n]:[!1,void 0]}}),z4=nr().command("palette",(e,t)=>{const[n,r]=it(t,0,[J.NAME]),i=hb(),s=uh(Dt(n));if(T(s)){const o=ym([s]);if(!T(o))return 0;const[a,c,u]=it(t,r,[J.NUMBER,J.NUMBER,J.NUMBER]),l=Pi(Vt.MAIN,kt(i.palette)?i.palette:Vt.MAIN,xt.PALETTE),h=Oi(l);if(T(h)&&o>=0&&o<=16){const f=o*ec;h.bits[f+0]=On(a,0,63),h.bits[f+1]=On(c,0,63),h.bits[f+2]=On(u,0,63)}T(l)&&(i.palette=l.id)}else{const o=oi(x.book,xt.PALETTE,n);T(o)?(i.palette=o.id,ne(H,`loaded palette ${n}`)):se(H,"not-found",`unabled to find palette ${n}`)}return 0}).command("charset",(e,t)=>{const[n]=it(t,0,[J.NAME]),r=hb(),i=oi(x.book,xt.CHARSET,n);return T(i)?(r.charset=i.id,ne(H,`loaded charset ${n}`)):se(H,"not-found",`unabled to find charset ${n}`),0}),K4=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),M1=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),W4=["NORTH","SOUTH","WEST","EAST"];function G4(e){const t=Xs(e);if(Lt(t.inputcurrent)||(t.inputcurrent=0),Xt(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=sn.NONE,i=0]=n??[sn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&gk?1:0,t.inputctrl=i&yk?1:0,t.inputshift=i&_k?1:0,r){case sn.MOVE_UP:case sn.MOVE_DOWN:case sn.MOVE_LEFT:case sn.MOVE_RIGHT:t.inputmove=[W4[r-sn.MOVE_UP]];break;case sn.OK_BUTTON:t.inputok=1;break;case sn.CANCEL_BUTTON:t.inputcancel=1;break;case sn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==sn.NONE&&o!==r}),t}const H4=nr({get(e,t){var a;if(x.elementisplayer&&K4.has(t)){const c=G4(x.elementid)[t];return[T(c),c]}const n=(a=x.element)==null?void 0:a[t];if(T(n)||M1.has(t))return[!0,n];const i=fc(x.board,x.element,x.elementfocus),s=(i==null?void 0:i.id)??x.elementfocus,o=Xs(s)[t];return[T(o),o]},set(e,t,n){var a;const r=(a=x.element)==null?void 0:a[t];if(T(r)||M1.has(t))return T(x.element)&&(x.element[t]=n),[!0,n];const i=fc(x.board,x.element,x.elementfocus),s=(i==null?void 0:i.id)??x.elementfocus,o=Xs(s);return T(o)?(o[t]=n,[!0,n]):[!1,n]},everytick(e){var t;T((t=x.element)==null?void 0:t.stepx)&&T(x.element.stepy)&&ud(e,x.book,x.board,x.element,{x:x.elementpt.x+x.element.stepx,y:x.elementpt.y+x.element.stepy})===!1&&(x.element.stepx=0,x.element.stepy=0,o1(x.book,x.element,"destructible")&&Ci(x.book,x.board,x.element,x.timestamp)),e.bucketempty()}}).command("become",(e,t)=>{const[n]=it(t,0,[J.KIND]);return Ur(x.book,x.board),Df(x.book,x.board,x.element),Ci(x.book,x.board,x.element,x.timestamp)&&ml(x.book,x.board,n,x.elementpt),e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[J.NUMBER]);return T(x.element)&&(x.element.char=n),0}).command("color",(e,t)=>{const[n]=it(t,0,[J.COLOR]);return T(x.element)&&T(n)&&wc(x.element,n),0}).command("go",(e,t)=>{if(T(x.element)){const[n]=it(t,0,[J.DIR]);if(ud(e,x.book,x.board,x.element,n),e.yield(),x.element.x===n.x&&x.element.y===n.y)return 0}return 1}).command("try",(e,t)=>{const[,n]=it(t,0,[J.DIR]);return e.command("go",...t)&&n<t.length&&e.command(...t.slice(n)),0}).command("walk",(e,t)=>{if(!T(x.element))return 0;const[n]=it(t,0,[J.DIR]),r=x.element.x??0,i=x.element.y??0;return x.element.stepx=n.x-r,x.element.stepy=n.y-i,0}),Y4=nr().command("clear",(e,t)=>(t.forEach(n=>e.set(An(n),0)),0)).command("set",(e,t)=>{const[n,r]=it(t,0,[J.NAME,J.ANY]);return e.set(n,r),0}).command("take",(e,t)=>{const[n,r,i]=it(t,0,[J.NAME,J.MAYBE_NUMBER]),s=e.get(n),o=r??1;if(!Lt(s))return 1;const a=s-o;return a<0?(i<t.length&&e.command(...t.slice(i)),1):(e.set(n,a),0)}).command("give",(e,t)=>{const[n,r,i]=it(t,0,[J.NAME,J.MAYBE_NUMBER]),s=e.get(n),o=Lt(s)?s:0,a=r??1;if(!Lt(a))return 0;const c=s===void 0?1:0;return c&&i<t.length&&e.command(...t.slice(i)),e.set(n,o+a),c}),V4=nr().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[J.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(An(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(An(t[0])),0)).command("cycle",(e,t)=>{if(T(x.element)){const[n]=it(t,0,[J.NUMBER]);x.element.cycle=On(Math.round(n),1,255)}return 0}).command("die",e=>(Ci(x.book,x.board,x.element,x.timestamp),e.endofprogram(),0)).command("endgame",()=>(x.elementisplayer&&Ld(H,x.elementid),0)).command("run",(e,t)=>{const[n]=it(t,0,[J.NAME]);return Nl(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[J.ANY,J.NAME]);return e.set("arg",n),Nl(r),0}),yl={};function q4(e){var t;return(t=yl[e])==null?void 0:t.arg}function J4(e){var t;return(t=yl[e])==null?void 0:t.format}function Gs(e){var t;return(t=yl[e])==null?void 0:t.content}function X4(e,t,n,r,i){const s=Me(Vt.MAIN);if(!T(s))return;const o=e4(s,xt.LOADER).filter(a=>{const c=os(a),u=c.format,l=kt(u)?new RegExp(u).test(t):!1,h=c.event,f=kt(h)?new RegExp(h).test(n):!1;return kt(u)&&kt(h)?l&&f:kt(u)?l:kt(h)?f:!1});for(let a=0;a<o.length;++a){const c=`${Te()}_loader`;yl[c]={arg:e,format:t,content:r,player:i},OM(c,o[a].code)}}function U1(e,t){if(!T(e))return;const n=Dt(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const Z4=(e,t)=>{const n=Gs(e.id());if(!T(n))return 0;const[r,i]=it(t,0,[J.NAME]),s=Dt(r);switch(s){case"seek":{const[o]=it(t,i,[J.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[J.NAME]);e.set(o,U1(n,s));break}case"text":{const[o,a]=it(t,i,[J.NAME,J.NAME]),c=U1(n,o);if(Lt(c)&&kt(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[J.NAME]),a=Mf(x.book,xt.PALETTE,o),c=Oi(a);if(T(c)){const u=lk*ec,l=Qm(new Uint8Array(n.bytes.buffer,n.cursor,u));T(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=it(t,i,[J.NAME]),a=Mf(x.book,xt.CHARSET,o),c=Oi(a);if(T(c)){const u=ic*ck*th,l=tg(new Uint8Array(n.bytes.buffer,n.cursor,u));T(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},Hs=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",_l=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!_l(e[n],t[n]))return!1;return!0}if(Hs(e)&&Hs(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!_l(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},bl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(Hs(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},Q4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",P1=e=>e>="0"&&e<="9"||e==="-",tL=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var Y;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(Y||(Y={}));const B1={"(":Y.TOK_LPAREN,")":Y.TOK_RPAREN,"*":Y.TOK_STAR,",":Y.TOK_COMMA,".":Y.TOK_DOT,":":Y.TOK_COLON,"@":Y.TOK_CURRENT,$:Y.TOK_ROOT,"]":Y.TOK_RBRACKET,"{":Y.TOK_LBRACE,"}":Y.TOK_RBRACE},eL={"!":!0,"<":!0,"=":!0,">":!0},nL={"	":!0,"\n":!0,"\r":!0," ":!0};class rL{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(Q4(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:Y.TOK_UNQUOTEDIDENTIFIER,value:i});else if(B1[t[this._current]]!==void 0)n.push({start:this._current,type:B1[t[this._current]],value:t[this._current]}),this._current+=1;else if(P1(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:Y.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:Y.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:Y.TOK_LITERAL,value:o})}else if(eL[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(nL[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:Y.TOK_AND,value:"&&"})):n.push({start:r,type:Y.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:Y.TOK_OR,value:"||"})):n.push({start:r,type:Y.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&tL(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;P1(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:Y.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:Y.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:Y.TOK_FLATTEN,value:"[]"}):{start:n,type:Y.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_NE,value:"!="}):{start:n,type:Y.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_LTE,value:"<="}):{start:n,type:Y.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_GTE,value:">="}):{start:n,type:Y.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:Y.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const iL=new rL,en={[Y.TOK_EOF]:0,[Y.TOK_UNQUOTEDIDENTIFIER]:0,[Y.TOK_QUOTEDIDENTIFIER]:0,[Y.TOK_RBRACKET]:0,[Y.TOK_RPAREN]:0,[Y.TOK_COMMA]:0,[Y.TOK_RBRACE]:0,[Y.TOK_NUMBER]:0,[Y.TOK_CURRENT]:0,[Y.TOK_EXPREF]:0,[Y.TOK_ROOT]:0,[Y.TOK_PIPE]:1,[Y.TOK_OR]:2,[Y.TOK_AND]:3,[Y.TOK_EQ]:5,[Y.TOK_GT]:5,[Y.TOK_LT]:5,[Y.TOK_GTE]:5,[Y.TOK_LTE]:5,[Y.TOK_NE]:5,[Y.TOK_FLATTEN]:9,[Y.TOK_STAR]:20,[Y.TOK_FILTER]:21,[Y.TOK_DOT]:40,[Y.TOK_NOT]:45,[Y.TOK_LBRACE]:50,[Y.TOK_LBRACKET]:55,[Y.TOK_LPAREN]:60};class sL{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Y.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...iL.tokenize(t),{type:Y.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<en[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case Y.TOK_LITERAL:return{type:"Literal",value:t.value};case Y.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case Y.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===Y.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Y.TOK_NOT:return r=this.expression(en.Not),{type:"NotExpression",children:[r]};case Y.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Y.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(en.Star),{type:"ValueProjection",children:[n,r]};case Y.TOK_FILTER:return this.led(t.type,{type:"Identity"});case Y.TOK_LBRACE:return this.parseMultiselectHash();case Y.TOK_FLATTEN:return n={type:Y.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(en.Flatten),{type:"Projection",children:[n,r]};case Y.TOK_LBRACKET:return this.lookahead(0)===Y.TOK_NUMBER||this.lookahead(0)===Y.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Y.TOK_STAR&&this.lookahead(1)===Y.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(en.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Y.TOK_CURRENT:return{type:Y.TOK_CURRENT};case Y.TOK_ROOT:return{type:Y.TOK_ROOT};case Y.TOK_EXPREF:return i=this.expression(en.Expref),{type:"ExpressionReference",children:[i]};case Y.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Y.TOK_RPAREN;)this.lookahead(0)===Y.TOK_CURRENT?(i={type:Y.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Y.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case Y.TOK_DOT:const i=en.Dot;return this.lookahead(0)!==Y.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Y.TOK_PIPE:return r=this.expression(en.Pipe),{type:Y.TOK_PIPE,children:[n,r]};case Y.TOK_OR:return r=this.expression(en.Or),{type:"OrExpression",children:[n,r]};case Y.TOK_AND:return r=this.expression(en.And),{type:"AndExpression",children:[n,r]};case Y.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Y.TOK_RPAREN;)this.lookahead(0)===Y.TOK_CURRENT?(a={type:Y.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Y.TOK_COMMA&&this.match(Y.TOK_COMMA),o.push(a);return this.match(Y.TOK_RPAREN),{name:s,type:"Function",children:o};case Y.TOK_FILTER:const u=this.expression(0);return this.match(Y.TOK_RBRACKET),r=this.lookahead(0)===Y.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(en.Filter),{type:"FilterProjection",children:[n,r,u]};case Y.TOK_FLATTEN:const l={type:Y.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(en.Flatten);return{type:"Projection",children:[l,h]};case Y.TOK_EQ:case Y.TOK_NE:case Y.TOK_GT:case Y.TOK_GTE:case Y.TOK_LT:case Y.TOK_LTE:return this.parseComparator(n,t);case Y.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===Y.TOK_NUMBER||f.type===Y.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Y.TOK_STAR),this.match(Y.TOK_RBRACKET),r=this.parseProjectionRHS(en.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Y.TOK_COLON||this.lookahead(1)===Y.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Y.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(en.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Y.TOK_RBRACKET&&n<3;){if(r===Y.TOK_COLON)n+=1,this.advance();else if(r===Y.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Y.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(en[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([Y.TOK_UNQUOTEDIDENTIFIER,Y.TOK_QUOTEDIDENTIFIER,Y.TOK_STAR].includes(n))return this.expression(t);if(n===Y.TOK_LBRACKET)return this.match(Y.TOK_LBRACKET),this.parseMultiselectList();if(n===Y.TOK_LBRACE)return this.match(Y.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(en[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Y.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===Y.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===Y.TOK_DOT)return this.match(Y.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==Y.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===Y.TOK_COMMA&&(this.match(Y.TOK_COMMA),this.lookahead(0)===Y.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Y.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[Y.TOK_UNQUOTEDIDENTIFIER,Y.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Y.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Y.TOK_COMMA)this.match(Y.TOK_COMMA);else if(this.lookahead(0)===Y.TOK_RBRACE){this.match(Y.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const oL=new sL;var lt;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(lt||(lt={}));class aL{constructor(t){this.TYPE_NAME_TABLE={[lt.TYPE_NUMBER]:"number",[lt.TYPE_ANY]:"any",[lt.TYPE_STRING]:"string",[lt.TYPE_ARRAY]:"array",[lt.TYPE_OBJECT]:"object",[lt.TYPE_BOOLEAN]:"boolean",[lt.TYPE_EXPREF]:"expression",[lt.TYPE_NULL]:"null",[lt.TYPE_ARRAY_NUMBER]:"Array<number>",[lt.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>Hs(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===lt.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[lt.TYPE_NUMBER,lt.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===lt.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[lt.TYPE_NUMBER,lt.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==lt.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===lt.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![lt.TYPE_NUMBER,lt.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===lt.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===lt.TYPE_NUMBER?n:r===lt.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===lt.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case lt.TYPE_NUMBER:return"number";case lt.TYPE_STRING:return"string";case lt.TYPE_ARRAY:return"array";case lt.TYPE_OBJECT:return"object";case lt.TYPE_BOOLEAN:return"boolean";case lt.TYPE_EXPREF:return"expref";case lt.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[lt.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[lt.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[lt.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[lt.TYPE_STRING,lt.TYPE_ARRAY]},{types:[lt.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[lt.TYPE_STRING]},{types:[lt.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[lt.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[lt.TYPE_STRING]},{types:[lt.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[lt.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[lt.TYPE_STRING,lt.TYPE_ARRAY,lt.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[lt.TYPE_EXPREF]},{types:[lt.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[lt.TYPE_ARRAY_NUMBER,lt.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[lt.TYPE_ARRAY]},{types:[lt.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[lt.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[lt.TYPE_ARRAY_NUMBER,lt.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[lt.TYPE_ARRAY]},{types:[lt.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[lt.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[lt.TYPE_STRING,lt.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[lt.TYPE_ARRAY_STRING,lt.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[lt.TYPE_ARRAY]},{types:[lt.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[lt.TYPE_STRING]},{types:[lt.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[lt.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[lt.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[lt.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[lt.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[lt.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[lt.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(g=>{var E;return(E=!g.optional)!==null&&E!==void 0?E:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=n.length<a,l=n.length>r.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let g=0;g<r.length;g+=1){p=!1,f=r[g].types,d=this.getTypeName(n[g]);let E;for(E=0;E<f.length;E+=1)if(d!==void 0&&this.typeMatches(d,f[E],n[g])){p=!0;break}if(!p&&d!==void 0){const w=f.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${g+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(t,n,r){if(n===lt.TYPE_ANY)return!0;if(n===lt.TYPE_ARRAY_STRING||n===lt.TYPE_ARRAY_NUMBER||n===lt.TYPE_ARRAY){if(n===lt.TYPE_ARRAY)return t===lt.TYPE_ARRAY;if(t===lt.TYPE_ARRAY){let i;n===lt.TYPE_ARRAY_NUMBER?i=lt.TYPE_NUMBER:n===lt.TYPE_ARRAY_STRING&&(i=lt.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return lt.TYPE_STRING;case"[object Number]":return lt.TYPE_NUMBER;case"[object Array]":return lt.TYPE_ARRAY;case"[object Boolean]":return lt.TYPE_BOOLEAN;case"[object Null]":return lt.TYPE_NULL;case"[object Object]":return t.jmespathType===Y.TOK_EXPREF?lt.TYPE_EXPREF:lt.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class cL{constructor(){this._rootValue=null,this.runtime=new aL(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,u,l,h,f,d;switch(t.type){case"Field":return n===null?null:Hs(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),f=1;f<t.children.length;f+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],n),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const g=[...t.children],E=this.computeSliceParams(n.length,g),[w,v,A]=E;if(s=[],A>0)for(f=w;f<v;f+=A)s.push(n[f]);else for(f=w;f>v;f+=A)s.push(n[f]);return s;case"Projection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(t.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(t.children[0],n),!Hs(d))return null;h=[];const O=Object.values(d);for(f=0;f<O.length;f+=1)i=this.visit(t.children[1],O[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;const U=[],L=[];for(f=0;f<d.length;f+=1)r=this.visit(t.children[2],d[f]),bl(r)||U.push(d[f]);for(let M=0;M<U.length;M+=1)i=this.visit(t.children[1],U[M]),i!==null&&L.push(i);return L;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case Y.TOK_EQ:s=_l(o,a);break;case Y.TOK_NE:s=!_l(o,a);break;case Y.TOK_GT:s=o>a;break;case Y.TOK_GTE:s=o>=a;break;case Y.TOK_LT:s=o<a;break;case Y.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case Y.TOK_FLATTEN:const N=this.visit(t.children[0],n);if(!Array.isArray(N))return null;let D=[];for(f=0;f<N.length;f+=1)i=N[f],Array.isArray(i)?D=[...D,...i]:D.push(i);return D;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<t.children.length;f+=1)h.push(this.visit(t.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let P;for(f=0;f<t.children.length;f+=1)P=t.children[f],h[P.name]=this.visit(P.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),bl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),bl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),bl(o);case"Literal":return t.value;case Y.TOK_PIPE:return u=this.visit(t.children[0],n),this.visit(t.children[1],u);case Y.TOK_CURRENT:return n;case Y.TOK_ROOT:return this._rootValue;case"Function":const et=[];for(let M=0;M<t.children.length;M+=1)et.push(this.visit(t.children[M],n));return this.runtime.callFunction(t.name,et);case"ExpressionReference":const dt=t.children[0];return dt.jmespathType=Y.TOK_EXPREF,dt;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const lL=new cL;lt.TYPE_ANY,lt.TYPE_ARRAY,lt.TYPE_ARRAY_NUMBER,lt.TYPE_ARRAY_STRING,lt.TYPE_BOOLEAN,lt.TYPE_EXPREF,lt.TYPE_NULL,lt.TYPE_NUMBER,lt.TYPE_OBJECT,lt.TYPE_STRING;function uL(e,t){const n=oL.parse(t);return lL.search(n,e)}const hL=(e,t)=>{const n=Gs(e.id());if(!T(n))return 0;const[r,i]=it(t,0,[J.NAME,J.NAME]),s=uL(n.json,r);return e.set(i,s),0},fL=(e,t)=>{const n=Gs(e.id());if(!T(n))return 0;const[r,i]=it(t,0,[J.NAME]);switch(Dt(r)){case"seek":{const[o]=it(t,i,[J.NUMBER]);n.cursor=On(o,0,n.lines.length-1);break}case"line":n.cursor=On(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o);if(T(c)){let u=1;for(let l=i;l<t.length;){const[h,f]=it(t,l,[J.NAME]);T(c[u])&&e.set(h,c[u]),++u,l=f}}break}}return 0},dL=nr({get(e,t){const n=J4(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=Gs(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Gs(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=Gs(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=it(t,0,[J.NAME,J.ANY]);return e.message({session:lb(),id:Te(),sender:e.id(),target:n,data:r}),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(An).join(" ");return Bn(H,"$2",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=An(n),s=r.map(An).join(" ");return Bn(H,"$2",`!${s};${i}`),0}).command("txt",fL).command("json",hL).command("bin",Z4);function F1(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=it(i,a,[J.ANY]);Xt(c)&&!ur(c)&&!Pr(c)&&!ci(c)&&!gn(c)?o.push(...c):o.push(c),a=u}switch(Dt(r)){case"get":case"post:json":dw(H,e,t,n,r,o,x.elementfocus);break}return 0}const pL=nr().command("tts",(e,t)=>{const[n,r]=it(t,0,[J.STRING,J.MAYBE_STRING]);return ww(H,r??"",n),0}).command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[J.NAME,J.NAME,J.MAYBE_STRING]);return F1(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[J.ANY,J.NAME,J.NAME,J.MAYBE_STRING]);return F1(n,r,i,s,t,o),1}),mL=nr({set(e,t,n){return kk(e,t,n),[!1,void 0]},everytick(){const e=kr(x.elementid),[t]=e;if(e.length===1&&kt(t)){if(T(x.element))if(t.trim().length===0){const n=on(x.elementid);n.sidebar=[]}else{x.element.tickertext=t,x.element.tickertime=x.timestamp;const n=Pf(x.book,x.element,1,Ut.WHITE,Ut.ONCLEAR);Bn(H,`$${Ut[n.color]}$${n.char}`,t)}}else if(e.length>1)if(x.elementisplayer){const n=on(x.elementid);n.sidebar=e}else{const n=on(x.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var l,h;const[n,r]=it(t,0,[J.NAME,J.ANY]),[i,s]=n.split(":"),o=T(s)?i:"self",a=s??i;function c(f){f.forEach(d=>{T(d.id)&&e.send(d.id,a,r)})}const u=Dt(o);switch(u){case"all":for(const f of Object.keys(((l=x.board)==null?void 0:l.objects)??{}))e.send(f,a,r);break;case"self":e.message({session:H.session(),id:Te(),sender:e.id(),target:a,data:r});break;case"others":for(const f of Object.keys(((h=x.board)==null?void 0:h.objects)??{}))f!==e.id()&&e.send(f,a,r);break;default:{c(fh(x.board,[o]));const f=e.get(u);Xt(f)?c(fh(x.board,f)):c(fh(x.board,[f]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(An).join("");return le(x.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=An(n);return ee(x.elementid,e.id(),i,r,e.get,e.set),0});var ia=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(ia||{});const gL={audio:v4,board:L4,cli:D4,const:j4,display:z4,element:H4,flags:Y4,runtime:mL,lifecycle:V4,loader:dL,network:pL},td=["const","flags","audio","board","display","network","lifecycle","element"],yL={0:[],1:["cli",...td],2:["loader",...td],3:["runtime",...td]},_L={0:new Map,1:new Map,2:new Map,3:new Map};function sa(e){return(yL[e]??[]).map(n=>gL[n]).filter(T)}function bL(e,t){const n=_L[e];if(!n.has(t)){let r;const i=sa(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!T(r));++s);n.set(t,r)}return n.get(t)}function wL(e,t,n){const r=sa(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function EL(e,t,n,r){const i=sa(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function TL(e,t){const n=sa(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function D1(e,t){const n=sa(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var $1={},j1={},z1={};const K1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");z1.encode=function(e){if(0<=e&&e<K1.length)return K1[e];throw new TypeError("Must be between 0 and 63: "+e)};const vL=z1,W1=5,G1=1<<W1,kL=G1-1,AL=G1;function xL(e){return e<0?(-e<<1)+1:(e<<1)+0}j1.encode=function(t){let n="",r,i=xL(t);do r=i&kL,i>>>=W1,i>0&&(r|=AL),n+=vL.encode(r);while(i>0);return n};var oa={};(function(e){function t(L,N,D){if(N in L)return L[N];if(arguments.length===3)return D;throw new Error('"'+N+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(L){const N=L.match(n);return N?{scheme:N[1],auth:N[2],host:N[3],port:N[4],path:N[5]}:null}e.urlParse=i;function s(L){let N="";return L.scheme&&(N+=L.scheme+":"),N+="//",L.auth&&(N+=L.auth+"@"),L.host&&(N+=L.host),L.port&&(N+=":"+L.port),L.path&&(N+=L.path),N}e.urlGenerate=s;const o=32;function a(L){const N=[];return function(D){for(let et=0;et<N.length;et++)if(N[et].input===D){const dt=N[0];return N[0]=N[et],N[et]=dt,N[0].result}const P=L(D);return N.unshift({input:D,result:P}),N.length>o&&N.pop(),P}}const c=a(function(N){let D=N;const P=i(N);if(P){if(!P.path)return N;D=P.path}const et=e.isAbsolute(D),dt=[];let M=0,R=0;for(;;)if(M=R,R=D.indexOf("/",M),R===-1){dt.push(D.slice(M));break}else for(dt.push(D.slice(M,R));R<D.length&&D[R]==="/";)R++;let _=0;for(R=dt.length-1;R>=0;R--){const B=dt[R];B==="."?dt.splice(R,1):B===".."?_++:_>0&&(B===""?(dt.splice(R+1,_),_=0):(dt.splice(R,2),_--))}return D=dt.join("/"),D===""&&(D=et?"/":"."),P?(P.path=D,s(P)):D});e.normalize=c;function u(L,N){L===""&&(L="."),N===""&&(N=".");const D=i(N),P=i(L);if(P&&(L=P.path||"/"),D&&!D.scheme)return P&&(D.scheme=P.scheme),s(D);if(D||N.match(r))return N;if(P&&!P.host&&!P.path)return P.host=N,s(P);const et=N.charAt(0)==="/"?N:c(L.replace(/\/+$/,"")+"/"+N);return P?(P.path=et,s(P)):et}e.join=u,e.isAbsolute=function(L){return L.charAt(0)==="/"||n.test(L)};function l(L,N){L===""&&(L="."),L=L.replace(/\/$/,"");let D=0;for(;N.indexOf(L+"/")!==0;){const P=L.lastIndexOf("/");if(P<0||(L=L.slice(0,P),L.match(/^([^\/]+:\/)?\/*$/)))return N;++D}return Array(D+1).join("../")+N.substr(L.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function f(L){return L}function d(L){return g(L)?"$"+L:L}e.toSetString=h?f:d;function p(L){return g(L)?L.slice(1):L}e.fromSetString=h?f:p;function g(L){if(!L)return!1;const N=L.length;if(N<9||L.charCodeAt(N-1)!==95||L.charCodeAt(N-2)!==95||L.charCodeAt(N-3)!==111||L.charCodeAt(N-4)!==116||L.charCodeAt(N-5)!==111||L.charCodeAt(N-6)!==114||L.charCodeAt(N-7)!==112||L.charCodeAt(N-8)!==95||L.charCodeAt(N-9)!==95)return!1;for(let D=N-10;D>=0;D--)if(L.charCodeAt(D)!==36)return!1;return!0}function E(L,N,D){let P=v(L.source,N.source);return P!==0||(P=L.originalLine-N.originalLine,P!==0)||(P=L.originalColumn-N.originalColumn,P!==0||D)||(P=L.generatedColumn-N.generatedColumn,P!==0)||(P=L.generatedLine-N.generatedLine,P!==0)?P:v(L.name,N.name)}e.compareByOriginalPositions=E;function w(L,N,D){let P=L.generatedLine-N.generatedLine;return P!==0||(P=L.generatedColumn-N.generatedColumn,P!==0||D)||(P=v(L.source,N.source),P!==0)||(P=L.originalLine-N.originalLine,P!==0)||(P=L.originalColumn-N.originalColumn,P!==0)?P:v(L.name,N.name)}e.compareByGeneratedPositionsDeflated=w;function v(L,N){return L===N?0:L===null?1:N===null?-1:L>N?1:-1}function A(L,N){let D=L.generatedLine-N.generatedLine;return D!==0||(D=L.generatedColumn-N.generatedColumn,D!==0)||(D=v(L.source,N.source),D!==0)||(D=L.originalLine-N.originalLine,D!==0)||(D=L.originalColumn-N.originalColumn,D!==0)?D:v(L.name,N.name)}e.compareByGeneratedPositionsInflated=A;function O(L){return JSON.parse(L.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=O;function U(L,N,D){if(N=N||"",L&&(L[L.length-1]!=="/"&&N[0]!=="/"&&(L+="/"),N=L+N),D){const P=i(D);if(!P)throw new Error("sourceMapURL could not be parsed");if(P.path){const et=P.path.lastIndexOf("/");et>=0&&(P.path=P.path.substring(0,et+1))}N=u(s(P),N)}return c(N)}e.computeSourceURL=U})(oa);var ed={};let SL=class Tb{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new Tb;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};ed.ArraySet=SL;var H1={};const Y1=oa;function RL(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||Y1.compareByGeneratedPositionsInflated(e,t)<=0}let IL=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){RL(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Y1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};H1.MappingList=IL;const aa=j1,Le=oa,wl=ed.ArraySet,OL=H1.MappingList;let V1=class vb{constructor(t){t||(t={}),this._file=Le.getArg(t,"file",null),this._sourceRoot=Le.getArg(t,"sourceRoot",null),this._skipValidation=Le.getArg(t,"skipValidation",!1),this._sources=new wl,this._names=new wl,this._mappings=new OL,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new vb({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Le.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Le.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Le.getArg(t,"generated"),r=Le.getArg(t,"original",null);let i=Le.getArg(t,"source",null),s=Le.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Le.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Le.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Le.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Le.relative(s,i));const o=this._mappings.toArray().length>0?new wl:this._sources,a=new wl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Le.join(r,c.source)),s!=null&&(c.source=Le.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=Le.join(r,c)),s!=null&&(c=Le.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const f=this._mappings.toArray();for(let d=0,p=f.length;d<p;d++){if(u=f[d],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(d>0){if(!Le.compareByGeneratedPositionsInflated(u,f[d-1]))continue;c+=","}c+=aa.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=aa.encode(h-o),o=h,c+=aa.encode(u.originalLine-1-i),i=u.originalLine-1,c+=aa.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=aa.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Le.relative(n,r));const i=Le.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};V1.prototype._version=3,$1.SourceMapGenerator=V1;var q1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(q1);var ca={exports:{}},NL=null,CL=Object.freeze({__proto__:null,default:NL}),LL=kb(CL),nd,J1;function ML(){if(J1)return nd;J1=1;function e(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function t(i,s){for(var o="",a=0,c=-1,u=0,l,h=0;h<=i.length;++h){if(h<i.length)l=i.charCodeAt(h);else{if(l===47)break;l=47}if(l===47){if(!(c===h-1||u===1))if(c!==h-1&&u===2){if(o.length<2||a!==2||o.charCodeAt(o.length-1)!==46||o.charCodeAt(o.length-2)!==46){if(o.length>2){var f=o.lastIndexOf("/");if(f!==o.length-1){f===-1?(o="",a=0):(o=o.slice(0,f),a=o.length-1-o.lastIndexOf("/")),c=h,u=0;continue}}else if(o.length===2||o.length===1){o="",a=0,c=h,u=0;continue}}s&&(o.length>0?o+="/..":o="..",a=2)}else o.length>0?o+="/"+i.slice(c+1,h):o=i.slice(c+1,h),a=h-c-1;c=h,u=0}else l===46&&u!==-1?++u:u=-1}return o}function n(i,s){var o=s.dir||s.root,a=s.base||(s.name||"")+(s.ext||"");return o?o===s.root?o+a:o+i+a:a}var r={resolve:function(){for(var s="",o=!1,a,c=arguments.length-1;c>=-1&&!o;c--){var u;c>=0?u=arguments[c]:(a===void 0&&(a=Wr.cwd()),u=a),e(u),u.length!==0&&(s=u+"/"+s,o=u.charCodeAt(0)===47)}return s=t(s,!o),o?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(e(s),s.length===0)return".";var o=s.charCodeAt(0)===47,a=s.charCodeAt(s.length-1)===47;return s=t(s,!o),s.length===0&&!o&&(s="."),s.length>0&&a&&(s+="/"),o?"/"+s:s},isAbsolute:function(s){return e(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,o=0;o<arguments.length;++o){var a=arguments[o];e(a),a.length>0&&(s===void 0?s=a:s+="/"+a)}return s===void 0?".":r.normalize(s)},relative:function(s,o){if(e(s),e(o),s===o||(s=r.resolve(s),o=r.resolve(o),s===o))return"";for(var a=1;a<s.length&&s.charCodeAt(a)===47;++a);for(var c=s.length,u=c-a,l=1;l<o.length&&o.charCodeAt(l)===47;++l);for(var h=o.length,f=h-l,d=u<f?u:f,p=-1,g=0;g<=d;++g){if(g===d){if(f>d){if(o.charCodeAt(l+g)===47)return o.slice(l+g+1);if(g===0)return o.slice(l+g)}else u>d&&(s.charCodeAt(a+g)===47?p=g:g===0&&(p=0));break}var E=s.charCodeAt(a+g),w=o.charCodeAt(l+g);if(E!==w)break;E===47&&(p=g)}var v="";for(g=a+p+1;g<=c;++g)(g===c||s.charCodeAt(g)===47)&&(v.length===0?v+="..":v+="/..");return v.length>0?v+o.slice(l+p):(l+=p,o.charCodeAt(l)===47&&++l,o.slice(l))},_makeLong:function(s){return s},dirname:function(s){if(e(s),s.length===0)return".";for(var o=s.charCodeAt(0),a=o===47,c=-1,u=!0,l=s.length-1;l>=1;--l)if(o=s.charCodeAt(l),o===47){if(!u){c=l;break}}else u=!1;return c===-1?a?"/":".":a&&c===1?"//":s.slice(0,c)},basename:function(s,o){if(o!==void 0&&typeof o!="string")throw new TypeError('"ext" argument must be a string');e(s);var a=0,c=-1,u=!0,l;if(o!==void 0&&o.length>0&&o.length<=s.length){if(o.length===s.length&&o===s)return"";var h=o.length-1,f=-1;for(l=s.length-1;l>=0;--l){var d=s.charCodeAt(l);if(d===47){if(!u){a=l+1;break}}else f===-1&&(u=!1,f=l+1),h>=0&&(d===o.charCodeAt(h)?--h===-1&&(c=l):(h=-1,c=f))}return a===c?c=f:c===-1&&(c=s.length),s.slice(a,c)}else{for(l=s.length-1;l>=0;--l)if(s.charCodeAt(l)===47){if(!u){a=l+1;break}}else c===-1&&(u=!1,c=l+1);return c===-1?"":s.slice(a,c)}},extname:function(s){e(s);for(var o=-1,a=0,c=-1,u=!0,l=0,h=s.length-1;h>=0;--h){var f=s.charCodeAt(h);if(f===47){if(!u){a=h+1;break}continue}c===-1&&(u=!1,c=h+1),f===46?o===-1?o=h:l!==1&&(l=1):o!==-1&&(l=-1)}return o===-1||c===-1||l===0||l===1&&o===c-1&&o===a+1?"":s.slice(o,c)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return n("/",s)},parse:function(s){e(s);var o={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return o;var a=s.charCodeAt(0),c=a===47,u;c?(o.root="/",u=1):u=0;for(var l=-1,h=0,f=-1,d=!0,p=s.length-1,g=0;p>=u;--p){if(a=s.charCodeAt(p),a===47){if(!d){h=p+1;break}continue}f===-1&&(d=!1,f=p+1),a===46?l===-1?l=p:g!==1&&(g=1):l!==-1&&(g=-1)}return l===-1||f===-1||g===0||g===1&&l===f-1&&l===h+1?f!==-1&&(h===0&&c?o.base=o.name=s.slice(1,f):o.base=o.name=s.slice(h,f)):(h===0&&c?(o.name=s.slice(1,l),o.base=s.slice(1,f)):(o.name=s.slice(h,l),o.base=s.slice(h,f)),o.ext=s.slice(l,f)),h>0?o.dir=s.slice(0,h-1):c&&(o.dir="/"),o},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,nd=r,nd}if((function(){return typeof window<"u"&&this===window}).call()){let e=null;ca.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},ca.exports.initialize=t=>e=t}else{const e=LL,t=ML();ca.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},ca.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var X1=ca.exports;const UL=X1;function PL(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let la=null;var BL=function(){if(la)return la;const t=[];return la=UL().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,f){const d=new PL;d.generatedLine=r+1,d.generatedColumn=i,s&&(d.lastGeneratedColumn=o-1),a&&(d.source=c,d.originalLine=u+1,d.originalColumn=l,h&&(d.name=f)),t[t.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw la=null,n}),la};const Tt=oa,rd=q1,El=ed.ArraySet,FL=X1,DL=BL,id=Symbol("smcInternal");class Oe{constructor(t,n){return t==id?Promise.resolve(this):jL(t,n)}static initialize(t){FL.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return zL(t,n)}static async with(t,n,r){const i=await new Oe(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Oe.prototype._version=3,Oe.GENERATED_ORDER=1,Oe.ORIGINAL_ORDER=2,Oe.GREATEST_LOWER_BOUND=1,Oe.LEAST_UPPER_BOUND=2;class ua extends Oe{constructor(t,n){return super(id).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const u=Tt.getArg(i,"sourcesContent",null),l=Tt.getArg(i,"mappings"),h=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(f){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(f)?Tt.relative(c,f):f}),r._names=El.fromArray(a.map(String),!0),r._sources=El.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return Tt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,DL().then(f=>(r._wasm=f,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new ua(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Oe.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Oe.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Oe.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Tt.getArg(t,"source");const r=Tt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(t,"bias",Oe.GREATEST_LOWER_BOUND);r==null&&(r=Oe.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Tt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(t,"line"),originalColumn:Tt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(t,"bias",Oe.GREATEST_LOWER_BOUND);i==null&&(i=Oe.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}ua.prototype.consumer=Oe;class $L extends Oe{constructor(t,n){return super(id).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new El,r._names=new El,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=Tt.getArg(c,"offset"),l=Tt.getArg(u,"line"),h=Tt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new Oe(Tt.getArg(c,"map"),n).then(d=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:d}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Tt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")},r=rd.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const f={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(t,n,r){const i=n||null,s=r||Oe.GENERATED_ORDER;let o;switch(s){case Oe.GENERATED_ORDER:o=this._generatedMappings;break;case Oe.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=Tt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return rd.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Tt.getArg(t,"line"),r={source:Tt.getArg(t,"source"),originalLine:n,originalColumn:Tt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,rd.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function jL(e,t){let n=e;typeof e=="string"&&(n=Tt.parseSourceMapInput(e));const r=n.sections!=null?new $L(n,t):new ua(n,t);return Promise.resolve(r)}function zL(e,t){return ua.fromSourceMap(e,t)}var Z1={};const KL=$1.SourceMapGenerator,Tl=oa,WL=/(\r?\n)/,GL=10,Ys="$$$isSourceNode$$$";let HL=class md{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[Ys]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new md,s=t.split(WL);let o=0;const a=function(){const d=g(),p=g()||"";return d+p;function g(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(d){if(l!==null)if(c<d.generatedLine)f(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,d.generatedColumn-u);s[o]=h.substr(d.generatedColumn-u),u=d.generatedColumn,f(l,p),l=d;return}for(;c<d.generatedLine;)i.add(a()),c++;u<d.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,d.generatedColumn)),s[o]=h.substr(d.generatedColumn),u=d.generatedColumn),l=d},this),o<s.length&&(l&&f(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(d){const p=n.sourceContentFor(d);p!=null&&(r!=null&&(d=Tl.join(r,d)),i.setSourceContent(d,p))}),i;function f(d,p){if(d===null||d.source===void 0)i.add(p);else{const g=r?Tl.join(r,d.source):d.source;i.add(new md(d.originalLine,d.originalColumn,g,p,d.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[Ys]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[Ys]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[Ys]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[Ys]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Tl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][Ys]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Tl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new KL(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,f=u.length;h<f;h++)u.charCodeAt(h)===GL?(n.line++,n.column=0,h+1===f?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};Z1.SourceNode=HL;var YL=Z1.SourceNode;let Q1=0;const tb=Ar,VL=["Command","lines"];class qL extends IC{constructor(){super(Z_,{traceInitPerf:Ar,skipValidations:!Ar,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ot(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ot(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(ea)}])}));Ot(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ot(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ot(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ot(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(x_)}));Ot(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(wf)}));Ot(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(k_)}])}));Ot(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(A_)}));Ot(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(S_),this.SUBRULE(this.words),this.CONSUME(R_)}));Ot(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME($s),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ot(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ot(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ot(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ot(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(xf),this.SUBRULE(this.words)}));Ot(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(j_),this.SUBRULE(this.words)}));Ot(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Sf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ot(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ll),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(ea)),this.CONSUME4($s),this.CONSUME4(Rf)}}])}));Ot(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ll),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME($s),this.CONSUME(Rf)}}])}));Ot(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ll),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ot(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME($s),this.CONSUME(If),this.CONSUME(Sf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_else",this.RULED("command_else",()=>{this.CONSUME($s),this.CONSUME(If),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(G_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(H_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Y_),this.SUBRULE(this.words)}));Ot(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(V_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(q_)}));Ot(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(J_)}));Ot(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(W_)}));Ot(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Ef),this.SUBRULE2(this.and_test)})}));Ot(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(vf),this.SUBRULE2(this.not_test)})}));Ot(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Tf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ot(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ot(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(N_)},{ALT:()=>this.CONSUME(C_)},{ALT:()=>this.CONSUME(L_)},{ALT:()=>this.CONSUME(M_)},{ALT:()=>this.CONSUME(U_)},{ALT:()=>this.CONSUME(P_)}])}));Ot(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Ef),this.SUBRULE2(this.and_test_value)})}));Ot(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(vf),this.SUBRULE2(this.not_test_value)})}));Ot(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Tf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ot(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ot(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(kf)},{ALT:()=>this.CONSUME(Af)}]),this.SUBRULE(this.term)}));Ot(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ot(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(F_)},{ALT:()=>this.CONSUME(xf)},{ALT:()=>this.CONSUME(D_)},{ALT:()=>this.CONSUME($_)}]),this.SUBRULE(this.factor)}));Ot(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(kf)},{ALT:()=>this.CONSUME(Af)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ot(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(B_),this.SUBRULE(this.factor)})}));Ot(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ot(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(I_)},{ALT:()=>this.CONSUME(hn)},{ALT:()=>this.CONSUME(O_)},{ALT:()=>{this.CONSUME(z_),this.SUBRULE(this.expr),this.CONSUME(K_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=VL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(Q1++).toString().padStart(3),c=s?"font-weight: bold;":"";if(tb&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),tb&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),Q1--},i)}}const Vs=new qL;if(Rk){const e=Vs.getGAstProductions(),t=jC(e);console.info(t)}const JL=Vs.getBaseCstVisitorConstructor();var gt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(gt||{}),ls=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(ls||{}),Fr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Fr||{}),vl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(vl||{});function XL(e){return!!(e!=null&&e.tokenType)}function fi(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class ZL extends JL{constructor(){super();Ot(this,"unique",0);Ar&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&XL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():T(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:fi(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:fi(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:fi(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:fi(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:fi(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,"if","",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Te(),i=Te();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Te(),i=Te();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,"if",r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Te(),i=Te();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Te(),i=Te(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Te(),i=Te(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Te();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=fi(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=fi(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=fi(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(fi(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const QL=new ZL,kn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},kl="zss.js";function Yt(e,t){return new YL(e.startLine??1,e.startColumn??1,kl,t)}function sd(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function od(e){return`'${sd(e)}'`}function Al(e){if(e.startsWith('"'))return Al(e.replaceAll(/(^"|"$)/g,""));const t=Xf(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===qf?`', api.get('${sd(r.image.substring(1))}'), '`:sd(r.image)).join("")}'].join('')`}function qs(e){return e.filter(t=>t!==void 0).map(te)}function eb(e){return Yt(e,"")}function tM(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function Ke(e,t,n){return Yt(e,[`api.${t}(`,...tM(n,", "),")"])}function eM(e){if(e.type===gt.COMPARE&&e.compare.type===gt.COMPARE_ITEM)switch(e.compare.method){case ls.IS_EQ:return Ke(e,"isEq",[te(e.lhs),te(e.rhs)]);case ls.IS_NOT_EQ:return Ke(e,"isNotEq",[te(e.lhs),te(e.rhs)]);case ls.IS_LESS_THAN:return Ke(e,"isLessThan",[te(e.lhs),te(e.rhs)]);case ls.IS_GREATER_THAN:return Ke(e,"isGreaterThan",[te(e.lhs),te(e.rhs)]);case ls.IS_LESS_THAN_OR_EQ:return Ke(e,"isLessThanOrEq",[te(e.lhs),te(e.rhs)]);case ls.IS_GREATER_THAN_OR_EQ:return Ke(e,"isGreaterThanOrEq",[te(e.lhs),te(e.rhs)])}return Yt(e,"")}function us(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",te(n),")"])}function nb(e,t,n){return e.prepend(`api.${t}(`),e.add([te(n),")"])}function nM(e,t){if(e.type===gt.OPERATOR_ITEM)switch(e.operator){case Fr.PLUS:return us(t,"opPlus",e.rhs);case Fr.MINUS:return us(t,"opMinus",e.rhs);case Fr.POWER:return us(t,"opPower",e.rhs);case Fr.MULTIPLY:return us(t,"opMultiply",e.rhs);case Fr.DIVIDE:return us(t,"opDivide",e.rhs);case Fr.MOD_DIVIDE:return us(t,"opModDivide",e.rhs);case Fr.FLOOR_DIVIDE:return us(t,"opFloorDivide",e.rhs);case Fr.UNI_PLUS:return nb(t,"opUniPlus",e.rhs);case Fr.UNI_MINUS:return nb(t,"opUniMinus",e.rhs)}return Yt(e,"")}function rM(e){if(e.type===gt.OPERATOR){const t=e.lhs?te(e.lhs):Yt(e,"");return e.items.forEach(n=>nM(n,t)),t}return Yt(e,"")}function xl(e,t){return Yt(e,[Ke(e,"jump",[`${t}`]),"; continue;"])}function di(e){return kn.linelookup[e??""]??-1}function ad(e,t){kn.linelookup[e]=t}function Js(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&(i.done=n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&(i.skip=n);break;case gt.LINE:Js(i.stmts,t,n);break}}}function rb(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&ad(i.done,n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&ad(i.skip,n);break;case gt.LINE:rb(i.stmts,t,n);break}}}function te(e){var t;switch(e.type){case gt.PROGRAM:return Yt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(te).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${kl}`]);case gt.API:return Yt(e,["  ",Ke(e,e.method,qs(e.words)),`;
`]);case gt.LINE:return Yt(e,[`case ${e.lineindex}:
`,...e.stmts.map(te).flat(),`  break;
`]);case gt.MARK:return Yt(e,`  // ${e.comment}
`);case gt.GOTO:{const n=di(e.id);return Yt(e,["  ",xl(e,n),`
`])}case gt.COUNT:return Yt(e,`${e.index}`);case gt.LITERAL:switch(e.literal){case vl.NUMBER:return Yt(e,`${e.value}`);case vl.STRING:return Yt(e,od(e.value));case vl.TEMPLATE:return Yt(e,Al(e.value))}return eb(e);case gt.TEXT:return Yt(e,["  ",Ke(e,"text",[Al(e.value)]),`;
`]);case gt.STAT:if(kn.isfirststat){kn.isfirststat=!1;const n=e.value.trim().split(" ").map(od);return Yt(e,["  ",Ke(e,"stat",n),`;
`])}return Yt(e,`  // skipped ${e.value}
`);case gt.LABEL:{const n=Dt(e.name),r=e.active?"label":"comment";kn.labels[n]||(kn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return kn.labels[n].push(i),Yt(e,`  // ${i} '${n}' ${r}
`)}case gt.HYPERLINK:return Yt(e,["  ",Ke(e,"hyperlink",[Al(e.text),...qs(e.link)]),`;
`]);case gt.MOVE:{const n=Ke(e,"command",[od("go"),qs(e.words)].flat());return e.wait?Yt(e,["  if (",n,`) { continue; };
`]):Yt(e,["  ",n,`;
`])}case gt.COMMAND:return Yt(e,["  if (",Ke(e,"command",qs(e.words)),`) { continue; };
`]);case gt.IF:{const n=((t=e.block)==null?void 0:t.type)===gt.IF_BLOCK?e.block:void 0;if(T(n)){Js([e.check],gt.IF_CHECK,n.skip);const r=Yt(e,te(e.check));return n.lines.forEach(i=>r.add(te(i))),rb(n.altlines,gt.ELSE_IF,di(n.done)),n.altlines.forEach(i=>r.add(te(i))),r}return Yt(e,te(e.check))}case gt.IF_CHECK:{const n=di(e.skip);return n===-1?Yt(e,["  ",Ke(e,e.method,qs(e.words)),`;
`]):Yt(e,["  if (!",Ke(e,e.method,qs(e.words)),") { ",xl(e,n),` }
`])}case gt.ELSE_IF:case gt.ELSE:{const n=Yt(e,"");return e.lines.forEach(r=>n.add(te(r))),n}case gt.WHILE:{const n=di(e.loop),r=di(e.done),i=Yt(e,"");return Js(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(te(s))}),i}case gt.REPEAT:{const n=di(e.loop),r=di(e.done),i=Yt(e,"");return Js(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(te(s))}),i}case gt.WAITFOR:{const n=Yt(e,"");return Js(e.lines,gt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(te(r))}),n}case gt.FOREACH:{const n=di(e.loop),r=di(e.done),i=Yt(e,"");return Js(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(te(s))}),i}case gt.BREAK:return Yt(e,["  ",xl(e,e.goto),`
`]);case gt.CONTINUE:return Yt(e,["  ",xl(e,e.goto),`
`]);case gt.OR:return Ke(e,"or",e.items.map(te));case gt.AND:return Ke(e,"and",e.items.map(te));case gt.NOT:return Ke(e,"not",e.items.map(te));case gt.COMPARE:return eM(e);case gt.OPERATOR:return rM(e);case gt.EXPR:return Ke(e,"expr",e.words.map(te));default:return console.error("<unsupported node>",e.type,e),eb(e)}}function Dr(e){if(T(e))switch(e.type===gt.LINE&&++kn.lineindex,e.lineindex=kn.lineindex,e.type){case gt.PROGRAM:e.lines.forEach(Dr);break;case gt.LINE:e.stmts.forEach(Dr);break;case gt.MARK:ad(e.id,e.lineindex);break;case gt.IF:Dr(e.check),Dr(e.block);break;case gt.IF_BLOCK:e.lines.forEach(Dr),e.altlines.forEach(Dr);break;case gt.ELSE_IF:e.lines.forEach(Dr);break;case gt.ELSE:case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.WAITFOR:e.lines.forEach(Dr);break;case gt.MOVE:case gt.COMMAND:case gt.IF_CHECK:e.words.forEach(Dr);break}}function iM(e){return kn.labels={},kn.internal=1,kn.lineindex=0,kn.isfirststat=!0,Dr(e),{...te(e).toStringWithSourceMap({file:`${kl}.map`}),...kn}}function ib(e){return Xt(e)?e.length>0?1:0:e??0}function An(e){return`${e??""}`}function sM(e){return`${e}_chip`}function sb(e=""){return`vm:${e??""}`}function oM(e,t,n){var u,l;const r=sM(e),i=Xs(r);let s;const o=dr(Object.entries(n.labels??{}));(!Xt(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=n.errors)==null?void 0:u.length)??0)!==0?1:0);function a(h,f){x.words=f;const d=bL(t,h);return T(d)?d(c,f):h!=="send"?a("send",[h,...f]):0}const c={halt(){TM(r)},id(){return e},set(h,f){const[d,p]=EL(t,c,h,f);if(d)return p},get(h){const[f,d]=wL(t,c,h);if(f)return d},bucket(h){const f=c.get("bucket");Xt(f)?f.push(h):c.set("bucket",[h])},bucketempty(){const h=c.get("bucket");Xt(h)&&c.set("bucket",0)},tick(h){const f=Lt(i.ps)?i.ps:0,d=f%h===0;if(i.ps=f+1,d===!1)return!1;if(c.shouldtick()===!1)return D1(t,c),!1;i.lc=0,i.ys=0,x.get=c.get,TL(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){se(H,"crash",p.message),i.es=1}return D1(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Lt(i.lc)?++i.lc>Xr.HALT_AT_COUNT:!0},hm(){if(Xt(i.mg)&&Xt(i.lb)){const[h]=i.mg;if(T(h))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)return p.find(g=>Lt(g)&&g>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,f,d,p){H.emit(`${sb(h)}:${f}`,d,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(Xt(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h){const g=p.findIndex(E=>E>0);g>=0&&(p[g]*=-1)}}},restore(h){if(Xt(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)for(let g=0;g<p.length;g++)p[f]=Math.abs(p[f])}},getcase(){i.ec=Lt(i.ec)?i.ec:1;const h=c.hm();if(h&&Xt(i.mg)){const[,f,d,p]=i.mg;c.set("sender",d),T(f)&&c.set("arg",f),p&&c.set("player",p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Lt(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const f=Sk.parse(h),[d]=f.filter(p=>p.fileName===kl);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[f,...d]=h;return a(An(f),d)},if(...h){const[f,d]=it(h,0,[J.ANY]),p=ib(f);return p&&d<h.length&&c.command(...h.slice(d)),p?1:0},repeatstart(h,...f){const[d,p]=it(f,0,[J.NUMBER]),g=`repeatcount${h}`,E=`repeatwords${h}`;i[g]=d,i[E]=p<f.length?f.slice(p):void 0},repeat(h){const f=`repeatcount${h}`,d=`repeatwords${h}`;if(!Lt(i[f]))return 0;const p=i[f];i[f]=p-1;const g=p>0,E=i[d];return g&&Xt(E)&&c.command(...E),g?1:0},foreachstart(h,...f){const[d,p,g,E]=it(f,0,[J.STRING,J.NUMBER,J.NUMBER,J.MAYBE_NUMBER]);let w=Math.min(p,g),v=Math.max(p,g);const A=(E??0)||1;if(A<0){const O=w;w=v,v=O}return c.set(d,w-A),0},foreach(h,...f){const[d,p,g,E,w]=it(f,0,[J.STRING,J.NUMBER,J.NUMBER,J.MAYBE_NUMBER]);let v=Math.min(p,g),A=Math.max(p,g);const O=(E??0)||1;if(O<0){const N=v;v=A,A=N}let U=c.get(d);!Lt(U)||U<v||U>A?U=v:U+=O;const L=U<=A?1:0;return L&&(c.set(d,U),w<f.length&&c.command(...f.slice(w))),L},waitfor(...h){const[f]=it(h,0,[J.ANY]),d=ib(f);return d||c.yield(),d?1:0},or(...h){let f=0;for(let d=0;d<h.length;){const[p,g]=it(h,d,[J.ANY]);if(f=p,f)break;d=g}return f},and(...h){let f=0;for(let d=0;d<h.length;){const[p,g]=it(h,d,[J.ANY]);if(f=p,!f)break;d=g}return f},not(...h){const[f]=it(h,0,[J.ANY]);return f?0:1},expr(...h){const[f]=it(h,0,[J.ANY]);return f},isEq(h,f){const[d]=it([h],0,[J.ANY]),[p]=it([f],0,[J.ANY]);return typeof d=="object"||typeof p=="object"?rw(d,p)?1:0:d===p?1:0},isNotEq(h,f){return this.isEq(h,f)?0:1},isLessThan(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return d<p?1:0},isGreaterThan(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return d>p?1:0},isLessThanOrEq(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return d>=p?1:0},opPlus(h,f){const[d]=it([h],0,[J.ANY]),[p]=it([f],0,[J.ANY]);return d+p},opMinus(h,f){const[d]=it([h],0,[J.ANY]),[p]=it([f],0,[J.ANY]);return d-p},opPower(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return Math.pow(d,p)},opMultiply(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return d*p},opDivide(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return d/p},opModDivide(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return d%p},opFloorDivide(h,f){const[d]=it([h],0,[J.NUMBER]),[p]=it([f],0,[J.NUMBER]);return Math.floor(d/p)},opUniPlus(h){const[f]=it([h],0,[J.NUMBER]);return+f},opUniMinus(h){const[f]=it([h],0,[J.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,c),c}function cd(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];Xt(r)?r.forEach(i=>{t.push(cd(i))}):t.push(cd(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function aM(e){const t=Q_(`${e}
`);if(t.errors.length>0)return t;Vs.input=t.tokens;const n=Vs.program();if(Vs.errors.length>0)return{tokens:t.tokens,errors:Vs.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=QL.go(n);return r?(cd(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const ld=Object.getPrototypeOf(function*(){}).constructor;function cM(e,t){const n=`compile-${e}`;console.time(n);const r=aM(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=iM(r.ast);if(i.code){Ik&&console.info(i.code);try{return{...r,...i,source:i.code,code:new ld("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new ld("api"," ")}}}return{...r,...i,source:"",code:new ld("api"," ")}}function lM(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=cM(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return T(s)?s.isended():!0},halt(i){const s=t[i];return T(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];T(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!T(t[i])){const h=n(a,c);if(u=t[i]=oM(i,s,h),(l=h.errors)!=null&&l.length){const[f]=h.errors,d=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((w,v)=>[w,v]);p.slice(d-5,d).forEach(([w,v])=>{se(H,"build",`$grey${v+1} $grey${w}`)});const[g,E]=p[d]??[];if(kt(g)&&T(E)){const w=(f.column??1)-1,v=w+f.length,A=w<g.length?g:`${g}*`,O=A.substring(0,w),U=A.substring(w,v),L=A.substring(v);se(H,"build",`$red${E+1} $grey${O}$red${U}$grey${L}`)}return f.message.split(`
`).forEach(w=>{se(H,"build",w)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=ro(i.target),a=t[s];if(T(a)){const c={...i,target:o};a.message(c)}}};return r}let ob=0;function uM(){switch(ob++){case 0:return Ut.BLUE;case 1:return Ut.GREEN;case 2:return Ut.CYAN;case 3:return Ut.RED;case 4:return Ut.PURPLE;case 5:return Ut.YELLOW;default:return ob=0,Ut.WHITE}}const hM=new xo,dn={},Sl={};function ab(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return T(dn[s])||(dn[s]=uk(e,t,n,r,i)),dn[s]}function fM(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return T(Sl[s])||(Sl[s]=hk(e,t,n)),Sl[s].id=i,Sl[s]}function dM(e,t){const n=`sprites:${e}:${t}`;return T(dn[n])||(dn[n]=fk(e,t)),dn[n]}function pM(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return T(dn[s])||(dn[s]=dk(e,t,n,r,i)),dn[s]}function cb(e,t,n,r){const i=`media:${e}:${t}`;return T(dn[i])||(dn[i]=pk(e,t,n,r)),dn[i]}function mM(e,t){const n=`control:${e}:${t}`;return T(dn[n])||(dn[n]=mk(e,t)),dn[n]}function gM(e,t,n,r,i){var U,L;const s=[];let o=t;const a=o===0,c=oe,u=an,l=a?Ut.BLACK:Ut.ONCLEAR,h=ab(e,o++,c,u,l);s.push(h);const f=o++,d=dM(e,f);d.sprites=[],s.push(d);const p=pM(e,o++,c,u,r.isdark?1:0);s.push(p);const g=ab(e,o++,c,u,Ut.ONCLEAR);s.push(g),g.char.fill(0);const E={...Zf(oe,an,uM(),Ut.ONCLEAR),...g},w=mM(e,o++);i&&s.push(w);for(let N=0;N<r.terrain.length;++N){const D=r.terrain[N],P=Pf(n,D,0,Ut.BLACK,Ut.ONCLEAR);h.char[N]=P.char,h.color[N]=P.color,h.bg[N]=P.bg}const v=Object.values(r.objects??{});for(let N=0;N<v.length;++N){const D=v[N];if(T(D.removed))continue;const P=D.id??"",et=Pf(n,D,1,Ut.WHITE,Ut.ONCLEAR),dt=fM(e,f,P,N);if(dt.x=D.x??0,dt.y=D.y??0,dt.char=et.char,dt.color=et.color,dt.bg=et.bg,d.sprites.push(dt),r.isdark&&Lt(et.light)){const M=Mk(dt.x,dt.y,et.light);for(let R=0;R<M.length;++R){let _=0;const B=M[R],X=Lk(dt.x,dt.y,B.x,B.y);for(let j=0;j<X.length;j++){const ct=X[j];if(ct.x<0||ct.x>=c||ct.y<0||ct.y>=u)break;const ht=hM.subVectors(ct,dt).length()/(et.light+1),K=1-On(ht+_,0,1),bt=ct.x+ct.y*c;p.alphas[bt]=On(p.alphas[bt]-K,0,1);const st=cs(r,ct);if(st<0||!T(r==null?void 0:r.lookup))break;if(ct.x!==dt.x||ct.y!==dt.y){const Nt=Jn(r,r.lookup[st]??"");T(Nt)&&(_+=.5)}const at=r.terrain[st],Ct=Ni(n,at),Jt=(at==null?void 0:at.collision)??(Ct==null?void 0:Ct.collision);if(hh(jt.ISWALK,Jt))break}}}if(kt(D.tickertext)&&Lt(D.tickertime)&&D.tickertext.length){const M=oe,R=N1(D.tickertext,M,an-1),_=(R==null?void 0:R.measuredwidth)??1,B=D.x??0,X=D.y??0,j=X<an*.5;E.x=B-Math.floor(_*.5),E.y=X+(j?1:-1),E.x+_>oe&&(E.x=oe-_),E.x<0&&(E.x=0),O1(D.tickertext,E,!0)}P===e&&(w.focusx=dt.x,w.focusy=dt.y,w.focusid=P)}const A=Me(Vt.MAIN),O=ai(A,Vt.MAIN);if(kt(O.palette)){const N=oi(A,xt.PALETTE,O.palette);T((U=N==null?void 0:N.palette)==null?void 0:U.bits)&&s.push(cb(e,o++,"image/palette",Array.from(N.palette.bits)))}if(kt(O.charset)){const N=oi(A,xt.CHARSET,O.charset);T((L=N==null?void 0:N.charset)==null?void 0:L.bits)&&s.push(cb(e,o++,"image/charset",Array.from(N.charset.bits)))}return s}const hr=lM();var Vt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Vt||{});const Ee={halt:!1,session:Te(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function lb(){return Ee.session}function ha(){return Ee.operator}function yM(e){Ee.operator=e}function _M(e){Ee.halt=e}function bM(){return Ee.halt}function Rl(){return[...Ee.books.values()]}function wM(){const[e]=Ee.books.values();return e}function Ui(e){const t=Dt(e);return Ee.books.get(e)??Rl().find(n=>n.name===t)}function Il(e,t){T(Ui(t))&&(Ee.software[e]=t)}function Me(e){return Ui(Ee.software[e])}function ub(e){const t=s1([]);return kt(e)&&(t.name=e),fb(t),Bn(H,`created [book] ${t.name}`),t}function EM(e){let t=Ui(e);return T(t)||(t=s1([]),t.name=e),fb(t),Bn(H,`created [book] ${t.name}`),t}function Mn(e,t){let n=T(t)?EM(t):Me(e);return T(n)||(T(n)||(n=wM()),T(n)||(n=ub(t)),T(n)&&Bn(H,`opened [book] ${n.name} for ${e}`)),Il(e,n.id),n}function Pi(e,t,n){return Mf(Mn(e),n,t)}function Xs(e){const t=Mn("main");return ai(t,e)}function hb(){const e=Mn("main");return ai(e,"main")}function TM(e){const t=Mn("main");return c1(t,e)}function vM(e,t){Ee.books.clear(),e.forEach(r=>{Ee.books.set(r.id,r),r.name==="main"&&(Ee.software.main=r.id)});const n=Ui(t);if(T(n)&&Il("main",n.id),!Ee.software.main){const r=Ee.books.values().next();r.value&&(Ee.software.main=r.value.id)}}function fb(e){return Ee.books.set(e.id,e),e.id}function kM(e){const t=Ui(e);t&&Ee.books.delete(t.id)}function AM(e){if(!kt(e)||!e)return se(H,"login",`failed for playerid ==>${e}<==`,e);const t=Me("main");if(!T(t))return se(H,"login:main","login failed to find book 'main'",e);const n=as(t,e);if(T(n))return!0;const r=Uf(t,xt.BOARD,"title");if(r.length===0)return se(H,"login:title","login failed to find board with 'title' stat",e);const i=fl(t,"player");if(!T(i))return se(H,"login:player","login failed to find object type 'player'",e);const s=pm(e,r),o=Oi(s);if(T(o)){const a=i1(s,"startx"),c=i1(s,"starty"),u=Lt(a)?a:Math.round(oe*.5),l=Lt(c)?c:Math.round(an*.5),h=i.name??"player",f=Wf(o,{x:u,y:l},h,e);if(T(f==null?void 0:f.id))return f.player=e,dl(t,e,o.id),!0}return!1}function xM(e){const t=Me("main"),n=as(t,e);dl(t,e,""),Df(t,n,Jn(n,e)),v1(n,e),hr.halt(e),c1(t,e)}function fr(e){const t=Me("main");return as(t,e)}function SM(e){const t=Me("main"),n=s4(t,e),r=as(t,e),i=Jn(r,e);return n&&T(i)}function RM(e){const t=Me("main"),n=Bf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Ul(c)&&T(e[c])===!1&&(e[c]=0,dl(t,c,i.id))}}}function IM(e){hr.message(e)}function Ol(e,t,n,r,i){const s=kt(t)?t:t.id,o=kt(t)?void 0:{x:t.x??0,y:t.y??0},a=kt(n)?n:n.id,c=s??o;T(a)&&T(c)&&e.send(a,r,c,i)}function ud(e,t,n,r,i){if(!T(r))return!1;const s=u1(t,n,r,i);if(T(s)){Ol(e,s,e.id(),"thud",void 0),r.kind==="player"?Ol(e,e.id(),s,"touch",r.id):r.collision===jt.ISBULLET?Ol(e,e.id(),s,"shot",void 0):Ol(e,e.id(),s,"bump",void 0);const o=Ni(t,s);return s.destructible??(o==null?void 0:o.destructible)?(T(s==null?void 0:s.id)?Ci(x.book,x.board,s,x.timestamp):li(n,{x:i.x,y:i.y}),!0):!1}return!0}function db(e,t,n,r,i=Ow){var h;if(!T(e)||!T(t)||!T(n))return;const s={...x};x.book=e,x.board=t,x.element=n,x.elementid=n.id??"",x.elementisplayer=Ul(x.elementid);const o=x.element.player??Ee.operator;x.elementfocus=x.elementisplayer?x.elementid:o;const a=Ni(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Dt(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(hr.tick(u,ia.RUNTIME,Lt(c)?c:i,l,r),Lt(n==null?void 0:n.tickertime)&&x.timestamp-n.tickertime>_a*5&&(n.tickertime=0,n.tickertext=""),x.elementisplayer){const f=Xs(x.elementid);Lt(f.inputcurrent)&&(f.inputcurrent=0)}Wl(s).forEach(f=>{x[f]=s[f]})}function OM(e,t){Ee.loaders.set(e,t)}function NM(e){hr.halt(e)}function CM(){const e=Me("main");if(!T(e))return;const t=e.timestamp+1,n=Xr.HALT_AT_COUNT;Xr.HALT_AT_COUNT=n*2,Ee.loaders.forEach((i,s)=>{const o={...x};x.timestamp=e.timestamp,x.book=e,x.board=void 0,x.element=void 0,x.elementpt={x:0,y:0},x.elementid="",x.elementisplayer=!1,x.elementfocus=Ee.operator;const a=q4(s);T(a)&&hr.arg(s,a),hr.tick(s,ia.LOADER,1,"loader",i),hr.isended(s)&&(hr.halt(s),Ee.loaders.delete(s)),Wl(o).forEach(c=>{x[c]=o[c]})}),Xr.HALT_AT_COUNT=n,e.timestamp=t,x.timestamp=t;const r=Bf(e);for(let i=0;i<r.length;++i){const s=r[i],o=h4(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:u,code:l,object:h}=o[a];u===xt.ERROR?hr.halt(c):db(e,s,h,l)}}}function LM(e){const t=Me("main");if(!T(t))return;const n=Bf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const a=i.objects[s[o]],c=`${sb(a.id)}:${e}`;H.emit(c)}}}function MM(e,t=""){var s,o,a;const n=Mn("main");if(!T(n))return;const r=`${e}_cli`;x.timestamp=n.timestamp,x.book=n,x.board=as(n,e),x.element=Jn(x.board,e),x.elementpt={x:((s=x.element)==null?void 0:s.x)??0,y:((o=x.element)==null?void 0:o.y)??0},x.elementid=((a=x.element)==null?void 0:a.id)??"",x.elementisplayer=!0,x.elementfocus=x.elementid||e;const i=Xr.HALT_AT_COUNT;Xr.HALT_AT_COUNT=i*8,Nd(H,"running",n.timestamp,r,t),hr.once(r,ia.CLI,"cli",t),Xr.HALT_AT_COUNT=i}function Nl(e){var o;const t=Mn("main"),n=zs(t,e);if(!T(t)||!T(n)||!T(x.element))return;const r=`${e}_run`,i=Dt(x.element.name??((o=x.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";hr.once(r,ia.RUNTIME,i,s)}function UM(e){const t=Me("main"),n=as(t,e),r=[];if(!T(t)||!T(n))return r;const i=Ks(t,n.over??""),s=Ks(t,n.under??""),o=[i,n,s].filter(T);let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=gM(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}Tk(e=>{if(Ul(e)){const t=Me(Vt.MAIN),n=ai(t,Vt.GADGETSTORE);let r=n[e];return T(r)||(n[e]=r=eh()),r}return eh()});const hd=ms("gadgetserver",["tock"],e=>{if(!hd.session(e))return;const t=Me(Vt.MAIN),n=(t==null?void 0:t.activelist)??[],r=ai(t,Vt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=on(s);o.layers=UM(s);const a=r[s]??{},c=Sd(a,o);c.length&&(r[s]=dr(o),fw(hd,c,s))}break;case"desync":e.player&&hw(hd,on(e.player),e.player);break;case"clearscroll":e.player&&vk(e.player);break;case"clearplayer":if(e.player){const i=Me(Vt.MAIN),s=ai(i,Vt.GADGETSTORE);delete s[e.player];const o=ai(i,Vt.GADGETSYNC);delete o[e.player]}break}});function Cl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pb={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof Cl=="function"&&Cl;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[u]={exports:{}};r[u][0].call(d.exports,function(p){var g=r[u][1][p];return o(g||p)},d,d.exports,n,r,i,s)}return i[u].exports}for(var a=typeof Cl=="function"&&Cl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,f,d,p,g,E=[],w=0,v=c.length,A=v,O=s.getTypeOf(c)!=="string";w<c.length;)A=v-w,h=O?(u=c[w++],l=w<v?c[w++]:0,w<v?c[w++]:0):(u=c.charCodeAt(w++),l=w<v?c.charCodeAt(w++):0,w<v?c.charCodeAt(w++):0),f=u>>2,d=(3&u)<<4|l>>4,p=1<A?(15&l)<<2|h>>6:64,g=2<A?63&h:64,E.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(g));return E.join("")},i.decode=function(c){var u,l,h,f,d,p,g=0,E=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var v,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|A):new Array(0|A);g<c.length;)u=a.indexOf(c.charAt(g++))<<2|(f=a.indexOf(c.charAt(g++)))>>4,l=(15&f)<<4|(d=a.indexOf(c.charAt(g++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(g++))),v[E++]=u,d!==64&&(v[E++]=l),p!==64&&(v[E++]=h);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,f,d,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,f){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var g=f;g<p;g++)u=u>>>8^d[255&(u^l[g])];return-1^u}(0|c,a,a.length,0):function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var g=f;g<p;g++)u=u>>>8^d[255&(u^l.charCodeAt(g))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var g,E="";for(g=0;g<p;g++)E+=String.fromCharCode(255&d),d>>>=8;return E}function o(d,p,g,E,w,v){var A,O,U=d.file,L=d.compression,N=v!==u.utf8encode,D=a.transformTo("string",v(U.name)),P=a.transformTo("string",u.utf8encode(U.name)),et=U.comment,dt=a.transformTo("string",v(et)),M=a.transformTo("string",u.utf8encode(et)),R=P.length!==U.name.length,_=M.length!==et.length,B="",X="",j="",ct=U.dir,tt=U.date,ht={crc32:0,compressedSize:0,uncompressedSize:0};p&&!g||(ht.crc32=d.crc32,ht.compressedSize=d.compressedSize,ht.uncompressedSize=d.uncompressedSize);var G=0;p&&(G|=8),N||!R&&!_||(G|=2048);var K=0,bt=0;ct&&(K|=16),w==="UNIX"?(bt=798,K|=function(at,Ct){var Jt=at;return at||(Jt=Ct?16893:33204),(65535&Jt)<<16}(U.unixPermissions,ct)):(bt=20,K|=function(at){return 63&(at||0)}(U.dosPermissions)),A=tt.getUTCHours(),A<<=6,A|=tt.getUTCMinutes(),A<<=5,A|=tt.getUTCSeconds()/2,O=tt.getUTCFullYear()-1980,O<<=4,O|=tt.getUTCMonth()+1,O<<=5,O|=tt.getUTCDate(),R&&(X=s(1,1)+s(l(D),4)+P,B+="up"+s(X.length,2)+X),_&&(j=s(1,1)+s(l(dt),4)+M,B+="uc"+s(j.length,2)+j);var st="";return st+=`
\0`,st+=s(G,2),st+=L.magic,st+=s(A,2),st+=s(O,2),st+=s(ht.crc32,4),st+=s(ht.compressedSize,4),st+=s(ht.uncompressedSize,4),st+=s(D.length,2),st+=s(B.length,2),{fileRecord:h.LOCAL_FILE_HEADER+st+D+B,dirRecord:h.CENTRAL_FILE_HEADER+s(bt,2)+st+s(dt.length,2)+"\0\0\0\0"+s(K,4)+s(E,4)+D+B+dt}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function f(d,p,g,E){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=g,this.encodeFileName=E,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,g=this.entriesCount,E=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:g?(p+100*(g-E-1))/g:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var g=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,g=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),p)this.push({data:function(E){return h.DATA_DESCRIPTOR+s(E.crc32,4)+s(E.compressedSize,4)+s(E.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var g=this.bytesWritten-d,E=function(w,v,A,O,U){var L=a.transformTo("string",U(O));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(v,4)+s(A,4)+s(L.length,2)+L}(this.dirRecords.length,g,d,this.zipComment,this.encodeFileName);this.push({data:E,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(g){p.processChunk(g)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(g){p.error(g)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var g=0;g<p.length;g++)try{p[g].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=function(v,A){var O=v||A,U=s[O];if(!U)throw new Error(O+" is not a valid compression method !");return U}(d.options.compression,c.compression),g=d.options.compressionOptions||c.compressionOptions||{},E=d.dir,w=d.date;d._compressWorker(p,g).withStreamInfo("file",{name:f,dir:E,date:w,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(f){l.error(f)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var g=f.decompressed.getContentWorker().pipe(new u);g.on("error",function(E){p(E)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(g){var E=new c(d);return E.load(g),E}).then(function(g){var E=[o.Promise.resolve(g)],w=g.files;if(d.checkCRC32)for(var v=0;v<w.length;v++)E.push(h(w[v]));return o.Promise.all(E)}).then(function(g){for(var E=g.shift(),w=E.files,v=0;v<w.length;v++){var A=w[v],O=A.fileNameStr,U=s.resolve(A.fileNameStr);p.file(U,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:d.createFolders}),A.dir||(p.file(U).unsafeOriginalName=O)}return E.zipComment.length&&(p.comment=E.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,f){l.push(h)||l._helper.pause(),u&&u(f)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Je<"u",newBufferFrom:function(s,o){if(Je.from&&Je.from!==Uint8Array.from)return Je.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Je(s,o)},allocBuffer:function(s){if(Je.alloc)return Je.alloc(s);var o=new Je(s);return o.fill(0),o},isBuffer:function(s){return Je.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,L,N){var D,P=a.getTypeOf(L),et=a.extend(N||{},l);et.date=et.date||new Date,et.compression!==null&&(et.compression=et.compression.toUpperCase()),typeof et.unixPermissions=="string"&&(et.unixPermissions=parseInt(et.unixPermissions,8)),et.unixPermissions&&16384&et.unixPermissions&&(et.dir=!0),et.dosPermissions&&16&et.dosPermissions&&(et.dir=!0),et.dir&&(U=w(U)),et.createFolders&&(D=E(U))&&v.call(this,D,!0);var dt=P==="string"&&et.binary===!1&&et.base64===!1;N&&N.binary!==void 0||(et.binary=!dt),(L instanceof h&&L.uncompressedSize===0||et.dir||!L||L.length===0)&&(et.base64=!1,et.binary=!0,L="",et.compression="STORE",P="string");var M=null;M=L instanceof h||L instanceof c?L:p.isNode&&p.isStream(L)?new g(U,L):a.prepareContent(U,L,et.binary,et.optimizedBinaryString,et.base64);var R=new f(U,M,et);this.files[U]=R}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),g=n("./nodejs/NodejsStreamInputAdapter"),E=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var L=U.lastIndexOf("/");return 0<L?U.substring(0,L):""},w=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},v=function(U,L){return L=L!==void 0?L:l.createFolders,U=w(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:L}),this.files[U]};function A(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var O={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var L,N,D;for(L in this.files)D=this.files[L],(N=L.slice(this.root.length,L.length))&&L.slice(0,this.root.length)===this.root&&U(N,D)},filter:function(U){var L=[];return this.forEach(function(N,D){U(N,D)&&L.push(D)}),L},file:function(U,L,N){if(arguments.length!==1)return U=this.root+U,s.call(this,U,L,N),this;if(A(U)){var D=U;return this.filter(function(et,dt){return!dt.dir&&D.test(et)})}var P=this.files[this.root+U];return P&&!P.dir?P:null},folder:function(U){if(!U)return this;if(A(U))return this.filter(function(P,et){return et.dir&&U.test(P)});var L=this.root+U,N=v.call(this,L),D=this.clone();return D.root=N.name,D},remove:function(U){U=this.root+U;var L=this.files[U];if(L||(U.slice(-1)!=="/"&&(U+="/"),L=this.files[U]),L&&!L.dir)delete this.files[U];else for(var N=this.filter(function(P,et){return et.name.slice(0,U.length)===U}),D=0;D<N.length;D++)delete this.files[N[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var L,N={};try{if((N=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=N.type.toLowerCase(),N.compression=N.compression.toUpperCase(),N.type==="binarystring"&&(N.type="string"),!N.type)throw new Error("No output type specified.");a.checkSupport(N.type),N.platform!=="darwin"&&N.platform!=="freebsd"&&N.platform!=="linux"&&N.platform!=="sunos"||(N.platform="UNIX"),N.platform==="win32"&&(N.platform="DOS");var D=N.comment||this.comment||"";L=d.generateWorker(this,N,D)}catch(P){(L=new c("error")).error(P)}return new u(L,N.type||"string",N.mimeType)},generateAsync:function(U,L){return this.generateInternalStream(U).accumulate(L)},generateNodeStream:function(U,L){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(L)}};r.exports=O},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===u&&this.data[f+2]===l&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&u===f[1]&&l===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,g){return new l.Promise(function(E,w){var v=[],A=p._internalType,O=p._outputType,U=p._mimeType;p.on("data",function(L,N){v.push(L),g&&g(N)}).on("error",function(L){v=[],w(L)}).on("end",function(){try{var L=function(N,D,P){switch(N){case"blob":return s.newBlob(s.transformTo("arraybuffer",D),P);case"base64":return c.encode(D);default:return s.transformTo(N,D)}}(O,function(N,D){var P,et=0,dt=null,M=0;for(P=0;P<D.length;P++)M+=D[P].length;switch(N){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(dt=new Uint8Array(M),P=0;P<D.length;P++)dt.set(D[P],et),et+=D[P].length;return dt;case"nodebuffer":return Je.concat(D);default:throw new Error("concat : unsupported type '"+N+"'")}}(A,v),U);E(L)}catch(N){w(N)}v=[]}).resume()})}function d(p,g,E){var w=g;switch(g){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=g,this._mimeType=E,s.checkSupport(w),this._worker=p.pipe(new o(w)),p.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,g){var E=this;return p==="data"?this._worker.on(p,function(w){g.call(E,w.data,w.meta)}):this._worker.on(p,function(){s.delay(g,arguments,E)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Je<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(p){var g,E,w,v,A,O=p.length,U=0;for(v=0;v<O;v++)(64512&(E=p.charCodeAt(v)))==55296&&v+1<O&&(64512&(w=p.charCodeAt(v+1)))==56320&&(E=65536+(E-55296<<10)+(w-56320),v++),U+=E<128?1:E<2048?2:E<65536?3:4;for(g=o.uint8array?new Uint8Array(U):new Array(U),v=A=0;A<U;v++)(64512&(E=p.charCodeAt(v)))==55296&&v+1<O&&(64512&(w=p.charCodeAt(v+1)))==56320&&(E=65536+(E-55296<<10)+(w-56320),v++),E<128?g[A++]=E:(E<2048?g[A++]=192|E>>>6:(E<65536?g[A++]=224|E>>>12:(g[A++]=240|E>>>18,g[A++]=128|E>>>12&63),g[A++]=128|E>>>6&63),g[A++]=128|63&E);return g}(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(p){var g,E,w,v,A=p.length,O=new Array(2*A);for(g=E=0;g<A;)if((w=p[g++])<128)O[E++]=w;else if(4<(v=u[w]))O[E++]=65533,g+=v-1;else{for(w&=v===2?31:v===3?15:7;1<v&&g<A;)w=w<<6|63&p[g++],v--;1<v?O[E++]=65533:w<65536?O[E++]=w:(w-=65536,O[E++]=55296|w>>10&1023,O[E++]=56320|1023&w)}return O.length!==E&&(O.subarray?O=O.subarray(0,E):O.length=E),s.applyFromCharCode(O)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var g=p;(p=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),p.set(g,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var E=function(v,A){var O;for((A=A||v.length)>v.length&&(A=v.length),O=A-1;0<=O&&(192&v[O])==128;)O--;return O<0||O===0?A:O+u[v[O]]>A?O:A}(p),w=p;E!==p.length&&(o.uint8array?(w=p.subarray(0,E),this.leftOver=p.subarray(E,p.length)):(w=p.slice(0,E),this.leftOver=p.slice(E,p.length))),this.push({data:i.utf8decode(w),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(g){return g}function l(g,E){for(var w=0;w<g.length;++w)E[w]=255&g.charCodeAt(w);return E}n("setimmediate"),i.newBlob=function(g,E){i.checkSupport("blob");try{return new Blob([g],{type:E})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(g),w.getBlob(E)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(g,E,w){var v=[],A=0,O=g.length;if(O<=w)return String.fromCharCode.apply(null,g);for(;A<O;)E==="array"||E==="nodebuffer"?v.push(String.fromCharCode.apply(null,g.slice(A,Math.min(A+w,O)))):v.push(String.fromCharCode.apply(null,g.subarray(A,Math.min(A+w,O)))),A+=w;return v.join("")},stringifyByChar:function(g){for(var E="",w=0;w<g.length;w++)E+=String.fromCharCode(g[w]);return E},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(g){var E=65536,w=i.getTypeOf(g),v=!0;if(w==="uint8array"?v=h.applyCanBeUsed.uint8array:w==="nodebuffer"&&(v=h.applyCanBeUsed.nodebuffer),v)for(;1<E;)try{return h.stringifyByChunk(g,w,E)}catch{E=Math.floor(E/2)}return h.stringifyByChar(g)}function d(g,E){for(var w=0;w<g.length;w++)E[w]=g[w];return E}i.applyFromCharCode=f;var p={};p.string={string:u,array:function(g){return l(g,new Array(g.length))},arraybuffer:function(g){return p.string.uint8array(g).buffer},uint8array:function(g){return l(g,new Uint8Array(g.length))},nodebuffer:function(g){return l(g,a.allocBuffer(g.length))}},p.array={string:f,array:u,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},p.arraybuffer={string:function(g){return f(new Uint8Array(g))},array:function(g){return d(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:u,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},p.uint8array={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:u,nodebuffer:function(g){return a.newBufferFrom(g)}},p.nodebuffer={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return p.nodebuffer.uint8array(g).buffer},uint8array:function(g){return d(g,new Uint8Array(g.length))},nodebuffer:u},i.transformTo=function(g,E){if(E=E||"",!g)return E;i.checkSupport(g);var w=i.getTypeOf(E);return p[w][g](E)},i.resolve=function(g){for(var E=g.split("/"),w=[],v=0;v<E.length;v++){var A=E[v];A==="."||A===""&&v!==0&&v!==E.length-1||(A===".."?w.pop():w.push(A))}return w.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var E,w,v="";for(w=0;w<(g||"").length;w++)v+="\\x"+((E=g.charCodeAt(w))<16?"0":"")+E.toString(16).toUpperCase();return v},i.delay=function(g,E,w){setImmediate(function(){g.apply(w||null,E||[])})},i.inherits=function(g,E){function w(){}w.prototype=E.prototype,g.prototype=new w},i.extend=function(){var g,E,w={};for(g=0;g<arguments.length;g++)for(E in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],E)&&w[E]===void 0&&(w[E]=arguments[g][E]);return w},i.prepareContent=function(g,E,w,v,A){return c.Promise.resolve(E).then(function(O){return s.blob&&(O instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(O))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,L){var N=new FileReader;N.onload=function(D){U(D.target.result)},N.onerror=function(D){L(D.target.error)},N.readAsArrayBuffer(O)}):O}).then(function(O){var U=i.getTypeOf(O);return U?(U==="arraybuffer"?O=i.transformTo("uint8array",O):U==="string"&&(A?O=o.decode(O):w&&v!==!0&&(O=function(L){return l(L,s.uint8array?new Uint8Array(L.length):new Array(L.length))}(O))),O):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,g;if(d.skip(22),this.fileNameLength=d.readInt(2),g=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(E){for(var w in l)if(Object.prototype.hasOwnProperty.call(l,w)&&l[w].magic===E)return l[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,g,E,w=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<w;)p=d.readInt(2),g=d.readInt(2),E=d.readData(g),this.extraFields[p]={id:p,length:g,value:E};d.setIndex(w)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var g=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var E=this.findExtraFieldUnicodeComment();if(E!==null)this.fileCommentStr=E;else{var w=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,g,E){this.name=p,this.dir=E.dir,this.date=E.date,this.comment=E.comment,this.unixPermissions=E.unixPermissions,this.dosPermissions=E.dosPermissions,this._data=g,this._dataBinary=E.binary,this.options={compression:E.compression,compressionOptions:E.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var g=null,E="string";try{if(!p)throw new Error("No output type specified.");var w=(E=p.toLowerCase())==="string"||E==="text";E!=="binarystring"&&E!=="text"||(E="string"),g=this._decompressWorker();var v=!this._dataBinary;v&&!w&&(g=g.pipe(new c.Utf8EncodeWorker)),!v&&w&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(A){(g=new l("error")).error(A)}return new o(g,E,"")},async:function(p,g){return this.internalStream(p).accumulate(g)},nodeStream:function(p,g){return this.internalStream(p||"nodebuffer").toNodejsStream(g)},_compressWorker:function(p,g){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var E=this._decompressWorker();return this._dataBinary||(E=E.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(E,p,g)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){p(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var g,E;a=!0;for(var w=d.length;w;){for(E=d,d=[],g=-1;++g<w;)E[g]();w=d.length}a=!1}r.exports=function(g){d.push(g)!==1||a||o()}}).call(this,typeof pn<"u"?pn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,w!==o&&g(this,w)}function f(w,v,A){this.promise=w,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function d(w,v,A){s(function(){var O;try{O=v(A)}catch(U){return a.reject(w,U)}O===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,O)})}function p(w){var v=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof v=="function")return function(){v.apply(w,arguments)}}function g(w,v){var A=!1;function O(N){A||(A=!0,a.reject(w,N))}function U(N){A||(A=!0,a.resolve(w,N))}var L=E(function(){v(U,O)});L.status==="error"&&O(L.value)}function E(w,v){var A={};try{A.value=w(v),A.status="success"}catch(O){A.status="error",A.value=O}return A}(r.exports=h).prototype.finally=function(w){if(typeof w!="function")return this;var v=this.constructor;return this.then(function(A){return v.resolve(w()).then(function(){return A})},function(A){return v.resolve(w()).then(function(){throw A})})},h.prototype.catch=function(w){return this.then(null,w)},h.prototype.then=function(w,v){if(typeof w!="function"&&this.state===u||typeof v!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==l?d(A,this.state===u?w:v,this.outcome):this.queue.push(new f(A,w,v)),A},f.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},f.prototype.otherCallFulfilled=function(w){d(this.promise,this.onFulfilled,w)},f.prototype.callRejected=function(w){a.reject(this.promise,w)},f.prototype.otherCallRejected=function(w){d(this.promise,this.onRejected,w)},a.resolve=function(w,v){var A=E(p,v);if(A.status==="error")return a.reject(w,A.value);var O=A.value;if(O)g(w,O);else{w.state=u,w.outcome=v;for(var U=-1,L=w.queue.length;++U<L;)w.queue[U].callFulfilled(v)}return w},a.reject=function(w,v){w.state=c,w.outcome=v;for(var A=-1,O=w.queue.length;++A<O;)w.queue[A].callRejected(v);return w},h.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},h.reject=function(w){var v=new this(o);return a.reject(v,w)},h.all=function(w){var v=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=w.length,O=!1;if(!A)return this.resolve([]);for(var U=new Array(A),L=0,N=-1,D=new this(o);++N<A;)P(w[N],N);return D;function P(et,dt){v.resolve(et).then(function(M){U[dt]=M,++L!==A||O||(O=!0,a.resolve(D,U))},function(M){O||(O=!0,a.reject(D,M))})}},h.race=function(w){var v=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=w.length,O=!1;if(!A)return this.resolve([]);for(var U=-1,L=new this(o);++U<A;)N=w[U],v.resolve(N).then(function(D){O||(O=!0,a.resolve(L,D))},function(D){O||(O=!0,a.reject(L,D))});var N;return L}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,f=-1,d=0,p=8;function g(w){if(!(this instanceof g))return new g(w);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},w||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(A!==h)throw new Error(c[A]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var O;if(O=typeof v.dictionary=="string"?a.string2buf(v.dictionary):l.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(A=s.deflateSetDictionary(this.strm,O))!==h)throw new Error(c[A]);this._dict_set=!0}}function E(w,v){var A=new g(v);if(A.push(w,!0),A.err)throw A.msg||c[A.err];return A.result}g.prototype.push=function(w,v){var A,O,U=this.strm,L=this.options.chunkSize;if(this.ended)return!1;O=v===~~v?v:v===!0?4:0,typeof w=="string"?U.input=a.string2buf(w):l.call(w)==="[object ArrayBuffer]"?U.input=new Uint8Array(w):U.input=w,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(L),U.next_out=0,U.avail_out=L),(A=s.deflate(U,O))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||O!==4&&O!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&A!==1);return O===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):O!==2||(this.onEnd(h),!(U.avail_out=0))},g.prototype.onData=function(w){this.chunks.push(w)},g.prototype.onEnd=function(w){w===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=g,i.deflate=E,i.deflateRaw=function(w,v){return(v=v||{}).raw=!0,E(w,v)},i.gzip=function(w,v){return(v=v||{}).gzip=!0,E(w,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(g){if(!(this instanceof d))return new d(g);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},g||{});var E=this.options;E.raw&&0<=E.windowBits&&E.windowBits<16&&(E.windowBits=-E.windowBits,E.windowBits===0&&(E.windowBits=-15)),!(0<=E.windowBits&&E.windowBits<16)||g&&g.windowBits||(E.windowBits+=32),15<E.windowBits&&E.windowBits<48&&!(15&E.windowBits)&&(E.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,E.windowBits);if(w!==c.Z_OK)throw new Error(u[w]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(g,E){var w=new d(E);if(w.push(g,!0),w.err)throw w.msg||u[w.err];return w.result}d.prototype.push=function(g,E){var w,v,A,O,U,L,N=this.strm,D=this.options.chunkSize,P=this.options.dictionary,et=!1;if(this.ended)return!1;v=E===~~E?E:E===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?N.input=a.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?N.input=new Uint8Array(g):N.input=g,N.next_in=0,N.avail_in=N.input.length;do{if(N.avail_out===0&&(N.output=new o.Buf8(D),N.next_out=0,N.avail_out=D),(w=s.inflate(N,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&P&&(L=typeof P=="string"?a.string2buf(P):f.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,w=s.inflateSetDictionary(this.strm,L)),w===c.Z_BUF_ERROR&&et===!0&&(w=c.Z_OK,et=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);N.next_out&&(N.avail_out!==0&&w!==c.Z_STREAM_END&&(N.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(N.output,N.next_out),O=N.next_out-A,U=a.buf2string(N.output,A),N.next_out=O,N.avail_out=D-O,O&&o.arraySet(N.output,N.output,A,O,0),this.onData(U)):this.onData(o.shrinkBuf(N.output,N.next_out)))),N.avail_in===0&&N.avail_out===0&&(et=!0)}while((0<N.avail_in||N.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(N.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(g,E){return(E=E||{}).raw=!0,p(g,E)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,f){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),f);else for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){var u,l,h,f,d,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=f=0,l=c.length;u<l;u++)d=c[u],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,u,l,h,f){for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,g,E,w=h.length,v=0;for(g=0;g<w;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<w&&(64512&(p=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),g++),v+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(v),g=E=0;E<v;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<w&&(64512&(p=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),g++),d<128?f[E++]=d:(d<2048?f[E++]=192|d>>>6:(d<65536?f[E++]=224|d>>>12:(f[E++]=240|d>>>18,f[E++]=128|d>>>12&63),f[E++]=128|d>>>6&63),f[E++]=128|63&d);return f},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,g,E,w=f||h.length,v=new Array(2*w);for(d=p=0;d<w;)if((g=h[d++])<128)v[p++]=g;else if(4<(E=c[g]))v[p++]=65533,d+=E-1;else{for(g&=E===2?31:E===3?15:7;1<E&&d<w;)g=g<<6|63&h[d++],E--;1<E?v[p++]=65533:g<65536?v[p++]=g:(g-=65536,v[p++]=55296|g>>10&1023,v[p++]=56320|1023&g)}return l(v,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var f=u;f<h;f++)o=o>>>8^l[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,f=4,d=0,p=-2,g=-1,E=4,w=2,v=8,A=9,O=286,U=30,L=19,N=2*O+1,D=15,P=3,et=258,dt=et+P+1,M=42,R=113,_=1,B=2,X=3,j=4;function ct(b,rt){return b.msg=l[rt],rt}function tt(b){return(b<<1)-(4<b?9:0)}function ht(b){for(var rt=b.length;0<=--rt;)b[rt]=0}function G(b){var rt=b.state,Q=rt.pending;Q>b.avail_out&&(Q=b.avail_out),Q!==0&&(o.arraySet(b.output,rt.pending_buf,rt.pending_out,Q,b.next_out),b.next_out+=Q,rt.pending_out+=Q,b.total_out+=Q,b.avail_out-=Q,rt.pending-=Q,rt.pending===0&&(rt.pending_out=0))}function K(b,rt){a._tr_flush_block(b,0<=b.block_start?b.block_start:-1,b.strstart-b.block_start,rt),b.block_start=b.strstart,G(b.strm)}function bt(b,rt){b.pending_buf[b.pending++]=rt}function st(b,rt){b.pending_buf[b.pending++]=rt>>>8&255,b.pending_buf[b.pending++]=255&rt}function at(b,rt){var Q,C,I=b.max_chain_length,W=b.strstart,ot=b.prev_length,ut=b.nice_match,q=b.strstart>b.w_size-dt?b.strstart-(b.w_size-dt):0,pt=b.window,_t=b.w_mask,ft=b.prev,vt=b.strstart+et,ae=pt[W+ot-1],Mt=pt[W+ot];b.prev_length>=b.good_match&&(I>>=2),ut>b.lookahead&&(ut=b.lookahead);do if(pt[(Q=rt)+ot]===Mt&&pt[Q+ot-1]===ae&&pt[Q]===pt[W]&&pt[++Q]===pt[W+1]){W+=2,Q++;do;while(pt[++W]===pt[++Q]&&pt[++W]===pt[++Q]&&pt[++W]===pt[++Q]&&pt[++W]===pt[++Q]&&pt[++W]===pt[++Q]&&pt[++W]===pt[++Q]&&pt[++W]===pt[++Q]&&pt[++W]===pt[++Q]&&W<vt);if(C=et-(vt-W),W=vt-et,ot<C){if(b.match_start=rt,ut<=(ot=C))break;ae=pt[W+ot-1],Mt=pt[W+ot]}}while((rt=ft[rt&_t])>q&&--I!=0);return ot<=b.lookahead?ot:b.lookahead}function Ct(b){var rt,Q,C,I,W,ot,ut,q,pt,_t,ft=b.w_size;do{if(I=b.window_size-b.lookahead-b.strstart,b.strstart>=ft+(ft-dt)){for(o.arraySet(b.window,b.window,ft,ft,0),b.match_start-=ft,b.strstart-=ft,b.block_start-=ft,rt=Q=b.hash_size;C=b.head[--rt],b.head[rt]=ft<=C?C-ft:0,--Q;);for(rt=Q=ft;C=b.prev[--rt],b.prev[rt]=ft<=C?C-ft:0,--Q;);I+=ft}if(b.strm.avail_in===0)break;if(ot=b.strm,ut=b.window,q=b.strstart+b.lookahead,pt=I,_t=void 0,_t=ot.avail_in,pt<_t&&(_t=pt),Q=_t===0?0:(ot.avail_in-=_t,o.arraySet(ut,ot.input,ot.next_in,_t,q),ot.state.wrap===1?ot.adler=c(ot.adler,ut,_t,q):ot.state.wrap===2&&(ot.adler=u(ot.adler,ut,_t,q)),ot.next_in+=_t,ot.total_in+=_t,_t),b.lookahead+=Q,b.lookahead+b.insert>=P)for(W=b.strstart-b.insert,b.ins_h=b.window[W],b.ins_h=(b.ins_h<<b.hash_shift^b.window[W+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[W+P-1])&b.hash_mask,b.prev[W&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=W,W++,b.insert--,!(b.lookahead+b.insert<P)););}while(b.lookahead<dt&&b.strm.avail_in!==0)}function Jt(b,rt){for(var Q,C;;){if(b.lookahead<dt){if(Ct(b),b.lookahead<dt&&rt===h)return _;if(b.lookahead===0)break}if(Q=0,b.lookahead>=P&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+P-1])&b.hash_mask,Q=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),Q!==0&&b.strstart-Q<=b.w_size-dt&&(b.match_length=at(b,Q)),b.match_length>=P)if(C=a._tr_tally(b,b.strstart-b.match_start,b.match_length-P),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=P){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+P-1])&b.hash_mask,Q=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,--b.match_length!=0;);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else C=a._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(C&&(K(b,!1),b.strm.avail_out===0))return _}return b.insert=b.strstart<P-1?b.strstart:P-1,rt===f?(K(b,!0),b.strm.avail_out===0?X:j):b.last_lit&&(K(b,!1),b.strm.avail_out===0)?_:B}function Nt(b,rt){for(var Q,C,I;;){if(b.lookahead<dt){if(Ct(b),b.lookahead<dt&&rt===h)return _;if(b.lookahead===0)break}if(Q=0,b.lookahead>=P&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+P-1])&b.hash_mask,Q=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=P-1,Q!==0&&b.prev_length<b.max_lazy_match&&b.strstart-Q<=b.w_size-dt&&(b.match_length=at(b,Q),b.match_length<=5&&(b.strategy===1||b.match_length===P&&4096<b.strstart-b.match_start)&&(b.match_length=P-1)),b.prev_length>=P&&b.match_length<=b.prev_length){for(I=b.strstart+b.lookahead-P,C=a._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-P),b.lookahead-=b.prev_length-1,b.prev_length-=2;++b.strstart<=I&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+P-1])&b.hash_mask,Q=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),--b.prev_length!=0;);if(b.match_available=0,b.match_length=P-1,b.strstart++,C&&(K(b,!1),b.strm.avail_out===0))return _}else if(b.match_available){if((C=a._tr_tally(b,0,b.window[b.strstart-1]))&&K(b,!1),b.strstart++,b.lookahead--,b.strm.avail_out===0)return _}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(C=a._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<P-1?b.strstart:P-1,rt===f?(K(b,!0),b.strm.avail_out===0?X:j):b.last_lit&&(K(b,!1),b.strm.avail_out===0)?_:B}function It(b,rt,Q,C,I){this.good_length=b,this.max_lazy=rt,this.nice_length=Q,this.max_chain=C,this.func=I}function re(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*N),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*L+1)),ht(this.dyn_ltree),ht(this.dyn_dtree),ht(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(D+1),this.heap=new o.Buf16(2*O+1),ht(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*O+1),ht(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function $t(b){var rt;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=w,(rt=b.state).pending=0,rt.pending_out=0,rt.wrap<0&&(rt.wrap=-rt.wrap),rt.status=rt.wrap?M:R,b.adler=rt.wrap===2?0:1,rt.last_flush=h,a._tr_init(rt),d):ct(b,p)}function ge(b){var rt=$t(b);return rt===d&&function(Q){Q.window_size=2*Q.w_size,ht(Q.head),Q.max_lazy_match=s[Q.level].max_lazy,Q.good_match=s[Q.level].good_length,Q.nice_match=s[Q.level].nice_length,Q.max_chain_length=s[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=P-1,Q.match_available=0,Q.ins_h=0}(b.state),rt}function Se(b,rt,Q,C,I,W){if(!b)return p;var ot=1;if(rt===g&&(rt=6),C<0?(ot=0,C=-C):15<C&&(ot=2,C-=16),I<1||A<I||Q!==v||C<8||15<C||rt<0||9<rt||W<0||E<W)return ct(b,p);C===8&&(C=9);var ut=new re;return(b.state=ut).strm=b,ut.wrap=ot,ut.gzhead=null,ut.w_bits=C,ut.w_size=1<<ut.w_bits,ut.w_mask=ut.w_size-1,ut.hash_bits=I+7,ut.hash_size=1<<ut.hash_bits,ut.hash_mask=ut.hash_size-1,ut.hash_shift=~~((ut.hash_bits+P-1)/P),ut.window=new o.Buf8(2*ut.w_size),ut.head=new o.Buf16(ut.hash_size),ut.prev=new o.Buf16(ut.w_size),ut.lit_bufsize=1<<I+6,ut.pending_buf_size=4*ut.lit_bufsize,ut.pending_buf=new o.Buf8(ut.pending_buf_size),ut.d_buf=1*ut.lit_bufsize,ut.l_buf=3*ut.lit_bufsize,ut.level=rt,ut.strategy=W,ut.method=Q,ge(b)}s=[new It(0,0,0,0,function(b,rt){var Q=65535;for(Q>b.pending_buf_size-5&&(Q=b.pending_buf_size-5);;){if(b.lookahead<=1){if(Ct(b),b.lookahead===0&&rt===h)return _;if(b.lookahead===0)break}b.strstart+=b.lookahead,b.lookahead=0;var C=b.block_start+Q;if((b.strstart===0||b.strstart>=C)&&(b.lookahead=b.strstart-C,b.strstart=C,K(b,!1),b.strm.avail_out===0)||b.strstart-b.block_start>=b.w_size-dt&&(K(b,!1),b.strm.avail_out===0))return _}return b.insert=0,rt===f?(K(b,!0),b.strm.avail_out===0?X:j):(b.strstart>b.block_start&&(K(b,!1),b.strm.avail_out),_)}),new It(4,4,8,4,Jt),new It(4,5,16,8,Jt),new It(4,6,32,32,Jt),new It(4,4,16,16,Nt),new It(8,16,32,32,Nt),new It(8,16,128,128,Nt),new It(8,32,128,256,Nt),new It(32,128,258,1024,Nt),new It(32,258,258,4096,Nt)],i.deflateInit=function(b,rt){return Se(b,rt,v,15,8,0)},i.deflateInit2=Se,i.deflateReset=ge,i.deflateResetKeep=$t,i.deflateSetHeader=function(b,rt){return b&&b.state?b.state.wrap!==2?p:(b.state.gzhead=rt,d):p},i.deflate=function(b,rt){var Q,C,I,W;if(!b||!b.state||5<rt||rt<0)return b?ct(b,p):p;if(C=b.state,!b.output||!b.input&&b.avail_in!==0||C.status===666&&rt!==f)return ct(b,b.avail_out===0?-5:p);if(C.strm=b,Q=C.last_flush,C.last_flush=rt,C.status===M)if(C.wrap===2)b.adler=0,bt(C,31),bt(C,139),bt(C,8),C.gzhead?(bt(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),bt(C,255&C.gzhead.time),bt(C,C.gzhead.time>>8&255),bt(C,C.gzhead.time>>16&255),bt(C,C.gzhead.time>>24&255),bt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),bt(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(bt(C,255&C.gzhead.extra.length),bt(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(b.adler=u(b.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(bt(C,0),bt(C,0),bt(C,0),bt(C,0),bt(C,0),bt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),bt(C,3),C.status=R);else{var ot=v+(C.w_bits-8<<4)<<8;ot|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(ot|=32),ot+=31-ot%31,C.status=R,st(C,ot),C.strstart!==0&&(st(C,b.adler>>>16),st(C,65535&b.adler)),b.adler=1}if(C.status===69)if(C.gzhead.extra){for(I=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),G(b),I=C.pending,C.pending!==C.pending_buf_size));)bt(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){I=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),G(b),I=C.pending,C.pending===C.pending_buf_size)){W=1;break}W=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,bt(C,W)}while(W!==0);C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),W===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){I=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),G(b),I=C.pending,C.pending===C.pending_buf_size)){W=1;break}W=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,bt(C,W)}while(W!==0);C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),W===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&G(b),C.pending+2<=C.pending_buf_size&&(bt(C,255&b.adler),bt(C,b.adler>>8&255),b.adler=0,C.status=R)):C.status=R),C.pending!==0){if(G(b),b.avail_out===0)return C.last_flush=-1,d}else if(b.avail_in===0&&tt(rt)<=tt(Q)&&rt!==f)return ct(b,-5);if(C.status===666&&b.avail_in!==0)return ct(b,-5);if(b.avail_in!==0||C.lookahead!==0||rt!==h&&C.status!==666){var ut=C.strategy===2?function(q,pt){for(var _t;;){if(q.lookahead===0&&(Ct(q),q.lookahead===0)){if(pt===h)return _;break}if(q.match_length=0,_t=a._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,_t&&(K(q,!1),q.strm.avail_out===0))return _}return q.insert=0,pt===f?(K(q,!0),q.strm.avail_out===0?X:j):q.last_lit&&(K(q,!1),q.strm.avail_out===0)?_:B}(C,rt):C.strategy===3?function(q,pt){for(var _t,ft,vt,ae,Mt=q.window;;){if(q.lookahead<=et){if(Ct(q),q.lookahead<=et&&pt===h)return _;if(q.lookahead===0)break}if(q.match_length=0,q.lookahead>=P&&0<q.strstart&&(ft=Mt[vt=q.strstart-1])===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]){ae=q.strstart+et;do;while(ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&vt<ae);q.match_length=et-(ae-vt),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=P?(_t=a._tr_tally(q,1,q.match_length-P),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(_t=a._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),_t&&(K(q,!1),q.strm.avail_out===0))return _}return q.insert=0,pt===f?(K(q,!0),q.strm.avail_out===0?X:j):q.last_lit&&(K(q,!1),q.strm.avail_out===0)?_:B}(C,rt):s[C.level].func(C,rt);if(ut!==X&&ut!==j||(C.status=666),ut===_||ut===X)return b.avail_out===0&&(C.last_flush=-1),d;if(ut===B&&(rt===1?a._tr_align(C):rt!==5&&(a._tr_stored_block(C,0,0,!1),rt===3&&(ht(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),G(b),b.avail_out===0))return C.last_flush=-1,d}return rt!==f?d:C.wrap<=0?1:(C.wrap===2?(bt(C,255&b.adler),bt(C,b.adler>>8&255),bt(C,b.adler>>16&255),bt(C,b.adler>>24&255),bt(C,255&b.total_in),bt(C,b.total_in>>8&255),bt(C,b.total_in>>16&255),bt(C,b.total_in>>24&255)):(st(C,b.adler>>>16),st(C,65535&b.adler)),G(b),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?d:1)},i.deflateEnd=function(b){var rt;return b&&b.state?(rt=b.state.status)!==M&&rt!==69&&rt!==73&&rt!==91&&rt!==103&&rt!==R&&rt!==666?ct(b,p):(b.state=null,rt===R?ct(b,-3):d):p},i.deflateSetDictionary=function(b,rt){var Q,C,I,W,ot,ut,q,pt,_t=rt.length;if(!b||!b.state||(W=(Q=b.state).wrap)===2||W===1&&Q.status!==M||Q.lookahead)return p;for(W===1&&(b.adler=c(b.adler,rt,_t,0)),Q.wrap=0,_t>=Q.w_size&&(W===0&&(ht(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0),pt=new o.Buf8(Q.w_size),o.arraySet(pt,rt,_t-Q.w_size,Q.w_size,0),rt=pt,_t=Q.w_size),ot=b.avail_in,ut=b.next_in,q=b.input,b.avail_in=_t,b.next_in=0,b.input=rt,Ct(Q);Q.lookahead>=P;){for(C=Q.strstart,I=Q.lookahead-(P-1);Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[C+P-1])&Q.hash_mask,Q.prev[C&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=C,C++,--I;);Q.strstart=C,Q.lookahead=P-1,Ct(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=P-1,Q.match_available=0,b.next_in=ut,b.input=q,b.avail_in=ot,Q.wrap=W,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,f,d,p,g,E,w,v,A,O,U,L,N,D,P,et,dt,M,R,_,B;a=s.state,c=s.next_in,_=s.input,u=c+(s.avail_in-5),l=s.next_out,B=s.output,h=l-(o-s.avail_out),f=l+(s.avail_out-257),d=a.dmax,p=a.wsize,g=a.whave,E=a.wnext,w=a.window,v=a.hold,A=a.bits,O=a.lencode,U=a.distcode,L=(1<<a.lenbits)-1,N=(1<<a.distbits)-1;t:do{A<15&&(v+=_[c++]<<A,A+=8,v+=_[c++]<<A,A+=8),D=O[v&L];e:for(;;){if(v>>>=P=D>>>24,A-=P,(P=D>>>16&255)===0)B[l++]=65535&D;else{if(!(16&P)){if(!(64&P)){D=O[(65535&D)+(v&(1<<P)-1)];continue e}if(32&P){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}et=65535&D,(P&=15)&&(A<P&&(v+=_[c++]<<A,A+=8),et+=v&(1<<P)-1,v>>>=P,A-=P),A<15&&(v+=_[c++]<<A,A+=8,v+=_[c++]<<A,A+=8),D=U[v&N];n:for(;;){if(v>>>=P=D>>>24,A-=P,!(16&(P=D>>>16&255))){if(!(64&P)){D=U[(65535&D)+(v&(1<<P)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(dt=65535&D,A<(P&=15)&&(v+=_[c++]<<A,(A+=8)<P&&(v+=_[c++]<<A,A+=8)),d<(dt+=v&(1<<P)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=P,A-=P,(P=l-h)<dt){if(g<(P=dt-P)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(R=w,(M=0)===E){if(M+=p-P,P<et){for(et-=P;B[l++]=w[M++],--P;);M=l-dt,R=B}}else if(E<P){if(M+=p+E-P,(P-=E)<et){for(et-=P;B[l++]=w[M++],--P;);if(M=0,E<et){for(et-=P=E;B[l++]=w[M++],--P;);M=l-dt,R=B}}}else if(M+=E-P,P<et){for(et-=P;B[l++]=w[M++],--P;);M=l-dt,R=B}for(;2<et;)B[l++]=R[M++],B[l++]=R[M++],B[l++]=R[M++],et-=3;et&&(B[l++]=R[M++],1<et&&(B[l++]=R[M++]))}else{for(M=l-dt;B[l++]=B[M++],B[l++]=B[M++],B[l++]=B[M++],2<(et-=3););et&&(B[l++]=B[M++],1<et&&(B[l++]=B[M++]))}break}}break}}while(c<u&&l<f);c-=et=A>>3,v&=(1<<(A-=et<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<f?f-l+257:257-(l-f),a.hold=v,a.bits=A}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,f=0,d=-2,p=1,g=852,E=592;function w(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(M){var R;return M&&M.state?(R=M.state,M.total_in=M.total_out=R.total=0,M.msg="",R.wrap&&(M.adler=1&R.wrap),R.mode=p,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new s.Buf32(g),R.distcode=R.distdyn=new s.Buf32(E),R.sane=1,R.back=-1,f):d}function O(M){var R;return M&&M.state?((R=M.state).wsize=0,R.whave=0,R.wnext=0,A(M)):d}function U(M,R){var _,B;return M&&M.state?(B=M.state,R<0?(_=0,R=-R):(_=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?d:(B.window!==null&&B.wbits!==R&&(B.window=null),B.wrap=_,B.wbits=R,O(M))):d}function L(M,R){var _,B;return M?(B=new v,(M.state=B).window=null,(_=U(M,R))!==f&&(M.state=null),_):d}var N,D,P=!0;function et(M){if(P){var R;for(N=new s.Buf32(512),D=new s.Buf32(32),R=0;R<144;)M.lens[R++]=8;for(;R<256;)M.lens[R++]=9;for(;R<280;)M.lens[R++]=7;for(;R<288;)M.lens[R++]=8;for(u(l,M.lens,0,288,N,0,M.work,{bits:9}),R=0;R<32;)M.lens[R++]=5;u(h,M.lens,0,32,D,0,M.work,{bits:5}),P=!1}M.lencode=N,M.lenbits=9,M.distcode=D,M.distbits=5}function dt(M,R,_,B){var X,j=M.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),B>=j.wsize?(s.arraySet(j.window,R,_-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(B<(X=j.wsize-j.wnext)&&(X=B),s.arraySet(j.window,R,_-B,X,j.wnext),(B-=X)?(s.arraySet(j.window,R,_-B,B,0),j.wnext=B,j.whave=j.wsize):(j.wnext+=X,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=X))),0}i.inflateReset=O,i.inflateReset2=U,i.inflateResetKeep=A,i.inflateInit=function(M){return L(M,15)},i.inflateInit2=L,i.inflate=function(M,R){var _,B,X,j,ct,tt,ht,G,K,bt,st,at,Ct,Jt,Nt,It,re,$t,ge,Se,b,rt,Q,C,I=0,W=new s.Buf8(4),ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return d;(_=M.state).mode===12&&(_.mode=13),ct=M.next_out,X=M.output,ht=M.avail_out,j=M.next_in,B=M.input,tt=M.avail_in,G=_.hold,K=_.bits,bt=tt,st=ht,rt=f;t:for(;;)switch(_.mode){case p:if(_.wrap===0){_.mode=13;break}for(;K<16;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(2&_.wrap&&G===35615){W[_.check=0]=255&G,W[1]=G>>>8&255,_.check=a(_.check,W,2,0),K=G=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&G)<<8)+(G>>8))%31){M.msg="incorrect header check",_.mode=30;break}if((15&G)!=8){M.msg="unknown compression method",_.mode=30;break}if(K-=4,b=8+(15&(G>>>=4)),_.wbits===0)_.wbits=b;else if(b>_.wbits){M.msg="invalid window size",_.mode=30;break}_.dmax=1<<b,M.adler=_.check=1,_.mode=512&G?10:12,K=G=0;break;case 2:for(;K<16;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(_.flags=G,(255&_.flags)!=8){M.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){M.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=G>>8&1),512&_.flags&&(W[0]=255&G,W[1]=G>>>8&255,_.check=a(_.check,W,2,0)),K=G=0,_.mode=3;case 3:for(;K<32;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}_.head&&(_.head.time=G),512&_.flags&&(W[0]=255&G,W[1]=G>>>8&255,W[2]=G>>>16&255,W[3]=G>>>24&255,_.check=a(_.check,W,4,0)),K=G=0,_.mode=4;case 4:for(;K<16;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}_.head&&(_.head.xflags=255&G,_.head.os=G>>8),512&_.flags&&(W[0]=255&G,W[1]=G>>>8&255,_.check=a(_.check,W,2,0)),K=G=0,_.mode=5;case 5:if(1024&_.flags){for(;K<16;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}_.length=G,_.head&&(_.head.extra_len=G),512&_.flags&&(W[0]=255&G,W[1]=G>>>8&255,_.check=a(_.check,W,2,0)),K=G=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(tt<(at=_.length)&&(at=tt),at&&(_.head&&(b=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,B,j,at,b)),512&_.flags&&(_.check=a(_.check,B,at,j)),tt-=at,j+=at,_.length-=at),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(tt===0)break t;for(at=0;b=B[j+at++],_.head&&b&&_.length<65536&&(_.head.name+=String.fromCharCode(b)),b&&at<tt;);if(512&_.flags&&(_.check=a(_.check,B,at,j)),tt-=at,j+=at,b)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(tt===0)break t;for(at=0;b=B[j+at++],_.head&&b&&_.length<65536&&(_.head.comment+=String.fromCharCode(b)),b&&at<tt;);if(512&_.flags&&(_.check=a(_.check,B,at,j)),tt-=at,j+=at,b)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;K<16;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(G!==(65535&_.check)){M.msg="header crc mismatch",_.mode=30;break}K=G=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),M.adler=_.check=0,_.mode=12;break;case 10:for(;K<32;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}M.adler=_.check=w(G),K=G=0,_.mode=11;case 11:if(_.havedict===0)return M.next_out=ct,M.avail_out=ht,M.next_in=j,M.avail_in=tt,_.hold=G,_.bits=K,2;M.adler=_.check=1,_.mode=12;case 12:if(R===5||R===6)break t;case 13:if(_.last){G>>>=7&K,K-=7&K,_.mode=27;break}for(;K<3;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}switch(_.last=1&G,K-=1,3&(G>>>=1)){case 0:_.mode=14;break;case 1:if(et(_),_.mode=20,R!==6)break;G>>>=2,K-=2;break t;case 2:_.mode=17;break;case 3:M.msg="invalid block type",_.mode=30}G>>>=2,K-=2;break;case 14:for(G>>>=7&K,K-=7&K;K<32;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if((65535&G)!=(G>>>16^65535)){M.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&G,K=G=0,_.mode=15,R===6)break t;case 15:_.mode=16;case 16:if(at=_.length){if(tt<at&&(at=tt),ht<at&&(at=ht),at===0)break t;s.arraySet(X,B,j,at,ct),tt-=at,j+=at,ht-=at,ct+=at,_.length-=at;break}_.mode=12;break;case 17:for(;K<14;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(_.nlen=257+(31&G),G>>>=5,K-=5,_.ndist=1+(31&G),G>>>=5,K-=5,_.ncode=4+(15&G),G>>>=4,K-=4,286<_.nlen||30<_.ndist){M.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;K<3;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}_.lens[ot[_.have++]]=7&G,G>>>=3,K-=3}for(;_.have<19;)_.lens[ot[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,Q={bits:_.lenbits},rt=u(0,_.lens,0,19,_.lencode,0,_.work,Q),_.lenbits=Q.bits,rt){M.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;It=(I=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,re=65535&I,!((Nt=I>>>24)<=K);){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(re<16)G>>>=Nt,K-=Nt,_.lens[_.have++]=re;else{if(re===16){for(C=Nt+2;K<C;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(G>>>=Nt,K-=Nt,_.have===0){M.msg="invalid bit length repeat",_.mode=30;break}b=_.lens[_.have-1],at=3+(3&G),G>>>=2,K-=2}else if(re===17){for(C=Nt+3;K<C;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}K-=Nt,b=0,at=3+(7&(G>>>=Nt)),G>>>=3,K-=3}else{for(C=Nt+7;K<C;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}K-=Nt,b=0,at=11+(127&(G>>>=Nt)),G>>>=7,K-=7}if(_.have+at>_.nlen+_.ndist){M.msg="invalid bit length repeat",_.mode=30;break}for(;at--;)_.lens[_.have++]=b}}if(_.mode===30)break;if(_.lens[256]===0){M.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,Q={bits:_.lenbits},rt=u(l,_.lens,0,_.nlen,_.lencode,0,_.work,Q),_.lenbits=Q.bits,rt){M.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,Q={bits:_.distbits},rt=u(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,Q),_.distbits=Q.bits,rt){M.msg="invalid distances set",_.mode=30;break}if(_.mode=20,R===6)break t;case 20:_.mode=21;case 21:if(6<=tt&&258<=ht){M.next_out=ct,M.avail_out=ht,M.next_in=j,M.avail_in=tt,_.hold=G,_.bits=K,c(M,st),ct=M.next_out,X=M.output,ht=M.avail_out,j=M.next_in,B=M.input,tt=M.avail_in,G=_.hold,K=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;It=(I=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,re=65535&I,!((Nt=I>>>24)<=K);){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(It&&!(240&It)){for($t=Nt,ge=It,Se=re;It=(I=_.lencode[Se+((G&(1<<$t+ge)-1)>>$t)])>>>16&255,re=65535&I,!($t+(Nt=I>>>24)<=K);){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}G>>>=$t,K-=$t,_.back+=$t}if(G>>>=Nt,K-=Nt,_.back+=Nt,_.length=re,It===0){_.mode=26;break}if(32&It){_.back=-1,_.mode=12;break}if(64&It){M.msg="invalid literal/length code",_.mode=30;break}_.extra=15&It,_.mode=22;case 22:if(_.extra){for(C=_.extra;K<C;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}_.length+=G&(1<<_.extra)-1,G>>>=_.extra,K-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;It=(I=_.distcode[G&(1<<_.distbits)-1])>>>16&255,re=65535&I,!((Nt=I>>>24)<=K);){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(!(240&It)){for($t=Nt,ge=It,Se=re;It=(I=_.distcode[Se+((G&(1<<$t+ge)-1)>>$t)])>>>16&255,re=65535&I,!($t+(Nt=I>>>24)<=K);){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}G>>>=$t,K-=$t,_.back+=$t}if(G>>>=Nt,K-=Nt,_.back+=Nt,64&It){M.msg="invalid distance code",_.mode=30;break}_.offset=re,_.extra=15&It,_.mode=24;case 24:if(_.extra){for(C=_.extra;K<C;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}_.offset+=G&(1<<_.extra)-1,G>>>=_.extra,K-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){M.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ht===0)break t;if(at=st-ht,_.offset>at){if((at=_.offset-at)>_.whave&&_.sane){M.msg="invalid distance too far back",_.mode=30;break}Ct=at>_.wnext?(at-=_.wnext,_.wsize-at):_.wnext-at,at>_.length&&(at=_.length),Jt=_.window}else Jt=X,Ct=ct-_.offset,at=_.length;for(ht<at&&(at=ht),ht-=at,_.length-=at;X[ct++]=Jt[Ct++],--at;);_.length===0&&(_.mode=21);break;case 26:if(ht===0)break t;X[ct++]=_.length,ht--,_.mode=21;break;case 27:if(_.wrap){for(;K<32;){if(tt===0)break t;tt--,G|=B[j++]<<K,K+=8}if(st-=ht,M.total_out+=st,_.total+=st,st&&(M.adler=_.check=_.flags?a(_.check,X,st,ct-st):o(_.check,X,st,ct-st)),st=ht,(_.flags?G:w(G))!==_.check){M.msg="incorrect data check",_.mode=30;break}K=G=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;K<32;){if(tt===0)break t;tt--,G+=B[j++]<<K,K+=8}if(G!==(4294967295&_.total)){M.msg="incorrect length check",_.mode=30;break}K=G=0}_.mode=29;case 29:rt=1;break t;case 30:rt=-3;break t;case 31:return-4;case 32:default:return d}return M.next_out=ct,M.avail_out=ht,M.next_in=j,M.avail_in=tt,_.hold=G,_.bits=K,(_.wsize||st!==M.avail_out&&_.mode<30&&(_.mode<27||R!==4))&&dt(M,M.output,M.next_out,st-M.avail_out)?(_.mode=31,-4):(bt-=M.avail_in,st-=M.avail_out,M.total_in+=bt,M.total_out+=st,_.total+=st,_.wrap&&st&&(M.adler=_.check=_.flags?a(_.check,X,st,M.next_out-st):o(_.check,X,st,M.next_out-st)),M.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(bt==0&&st===0||R===4)&&rt===f&&(rt=-5),rt)},i.inflateEnd=function(M){if(!M||!M.state)return d;var R=M.state;return R.window&&(R.window=null),M.state=null,f},i.inflateGetHeader=function(M,R){var _;return M&&M.state&&2&(_=M.state).wrap?((_.head=R).done=!1,f):d},i.inflateSetDictionary=function(M,R){var _,B=R.length;return M&&M.state?(_=M.state).wrap!==0&&_.mode!==11?d:_.mode===11&&o(1,R,B,0)!==_.check?-3:dt(M,R,B,B)?(_.mode=31,-4):(_.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,f,d,p,g,E,w){var v,A,O,U,L,N,D,P,et,dt=w.bits,M=0,R=0,_=0,B=0,X=0,j=0,ct=0,tt=0,ht=0,G=0,K=null,bt=0,st=new s.Buf16(16),at=new s.Buf16(16),Ct=null,Jt=0;for(M=0;M<=15;M++)st[M]=0;for(R=0;R<d;R++)st[h[f+R]]++;for(X=dt,B=15;1<=B&&st[B]===0;B--);if(B<X&&(X=B),B===0)return p[g++]=20971520,p[g++]=20971520,w.bits=1,0;for(_=1;_<B&&st[_]===0;_++);for(X<_&&(X=_),M=tt=1;M<=15;M++)if(tt<<=1,(tt-=st[M])<0)return-1;if(0<tt&&(l===0||B!==1))return-1;for(at[1]=0,M=1;M<15;M++)at[M+1]=at[M]+st[M];for(R=0;R<d;R++)h[f+R]!==0&&(E[at[h[f+R]]++]=R);if(N=l===0?(K=Ct=E,19):l===1?(K=o,bt-=257,Ct=a,Jt-=257,256):(K=c,Ct=u,-1),M=_,L=g,ct=R=G=0,O=-1,U=(ht=1<<(j=X))-1,l===1&&852<ht||l===2&&592<ht)return 1;for(;;){for(D=M-ct,et=E[R]<N?(P=0,E[R]):E[R]>N?(P=Ct[Jt+E[R]],K[bt+E[R]]):(P=96,0),v=1<<M-ct,_=A=1<<j;p[L+(G>>ct)+(A-=v)]=D<<24|P<<16|et|0,A!==0;);for(v=1<<M-1;G&v;)v>>=1;if(v!==0?(G&=v-1,G+=v):G=0,R++,--st[M]==0){if(M===B)break;M=h[f+E[R]]}if(X<M&&(G&U)!==O){for(ct===0&&(ct=X),L+=_,tt=1<<(j=M-ct);j+ct<B&&!((tt-=st[j+ct])<=0);)j++,tt<<=1;if(ht+=1<<j,l===1&&852<ht||l===2&&592<ht)return 1;p[O=G&U]=X<<24|j<<16|L-g|0}}return G!==0&&(p[L+G]=M-ct<<24|64<<16|0),w.bits=X,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(I){for(var W=I.length;0<=--W;)I[W]=0}var u=0,l=29,h=256,f=h+1+l,d=30,p=19,g=2*f+1,E=15,w=16,v=7,A=256,O=16,U=17,L=18,N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],dt=new Array(2*(f+2));c(dt);var M=new Array(2*d);c(M);var R=new Array(512);c(R);var _=new Array(256);c(_);var B=new Array(l);c(B);var X,j,ct,tt=new Array(d);function ht(I,W,ot,ut,q){this.static_tree=I,this.extra_bits=W,this.extra_base=ot,this.elems=ut,this.max_length=q,this.has_stree=I&&I.length}function G(I,W){this.dyn_tree=I,this.max_code=0,this.stat_desc=W}function K(I){return I<256?R[I]:R[256+(I>>>7)]}function bt(I,W){I.pending_buf[I.pending++]=255&W,I.pending_buf[I.pending++]=W>>>8&255}function st(I,W,ot){I.bi_valid>w-ot?(I.bi_buf|=W<<I.bi_valid&65535,bt(I,I.bi_buf),I.bi_buf=W>>w-I.bi_valid,I.bi_valid+=ot-w):(I.bi_buf|=W<<I.bi_valid&65535,I.bi_valid+=ot)}function at(I,W,ot){st(I,ot[2*W],ot[2*W+1])}function Ct(I,W){for(var ot=0;ot|=1&I,I>>>=1,ot<<=1,0<--W;);return ot>>>1}function Jt(I,W,ot){var ut,q,pt=new Array(E+1),_t=0;for(ut=1;ut<=E;ut++)pt[ut]=_t=_t+ot[ut-1]<<1;for(q=0;q<=W;q++){var ft=I[2*q+1];ft!==0&&(I[2*q]=Ct(pt[ft]++,ft))}}function Nt(I){var W;for(W=0;W<f;W++)I.dyn_ltree[2*W]=0;for(W=0;W<d;W++)I.dyn_dtree[2*W]=0;for(W=0;W<p;W++)I.bl_tree[2*W]=0;I.dyn_ltree[2*A]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0}function It(I){8<I.bi_valid?bt(I,I.bi_buf):0<I.bi_valid&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0}function re(I,W,ot,ut){var q=2*W,pt=2*ot;return I[q]<I[pt]||I[q]===I[pt]&&ut[W]<=ut[ot]}function $t(I,W,ot){for(var ut=I.heap[ot],q=ot<<1;q<=I.heap_len&&(q<I.heap_len&&re(W,I.heap[q+1],I.heap[q],I.depth)&&q++,!re(W,ut,I.heap[q],I.depth));)I.heap[ot]=I.heap[q],ot=q,q<<=1;I.heap[ot]=ut}function ge(I,W,ot){var ut,q,pt,_t,ft=0;if(I.last_lit!==0)for(;ut=I.pending_buf[I.d_buf+2*ft]<<8|I.pending_buf[I.d_buf+2*ft+1],q=I.pending_buf[I.l_buf+ft],ft++,ut===0?at(I,q,W):(at(I,(pt=_[q])+h+1,W),(_t=N[pt])!==0&&st(I,q-=B[pt],_t),at(I,pt=K(--ut),ot),(_t=D[pt])!==0&&st(I,ut-=tt[pt],_t)),ft<I.last_lit;);at(I,A,W)}function Se(I,W){var ot,ut,q,pt=W.dyn_tree,_t=W.stat_desc.static_tree,ft=W.stat_desc.has_stree,vt=W.stat_desc.elems,ae=-1;for(I.heap_len=0,I.heap_max=g,ot=0;ot<vt;ot++)pt[2*ot]!==0?(I.heap[++I.heap_len]=ae=ot,I.depth[ot]=0):pt[2*ot+1]=0;for(;I.heap_len<2;)pt[2*(q=I.heap[++I.heap_len]=ae<2?++ae:0)]=1,I.depth[q]=0,I.opt_len--,ft&&(I.static_len-=_t[2*q+1]);for(W.max_code=ae,ot=I.heap_len>>1;1<=ot;ot--)$t(I,pt,ot);for(q=vt;ot=I.heap[1],I.heap[1]=I.heap[I.heap_len--],$t(I,pt,1),ut=I.heap[1],I.heap[--I.heap_max]=ot,I.heap[--I.heap_max]=ut,pt[2*q]=pt[2*ot]+pt[2*ut],I.depth[q]=(I.depth[ot]>=I.depth[ut]?I.depth[ot]:I.depth[ut])+1,pt[2*ot+1]=pt[2*ut+1]=q,I.heap[1]=q++,$t(I,pt,1),2<=I.heap_len;);I.heap[--I.heap_max]=I.heap[1],function(Mt,xn){var k,m,y,S,F,Z,nt=xn.dyn_tree,Pt=xn.max_code,ye=xn.stat_desc.static_tree,pe=xn.stat_desc.has_stree,_e=xn.stat_desc.extra_bits,ie=xn.stat_desc.extra_base,da=xn.stat_desc.max_length,Ll=0;for(S=0;S<=E;S++)Mt.bl_count[S]=0;for(nt[2*Mt.heap[Mt.heap_max]+1]=0,k=Mt.heap_max+1;k<g;k++)da<(S=nt[2*nt[2*(m=Mt.heap[k])+1]+1]+1)&&(S=da,Ll++),nt[2*m+1]=S,Pt<m||(Mt.bl_count[S]++,F=0,ie<=m&&(F=_e[m-ie]),Z=nt[2*m],Mt.opt_len+=Z*(S+F),pe&&(Mt.static_len+=Z*(ye[2*m+1]+F)));if(Ll!==0){do{for(S=da-1;Mt.bl_count[S]===0;)S--;Mt.bl_count[S]--,Mt.bl_count[S+1]+=2,Mt.bl_count[da]--,Ll-=2}while(0<Ll);for(S=da;S!==0;S--)for(m=Mt.bl_count[S];m!==0;)Pt<(y=Mt.heap[--k])||(nt[2*y+1]!==S&&(Mt.opt_len+=(S-nt[2*y+1])*nt[2*y],nt[2*y+1]=S),m--)}}(I,W),Jt(pt,ae,I.bl_count)}function b(I,W,ot){var ut,q,pt=-1,_t=W[1],ft=0,vt=7,ae=4;for(_t===0&&(vt=138,ae=3),W[2*(ot+1)+1]=65535,ut=0;ut<=ot;ut++)q=_t,_t=W[2*(ut+1)+1],++ft<vt&&q===_t||(ft<ae?I.bl_tree[2*q]+=ft:q!==0?(q!==pt&&I.bl_tree[2*q]++,I.bl_tree[2*O]++):ft<=10?I.bl_tree[2*U]++:I.bl_tree[2*L]++,pt=q,ae=(ft=0)===_t?(vt=138,3):q===_t?(vt=6,3):(vt=7,4))}function rt(I,W,ot){var ut,q,pt=-1,_t=W[1],ft=0,vt=7,ae=4;for(_t===0&&(vt=138,ae=3),ut=0;ut<=ot;ut++)if(q=_t,_t=W[2*(ut+1)+1],!(++ft<vt&&q===_t)){if(ft<ae)for(;at(I,q,I.bl_tree),--ft!=0;);else q!==0?(q!==pt&&(at(I,q,I.bl_tree),ft--),at(I,O,I.bl_tree),st(I,ft-3,2)):ft<=10?(at(I,U,I.bl_tree),st(I,ft-3,3)):(at(I,L,I.bl_tree),st(I,ft-11,7));pt=q,ae=(ft=0)===_t?(vt=138,3):q===_t?(vt=6,3):(vt=7,4)}}c(tt);var Q=!1;function C(I,W,ot,ut){st(I,(u<<1)+(ut?1:0),3),function(q,pt,_t,ft){It(q),bt(q,_t),bt(q,~_t),s.arraySet(q.pending_buf,q.window,pt,_t,q.pending),q.pending+=_t}(I,W,ot)}i._tr_init=function(I){Q||(function(){var W,ot,ut,q,pt,_t=new Array(E+1);for(q=ut=0;q<l-1;q++)for(B[q]=ut,W=0;W<1<<N[q];W++)_[ut++]=q;for(_[ut-1]=q,q=pt=0;q<16;q++)for(tt[q]=pt,W=0;W<1<<D[q];W++)R[pt++]=q;for(pt>>=7;q<d;q++)for(tt[q]=pt<<7,W=0;W<1<<D[q]-7;W++)R[256+pt++]=q;for(ot=0;ot<=E;ot++)_t[ot]=0;for(W=0;W<=143;)dt[2*W+1]=8,W++,_t[8]++;for(;W<=255;)dt[2*W+1]=9,W++,_t[9]++;for(;W<=279;)dt[2*W+1]=7,W++,_t[7]++;for(;W<=287;)dt[2*W+1]=8,W++,_t[8]++;for(Jt(dt,f+1,_t),W=0;W<d;W++)M[2*W+1]=5,M[2*W]=Ct(W,5);X=new ht(dt,N,h+1,f,E),j=new ht(M,D,0,d,E),ct=new ht(new Array(0),P,0,p,v)}(),Q=!0),I.l_desc=new G(I.dyn_ltree,X),I.d_desc=new G(I.dyn_dtree,j),I.bl_desc=new G(I.bl_tree,ct),I.bi_buf=0,I.bi_valid=0,Nt(I)},i._tr_stored_block=C,i._tr_flush_block=function(I,W,ot,ut){var q,pt,_t=0;0<I.level?(I.strm.data_type===2&&(I.strm.data_type=function(ft){var vt,ae=4093624447;for(vt=0;vt<=31;vt++,ae>>>=1)if(1&ae&&ft.dyn_ltree[2*vt]!==0)return o;if(ft.dyn_ltree[18]!==0||ft.dyn_ltree[20]!==0||ft.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(ft.dyn_ltree[2*vt]!==0)return a;return o}(I)),Se(I,I.l_desc),Se(I,I.d_desc),_t=function(ft){var vt;for(b(ft,ft.dyn_ltree,ft.l_desc.max_code),b(ft,ft.dyn_dtree,ft.d_desc.max_code),Se(ft,ft.bl_desc),vt=p-1;3<=vt&&ft.bl_tree[2*et[vt]+1]===0;vt--);return ft.opt_len+=3*(vt+1)+5+5+4,vt}(I),q=I.opt_len+3+7>>>3,(pt=I.static_len+3+7>>>3)<=q&&(q=pt)):q=pt=ot+5,ot+4<=q&&W!==-1?C(I,W,ot,ut):I.strategy===4||pt===q?(st(I,2+(ut?1:0),3),ge(I,dt,M)):(st(I,4+(ut?1:0),3),function(ft,vt,ae,Mt){var xn;for(st(ft,vt-257,5),st(ft,ae-1,5),st(ft,Mt-4,4),xn=0;xn<Mt;xn++)st(ft,ft.bl_tree[2*et[xn]+1],3);rt(ft,ft.dyn_ltree,vt-1),rt(ft,ft.dyn_dtree,ae-1)}(I,I.l_desc.max_code+1,I.d_desc.max_code+1,_t+1),ge(I,I.dyn_ltree,I.dyn_dtree)),Nt(I),ut&&It(I)},i._tr_tally=function(I,W,ot){return I.pending_buf[I.d_buf+2*I.last_lit]=W>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&W,I.pending_buf[I.l_buf+I.last_lit]=255&ot,I.last_lit++,W===0?I.dyn_ltree[2*ot]++:(I.matches++,W--,I.dyn_ltree[2*(_[ot]+h+1)]++,I.dyn_dtree[2*K(W)]++),I.last_lit===I.lit_bufsize-1},i._tr_align=function(I){st(I,2,3),at(I,A,dt),function(W){W.bi_valid===16?(bt(W,W.bi_buf),W.bi_buf=0,W.bi_valid=0):8<=W.bi_valid&&(W.pending_buf[W.pending++]=255&W.bi_buf,W.bi_buf>>=8,W.bi_valid-=8)}(I)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,f=1,d={},p=!1,g=o.document,E=Object.getPrototypeOf&&Object.getPrototypeOf(o);E=E&&E.setTimeout?E:o,c={}.toString.call(o.process)==="[object process]"?function(O){Wr.nextTick(function(){v(O)})}:function(){if(o.postMessage&&!o.importScripts){var O=!0,U=o.onmessage;return o.onmessage=function(){O=!1},o.postMessage("","*"),o.onmessage=U,O}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(O){o.postMessage(h+O,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(O){v(O.data)},function(O){l.port2.postMessage(O)}):g&&"onreadystatechange"in g.createElement("script")?(u=g.documentElement,function(O){var U=g.createElement("script");U.onreadystatechange=function(){v(O),U.onreadystatechange=null,u.removeChild(U),U=null},u.appendChild(U)}):function(O){setTimeout(v,0,O)},E.setImmediate=function(O){typeof O!="function"&&(O=new Function(""+O));for(var U=new Array(arguments.length-1),L=0;L<U.length;L++)U[L]=arguments[L+1];var N={callback:O,args:U};return d[f]=N,c(f),f++},E.clearImmediate=w}function w(O){delete d[O]}function v(O){if(p)setTimeout(v,0,O);else{var U=d[O];if(U){p=!0;try{(function(L){var N=L.callback,D=L.args;switch(D.length){case 0:N();break;case 1:N(D[0]);break;case 2:N(D[0],D[1]);break;case 3:N(D[0],D[1],D[2]);break;default:N.apply(a,D)}})(U)}finally{w(O),p=!1}}}}function A(O){O.source===o&&typeof O.data=="string"&&O.data.indexOf(h)===0&&v(+O.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof pn<"u"?pn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(pb);var PM=pb.exports,fd=eo(PM);const mb={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(mb);var Xn=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Zs,fa,hs;class BM{constructor(...t){Zs.set(this,new Map),fa.set(this,new Map),hs.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Xn(this,hs,"f").has(r)||Xn(this,hs,"f").set(r,new Set);const s=Xn(this,hs,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Xn(this,fa,"f").set(r,a),o=!1,c)continue;const u=Xn(this,Zs,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);Xn(this,Zs,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:Xn(this,Zs,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&Xn(this,fa,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Xn(this,hs,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of Xn(this,hs,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Xn(this,Zs,"f"),extensions:Xn(this,fa,"f")}}}Zs=new WeakMap,fa=new WeakMap,hs=new WeakMap;var FM=new BM(mb)._freeze();function gb(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return FM.getType(e)??"application/octet-stream"}async function DM(e,t){try{Bn(H,e.name);const n=await e.arrayBuffer();(await new fd().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=gb(s,a),u=new File([a],o.name,{type:c});t(u)}).catch(a=>{se(H,"crash",a.message)})})}catch(n){se(H,"crash",n.message)}}async function $M(e,t){try{Bn(H,e.name);const n=await e.arrayBuffer();t(new Uint8Array(n))}catch(n){se(H,"crash",n.message)}}function yb(e,t){function n(r){if(T(t))switch(r){case"text/plain":t.text().then(i=>Vl(H,void 0,"text",`file:${t.name}`,i,e)).catch(i=>se(H,"crash",i.message));break;case"application/json":t.text().then(i=>Vl(H,void 0,"json",`file:${t.name}`,i,e)).catch(i=>se(H,"crash",i.message));break;case"application/zip":DM(t,i=>yb(e,i)).catch(i=>se(H,"crash",i.message));break;case"application/octet-stream":$M(t,i=>Vl(H,void 0,"binary",`file:${t.name}`,i,e)).catch(i=>se(H,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=gb(t.name,new Uint8Array(i));if(s)n(s);else return se(H,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>se(H,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function dd(e,t){function n(r){se(e,"crash",r.message)}t().catch(n)}function jM(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function zM(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const KM=new Date("1980/09/02");async function WM(e){return console.info("saved",e),new Promise((t,n)=>{const r=new fd;for(let i=0;i<e.length;++i){const s=e[i],o=QC(s);if(o){const a=pA(o);T(a)&&r.file(s.id,a,{date:KM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(zM(i))}).catch(n)})}async function GM(e){return new Promise((t,n)=>{const r=new fd;r.loadAsync(jM(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=t4(mA(c));T(u)&&i.push(u)}t(i)}).catch(n)})}const Un="$yellow$205$205$205$196";let We;function HM(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let f=r;f<=s;++f){const d={x:f-r,y:h-i},p=Br(e,{x:f,y:h});(p==null?void 0:p.category)===Pn.ISOBJECT?(u.push(dr(T1(e,f,h))),T(p.x)&&T(p.y)&&l.push({...dr(p),...d})):u.push({...dr(p),...d})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}function pd(e,t){return`inspect:${t!=null&&t.id?t.id:cs(e,t)}`}function YM(e,t,n){const r=Mn(Vt.MAIN);if(!T(r))return;const i=fr(e);if(!T(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){console.info(f,d),T(t)&&(t[f]=d)}const a=t.category===Pn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=pd(i,t);le(e,`${a}: ${c} ${u}`),le(e,Un),ee(e,l,"color",[n,"coloredit"],s,o);const h=on(e);h.scroll=kr(e)}function VM(e,t,n){const r=Mn(Vt.MAIN);if(!T(r))return;const i=fr(e);if(!T(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){T(t)&&(t[f]=d)}const a=t.category===Pn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=pd(i,t);le(e,`${a}: ${c} ${u}`),le(e,Un),ee(e,l,"char",[n,"charedit"],s,o);const h=on(e);h.scroll=kr(e)}function _b(e,t,n,r,i,s){var h,f,d;function o(p){var E;return(r==null?void 0:r[p])??((E=r==null?void 0:r.kinddata)==null?void 0:E[p])??0}function a(p,g){T(r)&&(r[p]=g)}s?le(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):le(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),le(e,Un);const c=pd(t,r);s?(ee(e,c,"cycle",["cycle","number","1","255"],o,a),ee(e,c,"collision",["collision","select","iswalking",`${jt.ISWALK}`,"isswimming",`${jt.ISSWIM}`,"isbullet",`${jt.ISBULLET}`],o,a)):ee(e,c,"collision",["collision","select","iswalkable",`${jt.ISWALK}`,"issolid",`${jt.ISSOLID}`,"iswim",`${jt.ISSWIM}`],o,a),s&&ee(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),ee(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const u=ul(n),l=Wl(u);for(let p=0;p<l.length;++p){const g=l[p];switch(g){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(Xt(u[g])){const[E,w,...v]=u[g];kt(w)&&ee(e,c,w||g,[g,E,...v],o,a)}break}}le(e,Un),ee(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),ee(e,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),ee(e,c,`bg: ${r.bg??((d=r.kinddata)==null?void 0:d.bg)??0}`,["bg","hk","b"," B ","next"],o,a)}function fs(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function qM(e,t,n,r){const i=fr(e);if(T(i))switch(We=HM(i,t,n),r){case"copyobjects":We.terrain=[];break;case"copyterrain":We.objects=[];break}}function JM(e,t,n){const r=fs(t,n);le(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),le(e,Un),ee(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),ee(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),ee(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=on(e);i.scroll=kr(e)}function XM(e,t,n,r){const i=fr(e);if(!T(i)||!T(We))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),u=a-s+1,l=c-o+1,h=Math.min(We.width,u),f=Math.min(We.height,l);switch(r){case"pasteall":{for(let d=0;d<f;++d)for(let p=0;p<h;++p){const g=ac({x:p,y:d},We.width);li(i,{...We.terrain[g],x:s+p,y:o+d})}for(let d=0;d<We.objects.length;++d){const p=We.objects[d];T(p.x)&&T(p.y)&&im(p.x,p.y,0,u-1,l-1,0)&&Kf(i,{...p,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let d=0;d<We.objects.length;++d){const p=We.objects[d];T(p.x)&&T(p.y)&&im(p.x,p.y,0,u-1,l-1,0)&&Kf(i,{...p,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let d=0;d<f;++d)for(let p=0;p<h;++p){const g=ac({x:p,y:d},We.width);li(i,{...We.terrain[g],x:s+p,y:o+d})}break;case"pasteterraintiled":for(let d=o;d<=c;++d)for(let p=s;p<=a;++p){const g=(p-s)%We.width,E=(d-o)%We.height,w=ac({x:g,y:E},We.width);li(i,{...We.terrain[w],x:p,y:d})}break}}function ZM(e,t,n){const r=fs(t,n);le(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),le(e,Un),ee(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),ee(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),ee(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),ee(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=on(e);i.scroll=kr(e)}function QM(e,t,n,r){const i=Mn(Vt.MAIN);if(!T(i))return;const s=fr(e);if(T(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Br(s,{x:a,y:o});(c==null?void 0:c.category)===Pn.ISOBJECT&&Ci(i,s,c,i.timestamp),li(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Br(s,{x:a,y:o});(c==null?void 0:c.category)===Pn.ISOBJECT&&Ci(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)li(s,{x:a,y:o});break}}}function tU(e,t,n){const r=fs(t,n);le(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),le(e,Un),ee(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),ee(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),ee(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=on(e);i.scroll=kr(e)}function eU(e,t,n,r){const i=fr(e);if(!T(i))return;function s(){return 0}function o(c,u){Lt(u)&&ih(t.x,t.y,n.x,n.y).forEach(l=>{const h=Br(i,l);T(h)&&(h[c]=u)})}le(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),le(e,Un),ee(e,`batch:${fs(t,n)}`,"char",[r,"charedit"],s,o);const a=on(e);a.scroll=kr(e)}function nU(e,t,n,r){const i=fr(e);if(!T(i))return;function s(){return 0}function o(c,u){Lt(u)&&ih(t.x,t.y,n.x,n.y).forEach(l=>{const h=Br(i,l);T(h)&&(h[c]=u)})}le(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),le(e,Un),ee(e,`batch:${fs(t,n)}`,"color",[r,"coloredit"],s,o);const a=on(e);a.scroll=kr(e)}function rU(e,t,n,r){const i=fr(e);if(!T(i))return;function s(){return 0}function o(c,u){Lt(u)&&ih(t.x,t.y,n.x,n.y).forEach(l=>{const h=Br(i,l);T(h)&&(h[c]=u)})}le(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),le(e,Un),ee(e,`batch:${fs(t,n)}`,"color",[r,"coloredit"],s,o);const a=on(e);a.scroll=kr(e)}function iU(e,t,n){const r=fs(t,n);le(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),le(e,Un),ee(e,"batch","copy elements",[`copy:${r}`,"hk","1"," 1 ","next"]),T(We)&&ee(e,"batch","paste elements",[`paste:${r}`,"hk","2"," 2 ","next"]),ee(e,"batch","make empty",[`empty:${r}`,"hk","0"," 0 ","next"]),le(e,Un),ee(e,"batch","set chars:",[`chars:${r}`,"hk","a"," A ","next"]),ee(e,"batch","set colors:",[`colors:${r}`,"hk","c"," C ","next"]),ee(e,"batch","set bgs:",[`bgs:${r}`,"hk","b"," B ","next"])}function sU(e,t,n){const r=Mn(Vt.MAIN);if(!T(r))return;const i=fr(e);if(!T(i))return;if(Ur(r,i),t.x===n.x&&t.y===n.y){const o=Br(i,t);if(T(o)){const a=oi(r,xt.TERRAIN,o.kind??"");T(a)&&_b(e,i,a,o,t,!1);const c=oi(r,xt.OBJECT,o.kind??"");T(c)&&_b(e,i,c,o,t,!0)}else le(e,`empty: ${t.x}, ${t.y}`),le(e,Un)}else iU(e,t,n);const s=on(e);s.scroll=kr(e)}const oU=16,ds={},aU=64;let bb=0;const Qs={},to={};async function wb(e=""){const t=Rl(),n=Me(Vt.MAIN);if(t.length&&T(n)){const r=await WM(t),i=`${e}${new Date().toISOString()} ${n.name} ${r.length} chars`;gw(Ue,i,r,ha())}}const Ue=ms("vm",["tick","second"],e=>{var t;if(Ue.session(e))switch(e.target){case"operator":T(e.player)&&(yM(e.player),ne(Ue,`operator set to ${e.player}`),Ue.replynext(e,"ackoperator",!0,e.player));break;case"books":e.player===ha()&&dd(Ue,async()=>{if(e.player&&Xt(e.data)){const[n,r]=e.data,i=await GM(n),s=i.map(o=>o.name);vM(i,r),ne(Ue,`loading ${s.join(", ")}`),Hl(Ue,e.player)}});break;case"joinack":T(e.player)&&!SM(e.player)&&Hl(Ue,e.player);break;case"logout":T(e.player)&&(xM(e.player),delete ds[e.player],ne(Ue,`player ${e.player} logout`),Hl(Ue,e.player));break;case"login":T(e.player)&&AM(e.player)&&(ds[e.player]=0,ne(Ue,`login from ${e.player}`),Ue.replynext(e,"acklogin",!0,e.player));break;case"doot":T(e.player)&&(ds[e.player]=0,Nd(Ue,"active",e.player));break;case"input":if(T(e.player)){const n=Xs(e.player),[r=sn.NONE,i=0]=e.data??[sn.NONE,0];Xt(n.inputqueue)||(n.inputqueue=[]),r!==sn.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(T(e.player)&&Xt(e.data)){const[n,r]=e.data,i=ya(n,r);T(to[i])||(to[i]=J0(i,s=>{const[o,a]=r,c=Ui(n),u=zs(c,o);if(T(u))if(js(u)===xt.BOARD&&T(a)){const l=Oi(u),h=Jn(l,a);T(h)&&(h.code=s,Cf(n1(s),h))}else u.code=s,ZC(u)})),Qs[i]=Qs[i]??new Set,Qs[i].add(e.player)}break;case"coderelease":if(e.player&&Xt(e.data)){const[n,r]=e.data,[,i]=r,s=ya(n,r);T(Qs[s])&&(Qs[s].delete(e.player),Qs[s].size===0&&((t=to[s])==null||t.call(to),to[s]=void 0,kt(i)&&NM(i)))}break;case"halt":e.player===ha()&&iw(e.data)&&_M(e.data);break;case"tick":bM()||CM();break;case"synthsend":kt(e.data)&&LM(e.data);break;case"second":{RM(ds);const n=Object.keys(ds);for(let r=0;r<n.length;++r)++ds[n[r]];for(let r=0;r<n.length;++r){const i=n[r];ds[i]>=oU&&Ld(Ue,i)}++bb>=aU&&(bb=0,Md(Ue,"autosave",ha()));break}case"flush":dd(Ue,async()=>{kt(e.data)?await wb(`${e.data} `):await wb()});break;case"cli":T(e.player)&&MM(e.player,e.data);break;case"inspect":if(T(e.player)&&Xt(e.data)){const[n,r]=e.data;sU(e.player,n,r)}break;case"loader":if(T(e.player)&&Xt(e.data)){const[n,r,i,s]=e.data;r==="file"?yb(e.player,s):X4(n,r,i,s,e.player)}break;default:{const{target:n,path:r}=ro(e.target);switch(Dt(n)){case"batch":if(T(e.player)){const i=fr(e.player);if(!T(i))break;const s=ro(r),[o,a,c,u]=s.path.split(",").map(f=>parseFloat(f)),l={x:o,y:a},h={x:c,y:u};switch(s.target){case"copy":JM(e.player,l,h);break;case"copyall":case"copyobjects":case"copyterrain":qM(e.player,l,h,s.target);break;case"paste":ZM(e.player,l,h);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":XM(e.player,l,h,s.target);break;case"empty":tU(e.player,l,h);break;case"emptyall":case"emptyobjects":case"emptyterrain":QM(e.player,l,h,s.target);break;case"chars":eU(e.player,l,h,"char");break;case"colors":nU(e.player,l,h,"color");break;case"bgs":rU(e.player,l,h,"bg");break;default:console.info("unknown batch",s);break}}break;case"inspect":if(T(e.player)){const i=Me(Vt.MAIN);if(!T(i))break;const s=fr(e.player);if(!T(s))break;const o=ro(r),a=b4(s,o.target);if(!T(a))break;switch(o.path){case"bg":case"color":YM(e.player,a,o.path);break;case"char":VM(e.player,a,o.path);break;case"code":dd(Ue,async()=>{if(!T(e.player))return;const c=Uo(a),u="object";Qt(Ue,`opened [${u}] ${c}`);const l=[s.id,a.id??""];Qu(ya(i.id,l),a.code??""),await Nw(1e3),Cd(Ue,i.id,[s.id,a.id??""],u,`${c} - ${i.name}`,e.player)});break;default:console.info("unknown inspect",o);break}}break;default:IM(e);break}break}}},lb());function cU(){mw(Ue)}const{forward:lU}=Iw(e=>postMessage(e));onmessage=function(t){lU(t.data)},setTimeout(cU,100)})();

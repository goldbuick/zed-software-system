var Ej=Object.defineProperty;var xj=(gi,Vn,Cn)=>Vn in gi?Ej(gi,Vn,{enumerable:!0,configurable:!0,writable:!0,value:Cn}):gi[Vn]=Cn;var Lt=(gi,Vn,Cn)=>xj(gi,typeof Vn!="symbol"?Vn+"":Vn,Cn);(function(){"use strict";const gi=new Set,Vn={emit(t,e,n,r,i){Vn.invoke(kv(t,e,n,r,i))},invoke(t){gi.forEach(e=>e.handle(t))},connect(t){gi.add(t)},disconnect(t){gi.delete(t)}};var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function no(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Kx(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var vp={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Cn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(vp);var Wx=vp.exports,kp=no(Wx),Tp={};(function(t){var e=Cn&&Cn.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,p;d<h;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,y=l.addAdverb,w=y===void 0?!1:y,k=e(e(e([],e([],Array(m),!0).map(function(T){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),w?[n(t.adverbs)]:[],!0);return h&&(k=k.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),k.join(f)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return t.adjectives.length*f*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*f+f*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(h?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*f+f*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(h?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(Tp);var Ap=no(Tp);const Hx="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Gx=t=>crypto.getRandomValues(new Uint8Array(t)),Yx=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Rp=(t,e=21)=>Yx(t,e,Gx),Vx=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Hx[n[t]&63];return e};var Sp="abcdefghijklmnopqrstuvwxyz",Op="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Ip="0123456789",Zx="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Xx="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const qx=Ip,Jx=Sp,Qx=Op;var tv=qx+Jx+Qx,mh={lowercase:Sp,uppercase:Op,numbers:Ip,nolookalikes:Zx,nolookalikesSafe:Xx,alphanumeric:tv};function Pe(){return`sid_${Vx(12).replaceAll("-",".")}`}Rp(mh.numbers,4),Rp(`${mh.numbers}${mh.lowercase}`,16);function Kr(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function ev(){return Ap({capitalize:!1,adjectiveCount:1})}function nv(){return Ap({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var rv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),iv=Object.prototype.hasOwnProperty;function gh(t,e){return iv.call(t,e)}function _h(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)gh(t,i)&&r.push(i);return r}function Ln(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function yh(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function ws(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Np(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function bh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(bh(t[e]))return!0}else if(typeof t=="object"){for(var r=_h(t),i=r.length,s=0;s<i;s++)if(bh(t[r[s]]))return!0}}return!1}function Cp(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Lp=function(t){rv(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,Cp(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Cp(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),Me=Lp,sv=Ln,ro={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=zc(n,this.path);r&&(r=Ln(r));var i=Es(n,{op:"remove",path:this.from}).removed;return Es(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=zc(n,this.from);return Es(n,{op:"add",path:this.path,value:Ln(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:_a(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},ov={add:function(t,e,n){return yh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:ro.move,copy:ro.copy,test:ro.test,_get:ro._get};function zc(t,e){if(e=="")return t;var n={op:"_get",path:e};return Es(t,n),n.value}function Es(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):Kc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=zc(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=_a(t,e.value),o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Ln(t));var a=e.path||"",c=a.split("/"),l=t,u=1,f=c.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=Kc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Np(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!yh(h))throw new Me("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);yh(h)&&(h=~~h)}if(u>=f){if(n&&e.op==="add"&&h>l.length)throw new Me("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=ov[e.op].call(e,l,h,t);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=f){var o=ro[e.op].call(e,l,h,t);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Me("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function wh(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Ln(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Es(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function av(t,e,n){var r=Es(t,e);if(r.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Kc(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Me("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(ro[t.op]){if(typeof t.path!="string")throw new Me("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Me('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Me("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&bh(t.value))throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Me("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Me("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Mp([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Me("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Mp(t,e,n){try{if(!Array.isArray(t))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)wh(Ln(e),Ln(t),n||!0);else{n=n||Kc;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof Me)return i;throw i}}function _a(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!_a(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!_a(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var cv=Object.freeze({__proto__:null,JsonPatchError:Me,_areEquals:_a,applyOperation:Es,applyPatch:wh,applyReducer:av,deepClone:sv,getValueByPointer:zc,validate:Mp,validator:Kc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Eh=new WeakMap,lv=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),uv=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function hv(t){return Eh.get(t)}function fv(t,e){return t.observers.get(e)}function dv(t,e){t.observers.delete(e.callback)}function pv(t,e){e.unobserve()}function mv(t,e){var n=[],r,i=hv(t);if(!i)i=new lv(t),Eh.set(t,i);else{var s=fv(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Ln(t),e){r.callback=e,r.next=null;var o=function(){xh(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){xh(r),clearTimeout(r.next),dv(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new uv(e,r)),r}function xh(t,e){e===void 0&&(e=!1);var n=Eh.get(t.object);vh(n.value,t.object,t.patches,"",e),t.patches.length&&wh(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function vh(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=_h(e),o=_h(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(gh(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?vh(u,f,n,r+"/"+ws(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+ws(l),value:Ln(u)}),n.push({op:"replace",path:r+"/"+ws(l),value:Ln(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+ws(l),value:Ln(u)}),n.push({op:"remove",path:r+"/"+ws(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!gh(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+ws(l),value:Ln(e[l])})}}}function Up(t,e,n){n===void 0&&(n=!1);var r=[];return vh(t,e,r,"",n),r}var gv=Object.freeze({__proto__:null,compare:Up,generate:xh,observe:mv,unobserve:pv});Object.assign({},cv,gv,{JsonPatchError:Lp,deepClone:Ln,escapePathComponent:ws,unescapePathComponent:Np});var _v=typeof Element<"u",yv=typeof Map=="function",bv=typeof Set=="function",wv=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Wc(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Wc(t[r],e[r]))return!1;return!0}var s;if(yv&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Wc(r.value[1],e.get(r.value[0])))return!1;return!0}if(bv&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(wv&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(_v&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Wc(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var Ev=function(e,n){try{return Wc(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},xv=no(Ev);function x(t){return t!=null}const hr=Object.keys;function Zn(t){return Ln(t)}function vv(t){return typeof t=="boolean"}function At(t){return typeof t=="number"&&isNaN(t)===!1}function bt(t){return typeof t=="string"}function ae(t){return Array.isArray(t)}function kh(t){return t}var Rt=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Rt||{}),$t=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))($t||{}),fr=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(fr||{}),pt=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.PLAYER=18]="PLAYER",t[t.FIND=19]="FIND",t[t.FLEE=20]="FLEE",t[t.TO=21]="TO",t[t.MID=22]="MID",t[t.OVER=23]="OVER",t[t.UNDER=24]="UNDER",t))(pt||{}),vt=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.ZSSEDIT=14]="ZSSEDIT",t[t.CHAREDIT=15]="CHAREDIT",t[t.COLOREDIT=16]="COLOREDIT",t))(vt||{});function It(t){return(t==null?void 0:t.toLowerCase().trim())??""}function kv(t,e,n,r,i){return{session:t,player:e,id:Pe(),sender:n,target:r,data:i}}function Xn(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function io(t,e=[],n=kh,r=""){const i=Pe(),s=It(t),o=e.map(It);let a=r;const c={id(){return i},name(){return t},session(l){return x(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,f){Vn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Xn(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&x(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Vn.connect(c),c}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Tv=4,Fp=0,Bp=1,Av=2;function so(t){let e=t.length;for(;--e>=0;)t[e]=0}const Rv=0,Pp=1,Sv=2,Ov=3,Iv=258,Th=29,ya=256,ba=ya+1+Th,oo=30,Ah=19,Dp=2*ba+1,xs=15,Rh=16,Nv=7,Sh=256,$p=16,jp=17,zp=18,Oh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Hc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Cv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Kp=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Lv=512,_i=new Array((ba+2)*2);so(_i);const wa=new Array(oo*2);so(wa);const Ea=new Array(Lv);so(Ea);const xa=new Array(Iv-Ov+1);so(xa);const Ih=new Array(Th);so(Ih);const Gc=new Array(oo);so(Gc);function Nh(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let Wp,Hp,Gp;function Ch(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const Yp=t=>t<256?Ea[t]:Ea[256+(t>>>7)],va=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Mn=(t,e,n)=>{t.bi_valid>Rh-n?(t.bi_buf|=e<<t.bi_valid&65535,va(t,t.bi_buf),t.bi_buf=e>>Rh-t.bi_valid,t.bi_valid+=n-Rh):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Wr=(t,e,n)=>{Mn(t,n[e*2],n[e*2+1])},Vp=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Mv=t=>{t.bi_valid===16?(va(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Uv=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,f,d,h,p,m=0;for(d=0;d<=xs;d++)t.bl_count[d]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Dp;l++)u=t.heap[l],d=n[n[u*2+1]*2+1]+1,d>c&&(d=c,m++),n[u*2+1]=d,!(u>r)&&(t.bl_count[d]++,h=0,u>=a&&(h=o[u-a]),p=n[u*2],t.opt_len+=p*(d+h),s&&(t.static_len+=p*(i[u*2+1]+h)));if(m!==0){do{for(d=c-1;t.bl_count[d]===0;)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,m-=2}while(m>0);for(d=c;d!==0;d--)for(u=t.bl_count[d];u!==0;)f=t.heap[--l],!(f>r)&&(n[f*2+1]!==d&&(t.opt_len+=(d-n[f*2+1])*n[f*2],n[f*2+1]=d),u--)}},Zp=(t,e,n)=>{const r=new Array(xs+1);let i=0,s,o;for(s=1;s<=xs;s++)i=i+n[s-1]<<1,r[s]=i;for(o=0;o<=e;o++){let a=t[o*2+1];a!==0&&(t[o*2]=Vp(r[a]++,a))}},Fv=()=>{let t,e,n,r,i;const s=new Array(xs+1);for(n=0,r=0;r<Th-1;r++)for(Ih[r]=n,t=0;t<1<<Oh[r];t++)xa[n++]=r;for(xa[n-1]=r,i=0,r=0;r<16;r++)for(Gc[r]=i,t=0;t<1<<Hc[r];t++)Ea[i++]=r;for(i>>=7;r<oo;r++)for(Gc[r]=i<<7,t=0;t<1<<Hc[r]-7;t++)Ea[256+i++]=r;for(e=0;e<=xs;e++)s[e]=0;for(t=0;t<=143;)_i[t*2+1]=8,t++,s[8]++;for(;t<=255;)_i[t*2+1]=9,t++,s[9]++;for(;t<=279;)_i[t*2+1]=7,t++,s[7]++;for(;t<=287;)_i[t*2+1]=8,t++,s[8]++;for(Zp(_i,ba+1,s),t=0;t<oo;t++)wa[t*2+1]=5,wa[t*2]=Vp(t,5);Wp=new Nh(_i,Oh,ya+1,ba,xs),Hp=new Nh(wa,Hc,0,oo,xs),Gp=new Nh(new Array(0),Cv,0,Ah,Nv)},Xp=t=>{let e;for(e=0;e<ba;e++)t.dyn_ltree[e*2]=0;for(e=0;e<oo;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Ah;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Sh*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},qp=t=>{t.bi_valid>8?va(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Jp=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},Lh=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Jp(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Jp(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},Qp=(t,e,n)=>{let r,i,s=0,o,a;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+s++]&255,r+=(t.pending_buf[t.sym_buf+s++]&255)<<8,i=t.pending_buf[t.sym_buf+s++],r===0?Wr(t,i,e):(o=xa[i],Wr(t,o+ya+1,e),a=Oh[o],a!==0&&(i-=Ih[o],Mn(t,i,a)),r--,o=Yp(r),Wr(t,o,n),a=Hc[o],a!==0&&(r-=Gc[o],Mn(t,r,a)));while(s<t.sym_next);Wr(t,Sh,e)},Mh=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c=-1,l;for(t.heap_len=0,t.heap_max=Dp,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)Lh(t,n,o);l=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Lh(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[l*2]=n[o*2]+n[a*2],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=l,t.heap[1]=l++,Lh(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Uv(t,e),Zp(n,c,t.bl_count)},tm=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)&&(a<l?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[$p*2]++):a<=10?t.bl_tree[jp*2]++:t.bl_tree[zp*2]++,a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},em=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)){if(a<l)do Wr(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Wr(t,s,t.bl_tree),a--),Wr(t,$p,t.bl_tree),Mn(t,a-3,2)):a<=10?(Wr(t,jp,t.bl_tree),Mn(t,a-3,3)):(Wr(t,zp,t.bl_tree),Mn(t,a-11,7));a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},Bv=t=>{let e;for(tm(t,t.dyn_ltree,t.l_desc.max_code),tm(t,t.dyn_dtree,t.d_desc.max_code),Mh(t,t.bl_desc),e=Ah-1;e>=3&&t.bl_tree[Kp[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Pv=(t,e,n,r)=>{let i;for(Mn(t,e-257,5),Mn(t,n-1,5),Mn(t,r-4,4),i=0;i<r;i++)Mn(t,t.bl_tree[Kp[i]*2+1],3);em(t,t.dyn_ltree,e-1),em(t,t.dyn_dtree,n-1)},Dv=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return Fp;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Bp;for(n=32;n<ya;n++)if(t.dyn_ltree[n*2]!==0)return Bp;return Fp};let nm=!1;const $v=t=>{nm||(Fv(),nm=!0),t.l_desc=new Ch(t.dyn_ltree,Wp),t.d_desc=new Ch(t.dyn_dtree,Hp),t.bl_desc=new Ch(t.bl_tree,Gp),t.bi_buf=0,t.bi_valid=0,Xp(t)},rm=(t,e,n,r)=>{Mn(t,(Rv<<1)+(r?1:0),3),qp(t),va(t,n),va(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},jv=t=>{Mn(t,Pp<<1,3),Wr(t,Sh,_i),Mv(t)},zv=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===Av&&(t.strm.data_type=Dv(t)),Mh(t,t.l_desc),Mh(t,t.d_desc),o=Bv(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?rm(t,e,n,r):t.strategy===Tv||s===i?(Mn(t,(Pp<<1)+(r?1:0),3),Qp(t,_i,wa)):(Mn(t,(Sv<<1)+(r?1:0),3),Pv(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Qp(t,t.dyn_ltree,t.dyn_dtree)),Xp(t),r&&qp(t)},Kv=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(xa[n]+ya+1)*2]++,t.dyn_dtree[Yp(e)*2]++),t.sym_next===t.sym_end);var Wv=$v,Hv=rm,Gv=zv,Yv=Kv,Vv=jv,Zv={_tr_init:Wv,_tr_stored_block:Hv,_tr_flush_block:Gv,_tr_tally:Yv,_tr_align:Vv},ka=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const Xv=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},qv=new Uint32Array(Xv());var rn=(t,e,n,r)=>{const i=qv,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1},vs={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ks={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Jv,_tr_stored_block:Uh,_tr_flush_block:Qv,_tr_tally:Wi,_tr_align:tk}=Zv,{Z_NO_FLUSH:Hi,Z_PARTIAL_FLUSH:ek,Z_FULL_FLUSH:nk,Z_FINISH:dr,Z_BLOCK:im,Z_OK:fn,Z_STREAM_END:sm,Z_STREAM_ERROR:Hr,Z_DATA_ERROR:rk,Z_BUF_ERROR:Fh,Z_DEFAULT_COMPRESSION:ik,Z_FILTERED:sk,Z_HUFFMAN_ONLY:Yc,Z_RLE:ok,Z_FIXED:ak,Z_DEFAULT_STRATEGY:ck,Z_UNKNOWN:lk,Z_DEFLATED:Vc}=ks,uk=9,hk=15,fk=8,Bh=256+1+29,dk=30,pk=19,mk=2*Bh+1,gk=15,Vt=3,Gi=258,Gr=Gi+Vt+1,_k=32,ao=42,Ph=57,Dh=69,$h=73,jh=91,zh=103,Ts=113,Ta=666,Tn=1,co=2,As=3,lo=4,yk=3,Rs=(t,e)=>(t.msg=vs[e],e),om=t=>t*2-(t>4?9:0),Yi=t=>{let e=t.length;for(;--e>=0;)t[e]=0},bk=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let Vi=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const qn=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Jn=(t,e)=>{Qv(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,qn(t.strm)},ie=(t,e)=>{t.pending_buf[t.pending++]=e},Aa=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},Kh=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=ka(t.adler,e,i,n):t.state.wrap===2&&(t.adler=rn(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},am=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-Gr?t.strstart-(t.w_size-Gr):0,l=t.window,u=t.w_mask,f=t.prev,d=t.strstart+Gi;let h=l[r+o-1],p=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(l[i+o]!==p||l[i+o-1]!==h||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<d);if(s=Gi-(d-r),r=d-Gi,s>o){if(t.match_start=e,o=s,s>=a)break;h=l[r+o-1],p=l[r+o]}}while((e=f[e&u])>c&&--n!==0);return o<=t.lookahead?o:t.lookahead},uo=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Gr)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),bk(t),r+=e),t.strm.avail_in===0)break;if(n=Kh(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=Vt)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Vi(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Vi(t,t.ins_h,t.window[i+Vt-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<Vt)););}while(t.lookahead<Gr&&t.strm.avail_in!==0)},cm=(t,e)=>{let n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,s,o=0,a=t.strm.avail_in;do{if(r=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>s&&(r=s),r<n&&(r===0&&e!==dr||e===Hi||r!==i+t.strm.avail_in)))break;o=e===dr&&r===i+t.strm.avail_in?1:0,Uh(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,qn(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(Kh(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?lo:e!==Hi&&e!==dr&&t.strm.avail_in===0&&t.strstart===t.block_start?co:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(Kh(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,n=s>t.w_size?t.w_size:s,i=t.strstart-t.block_start,(i>=n||(i||e===dr)&&e!==Hi&&t.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,o=e===dr&&t.strm.avail_in===0&&r===i?1:0,Uh(t,t.block_start,r,o),t.block_start+=r,qn(t.strm)),o?As:Tn)},Wh=(t,e)=>{let n,r;for(;;){if(t.lookahead<Gr){if(uo(t),t.lookahead<Gr&&e===Hi)return Tn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Vt&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Vt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Gr&&(t.match_length=am(t,n)),t.match_length>=Vt)if(r=Wi(t,t.strstart-t.match_start,t.match_length-Vt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Vt){t.match_length--;do t.strstart++,t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Vt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+1]);else r=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=t.strstart<Vt-1?t.strstart:Vt-1,e===dr?(Jn(t,!0),t.strm.avail_out===0?As:lo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:co},ho=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Gr){if(uo(t),t.lookahead<Gr&&e===Hi)return Tn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Vt&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Vt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Vt-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Gr&&(t.match_length=am(t,n),t.match_length<=5&&(t.strategy===sk||t.match_length===Vt&&t.strstart-t.match_start>4096)&&(t.match_length=Vt-1)),t.prev_length>=Vt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Vt,r=Wi(t,t.strstart-1-t.prev_match,t.prev_length-Vt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Vt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Vt-1,t.strstart++,r&&(Jn(t,!1),t.strm.avail_out===0))return Tn}else if(t.match_available){if(r=Wi(t,0,t.window[t.strstart-1]),r&&Jn(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Tn}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Wi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Vt-1?t.strstart:Vt-1,e===dr?(Jn(t,!0),t.strm.avail_out===0?As:lo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:co},wk=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=Gi){if(uo(t),t.lookahead<=Gi&&e===Hi)return Tn;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Vt&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Gi;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Gi-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Vt?(n=Wi(t,1,t.match_length-Vt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=0,e===dr?(Jn(t,!0),t.strm.avail_out===0?As:lo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:co},Ek=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(uo(t),t.lookahead===0)){if(e===Hi)return Tn;break}if(t.match_length=0,n=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Jn(t,!1),t.strm.avail_out===0))return Tn}return t.insert=0,e===dr?(Jn(t,!0),t.strm.avail_out===0?As:lo):t.sym_next&&(Jn(t,!1),t.strm.avail_out===0)?Tn:co};function Yr(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const Ra=[new Yr(0,0,0,0,cm),new Yr(4,4,8,4,Wh),new Yr(4,5,16,8,Wh),new Yr(4,6,32,32,Wh),new Yr(4,4,16,16,ho),new Yr(8,16,32,32,ho),new Yr(8,16,128,128,ho),new Yr(8,32,128,256,ho),new Yr(32,128,258,1024,ho),new Yr(32,258,258,4096,ho)],xk=t=>{t.window_size=2*t.w_size,Yi(t.head),t.max_lazy_match=Ra[t.level].max_lazy,t.good_match=Ra[t.level].good_length,t.nice_match=Ra[t.level].nice_length,t.max_chain_length=Ra[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Vt-1,t.match_available=0,t.ins_h=0};function vk(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Vc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(mk*2),this.dyn_dtree=new Uint16Array((2*dk+1)*2),this.bl_tree=new Uint16Array((2*pk+1)*2),Yi(this.dyn_ltree),Yi(this.dyn_dtree),Yi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(gk+1),this.heap=new Uint16Array(2*Bh+1),Yi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Bh+1),Yi(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Sa=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==ao&&e.status!==Ph&&e.status!==Dh&&e.status!==$h&&e.status!==jh&&e.status!==zh&&e.status!==Ts&&e.status!==Ta?1:0},lm=t=>{if(Sa(t))return Rs(t,Hr);t.total_in=t.total_out=0,t.data_type=lk;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Ph:e.wrap?ao:Ts,t.adler=e.wrap===2?0:1,e.last_flush=-2,Jv(e),fn},um=t=>{const e=lm(t);return e===fn&&xk(t.state),e},kk=(t,e)=>Sa(t)||t.state.wrap!==2?Hr:(t.state.gzhead=e,fn),hm=(t,e,n,r,i,s)=>{if(!t)return Hr;let o=1;if(e===ik&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>uk||n!==Vc||r<8||r>15||e<0||e>9||s<0||s>ak||r===8&&o!==1)return Rs(t,Hr);r===8&&(r=9);const a=new vk;return t.state=a,a.strm=t,a.status=ao,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Vt-1)/Vt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=n,um(t)},Tk=(t,e)=>hm(t,e,Vc,hk,fk,ck),Ak=(t,e)=>{if(Sa(t)||e>im||e<0)return t?Rs(t,Hr):Hr;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Ta&&e!==dr)return Rs(t,t.avail_out===0?Fh:Hr);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(qn(t),t.avail_out===0)return n.last_flush=-1,fn}else if(t.avail_in===0&&om(e)<=om(r)&&e!==dr)return Rs(t,Fh);if(n.status===Ta&&t.avail_in!==0)return Rs(t,Fh);if(n.status===ao&&n.wrap===0&&(n.status=Ts),n.status===ao){let i=Vc+(n.w_bits-8<<4)<<8,s=-1;if(n.strategy>=Yc||n.level<2?s=0:n.level<6?s=1:n.level===6?s=2:s=3,i|=s<<6,n.strstart!==0&&(i|=_k),i+=31-i%31,Aa(n,i),n.strstart!==0&&(Aa(n,t.adler>>>16),Aa(n,t.adler&65535)),t.adler=1,n.status=Ts,qn(t),n.pending!==0)return n.last_flush=-1,fn}if(n.status===Ph){if(t.adler=0,ie(n,31),ie(n,139),ie(n,8),n.gzhead)ie(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ie(n,n.gzhead.time&255),ie(n,n.gzhead.time>>8&255),ie(n,n.gzhead.time>>16&255),ie(n,n.gzhead.time>>24&255),ie(n,n.level===9?2:n.strategy>=Yc||n.level<2?4:0),ie(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(ie(n,n.gzhead.extra.length&255),ie(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=rn(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Dh;else if(ie(n,0),ie(n,0),ie(n,0),ie(n,0),ie(n,0),ie(n,n.level===9?2:n.strategy>=Yc||n.level<2?4:0),ie(n,yk),n.status=Ts,qn(t),n.pending!==0)return n.last_flush=-1,fn}if(n.status===Dh){if(n.gzhead.extra){let i=n.pending,s=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,qn(t),n.pending!==0)return n.last_flush=-1,fn;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=$h}if(n.status===$h){if(n.gzhead.name){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),qn(t),n.pending!==0)return n.last_flush=-1,fn;i=0}n.gzindex<n.gzhead.name.length?s=n.gzhead.name.charCodeAt(n.gzindex++)&255:s=0,ie(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=jh}if(n.status===jh){if(n.gzhead.comment){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),qn(t),n.pending!==0)return n.last_flush=-1,fn;i=0}n.gzindex<n.gzhead.comment.length?s=n.gzhead.comment.charCodeAt(n.gzindex++)&255:s=0,ie(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i))}n.status=zh}if(n.status===zh){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(qn(t),n.pending!==0))return n.last_flush=-1,fn;ie(n,t.adler&255),ie(n,t.adler>>8&255),t.adler=0}if(n.status=Ts,qn(t),n.pending!==0)return n.last_flush=-1,fn}if(t.avail_in!==0||n.lookahead!==0||e!==Hi&&n.status!==Ta){let i=n.level===0?cm(n,e):n.strategy===Yc?Ek(n,e):n.strategy===ok?wk(n,e):Ra[n.level].func(n,e);if((i===As||i===lo)&&(n.status=Ta),i===Tn||i===As)return t.avail_out===0&&(n.last_flush=-1),fn;if(i===co&&(e===ek?tk(n):e!==im&&(Uh(n,0,0,!1),e===nk&&(Yi(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),qn(t),t.avail_out===0))return n.last_flush=-1,fn}return e!==dr?fn:n.wrap<=0?sm:(n.wrap===2?(ie(n,t.adler&255),ie(n,t.adler>>8&255),ie(n,t.adler>>16&255),ie(n,t.adler>>24&255),ie(n,t.total_in&255),ie(n,t.total_in>>8&255),ie(n,t.total_in>>16&255),ie(n,t.total_in>>24&255)):(Aa(n,t.adler>>>16),Aa(n,t.adler&65535)),qn(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?fn:sm)},Rk=t=>{if(Sa(t))return Hr;const e=t.state.status;return t.state=null,e===Ts?Rs(t,rk):fn},Sk=(t,e)=>{let n=e.length;if(Sa(t))return Hr;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==ao||r.lookahead)return Hr;if(i===1&&(t.adler=ka(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Yi(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,uo(r);r.lookahead>=Vt;){let c=r.strstart,l=r.lookahead-(Vt-1);do r.ins_h=Vi(r,r.ins_h,r.window[c+Vt-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=Vt-1,uo(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Vt-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,fn};var Ok=Tk,Ik=hm,Nk=um,Ck=lm,Lk=kk,Mk=Ak,Uk=Rk,Fk=Sk,Bk="pako deflate (from Nodeca project)",Oa={deflateInit:Ok,deflateInit2:Ik,deflateReset:Nk,deflateResetKeep:Ck,deflateSetHeader:Lk,deflate:Mk,deflateEnd:Uk,deflateSetDictionary:Fk,deflateInfo:Bk};const Pk=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Dk=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Pk(n,r)&&(t[r]=n[r])}}return t},$k=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n},Zc={assign:Dk,flattenChunks:$k};let fm=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{fm=!1}const Ia=new Uint8Array(256);for(let t=0;t<256;t++)Ia[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ia[254]=Ia[254]=1;var jk=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const zk=(t,e)=>{if(e<65534&&t.subarray&&fm)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var Kk=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=Ia[o];if(a>4){s[i++]=65533,r+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|t[r++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return zk(s,i)},Wk=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+Ia[t[n]]>e?n:e},Na={string2buf:jk,buf2string:Kk,utf8border:Wk};function Hk(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var dm=Hk;const pm=Object.prototype.toString,{Z_NO_FLUSH:Gk,Z_SYNC_FLUSH:Yk,Z_FULL_FLUSH:Vk,Z_FINISH:Zk,Z_OK:Xc,Z_STREAM_END:Xk,Z_DEFAULT_COMPRESSION:qk,Z_DEFAULT_STRATEGY:Jk,Z_DEFLATED:Qk}=ks;function Ca(t){this.options=Zc.assign({level:qk,method:Qk,chunkSize:16384,windowBits:15,memLevel:8,strategy:Jk},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dm,this.strm.avail_out=0;let n=Oa.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Xc)throw new Error(vs[n]);if(e.header&&Oa.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=Na.string2buf(e.dictionary):pm.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=Oa.deflateSetDictionary(this.strm,r),n!==Xc)throw new Error(vs[n]);this._dict_set=!0}}Ca.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Zk:Gk,typeof t=="string"?n.input=Na.string2buf(t):pm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Yk||s===Vk)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=Oa.deflate(n,s),i===Xk)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Oa.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Xc;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0},Ca.prototype.onData=function(t){this.chunks.push(t)},Ca.prototype.onEnd=function(t){t===Xc&&(this.result=Zc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Hh(t,e){const n=new Ca(e);if(n.push(t,!0),n.err)throw n.msg||vs[n.err];return n.result}function tT(t,e){return e=e||{},e.raw=!0,Hh(t,e)}function eT(t,e){return e=e||{},e.gzip=!0,Hh(t,e)}var nT=Ca,rT=Hh,iT=tT,sT=eT,oT=ks,aT={Deflate:nT,deflate:rT,deflateRaw:iT,gzip:sT,constants:oT};const qc=16209,cT=16191;var lT=function(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,y,w,k,T,A,C,R,S,U,I,D;const G=e.state;r=e.next_in,I=e.input,i=r+(e.avail_in-5),s=e.next_out,D=e.output,o=s-(n-e.avail_out),a=s+(e.avail_out-257),c=G.dmax,l=G.wsize,u=G.whave,f=G.wnext,d=G.window,h=G.hold,p=G.bits,m=G.lencode,y=G.distcode,w=(1<<G.lenbits)-1,k=(1<<G.distbits)-1;t:do{p<15&&(h+=I[r++]<<p,p+=8,h+=I[r++]<<p,p+=8),T=m[h&w];e:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A===0)D[s++]=T&65535;else if(A&16){C=T&65535,A&=15,A&&(p<A&&(h+=I[r++]<<p,p+=8),C+=h&(1<<A)-1,h>>>=A,p-=A),p<15&&(h+=I[r++]<<p,p+=8,h+=I[r++]<<p,p+=8),T=y[h&k];n:for(;;){if(A=T>>>24,h>>>=A,p-=A,A=T>>>16&255,A&16){if(R=T&65535,A&=15,p<A&&(h+=I[r++]<<p,p+=8,p<A&&(h+=I[r++]<<p,p+=8)),R+=h&(1<<A)-1,R>c){e.msg="invalid distance too far back",G.mode=qc;break t}if(h>>>=A,p-=A,A=s-o,R>A){if(A=R-A,A>u&&G.sane){e.msg="invalid distance too far back",G.mode=qc;break t}if(S=0,U=d,f===0){if(S+=l-A,A<C){C-=A;do D[s++]=d[S++];while(--A);S=s-R,U=D}}else if(f<A){if(S+=l+f-A,A-=f,A<C){C-=A;do D[s++]=d[S++];while(--A);if(S=0,f<C){A=f,C-=A;do D[s++]=d[S++];while(--A);S=s-R,U=D}}}else if(S+=f-A,A<C){C-=A;do D[s++]=d[S++];while(--A);S=s-R,U=D}for(;C>2;)D[s++]=U[S++],D[s++]=U[S++],D[s++]=U[S++],C-=3;C&&(D[s++]=U[S++],C>1&&(D[s++]=U[S++]))}else{S=s-R;do D[s++]=D[S++],D[s++]=D[S++],D[s++]=D[S++],C-=3;while(C>2);C&&(D[s++]=D[S++],C>1&&(D[s++]=D[S++]))}}else if(A&64){e.msg="invalid distance code",G.mode=qc;break t}else{T=y[(T&65535)+(h&(1<<A)-1)];continue n}break}}else if(A&64)if(A&32){G.mode=cT;break t}else{e.msg="invalid literal/length code",G.mode=qc;break t}else{T=m[(T&65535)+(h&(1<<A)-1)];continue e}break}}while(r<i&&s<a);C=p>>3,r-=C,p-=C<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<a?257+(a-s):257-(s-a),G.hold=h,G.bits=p};const fo=15,mm=852,gm=592,_m=0,Gh=1,ym=2,uT=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),hT=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fT=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dT=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var La=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l=0,u=0,f=0,d=0,h=0,p=0,m=0,y=0,w=0,k=0,T,A,C,R,S,U=null,I;const D=new Uint16Array(fo+1),G=new Uint16Array(fo+1);let L=null,N,E,P;for(l=0;l<=fo;l++)D[l]=0;for(u=0;u<r;u++)D[e[n+u]]++;for(h=c,d=fo;d>=1&&D[d]===0;d--);if(h>d&&(h=d),d===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(f=1;f<d&&D[f]===0;f++);for(h<f&&(h=f),y=1,l=1;l<=fo;l++)if(y<<=1,y-=D[l],y<0)return-1;if(y>0&&(t===_m||d!==1))return-1;for(G[1]=0,l=1;l<fo;l++)G[l+1]=G[l]+D[l];for(u=0;u<r;u++)e[n+u]!==0&&(o[G[e[n+u]]++]=u);if(t===_m?(U=L=o,I=20):t===Gh?(U=uT,L=hT,I=257):(U=fT,L=dT,I=0),k=0,u=0,l=f,S=s,p=h,m=0,C=-1,w=1<<h,R=w-1,t===Gh&&w>mm||t===ym&&w>gm)return 1;for(;;){N=l-m,o[u]+1<I?(E=0,P=o[u]):o[u]>=I?(E=L[o[u]-I],P=U[o[u]-I]):(E=96,P=0),T=1<<l-m,A=1<<p,f=A;do A-=T,i[S+(k>>m)+A]=N<<24|E<<16|P|0;while(A!==0);for(T=1<<l-1;k&T;)T>>=1;if(T!==0?(k&=T-1,k+=T):k=0,u++,--D[l]===0){if(l===d)break;l=e[n+o[u]]}if(l>h&&(k&R)!==C){for(m===0&&(m=h),S+=f,p=l-m,y=1<<p;p+m<d&&(y-=D[p+m],!(y<=0));)p++,y<<=1;if(w+=1<<p,t===Gh&&w>mm||t===ym&&w>gm)return 1;C=k&R,i[C]=h<<24|p<<16|S-s|0}}return k!==0&&(i[S+k]=l-m<<24|64<<16|0),a.bits=h,0};const pT=0,bm=1,wm=2,{Z_FINISH:Em,Z_BLOCK:mT,Z_TREES:Jc,Z_OK:Ss,Z_STREAM_END:gT,Z_NEED_DICT:_T,Z_STREAM_ERROR:pr,Z_DATA_ERROR:xm,Z_MEM_ERROR:vm,Z_BUF_ERROR:yT,Z_DEFLATED:km}=ks,Qc=16180,Tm=16181,Am=16182,Rm=16183,Sm=16184,Om=16185,Im=16186,Nm=16187,Cm=16188,Lm=16189,tl=16190,yi=16191,Yh=16192,Mm=16193,Vh=16194,Um=16195,Fm=16196,Bm=16197,Pm=16198,el=16199,nl=16200,Dm=16201,$m=16202,jm=16203,zm=16204,Km=16205,Zh=16206,Wm=16207,Hm=16208,ve=16209,Gm=16210,Ym=16211,bT=852,wT=592,ET=15,Vm=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function xT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Os=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Qc||e.mode>Ym?1:0},Zm=t=>{if(Os(t))return pr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Qc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(bT),e.distcode=e.distdyn=new Int32Array(wT),e.sane=1,e.back=-1,Ss},Xm=t=>{if(Os(t))return pr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Zm(t)},qm=(t,e)=>{let n;if(Os(t))return pr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?pr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Xm(t))},Jm=(t,e)=>{if(!t)return pr;const n=new xT;t.state=n,n.strm=t,n.window=null,n.mode=Qc;const r=qm(t,e);return r!==Ss&&(t.state=null),r},vT=t=>Jm(t,ET);let Qm=!0,Xh,qh;const kT=t=>{if(Qm){Xh=new Int32Array(512),qh=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(La(bm,t.lens,0,288,Xh,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;La(wm,t.lens,0,32,qh,0,t.work,{bits:5}),Qm=!1}t.lencode=Xh,t.lenbits=9,t.distcode=qh,t.distbits=5},tg=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},TT=(t,e)=>{let n,r,i,s,o,a,c,l,u,f,d,h,p,m,y=0,w,k,T,A,C,R,S,U;const I=new Uint8Array(4);let D,G;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Os(t)||!t.output||!t.input&&t.avail_in!==0)return pr;n=t.state,n.mode===yi&&(n.mode=Yh),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,f=a,d=c,U=Ss;t:for(;;)switch(n.mode){case Qc:if(n.wrap===0){n.mode=Yh;break}for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,I[0]=l&255,I[1]=l>>>8&255,n.check=rn(n.check,I,2,0),l=0,u=0,n.mode=Tm;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=ve;break}if((l&15)!==km){t.msg="unknown compression method",n.mode=ve;break}if(l>>>=4,u-=4,S=(l&15)+8,n.wbits===0&&(n.wbits=S),S>15||S>n.wbits){t.msg="invalid window size",n.mode=ve;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=l&512?Lm:yi,l=0,u=0;break;case Tm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==km){t.msg="unknown compression method",n.mode=ve;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=ve;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=rn(n.check,I,2,0)),l=0,u=0,n.mode=Am;case Am:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,I[2]=l>>>16&255,I[3]=l>>>24&255,n.check=rn(n.check,I,4,0)),l=0,u=0,n.mode=Rm;case Rm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=rn(n.check,I,2,0)),l=0,u=0,n.mode=Sm;case Sm:if(n.flags&1024){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(I[0]=l&255,I[1]=l>>>8&255,n.check=rn(n.check,I,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=Om;case Om:if(n.flags&1024&&(h=n.length,h>a&&(h=a),h&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+h),S)),n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,n.length-=h),n.length))break t;n.length=0,n.mode=Im;case Im:if(n.flags&2048){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=Nm;case Nm:if(n.flags&4096){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.comment=null);n.mode=Cm;case Cm:if(n.flags&512){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=ve;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=yi;break;case Lm:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=Vm(l),l=0,u=0,n.mode=tl;case tl:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,_T;t.adler=n.check=1,n.mode=yi;case yi:if(e===mT||e===Jc)break t;case Yh:if(n.last){l>>>=u&7,u-=u&7,n.mode=Zh;break}for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}switch(n.last=l&1,l>>>=1,u-=1,l&3){case 0:n.mode=Mm;break;case 1:if(kT(n),n.mode=el,e===Jc){l>>>=2,u-=2;break t}break;case 2:n.mode=Fm;break;case 3:t.msg="invalid block type",n.mode=ve}l>>>=2,u-=2;break;case Mm:for(l>>>=u&7,u-=u&7;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=ve;break}if(n.length=l&65535,l=0,u=0,n.mode=Vh,e===Jc)break t;case Vh:n.mode=Um;case Um:if(h=n.length,h){if(h>a&&(h=a),h>c&&(h=c),h===0)break t;i.set(r.subarray(s,s+h),o),a-=h,s+=h,c-=h,o+=h,n.length-=h;break}n.mode=yi;break;case Fm:for(;u<14;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=ve;break}n.have=0,n.mode=Bm;case Bm:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.lens[L[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,D={bits:n.lenbits},U=La(pT,n.lens,0,19,n.lencode,0,n.work,D),n.lenbits=D.bits,U){t.msg="invalid code lengths set",n.mode=ve;break}n.have=0,n.mode=Pm;case Pm:for(;n.have<n.nlen+n.ndist;){for(;y=n.lencode[l&(1<<n.lenbits)-1],w=y>>>24,k=y>>>16&255,T=y&65535,!(w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(T<16)l>>>=w,u-=w,n.lens[n.have++]=T;else{if(T===16){for(G=w+2;u<G;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(l>>>=w,u-=w,n.have===0){t.msg="invalid bit length repeat",n.mode=ve;break}S=n.lens[n.have-1],h=3+(l&3),l>>>=2,u-=2}else if(T===17){for(G=w+3;u<G;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=w,u-=w,S=0,h=3+(l&7),l>>>=3,u-=3}else{for(G=w+7;u<G;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=w,u-=w,S=0,h=11+(l&127),l>>>=7,u-=7}if(n.have+h>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=ve;break}for(;h--;)n.lens[n.have++]=S}}if(n.mode===ve)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=ve;break}if(n.lenbits=9,D={bits:n.lenbits},U=La(bm,n.lens,0,n.nlen,n.lencode,0,n.work,D),n.lenbits=D.bits,U){t.msg="invalid literal/lengths set",n.mode=ve;break}if(n.distbits=6,n.distcode=n.distdyn,D={bits:n.distbits},U=La(wm,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D),n.distbits=D.bits,U){t.msg="invalid distances set",n.mode=ve;break}if(n.mode=el,e===Jc)break t;case el:n.mode=nl;case nl:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,lT(t,d),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===yi&&(n.back=-1);break}for(n.back=0;y=n.lencode[l&(1<<n.lenbits)-1],w=y>>>24,k=y>>>16&255,T=y&65535,!(w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(k&&!(k&240)){for(A=w,C=k,R=T;y=n.lencode[R+((l&(1<<A+C)-1)>>A)],w=y>>>24,k=y>>>16&255,T=y&65535,!(A+w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=w,u-=w,n.back+=w,n.length=T,k===0){n.mode=Km;break}if(k&32){n.back=-1,n.mode=yi;break}if(k&64){t.msg="invalid literal/length code",n.mode=ve;break}n.extra=k&15,n.mode=Dm;case Dm:if(n.extra){for(G=n.extra;u<G;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=$m;case $m:for(;y=n.distcode[l&(1<<n.distbits)-1],w=y>>>24,k=y>>>16&255,T=y&65535,!(w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(!(k&240)){for(A=w,C=k,R=T;y=n.distcode[R+((l&(1<<A+C)-1)>>A)],w=y>>>24,k=y>>>16&255,T=y&65535,!(A+w<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=A,u-=A,n.back+=A}if(l>>>=w,u-=w,n.back+=w,k&64){t.msg="invalid distance code",n.mode=ve;break}n.offset=T,n.extra=k&15,n.mode=jm;case jm:if(n.extra){for(G=n.extra;u<G;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=ve;break}n.mode=zm;case zm:if(c===0)break t;if(h=d-c,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=ve;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=i,p=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do i[o++]=m[p++];while(--h);n.length===0&&(n.mode=nl);break;case Km:if(c===0)break t;i[o++]=n.length,c--,n.mode=nl;break;case Zh:if(n.wrap){for(;u<32;){if(a===0)break t;a--,l|=r[s++]<<u,u+=8}if(d-=c,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?rn(n.check,i,d,o-d):ka(n.check,i,d,o-d)),d=c,n.wrap&4&&(n.flags?l:Vm(l))!==n.check){t.msg="incorrect data check",n.mode=ve;break}l=0,u=0}n.mode=Wm;case Wm:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=ve;break}l=0,u=0}n.mode=Hm;case Hm:U=gT;break t;case ve:U=xm;break t;case Gm:return vm;case Ym:default:return pr}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<ve&&(n.mode<Zh||e!==Em))&&tg(t,t.output,t.next_out,d-t.avail_out),f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?rn(n.check,i,d,t.next_out-d):ka(n.check,i,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===yi?128:0)+(n.mode===el||n.mode===Vh?256:0),(f===0&&d===0||e===Em)&&U===Ss&&(U=yT),U},AT=t=>{if(Os(t))return pr;let e=t.state;return e.window&&(e.window=null),t.state=null,Ss},RT=(t,e)=>{if(Os(t))return pr;const n=t.state;return n.wrap&2?(n.head=e,e.done=!1,Ss):pr},ST=(t,e)=>{const n=e.length;let r,i,s;return Os(t)||(r=t.state,r.wrap!==0&&r.mode!==tl)?pr:r.mode===tl&&(i=1,i=ka(i,e,n,0),i!==r.check)?xm:(s=tg(t,e,n,n),s?(r.mode=Gm,vm):(r.havedict=1,Ss))};var OT=Xm,IT=qm,NT=Zm,CT=vT,LT=Jm,MT=TT,UT=AT,FT=RT,BT=ST,PT="pako inflate (from Nodeca project)",bi={inflateReset:OT,inflateReset2:IT,inflateResetKeep:NT,inflateInit:CT,inflateInit2:LT,inflate:MT,inflateEnd:UT,inflateGetHeader:FT,inflateSetDictionary:BT,inflateInfo:PT};function DT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var $T=DT;const eg=Object.prototype.toString,{Z_NO_FLUSH:jT,Z_FINISH:zT,Z_OK:Ma,Z_STREAM_END:Jh,Z_NEED_DICT:Qh,Z_STREAM_ERROR:KT,Z_DATA_ERROR:ng,Z_MEM_ERROR:WT}=ks;function Ua(t){this.options=Zc.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dm,this.strm.avail_out=0;let n=bi.inflateInit2(this.strm,e.windowBits);if(n!==Ma)throw new Error(vs[n]);if(this.header=new $T,bi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Na.string2buf(e.dictionary):eg.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=bi.inflateSetDictionary(this.strm,e.dictionary),n!==Ma)))throw new Error(vs[n])}Ua.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?zT:jT,eg.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=bi.inflate(n,o),s===Qh&&i&&(s=bi.inflateSetDictionary(n,i),s===Ma?s=bi.inflate(n,o):s===ng&&(s=Qh));n.avail_in>0&&s===Jh&&n.state.wrap>0&&t[n.next_in]!==0;)bi.inflateReset(n),s=bi.inflate(n,o);switch(s){case KT:case ng:case Qh:case WT:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===Jh))if(this.options.to==="string"){let c=Na.utf8border(n.output,n.next_out),l=n.next_out-c,u=Na.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===Ma&&a===0)){if(s===Jh)return s=bi.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Ua.prototype.onData=function(t){this.chunks.push(t)},Ua.prototype.onEnd=function(t){t===Ma&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Zc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function tf(t,e){const n=new Ua(e);if(n.push(t),n.err)throw n.msg||vs[n.err];return n.result}function HT(t,e){return e=e||{},e.raw=!0,tf(t,e)}var GT=Ua,YT=tf,VT=HT,ZT=tf,XT=ks,qT={Inflate:GT,inflate:YT,inflateRaw:VT,ungzip:ZT,constants:XT};const{Deflate:JT,deflate:QT,deflateRaw:tA,gzip:eA}=aT,{Inflate:nA,inflate:rA,inflateRaw:iA,ungzip:sA}=qT;var oA=JT,aA=QT,cA=tA,lA=eA,uA=nA,hA=rA,fA=iA,dA=sA,pA=ks,mA={Deflate:oA,deflate:aA,deflateRaw:cA,gzip:lA,Inflate:uA,inflate:hA,inflateRaw:fA,ungzip:dA,constants:pA};function rg(t){let e=t.r.toString(16),n=t.g.toString(16),r=t.b.toString(16);return e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),e+n+r}const gA=t=>new Promise((e,n)=>{try{const r=mA.inflate(t),i=_A(r);e(i)}catch(r){n(r)}}),_A=t=>{const e=new DataView(t.buffer),n={version:e.getUint32(0,!0),layers:[]},r=e.getUint32(4,!0);let i=8;for(let s=0;s<r;s++){const o={width:0,height:0,raster:[]};o.width=e.getUint32(i,!0),i+=4,o.height=e.getUint32(i,!0),i+=4,o.raster=Array(o.height*o.width);for(let a=0;a<o.width;a++)for(let c=0;c<o.height;c++){const l={asciiCode:e.getUint32(i,!0),transparent:!1,color:{r:0,g:0,b:0,hex:""},bg:{r:0,g:0,b:0,hex:""}};i+=4,l.color.r=e.getUint8(i++),l.color.g=e.getUint8(i++),l.color.b=e.getUint8(i++),l.color.hex=rg(l.color),l.bg.r=e.getUint8(i++),l.bg.g=e.getUint8(i++),l.bg.b=e.getUint8(i++),l.bg.hex=rg(l.bg),l.transparent=l.bg.r===255&&l.bg.g===0&&l.bg.b===255,o.raster[a+o.width*c]=l}n.layers.push(o)}return n};function yA(t){return typeof t=="object"&&bt(t.session)&&bt(t.player)&&bt(t.id)&&bt(t.sender)&&bt(t.target)}function ue(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function bA(t,e,...n){return t.emit(e,"info",n),!0}function he(t,e,...n){return t.emit(e,"log",n),!0}function wA(t,e,n){t.emit(e,"toast",n)}function EA(t,e,n){t.emit(e,"bridge:streamstart",n)}function xA(t,e){t.emit(e,"bridge:streamstop",void 0)}function vA(t,e,n){t.emit(e,"bridge:chatstart",n)}function kA(t,e){t.emit(e,"bridge:chatstop")}function TA(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function AA(t,e){t.emit(e,"bridge:talkstart",e)}function RA(t,e){t.emit(e,"bridge:talkstop",e)}function SA(t,e){t.emit(e,"bridge:mediastart",e)}function OA(t,e){t.emit(e,"bridge:mediastop",e)}function IA(t,e,n){t.emit(e,"bridge:start",n)}function NA(t,e,n){t.emit(e,"bridge:tab",n)}function CA(t,e,n){t.emit(e,"gadgetclient:paint",n)}function LA(t,e,n){t.emit(e,"gadgetclient:patch",n)}function MA(t,e){t.emit(e,"gadgetserver:clearscroll")}function UA(t){t.emit("","ready")}function ig(t,e){t.emit(e,"register:loginfail")}function ef(t,e){t.emit(e,"register:loginready",!0)}function FA(t,e,n,r){t.emit(e,"register:savemem",[n,r])}function BA(t,e,n){t.emit(e,"register:forkmem",[n])}function nf(t,e,n){t.emit(e,"register:copy",n)}function PA(t,e,n,r){t.emit(e,"register:copyjsonfile",[n,r])}function sg(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function DA(t,e){t.emit(e,"register:dev",void 0)}function $A(t,e){t.emit(e,"register:share",void 0)}function jA(t,e){t.emit(e,"register:nuke",void 0)}function zA(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function KA(t,e,n){t.emit(e,"synth:tta",[n])}function WA(t,e,n,r,i){t.emit(e,"synth:play",[n,r,i])}function HA(t,e,n){t.emit(e,"synth:focus",n)}function GA(t,e,n){t.emit(e,"synth:bpm",n)}function YA(t,e,n){t.emit(e,"synth:playvolume",n)}function VA(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function ZA(t,e,n){t.emit(e,"synth:ttsvolume",n)}function rf(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function og(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function XA(t,e,n,r){t.emit(e,"register:config",[n,r])}function qA(t,e){t.emit(e,"register:configshow")}function JA(t,e){t.emit(e,"register:inspector")}function ag(t,e,n,r,i,s){t.emit(e,"register:editor:open",[n,r,i,s])}function QA(t,e){t.emit(e,"vm:local")}function cg(t,e){t.emit(e,"vm:logout")}function rl(t,e){const[n,r]=e;return`${t}:${[n,r].filter(x).join(":")}`}function tR(t,e,n){t.emit(e,"vm:cli",n)}function eR(t,e){t.emit(e,"vm:restart")}function lg(t,e){t.emit(e,"vm:flush")}function nR(t,e){t.emit(e,"vm:fork")}function rR(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function iR(t,e){return{filename:t,json:e}}function sR(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function oR(t,e){const n={filename:t,cursor:0,content:void 0};return gA(e).then(r=>{n.content=r}).catch(()=>{}),n}function Fa(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=rR(i,s);break;case"json":o=iR(i,s);break;case"binary":o=sR(i,s);break;case"rexpaint":o=oR(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}function aR(t){const e=new Set;function n(s){yA(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Vn.invoke(s))}const r=io("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Vn.disconnect(r)}return{forward:n,disconnect:i}}function cR(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=Xn(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const sf=66.666,il=Math.round(1e3/sf),lR=3;function ug(t){return new Promise(e=>setTimeout(e,t))}const of=io("clock");let af=0,sl=0,cf=0,hg=performance.now();function fg(){const t=performance.now(),e=t-hg;cf+=e,cf>=sf&&(cf%=sf,of.emit("","tick",sl),of.emit("","tock",sl),++af,++sl,af>=il&&(af%=il,of.emit("","second",sl))),hg=t,setTimeout(fg,2)}fg();function uR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dg={exports:{}},De=dg.exports={},Vr,Zr;function lf(){throw new Error("setTimeout has not been defined")}function uf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Vr=setTimeout:Vr=lf}catch{Vr=lf}try{typeof clearTimeout=="function"?Zr=clearTimeout:Zr=uf}catch{Zr=uf}})();function pg(t){if(Vr===setTimeout)return setTimeout(t,0);if((Vr===lf||!Vr)&&setTimeout)return Vr=setTimeout,setTimeout(t,0);try{return Vr(t,0)}catch{try{return Vr.call(null,t,0)}catch{return Vr.call(this,t,0)}}}function hR(t){if(Zr===clearTimeout)return clearTimeout(t);if((Zr===uf||!Zr)&&clearTimeout)return Zr=clearTimeout,clearTimeout(t);try{return Zr(t)}catch{try{return Zr.call(null,t)}catch{return Zr.call(this,t)}}}var wi=[],po=!1,Is,ol=-1;function fR(){!po||!Is||(po=!1,Is.length?wi=Is.concat(wi):ol=-1,wi.length&&mg())}function mg(){if(!po){var t=pg(fR);po=!0;for(var e=wi.length;e;){for(Is=wi,wi=[];++ol<e;)Is&&Is[ol].run();ol=-1,e=wi.length}Is=null,po=!1,hR(t)}}De.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi.push(new gg(t,e)),wi.length===1&&!po&&pg(mg)};function gg(t,e){this.fun=t,this.array=e}gg.prototype.run=function(){this.fun.apply(null,this.array)},De.title="browser",De.browser=!0,De.env={},De.argv=[],De.version="",De.versions={};function Ei(){}De.on=Ei,De.addListener=Ei,De.once=Ei,De.off=Ei,De.removeListener=Ei,De.removeAllListeners=Ei,De.emit=Ei,De.prependListener=Ei,De.prependOnceListener=Ei,De.listeners=function(t){return[]},De.binding=function(t){throw new Error("process.binding is not supported")},De.cwd=function(){return"/"},De.chdir=function(t){throw new Error("process.chdir is not supported")},De.umask=function(){return 0};var dR=dg.exports;const Ir=uR(dR);var zt={},hf=Symbol.for("react.transitional.element"),pR=Symbol.for("react.portal"),mR=Symbol.for("react.fragment"),gR=Symbol.for("react.strict_mode"),_R=Symbol.for("react.profiler"),yR=Symbol.for("react.consumer"),bR=Symbol.for("react.context"),wR=Symbol.for("react.forward_ref"),ER=Symbol.for("react.suspense"),xR=Symbol.for("react.memo"),_g=Symbol.for("react.lazy"),yg=Symbol.iterator;function vR(t){return t===null||typeof t!="object"?null:(t=yg&&t[yg]||t["@@iterator"],typeof t=="function"?t:null)}var bg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wg=Object.assign,Eg={};function mo(t,e,n){this.props=t,this.context=e,this.refs=Eg,this.updater=n||bg}mo.prototype.isReactComponent={},mo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},mo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function xg(){}xg.prototype=mo.prototype;function ff(t,e,n){this.props=t,this.context=e,this.refs=Eg,this.updater=n||bg}var df=ff.prototype=new xg;df.constructor=ff,wg(df,mo.prototype),df.isPureReactComponent=!0;var vg=Array.isArray,ke={H:null,A:null,T:null,S:null,V:null},kg=Object.prototype.hasOwnProperty;function pf(t,e,n,r,i,s){return n=s.ref,{$$typeof:hf,type:t,key:e,ref:n!==void 0?n:null,props:s}}function kR(t,e){return pf(t.type,e,void 0,void 0,void 0,t.props)}function mf(t){return typeof t=="object"&&t!==null&&t.$$typeof===hf}function TR(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Tg=/\/+/g;function gf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?TR(""+t.key):e.toString(36)}function Ag(){}function AR(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Ag,Ag):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function go(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case hf:case pR:o=!0;break;case _g:return o=t._init,go(o(t._payload),e,n,r,i)}}if(o)return i=i(t),o=r===""?"."+gf(t,0):r,vg(i)?(n="",o!=null&&(n=o.replace(Tg,"$&/")+"/"),go(i,e,n,"",function(l){return l})):i!=null&&(mf(i)&&(i=kR(i,n+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(Tg,"$&/")+"/")+o)),e.push(i)),1;o=0;var a=r===""?".":r+":";if(vg(t))for(var c=0;c<t.length;c++)r=t[c],s=a+gf(r,c),o+=go(r,e,n,s,i);else if(c=vR(t),typeof c=="function")for(t=c.call(t),c=0;!(r=t.next()).done;)r=r.value,s=a+gf(r,c++),o+=go(r,e,n,s,i);else if(s==="object"){if(typeof t.then=="function")return go(AR(t),e,n,r,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function al(t,e,n){if(t==null)return t;var r=[],i=0;return go(t,r,"","",function(s){return e.call(n,s,i++)}),r}function RR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Rg=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof Ir=="object"&&typeof Ir.emit=="function"){Ir.emit("uncaughtException",t);return}console.error(t)};function SR(){}zt.Children={map:al,forEach:function(t,e,n){al(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return al(t,function(){e++}),e},toArray:function(t){return al(t,function(e){return e})||[]},only:function(t){if(!mf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},zt.Component=mo,zt.Fragment=mR,zt.Profiler=_R,zt.PureComponent=ff,zt.StrictMode=gR,zt.Suspense=ER,zt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ke,zt.__COMPILER_RUNTIME={__proto__:null,c:function(t){return ke.H.useMemoCache(t)}},zt.cache=function(t){return function(){return t.apply(null,arguments)}},zt.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=wg({},t.props),i=t.key,s=void 0;if(e!=null)for(o in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(i=""+e.key),e)!kg.call(e,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&e.ref===void 0||(r[o]=e[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return pf(t.type,i,void 0,void 0,s,r)},zt.createContext=function(t){return t={$$typeof:bR,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:yR,_context:t},t},zt.createElement=function(t,e,n){var r,i={},s=null;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)kg.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return pf(t,s,void 0,void 0,null,i)},zt.createRef=function(){return{current:null}},zt.forwardRef=function(t){return{$$typeof:wR,render:t}},zt.isValidElement=mf,zt.lazy=function(t){return{$$typeof:_g,_payload:{_status:-1,_result:t},_init:RR}},zt.memo=function(t,e){return{$$typeof:xR,type:t,compare:e===void 0?null:e}},zt.startTransition=function(t){var e=ke.T,n={};ke.T=n;try{var r=t(),i=ke.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(SR,Rg)}catch(s){Rg(s)}finally{ke.T=e}},zt.unstable_useCacheRefresh=function(){return ke.H.useCacheRefresh()},zt.use=function(t){return ke.H.use(t)},zt.useActionState=function(t,e,n){return ke.H.useActionState(t,e,n)},zt.useCallback=function(t,e){return ke.H.useCallback(t,e)},zt.useContext=function(t){return ke.H.useContext(t)},zt.useDebugValue=function(){},zt.useDeferredValue=function(t,e){return ke.H.useDeferredValue(t,e)},zt.useEffect=function(t,e,n){var r=ke.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)},zt.useId=function(){return ke.H.useId()},zt.useImperativeHandle=function(t,e,n){return ke.H.useImperativeHandle(t,e,n)},zt.useInsertionEffect=function(t,e){return ke.H.useInsertionEffect(t,e)},zt.useLayoutEffect=function(t,e){return ke.H.useLayoutEffect(t,e)},zt.useMemo=function(t,e){return ke.H.useMemo(t,e)},zt.useOptimistic=function(t,e){return ke.H.useOptimistic(t,e)},zt.useReducer=function(t,e,n){return ke.H.useReducer(t,e,n)},zt.useRef=function(t){return ke.H.useRef(t)},zt.useState=function(t){return ke.H.useState(t)},zt.useSyncExternalStore=function(t,e,n){return ke.H.useSyncExternalStore(t,e,n)},zt.useTransition=function(){return ke.H.useTransition()},zt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Sg="0123456789abcdef",Og=[],cl=[];for(let t=0;t<256;t++)Og[t]=Sg[t>>4&15]+Sg[t&15],t<16&&(t<10?cl[48+t]=t:cl[87+t]=t);const Ig=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=Og[t[r++]];return n},ll=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=cl[t.charCodeAt(s++)]<<4|cl[t.charCodeAt(s++)];return r};for(var Ng="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",OR=typeof Uint8Array>"u"?[]:new Uint8Array(256),ul=0;ul<Ng.length;ul++)OR[Ng.charCodeAt(ul)]=ul;new TextDecoder,new TextEncoder;const Cg=typeof window<"u"?window:self,Lg=Cg.crypto||Cg.msCrypto||{};Lg.subtle||Lg.webkitSubtle;const _o=globalThis||void 0||self,Nr=()=>new Map,_f=t=>{const e=Nr();return t.forEach((n,r)=>{e.set(r,n)}),e},Zi=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},IR=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},NR=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},yo=()=>new Set,yf=t=>t[t.length-1],CR=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Ns=Array.from,LR=Array.isArray;class MR{constructor(){this._observers=Nr()}on(e,n){return Zi(this._observers,e,yo).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Ns((this._observers.get(e)||Nr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Nr()}}const Xi=Math.floor,hl=Math.abs,Mg=(t,e)=>t<e?t:e,Cs=(t,e)=>t>e?t:e,Ug=t=>t!==0?t<0:1/t<0,Fg=1,Bg=2,bf=4,wf=8,Ba=32,xi=64,Qn=128,fl=31,Ef=63,Ls=127,UR=2147483647,Pg=Number.MAX_SAFE_INTEGER,FR=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Xi(t)===t),BR=t=>t.toLowerCase(),PR=/^\s*/g,DR=t=>t.replace(PR,""),$R=/([A-Z])/g,Dg=(t,e)=>DR(t.replace($R,n=>`${e}${BR(n)}`)),jR=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},Pa=typeof TextEncoder<"u"?new TextEncoder:null,zR=Pa?t=>Pa.encode(t):jR;let Da=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Da&&Da.decode(new Uint8Array).length===1&&(Da=null);class $a{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const dl=()=>new $a,KR=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Xr=t=>{const e=new Uint8Array(KR(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},WR=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Cs(n,e)*2),t.cpos=0)},sn=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},xf=sn,te=(t,e)=>{for(;e>Ls;)sn(t,Qn|Ls&e),e=Xi(e/128);sn(t,Ls&e)},vf=(t,e)=>{const n=Ug(e);for(n&&(e=-e),sn(t,(e>Ef?Qn:0)|(n?xi:0)|Ef&e),e=Xi(e/64);e>0;)sn(t,(e>Ls?Qn:0)|Ls&e),e=Xi(e/128)},kf=new Uint8Array(3e4),HR=kf.length/3,GR=(t,e)=>{if(e.length<HR){const n=Pa.encodeInto(e,kf).written||0;te(t,n);for(let r=0;r<n;r++)sn(t,kf[r])}else tr(t,zR(e))},YR=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;te(t,r);for(let i=0;i<r;i++)sn(t,n.codePointAt(i))},bo=Pa&&Pa.encodeInto?GR:YR,pl=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Mg(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Cs(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},tr=(t,e)=>{te(t,e.byteLength),pl(t,e)},Tf=(t,e)=>{WR(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},VR=(t,e)=>Tf(t,4).setFloat32(0,e,!1),ZR=(t,e)=>Tf(t,8).setFloat64(0,e,!1),XR=(t,e)=>Tf(t,8).setBigInt64(0,e,!1),$g=new DataView(new ArrayBuffer(4)),qR=t=>($g.setFloat32(0,t),$g.getFloat32(0)===t),ja=(t,e)=>{switch(typeof e){case"string":sn(t,119),bo(t,e);break;case"number":FR(e)&&hl(e)<=UR?(sn(t,125),vf(t,e)):qR(e)?(sn(t,124),VR(t,e)):(sn(t,123),ZR(t,e));break;case"bigint":sn(t,122),XR(t,e);break;case"object":if(e===null)sn(t,126);else if(LR(e)){sn(t,117),te(t,e.length);for(let n=0;n<e.length;n++)ja(t,e[n])}else if(e instanceof Uint8Array)sn(t,116),tr(t,e);else{sn(t,118);const n=Object.keys(e);te(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];bo(t,i),ja(t,e[i])}}break;case"boolean":sn(t,e?120:121);break;default:sn(t,127)}};class jg extends $a{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&te(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const zg=t=>{t.count>0&&(vf(t.encoder,t.count===1?t.s:-t.s),t.count>1&&te(t.encoder,t.count-2))};class ml{constructor(){this.encoder=new $a,this.s=0,this.count=0}write(e){this.s===e?this.count++:(zg(this),this.count=1,this.s=e)}toUint8Array(){return zg(this),Xr(this.encoder)}}const Kg=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);vf(t.encoder,e),t.count>1&&te(t.encoder,t.count-2)}};class Af{constructor(){this.encoder=new $a,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Kg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Kg(this),Xr(this.encoder)}}class JR{constructor(){this.sarr=[],this.s="",this.lensE=new ml}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new $a;return this.sarr.push(this.s),this.s="",bo(e,this.sarr.join("")),pl(e,this.lensE.toUint8Array()),Xr(e)}}const qi=t=>new Error(t),qr=()=>{throw qi("Method unimplemented")},Jr=()=>{throw qi("Unexpected case")},Wg=qi("Unexpected end of array"),Hg=qi("Integer out of Range");class gl{constructor(e){this.arr=e,this.pos=0}}const wo=t=>new gl(t),QR=t=>t.pos!==t.arr.length,tS=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},er=t=>tS(t,Kt(t)),Eo=t=>t.arr[t.pos++],Kt=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&Ls)*n,n*=128,i<Qn)return e;if(e>Pg)throw Hg}throw Wg},Rf=t=>{let e=t.arr[t.pos++],n=e&Ef,r=64;const i=(e&xi)>0?-1:1;if(!(e&Qn))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&Ls)*r,r*=128,e<Qn)return i*n;if(n>Pg)throw Hg}throw Wg},xo=Da?t=>Da.decode(er(t)):t=>{let e=Kt(t);if(e===0)return"";{let n=String.fromCodePoint(Eo(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Eo(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Sf=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},eS=[t=>{},t=>null,Rf,t=>Sf(t,4).getFloat32(0,!1),t=>Sf(t,8).getFloat64(0,!1),t=>Sf(t,8).getBigInt64(0,!1),t=>!1,t=>!0,xo,t=>{const e=Kt(t),n={};for(let r=0;r<e;r++){const i=xo(t);n[i]=za(t)}return n},t=>{const e=Kt(t),n=[];for(let r=0;r<e;r++)n.push(za(t));return n},er],za=t=>eS[127-Eo(t)](t);class Gg extends gl{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),QR(this)?this.count=Kt(this)+1:this.count=-1),this.count--,this.s}}class _l extends gl{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Rf(this);const e=Ug(this.s);this.count=1,e&&(this.s=-this.s,this.count=Kt(this)+2)}return this.count--,this.s}}class Of extends gl{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Rf(this),n=e&1;this.diff=Xi(e/2),this.count=1,n&&(this.count=Kt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class nS{constructor(e){this.decoder=new _l(e),this.str=xo(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const rS=crypto.getRandomValues.bind(crypto),Yg=()=>rS(new Uint32Array(1))[0],iS="10000000-1000-4000-8000"+-1e11,sS=()=>iS.replace(/[018]/g,t=>(t^Yg()&15>>t/4).toString(16)),Vg=t=>new Promise(t);Promise.all.bind(Promise);var Zg={},yl={};yl.byteLength=cS,yl.toByteArray=uS,yl.fromByteArray=dS;for(var Qr=[],mr=[],oS=typeof Uint8Array<"u"?Uint8Array:Array,If="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vo=0,aS=If.length;vo<aS;++vo)Qr[vo]=If[vo],mr[If.charCodeAt(vo)]=vo;mr[45]=62,mr[95]=63;function Xg(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function cS(t){var e=Xg(t),n=e[0],r=e[1];return(n+r)*3/4-r}function lS(t,e,n){return(e+n)*3/4-n}function uS(t){var e,n=Xg(t),r=n[0],i=n[1],s=new oS(lS(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=mr[t.charCodeAt(c)]<<18|mr[t.charCodeAt(c+1)]<<12|mr[t.charCodeAt(c+2)]<<6|mr[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=mr[t.charCodeAt(c)]<<2|mr[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=mr[t.charCodeAt(c)]<<10|mr[t.charCodeAt(c+1)]<<4|mr[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function hS(t){return Qr[t>>18&63]+Qr[t>>12&63]+Qr[t>>6&63]+Qr[t&63]}function fS(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(hS(r));return i.join("")}function dS(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(fS(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Qr[e>>2]+Qr[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Qr[e>>10]+Qr[e>>4&63]+Qr[e<<2&63]+"=")),i.join("")}var Nf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Nf.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=t[e+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Nf.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=d/c:e+=d*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=a&255,h+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+h]=o&255,h+=p,o/=256,l-=8);t[n+h-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=yl,n=Nf,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=C,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const O=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(O,g),O.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(O){if(O>i)throw new RangeError('The value "'+O+'" is invalid for option "size"');const g=new s(O);return Object.setPrototypeOf(g,u.prototype),g}function u(O,g,_){if(typeof O=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(O)}return f(O,g,_)}u.poolSize=8192;function f(O,g,_){if(typeof O=="string")return m(O,g);if(o.isView(O))return w(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(dt(O,o)||O&&dt(O.buffer,o)||typeof a<"u"&&(dt(O,a)||O&&dt(O.buffer,a)))return k(O,g,_);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=O.valueOf&&O.valueOf();if(M!=null&&M!==O)return u.from(M,g,_);const j=T(O);if(j)return j;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return u.from(O[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}u.from=function(O,g,_){return f(O,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function h(O,g,_){return d(O),O<=0?l(O):g!==void 0?typeof _=="string"?l(O).fill(g,_):l(O).fill(g):l(O)}u.alloc=function(O,g,_){return h(O,g,_)};function p(O){return d(O),l(O<0?0:A(O)|0)}u.allocUnsafe=function(O){return p(O)},u.allocUnsafeSlow=function(O){return p(O)};function m(O,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=R(O,g)|0;let M=l(_);const j=M.write(O,g);return j!==_&&(M=M.slice(0,j)),M}function y(O){const g=O.length<0?0:A(O.length)|0,_=l(g);for(let M=0;M<g;M+=1)_[M]=O[M]&255;return _}function w(O){if(dt(O,s)){const g=new s(O);return k(g.buffer,g.byteOffset,g.byteLength)}return y(O)}function k(O,g,_){if(g<0||O.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&_===void 0?M=new s(O):_===void 0?M=new s(O,g):M=new s(O,g,_),Object.setPrototypeOf(M,u.prototype),M}function T(O){if(u.isBuffer(O)){const g=A(O.length)|0,_=l(g);return _.length===0||O.copy(_,0,0,g),_}if(O.length!==void 0)return typeof O.length!="number"||Tt(O.length)?l(0):y(O);if(O.type==="Buffer"&&Array.isArray(O.data))return y(O.data)}function A(O){if(O>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return O|0}function C(O){return+O!=O&&(O=0),u.alloc(+O)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),dt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let M=g.length,j=_.length;for(let Q=0,it=Math.min(M,j);Q<it;++Q)if(g[Q]!==_[Q]){M=g[Q],j=_[Q];break}return M<j?-1:j<M?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let M;if(_===void 0)for(_=0,M=0;M<g.length;++M)_+=g[M].length;const j=u.allocUnsafe(_);let Q=0;for(M=0;M<g.length;++M){let it=g[M];if(dt(it,s))Q+it.length>j.length?(u.isBuffer(it)||(it=u.from(it)),it.copy(j,Q)):s.prototype.set.call(j,it,Q);else if(u.isBuffer(it))it.copy(j,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return j};function R(O,g){if(u.isBuffer(O))return O.length;if(o.isView(O)||dt(O,o))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);const _=O.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&_===0)return 0;let j=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return at(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return mt(O).length;default:if(j)return M?-1:at(O).length;g=(""+g).toLowerCase(),j=!0}}u.byteLength=R;function S(O,g,_){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(O||(O="utf8");;)switch(O){case"hex":return Y(this,g,_);case"utf8":case"utf-8":return $(this,g,_);case"ascii":return ut(this,g,_);case"latin1":case"binary":return V(this,g,_);case"base64":return q(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xt(this,g,_);default:if(M)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),M=!0}}u.prototype._isBuffer=!0;function U(O,g,_){const M=O[g];O[g]=O[_],O[_]=M}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)U(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)U(this,_,_+3),U(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)U(this,_,_+7),U(this,_+1,_+6),U(this,_+2,_+5),U(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?$(this,0,g):S.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=t.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,M,j,Q){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),M===void 0&&(M=g?g.length:0),j===void 0&&(j=0),Q===void 0&&(Q=this.length),_<0||M>g.length||j<0||Q>this.length)throw new RangeError("out of range index");if(j>=Q&&_>=M)return 0;if(j>=Q)return-1;if(_>=M)return 1;if(_>>>=0,M>>>=0,j>>>=0,Q>>>=0,this===g)return 0;let it=Q-j,jt=M-_;const Se=Math.min(it,jt),we=this.slice(j,Q),Oe=g.slice(_,M);for(let ce=0;ce<Se;++ce)if(we[ce]!==Oe[ce]){it=we[ce],jt=Oe[ce];break}return it<jt?-1:jt<it?1:0};function I(O,g,_,M,j){if(O.length===0)return-1;if(typeof _=="string"?(M=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,Tt(_)&&(_=j?0:O.length-1),_<0&&(_=O.length+_),_>=O.length){if(j)return-1;_=O.length-1}else if(_<0)if(j)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,M)),u.isBuffer(g))return g.length===0?-1:D(O,g,_,M,j);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?j?s.prototype.indexOf.call(O,g,_):s.prototype.lastIndexOf.call(O,g,_):D(O,[g],_,M,j);throw new TypeError("val must be string, number or Buffer")}function D(O,g,_,M,j){let Q=1,it=O.length,jt=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(O.length<2||g.length<2)return-1;Q=2,it/=2,jt/=2,_/=2}function Se(Oe,ce){return Q===1?Oe[ce]:Oe.readUInt16BE(ce*Q)}let we;if(j){let Oe=-1;for(we=_;we<it;we++)if(Se(O,we)===Se(g,Oe===-1?0:we-Oe)){if(Oe===-1&&(Oe=we),we-Oe+1===jt)return Oe*Q}else Oe!==-1&&(we-=we-Oe),Oe=-1}else for(_+jt>it&&(_=it-jt),we=_;we>=0;we--){let Oe=!0;for(let ce=0;ce<jt;ce++)if(Se(O,we+ce)!==Se(g,ce)){Oe=!1;break}if(Oe)return we}return-1}u.prototype.includes=function(g,_,M){return this.indexOf(g,_,M)!==-1},u.prototype.indexOf=function(g,_,M){return I(this,g,_,M,!0)},u.prototype.lastIndexOf=function(g,_,M){return I(this,g,_,M,!1)};function G(O,g,_,M){_=Number(_)||0;const j=O.length-_;M?(M=Number(M),M>j&&(M=j)):M=j;const Q=g.length;M>Q/2&&(M=Q/2);let it;for(it=0;it<M;++it){const jt=parseInt(g.substr(it*2,2),16);if(Tt(jt))return it;O[_+it]=jt}return it}function L(O,g,_,M){return wt(at(g,O.length-_),O,_,M)}function N(O,g,_,M){return wt(ft(g),O,_,M)}function E(O,g,_,M){return wt(mt(g),O,_,M)}function P(O,g,_,M){return wt(J(g,O.length-_),O,_,M)}u.prototype.write=function(g,_,M,j){if(_===void 0)j="utf8",M=this.length,_=0;else if(M===void 0&&typeof _=="string")j=_,M=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(M)?(M=M>>>0,j===void 0&&(j="utf8")):(j=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-_;if((M===void 0||M>Q)&&(M=Q),g.length>0&&(M<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");j||(j="utf8");let it=!1;for(;;)switch(j){case"hex":return G(this,g,_,M);case"utf8":case"utf-8":return L(this,g,_,M);case"ascii":case"latin1":case"binary":return N(this,g,_,M);case"base64":return E(this,g,_,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,g,_,M);default:if(it)throw new TypeError("Unknown encoding: "+j);j=(""+j).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function q(O,g,_){return g===0&&_===O.length?e.fromByteArray(O):e.fromByteArray(O.slice(g,_))}function $(O,g,_){_=Math.min(O.length,_);const M=[];let j=g;for(;j<_;){const Q=O[j];let it=null,jt=Q>239?4:Q>223?3:Q>191?2:1;if(j+jt<=_){let Se,we,Oe,ce;switch(jt){case 1:Q<128&&(it=Q);break;case 2:Se=O[j+1],(Se&192)===128&&(ce=(Q&31)<<6|Se&63,ce>127&&(it=ce));break;case 3:Se=O[j+1],we=O[j+2],(Se&192)===128&&(we&192)===128&&(ce=(Q&15)<<12|(Se&63)<<6|we&63,ce>2047&&(ce<55296||ce>57343)&&(it=ce));break;case 4:Se=O[j+1],we=O[j+2],Oe=O[j+3],(Se&192)===128&&(we&192)===128&&(Oe&192)===128&&(ce=(Q&15)<<18|(Se&63)<<12|(we&63)<<6|Oe&63,ce>65535&&ce<1114112&&(it=ce))}}it===null?(it=65533,jt=1):it>65535&&(it-=65536,M.push(it>>>10&1023|55296),it=56320|it&1023),M.push(it),j+=jt}return nt(M)}const st=4096;function nt(O){const g=O.length;if(g<=st)return String.fromCharCode.apply(String,O);let _="",M=0;for(;M<g;)_+=String.fromCharCode.apply(String,O.slice(M,M+=st));return _}function ut(O,g,_){let M="";_=Math.min(O.length,_);for(let j=g;j<_;++j)M+=String.fromCharCode(O[j]&127);return M}function V(O,g,_){let M="";_=Math.min(O.length,_);for(let j=g;j<_;++j)M+=String.fromCharCode(O[j]);return M}function Y(O,g,_){const M=O.length;(!g||g<0)&&(g=0),(!_||_<0||_>M)&&(_=M);let j="";for(let Q=g;Q<_;++Q)j+=le[O[Q]];return j}function xt(O,g,_){const M=O.slice(g,_);let j="";for(let Q=0;Q<M.length-1;Q+=2)j+=String.fromCharCode(M[Q]+M[Q+1]*256);return j}u.prototype.slice=function(g,_){const M=this.length;g=~~g,_=_===void 0?M:~~_,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),_<0?(_+=M,_<0&&(_=0)):_>M&&(_=M),_<g&&(_=g);const j=this.subarray(g,_);return Object.setPrototypeOf(j,u.prototype),j};function ct(O,g,_){if(O%1!==0||O<0)throw new RangeError("offset is not uint");if(O+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||ct(g,_,this.length);let j=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)j+=this[g+it]*Q;return j},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||ct(g,_,this.length);let j=this[g+--_],Q=1;for(;_>0&&(Q*=256);)j+=this[g+--_]*Q;return j},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||ct(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||ct(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||ct(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Bt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&B(g,this.length-8);const j=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(j)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=Bt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&B(g,this.length-8);const j=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(j)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||ct(g,_,this.length);let j=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)j+=this[g+it]*Q;return Q*=128,j>=Q&&(j-=Math.pow(2,8*_)),j},u.prototype.readIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||ct(g,_,this.length);let j=_,Q=1,it=this[g+--j];for(;j>0&&(Q*=256);)it+=this[g+--j]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*_)),it},u.prototype.readInt8=function(g,_){return g=g>>>0,_||ct(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||ct(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||ct(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Bt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&B(g,this.length-8);const j=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(j)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Bt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&B(g,this.length-8);const j=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(j)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||ct(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||ct(g,8,this.length),n.read(this,g,!1,52,8)};function ht(O,g,_,M,j,Q){if(!u.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>j||g<Q)throw new RangeError('"value" argument is out of bounds');if(_+M>O.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,M,j){if(g=+g,_=_>>>0,M=M>>>0,!j){const jt=Math.pow(2,8*M)-1;ht(this,g,_,M,jt,0)}let Q=1,it=0;for(this[_]=g&255;++it<M&&(Q*=256);)this[_+it]=g/Q&255;return _+M},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,M,j){if(g=+g,_=_>>>0,M=M>>>0,!j){const jt=Math.pow(2,8*M)-1;ht(this,g,_,M,jt,0)}let Q=M-1,it=1;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)this[_+Q]=g/it&255;return _+M},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function Dt(O,g,_,M,j){ot(g,M,j,O,_,7);let Q=Number(g&BigInt(4294967295));O[_++]=Q,Q=Q>>8,O[_++]=Q,Q=Q>>8,O[_++]=Q,Q=Q>>8,O[_++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[_++]=it,it=it>>8,O[_++]=it,it=it>>8,O[_++]=it,it=it>>8,O[_++]=it,_}function re(O,g,_,M,j){ot(g,M,j,O,_,7);let Q=Number(g&BigInt(4294967295));O[_+7]=Q,Q=Q>>8,O[_+6]=Q,Q=Q>>8,O[_+5]=Q,Q=Q>>8,O[_+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[_+3]=it,it=it>>8,O[_+2]=it,it=it>>8,O[_+1]=it,it=it>>8,O[_]=it,_+8}u.prototype.writeBigUInt64LE=Bt(function(g,_=0){return Dt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Bt(function(g,_=0){return re(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,M,j){if(g=+g,_=_>>>0,!j){const Se=Math.pow(2,8*M-1);ht(this,g,_,M,Se-1,-Se)}let Q=0,it=1,jt=0;for(this[_]=g&255;++Q<M&&(it*=256);)g<0&&jt===0&&this[_+Q-1]!==0&&(jt=1),this[_+Q]=(g/it>>0)-jt&255;return _+M},u.prototype.writeIntBE=function(g,_,M,j){if(g=+g,_=_>>>0,!j){const Se=Math.pow(2,8*M-1);ht(this,g,_,M,Se-1,-Se)}let Q=M-1,it=1,jt=0;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)g<0&&jt===0&&this[_+Q+1]!==0&&(jt=1),this[_+Q]=(g/it>>0)-jt&255;return _+M},u.prototype.writeInt8=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||ht(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=Bt(function(g,_=0){return Dt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Bt(function(g,_=0){return re(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ft(O,g,_,M,j,Q){if(_+M>O.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function Mt(O,g,_,M,j){return g=+g,_=_>>>0,j||Ft(O,g,_,4),n.write(O,g,_,M,23,4),_+4}u.prototype.writeFloatLE=function(g,_,M){return Mt(this,g,_,!0,M)},u.prototype.writeFloatBE=function(g,_,M){return Mt(this,g,_,!1,M)};function oe(O,g,_,M,j){return g=+g,_=_>>>0,j||Ft(O,g,_,8),n.write(O,g,_,M,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,M){return oe(this,g,_,!0,M)},u.prototype.writeDoubleBE=function(g,_,M){return oe(this,g,_,!1,M)},u.prototype.copy=function(g,_,M,j){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!j&&j!==0&&(j=this.length),_>=g.length&&(_=g.length),_||(_=0),j>0&&j<M&&(j=M),j===M||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(j<0)throw new RangeError("sourceEnd out of bounds");j>this.length&&(j=this.length),g.length-_<j-M&&(j=g.length-_+M);const Q=j-M;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,M,j):s.prototype.set.call(g,this.subarray(M,j),_),Q},u.prototype.fill=function(g,_,M,j){if(typeof g=="string"){if(typeof _=="string"?(j=_,_=0,M=this.length):typeof M=="string"&&(j=M,M=this.length),j!==void 0&&typeof j!="string")throw new TypeError("encoding must be a string");if(typeof j=="string"&&!u.isEncoding(j))throw new TypeError("Unknown encoding: "+j);if(g.length===1){const it=g.charCodeAt(0);(j==="utf8"&&it<128||j==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<M)throw new RangeError("Out of range index");if(M<=_)return this;_=_>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=_;Q<M;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,j),jt=it.length;if(jt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<M-_;++Q)this[Q+_]=it[Q%jt]}return this};const Ht={};function Re(O,g,_){Ht[O]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${O}]`,this.stack,delete this.name}get code(){return O}set code(j){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:j,writable:!0})}toString(){return`${this.name} [${O}]: ${this.message}`}}}Re("ERR_BUFFER_OUT_OF_BOUNDS",function(O){return O?`${O} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Re("ERR_INVALID_ARG_TYPE",function(O,g){return`The "${O}" argument must be of type number. Received type ${typeof g}`},TypeError),Re("ERR_OUT_OF_RANGE",function(O,g,_){let M=`The value of "${O}" is out of range.`,j=_;return Number.isInteger(_)&&Math.abs(_)>2**32?j=Be(String(_)):typeof _=="bigint"&&(j=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(j=Be(j)),j+="n"),M+=` It must be ${g}. Received ${j}`,M},RangeError);function Be(O){let g="",_=O.length;const M=O[0]==="-"?1:0;for(;_>=M+4;_-=3)g=`_${O.slice(_-3,_)}${g}`;return`${O.slice(0,_)}${g}`}function v(O,g,_){et(g,"offset"),(O[g]===void 0||O[g+_]===void 0)&&B(g,O.length-(_+1))}function ot(O,g,_,M,j,Q){if(O>_||O<g){const it=typeof g=="bigint"?"n":"";let jt;throw g===0||g===BigInt(0)?jt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:jt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Ht.ERR_OUT_OF_RANGE("value",jt,O)}v(M,j,Q)}function et(O,g){if(typeof O!="number")throw new Ht.ERR_INVALID_ARG_TYPE(g,"number",O)}function B(O,g,_){throw Math.floor(O)!==O?(et(O,_),new Ht.ERR_OUT_OF_RANGE("offset","an integer",O)):g<0?new Ht.ERR_BUFFER_OUT_OF_BOUNDS:new Ht.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,O)}const F=/[^+/0-9A-Za-z-_]/g;function H(O){if(O=O.split("=")[0],O=O.trim().replace(F,""),O.length<2)return"";for(;O.length%4!==0;)O=O+"=";return O}function at(O,g){g=g||1/0;let _;const M=O.length;let j=null;const Q=[];for(let it=0;it<M;++it){if(_=O.charCodeAt(it),_>55295&&_<57344){if(!j){if(_>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===M){(g-=3)>-1&&Q.push(239,191,189);continue}j=_;continue}if(_<56320){(g-=3)>-1&&Q.push(239,191,189),j=_;continue}_=(j-55296<<10|_-56320)+65536}else j&&(g-=3)>-1&&Q.push(239,191,189);if(j=null,_<128){if((g-=1)<0)break;Q.push(_)}else if(_<2048){if((g-=2)<0)break;Q.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;Q.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;Q.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return Q}function ft(O){const g=[];for(let _=0;_<O.length;++_)g.push(O.charCodeAt(_)&255);return g}function J(O,g){let _,M,j;const Q=[];for(let it=0;it<O.length&&!((g-=2)<0);++it)_=O.charCodeAt(it),M=_>>8,j=_%256,Q.push(j),Q.push(M);return Q}function mt(O){return e.toByteArray(H(O))}function wt(O,g,_,M){let j;for(j=0;j<M&&!(j+_>=g.length||j>=O.length);++j)g[j+_]=O[j];return j}function dt(O,g){return O instanceof g||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===g.name}function Tt(O){return O!==O}const le=function(){const O="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const M=_*16;for(let j=0;j<16;++j)g[M+j]=O[_]+O[j]}return g}();function Bt(O){return typeof BigInt>"u"?Yn:O}function Yn(){throw new Error("BigInt not supported")}})(Zg);const dn=Zg.Buffer,qg=t=>t===void 0?null:t;class pS{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Jg=new pS,mS=!0;try{typeof localStorage<"u"&&localStorage&&(Jg=localStorage,mS=!1)}catch{}const gS=Jg,_S=Object.assign,yS=Object.keys,bS=(t,e)=>{for(const n in t)e(t[n],n)},Qg=t=>yS(t).length,wS=t=>{for(const e in t)return!1;return!0},ES=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},xS=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),vS=(t,e)=>t===e||Qg(t)===Qg(e)&&ES(t,(n,r)=>(n!==void 0||xS(e,r))&&e[r]===n),kS=Object.freeze,t_=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&t_(t[e])}return kS(t)},Cf=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Cf(t,e,n+1)}},TS=t=>t,AS=(t,e)=>e.includes(t);var e_={};const Ka=typeof Ir<"u"&&Ir.release&&/node|io\.js/.test(Ir.release.name)&&Object.prototype.toString.call(typeof Ir<"u"?Ir:0)==="[object process]";let ti;const RS=()=>{if(ti===void 0)if(Ka){ti=Nr();const t=Ir.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&ti.set(e,""),e=r):e!==null&&(ti.set(e,r),e=null)}e!==null&&ti.set(e,"")}else typeof location=="object"?(ti=Nr(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");ti.set(`--${Dg(e,"-")}`,n),ti.set(`-${Dg(e,"-")}`,n)}})):ti=Nr();return ti},Lf=t=>RS().has(t),bl=t=>qg(Ka?e_[t.toUpperCase().replaceAll("-","_")]:gS.getItem(t)),n_=t=>Lf("--"+t)||bl(t)!==null;n_("production");const SS=Ka&&AS(e_.FORCE_COLOR,["true","1","2"])||!Lf("--no-colors")&&!n_("no-color")&&(!Ka||Ir.stdout.isTTY)&&(!Ka||Lf("--color")||bl("COLORTERM")!==null||(bl("TERM")||"").includes("color")),OS=t=>new Uint8Array(t),IS=t=>{const e=OS(t.byteLength);return e.set(t),e};class NS{constructor(e,n){this.left=e,this.right=n}}const vi=(t,e)=>new NS(t,e);typeof DOMParser<"u"&&new DOMParser;const CS=t=>IR(t,(e,n)=>`${n}:${e};`).join(""),ki=Symbol,r_=ki(),i_=ki(),LS=ki(),MS=ki(),US=ki(),s_=ki(),FS=ki(),Mf=ki(),BS=ki(),PS=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},DS={[r_]:vi("font-weight","bold"),[i_]:vi("font-weight","normal"),[LS]:vi("color","blue"),[US]:vi("color","green"),[MS]:vi("color","grey"),[s_]:vi("color","red"),[FS]:vi("color","purple"),[Mf]:vi("color","orange"),[BS]:vi("color","black")},o_=SS?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Nr();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=DS[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=CS(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:PS,$S=(...t)=>{console.log(...o_(t)),a_.forEach(e=>e.print(t))},jS=(...t)=>{console.warn(...o_(t)),t.unshift(Mf),a_.forEach(e=>e.print(t))},a_=yo(),c_=t=>({[Symbol.iterator](){return this},next:t}),zS=(t,e)=>c_(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Uf=(t,e)=>c_(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Ff{constructor(e,n){this.clock=e,this.len=n}}class Wa{constructor(){this.clients=new Map}}const l_=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];T_(t,s,a.clock,a.len,n)}}),KS=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Xi((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},u_=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&KS(n,e.clock)!==null},Bf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=Cs(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},WS=t=>{const e=new Wa;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)CR(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return Bf(e),e},wl=(t,e,n,r)=>{Zi(t.clients,e,()=>[]).push(new Ff(n,r))},HS=()=>new Wa,GS=t=>{const e=HS();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Ff(a,c))}}i.length>0&&e.clients.set(r,i)}),e},ko=(t,e)=>{te(t.restEncoder,e.clients.size),Ns(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),te(t.restEncoder,n);const i=r.length;te(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},Pf=t=>{const e=new Wa,n=Kt(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Kt(t.restDecoder),s=Kt(t.restDecoder);if(s>0){const o=Zi(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Ff(t.readDsClock(),t.readDsLen()))}}return e},h_=(t,e,n)=>{const r=new Wa,i=Kt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Kt(t.restDecoder),a=Kt(t.restDecoder),c=n.clients.get(o)||[],l=on(n,o);for(let u=0;u<a;u++){const f=t.readDsClock(),d=f+t.readDsLen();if(f<l){l<d&&wl(r,o,l,d-l);let h=ei(c,f),p=c[h];for(!p.deleted&&p.id.clock<f&&(c.splice(h+1,0,Ml(e,p,f-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(h,0,Ml(e,p,d-p.id.clock)),p.delete(e))}else wl(r,o,f,d-f)}}if(r.clients.size>0){const s=new Ms;return te(s.restEncoder,0),ko(s,r),s.toUint8Array()}return null},f_=Yg;class To extends MR{constructor({guid:e=sS(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=f_(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new x_,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Vg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Vg(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&fe(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ns(this.subdocs).map(e=>e.guid))}transact(e,n=null){return fe(this,e,n)}get(e,n=pn){const r=Zi(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==pn&&i!==n)if(i===pn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Oo)}getText(e=""){return this.get(e,Ti)}getMap(e=""){return this.get(e,Io)}getXmlElement(e=""){return this.get(e,Co)}getXmlFragment(e=""){return this.get(e,Us)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Ns(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new To({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,fe(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class d_{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Kt(this.restDecoder)}readDsLen(){return Kt(this.restDecoder)}}class p_ extends d_{readLeftID(){return Zt(Kt(this.restDecoder),Kt(this.restDecoder))}readRightID(){return Zt(Kt(this.restDecoder),Kt(this.restDecoder))}readClient(){return Kt(this.restDecoder)}readInfo(){return Eo(this.restDecoder)}readString(){return xo(this.restDecoder)}readParentInfo(){return Kt(this.restDecoder)===1}readTypeRef(){return Kt(this.restDecoder)}readLen(){return Kt(this.restDecoder)}readAny(){return za(this.restDecoder)}readBuf(){return IS(er(this.restDecoder))}readJSON(){return JSON.parse(xo(this.restDecoder))}readKey(){return xo(this.restDecoder)}}class YS{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Kt(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Kt(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Ao extends YS{constructor(e){super(e),this.keys=[],Kt(e),this.keyClockDecoder=new Of(er(e)),this.clientDecoder=new _l(er(e)),this.leftClockDecoder=new Of(er(e)),this.rightClockDecoder=new Of(er(e)),this.infoDecoder=new Gg(er(e),Eo),this.stringDecoder=new nS(er(e)),this.parentInfoDecoder=new Gg(er(e),Eo),this.typeRefDecoder=new _l(er(e)),this.lenDecoder=new _l(er(e))}readLeftID(){return new Ro(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ro(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return za(this.restDecoder)}readBuf(){return er(this.restDecoder)}readJSON(){return za(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class VS{constructor(){this.restEncoder=dl()}toUint8Array(){return Xr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){te(this.restEncoder,e)}writeDsLen(e){te(this.restEncoder,e)}}class Ha extends VS{writeLeftID(e){te(this.restEncoder,e.client),te(this.restEncoder,e.clock)}writeRightID(e){te(this.restEncoder,e.client),te(this.restEncoder,e.clock)}writeClient(e){te(this.restEncoder,e)}writeInfo(e){xf(this.restEncoder,e)}writeString(e){bo(this.restEncoder,e)}writeParentInfo(e){te(this.restEncoder,e?1:0)}writeTypeRef(e){te(this.restEncoder,e)}writeLen(e){te(this.restEncoder,e)}writeAny(e){ja(this.restEncoder,e)}writeBuf(e){tr(this.restEncoder,e)}writeJSON(e){bo(this.restEncoder,JSON.stringify(e))}writeKey(e){bo(this.restEncoder,e)}}class ZS{constructor(){this.restEncoder=dl(),this.dsCurrVal=0}toUint8Array(){return Xr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,te(this.restEncoder,n)}writeDsLen(e){e===0&&Jr(),te(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ms extends ZS{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Af,this.clientEncoder=new ml,this.leftClockEncoder=new Af,this.rightClockEncoder=new Af,this.infoEncoder=new jg(xf),this.stringEncoder=new JR,this.parentInfoEncoder=new jg(xf),this.typeRefEncoder=new ml,this.lenEncoder=new ml}toUint8Array(){const e=dl();return te(e,0),tr(e,this.keyClockEncoder.toUint8Array()),tr(e,this.clientEncoder.toUint8Array()),tr(e,this.leftClockEncoder.toUint8Array()),tr(e,this.rightClockEncoder.toUint8Array()),tr(e,Xr(this.infoEncoder)),tr(e,this.stringEncoder.toUint8Array()),tr(e,Xr(this.parentInfoEncoder)),tr(e,this.typeRefEncoder.toUint8Array()),tr(e,this.lenEncoder.toUint8Array()),pl(e,Xr(this.restEncoder)),Xr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ja(this.restEncoder,e)}writeBuf(e){tr(this.restEncoder,e)}writeJSON(e){ja(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const XS=(t,e,n,r)=>{r=Cs(r,e[0].id.clock);const i=ei(e,r);te(t.restEncoder,e.length-i),t.writeClient(n),te(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Df=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{on(e,s)>i&&r.set(s,i)}),jf(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),te(t.restEncoder,r.size),Ns(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{XS(t,e.clients.get(i),i,s)})},qS=(t,e)=>{const n=Nr(),r=Kt(t.restDecoder);for(let i=0;i<r;i++){const s=Kt(t.restDecoder),o=new Array(s),a=t.readClient();let c=Kt(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(fl&u){case 0:{const f=t.readLen();o[l]=new gr(Zt(a,c),f),c+=f;break}case 10:{const f=Kt(t.restDecoder);o[l]=new _r(Zt(a,c),f),c+=f;break}default:{const f=(u&(xi|Qn))===0,d=new Ze(Zt(a,c),null,(u&Qn)===Qn?t.readLeftID():null,null,(u&xi)===xi?t.readRightID():null,f?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,f&&(u&Ba)===Ba?t.readString():null,X_(t,u));o[l]=d,c+=d.length}}}}return n},JS=(t,e,n)=>{const r=[];let i=Ns(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new x_,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(y=>y!==p)}r.length=0};for(;;){if(u.constructor!==_r){const p=Zi(f,u.id.client,()=>on(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const y=n.get(m)||{refs:[],i:0};if(y.refs.length===y.i)l(m,on(e,m)),d();else{u=y.refs[y.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new Ms;return Df(h,a,new Map),te(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},QS=(t,e)=>Df(t,e.doc.store,e.beforeState),tO=(t,e,n,r=new Ao(t))=>fe(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=qS(r,o),l=JS(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<on(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const p=u.missing.get(d);(p==null||p>h)&&u.missing.set(d,h)}u.update=vl([u.update,l.update])}}else a.pendingStructs=l;const f=h_(r,i,a);if(a.pendingDs){const d=new Ao(wo(a.pendingDs));Kt(d.restDecoder);const h=h_(d,i,a);f&&h?a.pendingDs=vl([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,m_(i.doc,d)}},n,!1),m_=(t,e,n,r=Ao)=>{const i=wo(e);tO(i,t,n,new r(i))},g_=(t,e,n)=>m_(t,e,n,p_),eO=(t,e,n=new Map)=>{Df(t,e.store,n),ko(t,GS(e.store))},nO=(t,e=new Uint8Array([0]),n=new Ms)=>{const r=__(e);eO(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(pO(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Ha)return fO(i.map((s,o)=>o===0?s:gO(s)));if(n.constructor===Ms)return vl(i)}return i[0]},rO=(t,e)=>nO(t,e,new Ha),iO=t=>{const e=new Map,n=Kt(t.restDecoder);for(let r=0;r<n;r++){const i=Kt(t.restDecoder),s=Kt(t.restDecoder);e.set(i,s)}return e},__=t=>iO(new d_(wo(t)));class sO{constructor(){this.l=[]}}const y_=()=>new sO,b_=(t,e)=>t.l.push(e),w_=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},E_=(t,e,n)=>Cf(t.l,[e,n]);class Ro{constructor(e,n){this.client=e,this.clock=n}}const El=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Zt=(t,e)=>new Ro(t,e),oO=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Jr()},So=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!u_(e.ds,t.id),$f=(t,e)=>{const n=Zi(t.meta,$f,yo),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<on(r,s)&&Ji(t,Zt(s,i))}),l_(t,e.ds,i=>{}),n.add(e))};class x_{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const jf=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},on=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},v_=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Jr()}n.push(e)},ei=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Xi(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Xi((n+r)/2)}throw Jr()},zf=(t,e)=>{const n=t.clients.get(e.client);return n[ei(n,e.clock)]},Kf=(t,e,n)=>{const r=ei(e,n),i=e[r];return i.id.clock<n&&i instanceof Ze?(e.splice(r+1,0,Ml(t,i,n-i.id.clock)),r+1):r},Ji=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Kf(t,n,e.clock)]},k_=(t,e,n)=>{const r=e.clients.get(n.client),i=ei(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==gr&&r.splice(i+1,0,Ml(t,s,n.clock-s.id.clock+1)),s},aO=(t,e,n)=>{const r=t.clients.get(e.id.client);r[ei(r,e.id.clock)]=n},T_=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=Kf(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&Kf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class cO{constructor(e,n,r){this.doc=e,this.deleteSet=new Wa,this.beforeState=jf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const A_=(t,e)=>e.deleteSet.clients.size===0&&!NR(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Bf(e.deleteSet),QS(t,e),ko(t,e.deleteSet),!0),R_=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Zi(t.changed,e,yo).add(n)},xl=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},lO=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ei(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Ze&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},uO=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Mg(i.length-1,1+ei(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+xl(i,c)}})},S_=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Bf(s),n.afterState=jf(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),E_(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Cf(a,[]),n._needFormattingCleanup&&IO(n)}finally{r.gc&&lO(s,i,r.gcFilter),uO(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=Cs(ei(h,d),1);for(let m=h.length-1;m>=p;)m-=1+xl(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=ei(h,d);p+1<h.length&&xl(h,p+1)>1||p>0&&xl(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&($S(Mf,r_,"[yjs] ",i_,s_,"Changed the client-id because another client seems to be using it."),r.clientID=f_()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ha;A_(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Ms;A_(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):S_(t,e+1)}}},fe=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new cO(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&S_(i,0)}}return o};function*hO(t){const e=Kt(t.restDecoder);for(let n=0;n<e;n++){const r=Kt(t.restDecoder),i=t.readClient();let s=Kt(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Kt(t.restDecoder);yield new _r(Zt(i,s),c),s+=c}else if(fl&a){const c=(a&(xi|Qn))===0,l=new Ze(Zt(i,s),null,(a&Qn)===Qn?t.readLeftID():null,null,(a&xi)===xi?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Ba)===Ba?t.readString():null,X_(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new gr(Zt(i,s),c),s+=c}}}}class Wf{constructor(e,n){this.gen=hO(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===_r);return this.curr}}class Hf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const fO=t=>vl(t,p_,Ha),dO=(t,e)=>{if(t.constructor===gr){const{client:n,clock:r}=t.id;return new gr(Zt(n,r+e),t.length-e)}else if(t.constructor===_r){const{client:n,clock:r}=t.id;return new _r(Zt(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Ze(Zt(r,i+e),null,Zt(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},vl=(t,e=Ao,n=Ms)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(wo(u)));let i=r.map(u=>new Wf(u,!0)),s=null;const o=new n,a=new Hf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const p=d.curr.id.clock-h.curr.id.clock;return p===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===_r?1:-1:p}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Qi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===_r)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Qi(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new _r(Zt(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===_r?s.struct.length-=p:d=dO(d,p)),s.struct.mergeWith(d)||(Qi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==_r;d=u.next())Qi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Qi(a,s.struct,s.offset),s=null),Gf(a);const c=r.map(u=>Pf(u)),l=WS(c);return ko(o,l),o.toUint8Array()},pO=(t,e,n=Ao,r=Ms)=>{const i=__(e),s=new r,o=new Hf(s),a=new n(wo(t)),c=new Wf(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===_r){c.next();continue}if(u.id.clock+u.length>d)for(Qi(o,u,Cs(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Qi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}Gf(o);const l=Pf(a);return ko(s,l),s.toUint8Array()},O_=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Xr(t.encoder.restEncoder)}),t.encoder.restEncoder=dl(),t.written=0)},Qi=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&O_(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),te(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Gf=t=>{O_(t);const e=t.encoder.restEncoder;te(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];te(e,r.written),pl(e,r.restEncoder)}},mO=(t,e,n,r)=>{const i=new n(wo(t)),s=new Wf(i,!1),o=new r,a=new Hf(o);for(let l=s.curr;l!==null;l=s.next())Qi(a,e(l),0);Gf(a);const c=Pf(i);return ko(o,c),o.toUint8Array()},gO=t=>mO(t,TS,Ao,Ha),I_="You must not compute changes after the event-handler fired.";class kl{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=_O(this.currentTarget,this.target))}deletes(e){return u_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw qi(I_);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=yf(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=yf(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=yf(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw qi(I_);const n=this.target,r=yo(),i=yo(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const _O=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},yn=()=>{jS("Invalid access: Add Yjs type to a document before reading data.")},N_=80;let Yf=0;class yO{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Yf++}}const bO=t=>{t.timestamp=Yf++},C_=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Yf++},wO=(t,e,n)=>{if(t.length>=N_){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return C_(r,e,n),r}else{const r=new yO(e,n);return t.push(r),r}},Tl=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>hl(e-s.index)<hl(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,bO(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&hl(n.index-i)<r.parent.length/N_?(C_(n,r,i),n):wO(t._searchMarker,r,i)},Ga=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=Cs(e,i.index+n))}},Al=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Zi(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;E_(r._eH,n,e)};class pn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=y_(),this._dEH=y_(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw qr()}clone(){throw qr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){b_(this._eH,e)}observeDeep(e){b_(this._dEH,e)}unobserve(e){w_(this._eH,e)}unobserveDeep(e){w_(this._dEH,e)}toJSON(){}}const L_=(t,e,n)=>{t.doc??yn(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},M_=t=>{t.doc??yn();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Ya=(t,e)=>{let n=0,r=t._start;for(t.doc??yn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},U_=(t,e)=>{const n=[];return Ya(t,(r,i)=>{n.push(e(r,i,t))}),n},EO=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},F_=(t,e)=>{t.doc??yn();const n=Tl(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Rl=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ze(Zt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Bs(l)),i.integrate(t,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Ze(Zt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Va(new Uint8Array(f))),i.integrate(t,0);break;case To:i=new Ze(Zt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Xa(f)),i.integrate(t,0);break;default:if(f instanceof pn)i=new Ze(Zt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ai(f)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},B_=()=>qi("Length exceeded!"),P_=(t,e,n,r)=>{if(n>e._length)throw B_();if(n===0)return e._searchMarker&&Ga(e._searchMarker,n,r.length),Rl(t,e,null,r);const i=n,s=Tl(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ji(t,Zt(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Ga(e._searchMarker,i,r.length),Rl(t,e,o,r)},xO=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Rl(t,e,i,n)},D_=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Tl(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ji(t,Zt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ji(t,Zt(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw B_();e._searchMarker&&Ga(e._searchMarker,i,-s+r)},Sl=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Vf=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new Bs([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Bs([r]);break;case Uint8Array:a=new Va(r);break;case To:a=new Xa(r);break;default:if(r instanceof pn)a=new Ai(r);else throw new Error("Unexpected content type")}new Ze(Zt(o,on(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Zf=(t,e)=>{t.doc??yn();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},$_=t=>{const e={};return t.doc??yn(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},j_=(t,e)=>{t.doc??yn();const n=t._map.get(e);return n!==void 0&&!n.deleted},vO=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&So(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Ol=t=>(t.doc??yn(),zS(t._map.entries(),e=>!e[1].deleted));class kO extends kl{}class Oo extends pn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Oo;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Oo}clone(){const e=new Oo;return e.insert(0,this.toArray().map(n=>n instanceof pn?n.clone():n)),e}get length(){return this.doc??yn(),this._length}_callObserver(e,n){super._callObserver(e,n),Al(this,e,new kO(this,e))}insert(e,n){this.doc!==null?fe(this.doc,r=>{P_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?fe(this.doc,n=>{xO(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?fe(this.doc,r=>{D_(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return F_(this,e)}toArray(){return M_(this)}slice(e=0,n=this.length){return L_(this,e,n)}toJSON(){return this.map(e=>e instanceof pn?e.toJSON():e)}map(e){return U_(this,e)}forEach(e){Ya(this,e)}[Symbol.iterator](){return EO(this)}_write(e){e.writeTypeRef(ZO)}}const TO=t=>new Oo;class AO extends kl{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Io extends pn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Io}clone(){const e=new Io;return this.forEach((n,r)=>{e.set(r,n instanceof pn?n.clone():n)}),e}_callObserver(e,n){Al(this,e,new AO(this,e,n))}toJSON(){this.doc??yn();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof pn?i.toJSON():i}}),e}get size(){return[...Ol(this)].length}keys(){return Uf(Ol(this),e=>e[0])}values(){return Uf(Ol(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Uf(Ol(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??yn(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?fe(this.doc,n=>{Sl(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?fe(this.doc,r=>{Vf(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Zf(this,e)}has(e){return j_(this,e)}clear(){this.doc!==null?fe(this.doc,e=>{this.forEach(function(n,r,i){Sl(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(XO)}}const RO=t=>new Io,ts=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&vS(t,e);class Xf{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Jr(),this.right.content.constructor){case Ve:this.right.deleted||No(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const z_=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Ve:e.right.deleted||No(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Ji(t,Zt(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Il=(t,e,n,r)=>{const i=new Map,s=r?Tl(e,n):null;if(s){const o=new Xf(s.p.left,s.p,s.index,i);return z_(t,o,n-s.index)}else{const o=new Xf(null,e._start,0,i);return z_(t,o,n)}},K_=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ve&&ts(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ze(Zt(s,on(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Ve(a,o));u.integrate(t,0),n.right=u,n.forward()})},No=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},W_=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ve&&ts(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},H_=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!ts(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Ze(Zt(s,on(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Ve(a,c)),n.right.integrate(t,0),n.forward()}}return o},qf=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;W_(n,i);const a=H_(t,e,n,i),c=r.constructor===String?new ni(r):r instanceof pn?new Ai(r):new Fs(r);let{left:l,right:u,index:f}=n;e._searchMarker&&Ga(e._searchMarker,n.index,c.getLength()),u=new Ze(Zt(o,on(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=f,n.forward(),K_(t,e,n,a)},G_=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;W_(n,i);const a=H_(t,e,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ve));){if(!n.right.deleted)switch(n.right.content.constructor){case Ve:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(ts(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Ji(t,Zt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ze(Zt(o,on(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new ni(c)),n.right.integrate(t,0),n.forward()}K_(t,e,n,a)},Y_=(t,e,n,r,i)=>{let s=e;const o=Nr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ve){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Ve:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(e.delete(t),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&No(i,l);break}}}e=e.right}return a},SO=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ve){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},OO=t=>{let e=0;return fe(t.doc,n=>{let r=t._start,i=t._start,s=Nr();const o=_f(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ve:No(o,i.content);break;default:e+=Y_(n,r,i,s,o),s=_f(o),r=i;break}i=i.right}}),e},IO=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&T_(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ve&&o.constructor!==gr&&e.add(o.parent)})}fe(n,r=>{l_(t,t.deleteSet,i=>{if(i instanceof gr||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Ve?e.add(s):SO(r,i)});for(const i of e)OO(i)})},V_=(t,e,n)=>{const r=n,i=_f(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ai:case Fs:case ni:n<e.right.length&&Ji(t,Zt(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Y_(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Ga(o._searchMarker,e.index,-r+n),e};class NO extends kl{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];fe(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},wS(c)||(h.attributes=_S({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case Ai:case Fs:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ni:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Ve:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;ts(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),ts(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;ts(m,p)||(a==="retain"&&d(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(ts(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&d(),No(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ti extends pn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??yn(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ti}clone(){const e=new Ti;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new NO(this,e,n);Al(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??yn();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ni&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?fe(this.doc,r=>{const i=new Xf(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&qf(r,this,i,a,o.attributes||{})}else o.retain!==void 0?G_(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&V_(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??yn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(So(c,e)||n!==void 0&&So(c,n))switch(c.content.constructor){case ni:{const f=s.get("ychange");e!==void 0&&!So(c,e)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!So(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Ai:case Fs:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Ve:So(c,e)&&(l(),No(s,c.content));break}c=c.right}l()};return e||n?fe(o,f=>{e&&$f(f,e),n&&$f(f,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?fe(i,s=>{const o=Il(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),qf(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?fe(i,s=>{const o=Il(s,this,e,!r);qf(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?fe(r,i=>{V_(i,Il(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?fe(i,s=>{const o=Il(s,this,e,!1);o.right!==null&&G_(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?fe(this.doc,n=>{Sl(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?fe(this.doc,r=>{Vf(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Zf(this,e)}getAttributes(){return $_(this)}_write(e){e.writeTypeRef(qO)}}const CO=t=>new Ti;class Jf{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??yn()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Co||n.constructor===Us)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Us extends pn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Us}clone(){const e=new Us;return e.insert(0,this.toArray().map(n=>n instanceof pn?n.clone():n)),e}get length(){return this.doc??yn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Jf(this,e)}querySelector(e){e=e.toUpperCase();const r=new Jf(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Ns(new Jf(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Al(this,e,new UO(this,n,e))}toString(){return U_(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ya(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?fe(this.doc,r=>{P_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)fe(this.doc,r=>{const i=e&&e instanceof pn?e._item:e;Rl(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw qi("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?fe(this.doc,r=>{D_(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return M_(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return F_(this,e)}slice(e=0,n=this.length){return L_(this,e,n)}forEach(e){Ya(this,e)}_write(e){e.writeTypeRef(QO)}}const LO=t=>new Us;class Co extends Us{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Co(this.nodeName)}clone(){const e=new Co(this.nodeName),n=this.getAttributes();return bS(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof pn?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?fe(this.doc,n=>{Sl(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?fe(this.doc,r=>{Vf(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Zf(this,e)}hasAttribute(e){return j_(this,e)}getAttributes(e){return e?vO(this,e):$_(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ya(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(JO),e.writeKey(this.nodeName)}}const MO=t=>new Co(t.readKey());class UO extends kl{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Nl extends Io{constructor(e){super(),this.hookName=e}_copy(){return new Nl(this.hookName)}clone(){const e=new Nl(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(tI),e.writeKey(this.hookName)}}const FO=t=>new Nl(t.readKey());class Cl extends Ti{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Cl}clone(){const e=new Cl;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(eI)}}const BO=t=>new Cl;class Qf{constructor(e,n){this.id=e,this.length=n}get deleted(){throw qr()}mergeWith(e){return!1}write(e,n,r){throw qr()}integrate(e,n){throw qr()}}const PO=0;class gr extends Qf{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),v_(e.doc.store,this)}write(e,n){e.writeInfo(PO),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Va{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Va(this.content)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const DO=t=>new Va(t.readBuf());class Za{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Za(this.len)}splice(e){const n=new Za(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){wl(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const $O=t=>new Za(t.readLen()),Z_=(t,e)=>new To({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Xa{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Xa(Z_(this.doc.guid,this.opts))}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const jO=t=>new Xa(Z_(t.readString(),t.readAny()));class Fs{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Fs(this.embed)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const zO=t=>new Fs(t.readJSON());class Ve{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ve(this.key,this.value)}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const KO=t=>new Ve(t.readKey(),t.readJSON());class Ll{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ll(this.arr)}splice(e){const n=new Ll(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const WO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Ll(n)},HO=bl("node_env")==="development";class Bs{constructor(e){this.arr=e,HO&&t_(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Bs(this.arr)}splice(e){const n=new Bs(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const GO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Bs(n)};class ni{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ni(this.str)}splice(e){const n=new ni(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const YO=t=>new ni(t.readString()),VO=[TO,RO,CO,MO,LO,FO,BO],ZO=0,XO=1,qO=2,JO=3,QO=4,tI=5,eI=6;class Ai{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ai(this.type._copy())}splice(e){throw qr()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const nI=t=>new Ai(VO[t.readTypeRef()](t)),Ml=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Ze(Zt(r,i+n),e,Zt(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Zt(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Ze extends Qf{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Bg:0}set marker(e){(this.info&wf)>0!==e&&(this.info^=wf)}get marker(){return(this.info&wf)>0}get keep(){return(this.info&Fg)>0}set keep(e){this.keep!==e&&(this.info^=Fg)}get countable(){return(this.info&Bg)>0}get deleted(){return(this.info&bf)>0}set deleted(e){this.deleted!==e&&(this.info^=bf)}markDeleted(){this.info|=bf}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=on(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=on(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ro&&this.id.client!==this.parent.client&&this.parent.clock>=on(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=k_(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ji(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===gr||this.right&&this.right.constructor===gr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ro){const r=zf(n,this.parent);r.constructor===gr?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=k_(e,e.doc.store,Zt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),El(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(El(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(zf(e.doc.store,i.origin)))s.has(zf(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),v_(e.doc.store,this),this.content.integrate(e,this),R_(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new gr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Zt(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&El(e.origin,this.lastId)&&this.right===e&&El(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),wl(e.deleteSet,this.id.client,this.id.clock,this.length),R_(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Jr();this.content.gc(e),n?aO(e,this,new gr(this.id,this.length)):this.content=new Za(this.length)}write(e,n){const r=n>0?Zt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&fl|(r===null?0:Qn)|(i===null?0:xi)|(s===null?0:Ba);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=oO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Ro?(e.writeParentInfo(!1),e.writeLeftID(a)):Jr();s!==null&&e.writeString(s)}this.content.write(e,n)}}const X_=(t,e)=>rI[e&fl](t),rI=[()=>{Jr()},$O,WO,DO,YO,zO,KO,nI,GO,jO,()=>{Jr()}],iI=10;class _r extends Qf{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Jr()}write(e,n){e.writeInfo(iI),te(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const q_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof _o<"u"?_o:{},J_="__ $YJS$ __";q_[J_]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),q_[J_]=!0;let Q_=!1;const nr=new To;function ty(t,e,n){const r=nr.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function sI(t,e){ty(t,0,e)}function td(t,e){const n=new Ti(e);ty(t,1,n)}function oI(t,e){nr.getMap().set(t,e)}function aI(t,e){const n=nr.getMap(),r=new Ti(e);n.set(t,r)}function ey(t,e){const n=nr.getMap();function r(i){const s=n.get(t);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function cI(t,e){return ey(t,n=>{At(n)&&e(n)})}function ny(t,e){return ey(t,n=>{n instanceof Ti&&e(n.toJSON())})}const Ps=io("modem",["second"],t=>{if(Ps.session(t))switch(t.target){case"second":!Q_&&t.data%2===0&&Ps.emit(t.player,"modem:join");break;case"join":t.sender!==Ps.id()&&Ps.reply(t,"joinack",Ig(rO(nr)));break;case"joinack":t.sender!==Ps.id()&&(Q_=!0,g_(nr,ll(t.data),nr));break;case"sync":{t.sender!==Ps.id()&&x(t.data)&&g_(nr,ll(t.data),nr);break}}});function ry(t,e){e!==nr&&Ps.emit("","modem:sync",Ig(t))}nr.on("update",ry),nr.on("destroy",()=>{nr.off("update",ry)});function lI(t,e){return t%e}function uI(t,e){return Math.floor(t/e)}function hI(t,e){return{x:lI(t,e),y:uI(t,e)}}function Lo(t,e){return t.x+t.y*e}function Mo(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function iy(t,e,n,r){const i=[],s=Math.min(t,n),o=Math.max(t,n),a=Math.min(e,r),c=Math.max(e,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function sy(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const oy="176",fI="",Cr="srgb",ay="srgb-linear",cy="linear",ed="srgb";function Lr(t,e,n){return Math.max(e,Math.min(n,t))}function dI(t,e){return(t%e+e)%e}function nd(t,e,n){return(1-n)*t+n*e}class qa{constructor(e=0,n=0){qa.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Lr(this.x,e.x,n.x),this.y=Lr(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Lr(this.x,e,n),this.y=Lr(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Lr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Lr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ja{constructor(e,n,r,i,s,o,a,c,l){Ja.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],p=r[8],m=i[0],y=i[3],w=i[6],k=i[1],T=i[4],A=i[7],C=i[2],R=i[5],S=i[8];return s[0]=o*m+a*k+c*C,s[3]=o*y+a*T+c*R,s[6]=o*w+a*A+c*S,s[1]=l*m+u*k+f*C,s[4]=l*y+u*T+f*R,s[7]=l*w+u*A+f*S,s[2]=d*m+h*k+p*C,s[5]=d*y+h*T+p*R,s[8]=d*w+h*A+p*S,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,p=n*f+r*d+i*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=f*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=h*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(rd.makeScale(e,n)),this}rotate(e){return this.premultiply(rd.makeRotation(-e)),this}translate(e,n){return this.premultiply(rd.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const rd=new Ja,ly=new Ja().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),uy=new Ja().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function pI(){const t={enabled:!0,workingColorSpace:ay,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===ed&&(i.r=Uo(i.r),i.g=Uo(i.g),i.b=Uo(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===ed&&(i.r=Fo(i.r),i.g=Fo(i.g),i.b=Fo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===fI?cy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[ay]:{primaries:e,whitePoint:r,transfer:cy,toXYZ:ly,fromXYZ:uy,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Cr},outputColorSpaceConfig:{drawingBufferColorSpace:Cr}},[Cr]:{primaries:e,whitePoint:r,transfer:ed,toXYZ:ly,fromXYZ:uy,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Cr}}}),t}const Mr=pI();function Uo(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Fo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const hy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},es={h:0,s:0,l:0},Ul={h:0,s:0,l:0};function id(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class sd{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Cr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Mr.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Mr.workingColorSpace){return this.r=e,this.g=n,this.b=r,Mr.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Mr.workingColorSpace){if(e=dI(e,1),n=Lr(n,0,1),r=Lr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=id(o,s,e+1/3),this.g=id(o,s,e),this.b=id(o,s,e-1/3)}return Mr.toWorkingColorSpace(this,i),this}setStyle(e,n=Cr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Cr){const r=hy[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Uo(e.r),this.g=Uo(e.g),this.b=Uo(e.b),this}copyLinearToSRGB(e){return this.r=Fo(e.r),this.g=Fo(e.g),this.b=Fo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Cr){return Mr.fromWorkingColorSpace(bn.copy(this),e),Math.round(Lr(bn.r*255,0,255))*65536+Math.round(Lr(bn.g*255,0,255))*256+Math.round(Lr(bn.b*255,0,255))}getHexString(e=Cr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Mr.workingColorSpace){Mr.fromWorkingColorSpace(bn.copy(this),n);const r=bn.r,i=bn.g,s=bn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Mr.workingColorSpace){return Mr.fromWorkingColorSpace(bn.copy(this),n),e.r=bn.r,e.g=bn.g,e.b=bn.b,e}getStyle(e=Cr){Mr.fromWorkingColorSpace(bn.copy(this),e);const n=bn.r,r=bn.g,i=bn.b;return e!==Cr?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(es),this.setHSL(es.h+e,es.s+n,es.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(es),e.getHSL(Ul);const r=nd(es.h,Ul.h,n),i=nd(es.s,Ul.s,n),s=nd(es.l,Ul.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const bn=new sd;sd.NAMES=hy,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:oy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=oy),new qa,new qa;function Xe(t,e,n){return Math.max(e,Math.min(n,t))}function fy(t){return t/180*Math.PI}function od(t){return t*180/Math.PI}const mI=kp("089fad0j9awfem09wavefc09uwaef");function gI(){return mI()}function _I(t){return kp(t)()}function yr(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(gI()*i)}function dy(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(_I(t)*s)}function py(t,e,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function yI(t){return t[yr(0,t.length-1)]}function bI(t,e){return e[dy(t,0,e.length-1)]}function Te(...t){return yI(t.flat())}function my(t,...e){return bI(t,e.flat())}function wI(t){return[...new Set(t)].filter(x)}function Bo(t){return x(t)&&x(t.x)&&x(t.y)}function ze(t,e){switch(e){case pt.NORTH:--t.y;break;case pt.SOUTH:++t.y;break;case pt.WEST:--t.x;break;case pt.EAST:++t.x;break}return t}function EI(t,e){return t<0?pt.WEST:t>0?pt.EAST:e<0?pt.NORTH:e>0?pt.SOUTH:pt.IDLE}function Ri(t,e){return EI(e.x-t.x,e.y-t.y)}const ad={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Si(t){return ae(t)&&gy(t[0])}function gy(t){return x(pt[t])&&bt(t)}function xI(t){const e=pt[t];return x(e)?e:pt.IDLE}function cd(t){if(bt(t))return ad[It(t)]}function vI(t){if(Si(t))return t;if(gy(t))return[t];const e=cd(t);if(x(e))return[e]}function _y(t){const e=b.words[t],n=vI(e);return Si(n)?[n,t+1]:[void 0,t]}function yy(t){var i,s;const e=[];let[n,r]=_y(t);for(;Si(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(b.words,r,[z.NUMBER,z.NUMBER]);e.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(b.words,r,[z.DIR]);e.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=rt(b.words,r,[z.DIR,z.DIR]),f=((i=b.element)==null?void 0:i.x)??0,d=((s=b.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,e.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[e,r]}const[o,a]=_y(r);n=o,r=a}return e.length?[e,r]:[void 0,t]}function kI(t){return x(t)&&t<Rt.ONBLACK?t:void 0}function TI(t){return x(t)&&t>Rt.WHITE&&t<Rt.ONCLEAR?t-Rt.ONBLACK:void 0}const Qa={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function ri(t){return ae(t)&&wy(t[0])}function by(t){return ri(t)&&t[0].startsWith("ON")}function wy(t){return x(Rt[t])&&bt(t)}function ld(t){if(bt(t))return Qa[It(t)]}function AI(t){return t.map(e=>Rt[e]).find(e=>x(e)&&e<Rt.ONBLACK)}function RI(t){return t.map(e=>Rt[e]).find(e=>x(e)&&e>=Rt.ONBLACK)}function SI(t){if(ri(t))return t;if(wy(t))return[t];const e=ld(t);if(x(e))return[e]}function Ey(t){const e=b.words[t],n=SI(e);return ri(n)?[n,t+1]:[void 0,t]}function ud(t){const e=[];let n=t;const[r,i]=Ey(t);if(ri(r)&&(e.push(...r),n=i),ri(e)&&!by(e)){const[s,o]=Ey(i);by(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function xy(t){const e={};return t.every(n=>{const r=Rt[n];x(r)&&(r<Rt.ONBLACK?e.color=r:e.bg=r-Rt.ONBLACK)}),e}function Po(t){return ae(t)&&typeof t[0]=="string"}function OI(t){const e=b.words[t];return bt(e)?[e,t+1]:[void 0,t]}function vy(t){const e=b.words[t];if(Po(e))return[e,t+1];const[n,r]=ud(t),[i,s]=OI(r);return bt(i)?[[i,n],s]:[void 0,t]}function hd(t){if(!Po(t))return;const[e]=t;return e}function ky(t){if(!Po(t))return;const[,e]=t,n=x(e)?AI(e):void 0;return x(n)?n:void 0}function Ty(t){if(!Po(t))return;const[,e]=t,n=x(e)?RI(e):void 0;return x(n)?n:void 0}var fd;try{fd=new TextDecoder}catch{}var gt,br,K=0,de={},Xt,ns,wr=0,ii=0,an,Oi,Un=[],Gt,Ay={useRecords:!1,mapsAsObjects:!0};class Ry{}const Sy=new Ry;Sy.name="MessagePack 0xC1";var rs=!1,Oy=2,Iy;try{new Function("")}catch{Oy=1/0}class tc{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(gt)return Ky(()=>(_d(),this?this.unpack(e,n):tc.prototype.unpack.call(Ay,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof dn<"u"?dn.from(e):new Uint8Array(e)),typeof n=="object"?(br=n.end||e.length,K=n.start||0):(K=0,br=n>-1?n:e.length),ii=0,ns=null,an=null,gt=e;try{Gt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw gt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof tc){if(de=this,this.structures)return Xt=this.structures,Fl(n);(!Xt||Xt.length>0)&&(Xt=[])}else de=Ay,(!Xt||Xt.length>0)&&(Xt=[]);return Fl(n)}unpackMultiple(e,n){let r,i=0;try{rs=!0;let s=e.length,o=this?this.unpack(e,s):Bl.unpack(e,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Fl(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Fl());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{rs=!1,_d()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Fl(t){try{if(!de.trusted&&!rs){let n=Xt.sharedLength||0;n<Xt.length&&(Xt.length=n)}let e;if(de.randomAccessStructure&&gt[K]<64&&gt[K]>=32&&Iy?(e=Iy(gt,K,br,de),gt=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),K=br):e=$e(),an&&(K=an.postBundlePosition,an=null),rs&&(Xt.restoreStructures=null),K==br)Xt&&Xt.restoreStructures&&Ny(),Xt=null,gt=null,Oi&&(Oi=null);else{if(K>br)throw new Error("Unexpected end of MessagePack data");if(!rs){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Xt&&Xt.restoreStructures&&Ny(),_d(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||K>br)&&(e.incomplete=!0),e}}function Ny(){for(let t in Xt.restoreStructures)Xt[t]=Xt.restoreStructures[t];Xt.restoreStructures=null}function $e(){let t=gt[K++];if(t<160)if(t<128){if(t<64)return t;{let e=Xt[t&63]||de.getStructures&&Ly()[t&63];return e?(e.read||(e.read=dd(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,de.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Dy();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return de.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(ii>=K)return ns.slice(K-wr,(K+=e)-wr);if(ii==0&&br<140){let n=e<16?md(e):Fy(e);if(n!=null)return n}return pd(e)}else{let e;switch(t){case 192:return null;case 193:return an?(e=$e(),e>0?an[1].slice(an.position1,an.position1+=e):an[0].slice(an.position0,an.position0-=e)):Sy;case 194:return!1;case 195:return!0;case 196:if(e=gt[K++],e===void 0)throw new Error("Unexpected end of buffer");return gd(e);case 197:return e=Gt.getUint16(K),K+=2,gd(e);case 198:return e=Gt.getUint32(K),K+=4,gd(e);case 199:return Ds(gt[K++]);case 200:return e=Gt.getUint16(K),K+=2,Ds(e);case 201:return e=Gt.getUint32(K),K+=4,Ds(e);case 202:if(e=Gt.getFloat32(K),de.useFloat32>2){let n=yd[(gt[K]&127)<<1|gt[K+1]>>7];return K+=4,(n*e+(e>0?.5:-.5)>>0)/n}return K+=4,e;case 203:return e=Gt.getFloat64(K),K+=8,e;case 204:return gt[K++];case 205:return e=Gt.getUint16(K),K+=2,e;case 206:return e=Gt.getUint32(K),K+=4,e;case 207:return de.int64AsType==="number"?(e=Gt.getUint32(K)*4294967296,e+=Gt.getUint32(K+4)):de.int64AsType==="string"?e=Gt.getBigUint64(K).toString():de.int64AsType==="auto"?(e=Gt.getBigUint64(K),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Gt.getBigUint64(K),K+=8,e;case 208:return Gt.getInt8(K++);case 209:return e=Gt.getInt16(K),K+=2,e;case 210:return e=Gt.getInt32(K),K+=4,e;case 211:return de.int64AsType==="number"?(e=Gt.getInt32(K)*4294967296,e+=Gt.getUint32(K+4)):de.int64AsType==="string"?e=Gt.getBigInt64(K).toString():de.int64AsType==="auto"?(e=Gt.getBigInt64(K),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Gt.getBigInt64(K),K+=8,e;case 212:if(e=gt[K++],e==114)return jy(gt[K++]&63);{let n=Un[e];if(n)return n.read?(K++,n.read($e())):n.noBuffer?(K++,n()):n(gt.subarray(K,++K));throw new Error("Unknown extension "+e)}case 213:return e=gt[K],e==114?(K++,jy(gt[K++]&63,gt[K++])):Ds(2);case 214:return Ds(4);case 215:return Ds(8);case 216:return Ds(16);case 217:return e=gt[K++],ii>=K?ns.slice(K-wr,(K+=e)-wr):NI(e);case 218:return e=Gt.getUint16(K),K+=2,ii>=K?ns.slice(K-wr,(K+=e)-wr):CI(e);case 219:return e=Gt.getUint32(K),K+=4,ii>=K?ns.slice(K-wr,(K+=e)-wr):LI(e);case 220:return e=Gt.getUint16(K),K+=2,My(e);case 221:return e=Gt.getUint32(K),K+=4,My(e);case 222:return e=Gt.getUint16(K),K+=2,Uy(e);case 223:return e=Gt.getUint32(K),K+=4,Uy(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const II=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function dd(t,e){function n(){if(n.count++>Oy){let i=t.read=new Function("r","return function(){return "+(de.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":II.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")($e);return t.highByte===0&&(t.read=Cy(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=$e()}return de.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?Cy(e,n):n}const Cy=(t,e)=>function(){let n=gt[K++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Xt[r]||Ly()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=dd(i,t)),i.read()};function Ly(){let t=Ky(()=>(gt=null,de.getStructures()));return Xt=de._mergeStructures(t,Xt)}var pd=ec,NI=ec,CI=ec,LI=ec;function ec(t){let e;if(t<16&&(e=md(t)))return e;if(t>64&&fd)return fd.decode(gt.subarray(K,K+=t));const n=K+t,r=[];for(e="";K<n;){const i=gt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gt[K++]&63,o=gt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=gt[K++]&63,o=gt[K++]&63,a=gt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=cn.apply(String,r),r.length=0)}return r.length>0&&(e+=cn.apply(String,r)),e}function My(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return de.freezeData?Object.freeze(e):e}function Uy(t){if(de.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Dy();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}}var cn=String.fromCharCode;function Fy(t){let e=K,n=new Array(t);for(let r=0;r<t;r++){const i=gt[K++];if((i&128)>0){K=e;return}n[r]=i}return cn.apply(String,n)}function md(t){if(t<4)if(t<2){if(t===0)return"";{let e=gt[K++];if((e&128)>1){K-=1;return}return cn(e)}}else{let e=gt[K++],n=gt[K++];if((e&128)>0||(n&128)>0){K-=2;return}if(t<3)return cn(e,n);let r=gt[K++];if((r&128)>0){K-=3;return}return cn(e,n,r)}else{let e=gt[K++],n=gt[K++],r=gt[K++],i=gt[K++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(t<6){if(t===4)return cn(e,n,r,i);{let s=gt[K++];if((s&128)>0){K-=5;return}return cn(e,n,r,i,s)}}else if(t<8){let s=gt[K++],o=gt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(t<7)return cn(e,n,r,i,s,o);let a=gt[K++];if((a&128)>0){K-=7;return}return cn(e,n,r,i,s,o,a)}else{let s=gt[K++],o=gt[K++],a=gt[K++],c=gt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(t<10){if(t===8)return cn(e,n,r,i,s,o,a,c);{let l=gt[K++];if((l&128)>0){K-=9;return}return cn(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=gt[K++],u=gt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(t<11)return cn(e,n,r,i,s,o,a,c,l,u);let f=gt[K++];if((f&128)>0){K-=11;return}return cn(e,n,r,i,s,o,a,c,l,u,f)}else{let l=gt[K++],u=gt[K++],f=gt[K++],d=gt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(t<14){if(t===12)return cn(e,n,r,i,s,o,a,c,l,u,f,d);{let h=gt[K++];if((h&128)>0){K-=13;return}return cn(e,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=gt[K++],p=gt[K++];if((h&128)>0||(p&128)>0){K-=14;return}if(t<15)return cn(e,n,r,i,s,o,a,c,l,u,f,d,h,p);let m=gt[K++];if((m&128)>0){K-=15;return}return cn(e,n,r,i,s,o,a,c,l,u,f,d,h,p,m)}}}}}function By(){let t=gt[K++],e;if(t<192)e=t-160;else switch(t){case 217:e=gt[K++];break;case 218:e=Gt.getUint16(K),K+=2;break;case 219:e=Gt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return ec(e)}function gd(t){return de.copyBuffers?Uint8Array.prototype.slice.call(gt,K,K+=t):gt.subarray(K,K+=t)}function Ds(t){let e=gt[K++];if(Un[e]){let n;return Un[e](gt.subarray(K,n=K+=t),r=>{K=r;try{return $e()}finally{K=n}})}else throw new Error("Unknown extension type "+e)}var Py=new Array(4096);function Dy(){let t=gt[K++];if(t>=160&&t<192){if(t=t-160,ii>=K)return ns.slice(K-wr,(K+=t)-wr);if(!(ii==0&&br<180))return pd(t)}else return K--,$y($e());let e=(t<<5^(t>1?Gt.getUint16(K):t>0?gt[K]:0))&4095,n=Py[e],r=K,i=K+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Gt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],Py[e]=n,n.bytes=t;r<i;)s=Gt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gt[r++],n.push(s);let a=t<16?md(t):Fy(t);return a!=null?n.string=a:n.string=pd(t)}function $y(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const jy=(t,e)=>{let n=$e().map($y),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Xt[t];return i&&(i.isShared||rs)&&((Xt.restoreStructures||(Xt.restoreStructures=[]))[t]=i),Xt[t]=n,n.read=dd(n,r),n.read()};Un[0]=()=>{},Un[0].noBuffer=!0,Un[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let MI={Error,TypeError,ReferenceError};Un[101]=()=>{let t=$e();return(MI[t[0]]||Error)(t[1],{cause:t[2]})},Un[105]=t=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Gt.getUint32(K-4);Oi||(Oi=new Map);let n=gt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Oi.set(e,i);let s=$e();return i.used?Object.assign(r,s):(i.target=s,s)},Un[112]=t=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Gt.getUint32(K-4),n=Oi.get(e);return n.used=!0,n.target},Un[115]=()=>new Set($e());const zy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let UI=typeof globalThis=="object"?globalThis:window;Un[116]=t=>{let e=t[0],n=zy[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new UI[n](Uint8Array.prototype.slice.call(t,1).buffer)},Un[120]=()=>{let t=$e();return new RegExp(t[0],t[1])};const FI=[];Un[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=K;return K+=e-t.length,an=FI,an=[By(),By()],an.position0=0,an.position1=0,an.postBundlePosition=K,K=n,$e()},Un[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function Ky(t){let e=br,n=K,r=wr,i=ii,s=ns,o=Oi,a=an,c=new Uint8Array(gt.slice(0,br)),l=Xt,u=Xt.slice(0,Xt.length),f=de,d=rs,h=t();return br=e,K=n,wr=r,ii=i,ns=s,Oi=o,an=a,gt=c,rs=d,Xt=l,Xt.splice(0,Xt.length,...u),de=f,Gt=new DataView(gt.buffer,gt.byteOffset,gt.byteLength),h}function _d(){gt=null,Oi=null,Xt=null}const yd=new Array(147);for(let t=0;t<256;t++)yd[t]=+("1e"+Math.floor(45.15-t*.30103));var Bl=new tc({useRecords:!1});const BI=Bl.unpack;Bl.unpackMultiple,Bl.unpack;let PI=new Float32Array(1);new Uint8Array(PI.buffer,0,4);let Pl;try{Pl=new TextEncoder}catch{}let bd,Wy;const Dl=typeof dn<"u",$l=Dl?function(t){return dn.allocUnsafeSlow(t)}:Uint8Array,Hy=Dl?dn:Uint8Array,Gy=Dl?4294967296:2144337920;let X,nc,pe,W=0,An,Ie=null,DI;const $I=21760,jI=/[\u0080-\uFFFF]/,Do=Symbol("record-id");class zI extends tc{constructor(e){super(e),this.offset=0;let n,r,i,s,o=Hy.prototype.utf8Write?function(N,E){return X.utf8Write(N,E,X.byteLength-E)}:Pl&&Pl.encodeInto?function(N,E){return Pl.encodeInto(N,X.subarray(E)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let f=e.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,p=u+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],y=0,w=0;this.pack=this.encode=function(N,E){if(X||(X=new $l(8192),pe=X.dataView||(X.dataView=new DataView(X.buffer,0,8192)),W=0),An=X.length-10,An-W<2048?(X=new $l(X.length),pe=X.dataView||(X.dataView=new DataView(X.buffer,0,X.length)),An=X.length-10,W=0):W=W+7&2147483640,n=W,E&ZI&&(W+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof N!="string"?(Ie=[],Ie.size=1/0):Ie=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let q=i.sharedLength||0;if(q>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let $=0;$<q;$++){let st=i[$];if(!st)continue;let nt,ut=i.transitions;for(let V=0,Y=st.length;V<Y;V++){let xt=st[V];nt=ut[xt],nt||(nt=ut[xt]=Object.create(null)),ut=nt}ut[Do]=$+64}this.lastNamedStructuresLength=q}c||(i.nextId=q+64)}r&&(r=!1);let P;try{a.randomAccessStructure&&N&&N.constructor&&N.constructor===Object?L(N):A(N);let q=Ie;if(Ie&&Zy(n,A,0),s&&s.idsToInsert){let $=s.idsToInsert.sort((V,Y)=>V.offset>Y.offset?1:-1),st=$.length,nt=-1;for(;q&&st>0;){let V=$[--st].offset+n;V<q.stringsPosition+n&&nt===-1&&(nt=0),V>q.position+n?nt>=0&&(nt+=6):(nt>=0&&(pe.setUint32(q.position+n,pe.getUint32(q.position+n)+nt),nt=-1),q=q.previous,st++)}nt>=0&&q&&pe.setUint32(q.position+n,pe.getUint32(q.position+n)+nt),W+=$.length*6,W>An&&I(W),a.offset=W;let ut=WI(X.subarray(n,W),$);return s=null,ut}return a.offset=W,E&YI?(X.start=n,X.end=W,X):X.subarray(n,W)}catch(q){throw P=q,q}finally{if(i&&(k(),r&&a.saveStructures)){let q=i.sharedLength||0,$=X.subarray(n,W),st=HI(i,a);if(!P)return a.saveStructures(st,st.isCompatible)===!1?a.pack(N,E):(a.lastNamedStructuresLength=q,X.length>1073741824&&(X=null),$)}X.length>1073741824&&(X=null),E&VI&&(W=n)}};const k=()=>{w<10&&w++;let N=i.sharedLength||0;if(i.length>N&&!c&&(i.length=N),y>1e4)i.transitions=null,w=0,y=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,P=m.length;E<P;E++)m[E][Do]=0;m=[]}},T=N=>{var E=N.length;E<16?X[W++]=144|E:E<65536?(X[W++]=220,X[W++]=E>>8,X[W++]=E&255):(X[W++]=221,pe.setUint32(W,E),W+=4);for(let P=0;P<E;P++)A(N[P])},A=N=>{W>An&&(X=I(W));var E=typeof N,P;if(E==="string"){let q=N.length;if(Ie&&q>=4&&q<4096){if((Ie.size+=q)>$I){let ut,V=(Ie[0]?Ie[0].length*3+Ie[1].length:0)+10;W+V>An&&(X=I(W+V));let Y;Ie.position?(Y=Ie,X[W]=200,W+=3,X[W++]=98,ut=W-n,W+=4,Zy(n,A,0),pe.setUint16(ut+n-3,W-n-ut)):(X[W++]=214,X[W++]=98,ut=W-n,W+=4),Ie=["",""],Ie.previous=Y,Ie.size=0,Ie.position=ut}let nt=jI.test(N);Ie[nt?0:1]+=N,X[W++]=193,A(nt?-q:q);return}let $;q<32?$=1:q<256?$=2:q<65536?$=3:$=5;let st=q*3;if(W+st>An&&(X=I(W+st)),q<64||!o){let nt,ut,V,Y=W+$;for(nt=0;nt<q;nt++)ut=N.charCodeAt(nt),ut<128?X[Y++]=ut:ut<2048?(X[Y++]=ut>>6|192,X[Y++]=ut&63|128):(ut&64512)===55296&&((V=N.charCodeAt(nt+1))&64512)===56320?(ut=65536+((ut&1023)<<10)+(V&1023),nt++,X[Y++]=ut>>18|240,X[Y++]=ut>>12&63|128,X[Y++]=ut>>6&63|128,X[Y++]=ut&63|128):(X[Y++]=ut>>12|224,X[Y++]=ut>>6&63|128,X[Y++]=ut&63|128);P=Y-W-$}else P=o(N,W+$);P<32?X[W++]=160|P:P<256?($<2&&X.copyWithin(W+2,W+1,W+1+P),X[W++]=217,X[W++]=P):P<65536?($<3&&X.copyWithin(W+3,W+2,W+2+P),X[W++]=218,X[W++]=P>>8,X[W++]=P&255):($<5&&X.copyWithin(W+5,W+3,W+3+P),X[W++]=219,pe.setUint32(W,P),W+=4),W+=P}else if(E==="number")if(N>>>0===N)N<32||N<128&&this.useRecords===!1||N<64&&!this.randomAccessStructure?X[W++]=N:N<256?(X[W++]=204,X[W++]=N):N<65536?(X[W++]=205,X[W++]=N>>8,X[W++]=N&255):(X[W++]=206,pe.setUint32(W,N),W+=4);else if(N>>0===N)N>=-32?X[W++]=256+N:N>=-128?(X[W++]=208,X[W++]=N+256):N>=-32768?(X[W++]=209,pe.setInt16(W,N),W+=2):(X[W++]=210,pe.setInt32(W,N),W+=4);else{let q;if((q=this.useFloat32)>0&&N<4294967296&&N>=-2147483648){X[W++]=202,pe.setFloat32(W,N);let $;if(q<4||($=N*yd[(X[W]&127)<<1|X[W+1]>>7])>>0===$){W+=4;return}else W--}X[W++]=203,pe.setFloat64(W,N),W+=8}else if(E==="object"||E==="function")if(!N)X[W++]=192;else{if(s){let $=s.get(N);if($){if(!$.id){let st=s.idsToInsert||(s.idsToInsert=[]);$.id=st.push($)}X[W++]=214,X[W++]=112,pe.setUint32(W,$.id),W+=4;return}else s.set(N,{offset:W-n})}let q=N.constructor;if(q===Object)U(N);else if(q===Array)T(N);else if(q===Map)if(this.mapAsEmptyObject)X[W++]=128;else{P=N.size,P<16?X[W++]=128|P:P<65536?(X[W++]=222,X[W++]=P>>8,X[W++]=P&255):(X[W++]=223,pe.setUint32(W,P),W+=4);for(let[$,st]of N)A($),A(st)}else{for(let $=0,st=bd.length;$<st;$++){let nt=Wy[$];if(N instanceof nt){let ut=bd[$];if(ut.write){ut.type&&(X[W++]=212,X[W++]=ut.type,X[W++]=0);let ht=ut.write.call(this,N);ht===N?Array.isArray(N)?T(N):U(N):A(ht);return}let V=X,Y=pe,xt=W;X=null;let ct;try{ct=ut.pack.call(this,N,ht=>(X=V,V=null,W+=ht,W>An&&I(W),{target:X,targetView:pe,position:W-ht}),A)}finally{V&&(X=V,pe=Y,W=xt,An=X.length-10)}ct&&(ct.length+W>An&&I(ct.length+W),W=KI(ct,X,W,ut.type));return}}if(Array.isArray(N))T(N);else{if(N.toJSON){const $=N.toJSON();if($!==N)return A($)}if(E==="function")return A(this.writeFunction&&this.writeFunction(N));U(N)}}}else if(E==="boolean")X[W++]=N?195:194;else if(E==="bigint"){if(N<BigInt(1)<<BigInt(63)&&N>=-(BigInt(1)<<BigInt(63)))X[W++]=211,pe.setBigInt64(W,N);else if(N<BigInt(1)<<BigInt(64)&&N>0)X[W++]=207,pe.setBigUint64(W,N);else if(this.largeBigIntToFloat)X[W++]=203,pe.setFloat64(W,Number(N));else{if(this.largeBigIntToString)return A(N.toString());if(this.useBigIntExtension&&N<BigInt(2)**BigInt(1023)&&N>-(BigInt(2)**BigInt(1023))){X[W++]=199,W++,X[W++]=66;let q=[],$;do{let st=N&BigInt(255);$=(st&BigInt(128))===(N<BigInt(0)?BigInt(128):BigInt(0)),q.push(st),N>>=BigInt(8)}while(!((N===BigInt(0)||N===BigInt(-1))&&$));X[W-2]=q.length;for(let st=q.length;st>0;)X[W++]=Number(q[--st]);return}else throw new RangeError(N+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}W+=8}else if(E==="undefined")this.encodeUndefinedAsNil?X[W++]=192:(X[W++]=212,X[W++]=0,X[W++]=0);else throw new Error("Unknown type: "+E)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?N=>{let E;if(this.skipValues){E=[];for(let $ in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty($))&&!this.skipValues.includes(N[$])&&E.push($)}else E=Object.keys(N);let P=E.length;P<16?X[W++]=128|P:P<65536?(X[W++]=222,X[W++]=P>>8,X[W++]=P&255):(X[W++]=223,pe.setUint32(W,P),W+=4);let q;if(this.coercibleKeyAsNumber)for(let $=0;$<P;$++){q=E[$];let st=Number(q);A(isNaN(st)?q:st),A(N[q])}else for(let $=0;$<P;$++)A(q=E[$]),A(N[q])}:N=>{X[W++]=222;let E=W-n;W+=2;let P=0;for(let q in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(q))&&(A(q),A(N[q]),P++);if(P>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');X[E+++n]=P>>8,X[E+n]=P&255},R=this.useRecords===!1?C:e.progressiveRecords&&!d?N=>{let E,P=i.transitions||(i.transitions=Object.create(null)),q=W++-n,$;for(let st in N)if(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st)){if(E=P[st],E)P=E;else{let nt=Object.keys(N),ut=P;P=i.transitions;let V=0;for(let Y=0,xt=nt.length;Y<xt;Y++){let ct=nt[Y];E=P[ct],E||(E=P[ct]=Object.create(null),V++),P=E}q+n+1==W?(W--,D(P,nt,V)):G(P,nt,q,V),$=!0,P=ut[st]}A(N[st])}if(!$){let st=P[Do];st?X[q+n]=st:G(P,Object.keys(N),q,0)}}:N=>{let E,P=i.transitions||(i.transitions=Object.create(null)),q=0;for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&(E=P[st],E||(E=P[st]=Object.create(null),q++),P=E);let $=P[Do];$?$>=96&&d?(X[W++]=(($-=96)&31)+96,X[W++]=$>>5):X[W++]=$:D(P,P.__keys__||Object.keys(N),q);for(let st in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(st))&&A(N[st])},S=typeof this.useRecords=="function"&&this.useRecords,U=S?N=>{S(N)?R(N):C(N)}:R,I=N=>{let E;if(N>16777216){if(N-n>Gy)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(Gy,Math.round(Math.max((N-n)*(N>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(N-n<<2,X.length-1)>>12)+1<<12;let P=new $l(E);return pe=P.dataView||(P.dataView=new DataView(P.buffer,0,E)),N=Math.min(N,X.length),X.copy?X.copy(P,0,n,N):P.set(X.slice(n,N)),W-=n,n=0,An=P.length-10,X=P},D=(N,E,P)=>{let q=i.nextId;q||(q=64),q<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(q=i.nextOwnId,q<p||(q=h),i.nextOwnId=q+1):(q>=p&&(q=h),i.nextId=q+1);let $=E.highByte=q>=96&&d?q-96>>5:-1;N[Do]=q,N.__keys__=E,i[q-64]=E,q<h?(E.isShared=!0,i.sharedLength=q-63,r=!0,$>=0?(X[W++]=(q&31)+96,X[W++]=$):X[W++]=q):($>=0?(X[W++]=213,X[W++]=114,X[W++]=(q&31)+96,X[W++]=$):(X[W++]=212,X[W++]=114,X[W++]=q),P&&(y+=w*P),m.length>=f&&(m.shift()[Do]=0),m.push(N),A(E))},G=(N,E,P,q)=>{let $=X,st=W,nt=An,ut=n;X=nc,W=0,n=0,X||(nc=X=new $l(8192)),An=X.length-10,D(N,E,q),nc=X;let V=W;if(X=$,W=st,An=nt,n=ut,V>1){let Y=W+V-1;Y>An&&I(Y);let xt=P+n;X.copyWithin(xt+V,xt+1,W),X.set(nc.slice(0,V),xt),W=Y}else X[P+n]=nc[0]},L=N=>{let E=DI(N,X,n,W,i,I,(P,q,$)=>{if($)return r=!0;W=q;let st=X;return A(P),k(),st!==X?{position:W,targetView:pe,target:X}:W},this);if(E===0)return U(N);W=E}}useBuffer(e){X=e,X.dataView||(X.dataView=new DataView(X.buffer,X.byteOffset,X.byteLength)),W=0}set position(e){W=e}get position(){return W}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Wy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Ry],bd=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?Yy(t,16,e):Vy(Dl?dn.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==Hy&&this.moreTypes?Yy(t,zy.indexOf(n.name),e):Vy(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function Yy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Vy(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function KI(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function WI(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function Zy(t,e,n){if(Ie.length>0){pe.setUint32(Ie.position+t,W+n-Ie.position-t),Ie.stringsPosition=W-t;let r=Ie;Ie=null,e(r[0]),e(r[1])}}function HI(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let Xy=new zI({useRecords:!1});const GI=Xy.pack;Xy.pack;const YI=512,VI=1024,ZI=2048,tt=io("SOFTWARE");function Ae(){return null}function $o(t,e,n={}){if(!x(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];x(c)&&(a=c(a));const l=e[o];x(l)&&(o=l),a!==null&&r.push(o,a)}return r}function rc(t,e,n={}){if(x(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){ue(tt,"","binary",r.message)}}function XI(t){try{const e=Zn(t);return GI(e)}catch(e){ue(tt,"","binary",e.message)}}function qI(t){try{return BI(t)}catch(e){ue(tt,"","binary",e.message)}}function qy(){return{id:Pe()}}var jl=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.destructible=16]="destructible",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t))(jl||{});function zl(t){return x(t==null?void 0:t.id)?$o(t,jl,{category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae}):$o(t,jl,{id:Ae,x:Ae,y:Ae,lx:Ae,ly:Ae,code:Ae,category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae})}function Kl(t){return rc(t,jl)}function wn(t){var e;return(((e=t==null?void 0:t.id)==null?void 0:e.length)??0)>0}function ic(t,e){if(!x(t)||!ri(e))return;const{color:n,bg:r}=xy(e);x(n)&&(t.color=n),x(r)&&(t.bg=r)}function is(t){var e;return It((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}const St=60,Yt=25,wd=St*Yt;var _t=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(_t||{});function JI(){return new Array(St*Yt).map(()=>{})}function Ed(t=kh){const e={terrain:JI(),objects:{},id:""};return t(e)}var xd=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(xd||{});function QI(t){return $o(t,xd,{terrain:e=>e.map(zl),objects:e=>Object.values(e).filter(n=>!n.removed).map(zl),id:Ae,named:Ae,lookup:Ae,codepage:Ae,distmaps:Ae,overboard:Ae,underboard:Ae})}function tN(t){return rc(t,xd,{terrain:e=>e.map(Kl),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=Kl(e[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Wl(t){return Mo(t.x,t.y,0,St-1,Yt-1,0)}function Ur(t,e){return!x(t)||!x(e==null?void 0:e.x)||!x(e==null?void 0:e.y)||e.x<0||e.x>=St||e.y<0||e.y>=Yt?-1:e.x+e.y*St}function me(t,e){const n=Ur(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Rn(t,t.lookup[n]??"");return x(r)?r:t.terrain[n]}function eN(t,e){const n=Rn(t,e);if(x(n))return n;const r=parseFloat(e),i=hI(isNaN(r)?-1:r,St);return jo(t,i.x,i.y)}function jo(t,e,n){return(e>=0&&e<St)??(n>=0&&n<Yt)?t==null?void 0:t.terrain[e+n*St]:void 0}function ln(t,e){if(!x(t)||!x(e)||!x(e.x)||!x(e.y)||e.x<0||e.x>=St||e.y<0||e.y>=Yt)return;const n=Zn(e),r=e.x+e.y*St;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function vd(t,e){if(!x(t)||!x(e))return;const n=Zn(e);return n.id=n.id??Pe(),t.objects[n.id]=n,t.objects[n.id]}function nN(t,e,n){return ln(t,{...e,kind:n})}function kd(t,e,n,r){return vd(t,{...e,kind:n,id:r})}function Rn(t,e){if(t)return t.objects[e]}function rN(t,e){const n=Ur(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Rn(t,t.lookup[n]??"");if(x(r))return r}function Jy(t,e){return x(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function iN(t,e,n){if(!x(t)||!x(e))return;const r=t.objects[n];if(x(r))return r;if(Bo(e))return eb(e,oc(t,"player"))}function zo(t,e){const n=t??$t.ISWALK,r=e??$t.ISWALK;switch(n){case $t.ISWALK:return r!==$t.ISWALK;case $t.ISSWIM:return r!==$t.ISSWIM;case $t.ISSOLID:return!0;case $t.ISBULLET:return r!==$t.ISWALK&&r!==$t.ISSWIM}}function sc(t,e,n){const r=t==null?void 0:t.objects[n];if(x(r))return r;const i=oc(t,"player");return x(e)?(e.x<0&&(e.x=yr(0,St-1)),e.y<0&&(e.y=yr(0,Yt-1)),eb(e,i)):Te(...i)}function oc(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(x)}function sN(t){const e=[];for(let n=0;n<Yt;++n)for(let r=0;r<St;++r){const i={x:r,y:n},s=me(t,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&e.push(i)}return e}function Qy(t,e){const n=hd(e),r=ky(e),i=Ty(e);return oc(t,n??"").filter(s=>{var o,a,c;return!(x(n)&&It((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Rt.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Rt.BLACK)!==i)}).filter(x)}function tb(t,e){return x(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(x(i))return i;const s=oc(t,It(n));if(s.length)return s}else if(Bo(n)&&n.x>=0&&n.x<St&&n.y>=0&&n.y<Yt){const i=n.x+n.y*St,s=(r=t.lookup)==null?void 0:r[i];return x(s)?t.objects[s]:t.terrain[i]}}).flat().filter(x):[]}function eb(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function nb(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}const Td=14,ac=3,Ko=8,Wo=14,Hl=16,oN=16,aN=16;var Gl=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(Gl||{});function Yl(t,e){return new Array(t).fill(e)}function cN(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:Yl(s,0),color:Yl(s,0),bg:Yl(s,i)}}function lN(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:Rt.ONCLEAR}}function uN(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function hN(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:Yl(s,i)}}function fN(t,e,n,r){return{id:`media:${t}:${e}`,type:4,mime:n,media:r}}function dN(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function rb(t,e){return`${t}:${e}`}const pN=1,mN=16,gN=256;var Sn=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Sn||{});function Ad(t){const e=Math.floor(t.length/ac);if(e*ac!==t.length)return;const n=nb(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function _N(t,e){return t&1<<e?255:0}function ib(t){const e=Math.floor(t.length/Td);if(e*Td!==t.length)return;const n=Math.ceil(e/Hl),r=Ko*Hl,i=nb(r,Wo*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*Wo+a,u=t[c];for(let f=0;f<Ko;++f){const d=s*Ko+f;i.bits[d+l*r]=_N(u,7-f)}++a,a===Wo&&(a=0,++s,s===Hl&&(s=0,++o))}return i}const yN=ll("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),sb=ll("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ob=typeof _o=="object"&&_o&&_o.Object===Object&&_o,bN=typeof self=="object"&&self&&self.Object===Object&&self,si=ob||bN||Function("return this")(),Er=si.Symbol,ab=Object.prototype,wN=ab.hasOwnProperty,EN=ab.toString,cc=Er?Er.toStringTag:void 0;function xN(t){var e=wN.call(t,cc),n=t[cc];try{t[cc]=void 0;var r=!0}catch{}var i=EN.call(t);return r&&(e?t[cc]=n:delete t[cc]),i}var vN=Object.prototype,kN=vN.toString;function TN(t){return kN.call(t)}var AN="[object Null]",RN="[object Undefined]",cb=Er?Er.toStringTag:void 0;function ss(t){return t==null?t===void 0?RN:AN:cb&&cb in Object(t)?xN(t):TN(t)}function Fr(t){return t!=null&&typeof t=="object"}var SN="[object Symbol]";function Vl(t){return typeof t=="symbol"||Fr(t)&&ss(t)==SN}function Zl(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Qt=Array.isArray,ON=1/0,lb=Er?Er.prototype:void 0,ub=lb?lb.toString:void 0;function hb(t){if(typeof t=="string")return t;if(Qt(t))return Zl(t,hb)+"";if(Vl(t))return ub?ub.call(t):"";var e=t+"";return e=="0"&&1/t==-ON?"-0":e}var IN=/\s/;function NN(t){for(var e=t.length;e--&&IN.test(t.charAt(e)););return e}var CN=/^\s+/;function LN(t){return t&&t.slice(0,NN(t)+1).replace(CN,"")}function xr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var fb=NaN,MN=/^[-+]0x[0-9a-f]+$/i,UN=/^0b[01]+$/i,FN=/^0o[0-7]+$/i,BN=parseInt;function PN(t){if(typeof t=="number")return t;if(Vl(t))return fb;if(xr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=xr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=LN(t);var n=UN.test(t);return n||FN.test(t)?BN(t.slice(2),n?2:8):MN.test(t)?fb:+t}var db=1/0,DN=17976931348623157e292;function $N(t){if(!t)return t===0?t:0;if(t=PN(t),t===db||t===-db){var e=t<0?-1:1;return e*DN}return t===t?t:0}function Xl(t){var e=$N(t),n=e%1;return e===e?n?e-n:e:0}function Ho(t){return t}var jN="[object AsyncFunction]",zN="[object Function]",KN="[object GeneratorFunction]",WN="[object Proxy]";function Ii(t){if(!xr(t))return!1;var e=ss(t);return e==zN||e==KN||e==jN||e==WN}var Rd=si["__core-js_shared__"],pb=function(){var t=/[^.]+$/.exec(Rd&&Rd.keys&&Rd.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function HN(t){return!!pb&&pb in t}var GN=Function.prototype,YN=GN.toString;function $s(t){if(t!=null){try{return YN.call(t)}catch{}try{return t+""}catch{}}return""}var VN=/[\\^$.*+?()[\]{}|]/g,ZN=/^\[object .+?Constructor\]$/,XN=Function.prototype,qN=Object.prototype,JN=XN.toString,QN=qN.hasOwnProperty,tC=RegExp("^"+JN.call(QN).replace(VN,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function eC(t){if(!xr(t)||HN(t))return!1;var e=Ii(t)?tC:ZN;return e.test($s(t))}function nC(t,e){return t==null?void 0:t[e]}function js(t,e){var n=nC(t,e);return eC(n)?n:void 0}var Sd=js(si,"WeakMap"),mb=Object.create,rC=function(){function t(){}return function(e){if(!xr(e))return{};if(mb)return mb(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function iC(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function qe(){}function sC(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var oC=800,aC=16,cC=Date.now;function lC(t){var e=0,n=0;return function(){var r=cC(),i=aC-(r-n);if(n=r,i>0){if(++e>=oC)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function uC(t){return function(){return t}}var ql=function(){try{var t=js(Object,"defineProperty");return t({},"",{}),t}catch{}}(),hC=ql?function(t,e){return ql(t,"toString",{configurable:!0,enumerable:!1,value:uC(e),writable:!0})}:Ho,fC=lC(hC);function gb(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function _b(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function dC(t){return t!==t}function pC(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Od(t,e,n){return e===e?pC(t,e,n):_b(t,dC,n)}function yb(t,e){var n=t==null?0:t.length;return!!n&&Od(t,e,0)>-1}var mC=9007199254740991,gC=/^(?:0|[1-9]\d*)$/;function Jl(t,e){var n=typeof t;return e=e??mC,!!e&&(n=="number"||n!="symbol"&&gC.test(t))&&t>-1&&t%1==0&&t<e}function Id(t,e,n){e=="__proto__"&&ql?ql(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function lc(t,e){return t===e||t!==t&&e!==e}var _C=Object.prototype,yC=_C.hasOwnProperty;function Ql(t,e,n){var r=t[e];(!(yC.call(t,e)&&lc(r,n))||n===void 0&&!(e in t))&&Id(t,e,n)}function Nd(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Id(n,a,c):Ql(n,a,c)}return n}var bb=Math.max;function bC(t,e,n){return e=bb(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=bb(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),iC(t,this,a)}}function Cd(t,e){return fC(bC(t,e,Ho),t+"")}var wC=9007199254740991;function Ld(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=wC}function oi(t){return t!=null&&Ld(t.length)&&!Ii(t)}function wb(t,e,n){if(!xr(n))return!1;var r=typeof e;return(r=="number"?oi(n)&&Jl(e,n.length):r=="string"&&e in n)?lc(n[e],t):!1}function EC(t){return Cd(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&wb(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var xC=Object.prototype;function uc(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||xC;return t===n}function vC(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var kC="[object Arguments]";function Eb(t){return Fr(t)&&ss(t)==kC}var xb=Object.prototype,TC=xb.hasOwnProperty,AC=xb.propertyIsEnumerable,tu=Eb(function(){return arguments}())?Eb:function(t){return Fr(t)&&TC.call(t,"callee")&&!AC.call(t,"callee")};function RC(){return!1}var vb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kb=vb&&typeof module=="object"&&module&&!module.nodeType&&module,SC=kb&&kb.exports===vb,Tb=SC?si.Buffer:void 0,OC=Tb?Tb.isBuffer:void 0,hc=OC||RC,IC="[object Arguments]",NC="[object Array]",CC="[object Boolean]",LC="[object Date]",MC="[object Error]",UC="[object Function]",FC="[object Map]",BC="[object Number]",PC="[object Object]",DC="[object RegExp]",$C="[object Set]",jC="[object String]",zC="[object WeakMap]",KC="[object ArrayBuffer]",WC="[object DataView]",HC="[object Float32Array]",GC="[object Float64Array]",YC="[object Int8Array]",VC="[object Int16Array]",ZC="[object Int32Array]",XC="[object Uint8Array]",qC="[object Uint8ClampedArray]",JC="[object Uint16Array]",QC="[object Uint32Array]",Ee={};Ee[HC]=Ee[GC]=Ee[YC]=Ee[VC]=Ee[ZC]=Ee[XC]=Ee[qC]=Ee[JC]=Ee[QC]=!0,Ee[IC]=Ee[NC]=Ee[KC]=Ee[CC]=Ee[WC]=Ee[LC]=Ee[MC]=Ee[UC]=Ee[FC]=Ee[BC]=Ee[PC]=Ee[DC]=Ee[$C]=Ee[jC]=Ee[zC]=!1;function t6(t){return Fr(t)&&Ld(t.length)&&!!Ee[ss(t)]}function eu(t){return function(e){return t(e)}}var Ab=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fc=Ab&&typeof module=="object"&&module&&!module.nodeType&&module,e6=fc&&fc.exports===Ab,Md=e6&&ob.process,os=function(){try{var t=fc&&fc.require&&fc.require("util").types;return t||Md&&Md.binding&&Md.binding("util")}catch{}}(),Rb=os&&os.isTypedArray,Ud=Rb?eu(Rb):t6,n6=Object.prototype,r6=n6.hasOwnProperty;function Sb(t,e){var n=Qt(t),r=!n&&tu(t),i=!n&&!r&&hc(t),s=!n&&!r&&!i&&Ud(t),o=n||r||i||s,a=o?vC(t.length,String):[],c=a.length;for(var l in t)(e||r6.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Jl(l,c)))&&a.push(l);return a}function Ob(t,e){return function(n){return t(e(n))}}var i6=Ob(Object.keys,Object),s6=Object.prototype,o6=s6.hasOwnProperty;function Ib(t){if(!uc(t))return i6(t);var e=[];for(var n in Object(t))o6.call(t,n)&&n!="constructor"&&e.push(n);return e}function vr(t){return oi(t)?Sb(t):Ib(t)}var a6=Object.prototype,c6=a6.hasOwnProperty,Fn=EC(function(t,e){if(uc(e)||oi(e)){Nd(e,vr(e),t);return}for(var n in e)c6.call(e,n)&&Ql(t,n,e[n])});function l6(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var u6=Object.prototype,h6=u6.hasOwnProperty;function f6(t){if(!xr(t))return l6(t);var e=uc(t),n=[];for(var r in t)r=="constructor"&&(e||!h6.call(t,r))||n.push(r);return n}function Nb(t){return oi(t)?Sb(t,!0):f6(t)}var d6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p6=/^\w*$/;function Fd(t,e){if(Qt(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Vl(t)?!0:p6.test(t)||!d6.test(t)||e!=null&&t in Object(e)}var dc=js(Object,"create");function m6(){this.__data__=dc?dc(null):{},this.size=0}function g6(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var _6="__lodash_hash_undefined__",y6=Object.prototype,b6=y6.hasOwnProperty;function w6(t){var e=this.__data__;if(dc){var n=e[t];return n===_6?void 0:n}return b6.call(e,t)?e[t]:void 0}var E6=Object.prototype,x6=E6.hasOwnProperty;function v6(t){var e=this.__data__;return dc?e[t]!==void 0:x6.call(e,t)}var k6="__lodash_hash_undefined__";function T6(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=dc&&e===void 0?k6:e,this}function zs(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}zs.prototype.clear=m6,zs.prototype.delete=g6,zs.prototype.get=w6,zs.prototype.has=v6,zs.prototype.set=T6;function A6(){this.__data__=[],this.size=0}function nu(t,e){for(var n=t.length;n--;)if(lc(t[n][0],e))return n;return-1}var R6=Array.prototype,S6=R6.splice;function O6(t){var e=this.__data__,n=nu(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():S6.call(e,n,1),--this.size,!0}function I6(t){var e=this.__data__,n=nu(e,t);return n<0?void 0:e[n][1]}function N6(t){return nu(this.__data__,t)>-1}function C6(t,e){var n=this.__data__,r=nu(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Ni(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ni.prototype.clear=A6,Ni.prototype.delete=O6,Ni.prototype.get=I6,Ni.prototype.has=N6,Ni.prototype.set=C6;var pc=js(si,"Map");function L6(){this.size=0,this.__data__={hash:new zs,map:new(pc||Ni),string:new zs}}function M6(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ru(t,e){var n=t.__data__;return M6(e)?n[typeof e=="string"?"string":"hash"]:n.map}function U6(t){var e=ru(this,t).delete(t);return this.size-=e?1:0,e}function F6(t){return ru(this,t).get(t)}function B6(t){return ru(this,t).has(t)}function P6(t,e){var n=ru(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Ci(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ci.prototype.clear=L6,Ci.prototype.delete=U6,Ci.prototype.get=F6,Ci.prototype.has=B6,Ci.prototype.set=P6;var D6="Expected a function";function Bd(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(D6);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Bd.Cache||Ci),n}Bd.Cache=Ci;var $6=500;function j6(t){var e=Bd(t,function(r){return n.size===$6&&n.clear(),r}),n=e.cache;return e}var z6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,K6=/\\(\\)?/g,W6=j6(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(z6,function(n,r,i,s){e.push(i?s.replace(K6,"$1"):r||n)}),e});function Cb(t){return t==null?"":hb(t)}function iu(t,e){return Qt(t)?t:Fd(t,e)?[t]:W6(Cb(t))}var H6=1/0;function mc(t){if(typeof t=="string"||Vl(t))return t;var e=t+"";return e=="0"&&1/t==-H6?"-0":e}function Pd(t,e){e=iu(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[mc(e[n++])];return n&&n==r?t:void 0}function G6(t,e,n){var r=t==null?void 0:Pd(t,e);return r===void 0?n:r}function Dd(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Lb=Er?Er.isConcatSpreadable:void 0;function Y6(t){return Qt(t)||tu(t)||!!(Lb&&t&&t[Lb])}function $d(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=Y6),i||(i=[]);++s<o;){var a=t[s];n(a)?Dd(i,a):r||(i[i.length]=a)}return i}function rr(t){var e=t==null?0:t.length;return e?$d(t):[]}var Mb=Ob(Object.getPrototypeOf,Object);function jd(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function V6(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:jd(t,e,n)}var Z6="\\ud800-\\udfff",X6="\\u0300-\\u036f",q6="\\ufe20-\\ufe2f",J6="\\u20d0-\\u20ff",Q6=X6+q6+J6,tL="\\ufe0e\\ufe0f",eL="\\u200d",nL=RegExp("["+eL+Z6+Q6+tL+"]");function Ub(t){return nL.test(t)}function rL(t){return t.split("")}var Fb="\\ud800-\\udfff",iL="\\u0300-\\u036f",sL="\\ufe20-\\ufe2f",oL="\\u20d0-\\u20ff",aL=iL+sL+oL,cL="\\ufe0e\\ufe0f",lL="["+Fb+"]",zd="["+aL+"]",Kd="\\ud83c[\\udffb-\\udfff]",uL="(?:"+zd+"|"+Kd+")",Bb="[^"+Fb+"]",Pb="(?:\\ud83c[\\udde6-\\uddff]){2}",Db="[\\ud800-\\udbff][\\udc00-\\udfff]",hL="\\u200d",$b=uL+"?",jb="["+cL+"]?",fL="(?:"+hL+"(?:"+[Bb,Pb,Db].join("|")+")"+jb+$b+")*",dL=jb+$b+fL,pL="(?:"+[Bb+zd+"?",zd,Pb,Db,lL].join("|")+")",mL=RegExp(Kd+"(?="+Kd+")|"+pL+dL,"g");function gL(t){return t.match(mL)||[]}function _L(t){return Ub(t)?gL(t):rL(t)}function yL(t){return function(e){e=Cb(e);var n=Ub(e)?_L(e):void 0,r=n?n[0]:e.charAt(0),i=n?V6(n,1).join(""):e.slice(1);return r[t]()+i}}var zb=yL("toUpperCase");function bL(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function wL(){this.__data__=new Ni,this.size=0}function EL(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function xL(t){return this.__data__.get(t)}function vL(t){return this.__data__.has(t)}var kL=200;function TL(t,e){var n=this.__data__;if(n instanceof Ni){var r=n.__data__;if(!pc||r.length<kL-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ci(r)}return n.set(t,e),this.size=n.size,this}function ai(t){var e=this.__data__=new Ni(t);this.size=e.size}ai.prototype.clear=wL,ai.prototype.delete=EL,ai.prototype.get=xL,ai.prototype.has=vL,ai.prototype.set=TL;function AL(t,e){return t&&Nd(e,vr(e),t)}var Kb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Wb=Kb&&typeof module=="object"&&module&&!module.nodeType&&module,RL=Wb&&Wb.exports===Kb,Hb=RL?si.Buffer:void 0,Gb=Hb?Hb.allocUnsafe:void 0;function SL(t,e){var n=t.length,r=Gb?Gb(n):new t.constructor(n);return t.copy(r),r}function Wd(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Yb(){return[]}var OL=Object.prototype,IL=OL.propertyIsEnumerable,Vb=Object.getOwnPropertySymbols,Hd=Vb?function(t){return t==null?[]:(t=Object(t),Wd(Vb(t),function(e){return IL.call(t,e)}))}:Yb;function NL(t,e){return Nd(t,Hd(t),e)}var CL=Object.getOwnPropertySymbols,LL=CL?function(t){for(var e=[];t;)Dd(e,Hd(t)),t=Mb(t);return e}:Yb;function Zb(t,e,n){var r=e(t);return Qt(t)?r:Dd(r,n(t))}function Gd(t){return Zb(t,vr,Hd)}function ML(t){return Zb(t,Nb,LL)}var Yd=js(si,"DataView"),Vd=js(si,"Promise"),Go=js(si,"Set"),Xb="[object Map]",UL="[object Object]",qb="[object Promise]",Jb="[object Set]",Qb="[object WeakMap]",t1="[object DataView]",FL=$s(Yd),BL=$s(pc),PL=$s(Vd),DL=$s(Go),$L=$s(Sd),kr=ss;(Yd&&kr(new Yd(new ArrayBuffer(1)))!=t1||pc&&kr(new pc)!=Xb||Vd&&kr(Vd.resolve())!=qb||Go&&kr(new Go)!=Jb||Sd&&kr(new Sd)!=Qb)&&(kr=function(t){var e=ss(t),n=e==UL?t.constructor:void 0,r=n?$s(n):"";if(r)switch(r){case FL:return t1;case BL:return Xb;case PL:return qb;case DL:return Jb;case $L:return Qb}return e});var jL=Object.prototype,zL=jL.hasOwnProperty;function KL(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&zL.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var su=si.Uint8Array;function WL(t){var e=new t.constructor(t.byteLength);return new su(e).set(new su(t)),e}function HL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var GL=/\w*$/;function YL(t){var e=new t.constructor(t.source,GL.exec(t));return e.lastIndex=t.lastIndex,e}var e1=Er?Er.prototype:void 0,n1=e1?e1.valueOf:void 0;function VL(t){return n1?Object(n1.call(t)):{}}function ZL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var XL="[object Boolean]",qL="[object Date]",JL="[object Map]",QL="[object Number]",t2="[object RegExp]",e2="[object Set]",n2="[object String]",r2="[object Symbol]",i2="[object ArrayBuffer]",s2="[object DataView]",o2="[object Float32Array]",a2="[object Float64Array]",c2="[object Int8Array]",l2="[object Int16Array]",u2="[object Int32Array]",h2="[object Uint8Array]",f2="[object Uint8ClampedArray]",d2="[object Uint16Array]",p2="[object Uint32Array]";function m2(t,e,n){var r=t.constructor;switch(e){case i2:return WL(t);case XL:case qL:return new r(+t);case s2:return HL(t);case o2:case a2:case c2:case l2:case u2:case h2:case f2:case d2:case p2:return ZL(t);case JL:return new r;case QL:case n2:return new r(t);case t2:return YL(t);case e2:return new r;case r2:return VL(t)}}function g2(t){return typeof t.constructor=="function"&&!uc(t)?rC(Mb(t)):{}}var _2="[object Map]";function y2(t){return Fr(t)&&kr(t)==_2}var r1=os&&os.isMap,b2=r1?eu(r1):y2,w2="[object Set]";function E2(t){return Fr(t)&&kr(t)==w2}var i1=os&&os.isSet,x2=i1?eu(i1):E2,s1="[object Arguments]",v2="[object Array]",k2="[object Boolean]",T2="[object Date]",A2="[object Error]",o1="[object Function]",R2="[object GeneratorFunction]",S2="[object Map]",O2="[object Number]",a1="[object Object]",I2="[object RegExp]",N2="[object Set]",C2="[object String]",L2="[object Symbol]",M2="[object WeakMap]",U2="[object ArrayBuffer]",F2="[object DataView]",B2="[object Float32Array]",P2="[object Float64Array]",D2="[object Int8Array]",$2="[object Int16Array]",j2="[object Int32Array]",z2="[object Uint8Array]",K2="[object Uint8ClampedArray]",W2="[object Uint16Array]",H2="[object Uint32Array]",ge={};ge[s1]=ge[v2]=ge[U2]=ge[F2]=ge[k2]=ge[T2]=ge[B2]=ge[P2]=ge[D2]=ge[$2]=ge[j2]=ge[S2]=ge[O2]=ge[a1]=ge[I2]=ge[N2]=ge[C2]=ge[L2]=ge[z2]=ge[K2]=ge[W2]=ge[H2]=!0,ge[A2]=ge[o1]=ge[M2]=!1;function ou(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!xr(t))return t;var a=Qt(t);if(a)return o=KL(t),sC(t,o);var c=kr(t),l=c==o1||c==R2;if(hc(t))return SL(t);if(c==a1||c==s1||l&&!i)return o=l?{}:g2(t),NL(t,AL(o,t));if(!ge[c])return i?t:{};o=m2(t,c),s||(s=new ai);var u=s.get(t);if(u)return u;s.set(t,o),x2(t)?t.forEach(function(h){o.add(ou(h,e,n,h,t,s))}):b2(t)&&t.forEach(function(h,p){o.set(p,ou(h,e,n,p,t,s))});var f=Gd,d=a?void 0:f(t);return gb(d||t,function(h,p){d&&(p=h,h=t[p]),Ql(o,p,ou(h,e,n,p,t,s))}),o}var G2=4;function mn(t){return ou(t,G2)}function gc(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var Y2="__lodash_hash_undefined__";function V2(t){return this.__data__.set(t,Y2),this}function Z2(t){return this.__data__.has(t)}function Yo(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ci;++e<n;)this.add(t[e])}Yo.prototype.add=Yo.prototype.push=V2,Yo.prototype.has=Z2;function c1(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Zd(t,e){return t.has(e)}var X2=1,q2=2;function l1(t,e,n,r,i,s){var o=n&X2,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var f=-1,d=!0,h=n&q2?new Yo:void 0;for(s.set(t,e),s.set(e,t);++f<a;){var p=t[f],m=e[f];if(r)var y=o?r(m,p,f,e,t,s):r(p,m,f,t,e,s);if(y!==void 0){if(y)continue;d=!1;break}if(h){if(!c1(e,function(w,k){if(!Zd(h,k)&&(p===w||i(p,w,n,r,s)))return h.push(k)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function J2(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Xd(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var Q2=1,tM=2,eM="[object Boolean]",nM="[object Date]",rM="[object Error]",iM="[object Map]",sM="[object Number]",oM="[object RegExp]",aM="[object Set]",cM="[object String]",lM="[object Symbol]",uM="[object ArrayBuffer]",hM="[object DataView]",u1=Er?Er.prototype:void 0,qd=u1?u1.valueOf:void 0;function fM(t,e,n,r,i,s,o){switch(n){case hM:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case uM:return!(t.byteLength!=e.byteLength||!s(new su(t),new su(e)));case eM:case nM:case sM:return lc(+t,+e);case rM:return t.name==e.name&&t.message==e.message;case oM:case cM:return t==e+"";case iM:var a=J2;case aM:var c=r&Q2;if(a||(a=Xd),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=tM,o.set(t,e);var u=l1(a(t),a(e),r,i,s,o);return o.delete(t),u;case lM:if(qd)return qd.call(t)==qd.call(e)}return!1}var dM=1,pM=Object.prototype,mM=pM.hasOwnProperty;function gM(t,e,n,r,i,s){var o=n&dM,a=Gd(t),c=a.length,l=Gd(e),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in e:mM.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var y=o;++f<c;){d=a[f];var w=t[d],k=e[d];if(r)var T=o?r(k,w,d,e,t,s):r(w,k,d,t,e,s);if(!(T===void 0?w===k||i(w,k,n,r,s):T)){m=!1;break}y||(y=d=="constructor")}if(m&&!y){var A=t.constructor,C=e.constructor;A!=C&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var _M=1,h1="[object Arguments]",f1="[object Array]",au="[object Object]",yM=Object.prototype,d1=yM.hasOwnProperty;function bM(t,e,n,r,i,s){var o=Qt(t),a=Qt(e),c=o?f1:kr(t),l=a?f1:kr(e);c=c==h1?au:c,l=l==h1?au:l;var u=c==au,f=l==au,d=c==l;if(d&&hc(t)){if(!hc(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ai),o||Ud(t)?l1(t,e,n,r,i,s):fM(t,e,c,n,r,i,s);if(!(n&_M)){var h=u&&d1.call(t,"__wrapped__"),p=f&&d1.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,y=p?e.value():e;return s||(s=new ai),i(m,y,n,r,s)}}return d?(s||(s=new ai),gM(t,e,n,r,i,s)):!1}function Jd(t,e,n,r,i){return t===e?!0:t==null||e==null||!Fr(t)&&!Fr(e)?t!==t&&e!==e:bM(t,e,n,r,Jd,i)}var wM=1,EM=2;function xM(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new ai,f;if(!(f===void 0?Jd(l,c,wM|EM,r,u):f))return!1}}return!0}function p1(t){return t===t&&!xr(t)}function vM(t){for(var e=vr(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,p1(i)]}return e}function m1(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function kM(t){var e=vM(t);return e.length==1&&e[0][2]?m1(e[0][0],e[0][1]):function(n){return n===t||xM(n,t,e)}}function TM(t,e){return t!=null&&e in Object(t)}function g1(t,e,n){e=iu(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=mc(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Ld(i)&&Jl(o,i)&&(Qt(t)||tu(t)))}function AM(t,e){return t!=null&&g1(t,e,TM)}var RM=1,SM=2;function OM(t,e){return Fd(t)&&p1(e)?m1(mc(t),e):function(n){var r=G6(n,t);return r===void 0&&r===e?AM(n,t):Jd(e,r,RM|SM)}}function IM(t){return function(e){return e==null?void 0:e[t]}}function NM(t){return function(e){return Pd(e,t)}}function CM(t){return Fd(t)?IM(mc(t)):NM(t)}function ci(t){return typeof t=="function"?t:t==null?Ho:typeof t=="object"?Qt(t)?OM(t[0],t[1]):kM(t):CM(t)}function LM(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function MM(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var UM=MM();function FM(t,e){return t&&UM(t,e,vr)}function BM(t,e){return function(n,r){if(n==null)return n;if(!oi(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var Ks=BM(FM);function PM(t,e,n,r){return Ks(t,function(i,s,o){e(r,i,n(i),o)}),r}function DM(t,e){return function(n,r){var i=Qt(n)?LM:PM,s=e?e():{};return i(n,t,ci(r),s)}}var _1=Object.prototype,$M=_1.hasOwnProperty,Qd=Cd(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&wb(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Nb(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||lc(u,_1[l])&&!$M.call(t,l))&&(t[l]=s[l])}return t});function y1(t){return Fr(t)&&oi(t)}var jM=200;function zM(t,e,n,r){var i=-1,s=yb,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=jM&&(s=Zd,o=!1,e=new Yo(e));t:for(;++i<a;){var u=t[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(e[d]===f)continue t;c.push(u)}else s(e,f,r)||c.push(u)}return c}var cu=Cd(function(t,e){return y1(t)?zM(t,$d(e,1,y1,!0)):[]});function Vo(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function gn(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:Xl(e),jd(t,e<0?0:e,r)):[]}function _c(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:Xl(e),e=r-e,jd(t,0,e<0?0:e)):[]}function KM(t){return typeof t=="function"?t:Ho}function Nt(t,e){var n=Qt(t)?gb:Ks;return n(t,KM(e))}function WM(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function HM(t,e){var n=!0;return Ks(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function Br(t,e,n){var r=Qt(t)?WM:HM;return r(t,ci(e))}function b1(t,e){var n=[];return Ks(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Tr(t,e){var n=Qt(t)?Wd:b1;return n(t,ci(e))}function GM(t){return function(e,n,r){var i=Object(e);if(!oi(e)){var s=ci(n);e=vr(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var YM=Math.max;function VM(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:Xl(n);return i<0&&(i=YM(r+i,0)),_b(t,ci(e),i)}var Zo=GM(VM);function Pr(t){return t&&t.length?t[0]:void 0}function ZM(t,e){var n=-1,r=oi(t)?Array(t.length):[];return Ks(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function Et(t,e){var n=Qt(t)?Zl:ZM;return n(t,ci(e))}function Ar(t,e){return $d(Et(t,e))}var XM=Object.prototype,qM=XM.hasOwnProperty,w1=DM(function(t,e,n){qM.call(t,n)?t[n].push(e):Id(t,n,[e])}),JM=Object.prototype,QM=JM.hasOwnProperty;function t8(t,e){return t!=null&&QM.call(t,e)}function Ot(t,e){return t!=null&&g1(t,e,t8)}var e8="[object String]";function Bn(t){return typeof t=="string"||!Qt(t)&&Fr(t)&&ss(t)==e8}function n8(t,e){return Zl(e,function(n){return t[n]})}function Ke(t){return t==null?[]:n8(t,vr(t))}var r8=Math.max;function On(t,e,n,r){t=oi(t)?t:Ke(t),n=n&&!r?Xl(n):0;var i=t.length;return n<0&&(n=r8(i+n,0)),Bn(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Od(t,e,n)>-1}function E1(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return Od(t,e,i)}var i8="[object Map]",s8="[object Set]",o8=Object.prototype,a8=o8.hasOwnProperty;function _e(t){if(t==null)return!0;if(oi(t)&&(Qt(t)||typeof t=="string"||typeof t.splice=="function"||hc(t)||Ud(t)||tu(t)))return!t.length;var e=kr(t);if(e==i8||e==s8)return!t.size;if(uc(t))return!Ib(t).length;for(var n in t)if(a8.call(t,n))return!1;return!0}var c8="[object RegExp]";function l8(t){return Fr(t)&&ss(t)==c8}var x1=os&&os.isRegExp,Li=x1?eu(x1):l8;function Mi(t){return t===void 0}var u8="Expected a function";function h8(t){if(typeof t!="function")throw new TypeError(u8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function f8(t,e,n,r){if(!xr(t))return t;e=iu(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=mc(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=xr(u)?u:Jl(e[i+1])?[]:{})}Ql(a,c,l),a=a[c]}return t}function d8(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Pd(t,o);n(a,o)&&f8(s,iu(o,t),a)}return s}function Dr(t,e){if(t==null)return{};var n=Zl(ML(t),function(r){return[r]});return e=ci(e),d8(t,n,function(r,i){return e(r,i[0])})}function p8(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Pn(t,e,n){var r=Qt(t)?bL:p8,i=arguments.length<3;return r(t,ci(e),n,i,Ks)}function lu(t,e){var n=Qt(t)?Wd:b1;return n(t,h8(ci(e)))}function m8(t,e){var n;return Ks(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function t0(t,e,n){var r=Qt(t)?c1:m8;return r(t,ci(e))}var g8=1/0,_8=Go&&1/Xd(new Go([,-0]))[1]==g8?function(t){return new Go(t)}:qe,y8=200;function b8(t,e,n){var r=-1,i=yb,s=t.length,o=!0,a=[],c=a;if(s>=y8){var l=_8(t);if(l)return Xd(l);o=!1,i=Zd,c=new Yo}else c=a;t:for(;++r<s;){var u=t[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function uu(t){return t&&t.length?b8(t):[]}function e0(t){console&&console.error&&console.error(`Error: ${t}`)}function v1(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function k1(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function T1(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function w8(t){return E8(t)?t.LABEL:t.name}function E8(t){return Bn(t.LABEL)&&t.LABEL!==""}class li{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Nt(this.definition,n=>{n.accept(e)})}}class Dn extends li{constructor(e){super([]),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Xo extends li{constructor(e){super(e.definition),this.orgText="",Fn(this,Dr(e,n=>n!==void 0))}}class $n extends li{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Fn(this,Dr(e,n=>n!==void 0))}}class jn extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class ui extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class hi extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class Je extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class $r extends li{constructor(e){super(e.definition),this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}}class jr extends li{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Fn(this,Dr(e,n=>n!==void 0))}}class Ne{constructor(e){this.idx=1,Fn(this,Dr(e,n=>n!==void 0))}accept(e){e.visit(this)}}function x8(t){return Et(t,hu)}function hu(t){function e(n){return Et(n,hu)}if(t instanceof Dn){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Bn(t.label)&&(n.label=t.label),n}else{if(t instanceof $n)return{type:"Alternative",definition:e(t.definition)};if(t instanceof jn)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof ui)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof hi)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:hu(new Ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof $r)return{type:"RepetitionWithSeparator",idx:t.idx,separator:hu(new Ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Je)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof jr)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Ne){const n={type:"Terminal",name:t.terminalType.name,label:w8(t.terminalType),idx:t.idx};Bn(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Li(r)?r.source:r),n}else{if(t instanceof Xo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Ws{visit(e){const n=e;switch(n.constructor){case Dn:return this.visitNonTerminal(n);case $n:return this.visitAlternative(n);case jn:return this.visitOption(n);case ui:return this.visitRepetitionMandatory(n);case hi:return this.visitRepetitionMandatoryWithSeparator(n);case $r:return this.visitRepetitionWithSeparator(n);case Je:return this.visitRepetition(n);case jr:return this.visitAlternation(n);case Ne:return this.visitTerminal(n);case Xo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function v8(t){return t instanceof $n||t instanceof jn||t instanceof Je||t instanceof ui||t instanceof hi||t instanceof $r||t instanceof Ne||t instanceof Xo}function fu(t,e=[]){return t instanceof jn||t instanceof Je||t instanceof $r?!0:t instanceof jr?t0(t.definition,r=>fu(r,e)):t instanceof Dn&&On(e,t)?!1:t instanceof li?(t instanceof Dn&&e.push(t),Br(t.definition,r=>fu(r,e))):!1}function k8(t){return t instanceof jr}function fi(t){if(t instanceof Dn)return"SUBRULE";if(t instanceof jn)return"OPTION";if(t instanceof jr)return"OR";if(t instanceof ui)return"AT_LEAST_ONE";if(t instanceof hi)return"AT_LEAST_ONE_SEP";if(t instanceof $r)return"MANY_SEP";if(t instanceof Je)return"MANY";if(t instanceof Ne)return"CONSUME";throw Error("non exhaustive match")}class du{walk(e,n=[]){Nt(e.definition,(r,i)=>{const s=gn(e.definition,i+1);if(r instanceof Dn)this.walkProdRef(r,s,n);else if(r instanceof Ne)this.walkTerminal(r,s,n);else if(r instanceof $n)this.walkFlat(r,s,n);else if(r instanceof jn)this.walkOption(r,s,n);else if(r instanceof ui)this.walkAtLeastOne(r,s,n);else if(r instanceof hi)this.walkAtLeastOneSep(r,s,n);else if(r instanceof $r)this.walkManySep(r,s,n);else if(r instanceof Je)this.walkMany(r,s,n);else if(r instanceof jr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new jn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=A1(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new jn({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=A1(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Nt(e.definition,s=>{const o=new $n({definition:[s]});this.walk(o,i)})}}function A1(t,e,n){return[new jn({definition:[new Ne({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function yc(t){if(t instanceof Dn)return yc(t.referencedRule);if(t instanceof Ne)return R8(t);if(v8(t))return T8(t);if(k8(t))return A8(t);throw Error("non exhaustive match")}function T8(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=fu(s),e=e.concat(yc(s)),r=r+1,i=n.length>r;return uu(e)}function A8(t){const e=Et(t.definition,n=>yc(n));return uu(rr(e))}function R8(t){return[t.terminalType]}const R1="_~IN~_";class S8 extends du{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=I8(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new $n({definition:s}),a=yc(o);this.follows[i]=a}}function O8(t){const e={};return Nt(t,n=>{const r=new S8(n).startWalking();Fn(e,r)}),e}function I8(t,e){return t.name+e+R1}function Ct(t){return t.charCodeAt(0)}function n0(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function bc(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function qo(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function N8(){throw Error("Internal Error - Should never get here!")}function S1(t){return t.type==="Character"}const pu=[];for(let t=Ct("0");t<=Ct("9");t++)pu.push(t);const mu=[Ct("_")].concat(pu);for(let t=Ct("a");t<=Ct("z");t++)mu.push(t);for(let t=Ct("A");t<=Ct("Z");t++)mu.push(t);const O1=[Ct(" "),Ct("\f"),Ct(`
`),Ct("\r"),Ct("	"),Ct("\v"),Ct("	"),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct(""),Ct("\u2028"),Ct("\u2029"),Ct(""),Ct(""),Ct(""),Ct("\uFEFF")],C8=/[0-9a-fA-F]/,gu=/[0-9]/,L8=/[1-9]/;class M8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":bc(r,"global");break;case"i":bc(r,"ignoreCase");break;case"m":bc(r,"multiLine");break;case"u":bc(r,"unicode");break;case"y":bc(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}qo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return N8()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;qo(n);break}if(!(e===!0&&n===void 0)&&qo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),qo(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ct(`
`),Ct("\r"),Ct("\u2028"),Ct("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=pu;break;case"D":e=pu,n=!0;break;case"s":e=O1;break;case"S":e=O1,n=!0;break;case"w":e=mu;break;case"W":e=mu,n=!0;break}if(qo(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Ct("\f");break;case"n":e=Ct(`
`);break;case"r":e=Ct("\r");break;case"t":e=Ct("	");break;case"v":e=Ct("\v");break}if(qo(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ct("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Ct(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Ct(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,S1(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,S1(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else n0(r.value,e),e.push(Ct("-")),n0(i.value,e)}else n0(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ct("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(L8.test(e)===!1)throw Error("Expecting a positive integer");for(;gu.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(gu.test(e)===!1)throw Error("Expecting an integer");for(;gu.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ct(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return gu.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(C8.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class r0{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let _u={};const U8=new M8;function yu(t){const e=t.toString();if(_u.hasOwnProperty(e))return _u[e];{const n=U8.pattern(e);return _u[e]=n,n}}function F8(){_u={}}const I1="Complement Sets are not supported for first char optimization",bu=`Unable to use "first char" lexer optimizations:
`;function B8(t,e=!1){try{const n=yu(t);return i0(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===I1)e&&v1(`${bu}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),e0(`${bu}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function i0(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)i0(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":wu(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(I1);Nt(o.value,c=>{if(typeof c=="number")wu(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)wu(u,e,n);else{for(let u=l.from;u<=l.to&&u<Ec;u++)wu(u,e,n);if(l.to>=Ec){const u=l.from>=Ec?l.from:Ec,f=l.to,d=as(u),h=as(f);for(let p=d;p<=h;p++)e[p]=p}}}});break;case"Group":i0(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&s0(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ke(e)}function wu(t,e,n){const r=as(t);e[r]=r,n===!0&&P8(t,e)}function P8(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=as(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=as(i.charCodeAt(0));e[s]=s}}}function N1(t,e){return Zo(t.value,n=>{if(typeof n=="number")return On(e,n);{const r=n;return Zo(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function s0(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Qt(t.value)?Br(t.value,s0):s0(t.value):!1}class D8 extends r0{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){On(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?N1(e,this.targetCharCodes)===void 0&&(this.found=!0):N1(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function o0(t,e){if(e instanceof RegExp){const n=yu(e),r=new D8(t);return r.visit(n),r.found}else return Zo(e,n=>On(t,n.charCodeAt(0)))!==void 0}const Hs="PATTERN",wc="defaultMode",Eu="modes";let C1=typeof new RegExp("(?:)").sticky=="boolean";function $8(t,e){e=Qd(e,{useSticky:C1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(k,T)=>T()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{l3()});let r;n("Reject Lexer.NA",()=>{r=lu(t,k=>k[Hs]===Qe.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Et(r,k=>{const T=k[Hs];if(Li(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!On(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?M1(T):L1(T)}else{if(Ii(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(A);return e.useSticky?M1(C):L1(C)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Et(r,k=>k.tokenTypeIdx),a=Et(r,k=>{const T=k.GROUP;if(T!==Qe.SKIPPED){if(Bn(T))return T;if(Mi(T))return!1;throw Error("non exhaustive match")}}),c=Et(r,k=>{const T=k.LONGER_ALT;if(T)return Qt(T)?Et(T,C=>E1(r,C)):[E1(r,T)]}),l=Et(r,k=>k.PUSH_MODE),u=Et(r,k=>Ot(k,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const k=B1(e.lineTerminatorCharacters);f=Et(r,T=>!1),e.positionTracking!=="onlyOffset"&&(f=Et(r,T=>Ot(T,"LINE_BREAKS")?!!T.LINE_BREAKS:F1(T,k)===!1&&o0(k,T.PATTERN)))});let d,h,p,m;n("Misc Mapping #2",()=>{d=Et(r,U1),h=Et(s,o3),p=Pn(r,(k,T)=>{const A=T.GROUP;return Bn(A)&&A!==Qe.SKIPPED&&(k[A]=[]),k},{}),m=Et(s,(k,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let y=!0,w=[];return e.safeMode||n("First Char Optimization",()=>{w=Pn(r,(k,T,A)=>{if(typeof T.PATTERN=="string"){const C=T.PATTERN.charCodeAt(0),R=as(C);a0(k,R,m[A])}else if(Qt(T.START_CHARS_HINT)){let C;Nt(T.START_CHARS_HINT,R=>{const S=typeof R=="string"?R.charCodeAt(0):R,U=as(S);C!==U&&(C=U,a0(k,U,m[A]))})}else if(Li(T.PATTERN))if(T.PATTERN.unicode)y=!1,e.ensureOptimizations&&e0(`${bu}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=B8(T.PATTERN,e.ensureOptimizations);_e(C)&&(y=!1),Nt(C,R=>{a0(k,R,m[A])})}else e.ensureOptimizations&&e0(`${bu}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),y=!1;return k},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:y}}function j8(t,e){let n=[];const r=K8(t);n=n.concat(r.errors);const i=W8(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(z8(s)),n=n.concat(J8(s)),n=n.concat(Q8(s,e)),n=n.concat(t3(s)),n}function z8(t){let e=[];const n=Tr(t,r=>Li(r[Hs]));return e=e.concat(G8(n)),e=e.concat(Z8(n)),e=e.concat(X8(n)),e=e.concat(q8(n)),e=e.concat(Y8(n)),e}function K8(t){const e=Tr(t,i=>!Ot(i,Hs)),n=Et(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ue.MISSING_PATTERN,tokenTypes:[i]})),r=cu(t,e);return{errors:n,valid:r}}function W8(t){const e=Tr(t,i=>{const s=i[Hs];return!Li(s)&&!Ii(s)&&!Ot(s,"exec")&&!Bn(s)}),n=Et(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ue.INVALID_PATTERN,tokenTypes:[i]})),r=cu(t,e);return{errors:n,valid:r}}const H8=/[^\\][$]/;function G8(t){class e extends r0{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Tr(t,i=>{const s=i.PATTERN;try{const o=yu(s),a=new e;return a.visit(o),a.found}catch{return H8.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ue.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Y8(t){const e=Tr(t,r=>r.PATTERN.test(""));return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ue.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const V8=/[^\\[][\^]|^\^/;function Z8(t){class e extends r0{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Tr(t,i=>{const s=i.PATTERN;try{const o=yu(s),a=new e;return a.visit(o),a.found}catch{return V8.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ue.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function X8(t){const e=Tr(t,r=>{const i=r[Hs];return i instanceof RegExp&&(i.multiline||i.global)});return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ue.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function q8(t){const e=[];let n=Et(t,s=>Pn(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!On(e,a)&&a.PATTERN!==Qe.NA&&(e.push(a),o.push(a)),o),[]));n=gc(n);const r=Tr(n,s=>s.length>1);return Et(r,s=>{const o=Et(s,c=>c.name);return{message:`The same RegExp pattern ->${Pr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ue.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function J8(t){const e=Tr(t,r=>{if(!Ot(r,"GROUP"))return!1;const i=r.GROUP;return i!==Qe.SKIPPED&&i!==Qe.NA&&!Bn(i)});return Et(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ue.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function Q8(t,e){const n=Tr(t,i=>i.PUSH_MODE!==void 0&&!On(e,i.PUSH_MODE));return Et(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ue.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function t3(t){const e=[],n=Pn(t,(r,i,s)=>{const o=i.PATTERN;return o===Qe.NA||(Bn(o)?r.push({str:o,idx:s,tokenType:i}):Li(o)&&n3(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Nt(t,(r,i)=>{Nt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&e3(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Ue.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function e3(t,e){if(Li(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Ii(e))return e(t,0,[],{});if(Ot(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function n3(t){return Zo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function L1(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function M1(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function r3(t,e,n){const r=[];return Ot(t,wc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+wc+`> property in its definition
`,type:Ue.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ot(t,Eu)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Eu+`> property in its definition
`,type:Ue.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ot(t,Eu)&&Ot(t,wc)&&!Ot(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${wc}: <${t.defaultMode}>which does not exist
`,type:Ue.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ot(t,Eu)&&Nt(t.modes,(i,s)=>{Nt(i,(o,a)=>{if(Mi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ue.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ot(o,"LONGER_ALT")){const c=Qt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Nt(c,l=>{!Mi(l)&&!On(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ue.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function i3(t,e,n){const r=[];let i=!1;const s=gc(rr(Ke(t.modes))),o=lu(s,c=>c[Hs]===Qe.NA),a=B1(n);return e&&Nt(o,c=>{const l=F1(c,a);if(l!==!1){const f={message:c3(c,l),type:l.issue,tokenType:c};r.push(f)}else Ot(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):o0(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ue.NO_LINE_BREAKS_FLAGS}),r}function s3(t){const e={},n=vr(t);return Nt(n,r=>{const i=t[r];if(Qt(i))e[r]=[];else throw Error("non exhaustive match")}),e}function U1(t){const e=t.PATTERN;if(Li(e))return!1;if(Ii(e))return!0;if(Ot(e,"exec"))return!0;if(Bn(e))return!1;throw Error("non exhaustive match")}function o3(t){return Bn(t)&&t.length===1?t.charCodeAt(0):!1}const a3={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function F1(t,e){if(Ot(t,"LINE_BREAKS"))return!1;if(Li(t.PATTERN)){try{o0(e,t.PATTERN)}catch(n){return{issue:Ue.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Bn(t.PATTERN))return!1;if(U1(t))return{issue:Ue.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function c3(t,e){if(e.issue===Ue.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Ue.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function B1(t){return Et(t,n=>Bn(n)?n.charCodeAt(0):n)}function a0(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Ec=256;let xu=[];function as(t){return t<Ec?t:xu[t]}function l3(){if(_e(xu)){xu=new Array(65536);for(let t=0;t<65536;t++)xu[t]=t>255?255+~~(t/255):t}}function xc(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function vu(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let P1=1;const D1={};function vc(t){const e=u3(t);h3(e),d3(e),f3(e),Nt(e,n=>{n.isParent=n.categoryMatches.length>0})}function u3(t){let e=mn(t),n=t,r=!0;for(;r;){n=gc(rr(Et(n,s=>s.CATEGORIES)));const i=cu(n,e);e=e.concat(i),_e(i)?r=!1:n=i}return e}function h3(t){Nt(t,e=>{j1(e)||(D1[P1]=e,e.tokenTypeIdx=P1++),z1(e)&&!Qt(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),z1(e)||(e.CATEGORIES=[]),p3(e)||(e.categoryMatches=[]),m3(e)||(e.categoryMatchesMap={})})}function f3(t){Nt(t,e=>{e.categoryMatches=[],Nt(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(D1[r].tokenTypeIdx)})})}function d3(t){Nt(t,e=>{$1([],e)})}function $1(t,e){Nt(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Nt(e.CATEGORIES,n=>{const r=t.concat(e);On(r,n)||$1(r,n)})}function j1(t){return Ot(t,"tokenTypeIdx")}function z1(t){return Ot(t,"CATEGORIES")}function p3(t){return Ot(t,"categoryMatches")}function m3(t){return Ot(t,"categoryMatchesMap")}function g3(t){return Ot(t,"tokenTypeIdx")}const _3={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var Ue;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ue||(Ue={}));const kc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:_3,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(kc);let Qe=class{constructor(e,n=kc){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=k1(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Fn({},kc,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===kc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=a3;else if(this.config.lineTerminatorCharacters===kc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Qt(e)?i={modes:{defaultMode:mn(e)},defaultMode:wc}:(s=!1,i=mn(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(r3(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(i3(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Nt(i.modes,(a,c)=>{i.modes[c]=lu(a,l=>Mi(l))});const o=vr(i.modes);if(Nt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(j8(a,o))}),_e(this.lexerDefinitionErrors)){vc(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=$8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Fn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!_e(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Et(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Nt(this.lexerDefinitionWarning,a=>{v1(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(C1?(this.chopInput=Ho,this.match=this.matchWithTest):(this.updateLastIndex=qe,this.match=this.matchWithExec),s&&(this.handleModes=qe),this.trackStartLines===!1&&(this.computeNewColumn=Ho),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=qe),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Pn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!_e(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{F8()}),this.TRACE_INIT("toFastProperties",()=>{T1(this)})})}tokenize(e,n=this.defaultMode){if(!_e(this.lexerDefinitionErrors)){const i=Et(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,y,w;const k=e,T=k.length;let A=0,C=0;const R=this.hasCustom?0:Math.floor(e.length/10),S=new Array(R),U=[];let I=this.trackStartLines?1:void 0,D=this.trackStartLines?1:void 0;const G=s3(this.emptyGroups),L=this.trackStartLines,N=this.config.lineTerminatorsPattern;let E=0,P=[],q=[];const $=[],st=[];Object.freeze(st);let nt;function ut(){return P}function V(Dt){const re=as(Dt),Ft=q[re];return Ft===void 0?st:Ft}const Y=Dt=>{if($.length===1&&Dt.tokenType.PUSH_MODE===void 0){const re=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Dt);U.push({offset:Dt.startOffset,line:Dt.startLine,column:Dt.startColumn,length:Dt.image.length,message:re})}else{$.pop();const re=Vo($);P=this.patternIdxToConfig[re],q=this.charCodeToPatternIdxToConfig[re],E=P.length;const Ft=this.canModeBeOptimized[re]&&this.config.safeMode===!1;q&&Ft?nt=V:nt=ut}};function xt(Dt){$.push(Dt),q=this.charCodeToPatternIdxToConfig[Dt],P=this.patternIdxToConfig[Dt],E=P.length,E=P.length;const re=this.canModeBeOptimized[Dt]&&this.config.safeMode===!1;q&&re?nt=V:nt=ut}xt.call(this,n);let ct;const ht=this.config.recoveryEnabled;for(;A<T;){c=null;const Dt=k.charCodeAt(A),re=nt(Dt),Ft=re.length;for(r=0;r<Ft;r++){ct=re[r];const Mt=ct.pattern;l=null;const oe=ct.short;if(oe!==!1?Dt===oe&&(c=Mt):ct.isCustom===!0?(w=Mt.exec(k,A,S,G),w!==null?(c=w[0],w.payload!==void 0&&(l=w.payload)):c=null):(this.updateLastIndex(Mt,A),c=this.match(Mt,e,A)),c!==null){if(a=ct.longerAlt,a!==void 0){const Ht=a.length;for(s=0;s<Ht;s++){const Re=P[a[s]],Be=Re.pattern;if(u=null,Re.isCustom===!0?(w=Be.exec(k,A,S,G),w!==null?(o=w[0],w.payload!==void 0&&(u=w.payload)):o=null):(this.updateLastIndex(Be,A),o=this.match(Be,e,A)),o&&o.length>c.length){c=o,l=u,ct=Re;break}}}break}}if(c!==null){if(f=c.length,d=ct.group,d!==void 0&&(h=ct.tokenTypeIdx,p=this.createTokenInstance(c,A,h,ct.tokenType,I,D,f),this.handlePayload(p,l),d===!1?C=this.addToken(S,C,p):G[d].push(p)),e=this.chopInput(e,f),A=A+f,D=this.computeNewColumn(D,f),L===!0&&ct.canLineTerminator===!0){let Mt=0,oe,Ht;N.lastIndex=0;do oe=N.test(c),oe===!0&&(Ht=N.lastIndex-1,Mt++);while(oe===!0);Mt!==0&&(I=I+Mt,D=f-Ht,this.updateTokenEndLineColumnLocation(p,d,Ht,Mt,I,D,f))}this.handleModes(ct,Y,xt,p)}else{const Mt=A,oe=I,Ht=D;let Re=ht===!1;for(;Re===!1&&A<T;)for(e=this.chopInput(e,1),A++,i=0;i<E;i++){const Be=P[i],v=Be.pattern,ot=Be.short;if(ot!==!1?k.charCodeAt(A)===ot&&(Re=!0):Be.isCustom===!0?Re=v.exec(k,A,S,G)!==null:(this.updateLastIndex(v,A),Re=v.exec(e)!==null),Re===!0)break}if(m=A-Mt,D=this.computeNewColumn(D,m),y=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(k,Mt,m,oe,Ht),U.push({offset:Mt,line:oe,column:Ht,length:m,message:y}),ht===!1)break}}return this.hasCustom||(S.length=C),{tokens:S,groups:G,errors:U}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};Qe.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Qe.NA=/NOT_APPLICABLE/;function Tc(t){return K1(t)?t.LABEL:t.name}function K1(t){return Bn(t.LABEL)&&t.LABEL!==""}const y3="parent",W1="categories",H1="label",G1="group",Y1="push_mode",V1="pop_mode",Z1="longer_alt",X1="line_breaks",q1="start_chars_hint";function ir(t){return b3(t)}function b3(t){const e=t.pattern,n={};if(n.name=t.name,Mi(e)||(n.PATTERN=e),Ot(t,y3))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ot(t,W1)&&(n.CATEGORIES=t[W1]),vc([n]),Ot(t,H1)&&(n.LABEL=t[H1]),Ot(t,G1)&&(n.GROUP=t[G1]),Ot(t,V1)&&(n.POP_MODE=t[V1]),Ot(t,Y1)&&(n.PUSH_MODE=t[Y1]),Ot(t,Z1)&&(n.LONGER_ALT=t[Z1]),Ot(t,X1)&&(n.LINE_BREAKS=t[X1]),Ot(t,q1)&&(n.START_CHARS_HINT=t[q1]),n}const Gs=ir({name:"EOF",pattern:Qe.NA});vc([Gs]);function ku(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function w3(t,e){return xc(t,e)}const J1={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${K1(t)?`--> ${Tc(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Pr(e).image+"'";if(r)return s+r+a;{const c=Pn(t,(d,h)=>d.concat(h),[]),l=Et(c,d=>`[${Et(d,h=>Tc(h)).join(", ")}]`),f=`one of these possible Token sequences:
${Et(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Pr(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Et(t,l=>`[${Et(l,u=>Tc(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(J1);const E3={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Ys={buildDuplicateFoundError(t,e){function n(u){return u instanceof Ne?u.terminalType.name:u instanceof Dn?u.nonTerminalName:""}const r=t.name,i=Pr(e),s=i.idx,o=fi(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=Et(t.prefixPath,i=>Tc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=Et(t.prefixPath,i=>Tc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=fi(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=Et(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Xo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function x3(t,e){const n=new v3(t,e);return n.resolveRefs(),n.errors}class v3 extends Ws{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Nt(Ke(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:In.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class k3 extends du{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=mn(this.path.ruleStack).reverse(),this.occurrenceStack=mn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){_e(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class T3 extends k3{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new $n({definition:i});this.possibleTokTypes=yc(s),this.found=!0}}}class Tu extends du{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class A3 extends Tu{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class Q1 extends Tu{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class R3 extends Tu{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class tw extends Tu{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ne&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function c0(t,e,n=[]){n=mn(n);let r=[],i=0;function s(a){return a.concat(gn(t,i+1))}function o(a){const c=c0(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof $n)return o(a.definition);if(a instanceof Dn)return o(a.definition);if(a instanceof jn)r=o(a.definition);else if(a instanceof ui){const c=a.definition.concat([new Je({definition:a.definition})]);return o(c)}else if(a instanceof hi){const c=[new $n({definition:a.definition}),new Je({definition:[new Ne({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof $r){const c=a.definition.concat([new Je({definition:[new Ne({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Je){const c=a.definition.concat([new Je({definition:a.definition})]);r=o(c)}else{if(a instanceof jr)return Nt(a.definition,c=>{_e(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ne)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:gn(t,i)}),r}function ew(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!_e(f);){const d=f.pop();if(d===o){a&&Vo(f).idx<=l&&f.pop();continue}const h=d.def,p=d.idx,m=d.ruleStack,y=d.occurrenceStack;if(_e(h))continue;const w=h[0];if(w===i){const k={idx:p,def:gn(h),ruleStack:_c(m),occurrenceStack:_c(y)};f.push(k)}else if(w instanceof Ne)if(p<c-1){const k=p+1,T=e[k];if(n(T,w.terminalType)){const A={idx:k,def:gn(h),ruleStack:m,occurrenceStack:y};f.push(A)}}else if(p===c-1)u.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:m,occurrenceStack:y}),a=!0;else throw Error("non exhaustive match");else if(w instanceof Dn){const k=mn(m);k.push(w.nonTerminalName);const T=mn(y);T.push(w.idx);const A={idx:p,def:w.definition.concat(s,gn(h)),ruleStack:k,occurrenceStack:T};f.push(A)}else if(w instanceof jn){const k={idx:p,def:gn(h),ruleStack:m,occurrenceStack:y};f.push(k),f.push(o);const T={idx:p,def:w.definition.concat(gn(h)),ruleStack:m,occurrenceStack:y};f.push(T)}else if(w instanceof ui){const k=new Je({definition:w.definition,idx:w.idx}),T=w.definition.concat([k],gn(h)),A={idx:p,def:T,ruleStack:m,occurrenceStack:y};f.push(A)}else if(w instanceof hi){const k=new Ne({terminalType:w.separator}),T=new Je({definition:[k].concat(w.definition),idx:w.idx}),A=w.definition.concat([T],gn(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:y};f.push(C)}else if(w instanceof $r){const k={idx:p,def:gn(h),ruleStack:m,occurrenceStack:y};f.push(k),f.push(o);const T=new Ne({terminalType:w.separator}),A=new Je({definition:[T].concat(w.definition),idx:w.idx}),C=w.definition.concat([A],gn(h)),R={idx:p,def:C,ruleStack:m,occurrenceStack:y};f.push(R)}else if(w instanceof Je){const k={idx:p,def:gn(h),ruleStack:m,occurrenceStack:y};f.push(k),f.push(o);const T=new Je({definition:w.definition,idx:w.idx}),A=w.definition.concat([T],gn(h)),C={idx:p,def:A,ruleStack:m,occurrenceStack:y};f.push(C)}else if(w instanceof jr)for(let k=w.definition.length-1;k>=0;k--){const T=w.definition[k],A={idx:p,def:T.definition.concat(gn(h)),ruleStack:m,occurrenceStack:y};f.push(A),f.push(o)}else if(w instanceof $n)f.push({idx:p,def:w.definition.concat(gn(h)),ruleStack:m,occurrenceStack:y});else if(w instanceof Xo)f.push(S3(w,p,m,y));else throw Error("non exhaustive match")}return u}function S3(t,e,n,r){const i=mn(n);i.push(t.name);const s=mn(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Fe;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Fe||(Fe={}));function nw(t){if(t instanceof jn||t==="Option")return Fe.OPTION;if(t instanceof Je||t==="Repetition")return Fe.REPETITION;if(t instanceof ui||t==="RepetitionMandatory")return Fe.REPETITION_MANDATORY;if(t instanceof hi||t==="RepetitionMandatoryWithSeparator")return Fe.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof $r||t==="RepetitionWithSeparator")return Fe.REPETITION_WITH_SEPARATOR;if(t instanceof jr||t==="Alternation")return Fe.ALTERNATION;throw Error("non exhaustive match")}function O3(t,e,n,r,i,s){const o=u0(t,e,n),a=ow(o)?vu:xc;return s(o,r,a,i)}function I3(t,e,n,r,i,s){const o=h0(t,e,i,n),a=ow(o)?vu:xc;return s(o[0],a,r)}function N3(t,e,n,r){const i=t.length,s=Br(t,o=>Br(o,a=>a.length===1));if(e)return function(o){const a=Et(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],p=h.length;for(let m=0;m<p;m++){const y=this.LA(m+1);if(n(y,h[m])===!1)continue t}return c}}};if(s&&!r){const o=Et(t,c=>rr(c)),a=Pn(o,(c,l,u)=>(Nt(l,f=>{Ot(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Nt(f.categoryMatches,d=>{Ot(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function C3(t,e,n){const r=Br(t,s=>s.length===1),i=t.length;if(r&&!n){const s=rr(t);if(s.length===1&&_e(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Pn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Nt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue t}return!0}return!1}}class L3 extends du{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,Fe.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,Fe.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,Fe.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,Fe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class rw extends Ws{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Fe.OPTION)}visitRepetition(e){this.checkIsTarget(e,Fe.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Fe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Fe.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Fe.ALTERNATION)}}function iw(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function l0(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function M3(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function sw(t,e){const n=Et(t,o=>c0([o],1)),r=iw(n.length),i=Et(n,o=>{const a={};return Nt(o,c=>{const l=l0(c.partialPath);Nt(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=iw(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=l0(f);if(M3(i,h,c)||_e(d)||f.length===e){const m=r[c];if(f0(m,f)===!1){m.push(f);for(let y=0;y<h.length;y++){const w=h[y];i[c][w]=!0}}}else{const m=c0(d,o+1,f);s[c]=s[c].concat(m),Nt(m,y=>{const w=l0(y.partialPath);Nt(w,k=>{i[c][k]=!0})})}}}}return r}function u0(t,e,n,r){const i=new rw(t,Fe.ALTERNATION,r);return e.accept(i),sw(i.result,n)}function h0(t,e,n,r){const i=new rw(t,n);e.accept(i);const s=i.result,a=new L3(e,t,n).startWalking(),c=new $n({definition:s}),l=new $n({definition:a});return sw([c,l],r)}function f0(t,e){t:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function U3(t,e){return t.length<e.length&&Br(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function ow(t){return Br(t,e=>Br(e,n=>Br(n,r=>_e(r.categoryMatches))))}function F3(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return Et(e,n=>Object.assign({type:In.CUSTOM_LOOKAHEAD_VALIDATION},n))}function B3(t,e,n,r){const i=Ar(t,c=>P3(c,n)),s=X3(t,e,n),o=Ar(t,c=>G3(c,n)),a=Ar(t,c=>j3(c,t,r,n));return i.concat(s,o,a)}function P3(t,e){const n=new $3;t.accept(n);const r=n.allProductions,i=w1(r,D3),s=Dr(i,a=>a.length>1);return Et(Ke(s),a=>{const c=Pr(a),l=e.buildDuplicateFoundError(t,a),u=fi(c),f={message:l,type:In.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=aw(c);return d&&(f.parameter=d),f})}function D3(t){return`${fi(t)}_#_${t.idx}_#_${aw(t)}`}function aw(t){return t instanceof Ne?t.terminalType.name:t instanceof Dn?t.nonTerminalName:""}class $3 extends Ws{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function j3(t,e,n,r){const i=[];if(Pn(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:In.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function z3(t,e,n){const r=[];let i;return On(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:In.INVALID_RULE_OVERRIDE,ruleName:t})),r}function cw(t,e,n,r=[]){const i=[],s=Au(e.definition);if(_e(s))return[];{const o=t.name;On(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:In.LEFT_RECURSION,ruleName:o});const c=cu(s,r.concat([t])),l=Ar(c,u=>{const f=mn(r);return f.push(u),cw(t,u,n,f)});return i.concat(l)}}function Au(t){let e=[];if(_e(t))return e;const n=Pr(t);if(n instanceof Dn)e.push(n.referencedRule);else if(n instanceof $n||n instanceof jn||n instanceof ui||n instanceof hi||n instanceof $r||n instanceof Je)e=e.concat(Au(n.definition));else if(n instanceof jr)e=rr(Et(n.definition,s=>Au(s.definition)));else if(!(n instanceof Ne))throw Error("non exhaustive match");const r=fu(n),i=t.length>1;if(r&&i){const s=gn(t);return e.concat(Au(s))}else return e}class d0 extends Ws{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function K3(t,e){const n=new d0;t.accept(n);const r=n.alternations;return Ar(r,s=>{const o=_c(s.definition);return Ar(o,(a,c)=>{const l=ew([a],[],xc,1);return _e(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:In.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function W3(t,e,n){const r=new d0;t.accept(r);let i=r.alternations;return i=lu(i,o=>o.ignoreAmbiguities===!0),Ar(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=u0(a,t,c,o),u=V3(l,o,t,n),f=Z3(l,o,t,n);return u.concat(f)})}class H3 extends Ws{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function G3(t,e){const n=new d0;t.accept(n);const r=n.alternations;return Ar(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:In.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function Y3(t,e,n){const r=[];return Nt(t,i=>{const s=new H3;i.accept(s);const o=s.allProductions;Nt(o,a=>{const c=nw(a),l=a.maxLookahead||e,u=a.idx,d=h0(u,i,c,l)[0];if(_e(rr(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:In.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function V3(t,e,n,r){const i=[],s=Pn(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Nt(c,u=>{const f=[l];Nt(t,(d,h)=>{l!==h&&f0(d,u)&&e.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!f0(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return Et(s,a=>{const c=Et(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:In.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function Z3(t,e,n,r){const i=Pn(t,(o,a,c)=>{const l=Et(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return gc(Ar(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Tr(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&U3(d.path,l));return Et(u,d=>{const h=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:d.path}),type:In.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function X3(t,e,n){const r=[],i=Et(e,s=>s.name);return Nt(t,s=>{const o=s.name;if(On(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:In.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function q3(t){const e=Qd(t,{errMsgProvider:E3}),n={};return Nt(t.rules,r=>{n[r.name]=r}),x3(n,e.errMsgProvider)}function J3(t){return t=Qd(t,{errMsgProvider:Ys}),B3(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const lw="MismatchedTokenException",uw="NoViableAltException",hw="EarlyExitException",fw="NotAllInputParsedException",dw=[lw,uw,hw,fw];Object.freeze(dw);function Ru(t){return On(dw,t.name)}class Su extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class pw extends Su{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=lw}}class Q3 extends Su{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=uw}}class tU extends Su{constructor(e,n){super(e,n),this.name=fw}}class eU extends Su{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=hw}}const p0={},mw="InRuleRecoveryException";class nU extends Error{constructor(e){super(e),this.name=mw}}class rU{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ot(e,"recoveryEnabled")?e.recoveryEnabled:Ui.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=iU)}getTokenToInsert(e){const n=ku(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new pw(h,l,this.LA(0));p.resyncedTokens=_c(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new nU("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||_e(n))return!1;const r=this.LA(1);return Zo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return On(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Zo(e,s=>w3(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return p0;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Et(e,(r,i)=>i===0?p0:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Et(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return rr(e)}getFollowSetFromFollowKey(e){if(e===p0)return[Gs];const n=e.ruleName+e.idxInCallingRule+R1+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Gs)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return _c(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=mn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Et(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function iU(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=Gs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const sU=4,cs=8,gw=1<<cs,_w=2<<cs,m0=3<<cs,g0=4<<cs,_0=5<<cs,Ou=6<<cs;function y0(t,e,n){return n|e|t}class oU{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Ui.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(_e(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Ar(e,n=>cw(n,n,Ys))}validateEmptyOrAlternatives(e){return Ar(e,n=>K3(n,Ys))}validateAmbiguousAlternationAlternatives(e,n){return Ar(e,r=>W3(r,n,Ys))}validateSomeNonEmptyLookaheadPath(e,n){return Y3(e,n,Ys)}buildLookaheadForAlternation(e){return O3(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,N3)}buildLookaheadForOptional(e){return I3(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,nw(e.prodType),C3)}}class aU{initLooksAhead(e){this.dynamicTokensEnabled=Ot(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Ui.dynamicTokensEnabled,this.maxLookahead=Ot(e,"maxLookahead")?e.maxLookahead:Ui.maxLookahead,this.lookaheadStrategy=Ot(e,"lookaheadStrategy")?e.lookaheadStrategy:new oU({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Nt(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=lU(n);Nt(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${fi(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=y0(this.fullRuleNameToShort[n.name],gw,l.idx);this.setLaFuncCache(d,f)})}),Nt(i,l=>{this.computeLookaheadFunc(n,l.idx,m0,"Repetition",l.maxLookahead,fi(l))}),Nt(s,l=>{this.computeLookaheadFunc(n,l.idx,_w,"Option",l.maxLookahead,fi(l))}),Nt(o,l=>{this.computeLookaheadFunc(n,l.idx,g0,"RepetitionMandatory",l.maxLookahead,fi(l))}),Nt(a,l=>{this.computeLookaheadFunc(n,l.idx,Ou,"RepetitionMandatoryWithSeparator",l.maxLookahead,fi(l))}),Nt(c,l=>{this.computeLookaheadFunc(n,l.idx,_0,"RepetitionWithSeparator",l.maxLookahead,fi(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=y0(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return y0(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class cU extends Ws{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Iu=new cU;function lU(t){Iu.reset(),t.accept(Iu);const e=Iu.dslMethods;return Iu.reset(),e}function yw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function bw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function uU(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function hU(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const fU="name";function ww(t,e){Object.defineProperty(t,fU,{enumerable:!1,configurable:!0,writable:!1,value:e})}function dU(t,e){const n=vr(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function pU(t,e){const n=function(){};ww(n,t+"BaseSemantics");const r={visit:function(i,s){if(Qt(i)&&(i=i[0]),!Mi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=gU(this,e);if(!_e(i)){const s=Et(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function mU(t,e,n){const r=function(){};ww(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Nt(e,s=>{i[s]=dU}),r.prototype=i,r.prototype.constructor=r,r}var b0;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(b0||(b0={}));function gU(t,e){return _U(t,e)}function _U(t,e){const n=Tr(e,i=>Ii(t[i])===!1),r=Et(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:b0.MISSING_METHOD,methodName:i}));return gc(r)}class yU{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Ot(e,"nodeLocationTracking")?e.nodeLocationTracking:Ui.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=qe,this.cstFinallyStateUpdate=qe,this.cstPostTerminal=qe,this.cstPostNonTerminal=qe,this.cstPostRule=qe;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=bw,this.setNodeLocationFromNode=bw,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=yw,this.setNodeLocationFromNode=yw,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=qe,this.setInitialNodeLocation=qe;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];uU(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];hU(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Mi(this.baseCstVisitorConstructor)){const e=pU(this.className,vr(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Mi(this.baseCstVisitorWithDefaultsConstructor)){const e=mU(this.className,vr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class bU{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Lu}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Lu:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class wU{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Mu){if(On(this.definedRulesNames,e)){const o={message:Ys.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:In.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Mu){const i=z3(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Ru(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return x8(Ke(this.gastProductionsCache))}}class EU{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=vu,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ot(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Qt(e)){if(_e(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Qt(e))this.tokensMap=Pn(e,(s,o)=>(s[o.name]=o,s),{});else if(Ot(e,"modes")&&Br(rr(Ke(e.modes)),g3)){const s=rr(Ke(e.modes)),o=uu(s);this.tokensMap=Pn(o,(a,c)=>(a[c.name]=c,a),{})}else if(xr(e))this.tokensMap=mn(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Gs;const r=Ot(e,"modes")?rr(Ke(e.modes)):Ke(e),i=Br(r,s=>_e(s.categoryMatches));this.tokenMatcher=i?vu:xc,vc(Ke(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ot(r,"resyncEnabled")?r.resyncEnabled:Mu.resyncEnabled,s=Ot(r,"recoveryValueFunc")?r.recoveryValueFunc:Mu.recoveryValueFunc,o=this.ruleShortNameIdx<<sU+cs;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Ru(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(_w,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(g0,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Fe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,g0,e,R3)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ou,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,tw],a,Ou,e,tw)}else throw this.raiseEarlyExitException(e,Fe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(m0,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,m0,e,A3,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(_0,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Q1],a,_0,e,Q1)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Ou,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(gw,n),i=Qt(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new tU(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Ru(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new pw(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===mw?r:s}}else throw r}saveRecogState(){const e=this.errors,n=mn(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Gs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class xU{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Ot(e,"errorMessageProvider")?e.errorMessageProvider:Ui.errorMessageProvider}SAVE_ERROR(e){if(Ru(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:mn(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return mn(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=h0(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new eU(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=u0(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Q3(c,this.LA(1),a))}}class vU{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Mi(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return ew([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Pr(e.ruleStack),i=this.getGAstProductions()[n];return new T3(i,e).startWalking()}}const Nu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Nu);const Ew=!0,xw=Math.pow(2,cs)-1,vw=ir({name:"RECORDING_PHASE_TOKEN",pattern:Qe.NA});vc([vw]);const kw=ku(vw,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(kw);const kU={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class TU{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Lu}topLevelRuleRecord(e,n){try{const r=new Xo({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Ac.call(this,jn,e,n)}atLeastOneInternalRecord(e,n){Ac.call(this,ui,n,e)}atLeastOneSepFirstInternalRecord(e,n){Ac.call(this,hi,n,e,Ew)}manyInternalRecord(e,n){Ac.call(this,Je,n,e)}manySepFirstInternalRecord(e,n){Ac.call(this,$r,n,e,Ew)}orInternalRecord(e,n){return AU.call(this,e,n)}subruleInternalRecord(e,n,r){if(Cu(n),!e||Ot(e,"ruleName")===!1){const a=new Error(`<SUBRULE${Tw(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Vo(this.recordingProdStack),s=e.ruleName,o=new Dn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?kU:Nu}consumeInternalRecord(e,n,r){if(Cu(n),!j1(e)){const o=new Error(`<CONSUME${Tw(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Vo(this.recordingProdStack),s=new Ne({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),kw}}function Ac(t,e,n,r=!1){Cu(n);const i=Vo(this.recordingProdStack),s=Ii(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),Ot(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Nu}function AU(t,e){Cu(e);const n=Vo(this.recordingProdStack),r=Qt(t)===!1,i=r===!1?t:t.DEF,s=new jr({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});Ot(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=t0(i,a=>Ii(a.GATE));return s.hasPredicates=o,n.definition.push(s),Nt(i,a=>{const c=new $n({definition:[]});s.definition.push(c),Ot(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ot(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Nu}function Tw(t){return t===0?"":`${t}`}function Cu(t){if(t<0||t>xw){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${xw+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class RU{initPerformanceTracer(e){if(Ot(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ui.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=k1(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function SU(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Lu=ku(Gs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Lu);const Ui=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:J1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Mu=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var In;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(In||(In={}));let w0=class $x{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{T1(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Nt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=q3({rules:Ke(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(_e(r)&&this.skipValidations===!1){const i=J3({rules:Ke(this.gastProductionsCache),tokenTypes:Ke(this.tokensMap),errMsgProvider:Ys,grammarName:n}),s=F3({lookaheadStrategy:this.lookaheadStrategy,rules:Ke(this.gastProductionsCache),tokenTypes:Ke(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),_e(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=O8(Ke(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ke(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ke(this.gastProductionsCache))})),!$x.DEFER_DEFINITION_ERRORS_HANDLING&&!_e(this.definitionErrors))throw e=Et(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Ot(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ot(n,"skipValidations")?n.skipValidations:Ui.skipValidations}};w0.DEFER_DEFINITION_ERRORS_HANDLING=!1,SU(w0,[rU,aU,yU,bU,EU,wU,xU,vU,TU,RU]);class OU extends w0{constructor(e,n=Ui){const r=mn(n);r.outputCst=!0,super(e,r)}}function IU(t){const e=new NU,n=Ke(t);return Et(n,r=>e.visitRule(r))}class NU extends Ws{visitRule(e){const n=this.visitEach(e.definition),r=w1(n,s=>s.propertyName),i=Et(r,(s,o)=>{const a=!t0(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Et(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Uu(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Uu(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Uu(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Uu(e)}]}visitEachAndOverrideWith(e,n){return Et(this.visitEach(e),r=>Fn({},r,n))}visitEach(e){return rr(Et(e,n=>this.visit(n)))}}function Uu(t){return t instanceof Dn?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function CU(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(rr(Et(t,r=>LU(r)))),e.includeVisitorInterface&&(n=n.concat(BU(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function LU(t){const e=MU(t),n=UU(t);return[e,n]}function MU(t){const e=Rw(t.name),n=E0(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function UU(t){return`export type ${E0(t.name)} = {
  ${Et(t.properties,n=>FU(n)).join(`
  `)}
};`}function FU(t){const e=DU(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function BU(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Et(e,n=>PU(n)).join(`
  `)}
}`}function PU(t){const e=E0(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function DU(t){if(Qt(t)){const e=uu(Et(t,r=>Aw(r)));return"("+Pn(e,(r,i)=>r+" | "+i)+")"}else return Aw(t)}function Aw(t){return t.kind==="token"?"IToken":Rw(t.name)}function Rw(t){return zb(t)+"CstNode"}function E0(t){return zb(t)+"CstChildren"}const $U={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function jU(t,e){const n=Object.assign(Object.assign({},$U),e),r=IU(t);return CU(r,n)}const di=!!JSON.parse("false"),zU=!!JSON.parse("false");JSON.parse("false");const KU=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Fi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Ko*Fi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Wo*Fi.DRAW_CHAR_SCALE}},Fu=py(32,126).map(t=>String.fromCharCode(t));function Wt(t){return ir({...t,name:`token_${t.name}`})}function ls(t,e=!1){return Wt(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:_n,group:Qe.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:_n})}const Rc=Wt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),WU=Wt({name:"whitespace",pattern:/ +/,group:Qe.SKIPPED}),HU=Wt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Qe.SKIPPED}),x0=Wt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Jo=Wt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Sw=!1;function GU(t,e,n){if(!Sw)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Rc)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const Ow=Wt({name:"text",pattern:GU,line_breaks:!1,start_chars_hint:Fu.filter(t=>"@#/?':!".includes(t)===!1)}),Iw=Wt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Nw=Wt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Cw=Wt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Lw=Wt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),_n=Wt({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:Fu}),Mw=Wt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Uw=Wt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Fw=Wt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:_n}),Bw=Wt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:_n}),Pw=Wt({name:"islessthan",pattern:/<|below/,longer_alt:_n}),Dw=Wt({name:"isgreaterthan",pattern:/>|above/,longer_alt:_n}),$w=Wt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:_n}),jw=Wt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:_n}),v0=Wt({name:"or",pattern:/or/i,longer_alt:_n}),k0=Wt({name:"not",pattern:/not/i,longer_alt:_n}),T0=Wt({name:"and",pattern:/and/i,longer_alt:_n}),A0=Wt({name:"plus",pattern:/\+/}),R0=Wt({name:"minus",pattern:/-/}),zw=Wt({name:"power",pattern:/\*\*/}),Kw=Wt({name:"multiply",pattern:/\*/}),S0=Wt({name:"divide",pattern:/\//}),Ww=Wt({name:"moddivide",pattern:/%/}),Hw=Wt({name:"floordivide",pattern:/%%/}),Gw=Wt({name:"query",pattern:/\?/}),Yw=Wt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Vw=Wt({name:"rparen",pattern:/\)/,pop_mode:!0}),Zw=Wt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Fu,longer_alt:_n}),Xw=Wt({name:"command_toast",pattern:/toast .*/,start_chars_hint:Fu,longer_alt:_n}),O0=Wt({name:"if",pattern:/if|try|take|give/,longer_alt:_n}),Bu=ls("do"),I0=ls("done"),N0=ls("else"),qw=ls("while"),Jw=ls("repeat"),Qw=ls("waitfor"),tE=Wt({name:"foreach",pattern:/foreach|for/,longer_alt:_n}),eE=ls("break"),nE=ls("continue");function rE(t){return[...t,Uw,Fw,Bw,$w,Pw,jw,Dw,v0,k0,T0,A0,R0,zw,Kw,S0,Hw,Ww,Gw,Yw,Vw,Mw,_n]}const iE=rE([Ow,x0,Zw,Xw,Jo,Iw,Nw,Cw,Lw,Rc,WU,eE,nE,I0,Bu,N0,tE,O0,Jw,Qw,qw]),YU=new Qe({defaultMode:"use_newlines",modes:{use_newlines:iE,ignore_newlines:rE([HU])}},{skipValidations:!di,ensureOptimizations:di,positionTracking:"full"});function sE(t){Sw=!0;const e=YU.tokenize(t||` 
`),[n]=(ae(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(ku(Rc,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function VU(t,e,n=!0){if(n){const[r,...i]=e;switch(It(r??"")){default:return{type:vt.OBJECT,values:e};case"loader":return{type:vt.LOADER,values:i};case"board":return{type:vt.BOARD,values:i};case"object":return{type:vt.OBJECT,values:i};case"terrain":return{type:vt.TERRAIN,values:i};case"charset":return{type:vt.CHARSET,values:i};case"palette":return{type:vt.PALETTE,values:i}}}else{const[r,i,...s]=e,o=It(i??""),a=[r,t,...s];switch(o){default:return{type:vt.CONST,values:e};case"rn":case"range":return{type:vt.RANGE,values:a};case"sl":case"select":return{type:vt.SELECT,values:a};case"nm":case"number":return{type:vt.NUMBER,values:a};case"tx":case"text":return{type:vt.TEXT,values:a};case"hk":case"hotkey":return{type:vt.HOTKEY,values:a};case"copyit":return{type:vt.COPYIT,values:a};case"openit":return{type:vt.OPENIT,values:a};case"zssedit":return{type:vt.ZSSEDIT,values:a};case"charedit":return{type:vt.CHAREDIT,values:a};case"coloredit":return{type:vt.COLOREDIT,values:a}}}}function sr(t){switch(t){case vt.LOADER:return"loader";case vt.BOARD:return"board";case vt.OBJECT:return"object";case vt.TERRAIN:return"terrain";case vt.CHARSET:return"charset";case vt.PALETTE:return"palette";case vt.CONST:return"const";case vt.RANGE:return"range";case vt.SELECT:return"select";case vt.NUMBER:return"number";case vt.TEXT:return"text";case vt.HOTKEY:return"hotkey";case vt.COPYIT:return"copyit";case vt.OPENIT:return"openit";case vt.ZSSEDIT:return"zssedit";case vt.CHAREDIT:return"charedit";case vt.COLOREDIT:return"coloredit"}}var C0=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(C0||{});function oE(t){return $o(t,C0,{bits:e=>Array.from(e)})}function aE(t){return rc(t,C0,{bits:e=>new Uint8Array(e)})}function ZU(t,e){return{id:Pe(),code:t,...e}}var L0=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(L0||{});function XU(t){return $o(t,L0,{board:QI,object:zl,terrain:zl,charset:oE,palette:oE,stats:Ae})}function qU(t){return rc(t,L0,{board:tN,object:Kl,terrain:Kl,charset:aE,palette:aE})}function Sc(t){const e={...Vs(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function JU(t){return x(t)?(t.stats=void 0,Vs(t)):{}}function cE(t){const e=sE(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===x0){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=VU(bt(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case vt.LOADER:n.type=_t.LOADER,n.name=f;break;case vt.BOARD:n.type=_t.BOARD,n.name=f;break;case vt.OBJECT:n.type=_t.OBJECT,n.name=f||"object";break;case vt.TERRAIN:n.type=_t.TERRAIN,n.name=f;break;case vt.CHARSET:n.type=_t.CHARSET,n.name=f;break;case vt.PALETTE:n.type=_t.PALETTE,n.name=f;break;case vt.CONST:{const[d,h]=u.values;if(bt(d)){const p=It(d);if(bt(h)){const m=parseFloat(h);n[p]=At(m)?m:h}else At(h)?n[p]=h:n[p]=1}break}case vt.RANGE:case vt.SELECT:case vt.NUMBER:case vt.TEXT:case vt.HOTKEY:case vt.ZSSEDIT:case vt.CHAREDIT:case vt.COLOREDIT:{const[d,...h]=u.values;if(bt(d)){const p=It(d);n[p]=[sr(u.type),...h]}break}}}}return n}function Vs(t){var e;return x(t)?(x((e=t.stats)==null?void 0:e.type)||(t.stats=cE(t.code),x(t.stats.type)||(t.stats.type=_t.OBJECT)),t.stats):{}}function lE(t){switch(t){default:case _t.ERROR:return"error";case _t.LOADER:return sr(vt.LOADER);case _t.BOARD:return sr(vt.BOARD);case _t.OBJECT:return sr(vt.OBJECT);case _t.TERRAIN:return sr(vt.TERRAIN);case _t.CHARSET:return sr(vt.CHARSET);case _t.PALETTE:return sr(vt.PALETTE)}}function Bi(t){return Vs(t).type??_t.ERROR}function us(t){return lE(Bi(t))}function We(t){return Vs(t).name??""}function M0(t,e){return Vs(t)[e]}const Pu=new sd;function U0(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!ae(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"ispushable":e.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=$t.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=$t.ISSWIM;break;case"issolid":e.collision=$t.ISSOLID;break;case"isbullet":e.collision=$t.ISBULLET;break;case"isdestructible":e.destructible=1;break}}}function Ce(t){var e;if(x(t))switch(Bi(t)){default:return;case _t.ERROR:return t.code??"";case _t.LOADER:return t.code??"";case _t.BOARD:{x(t.board)||(t.board=Ed()),t.board.id=t.id;const n=Sc(t);return t.board.isdark=n.isdark??t.board.isdark?1:0,t.board.startx=n.startx??t.board.startx,t.board.starty=n.starty??t.board.starty,t.board.over=n.over??t.board.over,t.board.under=n.under??t.board.under,t.board.camera=n.camera??t.board.camera,t.board.graphics=n.graphics??t.board.graphics,t.board.facing=n.facing??t.board.facing,t.board.exitnorth=n.exitnorth??t.board.exitnorth,t.board.exitsouth=n.exitsouth??t.board.exitsouth,t.board.exitwest=n.exitwest??t.board.exitwest,t.board.exiteast=n.exiteast??t.board.exiteast,t.board.timelimit=n.timelimit??t.board.timelimit,t.board.restartonzap=n.restartonzap??t.board.restartonzap,t.board.maxplayershots=n.maxplayershots??t.board.maxplayershots,t.board}case _t.OBJECT:return x(t.object)||(t.object=qy()),t.object.id=t.id,t.object.name=We(t),t.object.category=fr.ISOBJECT,U0(Sc(t),t.object),t.object;case _t.TERRAIN:return x(t.terrain)||(t.terrain=qy()),t.terrain.id=t.id,t.terrain.name=We(t),t.terrain.category=fr.ISTERRAIN,U0(Sc(t),t.terrain),t.terrain;case _t.PALETTE:{if(x(t.palette)||(t.palette=Ad(sb)),x((e=t.palette)==null?void 0:e.bits)){const n=Sc(t),r=hr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&bt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Pu.set(o);const c=a*ac,l=Pu.r*63,u=Pu.g*63,f=Pu.b*63;t.palette.bits[c+0]=Xe(l,0,63),t.palette.bits[c+1]=Xe(u,0,63),t.palette.bits[c+2]=Xe(f,0,63)}}}}return t.palette}case _t.CHARSET:return x(t.charset)||(t.charset=ib(yN)),t.charset}}function uE(t){return{id:Pe(),name:ev(),timestamp:0,activelist:[],pages:t,flags:{}}}var F0=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))(F0||{});function QU(t){return $o(t,F0,{pages:e=>e.map(XU),flags:e=>{const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function tF(t){return rc(t,F0,{pages:e=>e.map(qU)})}function hE(t){x(t)&&(t.token=`${nv()}${yr(1111,9999)}`)}function Pi(t,e){if(!x(t))return;const n=It(e);return t.pages.find(i=>i.id===e||n===We(i))}function tn(t,e,n){if(!x(t))return;const r=It(n);return t.pages.find(s=>Bi(s)===e&&(s.id===n||r===We(s)))}function B0(t,e,n){let r=tn(t,e,n);if(!x(r)){const i=lE(e);r=ZU(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),dE(t,r)}return r}function Zs(t,e){return x(t)?t.pages.filter(n=>Bi(n)===e):[]}function zn(t,e,n){if(!x(t))return[];const r=It(n);return t.pages.filter(s=>Bi(s)===e).filter(s=>{const o=Vs(s),a=It(We(s));return s.id===n||r===a||x(o[n])})}function P0(t){return x(t)?Zn(t.pages).sort((n,r)=>{const i=Bi(n),s=Bi(r);return i===s?We(n).localeCompare(We(r)):s-i}):[]}function fE(t,e){if(x(e)){const n=tn(t,_t.TERRAIN,e.kind??"");if(x(n))return n;const r=tn(t,_t.OBJECT,e.kind??"");if(x(r))return r}}function dE(t,e){if(!x(t)||!x(e))return!1;const n=Pi(t,e.id);return x(n)?!1:(t.pages.push(e),hE(t),!0)}function pE(t,e){const n=Pi(t,e);if(x(t)&&x(n)){const r=It(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==We(i)),hE(t),n}}function Di(t,e){if(x(e)&&x(e.kind))return x(e.kinddata)||(e.kinddata=x(e.id)?Xs(t,e.kind):Oc(t,e.kind)),e.kinddata}function He(t,e,n){const r=Di(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])??M0(Pi(t,(r==null?void 0:r.id)??""),n)}let eF=0;function hs(t,e){const n=He(t,e,"group");if(bt(n))return n;const r=He(t,e==null?void 0:e.kinddata,"group");return bt(r)?r:`group${eF++}`}function Du(t,e,n,r,i){const s=Di(t,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??n,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function Xs(t,e){const n=e??"",r=tn(t,_t.OBJECT,n);if(x(r)){const i=Ce(r);return{...Zn(i),name:n,code:r.code}}}function Oc(t,e){const n=e??"",r=tn(t,_t.TERRAIN,n);if(x(r)){const i=Ce(r);return{...Zn(i),name:n,code:r.code}}}function fs(t,e){const n=Pi(t,e);return Ce(n)}function nF(t,e){return!!(t!=null&&t.flags[e])}function $i(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function mE(t,e){t&&delete t.flags[e]}function gE(t,e,n){const r=$i(t,e);return r==null?void 0:r[n]}function rF(t,e,n,r){const i=$i(t,e);return i&&(i[n]=r),r}function qs(t,e){const n=gE(t,e,"board");return fs(t,bt(n)?n:"")}function iF(t,e){return(t==null?void 0:t.activelist.includes(e))??!1}function $u(t,e,n){if(!x(t))return;rF(t,e,"board",n);const r=fs(t,n);x(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function Qo(t,e,n,r){if(!x(t))return;const i=qs(t,e);if(!x(i))return;const s=Rn(i,e);if(!wn(s)||!(s!=null&&s.id))return;const o=fs(t,n);if(!x(o)||(Ge(t,o),z0(t,o,$t.ISWALK,r)))return;delete i.objects[s.id];const a=Ur(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Ur(o,s);o.lookup&&(o.lookup[c]=s.id),$u(t,e,o.id)}function sF(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=gE(t,r,"board");return bt(i)?i:""});return wI(n)}function D0(t){const e=sF(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=fs(t,e[i]);if(x(s)&&!n.has(s.id)){if(bt(s.over))if(bt(s.overboard)){const o=fs(t,s.overboard);x(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=zn(t,_t.BOARD,s.over);if(o.length){const a=Te(o),c=Ce(a);x(c)&&(s.overboard=c.id)}}else bt(s.overboard)&&delete s.overboard;if(r.push(s),bt(s.under))if(bt(s.underboard)){const o=fs(t,s.underboard);x(o)||delete s.underboard}else{const o=zn(t,_t.BOARD,s.under);if(o.length){const a=Te(o),c=Ce(a);x(c)&&(s.underboard=c.id)}}else bt(s.underboard)&&delete s.underboard}}return r}function oF(t,e,n,r,i){if(!x(e))return;x(e.distmaps)||(e.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=e.distmaps[s];if(!x(o)){o=new Array(wd).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(x(l)&&Wl(l)){const u=Lo(l,St);if(o[u]===-2){const f=jo(e,l.x,l.y);zo(n,He(t,f,"collision")??$t.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}e.distmaps[s]=o}return o}function _E(t,e){return Wl(t)?e[Lo(t,St)]:-1}function yE(t,e,n,r,i,s){if(!x(t)||!x(e))return;const o=oF(t,e,n,r,i);if(!x(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const f=_E(a[u],o);f>=0&&f>l&&(l=f,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const f=_E(a[u],o);f>=0&&f<l&&(l=f,c=a[u])}}return c}function Ge(t,e){var a;if(!x(t)||!x(e)||x(e.lookup)&&x(e.named))return;const n=new Array(St*Yt).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(x(l.x)&&x(l.y)&&x(l.id)&&!x(l.removed)){l.category=fr.ISOBJECT,n[l.x+l.y*St]=l.id;const u=It(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(x(l)){l.x=s,l.y=o,l.category=fr.ISTERRAIN;const u=is(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=St&&(s=0,++o)}e.lookup=n,e.named=r}function ju(t,e){x(e)&&(delete e.named,delete e.lookup,Ge(t,e))}function bE(t,e,n,r){var s;if(!x(t)||!x(e)||!x(e.named)||!x(n))return;const i=It(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function aF(t,e,n){if(!(!x(t)||!x(e)||!x(e.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*St]=n.id}}function cF(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.x)&&x(n.y)){const i=is(n),s=Ur(e,n);x((r=e.named)==null?void 0:r[i])&&e.named[i].delete(s)}}function $0(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.id)){if(x(e.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*St;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=is(n);x((r=e.named)==null?void 0:r[i])&&x(n.id)&&e.named[i].delete(n.id)}}function j0(t,e,n,r,i,s){const o=pt.MID;if(!x(t)||!x(e)||!x(n))return{dir:i,startpt:s,destpt:s,layer:o};const a={x:n.x??0,y:n.y??0},c={x:n.lx??a.x,y:n.ly??a.y},l=Ri(c,a),u=St-1,f=Yt-1;for(let d=0;d<i.length;++d){const h=xI(i[d]);switch(h){case pt.IDLE:break;case pt.NORTH:case pt.SOUTH:case pt.WEST:case pt.EAST:ze(a,h);break;case pt.BY:{const[p,m]=i.slice(d+1);At(p)&&At(m)&&(a.x=Xe(a.x+p,0,u),a.y=Xe(a.y+m,0,f)),d+=2;break}case pt.TO:case pt.AT:{const[p,m]=i.slice(d+1);At(p)&&At(m)&&(a.x=Xe(p,0,u),a.y=Xe(m,0,f)),d+=2;break}case pt.FLOW:ze(a,l);break;case pt.SEEK:{const p=iN(e,n,r);Bo(p)&&ze(a,Ri(s,p));break}case pt.RNDNS:ze(a,Te(pt.NORTH,pt.SOUTH));break;case pt.RNDNE:ze(a,Te(pt.NORTH,pt.EAST));break;case pt.RND:ze(a,Te(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));break;case pt.CW:case pt.CCW:case pt.OPP:case pt.RNDP:{const p=j0(t,e,n,r,i.slice(d+1),s);switch(a.x=s.x,a.y=s.y,h){case pt.CW:switch(Ri(s,p.destpt)){case pt.NORTH:ze(a,pt.EAST);break;case pt.SOUTH:ze(a,pt.WEST);break;case pt.EAST:ze(a,pt.SOUTH);break;case pt.WEST:ze(a,pt.NORTH);break}break;case pt.CCW:switch(Ri(s,p.destpt)){case pt.NORTH:ze(a,pt.WEST);break;case pt.SOUTH:ze(a,pt.EAST);break;case pt.EAST:ze(a,pt.NORTH);break;case pt.WEST:ze(a,pt.SOUTH);break}break;case pt.OPP:switch(Ri(s,p.destpt)){case pt.NORTH:ze(a,pt.SOUTH);break;case pt.SOUTH:ze(a,pt.NORTH);break;case pt.EAST:ze(a,pt.WEST);break;case pt.WEST:ze(a,pt.EAST);break}break;case pt.RNDP:switch(Ri(s,p.destpt)){case pt.NORTH:case pt.SOUTH:a.x+=Te(-1,1);break;case pt.WEST:case pt.EAST:a.y+=Te(-1,1);break}break}break}case pt.FLEE:case pt.AWAY:{const[p,m]=i.slice(d+1);if(At(p)&&At(m)){const y={x:Xe(p,0,u),y:Xe(m,0,f)},w=He(t,n,"collision"),k=yE(t,e,w,a,y,!0);x(k)&&(a.x=k.x,a.y=k.y)}d+=2;break}case pt.FIND:case pt.TOWARD:{const[p,m]=i.slice(d+1);if(At(p)&&At(m)){const y={x:Xe(p,0,u),y:Xe(m,0,f)};if(yr(1,100)<5)ze(a,Te(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));else{const w=He(t,n,"collision"),k=yE(t,e,w,a,y,!1);if(x(k))if(k.x!==p&&k.y!==m&&rN(e,k))switch(Ri(s,k)){case pt.EAST:case pt.WEST:a.y+=Te(-1,1);break;case pt.NORTH:case pt.SOUTH:a.x+=Te(-1,1);break}else a.x=k.x,a.y=k.y}}d+=2;break}case pt.PLAYER:{const p=sc(e,s,r);Bo(p)&&(a.x=p.x,a.y=p.y);break}case pt.OVER:case pt.UNDER:{const p=j0(t,e,n,r,i.slice(d+1),s);return p.layer=h,p}}}return{dir:i,startpt:s,destpt:a,layer:o}}function lF(t,e,n,r){if(x(t)&&x(e)&&x(n)){const[i,s]=n,o=Xs(t,i);if(x(o)&&x(o.name)){const a=kd(e,r,i);return ic(a,s),a}}}function ds(t,e,n,r,i){if(x(t)&&x(e)&&x(n)){const[s,o]=n,a=Oc(t,s);if(x(a)){const l=nN(e,r,s);if(x(l)){ic(l,o);const u=Lo(r,St);return Di(t,l),bE(t,e,l,u),l}}const c=Xs(t,s);if(x(c)&&x(c.name)){const l=kd(e,r,s,i);if(x(l))return ic(l,o),aF(t,e,l),Di(t,l),bE(t,e,l),l}}}function or(t,e,n,r){return!x(n)||is(n)==="player"?!1:(n.id?(n.removed=r,$0(t,e,n)):(ln(e,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),cF(t,e,n)),!0)}function z0(t,e,n,r){if(!x(t)||!x(e)||!x(e.lookup)||r.x<0||r.x>=St||r.y<0||r.y>=Yt)return!0;const i=r.x+r.y*St,s=Rn(e,e.lookup[i]??"404");if(x(s))return!0;const o=e.terrain[i];return x(o)?zo(n,He(t,o,"collision")??$t.ISWALK):!1}function uF(t,e,n,r){const i=Rn(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=He(t,i,"collision");return z0(t,e,a,r)}function K0(t,e,n,r){var d;const i=Rn(e,(n==null?void 0:n.id)??"");if(!x(t)||!x(e)||!x(i)||!x(i.x)||!x(i.y)||!x(e.lookup)||!x(n)||r.x<0||r.x>=St||r.y<0||r.y>=Yt)return{name:"edge",kind:"edge",collision:$t.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Ur(e,i),o=Ur(e,r),a=He(t,i,"collision")??$t.ISWALK,c=Kr(i==null?void 0:i.id),l=Rn(e,e.lookup[o]??""),u=Kr((l==null?void 0:l.id)??"");if(x(l)&&(!c||!u)&&hs(t,n)!==hs(t,l)){if(!!He(t,l,"pushable")){const p={x:r.x-(n.x??0),y:r.y-(n.y??0)};K0(t,e,l,p)}return{...l}}const f=e.terrain[o];if(x(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??$t.ISWALK;if(zo(a,h))return{...f,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function hF(t,e,n){const r=[];if(!x(t)||!x(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>il*5&&(r.push(o.id),Jy(e,o.id))}return r}function fF(t,e,n){const r=[];if(!x(t)||!x(e))return r;e.lookup=void 0,Ge(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!x(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Di(t,a),l=`${(c==null?void 0:c.code)??""}
${a.code??""}`;l&&r.push({id:a.id,type:_t.OBJECT,code:l,object:a,terrain:void 0})}const s=hF(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:_t.ERROR,code:"",object:void 0,terrain:void 0});return r}function dF(t,e,n){const r=[],i=[];if(!x(t)||!x(e))return{objectelements:r,terrainelements:i};function s(a){const c=He(t,a,n);return x(c)||hs(t,a)===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c)&&r.push(c)}for(let a=0;a<wd;++a){const c=e.terrain[a];x(c)&&s(c)&&i.push(c)}return{objectelements:r,terrainelements:i}}var wE={exports:{}},W0={exports:{}},EE;function pF(){return EE||(EE=1,function(t,e){(function(n,r){t.exports=r()})(Cn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(m){if(m)for(var y=0;y<u.length;y++)m[u[y]]!==void 0&&this["set"+r(u[y])](m[u[y]])}f.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof f)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new f(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",y=this.getLineNumber()||"",w=this.getColumnNumber()||"",k=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+y+":"+w+")":"[eval]:"+y+":"+w:k?k+" ("+m+":"+y+":"+w+")":m+":"+y+":"+w}},f.fromString=function(y){var w=y.indexOf("("),k=y.lastIndexOf(")"),T=y.substring(0,w),A=y.substring(w+1,k).split(","),C=y.substring(k+1);if(C.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),S=R[1],U=R[2],I=R[3];return new f({functionName:T,args:A||void 0,fileName:S,lineNumber:U||void 0,columnNumber:I||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(m){return function(y){this[m]=!!y}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(m){return function(y){if(!n(y))throw new TypeError(m+" must be a Number");this[m]=Number(y)}}(o[h]);for(var p=0;p<a.length;p++)f.prototype["get"+r(a[p])]=i(a[p]),f.prototype["set"+r(a[p])]=function(m){return function(y){this[m]=String(y)}}(a[p]);return f})}(W0)),W0.exports}(function(t,e){(function(n,r){t.exports=r(pF())})(Cn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),p=d&&f||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var y=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:y,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(wE);var mF=wE.exports,gF=no(mF);function ji(t){const e={},n={tick(){},everytick(){},listcommands(){return hr(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function ye(t){return`${t??""}`}function Ic(t,e){const n=parseFloat(ye(t));return isNaN(n)?e:n}function xE(t,e,n){var i;const[r]=rt(e,0,[z.MAYBE_NAME]);WA(tt,t,((i=b.board)==null?void 0:i.id)??"",r??"",n)}function Kn(t,e,n,r){const[i,s]=rt(r,0,[z.NUMBER_OR_STRING,z.MAYBE_NUMBER_OR_STRING]);og(tt,t,e,n,i,s)}const _F=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function vE(t,e,n){const[r,i]=rt(n,0,[z.NUMBER_OR_STRING]);if(At(r))rf(tt,t,e,"volume",r);else if(_F.includes(It(r))){const[s,o]=rt(n,i,[z.NUMBER_OR_STRING,z.MAYBE_NUMBER_OR_STRING]);og(tt,t,e,r,s,o)}else{const[s]=rt(n,i,[z.MAYBE_NUMBER_OR_STRING]);if(At(s)){const o=n.length-i,a=new Array(o).fill(z.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;rf(tt,t,e,r,l)}else{const[o]=rt(n,i,[z.MAYBE_NUMBER_OR_STRING]);rf(tt,t,e,r,o)}}}const H0=ji().command("talk",(t,e)=>{const[n]=rt(e,0,[z.ANY]);switch(It(n)){default:AA(tt,b.elementfocus);break;case"stop":RA(tt,b.elementfocus);break}return 0}).command("media",(t,e)=>{const[n]=rt(e,0,[z.ANY]);switch(It(n)){default:SA(tt,b.elementfocus);break;case"stop":OA(tt,b.elementfocus);break}return 0}).command("tts",(t,e)=>{const[n,r]=rt(e,0,[z.STRING]),i=e.slice(r).map(ye).join("");return zA(tt,b.elementfocus,n,i),0}).command("tta",(t,e)=>{const n=e.map(ye).join("");return KA(tt,b.elementfocus,n),0}).command("bpm",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return GA(tt,b.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return YA(tt,b.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return VA(tt,b.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=rt(e,0,[z.NUMBER]);return ZA(tt,b.elementfocus,n),0}).command("play",(t,e)=>(xE(b.elementfocus,e,!1),0)).command("bgplay",(t,e)=>(xE(b.elementfocus,e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)vE(b.elementfocus,n,e);return 0}).command("echo",(t,e)=>{for(let n=0;n<3;++n)Kn(b.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<3;++n)Kn(b.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<3;++n)Kn(b.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<3;++n)Kn(b.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<3;++n)Kn(b.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<3;++n)Kn(b.elementfocus,n,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let n=0;n<3;++n)Kn(b.elementfocus,n,"autowah",e);return 0});for(let t=0;t<8;++t)H0.command(`synth${t+1}`,(e,n)=>(vE(b.elementfocus,t,n),0));for(let t=0;t<3;++t){const e=t+1;H0.command(`echo${e}`,(n,r)=>(Kn(b.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(Kn(b.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(Kn(b.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(Kn(b.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(Kn(b.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(Kn(b.elementfocus,t,"vibrato",r),0)).command(`autowah${e}`,(n,r)=>(Kn(b.elementfocus,t,"autowah",r),0))}const yF=py(32,126).map(t=>String.fromCharCode(t)),bF=ir({name:"Whitespace",pattern:/ +/}),wF=ir({name:"WhitespaceSkipped",pattern:/ +/,group:Qe.SKIPPED}),G0=ir({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),kE=ir({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:yF}),Y0=ir({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),V0=ir({name:"EscapedDollar",pattern:"$$"}),Z0=ir({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),X0=ir({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),TE=ir({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function EF(t,e=""){return ir({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const AE=Object.keys(Qa).map(t=>EF(`\\$(${t})`,t)),xF=[bF,G0,...AE,Y0,kE,X0,V0,TE,Z0],vF=new Qe(xF,{skipValidations:!di,ensureOptimizations:di}),kF=new Qe([wF,G0,...AE,Y0,kE,X0,V0,TE,Z0],{skipValidations:!di,ensureOptimizations:di});function q0(t,e=!1){return e?kF.tokenize(t):vF.tokenize(t)}function J0(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function RE(t){t.active={...t.reset}}function SE(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case V0:s("$");break;case X0:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case Y0:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case G0:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=Qa[l],f=kI(Rt[u]),d=TI(Rt[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):x(f)?e.active.color=f:x(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(x(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){RE(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;AF(u,u+l.length,e.active.color,e.active.bg,e),TF(u,l,e)}}}function OE(t,e,n){const r=q0(t);r.tokens&&(SE(r.tokens,e),n&&RE(e),e.changed())}function IE(t,e,n){const r=q0(t);if(!r.tokens)return;const i=J0(e,n,Rt.WHITE,Rt.BLACK);return i.measureonly=!0,SE(r.tokens,i),i.x>0&&++i.y,i}function TF(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function AF(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function NE(t,e,n){if(!Bo(b.element))return 0;const[r,i]=rt(e,0,[z.DIR,z.MAYBE_KIND]),s=i??["bullet"],o=lF(b.book,b.board,s,{x:b.element.x,y:b.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=b.elementid,o.collision=$t.ISBULLET,o.destructible=1,o.stepx=r.destpt.x-b.element.x,o.stepy=r.destpt.y-b.element.y,o.bg=Rt.ONCLEAR;const a=Di(b.book,o),c=o.code??(a==null?void 0:a.code)??"";Tx(b.book,b.board,o,c,1)}return t.yield(),0}function zu(t,e,n,r){var u,f;if(!Bo(b.element)||!x(b.book)||!x(b.board)||!x(b.element))return 0;Ge(b.book,b.board);const[i,s]=rt(e,0,[z.DIR,z.KIND]),o=me(b.board,i.destpt);if((o==null?void 0:o.category)===fr.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((u=b.element)==null?void 0:u.x)??0,y:((f=b.element)==null?void 0:f.y)??0},h=ze(i.destpt,Ri(d,i.destpt));K0(b.book,b.board,o,h)}const[a]=s,c=Oc(b.book,a);x(c)&&ds(b.book,b.board,s,i.destpt,n);const l=Xs(b.book,a);if(x(l)){const d=Xs(b.book,a)??Oc(b.book,a),h=He(b.book,d,"collision")??$t.ISWALK;if(!z0(b.book,b.board,h,i.destpt)){const m=ds(b.book,b.board,s,i.destpt,n);x(m)&&x(r)&&(m.arg=r)}}return 0}const RF=ji().command("board",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;const[n,r]=rt(e,0,[z.NAME]),[i,s]=rt(e,r,[z.MAYBE_NUMBER,z.MAYBE_NUMBER]),o=zn(b.book,_t.BOARD,n);if(o.length){const a=Te(...o);x(a)&&Qo(b.book,b.elementfocus,a.id,{x:i??Math.round(St*.5),y:s??Math.round(Yt*.5)})}return 0}).command("edge",(t,e)=>{var s,o;if(!x(b.book)||!x(b.board)||!x(b.element))return 0;const[n,r]=rt(e,0,[z.DIR,z.NAME]),i=zn(b.book,_t.BOARD,r);if(i.length){const a={x:((s=b.element)==null?void 0:s.x)??0,y:((o=b.element)==null?void 0:o.y)??0},c=Ri(a,n.destpt),l=Te(...i);switch(c){case pt.NORTH:b.board.exitnorth=l.id;break;case pt.SOUTH:b.board.exitsouth=l.id;break;case pt.WEST:b.board.exitwest=l.id;break;case pt.EAST:b.board.exiteast=l.id;break}}return 0}).command("shove",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;Ge(b.book,b.board);const[n,r]=rt(e,0,[z.DIR,z.DIR]),i=me(b.board,n.destpt);return wn(i)&&ua(b.book,b.board,i,r.destpt),0}).command("duplicate",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;Ge(b.book,b.board);const[n,r]=rt(e,0,[z.DIR,z.DIR]),i=me(b.board,n.destpt);return wn(i),0}).command("write",(t,e)=>{var l;if(!x(b.book)||!x(b.board))return 0;Ge(b.book,b.board);const[n,r,i]=rt(e,0,[z.DIR,z.COLOR,z.STRING]),{color:s,bg:o}=xy(r),a=((l=IE(i,256,1))==null?void 0:l.measuredwidth)??1,c=J0(256,1,s??Rt.WHITE,o??Rt.BLACK);OE(i,c,!1);for(let u=0;u<a;++u)ln(b.board,{x:n.destpt.x+u,y:n.destpt.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;Ge(b.book,b.board);const[n,r]=rt(e,0,[z.KIND,z.KIND]);(hd(n)??"")==="empty"&&sN(b.board).forEach(c=>{ds(b.book,b.board,r,c)});const s=hd(r),o=ky(r),a=Ty(r);return Qy(b.board,n).forEach(c=>{if(is(c)===s)x(o)&&(c.color=o),x(a)&&(c.bg=a);else if(or(b.book,b.board,c,b.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};ds(b.book,b.board,r,l)}}),0}).command("put",(t,e)=>zu(t,e)).command("putwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return zu(t,e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return x(b.board)&&Rn(b.board,n)?0:zu(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=rt(e,0,[z.ANY,z.ANY]);return x(b.board)&&Rn(b.board,r)?0:zu(t,e.slice(i),r,n)}).command("shoot",NE).command("shootwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY]);return NE(t,e.slice(r),n)}),ps="$dkpurple",SF="$196",OF="$205",un="$yellow$205$205$205$196";function Le(t,e,n){bA(t,e,n)}function IF(t,e,n){const r=SF.repeat(n);Le(t,e,`${ps}${r}`)}function Q0(t,e,n){const r=OF.repeat(n);Le(t,e,`${ps}${r}`)}function tp(t,e,n){Le(t,e,`${ps} ${" ".repeat(n.length)} `),IF(t,e,n.length+2),Le(t,e,`${ps} $white${n} `),Q0(t,e,n.length+2)}function Js(t,e,n){Le(t,e,`${ps} ${" ".repeat(n.length)} `),Le(t,e,`${ps} $gray${n} `),Q0(t,e,n.length+2)}function Nc(t,e,n,r){Le(t,e,`${ps} $white${n} $blue${r}`)}function Wn(t,e,n){Le(t,e,`${ps}$blue${n}`)}function NF(t,e,n,r){Le(t,e,`!${n};${r}`)}function CE(t){const[e,n]=t.split(":"),r=x(n);return[r?e:"self",r?n:t]}var CF=`desc;$DKGRAYname and type of codepage
`,LF=Object.freeze({__proto__:null,default:CF}),MF="desc;changes object into specified element",UF=Object.freeze({__proto__:null,default:MF}),FF="desc;like #play but for sound effects",BF=Object.freeze({__proto__:null,default:FF}),PF="",DF=Object.freeze({__proto__:null,default:PF}),$F="",jF=Object.freeze({__proto__:null,default:$F}),zF="",KF=Object.freeze({__proto__:null,default:zF}),WF="",HF=Object.freeze({__proto__:null,default:WF}),GF="",YF=Object.freeze({__proto__:null,default:GF}),VF="",ZF=Object.freeze({__proto__:null,default:VF}),XF="",qF=Object.freeze({__proto__:null,default:XF}),JF="",QF=Object.freeze({__proto__:null,default:JF}),tB="",eB=Object.freeze({__proto__:null,default:tB}),nB="",rB=Object.freeze({__proto__:null,default:nB}),iB="",sB=Object.freeze({__proto__:null,default:iB}),oB="",aB=Object.freeze({__proto__:null,default:oB}),cB="",lB=Object.freeze({__proto__:null,default:cB}),uB="",hB=Object.freeze({__proto__:null,default:uB}),fB="",dB=Object.freeze({__proto__:null,default:fB}),pB=`desc;$DKGRAYstarts a section of an if-do-done block
`,mB=Object.freeze({__proto__:null,default:pB}),gB=`desc;$DKGRAYcompletes an if-do-done block
`,_B=Object.freeze({__proto__:null,default:gB}),yB="",bB=Object.freeze({__proto__:null,default:yB}),wB="",EB=Object.freeze({__proto__:null,default:wB}),xB="",vB=Object.freeze({__proto__:null,default:xB}),kB=`desc;$DKGRAYelse logic in an if-do-done block
`,TB=Object.freeze({__proto__:null,default:kB}),AB=`desc;$DKGRAYconditional else logic in an if-do-done block
`,RB=Object.freeze({__proto__:null,default:AB}),SB="",OB=Object.freeze({__proto__:null,default:SB}),IB="",NB=Object.freeze({__proto__:null,default:IB}),CB="",LB=Object.freeze({__proto__:null,default:CB}),MB="",UB=Object.freeze({__proto__:null,default:MB}),FB="",BB=Object.freeze({__proto__:null,default:FB}),PB="",DB=Object.freeze({__proto__:null,default:PB}),$B="",jB=Object.freeze({__proto__:null,default:$B}),zB="",KB=Object.freeze({__proto__:null,default:zB}),WB=`desc;$DKGRAYhalt until the next cycle
`,HB=Object.freeze({__proto__:null,default:WB}),GB=`desc;$DKGRAYevals condition for true or false
`,YB=Object.freeze({__proto__:null,default:GB}),VB="",ZB=Object.freeze({__proto__:null,default:VB}),XB="",qB=Object.freeze({__proto__:null,default:XB}),JB="",QB=Object.freeze({__proto__:null,default:JB}),tP="",eP=Object.freeze({__proto__:null,default:tP}),nP="",rP=Object.freeze({__proto__:null,default:nP}),iP="",sP=Object.freeze({__proto__:null,default:iP}),oP="",aP=Object.freeze({__proto__:null,default:oP}),cP="",lP=Object.freeze({__proto__:null,default:cP}),uP="",hP=Object.freeze({__proto__:null,default:uP}),fP="",dP=Object.freeze({__proto__:null,default:fP}),pP="",mP=Object.freeze({__proto__:null,default:pP}),gP="",_P=Object.freeze({__proto__:null,default:gP}),yP="",bP=Object.freeze({__proto__:null,default:yP}),wP="",EP=Object.freeze({__proto__:null,default:wP}),xP="",vP=Object.freeze({__proto__:null,default:xP}),kP="",TP=Object.freeze({__proto__:null,default:kP}),AP="",RP=Object.freeze({__proto__:null,default:AP}),SP="",OP=Object.freeze({__proto__:null,default:SP}),IP="",NP=Object.freeze({__proto__:null,default:IP}),CP="",LP=Object.freeze({__proto__:null,default:CP}),MP="",UP=Object.freeze({__proto__:null,default:MP}),FP=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,BP=Object.freeze({__proto__:null,default:FP}),PP="",DP=Object.freeze({__proto__:null,default:PP}),$P="",jP=Object.freeze({__proto__:null,default:$P}),zP="",KP=Object.freeze({__proto__:null,default:zP}),WP="",HP=Object.freeze({__proto__:null,default:WP}),GP="",YP=Object.freeze({__proto__:null,default:GP}),VP="",ZP=Object.freeze({__proto__:null,default:VP}),XP="",qP=Object.freeze({__proto__:null,default:XP}),JP="",QP=Object.freeze({__proto__:null,default:JP}),tD="",eD=Object.freeze({__proto__:null,default:tD}),nD="",rD=Object.freeze({__proto__:null,default:nD}),iD="",sD=Object.freeze({__proto__:null,default:iD}),oD="",aD=Object.freeze({__proto__:null,default:oD}),cD="",lD=Object.freeze({__proto__:null,default:cD}),uD="",hD=Object.freeze({__proto__:null,default:uD}),fD="",dD=Object.freeze({__proto__:null,default:fD}),pD="",mD=Object.freeze({__proto__:null,default:pD}),gD="",_D=Object.freeze({__proto__:null,default:gD}),yD="",bD=Object.freeze({__proto__:null,default:yD}),wD="",ED=Object.freeze({__proto__:null,default:wD}),xD=`desc;$DKGRAYdesignates an inactive label or comment
`,vD=Object.freeze({__proto__:null,default:xD}),kD=`desc;$DKGRAYadds hyperlink text

`,TD=Object.freeze({__proto__:null,default:kD}),AD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,RD=Object.freeze({__proto__:null,default:AD}),SD=`desc;$DKGRAYread number input into given stat/flag
`,OD=Object.freeze({__proto__:null,default:SD}),ID=`desc;$DKGRAYa slider input from 1 to 9 

`,ND=Object.freeze({__proto__:null,default:ID}),CD=`desc;$DKGRAYlist with label value pairs to pick from
`,LD=Object.freeze({__proto__:null,default:CD}),MD=`desc;$DKGRAYread text input into given stat/flag
`,UD=Object.freeze({__proto__:null,default:MD}),FD=`desc;$DKGRAYdesignates a starting point for running code
`,BD=Object.freeze({__proto__:null,default:FD}),PD=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,DD=Object.freeze({__proto__:null,default:PD}),$D=`desc;$DKGRAYwill move the object in the given direction
`,jD=Object.freeze({__proto__:null,default:$D}),zD=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,KD=Object.freeze({__proto__:null,default:zD}),WD=`desc;$DKGRAYcustom 8x14 charset
`,HD=Object.freeze({__proto__:null,default:WD}),GD=`desc;$DKGRAYsets stat to given value

`,YD=Object.freeze({__proto__:null,default:GD}),VD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,ZD=Object.freeze({__proto__:null,default:VD}),XD=`desc;$DKGRAYread external content and/or handle events
`,qD=Object.freeze({__proto__:null,default:XD}),JD=`desc;$DKGRAYread number input into given stat/flag
`,QD=Object.freeze({__proto__:null,default:JD}),t$=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,e$=Object.freeze({__proto__:null,default:t$}),n$=`desc;$DKGRAYcustom palette colors
`,r$=Object.freeze({__proto__:null,default:n$}),i$=`desc;$DKGRAYa slider input from 1 to 9 

`,s$=Object.freeze({__proto__:null,default:i$}),o$=`desc;$DKGRAYlist with label value pairs to pick from
`,a$=Object.freeze({__proto__:null,default:o$}),c$=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,l$=Object.freeze({__proto__:null,default:c$}),u$=`desc;$DKGRAYread text input into given stat/flag
`,h$=Object.freeze({__proto__:null,default:u$}),f$=`desc;$DKGRAYadds text
`,d$=Object.freeze({__proto__:null,default:f$}),p$=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,m$=Object.freeze({__proto__:null,default:p$}),g$=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,_$=Object.freeze({__proto__:null,default:g$}),y$=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,b$=Object.freeze({__proto__:null,default:y$}),w$=`header;player settings
#set user "name goes here"
`,E$=Object.freeze({__proto__:null,default:w$}),x$=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,v$=Object.freeze({__proto__:null,default:x$});const LE=Object.assign({"./editor/codepagename.txt":LF,"./editor/command/become.txt":UF,"./editor/command/bgplay.txt":BF,"./editor/command/bgvol.txt":DF,"./editor/command/bind.txt":jF,"./editor/command/board.txt":KF,"./editor/command/bpm.txt":HF,"./editor/command/break.txt":YF,"./editor/command/change.txt":ZF,"./editor/command/char.txt":qF,"./editor/command/charset.txt":QF,"./editor/command/clear.txt":eB,"./editor/command/color.txt":rB,"./editor/command/continue.txt":sB,"./editor/command/copy.txt":aB,"./editor/command/cycle.txt":lB,"./editor/command/die.txt":hB,"./editor/command/distort.txt":dB,"./editor/command/do.txt":mB,"./editor/command/done.txt":_B,"./editor/command/duplicate.txt":bB,"./editor/command/echo.txt":EB,"./editor/command/edge.txt":vB,"./editor/command/else.txt":TB,"./editor/command/elseif.txt":RB,"./editor/command/end.txt":OB,"./editor/command/endgame.txt":NB,"./editor/command/endwith.txt":LB,"./editor/command/fcrush.txt":UB,"./editor/command/fetch.txt":BB,"./editor/command/fetchwith.txt":DB,"./editor/command/foreach.txt":jB,"./editor/command/go.txt":KB,"./editor/command/idle.txt":HB,"./editor/command/if.txt":YB,"./editor/command/lock.txt":ZB,"./editor/command/oneof.txt":qB,"./editor/command/oneofwith.txt":QB,"./editor/command/palette.txt":eP,"./editor/command/phaser.txt":rP,"./editor/command/pivot.txt":sP,"./editor/command/play.txt":aP,"./editor/command/put.txt":lP,"./editor/command/putwith.txt":hP,"./editor/command/readbin.txt":dP,"./editor/command/readjson.txt":mP,"./editor/command/readline.txt":_P,"./editor/command/readrexpaint.txt":bP,"./editor/command/remix.txt":EP,"./editor/command/repeat.txt":vP,"./editor/command/restore.txt":TP,"./editor/command/reverb.txt":RP,"./editor/command/revert.txt":OP,"./editor/command/run.txt":NP,"./editor/command/runwith.txt":LP,"./editor/command/set.txt":UP,"./editor/command/shoot.txt":BP,"./editor/command/shootwith.txt":DP,"./editor/command/shove.txt":jP,"./editor/command/snapshot.txt":KP,"./editor/command/synth.txt":HP,"./editor/command/toast.txt":YP,"./editor/command/tts.txt":ZP,"./editor/command/ttsvol.txt":qP,"./editor/command/twitchbroadcast.txt":QP,"./editor/command/twitchchat.txt":eD,"./editor/command/unlock.txt":rD,"./editor/command/vibrato.txt":sD,"./editor/command/vol.txt":aD,"./editor/command/waitfor.txt":lD,"./editor/command/walk.txt":hD,"./editor/command/weave.txt":dD,"./editor/command/while.txt":mD,"./editor/command/with.txt":_D,"./editor/command/write.txt":bD,"./editor/command/zap.txt":ED,"./editor/comment.txt":vD,"./editor/hyperlink.txt":TD,"./editor/hyperlink/hotkey.txt":RD,"./editor/hyperlink/number.txt":OD,"./editor/hyperlink/range.txt":ND,"./editor/hyperlink/select.txt":LD,"./editor/hyperlink/text.txt":UD,"./editor/label.txt":BD,"./editor/shortgo.txt":DD,"./editor/shorttry.txt":jD,"./editor/stat/board.txt":KD,"./editor/stat/charset.txt":HD,"./editor/stat/const.txt":YD,"./editor/stat/hotkey.txt":ZD,"./editor/stat/loader.txt":qD,"./editor/stat/number.txt":QD,"./editor/stat/object.txt":e$,"./editor/stat/palette.txt":r$,"./editor/stat/range.txt":s$,"./editor/stat/select.txt":a$,"./editor/stat/terrain.txt":l$,"./editor/stat/text.txt":h$,"./editor/text.txt":d$,"./help/controls.txt":m$,"./help/developer.txt":_$,"./help/menu.txt":b$,"./help/player.txt":E$,"./help/text.txt":v$}),ME={};hr(LE).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");ME[e]=LE[t].default});function k$(t){const e=It(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=ME[e];if(x(n))return n;const{target:r,path:i}=Xn(e);switch(r){case"editor":{const s=Xn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function T$(t,e){const n=(t??"").split(`
`);for(let r=0;r<n.length;++r)e(n[r].split(";"))}function A$(t,e){const[n,...r]=e,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":tp(tt,t,i);break;case"section":Js(tt,t,i);break;case"option":Nc(tt,t,i,s);break;default:n.trimStart().startsWith("!")?NF(tt,t,n.trimStart().slice(1),i):Le(tt,t,n);break}}function ta(){lg(tt,cr())}function Cc(t){T$(k$(`help:${t}`),e=>A$(b.elementfocus,e))}const R$=ji().command("send",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);switch(It(n)){case"helpmenu":Cc("menu");break;case"helpcontrols":Cc("controls");break;case"helptext":Cc("text");break;case"helpdeveloper":Cc("developer");break;case"helpplayer":Cc("player");break;default:{const[i,s]=CE(n);_p(i==="self"&&b.elementisplayer?`${b.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(ye),s=i.join(" ");switch(It(r)){case sr(vt.LOADER):n=ys(Pt.CONTENT,s,_t.LOADER);break;default:n=ys(Pt.CONTENT,[r,...i].join(" "),_t.OBJECT);break;case sr(vt.BOARD):n=ys(Pt.CONTENT,s,_t.BOARD);break;case sr(vt.OBJECT):n=ys(Pt.CONTENT,s,_t.OBJECT);break;case sr(vt.TERRAIN):n=ys(Pt.CONTENT,s,_t.TERRAIN);break;case sr(vt.CHARSET):n=ys(Pt.CONTENT,s,_t.CHARSET);break;case sr(vt.PALETTE):n=ys(Pt.CONTENT,s,_t.PALETTE);break}return x(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(ye).join(" ");if(x(b.element)&&b.elementisplayer){const{user:r}=Sr(b.elementid),i=bt(r)?r:"player";b.element.tickertext=`${i}: ${n}`,b.element.tickertime=b.timestamp;const s=Du(b.book,b.element,1,Rt.WHITE,Rt.BLACK);he(tt,b.elementid,`$${Rt[s.color]}$ON${Rt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),Fa(tt,b.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ye(n),s=r.map(ye).join(" "),{user:o}=Sr(b.elementid),a=bt(o)?o:"player",c=Du(b.book,b.element,1,Rt.WHITE,Rt.BLACK);return he(tt,b.elementid,`!${s};$${Rt[c.color]}$ON${Rt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`),0}).command("config",(t,e)=>{const[n,r]=rt(e,0,[z.MAYBE_NAME,z.MAYBE_STRING]);return bt(n)&&bt(r)?XA(tt,b.elementfocus,n,r):qA(tt,b.elementfocus),0}).command("bookcreate",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]),r=wx(n);return x(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return x(r)?(he(tt,b.elementfocus,`opened [book] ${r.name}`),ah(Pt.MAIN,r.id),t.command("pages")):ue(tt,b.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=be(Pt.MAIN),i=zr(n);return x(i)&&(r===i&&ah(Pt.MAIN,""),T4(n),he(tt,b.elementfocus,`trashed [book] ${i.name}`),ta(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zn(b.book,_t.BOARD,n);if(r.length){const i=Te(...r);x(i)&&Qo(b.book,b.elementfocus,i.id,{x:yr(0,St-1),y:yr(0,Yt-1)})}return 0}).command("pageopen",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.MAYBE_NAME]),i=vn(Pt.MAIN);if(!x(i))return 0;const s=Pi(i,n);if(x(s)){const o=We(s),a=us(s);he(tt,b.elementfocus,`opened [${a}] ${o}`);const c=[s.id,r];td(rl(i.id,c),s.code);const l=us(s);ag(tt,b.elementfocus,i.id,c,l,`${o} - ${i.name}`)}else ue(tt,"pageopen",`page ${n} not found`,b.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=vn(Pt.MAIN),i=pE(r,n);if(x(n)){const s=We(i),o=us(i);he(tt,b.elementfocus,`trashed [${o}] ${s}`),ta(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(ye).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{Js(tt,b.elementfocus,"books");const t=be(Pt.MAIN);Nc(tt,b.elementfocus,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=be(Pt.CONTENT);Nc(tt,b.elementfocus,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),Q0(tt,b.elementfocus,7);const n=ca();return n.length?n.forEach(r=>{Le(tt,b.elementfocus,`!bookopen ${r.id};${r.name}`)}):Wn(tt,b.elementfocus,"no books found"),Le(tt,b.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=vn(Pt.MAIN);return x(t)&&(Js(tt,b.elementfocus,"pages"),Nc(tt,b.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?P0(t).forEach(n=>{const r=We(n),i=us(n);Le(tt,b.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Le(tt,b.elementfocus,""),Wn(tt,b.elementfocus,"$white no pages found"),Wn(tt,b.elementfocus,"$white use @ to create a page"),Wn(tt,b.elementfocus,"$white @board name of board"),Wn(tt,b.elementfocus,"$white @object name of object"),Wn(tt,b.elementfocus,"$white @terrain name of terrain"),Wn(tt,b.elementfocus,"$white You can omit the type and it will default to object"),Wn(tt,b.elementfocus,"$white @object name of object"),Wn(tt,b.elementfocus,"$white @name of object"))),0}).command("boards",()=>{Js(tt,b.elementfocus,"boards");const t=vn(Pt.MAIN);if(x(t)){Nc(tt,b.elementfocus,"main",`${t.name} $GREEN${t.id}`);const e=P0(t);e.filter(n=>Bi(n)===_t.BOARD).forEach(n=>{const r=We(n),i=us(n);Le(tt,b.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),e.length===0&&(Le(tt,b.elementfocus,""),Wn(tt,b.elementfocus,"$white no boards found"),Wn(tt,b.elementfocus,"$white use @ to create a board"),Wn(tt,b.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{Js(tt,b.elementfocus,"$REDTRASH"),Wn(tt,b.elementfocus,"books");const t=ca();t.length&&(t.forEach(n=>{Le(tt,b.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Le(tt,b.elementfocus,""));const e=be(Pt.MAIN);return x(e)&&(Wn(tt,b.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=We(n);Le(tt,b.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Le(tt,b.elementfocus,"")),0}).command("dev",()=>(ta(),DA(tt,b.elementfocus),0)).command("share",()=>(ta(),$A(tt,b.elementfocus),0)).command("save",()=>(ta(),0)).command("fork",()=>(nR(tt,b.elementfocus),0)).command("nuke",()=>(jA(tt,b.elementfocus),0)).command("restart",()=>(eR(tt,b.elementfocus),ta(),0)).command("export",()=>{tp(tt,b.elementfocus,"E X P O R T"),Js(tt,b.elementfocus,"books");const t=ca();return t.length&&t.forEach(e=>Le(tt,b.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return x(r)&&(tp(tt,b.elementfocus,"E X P O R T"),Js(tt,b.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=P0(r);Le(tt,b.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=We(s),a=us(s);Le(tt,b.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zr(n);return x(r)&&sg(tt,b.elementfocus,Zn(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=rt(e,0,[z.NAME]),{target:r,path:i}=Xn(n),s=zr(r),o=Pi(s,i);return x(o)&&sg(tt,b.elementfocus,Zn(o),`${We(o)}.${us(o)}.json`),0}).command("gadget",()=>(JA(tt,b.elementfocus),0)).command("joincode",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return IA(tt,b.elementfocus,!!n),0}).command("jointab",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return NA(tt,b.elementfocus,!!n),0}),S$=ji().command("toast",(t,e)=>{const n=e.map(ye).join("");return wA(tt,b.elementfocus,n),0}).command("palette",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=xx(),i=tn(b.book,_t.PALETTE,n);return x(i)?(r.palette=i.id,he(tt,b.elementfocus,`loaded palette ${n}`)):ue(tt,b.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=xx(),i=tn(b.book,_t.CHARSET,n);return x(i)?(r.charset=i.id,he(tt,b.elementfocus,`loaded charset ${n}`)):ue(tt,b.elementfocus,"not-found",`unabled to find charset ${n}`),0}),ep={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Lc(t){return ae(t)&&UE(t[0])}function UE(t){return x(fr[t])&&bt(t)}function FE(t){if(bt(t))return ep[It(t)]}function BE(t){if(Lc(t))return t;if(UE(t))return[t];const e=FE(t);if(x(e))return[e]}function O$(t){const e=b.words[t],n=BE(e);if(Lc(n))return[n,t+1];const[r,i]=Gn(t),s=BE(r);return Lc(s)?[s,i]:[void 0,t]}const np={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};$t.ISSOLID,$t.ISWALK,$t.ISSWIM,$t.ISBULLET,$t.ISWALK,$t.ISSWIM;function Ku(t){return ae(t)&&rp(t[0])}function rp(t){return x($t[t])&&bt(t)}function I$(t){if(bt(t))return np[It(t)]}function N$(t){const e=b.words[t];if(Ku(e))return[e,t+1];if(rp(e))return[[e],t+1];const[n,r]=Gn(t);return Ku(n)?[n,r]:rp(n)?[[n],r]:[void 0,t]}const C$=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),PE=new Set(["char","color","bg","group","party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),L$=["NORTH","SOUTH","WEST","EAST"];function M$(t){const e=Sr(t);if(At(e.inputcurrent)||(e.inputcurrent=0),ae(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Sn.NONE,i=0]=n??[Sn.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&pN?1:0,e.inputctrl=i&mN?1:0,e.inputshift=i&gN?1:0,r){case Sn.MOVE_UP:case Sn.MOVE_DOWN:case Sn.MOVE_LEFT:case Sn.MOVE_RIGHT:e.inputmove=[L$[r-Sn.MOVE_UP]];break;case Sn.OK_BUTTON:e.inputok=1;break;case Sn.CANCEL_BUTTON:e.inputcancel=1;break;case Sn.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Sn.NONE&&o!==r}),e}function U$(t){const e=ep[t];if(x(e))return e;const n=np[t];if(x(n))return n;const r=Qa[t];if(x(r))return r;const i=ad[t];if(x(i))return i}const F$=ji({get(t,e){var o,a,c,l,u,f,d,h,p,m,y,w,k,T,A,C,R,S,U,I,D;const n=U$(e);if(x(n))return[!0,n];if(b.elementisplayer&&C$.has(e)){const G=M$(b.elementid)[e];return[x(G),G]}const r=sc(b.board,{x:((o=b.element)==null?void 0:o.x)??-1,y:((a=b.element)==null?void 0:a.y)??-1},b.elementfocus),i=(r==null?void 0:r.id)??b.elementfocus??cr();switch(e){case"isdark":return[!0,(c=b.board)!=null&&c.isdark?1:0];case"startx":return[!0,((l=b.board)==null?void 0:l.startx)??0];case"starty":return[!0,((u=b.board)==null?void 0:u.starty)??0];case"over":return[!0,((f=b.board)==null?void 0:f.over)??""];case"under":return[!0,((d=b.board)==null?void 0:d.under)??""];case"camera":return[!0,((h=b.board)==null?void 0:h.camera)??""];case"graphics":return[!0,((p=b.board)==null?void 0:p.graphics)??""];case"facing":break;case"exitnorth":return[!0,((m=b.board)==null?void 0:m.exitnorth)??""];case"exitsouth":return[!0,((y=b.board)==null?void 0:y.exitsouth)??""];case"exitwest":return[!0,((w=b.board)==null?void 0:w.exitwest)??""];case"exiteast":return[!0,((k=b.board)==null?void 0:k.exiteast)??""];case"timelimit":return[!0,((T=b.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=b.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((C=b.board)==null?void 0:C.maxplayershots)??0];case"boardid":return[!0,((R=b.board)==null?void 0:R.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((S=b.element)==null?void 0:S.id)??""];case"thisx":return[!0,((U=b.element)==null?void 0:U.x)??-1];case"thisy":return[!0,((I=b.element)==null?void 0:I.y)??-1];default:{const G=(D=b.element)==null?void 0:D[e];if(PE.has(e))return[!0,G];break}}const s=Sr(i)[e];return[x(s),s]},set(t,e,n){var o,a;const r=sc(b.board,{x:((o=b.element)==null?void 0:o.x)??-1,y:((a=b.element)==null?void 0:a.y)??-1},b.elementfocus),i=(r==null?void 0:r.id)??b.elementfocus;switch(e){case"isdark":if(x(b.board))return b.board.isdark=n?1:0,[!0,b.board.isdark];break;case"startx":if(x(b.board))return b.board.startx=Ic(n,0),[!0,b.board.startx];break;case"starty":if(x(b.board))return b.board.starty=Ic(n,0),[!0,b.board.starty];break;case"over":if(x(b.board))return b.board.over=At(n)?n:ye(n),[!0,b.board.over];break;case"under":if(x(b.board))return b.board.under=At(n)?n:ye(n),[!0,b.board.under];break;case"camera":if(x(b.board))return[!0,b.board.camera=ye(n)];break;case"graphics":if(x(b.board))return[!0,b.board.graphics=ye(n)];break;case"facing":break;case"exitnorth":if(x(b.board))return b.board.exitnorth=ye(n),[!0,b.board.exitnorth];break;case"exitsouth":if(x(b.board))return b.board.exitsouth=ye(n),[!0,b.board.exitsouth];break;case"exitwest":if(x(b.board))return b.board.exitwest=ye(n),[!0,b.board.exitwest];break;case"exiteast":if(x(b.board))return b.board.exiteast=ye(n),[!0,b.board.exiteast];break;case"timelimit":if(x(b.board))return b.board.timelimit=Ic(n,0),[!0,b.board.timelimit];break;case"restartonzap":if(x(b.board))return b.board.restartonzap=n?1:0,[!0,b.board.restartonzap];break;case"maxplayershots":if(x(b.board))return b.board.maxplayershots=Ic(n,0),[!0,b.board.maxplayershots];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(PE.has(e))return x(b.element)&&(b.element[e]=n),[!0,n];break}}const s=Sr(i);return x(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n,r,i;if(!((t=b.element)!=null&&t.removed)&&(x((e=b.element)==null?void 0:e.stepx)||x((n=b.element)==null?void 0:n.stepy))){const s={x:((r=b.element)==null?void 0:r.x)??0,y:((i=b.element)==null?void 0:i.y)??0};ua(b.book,b.board,b.element,{x:s.x+(b.element.stepx??0),y:s.y+(b.element.stepy??0)})===!1&&(b.element.stepx=0,b.element.stepy=0,He(b.book,b.element,"destructible")&&or(b.book,b.board,b.element,b.timestamp))}}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(ye(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{var r,i;const[n]=rt(e,0,[z.KIND]);if(Ge(b.book,b.board),$0(b.book,b.board,b.element),or(b.book,b.board,b.element,b.timestamp)){const s={x:((r=b.element)==null?void 0:r.x)??0,y:((i=b.element)==null?void 0:i.y)??0};ds(b.book,b.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=rt(e,0,[z.ANY]);if(Si(n)){const[r,i]=rt(e,0,[z.DIR,z.NUMBER]),s=me(b.board,r.destpt);x(s)&&(s.char=i)}else x(b.element)&&At(n)&&(b.element.char=n);return 0}).command("color",(t,e)=>{const[n]=rt(e,0,[z.ANY]);if(Si(n)){const[r,i]=rt(e,0,[z.DIR,z.COLOR]),s=me(b.board,r.destpt);x(s)&&ic(b.element,i)}else{const[r]=rt(e,0,[z.COLOR]);x(b.element)&&x(r)&&ic(b.element,r)}return 0}).command("go",(t,e)=>{if(x(b.element)){const[n]=rt(e,0,[z.DIR]);if(ua(b.book,b.board,b.element,n.destpt),t.yield(),b.element.x===n.destpt.x&&b.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!x(b.element))return 0;const[n]=rt(e,0,[z.DIR]),r=b.element.x??0,i=b.element.y??0;return b.element.stepx=n.destpt.x-r,b.element.stepy=n.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=rt(e,0,[z.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(ye(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(ye(e[0])),0)).command("cycle",(t,e)=>{if(x(b.element)){const[n]=rt(e,0,[z.NUMBER]);b.element.cycle=Xe(Math.round(n),1,255)}return 0}).command("die",t=>(or(b.book,b.board,b.element,b.timestamp),t.endofprogram(),0)).command("endgame",()=>(cg(tt,b.elementfocus),0)).command("run",(t,e)=>{const[n]=rt(e,0,[z.NAME]);return ch(n),0}).command("runwith",(t,e)=>{const[n,r]=rt(e,0,[z.ANY,z.NAME]);return t.set("arg",n),ch(r),0}),Wu={};function B$(t){var e;return(e=Wu[t])==null?void 0:e.arg}function P$(t){var e;return(e=Wu[t])==null?void 0:e.format}function ms(t){var e;return(e=Wu[t])==null?void 0:e.content}function D$(t,e,n,r,i){const s=be(Pt.MAIN);if(!x(s))return;const o=Zs(s,_t.LOADER).filter(a=>{const c=Vs(a),l=c.format,u=bt(l)?new RegExp(l).test(e):!1,f=c.event,d=bt(f)?new RegExp(f).test(n):!1;return bt(l)&&bt(f)?u&&d:bt(l)?u:bt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${Pe()}_loader`;Wu[c]={arg:t,format:e,content:r,player:i},I4(c,o[a].code)}}function DE(t,e){if(!x(t))return;const n=It(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const $$=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[z.NAME]),s=It(r);switch(s){case"seek":{const[o]=rt(e,i,[z.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(e,i,[z.NAME]);t.set(o,DE(n,s));break}case"text":{const[o,a]=rt(e,i,[z.NAME,z.NAME]),c=DE(n,o);if(At(c)&&bt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);t.set(a,f),n.cursor+=c}break}case"palette":{const[o]=rt(e,i,[z.NAME]),a=B0(b.book,_t.PALETTE,o),c=Ce(a);if(x(c)){const l=aN*ac,u=Ad(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(e,i,[z.NAME]),a=B0(b.book,_t.CHARSET,o),c=Ce(a);if(x(c)){const l=Hl*oN*Td,u=ib(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},ea=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",Hu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!Hu(t[n],e[n]))return!1;return!0}if(ea(t)&&ea(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Hu(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},Gu=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(ea(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},j$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",$E=t=>t>="0"&&t<="9"||t==="-",z$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var Z;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(Z||(Z={}));const jE={"(":Z.TOK_LPAREN,")":Z.TOK_RPAREN,"*":Z.TOK_STAR,",":Z.TOK_COMMA,".":Z.TOK_DOT,":":Z.TOK_COLON,"@":Z.TOK_CURRENT,$:Z.TOK_ROOT,"]":Z.TOK_RBRACKET,"{":Z.TOK_LBRACE,"}":Z.TOK_RBRACE},K$={"!":!0,"<":!0,"=":!0,">":!0},W$={"	":!0,"\n":!0,"\r":!0," ":!0};class H${constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(j$(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:Z.TOK_UNQUOTEDIDENTIFIER,value:i});else if(jE[e[this._current]]!==void 0)n.push({start:this._current,type:jE[e[this._current]],value:e[this._current]}),this._current+=1;else if($E(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:Z.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:Z.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:Z.TOK_LITERAL,value:o})}else if(K$[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(W$[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:Z.TOK_AND,value:"&&"})):n.push({start:r,type:Z.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:Z.TOK_OR,value:"||"})):n.push({start:r,type:Z.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&z$(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;$E(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:Z.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:Z.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:Z.TOK_FLATTEN,value:"[]"}):{start:n,type:Z.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_NE,value:"!="}):{start:n,type:Z.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_LTE,value:"<="}):{start:n,type:Z.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_GTE,value:">="}):{start:n,type:Z.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:Z.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const G$=new H$,En={[Z.TOK_EOF]:0,[Z.TOK_UNQUOTEDIDENTIFIER]:0,[Z.TOK_QUOTEDIDENTIFIER]:0,[Z.TOK_RBRACKET]:0,[Z.TOK_RPAREN]:0,[Z.TOK_COMMA]:0,[Z.TOK_RBRACE]:0,[Z.TOK_NUMBER]:0,[Z.TOK_CURRENT]:0,[Z.TOK_EXPREF]:0,[Z.TOK_ROOT]:0,[Z.TOK_PIPE]:1,[Z.TOK_OR]:2,[Z.TOK_AND]:3,[Z.TOK_EQ]:5,[Z.TOK_GT]:5,[Z.TOK_LT]:5,[Z.TOK_GTE]:5,[Z.TOK_LTE]:5,[Z.TOK_NE]:5,[Z.TOK_FLATTEN]:9,[Z.TOK_STAR]:20,[Z.TOK_FILTER]:21,[Z.TOK_DOT]:40,[Z.TOK_NOT]:45,[Z.TOK_LBRACE]:50,[Z.TOK_LBRACKET]:55,[Z.TOK_LPAREN]:60};class Y${constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Z.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...G$.tokenize(e),{type:Z.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<En[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case Z.TOK_LITERAL:return{type:"Literal",value:e.value};case Z.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case Z.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===Z.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Z.TOK_NOT:return r=this.expression(En.Not),{type:"NotExpression",children:[r]};case Z.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Z.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(En.Star),{type:"ValueProjection",children:[n,r]};case Z.TOK_FILTER:return this.led(e.type,{type:"Identity"});case Z.TOK_LBRACE:return this.parseMultiselectHash();case Z.TOK_FLATTEN:return n={type:Z.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(En.Flatten),{type:"Projection",children:[n,r]};case Z.TOK_LBRACKET:return this.lookahead(0)===Z.TOK_NUMBER||this.lookahead(0)===Z.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Z.TOK_STAR&&this.lookahead(1)===Z.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(En.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Z.TOK_CURRENT:return{type:Z.TOK_CURRENT};case Z.TOK_ROOT:return{type:Z.TOK_ROOT};case Z.TOK_EXPREF:return i=this.expression(En.Expref),{type:"ExpressionReference",children:[i]};case Z.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Z.TOK_RPAREN;)this.lookahead(0)===Z.TOK_CURRENT?(i={type:Z.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Z.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case Z.TOK_DOT:const i=En.Dot;return this.lookahead(0)!==Z.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Z.TOK_PIPE:return r=this.expression(En.Pipe),{type:Z.TOK_PIPE,children:[n,r]};case Z.TOK_OR:return r=this.expression(En.Or),{type:"OrExpression",children:[n,r]};case Z.TOK_AND:return r=this.expression(En.And),{type:"AndExpression",children:[n,r]};case Z.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Z.TOK_RPAREN;)this.lookahead(0)===Z.TOK_CURRENT?(a={type:Z.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Z.TOK_COMMA&&this.match(Z.TOK_COMMA),o.push(a);return this.match(Z.TOK_RPAREN),{name:s,type:"Function",children:o};case Z.TOK_FILTER:const l=this.expression(0);return this.match(Z.TOK_RBRACKET),r=this.lookahead(0)===Z.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(En.Filter),{type:"FilterProjection",children:[n,r,l]};case Z.TOK_FLATTEN:const u={type:Z.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(En.Flatten);return{type:"Projection",children:[u,f]};case Z.TOK_EQ:case Z.TOK_NE:case Z.TOK_GT:case Z.TOK_GTE:case Z.TOK_LT:case Z.TOK_LTE:return this.parseComparator(n,e);case Z.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===Z.TOK_NUMBER||d.type===Z.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Z.TOK_STAR),this.match(Z.TOK_RBRACKET),r=this.parseProjectionRHS(En.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Z.TOK_COLON||this.lookahead(1)===Z.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Z.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(En.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Z.TOK_RBRACKET&&n<3;){if(r===Z.TOK_COLON)n+=1,this.advance();else if(r===Z.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Z.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(En[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([Z.TOK_UNQUOTEDIDENTIFIER,Z.TOK_QUOTEDIDENTIFIER,Z.TOK_STAR].includes(n))return this.expression(e);if(n===Z.TOK_LBRACKET)return this.match(Z.TOK_LBRACKET),this.parseMultiselectList();if(n===Z.TOK_LBRACE)return this.match(Z.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(En[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Z.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===Z.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===Z.TOK_DOT)return this.match(Z.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==Z.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===Z.TOK_COMMA&&(this.match(Z.TOK_COMMA),this.lookahead(0)===Z.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Z.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[Z.TOK_UNQUOTEDIDENTIFIER,Z.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Z.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Z.TOK_COMMA)this.match(Z.TOK_COMMA);else if(this.lookahead(0)===Z.TOK_RBRACE){this.match(Z.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const V$=new Y$;var lt;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(lt||(lt={}));class Z${constructor(e){this.TYPE_NAME_TABLE={[lt.TYPE_NUMBER]:"number",[lt.TYPE_ANY]:"any",[lt.TYPE_STRING]:"string",[lt.TYPE_ARRAY]:"array",[lt.TYPE_OBJECT]:"object",[lt.TYPE_BOOLEAN]:"boolean",[lt.TYPE_EXPREF]:"expression",[lt.TYPE_NULL]:"null",[lt.TYPE_ARRAY_NUMBER]:"Array<number>",[lt.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>ea(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===lt.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[lt.TYPE_NUMBER,lt.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===lt.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[lt.TYPE_NUMBER,lt.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==lt.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===lt.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![lt.TYPE_NUMBER,lt.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===lt.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===lt.TYPE_NUMBER?n:r===lt.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===lt.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case lt.TYPE_NUMBER:return"number";case lt.TYPE_STRING:return"string";case lt.TYPE_ARRAY:return"array";case lt.TYPE_OBJECT:return"object";case lt.TYPE_BOOLEAN:return"boolean";case lt.TYPE_EXPREF:return"expref";case lt.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[lt.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[lt.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[lt.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[lt.TYPE_STRING,lt.TYPE_ARRAY]},{types:[lt.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[lt.TYPE_STRING]},{types:[lt.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[lt.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[lt.TYPE_STRING]},{types:[lt.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[lt.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[lt.TYPE_STRING,lt.TYPE_ARRAY,lt.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[lt.TYPE_EXPREF]},{types:[lt.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[lt.TYPE_ARRAY_NUMBER,lt.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[lt.TYPE_ARRAY]},{types:[lt.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[lt.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[lt.TYPE_ARRAY_NUMBER,lt.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[lt.TYPE_ARRAY]},{types:[lt.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[lt.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[lt.TYPE_STRING,lt.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[lt.TYPE_ARRAY_STRING,lt.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[lt.TYPE_ARRAY]},{types:[lt.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[lt.TYPE_STRING]},{types:[lt.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[lt.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[lt.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[lt.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[lt.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[lt.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[lt.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var y;return(y=!m.optional)!==null&&y!==void 0?y:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,h=this.getTypeName(n[m]);let y;for(y=0;y<d.length;y+=1)if(h!==void 0&&this.typeMatches(h,d[y],n[m])){p=!0;break}if(!p&&h!==void 0){const w=d.map(k=>this.TYPE_NAME_TABLE[k]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(e,n,r){if(n===lt.TYPE_ANY)return!0;if(n===lt.TYPE_ARRAY_STRING||n===lt.TYPE_ARRAY_NUMBER||n===lt.TYPE_ARRAY){if(n===lt.TYPE_ARRAY)return e===lt.TYPE_ARRAY;if(e===lt.TYPE_ARRAY){let i;n===lt.TYPE_ARRAY_NUMBER?i=lt.TYPE_NUMBER:n===lt.TYPE_ARRAY_STRING&&(i=lt.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return lt.TYPE_STRING;case"[object Number]":return lt.TYPE_NUMBER;case"[object Array]":return lt.TYPE_ARRAY;case"[object Boolean]":return lt.TYPE_BOOLEAN;case"[object Null]":return lt.TYPE_NULL;case"[object Object]":return e.jmespathType===Z.TOK_EXPREF?lt.TYPE_EXPREF:lt.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class X${constructor(){this._rootValue=null,this.runtime=new Z$(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,f,d,h;switch(e.type){case"Field":return n===null?null:ea(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...e.children],y=this.computeSliceParams(n.length,m),[w,k,T]=y;if(s=[],T>0)for(d=w;d<k;d+=T)s.push(n[d]);else for(d=w;d>k;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(e.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(e.children[0],n),!ea(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(e.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;const C=[],R=[];for(d=0;d<h.length;d+=1)r=this.visit(e.children[2],h[d]),Gu(r)||C.push(h[d]);for(let L=0;L<C.length;L+=1)i=this.visit(e.children[1],C[L]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case Z.TOK_EQ:s=Hu(o,a);break;case Z.TOK_NE:s=!Hu(o,a);break;case Z.TOK_GT:s=o>a;break;case Z.TOK_GTE:s=o>=a;break;case Z.TOK_LT:s=o<a;break;case Z.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case Z.TOK_FLATTEN:const S=this.visit(e.children[0],n);if(!Array.isArray(S))return null;let U=[];for(d=0;d<S.length;d+=1)i=S[d],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<e.children.length;d+=1)f.push(this.visit(e.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let I;for(d=0;d<e.children.length;d+=1)I=e.children[d],f[I.name]=this.visit(I.value,n);return f;case"OrExpression":return r=this.visit(e.children[0],n),Gu(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),Gu(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),Gu(o);case"Literal":return e.value;case Z.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case Z.TOK_CURRENT:return n;case Z.TOK_ROOT:return this._rootValue;case"Function":const D=[];for(let L=0;L<e.children.length;L+=1)D.push(this.visit(e.children[L],n));return this.runtime.callFunction(e.name,D);case"ExpressionReference":const G=e.children[0];return G.jmespathType=Z.TOK_EXPREF,G;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const q$=new X$;lt.TYPE_ANY,lt.TYPE_ARRAY,lt.TYPE_ARRAY_NUMBER,lt.TYPE_ARRAY_STRING,lt.TYPE_BOOLEAN,lt.TYPE_EXPREF,lt.TYPE_NULL,lt.TYPE_NUMBER,lt.TYPE_OBJECT,lt.TYPE_STRING;function J$(t,e){const n=V$.parse(e);return q$.search(n,t)}const Q$=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[z.NAME,z.NAME]),s=J$(n.json,r);return t.set(i,s),0};function t5(t,e){return Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2))}const Yu=Ad(sb);function zE(t){let e;if(!x(Yu))return e;let n=1e9;for(let r=0;r<=Rt.BLACK;++r){const i=r*ac,s=Yu.bits[i],o=Yu.bits[i+1],a=Yu.bits[i+2],c=t5(t,{r:s,g:o,b:a,hex:""});c<n&&(e=r,n=c)}return e}const e5=(t,e)=>{var a,c,l,u;const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[z.NAME]),s=It(r),o=((a=n.content)==null?void 0:a.layers)??[];switch(s){case"seek":{const[f]=rt(e,i,[z.NUMBER]);n.cursor=Xe(f,0,o.length-1);break}case"layer":{const f=n.cursor+1;n.cursor=Xe(f,0,o.length-1);break}case"char":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(c=n.content)==null?void 0:c.layers[n.cursor];x(p)&&Mo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,p.raster[f+d*p.width].asciiCode);break}case"color":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(l=n.content)==null?void 0:l.layers[n.cursor];x(p)&&Mo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,zE(p.raster[f+d*p.width].color));break}case"bg":{const[f,d,h]=rt(e,i,[z.NUMBER,z.NUMBER,z.NAME]),p=(u=n.content)==null?void 0:u.layers[n.cursor];x(p)&&Mo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,zE(p.raster[f+d*p.width].bg));break}}return 0},n5=(t,e)=>{const n=ms(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[z.NAME]);switch(It(r)){case"seek":{const[o]=rt(e,i,[z.NUMBER]);n.cursor=Xe(o,0,n.lines.length-1);break}case"line":n.cursor=Xe(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[f,d]=rt(e,u,[z.NAME]);t.set(f,c[l]??0),++l,u=d}break}}return 0},r5=ji({get(t,e){var r,i,s;const n=P$(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"lines":return[!0,o.lines.length]}break}case"json":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename]}break}case"binary":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"bytes":return[!0,o.bytes.length]}break}case"rexpaint":{const o=ms(t.id());switch(e){case"filename":return[!0,o.filename];case"layers":return[!0,((r=o.content)==null?void 0:r.layers.length)??0];case"width":return[!0,((i=o.content)==null?void 0:i.layers[o.cursor].width)??0];case"height":return[!0,((s=o.content)==null?void 0:s.layers[o.cursor].height)??0];case"cursor":return[!0,o.cursor]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=rt(e,0,[z.NAME,z.ANY]);return _p(n,r),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(ye).join(" ");return he(tt,b.elementfocus,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ye(n),s=r.map(ye).join(" ");return he(tt,b.elementfocus,"$175",`!${s};${i}`),0}).command("readline",n5).command("readjson",Q$).command("readbin",$$).command("readrexpaint",e5).command("with",(t,e)=>{const[n]=rt(e,0,[z.NAME]),r=zn(b.book,_t.BOARD,n);if(r.length){const i=Te(...r);x(i)&&(b.board=Ce(i),b.element={x:-1,y:-1})}return 0});function KE(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[z.ANY]);ae(c)&&!Si(c)&&!Lc(c)&&!Ku(c)&&!ri(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":TA(tt,b.elementfocus,t,e,n,r,o);break}return 0}const i5=ji().command("fetch",(t,e)=>{const[n,r,i="get",s]=rt(e,0,[z.NAME,z.NAME,z.MAYBE_STRING]);return KE(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=rt(e,0,[z.ANY,z.NAME,z.NAME,z.MAYBE_STRING]);return KE(n,r,i,s,e,o),0}).command("chat",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return n?vA(tt,b.elementfocus,n):kA(tt,b.elementfocus),0}).command("broadcast",(t,e)=>{const[n]=rt(e,0,[z.MAYBE_NAME]);return n?EA(tt,b.elementfocus,n):xA(tt,b.elementfocus),0}),s5=ji({set(t,e,n){return j4(t,e,n),[!1,void 0]},everytick(){const t=ur(b.elementid),[e]=t;if(t.length===1&&bt(e)){if(x(b.element))if(e.trim().length===0){const n=hn(b.elementid);n.sidebar=[]}else b.element.tickertext=e,b.element.tickertime=b.timestamp}else if(t.length>1)if(b.elementisplayer){const n=hn(b.elementid);n.sidebar=t}else{const n=hn(b.elementfocus);n.scroll=t}}}).command("send",(t,e)=>{var a,c;const[n,r]=rt(e,0,[z.NAME,z.ANY]),[i,s]=CE(n);switch(It(i)){case"all":for(const l of Object.keys(((a=b.board)==null?void 0:a.objects)??{}))t.send(b.elementfocus,l,s,r);break;case"self":t.message({session:tt.session(),player:b.elementfocus,id:Pe(),sender:t.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((c=b.board)==null?void 0:c.objects)??{}))l!==t.id()&&t.send(b.elementfocus,l,s,r);break;default:{const l=tb(b.board,[i]);for(let u=0;u<l.length;++u){const f=l[u];x(f.id)&&t.send(b.elementfocus,f.id,s,r)}break}}return 0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(ye).join("");return ee(b.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ye(n);return Ut(b.elementid,t.id(),i,r,t.get,t.set),0});function WE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=me(e,{x:s,y:i});wn(o)&&or(t,e,o,t.timestamp),ln(e,{x:s,y:i})}}function o5(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)ln(t,{x:i,y:r})}function HE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=me(e,{x:s,y:i});wn(o)&&or(t,e,o,t.timestamp),ln(e,{x:s,y:i})}}function Vu(t,e){x(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.code=e.code,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.stepx=e.stepx,t.stepy=e.stepy,t.pushable=e.pushable,t.collision=e.collision,t.destructible=e.destructible,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function ip(t,e,n,r,i){if(!x(b.book))return;const s=b.book,o=tn(s,_t.BOARD,t),a=Ce(o);if(!x(a))return;const c=tn(s,_t.BOARD,e),l=Ce(c);if(!x(l))return;Ge(s,a),Ge(s,l);let u=!1;if(x(a)&&x(l)){switch(i){case"all":WE(s,l,n,r);break;case"object":HE(s,l,n,r);break;case"terrain":o5(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,p=!1;switch(i){case"all":h=!0,p=!0;break;case"object":h=!0;break;case"terrain":p=!0;break}const m={x:d,y:f};let y,w=me(a,m);if(wn(w)?(y=jo(a,d,f),Kr(w==null?void 0:w.id)&&(w=void 0)):(y=w,w=void 0),x(y)&&(p||u&&hs(s,y)===i)){u&&WE(s,l,m,m);const k=ds(s,l,[y.kind??""],m);Vu(k,y)}if(x(w)&&(h||u&&hs(s,w)===i)){u&&HE(s,l,m,m);const k=ds(s,l,[w.kind??""],m);Vu(k,w)}}ju(s,l)}}function a5(t,e,n,r,i){if(!x(b.book))return;const s=b.book,o=tn(s,_t.BOARD,t),a=Ce(o);if(!x(a))return;const c=Ed(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Ge(s,a),Ge(s,c);const f=-Math.tan(e*.5),d=Math.sin(e),h=Math.round(12.5*f),p=Math.round(12.5*d),m=new Array(Yt).fill(0);sy(h,0,-h,Yt-1).forEach(A=>{A.x<0?m[A.y]=Math.min(m[A.y],A.x):m[A.y]=Math.max(m[A.y],A.x)});const w=new Array(St).fill(0);sy(0,p,St-1,-p).forEach(A=>{A.y<0?w[A.x]=Math.min(w[A.x],A.y):w[A.x]=Math.max(w[A.x],A.y)});const T=[m,w,m];for(let A=0;A<T.length;++A){const C=T[A];if(A!==1){for(let R=0;R<Yt;++R){const S=C[R],U=R*St;for(let I=0;I<St;I++){const D=(I+S+St)%St;u&&(c.terrain[D+U]=a.terrain[I+U])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:I,y:D}=a.objects[U];if(x(I)&&x(D)){const G=C[D];a.objects[U].x=(I+G+St)%St,a.objects[U].lx=a.objects[U].x}}}}if(A===1){for(let R=0;R<St;++R){const S=C[R];for(let U=0;U<Yt;++U){const I=(U+S+Yt)%Yt;u&&(c.terrain[R+I*St]=a.terrain[R+U*St])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:I,y:D}=a.objects[U];if(x(I)&&x(D)){const G=C[I];a.objects[U].y=(D+G+Yt)%Yt,a.objects[U].ly=a.objects[U].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Ge(s,c),Ge(s,a)}}function c5(t,e){let n=0,r=0,i=0;for(;i<t.length;i++)n+=t[i];for(i=0,e*=n;e&&i<t.length;){if(r+=t[i],e<=r)return i;i++}return 0}var l5=c5;const u5=l5,qt=function(){};qt.prototype.FMX=0,qt.prototype.FMY=0,qt.prototype.FMXxFMY=0,qt.prototype.T=0,qt.prototype.N=0,qt.prototype.initiliazedField=!1,qt.prototype.generationComplete=!1,qt.prototype.wave=null,qt.prototype.compatible=null,qt.prototype.weightLogWeights=null,qt.prototype.sumOfWeights=0,qt.prototype.sumOfWeightLogWeights=0,qt.prototype.startingEntropy=0,qt.prototype.sumsOfOnes=null,qt.prototype.sumsOfWeights=null,qt.prototype.sumsOfWeightLogWeights=null,qt.prototype.entropies=null,qt.prototype.propagator=null,qt.prototype.observed=null,qt.prototype.distribution=null,qt.prototype.stack=null,qt.prototype.stackSize=0,qt.prototype.DX=[-1,0,1,0],qt.prototype.DY=[0,1,0,-1],qt.prototype.opposite=[2,3,0,1],qt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let e=0;e<this.T;e++)this.compatible[t][e]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},qt.prototype.observe=function(t){let e=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=e){const c=1e-6*t();a+c<e&&(e=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=u5(this.distribution,t()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},qt.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const e=t[0],n=e%this.FMX,r=e/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][t[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],p=f[h];p[i]--,p[i]==0&&this.ban(l,h)}}}},qt.prototype.singleIteration=function(t){const e=this.observe(t);return e!==null?(this.generationComplete=e,!!e):(this.propagate(),null)},qt.prototype.iterate=function(t,e){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,e=e||Math.random;for(let n=0;n<t||t===0;n++){const r=this.singleIteration(e);if(r!==null)return!!r}return!0},qt.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const e=this.singleIteration(t);if(e!==null)return!!e}},qt.prototype.isGenerationComplete=function(){return this.generationComplete},qt.prototype.ban=function(t,e){const n=this.compatible[t][e];for(let i=0;i<4;i++)n[i]=0;this.wave[t][e]=!1,this.stack[this.stackSize]=[t,e],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[e],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[e];const r=this.sumsOfWeights[t];this.entropies[t]=Math.log(r)-this.sumsOfWeightLogWeights[t]/r},qt.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let e=0;e<this.T;e++){this.wave[t][e]=!0;for(let n=0;n<4;n++)this.compatible[t][e][n]=this.propagator[this.opposite[n]][e].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var GE=qt;const YE=GE,zi=function(e,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let I=0;I<f;I++)d[I]=new Array(r);this.colors=[];const h={};for(let I=0;I<r;I++)for(let D=0;D<n;D++){const G=(I*n+D)*4,L=[e[G],e[G+1],e[G+2],e[G+3]],N=L.join("-");h.hasOwnProperty(N)||(h[N]=this.colors.length,this.colors.push(L)),d[D][I]=h[N]}const p=this.colors.length,m=Math.pow(p,i*i),y=function(D){let G=new Array(i*i);for(let L=0;L<i;L++)for(let N=0;N<i;N++)G[N+L*i]=D(N,L);return G},w=function(D,G){return y(function(L,N){return d[(D+L)%n][(G+N)%r]})},k=function(D){return y(function(G,L){return D[i-1-L+G*i]})},T=function(D){return y(function(G,L){return D[i-1-G+L*i]})},A=function(D){let G=0,L=1;for(let N=0;N<D.length;N++)G+=D[D.length-1-N]*L,L*=p;return G},C=function(D){let G=D,L=m;const N=new Array(i*i);for(let E=0;E<N.length;E++){L/=p;let P=0;for(;G>=L;)G-=L,P++;N[E]=P}return N},R={},S=[];for(let I=0;I<(a?r:r-i+1);I++)for(let D=0;D<(a?n:n-i+1);D++){const G=new Array(8);G[0]=w(D,I),G[1]=T(G[0]),G[2]=k(G[0]),G[3]=T(G[2]),G[4]=k(G[2]),G[5]=T(G[4]),G[6]=k(G[4]),G[7]=T(G[6]);for(let L=0;L<l;L++){const N=A(G[L]);R[N]?R[N]++:(S.push(N),R[N]=1)}}this.T=S.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let I=0;I<this.T;I++){const D=parseInt(S[I],10);this.patterns[I]=C(D),this.weights[I]=R[D]}const U=function(D,G,L,N){const E=L<0?0:L,P=L<0?L+i:i,q=N<0?0:N,$=N<0?N+i:i;for(let st=q;st<$;st++)for(let nt=E;nt<P;nt++)if(D[nt+i*st]!=G[nt-L+i*(st-N)])return!1;return!0};this.propagator=new Array(4);for(let I=0;I<4;I++){this.propagator[I]=new Array(this.T);for(let D=0;D<this.T;D++){const G=[];for(let L=0;L<this.T;L++)U(this.patterns[D],this.patterns[L],this.DX[I],this.DY[I])&&G.push(L);this.propagator[I][D]=G}}};zi.prototype=Object.create(YE.prototype),zi.prototype.constructor=zi,zi.prototype.onBoundary=function(t,e){return!this.periodic&&(t+this.N>this.FMX||e+this.N>this.FMY||t<0||e<0)},zi.prototype.clear=function(){if(YE.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let e=0;e<this.T;e++)e!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,e);for(let e=0;e<this.FMY-1;e++)this.ban(t+e*this.FMX,this.ground)}this.propagate()}},zi.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},zi.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMY;e++){const n=e<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(e*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(e-n)*this.FMX]][i+n*this.N]];t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3]}}},zi.prototype.graphicsIncomplete=function(t){for(let e=0;e<this.FMXxFMY;e++){const n=e%this.FMX,r=e/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const p=d+h*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const y=this.colors[this.patterns[m][f+u*this.N]];s+=y[0],o+=y[1],a+=y[2],c+=y[3]}}const l=e*4;t[l]=s/i,t[l+1]=o/i,t[l+2]=a/i,t[l+3]=c/i}};var h5=zi;const f5=GE,gs=function(e,n,r,i,s){const o=e.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!e.unique;let c=null;n&&e.subsets&&e.subsets[n]&&(c=e.subsets[n]);const l=function(A){const C=new Array(o*o);for(let R=0;R<o;R++)for(let S=0;S<o;S++)C[S+R*o]=A(S,R);return C},u=function(A){return l(function(C,R){return A[o-1-R+C*o]})},f=function(A){return l(function(C,R){return A[o-1-C+R*o]})};this.tiles=[];const d=[],h=[],p={};let m,y,w;for(let T=0;T<e.tiles.length;T++){const A=e.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":w=4,m=function(R){return(R+1)%4},y=function(R){return R%2===0?R+1:R-1};break;case"T":w=4,m=function(R){return(R+1)%4},y=function(R){return R%2===0?R:4-R};break;case"I":w=2,m=function(R){return 1-R},y=function(R){return R};break;case"\\":w=2,m=function(R){return 1-R},y=function(R){return 1-R};break;case"F":w=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},y=function(R){return R<4?R+4:R-4};break;default:w=1,m=function(R){return R},y=function(R){return R};break}this.T=h.length,p[A.name]=this.T;for(let R=0;R<w;R++)h.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+y(R),this.T+y(m(R)),this.T+y(m(m(R))),this.T+y(m(m(m(R))))]);let C;if(a)for(let R=0;R<w;R++)C=A.bitmap[R],this.tiles.push(l(function(S,U){return[C[(o*U+S)*4],C[(o*U+S)*4+1],C[(o*U+S)*4+2],C[(o*U+S)*4+3]]}));else{C=A.bitmap,this.tiles.push(l(function(R,S){return[C[(o*S+R)*4],C[(o*S+R)*4+1],C[(o*S+R)*4+2],C[(o*S+R)*4+3]]}));for(let R=1;R<w;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):f(this.tiles[this.T+R-4]))}for(let R=0;R<w;R++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const k=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),k[T]=new Array(this.T);for(let A=0;A<this.T;A++){k[T][A]=new Array(this.T);for(let C=0;C<this.T;C++)k[T][A][C]=!1}}for(let T=0;T<e.neighbors.length;T++){const A=e.neighbors[T],C=A.left.split(" ").filter(function(G){return G.length}),R=A.right.split(" ").filter(function(G){return G.length});if(c!==null&&(c.indexOf(C[0])===-1||c.indexOf(R[0])===-1))continue;const S=h[p[C[0]]][C.length==1?0:parseInt(C[1],10)],U=h[S][1],I=h[p[R[0]]][R.length==1?0:parseInt(R[1],10)],D=h[I][1];k[0][I][S]=!0,k[0][h[I][6]][h[S][6]]=!0,k[0][h[S][4]][h[I][4]]=!0,k[0][h[S][2]][h[I][2]]=!0,k[1][D][U]=!0,k[1][h[U][6]][h[D][6]]=!0,k[1][h[D][4]][h[U][4]]=!0,k[1][h[U][2]][h[D][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)k[2][T][A]=k[0][A][T],k[3][T][A]=k[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const C=[],R=k[T][A];for(let S=0;S<this.T;S++)R[S]&&C.push(S);this.propagator[T][A]=C}};gs.prototype=Object.create(f5.prototype),gs.prototype.constructor=gs,gs.prototype.onBoundary=function(t,e){return!this.periodic&&(t<0||e<0||t>=this.FMX||e>=this.FMY)},gs.prototype.graphics=function(t,e){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,e),t},gs.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMX;e++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[e+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(e*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];t[o]=a[0],t[o+1]=a[1],t[o+2]=a[2],t[o+3]=a[3]}}},gs.prototype.graphicsIncomplete=function(t,e){(!e||e.length!==4)&&(e=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(e&&s===this.T)t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];else{let f=0,d=0,h=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const y=this.tiles[m][l+c*this.tilesize],w=this.weights[m]*a;f+=y[0]*w,d+=y[1]*w,h+=y[2]*w,p+=y[3]*w}t[u]=f,t[u+1]=d,t[u+2]=h,t[u+3]=p}}}};var d5=gs,p5={OverlappingModel:h5,SimpleTiledModel:d5},m5=no(p5);const VE=5;function ZE(t,e,n,r,i,s,o){if(!x(b.book))return!1;const a=b.book,c=tn(a,_t.BOARD,t),l=tn(a,_t.BOARD,e),u=Ce(c),f=Ce(l);if(!x(u)||!x(f))return!1;Ge(a,u),Ge(a,f);let d=0;const h=new Map,p=new Map;let m=0;const y=32,w=new Uint8Array(wd*4);for(let S=0;S<Yt;++S)for(let U=0;U<St;++U){const I=me(f,{x:U,y:S}),D=(I==null?void 0:I.char)??0,G=(I==null?void 0:I.color)??y,L=(I==null?void 0:I.bg)??y;w[m++]=D,w[m++]=G,w[m++]=L;const N=Di(a,I),E=It((N==null?void 0:N.name)??"empty"),P=h.get(E);At(P)?w[m++]=P:(h.set(E,d),p.set(d,E),w[m++]=d++)}const k=s.x-i.x+1,T=s.y-i.y+1,A=new m5.OverlappingModel(w,St,Yt,n,k,T,!1,!1,r,0);let C=0;for(;C<VE&&!A.generate();++C);if(C===VE)return!1;m=0;const R=A.graphics();for(let S=i.y;S<=s.y;++S)for(let U=i.x;U<=s.x;++U){const I={x:U,y:S},D=R[m++],G=R[m++],L=R[m++];switch(d=R[m++],o){case"all":{const st=me(u,{x:U,y:S});wn(st)&&or(a,u,st,a.timestamp),ln(u,{x:U,y:S});break}case"object":{const st=me(u,{x:U,y:S});wn(st)&&or(a,u,st,a.timestamp);break}case"terrain":ln(u,{x:U,y:S});break}let N=p.get(d)??"";const E=Xs(a,N),P=Oc(a,N),q=E??P;switch(o){case"all":break;case"object":x(P)&&(N="");break;case"terrain":x(E)&&(N="");break;default:if(hs(a,q)!==o&&(N=""),N){const st=me(u,{x:U,y:S});wn(st)&&or(a,u,st,a.timestamp),ln(u,{x:U,y:S})}break}const $=N?ds(a,u,[N],I):void 0;if(!(!x($)||!x(q))&&(Vu($,q),D>0&&($.char=D),G<y&&($.color=G),L<y&&($.bg=L),wn($))){const st=Te(oc(f,N));x(st)&&(ln(u,{...jo(f,st.x??0,st.y??0),x:U,y:S}),Vu($,st))}}return!0}function XE(t){return`zss_snapshot_${t}`}function g5(t,e,n,r){const i=tn(b.book,_t.BOARD,t),s=Ce(i);if(!x(s))return;const o=XE(s.id);pE(b.book,o);const a=ys(Pt.CONTENT,o,_t.BOARD),c=Ce(a);if(x(c))return ip(t,c.id,e,n,r),c}function _5(t,e,n,r){const i=tn(b.book,_t.BOARD,t),s=Ce(i);if(!x(s))return;const o=XE(s.id),a=tn(b.book,_t.BOARD,o),c=Ce(a);if(x(c))return ip(c.id,t,e,n,r),c}function y5(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return b5(t,e,i)}if(!x(b.book))return;const s=b.book,o=tn(s,_t.BOARD,t),a=Ce(o);if(!x(a))return;const c=Ed();Ge(s,a);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let f=!1,d=!1;switch(i){case"all":f=!0,d=!0;break;case"object":f=!0;break;case"terrain":d=!0;break}const h=(u+e.x+St)%St,p=(l+e.y+Yt)%Yt;if(f){const m=me(a,{x:u,y:l});wn(m)&&x(m==null?void 0:m.x)&&x(m==null?void 0:m.y)&&(m.x=h,m.lx=h,m.y=p,m.ly=p)}d&&(c.terrain[h+p*St]=a.terrain[u+l*St])}(i==="all"||i==="terrain")&&(a.terrain=[...c.terrain]),ju(s,a)}function b5(t,e,n){if(!x(b.book))return;const r=b.book,i=tn(r,_t.BOARD,t),s=Ce(i);if(!x(s))return;Ge(r,s);const{objectelements:o,terrainelements:a}=dF(r,s,n);let c=!1;const l={};for(let f=0;f<a.length;++f){const d=a[f],h=He(r,d,"collision"),p={x:d.x??-1,y:d.y??-1},m=me(s,p);wn(m)&&x(m)&&(l[m.id??""]=!0);const y={x:p.x+e.x,y:p.y+e.y};if(Wl(y)){const w=me(s,y),k=hs(r,w),T=He(r,w,"collision");wn(w)&&n!==k?zo(h,T)?c=!0:He(r,w,"pushable")?c=ua(r,s,w,y)!==!0:c=!1:T===$t.ISSOLID&&n!==k&&(c=!0)}else c=!0}if(c)return;for(let f=0;f<o.length;++f){const d=o[f],h=He(r,d,"collision"),p={x:d.x??0,y:d.y??0},m={x:p.x+e.x,y:p.y+e.y};if(Wl(m)){const y=me(s,m),w=hs(r,y),k=He(r,y,"collision");wn(y)&&x(y)&&n!==w&&!l[y.id??""]?He(r,y,"pushable")?c=ua(r,s,y,m)!==!0:c=!0:zo(h,k)&&n!==w&&(c=!0)}else c=!0}if(c)return;(e.x>0||e.y>0)&&a.reverse();for(let f=0;f<a.length;++f){const d=a[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y},m=jo(s,p.x,p.y);if(x(d)&&x(m)){ln(s,{...d,x:p.x,y:p.y}),ln(s,{...m,x:h.x,y:h.y});const y=me(s,h);wn(y)&&x(y)&&(y.x=(y.x??0)+e.x,y.y=(y.y??0)+e.y,y.lx=(y.lx??0)+e.x,y.ly=(y.ly??0)+e.y)}}ju(r,s);for(let f=0;f<o.length;++f){const d=o[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y};if(!ua(r,s,d,p))break}ju(r,s)}function na(t,e){let n="all";const r={x:0,y:0},i={x:St-1,y:Yt-1};for(let s=e;s<t.length;){const[o,a]=rt(t,s,[z.MAYBE_NUMBER_OR_STRING]);if(bt(o))n=It(o),s=a;else if(At(o)){const[c,l,u,f]=rt(t,a,[z.NUMBER,z.NUMBER,z.NUMBER]);r.x=Math.min(o,l),r.y=Math.min(c,u),i.x=Math.max(o,l),i.y=Math.max(c,u),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const w5=ji().command("snapshot",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;const n=na(e,0);return g5(b.board.id,n.pt1,n.pt2,n.targetset),0}).command("revert",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;const n=na(e,0);return _5(b.board.id,n.pt1,n.pt2,n.targetset),0}).command("copy",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;const[n,r]=rt(e,0,[z.NAME]),i=zn(b.book,_t.BOARD,n),s=Te(...i);if(x(s)){const o=na(e,r);ip(s.id,b.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;const[n,r,i,s]=rt(e,0,[z.NAME,z.NUMBER,z.NUMBER]),o=zn(b.book,_t.BOARD,n),a=Te(...o);if(x(a)){const c=na(e,s);ZE(b.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{var o,a;if(!x(b.book)||!x(b.board))return 0;const[n,r]=rt(e,0,[z.DIR]),i={x:n.destpt.x-(((o=b.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=b.element)==null?void 0:a.y)??0)},s=na(e,r);return y5(b.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(t,e)=>{if(!x(b.book)||!x(b.board))return 0;const[n,r]=rt(e,0,[z.NUMBER]),i=na(e,r);return a5(b.board.id,fy(n),i.pt1,i.pt2,i.targetset),0});var _s=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(_s||{});const E5={audio:H0,board:RF,cli:R$,display:S$,element:F$,runtime:s5,loader:r5,network:i5,transform:w5},sp=["audio","board","display","network","transform","element"],x5={0:[],1:["cli",...sp],2:["loader",...sp],3:["runtime",...sp]},v5={0:new Map,1:new Map,2:new Map,3:new Map};function ra(t){return(x5[t]??[]).map(n=>E5[n]).filter(x)}function op(t){const e=[],n=ra(t);for(let r=0;r<n.length;++r)e.push(...n[r].listcommands());return e}function k5(t,e){const n=v5[t];if(!n.has(e)){let r;const i=ra(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!x(r));++s);n.set(e,r)}return n.get(e)}function T5(t,e,n){const r=ra(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function A5(t,e,n,r){const i=ra(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function R5(t,e){const n=ra(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function qE(t,e){const n=ra(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var JE={},QE={},tx={};const ex="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");tx.encode=function(t){if(0<=t&&t<ex.length)return ex[t];throw new TypeError("Must be between 0 and 63: "+t)};const S5=tx,nx=5,rx=1<<nx,O5=rx-1,I5=rx;function N5(t){return t<0?(-t<<1)+1:(t<<1)+0}QE.encode=function(e){let n="",r,i=N5(e);do r=i&O5,i>>>=nx,i>0&&(r|=I5),n+=S5.encode(r);while(i>0);return n};var Mc={};(function(t){function e(R,S,U){if(S in R)return R[S];if(arguments.length===3)return U;throw new Error('"'+S+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const S=R.match(n);return S?{scheme:S[1],auth:S[2],host:S[3],port:S[4],path:S[5]}:null}t.urlParse=i;function s(R){let S="";return R.scheme&&(S+=R.scheme+":"),S+="//",R.auth&&(S+=R.auth+"@"),R.host&&(S+=R.host),R.port&&(S+=":"+R.port),R.path&&(S+=R.path),S}t.urlGenerate=s;const o=32;function a(R){const S=[];return function(U){for(let D=0;D<S.length;D++)if(S[D].input===U){const G=S[0];return S[0]=S[D],S[D]=G,S[0].result}const I=R(U);return S.unshift({input:U,result:I}),S.length>o&&S.pop(),I}}const c=a(function(S){let U=S;const I=i(S);if(I){if(!I.path)return S;U=I.path}const D=t.isAbsolute(U),G=[];let L=0,N=0;for(;;)if(L=N,N=U.indexOf("/",L),N===-1){G.push(U.slice(L));break}else for(G.push(U.slice(L,N));N<U.length&&U[N]==="/";)N++;let E=0;for(N=G.length-1;N>=0;N--){const P=G[N];P==="."?G.splice(N,1):P===".."?E++:E>0&&(P===""?(G.splice(N+1,E),E=0):(G.splice(N,2),E--))}return U=G.join("/"),U===""&&(U=D?"/":"."),I?(I.path=U,s(I)):U});t.normalize=c;function l(R,S){R===""&&(R="."),S===""&&(S=".");const U=i(S),I=i(R);if(I&&(R=I.path||"/"),U&&!U.scheme)return I&&(U.scheme=I.scheme),s(U);if(U||S.match(r))return S;if(I&&!I.host&&!I.path)return I.host=S,s(I);const D=S.charAt(0)==="/"?S:c(R.replace(/\/+$/,"")+"/"+S);return I?(I.path=D,s(I)):D}t.join=l,t.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,S){R===""&&(R="."),R=R.replace(/\/$/,"");let U=0;for(;S.indexOf(R+"/")!==0;){const I=R.lastIndexOf("/");if(I<0||(R=R.slice(0,I),R.match(/^([^\/]+:\/)?\/*$/)))return S;++U}return Array(U+1).join("../")+S.substr(R.length+1)}t.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(R){return R}function h(R){return m(R)?"$"+R:R}t.toSetString=f?d:h;function p(R){return m(R)?R.slice(1):R}t.fromSetString=f?d:p;function m(R){if(!R)return!1;const S=R.length;if(S<9||R.charCodeAt(S-1)!==95||R.charCodeAt(S-2)!==95||R.charCodeAt(S-3)!==111||R.charCodeAt(S-4)!==116||R.charCodeAt(S-5)!==111||R.charCodeAt(S-6)!==114||R.charCodeAt(S-7)!==112||R.charCodeAt(S-8)!==95||R.charCodeAt(S-9)!==95)return!1;for(let U=S-10;U>=0;U--)if(R.charCodeAt(U)!==36)return!1;return!0}function y(R,S,U){let I=k(R.source,S.source);return I!==0||(I=R.originalLine-S.originalLine,I!==0)||(I=R.originalColumn-S.originalColumn,I!==0||U)||(I=R.generatedColumn-S.generatedColumn,I!==0)||(I=R.generatedLine-S.generatedLine,I!==0)?I:k(R.name,S.name)}t.compareByOriginalPositions=y;function w(R,S,U){let I=R.generatedLine-S.generatedLine;return I!==0||(I=R.generatedColumn-S.generatedColumn,I!==0||U)||(I=k(R.source,S.source),I!==0)||(I=R.originalLine-S.originalLine,I!==0)||(I=R.originalColumn-S.originalColumn,I!==0)?I:k(R.name,S.name)}t.compareByGeneratedPositionsDeflated=w;function k(R,S){return R===S?0:R===null?1:S===null?-1:R>S?1:-1}function T(R,S){let U=R.generatedLine-S.generatedLine;return U!==0||(U=R.generatedColumn-S.generatedColumn,U!==0)||(U=k(R.source,S.source),U!==0)||(U=R.originalLine-S.originalLine,U!==0)||(U=R.originalColumn-S.originalColumn,U!==0)?U:k(R.name,S.name)}t.compareByGeneratedPositionsInflated=T;function A(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function C(R,S,U){if(S=S||"",R&&(R[R.length-1]!=="/"&&S[0]!=="/"&&(R+="/"),S=R+S),U){const I=i(U);if(!I)throw new Error("sourceMapURL could not be parsed");if(I.path){const D=I.path.lastIndexOf("/");D>=0&&(I.path=I.path.substring(0,D+1))}S=l(s(I),S)}return c(S)}t.computeSourceURL=C})(Mc);var ap={};let C5=class jx{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new jx;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};ap.ArraySet=C5;var ix={};const sx=Mc;function L5(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||sx.compareByGeneratedPositionsInflated(t,e)<=0}let M5=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){L5(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(sx.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};ix.MappingList=M5;const Uc=QE,Ye=Mc,Zu=ap.ArraySet,U5=ix.MappingList;let ox=class zx{constructor(e){e||(e={}),this._file=Ye.getArg(e,"file",null),this._sourceRoot=Ye.getArg(e,"sourceRoot",null),this._skipValidation=Ye.getArg(e,"skipValidation",!1),this._sources=new Zu,this._names=new Zu,this._mappings=new U5,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new zx({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ye.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=Ye.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=Ye.getArg(e,"generated"),r=Ye.getArg(e,"original",null);let i=Ye.getArg(e,"source",null),s=Ye.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=Ye.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ye.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ye.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=Ye.relative(s,i));const o=this._mappings.toArray().length>0?new Zu:this._sources,a=new Zu;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=Ye.join(r,c.source)),s!=null&&(c.source=Ye.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=Ye.join(r,c)),s!=null&&(c=Ye.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,p=d.length;h<p;h++){if(l=d[h],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Ye.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Uc.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Uc.encode(f-o),o=f,c+=Uc.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Uc.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Uc.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ye.relative(n,r));const i=Ye.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};ox.prototype._version=3,JE.SourceMapGenerator=ox;var ax={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(ax);var Fc={exports:{}},F5={},B5=Object.freeze({__proto__:null,default:F5}),cx=Kx(B5);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;Fc.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Fc.exports.initialize=e=>t=e}else{const t=cx,e=cx;Fc.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Fc.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var lx=Fc.exports;const P5=lx;function D5(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Bc=null;var $5=function(){if(Bc)return Bc;const e=[];return Bc=P5().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new D5;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),e[e.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw Bc=null,n}),Bc};const kt=Mc,cp=ax,Xu=ap.ArraySet,j5=lx,z5=$5,lp=Symbol("smcInternal");class je{constructor(e,n){return e==lp?Promise.resolve(this):W5(e,n)}static initialize(e){j5.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return H5(e,n)}static async with(e,n,r){const i=await new je(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}je.prototype._version=3,je.GENERATED_ORDER=1,je.ORIGINAL_ORDER=2,je.GREATEST_LOWER_BOUND=1,je.LEAST_UPPER_BOUND=2;class Pc extends je{constructor(e,n){return super(lp).then(r=>{let i=e;typeof e=="string"&&(i=kt.parseSourceMapInput(e));const s=kt.getArg(i,"version");let o=kt.getArg(i,"sources");const a=kt.getArg(i,"names",[]);let c=kt.getArg(i,"sourceRoot",null);const l=kt.getArg(i,"sourcesContent",null),u=kt.getArg(i,"mappings"),f=kt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=kt.normalize(c)),o=o.map(String).map(kt.normalize).map(function(d){return c&&kt.isAbsolute(c)&&kt.isAbsolute(d)?kt.relative(c,d):d}),r._names=Xu.fromArray(a.map(String),!0),r._sources=Xu.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return kt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,z5().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=kt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Pc(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||je.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=kt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case je.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case je.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=kt.getArg(e,"source");const r=kt.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:kt.getArg(e,"line"),generatedColumn:kt.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=kt.getArg(e,"bias",je.GREATEST_LOWER_BOUND);r==null&&(r=je.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=kt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=kt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=kt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:kt.getArg(i,"originalLine",null),column:kt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=kt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=kt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=kt.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:kt.getArg(e,"line"),originalColumn:kt.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=kt.getArg(e,"bias",je.GREATEST_LOWER_BOUND);i==null&&(i=je.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:kt.getArg(s,"generatedLine",null),column:kt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Pc.prototype.consumer=je;class K5 extends je{constructor(e,n){return super(lp).then(r=>{let i=e;typeof e=="string"&&(i=kt.parseSourceMapInput(e));const s=kt.getArg(i,"version"),o=kt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Xu,r._names=new Xu,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=kt.getArg(c,"offset"),u=kt.getArg(l,"line"),f=kt.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new je(kt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(kt.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(kt.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:kt.getArg(e,"line"),generatedColumn:kt.getArg(e,"column")},r=cp.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(kt.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=kt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||je.GENERATED_ORDER;let o;switch(s){case je.GENERATED_ORDER:o=this._generatedMappings;break;case je.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=kt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return cp.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=kt.getArg(e,"line"),r={source:kt.getArg(e,"source"),originalLine:n,originalColumn:kt.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",kt.compareByOriginalPositions,cp.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kt.getArg(o,"generatedLine",null),column:kt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kt.getArg(o,"generatedLine",null),column:kt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function W5(t,e){let n=t;typeof t=="string"&&(n=kt.parseSourceMapInput(t));const r=n.sections!=null?new K5(n,e):new Pc(n,e);return Promise.resolve(r)}function H5(t,e){return Pc.fromSourceMap(t,e)}var ux={};const G5=JE.SourceMapGenerator,qu=Mc,Y5=/(\r?\n)/,V5=10,ia="$$$isSourceNode$$$";let Z5=class xp{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[ia]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new xp,s=e.split(Y5);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const p=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=qu.join(r,h)),i.setSourceContent(h,p))}),i;function d(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?qu.join(r,h.source):h.source;i.add(new xp(h.originalLine,h.originalColumn,m,p,h.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[ia]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[ia]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[ia]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[ia]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[qu.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][ia]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(qu.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new G5(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===V5?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};ux.SourceNode=Z5;var X5=ux.SourceNode;let hx=0;const fx=di,q5=["Command","lines"];class J5 extends OU{constructor(){super(iE,{traceInitPerf:di,skipValidations:!di,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Lt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Lt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Rc)}])}));Lt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Lt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Lt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Lt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Nw)}));Lt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(x0)}));Lt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Ow)}])}));Lt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Iw)}));Lt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Cw),this.SUBRULE(this.words),this.CONSUME(Lw)}));Lt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Jo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Lt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Lt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Lt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Lt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(S0),this.SUBRULE(this.words)}));Lt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Gw),this.SUBRULE(this.words)}));Lt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(O0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Lt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Rc)),this.CONSUME4(Jo),this.CONSUME4(I0)}}])}));Lt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Jo),this.CONSUME(I0)}}])}));Lt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Lt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Jo),this.CONSUME(N0),this.CONSUME(O0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Lt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Jo),this.CONSUME(N0),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Lt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(qw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(Jw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Qw),this.SUBRULE(this.words)}));Lt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(tE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(eE)}));Lt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(nE)}));Lt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Zw)}));Lt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Xw)}));Lt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(v0),this.SUBRULE2(this.and_test)})}));Lt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(T0),this.SUBRULE2(this.not_test)})}));Lt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(k0),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Lt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Lt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(jw)}])}));Lt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(v0),this.SUBRULE2(this.and_test_value)})}));Lt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(T0),this.SUBRULE2(this.not_test_value)})}));Lt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(k0),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Lt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Lt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(A0)},{ALT:()=>this.CONSUME(R0)}]),this.SUBRULE(this.term)}));Lt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Lt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(S0)},{ALT:()=>this.CONSUME(Ww)},{ALT:()=>this.CONSUME(Hw)}]),this.SUBRULE(this.factor)}));Lt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(A0)},{ALT:()=>this.CONSUME(R0)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Lt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(zw),this.SUBRULE(this.factor)})}));Lt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Lt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(_n)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>{this.CONSUME(Yw),this.SUBRULE(this.words),this.CONSUME(Vw)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=q5.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(hx++).toString().padStart(3),c=s?"font-weight: bold;":"";if(fx&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),fx&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),hx--},i)}}const sa=new J5;if(zU){const t=sa.getGAstProductions(),e=jU(t);console.info(e)}const Q5=sa.getBaseCstVisitorConstructor();var yt=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(yt||{}),Qs=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Qs||{}),pi=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(pi||{}),Ju=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(Ju||{});function Rr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class t4 extends Q5{constructor(){super();Lt(this,"unique",0);di&&this.validateVisitor()}visit(n){if(ae(n)&&(n=n[0]),!!x(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Rr(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Rr(n.token_stat,"@").slice(1)}))}stmt_text(n,r){return this.createlinenode(r,this.createcodenode(r,{type:6,value:Rr(n.token_text,"")}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Rr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:Rr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n,r){return n.words?this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,Rr(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=Pe(),s=Pe();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=Pe(),s=Pe();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,Rr(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){return this.createcodenode(r,{type:17,lines:this.go(n.command_fork)})}command_while(n,r){const i=Pe(),s=Pe();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=Pe(),s=Pe(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=Pe(),s=Pe(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=Pe();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=Rr(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}))}command_toast(n,r){const s=Rr(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"toast"),this.createstringnode(r,s)].flat()}))}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}token(n,r){if(n.token_stringliteraldouble){const i=Rr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Rr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Rr(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return n.token_lparen?this.createcodenode(r,{type:31,words:this.go(n.words)}):[]}}const e4=new t4,Hn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Qu="zss.js";function Jt(t,e){return new X5(t.startLine??1,t.startColumn??1,Qu,e)}function up(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function hp(t){return`'${up(t)}'`}function th(t){if(t.startsWith('"'))return th(t.replaceAll(/(^"|"$)/g,""));const e=q0(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===Z0?`', api.get('${up(r.image.substring(1))}'), '`:up(r.image)).join("")}'].join('')`}function oa(t){return t.filter(e=>e!==void 0).map(ne)}function dx(t){return Jt(t,"")}function n4(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function en(t,e,n){return Jt(t,[`api.${e}(`,...n4(n,", "),")"])}function r4(t){if(t.type===yt.COMPARE&&t.compare.type===yt.COMPARE_ITEM)switch(t.compare.method){case Qs.IS_EQ:return en(t,"isEq",[ne(t.lhs),ne(t.rhs)]);case Qs.IS_NOT_EQ:return en(t,"isNotEq",[ne(t.lhs),ne(t.rhs)]);case Qs.IS_LESS_THAN:return en(t,"isLessThan",[ne(t.lhs),ne(t.rhs)]);case Qs.IS_GREATER_THAN:return en(t,"isGreaterThan",[ne(t.lhs),ne(t.rhs)]);case Qs.IS_LESS_THAN_OR_EQ:return en(t,"isLessThanOrEq",[ne(t.lhs),ne(t.rhs)]);case Qs.IS_GREATER_THAN_OR_EQ:return en(t,"isGreaterThanOrEq",[ne(t.lhs),ne(t.rhs)])}return Jt(t,"")}function to(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",ne(n),")"])}function px(t,e,n){return t.prepend(`api.${e}(`),t.add([ne(n),")"])}function i4(t,e){if(t.type===yt.OPERATOR_ITEM)switch(t.operator){case pi.PLUS:return to(e,"opPlus",t.rhs);case pi.MINUS:return to(e,"opMinus",t.rhs);case pi.POWER:return to(e,"opPower",t.rhs);case pi.MULTIPLY:return to(e,"opMultiply",t.rhs);case pi.DIVIDE:return to(e,"opDivide",t.rhs);case pi.MOD_DIVIDE:return to(e,"opModDivide",t.rhs);case pi.FLOOR_DIVIDE:return to(e,"opFloorDivide",t.rhs);case pi.UNI_PLUS:return px(e,"opUniPlus",t.rhs);case pi.UNI_MINUS:return px(e,"opUniMinus",t.rhs)}return Jt(t,"")}function s4(t){if(t.type===yt.OPERATOR){const e=t.lhs?ne(t.lhs):Jt(t,"");return t.items.forEach(n=>i4(n,e)),e}return Jt(t,"")}function eh(t,e){return Jt(t,[en(t,"jump",[`${e}`]),"; continue;"])}function Ki(t){return Hn.linelookup[t??""]??-1}function fp(t,e){Hn.linelookup[t]=e}function aa(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&(i.done=n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&(i.skip=n);break;case yt.LINE:aa(i.stmts,e,n);break}}}function mx(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&fp(i.done,n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&fp(i.skip,n);break;case yt.LINE:mx(i.stmts,e,n);break}}}function ne(t){var e;switch(t.type){case yt.PROGRAM:return Jt(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(ne).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Qu}`]);case yt.API:return Jt(t,["  ",en(t,t.method,oa(t.words)),`;
`]);case yt.LINE:return Jt(t,[`case ${t.lineindex}:
`,...t.stmts.map(ne).flat(),`  break;
`]);case yt.MARK:return Jt(t,`  // ${t.comment}
`);case yt.GOTO:{const n=Ki(t.id);return Jt(t,["  ",eh(t,n),`
`])}case yt.COUNT:return Jt(t,`${t.index}`);case yt.LITERAL:switch(t.literal){case Ju.NUMBER:return Jt(t,`${t.value}`);case Ju.STRING:return Jt(t,hp(t.value));case Ju.TEMPLATE:return Jt(t,th(t.value))}return dx(t);case yt.TEXT:return Jt(t,["  ",en(t,"text",[th(t.value)]),`;
`]);case yt.STAT:if(Hn.isfirststat){Hn.isfirststat=!1;const n=t.value.trim().split(" ").map(hp);return Jt(t,["  ",en(t,"stat",n),`;
`])}return Jt(t,`  // skipped ${t.value}
`);case yt.LABEL:{const n=It(t.name),r=t.active?"label":"comment";Hn.labels[n]||(Hn.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Hn.labels[n].push(i),Jt(t,`  // ${i} '${n}' ${r}
`)}case yt.HYPERLINK:return Jt(t,["  ",en(t,"hyperlink",[th(t.text),...oa(t.link)]),`;
`]);case yt.MOVE:{const n=en(t,"command",[hp("go"),oa(t.words)].flat());return t.wait?Jt(t,["  if (",n,`) { continue; };
`]):Jt(t,["  ",n,`;
`])}case yt.COMMAND:return Jt(t,["  if (",en(t,"command",oa(t.words)),`) { continue; };
`]);case yt.IF:{const n=((e=t.block)==null?void 0:e.type)===yt.IF_BLOCK?t.block:void 0;if(x(n)){aa([t.check],yt.IF_CHECK,n.skip);const r=Jt(t,ne(t.check));return n.lines.forEach(i=>r.add(ne(i))),mx(n.altlines,yt.ELSE_IF,Ki(n.done)),n.altlines.forEach(i=>r.add(ne(i))),r}return Jt(t,ne(t.check))}case yt.IF_CHECK:{const n=Ki(t.skip);return n===-1?Jt(t,["  ",en(t,t.method,oa(t.words)),`;
`]):Jt(t,["  if (!",en(t,t.method,oa(t.words)),") { ",eh(t,n),` }
`])}case yt.ELSE_IF:case yt.ELSE:{const n=Jt(t,"");return t.lines.forEach(r=>n.add(ne(r))),n}case yt.WHILE:{const n=Ki(t.loop),r=Ki(t.done),i=Jt(t,"");return aa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case yt.REPEAT:{const n=Ki(t.loop),r=Ki(t.done),i=Jt(t,"");return aa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case yt.WAITFOR:{const n=Jt(t,"");return aa(t.lines,yt.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(ne(r))}),n}case yt.FOREACH:{const n=Ki(t.loop),r=Ki(t.done),i=Jt(t,"");return aa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ne(s))}),i}case yt.BREAK:return Jt(t,["  ",eh(t,t.goto),`
`]);case yt.CONTINUE:return Jt(t,["  ",eh(t,t.goto),`
`]);case yt.OR:return en(t,"or",t.items.map(ne));case yt.AND:return en(t,"and",t.items.map(ne));case yt.NOT:return en(t,"not",t.items.map(ne));case yt.COMPARE:return r4(t);case yt.OPERATOR:return s4(t);case yt.EXPR:return en(t,"expr",t.words.map(ne));default:return console.error("<unsupported node>",t.type,t),dx(t)}}function mi(t){if(x(t))switch(t.type===yt.LINE&&++Hn.lineindex,t.lineindex=Hn.lineindex,t.type){case yt.PROGRAM:t.lines.forEach(mi);break;case yt.LINE:t.stmts.forEach(mi);break;case yt.MARK:fp(t.id,t.lineindex);break;case yt.IF:mi(t.check),mi(t.block);break;case yt.IF_BLOCK:t.lines.forEach(mi),t.altlines.forEach(mi);break;case yt.ELSE_IF:t.lines.forEach(mi);break;case yt.ELSE:case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.WAITFOR:t.lines.forEach(mi);break;case yt.MOVE:case yt.COMMAND:case yt.IF_CHECK:t.words.forEach(mi);break}}function o4(t){Hn.labels={},Hn.internal=1,Hn.lineindex=0,Hn.isfirststat=!0,mi(t)}function a4(t){return o4(t),{...ne(t).toStringWithSourceMap({file:`${Qu}.map`}),...Hn}}function gx(t){return ae(t)?t.length>0?1:0:t??0}function c4(t){return`${t}_chip`}function _x(t=""){return`vm:${t??""}`}function l4(t,e,n){var l,u;const r=c4(t),i=Sr(r);let s;const o=Zn(Object.entries(n.labels??{}));(!ae(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){b.words=d;const h=k5(e,f);return x(h)?h(c,d):f!=="send"?a("send",[f,...d]):0}const c={halt(){v4(r)},id(){return t},set(f,d){const[h,p]=A5(e,c,f,d);if(h)return p},get(f){const[d,h]=T5(e,c,f);if(d)return h},tick(f){const d=At(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return qE(e,c),!1;i.lc=0,i.ys=0,b.get=c.get,R5(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ue(tt,b.elementfocus,"crash",p.message),i.es=1}return qE(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return At(i.lc)?++i.lc>Fi.HALT_AT_COUNT:!0},hm(){if(ae(i.mg)&&ae(i.lb)){const[f]=i.mg;if(x(f))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)return p.find(m=>At(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,p){tt.emit(f,`${_x(d)}:${h}`,p)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f){const m=p.findIndex(y=>y>0);m>=0&&(p[m]*=-1)}}},restore(f){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)for(let m=0;m<p.length;m++)p[d]=Math.abs(p[d])}},getcase(){i.ec=At(i.ec)?i.ec:1;const f=c.hm();if(f&&ae(i.mg)){const[,d,h,p]=i.mg;c.set("sender",h),x(d)&&c.set("arg",d),p&&(c.set("player",p),b.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=At(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=gF.parse(f),[h]=d.filter(p=>p.fileName===Qu);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(ye(d)),h)},if(...f){const[d,h]=rt(f,0,[z.ANY]),p=gx(d);return p&&h<f.length&&c.command(...f.slice(h)),p?1:0},try(...f){const[,d]=rt(f,0,[z.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,p]=rt(f,0,[z.NAME,z.ANY]),m=At(h),y=m?p:1,w=c.get(d),k=m?h:1;if(!At(w))return y<f.length&&c.command(...f.slice(y)),1;const T=w-k;return T<0?(y<f.length&&c.command(...f.slice(y)),1):(c.set(d,T),0)},give(...f){const[d,h,p]=rt(f,0,[z.NAME,z.ANY]),m=At(h),y=m?p:1,w=c.get(d),k=m?h:1,T=w===void 0?1:0;return T&&y<f.length&&c.command(...f.slice(y)),c.set(d,Ic(w,0)+k),T},repeatstart(f,...d){const[h,p]=rt(d,0,[z.NUMBER]),m=`repeatcount${f}`,y=`repeatwords${f}`;i[m]=h,i[y]=p<d.length?d.slice(p):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!At(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,y=i[h];return m&&ae(y)&&c.command(...y),m?1:0},foreachstart(f,...d){const[h,p,m,y]=rt(d,0,[z.NAME,z.NUMBER,z.NUMBER,z.MAYBE_NUMBER]);let w=Math.min(p,m),k=Math.max(p,m);const T=(y??0)||1;if(T<0){const A=w;w=k,k=A}return c.set(h,w-T),0},foreach(f,...d){const[h,p,m,y,w]=rt(d,0,[z.NAME,z.NUMBER,z.NUMBER,z.MAYBE_NUMBER]);let k=Math.min(p,m),T=Math.max(p,m);const A=(y??0)||1;if(A<0){const S=k;k=T,T=S}let C=c.get(h);!At(C)||C<k||C>T?C=k:C+=A;const R=C<=T?1:0;return R&&(c.set(h,C),w<d.length&&c.command(...d.slice(w))),R},waitfor(...f){const[d]=rt(f,0,[z.ANY]),h=gx(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[z.ANY]);if(d=p,d)break;h=m}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[z.ANY]);if(d=p,!d)break;h=m}return d},not(...f){const[d]=rt(f,0,[z.ANY]);return d?0:1},expr(...f){const[d]=rt(f,0,[z.ANY]);return d},isEq(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return typeof h=="object"||typeof p=="object"?xv(h,p)?1:0:h===p?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h<p?1:0},isGreaterThan(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h>p?1:0},isLessThanOrEq(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h<=p?1:0},isGreaterThanOrEq(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h>=p?1:0},opPlus(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return h+p},opMinus(f,d){const[h]=rt([f],0,[z.ANY]),[p]=rt([d],0,[z.ANY]);return h-p},opPower(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return Math.pow(h,p)},opMultiply(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h*p},opDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h/p},opModDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return h%p},opFloorDivide(f,d){const[h]=rt([f],0,[z.NUMBER]),[p]=rt([d],0,[z.NUMBER]);return Math.floor(h/p)},opUniPlus(f){const[d]=rt([f],0,[z.NUMBER]);return+d},opUniMinus(f){const[d]=rt([f],0,[z.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function dp(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];ae(r)?r.forEach(i=>{e.push(dp(i))}):e.push(dp(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function u4(t){const e=sE(`${t}
`);if(e.errors.length>0)return e;sa.input=e.tokens;const n=sa.program();if(sa.errors.length>0)return{tokens:e.tokens,errors:sa.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=e4.go(n);return r?(dp(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const pp=Object.getPrototypeOf(function*(){}).constructor;function h4(t,e){const n=`compile-${t}`;console.time(n);const r=u4(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=a4(r.ast);if(i.code){KU&&console.info(i.code);try{return{...r,...i,source:i.code,code:new pp("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new pp("api"," ")}}}return{...r,...i,source:"",code:new pp("api"," ")}}function f4(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=h4(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return x(s)?s.isended():!0},halt(i){const s=e[i];return x(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!x(e[i])){const f=n(a,c);if(l=e[i]=l4(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((w,k)=>[w,k]);p.slice(h-5,h).forEach(([w,k])=>{ue(tt,cr(),"build",`$grey${k+1} $grey${w}`)});const[m,y]=p[h]??[];if(bt(m)&&x(y)){const w=(d.column??1)-1,k=w+d.length,T=w<m.length?m:`${m}*`,A=T.substring(0,w),C=T.substring(w,k),R=T.substring(k);ue(tt,cr(),"build",`$red${y+1} $grey${A}$red${C}$grey${R}`)}return d.message.split(`
`).forEach(w=>{ue(tt,cr(),"build",w)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Xn(i.target),a=e[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}const xn=new qa,Nn={},nh={};function yx(t,e,n,r,i=0){const s=`tiles:${t}:${e}`;return x(Nn[s])||(Nn[s]=cN(t,e,n,r,i)),Nn[s]}function d4(t,e,n,r){const i=`sprites:${t}:${e}:${n}`,s=`sprite:${t}:${e}:${r}`;return x(nh[s])||(nh[s]=lN(t,e,n)),nh[s].id=i,nh[s]}function p4(t,e){const n=`sprites:${t}:${e}`;return x(Nn[n])||(Nn[n]=uN(t,e)),Nn[n]}function m4(t,e,n,r,i=0){const s=`dither:${t}:${e}`;return x(Nn[s])||(Nn[s]=hN(t,e,n,r,i)),Nn[s]}function rh(t,e,n,r){const i=`media:${t}:${e}`;x(Nn[i])||(Nn[i]=fN(t,e,n,r));const s=Nn[i];return s.mime=n,s.media=r,s}function g4(t,e){const n=`control:${t}:${e}`;return x(Nn[n])||(Nn[n]=dN(t,e)),Nn[n]}const ih=Ko*.75,sh=Wo*.75;function bx(t,e){const n=[],r=(e.x-t.x)*Ko,i=(e.y-t.y)*Wo;xn.x=r-ih,xn.y=i-sh,n.push(xn.angle()),xn.x=r+ih,xn.y=i-sh,n.push(xn.angle()),xn.x=r-ih,xn.y=i+sh,n.push(xn.angle()),xn.x=r+ih,xn.y=i+sh,n.push(xn.angle());const s=Math.round(od(Math.min(...n))),o=Math.round(od(Math.max(...n)));return Math.abs(s-o)>180?[o,s]:[s,o]}function oh(t,e,n,r,i,s,o,a,c,l){var A;xn.x=c-s.x,xn.y=l-s.y;const u=xn.length();if(u>o)return;const f={x:c,y:l},d=Ur(e,f);if(d===-1)return;const h=Math.round(od(xn.angle()));let p=0;for(let C=0;C<r.length;++C){const R=r[C];h>=R[0]&&h<=R[1]&&(p=Math.max(p,R[2]))}const m=o*.5;n[d]=Math.min(n[d],p+(u<m?0:(u-m)*a)),n[d]=Xe(n[d],0,1);const y=Rn(e,((A=e.lookup)==null?void 0:A[d])??"");if(x(y)){const C=[...bx(s,f),.25];i.push(C)}const w=e.terrain[d],k=Di(t,w),T=(w==null?void 0:w.collision)??(k==null?void 0:k.collision);if(zo($t.ISBULLET,T)){const C=[...bx(s,f),1];i.push(C)}}function mp(t,e,n,r,i,s,o){if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const a=[];let c=e;const l=St,u=Yt,f=o?Rt.BLACK:Rt.ONCLEAR,d=yx(t,c++,l,u,f);a.push(d);const h=c++,p=p4(t,h);p.sprites=[],a.push(p);const m=r.isdark?1:0,y=m4(t,c++,l,u,m);a.push(y),y.alphas.fill(m);const w=yx(t,c++,l,u,Rt.ONCLEAR);a.push(w),w.char.fill(0);const k={...J0(St,Yt,i,Rt.ONCLEAR),...w},T=g4(t,c++);if(s){if(a.push(T),bt(r.camera))switch(It(r.camera)){default:case"mid":T.viewscale=Gl.MID;break;case"near":T.viewscale=Gl.NEAR;break;case"far":T.viewscale=Gl.FAR;break}if(bt(r.graphics)){const I=It(r.graphics);switch(I){case"mode7":case"firstperson":T.graphics=I;break;default:case"flat":T.graphics="flat";break}}const{facing:U}=Sr(t);At(U)&&(T.facing=fy(U%360))}for(let U=0;U<r.terrain.length;++U){const I=r.terrain[U],D=Du(n,I,0,Rt.WHITE,o?Rt.BLACK:Rt.ONCLEAR);d.char[U]=D.char,d.color[U]=D.color,d.bg[U]=D.bg}const A=Object.values(r.objects??{});for(let U=0;U<A.length;++U){const I=A[U];if(x(I.removed))continue;const D=I.id??"",G=Du(n,I,1,Rt.WHITE,Rt.BLACK),L=d4(t,h,D,U);if(L.x=I.x??0,L.y=I.y??0,L.char=G.char,L.color=G.color,L.bg=G.bg,p.sprites.push(L),m){if(G.light>0){const N=[],E=Ur(r,L),P=Xe(Math.round(G.light),1,Yt),q=1/(P*.5);if(y.alphas[E]=0,P>1)for(let $=1;$<=P;++$){const st=[];for(let ut=L.y-$;ut<=L.y+$;++ut)oh(n,r,y.alphas,N,st,L,P,q,L.x-$,ut),oh(n,r,y.alphas,N,st,L,P,q,L.x+$,ut);const nt=$-1;for(let ut=L.x-nt;ut<=L.x+nt;++ut)oh(n,r,y.alphas,N,st,L,P,q,ut,L.y-$),oh(n,r,y.alphas,N,st,L,P,q,ut,L.y+$);N.push(...st)}}else if(Kr(D)){const N=Ur(r,L);y.alphas[N]=0}}if(bt(I.tickertext)&&At(I.tickertime)&&I.tickertext.length){const N=St,E=IE(I.tickertext,N,Yt-1),P=(E==null?void 0:E.measuredwidth)??1,q=I.x??0,$=I.y??0,st=$<Yt*.5;k.x=q-Math.floor(P*.5),k.y=$+(st?1:-1),k.x+P>St&&(k.x=St-P),k.x<0&&(k.x=0),OE(I.tickertext,k,!0)}D===t&&(T.focusx=L.x,T.focusy=L.y,T.focusid=D)}a.push(rh(t,c++,"text/mood",m?"dark":"bright"));const C=be(Pt.MAIN),R=$i(C,Pt.MAIN);if(bt(R.palette)){const U=tn(C,_t.PALETTE,R.palette),I=Ce(U);x(I==null?void 0:I.bits)&&a.push(rh(t,c++,"image/palette",Array.from(I.bits)))}if(bt(R.charset)){const U=tn(C,_t.CHARSET,R.charset),I=Ce(U);x(I==null?void 0:I.bits)&&a.push(rh(t,c++,"image/charset",Array.from(I.bits)))}const S=Object.keys(r.objects).filter(Kr);return a.push(rh(t,c++,"text/players",S.join(","))),a}const ar=f4();var Pt=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Pt||{});const xe={halt:!1,session:Pe(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function _4(){return xe.session}function cr(){return xe.operator}function y4(t){xe.operator=t}function b4(t){xe.halt=t}function w4(){return xe.halt}function ca(){return[...xe.books.values()]}function E4(){const[t]=xe.books.values();return t}function zr(t){const e=It(t);return xe.books.get(t)??ca().find(n=>n.name===e)}function ah(t,e){x(zr(e))&&(xe.software[t]=e)}function be(t){return zr(xe.software[t])}function wx(t){const e=uE([]);return bt(t)&&(e.name=t),gp(e),he(tt,xe.operator,`created [book] ${e.name}`),e}function x4(t){let e=zr(t);return x(e)||(e=uE([]),e.name=t),gp(e),he(tt,xe.operator,`created [book] ${e.name}`),e}function vn(t,e){let n=x(e)?x4(e):be(t);return x(n)||(x(n)||(n=E4()),x(n)||(n=wx(e)),x(n)&&he(tt,xe.operator,`opened [book] ${n.name} for ${t}`)),ah(t,n.id),n}function ys(t,e,n){return B0(vn(t),n,e)}function Sr(t){const e=vn("main");return $i(e,t)}function Ex(t){const e=vn("main");return nF(e,t)}function xx(){const t=vn("main");return $i(t,"main")}function v4(t){const e=vn("main");return mE(e,t)}function k4(t,e){xe.books.clear(),t.forEach(r=>{xe.books.set(r.id,r),r.name==="main"&&(xe.software.main=r.id)});const n=zr(e);if(x(n)&&ah("main",n.id),!xe.software.main){const r=xe.books.values().next();r.value&&(xe.software.main=r.value.id)}}function gp(t){return xe.books.set(t.id,t),t.id}function T4(t){const e=zr(t);e&&xe.books.delete(e.id)}function vx(t){if(!bt(t)||!t)return ue(tt,t,"login",`failed for playerid ==>${t}<==`);const e=be("main");if(!x(e))return ue(tt,t,"login:main","login failed to find book 'main'");const n=qs(e,t);if(x(n))return!0;const r=zn(e,_t.BOARD,"title");if(r.length===0)return ue(tt,t,"login:title","login failed to find board with 'title' stat");const i=Xs(e,"player");if(!x(i))return ue(tt,t,"login:player","login failed to find object type 'player'");const s=my(t,r),o=Ce(s);if(x(o)){const a=M0(s,"startx"),c=M0(s,"starty"),l=At(a)?a:Math.round(St*.5),u=At(c)?c:Math.round(Yt*.5),f=i.name??"player",d=kd(o,{x:l,y:u},f,t);if(x(d==null?void 0:d.id))return d.player=t,$u(e,t,o.id),!0}return!1}function A4(t){const e=be("main"),n=qs(e,t);if(!x(e))return;const r=[t];for(let i=0;i<e.activelist.length;++i){const s=e.activelist[i];s.startsWith(t)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];$u(e,s,""),$0(e,n,Rn(n,s)),Jy(n,s),ar.halt(s),mE(e,s)}}function lr(t){const e=be("main");return qs(e,t)}function R4(t){const e=be("main"),n=iF(e,t),r=qs(e,t),i=Rn(r,t);return n&&x(i)}function S4(t){const e=be("main"),n=D0(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Kr(c)&&x(t[c])===!1&&(t[c]=0,$u(e,c,i.id))}}}function kx(t){ar.message(t)}function la(t,e,n,r){const i=is(e);bt(n.id)&&tt.emit(t,"vm:touched",[n.id,i,r])}function O4(t,e,n,r){const i=n.id??"";if(r.x<0){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitwest)??"");if(s.length){const o=Te(s);Qo(t,i,o.id,{x:St-1,y:r.y})}}else if(r.x>=St){const s=zn(t,_t.BOARD,(e==null?void 0:e.exiteast)??"");if(s.length){const o=Te(s);Qo(t,i,o.id,{x:0,y:r.y})}}else if(r.y<0){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitnorth)??"");if(s.length){const o=Te(s);Qo(t,i,o.id,{x:r.x,y:Yt-1})}}else if(r.y>=Yt){const s=zn(t,_t.BOARD,(e==null?void 0:e.exitsouth)??"");if(s.length){const o=Te(s);Qo(t,i,o.id,{x:r.x,y:0})}}}function ua(t,e,n,r){if(!x(n==null?void 0:n.id))return!1;const i=K0(t,e,n,r);if(x(i)){const s=Kr(i.id);return n.kind==="player"&&i.kind==="edge"?O4(t,e,n,r):la("",i,n,"thud"),n.kind==="player"?la(n.id,n,i,s?"bump":"touch"):n.collision===$t.ISBULLET?He(t,i,"collision")===$t.ISBULLET?la("",n,i,"thud"):Kr(n.party)?la(n.id,n,i,s?"partyshot":"shot"):la("",n,i,s?"shot":"partyshot"):la("",n,i,"bump"),He(t,i,"destructible")?(x(i==null?void 0:i.id)?or(b.book,b.board,i,b.timestamp):ln(e,{x:r.x,y:r.y}),!0):!1}return!0}function Tx(t,e,n,r,i=lR){var f;if(!x(t)||!x(e)||!x(n))return;const s={...b};b.book=t,b.board=e,b.element=n,b.elementid=n.id??"",b.elementisplayer=Kr(b.elementid);const o=b.element.player??xe.operator;b.elementfocus=b.elementisplayer?b.elementid:o;const a=Di(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=It(n.name??((f=n.kinddata)==null?void 0:f.name)??"");if(ar.tick(l,_s.RUNTIME,At(c)?c:i,u,r),At(n==null?void 0:n.tickertime)&&b.timestamp-n.tickertime>il*5&&(n.tickertime=0,n.tickertext=""),b.elementisplayer){const d=Sr(b.elementid);At(d.inputcurrent)&&(d.inputcurrent=0)}hr(s).forEach(d=>{b[d]=s[d]})}function I4(t,e){xe.loaders.set(t,e)}function N4(t){ar.halt(t)}function C4(){const t=ar.ids();for(let n=0;n<t.length;++n)ar.halt(t[n]);const e=be("main");x(e)&&(e.flags={})}function L4(){const t=be("main");if(!x(t))return;const e=t.timestamp+1,n=Fi.HALT_AT_COUNT;Fi.HALT_AT_COUNT=n*2,xe.loaders.forEach((i,s)=>{const o={...b};b.timestamp=t.timestamp,b.book=t,b.board=void 0,b.element=void 0,b.elementid=s,b.elementisplayer=!1,b.elementfocus=cr();const a=B$(s);x(a)&&ar.arg(s,a),ar.tick(s,_s.LOADER,1,"loader",i),ar.isended(s)&&(ar.halt(s),xe.loaders.delete(s)),hr(o).forEach(c=>{b[c]=o[c]})}),Fi.HALT_AT_COUNT=n,t.timestamp=e,b.timestamp=e;const r=D0(t);for(let i=0;i<r.length;++i){const s=r[i],o=fF(t,s,e);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:f}=o[a];l===_t.ERROR?ar.halt(c):Tx(t,s,f,u)}}}function _p(t,e){const n=be("main");if(!x(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(x(u.id)){const f=`${_x(u.id)}:${c}`;tt.emit("",f,e)}}}const{target:i,path:s}=Xn(t),o=D0(n);for(let a=0;a<o.length;++a){const c=o[a];switch(It(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(tb(c,[i]),s);break}}}}function M4(t){const e=Sr(t).playbuffer;bt(e)&&e&&Ax(t,e)}function Ax(t,e=""){var s;const n=vn("main");if(!x(n))return;const r=`${t}_cli`;b.timestamp=n.timestamp,b.book=n,b.board=qs(n,t),b.element=Rn(b.board,t),b.elementid=((s=b.element)==null?void 0:s.id)??"",b.elementisplayer=!0,b.elementfocus=b.elementid||t;const i=Fi.HALT_AT_COUNT;Fi.HALT_AT_COUNT=i*8,ar.once(r,_s.CLI,"cli",e),Sr(t).playbuffer=e,Fi.HALT_AT_COUNT=i}function ch(t){var a;const e=vn("main"),n=Pi(e,t);if(!x(e)||!x(n)||!x(b.element))return;const r={...b},i=`${t}_run`,s=It(b.element.name??((a=b.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";ar.once(i,_s.RUNTIME,s,o),hr(r).forEach(c=>{b[c]=r[c]})}function U4(t,e){const n=be("main"),r=qs(n,t),i=[],s=[],o=[];if(!x(n)||!x(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=fs(n,r.overboard??""),l=fs(n,r.underboard??"");return s.push(...mp(t,0,n,l,e,!1,!0)),o.push(...mp(t,s.length,n,r,e,!0,a!=="flat")),i.push(...mp(t,s.length+o.length,n,c,e,!1,!1)),{over:i,under:s,layers:o}}function ha(t,e=0){const n=[];let r=t;for(;r<b.words.length;){const[i,s]=Gn(r);if(ae(i)&&!Si(i)&&!Lc(i)&&!Ku(i)&&!ri(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function Gn(t){var r,i,s,o,a,c,l,u,f;const e=b.words[t],n=t+1;if(FE(e)){const[d,h]=O$(t);if(x(d))return[d,h]}if(I$(e)){const[d,h]=N$(t);if(x(d))return[d,h]}if(ld(e)){const[d,h]=ud(t);if(x(d))return[d,h]}if(bt(e)&&It(e)==="rnd"){const[d,h]=Gn(n),[p,m]=Gn(h);return At(d)&&At(p)?[yr(d,p),m]:At(d)?[yr(0,d),h]:[yr(0,1),n]}if(cd(e)){const[d,h]=yy(t);if(x(d))return[d,h]}if(!x(e))return[void 0,t];if(At(e)||ae(e))return[e,n];if(bt(e)){const d=It(e),h=(r=b.get)==null?void 0:r.call(b,e);if(x(h))return[h,n];switch(d){case"aligned":case"alligned":{const p=sc(b.board,{x:((i=b.element)==null?void 0:i.x)??-1,y:((s=b.element)==null?void 0:s.y)??-1},b.elementfocus);return!x(b.element)||!x(p)?[0,n]:[b.element.x===p.x||b.element.y===p.y?1:0,n]}case"contact":{const p=sc(b.board,{x:((o=b.element)==null?void 0:o.x)??-1,y:((a=b.element)==null?void 0:a.y)??-1},b.elementfocus);if(!x(b.element)||!x(p))return[0,n];const m=(p.x??0)-(((c=b.element)==null?void 0:c.x)??0),y=(p.y??0)-(((l=b.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(y)<2||y===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=rt(b.words,n,[z.DIR]);return[uF(b.book,b.board,b.element,p.destpt)?1:0,m]}case"any":{const[p,m]=rt(b.words,n,[z.KIND]);return[Qy(b.board,p).length?1:0,m]}case"rnd":return[yr(0,1),n];case"abs":{const[p,m]=rt(b.words,n,[z.NUMBER]);return[Math.abs(p),m]}case"intceil":{const[p,m]=rt(b.words,n,[z.NUMBER]);return[Math.ceil(p),m]}case"intfloor":{const[p,m]=rt(b.words,n,[z.NUMBER]);return[Math.floor(p),m]}case"intround":{const[p,m]=rt(b.words,n,[z.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,y,w]=rt(b.words,n,[z.NUMBER,z.NUMBER,z.NUMBER]);return[Xe(p,m,y),w]}case"min":{const[p,m]=ha(n);return[Math.min(...p),m]}case"max":{const[p,m]=ha(n);return[Math.max(...p),m]}case"pick":{const[p,m]=ha(n);return[Te(p),m]}case"pickwith":{const[p,m]=rt(b.words,n,[z.NUMBER_OR_STRING]),[y,w]=ha(m);return[my(`${p}`,y),w]}case"random":{const[p,m]=ha(n,2),[y,w]=p;return[yr(y,w??0),m]}case"randomwith":{const[p,m]=rt(b.words,n,[z.NUMBER_OR_STRING]),[y,w]=ha(m,2),[k,T]=y;return[dy(`${p}`,k,T??0),w]}case"run":{const[p,m]=rt(b.words,n,[z.NAME]);return ch(p),[(u=b.get)==null?void 0:u.call(b,"arg"),m]}case"runwith":{const[p,m,y]=rt(b.words,n,[z.ANY,z.NAME]);return x(b.element)&&(b.element.arg=p),ch(m),[(f=b.get)==null?void 0:f.call(b,"arg"),y]}}}return[e,n]}const b={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var z=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.MAYBE_KIND=7]="MAYBE_KIND",t[t.MAYBE_NAME=8]="MAYBE_NAME",t[t.MAYBE_NUMBER=9]="MAYBE_NUMBER",t[t.MAYBE_STRING=10]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",t[t.ANY=12]="ANY",t))(z||{});function kn(t,e,n){throw console.info(n,b.element,b.elementid,b.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function Rx(t){var n,r;const e={x:((n=b.element)==null?void 0:n.x)??0,y:((r=b.element)==null?void 0:r.y)??0};return j0(b.book,b.board,b.element,b.elementfocus,t,e)}function rt(t,e,n){const r=b.words;b.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=vy(s);Po(a)?(s=c,i.push(a)):kn("kind",a,t);break}case 0:{if(ld(t[0])===void 0){const[a,c]=Gn(s);ri(a)?(s=c,i.push(a)):kn("color",a,t)}else{const[a,c]=ud(s);ri(a)?(s=c,i.push(a)):kn("color",a,t)}break}case 2:{if(cd(t[0])===void 0){const[a,c]=Gn(s);Si(a)?(s=c,i.push(Rx(a))):kn("direction",a,t)}else{const[a,c]=yy(s);Si(a)?(s=c,i.push(Rx(a))):kn("direction",a,t)}break}case 3:{const a=b.words[s];bt(a)||kn("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Gn(s);if(bt(a)){const l=parseFloat(a);At(l)?i.push(l):kn("number",a,t)}else At(a)?i.push(a):kn("number",a,t);s=c;break}case 5:{const[a,c]=Gn(s);bt(a)||kn("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Gn(s);let l=a;if(bt(l)){const u=parseFloat(l);At(u)&&(l=u)}else At(l)||kn("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=vy(s);a!==void 0&&!Po(a)&&kn("optional kind",a,t),s=c,i.push(a);break}case 8:{const a=b.words[s];a!==void 0&&!bt(a)&&kn("optional string",a,t),++s,i.push(a);break}case 9:{const[a,c]=Gn(s);if(bt(a)){const l=parseFloat(a);At(l)?i.push(l):kn("optional number",a,t)}else At(a)||a===void 0?i.push(a):kn("optional number",a,t);s=c;break}case 10:{const[a,c]=Gn(s);a!==void 0&&!bt(a)&&kn("optional string",a,t),s=c,i.push(a);break}case 11:{const[a,c]=Gn(s);let l=a;if(bt(l)){const u=parseFloat(l);At(u)&&(l=u)}else l!==void 0&&!At(l)&&kn("number or string",l,t);s=c,i.push(l);break}case 12:{const[a,c]=Gn(s);s=c,i.push(a);break}}return b.words=r,[...i,s]}const lh={},fa={};function yp(){return{id:Pe(),layers:[],scroll:[],sidebar:[]}}const F4=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),B4=new Set(["tx","text"]),P4={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Sx={};let Ox=t=>{let e=Sx[t];return x(e)||(Sx[t]=e=yp()),e};function D4(t){Ox=t}function hn(t){return Ox(t)}function bp(t){return x(lh[t])||(lh[t]=[]),lh[t]}function $4(t){const e=hn(t);e.scroll=[]}function j4(t,e,n){Object.values(fa).forEach(r=>{if(r[e]!==void 0){const i=rb(t.id(),e);At(n)&&oI(i,n),bt(n)&&aI(i,n)}})}function ur(t){const e=bp(t);return lh[t]=[],e}function ee(t,e){bp(t).push(e)}function Ut(t,e,n,r,i=()=>0,s=kh){const o=[e,n,...r],a=It(`${o[3]}`),c={...b};function l(u,f){x(f)&&f!==i(u)&&(b.board=c.board,b.element=c.element,b.elementfocus=c.elementfocus,s(u,f))}if(F4.has(a)){const u=`${o[2]}`;fa[e]=fa[e]??{};const f=i(u)??P4[a];if(fa[e][u]===void 0){const d=rb(e,u);At(f)&&sI(d,f),bt(f)&&td(d,f),B4.has(a)?fa[e][u]=ny(d,h=>{l(u,h)}):fa[e][u]=cI(d,h=>{l(u,h)})}}bp(t).push(o)}D4(t=>{if(Kr(t)){const e=be(Pt.MAIN),n=$i(e,Pt.GADGETSTORE);let r=n[t];return x(r)||(n[t]=r=yp()),r}return yp()});let Ix=0;function z4(){switch(Ix++){case 0:return Rt.BLUE;case 1:return Rt.BLACK;case 2:return Rt.GREEN;case 3:return Rt.BLACK;case 4:return Rt.CYAN;case 5:return Rt.BLACK;case 6:return Rt.RED;case 7:return Rt.BLACK;case 8:return Rt.PURPLE;case 9:return Rt.BLACK;case 10:return Rt.YELLOW;case 11:return Rt.BLACK;case 12:return Rt.WHITE;default:return Ix=0,Rt.BLACK}}const uh=io("gadgetserver",["tock","second"],t=>{if(!uh.session(t))return;const e=be(Pt.MAIN),n=(e==null?void 0:e.activelist)??[],r=$i(e,Pt.GADGETSYNC);switch(t.target){case"tock":{const i=z4();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=U4(o,i),u=hn(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=Up(f,u);d.length&&(r[o]=Zn(u),LA(uh,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=lr(s);x(o)&&HA(uh,s,o.id)}break;case"desync":CA(uh,t.player,hn(t.player));break;case"clearscroll":$4(t.player);break;case"clearplayer":{const i=be(Pt.MAIN),s=$i(i,Pt.GADGETSTORE);delete s[t.player];const o=$i(i,Pt.GADGETSYNC);delete o[t.player];break}}});function hh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Nx={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof hh=="function"&&hh;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof hh=="function"&&hh,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,p,m,y=[],w=0,k=c.length,T=k,A=s.getTypeOf(c)!=="string";w<c.length;)T=k-w,f=A?(l=c[w++],u=w<k?c[w++]:0,w<k?c[w++]:0):(l=c.charCodeAt(w++),u=w<k?c.charCodeAt(w++):0,w<k?c.charCodeAt(w++):0),d=l>>2,h=(3&l)<<4|u>>4,p=1<T?(15&u)<<2|f>>6:64,m=2<T?63&f:64,y.push(a.charAt(d)+a.charAt(h)+a.charAt(p)+a.charAt(m));return y.join("")},i.decode=function(c){var l,u,f,d,h,p,m=0,y=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var k,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=o.uint8array?new Uint8Array(0|T):new Array(0|T);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(m++)))>>2,f=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),k[y++]=l,h!==64&&(k[y++]=u),p!==64&&(k[y++]=f);return k}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,p){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,y="";for(m=0;m<p;m++)y+=String.fromCharCode(255&h),h>>>=8;return y}function o(h,p,m,y,w,k){var T,A,C=h.file,R=h.compression,S=k!==l.utf8encode,U=a.transformTo("string",k(C.name)),I=a.transformTo("string",l.utf8encode(C.name)),D=C.comment,G=a.transformTo("string",k(D)),L=a.transformTo("string",l.utf8encode(D)),N=I.length!==C.name.length,E=L.length!==D.length,P="",q="",$="",st=C.dir,nt=C.date,ut={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ut.crc32=h.crc32,ut.compressedSize=h.compressedSize,ut.uncompressedSize=h.uncompressedSize);var V=0;p&&(V|=8),S||!N&&!E||(V|=2048);var Y=0,xt=0;st&&(Y|=16),w==="UNIX"?(xt=798,Y|=function(ht,Dt){var re=ht;return ht||(re=Dt?16893:33204),(65535&re)<<16}(C.unixPermissions,st)):(xt=20,Y|=function(ht){return 63&(ht||0)}(C.dosPermissions)),T=nt.getUTCHours(),T<<=6,T|=nt.getUTCMinutes(),T<<=5,T|=nt.getUTCSeconds()/2,A=nt.getUTCFullYear()-1980,A<<=4,A|=nt.getUTCMonth()+1,A<<=5,A|=nt.getUTCDate(),N&&(q=s(1,1)+s(u(U),4)+I,P+="up"+s(q.length,2)+q),E&&($=s(1,1)+s(u(G),4)+L,P+="uc"+s($.length,2)+$);var ct="";return ct+=`
\0`,ct+=s(V,2),ct+=R.magic,ct+=s(T,2),ct+=s(A,2),ct+=s(ut.crc32,4),ct+=s(ut.compressedSize,4),ct+=s(ut.uncompressedSize,4),ct+=s(U.length,2),ct+=s(P.length,2),{fileRecord:f.LOCAL_FILE_HEADER+ct+U+P,dirRecord:f.CENTRAL_FILE_HEADER+s(xt,2)+ct+s(G.length,2)+"\0\0\0\0"+s(Y,4)+s(y,4)+U+P+G}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,p,m,y){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=y,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-y-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(y){return f.DATA_DESCRIPTOR+s(y.crc32,4)+s(y.compressedSize,4)+s(y.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,y=function(w,k,T,A,C){var R=a.transformTo("string",C(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(k,4)+s(T,4)+s(R.length,2)+R}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var p=function(k,T){var A=k||T,C=s[A];if(!C)throw new Error(A+" is not a valid compression method !");return C}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},y=h.dir,w=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:y,date:w,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(y){p(y)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var y=new c(h);return y.load(m),y}).then(function(m){var y=[o.Promise.resolve(m)],w=m.files;if(h.checkCRC32)for(var k=0;k<w.length;k++)y.push(f(w[k]));return o.Promise.all(y)}).then(function(m){for(var y=m.shift(),w=y.files,k=0;k<w.length;k++){var T=w[k],A=T.fileNameStr,C=s.resolve(T.fileNameStr);p.file(C,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(p.file(C).unsafeOriginalName=A)}return y.zipComment.length&&(p.comment=y.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof dn<"u",newBufferFrom:function(s,o){if(dn.from&&dn.from!==Uint8Array.from)return dn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new dn(s,o)},allocBuffer:function(s){if(dn.alloc)return dn.alloc(s);var o=new dn(s);return o.fill(0),o},isBuffer:function(s){return dn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,R,S){var U,I=a.getTypeOf(R),D=a.extend(S||{},u);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(C=w(C)),D.createFolders&&(U=y(C))&&k.call(this,U,!0);var G=I==="string"&&D.binary===!1&&D.base64===!1;S&&S.binary!==void 0||(D.binary=!G),(R instanceof f&&R.uncompressedSize===0||D.dir||!R||R.length===0)&&(D.base64=!1,D.binary=!0,R="",D.compression="STORE",I="string");var L=null;L=R instanceof f||R instanceof c?R:p.isNode&&p.isStream(R)?new m(C,R):a.prepareContent(C,R,D.binary,D.optimizedBinaryString,D.base64);var N=new d(C,L,D);this.files[C]=N}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),y=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var R=C.lastIndexOf("/");return 0<R?C.substring(0,R):""},w=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},k=function(C,R){return R=R!==void 0?R:u.createFolders,C=w(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:R}),this.files[C]};function T(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var R,S,U;for(R in this.files)U=this.files[R],(S=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&C(S,U)},filter:function(C){var R=[];return this.forEach(function(S,U){C(S,U)&&R.push(U)}),R},file:function(C,R,S){if(arguments.length!==1)return C=this.root+C,s.call(this,C,R,S),this;if(T(C)){var U=C;return this.filter(function(D,G){return!G.dir&&U.test(D)})}var I=this.files[this.root+C];return I&&!I.dir?I:null},folder:function(C){if(!C)return this;if(T(C))return this.filter(function(I,D){return D.dir&&C.test(I)});var R=this.root+C,S=k.call(this,R),U=this.clone();return U.root=S.name,U},remove:function(C){C=this.root+C;var R=this.files[C];if(R||(C.slice(-1)!=="/"&&(C+="/"),R=this.files[C]),R&&!R.dir)delete this.files[C];else for(var S=this.filter(function(I,D){return D.name.slice(0,C.length)===C}),U=0;U<S.length;U++)delete this.files[S[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var R,S={};try{if((S=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");a.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var U=S.comment||this.comment||"";R=h.generateWorker(this,S,U)}catch(I){(R=new c("error")).error(I)}return new l(R,S.type||"string",S.mimeType)},generateAsync:function(C,R){return this.generateInternalStream(C).accumulate(R)},generateNodeStream:function(C,R){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(R)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(y,w){var k=[],T=p._internalType,A=p._outputType,C=p._mimeType;p.on("data",function(R,S){k.push(R),m&&m(S)}).on("error",function(R){k=[],w(R)}).on("end",function(){try{var R=function(S,U,I){switch(S){case"blob":return s.newBlob(s.transformTo("arraybuffer",U),I);case"base64":return c.encode(U);default:return s.transformTo(S,U)}}(A,function(S,U){var I,D=0,G=null,L=0;for(I=0;I<U.length;I++)L+=U[I].length;switch(S){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(G=new Uint8Array(L),I=0;I<U.length;I++)G.set(U[I],D),D+=U[I].length;return G;case"nodebuffer":return dn.concat(U);default:throw new Error("concat : unsupported type '"+S+"'")}}(T,k),C);y(R)}catch(S){w(S)}k=[]}).resume()})}function h(p,m,y){var w=m;switch(m){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=m,this._mimeType=y,s.checkSupport(w),this._worker=p.pipe(new o(w)),p.lock()}catch(k){this._worker=new a("error"),this._worker.error(k)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var y=this;return p==="data"?this._worker.on(p,function(w){m.call(y,w.data,w.meta)}):this._worker.on(p,function(){s.delay(m,arguments,y)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof dn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,y,w,k,T,A=p.length,C=0;for(k=0;k<A;k++)(64512&(y=p.charCodeAt(k)))==55296&&k+1<A&&(64512&(w=p.charCodeAt(k+1)))==56320&&(y=65536+(y-55296<<10)+(w-56320),k++),C+=y<128?1:y<2048?2:y<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),k=T=0;T<C;k++)(64512&(y=p.charCodeAt(k)))==55296&&k+1<A&&(64512&(w=p.charCodeAt(k+1)))==56320&&(y=65536+(y-55296<<10)+(w-56320),k++),y<128?m[T++]=y:(y<2048?m[T++]=192|y>>>6:(y<65536?m[T++]=224|y>>>12:(m[T++]=240|y>>>18,m[T++]=128|y>>>12&63),m[T++]=128|y>>>6&63),m[T++]=128|63&y);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,y,w,k,T=p.length,A=new Array(2*T);for(m=y=0;m<T;)if((w=p[m++])<128)A[y++]=w;else if(4<(k=l[w]))A[y++]=65533,m+=k-1;else{for(w&=k===2?31:k===3?15:7;1<k&&m<T;)w=w<<6|63&p[m++],k--;1<k?A[y++]=65533:w<65536?A[y++]=w:(w-=65536,A[y++]=55296|w>>10&1023,A[y++]=56320|1023&w)}return A.length!==y&&(A.subarray?A=A.subarray(0,y):A.length=y),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var y=function(k,T){var A;for((T=T||k.length)>k.length&&(T=k.length),A=T-1;0<=A&&(192&k[A])==128;)A--;return A<0||A===0?T:A+l[k[A]]>T?A:T}(p),w=p;y!==p.length&&(o.uint8array?(w=p.subarray(0,y),this.leftOver=p.subarray(y,p.length)):(w=p.slice(0,y),this.leftOver=p.slice(y,p.length))),this.push({data:i.utf8decode(w),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,y){for(var w=0;w<m.length;++w)y[w]=255&m.charCodeAt(w);return y}n("setimmediate"),i.newBlob=function(m,y){i.checkSupport("blob");try{return new Blob([m],{type:y})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(m),w.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,y,w){var k=[],T=0,A=m.length;if(A<=w)return String.fromCharCode.apply(null,m);for(;T<A;)y==="array"||y==="nodebuffer"?k.push(String.fromCharCode.apply(null,m.slice(T,Math.min(T+w,A)))):k.push(String.fromCharCode.apply(null,m.subarray(T,Math.min(T+w,A)))),T+=w;return k.join("")},stringifyByChar:function(m){for(var y="",w=0;w<m.length;w++)y+=String.fromCharCode(m[w]);return y},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var y=65536,w=i.getTypeOf(m),k=!0;if(w==="uint8array"?k=f.applyCanBeUsed.uint8array:w==="nodebuffer"&&(k=f.applyCanBeUsed.nodebuffer),k)for(;1<y;)try{return f.stringifyByChunk(m,w,y)}catch{y=Math.floor(y/2)}return f.stringifyByChar(m)}function h(m,y){for(var w=0;w<m.length;w++)y[w]=m[w];return y}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,y){if(y=y||"",!m)return y;i.checkSupport(m);var w=i.getTypeOf(y);return p[w][m](y)},i.resolve=function(m){for(var y=m.split("/"),w=[],k=0;k<y.length;k++){var T=y[k];T==="."||T===""&&k!==0&&k!==y.length-1||(T===".."?w.pop():w.push(T))}return w.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var y,w,k="";for(w=0;w<(m||"").length;w++)k+="\\x"+((y=m.charCodeAt(w))<16?"0":"")+y.toString(16).toUpperCase();return k},i.delay=function(m,y,w){setImmediate(function(){m.apply(w||null,y||[])})},i.inherits=function(m,y){function w(){}w.prototype=y.prototype,m.prototype=new w},i.extend=function(){var m,y,w={};for(m=0;m<arguments.length;m++)for(y in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],y)&&w[y]===void 0&&(w[y]=arguments[m][y]);return w},i.prepareContent=function(m,y,w,k,T){return c.Promise.resolve(y).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,R){var S=new FileReader;S.onload=function(U){C(U.target.result)},S.onerror=function(U){R(U.target.error)},S.readAsArrayBuffer(A)}):A}).then(function(A){var C=i.getTypeOf(A);return C?(C==="arraybuffer"?A=i.transformTo("uint8array",A):C==="string"&&(T?A=o.decode(A):w&&k!==!0&&(A=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(y){for(var w in u)if(Object.prototype.hasOwnProperty.call(u,w)&&u[w].magic===y)return u[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,y,w=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<w;)p=h.readInt(2),m=h.readInt(2),y=h.readData(m),this.extraFields[p]={id:p,length:m,value:y};h.setIndex(w)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var w=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,y){this.name=p,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=m,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,y="string";try{if(!p)throw new Error("No output type specified.");var w=(y=p.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),m=this._decompressWorker();var k=!this._dataBinary;k&&!w&&(m=m.pipe(new c.Utf8EncodeWorker)),!k&&w&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(T){(m=new u("error")).error(T)}return new o(m,y,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(y,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,y;a=!0;for(var w=h.length;w;){for(y=h,h=[],m=-1;++m<w;)y[m]();w=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Cn<"u"?Cn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,w!==o&&m(this,w)}function d(w,k,T){this.promise=w,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(w,k,T){s(function(){var A;try{A=k(T)}catch(C){return a.reject(w,C)}A===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,A)})}function p(w){var k=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof k=="function")return function(){k.apply(w,arguments)}}function m(w,k){var T=!1;function A(S){T||(T=!0,a.reject(w,S))}function C(S){T||(T=!0,a.resolve(w,S))}var R=y(function(){k(C,A)});R.status==="error"&&A(R.value)}function y(w,k){var T={};try{T.value=w(k),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(w){if(typeof w!="function")return this;var k=this.constructor;return this.then(function(T){return k.resolve(w()).then(function(){return T})},function(T){return k.resolve(w()).then(function(){throw T})})},f.prototype.catch=function(w){return this.then(null,w)},f.prototype.then=function(w,k){if(typeof w!="function"&&this.state===l||typeof k!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?w:k,this.outcome):this.queue.push(new d(T,w,k)),T},d.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},d.prototype.otherCallFulfilled=function(w){h(this.promise,this.onFulfilled,w)},d.prototype.callRejected=function(w){a.reject(this.promise,w)},d.prototype.otherCallRejected=function(w){h(this.promise,this.onRejected,w)},a.resolve=function(w,k){var T=y(p,k);if(T.status==="error")return a.reject(w,T.value);var A=T.value;if(A)m(w,A);else{w.state=l,w.outcome=k;for(var C=-1,R=w.queue.length;++C<R;)w.queue[C].callFulfilled(k)}return w},a.reject=function(w,k){w.state=c,w.outcome=k;for(var T=-1,A=w.queue.length;++T<A;)w.queue[T].callRejected(k);return w},f.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},f.reject=function(w){var k=new this(o);return a.reject(k,w)},f.all=function(w){var k=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=w.length,A=!1;if(!T)return this.resolve([]);for(var C=new Array(T),R=0,S=-1,U=new this(o);++S<T;)I(w[S],S);return U;function I(D,G){k.resolve(D).then(function(L){C[G]=L,++R!==T||A||(A=!0,a.resolve(U,C))},function(L){A||(A=!0,a.reject(U,L))})}},f.race=function(w){var k=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=w.length,A=!1;if(!T)return this.resolve([]);for(var C=-1,R=new this(o);++C<T;)S=w[C],k.resolve(S).then(function(U){A||(A=!0,a.resolve(R,U))},function(U){A||(A=!0,a.reject(R,U))});var S;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(w){if(!(this instanceof m))return new m(w);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},w||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(T!==f)throw new Error(c[T]);if(k.header&&s.deflateSetHeader(this.strm,k.header),k.dictionary){var A;if(A=typeof k.dictionary=="string"?a.string2buf(k.dictionary):u.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function y(w,k){var T=new m(k);if(T.push(w,!0),T.err)throw T.msg||c[T.err];return T.result}m.prototype.push=function(w,k){var T,A,C=this.strm,R=this.options.chunkSize;if(this.ended)return!1;A=k===~~k?k:k===!0?4:0,typeof w=="string"?C.input=a.string2buf(w):u.call(w)==="[object ArrayBuffer]"?C.input=new Uint8Array(w):C.input=w,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(R),C.next_out=0,C.avail_out=R),(T=s.deflate(C,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(C.avail_out=0))},m.prototype.onData=function(w){this.chunks.push(w)},m.prototype.onEnd=function(w){w===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=m,i.deflate=y,i.deflateRaw=function(w,k){return(k=k||{}).raw=!0,y(w,k)},i.gzip=function(w,k){return(k=k||{}).gzip=!0,y(w,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||m&&m.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,y.windowBits);if(w!==c.Z_OK)throw new Error(l[w]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function p(m,y){var w=new h(y);if(w.push(m,!0),w.err)throw w.msg||l[w.err];return w.result}h.prototype.push=function(m,y){var w,k,T,A,C,R,S=this.strm,U=this.options.chunkSize,I=this.options.dictionary,D=!1;if(this.ended)return!1;k=y===~~y?y:y===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?S.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(U),S.next_out=0,S.avail_out=U),(w=s.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&I&&(R=typeof I=="string"?a.string2buf(I):d.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,w=s.inflateSetDictionary(this.strm,R)),w===c.Z_BUF_ERROR&&D===!0&&(w=c.Z_OK,D=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&w!==c.Z_STREAM_END&&(S.avail_in!==0||k!==c.Z_FINISH&&k!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(S.output,S.next_out),A=S.next_out-T,C=a.buf2string(S.output,T),S.next_out=A,S.avail_out=U-A,A&&o.arraySet(S.output,S.output,T,A,0),this.onData(C)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(D=!0)}while((0<S.avail_in||S.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(k=c.Z_FINISH),k===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):k!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,y){return(y=y||{}).raw=!0,p(m,y)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,p;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(p=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],p.set(h,d),d+=h.length;return p}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,p,m,y,w=f.length,k=0;for(m=0;m<w;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),k+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(k),m=y=0;y<k;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[y++]=h:(h<2048?d[y++]=192|h>>>6:(h<65536?d[y++]=224|h>>>12:(d[y++]=240|h>>>18,d[y++]=128|h>>>12&63),d[y++]=128|h>>>6&63),d[y++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,p,m,y,w=d||f.length,k=new Array(2*w);for(h=p=0;h<w;)if((m=f[h++])<128)k[p++]=m;else if(4<(y=c[m]))k[p++]=65533,h+=y-1;else{for(m&=y===2?31:y===3?15:7;1<y&&h<w;)m=m<<6|63&f[h++],y--;1<y?k[p++]=65533:m<65536?k[p++]=m:(m-=65536,k[p++]=55296|m>>10&1023,k[p++]=56320|1023&m)}return u(k,p)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,p=-2,m=-1,y=4,w=2,k=8,T=9,A=286,C=30,R=19,S=2*A+1,U=15,I=3,D=258,G=D+I+1,L=42,N=113,E=1,P=2,q=3,$=4;function st(v,ot){return v.msg=u[ot],ot}function nt(v){return(v<<1)-(4<v?9:0)}function ut(v){for(var ot=v.length;0<=--ot;)v[ot]=0}function V(v){var ot=v.state,et=ot.pending;et>v.avail_out&&(et=v.avail_out),et!==0&&(o.arraySet(v.output,ot.pending_buf,ot.pending_out,et,v.next_out),v.next_out+=et,ot.pending_out+=et,v.total_out+=et,v.avail_out-=et,ot.pending-=et,ot.pending===0&&(ot.pending_out=0))}function Y(v,ot){a._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,ot),v.block_start=v.strstart,V(v.strm)}function xt(v,ot){v.pending_buf[v.pending++]=ot}function ct(v,ot){v.pending_buf[v.pending++]=ot>>>8&255,v.pending_buf[v.pending++]=255&ot}function ht(v,ot){var et,B,F=v.max_chain_length,H=v.strstart,at=v.prev_length,ft=v.nice_match,J=v.strstart>v.w_size-G?v.strstart-(v.w_size-G):0,mt=v.window,wt=v.w_mask,dt=v.prev,Tt=v.strstart+D,le=mt[H+at-1],Bt=mt[H+at];v.prev_length>=v.good_match&&(F>>=2),ft>v.lookahead&&(ft=v.lookahead);do if(mt[(et=ot)+at]===Bt&&mt[et+at-1]===le&&mt[et]===mt[H]&&mt[++et]===mt[H+1]){H+=2,et++;do;while(mt[++H]===mt[++et]&&mt[++H]===mt[++et]&&mt[++H]===mt[++et]&&mt[++H]===mt[++et]&&mt[++H]===mt[++et]&&mt[++H]===mt[++et]&&mt[++H]===mt[++et]&&mt[++H]===mt[++et]&&H<Tt);if(B=D-(Tt-H),H=Tt-D,at<B){if(v.match_start=ot,ft<=(at=B))break;le=mt[H+at-1],Bt=mt[H+at]}}while((ot=dt[ot&wt])>J&&--F!=0);return at<=v.lookahead?at:v.lookahead}function Dt(v){var ot,et,B,F,H,at,ft,J,mt,wt,dt=v.w_size;do{if(F=v.window_size-v.lookahead-v.strstart,v.strstart>=dt+(dt-G)){for(o.arraySet(v.window,v.window,dt,dt,0),v.match_start-=dt,v.strstart-=dt,v.block_start-=dt,ot=et=v.hash_size;B=v.head[--ot],v.head[ot]=dt<=B?B-dt:0,--et;);for(ot=et=dt;B=v.prev[--ot],v.prev[ot]=dt<=B?B-dt:0,--et;);F+=dt}if(v.strm.avail_in===0)break;if(at=v.strm,ft=v.window,J=v.strstart+v.lookahead,mt=F,wt=void 0,wt=at.avail_in,mt<wt&&(wt=mt),et=wt===0?0:(at.avail_in-=wt,o.arraySet(ft,at.input,at.next_in,wt,J),at.state.wrap===1?at.adler=c(at.adler,ft,wt,J):at.state.wrap===2&&(at.adler=l(at.adler,ft,wt,J)),at.next_in+=wt,at.total_in+=wt,wt),v.lookahead+=et,v.lookahead+v.insert>=I)for(H=v.strstart-v.insert,v.ins_h=v.window[H],v.ins_h=(v.ins_h<<v.hash_shift^v.window[H+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[H+I-1])&v.hash_mask,v.prev[H&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=H,H++,v.insert--,!(v.lookahead+v.insert<I)););}while(v.lookahead<G&&v.strm.avail_in!==0)}function re(v,ot){for(var et,B;;){if(v.lookahead<G){if(Dt(v),v.lookahead<G&&ot===f)return E;if(v.lookahead===0)break}if(et=0,v.lookahead>=I&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),et!==0&&v.strstart-et<=v.w_size-G&&(v.match_length=ht(v,et)),v.match_length>=I)if(B=a._tr_tally(v,v.strstart-v.match_start,v.match_length-I),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=I){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else B=a._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(B&&(Y(v,!1),v.strm.avail_out===0))return E}return v.insert=v.strstart<I-1?v.strstart:I-1,ot===d?(Y(v,!0),v.strm.avail_out===0?q:$):v.last_lit&&(Y(v,!1),v.strm.avail_out===0)?E:P}function Ft(v,ot){for(var et,B,F;;){if(v.lookahead<G){if(Dt(v),v.lookahead<G&&ot===f)return E;if(v.lookahead===0)break}if(et=0,v.lookahead>=I&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=I-1,et!==0&&v.prev_length<v.max_lazy_match&&v.strstart-et<=v.w_size-G&&(v.match_length=ht(v,et),v.match_length<=5&&(v.strategy===1||v.match_length===I&&4096<v.strstart-v.match_start)&&(v.match_length=I-1)),v.prev_length>=I&&v.match_length<=v.prev_length){for(F=v.strstart+v.lookahead-I,B=a._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-I),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=F&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=I-1,v.strstart++,B&&(Y(v,!1),v.strm.avail_out===0))return E}else if(v.match_available){if((B=a._tr_tally(v,0,v.window[v.strstart-1]))&&Y(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return E}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(B=a._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<I-1?v.strstart:I-1,ot===d?(Y(v,!0),v.strm.avail_out===0?q:$):v.last_lit&&(Y(v,!1),v.strm.avail_out===0)?E:P}function Mt(v,ot,et,B,F){this.good_length=v,this.max_lazy=ot,this.nice_length=et,this.max_chain=B,this.func=F}function oe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),ut(this.dyn_ltree),ut(this.dyn_dtree),ut(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(U+1),this.heap=new o.Buf16(2*A+1),ut(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),ut(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ht(v){var ot;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=w,(ot=v.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?L:N,v.adler=ot.wrap===2?0:1,ot.last_flush=f,a._tr_init(ot),h):st(v,p)}function Re(v){var ot=Ht(v);return ot===h&&function(et){et.window_size=2*et.w_size,ut(et.head),et.max_lazy_match=s[et.level].max_lazy,et.good_match=s[et.level].good_length,et.nice_match=s[et.level].nice_length,et.max_chain_length=s[et.level].max_chain,et.strstart=0,et.block_start=0,et.lookahead=0,et.insert=0,et.match_length=et.prev_length=I-1,et.match_available=0,et.ins_h=0}(v.state),ot}function Be(v,ot,et,B,F,H){if(!v)return p;var at=1;if(ot===m&&(ot=6),B<0?(at=0,B=-B):15<B&&(at=2,B-=16),F<1||T<F||et!==k||B<8||15<B||ot<0||9<ot||H<0||y<H)return st(v,p);B===8&&(B=9);var ft=new oe;return(v.state=ft).strm=v,ft.wrap=at,ft.gzhead=null,ft.w_bits=B,ft.w_size=1<<ft.w_bits,ft.w_mask=ft.w_size-1,ft.hash_bits=F+7,ft.hash_size=1<<ft.hash_bits,ft.hash_mask=ft.hash_size-1,ft.hash_shift=~~((ft.hash_bits+I-1)/I),ft.window=new o.Buf8(2*ft.w_size),ft.head=new o.Buf16(ft.hash_size),ft.prev=new o.Buf16(ft.w_size),ft.lit_bufsize=1<<F+6,ft.pending_buf_size=4*ft.lit_bufsize,ft.pending_buf=new o.Buf8(ft.pending_buf_size),ft.d_buf=1*ft.lit_bufsize,ft.l_buf=3*ft.lit_bufsize,ft.level=ot,ft.strategy=H,ft.method=et,Re(v)}s=[new Mt(0,0,0,0,function(v,ot){var et=65535;for(et>v.pending_buf_size-5&&(et=v.pending_buf_size-5);;){if(v.lookahead<=1){if(Dt(v),v.lookahead===0&&ot===f)return E;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var B=v.block_start+et;if((v.strstart===0||v.strstart>=B)&&(v.lookahead=v.strstart-B,v.strstart=B,Y(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-G&&(Y(v,!1),v.strm.avail_out===0))return E}return v.insert=0,ot===d?(Y(v,!0),v.strm.avail_out===0?q:$):(v.strstart>v.block_start&&(Y(v,!1),v.strm.avail_out),E)}),new Mt(4,4,8,4,re),new Mt(4,5,16,8,re),new Mt(4,6,32,32,re),new Mt(4,4,16,16,Ft),new Mt(8,16,32,32,Ft),new Mt(8,16,128,128,Ft),new Mt(8,32,128,256,Ft),new Mt(32,128,258,1024,Ft),new Mt(32,258,258,4096,Ft)],i.deflateInit=function(v,ot){return Be(v,ot,k,15,8,0)},i.deflateInit2=Be,i.deflateReset=Re,i.deflateResetKeep=Ht,i.deflateSetHeader=function(v,ot){return v&&v.state?v.state.wrap!==2?p:(v.state.gzhead=ot,h):p},i.deflate=function(v,ot){var et,B,F,H;if(!v||!v.state||5<ot||ot<0)return v?st(v,p):p;if(B=v.state,!v.output||!v.input&&v.avail_in!==0||B.status===666&&ot!==d)return st(v,v.avail_out===0?-5:p);if(B.strm=v,et=B.last_flush,B.last_flush=ot,B.status===L)if(B.wrap===2)v.adler=0,xt(B,31),xt(B,139),xt(B,8),B.gzhead?(xt(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),xt(B,255&B.gzhead.time),xt(B,B.gzhead.time>>8&255),xt(B,B.gzhead.time>>16&255),xt(B,B.gzhead.time>>24&255),xt(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),xt(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(xt(B,255&B.gzhead.extra.length),xt(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(v.adler=l(v.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(xt(B,0),xt(B,0),xt(B,0),xt(B,0),xt(B,0),xt(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),xt(B,3),B.status=N);else{var at=k+(B.w_bits-8<<4)<<8;at|=(2<=B.strategy||B.level<2?0:B.level<6?1:B.level===6?2:3)<<6,B.strstart!==0&&(at|=32),at+=31-at%31,B.status=N,ct(B,at),B.strstart!==0&&(ct(B,v.adler>>>16),ct(B,65535&v.adler)),v.adler=1}if(B.status===69)if(B.gzhead.extra){for(F=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>F&&(v.adler=l(v.adler,B.pending_buf,B.pending-F,F)),V(v),F=B.pending,B.pending!==B.pending_buf_size));)xt(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>F&&(v.adler=l(v.adler,B.pending_buf,B.pending-F,F)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(B.status===73)if(B.gzhead.name){F=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>F&&(v.adler=l(v.adler,B.pending_buf,B.pending-F,F)),V(v),F=B.pending,B.pending===B.pending_buf_size)){H=1;break}H=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,xt(B,H)}while(H!==0);B.gzhead.hcrc&&B.pending>F&&(v.adler=l(v.adler,B.pending_buf,B.pending-F,F)),H===0&&(B.gzindex=0,B.status=91)}else B.status=91;if(B.status===91)if(B.gzhead.comment){F=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>F&&(v.adler=l(v.adler,B.pending_buf,B.pending-F,F)),V(v),F=B.pending,B.pending===B.pending_buf_size)){H=1;break}H=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,xt(B,H)}while(H!==0);B.gzhead.hcrc&&B.pending>F&&(v.adler=l(v.adler,B.pending_buf,B.pending-F,F)),H===0&&(B.status=103)}else B.status=103;if(B.status===103&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&V(v),B.pending+2<=B.pending_buf_size&&(xt(B,255&v.adler),xt(B,v.adler>>8&255),v.adler=0,B.status=N)):B.status=N),B.pending!==0){if(V(v),v.avail_out===0)return B.last_flush=-1,h}else if(v.avail_in===0&&nt(ot)<=nt(et)&&ot!==d)return st(v,-5);if(B.status===666&&v.avail_in!==0)return st(v,-5);if(v.avail_in!==0||B.lookahead!==0||ot!==f&&B.status!==666){var ft=B.strategy===2?function(J,mt){for(var wt;;){if(J.lookahead===0&&(Dt(J),J.lookahead===0)){if(mt===f)return E;break}if(J.match_length=0,wt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,wt&&(Y(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===d?(Y(J,!0),J.strm.avail_out===0?q:$):J.last_lit&&(Y(J,!1),J.strm.avail_out===0)?E:P}(B,ot):B.strategy===3?function(J,mt){for(var wt,dt,Tt,le,Bt=J.window;;){if(J.lookahead<=D){if(Dt(J),J.lookahead<=D&&mt===f)return E;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=I&&0<J.strstart&&(dt=Bt[Tt=J.strstart-1])===Bt[++Tt]&&dt===Bt[++Tt]&&dt===Bt[++Tt]){le=J.strstart+D;do;while(dt===Bt[++Tt]&&dt===Bt[++Tt]&&dt===Bt[++Tt]&&dt===Bt[++Tt]&&dt===Bt[++Tt]&&dt===Bt[++Tt]&&dt===Bt[++Tt]&&dt===Bt[++Tt]&&Tt<le);J.match_length=D-(le-Tt),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=I?(wt=a._tr_tally(J,1,J.match_length-I),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(wt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),wt&&(Y(J,!1),J.strm.avail_out===0))return E}return J.insert=0,mt===d?(Y(J,!0),J.strm.avail_out===0?q:$):J.last_lit&&(Y(J,!1),J.strm.avail_out===0)?E:P}(B,ot):s[B.level].func(B,ot);if(ft!==q&&ft!==$||(B.status=666),ft===E||ft===q)return v.avail_out===0&&(B.last_flush=-1),h;if(ft===P&&(ot===1?a._tr_align(B):ot!==5&&(a._tr_stored_block(B,0,0,!1),ot===3&&(ut(B.head),B.lookahead===0&&(B.strstart=0,B.block_start=0,B.insert=0))),V(v),v.avail_out===0))return B.last_flush=-1,h}return ot!==d?h:B.wrap<=0?1:(B.wrap===2?(xt(B,255&v.adler),xt(B,v.adler>>8&255),xt(B,v.adler>>16&255),xt(B,v.adler>>24&255),xt(B,255&v.total_in),xt(B,v.total_in>>8&255),xt(B,v.total_in>>16&255),xt(B,v.total_in>>24&255)):(ct(B,v.adler>>>16),ct(B,65535&v.adler)),V(v),0<B.wrap&&(B.wrap=-B.wrap),B.pending!==0?h:1)},i.deflateEnd=function(v){var ot;return v&&v.state?(ot=v.state.status)!==L&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==N&&ot!==666?st(v,p):(v.state=null,ot===N?st(v,-3):h):p},i.deflateSetDictionary=function(v,ot){var et,B,F,H,at,ft,J,mt,wt=ot.length;if(!v||!v.state||(H=(et=v.state).wrap)===2||H===1&&et.status!==L||et.lookahead)return p;for(H===1&&(v.adler=c(v.adler,ot,wt,0)),et.wrap=0,wt>=et.w_size&&(H===0&&(ut(et.head),et.strstart=0,et.block_start=0,et.insert=0),mt=new o.Buf8(et.w_size),o.arraySet(mt,ot,wt-et.w_size,et.w_size,0),ot=mt,wt=et.w_size),at=v.avail_in,ft=v.next_in,J=v.input,v.avail_in=wt,v.next_in=0,v.input=ot,Dt(et);et.lookahead>=I;){for(B=et.strstart,F=et.lookahead-(I-1);et.ins_h=(et.ins_h<<et.hash_shift^et.window[B+I-1])&et.hash_mask,et.prev[B&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=B,B++,--F;);et.strstart=B,et.lookahead=I-1,Dt(et)}return et.strstart+=et.lookahead,et.block_start=et.strstart,et.insert=et.lookahead,et.lookahead=0,et.match_length=et.prev_length=I-1,et.match_available=0,v.next_in=ft,v.input=J,v.avail_in=at,et.wrap=H,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,p,m,y,w,k,T,A,C,R,S,U,I,D,G,L,N,E,P;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,P=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,y=a.wnext,w=a.window,k=a.hold,T=a.bits,A=a.lencode,C=a.distcode,R=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;t:do{T<15&&(k+=E[c++]<<T,T+=8,k+=E[c++]<<T,T+=8),U=A[k&R];e:for(;;){if(k>>>=I=U>>>24,T-=I,(I=U>>>16&255)===0)P[u++]=65535&U;else{if(!(16&I)){if(!(64&I)){U=A[(65535&U)+(k&(1<<I)-1)];continue e}if(32&I){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}D=65535&U,(I&=15)&&(T<I&&(k+=E[c++]<<T,T+=8),D+=k&(1<<I)-1,k>>>=I,T-=I),T<15&&(k+=E[c++]<<T,T+=8,k+=E[c++]<<T,T+=8),U=C[k&S];n:for(;;){if(k>>>=I=U>>>24,T-=I,!(16&(I=U>>>16&255))){if(!(64&I)){U=C[(65535&U)+(k&(1<<I)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(G=65535&U,T<(I&=15)&&(k+=E[c++]<<T,(T+=8)<I&&(k+=E[c++]<<T,T+=8)),h<(G+=k&(1<<I)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(k>>>=I,T-=I,(I=u-f)<G){if(m<(I=G-I)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(N=w,(L=0)===y){if(L+=p-I,I<D){for(D-=I;P[u++]=w[L++],--I;);L=u-G,N=P}}else if(y<I){if(L+=p+y-I,(I-=y)<D){for(D-=I;P[u++]=w[L++],--I;);if(L=0,y<D){for(D-=I=y;P[u++]=w[L++],--I;);L=u-G,N=P}}}else if(L+=y-I,I<D){for(D-=I;P[u++]=w[L++],--I;);L=u-G,N=P}for(;2<D;)P[u++]=N[L++],P[u++]=N[L++],P[u++]=N[L++],D-=3;D&&(P[u++]=N[L++],1<D&&(P[u++]=N[L++]))}else{for(L=u-G;P[u++]=P[L++],P[u++]=P[L++],P[u++]=P[L++],2<(D-=3););D&&(P[u++]=P[L++],1<D&&(P[u++]=P[L++]))}break}}break}}while(c<l&&u<d);c-=D=T>>3,k&=(1<<(T-=D<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=k,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,p=1,m=852,y=592;function w(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(L){var N;return L&&L.state?(N=L.state,L.total_in=L.total_out=N.total=0,L.msg="",N.wrap&&(L.adler=1&N.wrap),N.mode=p,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new s.Buf32(m),N.distcode=N.distdyn=new s.Buf32(y),N.sane=1,N.back=-1,d):h}function A(L){var N;return L&&L.state?((N=L.state).wsize=0,N.whave=0,N.wnext=0,T(L)):h}function C(L,N){var E,P;return L&&L.state?(P=L.state,N<0?(E=0,N=-N):(E=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?h:(P.window!==null&&P.wbits!==N&&(P.window=null),P.wrap=E,P.wbits=N,A(L))):h}function R(L,N){var E,P;return L?(P=new k,(L.state=P).window=null,(E=C(L,N))!==d&&(L.state=null),E):h}var S,U,I=!0;function D(L){if(I){var N;for(S=new s.Buf32(512),U=new s.Buf32(32),N=0;N<144;)L.lens[N++]=8;for(;N<256;)L.lens[N++]=9;for(;N<280;)L.lens[N++]=7;for(;N<288;)L.lens[N++]=8;for(l(u,L.lens,0,288,S,0,L.work,{bits:9}),N=0;N<32;)L.lens[N++]=5;l(f,L.lens,0,32,U,0,L.work,{bits:5}),I=!1}L.lencode=S,L.lenbits=9,L.distcode=U,L.distbits=5}function G(L,N,E,P){var q,$=L.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),P>=$.wsize?(s.arraySet($.window,N,E-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(P<(q=$.wsize-$.wnext)&&(q=P),s.arraySet($.window,N,E-P,q,$.wnext),(P-=q)?(s.arraySet($.window,N,E-P,P,0),$.wnext=P,$.whave=$.wsize):($.wnext+=q,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=q))),0}i.inflateReset=A,i.inflateReset2=C,i.inflateResetKeep=T,i.inflateInit=function(L){return R(L,15)},i.inflateInit2=R,i.inflate=function(L,N){var E,P,q,$,st,nt,ut,V,Y,xt,ct,ht,Dt,re,Ft,Mt,oe,Ht,Re,Be,v,ot,et,B,F=0,H=new s.Buf8(4),at=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(E=L.state).mode===12&&(E.mode=13),st=L.next_out,q=L.output,ut=L.avail_out,$=L.next_in,P=L.input,nt=L.avail_in,V=E.hold,Y=E.bits,xt=nt,ct=ut,ot=d;t:for(;;)switch(E.mode){case p:if(E.wrap===0){E.mode=13;break}for(;Y<16;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(2&E.wrap&&V===35615){H[E.check=0]=255&V,H[1]=V>>>8&255,E.check=a(E.check,H,2,0),Y=V=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&V)<<8)+(V>>8))%31){L.msg="incorrect header check",E.mode=30;break}if((15&V)!=8){L.msg="unknown compression method",E.mode=30;break}if(Y-=4,v=8+(15&(V>>>=4)),E.wbits===0)E.wbits=v;else if(v>E.wbits){L.msg="invalid window size",E.mode=30;break}E.dmax=1<<v,L.adler=E.check=1,E.mode=512&V?10:12,Y=V=0;break;case 2:for(;Y<16;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(E.flags=V,(255&E.flags)!=8){L.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){L.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=V>>8&1),512&E.flags&&(H[0]=255&V,H[1]=V>>>8&255,E.check=a(E.check,H,2,0)),Y=V=0,E.mode=3;case 3:for(;Y<32;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}E.head&&(E.head.time=V),512&E.flags&&(H[0]=255&V,H[1]=V>>>8&255,H[2]=V>>>16&255,H[3]=V>>>24&255,E.check=a(E.check,H,4,0)),Y=V=0,E.mode=4;case 4:for(;Y<16;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}E.head&&(E.head.xflags=255&V,E.head.os=V>>8),512&E.flags&&(H[0]=255&V,H[1]=V>>>8&255,E.check=a(E.check,H,2,0)),Y=V=0,E.mode=5;case 5:if(1024&E.flags){for(;Y<16;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}E.length=V,E.head&&(E.head.extra_len=V),512&E.flags&&(H[0]=255&V,H[1]=V>>>8&255,E.check=a(E.check,H,2,0)),Y=V=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(nt<(ht=E.length)&&(ht=nt),ht&&(E.head&&(v=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,P,$,ht,v)),512&E.flags&&(E.check=a(E.check,P,ht,$)),nt-=ht,$+=ht,E.length-=ht),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(nt===0)break t;for(ht=0;v=P[$+ht++],E.head&&v&&E.length<65536&&(E.head.name+=String.fromCharCode(v)),v&&ht<nt;);if(512&E.flags&&(E.check=a(E.check,P,ht,$)),nt-=ht,$+=ht,v)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(nt===0)break t;for(ht=0;v=P[$+ht++],E.head&&v&&E.length<65536&&(E.head.comment+=String.fromCharCode(v)),v&&ht<nt;);if(512&E.flags&&(E.check=a(E.check,P,ht,$)),nt-=ht,$+=ht,v)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;Y<16;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(V!==(65535&E.check)){L.msg="header crc mismatch",E.mode=30;break}Y=V=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),L.adler=E.check=0,E.mode=12;break;case 10:for(;Y<32;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}L.adler=E.check=w(V),Y=V=0,E.mode=11;case 11:if(E.havedict===0)return L.next_out=st,L.avail_out=ut,L.next_in=$,L.avail_in=nt,E.hold=V,E.bits=Y,2;L.adler=E.check=1,E.mode=12;case 12:if(N===5||N===6)break t;case 13:if(E.last){V>>>=7&Y,Y-=7&Y,E.mode=27;break}for(;Y<3;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}switch(E.last=1&V,Y-=1,3&(V>>>=1)){case 0:E.mode=14;break;case 1:if(D(E),E.mode=20,N!==6)break;V>>>=2,Y-=2;break t;case 2:E.mode=17;break;case 3:L.msg="invalid block type",E.mode=30}V>>>=2,Y-=2;break;case 14:for(V>>>=7&Y,Y-=7&Y;Y<32;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if((65535&V)!=(V>>>16^65535)){L.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&V,Y=V=0,E.mode=15,N===6)break t;case 15:E.mode=16;case 16:if(ht=E.length){if(nt<ht&&(ht=nt),ut<ht&&(ht=ut),ht===0)break t;s.arraySet(q,P,$,ht,st),nt-=ht,$+=ht,ut-=ht,st+=ht,E.length-=ht;break}E.mode=12;break;case 17:for(;Y<14;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(E.nlen=257+(31&V),V>>>=5,Y-=5,E.ndist=1+(31&V),V>>>=5,Y-=5,E.ncode=4+(15&V),V>>>=4,Y-=4,286<E.nlen||30<E.ndist){L.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;Y<3;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}E.lens[at[E.have++]]=7&V,V>>>=3,Y-=3}for(;E.have<19;)E.lens[at[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,et={bits:E.lenbits},ot=l(0,E.lens,0,19,E.lencode,0,E.work,et),E.lenbits=et.bits,ot){L.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Mt=(F=E.lencode[V&(1<<E.lenbits)-1])>>>16&255,oe=65535&F,!((Ft=F>>>24)<=Y);){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(oe<16)V>>>=Ft,Y-=Ft,E.lens[E.have++]=oe;else{if(oe===16){for(B=Ft+2;Y<B;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(V>>>=Ft,Y-=Ft,E.have===0){L.msg="invalid bit length repeat",E.mode=30;break}v=E.lens[E.have-1],ht=3+(3&V),V>>>=2,Y-=2}else if(oe===17){for(B=Ft+3;Y<B;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}Y-=Ft,v=0,ht=3+(7&(V>>>=Ft)),V>>>=3,Y-=3}else{for(B=Ft+7;Y<B;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}Y-=Ft,v=0,ht=11+(127&(V>>>=Ft)),V>>>=7,Y-=7}if(E.have+ht>E.nlen+E.ndist){L.msg="invalid bit length repeat",E.mode=30;break}for(;ht--;)E.lens[E.have++]=v}}if(E.mode===30)break;if(E.lens[256]===0){L.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,et={bits:E.lenbits},ot=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,et),E.lenbits=et.bits,ot){L.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,et={bits:E.distbits},ot=l(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,et),E.distbits=et.bits,ot){L.msg="invalid distances set",E.mode=30;break}if(E.mode=20,N===6)break t;case 20:E.mode=21;case 21:if(6<=nt&&258<=ut){L.next_out=st,L.avail_out=ut,L.next_in=$,L.avail_in=nt,E.hold=V,E.bits=Y,c(L,ct),st=L.next_out,q=L.output,ut=L.avail_out,$=L.next_in,P=L.input,nt=L.avail_in,V=E.hold,Y=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Mt=(F=E.lencode[V&(1<<E.lenbits)-1])>>>16&255,oe=65535&F,!((Ft=F>>>24)<=Y);){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(Mt&&!(240&Mt)){for(Ht=Ft,Re=Mt,Be=oe;Mt=(F=E.lencode[Be+((V&(1<<Ht+Re)-1)>>Ht)])>>>16&255,oe=65535&F,!(Ht+(Ft=F>>>24)<=Y);){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}V>>>=Ht,Y-=Ht,E.back+=Ht}if(V>>>=Ft,Y-=Ft,E.back+=Ft,E.length=oe,Mt===0){E.mode=26;break}if(32&Mt){E.back=-1,E.mode=12;break}if(64&Mt){L.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Mt,E.mode=22;case 22:if(E.extra){for(B=E.extra;Y<B;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}E.length+=V&(1<<E.extra)-1,V>>>=E.extra,Y-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Mt=(F=E.distcode[V&(1<<E.distbits)-1])>>>16&255,oe=65535&F,!((Ft=F>>>24)<=Y);){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(!(240&Mt)){for(Ht=Ft,Re=Mt,Be=oe;Mt=(F=E.distcode[Be+((V&(1<<Ht+Re)-1)>>Ht)])>>>16&255,oe=65535&F,!(Ht+(Ft=F>>>24)<=Y);){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}V>>>=Ht,Y-=Ht,E.back+=Ht}if(V>>>=Ft,Y-=Ft,E.back+=Ft,64&Mt){L.msg="invalid distance code",E.mode=30;break}E.offset=oe,E.extra=15&Mt,E.mode=24;case 24:if(E.extra){for(B=E.extra;Y<B;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}E.offset+=V&(1<<E.extra)-1,V>>>=E.extra,Y-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){L.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(ut===0)break t;if(ht=ct-ut,E.offset>ht){if((ht=E.offset-ht)>E.whave&&E.sane){L.msg="invalid distance too far back",E.mode=30;break}Dt=ht>E.wnext?(ht-=E.wnext,E.wsize-ht):E.wnext-ht,ht>E.length&&(ht=E.length),re=E.window}else re=q,Dt=st-E.offset,ht=E.length;for(ut<ht&&(ht=ut),ut-=ht,E.length-=ht;q[st++]=re[Dt++],--ht;);E.length===0&&(E.mode=21);break;case 26:if(ut===0)break t;q[st++]=E.length,ut--,E.mode=21;break;case 27:if(E.wrap){for(;Y<32;){if(nt===0)break t;nt--,V|=P[$++]<<Y,Y+=8}if(ct-=ut,L.total_out+=ct,E.total+=ct,ct&&(L.adler=E.check=E.flags?a(E.check,q,ct,st-ct):o(E.check,q,ct,st-ct)),ct=ut,(E.flags?V:w(V))!==E.check){L.msg="incorrect data check",E.mode=30;break}Y=V=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;Y<32;){if(nt===0)break t;nt--,V+=P[$++]<<Y,Y+=8}if(V!==(4294967295&E.total)){L.msg="incorrect length check",E.mode=30;break}Y=V=0}E.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=st,L.avail_out=ut,L.next_in=$,L.avail_in=nt,E.hold=V,E.bits=Y,(E.wsize||ct!==L.avail_out&&E.mode<30&&(E.mode<27||N!==4))&&G(L,L.output,L.next_out,ct-L.avail_out)?(E.mode=31,-4):(xt-=L.avail_in,ct-=L.avail_out,L.total_in+=xt,L.total_out+=ct,E.total+=ct,E.wrap&&ct&&(L.adler=E.check=E.flags?a(E.check,q,ct,L.next_out-ct):o(E.check,q,ct,L.next_out-ct)),L.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(xt==0&&ct===0||N===4)&&ot===d&&(ot=-5),ot)},i.inflateEnd=function(L){if(!L||!L.state)return h;var N=L.state;return N.window&&(N.window=null),L.state=null,d},i.inflateGetHeader=function(L,N){var E;return L&&L.state&&2&(E=L.state).wrap?((E.head=N).done=!1,d):h},i.inflateSetDictionary=function(L,N){var E,P=N.length;return L&&L.state?(E=L.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,N,P,0)!==E.check?-3:G(L,N,P,P)?(E.mode=31,-4):(E.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,p,m,y,w){var k,T,A,C,R,S,U,I,D,G=w.bits,L=0,N=0,E=0,P=0,q=0,$=0,st=0,nt=0,ut=0,V=0,Y=null,xt=0,ct=new s.Buf16(16),ht=new s.Buf16(16),Dt=null,re=0;for(L=0;L<=15;L++)ct[L]=0;for(N=0;N<h;N++)ct[f[d+N]]++;for(q=G,P=15;1<=P&&ct[P]===0;P--);if(P<q&&(q=P),P===0)return p[m++]=20971520,p[m++]=20971520,w.bits=1,0;for(E=1;E<P&&ct[E]===0;E++);for(q<E&&(q=E),L=nt=1;L<=15;L++)if(nt<<=1,(nt-=ct[L])<0)return-1;if(0<nt&&(u===0||P!==1))return-1;for(ht[1]=0,L=1;L<15;L++)ht[L+1]=ht[L]+ct[L];for(N=0;N<h;N++)f[d+N]!==0&&(y[ht[f[d+N]]++]=N);if(S=u===0?(Y=Dt=y,19):u===1?(Y=o,xt-=257,Dt=a,re-=257,256):(Y=c,Dt=l,-1),L=E,R=m,st=N=V=0,A=-1,C=(ut=1<<($=q))-1,u===1&&852<ut||u===2&&592<ut)return 1;for(;;){for(U=L-st,D=y[N]<S?(I=0,y[N]):y[N]>S?(I=Dt[re+y[N]],Y[xt+y[N]]):(I=96,0),k=1<<L-st,E=T=1<<$;p[R+(V>>st)+(T-=k)]=U<<24|I<<16|D|0,T!==0;);for(k=1<<L-1;V&k;)k>>=1;if(k!==0?(V&=k-1,V+=k):V=0,N++,--ct[L]==0){if(L===P)break;L=f[d+y[N]]}if(q<L&&(V&C)!==A){for(st===0&&(st=q),R+=E,nt=1<<($=L-st);$+st<P&&!((nt-=ct[$+st])<=0);)$++,nt<<=1;if(ut+=1<<$,u===1&&852<ut||u===2&&592<ut)return 1;p[A=V&C]=q<<24|$<<16|R-m|0}}return V!==0&&(p[R+V]=L-st<<24|64<<16|0),w.bits=q,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var H=F.length;0<=--H;)F[H]=0}var l=0,u=29,f=256,d=f+1+u,h=30,p=19,m=2*d+1,y=15,w=16,k=7,T=256,A=16,C=17,R=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(d+2));c(G);var L=new Array(2*h);c(L);var N=new Array(512);c(N);var E=new Array(256);c(E);var P=new Array(u);c(P);var q,$,st,nt=new Array(h);function ut(F,H,at,ft,J){this.static_tree=F,this.extra_bits=H,this.extra_base=at,this.elems=ft,this.max_length=J,this.has_stree=F&&F.length}function V(F,H){this.dyn_tree=F,this.max_code=0,this.stat_desc=H}function Y(F){return F<256?N[F]:N[256+(F>>>7)]}function xt(F,H){F.pending_buf[F.pending++]=255&H,F.pending_buf[F.pending++]=H>>>8&255}function ct(F,H,at){F.bi_valid>w-at?(F.bi_buf|=H<<F.bi_valid&65535,xt(F,F.bi_buf),F.bi_buf=H>>w-F.bi_valid,F.bi_valid+=at-w):(F.bi_buf|=H<<F.bi_valid&65535,F.bi_valid+=at)}function ht(F,H,at){ct(F,at[2*H],at[2*H+1])}function Dt(F,H){for(var at=0;at|=1&F,F>>>=1,at<<=1,0<--H;);return at>>>1}function re(F,H,at){var ft,J,mt=new Array(y+1),wt=0;for(ft=1;ft<=y;ft++)mt[ft]=wt=wt+at[ft-1]<<1;for(J=0;J<=H;J++){var dt=F[2*J+1];dt!==0&&(F[2*J]=Dt(mt[dt]++,dt))}}function Ft(F){var H;for(H=0;H<d;H++)F.dyn_ltree[2*H]=0;for(H=0;H<h;H++)F.dyn_dtree[2*H]=0;for(H=0;H<p;H++)F.bl_tree[2*H]=0;F.dyn_ltree[2*T]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Mt(F){8<F.bi_valid?xt(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function oe(F,H,at,ft){var J=2*H,mt=2*at;return F[J]<F[mt]||F[J]===F[mt]&&ft[H]<=ft[at]}function Ht(F,H,at){for(var ft=F.heap[at],J=at<<1;J<=F.heap_len&&(J<F.heap_len&&oe(H,F.heap[J+1],F.heap[J],F.depth)&&J++,!oe(H,ft,F.heap[J],F.depth));)F.heap[at]=F.heap[J],at=J,J<<=1;F.heap[at]=ft}function Re(F,H,at){var ft,J,mt,wt,dt=0;if(F.last_lit!==0)for(;ft=F.pending_buf[F.d_buf+2*dt]<<8|F.pending_buf[F.d_buf+2*dt+1],J=F.pending_buf[F.l_buf+dt],dt++,ft===0?ht(F,J,H):(ht(F,(mt=E[J])+f+1,H),(wt=S[mt])!==0&&ct(F,J-=P[mt],wt),ht(F,mt=Y(--ft),at),(wt=U[mt])!==0&&ct(F,ft-=nt[mt],wt)),dt<F.last_lit;);ht(F,T,H)}function Be(F,H){var at,ft,J,mt=H.dyn_tree,wt=H.stat_desc.static_tree,dt=H.stat_desc.has_stree,Tt=H.stat_desc.elems,le=-1;for(F.heap_len=0,F.heap_max=m,at=0;at<Tt;at++)mt[2*at]!==0?(F.heap[++F.heap_len]=le=at,F.depth[at]=0):mt[2*at+1]=0;for(;F.heap_len<2;)mt[2*(J=F.heap[++F.heap_len]=le<2?++le:0)]=1,F.depth[J]=0,F.opt_len--,dt&&(F.static_len-=wt[2*J+1]);for(H.max_code=le,at=F.heap_len>>1;1<=at;at--)Ht(F,mt,at);for(J=Tt;at=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Ht(F,mt,1),ft=F.heap[1],F.heap[--F.heap_max]=at,F.heap[--F.heap_max]=ft,mt[2*J]=mt[2*at]+mt[2*ft],F.depth[J]=(F.depth[at]>=F.depth[ft]?F.depth[at]:F.depth[ft])+1,mt[2*at+1]=mt[2*ft+1]=J,F.heap[1]=J++,Ht(F,mt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(Bt,Yn){var O,g,_,M,j,Q,it=Yn.dyn_tree,jt=Yn.max_code,Se=Yn.stat_desc.static_tree,we=Yn.stat_desc.has_stree,Oe=Yn.stat_desc.extra_bits,ce=Yn.stat_desc.extra_base,jc=Yn.stat_desc.max_length,ph=0;for(M=0;M<=y;M++)Bt.bl_count[M]=0;for(it[2*Bt.heap[Bt.heap_max]+1]=0,O=Bt.heap_max+1;O<m;O++)jc<(M=it[2*it[2*(g=Bt.heap[O])+1]+1]+1)&&(M=jc,ph++),it[2*g+1]=M,jt<g||(Bt.bl_count[M]++,j=0,ce<=g&&(j=Oe[g-ce]),Q=it[2*g],Bt.opt_len+=Q*(M+j),we&&(Bt.static_len+=Q*(Se[2*g+1]+j)));if(ph!==0){do{for(M=jc-1;Bt.bl_count[M]===0;)M--;Bt.bl_count[M]--,Bt.bl_count[M+1]+=2,Bt.bl_count[jc]--,ph-=2}while(0<ph);for(M=jc;M!==0;M--)for(g=Bt.bl_count[M];g!==0;)jt<(_=Bt.heap[--O])||(it[2*_+1]!==M&&(Bt.opt_len+=(M-it[2*_+1])*it[2*_],it[2*_+1]=M),g--)}}(F,H),re(mt,le,F.bl_count)}function v(F,H,at){var ft,J,mt=-1,wt=H[1],dt=0,Tt=7,le=4;for(wt===0&&(Tt=138,le=3),H[2*(at+1)+1]=65535,ft=0;ft<=at;ft++)J=wt,wt=H[2*(ft+1)+1],++dt<Tt&&J===wt||(dt<le?F.bl_tree[2*J]+=dt:J!==0?(J!==mt&&F.bl_tree[2*J]++,F.bl_tree[2*A]++):dt<=10?F.bl_tree[2*C]++:F.bl_tree[2*R]++,mt=J,le=(dt=0)===wt?(Tt=138,3):J===wt?(Tt=6,3):(Tt=7,4))}function ot(F,H,at){var ft,J,mt=-1,wt=H[1],dt=0,Tt=7,le=4;for(wt===0&&(Tt=138,le=3),ft=0;ft<=at;ft++)if(J=wt,wt=H[2*(ft+1)+1],!(++dt<Tt&&J===wt)){if(dt<le)for(;ht(F,J,F.bl_tree),--dt!=0;);else J!==0?(J!==mt&&(ht(F,J,F.bl_tree),dt--),ht(F,A,F.bl_tree),ct(F,dt-3,2)):dt<=10?(ht(F,C,F.bl_tree),ct(F,dt-3,3)):(ht(F,R,F.bl_tree),ct(F,dt-11,7));mt=J,le=(dt=0)===wt?(Tt=138,3):J===wt?(Tt=6,3):(Tt=7,4)}}c(nt);var et=!1;function B(F,H,at,ft){ct(F,(l<<1)+(ft?1:0),3),function(J,mt,wt,dt){Mt(J),xt(J,wt),xt(J,~wt),s.arraySet(J.pending_buf,J.window,mt,wt,J.pending),J.pending+=wt}(F,H,at)}i._tr_init=function(F){et||(function(){var H,at,ft,J,mt,wt=new Array(y+1);for(J=ft=0;J<u-1;J++)for(P[J]=ft,H=0;H<1<<S[J];H++)E[ft++]=J;for(E[ft-1]=J,J=mt=0;J<16;J++)for(nt[J]=mt,H=0;H<1<<U[J];H++)N[mt++]=J;for(mt>>=7;J<h;J++)for(nt[J]=mt<<7,H=0;H<1<<U[J]-7;H++)N[256+mt++]=J;for(at=0;at<=y;at++)wt[at]=0;for(H=0;H<=143;)G[2*H+1]=8,H++,wt[8]++;for(;H<=255;)G[2*H+1]=9,H++,wt[9]++;for(;H<=279;)G[2*H+1]=7,H++,wt[7]++;for(;H<=287;)G[2*H+1]=8,H++,wt[8]++;for(re(G,d+1,wt),H=0;H<h;H++)L[2*H+1]=5,L[2*H]=Dt(H,5);q=new ut(G,S,f+1,d,y),$=new ut(L,U,0,h,y),st=new ut(new Array(0),I,0,p,k)}(),et=!0),F.l_desc=new V(F.dyn_ltree,q),F.d_desc=new V(F.dyn_dtree,$),F.bl_desc=new V(F.bl_tree,st),F.bi_buf=0,F.bi_valid=0,Ft(F)},i._tr_stored_block=B,i._tr_flush_block=function(F,H,at,ft){var J,mt,wt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(dt){var Tt,le=4093624447;for(Tt=0;Tt<=31;Tt++,le>>>=1)if(1&le&&dt.dyn_ltree[2*Tt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(Tt=32;Tt<f;Tt++)if(dt.dyn_ltree[2*Tt]!==0)return a;return o}(F)),Be(F,F.l_desc),Be(F,F.d_desc),wt=function(dt){var Tt;for(v(dt,dt.dyn_ltree,dt.l_desc.max_code),v(dt,dt.dyn_dtree,dt.d_desc.max_code),Be(dt,dt.bl_desc),Tt=p-1;3<=Tt&&dt.bl_tree[2*D[Tt]+1]===0;Tt--);return dt.opt_len+=3*(Tt+1)+5+5+4,Tt}(F),J=F.opt_len+3+7>>>3,(mt=F.static_len+3+7>>>3)<=J&&(J=mt)):J=mt=at+5,at+4<=J&&H!==-1?B(F,H,at,ft):F.strategy===4||mt===J?(ct(F,2+(ft?1:0),3),Re(F,G,L)):(ct(F,4+(ft?1:0),3),function(dt,Tt,le,Bt){var Yn;for(ct(dt,Tt-257,5),ct(dt,le-1,5),ct(dt,Bt-4,4),Yn=0;Yn<Bt;Yn++)ct(dt,dt.bl_tree[2*D[Yn]+1],3);ot(dt,dt.dyn_ltree,Tt-1),ot(dt,dt.dyn_dtree,le-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,wt+1),Re(F,F.dyn_ltree,F.dyn_dtree)),Ft(F),ft&&Mt(F)},i._tr_tally=function(F,H,at){return F.pending_buf[F.d_buf+2*F.last_lit]=H>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&H,F.pending_buf[F.l_buf+F.last_lit]=255&at,F.last_lit++,H===0?F.dyn_ltree[2*at]++:(F.matches++,H--,F.dyn_ltree[2*(E[at]+f+1)]++,F.dyn_dtree[2*Y(H)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){ct(F,2,3),ht(F,T,G),function(H){H.bi_valid===16?(xt(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):8<=H.bi_valid&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},p=!1,m=o.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(o);y=y&&y.setTimeout?y:o,c={}.toString.call(o.process)==="[object process]"?function(A){Ir.nextTick(function(){k(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,C=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=C,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){k(A.data)},function(A){u.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(A){var C=m.createElement("script");C.onreadystatechange=function(){k(A),C.onreadystatechange=null,l.removeChild(C),C=null},l.appendChild(C)}):function(A){setTimeout(k,0,A)},y.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var C=new Array(arguments.length-1),R=0;R<C.length;R++)C[R]=arguments[R+1];var S={callback:A,args:C};return h[d]=S,c(d),d++},y.clearImmediate=w}function w(A){delete h[A]}function k(A){if(p)setTimeout(k,0,A);else{var C=h[A];if(C){p=!0;try{(function(R){var S=R.callback,U=R.args;switch(U.length){case 0:S();break;case 1:S(U[0]);break;case 2:S(U[0],U[1]);break;case 3:S(U[0],U[1],U[2]);break;default:S.apply(a,U)}})(C)}finally{w(A),p=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&k(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Cn<"u"?Cn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Nx);var K4=Nx.exports,wp=no(K4);const Cx={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Cx);var Or=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},da,Dc,eo;class W4{constructor(...e){da.set(this,new Map),Dc.set(this,new Map),eo.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Or(this,eo,"f").has(r)||Or(this,eo,"f").set(r,new Set);const s=Or(this,eo,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Or(this,Dc,"f").set(r,a),o=!1,c)continue;const l=Or(this,da,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Or(this,da,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Or(this,da,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&Or(this,Dc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Or(this,eo,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Or(this,eo,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Or(this,da,"f"),extensions:Or(this,Dc,"f")}}}da=new WeakMap,Dc=new WeakMap,eo=new WeakMap;var H4=new W4(Cx)._freeze();function Lx(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:if(t.endsWith(".xp"))return"application/rexpaint";break}return H4.getType(t)??"application/octet-stream"}async function G4(t,e,n){try{he(tt,t,"parsezipfile",e.name);const r=await e.arrayBuffer();(await new wp().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=Lx(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{ue(tt,t,"crash",c.message)})})}catch(r){ue(tt,t,"crash",r.message)}}async function Mx(t,e,n){try{he(tt,e,"parsebinaryfile",t.name);const r=await t.arrayBuffer();n(new Uint8Array(r))}catch(r){ue(tt,e,"crash",r.message)}}function Ux(t,e){function n(r){if(x(e))switch(r){case"text/plain":e.text().then(i=>Fa(tt,t,void 0,"text",`file:${e.name}`,i)).catch(i=>ue(tt,t,"crash",i.message));break;case"application/json":e.text().then(i=>Fa(tt,t,void 0,"json",`file:${e.name}`,i)).catch(i=>ue(tt,t,"crash",i.message));break;case"application/zip":G4(t,e,i=>Ux(t,i)).catch(i=>ue(tt,t,"crash",i.message));break;case"application/rexpaint":Mx(e,t,i=>Fa(tt,t,void 0,"rexpaint",`file:${e.name}`,i)).catch(i=>ue(tt,t,"crash",i.message));break;case"application/octet-stream":Mx(e,t,i=>Fa(tt,t,void 0,"binary",`file:${e.name}`,i)).catch(i=>ue(tt,t,"crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=Lx(e.name,new Uint8Array(i));if(s)n(s);else return ue(tt,t,"parsewebfile",`unsupported file ${e.name}`)}).catch(i=>ue(tt,t,"crash",i.message));return}}n((e==null?void 0:e.type)??"")}function pa(t,e,n){function r(i){ue(t,e,"crash",i.message)}n().catch(r)}function Y4(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function V4(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const Z4=new Date("1980/09/02");async function Fx(t){return console.info("saved",t),new Promise((e,n)=>{const r=new wp;for(let i=0;i<t.length;++i){const s=t[i],o=QU(s);if(o){const a=XI(o);x(a)&&r.file(s.id,a,{date:Z4})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(V4(i))}).catch(n)})}async function X4(t){return new Promise((e,n)=>{const r=new wp;r.loadAsync(Y4(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=tF(qI(c));x(l)&&i.push(l)}e(i)}).catch(n)})}function Bx(t,e){return`${t.x},${t.y},${e.x},${e.y}`}let nn;function q4(){return!!nn}function J4(t,e,n){const r=Math.min(e.x,n.x),i=Math.min(e.y,n.y),s=Math.max(e.x,n.x),o=Math.max(e.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},p=me(t,{x:d,y:f});(p==null?void 0:p.category)===fr.ISOBJECT?(l.push(Zn(jo(t,d,f))),is(p)!=="player"&&u.push({...Zn(p),...h,id:"blank"})):l.push({...Zn(p),...h})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}function Q4(t,e,n,r){const i=lr(t);if(x(i))switch(nn=J4(i,e,n),r){case"copyobjects":nn.terrain=[];break;case"copyterrain":nn.objects=[];break}}function tj(t,e,n){const r=Bx(e,n);ee(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Ut(t,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Ut(t,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=hn(t);i.scroll=ur(t)}function ej(t,e,n,r){const i=lr(t);if(!x(i)||!x(nn))return;const s=Math.min(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.x,n.x),c=Math.max(e.y,n.y),l=a-s+1,u=c-o+1,f=Math.min(nn.width,l),d=Math.min(nn.height,u);switch(r){case"pasteall":{for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Lo({x:p,y:h},nn.width);ln(i,{...nn.terrain[m],x:s+p,y:o+h})}for(let h=0;h<nn.objects.length;++h){const p=nn.objects[h];x(p.x)&&x(p.y)&&Mo(p.x,p.y,0,l-1,u-1,0)&&vd(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let h=0;h<nn.objects.length;++h){const p=nn.objects[h];x(p.x)&&x(p.y)&&Mo(p.x,p.y,0,l-1,u-1,0)&&vd(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Lo({x:p,y:h},nn.width);ln(i,{...nn.terrain[m],x:s+p,y:o+h})}break;case"pasteterraintiled":for(let h=o;h<=c;++h)for(let p=s;p<=a;++p){const m=(p-s)%nn.width,y=(h-o)%nn.height,w=Lo({x:m,y},nn.width);ln(i,{...nn.terrain[w],x:p,y:h})}break}}function nj(t,e,n){const r=Bx(e,n);ee(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Ut(t,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Ut(t,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Ut(t,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=hn(t);i.scroll=ur(t)}function fh(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function rj(t,e,n,r){const i=lr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){At(u)&&(s=u,iy(e.x,e.y,n.x,n.y).forEach(f=>{const d=me(i,f);x(d)&&(d[l]=u)}))}ee(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,`batch:${fh(e,n)}`,"char",[r,"charedit"],o,a);const c=hn(t);c.scroll=ur(t)}function ij(t,e,n,r){const i=lr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){if(At(u)){s=u;for(let f=e.y;f<=n.y;++f)for(let d=e.x;d<=n.x;++d){const h=me(i,{x:d,y:f});x(h)&&(h[l]=u)}}}ee(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,`batch:${fh(e,n)}`,"color",[r,"coloredit"],o,a);const c=hn(t);c.scroll=ur(t)}function sj(t,e,n,r){const i=lr(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){At(u)&&(s=u,iy(e.x,e.y,n.x,n.y).forEach(f=>{const d=me(i,f);x(d)&&(d[l]=u)}))}ee(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,`batch:${fh(e,n)}`,"color",[r,"coloredit"],o,a);const c=hn(t);c.scroll=ur(t)}const $c={stat:"",patternsize:2,mirror:1};function oj(t,e,n){const r=vn(Pt.MAIN);if(!x(r))return;const i=lr(t);if(!x(i))return;const s=fh(e,n);ee(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),q4()&&Ut(t,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),Ut(t,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(h){const{target:p}=Xn(h);return $c[p]}function a(h,p){if(At(p)||bt(p)){const{target:m}=Xn(h);$c[m]=p}}Ut(t,"batch","remix",[`stat:${s}`,"text"],o,a),Ut(t,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),Ut(t,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),Ut(t,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),ee(t,un),Ut(t,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),Ut(t,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),Ut(t,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),ee(t,un),Ut(t,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),ee(t,un),ee(t,"codepages:");const c=Math.min(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.x,n.x),f=Math.max(e.y,n.y),d=new Set;for(let h=l;h<=f;++h)for(let p=c;p<=u;++p){const m=me(i,{x:p,y:h}),y=fE(r,m);x(y)&&!d.has(y.id)&&(d.add(y.id),Ut(t,"batch",`edit @${We(y)}`,[`pageopen:${y.id}`]))}}function Ep(t,e){return`inspect:${e!=null&&e.id?e.id:Ur(t,e)}`}function aj(t,e,n){const r=vn(Pt.MAIN);if(!x(r))return;const i=lr(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===fr.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=Ep(i,e);ee(t,`${a}: ${c} ${l}`),ee(t,un),Ut(t,u,"color",[n,"coloredit"],s,o);const f=hn(t);f.scroll=ur(t)}function cj(t,e,n){const r=vn(Pt.MAIN);if(!x(r))return;const i=lr(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===fr.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=Ep(i,e);ee(t,`${a}: ${c} ${l}`),ee(t,un),Ut(t,u,"char",[n,"charedit"],s,o);const f=hn(t);f.scroll=ur(t)}function lj(t,e,n,r,i,s){var f,d,h;function o(p){var y;const m=(r==null?void 0:r[p])??((y=r==null?void 0:r.kinddata)==null?void 0:y[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return $t.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?ee(t,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ee(t,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ee(t,un);const c=Ep(e,r);s?(Ut(t,c,"cycle",["cycle","number","1","255"],o,a),Ut(t,c,"collision",["collision","select","iswalking",`${$t.ISWALK}`,"isswimming",`${$t.ISSWIM}`],o,a)):Ut(t,c,"collision",["collision","select","iswalkable",`${$t.ISWALK}`,"isswimable",`${$t.ISSWIM}`,"issolid",`${$t.ISSOLID}`],o,a),s&&Ut(t,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Ut(t,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const l=Sc(n),u=hr(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ae(l[m])){const[y,w,...k]=l[m];bt(w)&&Ut(t,c,w||m,[m,y,...k],o,a)}break}}Ut(t,c,"copy coords",["copycoords","hk","5"," 5 "]),ee(t,un),Ut(t,c,`char: ${r.char??((f=r.kinddata)==null?void 0:f.char)??1}`,["char","hk","a"," A ","next"],o,a),Ut(t,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),Ut(t,c,`bg: ${r.bg??((h=r.kinddata)==null?void 0:h.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ee(t,un),Ut(t,c,"make empty",["empty","hk","0"],o,a),ee(t,un),Ut(t,"batch",`edit @${We(n)}`,[`pageopen:${n.id}`])}function uj(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function hj(t,e,n,r){const i=vn(Pt.MAIN);if(!x(i))return;const s=lr(t);if(x(s))switch(r){case"emptyall":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=me(s,{x:a,y:o});(c==null?void 0:c.category)===fr.ISOBJECT&&or(i,s,c,i.timestamp),ln(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=me(s,{x:a,y:o});(c==null?void 0:c.category)===fr.ISOBJECT&&or(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a)ln(s,{x:a,y:o});break}}}function fj(t,e,n){const r=uj(e,n);ee(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ee(t,un),Ut(t,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Ut(t,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Ut(t,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=hn(t);i.scroll=ur(t)}function dj(t,e,n){const r=vn(Pt.MAIN);if(!x(r))return;const i=lr(t);if(!x(i))return;if(Ge(r,i),e.x===n.x&&e.y===n.y){const o=me(i,e),a=fE(r,o);x(o)&&x(a)&&lj(t,i,a,o,e,wn(o)),o!=null&&o.kind||(ee(t,`empty: ${e.x}, ${e.y}`),ee(t,un),Ut(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]))}else oj(t,e,n);const s=hn(t);s.scroll=ur(t)}function pj(t,e){const n=be(Pt.MAIN);if(!x(n))return;const r=lr(e);if(!x(r))return;const i=Xn(t),s=eN(r,i.target);if(x(s))switch(i.path){case"copycoords":nf(tt,cr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":aj(e,s,i.path);break;case"char":cj(e,s,i.path);break;case"empty":or(n,r,s,n.timestamp);break;case"code":pa(tt,e,async()=>{const o=is(s),a="object";he(tt,e,`opened [${a}] ${o}`);const c=[r.id,s.id];td(rl(n.id,c),s.code??""),MA(tt,e),await ug(800),ag(tt,e,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}function mj(t,e){const n=lr(e);if(!x(n))return;const r=Xn(t),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":tj(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":Q4(e,c,l,r.target);break;case"paste":nj(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":ej(e,c,l,r.target);break;case"empty":fj(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":hj(e,c,l,r.target);break;case"chars":rj(e,c,l,"char");break;case"colors":ij(e,c,l,"color");break;case"bgs":sj(e,c,l,"bg");break;case"copycoords":nf(tt,e,[i,s,o,a].join(" "));break;case"remixrun":{const u=zn(b.book,_t.BOARD,$c.stat),f=Te(...u);x(f)&&ZE(n.id,f.id,$c.patternsize,$c.mirror,c,l,"all");break}case"pageopen":pa(tt,e,async()=>{await ug(800),tR(tt,e,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const gj=16,bs={},dh={},_j=60;let Px=0;const ma={},ga={};async function Dx(t){const e=ca(),n=be(Pt.MAIN);if(e.length&&x(n)){const r=await Fx(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;FA(se,cr(),i,r)}}async function yj(){const t=ca(),e=be(Pt.MAIN);if(t.length&&x(e)){const n=await Fx(t);BA(se,cr(),n)}}const se=io("vm",["tick","second"],t=>{var n;if(!se.session(t))return;const e=cr();switch(t.target){case"operator":y4(t.player),he(se,t.player,`operator set to ${t.player}`),se.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=be(Pt.MAIN);se.replynext(t,"ackzsswords",{cli:op(_s.CLI),loader:op(_s.LOADER),runtime:op(_s.RUNTIME),flags:[...hr(Sr(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...Zs(r,_t.OBJECT).map(i=>We(i)),...hr(ep)],altkinds:[...Zs(r,_t.TERRAIN),...Zs(r,_t.BOARD),...Zs(r,_t.PALETTE),...Zs(r,_t.CHARSET),...Zs(r,_t.LOADER)].map(i=>We(i)),colors:[...hr(Qa)],dirs:[...hr(ad).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...hr(np)]});break}case"books":t.player===e&&pa(se,t.player,async()=>{if(ae(t.data)){const[r,i]=t.data,s=await X4(r),o=s.map(a=>a.name);k4(s,i),he(se,t.player,`loading ${o.join(", ")}`),ef(se,t.player)}});break;case"search":R4(t.player)||ef(se,t.player);break;case"logout":A4(t.player),delete bs[t.player],he(se,e,`player ${t.player} logout`),ef(se,t.player);break;case"login":vx(t.player)?(bs[t.player]=0,he(se,cr(),`login from ${t.player}`),se.replynext(t,"acklogin",!0)):ig(se,t.player);break;case"local":vx(t.player)?(bs[t.player]=0,he(se,cr(),`login from ${t.player}`)):ig(se,t.player);break;case"doot":bs[t.player]=0,dh[t.player]=dh[t.player]??0,dh[t.player]%32===0&&he(se,t.player,`$whiteactive $blue${t.player}`),++dh[t.player];break;case"input":{if(t.player.includes("local")&&!Ex(t.player)&&QA(se,t.player),!t.player.includes("local")||Ex(t.player)){const r=Sr(t.player),[i=Sn.NONE,s=0]=t.data??[Sn.NONE,0];ae(r.inputqueue)||(r.inputqueue=[]),i!==Sn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ae(t.data)){const[r,i]=t.data,s=rl(r,i);x(ga[s])||(ga[s]=ny(s,o=>{const[a,c]=i,l=zr(r),u=Pi(l,a);if(x(u))if(Bi(u)===_t.BOARD&&x(c)){const f=Ce(u),d=Rn(f,c);x(d)&&(d.code=o,U0(cE(o),d))}else u.code=o,JU(u)})),ma[s]=ma[s]??new Set,ma[s].add(t.player)}break;case"coderelease":if(ae(t.data)){const[r,i]=t.data,[,s]=i,o=rl(r,i);x(ma[o])&&(ma[o].delete(t.player),ma[o].size===0&&((n=ga[o])==null||n.call(ga),ga[o]=void 0,bt(s)&&N4(s)))}break;case"halt":t.player===e&&vv(t.data)&&b4(t.data);break;case"tick":w4()||L4();break;case"synthsend":bt(t.data)&&_p(t.data,void 0);break;case"second":{S4(bs);const r=Object.keys(bs);for(let i=0;i<r.length;++i)++bs[r[i]];for(let i=0;i<r.length;++i){const s=r[i];bs[s]>=gj&&cg(se,s)}++Px>=_j&&(Px=0,pa(se,t.player,async()=>{await Dx(!0)}));break}case"copyjsonfile":if(t.player===e){const r=be(Pt.MAIN);if(x(r)&&ae(t.data)){const[i]=t.data,s=Pi(r,i);x(s)&&PA(se,e,s,`${We(s)}.${us(s)}.json`)}}break;case"refscroll":{ee(t.player,"stat refs"),ee(t.player,un),Ut(t.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Ut(t.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]);const r=hn(t.player);r.scroll=ur(t.player);break}case"fork":t.player===e&&pa(se,t.player,async()=>{await yj()});break;case"flush":t.player===e&&pa(se,t.player,async()=>{await Dx()});break;case"cli":Ax(t.player,t.data);break;case"clirepeatlast":M4(t.player);break;case"restart":t.player===e&&(C4(),lg(se,t.player));break;case"inspect":if(ae(t.data)){const[r,i]=t.data;dj(t.player,r,i)}break;case"loader":if(ae(t.data)){const[r,i,s,o]=t.data;if(i==="file")Ux(t.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){he(se,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=be(Pt.MAIN);x(c)&&x(a.data)&&bt(a.exported)&&(gp(a.data),he(se,t.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){he(se,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=be(Pt.MAIN);x(c)&&x(a.data)&&bt(a.exported)&&(dE(c,a.data),he(se,t.player,`loaded ${a.exported}`))}else D$(r,i,s,o,t.player)}break;default:{const{target:r,path:i}=Xn(t.target);switch(It(r)){case"refscroll":switch(i){case"charscroll":{Ut(t.player,"refscroll","char",["char","charedit"]);const s=hn(t.player);s.scroll=ur(t.player);break}case"colorscroll":{Ut(t.player,"refscroll","color",["color","coloredit"]);const s=hn(t.player);s.scroll=ur(t.player);break}}break;case"batch":mj(i,t.player);break;case"empty":{const s=Xn(i);switch(s.target){case"copycoords":nf(se,cr(),s.path.split(",").join(" "));break}break}case"inspect":pj(i,t.player);break;case"touched":if(ae(t.data)){const[s,o,a]=t.data;kx({...t,target:`${s}:${a}`,data:void 0,sender:o})}break;default:kx(t);break}break}}},_4());function bj(){UA(se)}const{forward:wj}=aR(t=>{cR(t)&&postMessage(t)});onmessage=function(e){wj(e.data)},setTimeout(bj,100)})();

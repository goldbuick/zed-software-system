(function(){"use strict";const Wu=new Set,Ko={emit(t,e,r,n,i){Ko.invoke(PT(t,e,r,n,i))},invoke(t){Wu.forEach(e=>e.handle(t))},connect(t){Wu.add(t)},disconnect(t){Wu.delete(t)}};var Ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function js(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function nT(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var ac={exports:{}},iT=ac.exports,J0;function sT(){return J0||(J0=1,(function(t,e){(function(r,n){t.exports=n()})(iT,function(){return r.importState=function(i){var s=new r;return s.importState(i),s},r;function r(){return(function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=n();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h})(Array.prototype.slice.call(arguments))}function n(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(ac)),ac.exports}var oT=sT(),Q0=js(oT),qo={},em;function aT(){return em||(em=1,(function(t){var e=qo&&qo.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,m;d<f;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function r(l){return l[Math.floor(Math.random()*l.length)]}function n(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,g=l.addAdverb,y=g===void 0?!1:g,b=e(e(e([],e([],Array(p),!0).map(function(A){return r(t.adjectives)}),!0),[r(t.nouns),r(t.verbs)],!1),y?[r(t.adverbs)]:[],!0);return f&&(b=b.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),b.join(h)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return n(t.adjectives).length*h+h*p.length+n(t.nouns).length+p.length+n(t.verbs).length+(f?n(t.adverbs).length+p.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(t.adjectives).length*h+h*p.length+i(t.nouns).length+p.length+i(t.verbs).length+(f?i(t.adverbs).length+p.length:0)}t.minLength=c,t.default=s})(qo)),qo}var cT=aT(),tm=js(cT);const lT="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let uT=t=>crypto.getRandomValues(new Uint8Array(t)),fT=(t,e,r)=>{let n=(2<<Math.log2(t.length-1))-1,i=-~(1.6*n*e/t.length);return(s=e)=>{let o="";for(;;){let a=r(i),c=i|0;for(;c--;)if(o+=t[a[c]&n]||"",o.length>=s)return o}}},rm=(t,e=21)=>fT(t,e|0,uT),hT=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=lT[r[t]&63];return e};var Hu,nm;function im(){return nm||(nm=1,Hu="abcdefghijklmnopqrstuvwxyz"),Hu}var Gu,sm;function om(){return sm||(sm=1,Gu="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),Gu}var Ku,am;function cm(){return am||(am=1,Ku="0123456789"),Ku}var qu,lm;function dT(){return lm||(lm=1,qu="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz"),qu}var Yu,um;function pT(){return um||(um=1,Yu="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz"),Yu}var Vu,fm;function mT(){if(fm)return Vu;fm=1;const t=cm(),e=im(),r=om();return Vu=t+e+r,Vu}var Xu,hm;function gT(){return hm||(hm=1,Xu={lowercase:im(),uppercase:om(),numbers:cm(),nolookalikes:dT(),nolookalikesSafe:pT(),alphanumeric:mT()}),Xu}var Zu=gT();function Ft(){return`sid_${hT(12).replaceAll("-",".")}`}rm(Zu.numbers,4),rm(`${Zu.numbers}${Zu.lowercase}`,16);function gr(t){return t?.startsWith("pid_")??!1}function yT(){return tm({capitalize:!1,adjectiveCount:1})}function _T(){return tm({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var bT=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),wT=Object.prototype.hasOwnProperty;function Ju(t,e){return wT.call(t,e)}function Qu(t){if(Array.isArray(t)){for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=""+r;return e}if(Object.keys)return Object.keys(t);var n=[];for(var i in t)Ju(t,i)&&n.push(i);return n}function Lr(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function ef(t){for(var e=0,r=t.length,n;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function ts(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function dm(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function tf(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,r=t.length;e<r;e++)if(tf(t[e]))return!0}else if(typeof t=="object"){for(var n=Qu(t),i=n.length,s=0;s<i;s++)if(tf(t[n[s]]))return!0}}return!1}function pm(t,e){var r=[t];for(var n in e){var i=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof i<"u"&&r.push(n+": "+i)}return r.join(`
`)}var mm=(function(t){bT(e,t);function e(r,n,i,s,o){var a=this.constructor,c=t.call(this,pm(r,{name:n,index:i,operation:s,tree:o}))||this;return c.name=n,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=pm(r,{name:n,index:i,operation:s,tree:o}),c}return e})(Error),Nt=mm,vT=Lr,zs={add:function(t,e,r){return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){var n=cc(r,this.path);n&&(n=Lr(n));var i=rs(r,{op:"remove",path:this.from}).removed;return rs(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(t,e,r){var n=cc(r,this.from);return rs(r,{op:"add",path:this.path,value:Lr(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:Yo(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}},ET={add:function(t,e,r){return ef(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:zs.move,copy:zs.copy,test:zs.test,_get:zs._get};function cc(t,e){if(e=="")return t;var r={op:"_get",path:e};return rs(t,r),r.value}function rs(t,e,r,n,i,s){if(r===void 0&&(r=!1),n===void 0&&(n=!0),i===void 0&&(i=!0),s===void 0&&(s=0),r&&(typeof r=="function"?r(e,0,t,e.path):lc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=cc(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=Yo(t,e.value),o.test===!1)throw new Nt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(r)throw new Nt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{n||(t=Lr(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,d=void 0,f=void 0,m=void 0;for(typeof r=="function"?m=r:m=lc;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=dm(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&m(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(r&&!ef(f))throw new Nt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);ef(f)&&(f=~~f)}if(u>=h){if(r&&e.op==="add"&&f>l.length)throw new Nt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=ET[e.op].call(e,l,f,t);if(o.test===!1)throw new Nt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=h){var o=zs[e.op].call(e,l,f,t);if(o.test===!1)throw new Nt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[f],r&&u<h&&(!l||typeof l!="object"))throw new Nt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function rf(t,e,r,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!0),r&&!Array.isArray(e))throw new Nt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=Lr(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=rs(t,e[o],r,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function kT(t,e,r){var n=rs(t,e);if(n.test===!1)throw new Nt("Test operation failed","TEST_OPERATION_FAILED",r,e,t);return n.newDocument}function lc(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new Nt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(zs[t.op]){if(typeof t.path!="string")throw new Nt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Nt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Nt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Nt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&tf(t.value))throw new Nt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var i=t.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new Nt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new Nt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=gm([o],r);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Nt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new Nt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function gm(t,e,r){try{if(!Array.isArray(t))throw new Nt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)rf(Lr(e),Lr(t),r||!0);else{r=r||lc;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(i){if(i instanceof Nt)return i;throw i}}function Yo(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),i,s,o;if(r&&n){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!Yo(t[i],e[i]))return!1;return!0}if(r!=n)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Yo(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var xT=Object.freeze({__proto__:null,JsonPatchError:Nt,_areEquals:Yo,applyOperation:rs,applyPatch:rf,applyReducer:kT,deepClone:vT,getValueByPointer:cc,validate:gm,validator:lc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var nf=new WeakMap,AT=(function(){function t(e){this.observers=new Map,this.obj=e}return t})(),TT=(function(){function t(e,r){this.callback=e,this.observer=r}return t})();function ST(t){return nf.get(t)}function RT(t,e){return t.observers.get(e)}function OT(t,e){t.observers.delete(e.callback)}function IT(t,e){e.unobserve()}function NT(t,e){var r=[],n,i=ST(t);if(!i)i=new AT(t),nf.set(t,i);else{var s=RT(i,e);n=s&&s.observer}if(n)return n;if(n={},i.value=Lr(t),e){n.callback=e,n.next=null;var o=function(){sf(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=r,n.object=t,n.unobserve=function(){sf(n),clearTimeout(n.next),OT(i,n),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new TT(e,n)),n}function sf(t,e){e===void 0&&(e=!1);var r=nf.get(t.object);of(r.value,t.object,t.patches,"",e),t.patches.length&&rf(r.value,t.patches);var n=t.patches;return n.length>0&&(t.patches=[],t.callback&&t.callback(n)),n}function of(t,e,r,n,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Qu(e),o=Qu(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(Ju(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?of(u,h,r,n+"/"+ts(l),i):u!==h&&(i&&r.push({op:"test",path:n+"/"+ts(l),value:Lr(u)}),r.push({op:"replace",path:n+"/"+ts(l),value:Lr(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&r.push({op:"test",path:n+"/"+ts(l),value:Lr(u)}),r.push({op:"remove",path:n+"/"+ts(l)}),a=!0):(i&&r.push({op:"test",path:n,value:t}),r.push({op:"replace",path:n,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Ju(t,l)&&e[l]!==void 0&&r.push({op:"add",path:n+"/"+ts(l),value:Lr(e[l])})}}}function ym(t,e,r){r===void 0&&(r=!1);var n=[];return of(t,e,n,"",r),n}var CT=Object.freeze({__proto__:null,compare:ym,generate:sf,observe:NT,unobserve:IT});Object.assign({},xT,CT,{JsonPatchError:mm,deepClone:Lr,escapePathComponent:ts,unescapePathComponent:dm});var af,_m;function LT(){if(_m)return af;_m=1;var t=typeof Element<"u",e=typeof Map=="function",r=typeof Set=="function",n=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function i(s,o){if(s===o)return!0;if(s&&o&&typeof s=="object"&&typeof o=="object"){if(s.constructor!==o.constructor)return!1;var a,c,l;if(Array.isArray(s)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(!i(s[c],o[c]))return!1;return!0}var u;if(e&&s instanceof Map&&o instanceof Map){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;for(u=s.entries();!(c=u.next()).done;)if(!i(c.value[1],o.get(c.value[0])))return!1;return!0}if(r&&s instanceof Set&&o instanceof Set){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;return!0}if(n&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(o)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(s[c]!==o[c])return!1;return!0}if(s.constructor===RegExp)return s.source===o.source&&s.flags===o.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof o.valueOf=="function")return s.valueOf()===o.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof o.toString=="function")return s.toString()===o.toString();if(l=Object.keys(s),a=l.length,a!==Object.keys(o).length)return!1;for(c=a;c--!==0;)if(!Object.prototype.hasOwnProperty.call(o,l[c]))return!1;if(t&&s instanceof Element)return!1;for(c=a;c--!==0;)if(!((l[c]==="_owner"||l[c]==="__v"||l[c]==="__o")&&s.$$typeof)&&!i(s[l[c]],o[l[c]]))return!1;return!0}return s!==s&&o!==o}return af=function(o,a){try{return i(o,a)}catch(c){if((c.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw c}},af}var MT=LT(),UT=js(MT);function w(t){return t!=null}const Mr=Object.keys;function xn(t){return Lr(t)}function FT(t){return typeof t=="boolean"}function Te(t){return typeof t=="number"&&isNaN(t)===!1}function ye(t){return typeof t=="string"}function ut(t){return Array.isArray(t)}function cf(t){return t}var it=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(it||{}),We=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t[t.ISGHOST=4]="ISGHOST",t))(We||{}),Ur=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Ur||{}),Ee=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.FIND=18]="FIND",t[t.FLEE=19]="FLEE",t[t.TO=20]="TO",t[t.MID=21]="MID",t[t.OVER=22]="OVER",t[t.UNDER=23]="UNDER",t[t.WITHIN=24]="WITHIN",t[t.AWAYBY=25]="AWAYBY",t))(Ee||{}),Fe=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.VIEWIT=14]="VIEWIT",t[t.ZSSEDIT=15]="ZSSEDIT",t[t.CHAREDIT=16]="CHAREDIT",t[t.COLOREDIT=17]="COLOREDIT",t))(Fe||{});function Be(t){return ye(t)?t.toLowerCase().trim():""}function PT(t,e,r,n,i){return{session:t,player:e,id:Ft(),sender:r,target:n,data:i}}function Fr(t){const[e,...r]=t.split(":");return{target:e,path:r.join(":")}}function Ws(t,e=[],r=cf,n=""){const i=Ft(),s=Be(t),o=e.map(Be);let a=n;const c={id(){return i},name(){return t},session(l){return w(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,h){Ko.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=Fr(l.target),d=Be(u);!a&&d==="ready"&&(a=l.session),d==="session_reset"&&(a=""),o.findIndex(f=>f==="all"||f===d)!==-1&&r(l),(i===u||d==="all"||s===d)&&r({...l,target:h})}};return Ko.connect(c),c}function $T(t){return typeof t=="object"&&ye(t.session)&&ye(t.player)&&ye(t.id)&&ye(t.sender)&&ye(t.target)}function mt(t,e,r,...n){return t.emit(e,"error",[`$red${r}$blue>>`,...n]),!1}function BT(t,e,...r){return t.emit(e,"info",r),!0}function Pt(t,e,...r){return t.emit(e,"log",r),!0}function DT(t,e,...r){return t.emit(e,"chat",r),!0}function Vo(t,e,r){t.emit(e,"toast",r)}function jT(t,e,r){t.emit(e,"bridge:streamstart",r)}function zT(t,e){t.emit(e,"bridge:streamstop",void 0)}function WT(t,e,r){t.emit(e,"bridge:chatstart",r)}function HT(t,e){t.emit(e,"bridge:chatstop")}function GT(t,e,r,n,i,s,o){t.emit(e,"bridge:fetch",[r,n,i,s,o])}function KT(t,e,r){t.emit(e,"bridge:start",r)}function qT(t,e,r){t.emit(e,"bridge:tab",r)}function YT(t,e,r){t.emit(e,"gadgetclient:paint",r)}function VT(t,e,r){t.emit(e,"gadgetclient:patch",r)}function XT(t,e){t.emit(e,"gadgetserver:clearscroll")}function ZT(t,e){t.emit(e,"gadgetserver:clearplayer")}function JT(t){t.emit("","ready")}function bm(t,e){t.emit(e,"register:loginfail")}function lf(t,e){t.emit(e,"register:loginready",!0)}function QT(t,e,r,n){t.emit(e,"register:savemem",[r,n])}function eS(t,e,r){t.emit(e,"register:forkmem",[r])}function tS(t,e,r,n){t.emit(e,"register:itchiopublishmem",[r,n])}function uf(t,e,r){t.emit(e,"register:copy",r)}function rS(t,e,r,n){t.emit(e,"register:copyjsonfile",[r,n])}function wm(t,e,r,n){t.emit(e,"register:downloadjsonfile",[r,n])}function nS(t,e){t.emit(e,"register:dev",void 0)}function iS(t,e){t.emit(e,"register:share",void 0)}function sS(t,e){t.emit(e,"register:nuke",void 0)}function oS(t,e){t.emit(e,"register:enterar",void 0)}function aS(t,e,r,n){t.emit(e,"synth:tts",[r,n])}function cS(t,e,r,n){t.emit(e,"synth:ttsqueue",[r,n])}function lS(t,e,r,n){t.emit(e,"synth:play",[r,n])}function uS(t,e,r,n,i){t.emit(e,"synth:bgplay",[r,n,i])}function fS(t,e,r){t.emit(e,"synth:bpm",r)}function hS(t,e,r){t.emit(e,"synth:playvolume",r)}function dS(t,e,r){t.emit(e,"synth:bgplayvolume",r)}function pS(t,e,r){t.emit(e,"synth:ttsvolume",r)}function ff(t,e,r,n,i){t.emit(e,"synth:voice",[r,n,i])}function vm(t,e,r,n,i,s){t.emit(e,"synth:voicefx",[r,n,i,s])}function mS(t,e,r){t.emit(e,"synth:record",r)}function gS(t,e){t.emit(e,"synth:flush",filename)}function Em(t,e,r,n){t.emit(e,"register:config",[r,n])}function yS(t,e){t.emit(e,"register:configshow")}function _S(t,e){t.emit(e,"register:inspector")}function bS(t,e){t.emit(e,"register:terminal:full")}function km(t,e,r,n,i,s){t.emit(e,"register:editor:open",[r,n,i,s])}function wS(t,e,r,n){t.emit(e,"vm:zztsearch",[r,n])}function vS(t,e){t.emit(e,"vm:zztrandom")}function ES(t,e){t.emit(e,"vm:local")}function hf(t,e){t.emit(e,"vm:logout")}function xm(t,e,r,n,i){t.emit(e,"vm:touched",[r,n,i])}function kS(t,e){t.emit(e,"vm:readzipfilelist")}function uc(t,e){const[r,n]=e;return`${t}:${[r,n].filter(w).join(":")}`}function xS(t,e,r){t.emit(e,"vm:cli",r)}function AS(t,e){t.emit(e,"vm:restart")}function Am(t,e){t.emit(e,"vm:flush")}function TS(t,e){t.emit(e,"vm:fork")}function SS(t,e){t.emit(e,"vm:itchiopublish")}function RS(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function OS(t,e){return{filename:t,json:e}}function IS(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function df(t,e,r,n,i,s){let o;switch(n){case"file":o=s;break;case"text":o=RS(i,s);break;case"json":o=OS(i,s);break;case"binary":o=IS(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[r,n,i,o])},1)}function NS(t){const e=new Set;function r(s){$T(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Ko.invoke(s))}const n=Ws("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Ko.disconnect(n)}return{forward:r,disconnect:i}}function CS(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"chat":case"toast":case"second":return!0;default:{const e=Fr(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const pf=80,fc=Math.floor(1e3/pf),Tm=3;function hc(t){return new Promise(e=>setTimeout(e,t))}const mf=Ws("clock");let gf=0,dc=0,yf=0,Sm=performance.now();function Rm(){const t=performance.now(),e=t-Sm;yf+=e,yf>=pf&&(yf%=pf,mf.emit("","tick",dc),mf.emit("","tock",dc),++gf,++dc,gf>=fc&&(gf%=fc,mf.emit("","second",dc))),Sm=t,setTimeout(Rm,2)}Rm();var _f={exports:{}};function LS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Om={exports:{}},$t=Om.exports={},jn,zn;function bf(){throw new Error("setTimeout has not been defined")}function wf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?jn=setTimeout:jn=bf}catch{jn=bf}try{typeof clearTimeout=="function"?zn=clearTimeout:zn=wf}catch{zn=wf}})();function Im(t){if(jn===setTimeout)return setTimeout(t,0);if((jn===bf||!jn)&&setTimeout)return jn=setTimeout,setTimeout(t,0);try{return jn(t,0)}catch{try{return jn.call(null,t,0)}catch{return jn.call(this,t,0)}}}function MS(t){if(zn===clearTimeout)return clearTimeout(t);if((zn===wf||!zn)&&clearTimeout)return zn=clearTimeout,clearTimeout(t);try{return zn(t)}catch{try{return zn.call(null,t)}catch{return zn.call(this,t)}}}var ui=[],Hs=!1,ns,pc=-1;function US(){!Hs||!ns||(Hs=!1,ns.length?ui=ns.concat(ui):pc=-1,ui.length&&Nm())}function Nm(){if(!Hs){var t=Im(US);Hs=!0;for(var e=ui.length;e;){for(ns=ui,ui=[];++pc<e;)ns&&ns[pc].run();pc=-1,e=ui.length}ns=null,Hs=!1,MS(t)}}$t.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];ui.push(new Cm(t,e)),ui.length===1&&!Hs&&Im(Nm)};function Cm(t,e){this.fun=t,this.array=e}Cm.prototype.run=function(){this.fun.apply(null,this.array)},$t.title="browser",$t.browser=!0,$t.env={},$t.argv=[],$t.version="",$t.versions={};function fi(){}$t.on=fi,$t.addListener=fi,$t.once=fi,$t.off=fi,$t.removeListener=fi,$t.removeAllListeners=fi,$t.emit=fi,$t.prependListener=fi,$t.prependOnceListener=fi,$t.listeners=function(t){return[]},$t.binding=function(t){throw new Error("process.binding is not supported")},$t.cwd=function(){return"/"},$t.chdir=function(t){throw new Error("process.chdir is not supported")},$t.umask=function(){return 0};var FS=Om.exports;const An=LS(FS);var Je={},Lm;function PS(){if(Lm)return Je;Lm=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function d(N){return N===null||typeof N!="object"?null:(N=h&&N[h]||N["@@iterator"],typeof N=="function"?N:null)}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,p={};function g(N,M,U){this.props=N,this.context=M,this.refs=p,this.updater=U||f}g.prototype.isReactComponent={},g.prototype.setState=function(N,M){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,M,"setState")},g.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function y(){}y.prototype=g.prototype;function b(N,M,U){this.props=N,this.context=M,this.refs=p,this.updater=U||f}var A=b.prototype=new y;A.constructor=b,m(A,g.prototype),A.isPureReactComponent=!0;var S=Array.isArray,x={H:null,A:null,T:null,S:null,V:null},F=Object.prototype.hasOwnProperty;function R(N,M,U,V,q,J){return U=J.ref,{$$typeof:t,type:N,key:M,ref:U!==void 0?U:null,props:J}}function P(N,M){return R(N.type,M,void 0,void 0,void 0,N.props)}function W(N){return typeof N=="object"&&N!==null&&N.$$typeof===t}function D(N){var M={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(U){return M[U]})}var G=/\/+/g;function O(N,M){return typeof N=="object"&&N!==null&&N.key!=null?D(""+N.key):M.toString(36)}function I(){}function v(N){switch(N.status){case"fulfilled":return N.value;case"rejected":throw N.reason;default:switch(typeof N.status=="string"?N.then(I,I):(N.status="pending",N.then(function(M){N.status==="pending"&&(N.status="fulfilled",N.value=M)},function(M){N.status==="pending"&&(N.status="rejected",N.reason=M)})),N.status){case"fulfilled":return N.value;case"rejected":throw N.reason}}throw N}function C(N,M,U,V,q){var J=typeof N;(J==="undefined"||J==="boolean")&&(N=null);var he=!1;if(N===null)he=!0;else switch(J){case"bigint":case"string":case"number":he=!0;break;case"object":switch(N.$$typeof){case t:case e:he=!0;break;case u:return he=N._init,C(he(N._payload),M,U,V,q)}}if(he)return q=q(N),he=V===""?"."+O(N,0):V,S(q)?(U="",he!=null&&(U=he.replace(G,"$&/")+"/"),C(q,M,U,"",function(ke){return ke})):q!=null&&(W(q)&&(q=P(q,U+(q.key==null||N&&N.key===q.key?"":(""+q.key).replace(G,"$&/")+"/")+he)),M.push(q)),1;he=0;var xe=V===""?".":V+":";if(S(N))for(var ve=0;ve<N.length;ve++)V=N[ve],J=xe+O(V,ve),he+=C(V,M,U,J,q);else if(ve=d(N),typeof ve=="function")for(N=ve.call(N),ve=0;!(V=N.next()).done;)V=V.value,J=xe+O(V,ve++),he+=C(V,M,U,J,q);else if(J==="object"){if(typeof N.then=="function")return C(v(N),M,U,V,q);throw M=String(N),Error("Objects are not valid as a React child (found: "+(M==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":M)+"). If you meant to render a collection of children, use an array instead.")}return he}function z(N,M,U){if(N==null)return N;var V=[],q=0;return C(N,V,"","",function(J){return M.call(U,J,q++)}),V}function $(N){if(N._status===-1){var M=N._result;M=M(),M.then(function(U){(N._status===0||N._status===-1)&&(N._status=1,N._result=U)},function(U){(N._status===0||N._status===-1)&&(N._status=2,N._result=U)}),N._status===-1&&(N._status=0,N._result=M)}if(N._status===1)return N._result.default;throw N._result}var Q=typeof reportError=="function"?reportError:function(N){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var M=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof N=="object"&&N!==null&&typeof N.message=="string"?String(N.message):String(N),error:N});if(!window.dispatchEvent(M))return}else if(typeof An=="object"&&typeof An.emit=="function"){An.emit("uncaughtException",N);return}console.error(N)};function Y(){}return Je.Children={map:z,forEach:function(N,M,U){z(N,function(){M.apply(this,arguments)},U)},count:function(N){var M=0;return z(N,function(){M++}),M},toArray:function(N){return z(N,function(M){return M})||[]},only:function(N){if(!W(N))throw Error("React.Children.only expected to receive a single React element child.");return N}},Je.Component=g,Je.Fragment=r,Je.Profiler=i,Je.PureComponent=b,Je.StrictMode=n,Je.Suspense=c,Je.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=x,Je.__COMPILER_RUNTIME={__proto__:null,c:function(N){return x.H.useMemoCache(N)}},Je.cache=function(N){return function(){return N.apply(null,arguments)}},Je.cloneElement=function(N,M,U){if(N==null)throw Error("The argument must be a React element, but you passed "+N+".");var V=m({},N.props),q=N.key,J=void 0;if(M!=null)for(he in M.ref!==void 0&&(J=void 0),M.key!==void 0&&(q=""+M.key),M)!F.call(M,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&M.ref===void 0||(V[he]=M[he]);var he=arguments.length-2;if(he===1)V.children=U;else if(1<he){for(var xe=Array(he),ve=0;ve<he;ve++)xe[ve]=arguments[ve+2];V.children=xe}return R(N.type,q,void 0,void 0,J,V)},Je.createContext=function(N){return N={$$typeof:o,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null},N.Provider=N,N.Consumer={$$typeof:s,_context:N},N},Je.createElement=function(N,M,U){var V,q={},J=null;if(M!=null)for(V in M.key!==void 0&&(J=""+M.key),M)F.call(M,V)&&V!=="key"&&V!=="__self"&&V!=="__source"&&(q[V]=M[V]);var he=arguments.length-2;if(he===1)q.children=U;else if(1<he){for(var xe=Array(he),ve=0;ve<he;ve++)xe[ve]=arguments[ve+2];q.children=xe}if(N&&N.defaultProps)for(V in he=N.defaultProps,he)q[V]===void 0&&(q[V]=he[V]);return R(N,J,void 0,void 0,null,q)},Je.createRef=function(){return{current:null}},Je.forwardRef=function(N){return{$$typeof:a,render:N}},Je.isValidElement=W,Je.lazy=function(N){return{$$typeof:u,_payload:{_status:-1,_result:N},_init:$}},Je.memo=function(N,M){return{$$typeof:l,type:N,compare:M===void 0?null:M}},Je.startTransition=function(N){var M=x.T,U={};x.T=U;try{var V=N(),q=x.S;q!==null&&q(U,V),typeof V=="object"&&V!==null&&typeof V.then=="function"&&V.then(Y,Q)}catch(J){Q(J)}finally{x.T=M}},Je.unstable_useCacheRefresh=function(){return x.H.useCacheRefresh()},Je.use=function(N){return x.H.use(N)},Je.useActionState=function(N,M,U){return x.H.useActionState(N,M,U)},Je.useCallback=function(N,M){return x.H.useCallback(N,M)},Je.useContext=function(N){return x.H.useContext(N)},Je.useDebugValue=function(){},Je.useDeferredValue=function(N,M){return x.H.useDeferredValue(N,M)},Je.useEffect=function(N,M,U){var V=x.H;if(typeof U=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return V.useEffect(N,M)},Je.useId=function(){return x.H.useId()},Je.useImperativeHandle=function(N,M,U){return x.H.useImperativeHandle(N,M,U)},Je.useInsertionEffect=function(N,M){return x.H.useInsertionEffect(N,M)},Je.useLayoutEffect=function(N,M){return x.H.useLayoutEffect(N,M)},Je.useMemo=function(N,M){return x.H.useMemo(N,M)},Je.useOptimistic=function(N,M){return x.H.useOptimistic(N,M)},Je.useReducer=function(N,M,U){return x.H.useReducer(N,M,U)},Je.useRef=function(N){return x.H.useRef(N)},Je.useState=function(N){return x.H.useState(N)},Je.useSyncExternalStore=function(N,M,U){return x.H.useSyncExternalStore(N,M,U)},Je.useTransition=function(){return x.H.useTransition()},Je.version="19.1.1",Je}var Mm;function $S(){return Mm||(Mm=1,_f.exports=PS()),_f.exports}$S();/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Um="0123456789abcdef",Fm=[],mc=[];for(let t=0;t<256;t++)Fm[t]=Um[t>>4&15]+Um[t&15],t<16&&(t<10?mc[48+t]=t:mc[87+t]=t);const Pm=t=>{const e=t.length;let r="",n=0;for(;n<e;)r+=Fm[t[n++]];return r},gc=t=>{const e=t.length>>1,r=e<<1,n=new Uint8Array(e);let i=0,s=0;for(;s<r;)n[i++]=mc[t.charCodeAt(s++)]<<4|mc[t.charCodeAt(s++)];return n};for(var $m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BS=typeof Uint8Array>"u"?[]:new Uint8Array(256),yc=0;yc<$m.length;yc++)BS[$m.charCodeAt(yc)]=yc;new TextDecoder,new TextEncoder;const Bm=typeof window<"u"?window:self,Dm=Bm.crypto||Bm.msCrypto||{};Dm.subtle||Dm.webkitSubtle;const Gs=globalThis||void 0||self,Tn=()=>new Map,vf=t=>{const e=Tn();return t.forEach((r,n)=>{e.set(n,r)}),e},Li=(t,e,r)=>{let n=t.get(e);return n===void 0&&t.set(e,n=r()),n},DS=(t,e)=>{const r=[];for(const[n,i]of t)r.push(e(i,n));return r},jS=(t,e)=>{for(const[r,n]of t)if(e(n,r))return!0;return!1},Ks=()=>new Set,Ef=t=>t[t.length-1],zS=(t,e)=>{for(let r=0;r<e.length;r++)t.push(e[r])},is=Array.from,WS=Array.isArray;class HS{constructor(){this._observers=Tn()}on(e,r){return Li(this._observers,e,Ks).add(r),r}once(e,r){const n=(...i)=>{this.off(e,n),r(...i)};this.on(e,n)}off(e,r){const n=this._observers.get(e);n!==void 0&&(n.delete(r),n.size===0&&this._observers.delete(e))}emit(e,r){return is((this._observers.get(e)||Tn()).values()).forEach(n=>n(...r))}destroy(){this._observers=Tn()}}const Mi=Math.floor,_c=Math.abs,jm=(t,e)=>t<e?t:e,ss=(t,e)=>t>e?t:e,zm=t=>t!==0?t<0:1/t<0,Wm=1,Hm=2,kf=4,xf=8,Xo=32,hi=64,Vr=128,bc=31,Af=63,os=127,GS=2147483647,Gm=Number.MAX_SAFE_INTEGER,KS=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Mi(t)===t),qS=t=>t.toLowerCase(),YS=/^\s*/g,VS=t=>t.replace(YS,""),XS=/([A-Z])/g,Km=(t,e)=>VS(t.replace(XS,r=>`${e}${qS(r)}`)),ZS=t=>{const e=unescape(encodeURIComponent(t)),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.codePointAt(i);return n},Zo=typeof TextEncoder<"u"?new TextEncoder:null,JS=Zo?t=>Zo.encode(t):ZS;let Jo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Jo&&Jo.decode(new Uint8Array).length===1&&(Jo=null);class Qo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const wc=()=>new Qo,QS=t=>{let e=t.cpos;for(let r=0;r<t.bufs.length;r++)e+=t.bufs[r].length;return e},Wn=t=>{const e=new Uint8Array(QS(t));let r=0;for(let n=0;n<t.bufs.length;n++){const i=t.bufs[n];e.set(i,r),r+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),r),e},eR=(t,e)=>{const r=t.cbuf.length;r-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(ss(r,e)*2),t.cpos=0)},nr=(t,e)=>{const r=t.cbuf.length;t.cpos===r&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(r*2),t.cpos=0),t.cbuf[t.cpos++]=e},Tf=nr,ft=(t,e)=>{for(;e>os;)nr(t,Vr|os&e),e=Mi(e/128);nr(t,os&e)},Sf=(t,e)=>{const r=zm(e);for(r&&(e=-e),nr(t,(e>Af?Vr:0)|(r?hi:0)|Af&e),e=Mi(e/64);e>0;)nr(t,(e>os?Vr:0)|os&e),e=Mi(e/128)},Rf=new Uint8Array(3e4),tR=Rf.length/3,rR=(t,e)=>{if(e.length<tR){const r=Zo.encodeInto(e,Rf).written||0;ft(t,r);for(let n=0;n<r;n++)nr(t,Rf[n])}else Xr(t,JS(e))},nR=(t,e)=>{const r=unescape(encodeURIComponent(e)),n=r.length;ft(t,n);for(let i=0;i<n;i++)nr(t,r.codePointAt(i))},qs=Zo&&Zo.encodeInto?rR:nR,vc=(t,e)=>{const r=t.cbuf.length,n=t.cpos,i=jm(r-n,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),n),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ss(r*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Xr=(t,e)=>{ft(t,e.byteLength),vc(t,e)},Of=(t,e)=>{eR(t,e);const r=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,r},iR=(t,e)=>Of(t,4).setFloat32(0,e,!1),sR=(t,e)=>Of(t,8).setFloat64(0,e,!1),oR=(t,e)=>Of(t,8).setBigInt64(0,e,!1),qm=new DataView(new ArrayBuffer(4)),aR=t=>(qm.setFloat32(0,t),qm.getFloat32(0)===t),ea=(t,e)=>{switch(typeof e){case"string":nr(t,119),qs(t,e);break;case"number":KS(e)&&_c(e)<=GS?(nr(t,125),Sf(t,e)):aR(e)?(nr(t,124),iR(t,e)):(nr(t,123),sR(t,e));break;case"bigint":nr(t,122),oR(t,e);break;case"object":if(e===null)nr(t,126);else if(WS(e)){nr(t,117),ft(t,e.length);for(let r=0;r<e.length;r++)ea(t,e[r])}else if(e instanceof Uint8Array)nr(t,116),Xr(t,e);else{nr(t,118);const r=Object.keys(e);ft(t,r.length);for(let n=0;n<r.length;n++){const i=r[n];qs(t,i),ea(t,e[i])}}break;case"boolean":nr(t,e?120:121);break;default:nr(t,127)}};class Ym extends Qo{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ft(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Vm=t=>{t.count>0&&(Sf(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ft(t.encoder,t.count-2))};class Ec{constructor(){this.encoder=new Qo,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Vm(this),this.count=1,this.s=e)}toUint8Array(){return Vm(this),Wn(this.encoder)}}const Xm=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Sf(t.encoder,e),t.count>1&&ft(t.encoder,t.count-2)}};class If{constructor(){this.encoder=new Qo,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Xm(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Xm(this),Wn(this.encoder)}}class cR{constructor(){this.sarr=[],this.s="",this.lensE=new Ec}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Qo;return this.sarr.push(this.s),this.s="",qs(e,this.sarr.join("")),vc(e,this.lensE.toUint8Array()),Wn(e)}}const Ui=t=>new Error(t),Hn=()=>{throw Ui("Method unimplemented")},Gn=()=>{throw Ui("Unexpected case")},Zm=Ui("Unexpected end of array"),Jm=Ui("Integer out of Range");class kc{constructor(e){this.arr=e,this.pos=0}}const Ys=t=>new kc(t),lR=t=>t.pos!==t.arr.length,uR=(t,e)=>{const r=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,r},Zr=t=>uR(t,tt(t)),Vs=t=>t.arr[t.pos++],tt=t=>{let e=0,r=1;const n=t.arr.length;for(;t.pos<n;){const i=t.arr[t.pos++];if(e=e+(i&os)*r,r*=128,i<Vr)return e;if(e>Gm)throw Jm}throw Zm},Nf=t=>{let e=t.arr[t.pos++],r=e&Af,n=64;const i=(e&hi)>0?-1:1;if((e&Vr)===0)return i*r;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],r=r+(e&os)*n,n*=128,e<Vr)return i*r;if(r>Gm)throw Jm}throw Zm},Xs=Jo?t=>Jo.decode(Zr(t)):t=>{let e=tt(t);if(e===0)return"";{let r=String.fromCodePoint(Vs(t));if(--e<100)for(;e--;)r+=String.fromCodePoint(Vs(t));else for(;e>0;){const n=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+n);t.pos+=n,r+=String.fromCodePoint.apply(null,i),e-=n}return decodeURIComponent(escape(r))}},Cf=(t,e)=>{const r=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,r},fR=[t=>{},t=>null,Nf,t=>Cf(t,4).getFloat32(0,!1),t=>Cf(t,8).getFloat64(0,!1),t=>Cf(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Xs,t=>{const e=tt(t),r={};for(let n=0;n<e;n++){const i=Xs(t);r[i]=ta(t)}return r},t=>{const e=tt(t),r=[];for(let n=0;n<e;n++)r.push(ta(t));return r},Zr],ta=t=>fR[127-Vs(t)](t);class Qm extends kc{constructor(e,r){super(e),this.reader=r,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),lR(this)?this.count=tt(this)+1:this.count=-1),this.count--,this.s}}class xc extends kc{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Nf(this);const e=zm(this.s);this.count=1,e&&(this.s=-this.s,this.count=tt(this)+2)}return this.count--,this.s}}class Lf extends kc{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Nf(this),r=e&1;this.diff=Mi(e/2),this.count=1,r&&(this.count=tt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class hR{constructor(e){this.decoder=new xc(e),this.str=Xs(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),r=this.str.slice(this.spos,e);return this.spos=e,r}}const dR=crypto.getRandomValues.bind(crypto),eg=()=>dR(new Uint32Array(1))[0],pR="10000000-1000-4000-8000"+-1e11,mR=()=>pR.replace(/[018]/g,t=>(t^eg()&15>>t/4).toString(16)),tg=t=>new Promise(t);Promise.all.bind(Promise);var rg={},Ac={};Ac.byteLength=_R,Ac.toByteArray=wR,Ac.fromByteArray=kR;for(var Kn=[],ln=[],gR=typeof Uint8Array<"u"?Uint8Array:Array,Mf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Zs=0,yR=Mf.length;Zs<yR;++Zs)Kn[Zs]=Mf[Zs],ln[Mf.charCodeAt(Zs)]=Zs;ln[45]=62,ln[95]=63;function ng(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function _R(t){var e=ng(t),r=e[0],n=e[1];return(r+n)*3/4-n}function bR(t,e,r){return(e+r)*3/4-r}function wR(t){var e,r=ng(t),n=r[0],i=r[1],s=new gR(bR(t,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=ln[t.charCodeAt(c)]<<18|ln[t.charCodeAt(c+1)]<<12|ln[t.charCodeAt(c+2)]<<6|ln[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=ln[t.charCodeAt(c)]<<2|ln[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=ln[t.charCodeAt(c)]<<10|ln[t.charCodeAt(c+1)]<<4|ln[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function vR(t){return Kn[t>>18&63]+Kn[t>>12&63]+Kn[t>>6&63]+Kn[t&63]}function ER(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(vR(n));return i.join("")}function kR(t){for(var e,r=t.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(ER(t,o,o+s>a?a:o+s));return n===1?(e=t[r-1],i.push(Kn[e>>2]+Kn[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Kn[e>>10]+Kn[e>>4&63]+Kn[e<<2&63]+"=")),i.join("")}var Uf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Uf.read=function(t,e,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+t[e+h],h+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(f?-1:1)*o*Math.pow(2,s-n)},Uf.write=function(t,e,r,n,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,m=n?1:-1,p=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=d/c:e+=d*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+f]=a&255,f+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[r+f]=o&255,f+=m,o/=256,l-=8);t[r+f-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Ac,r=Uf,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=x,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const L=new s(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,s.prototype),Object.setPrototypeOf(L,_),L.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(L){if(L>i)throw new RangeError('The value "'+L+'" is invalid for option "size"');const _=new s(L);return Object.setPrototypeOf(_,u.prototype),_}function u(L,_,E){if(typeof L=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(L)}return h(L,_,E)}u.poolSize=8192;function h(L,_,E){if(typeof L=="string")return p(L,_);if(o.isView(L))return y(L);if(L==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof L);if(be(L,o)||L&&be(L.buffer,o)||typeof a<"u"&&(be(L,a)||L&&be(L.buffer,a)))return b(L,_,E);if(typeof L=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const B=L.valueOf&&L.valueOf();if(B!=null&&B!==L)return u.from(B,_,E);const X=A(L);if(X)return X;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof L[Symbol.toPrimitive]=="function")return u.from(L[Symbol.toPrimitive]("string"),_,E);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof L)}u.from=function(L,_,E){return h(L,_,E)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(L){if(typeof L!="number")throw new TypeError('"size" argument must be of type number');if(L<0)throw new RangeError('The value "'+L+'" is invalid for option "size"')}function f(L,_,E){return d(L),L<=0?l(L):_!==void 0?typeof E=="string"?l(L).fill(_,E):l(L).fill(_):l(L)}u.alloc=function(L,_,E){return f(L,_,E)};function m(L){return d(L),l(L<0?0:S(L)|0)}u.allocUnsafe=function(L){return m(L)},u.allocUnsafeSlow=function(L){return m(L)};function p(L,_){if((typeof _!="string"||_==="")&&(_="utf8"),!u.isEncoding(_))throw new TypeError("Unknown encoding: "+_);const E=F(L,_)|0;let B=l(E);const X=B.write(L,_);return X!==E&&(B=B.slice(0,X)),B}function g(L){const _=L.length<0?0:S(L.length)|0,E=l(_);for(let B=0;B<_;B+=1)E[B]=L[B]&255;return E}function y(L){if(be(L,s)){const _=new s(L);return b(_.buffer,_.byteOffset,_.byteLength)}return g(L)}function b(L,_,E){if(_<0||L.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(L.byteLength<_+(E||0))throw new RangeError('"length" is outside of buffer bounds');let B;return _===void 0&&E===void 0?B=new s(L):E===void 0?B=new s(L,_):B=new s(L,_,E),Object.setPrototypeOf(B,u.prototype),B}function A(L){if(u.isBuffer(L)){const _=S(L.length)|0,E=l(_);return E.length===0||L.copy(E,0,0,_),E}if(L.length!==void 0)return typeof L.length!="number"||$e(L.length)?l(0):g(L);if(L.type==="Buffer"&&Array.isArray(L.data))return g(L.data)}function S(L){if(L>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return L|0}function x(L){return+L!=L&&(L=0),u.alloc(+L)}u.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==u.prototype},u.compare=function(_,E){if(be(_,s)&&(_=u.from(_,_.offset,_.byteLength)),be(E,s)&&(E=u.from(E,E.offset,E.byteLength)),!u.isBuffer(_)||!u.isBuffer(E))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===E)return 0;let B=_.length,X=E.length;for(let ce=0,H=Math.min(B,X);ce<H;++ce)if(_[ce]!==E[ce]){B=_[ce],X=E[ce];break}return B<X?-1:X<B?1:0},u.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(_,E){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return u.alloc(0);let B;if(E===void 0)for(E=0,B=0;B<_.length;++B)E+=_[B].length;const X=u.allocUnsafe(E);let ce=0;for(B=0;B<_.length;++B){let H=_[B];if(be(H,s))ce+H.length>X.length?(u.isBuffer(H)||(H=u.from(H)),H.copy(X,ce)):s.prototype.set.call(X,H,ce);else if(u.isBuffer(H))H.copy(X,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=H.length}return X};function F(L,_){if(u.isBuffer(L))return L.length;if(o.isView(L)||be(L,o))return L.byteLength;if(typeof L!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof L);const E=L.length,B=arguments.length>2&&arguments[2]===!0;if(!B&&E===0)return 0;let X=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return E;case"utf8":case"utf-8":return pe(L).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E*2;case"hex":return E>>>1;case"base64":return _e(L).length;default:if(X)return B?-1:pe(L).length;_=(""+_).toLowerCase(),X=!0}}u.byteLength=F;function R(L,_,E){let B=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((E===void 0||E>this.length)&&(E=this.length),E<=0)||(E>>>=0,_>>>=0,E<=_))return"";for(L||(L="utf8");;)switch(L){case"hex":return U(this,_,E);case"utf8":case"utf-8":return $(this,_,E);case"ascii":return N(this,_,E);case"latin1":case"binary":return M(this,_,E);case"base64":return z(this,_,E);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,_,E);default:if(B)throw new TypeError("Unknown encoding: "+L);L=(L+"").toLowerCase(),B=!0}}u.prototype._isBuffer=!0;function P(L,_,E){const B=L[_];L[_]=L[E],L[E]=B}u.prototype.swap16=function(){const _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let E=0;E<_;E+=2)P(this,E,E+1);return this},u.prototype.swap32=function(){const _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let E=0;E<_;E+=4)P(this,E,E+3),P(this,E+1,E+2);return this},u.prototype.swap64=function(){const _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let E=0;E<_;E+=8)P(this,E,E+7),P(this,E+1,E+6),P(this,E+2,E+5),P(this,E+3,E+4);return this},u.prototype.toString=function(){const _=this.length;return _===0?"":arguments.length===0?$(this,0,_):R.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(_){if(!u.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:u.compare(this,_)===0},u.prototype.inspect=function(){let _="";const E=t.INSPECT_MAX_BYTES;return _=this.toString("hex",0,E).replace(/(.{2})/g,"$1 ").trim(),this.length>E&&(_+=" ... "),"<Buffer "+_+">"},n&&(u.prototype[n]=u.prototype.inspect),u.prototype.compare=function(_,E,B,X,ce){if(be(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(E===void 0&&(E=0),B===void 0&&(B=_?_.length:0),X===void 0&&(X=0),ce===void 0&&(ce=this.length),E<0||B>_.length||X<0||ce>this.length)throw new RangeError("out of range index");if(X>=ce&&E>=B)return 0;if(X>=ce)return-1;if(E>=B)return 1;if(E>>>=0,B>>>=0,X>>>=0,ce>>>=0,this===_)return 0;let H=ce-X,re=B-E;const ze=Math.min(H,re),Ge=this.slice(X,ce),qe=_.slice(E,B);for(let Ce=0;Ce<ze;++Ce)if(Ge[Ce]!==qe[Ce]){H=Ge[Ce],re=qe[Ce];break}return H<re?-1:re<H?1:0};function W(L,_,E,B,X){if(L.length===0)return-1;if(typeof E=="string"?(B=E,E=0):E>2147483647?E=2147483647:E<-2147483648&&(E=-2147483648),E=+E,$e(E)&&(E=X?0:L.length-1),E<0&&(E=L.length+E),E>=L.length){if(X)return-1;E=L.length-1}else if(E<0)if(X)E=0;else return-1;if(typeof _=="string"&&(_=u.from(_,B)),u.isBuffer(_))return _.length===0?-1:D(L,_,E,B,X);if(typeof _=="number")return _=_&255,typeof s.prototype.indexOf=="function"?X?s.prototype.indexOf.call(L,_,E):s.prototype.lastIndexOf.call(L,_,E):D(L,[_],E,B,X);throw new TypeError("val must be string, number or Buffer")}function D(L,_,E,B,X){let ce=1,H=L.length,re=_.length;if(B!==void 0&&(B=String(B).toLowerCase(),B==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(L.length<2||_.length<2)return-1;ce=2,H/=2,re/=2,E/=2}function ze(qe,Ce){return ce===1?qe[Ce]:qe.readUInt16BE(Ce*ce)}let Ge;if(X){let qe=-1;for(Ge=E;Ge<H;Ge++)if(ze(L,Ge)===ze(_,qe===-1?0:Ge-qe)){if(qe===-1&&(qe=Ge),Ge-qe+1===re)return qe*ce}else qe!==-1&&(Ge-=Ge-qe),qe=-1}else for(E+re>H&&(E=H-re),Ge=E;Ge>=0;Ge--){let qe=!0;for(let Ce=0;Ce<re;Ce++)if(ze(L,Ge+Ce)!==ze(_,Ce)){qe=!1;break}if(qe)return Ge}return-1}u.prototype.includes=function(_,E,B){return this.indexOf(_,E,B)!==-1},u.prototype.indexOf=function(_,E,B){return W(this,_,E,B,!0)},u.prototype.lastIndexOf=function(_,E,B){return W(this,_,E,B,!1)};function G(L,_,E,B){E=Number(E)||0;const X=L.length-E;B?(B=Number(B),B>X&&(B=X)):B=X;const ce=_.length;B>ce/2&&(B=ce/2);let H;for(H=0;H<B;++H){const re=parseInt(_.substr(H*2,2),16);if($e(re))return H;L[E+H]=re}return H}function O(L,_,E,B){return Oe(pe(_,L.length-E),L,E,B)}function I(L,_,E,B){return Oe(me(_),L,E,B)}function v(L,_,E,B){return Oe(_e(_),L,E,B)}function C(L,_,E,B){return Oe(se(_,L.length-E),L,E,B)}u.prototype.write=function(_,E,B,X){if(E===void 0)X="utf8",B=this.length,E=0;else if(B===void 0&&typeof E=="string")X=E,B=this.length,E=0;else if(isFinite(E))E=E>>>0,isFinite(B)?(B=B>>>0,X===void 0&&(X="utf8")):(X=B,B=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-E;if((B===void 0||B>ce)&&(B=ce),_.length>0&&(B<0||E<0)||E>this.length)throw new RangeError("Attempt to write outside buffer bounds");X||(X="utf8");let H=!1;for(;;)switch(X){case"hex":return G(this,_,E,B);case"utf8":case"utf-8":return O(this,_,E,B);case"ascii":case"latin1":case"binary":return I(this,_,E,B);case"base64":return v(this,_,E,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,_,E,B);default:if(H)throw new TypeError("Unknown encoding: "+X);X=(""+X).toLowerCase(),H=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function z(L,_,E){return _===0&&E===L.length?e.fromByteArray(L):e.fromByteArray(L.slice(_,E))}function $(L,_,E){E=Math.min(L.length,E);const B=[];let X=_;for(;X<E;){const ce=L[X];let H=null,re=ce>239?4:ce>223?3:ce>191?2:1;if(X+re<=E){let ze,Ge,qe,Ce;switch(re){case 1:ce<128&&(H=ce);break;case 2:ze=L[X+1],(ze&192)===128&&(Ce=(ce&31)<<6|ze&63,Ce>127&&(H=Ce));break;case 3:ze=L[X+1],Ge=L[X+2],(ze&192)===128&&(Ge&192)===128&&(Ce=(ce&15)<<12|(ze&63)<<6|Ge&63,Ce>2047&&(Ce<55296||Ce>57343)&&(H=Ce));break;case 4:ze=L[X+1],Ge=L[X+2],qe=L[X+3],(ze&192)===128&&(Ge&192)===128&&(qe&192)===128&&(Ce=(ce&15)<<18|(ze&63)<<12|(Ge&63)<<6|qe&63,Ce>65535&&Ce<1114112&&(H=Ce))}}H===null?(H=65533,re=1):H>65535&&(H-=65536,B.push(H>>>10&1023|55296),H=56320|H&1023),B.push(H),X+=re}return Y(B)}const Q=4096;function Y(L){const _=L.length;if(_<=Q)return String.fromCharCode.apply(String,L);let E="",B=0;for(;B<_;)E+=String.fromCharCode.apply(String,L.slice(B,B+=Q));return E}function N(L,_,E){let B="";E=Math.min(L.length,E);for(let X=_;X<E;++X)B+=String.fromCharCode(L[X]&127);return B}function M(L,_,E){let B="";E=Math.min(L.length,E);for(let X=_;X<E;++X)B+=String.fromCharCode(L[X]);return B}function U(L,_,E){const B=L.length;(!_||_<0)&&(_=0),(!E||E<0||E>B)&&(E=B);let X="";for(let ce=_;ce<E;++ce)X+=pt[L[ce]];return X}function V(L,_,E){const B=L.slice(_,E);let X="";for(let ce=0;ce<B.length-1;ce+=2)X+=String.fromCharCode(B[ce]+B[ce+1]*256);return X}u.prototype.slice=function(_,E){const B=this.length;_=~~_,E=E===void 0?B:~~E,_<0?(_+=B,_<0&&(_=0)):_>B&&(_=B),E<0?(E+=B,E<0&&(E=0)):E>B&&(E=B),E<_&&(E=_);const X=this.subarray(_,E);return Object.setPrototypeOf(X,u.prototype),X};function q(L,_,E){if(L%1!==0||L<0)throw new RangeError("offset is not uint");if(L+_>E)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(_,E,B){_=_>>>0,E=E>>>0,B||q(_,E,this.length);let X=this[_],ce=1,H=0;for(;++H<E&&(ce*=256);)X+=this[_+H]*ce;return X},u.prototype.readUintBE=u.prototype.readUIntBE=function(_,E,B){_=_>>>0,E=E>>>0,B||q(_,E,this.length);let X=this[_+--E],ce=1;for(;E>0&&(ce*=256);)X+=this[_+--E]*ce;return X},u.prototype.readUint8=u.prototype.readUInt8=function(_,E){return _=_>>>0,E||q(_,1,this.length),this[_]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(_,E){return _=_>>>0,E||q(_,2,this.length),this[_]|this[_+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(_,E){return _=_>>>0,E||q(_,2,this.length),this[_]<<8|this[_+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(_,E){return _=_>>>0,E||q(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(_,E){return _=_>>>0,E||q(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},u.prototype.readBigUInt64LE=Ze(function(_){_=_>>>0,ie(_,"offset");const E=this[_],B=this[_+7];(E===void 0||B===void 0)&&K(_,this.length-8);const X=E+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,ce=this[++_]+this[++_]*2**8+this[++_]*2**16+B*2**24;return BigInt(X)+(BigInt(ce)<<BigInt(32))}),u.prototype.readBigUInt64BE=Ze(function(_){_=_>>>0,ie(_,"offset");const E=this[_],B=this[_+7];(E===void 0||B===void 0)&&K(_,this.length-8);const X=E*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],ce=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+B;return(BigInt(X)<<BigInt(32))+BigInt(ce)}),u.prototype.readIntLE=function(_,E,B){_=_>>>0,E=E>>>0,B||q(_,E,this.length);let X=this[_],ce=1,H=0;for(;++H<E&&(ce*=256);)X+=this[_+H]*ce;return ce*=128,X>=ce&&(X-=Math.pow(2,8*E)),X},u.prototype.readIntBE=function(_,E,B){_=_>>>0,E=E>>>0,B||q(_,E,this.length);let X=E,ce=1,H=this[_+--X];for(;X>0&&(ce*=256);)H+=this[_+--X]*ce;return ce*=128,H>=ce&&(H-=Math.pow(2,8*E)),H},u.prototype.readInt8=function(_,E){return _=_>>>0,E||q(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},u.prototype.readInt16LE=function(_,E){_=_>>>0,E||q(_,2,this.length);const B=this[_]|this[_+1]<<8;return B&32768?B|4294901760:B},u.prototype.readInt16BE=function(_,E){_=_>>>0,E||q(_,2,this.length);const B=this[_+1]|this[_]<<8;return B&32768?B|4294901760:B},u.prototype.readInt32LE=function(_,E){return _=_>>>0,E||q(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},u.prototype.readInt32BE=function(_,E){return _=_>>>0,E||q(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},u.prototype.readBigInt64LE=Ze(function(_){_=_>>>0,ie(_,"offset");const E=this[_],B=this[_+7];(E===void 0||B===void 0)&&K(_,this.length-8);const X=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(B<<24);return(BigInt(X)<<BigInt(32))+BigInt(E+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),u.prototype.readBigInt64BE=Ze(function(_){_=_>>>0,ie(_,"offset");const E=this[_],B=this[_+7];(E===void 0||B===void 0)&&K(_,this.length-8);const X=(E<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(X)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+B)}),u.prototype.readFloatLE=function(_,E){return _=_>>>0,E||q(_,4,this.length),r.read(this,_,!0,23,4)},u.prototype.readFloatBE=function(_,E){return _=_>>>0,E||q(_,4,this.length),r.read(this,_,!1,23,4)},u.prototype.readDoubleLE=function(_,E){return _=_>>>0,E||q(_,8,this.length),r.read(this,_,!0,52,8)},u.prototype.readDoubleBE=function(_,E){return _=_>>>0,E||q(_,8,this.length),r.read(this,_,!1,52,8)};function J(L,_,E,B,X,ce){if(!u.isBuffer(L))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>X||_<ce)throw new RangeError('"value" argument is out of bounds');if(E+B>L.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(_,E,B,X){if(_=+_,E=E>>>0,B=B>>>0,!X){const re=Math.pow(2,8*B)-1;J(this,_,E,B,re,0)}let ce=1,H=0;for(this[E]=_&255;++H<B&&(ce*=256);)this[E+H]=_/ce&255;return E+B},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(_,E,B,X){if(_=+_,E=E>>>0,B=B>>>0,!X){const re=Math.pow(2,8*B)-1;J(this,_,E,B,re,0)}let ce=B-1,H=1;for(this[E+ce]=_&255;--ce>=0&&(H*=256);)this[E+ce]=_/H&255;return E+B},u.prototype.writeUint8=u.prototype.writeUInt8=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,1,255,0),this[E]=_&255,E+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,2,65535,0),this[E]=_&255,this[E+1]=_>>>8,E+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,2,65535,0),this[E]=_>>>8,this[E+1]=_&255,E+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,4,4294967295,0),this[E+3]=_>>>24,this[E+2]=_>>>16,this[E+1]=_>>>8,this[E]=_&255,E+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,4,4294967295,0),this[E]=_>>>24,this[E+1]=_>>>16,this[E+2]=_>>>8,this[E+3]=_&255,E+4};function he(L,_,E,B,X){fe(_,B,X,L,E,7);let ce=Number(_&BigInt(4294967295));L[E++]=ce,ce=ce>>8,L[E++]=ce,ce=ce>>8,L[E++]=ce,ce=ce>>8,L[E++]=ce;let H=Number(_>>BigInt(32)&BigInt(4294967295));return L[E++]=H,H=H>>8,L[E++]=H,H=H>>8,L[E++]=H,H=H>>8,L[E++]=H,E}function xe(L,_,E,B,X){fe(_,B,X,L,E,7);let ce=Number(_&BigInt(4294967295));L[E+7]=ce,ce=ce>>8,L[E+6]=ce,ce=ce>>8,L[E+5]=ce,ce=ce>>8,L[E+4]=ce;let H=Number(_>>BigInt(32)&BigInt(4294967295));return L[E+3]=H,H=H>>8,L[E+2]=H,H=H>>8,L[E+1]=H,H=H>>8,L[E]=H,E+8}u.prototype.writeBigUInt64LE=Ze(function(_,E=0){return he(this,_,E,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Ze(function(_,E=0){return xe(this,_,E,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(_,E,B,X){if(_=+_,E=E>>>0,!X){const ze=Math.pow(2,8*B-1);J(this,_,E,B,ze-1,-ze)}let ce=0,H=1,re=0;for(this[E]=_&255;++ce<B&&(H*=256);)_<0&&re===0&&this[E+ce-1]!==0&&(re=1),this[E+ce]=(_/H>>0)-re&255;return E+B},u.prototype.writeIntBE=function(_,E,B,X){if(_=+_,E=E>>>0,!X){const ze=Math.pow(2,8*B-1);J(this,_,E,B,ze-1,-ze)}let ce=B-1,H=1,re=0;for(this[E+ce]=_&255;--ce>=0&&(H*=256);)_<0&&re===0&&this[E+ce+1]!==0&&(re=1),this[E+ce]=(_/H>>0)-re&255;return E+B},u.prototype.writeInt8=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,1,127,-128),_<0&&(_=255+_+1),this[E]=_&255,E+1},u.prototype.writeInt16LE=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,2,32767,-32768),this[E]=_&255,this[E+1]=_>>>8,E+2},u.prototype.writeInt16BE=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,2,32767,-32768),this[E]=_>>>8,this[E+1]=_&255,E+2},u.prototype.writeInt32LE=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,4,2147483647,-2147483648),this[E]=_&255,this[E+1]=_>>>8,this[E+2]=_>>>16,this[E+3]=_>>>24,E+4},u.prototype.writeInt32BE=function(_,E,B){return _=+_,E=E>>>0,B||J(this,_,E,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[E]=_>>>24,this[E+1]=_>>>16,this[E+2]=_>>>8,this[E+3]=_&255,E+4},u.prototype.writeBigInt64LE=Ze(function(_,E=0){return he(this,_,E,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Ze(function(_,E=0){return xe(this,_,E,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ve(L,_,E,B,X,ce){if(E+B>L.length)throw new RangeError("Index out of range");if(E<0)throw new RangeError("Index out of range")}function ke(L,_,E,B,X){return _=+_,E=E>>>0,X||ve(L,_,E,4),r.write(L,_,E,B,23,4),E+4}u.prototype.writeFloatLE=function(_,E,B){return ke(this,_,E,!0,B)},u.prototype.writeFloatBE=function(_,E,B){return ke(this,_,E,!1,B)};function Ae(L,_,E,B,X){return _=+_,E=E>>>0,X||ve(L,_,E,8),r.write(L,_,E,B,52,8),E+8}u.prototype.writeDoubleLE=function(_,E,B){return Ae(this,_,E,!0,B)},u.prototype.writeDoubleBE=function(_,E,B){return Ae(this,_,E,!1,B)},u.prototype.copy=function(_,E,B,X){if(!u.isBuffer(_))throw new TypeError("argument should be a Buffer");if(B||(B=0),!X&&X!==0&&(X=this.length),E>=_.length&&(E=_.length),E||(E=0),X>0&&X<B&&(X=B),X===B||_.length===0||this.length===0)return 0;if(E<0)throw new RangeError("targetStart out of bounds");if(B<0||B>=this.length)throw new RangeError("Index out of range");if(X<0)throw new RangeError("sourceEnd out of bounds");X>this.length&&(X=this.length),_.length-E<X-B&&(X=_.length-E+B);const ce=X-B;return this===_&&typeof s.prototype.copyWithin=="function"?this.copyWithin(E,B,X):s.prototype.set.call(_,this.subarray(B,X),E),ce},u.prototype.fill=function(_,E,B,X){if(typeof _=="string"){if(typeof E=="string"?(X=E,E=0,B=this.length):typeof B=="string"&&(X=B,B=this.length),X!==void 0&&typeof X!="string")throw new TypeError("encoding must be a string");if(typeof X=="string"&&!u.isEncoding(X))throw new TypeError("Unknown encoding: "+X);if(_.length===1){const H=_.charCodeAt(0);(X==="utf8"&&H<128||X==="latin1")&&(_=H)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(E<0||this.length<E||this.length<B)throw new RangeError("Out of range index");if(B<=E)return this;E=E>>>0,B=B===void 0?this.length:B>>>0,_||(_=0);let ce;if(typeof _=="number")for(ce=E;ce<B;++ce)this[ce]=_;else{const H=u.isBuffer(_)?_:u.from(_,X),re=H.length;if(re===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(ce=0;ce<B-E;++ce)this[ce+E]=H[ce%re]}return this};const Se={};function Le(L,_,E){Se[L]=class extends E{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${L}]`,this.stack,delete this.name}get code(){return L}set code(X){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:X,writable:!0})}toString(){return`${this.name} [${L}]: ${this.message}`}}}Le("ERR_BUFFER_OUT_OF_BOUNDS",function(L){return L?`${L} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Le("ERR_INVALID_ARG_TYPE",function(L,_){return`The "${L}" argument must be of type number. Received type ${typeof _}`},TypeError),Le("ERR_OUT_OF_RANGE",function(L,_,E){let B=`The value of "${L}" is out of range.`,X=E;return Number.isInteger(E)&&Math.abs(E)>2**32?X=je(String(E)):typeof E=="bigint"&&(X=String(E),(E>BigInt(2)**BigInt(32)||E<-(BigInt(2)**BigInt(32)))&&(X=je(X)),X+="n"),B+=` It must be ${_}. Received ${X}`,B},RangeError);function je(L){let _="",E=L.length;const B=L[0]==="-"?1:0;for(;E>=B+4;E-=3)_=`_${L.slice(E-3,E)}${_}`;return`${L.slice(0,E)}${_}`}function T(L,_,E){ie(_,"offset"),(L[_]===void 0||L[_+E]===void 0)&&K(_,L.length-(E+1))}function fe(L,_,E,B,X,ce){if(L>E||L<_){const H=typeof _=="bigint"?"n":"";let re;throw _===0||_===BigInt(0)?re=`>= 0${H} and < 2${H} ** ${(ce+1)*8}${H}`:re=`>= -(2${H} ** ${(ce+1)*8-1}${H}) and < 2 ** ${(ce+1)*8-1}${H}`,new Se.ERR_OUT_OF_RANGE("value",re,L)}T(B,X,ce)}function ie(L,_){if(typeof L!="number")throw new Se.ERR_INVALID_ARG_TYPE(_,"number",L)}function K(L,_,E){throw Math.floor(L)!==L?(ie(L,E),new Se.ERR_OUT_OF_RANGE("offset","an integer",L)):_<0?new Se.ERR_BUFFER_OUT_OF_BOUNDS:new Se.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${_}`,L)}const j=/[^+/0-9A-Za-z-_]/g;function ee(L){if(L=L.split("=")[0],L=L.trim().replace(j,""),L.length<2)return"";for(;L.length%4!==0;)L=L+"=";return L}function pe(L,_){_=_||1/0;let E;const B=L.length;let X=null;const ce=[];for(let H=0;H<B;++H){if(E=L.charCodeAt(H),E>55295&&E<57344){if(!X){if(E>56319){(_-=3)>-1&&ce.push(239,191,189);continue}else if(H+1===B){(_-=3)>-1&&ce.push(239,191,189);continue}X=E;continue}if(E<56320){(_-=3)>-1&&ce.push(239,191,189),X=E;continue}E=(X-55296<<10|E-56320)+65536}else X&&(_-=3)>-1&&ce.push(239,191,189);if(X=null,E<128){if((_-=1)<0)break;ce.push(E)}else if(E<2048){if((_-=2)<0)break;ce.push(E>>6|192,E&63|128)}else if(E<65536){if((_-=3)<0)break;ce.push(E>>12|224,E>>6&63|128,E&63|128)}else if(E<1114112){if((_-=4)<0)break;ce.push(E>>18|240,E>>12&63|128,E>>6&63|128,E&63|128)}else throw new Error("Invalid code point")}return ce}function me(L){const _=[];for(let E=0;E<L.length;++E)_.push(L.charCodeAt(E)&255);return _}function se(L,_){let E,B,X;const ce=[];for(let H=0;H<L.length&&!((_-=2)<0);++H)E=L.charCodeAt(H),B=E>>8,X=E%256,ce.push(X),ce.push(B);return ce}function _e(L){return e.toByteArray(ee(L))}function Oe(L,_,E,B){let X;for(X=0;X<B&&!(X+E>=_.length||X>=L.length);++X)_[X+E]=L[X];return X}function be(L,_){return L instanceof _||L!=null&&L.constructor!=null&&L.constructor.name!=null&&L.constructor.name===_.name}function $e(L){return L!==L}const pt=(function(){const L="0123456789abcdef",_=new Array(256);for(let E=0;E<16;++E){const B=E*16;for(let X=0;X<16;++X)_[B+X]=L[E]+L[X]}return _})();function Ze(L){return typeof BigInt>"u"?Yt:L}function Yt(){throw new Error("BigInt not supported")}})(rg);const Vt=rg.Buffer,ig=t=>t===void 0?null:t;class xR{constructor(){this.map=new Map}setItem(e,r){this.map.set(e,r)}getItem(e){return this.map.get(e)}}let sg=new xR,AR=!0;try{typeof localStorage<"u"&&localStorage&&(sg=localStorage,AR=!1)}catch{}const TR=sg,SR=Object.assign,RR=Object.keys,OR=(t,e)=>{for(const r in t)e(t[r],r)},og=t=>RR(t).length,IR=t=>{for(const e in t)return!1;return!0},NR=(t,e)=>{for(const r in t)if(!e(t[r],r))return!1;return!0},CR=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),LR=(t,e)=>t===e||og(t)===og(e)&&NR(t,(r,n)=>(r!==void 0||CR(e,n))&&e[n]===r),MR=Object.freeze,ag=t=>{for(const e in t){const r=t[e];(typeof r=="object"||typeof r=="function")&&ag(t[e])}return MR(t)},Ff=(t,e,r=0)=>{try{for(;r<t.length;r++)t[r](...e)}finally{r<t.length&&Ff(t,e,r+1)}},UR=t=>t,FR=(t,e)=>e.includes(t);var cg={};const ra=typeof An<"u"&&An.release&&/node|io\.js/.test(An.release.name)&&Object.prototype.toString.call(typeof An<"u"?An:0)==="[object process]";let qn;const PR=()=>{if(qn===void 0)if(ra){qn=Tn();const t=An.argv;let e=null;for(let r=0;r<t.length;r++){const n=t[r];n[0]==="-"?(e!==null&&qn.set(e,""),e=n):e!==null&&(qn.set(e,n),e=null)}e!==null&&qn.set(e,"")}else typeof location=="object"?(qn=Tn(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,r]=t.split("=");qn.set(`--${Km(e,"-")}`,r),qn.set(`-${Km(e,"-")}`,r)}})):qn=Tn();return qn},Pf=t=>PR().has(t),Tc=t=>ig(ra?cg[t.toUpperCase().replaceAll("-","_")]:TR.getItem(t)),lg=t=>Pf("--"+t)||Tc(t)!==null;lg("production");const $R=ra&&FR(cg.FORCE_COLOR,["true","1","2"])||!Pf("--no-colors")&&!lg("no-color")&&(!ra||An.stdout.isTTY)&&(!ra||Pf("--color")||Tc("COLORTERM")!==null||(Tc("TERM")||"").includes("color")),BR=t=>new Uint8Array(t),DR=t=>{const e=BR(t.byteLength);return e.set(t),e};class jR{constructor(e,r){this.left=e,this.right=r}}const di=(t,e)=>new jR(t,e);typeof DOMParser<"u"&&new DOMParser;const zR=t=>DS(t,(e,r)=>`${r}:${e};`).join(""),pi=Symbol,ug=pi(),fg=pi(),WR=pi(),HR=pi(),GR=pi(),hg=pi(),KR=pi(),$f=pi(),qR=pi(),YR=t=>{t.length===1&&t[0]?.constructor===Function&&(t=t[0]());const e=[],r=[];let n=0;for(;n<t.length;n++){const i=t[n];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(n>0&&r.push(e.join(""));n<t.length;n++){const i=t[n];i instanceof Symbol||r.push(i)}return r},VR={[ug]:di("font-weight","bold"),[fg]:di("font-weight","normal"),[WR]:di("color","blue"),[GR]:di("color","green"),[HR]:di("color","grey"),[hg]:di("color","red"),[KR]:di("color","purple"),[$f]:di("color","orange"),[qR]:di("color","black")},dg=$R?t=>{t.length===1&&t[0]?.constructor===Function&&(t=t[0]());const e=[],r=[],n=Tn();let i=[],s=0;for(;s<t.length;s++){const o=t[s],a=VR[o];if(a!==void 0)n.set(a.left,a.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const c=zR(n);s>0||c.length>0?(e.push("%c"+o),r.push(c)):e.push(o)}else break}}for(s>0&&(i=r,i.unshift(e.join("")));s<t.length;s++){const o=t[s];o instanceof Symbol||i.push(o)}return i}:YR,XR=(...t)=>{console.log(...dg(t)),pg.forEach(e=>e.print(t))},ZR=(...t)=>{console.warn(...dg(t)),t.unshift($f),pg.forEach(e=>e.print(t))},pg=Ks(),mg=t=>({[Symbol.iterator](){return this},next:t}),JR=(t,e)=>mg(()=>{let r;do r=t.next();while(!r.done&&!e(r.value));return r}),Bf=(t,e)=>mg(()=>{const{done:r,value:n}=t.next();return{done:r,value:r?void 0:e(n)}});class Df{constructor(e,r){this.clock=e,this.len=r}}class na{constructor(){this.clients=new Map}}const gg=(t,e,r)=>e.clients.forEach((n,i)=>{const s=t.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,l=n[c];c<n.length&&l.clock<a;l=n[++c])Cg(t,s,l.clock,l.len,r)}}),QR=(t,e)=>{let r=0,n=t.length-1;for(;r<=n;){const i=Mi((r+n)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;r=i+1}else n=i-1}return null},yg=(t,e)=>{const r=t.clients.get(e.client);return r!==void 0&&QR(r,e.clock)!==null},jf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let r,n;for(r=1,n=1;r<e.length;r++){const i=e[n-1],s=e[r];i.clock+i.len>=s.clock?i.len=ss(i.len,s.clock+s.len-i.clock):(n<r&&(e[n]=s),n++)}e.length=n})},eO=t=>{const e=new na;for(let r=0;r<t.length;r++)t[r].clients.forEach((n,i)=>{if(!e.clients.has(i)){const s=n.slice();for(let o=r+1;o<t.length;o++)zS(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return jf(e),e},Sc=(t,e,r,n)=>{Li(t.clients,e,()=>[]).push(new Df(r,n))},tO=()=>new na,rO=t=>{const e=tO();return t.clients.forEach((r,n)=>{const i=[];for(let s=0;s<r.length;s++){const o=r[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<r.length)for(let l=r[s+1];s+1<r.length&&l.deleted;l=r[++s+1])c+=l.length;i.push(new Df(a,c))}}i.length>0&&e.clients.set(n,i)}),e},Js=(t,e)=>{ft(t.restEncoder,e.clients.size),is(e.clients.entries()).sort((r,n)=>n[0]-r[0]).forEach(([r,n])=>{t.resetDsCurVal(),ft(t.restEncoder,r);const i=n.length;ft(t.restEncoder,i);for(let s=0;s<i;s++){const o=n[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},zf=t=>{const e=new na,r=tt(t.restDecoder);for(let n=0;n<r;n++){t.resetDsCurVal();const i=tt(t.restDecoder),s=tt(t.restDecoder);if(s>0){const o=Li(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Df(t.readDsClock(),t.readDsLen()))}}return e},_g=(t,e,r)=>{const n=new na,i=tt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=tt(t.restDecoder),a=tt(t.restDecoder),c=r.clients.get(o)||[],l=ir(r,o);for(let u=0;u<a;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&Sc(n,o,l,d-l);let f=Yn(c,h),m=c[f];for(!m.deleted&&m.id.clock<h&&(c.splice(f+1,0,jc(e,m,h-m.id.clock)),f++);f<c.length&&(m=c[f++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(f,0,jc(e,m,d-m.id.clock)),m.delete(e))}else Sc(n,o,h,d-h)}}if(n.clients.size>0){const s=new as;return ft(s.restEncoder,0),Js(s,n),s.toUint8Array()}return null},bg=eg;class Qs extends HS{constructor({guid:e=mR(),collectionid:r=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=bg(),this.guid=e,this.collectionid=r,this.share=new Map,this.store=new Og,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=tg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>tg(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&bt(e.parent.doc,r=>{r.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(is(this.subdocs).map(e=>e.guid))}transact(e,r=null){return bt(this,e,r)}get(e,r=yr){const n=Li(this.share,e,()=>{const s=new r;return s._integrate(this,null),s}),i=n.constructor;if(r!==yr&&i!==r)if(i===yr){const s=new r;s._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=n._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=n._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return n}getArray(e=""){return this.get(e,no)}getText(e=""){return this.get(e,mi)}getMap(e=""){return this.get(e,io)}getXmlElement(e=""){return this.get(e,oo)}getXmlFragment(e=""){return this.get(e,cs)}toJSON(){const e={};return this.share.forEach((r,n)=>{e[n]=r.toJSON()}),e}destroy(){this.isDestroyed=!0,is(this.subdocs).forEach(r=>r.destroy());const e=this._item;if(e!==null){this._item=null;const r=e.content;r.doc=new Qs({guid:this.guid,...r.opts,shouldLoad:!1}),r.doc._item=e,bt(e.parent.doc,n=>{const i=r.doc;e.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class wg{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return tt(this.restDecoder)}readDsLen(){return tt(this.restDecoder)}}class vg extends wg{readLeftID(){return ot(tt(this.restDecoder),tt(this.restDecoder))}readRightID(){return ot(tt(this.restDecoder),tt(this.restDecoder))}readClient(){return tt(this.restDecoder)}readInfo(){return Vs(this.restDecoder)}readString(){return Xs(this.restDecoder)}readParentInfo(){return tt(this.restDecoder)===1}readTypeRef(){return tt(this.restDecoder)}readLen(){return tt(this.restDecoder)}readAny(){return ta(this.restDecoder)}readBuf(){return DR(Zr(this.restDecoder))}readJSON(){return JSON.parse(Xs(this.restDecoder))}readKey(){return Xs(this.restDecoder)}}class nO{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=tt(this.restDecoder),this.dsCurrVal}readDsLen(){const e=tt(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class eo extends nO{constructor(e){super(e),this.keys=[],tt(e),this.keyClockDecoder=new Lf(Zr(e)),this.clientDecoder=new xc(Zr(e)),this.leftClockDecoder=new Lf(Zr(e)),this.rightClockDecoder=new Lf(Zr(e)),this.infoDecoder=new Qm(Zr(e),Vs),this.stringDecoder=new hR(Zr(e)),this.parentInfoDecoder=new Qm(Zr(e),Vs),this.typeRefDecoder=new xc(Zr(e)),this.lenDecoder=new xc(Zr(e))}readLeftID(){return new to(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new to(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ta(this.restDecoder)}readBuf(){return Zr(this.restDecoder)}readJSON(){return ta(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const r=this.stringDecoder.read();return this.keys.push(r),r}}}class iO{constructor(){this.restEncoder=wc()}toUint8Array(){return Wn(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ft(this.restEncoder,e)}writeDsLen(e){ft(this.restEncoder,e)}}class ia extends iO{writeLeftID(e){ft(this.restEncoder,e.client),ft(this.restEncoder,e.clock)}writeRightID(e){ft(this.restEncoder,e.client),ft(this.restEncoder,e.clock)}writeClient(e){ft(this.restEncoder,e)}writeInfo(e){Tf(this.restEncoder,e)}writeString(e){qs(this.restEncoder,e)}writeParentInfo(e){ft(this.restEncoder,e?1:0)}writeTypeRef(e){ft(this.restEncoder,e)}writeLen(e){ft(this.restEncoder,e)}writeAny(e){ea(this.restEncoder,e)}writeBuf(e){Xr(this.restEncoder,e)}writeJSON(e){qs(this.restEncoder,JSON.stringify(e))}writeKey(e){qs(this.restEncoder,e)}}class sO{constructor(){this.restEncoder=wc(),this.dsCurrVal=0}toUint8Array(){return Wn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const r=e-this.dsCurrVal;this.dsCurrVal=e,ft(this.restEncoder,r)}writeDsLen(e){e===0&&Gn(),ft(this.restEncoder,e-1),this.dsCurrVal+=e}}class as extends sO{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new If,this.clientEncoder=new Ec,this.leftClockEncoder=new If,this.rightClockEncoder=new If,this.infoEncoder=new Ym(Tf),this.stringEncoder=new cR,this.parentInfoEncoder=new Ym(Tf),this.typeRefEncoder=new Ec,this.lenEncoder=new Ec}toUint8Array(){const e=wc();return ft(e,0),Xr(e,this.keyClockEncoder.toUint8Array()),Xr(e,this.clientEncoder.toUint8Array()),Xr(e,this.leftClockEncoder.toUint8Array()),Xr(e,this.rightClockEncoder.toUint8Array()),Xr(e,Wn(this.infoEncoder)),Xr(e,this.stringEncoder.toUint8Array()),Xr(e,Wn(this.parentInfoEncoder)),Xr(e,this.typeRefEncoder.toUint8Array()),Xr(e,this.lenEncoder.toUint8Array()),vc(e,Wn(this.restEncoder)),Wn(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ea(this.restEncoder,e)}writeBuf(e){Xr(this.restEncoder,e)}writeJSON(e){ea(this.restEncoder,e)}writeKey(e){const r=this.keyMap.get(e);r===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(r)}}const oO=(t,e,r,n)=>{n=ss(n,e[0].id.clock);const i=Yn(e,n);ft(t.restEncoder,e.length-i),t.writeClient(r),ft(t.restEncoder,n);const s=e[i];s.write(t,n-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Wf=(t,e,r)=>{const n=new Map;r.forEach((i,s)=>{ir(e,s)>i&&n.set(s,i)}),Gf(e).forEach((i,s)=>{r.has(s)||n.set(s,0)}),ft(t.restEncoder,n.size),is(n.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{oO(t,e.clients.get(i),i,s)})},aO=(t,e)=>{const r=Tn(),n=tt(t.restDecoder);for(let i=0;i<n;i++){const s=tt(t.restDecoder),o=new Array(s),a=t.readClient();let c=tt(t.restDecoder);r.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(bc&u){case 0:{const h=t.readLen();o[l]=new un(ot(a,c),h),c+=h;break}case 10:{const h=tt(t.restDecoder);o[l]=new fn(ot(a,c),h),c+=h;break}default:{const h=(u&(hi|Vr))===0,d=new Zt(ot(a,c),null,(u&Vr)===Vr?t.readLeftID():null,null,(u&hi)===hi?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&Xo)===Xo?t.readString():null,ny(t,u));o[l]=d,c+=d.length}}}}return r},cO=(t,e,r)=>{const n=[];let i=is(r.keys()).sort((f,m)=>f-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=r.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=r.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new Og,c=new Map,l=(f,m)=>{const p=c.get(f);(p==null||p>m)&&c.set(f,m)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of n){const m=f.id.client,p=r.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),r.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[f]),i=i.filter(g=>g!==m)}n.length=0};for(;;){if(u.constructor!==fn){const m=Li(h,u.id.client,()=>ir(e,u.id.client))-u.id.clock;if(m<0)n.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(t,e);if(p!==null){n.push(u);const g=r.get(p)||{refs:[],i:0};if(g.refs.length===g.i)l(p,ir(e,p)),d();else{u=g.refs[g.i++];continue}}else(m===0||m<u.length)&&(u.integrate(t,m),h.set(u.id.client,u.id.clock+u.length))}}if(n.length>0)u=n.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new as;return Wf(f,a,new Map),ft(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},lO=(t,e)=>Wf(t,e.doc.store,e.beforeState),uO=(t,e,r,n=new eo(t))=>bt(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=aO(n,o),l=cO(i,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<ir(a,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const m=u.missing.get(d);(m==null||m>f)&&u.missing.set(d,f)}u.update=Ic([u.update,l.update])}}else a.pendingStructs=l;const h=_g(n,i,a);if(a.pendingDs){const d=new eo(Ys(a.pendingDs));tt(d.restDecoder);const f=_g(d,i,a);h&&f?a.pendingDs=Ic([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,Eg(i.doc,d)}},r,!1),Eg=(t,e,r,n=eo)=>{const i=Ys(e);uO(i,t,r,new n(i))},kg=(t,e,r)=>Eg(t,e,r,vg),fO=(t,e,r=new Map)=>{Wf(t,e.store,r),Js(t,rO(e.store))},hO=(t,e=new Uint8Array([0]),r=new as)=>{const n=xg(e);fO(r,t,n);const i=[r.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(xO(t.store.pendingStructs.update,e)),i.length>1){if(r.constructor===ia)return EO(i.map((s,o)=>o===0?s:TO(s)));if(r.constructor===as)return Ic(i)}return i[0]},dO=(t,e)=>hO(t,e,new ia),pO=t=>{const e=new Map,r=tt(t.restDecoder);for(let n=0;n<r;n++){const i=tt(t.restDecoder),s=tt(t.restDecoder);e.set(i,s)}return e},xg=t=>pO(new wg(Ys(t)));class mO{constructor(){this.l=[]}}const Ag=()=>new mO,Tg=(t,e)=>t.l.push(e),Sg=(t,e)=>{const r=t.l,n=r.length;t.l=r.filter(i=>e!==i),n===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Rg=(t,e,r)=>Ff(t.l,[e,r]);class to{constructor(e,r){this.client=e,this.clock=r}}const Rc=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,ot=(t,e)=>new to(t,e),gO=t=>{for(const[e,r]of t.doc.share.entries())if(r===t)return e;throw Gn()},ro=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!yg(e.ds,t.id),Hf=(t,e)=>{const r=Li(t.meta,Hf,Ks),n=t.doc.store;r.has(e)||(e.sv.forEach((i,s)=>{i<ir(n,s)&&Fi(t,ot(s,i))}),gg(t,e.ds,i=>{}),r.add(e))};class Og{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Gf=t=>{const e=new Map;return t.clients.forEach((r,n)=>{const i=r[r.length-1];e.set(n,i.id.clock+i.length)}),e},ir=(t,e)=>{const r=t.clients.get(e);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},Ig=(t,e)=>{let r=t.clients.get(e.id.client);if(r===void 0)r=[],t.clients.set(e.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==e.id.clock)throw Gn()}r.push(e)},Yn=(t,e)=>{let r=0,n=t.length-1,i=t[n],s=i.id.clock;if(s===e)return n;let o=Mi(e/(s+i.length-1)*n);for(;r<=n;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;r=o+1}else n=o-1;o=Mi((r+n)/2)}throw Gn()},Kf=(t,e)=>{const r=t.clients.get(e.client);return r[Yn(r,e.clock)]},qf=(t,e,r)=>{const n=Yn(e,r),i=e[n];return i.id.clock<r&&i instanceof Zt?(e.splice(n+1,0,jc(t,i,r-i.id.clock)),n+1):n},Fi=(t,e)=>{const r=t.doc.store.clients.get(e.client);return r[qf(t,r,e.clock)]},Ng=(t,e,r)=>{const n=e.clients.get(r.client),i=Yn(n,r.clock),s=n[i];return r.clock!==s.id.clock+s.length-1&&s.constructor!==un&&n.splice(i+1,0,jc(t,s,r.clock-s.id.clock+1)),s},yO=(t,e,r)=>{const n=t.clients.get(e.id.client);n[Yn(n,e.id.clock)]=r},Cg=(t,e,r,n,i)=>{if(n===0)return;const s=r+n;let o=qf(t,e,r),a;do a=e[o++],s<a.id.clock+a.length&&qf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class _O{constructor(e,r,n){this.doc=e,this.deleteSet=new na,this.beforeState=Gf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=r,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Lg=(t,e)=>e.deleteSet.clients.size===0&&!jS(e.afterState,(r,n)=>e.beforeState.get(n)!==r)?!1:(jf(e.deleteSet),lO(t,e),Js(t,e.deleteSet),!0),Mg=(t,e,r)=>{const n=e._item;(n===null||n.id.clock<(t.beforeState.get(n.id.client)||0)&&!n.deleted)&&Li(t.changed,e,Ks).add(r)},Oc=(t,e)=>{let r=t[e],n=t[e-1],i=e;for(;i>0;r=n,n=t[--i-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof Zt&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},bO=(t,e,r)=>{for(const[n,i]of t.clients.entries()){const s=e.clients.get(n);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Yn(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof Zt&&h.deleted&&!h.keep&&r(h)&&h.gc(e,!1)}}}},wO=(t,e)=>{t.clients.forEach((r,n)=>{const i=e.clients.get(n);for(let s=r.length-1;s>=0;s--){const o=r[s],a=jm(i.length-1,1+Yn(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Oc(i,c)}})},Ug=(t,e)=>{if(e<t.length){const r=t[e],n=r.doc,i=n.store,s=r.deleteSet,o=r._mergeStructs;try{jf(s),r.afterState=Gf(r.doc.store),n.emit("beforeObserverCalls",[r,n]);const a=[];r.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(r,c)})),a.push(()=>{r.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),Rg(l._dEH,c,r))})}),a.push(()=>n.emit("afterTransaction",[r,n])),Ff(a,[]),r._needFormattingCleanup&&DO(r)}finally{n.gc&&bO(s,i,n.gcFilter),wO(s,i),r.afterState.forEach((u,h)=>{const d=r.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),m=ss(Yn(f,d),1);for(let p=f.length-1;p>=m;)p-=1+Oc(f,p)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=i.clients.get(h),m=Yn(f,d);m+1<f.length&&Oc(f,m+1)>1||m>0&&Oc(f,m)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(XR($f,ug,"[yjs] ",fg,hg,"Changed the client-id because another client seems to be using it."),n.clientID=bg()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const u=new ia;Lg(u,r)&&n.emit("update",[u.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const u=new as;Lg(u,r)&&n.emit("updateV2",[u.toUint8Array(),r.origin,n,r])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=r;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=n.clientID,u.collectionid==null&&(u.collectionid=n.collectionid),n.subdocs.add(u)}),l.forEach(u=>n.subdocs.delete(u)),n.emit("subdocs",[{loaded:c,added:a,removed:l},n,r]),l.forEach(u=>u.destroy())),t.length<=e+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,t])):Ug(t,e+1)}}},bt=(t,e,r=null,n=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new _O(t,r,n),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&Ug(i,0)}}return o};function*vO(t){const e=tt(t.restDecoder);for(let r=0;r<e;r++){const n=tt(t.restDecoder),i=t.readClient();let s=tt(t.restDecoder);for(let o=0;o<n;o++){const a=t.readInfo();if(a===10){const c=tt(t.restDecoder);yield new fn(ot(i,s),c),s+=c}else if((bc&a)!==0){const c=(a&(hi|Vr))===0,l=new Zt(ot(i,s),null,(a&Vr)===Vr?t.readLeftID():null,null,(a&hi)===hi?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Xo)===Xo?t.readString():null,ny(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new un(ot(i,s),c),s+=c}}}}class Yf{constructor(e,r){this.gen=vO(e),this.curr=null,this.done=!1,this.filterSkips=r,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===fn);return this.curr}}class Vf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const EO=t=>Ic(t,vg,ia),kO=(t,e)=>{if(t.constructor===un){const{client:r,clock:n}=t.id;return new un(ot(r,n+e),t.length-e)}else if(t.constructor===fn){const{client:r,clock:n}=t.id;return new fn(ot(r,n+e),t.length-e)}else{const r=t,{client:n,clock:i}=r.id;return new Zt(ot(n,i+e),null,ot(n,i+e-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(e))}},Ic=(t,e=eo,r=as)=>{if(t.length===1)return t[0];const n=t.map(u=>new e(Ys(u)));let i=n.map(u=>new Yf(u,!0)),s=null;const o=new r,a=new Vf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const m=d.curr.id.clock-f.curr.id.clock;return m===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===fn?1:-1:m}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===fn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new fn(ot(h,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===fn?s.struct.length-=m:d=kO(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==fn;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),Xf(a);const c=n.map(u=>zf(u)),l=eO(c);return Js(o,l),o.toUint8Array()},xO=(t,e,r=eo,n=as)=>{const i=xg(e),s=new n,o=new Vf(s),a=new r(Ys(t)),c=new Yf(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===fn){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,ss(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Xf(o);const l=zf(a);return Js(s,l),s.toUint8Array()},Fg=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Wn(t.encoder.restEncoder)}),t.encoder.restEncoder=wc(),t.written=0)},Pi=(t,e,r)=>{t.written>0&&t.currClient!==e.id.client&&Fg(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ft(t.encoder.restEncoder,e.id.clock+r)),e.write(t.encoder,r),t.written++},Xf=t=>{Fg(t);const e=t.encoder.restEncoder;ft(e,t.clientStructs.length);for(let r=0;r<t.clientStructs.length;r++){const n=t.clientStructs[r];ft(e,n.written),vc(e,n.restEncoder)}},AO=(t,e,r,n)=>{const i=new r(Ys(t)),s=new Yf(i,!1),o=new n,a=new Vf(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,e(l),0);Xf(a);const c=zf(i);return Js(o,c),o.toUint8Array()},TO=t=>AO(t,UR,eo,ia),Pg="You must not compute changes after the event-handler fired.";class Nc{constructor(e,r){this.target=e,this.currentTarget=e,this.transaction=r,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=SO(this.currentTarget,this.target))}deletes(e){return yg(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ui(Pg);const e=new Map,r=this.target;this.transaction.changed.get(r).forEach(i=>{if(i!==null){const s=r._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Ef(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Ef(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Ef(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ui(Pg);const r=this.target,n=Ks(),i=Ks(),s=[];if(e={added:n,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(r).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=r._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),n.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const SO=(t,e)=>{const r=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)r.unshift(e._item.parentSub);else{let n=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;r.unshift(n)}e=e._item.parent}return r},vr=()=>{ZR("Invalid access: Add Yjs type to a document before reading data.")},$g=80;let Zf=0;class RO{constructor(e,r){e.marker=!0,this.p=e,this.index=r,this.timestamp=Zf++}}const OO=t=>{t.timestamp=Zf++},Bg=(t,e,r)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=r,t.timestamp=Zf++},IO=(t,e,r)=>{if(t.length>=$g){const n=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Bg(n,e,r),n}else{const n=new RO(e,r);return t.push(n),n}},Cc=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const r=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>_c(e-s.index)<_c(e-o.index)?s:o);let n=t._start,i=0;for(r!==null&&(n=r.p,i=r.index,OO(r));n.right!==null&&i<e;){if(!n.deleted&&n.countable){if(e<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>e;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&_c(r.index-i)<n.parent.length/$g?(Bg(r,n,i),r):IO(t._searchMarker,n,i)},sa=(t,e,r)=>{for(let n=t.length-1;n>=0;n--){const i=t[n];if(r>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(n,1);continue}i.p=s,s.marker=!0}(e<i.index||r>0&&e===i.index)&&(i.index=ss(e,i.index+r))}},Lc=(t,e,r)=>{const n=t,i=e.changedParentTypes;for(;Li(i,t,()=>[]).push(r),t._item!==null;)t=t._item.parent;Rg(n._eH,r,e)};class yr{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ag(),this._dEH=Ag(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,r){this.doc=e,this._item=r}_copy(){throw Hn()}clone(){throw Hn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,r){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Tg(this._eH,e)}observeDeep(e){Tg(this._dEH,e)}unobserve(e){Sg(this._eH,e)}unobserveDeep(e){Sg(this._dEH,e)}toJSON(){}}const Dg=(t,e,r)=>{t.doc??vr(),e<0&&(e=t._length+e),r<0&&(r=t._length+r);let n=r-e;const i=[];let s=t._start;for(;s!==null&&n>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&n>0;a++)i.push(o[a]),n--;e=0}}s=s.right}return i},jg=t=>{t.doc??vr();const e=[];let r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)e.push(n[i])}r=r.right}return e},oa=(t,e)=>{let r=0,n=t._start;for(t.doc??vr();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)e(i[s],r++,t)}n=n.right}},zg=(t,e)=>{const r=[];return oa(t,(n,i)=>{r.push(e(n,i,t))}),r},NO=t=>{let e=t._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};r=e.content.getContent(),n=0,e=e.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},Wg=(t,e)=>{t.doc??vr();const r=Cc(t,e);let n=t._start;for(r!==null&&(n=r.p,e-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(e<n.length)return n.content.getContent()[e];e-=n.length}},Mc=(t,e,r,n)=>{let i=r;const s=t.doc,o=s.clientID,a=s.store,c=r===null?e._start:r.right;let l=[];const u=()=>{l.length>0&&(i=new Zt(ot(o,ir(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new us(l)),i.integrate(t,0),l=[])};n.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new Zt(ot(o,ir(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new aa(new Uint8Array(h))),i.integrate(t,0);break;case Qs:i=new Zt(ot(o,ir(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new la(h)),i.integrate(t,0);break;default:if(h instanceof yr)i=new Zt(ot(o,ir(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new gi(h)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Hg=()=>Ui("Length exceeded!"),Gg=(t,e,r,n)=>{if(r>e._length)throw Hg();if(r===0)return e._searchMarker&&sa(e._searchMarker,r,n.length),Mc(t,e,null,n);const i=r,s=Cc(e,r);let o=e._start;for(s!==null&&(o=s.p,r-=s.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&Fi(t,ot(o.id.client,o.id.clock+r));break}r-=o.length}return e._searchMarker&&sa(e._searchMarker,i,n.length),Mc(t,e,o,n)},CO=(t,e,r)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Mc(t,e,i,r)},Kg=(t,e,r,n)=>{if(n===0)return;const i=r,s=n,o=Cc(e,r);let a=e._start;for(o!==null&&(a=o.p,r-=o.index);a!==null&&r>0;a=a.right)!a.deleted&&a.countable&&(r<a.length&&Fi(t,ot(a.id.client,a.id.clock+r)),r-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&Fi(t,ot(a.id.client,a.id.clock+n)),a.delete(t),n-=a.length),a=a.right;if(n>0)throw Hg();e._searchMarker&&sa(e._searchMarker,i,-s+n)},Uc=(t,e,r)=>{const n=e._map.get(r);n!==void 0&&n.delete(t)},Jf=(t,e,r,n)=>{const i=e._map.get(r)||null,s=t.doc,o=s.clientID;let a;if(n==null)a=new us([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new us([n]);break;case Uint8Array:a=new aa(n);break;case Qs:a=new la(n);break;default:if(n instanceof yr)a=new gi(n);else throw new Error("Unexpected content type")}new Zt(ot(o,ir(s.store,o)),i,i&&i.lastId,null,null,e,r,a).integrate(t,0)},Qf=(t,e)=>{t.doc??vr();const r=t._map.get(e);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},qg=t=>{const e={};return t.doc??vr(),t._map.forEach((r,n)=>{r.deleted||(e[n]=r.content.getContent()[r.length-1])}),e},Yg=(t,e)=>{t.doc??vr();const r=t._map.get(e);return r!==void 0&&!r.deleted},LO=(t,e)=>{const r={};return t._map.forEach((n,i)=>{let s=n;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&ro(s,e)&&(r[i]=s.content.getContent()[s.length-1])}),r},Fc=t=>(t.doc??vr(),JR(t._map.entries(),e=>!e[1].deleted));class MO extends Nc{}class no extends yr{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const r=new no;return r.push(e),r}_integrate(e,r){super._integrate(e,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new no}clone(){const e=new no;return e.insert(0,this.toArray().map(r=>r instanceof yr?r.clone():r)),e}get length(){return this.doc??vr(),this._length}_callObserver(e,r){super._callObserver(e,r),Lc(this,e,new MO(this,e))}insert(e,r){this.doc!==null?bt(this.doc,n=>{Gg(n,this,e,r)}):this._prelimContent.splice(e,0,...r)}push(e){this.doc!==null?bt(this.doc,r=>{CO(r,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,r=1){this.doc!==null?bt(this.doc,n=>{Kg(n,this,e,r)}):this._prelimContent.splice(e,r)}get(e){return Wg(this,e)}toArray(){return jg(this)}slice(e=0,r=this.length){return Dg(this,e,r)}toJSON(){return this.map(e=>e instanceof yr?e.toJSON():e)}map(e){return zg(this,e)}forEach(e){oa(this,e)}[Symbol.iterator](){return NO(this)}_write(e){e.writeTypeRef(sI)}}const UO=t=>new no;class FO extends Nc{constructor(e,r,n){super(e,r),this.keysChanged=n}}class io extends yr{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,r){super._integrate(e,r),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new io}clone(){const e=new io;return this.forEach((r,n)=>{e.set(n,r instanceof yr?r.clone():r)}),e}_callObserver(e,r){Lc(this,e,new FO(this,e,r))}toJSON(){this.doc??vr();const e={};return this._map.forEach((r,n)=>{if(!r.deleted){const i=r.content.getContent()[r.length-1];e[n]=i instanceof yr?i.toJSON():i}}),e}get size(){return[...Fc(this)].length}keys(){return Bf(Fc(this),e=>e[0])}values(){return Bf(Fc(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Bf(Fc(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??vr(),this._map.forEach((r,n)=>{r.deleted||e(r.content.getContent()[r.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?bt(this.doc,r=>{Uc(r,this,e)}):this._prelimContent.delete(e)}set(e,r){return this.doc!==null?bt(this.doc,n=>{Jf(n,this,e,r)}):this._prelimContent.set(e,r),r}get(e){return Qf(this,e)}has(e){return Yg(this,e)}clear(){this.doc!==null?bt(this.doc,e=>{this.forEach(function(r,n,i){Uc(e,i,n)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(oI)}}const PO=t=>new io,$i=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&LR(t,e);class eh{constructor(e,r,n,i){this.left=e,this.right=r,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Gn(),this.right.content.constructor){case Xt:this.right.deleted||so(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Vg=(t,e,r)=>{for(;e.right!==null&&r>0;){switch(e.right.content.constructor){case Xt:e.right.deleted||so(e.currentAttributes,e.right.content);break;default:e.right.deleted||(r<e.right.length&&Fi(t,ot(e.right.id.client,e.right.id.clock+r)),e.index+=e.right.length,r-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Pc=(t,e,r,n)=>{const i=new Map,s=n?Cc(e,r):null;if(s){const o=new eh(s.p.left,s.p,s.index,i);return Vg(t,o,r-s.index)}else{const o=new eh(null,e._start,0,i);return Vg(t,o,r)}},Xg=(t,e,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===Xt&&$i(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=t.doc,s=i.clientID;n.forEach((o,a)=>{const c=r.left,l=r.right,u=new Zt(ot(s,ir(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Xt(a,o));u.integrate(t,0),r.right=u,r.forward()})},so=(t,e)=>{const{key:r,value:n}=e;n===null?t.delete(r):t.set(r,n)},Zg=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Xt&&$i(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Jg=(t,e,r,n)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in n){const c=n[a],l=r.currentAttributes.get(a)??null;if(!$i(l,c)){o.set(a,l);const{left:u,right:h}=r;r.right=new Zt(ot(s,ir(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new Xt(a,c)),r.right.integrate(t,0),r.forward()}}return o},th=(t,e,r,n,i)=>{r.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=t.doc,o=s.clientID;Zg(r,i);const a=Jg(t,e,r,i),c=n.constructor===String?new Vn(n):n instanceof yr?new gi(n):new ls(n);let{left:l,right:u,index:h}=r;e._searchMarker&&sa(e._searchMarker,r.index,c.getLength()),u=new Zt(ot(o,ir(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),r.right=u,r.index=h,r.forward(),Xg(t,e,r,a)},Qg=(t,e,r,n,i)=>{const s=t.doc,o=s.clientID;Zg(r,i);const a=Jg(t,e,r,i);e:for(;r.right!==null&&(n>0||a.size>0&&(r.right.deleted||r.right.content.constructor===Xt));){if(!r.right.deleted)switch(r.right.content.constructor){case Xt:{const{key:c,value:l}=r.right.content,u=i[c];if(u!==void 0){if($i(u,l))a.delete(c);else{if(n===0)break e;a.set(c,l)}r.right.delete(t)}else r.currentAttributes.set(c,l);break}default:n<r.right.length&&Fi(t,ot(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new Zt(ot(o,ir(s.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,e,null,new Vn(c)),r.right.integrate(t,0),r.forward()}Xg(t,e,r,a)},ey=(t,e,r,n,i)=>{let s=e;const o=Tn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Xt){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(r===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Xt:{const{key:u,value:h}=l,d=n.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(t),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&so(i,l);break}}}e=e.right}return a},$O=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const r=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Xt){const n=e.content.key;r.has(n)?e.delete(t):r.add(n)}e=e.left}},BO=t=>{let e=0;return bt(t.doc,r=>{let n=t._start,i=t._start,s=Tn();const o=vf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Xt:so(o,i.content);break;default:e+=ey(r,n,i,s,o),s=vf(o),n=i;break}i=i.right}}),e},DO=t=>{const e=new Set,r=t.doc;for(const[n,i]of t.afterState.entries()){const s=t.beforeState.get(n)||0;i!==s&&Cg(t,r.store.clients.get(n),s,i,o=>{!o.deleted&&o.content.constructor===Xt&&o.constructor!==un&&e.add(o.parent)})}bt(r,n=>{gg(t,t.deleteSet,i=>{if(i instanceof un||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Xt?e.add(s):$O(n,i)});for(const i of e)BO(i)})},ty=(t,e,r)=>{const n=r,i=vf(e.currentAttributes),s=e.right;for(;r>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case gi:case ls:case Vn:r<e.right.length&&Fi(t,ot(e.right.id.client,e.right.id.clock+r)),r-=e.right.length,e.right.delete(t);break}e.forward()}s&&ey(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&sa(o._searchMarker,e.index,-n+r),e};class jO extends Nc{constructor(e,r,n){super(e,r),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,r=[];bt(e,n=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((m,p)=>{m!==null&&(f.attributes[p]=m)}))),l="";break;case"retain":u>0&&(f={retain:u},IR(c)||(f.attributes=SR({},c))),u=0;break}f&&r.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case gi:case ls:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Vn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Xt:{const{key:f,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(f)??null;$i(p,m)?m!==null&&o.delete(n):(a==="retain"&&d(),$i(m,s.get(f)??null)?delete c[f]:c[f]=m)}}else if(this.deletes(o)){s.set(f,m);const p=i.get(f)??null;$i(p,m)||(a==="retain"&&d(),c[f]=p)}else if(!o.deleted){s.set(f,m);const p=c[f];p!==void 0&&($i(p,m)?p!==null&&o.delete(n):(a==="retain"&&d(),m===null?delete c[f]:c[f]=m))}o.deleted||(a==="insert"&&d(),so(i,o.content));break}}o=o.right}for(d();r.length>0;){const f=r[r.length-1];if(f.retain!==void 0&&f.attributes===void 0)r.pop();else break}}),this._delta=r}return this._delta}}class mi extends yr{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??vr(),this._length}_integrate(e,r){super._integrate(e,r);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new mi}clone(){const e=new mi;return e.applyDelta(this.toDelta()),e}_callObserver(e,r){super._callObserver(e,r);const n=new jO(this,e,r);Lc(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??vr();let e="",r=this._start;for(;r!==null;)!r.deleted&&r.countable&&r.content.constructor===Vn&&(e+=r.content.str),r=r.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:r=!0}={}){this.doc!==null?bt(this.doc,n=>{const i=new eh(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!r&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&th(n,this,i,a,o.attributes||{})}else o.retain!==void 0?Qg(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&ty(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,r,n){this.doc??vr();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((m,p)=>{d=!0,h[p]=m});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const u=()=>{for(;c!==null;){if(ro(c,e)||r!==void 0&&ro(c,r))switch(c.content.constructor){case Vn:{const h=s.get("ychange");e!==void 0&&!ro(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",n?n("removed",c.id):{type:"removed"})):r!==void 0&&!ro(c,r)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",n?n("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case gi:case ls:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,m)=>{d[m]=f})}i.push(h);break}case Xt:ro(c,e)&&(l(),so(s,c.content));break}c=c.right}l()};return e||r?bt(o,h=>{e&&Hf(h,e),r&&Hf(h,r),u()},"cleanup"):u(),i}insert(e,r,n){if(r.length<=0)return;const i=this.doc;i!==null?bt(i,s=>{const o=Pc(s,this,e,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),th(s,this,o,r,n)}):this._pending.push(()=>this.insert(e,r,n))}insertEmbed(e,r,n){const i=this.doc;i!==null?bt(i,s=>{const o=Pc(s,this,e,!n);th(s,this,o,r,n||{})}):this._pending.push(()=>this.insertEmbed(e,r,n||{}))}delete(e,r){if(r===0)return;const n=this.doc;n!==null?bt(n,i=>{ty(i,Pc(i,this,e,!0),r)}):this._pending.push(()=>this.delete(e,r))}format(e,r,n){if(r===0)return;const i=this.doc;i!==null?bt(i,s=>{const o=Pc(s,this,e,!1);o.right!==null&&Qg(s,this,o,r,n)}):this._pending.push(()=>this.format(e,r,n))}removeAttribute(e){this.doc!==null?bt(this.doc,r=>{Uc(r,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,r){this.doc!==null?bt(this.doc,n=>{Jf(n,this,e,r)}):this._pending.push(()=>this.setAttribute(e,r))}getAttribute(e){return Qf(this,e)}getAttributes(){return qg(this)}_write(e){e.writeTypeRef(aI)}}const zO=t=>new mi;class rh{constructor(e,r=()=>!0){this._filter=r,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??vr()}[Symbol.iterator](){return this}next(){let e=this._currentNode,r=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(r)))do if(r=e.content.type,!e.deleted&&(r.constructor===oo||r.constructor===cs)&&r._start!==null)e=r._start;else for(;e!==null;){const n=e.next;if(n!==null){e=n;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class cs extends yr{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,r){super._integrate(e,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new cs}clone(){const e=new cs;return e.insert(0,this.toArray().map(r=>r instanceof yr?r.clone():r)),e}get length(){return this.doc??vr(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new rh(this,e)}querySelector(e){e=e.toUpperCase();const n=new rh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return n.done?null:n.value}querySelectorAll(e){return e=e.toUpperCase(),is(new rh(this,r=>r.nodeName&&r.nodeName.toUpperCase()===e))}_callObserver(e,r){Lc(this,e,new GO(this,r,e))}toString(){return zg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,r={},n){const i=e.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),oa(this,s=>{i.insertBefore(s.toDOM(e,r,n),null)}),i}insert(e,r){this.doc!==null?bt(this.doc,n=>{Gg(n,this,e,r)}):this._prelimContent.splice(e,0,...r)}insertAfter(e,r){if(this.doc!==null)bt(this.doc,n=>{const i=e&&e instanceof yr?e._item:e;Mc(n,this,i,r)});else{const n=this._prelimContent,i=e===null?0:n.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Ui("Reference item not found");n.splice(i,0,...r)}}delete(e,r=1){this.doc!==null?bt(this.doc,n=>{Kg(n,this,e,r)}):this._prelimContent.splice(e,r)}toArray(){return jg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Wg(this,e)}slice(e=0,r=this.length){return Dg(this,e,r)}forEach(e){oa(this,e)}_write(e){e.writeTypeRef(lI)}}const WO=t=>new cs;class oo extends cs{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,r){super._integrate(e,r),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new oo(this.nodeName)}clone(){const e=new oo(this.nodeName),r=this.getAttributes();return OR(r,(n,i)=>{typeof n=="string"&&e.setAttribute(i,n)}),e.insert(0,this.toArray().map(n=>n instanceof yr?n.clone():n)),e}toString(){const e=this.getAttributes(),r=[],n=[];for(const a in e)n.push(a);n.sort();const i=n.length;for(let a=0;a<i;a++){const c=n[a];r.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=r.length>0?" "+r.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?bt(this.doc,r=>{Uc(r,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,r){this.doc!==null?bt(this.doc,n=>{Jf(n,this,e,r)}):this._prelimAttrs.set(e,r)}getAttribute(e){return Qf(this,e)}hasAttribute(e){return Yg(this,e)}getAttributes(e){return e?LO(this,e):qg(this)}toDOM(e=document,r={},n){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return oa(this,o=>{i.appendChild(o.toDOM(e,r,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(e){e.writeTypeRef(cI),e.writeKey(this.nodeName)}}const HO=t=>new oo(t.readKey());class GO extends Nc{constructor(e,r,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class $c extends io{constructor(e){super(),this.hookName=e}_copy(){return new $c(this.hookName)}clone(){const e=new $c(this.hookName);return this.forEach((r,n)=>{e.set(n,r)}),e}toDOM(e=document,r={},n){const i=r[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(uI),e.writeKey(this.hookName)}}const KO=t=>new $c(t.readKey());class Bc extends mi{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Bc}clone(){const e=new Bc;return e.applyDelta(this.toDelta()),e}toDOM(e=document,r,n){const i=e.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const r=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),r.push({nodeName:i,attrs:s})}r.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let n="";for(let i=0;i<r.length;i++){const s=r[i];n+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=e.insert;for(let i=r.length-1;i>=0;i--)n+=`</${r[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(fI)}}const qO=t=>new Bc;class nh{constructor(e,r){this.id=e,this.length=r}get deleted(){throw Hn()}mergeWith(e){return!1}write(e,r,n){throw Hn()}integrate(e,r){throw Hn()}}const YO=0;class un extends nh{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,r){r>0&&(this.id.clock+=r,this.length-=r),Ig(e.doc.store,this)}write(e,r){e.writeInfo(YO),e.writeLen(this.length-r)}getMissing(e,r){return null}}class aa{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new aa(this.content)}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeBuf(this.content)}getRef(){return 3}}const VO=t=>new aa(t.readBuf());class ca{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ca(this.len)}splice(e){const r=new ca(this.len-e);return this.len=e,r}mergeWith(e){return this.len+=e.len,!0}integrate(e,r){Sc(e.deleteSet,r.id.client,r.id.clock,this.len),r.markDeleted()}delete(e){}gc(e){}write(e,r){e.writeLen(this.len-r)}getRef(){return 1}}const XO=t=>new ca(t.readLen()),ry=(t,e)=>new Qs({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class la{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const r={};this.opts=r,e.gc||(r.gc=!1),e.autoLoad&&(r.autoLoad=!0),e.meta!==null&&(r.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new la(ry(this.doc.guid,this.opts))}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){this.doc._item=r,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,r){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const ZO=t=>new la(ry(t.readString(),t.readAny()));class ls{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ls(this.embed)}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeJSON(this.embed)}getRef(){return 5}}const JO=t=>new ls(t.readJSON());class Xt{constructor(e,r){this.key=e,this.value=r}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Xt(this.key,this.value)}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){const n=r.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,r){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const QO=t=>new Xt(t.readKey(),t.readJSON());class Dc{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Dc(this.arr)}splice(e){const r=new Dc(this.arr.slice(e));return this.arr=this.arr.slice(0,e),r}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){const n=this.arr.length;e.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const eI=t=>{const e=t.readLen(),r=[];for(let n=0;n<e;n++){const i=t.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new Dc(r)},tI=Tc("node_env")==="development";class us{constructor(e){this.arr=e,tI&&ag(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new us(this.arr)}splice(e){const r=new us(this.arr.slice(e));return this.arr=this.arr.slice(0,e),r}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){const n=this.arr.length;e.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const rI=t=>{const e=t.readLen(),r=[];for(let n=0;n<e;n++)r.push(t.readAny());return new us(r)};class Vn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vn(this.str)}splice(e){const r=new Vn(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"�",r.str="�"+r.str.slice(1)),r}mergeWith(e){return this.str+=e.str,!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeString(r===0?this.str:this.str.slice(r))}getRef(){return 4}}const nI=t=>new Vn(t.readString()),iI=[UO,PO,zO,HO,WO,KO,qO],sI=0,oI=1,aI=2,cI=3,lI=4,uI=5,fI=6;class gi{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new gi(this.type._copy())}splice(e){throw Hn()}mergeWith(e){return!1}integrate(e,r){this.type._integrate(e.doc,r)}delete(e){let r=this.type._start;for(;r!==null;)r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e),r=r.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e)}),e.changed.delete(this.type)}gc(e){let r=this.type._start;for(;r!==null;)r.gc(e,!0),r=r.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(e,!0),n=n.left}),this.type._map=new Map}write(e,r){this.type._write(e)}getRef(){return 7}}const hI=t=>new gi(iI[t.readTypeRef()](t)),jc=(t,e,r)=>{const{client:n,clock:i}=e.id,s=new Zt(ot(n,i+r),e,ot(n,i+r-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(r));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=ot(e.redone.client,e.redone.clock+r)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=r,s};class Zt extends nh{constructor(e,r,n,i,s,o,a,c){super(e,c.getLength()),this.origin=n,this.left=r,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Hm:0}set marker(e){(this.info&xf)>0!==e&&(this.info^=xf)}get marker(){return(this.info&xf)>0}get keep(){return(this.info&Wm)>0}set keep(e){this.keep!==e&&(this.info^=Wm)}get countable(){return(this.info&Hm)>0}get deleted(){return(this.info&kf)>0}set deleted(e){this.deleted!==e&&(this.info^=kf)}markDeleted(){this.info|=kf}getMissing(e,r){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ir(r,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ir(r,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===to&&this.id.client!==this.parent.client&&this.parent.clock>=ir(r,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Ng(e,r,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Fi(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===un||this.right&&this.right.constructor===un)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Zt?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Zt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===to){const n=Kf(r,this.parent);n.constructor===un?this.parent=null:this.parent=n.content.type}return null}integrate(e,r){if(r>0&&(this.id.clock+=r,this.left=Ng(e,e.doc.store,ot(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(r),this.length-=r),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Rc(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,s.clear();else if(Rc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Kf(e.doc.store,i.origin)))s.has(Kf(e.doc.store,i.origin))||(n=i,s.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ig(e.doc.store,this),this.content.integrate(e,this),Mg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new un(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:ot(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Rc(e.origin,this.lastId)&&this.right===e&&Rc(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const r=this.parent._searchMarker;return r&&r.forEach(n=>{n.p===e&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const r=this.parent;this.countable&&this.parentSub===null&&(r._length-=this.length),this.markDeleted(),Sc(e.deleteSet,this.id.client,this.id.clock,this.length),Mg(e,r,this.parentSub),this.content.delete(e)}}gc(e,r){if(!this.deleted)throw Gn();this.content.gc(e),r?yO(e,this,new un(this.id,this.length)):this.content=new ca(this.length)}write(e,r){const n=r>0?ot(this.id.client,this.id.clock+r-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&bc|(n===null?0:Vr)|(i===null?0:hi)|(s===null?0:Xo);if(e.writeInfo(o),n!==null&&e.writeLeftID(n),i!==null&&e.writeRightID(i),n===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=gO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===to?(e.writeParentInfo(!1),e.writeLeftID(a)):Gn();s!==null&&e.writeString(s)}this.content.write(e,r)}}const ny=(t,e)=>dI[e&bc](t),dI=[()=>{Gn()},XO,eI,VO,nI,JO,QO,hI,rI,ZO,()=>{Gn()}],pI=10;class fn extends nh{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,r){Gn()}write(e,r){e.writeInfo(pI),ft(e.restEncoder,this.length-r)}getMissing(e,r){return null}}const iy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Gs<"u"?Gs:{},sy="__ $YJS$ __";iy[sy]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),iy[sy]=!0;let oy=!1;const Jr=new Qs;function ay(t,e,r){const n=Jr.getMap();if(!n.has(t))switch(e){case 0:case 1:n.set(t,r);break}}function mI(t,e){ay(t,0,e)}function ih(t,e){const r=new mi(e);ay(t,1,r)}function gI(t,e){Jr.getMap().set(t,e)}function yI(t,e){const r=Jr.getMap(),n=new mi(e);r.set(t,n)}function cy(t,e){const r=Jr.getMap();function n(i){const s=r.get(t);for(let o=0;o<i.length;++o)(i[o].target===r||i[o].target===s)&&e(s)}return r.has(t)&&e(r.get(t)),r.observeDeep(n),()=>{r.observeDeep(n)}}function _I(t,e){return cy(t,r=>{Te(r)&&e(r)})}function ly(t,e){return cy(t,r=>{r instanceof mi&&e(r.toJSON())})}const fs=Ws("modem",["second"],t=>{if(fs.session(t))switch(t.target){case"second":!oy&&t.data%2===0&&fs.emit(t.player,"modem:join");break;case"join":t.sender!==fs.id()&&fs.reply(t,"joinack",Pm(dO(Jr)));break;case"joinack":t.sender!==fs.id()&&(oy=!0,kg(Jr,gc(t.data),Jr));break;case"sync":{t.sender!==fs.id()&&w(t.data)&&kg(Jr,gc(t.data),Jr);break}}});function uy(t,e){e!==Jr&&fs.emit("","modem:sync",Pm(t))}Jr.on("update",uy),Jr.on("destroy",()=>{Jr.off("update",uy)});function fy(t,e){return t%e}function hy(t,e){return Math.floor(t/e)}function bI(t,e){return{x:fy(t,e),y:hy(t,e)}}function dy(t,e){const r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function Qr(t,e){return t.x+t.y*e}function ao(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function sh(t,e,r,n,i,s){return t>=s&&t<=n&&e>=r&&e<=i}function py(t,e,r,n){const i=[],s=Math.min(t,r),o=Math.max(t,r),a=Math.min(e,n),c=Math.max(e,n);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function my(t,e,r,n){const i=[],s=Math.abs(r-t),o=Math.abs(n-e),a=t<r?1:-1,c=e<n?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==r||e!==n;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const gy="176",wI="",Sn="srgb",yy="srgb-linear",_y="linear",oh="srgb";function Rn(t,e,r){return Math.max(e,Math.min(r,t))}function vI(t,e){return(t%e+e)%e}function ah(t,e,r){return(1-r)*t+r*e}class ua{constructor(e=0,r=0){ua.prototype.isVector2=!0,this.x=e,this.y=r}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,r){return this.x=e,this.y=r,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,r){switch(e){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this}addScaledVector(e,r){return this.x+=e.x*r,this.y+=e.y*r,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const r=this.x,n=this.y,i=e.elements;return this.x=i[0]*r+i[3]*n+i[6],this.y=i[1]*r+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,r){return this.x=Rn(this.x,e.x,r.x),this.y=Rn(this.y,e.y,r.y),this}clampScalar(e,r){return this.x=Rn(this.x,e,r),this.y=Rn(this.y,e,r),this}clampLength(e,r){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Rn(n,e,r))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const r=Math.sqrt(this.lengthSq()*e.lengthSq());if(r===0)return Math.PI/2;const n=this.dot(e)/r;return Math.acos(Rn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const r=this.x-e.x,n=this.y-e.y;return r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,r){return this.x+=(e.x-this.x)*r,this.y+=(e.y-this.y)*r,this}lerpVectors(e,r,n){return this.x=e.x+(r.x-e.x)*n,this.y=e.y+(r.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,r=0){return this.x=e[r],this.y=e[r+1],this}toArray(e=[],r=0){return e[r]=this.x,e[r+1]=this.y,e}fromBufferAttribute(e,r){return this.x=e.getX(r),this.y=e.getY(r),this}rotateAround(e,r){const n=Math.cos(r),i=Math.sin(r),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*i+e.x,this.y=s*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class fa{constructor(e,r,n,i,s,o,a,c,l){fa.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,r,n,i,s,o,a,c,l)}set(e,r,n,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=r,u[4]=s,u[5]=c,u[6]=n,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const r=this.elements,n=e.elements;return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],this}extractBasis(e,r,n){return e.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const r=e.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,r){const n=e.elements,i=r.elements,s=this.elements,o=n[0],a=n[3],c=n[6],l=n[1],u=n[4],h=n[7],d=n[2],f=n[5],m=n[8],p=i[0],g=i[3],y=i[6],b=i[1],A=i[4],S=i[7],x=i[2],F=i[5],R=i[8];return s[0]=o*p+a*b+c*x,s[3]=o*g+a*A+c*F,s[6]=o*y+a*S+c*R,s[1]=l*p+u*b+h*x,s[4]=l*g+u*A+h*F,s[7]=l*y+u*S+h*R,s[2]=d*p+f*b+m*x,s[5]=d*g+f*A+m*F,s[8]=d*y+f*S+m*R,this}multiplyScalar(e){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=e,r[4]*=e,r[7]*=e,r[2]*=e,r[5]*=e,r[8]*=e,this}determinant(){const e=this.elements,r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return r*o*u-r*a*l-n*s*u+n*a*c+i*s*l-i*o*c}invert(){const e=this.elements,r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,m=r*h+n*d+i*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=h*p,e[1]=(i*l-u*n)*p,e[2]=(a*n-i*o)*p,e[3]=d*p,e[4]=(u*r-i*c)*p,e[5]=(i*s-a*r)*p,e[6]=f*p,e[7]=(n*c-l*r)*p,e[8]=(o*r-n*s)*p,this}transpose(){let e;const r=this.elements;return e=r[1],r[1]=r[3],r[3]=e,e=r[2],r[2]=r[6],r[6]=e,e=r[5],r[5]=r[7],r[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const r=this.elements;return e[0]=r[0],e[1]=r[3],e[2]=r[6],e[3]=r[1],e[4]=r[4],e[5]=r[7],e[6]=r[2],e[7]=r[5],e[8]=r[8],this}setUvTransform(e,r,n,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(n*c,n*l,-n*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+r,0,0,1),this}scale(e,r){return this.premultiply(ch.makeScale(e,r)),this}rotate(e){return this.premultiply(ch.makeRotation(-e)),this}translate(e,r){return this.premultiply(ch.makeTranslation(e,r)),this}makeTranslation(e,r){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,r,0,0,1),this}makeRotation(e){const r=Math.cos(e),n=Math.sin(e);return this.set(r,-n,0,n,r,0,0,0,1),this}makeScale(e,r){return this.set(e,0,0,0,r,0,0,0,1),this}equals(e){const r=this.elements,n=e.elements;for(let i=0;i<9;i++)if(r[i]!==n[i])return!1;return!0}fromArray(e,r=0){for(let n=0;n<9;n++)this.elements[n]=e[n+r];return this}toArray(e=[],r=0){const n=this.elements;return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],e[r+4]=n[4],e[r+5]=n[5],e[r+6]=n[6],e[r+7]=n[7],e[r+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ch=new fa,by=new fa().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),wy=new fa().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function EI(){const t={enabled:!0,workingColorSpace:yy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===oh&&(i.r=co(i.r),i.g=co(i.g),i.b=co(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===oh&&(i.r=lo(i.r),i.g=lo(i.g),i.b=lo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===wI?_y:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],n=[.3127,.329];return t.define({[yy]:{primaries:e,whitePoint:n,transfer:_y,toXYZ:by,fromXYZ:wy,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:Sn},outputColorSpaceConfig:{drawingBufferColorSpace:Sn}},[Sn]:{primaries:e,whitePoint:n,transfer:oh,toXYZ:by,fromXYZ:wy,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:Sn}}}),t}const On=EI();function co(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function lo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const vy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bi={h:0,s:0,l:0},zc={h:0,s:0,l:0};function lh(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*6*(2/3-r):t}class uh{constructor(e,r,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,r,n)}set(e,r,n){if(r===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,r,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,r=Sn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,On.toWorkingColorSpace(this,r),this}setRGB(e,r,n,i=On.workingColorSpace){return this.r=e,this.g=r,this.b=n,On.toWorkingColorSpace(this,i),this}setHSL(e,r,n,i=On.workingColorSpace){if(e=vI(e,1),r=Rn(r,0,1),n=Rn(n,0,1),r===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+r):n+r-n*r,o=2*n-s;this.r=lh(o,s,e+1/3),this.g=lh(o,s,e),this.b=lh(o,s,e-1/3)}return On.toWorkingColorSpace(this,i),this}setStyle(e,r=Sn){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,r);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,r);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,r);if(o===6)return this.setHex(parseInt(s,16),r);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,r);return this}setColorName(e,r=Sn){const n=vy[e.toLowerCase()];return n!==void 0?this.setHex(n,r):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=co(e.r),this.g=co(e.g),this.b=co(e.b),this}copyLinearToSRGB(e){return this.r=lo(e.r),this.g=lo(e.g),this.b=lo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Sn){return On.fromWorkingColorSpace(Er.copy(this),e),Math.round(Rn(Er.r*255,0,255))*65536+Math.round(Rn(Er.g*255,0,255))*256+Math.round(Rn(Er.b*255,0,255))}getHexString(e=Sn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,r=On.workingColorSpace){On.fromWorkingColorSpace(Er.copy(this),r);const n=Er.r,i=Er.g,s=Er.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case n:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-n)/h+2;break;case s:c=(n-i)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,r=On.workingColorSpace){return On.fromWorkingColorSpace(Er.copy(this),r),e.r=Er.r,e.g=Er.g,e.b=Er.b,e}getStyle(e=Sn){On.fromWorkingColorSpace(Er.copy(this),e);const r=Er.r,n=Er.g,i=Er.b;return e!==Sn?`color(${e} ${r.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(r*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,r,n){return this.getHSL(Bi),this.setHSL(Bi.h+e,Bi.s+r,Bi.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,r){return this.r=e.r+r.r,this.g=e.g+r.g,this.b=e.b+r.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,r){return this.r+=(e.r-this.r)*r,this.g+=(e.g-this.g)*r,this.b+=(e.b-this.b)*r,this}lerpColors(e,r,n){return this.r=e.r+(r.r-e.r)*n,this.g=e.g+(r.g-e.g)*n,this.b=e.b+(r.b-e.b)*n,this}lerpHSL(e,r){this.getHSL(Bi),e.getHSL(zc);const n=ah(Bi.h,zc.h,r),i=ah(Bi.s,zc.s,r),s=ah(Bi.l,zc.l,r);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const r=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*r+s[3]*n+s[6]*i,this.g=s[1]*r+s[4]*n+s[7]*i,this.b=s[2]*r+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,r=0){return this.r=e[r],this.g=e[r+1],this.b=e[r+2],this}toArray(e=[],r=0){return e[r]=this.r,e[r+1]=this.g,e[r+2]=this.b,e}fromBufferAttribute(e,r){return this.r=e.getX(r),this.g=e.getY(r),this.b=e.getZ(r),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Er=new uh;uh.NAMES=vy,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:gy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=gy),new ua,new ua;function Bt(t,e,r){return Math.max(e,Math.min(r,t))}function Ey(t){return t/180*Math.PI}function ky(t){return t*180/Math.PI}const kI=Q0("089fad0j9awfem09wavefc09uwaef");function xI(){return kI()}function AI(t){return Q0(t)()}function hn(t,e){const r=Math.min(t,e),i=Math.max(t,e)-r+1;return r+Math.floor(xI()*i)}function xy(t,e,r){const n=Math.min(e,r),s=Math.max(e,r)-n+1;return n+Math.floor(AI(t)*s)}function Ay(t,e,r){typeof r!="number"&&(r=1);const n=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=r)n.push(o);return n}function TI(t){return t[hn(0,t.length-1)]}function SI(t,e){return e[xy(t,0,e.length-1)]}function en(...t){return TI(t.flat())}function RI(t,...e){return SI(t,e.flat())}function OI(t){return[...new Set(t)].filter(w)}function hs(t){return w(t)&&w(t.x)&&w(t.y)}function Ct(t,e){switch(e){case Ee.NORTH:--t.y;break;case Ee.SOUTH:++t.y;break;case Ee.WEST:--t.x;break;case Ee.EAST:++t.x;break}return t}function fh(t,e){return t<0?Ee.WEST:t>0?Ee.EAST:e<0?Ee.NORTH:e>0?Ee.SOUTH:Ee.IDLE}function In(t,e){return fh(e.x-t.x,e.y-t.y)}const hh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER",within:"WITHIN",awayby:"AWAYBY"};function tn(t){return ut(t)&&Ty(t[0])}function Ty(t){return w(Ee[t])&&ye(t)}function Sy(t){const e=Ee[t];return w(e)?e:Ee.IDLE}function Wc(t){if(ye(t))return hh[Be(t)]}function II(t){if(tn(t))return t;if(Ty(t))return[t];const e=Wc(t);if(w(e))return[e]}function Ry(t){const e=k.words[t],r=II(e);return tn(r)?[r,t+1]:[void 0,t]}function Oy(t){const e=[];let[r,n]=Ry(t);for(;tn(r);){switch(e.push(...r),r[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[a,c,l]=ue(k.words,n,[Z.NUMBER,Z.NUMBER]);e.push(a,c),n=l;break}case"FLEE":case"FIND":{const[a,c]=ue(k.words,n,[Z.KIND]);console.info("kind",a),n=c;break}case"TO":{const[a,c,l]=ue(k.words,n,[Z.DIR,Z.DIR]),u=k.element?.x??0,h=k.element?.y??0;a.destpt.x-=u,a.destpt.y-=h,c.destpt.x-=u,c.destpt.y-=h,e.push(u+a.destpt.x+c.destpt.x,h+a.destpt.y+c.destpt.y),n=l;break}case"WITHIN":case"AWAYBY":{const[a,c]=ue(k.words,n,[Z.NUMBER]);e.push(a),n=c;break}}const i=n;switch(r[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":case"WITHIN":case"AWAYBY":break;default:return[e,n]}const[s,o]=Ry(i);r=s,n=o}return e.length?[e,n]:[void 0,t]}function NI(t){return w(t)&&t<it.ONBLACK?t:void 0}function dh(t){return w(t)&&t>it.WHITE&&t<it.ONCLEAR?t-it.ONBLACK:void 0}const ha={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Tr(t){return ut(t)&&Iy(t[0])}function CI(t){return Tr(t)&&t[0].startsWith("ON")}function Iy(t){return w(it[t])&&ye(t)}function da(t){if(ye(t))return ha[Be(t)]}function uo(t,e){return[w(t)?`${it[t]}`:void 0,w(e)?`ON${it[e]}`:void 0].filter(w)}function Hc(t){return t.map(e=>it[e]).find(e=>w(e)&&e<it.ONBLACK)}function Gc(t){return t.map(e=>it[e]).find(e=>w(e)&&e>=it.ONBLACK)}function LI(t){if(Tr(t))return t;if(Iy(t))return[t];const e=da(t);if(w(e))return[e]}function Ny(t){const e=k.words[t],r=LI(e);return Tr(r)?[r,t+1]:[void 0,t]}function Kc(t){const e=[];let r=t;const n=parseFloat(k.words[t]);if(Te(n))return[uo(n,void 0),t+1];const[i,s]=Ny(t);Tr(i)&&(e.push(...i),r=s);const[o,a]=Ny(s);return CI(o)&&(e.push(...o),r=a),e.length?[e,r]:[void 0,t]}function Cy(t){const e={};for(let r=0;r<t.length;++r){const n=t[r],i=it[n];w(i)&&(i<it.ONBLACK?e.color=i:e.bg=dh(i))}return e}var qc={exports:{}},Yc={exports:{}},MI=Yc.exports,Ly;function UI(){return Ly||(Ly=1,(function(t,e){(function(r,n){t.exports=n()})(MI,function(){function r(p){return!isNaN(parseFloat(p))&&isFinite(p)}function n(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(p){if(p)for(var g=0;g<u.length;g++)p[u[g]]!==void 0&&this["set"+n(u[g])](p[u[g]])}h.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof h)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new h(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",g=this.getLineNumber()||"",y=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+g+":"+y+")":"[eval]:"+g+":"+y:b?b+" ("+p+":"+g+":"+y+")":p+":"+g+":"+y}},h.fromString=function(g){var y=g.indexOf("("),b=g.lastIndexOf(")"),A=g.substring(0,y),S=g.substring(y+1,b).split(","),x=g.substring(b+1);if(x.indexOf("@")===0)var F=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(x,""),R=F[1],P=F[2],W=F[3];return new h({functionName:A,args:S||void 0,fileName:R,lineNumber:P||void 0,columnNumber:W||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+n(s[d])]=i(s[d]),h.prototype["set"+n(s[d])]=(function(p){return function(g){this[p]=!!g}})(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+n(o[f])]=i(o[f]),h.prototype["set"+n(o[f])]=(function(p){return function(g){if(!r(g))throw new TypeError(p+" must be a Number");this[p]=Number(g)}})(o[f]);for(var m=0;m<a.length;m++)h.prototype["get"+n(a[m])]=i(a[m]),h.prototype["set"+n(a[m])]=(function(p){return function(g){this[p]=String(g)}})(a[m]);return h})})(Yc)),Yc.exports}var FI=qc.exports,My;function PI(){return My||(My=1,(function(t,e){(function(r,n){t.exports=n(UI())})(FI,function(n){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),m=d&&h||void 0,p=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new n({functionName:m,fileName:p,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new n({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(h,""));return new n({functionName:f,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new n({fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new n({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",m=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;f.match(/\(([^)]*)\)/)&&(p=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new n({functionName:m,args:g,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(qc)),qc.exports}var $I=PI(),BI=js($I);const Me=60,rt=25,ph=Me*rt;var Re=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Re||{});const mh=14,Vc=3,ds=8,ps=14,Xc=16,DI=16,jI=16;var Zc=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(Zc||{});function pa(t,e){return new Array(t).fill(e)}function zI(t,e,r,n,i,s=0){const o=n*i;return{id:`tiles:${t}:${e}`,type:1,tag:r,width:n,height:i,char:pa(o,0),color:pa(o,0),bg:pa(o,s),wall:pa(o,0)}}function WI(t,e,r,n=1,i=15){return{id:`sprites:${t}:${e}:${r}`,x:0,y:0,char:n,color:i,bg:it.ONCLEAR}}function HI(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function GI(t,e,r,n,i=0){const s=r*n;return{id:`dither:${t}:${e}`,type:3,width:r,height:n,alphas:pa(s,i)}}function KI(t,e,r,n){return{id:`media:${t}:${e}`,type:4,mime:r,media:n}}function qI(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function Uy(t,e){return`${t}:${e}`}const YI=1,VI=16,XI=256;var Sr=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Sr||{});const Xn=!!JSON.parse("false"),ZI=!!JSON.parse("false");JSON.parse("false");const Fy=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ms={HALT_AT_COUNT:256},le=Ws("SOFTWARE");function yi(t){const e={},r={everytick(){},aftertick(){},listcommands(){return Mr(e)},...t,getcommand(n){return e[n]},command(n,i){return e[n]=i,r}};return r}function Pr(t,e,r,n){const[i,s]=ue(n,0,[Z.NUMBER_OR_STRING,Z.MAYBE_NUMBER_OR_STRING]);vm(le,t,e,r,i,s)}const JI=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function gh(t,e,r){const[n,i]=ue(r,0,[Z.NUMBER_OR_STRING]);if(Te(n))ff(le,t,e,"volume",n);else if(JI.includes(Be(n))){const[s,o]=ue(r,i,[Z.NUMBER_OR_STRING,Z.MAYBE_NUMBER_OR_STRING]);vm(le,t,e,n,s,o)}else{const[s]=ue(r,i,[Z.MAYBE_NUMBER_OR_STRING]);if(Te(s)){const o=r.length-i,a=new Array(o).fill(Z.NUMBER),c=ue(r,i,a).slice(0,o),l=c.length===1?c[0]:c;ff(le,t,e,n,l)}else{const[o]=ue(r,i,[Z.MAYBE_NUMBER_OR_STRING]);ff(le,t,e,n,o)}}}function Di(t,e){const[r]=ue(t,0,[Z.MAYBE_NAME]);uS(le,k.elementfocus,k.board?.id??"",r??"",e)}const Jc=yi().command("tts",(t,e)=>{const[r,n]=ue(e,0,[Z.STRING,Z.STRING]);return aS(le,k.elementfocus,r,n),0}).command("ttsqueue",(t,e)=>{const[r,n]=ue(e,0,[Z.STRING,Z.STRING]);return cS(le,k.elementfocus,r,n),0}).command("bpm",(t,e)=>{const[r]=ue(e,0,[Z.NUMBER]);return fS(le,k.elementfocus,r),0}).command("vol",(t,e)=>{const[r]=ue(e,0,[Z.NUMBER]);return hS(le,k.elementfocus,r),0}).command("bgvol",(t,e)=>{const[r]=ue(e,0,[Z.NUMBER]);return dS(le,k.elementfocus,r),0}).command("ttsvol",(t,e)=>{const[r]=ue(e,0,[Z.NUMBER]);return pS(le,k.elementfocus,r),0}).command("play",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return lS(le,k.elementfocus,k.board?.id??"",r??""),0}).command("bgplay",(t,e)=>(Di(e,""),0)).command("bgplayon64n",(t,e)=>(Di(e,"@64n"),0)).command("bgplayon32n",(t,e)=>(Di(e,"@32n"),0)).command("bgplayon16n",(t,e)=>(Di(e,"@16n"),0)).command("bgplayon8n",(t,e)=>(Di(e,"@8n"),0)).command("bgplayon4n",(t,e)=>(Di(e,"@4n"),0)).command("bgplayon2n",(t,e)=>(Di(e,"@2n"),0)).command("bgplayon1n",(t,e)=>(Di(e,"@1m"),0)).command("synth",(t,e)=>{for(let r=0;r<4;++r)gh(k.elementfocus,r,e);return 0}).command("synthrecord",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_STRING]);return mS(le,k.elementfocus,r??""),0}).command("synthflush",()=>(gS(le,k.elementfocus),0)).command("echo",(t,e)=>{for(let r=0;r<2;++r)Pr(k.elementfocus,r,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let r=0;r<2;++r)Pr(k.elementfocus,r,"fc",e);return 0}).command("phaser",(t,e)=>{for(let r=0;r<2;++r)Pr(k.elementfocus,r,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let r=0;r<2;++r)Pr(k.elementfocus,r,"reverb",e);return 0}).command("distort",(t,e)=>{for(let r=0;r<2;++r)Pr(k.elementfocus,r,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let r=0;r<2;++r)Pr(k.elementfocus,r,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let r=0;r<2;++r)Pr(k.elementfocus,r,"autowah",e);return 0});for(let t=0;t<4;++t)Jc.command(`synth${t+1}`,(e,r)=>(gh(k.elementfocus,t,r),0));Jc.command("synth5",(t,e)=>{for(let r=4;r<8;++r)gh(k.elementfocus,r,e);return 0});for(let t=0;t<3;++t){const e=t+1;Jc.command(`echo${e}`,(r,n)=>(Pr(k.elementfocus,t,"echo",n),0)).command(`fcrush${e}`,(r,n)=>(Pr(k.elementfocus,t,"fcrush",n),0)).command(`phaser${e}`,(r,n)=>(Pr(k.elementfocus,t,"phaser",n),0)).command(`reverb${e}`,(r,n)=>(Pr(k.elementfocus,t,"reverb",n),0)).command(`distort${e}`,(r,n)=>(Pr(k.elementfocus,t,"distort",n),0)).command(`vibrato${e}`,(r,n)=>(Pr(k.elementfocus,t,"vibrato",n),0)).command(`autowah${e}`,(r,n)=>(Pr(k.elementfocus,t,"autowah",n),0))}var yh;try{yh=new TextDecoder}catch{}var Ie,Zn,te=0,wt={},at,ji,dn=0,Jn=0,sr,_i,$r=[],st,Py={useRecords:!1,mapsAsObjects:!0};class $y{}const By=new $y;By.name="MessagePack 0xC1";var zi=!1,Dy=2,QI;try{new Function("")}catch{Dy=1/0}class ma{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,r){if(Ie)return e_(()=>(Eh(),this?this.unpack(e,r):ma.prototype.unpack.call(Py,e,r)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Vt<"u"?Vt.from(e):new Uint8Array(e)),typeof r=="object"?(Zn=r.end||e.length,te=r.start||0):(te=0,Zn=r>-1?r:e.length),Jn=0,ji=null,sr=null,Ie=e;try{st=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(n){throw Ie=null,e instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof ma){if(wt=this,this.structures)return at=this.structures,Qc(r);(!at||at.length>0)&&(at=[])}else wt=Py,(!at||at.length>0)&&(at=[]);return Qc(r)}unpackMultiple(e,r){let n,i=0;try{zi=!0;let s=e.length,o=this?this.unpack(e,s):el.unpack(e,s);if(r){if(r(o,i,te)===!1)return;for(;te<s;)if(i=te,r(Qc(),i,te)===!1)return}else{for(n=[o];te<s;)i=te,n.push(Qc());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{zi=!1,Eh()}}_mergeStructures(e,r){e=e||[],Object.isFrozen(e)&&(e=e.map(n=>n.slice(0)));for(let n=0,i=e.length;n<i;n++){let s=e[n];s&&(s.isShared=!0,n>=32&&(s.highByte=n-32>>5))}e.sharedLength=e.length;for(let n in r||[])if(n>=0){let i=e[n],s=r[n];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[n]=i),e[n]=s)}return this.structures=e}decode(e,r){return this.unpack(e,r)}}function Qc(t){try{if(!wt.trusted&&!zi){let r=at.sharedLength||0;r<at.length&&(at.length=r)}let e;if(wt.randomAccessStructure&&Ie[te]<64&&Ie[te]>=32&&QI||(e=Dt()),sr&&(te=sr.postBundlePosition,sr=null),zi&&(at.restoreStructures=null),te==Zn)at&&at.restoreStructures&&jy(),at=null,Ie=null,_i&&(_i=null);else{if(te>Zn)throw new Error("Unexpected end of MessagePack data");if(!zi){let r;try{r=JSON.stringify(e,(n,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return e}catch(e){throw at&&at.restoreStructures&&jy(),Eh(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||te>Zn)&&(e.incomplete=!0),e}}function jy(){for(let t in at.restoreStructures)at[t]=at.restoreStructures[t];at.restoreStructures=null}function Dt(){let t=Ie[te++];if(t<160)if(t<128){if(t<64)return t;{let e=at[t&63]||wt.getStructures&&Wy()[t&63];return e?(e.read||(e.read=_h(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,wt.mapsAsObjects){let e={};for(let r=0;r<t;r++){let n=Vy();n==="__proto__"&&(n="__proto_"),e[n]=Dt()}return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(Dt(),Dt());return e}else{t-=144;let e=new Array(t);for(let r=0;r<t;r++)e[r]=Dt();return wt.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(Jn>=te)return ji.slice(te-dn,(te+=e)-dn);if(Jn==0&&Zn<140){let r=e<16?wh(e):Ky(e);if(r!=null)return r}return bh(e)}else{let e;switch(t){case 192:return null;case 193:return sr?(e=Dt(),e>0?sr[1].slice(sr.position1,sr.position1+=e):sr[0].slice(sr.position0,sr.position0-=e)):By;case 194:return!1;case 195:return!0;case 196:if(e=Ie[te++],e===void 0)throw new Error("Unexpected end of buffer");return vh(e);case 197:return e=st.getUint16(te),te+=2,vh(e);case 198:return e=st.getUint32(te),te+=4,vh(e);case 199:return gs(Ie[te++]);case 200:return e=st.getUint16(te),te+=2,gs(e);case 201:return e=st.getUint32(te),te+=4,gs(e);case 202:if(e=st.getFloat32(te),wt.useFloat32>2){let r=kh[(Ie[te]&127)<<1|Ie[te+1]>>7];return te+=4,(r*e+(e>0?.5:-.5)>>0)/r}return te+=4,e;case 203:return e=st.getFloat64(te),te+=8,e;case 204:return Ie[te++];case 205:return e=st.getUint16(te),te+=2,e;case 206:return e=st.getUint32(te),te+=4,e;case 207:return wt.int64AsType==="number"?(e=st.getUint32(te)*4294967296,e+=st.getUint32(te+4)):wt.int64AsType==="string"?e=st.getBigUint64(te).toString():wt.int64AsType==="auto"?(e=st.getBigUint64(te),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=st.getBigUint64(te),te+=8,e;case 208:return st.getInt8(te++);case 209:return e=st.getInt16(te),te+=2,e;case 210:return e=st.getInt32(te),te+=4,e;case 211:return wt.int64AsType==="number"?(e=st.getInt32(te)*4294967296,e+=st.getUint32(te+4)):wt.int64AsType==="string"?e=st.getBigInt64(te).toString():wt.int64AsType==="auto"?(e=st.getBigInt64(te),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=st.getBigInt64(te),te+=8,e;case 212:if(e=Ie[te++],e==114)return Zy(Ie[te++]&63);{let r=$r[e];if(r)return r.read?(te++,r.read(Dt())):r.noBuffer?(te++,r()):r(Ie.subarray(te,++te));throw new Error("Unknown extension "+e)}case 213:return e=Ie[te],e==114?(te++,Zy(Ie[te++]&63,Ie[te++])):gs(2);case 214:return gs(4);case 215:return gs(8);case 216:return gs(16);case 217:return e=Ie[te++],Jn>=te?ji.slice(te-dn,(te+=e)-dn):tN(e);case 218:return e=st.getUint16(te),te+=2,Jn>=te?ji.slice(te-dn,(te+=e)-dn):rN(e);case 219:return e=st.getUint32(te),te+=4,Jn>=te?ji.slice(te-dn,(te+=e)-dn):nN(e);case 220:return e=st.getUint16(te),te+=2,Hy(e);case 221:return e=st.getUint32(te),te+=4,Hy(e);case 222:return e=st.getUint16(te),te+=2,Gy(e);case 223:return e=st.getUint32(te),te+=4,Gy(e);default:if(t>=224)return t-256;if(t===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+t)}}}const eN=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function _h(t,e){function r(){if(r.count++>Dy){let i=t.read=new Function("r","return function(){return "+(wt.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":eN.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Dt);return t.highByte===0&&(t.read=zy(e,t.read)),i()}let n={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),n[o]=Dt()}return wt.freezeData?Object.freeze(n):n}return r.count=0,t.highByte===0?zy(e,r):r}const zy=(t,e)=>function(){let r=Ie[te++];if(r===0)return e();let n=t<32?-(t+(r<<5)):t+(r<<5),i=at[n]||Wy()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=_h(i,t)),i.read()};function Wy(){let t=e_(()=>(Ie=null,wt.getStructures()));return at=wt._mergeStructures(t,at)}var bh=ga,tN=ga,rN=ga,nN=ga;function ga(t){let e;if(t<16&&(e=wh(t)))return e;if(t>64&&yh)return yh.decode(Ie.subarray(te,te+=t));const r=te+t,n=[];for(e="";te<r;){const i=Ie[te++];if((i&128)===0)n.push(i);else if((i&224)===192){const s=Ie[te++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=Ie[te++]&63,o=Ie[te++]&63;n.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Ie[te++]&63,o=Ie[te++]&63,a=Ie[te++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c)}else n.push(i);n.length>=4096&&(e+=or.apply(String,n),n.length=0)}return n.length>0&&(e+=or.apply(String,n)),e}function Hy(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=Dt();return wt.freezeData?Object.freeze(e):e}function Gy(t){if(wt.mapsAsObjects){let e={};for(let r=0;r<t;r++){let n=Vy();n==="__proto__"&&(n="__proto_"),e[n]=Dt()}return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(Dt(),Dt());return e}}var or=String.fromCharCode;function Ky(t){let e=te,r=new Array(t);for(let n=0;n<t;n++){const i=Ie[te++];if((i&128)>0){te=e;return}r[n]=i}return or.apply(String,r)}function wh(t){if(t<4)if(t<2){if(t===0)return"";{let e=Ie[te++];if((e&128)>1){te-=1;return}return or(e)}}else{let e=Ie[te++],r=Ie[te++];if((e&128)>0||(r&128)>0){te-=2;return}if(t<3)return or(e,r);let n=Ie[te++];if((n&128)>0){te-=3;return}return or(e,r,n)}else{let e=Ie[te++],r=Ie[te++],n=Ie[te++],i=Ie[te++];if((e&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){te-=4;return}if(t<6){if(t===4)return or(e,r,n,i);{let s=Ie[te++];if((s&128)>0){te-=5;return}return or(e,r,n,i,s)}}else if(t<8){let s=Ie[te++],o=Ie[te++];if((s&128)>0||(o&128)>0){te-=6;return}if(t<7)return or(e,r,n,i,s,o);let a=Ie[te++];if((a&128)>0){te-=7;return}return or(e,r,n,i,s,o,a)}else{let s=Ie[te++],o=Ie[te++],a=Ie[te++],c=Ie[te++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){te-=8;return}if(t<10){if(t===8)return or(e,r,n,i,s,o,a,c);{let l=Ie[te++];if((l&128)>0){te-=9;return}return or(e,r,n,i,s,o,a,c,l)}}else if(t<12){let l=Ie[te++],u=Ie[te++];if((l&128)>0||(u&128)>0){te-=10;return}if(t<11)return or(e,r,n,i,s,o,a,c,l,u);let h=Ie[te++];if((h&128)>0){te-=11;return}return or(e,r,n,i,s,o,a,c,l,u,h)}else{let l=Ie[te++],u=Ie[te++],h=Ie[te++],d=Ie[te++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){te-=12;return}if(t<14){if(t===12)return or(e,r,n,i,s,o,a,c,l,u,h,d);{let f=Ie[te++];if((f&128)>0){te-=13;return}return or(e,r,n,i,s,o,a,c,l,u,h,d,f)}}else{let f=Ie[te++],m=Ie[te++];if((f&128)>0||(m&128)>0){te-=14;return}if(t<15)return or(e,r,n,i,s,o,a,c,l,u,h,d,f,m);let p=Ie[te++];if((p&128)>0){te-=15;return}return or(e,r,n,i,s,o,a,c,l,u,h,d,f,m,p)}}}}}function qy(){let t=Ie[te++],e;if(t<192)e=t-160;else switch(t){case 217:e=Ie[te++];break;case 218:e=st.getUint16(te),te+=2;break;case 219:e=st.getUint32(te),te+=4;break;default:throw new Error("Expected string")}return ga(e)}function vh(t){return wt.copyBuffers?Uint8Array.prototype.slice.call(Ie,te,te+=t):Ie.subarray(te,te+=t)}function gs(t){let e=Ie[te++];if($r[e]){let r;return $r[e](Ie.subarray(te,r=te+=t),n=>{te=n;try{return Dt()}finally{te=r}})}else throw new Error("Unknown extension type "+e)}var Yy=new Array(4096);function Vy(){let t=Ie[te++];if(t>=160&&t<192){if(t=t-160,Jn>=te)return ji.slice(te-dn,(te+=t)-dn);if(!(Jn==0&&Zn<180))return bh(t)}else return te--,Xy(Dt());let e=(t<<5^(t>1?st.getUint16(te):t>0?Ie[te]:0))&4095,r=Yy[e],n=te,i=te+t-3,s,o=0;if(r&&r.bytes==t){for(;n<i;){if(s=st.getUint32(n),s!=r[o++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(s=Ie[n++],s!=r[o++]){n=1879048192;break}if(n===i)return te=n,r.string;i-=3,n=te}for(r=[],Yy[e]=r,r.bytes=t;n<i;)s=st.getUint32(n),r.push(s),n+=4;for(i+=3;n<i;)s=Ie[n++],r.push(s);let a=t<16?wh(t):Ky(t);return a!=null?r.string=a:r.string=bh(t)}function Xy(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";if(wt.allowArraysInMapKeys&&Array.isArray(t)&&t.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return t.flat().toString();throw new Error(`Invalid property type for record: ${typeof t}`)}const Zy=(t,e)=>{let r=Dt().map(Xy),n=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,r.highByte=e);let i=at[t];return i&&(i.isShared||zi)&&((at.restoreStructures||(at.restoreStructures=[]))[t]=i),at[t]=r,r.read=_h(r,n),r.read()};$r[0]=()=>{},$r[0].noBuffer=!0,$r[66]=t=>{let e=t.byteLength%8||8,r=BigInt(t[0]&128?t[0]-256:t[0]);for(let n=1;n<e;n++)r<<=BigInt(8),r+=BigInt(t[n]);if(t.byteLength!==e){let n=new DataView(t.buffer,t.byteOffset,t.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=n.getBigUint64(s);for(let d=s+8;d<o;d+=8)h<<=64n,h|=n.getBigUint64(d);return h}let c=s+(a>>4<<3),l=i(s,c),u=i(c,o);return l<<BigInt((o-c)*8)|u};r=r<<BigInt((n.byteLength-e)*8)|i(e,n.byteLength)}return r};let Jy={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};$r[101]=()=>{let t=Dt();if(!Jy[t[0]]){let e=Error(t[1],{cause:t[2]});return e.name=t[0],e}return Jy[t[0]](t[1],{cause:t[2]})},$r[105]=t=>{if(wt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=st.getUint32(te-4);_i||(_i=new Map);let r=Ie[te],n;r>=144&&r<160||r==220||r==221?n=[]:r>=128&&r<144||r==222||r==223?n=new Map:(r>=199&&r<=201||r>=212&&r<=216)&&Ie[te+1]===115?n=new Set:n={};let i={target:n};_i.set(e,i);let s=Dt();if(i.used)Object.assign(n,s);else return i.target=s;if(n instanceof Map)for(let[o,a]of s.entries())n.set(o,a);if(n instanceof Set)for(let o of Array.from(s))n.add(o);return n},$r[112]=t=>{if(wt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=st.getUint32(te-4),r=_i.get(e);return r.used=!0,r.target},$r[115]=()=>new Set(Dt());const Qy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let iN=typeof globalThis=="object"?globalThis:window;$r[116]=t=>{let e=t[0],r=Uint8Array.prototype.slice.call(t,1).buffer,n=Qy[e];if(!n){if(e===16)return r;if(e===17)return new DataView(r);throw new Error("Could not find typed array for code "+e)}return new iN[n](r)},$r[120]=()=>{let t=Dt();return new RegExp(t[0],t[1])};const sN=[];$r[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],r=te;return te+=e-t.length,sr=sN,sr=[qy(),qy()],sr.position0=0,sr.position1=0,sr.postBundlePosition=te,te=r,Dt()},$r[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function e_(t){let e=Zn,r=te,n=dn,i=Jn,s=ji,o=_i,a=sr,c=new Uint8Array(Ie.slice(0,Zn)),l=at,u=at.slice(0,at.length),h=wt,d=zi,f=t();return Zn=e,te=r,dn=n,Jn=i,ji=s,_i=o,sr=a,Ie=c,zi=d,at=l,at.splice(0,at.length,...u),wt=h,st=new DataView(Ie.buffer,Ie.byteOffset,Ie.byteLength),f}function Eh(){Ie=null,_i=null,at=null}const kh=new Array(147);for(let t=0;t<256;t++)kh[t]=+("1e"+Math.floor(45.15-t*.30103));var el=new ma({useRecords:!1});const oN=el.unpack;el.unpackMultiple,el.unpack;let aN=new Float32Array(1);new Uint8Array(aN.buffer,0,4);let tl;try{tl=new TextEncoder}catch{}let xh,t_;const fo=typeof Vt<"u",rl=fo?function(t){return Vt.allocUnsafeSlow(t)}:Uint8Array,r_=fo?Vt:Uint8Array,n_=fo?4294967296:2144337920;let ae,ya,_t,ne=0,kr,Ot=null,cN;const lN=21760,uN=/[\u0080-\uFFFF]/,ho=Symbol("record-id");class fN extends ma{constructor(e){super(e),this.offset=0;let r,n,i,s,o=r_.prototype.utf8Write?function(I,v){return ae.utf8Write(I,v,ae.byteLength-v)}:tl&&tl.encodeInto?function(I,v){return tl.encodeInto(I,ae.subarray(v)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,m=u+h+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],g=0,y=0;this.pack=this.encode=function(I,v){if(ae||(ae=new rl(8192),_t=ae.dataView||(ae.dataView=new DataView(ae.buffer,0,8192)),ne=0),kr=ae.length-10,kr-ne<2048?(ae=new rl(ae.length),_t=ae.dataView||(ae.dataView=new DataView(ae.buffer,0,ae.length)),kr=ae.length-10,ne=0):ne=ne+7&2147483640,r=ne,v&yN&&(ne+=v&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof I!="string"?(Ot=[],Ot.size=1/0):Ot=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let z=i.sharedLength||0;if(z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let $=0;$<z;$++){let Q=i[$];if(!Q)continue;let Y,N=i.transitions;for(let M=0,U=Q.length;M<U;M++){let V=Q[M];Y=N[V],Y||(Y=N[V]=Object.create(null)),N=Y}N[ho]=$+64}this.lastNamedStructuresLength=z}c||(i.nextId=z+64)}n&&(n=!1);let C;try{a.randomAccessStructure&&I&&I.constructor&&I.constructor===Object?O(I):S(I);let z=Ot;if(Ot&&s_(r,S,0),s&&s.idsToInsert){let $=s.idsToInsert.sort((M,U)=>M.offset>U.offset?1:-1),Q=$.length,Y=-1;for(;z&&Q>0;){let M=$[--Q].offset+r;M<z.stringsPosition+r&&Y===-1&&(Y=0),M>z.position+r?Y>=0&&(Y+=6):(Y>=0&&(_t.setUint32(z.position+r,_t.getUint32(z.position+r)+Y),Y=-1),z=z.previous,Q++)}Y>=0&&z&&_t.setUint32(z.position+r,_t.getUint32(z.position+r)+Y),ne+=$.length*6,ne>kr&&W(ne),a.offset=ne;let N=hN(ae.subarray(r,ne),$);return s=null,N}return a.offset=ne,v&mN?(ae.start=r,ae.end=ne,ae):ae.subarray(r,ne)}catch(z){throw C=z,z}finally{if(i&&(b(),n&&a.saveStructures)){let z=i.sharedLength||0,$=ae.subarray(r,ne),Q=dN(i,a);if(!C)return a.saveStructures(Q,Q.isCompatible)===!1?a.pack(I,v):(a.lastNamedStructuresLength=z,ae.length>1073741824&&(ae=null),$)}ae.length>1073741824&&(ae=null),v&gN&&(ne=r)}};const b=()=>{y<10&&y++;let I=i.sharedLength||0;if(i.length>I&&!c&&(i.length=I),g>1e4)i.transitions=null,y=0,g=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let v=0,C=p.length;v<C;v++)p[v][ho]=0;p=[]}},A=I=>{var v=I.length;v<16?ae[ne++]=144|v:v<65536?(ae[ne++]=220,ae[ne++]=v>>8,ae[ne++]=v&255):(ae[ne++]=221,_t.setUint32(ne,v),ne+=4);for(let C=0;C<v;C++)S(I[C])},S=I=>{ne>kr&&(ae=W(ne));var v=typeof I,C;if(v==="string"){let z=I.length;if(Ot&&z>=4&&z<4096){if((Ot.size+=z)>lN){let N,M=(Ot[0]?Ot[0].length*3+Ot[1].length:0)+10;ne+M>kr&&(ae=W(ne+M));let U;Ot.position?(U=Ot,ae[ne]=200,ne+=3,ae[ne++]=98,N=ne-r,ne+=4,s_(r,S,0),_t.setUint16(N+r-3,ne-r-N)):(ae[ne++]=214,ae[ne++]=98,N=ne-r,ne+=4),Ot=["",""],Ot.previous=U,Ot.size=0,Ot.position=N}let Y=uN.test(I);Ot[Y?0:1]+=I,ae[ne++]=193,S(Y?-z:z);return}let $;z<32?$=1:z<256?$=2:z<65536?$=3:$=5;let Q=z*3;if(ne+Q>kr&&(ae=W(ne+Q)),z<64||!o){let Y,N,M,U=ne+$;for(Y=0;Y<z;Y++)N=I.charCodeAt(Y),N<128?ae[U++]=N:N<2048?(ae[U++]=N>>6|192,ae[U++]=N&63|128):(N&64512)===55296&&((M=I.charCodeAt(Y+1))&64512)===56320?(N=65536+((N&1023)<<10)+(M&1023),Y++,ae[U++]=N>>18|240,ae[U++]=N>>12&63|128,ae[U++]=N>>6&63|128,ae[U++]=N&63|128):(ae[U++]=N>>12|224,ae[U++]=N>>6&63|128,ae[U++]=N&63|128);C=U-ne-$}else C=o(I,ne+$);C<32?ae[ne++]=160|C:C<256?($<2&&ae.copyWithin(ne+2,ne+1,ne+1+C),ae[ne++]=217,ae[ne++]=C):C<65536?($<3&&ae.copyWithin(ne+3,ne+2,ne+2+C),ae[ne++]=218,ae[ne++]=C>>8,ae[ne++]=C&255):($<5&&ae.copyWithin(ne+5,ne+3,ne+3+C),ae[ne++]=219,_t.setUint32(ne,C),ne+=4),ne+=C}else if(v==="number")if(I>>>0===I)I<32||I<128&&this.useRecords===!1||I<64&&!this.randomAccessStructure?ae[ne++]=I:I<256?(ae[ne++]=204,ae[ne++]=I):I<65536?(ae[ne++]=205,ae[ne++]=I>>8,ae[ne++]=I&255):(ae[ne++]=206,_t.setUint32(ne,I),ne+=4);else if(I>>0===I)I>=-32?ae[ne++]=256+I:I>=-128?(ae[ne++]=208,ae[ne++]=I+256):I>=-32768?(ae[ne++]=209,_t.setInt16(ne,I),ne+=2):(ae[ne++]=210,_t.setInt32(ne,I),ne+=4);else{let z;if((z=this.useFloat32)>0&&I<4294967296&&I>=-2147483648){ae[ne++]=202,_t.setFloat32(ne,I);let $;if(z<4||($=I*kh[(ae[ne]&127)<<1|ae[ne+1]>>7])>>0===$){ne+=4;return}else ne--}ae[ne++]=203,_t.setFloat64(ne,I),ne+=8}else if(v==="object"||v==="function")if(!I)ae[ne++]=192;else{if(s){let $=s.get(I);if($){if(!$.id){let Q=s.idsToInsert||(s.idsToInsert=[]);$.id=Q.push($)}ae[ne++]=214,ae[ne++]=112,_t.setUint32(ne,$.id),ne+=4;return}else s.set(I,{offset:ne-r})}let z=I.constructor;if(z===Object)P(I);else if(z===Array)A(I);else if(z===Map)if(this.mapAsEmptyObject)ae[ne++]=128;else{C=I.size,C<16?ae[ne++]=128|C:C<65536?(ae[ne++]=222,ae[ne++]=C>>8,ae[ne++]=C&255):(ae[ne++]=223,_t.setUint32(ne,C),ne+=4);for(let[$,Q]of I)S($),S(Q)}else{for(let $=0,Q=xh.length;$<Q;$++){let Y=t_[$];if(I instanceof Y){let N=xh[$];if(N.write){N.type&&(ae[ne++]=212,ae[ne++]=N.type,ae[ne++]=0);let J=N.write.call(this,I);J===I?Array.isArray(I)?A(I):P(I):S(J);return}let M=ae,U=_t,V=ne;ae=null;let q;try{q=N.pack.call(this,I,J=>(ae=M,M=null,ne+=J,ne>kr&&W(ne),{target:ae,targetView:_t,position:ne-J}),S)}finally{M&&(ae=M,_t=U,ne=V,kr=ae.length-10)}q&&(q.length+ne>kr&&W(q.length+ne),ne=i_(q,ae,ne,N.type));return}}if(Array.isArray(I))A(I);else{if(I.toJSON){const $=I.toJSON();if($!==I)return S($)}if(v==="function")return S(this.writeFunction&&this.writeFunction(I));P(I)}}}else if(v==="boolean")ae[ne++]=I?195:194;else if(v==="bigint"){if(I<9223372036854776e3&&I>=-9223372036854776e3)ae[ne++]=211,_t.setBigInt64(ne,I);else if(I<18446744073709552e3&&I>0)ae[ne++]=207,_t.setBigUint64(ne,I);else if(this.largeBigIntToFloat)ae[ne++]=203,_t.setFloat64(ne,Number(I));else{if(this.largeBigIntToString)return S(I.toString());if(this.useBigIntExtension||this.moreTypes){let z=I<0?BigInt(-1):BigInt(0),$;if(I>>BigInt(65536)===z){let Q=BigInt(18446744073709552e3)-BigInt(1),Y=[];for(;Y.push(I&Q),I>>BigInt(63)!==z;)I>>=BigInt(64);$=new Uint8Array(new BigUint64Array(Y).buffer),$.reverse()}else{let Q=I<0,Y=(Q?~I:I).toString(16);if(Y.length%2?Y="0"+Y:parseInt(Y.charAt(0),16)>=8&&(Y="00"+Y),fo)$=Vt.from(Y,"hex");else{$=new Uint8Array(Y.length/2);for(let N=0;N<$.length;N++)$[N]=parseInt(Y.slice(N*2,N*2+2),16)}if(Q)for(let N=0;N<$.length;N++)$[N]=~$[N]}$.length+ne>kr&&W($.length+ne),ne=i_($,ae,ne,66);return}else throw new RangeError(I+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}ne+=8}else if(v==="undefined")this.encodeUndefinedAsNil?ae[ne++]=192:(ae[ne++]=212,ae[ne++]=0,ae[ne++]=0);else throw new Error("Unknown type: "+v)},x=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?I=>{let v;if(this.skipValues){v=[];for(let $ in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty($))&&!this.skipValues.includes(I[$])&&v.push($)}else v=Object.keys(I);let C=v.length;C<16?ae[ne++]=128|C:C<65536?(ae[ne++]=222,ae[ne++]=C>>8,ae[ne++]=C&255):(ae[ne++]=223,_t.setUint32(ne,C),ne+=4);let z;if(this.coercibleKeyAsNumber)for(let $=0;$<C;$++){z=v[$];let Q=Number(z);S(isNaN(Q)?z:Q),S(I[z])}else for(let $=0;$<C;$++)S(z=v[$]),S(I[z])}:I=>{ae[ne++]=222;let v=ne-r;ne+=2;let C=0;for(let z in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(z))&&(S(z),S(I[z]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');ae[v+++r]=C>>8,ae[v+r]=C&255},F=this.useRecords===!1?x:e.progressiveRecords&&!d?I=>{let v,C=i.transitions||(i.transitions=Object.create(null)),z=ne++-r,$;for(let Q in I)if(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Q)){if(v=C[Q],v)C=v;else{let Y=Object.keys(I),N=C;C=i.transitions;let M=0;for(let U=0,V=Y.length;U<V;U++){let q=Y[U];v=C[q],v||(v=C[q]=Object.create(null),M++),C=v}z+r+1==ne?(ne--,D(C,Y,M)):G(C,Y,z,M),$=!0,C=N[Q]}S(I[Q])}if(!$){let Q=C[ho];Q?ae[z+r]=Q:G(C,Object.keys(I),z,0)}}:I=>{let v,C=i.transitions||(i.transitions=Object.create(null)),z=0;for(let Q in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Q))&&(v=C[Q],v||(v=C[Q]=Object.create(null),z++),C=v);let $=C[ho];$?$>=96&&d?(ae[ne++]=(($-=96)&31)+96,ae[ne++]=$>>5):ae[ne++]=$:D(C,C.__keys__||Object.keys(I),z);for(let Q in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Q))&&S(I[Q])},R=typeof this.useRecords=="function"&&this.useRecords,P=R?I=>{R(I)?F(I):x(I)}:F,W=I=>{let v;if(I>16777216){if(I-r>n_)throw new Error("Packed buffer would be larger than maximum buffer size");v=Math.min(n_,Math.round(Math.max((I-r)*(I>67108864?1.25:2),4194304)/4096)*4096)}else v=(Math.max(I-r<<2,ae.length-1)>>12)+1<<12;let C=new rl(v);return _t=C.dataView||(C.dataView=new DataView(C.buffer,0,v)),I=Math.min(I,ae.length),ae.copy?ae.copy(C,0,r,I):C.set(ae.slice(r,I)),ne-=r,r=0,kr=C.length-10,ae=C},D=(I,v,C)=>{let z=i.nextId;z||(z=64),z<f&&this.shouldShareStructure&&!this.shouldShareStructure(v)?(z=i.nextOwnId,z<m||(z=f),i.nextOwnId=z+1):(z>=m&&(z=f),i.nextId=z+1);let $=v.highByte=z>=96&&d?z-96>>5:-1;I[ho]=z,I.__keys__=v,i[z-64]=v,z<f?(v.isShared=!0,i.sharedLength=z-63,n=!0,$>=0?(ae[ne++]=(z&31)+96,ae[ne++]=$):ae[ne++]=z):($>=0?(ae[ne++]=213,ae[ne++]=114,ae[ne++]=(z&31)+96,ae[ne++]=$):(ae[ne++]=212,ae[ne++]=114,ae[ne++]=z),C&&(g+=y*C),p.length>=h&&(p.shift()[ho]=0),p.push(I),S(v))},G=(I,v,C,z)=>{let $=ae,Q=ne,Y=kr,N=r;ae=ya,ne=0,r=0,ae||(ya=ae=new rl(8192)),kr=ae.length-10,D(I,v,z),ya=ae;let M=ne;if(ae=$,ne=Q,kr=Y,r=N,M>1){let U=ne+M-1;U>kr&&W(U);let V=C+r;ae.copyWithin(V+M,V+1,ne),ae.set(ya.slice(0,M),V),ne=U}else ae[C+r]=ya[0]},O=I=>{let v=cN(I,ae,r,ne,i,W,(C,z,$)=>{if($)return n=!0;ne=z;let Q=ae;return S(C),b(),Q!==ae?{position:ne,targetView:_t,target:ae}:ne},this);if(v===0)return P(I);ne=v}}useBuffer(e){ae=e,ae.dataView||(ae.dataView=new DataView(ae.buffer,ae.byteOffset,ae.byteLength)),_t=ae.dataView,ne=0}set position(e){ne=e}get position(){return ne}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}t_=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,$y],xh=[{pack(t,e,r){let n=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,n)}else if(n>0&&n<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return e(0),r(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(t,e,r){if(this.setAsEmptyObject)return e(0),r({});let n=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([t.name,t.message,t.cause])}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([t.source,t.flags])}},{pack(t,e){this.moreTypes?Ah(t,16,e):Th(fo?Vt.from(t):new Uint8Array(t),e)}},{pack(t,e){let r=t.constructor;r!==r_&&this.moreTypes?Ah(t,Qy.indexOf(r.name),e):Th(t,e)}},{pack(t,e){this.moreTypes?Ah(t,17,e):Th(fo?Vt.from(t):new Uint8Array(t),e)}},{pack(t,e){let{target:r,position:n}=e(1);r[n]=193}}];function Ah(t,e,r,n){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=r(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=r(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=r(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Th(t,e){let r=t.byteLength;var n,i;if(r<256){var{target:n,position:i}=e(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=e(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:s}=e(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(t,i)}function i_(t,e,r,n){let i=t.length;switch(i){case 1:e[r++]=212;break;case 2:e[r++]=213;break;case 4:e[r++]=214;break;case 8:e[r++]=215;break;case 16:e[r++]=216;break;default:i<256?(e[r++]=199,e[r++]=i):i<65536?(e[r++]=200,e[r++]=i>>8,e[r++]=i&255):(e[r++]=201,e[r++]=i>>24,e[r++]=i>>16&255,e[r++]=i>>8&255,e[r++]=i&255)}return e[r++]=n,e.set(t,r),r+=i,r}function hN(t,e){let r,n=e.length*6,i=t.length-n;for(;r=e.pop();){let s=r.offset,o=r.id;t.copyWithin(s+n,s,i),n-=6;let a=s+n;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function s_(t,e,r){if(Ot.length>0){_t.setUint32(Ot.position+t,ne+r-Ot.position-t),Ot.stringsPosition=ne-t;let n=Ot;Ot=null,e(n[0]),e(n[1])}}function dN(t,e){return t.isCompatible=r=>{let n=!r||(e.lastNamedStructuresLength||0)===r.length;return n||e._mergeStructures(r),n},t}let o_=new fN({useRecords:!1});const pN=o_.pack;o_.pack;const mN=512,gN=1024,yN=2048;function Tt(){return null}function po(t,e,r={}){if(!w(t))return;const n=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=r[o];w(c)&&(a=c(a));const l=e[o];w(l)&&(o=l),a!==null&&n.push(o,a)}return n}function _a(t,e,r={}){if(w(t))try{const n={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];w(a)&&(s=a);const c=r[s];w(c)&&(o=c(o)),n[s]=o}return n}catch(n){mt(le,"","format",n.message)}}function _N(t){try{return pN(t)}catch(e){mt(le,"","format",e.message)}}function Sh(t){if(ye(t)){try{return JSON.parse(t)}catch(e){mt(le,"","format",e.message)}return}try{return oN(t)}catch(e){mt(le,"","format",e.message)}}function a_(){return{id:Ft()}}var nl=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.breakable=16]="breakable",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t[t.lightdir=31]="lightdir",t[t.item=32]="item",t[t.p4=33]="p4",t[t.p5=34]="p5",t[t.p6=35]="p6",t[t.displaychar=36]="displaychar",t[t.displaycolor=37]="displaycolor",t[t.displaybg=38]="displaybg",t[t.shootx=39]="shootx",t[t.shooty=40]="shooty",t[t.p7=41]="p7",t[t.p8=42]="p8",t[t.p9=43]="p9",t[t.p10=44]="p10",t))(nl||{});function il(t){return w(t?.id)?po(t,nl,{category:Tt,kinddata:Tt,stopped:Tt,removed:Tt,bucket:Tt}):po(t,nl,{id:Tt,x:Tt,y:Tt,lx:Tt,ly:Tt,code:Tt,category:Tt,kinddata:Tt,stopped:Tt,removed:Tt,bucket:Tt})}function sl(t){return _a(t,nl)}function jt(t){return t?.category===Ur.ISOBJECT}function ba(t,e){if(!w(t)||!Tr(e))return;const{color:r,bg:n}=Cy(e);w(r)&&(t.color=r),w(n)&&(t.bg=n)}function c_(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}function l_(t){const e=Math.floor(t.length/Vc);if(e*Vc!==t.length)return;const r=c_(3,e);for(let n=0;n<r.bits.length;++n)r.bits[n]=t[n];return r}function bN(t,e){return t&1<<e?255:0}function Rh(t){const e=Math.floor(t.length/mh);if(e*mh!==t.length)return;const r=Math.ceil(e/Xc),n=ds*Xc,i=c_(n,ps*r);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*ps+a,u=t[c];for(let h=0;h<ds;++h){const d=s*ds+h;i.bits[d+l*n]=bN(u,7-h)}++a,a===ps&&(a=0,++s,s===Xc&&(s=0,++o))}return i}const wN=gc("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),vN=gc("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var u_=typeof Gs=="object"&&Gs&&Gs.Object===Object&&Gs,EN=typeof self=="object"&&self&&self.Object===Object&&self,Qn=u_||EN||Function("return this")(),pn=Qn.Symbol,f_=Object.prototype,kN=f_.hasOwnProperty,xN=f_.toString,wa=pn?pn.toStringTag:void 0;function AN(t){var e=kN.call(t,wa),r=t[wa];try{t[wa]=void 0;var n=!0}catch{}var i=xN.call(t);return n&&(e?t[wa]=r:delete t[wa]),i}var TN=Object.prototype,SN=TN.toString;function RN(t){return SN.call(t)}var ON="[object Null]",IN="[object Undefined]",h_=pn?pn.toStringTag:void 0;function Wi(t){return t==null?t===void 0?IN:ON:h_&&h_ in Object(t)?AN(t):RN(t)}function Nn(t){return t!=null&&typeof t=="object"}var NN="[object Symbol]";function ol(t){return typeof t=="symbol"||Nn(t)&&Wi(t)==NN}function al(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var lt=Array.isArray,d_=pn?pn.prototype:void 0,p_=d_?d_.toString:void 0;function m_(t){if(typeof t=="string")return t;if(lt(t))return al(t,m_)+"";if(ol(t))return p_?p_.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var CN=/\s/;function LN(t){for(var e=t.length;e--&&CN.test(t.charAt(e)););return e}var MN=/^\s+/;function UN(t){return t&&t.slice(0,LN(t)+1).replace(MN,"")}function mn(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var g_=NaN,FN=/^[-+]0x[0-9a-f]+$/i,PN=/^0b[01]+$/i,$N=/^0o[0-7]+$/i,BN=parseInt;function DN(t){if(typeof t=="number")return t;if(ol(t))return g_;if(mn(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=mn(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=UN(t);var r=PN.test(t);return r||$N.test(t)?BN(t.slice(2),r?2:8):FN.test(t)?g_:+t}var y_=1/0,jN=17976931348623157e292;function zN(t){if(!t)return t===0?t:0;if(t=DN(t),t===y_||t===-y_){var e=t<0?-1:1;return e*jN}return t===t?t:0}function cl(t){var e=zN(t),r=e%1;return e===e?r?e-r:e:0}function mo(t){return t}var WN="[object AsyncFunction]",HN="[object Function]",GN="[object GeneratorFunction]",KN="[object Proxy]";function bi(t){if(!mn(t))return!1;var e=Wi(t);return e==HN||e==GN||e==WN||e==KN}var Oh=Qn["__core-js_shared__"],__=(function(){var t=/[^.]+$/.exec(Oh&&Oh.keys&&Oh.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function qN(t){return!!__&&__ in t}var YN=Function.prototype,VN=YN.toString;function ys(t){if(t!=null){try{return VN.call(t)}catch{}try{return t+""}catch{}}return""}var XN=/[\\^$.*+?()[\]{}|]/g,ZN=/^\[object .+?Constructor\]$/,JN=Function.prototype,QN=Object.prototype,eC=JN.toString,tC=QN.hasOwnProperty,rC=RegExp("^"+eC.call(tC).replace(XN,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nC(t){if(!mn(t)||qN(t))return!1;var e=bi(t)?rC:ZN;return e.test(ys(t))}function iC(t,e){return t?.[e]}function _s(t,e){var r=iC(t,e);return nC(r)?r:void 0}var Ih=_s(Qn,"WeakMap"),b_=Object.create,sC=(function(){function t(){}return function(e){if(!mn(e))return{};if(b_)return b_(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})();function oC(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function Jt(){}function aC(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var cC=800,lC=16,uC=Date.now;function fC(t){var e=0,r=0;return function(){var n=uC(),i=lC-(n-r);if(r=n,i>0){if(++e>=cC)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function hC(t){return function(){return t}}var ll=(function(){try{var t=_s(Object,"defineProperty");return t({},"",{}),t}catch{}})(),dC=ll?function(t,e){return ll(t,"toString",{configurable:!0,enumerable:!1,value:hC(e),writable:!0})}:mo,pC=fC(dC);function w_(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}function v_(t,e,r,n){for(var i=t.length,s=r+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function mC(t){return t!==t}function gC(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}function Nh(t,e,r){return e===e?gC(t,e,r):v_(t,mC,r)}function E_(t,e){var r=t==null?0:t.length;return!!r&&Nh(t,e,0)>-1}var yC=9007199254740991,_C=/^(?:0|[1-9]\d*)$/;function ul(t,e){var r=typeof t;return e=e??yC,!!e&&(r=="number"||r!="symbol"&&_C.test(t))&&t>-1&&t%1==0&&t<e}function Ch(t,e,r){e=="__proto__"&&ll?ll(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function va(t,e){return t===e||t!==t&&e!==e}var bC=Object.prototype,wC=bC.hasOwnProperty;function fl(t,e,r){var n=t[e];(!(wC.call(t,e)&&va(n,r))||r===void 0&&!(e in t))&&Ch(t,e,r)}function Ea(t,e,r,n){var i=!r;r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Ch(r,a,c):fl(r,a,c)}return r}var k_=Math.max;function vC(t,e,r){return e=k_(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=k_(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),oC(t,this,a)}}function Lh(t,e){return pC(vC(t,e,mo),t+"")}var EC=9007199254740991;function Mh(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=EC}function ei(t){return t!=null&&Mh(t.length)&&!bi(t)}function x_(t,e,r){if(!mn(r))return!1;var n=typeof e;return(n=="number"?ei(r)&&ul(e,r.length):n=="string"&&e in r)?va(r[e],t):!1}function kC(t){return Lh(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&x_(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,s)}return e})}var xC=Object.prototype;function ka(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||xC;return t===r}function AC(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var TC="[object Arguments]";function A_(t){return Nn(t)&&Wi(t)==TC}var T_=Object.prototype,SC=T_.hasOwnProperty,RC=T_.propertyIsEnumerable,hl=A_((function(){return arguments})())?A_:function(t){return Nn(t)&&SC.call(t,"callee")&&!RC.call(t,"callee")};function OC(){return!1}var S_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,R_=S_&&typeof module=="object"&&module&&!module.nodeType&&module,IC=R_&&R_.exports===S_,O_=IC?Qn.Buffer:void 0,NC=O_?O_.isBuffer:void 0,xa=NC||OC,CC="[object Arguments]",LC="[object Array]",MC="[object Boolean]",UC="[object Date]",FC="[object Error]",PC="[object Function]",$C="[object Map]",BC="[object Number]",DC="[object Object]",jC="[object RegExp]",zC="[object Set]",WC="[object String]",HC="[object WeakMap]",GC="[object ArrayBuffer]",KC="[object DataView]",qC="[object Float32Array]",YC="[object Float64Array]",VC="[object Int8Array]",XC="[object Int16Array]",ZC="[object Int32Array]",JC="[object Uint8Array]",QC="[object Uint8ClampedArray]",eL="[object Uint16Array]",tL="[object Uint32Array]",xt={};xt[qC]=xt[YC]=xt[VC]=xt[XC]=xt[ZC]=xt[JC]=xt[QC]=xt[eL]=xt[tL]=!0,xt[CC]=xt[LC]=xt[GC]=xt[MC]=xt[KC]=xt[UC]=xt[FC]=xt[PC]=xt[$C]=xt[BC]=xt[DC]=xt[jC]=xt[zC]=xt[WC]=xt[HC]=!1;function rL(t){return Nn(t)&&Mh(t.length)&&!!xt[Wi(t)]}function dl(t){return function(e){return t(e)}}var I_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Aa=I_&&typeof module=="object"&&module&&!module.nodeType&&module,nL=Aa&&Aa.exports===I_,Uh=nL&&u_.process,Hi=(function(){try{var t=Aa&&Aa.require&&Aa.require("util").types;return t||Uh&&Uh.binding&&Uh.binding("util")}catch{}})(),N_=Hi&&Hi.isTypedArray,Fh=N_?dl(N_):rL,iL=Object.prototype,sL=iL.hasOwnProperty;function C_(t,e){var r=lt(t),n=!r&&hl(t),i=!r&&!n&&xa(t),s=!r&&!n&&!i&&Fh(t),o=r||n||i||s,a=o?AC(t.length,String):[],c=a.length;for(var l in t)(e||sL.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ul(l,c)))&&a.push(l);return a}function L_(t,e){return function(r){return t(e(r))}}var oL=L_(Object.keys,Object),aL=Object.prototype,cL=aL.hasOwnProperty;function M_(t){if(!ka(t))return oL(t);var e=[];for(var r in Object(t))cL.call(t,r)&&r!="constructor"&&e.push(r);return e}function gn(t){return ei(t)?C_(t):M_(t)}var lL=Object.prototype,uL=lL.hasOwnProperty,Br=kC(function(t,e){if(ka(e)||ei(e)){Ea(e,gn(e),t);return}for(var r in e)uL.call(e,r)&&fl(t,r,e[r])});function fL(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var hL=Object.prototype,dL=hL.hasOwnProperty;function pL(t){if(!mn(t))return fL(t);var e=ka(t),r=[];for(var n in t)n=="constructor"&&(e||!dL.call(t,n))||r.push(n);return r}function Ph(t){return ei(t)?C_(t,!0):pL(t)}var mL=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,gL=/^\w*$/;function $h(t,e){if(lt(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||ol(t)?!0:gL.test(t)||!mL.test(t)||e!=null&&t in Object(e)}var Ta=_s(Object,"create");function yL(){this.__data__=Ta?Ta(null):{},this.size=0}function _L(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var bL="__lodash_hash_undefined__",wL=Object.prototype,vL=wL.hasOwnProperty;function EL(t){var e=this.__data__;if(Ta){var r=e[t];return r===bL?void 0:r}return vL.call(e,t)?e[t]:void 0}var kL=Object.prototype,xL=kL.hasOwnProperty;function AL(t){var e=this.__data__;return Ta?e[t]!==void 0:xL.call(e,t)}var TL="__lodash_hash_undefined__";function SL(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ta&&e===void 0?TL:e,this}function bs(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}bs.prototype.clear=yL,bs.prototype.delete=_L,bs.prototype.get=EL,bs.prototype.has=AL,bs.prototype.set=SL;function RL(){this.__data__=[],this.size=0}function pl(t,e){for(var r=t.length;r--;)if(va(t[r][0],e))return r;return-1}var OL=Array.prototype,IL=OL.splice;function NL(t){var e=this.__data__,r=pl(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():IL.call(e,r,1),--this.size,!0}function CL(t){var e=this.__data__,r=pl(e,t);return r<0?void 0:e[r][1]}function LL(t){return pl(this.__data__,t)>-1}function ML(t,e){var r=this.__data__,n=pl(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function wi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}wi.prototype.clear=RL,wi.prototype.delete=NL,wi.prototype.get=CL,wi.prototype.has=LL,wi.prototype.set=ML;var Sa=_s(Qn,"Map");function UL(){this.size=0,this.__data__={hash:new bs,map:new(Sa||wi),string:new bs}}function FL(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ml(t,e){var r=t.__data__;return FL(e)?r[typeof e=="string"?"string":"hash"]:r.map}function PL(t){var e=ml(this,t).delete(t);return this.size-=e?1:0,e}function $L(t){return ml(this,t).get(t)}function BL(t){return ml(this,t).has(t)}function DL(t,e){var r=ml(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function vi(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}vi.prototype.clear=UL,vi.prototype.delete=PL,vi.prototype.get=$L,vi.prototype.has=BL,vi.prototype.set=DL;var jL="Expected a function";function Bh(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(jL);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(Bh.Cache||vi),r}Bh.Cache=vi;var zL=500;function WL(t){var e=Bh(t,function(n){return r.size===zL&&r.clear(),n}),r=e.cache;return e}var HL=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,GL=/\\(\\)?/g,KL=WL(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(HL,function(r,n,i,s){e.push(i?s.replace(GL,"$1"):n||r)}),e});function U_(t){return t==null?"":m_(t)}function gl(t,e){return lt(t)?t:$h(t,e)?[t]:KL(U_(t))}function Ra(t){if(typeof t=="string"||ol(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Dh(t,e){e=gl(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Ra(e[r++])];return r&&r==n?t:void 0}function qL(t,e,r){var n=t==null?void 0:Dh(t,e);return n===void 0?r:n}function jh(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var F_=pn?pn.isConcatSpreadable:void 0;function YL(t){return lt(t)||hl(t)||!!(F_&&t&&t[F_])}function zh(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=YL),i||(i=[]);++s<o;){var a=t[s];r(a)?jh(i,a):n||(i[i.length]=a)}return i}function rn(t){var e=t==null?0:t.length;return e?zh(t):[]}var P_=L_(Object.getPrototypeOf,Object);function Wh(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s}function VL(t,e,r){var n=t.length;return r=r===void 0?n:r,!e&&r>=n?t:Wh(t,e,r)}var XL="\\ud800-\\udfff",ZL="\\u0300-\\u036f",JL="\\ufe20-\\ufe2f",QL="\\u20d0-\\u20ff",e6=ZL+JL+QL,t6="\\ufe0e\\ufe0f",r6="\\u200d",n6=RegExp("["+r6+XL+e6+t6+"]");function $_(t){return n6.test(t)}function i6(t){return t.split("")}var B_="\\ud800-\\udfff",s6="\\u0300-\\u036f",o6="\\ufe20-\\ufe2f",a6="\\u20d0-\\u20ff",c6=s6+o6+a6,l6="\\ufe0e\\ufe0f",u6="["+B_+"]",Hh="["+c6+"]",Gh="\\ud83c[\\udffb-\\udfff]",f6="(?:"+Hh+"|"+Gh+")",D_="[^"+B_+"]",j_="(?:\\ud83c[\\udde6-\\uddff]){2}",z_="[\\ud800-\\udbff][\\udc00-\\udfff]",h6="\\u200d",W_=f6+"?",H_="["+l6+"]?",d6="(?:"+h6+"(?:"+[D_,j_,z_].join("|")+")"+H_+W_+")*",p6=H_+W_+d6,m6="(?:"+[D_+Hh+"?",Hh,j_,z_,u6].join("|")+")",g6=RegExp(Gh+"(?="+Gh+")|"+m6+p6,"g");function y6(t){return t.match(g6)||[]}function _6(t){return $_(t)?y6(t):i6(t)}function b6(t){return function(e){e=U_(e);var r=$_(e)?_6(e):void 0,n=r?r[0]:e.charAt(0),i=r?VL(r,1).join(""):e.slice(1);return n[t]()+i}}var G_=b6("toUpperCase");function w6(t,e,r,n){var i=-1,s=t==null?0:t.length;for(n&&s&&(r=t[++i]);++i<s;)r=e(r,t[i],i,t);return r}function v6(){this.__data__=new wi,this.size=0}function E6(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function k6(t){return this.__data__.get(t)}function x6(t){return this.__data__.has(t)}var A6=200;function T6(t,e){var r=this.__data__;if(r instanceof wi){var n=r.__data__;if(!Sa||n.length<A6-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new vi(n)}return r.set(t,e),this.size=r.size,this}function ti(t){var e=this.__data__=new wi(t);this.size=e.size}ti.prototype.clear=v6,ti.prototype.delete=E6,ti.prototype.get=k6,ti.prototype.has=x6,ti.prototype.set=T6;function S6(t,e){return t&&Ea(e,gn(e),t)}function R6(t,e){return t&&Ea(e,Ph(e),t)}var K_=typeof exports=="object"&&exports&&!exports.nodeType&&exports,q_=K_&&typeof module=="object"&&module&&!module.nodeType&&module,O6=q_&&q_.exports===K_,Y_=O6?Qn.Buffer:void 0,V_=Y_?Y_.allocUnsafe:void 0;function I6(t,e){var r=t.length,n=V_?V_(r):new t.constructor(r);return t.copy(n),n}function Kh(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}function X_(){return[]}var N6=Object.prototype,C6=N6.propertyIsEnumerable,Z_=Object.getOwnPropertySymbols,qh=Z_?function(t){return t==null?[]:(t=Object(t),Kh(Z_(t),function(e){return C6.call(t,e)}))}:X_;function L6(t,e){return Ea(t,qh(t),e)}var M6=Object.getOwnPropertySymbols,J_=M6?function(t){for(var e=[];t;)jh(e,qh(t)),t=P_(t);return e}:X_;function U6(t,e){return Ea(t,J_(t),e)}function Q_(t,e,r){var n=e(t);return lt(t)?n:jh(n,r(t))}function Yh(t){return Q_(t,gn,qh)}function F6(t){return Q_(t,Ph,J_)}var Vh=_s(Qn,"DataView"),Xh=_s(Qn,"Promise"),go=_s(Qn,"Set"),eb="[object Map]",P6="[object Object]",tb="[object Promise]",rb="[object Set]",nb="[object WeakMap]",ib="[object DataView]",$6=ys(Vh),B6=ys(Sa),D6=ys(Xh),j6=ys(go),z6=ys(Ih),yn=Wi;(Vh&&yn(new Vh(new ArrayBuffer(1)))!=ib||Sa&&yn(new Sa)!=eb||Xh&&yn(Xh.resolve())!=tb||go&&yn(new go)!=rb||Ih&&yn(new Ih)!=nb)&&(yn=function(t){var e=Wi(t),r=e==P6?t.constructor:void 0,n=r?ys(r):"";if(n)switch(n){case $6:return ib;case B6:return eb;case D6:return tb;case j6:return rb;case z6:return nb}return e});var W6=Object.prototype,H6=W6.hasOwnProperty;function G6(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&H6.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var yl=Qn.Uint8Array;function K6(t){var e=new t.constructor(t.byteLength);return new yl(e).set(new yl(t)),e}function q6(t,e){var r=t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var Y6=/\w*$/;function V6(t){var e=new t.constructor(t.source,Y6.exec(t));return e.lastIndex=t.lastIndex,e}var sb=pn?pn.prototype:void 0,ob=sb?sb.valueOf:void 0;function X6(t){return ob?Object(ob.call(t)):{}}function Z6(t,e){var r=t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var J6="[object Boolean]",Q6="[object Date]",eM="[object Map]",tM="[object Number]",rM="[object RegExp]",nM="[object Set]",iM="[object String]",sM="[object Symbol]",oM="[object ArrayBuffer]",aM="[object DataView]",cM="[object Float32Array]",lM="[object Float64Array]",uM="[object Int8Array]",fM="[object Int16Array]",hM="[object Int32Array]",dM="[object Uint8Array]",pM="[object Uint8ClampedArray]",mM="[object Uint16Array]",gM="[object Uint32Array]";function yM(t,e,r){var n=t.constructor;switch(e){case oM:return K6(t);case J6:case Q6:return new n(+t);case aM:return q6(t);case cM:case lM:case uM:case fM:case hM:case dM:case pM:case mM:case gM:return Z6(t);case eM:return new n;case tM:case iM:return new n(t);case rM:return V6(t);case nM:return new n;case sM:return X6(t)}}function _M(t){return typeof t.constructor=="function"&&!ka(t)?sC(P_(t)):{}}var bM="[object Map]";function wM(t){return Nn(t)&&yn(t)==bM}var ab=Hi&&Hi.isMap,vM=ab?dl(ab):wM,EM="[object Set]";function kM(t){return Nn(t)&&yn(t)==EM}var cb=Hi&&Hi.isSet,xM=cb?dl(cb):kM,AM=2,lb="[object Arguments]",TM="[object Array]",SM="[object Boolean]",RM="[object Date]",OM="[object Error]",ub="[object Function]",IM="[object GeneratorFunction]",NM="[object Map]",CM="[object Number]",fb="[object Object]",LM="[object RegExp]",MM="[object Set]",UM="[object String]",FM="[object Symbol]",PM="[object WeakMap]",$M="[object ArrayBuffer]",BM="[object DataView]",DM="[object Float32Array]",jM="[object Float64Array]",zM="[object Int8Array]",WM="[object Int16Array]",HM="[object Int32Array]",GM="[object Uint8Array]",KM="[object Uint8ClampedArray]",qM="[object Uint16Array]",YM="[object Uint32Array]",vt={};vt[lb]=vt[TM]=vt[$M]=vt[BM]=vt[SM]=vt[RM]=vt[DM]=vt[jM]=vt[zM]=vt[WM]=vt[HM]=vt[NM]=vt[CM]=vt[fb]=vt[LM]=vt[MM]=vt[UM]=vt[FM]=vt[GM]=vt[KM]=vt[qM]=vt[YM]=!0,vt[OM]=vt[ub]=vt[PM]=!1;function _l(t,e,r,n,i,s){var o,a=e&AM;if(o!==void 0)return o;if(!mn(t))return t;var c=lt(t);if(c)return o=G6(t),aC(t,o);var l=yn(t),u=l==ub||l==IM;if(xa(t))return I6(t);if(l==fb||l==lb||u&&!i)return o=u?{}:_M(t),a?U6(t,R6(o,t)):L6(t,S6(o,t));if(!vt[l])return i?t:{};o=yM(t,l),s||(s=new ti);var h=s.get(t);if(h)return h;s.set(t,o),xM(t)?t.forEach(function(m){o.add(_l(m,e,r,m,t,s))}):vM(t)&&t.forEach(function(m,p){o.set(p,_l(m,e,r,p,t,s))});var d=Yh,f=c?void 0:d(t);return w_(f||t,function(m,p){f&&(p=m,m=t[p]),fl(o,p,_l(m,e,r,p,t,s))}),o}var VM=4;function _r(t){return _l(t,VM)}function Oa(t){for(var e=-1,r=t==null?0:t.length,n=0,i=[];++e<r;){var s=t[e];s&&(i[n++]=s)}return i}var XM="__lodash_hash_undefined__";function ZM(t){return this.__data__.set(t,XM),this}function JM(t){return this.__data__.has(t)}function yo(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new vi;++e<r;)this.add(t[e])}yo.prototype.add=yo.prototype.push=ZM,yo.prototype.has=JM;function hb(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function Zh(t,e){return t.has(e)}var QM=1,eU=2;function db(t,e,r,n,i,s){var o=r&QM,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,f=r&eU?new yo:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var m=t[h],p=e[h];if(n)var g=o?n(p,m,h,e,t,s):n(m,p,h,t,e,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!hb(e,function(y,b){if(!Zh(f,b)&&(m===y||i(m,y,r,n,s)))return f.push(b)})){d=!1;break}}else if(!(m===p||i(m,p,r,n,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function tU(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}function Jh(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var rU=1,nU=2,iU="[object Boolean]",sU="[object Date]",oU="[object Error]",aU="[object Map]",cU="[object Number]",lU="[object RegExp]",uU="[object Set]",fU="[object String]",hU="[object Symbol]",dU="[object ArrayBuffer]",pU="[object DataView]",pb=pn?pn.prototype:void 0,Qh=pb?pb.valueOf:void 0;function mU(t,e,r,n,i,s,o){switch(r){case pU:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case dU:return!(t.byteLength!=e.byteLength||!s(new yl(t),new yl(e)));case iU:case sU:case cU:return va(+t,+e);case oU:return t.name==e.name&&t.message==e.message;case lU:case fU:return t==e+"";case aU:var a=tU;case uU:var c=n&rU;if(a||(a=Jh),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;n|=nU,o.set(t,e);var u=db(a(t),a(e),n,i,s,o);return o.delete(t),u;case hU:if(Qh)return Qh.call(t)==Qh.call(e)}return!1}var gU=1,yU=Object.prototype,_U=yU.hasOwnProperty;function bU(t,e,r,n,i,s){var o=r&gU,a=Yh(t),c=a.length,l=Yh(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:_U.call(e,d)))return!1}var f=s.get(t),m=s.get(e);if(f&&m)return f==e&&m==t;var p=!0;s.set(t,e),s.set(e,t);for(var g=o;++h<c;){d=a[h];var y=t[d],b=e[d];if(n)var A=o?n(b,y,d,e,t,s):n(y,b,d,t,e,s);if(!(A===void 0?y===b||i(y,b,r,n,s):A)){p=!1;break}g||(g=d=="constructor")}if(p&&!g){var S=t.constructor,x=e.constructor;S!=x&&"constructor"in t&&"constructor"in e&&!(typeof S=="function"&&S instanceof S&&typeof x=="function"&&x instanceof x)&&(p=!1)}return s.delete(t),s.delete(e),p}var wU=1,mb="[object Arguments]",gb="[object Array]",bl="[object Object]",vU=Object.prototype,yb=vU.hasOwnProperty;function EU(t,e,r,n,i,s){var o=lt(t),a=lt(e),c=o?gb:yn(t),l=a?gb:yn(e);c=c==mb?bl:c,l=l==mb?bl:l;var u=c==bl,h=l==bl,d=c==l;if(d&&xa(t)){if(!xa(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ti),o||Fh(t)?db(t,e,r,n,i,s):mU(t,e,c,r,n,i,s);if(!(r&wU)){var f=u&&yb.call(t,"__wrapped__"),m=h&&yb.call(e,"__wrapped__");if(f||m){var p=f?t.value():t,g=m?e.value():e;return s||(s=new ti),i(p,g,r,n,s)}}return d?(s||(s=new ti),bU(t,e,r,n,i,s)):!1}function ed(t,e,r,n,i){return t===e?!0:t==null||e==null||!Nn(t)&&!Nn(e)?t!==t&&e!==e:EU(t,e,r,n,ed,i)}var kU=1,xU=2;function AU(t,e,r,n){var i=r.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=r[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=r[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new ti,h;if(!(h===void 0?ed(l,c,kU|xU,n,u):h))return!1}}return!0}function _b(t){return t===t&&!mn(t)}function TU(t){for(var e=gn(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,_b(i)]}return e}function bb(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}function SU(t){var e=TU(t);return e.length==1&&e[0][2]?bb(e[0][0],e[0][1]):function(r){return r===t||AU(r,t,e)}}function RU(t,e){return t!=null&&e in Object(t)}function wb(t,e,r){e=gl(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=Ra(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&Mh(i)&&ul(o,i)&&(lt(t)||hl(t)))}function OU(t,e){return t!=null&&wb(t,e,RU)}var IU=1,NU=2;function CU(t,e){return $h(t)&&_b(e)?bb(Ra(t),e):function(r){var n=qL(r,t);return n===void 0&&n===e?OU(r,t):ed(e,n,IU|NU)}}function LU(t){return function(e){return e?.[t]}}function MU(t){return function(e){return Dh(e,t)}}function UU(t){return $h(t)?LU(Ra(t)):MU(t)}function ri(t){return typeof t=="function"?t:t==null?mo:typeof t=="object"?lt(t)?CU(t[0],t[1]):SU(t):UU(t)}function FU(t,e,r,n){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(n,o,r(o),t)}return n}function PU(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var c=o[++i];if(r(s[c],c,s)===!1)break}return e}}var $U=PU();function BU(t,e){return t&&$U(t,e,gn)}function DU(t,e){return function(r,n){if(r==null)return r;if(!ei(r))return t(r,n);for(var i=r.length,s=-1,o=Object(r);++s<i&&n(o[s],s,o)!==!1;);return r}}var ws=DU(BU);function jU(t,e,r,n){return ws(t,function(i,s,o){e(n,i,r(i),o)}),n}function zU(t,e){return function(r,n){var i=lt(r)?FU:jU,s=e?e():{};return i(r,t,ri(n),s)}}var vb=Object.prototype,WU=vb.hasOwnProperty,td=Lh(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&x_(e[0],e[1],i)&&(n=1);++r<n;)for(var s=e[r],o=Ph(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||va(u,vb[l])&&!WU.call(t,l))&&(t[l]=s[l])}return t});function Eb(t){return Nn(t)&&ei(t)}var HU=200;function GU(t,e,r,n){var i=-1,s=E_,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=HU&&(s=Zh,o=!1,e=new yo(e));e:for(;++i<a;){var u=t[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else s(e,h,n)||c.push(u)}return c}var wl=Lh(function(t,e){return Eb(t)?GU(t,zh(e,1,Eb,!0)):[]});function _o(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function br(t,e,r){var n=t==null?0:t.length;return n?(e=e===void 0?1:cl(e),Wh(t,e<0?0:e,n)):[]}function Ia(t,e,r){var n=t==null?0:t.length;return n?(e=e===void 0?1:cl(e),e=n-e,Wh(t,0,e<0?0:e)):[]}function KU(t){return typeof t=="function"?t:mo}function Ye(t,e){var r=lt(t)?w_:ws;return r(t,KU(e))}function qU(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}function YU(t,e){var r=!0;return ws(t,function(n,i,s){return r=!!e(n,i,s),r}),r}function Cn(t,e,r){var n=lt(t)?qU:YU;return n(t,ri(e))}function kb(t,e){var r=[];return ws(t,function(n,i,s){e(n,i,s)&&r.push(n)}),r}function _n(t,e){var r=lt(t)?Kh:kb;return r(t,ri(e))}function VU(t){return function(e,r,n){var i=Object(e);if(!ei(e)){var s=ri(r);e=gn(e),r=function(a){return s(i[a],a,i)}}var o=t(e,r,n);return o>-1?i[s?e[o]:o]:void 0}}var XU=Math.max;function ZU(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:cl(r);return i<0&&(i=XU(n+i,0)),v_(t,ri(e),i)}var bo=VU(ZU);function Ln(t){return t&&t.length?t[0]:void 0}function JU(t,e){var r=-1,n=ei(t)?Array(t.length):[];return ws(t,function(i,s,o){n[++r]=e(i,s,o)}),n}function Ue(t,e){var r=lt(t)?al:JU;return r(t,ri(e))}function bn(t,e){return zh(Ue(t,e))}var QU=Object.prototype,e8=QU.hasOwnProperty,xb=zU(function(t,e,r){e8.call(t,r)?t[r].push(e):Ch(t,r,[e])}),t8=Object.prototype,r8=t8.hasOwnProperty;function n8(t,e){return t!=null&&r8.call(t,e)}function Ke(t,e){return t!=null&&wb(t,e,n8)}var i8="[object String]";function Dr(t){return typeof t=="string"||!lt(t)&&Nn(t)&&Wi(t)==i8}function s8(t,e){return al(e,function(r){return t[r]})}function Kt(t){return t==null?[]:s8(t,gn(t))}var o8=Math.max;function Rr(t,e,r,n){t=ei(t)?t:Kt(t),r=r?cl(r):0;var i=t.length;return r<0&&(r=o8(i+r,0)),Dr(t)?r<=i&&t.indexOf(e,r)>-1:!!i&&Nh(t,e,r)>-1}function Ab(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=0;return Nh(t,e,i)}var a8="[object Map]",c8="[object Set]",l8=Object.prototype,u8=l8.hasOwnProperty;function Et(t){if(t==null)return!0;if(ei(t)&&(lt(t)||typeof t=="string"||typeof t.splice=="function"||xa(t)||Fh(t)||hl(t)))return!t.length;var e=yn(t);if(e==a8||e==c8)return!t.size;if(ka(t))return!M_(t).length;for(var r in t)if(u8.call(t,r))return!1;return!0}var f8="[object RegExp]";function h8(t){return Nn(t)&&Wi(t)==f8}var Tb=Hi&&Hi.isRegExp,Ei=Tb?dl(Tb):h8;function ki(t){return t===void 0}var d8="Expected a function";function p8(t){if(typeof t!="function")throw new TypeError(d8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function m8(t,e,r,n){if(!mn(t))return t;e=gl(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=Ra(e[i]),l=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=mn(u)?u:ul(e[i+1])?[]:{})}fl(a,c,l),a=a[c]}return t}function g8(t,e,r){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=Dh(t,o);r(a,o)&&m8(s,gl(o,t),a)}return s}function Mn(t,e){if(t==null)return{};var r=al(F6(t),function(n){return[n]});return e=ri(e),g8(t,r,function(n,i){return e(n,i[0])})}function y8(t,e,r,n,i){return i(t,function(s,o,a){r=n?(n=!1,s):e(r,s,o,a)}),r}function jr(t,e,r){var n=lt(t)?w6:y8,i=arguments.length<3;return n(t,ri(e),r,i,ws)}function vl(t,e){var r=lt(t)?Kh:kb;return r(t,p8(ri(e)))}function _8(t,e){var r;return ws(t,function(n,i,s){return r=e(n,i,s),!r}),!!r}function rd(t,e,r){var n=lt(t)?hb:_8;return n(t,ri(e))}var b8=1/0,w8=go&&1/Jh(new go([,-0]))[1]==b8?function(t){return new go(t)}:Jt,v8=200;function E8(t,e,r){var n=-1,i=E_,s=t.length,o=!0,a=[],c=a;if(s>=v8){var l=w8(t);if(l)return Jh(l);o=!1,i=Zh,c=new yo}else c=a;e:for(;++n<s;){var u=t[n],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(u)}else i(c,h,r)||(c!==a&&c.push(h),a.push(u))}return a}function El(t){return t&&t.length?E8(t):[]}function nd(t){console&&console.error&&console.error(`Error: ${t}`)}function Sb(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function Rb(t){const e=new Date().getTime(),r=t();return{time:new Date().getTime()-e,value:r}}function Ob(t){function e(){}e.prototype=t;const r=new e;function n(){return typeof r.bar}return n(),n(),t}function k8(t){return x8(t)?t.LABEL:t.name}function x8(t){return Dr(t.LABEL)&&t.LABEL!==""}class ni{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Ye(this.definition,r=>{r.accept(e)})}}class zr extends ni{constructor(e){super([]),this.idx=1,Br(this,Mn(e,r=>r!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class wo extends ni{constructor(e){super(e.definition),this.orgText="",Br(this,Mn(e,r=>r!==void 0))}}class Wr extends ni{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Br(this,Mn(e,r=>r!==void 0))}}class Hr extends ni{constructor(e){super(e.definition),this.idx=1,Br(this,Mn(e,r=>r!==void 0))}}class ii extends ni{constructor(e){super(e.definition),this.idx=1,Br(this,Mn(e,r=>r!==void 0))}}class si extends ni{constructor(e){super(e.definition),this.idx=1,Br(this,Mn(e,r=>r!==void 0))}}class Qt extends ni{constructor(e){super(e.definition),this.idx=1,Br(this,Mn(e,r=>r!==void 0))}}class Un extends ni{constructor(e){super(e.definition),this.idx=1,Br(this,Mn(e,r=>r!==void 0))}}class Fn extends ni{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Br(this,Mn(e,r=>r!==void 0))}}class It{constructor(e){this.idx=1,Br(this,Mn(e,r=>r!==void 0))}accept(e){e.visit(this)}}function A8(t){return Ue(t,kl)}function kl(t){function e(r){return Ue(r,kl)}if(t instanceof zr){const r={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Dr(t.label)&&(r.label=t.label),r}else{if(t instanceof Wr)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Hr)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof ii)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof si)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:kl(new It({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Un)return{type:"RepetitionWithSeparator",idx:t.idx,separator:kl(new It({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Qt)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Fn)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof It){const r={type:"Terminal",name:t.terminalType.name,label:k8(t.terminalType),idx:t.idx};Dr(t.label)&&(r.terminalLabel=t.label);const n=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(r.pattern=Ei(n)?n.source:n),r}else{if(t instanceof wo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class vs{visit(e){const r=e;switch(r.constructor){case zr:return this.visitNonTerminal(r);case Wr:return this.visitAlternative(r);case Hr:return this.visitOption(r);case ii:return this.visitRepetitionMandatory(r);case si:return this.visitRepetitionMandatoryWithSeparator(r);case Un:return this.visitRepetitionWithSeparator(r);case Qt:return this.visitRepetition(r);case Fn:return this.visitAlternation(r);case It:return this.visitTerminal(r);case wo:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function T8(t){return t instanceof Wr||t instanceof Hr||t instanceof Qt||t instanceof ii||t instanceof si||t instanceof Un||t instanceof It||t instanceof wo}function xl(t,e=[]){return t instanceof Hr||t instanceof Qt||t instanceof Un?!0:t instanceof Fn?rd(t.definition,n=>xl(n,e)):t instanceof zr&&Rr(e,t)?!1:t instanceof ni?(t instanceof zr&&e.push(t),Cn(t.definition,n=>xl(n,e))):!1}function S8(t){return t instanceof Fn}function oi(t){if(t instanceof zr)return"SUBRULE";if(t instanceof Hr)return"OPTION";if(t instanceof Fn)return"OR";if(t instanceof ii)return"AT_LEAST_ONE";if(t instanceof si)return"AT_LEAST_ONE_SEP";if(t instanceof Un)return"MANY_SEP";if(t instanceof Qt)return"MANY";if(t instanceof It)return"CONSUME";throw Error("non exhaustive match")}class Al{walk(e,r=[]){Ye(e.definition,(n,i)=>{const s=br(e.definition,i+1);if(n instanceof zr)this.walkProdRef(n,s,r);else if(n instanceof It)this.walkTerminal(n,s,r);else if(n instanceof Wr)this.walkFlat(n,s,r);else if(n instanceof Hr)this.walkOption(n,s,r);else if(n instanceof ii)this.walkAtLeastOne(n,s,r);else if(n instanceof si)this.walkAtLeastOneSep(n,s,r);else if(n instanceof Un)this.walkManySep(n,s,r);else if(n instanceof Qt)this.walkMany(n,s,r);else if(n instanceof Fn)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(e,r,n){}walkProdRef(e,r,n){}walkFlat(e,r,n){const i=r.concat(n);this.walk(e,i)}walkOption(e,r,n){const i=r.concat(n);this.walk(e,i)}walkAtLeastOne(e,r,n){const i=[new Hr({definition:e.definition})].concat(r,n);this.walk(e,i)}walkAtLeastOneSep(e,r,n){const i=Ib(e,r,n);this.walk(e,i)}walkMany(e,r,n){const i=[new Hr({definition:e.definition})].concat(r,n);this.walk(e,i)}walkManySep(e,r,n){const i=Ib(e,r,n);this.walk(e,i)}walkOr(e,r,n){const i=r.concat(n);Ye(e.definition,s=>{const o=new Wr({definition:[s]});this.walk(o,i)})}}function Ib(t,e,r){return[new Hr({definition:[new It({terminalType:t.separator})].concat(t.definition)})].concat(e,r)}function Na(t){if(t instanceof zr)return Na(t.referencedRule);if(t instanceof It)return I8(t);if(T8(t))return R8(t);if(S8(t))return O8(t);throw Error("non exhaustive match")}function R8(t){let e=[];const r=t.definition;let n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=xl(s),e=e.concat(Na(s)),n=n+1,i=r.length>n;return El(e)}function O8(t){const e=Ue(t.definition,r=>Na(r));return El(rn(e))}function I8(t){return[t.terminalType]}const Nb="_~IN~_";class N8 extends Al{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,r,n){}walkProdRef(e,r,n){const i=L8(e.referencedRule,e.idx)+this.topProd.name,s=r.concat(n),o=new Wr({definition:s}),a=Na(o);this.follows[i]=a}}function C8(t){const e={};return Ye(t,r=>{const n=new N8(r).startWalking();Br(e,n)}),e}function L8(t,e){return t.name+e+Nb}function Ve(t){return t.charCodeAt(0)}function id(t,e){Array.isArray(t)?t.forEach(function(r){e.push(r)}):e.push(t)}function Ca(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function vo(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function M8(){throw Error("Internal Error - Should never get here!")}function Cb(t){return t.type==="Character"}const Tl=[];for(let t=Ve("0");t<=Ve("9");t++)Tl.push(t);const Sl=[Ve("_")].concat(Tl);for(let t=Ve("a");t<=Ve("z");t++)Sl.push(t);for(let t=Ve("A");t<=Ve("Z");t++)Sl.push(t);const Lb=[Ve(" "),Ve("\f"),Ve(`
`),Ve("\r"),Ve("	"),Ve("\v"),Ve("	"),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve("\u2028"),Ve("\u2029"),Ve(" "),Ve(" "),Ve("　"),Ve("\uFEFF")],U8=/[0-9a-fA-F]/,Rl=/[0-9]/,F8=/[1-9]/;class P8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const r=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Ca(n,"global");break;case"i":Ca(n,"ignoreCase");break;case"m":Ca(n,"multiLine");break;case"u":Ca(n,"unicode");break;case"y":Ca(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){const e=[],r=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(r)}}alternative(){const e=[],r=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}vo(r);const n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(e)}}return M8()}quantifier(e=!1){let r;const n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&r===void 0)return;vo(r);break}if(!(e===!0&&r===void 0)&&vo(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let e;const r=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),vo(e))return e.loc=this.loc(r),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ve(`
`),Ve("\r"),Ve("\u2028"),Ve("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,r=!1;switch(this.popChar()){case"d":e=Tl;break;case"D":e=Tl,r=!0;break;case"s":e=Lb;break;case"S":e=Lb,r=!0;break;case"w":e=Sl;break;case"W":e=Sl,r=!0;break}if(vo(e))return{type:"Set",value:e,complement:r}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Ve("\f");break;case"n":e=Ve(`
`);break;case"r":e=Ve("\r");break;case"t":e=Ve("	");break;case"v":e=Ve("\v");break}if(vo(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ve("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Ve(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Ve(e)}}}characterClass(){const e=[];let r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){const n=this.classAtom();if(n.type,Cb(n)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,Cb(i)){if(i.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:i.value})}else id(n.value,e),e.push(Ve("-")),id(i.value,e)}else id(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:r,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ve("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const r=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:e,value:r};return e&&(n.idx=this.groupIdx),n}positiveInteger(){let e=this.popChar();if(F8.test(e)===!1)throw Error("Expecting a positive integer");for(;Rl.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Rl.test(e)===!1)throw Error("Expecting an integer");for(;Rl.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ve(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Rl.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let r="";for(let i=0;i<e;i++){const s=this.popChar();if(U8.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class sd{visitChildren(e){for(const r in e){const n=e[r];e.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let Ol={};const $8=new P8;function Il(t){const e=t.toString();if(Ol.hasOwnProperty(e))return Ol[e];{const r=$8.pattern(e);return Ol[e]=r,r}}function B8(){Ol={}}const Mb="Complement Sets are not supported for first char optimization",Nl=`Unable to use "first char" lexer optimizations:
`;function D8(t,e=!1){try{const r=Il(t);return od(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===Mb)e&&Sb(`${Nl}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),nd(`${Nl}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function od(t,e,r){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)od(t.value[i],e,r);break;case"Alternative":const n=t.value;for(let i=0;i<n.length;i++){const s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Cl(o.value,e,r);break;case"Set":if(o.complement===!0)throw Error(Mb);Ye(o.value,c=>{if(typeof c=="number")Cl(c,e,r);else{const l=c;if(r===!0)for(let u=l.from;u<=l.to;u++)Cl(u,e,r);else{for(let u=l.from;u<=l.to&&u<Ma;u++)Cl(u,e,r);if(l.to>=Ma){const u=l.from>=Ma?l.from:Ma,h=l.to,d=Gi(u),f=Gi(h);for(let m=d;m<=f;m++)e[m]=m}}}});break;case"Group":od(o.value,e,r);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&ad(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Kt(e)}function Cl(t,e,r){const n=Gi(t);e[n]=n,r===!0&&j8(t,e)}function j8(t,e){const r=String.fromCharCode(t),n=r.toUpperCase();if(n!==r){const i=Gi(n.charCodeAt(0));e[i]=i}else{const i=r.toLowerCase();if(i!==r){const s=Gi(i.charCodeAt(0));e[s]=s}}}function Ub(t,e){return bo(t.value,r=>{if(typeof r=="number")return Rr(e,r);{const n=r;return bo(e,i=>n.from<=i&&i<=n.to)!==void 0}})}function ad(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?lt(t.value)?Cn(t.value,ad):ad(t.value):!1}class z8 extends sd{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Rr(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Ub(e,this.targetCharCodes)===void 0&&(this.found=!0):Ub(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function cd(t,e){if(e instanceof RegExp){const r=Il(e),n=new z8(t);return n.visit(r),n.found}else return bo(e,r=>Rr(t,r.charCodeAt(0)))!==void 0}const Es="PATTERN",La="defaultMode",Ll="modes";let Fb=typeof new RegExp("(?:)").sticky=="boolean";function W8(t,e){e=td(e,{useSticky:Fb,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(b,A)=>A()});const r=e.tracer;r("initCharCodeToOptimizedIndexMap",()=>{h2()});let n;r("Reject Lexer.NA",()=>{n=vl(t,b=>b[Es]===ar.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=Ue(n,b=>{const A=b[Es];if(Ei(A)){const S=A.source;return S.length===1&&S!=="^"&&S!=="$"&&S!=="."&&!A.ignoreCase?S:S.length===2&&S[0]==="\\"&&!Rr(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],S[1])?S[1]:e.useSticky?$b(A):Pb(A)}else{if(bi(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const S=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),x=new RegExp(S);return e.useSticky?$b(x):Pb(x)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;r("misc mapping",()=>{o=Ue(n,b=>b.tokenTypeIdx),a=Ue(n,b=>{const A=b.GROUP;if(A!==ar.SKIPPED){if(Dr(A))return A;if(ki(A))return!1;throw Error("non exhaustive match")}}),c=Ue(n,b=>{const A=b.LONGER_ALT;if(A)return lt(A)?Ue(A,x=>Ab(n,x)):[Ab(n,A)]}),l=Ue(n,b=>b.PUSH_MODE),u=Ue(n,b=>Ke(b,"POP_MODE"))});let h;r("Line Terminator Handling",()=>{const b=jb(e.lineTerminatorCharacters);h=Ue(n,A=>!1),e.positionTracking!=="onlyOffset"&&(h=Ue(n,A=>Ke(A,"LINE_BREAKS")?!!A.LINE_BREAKS:Db(A,b)===!1&&cd(b,A.PATTERN)))});let d,f,m,p;r("Misc Mapping #2",()=>{d=Ue(n,Bb),f=Ue(s,l2),m=jr(n,(b,A)=>{const S=A.GROUP;return Dr(S)&&S!==ar.SKIPPED&&(b[S]=[]),b},{}),p=Ue(s,(b,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:d[A],short:f[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:n[A]}))});let g=!0,y=[];return e.safeMode||r("First Char Optimization",()=>{y=jr(n,(b,A,S)=>{if(typeof A.PATTERN=="string"){const x=A.PATTERN.charCodeAt(0),F=Gi(x);ld(b,F,p[S])}else if(lt(A.START_CHARS_HINT)){let x;Ye(A.START_CHARS_HINT,F=>{const R=typeof F=="string"?F.charCodeAt(0):F,P=Gi(R);x!==P&&(x=P,ld(b,P,p[S]))})}else if(Ei(A.PATTERN))if(A.PATTERN.unicode)g=!1,e.ensureOptimizations&&nd(`${Nl}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const x=D8(A.PATTERN,e.ensureOptimizations);Et(x)&&(g=!1),Ye(x,F=>{ld(b,F,p[S])})}else e.ensureOptimizations&&nd(`${Nl}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return b},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:g}}function H8(t,e){let r=[];const n=K8(t);r=r.concat(n.errors);const i=q8(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(G8(s)),r=r.concat(t2(s)),r=r.concat(r2(s,e)),r=r.concat(n2(s)),r}function G8(t){let e=[];const r=_n(t,n=>Ei(n[Es]));return e=e.concat(V8(r)),e=e.concat(J8(r)),e=e.concat(Q8(r)),e=e.concat(e2(r)),e=e.concat(X8(r)),e}function K8(t){const e=_n(t,i=>!Ke(i,Es)),r=Ue(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Lt.MISSING_PATTERN,tokenTypes:[i]})),n=wl(t,e);return{errors:r,valid:n}}function q8(t){const e=_n(t,i=>{const s=i[Es];return!Ei(s)&&!bi(s)&&!Ke(s,"exec")&&!Dr(s)}),r=Ue(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Lt.INVALID_PATTERN,tokenTypes:[i]})),n=wl(t,e);return{errors:r,valid:n}}const Y8=/[^\\][$]/;function V8(t){class e extends sd{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const r=_n(t,i=>{const s=i.PATTERN;try{const o=Il(s),a=new e;return a.visit(o),a.found}catch{return Y8.test(s.source)}});return Ue(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Lt.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function X8(t){const e=_n(t,n=>n.PATTERN.test(""));return Ue(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:Lt.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}const Z8=/[^\\[][\^]|^\^/;function J8(t){class e extends sd{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const r=_n(t,i=>{const s=i.PATTERN;try{const o=Il(s),a=new e;return a.visit(o),a.found}catch{return Z8.test(s.source)}});return Ue(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Lt.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Q8(t){const e=_n(t,n=>{const i=n[Es];return i instanceof RegExp&&(i.multiline||i.global)});return Ue(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Lt.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function e2(t){const e=[];let r=Ue(t,s=>jr(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Rr(e,a)&&a.PATTERN!==ar.NA&&(e.push(a),o.push(a)),o),[]));r=Oa(r);const n=_n(r,s=>s.length>1);return Ue(n,s=>{const o=Ue(s,c=>c.name);return{message:`The same RegExp pattern ->${Ln(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Lt.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function t2(t){const e=_n(t,n=>{if(!Ke(n,"GROUP"))return!1;const i=n.GROUP;return i!==ar.SKIPPED&&i!==ar.NA&&!Dr(i)});return Ue(e,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Lt.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function r2(t,e){const r=_n(t,i=>i.PUSH_MODE!==void 0&&!Rr(e,i.PUSH_MODE));return Ue(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Lt.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function n2(t){const e=[],r=jr(t,(n,i,s)=>{const o=i.PATTERN;return o===ar.NA||(Dr(o)?n.push({str:o,idx:s,tokenType:i}):Ei(o)&&s2(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return Ye(t,(n,i)=>{Ye(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&i2(s,n.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Lt.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),e}function i2(t,e){if(Ei(e)){const r=e.exec(t);return r!==null&&r.index===0}else{if(bi(e))return e(t,0,[],{});if(Ke(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function s2(t){return bo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>t.source.indexOf(r)!==-1)===void 0}function Pb(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function $b(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function o2(t,e,r){const n=[];return Ke(t,La)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+La+`> property in its definition
`,type:Lt.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ke(t,Ll)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ll+`> property in its definition
`,type:Lt.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ke(t,Ll)&&Ke(t,La)&&!Ke(t.modes,t.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${La}: <${t.defaultMode}>which does not exist
`,type:Lt.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ke(t,Ll)&&Ye(t.modes,(i,s)=>{Ye(i,(o,a)=>{if(ki(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Lt.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ke(o,"LONGER_ALT")){const c=lt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ye(c,l=>{!ki(l)&&!Rr(i,l)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Lt.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function a2(t,e,r){const n=[];let i=!1;const s=Oa(rn(Kt(t.modes))),o=vl(s,c=>c[Es]===ar.NA),a=jb(r);return e&&Ye(o,c=>{const l=Db(c,a);if(l!==!1){const h={message:f2(c,l),type:l.issue,tokenType:c};n.push(h)}else Ke(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):cd(a,c.PATTERN)&&(i=!0)}),e&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Lt.NO_LINE_BREAKS_FLAGS}),n}function c2(t){const e={},r=gn(t);return Ye(r,n=>{const i=t[n];if(lt(i))e[n]=[];else throw Error("non exhaustive match")}),e}function Bb(t){const e=t.PATTERN;if(Ei(e))return!1;if(bi(e))return!0;if(Ke(e,"exec"))return!0;if(Dr(e))return!1;throw Error("non exhaustive match")}function l2(t){return Dr(t)&&t.length===1?t.charCodeAt(0):!1}const u2={test:function(t){const e=t.length;for(let r=this.lastIndex;r<e;r++){const n=t.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return t.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function Db(t,e){if(Ke(t,"LINE_BREAKS"))return!1;if(Ei(t.PATTERN)){try{cd(e,t.PATTERN)}catch(r){return{issue:Lt.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(Dr(t.PATTERN))return!1;if(Bb(t))return{issue:Lt.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function f2(t,e){if(e.issue===Lt.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Lt.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function jb(t){return Ue(t,r=>Dr(r)?r.charCodeAt(0):r)}function ld(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}const Ma=256;let Ml=[];function Gi(t){return t<Ma?t:Ml[t]}function h2(){if(Et(Ml)){Ml=new Array(65536);for(let t=0;t<65536;t++)Ml[t]=t>255?255+~~(t/255):t}}function Ua(t,e){const r=t.tokenTypeIdx;return r===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[r]===!0}function Ul(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let zb=1;const Wb={};function Fa(t){const e=d2(t);p2(e),g2(e),m2(e),Ye(e,r=>{r.isParent=r.categoryMatches.length>0})}function d2(t){let e=_r(t),r=t,n=!0;for(;n;){r=Oa(rn(Ue(r,s=>s.CATEGORIES)));const i=wl(r,e);e=e.concat(i),Et(i)?n=!1:r=i}return e}function p2(t){Ye(t,e=>{Gb(e)||(Wb[zb]=e,e.tokenTypeIdx=zb++),Kb(e)&&!lt(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Kb(e)||(e.CATEGORIES=[]),y2(e)||(e.categoryMatches=[]),_2(e)||(e.categoryMatchesMap={})})}function m2(t){Ye(t,e=>{e.categoryMatches=[],Ye(e.categoryMatchesMap,(r,n)=>{e.categoryMatches.push(Wb[n].tokenTypeIdx)})})}function g2(t){Ye(t,e=>{Hb([],e)})}function Hb(t,e){Ye(t,r=>{e.categoryMatchesMap[r.tokenTypeIdx]=!0}),Ye(e.CATEGORIES,r=>{const n=t.concat(e);Rr(n,r)||Hb(n,r)})}function Gb(t){return Ke(t,"tokenTypeIdx")}function Kb(t){return Ke(t,"CATEGORIES")}function y2(t){return Ke(t,"categoryMatches")}function _2(t){return Ke(t,"categoryMatchesMap")}function b2(t){return Ke(t,"tokenTypeIdx")}const w2={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,r,n,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${r} characters.`}};var Lt;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Lt||(Lt={}));const Pa={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:w2,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Pa);let ar=class{constructor(e,r=Pa){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Rb(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Br({},Pa,r);const n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Pa.lineTerminatorsPattern)this.config.lineTerminatorsPattern=u2;else if(this.config.lineTerminatorCharacters===Pa.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),lt(e)?i={modes:{defaultMode:_r(e)},defaultMode:La}:(s=!1,i=_r(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(o2(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(a2(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ye(i.modes,(a,c)=>{i.modes[c]=vl(a,l=>ki(l))});const o=gn(i.modes);if(Ye(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(H8(a,o))}),Et(this.lexerDefinitionErrors)){Fa(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=W8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Br({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Et(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Ue(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ye(this.lexerDefinitionWarning,a=>{Sb(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Fb?(this.chopInput=mo,this.match=this.matchWithTest):(this.updateLastIndex=Jt,this.match=this.matchWithExec),s&&(this.handleModes=Jt),this.trackStartLines===!1&&(this.computeNewColumn=mo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Jt),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=jr(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(r.ensureOptimizations&&!Et(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{B8()}),this.TRACE_INIT("toFastProperties",()=>{Ob(this)})})}tokenize(e,r=this.defaultMode){if(!Et(this.lexerDefinitionErrors)){const i=Ue(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,r)}tokenizeInternal(e,r){let n,i,s,o,a,c,l,u,h,d,f,m,p,g,y;const b=e,A=b.length;let S=0,x=0;const F=this.hasCustom?0:Math.floor(e.length/10),R=new Array(F),P=[];let W=this.trackStartLines?1:void 0,D=this.trackStartLines?1:void 0;const G=c2(this.emptyGroups),O=this.trackStartLines,I=this.config.lineTerminatorsPattern;let v=0,C=[],z=[];const $=[],Q=[];Object.freeze(Q);let Y;function N(){return C}function M(he){const xe=Gi(he),ve=z[xe];return ve===void 0?Q:ve}const U=he=>{if($.length===1&&he.tokenType.PUSH_MODE===void 0){const xe=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(he);P.push({offset:he.startOffset,line:he.startLine,column:he.startColumn,length:he.image.length,message:xe})}else{$.pop();const xe=_o($);C=this.patternIdxToConfig[xe],z=this.charCodeToPatternIdxToConfig[xe],v=C.length;const ve=this.canModeBeOptimized[xe]&&this.config.safeMode===!1;z&&ve?Y=M:Y=N}};function V(he){$.push(he),z=this.charCodeToPatternIdxToConfig[he],C=this.patternIdxToConfig[he],v=C.length,v=C.length;const xe=this.canModeBeOptimized[he]&&this.config.safeMode===!1;z&&xe?Y=M:Y=N}V.call(this,r);let q;const J=this.config.recoveryEnabled;for(;S<A;){c=null;const he=b.charCodeAt(S),xe=Y(he),ve=xe.length;for(n=0;n<ve;n++){q=xe[n];const ke=q.pattern;l=null;const Ae=q.short;if(Ae!==!1?he===Ae&&(c=ke):q.isCustom===!0?(y=ke.exec(b,S,R,G),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(ke,S),c=this.match(ke,e,S)),c!==null){if(a=q.longerAlt,a!==void 0){const Se=a.length;for(s=0;s<Se;s++){const Le=C[a[s]],je=Le.pattern;if(u=null,Le.isCustom===!0?(y=je.exec(b,S,R,G),y!==null?(o=y[0],y.payload!==void 0&&(u=y.payload)):o=null):(this.updateLastIndex(je,S),o=this.match(je,e,S)),o&&o.length>c.length){c=o,l=u,q=Le;break}}}break}}if(c!==null){if(h=c.length,d=q.group,d!==void 0&&(f=q.tokenTypeIdx,m=this.createTokenInstance(c,S,f,q.tokenType,W,D,h),this.handlePayload(m,l),d===!1?x=this.addToken(R,x,m):G[d].push(m)),e=this.chopInput(e,h),S=S+h,D=this.computeNewColumn(D,h),O===!0&&q.canLineTerminator===!0){let ke=0,Ae,Se;I.lastIndex=0;do Ae=I.test(c),Ae===!0&&(Se=I.lastIndex-1,ke++);while(Ae===!0);ke!==0&&(W=W+ke,D=h-Se,this.updateTokenEndLineColumnLocation(m,d,Se,ke,W,D,h))}this.handleModes(q,U,V,m)}else{const ke=S,Ae=W,Se=D;let Le=J===!1;for(;Le===!1&&S<A;)for(e=this.chopInput(e,1),S++,i=0;i<v;i++){const je=C[i],T=je.pattern,fe=je.short;if(fe!==!1?b.charCodeAt(S)===fe&&(Le=!0):je.isCustom===!0?Le=T.exec(b,S,R,G)!==null:(this.updateLastIndex(T,S),Le=T.exec(e)!==null),Le===!0)break}if(p=S-ke,D=this.computeNewColumn(D,p),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,ke,p,Ae,Se),P.push({offset:ke,line:Ae,column:Se,length:p,message:g}),J===!1)break}}return this.hasCustom||(R.length=x),{tokens:R,groups:G,errors:P}}handleModes(e,r,n,i){if(e.pop===!0){const s=e.push;r(i),s!==void 0&&n.call(this,s)}else e.push!==void 0&&n.call(this,e.push)}chopInput(e,r){return e.substring(r)}updateLastIndex(e,r){e.lastIndex=r}updateTokenEndLineColumnLocation(e,r,n,i,s,o,a){let c,l;r!==void 0&&(c=n===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,r){return e+r}createOffsetOnlyToken(e,r,n,i){return{image:e,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(e,r,n,i,s,o){return{image:e,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(e,r,n){return e.push(n),r}addTokenUsingMemberAccess(e,r,n){return e[r]=n,r++,r}handlePayloadNoCustom(e,r){}handlePayloadWithCustom(e,r){r!==null&&(e.payload=r)}matchWithTest(e,r,n){return e.test(r)===!0?r.substring(n,e.lastIndex):null}matchWithExec(e,r){const n=e.exec(r);return n!==null?n[0]:null}};ar.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",ar.NA=/NOT_APPLICABLE/;function $a(t){return qb(t)?t.LABEL:t.name}function qb(t){return Dr(t.LABEL)&&t.LABEL!==""}const v2="parent",Yb="categories",Vb="label",Xb="group",Zb="push_mode",Jb="pop_mode",Qb="longer_alt",e1="line_breaks",t1="start_chars_hint";function nn(t){return E2(t)}function E2(t){const e=t.pattern,r={};if(r.name=t.name,ki(e)||(r.PATTERN=e),Ke(t,v2))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ke(t,Yb)&&(r.CATEGORIES=t[Yb]),Fa([r]),Ke(t,Vb)&&(r.LABEL=t[Vb]),Ke(t,Xb)&&(r.GROUP=t[Xb]),Ke(t,Jb)&&(r.POP_MODE=t[Jb]),Ke(t,Zb)&&(r.PUSH_MODE=t[Zb]),Ke(t,Qb)&&(r.LONGER_ALT=t[Qb]),Ke(t,e1)&&(r.LINE_BREAKS=t[e1]),Ke(t,t1)&&(r.START_CHARS_HINT=t[t1]),r}const ks=nn({name:"EOF",pattern:ar.NA});Fa([ks]);function Fl(t,e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function k2(t,e){return Ua(t,e)}const r1={buildMismatchTokenMessage({expected:t,actual:e,previous:r,ruleName:n}){return`Expecting ${qb(t)?`--> ${$a(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:r,customUserDescription:n,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Ln(e).image+"'";if(n)return s+n+a;{const c=jr(t,(d,f)=>d.concat(f),[]),l=Ue(c,d=>`[${Ue(d,f=>$a(f)).join(", ")}]`),h=`one of these possible Token sequences:
${Ue(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:r,ruleName:n}){const i="Expecting: ",o=`
but found: '`+Ln(e).image+"'";if(r)return i+r+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Ue(t,l=>`[${Ue(l,u=>$a(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(r1);const x2={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},xs={buildDuplicateFoundError(t,e){function r(u){return u instanceof It?u.terminalType.name:u instanceof zr?u.nonTerminalName:""}const n=t.name,i=Ln(e),s=i.idx,o=oi(i),a=r(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=Ue(t.prefixPath,i=>$a(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=Ue(t.prefixPath,i=>$a(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx;let n=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(t){let e=oi(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,r=Ue(t.leftRecursionPath,s=>s.name),n=`${e} --> ${r.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof wo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function A2(t,e){const r=new T2(t,e);return r.resolveRefs(),r.errors}class T2 extends vs{constructor(e,r){super(),this.nameToTopRule=e,this.errMsgProvider=r,this.errors=[]}resolveRefs(){Ye(Kt(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const r=this.nameToTopRule[e.nonTerminalName];if(r)e.referencedRule=r;else{const n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:Or.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class S2 extends Al{constructor(e,r){super(),this.topProd=e,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=_r(this.path.ruleStack).reverse(),this.occurrenceStack=_r(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,r=[]){this.found||super.walk(e,r)}walkProdRef(e,r,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=r.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Et(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class R2 extends S2{constructor(e,r){super(e,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,r,n){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=r.concat(n),s=new Wr({definition:i});this.possibleTokTypes=Na(s),this.found=!0}}}class Pl extends Al{constructor(e,r){super(),this.topRule=e,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class O2 extends Pl{walkMany(e,r,n){if(e.idx===this.occurrence){const i=Ln(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof It&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,r,n)}}class n1 extends Pl{walkManySep(e,r,n){if(e.idx===this.occurrence){const i=Ln(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof It&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,r,n)}}class I2 extends Pl{walkAtLeastOne(e,r,n){if(e.idx===this.occurrence){const i=Ln(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof It&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,r,n)}}class i1 extends Pl{walkAtLeastOneSep(e,r,n){if(e.idx===this.occurrence){const i=Ln(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof It&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,r,n)}}function ud(t,e,r=[]){r=_r(r);let n=[],i=0;function s(a){return a.concat(br(t,i+1))}function o(a){const c=ud(s(a),e,r);return n.concat(c)}for(;r.length<e&&i<t.length;){const a=t[i];if(a instanceof Wr)return o(a.definition);if(a instanceof zr)return o(a.definition);if(a instanceof Hr)n=o(a.definition);else if(a instanceof ii){const c=a.definition.concat([new Qt({definition:a.definition})]);return o(c)}else if(a instanceof si){const c=[new Wr({definition:a.definition}),new Qt({definition:[new It({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Un){const c=a.definition.concat([new Qt({definition:[new It({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof Qt){const c=a.definition.concat([new Qt({definition:a.definition})]);n=o(c)}else{if(a instanceof Fn)return Ye(a.definition,c=>{Et(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof It)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:br(t,i)}),n}function s1(t,e,r,n){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-n-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Et(h);){const d=h.pop();if(d===o){a&&_o(h).idx<=l&&h.pop();continue}const f=d.def,m=d.idx,p=d.ruleStack,g=d.occurrenceStack;if(Et(f))continue;const y=f[0];if(y===i){const b={idx:m,def:br(f),ruleStack:Ia(p),occurrenceStack:Ia(g)};h.push(b)}else if(y instanceof It)if(m<c-1){const b=m+1,A=e[b];if(r(A,y.terminalType)){const S={idx:b,def:br(f),ruleStack:p,occurrenceStack:g};h.push(S)}}else if(m===c-1)u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:p,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(y instanceof zr){const b=_r(p);b.push(y.nonTerminalName);const A=_r(g);A.push(y.idx);const S={idx:m,def:y.definition.concat(s,br(f)),ruleStack:b,occurrenceStack:A};h.push(S)}else if(y instanceof Hr){const b={idx:m,def:br(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const A={idx:m,def:y.definition.concat(br(f)),ruleStack:p,occurrenceStack:g};h.push(A)}else if(y instanceof ii){const b=new Qt({definition:y.definition,idx:y.idx}),A=y.definition.concat([b],br(f)),S={idx:m,def:A,ruleStack:p,occurrenceStack:g};h.push(S)}else if(y instanceof si){const b=new It({terminalType:y.separator}),A=new Qt({definition:[b].concat(y.definition),idx:y.idx}),S=y.definition.concat([A],br(f)),x={idx:m,def:S,ruleStack:p,occurrenceStack:g};h.push(x)}else if(y instanceof Un){const b={idx:m,def:br(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const A=new It({terminalType:y.separator}),S=new Qt({definition:[A].concat(y.definition),idx:y.idx}),x=y.definition.concat([S],br(f)),F={idx:m,def:x,ruleStack:p,occurrenceStack:g};h.push(F)}else if(y instanceof Qt){const b={idx:m,def:br(f),ruleStack:p,occurrenceStack:g};h.push(b),h.push(o);const A=new Qt({definition:y.definition,idx:y.idx}),S=y.definition.concat([A],br(f)),x={idx:m,def:S,ruleStack:p,occurrenceStack:g};h.push(x)}else if(y instanceof Fn)for(let b=y.definition.length-1;b>=0;b--){const A=y.definition[b],S={idx:m,def:A.definition.concat(br(f)),ruleStack:p,occurrenceStack:g};h.push(S),h.push(o)}else if(y instanceof Wr)h.push({idx:m,def:y.definition.concat(br(f)),ruleStack:p,occurrenceStack:g});else if(y instanceof wo)h.push(N2(y,m,p,g));else throw Error("non exhaustive match")}return u}function N2(t,e,r,n){const i=_r(r);i.push(t.name);const s=_r(n);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Mt;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Mt||(Mt={}));function o1(t){if(t instanceof Hr||t==="Option")return Mt.OPTION;if(t instanceof Qt||t==="Repetition")return Mt.REPETITION;if(t instanceof ii||t==="RepetitionMandatory")return Mt.REPETITION_MANDATORY;if(t instanceof si||t==="RepetitionMandatoryWithSeparator")return Mt.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Un||t==="RepetitionWithSeparator")return Mt.REPETITION_WITH_SEPARATOR;if(t instanceof Fn||t==="Alternation")return Mt.ALTERNATION;throw Error("non exhaustive match")}function C2(t,e,r,n,i,s){const o=hd(t,e,r),a=u1(o)?Ul:Ua;return s(o,n,a,i)}function L2(t,e,r,n,i,s){const o=dd(t,e,i,r),a=u1(o)?Ul:Ua;return s(o[0],a,n)}function M2(t,e,r,n){const i=t.length,s=Cn(t,o=>Cn(o,a=>a.length===1));if(e)return function(o){const a=Ue(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const f=l[d],m=f.length;for(let p=0;p<m;p++){const g=this.LA(p+1);if(r(g,f[p])===!1)continue e}return c}}};if(s&&!n){const o=Ue(t,c=>rn(c)),a=jr(o,(c,l,u)=>(Ye(l,h=>{Ke(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Ye(h.categoryMatches,d=>{Ke(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(r(f,u[d])===!1)continue e}return o}}}}function U2(t,e,r){const n=Cn(t,s=>s.length===1),i=t.length;if(n&&!r){const s=rn(t);if(s.length===1&&Et(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=jr(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ye(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class F2 extends Al{constructor(e,r,n){super(),this.topProd=e,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,r,n,i){return e.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(e,r,n){this.checkIsTarget(e,Mt.OPTION,r,n)||super.walkOption(e,r,n)}walkAtLeastOne(e,r,n){this.checkIsTarget(e,Mt.REPETITION_MANDATORY,r,n)||super.walkOption(e,r,n)}walkAtLeastOneSep(e,r,n){this.checkIsTarget(e,Mt.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}walkMany(e,r,n){this.checkIsTarget(e,Mt.REPETITION,r,n)||super.walkOption(e,r,n)}walkManySep(e,r,n){this.checkIsTarget(e,Mt.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}}class a1 extends vs{constructor(e,r,n){super(),this.targetOccurrence=e,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(e,r){e.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Mt.OPTION)}visitRepetition(e){this.checkIsTarget(e,Mt.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Mt.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Mt.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Mt.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Mt.ALTERNATION)}}function c1(t){const e=new Array(t);for(let r=0;r<t;r++)e[r]=[];return e}function fd(t){let e=[""];for(let r=0;r<t.length;r++){const n=t[r],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){const c="_"+n.categoryMatches[a];i.push(o+c)}}e=i}return e}function P2(t,e,r){for(let n=0;n<t.length;n++){if(n===r)continue;const i=t[n];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function l1(t,e){const r=Ue(t,o=>ud([o],1)),n=c1(r.length),i=Ue(r,o=>{const a={};return Ye(o,c=>{const l=fd(c.partialPath);Ye(l,u=>{a[u]=!0})}),a});let s=r;for(let o=1;o<=e;o++){const a=s;s=c1(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=fd(h);if(P2(i,f,c)||Et(d)||h.length===e){const p=n[c];if(pd(p,h)===!1){p.push(h);for(let g=0;g<f.length;g++){const y=f[g];i[c][y]=!0}}}else{const p=ud(d,o+1,h);s[c]=s[c].concat(p),Ye(p,g=>{const y=fd(g.partialPath);Ye(y,b=>{i[c][b]=!0})})}}}}return n}function hd(t,e,r,n){const i=new a1(t,Mt.ALTERNATION,n);return e.accept(i),l1(i.result,r)}function dd(t,e,r,n){const i=new a1(t,r);e.accept(i);const s=i.result,a=new F2(e,t,r).startWalking(),c=new Wr({definition:s}),l=new Wr({definition:a});return l1([c,l],n)}function pd(t,e){e:for(let r=0;r<t.length;r++){const n=t[r];if(n.length===e.length){for(let i=0;i<n.length;i++){const s=e[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function $2(t,e){return t.length<e.length&&Cn(t,(r,n)=>{const i=e[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function u1(t){return Cn(t,e=>Cn(e,r=>Cn(r,n=>Et(n.categoryMatches))))}function B2(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return Ue(e,r=>Object.assign({type:Or.CUSTOM_LOOKAHEAD_VALIDATION},r))}function D2(t,e,r,n){const i=bn(t,c=>j2(c,r)),s=Q2(t,e,r),o=bn(t,c=>V2(c,r)),a=bn(t,c=>H2(c,t,n,r));return i.concat(s,o,a)}function j2(t,e){const r=new W2;t.accept(r);const n=r.allProductions,i=xb(n,z2),s=Mn(i,a=>a.length>1);return Ue(Kt(s),a=>{const c=Ln(a),l=e.buildDuplicateFoundError(t,a),u=oi(c),h={message:l,type:Or.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=f1(c);return d&&(h.parameter=d),h})}function z2(t){return`${oi(t)}_#_${t.idx}_#_${f1(t)}`}function f1(t){return t instanceof It?t.terminalType.name:t instanceof zr?t.nonTerminalName:""}class W2 extends vs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function H2(t,e,r,n){const i=[];if(jr(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=n.buildDuplicateRuleNameError({topLevelRule:t,grammarName:r});i.push({message:o,type:Or.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function G2(t,e,r){const n=[];let i;return Rr(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:Or.INVALID_RULE_OVERRIDE,ruleName:t})),n}function h1(t,e,r,n=[]){const i=[],s=$l(e.definition);if(Et(s))return[];{const o=t.name;Rr(s,t)&&i.push({message:r.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:n}),type:Or.LEFT_RECURSION,ruleName:o});const c=wl(s,n.concat([t])),l=bn(c,u=>{const h=_r(n);return h.push(u),h1(t,u,r,h)});return i.concat(l)}}function $l(t){let e=[];if(Et(t))return e;const r=Ln(t);if(r instanceof zr)e.push(r.referencedRule);else if(r instanceof Wr||r instanceof Hr||r instanceof ii||r instanceof si||r instanceof Un||r instanceof Qt)e=e.concat($l(r.definition));else if(r instanceof Fn)e=rn(Ue(r.definition,s=>$l(s.definition)));else if(!(r instanceof It))throw Error("non exhaustive match");const n=xl(r),i=t.length>1;if(n&&i){const s=br(t);return e.concat($l(s))}else return e}class md extends vs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function K2(t,e){const r=new md;t.accept(r);const n=r.alternations;return bn(n,s=>{const o=Ia(s.definition);return bn(o,(a,c)=>{const l=s1([a],[],Ua,1);return Et(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Or.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function q2(t,e,r){const n=new md;t.accept(n);let i=n.alternations;return i=vl(i,o=>o.ignoreAmbiguities===!0),bn(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=hd(a,t,c,o),u=Z2(l,o,t,r),h=J2(l,o,t,r);return u.concat(h)})}class Y2 extends vs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function V2(t,e){const r=new md;t.accept(r);const n=r.alternations;return bn(n,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Or.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function X2(t,e,r){const n=[];return Ye(t,i=>{const s=new Y2;i.accept(s);const o=s.allProductions;Ye(o,a=>{const c=o1(a),l=a.maxLookahead||e,u=a.idx,d=dd(u,i,c,l)[0];if(Et(rn(d))){const f=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:f,type:Or.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function Z2(t,e,r,n){const i=[],s=jr(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Ye(c,u=>{const h=[l];Ye(t,(d,f)=>{l!==f&&pd(d,u)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!pd(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return Ue(s,a=>{const c=Ue(a.alts,u=>u+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Or.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:e.idx,alternatives:a.alts}})}function J2(t,e,r,n){const i=jr(t,(o,a,c)=>{const l=Ue(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Oa(bn(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=_n(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&$2(d.path,l));return Ue(u,d=>{const f=[d.idx+1,c+1],m=e.idx===0?"":e.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:Or.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:m,alternatives:f}})}))}function Q2(t,e,r){const n=[],i=Ue(e,s=>s.name);return Ye(t,s=>{const o=s.name;if(Rr(i,o)){const a=r.buildNamespaceConflictError(s);n.push({message:a,type:Or.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function e3(t){const e=td(t,{errMsgProvider:x2}),r={};return Ye(t.rules,n=>{r[n.name]=n}),A2(r,e.errMsgProvider)}function t3(t){return t=td(t,{errMsgProvider:xs}),D2(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const d1="MismatchedTokenException",p1="NoViableAltException",m1="EarlyExitException",g1="NotAllInputParsedException",y1=[d1,p1,m1,g1];Object.freeze(y1);function Bl(t){return Rr(y1,t.name)}class Dl extends Error{constructor(e,r){super(e),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class _1 extends Dl{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=d1}}class r3 extends Dl{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=p1}}class n3 extends Dl{constructor(e,r){super(e,r),this.name=g1}}class i3 extends Dl{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=m1}}const gd={},b1="InRuleRecoveryException";class s3 extends Error{constructor(e){super(e),this.name=b1}}class o3{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ke(e,"recoveryEnabled")?e.recoveryEnabled:xi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=a3)}getTokenToInsert(e){const r=Fl(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,r,n,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new _1(f,l,this.LA(0));m.resyncedTokens=Ia(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(n.call(this)){h(),e.apply(this,r);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,r)))}getFollowsForInRuleRecovery(e,r){const n=this.getCurrentGrammarPath(e,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(e,r){if(this.canRecoverWithSingleTokenInsertion(e,r))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new s3("sad sad panda")}canPerformInRuleRecovery(e,r){return this.canRecoverWithSingleTokenInsertion(e,r)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,r){if(!this.canTokenTypeBeInsertedInRecovery(e)||Et(r))return!1;const n=this.LA(1);return bo(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Rr(n,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let r=this.LA(1),n=2;for(;;){const i=bo(e,s=>k2(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return gd;const e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return Ue(e,(n,i)=>i===0?gd:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Ue(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return rn(e)}getFollowSetFromFollowKey(e){if(e===gd)return[ks];const r=e.ruleName+e.idxInCallingRule+Nb+e.inRule;return this.resyncFollows[r]}addToResyncTokens(e,r){return this.tokenMatcher(e,ks)||r.push(e),r}reSyncTo(e){const r=[];let n=this.LA(1);for(;this.tokenMatcher(n,e)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return Ia(r)}attemptInRepetitionRecovery(e,r,n,i,s,o,a){}getCurrentGrammarPath(e,r){const n=this.getHumanReadableRuleStack(),i=_r(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:e,lastTokOccurrence:r}}getHumanReadableRuleStack(){return Ue(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function a3(t,e,r,n,i,s,o){const a=this.getKeyForAutomaticLookahead(n,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=ks,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,r,l)}const c3=4,Ki=8,w1=1<<Ki,v1=2<<Ki,yd=3<<Ki,_d=4<<Ki,bd=5<<Ki,jl=6<<Ki;function wd(t,e,r){return r|e|t}class l3{constructor(e){var r;this.maxLookahead=(r=e?.maxLookahead)!==null&&r!==void 0?r:xi.maxLookahead}validate(e){const r=this.validateNoLeftRecursion(e.rules);if(Et(r)){const n=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(e){return bn(e,r=>h1(r,r,xs))}validateEmptyOrAlternatives(e){return bn(e,r=>K2(r,xs))}validateAmbiguousAlternationAlternatives(e,r){return bn(e,n=>q2(n,r,xs))}validateSomeNonEmptyLookaheadPath(e,r){return X2(e,r,xs)}buildLookaheadForAlternation(e){return C2(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,M2)}buildLookaheadForOptional(e){return L2(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,o1(e.prodType),U2)}}class u3{initLooksAhead(e){this.dynamicTokensEnabled=Ke(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:xi.dynamicTokensEnabled,this.maxLookahead=Ke(e,"maxLookahead")?e.maxLookahead:xi.maxLookahead,this.lookaheadStrategy=Ke(e,"lookaheadStrategy")?e.lookaheadStrategy:new l3({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Ye(e,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{const{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=h3(r);Ye(n,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${oi(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:r,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=wd(this.fullRuleNameToShort[r.name],w1,l.idx);this.setLaFuncCache(d,h)})}),Ye(i,l=>{this.computeLookaheadFunc(r,l.idx,yd,"Repetition",l.maxLookahead,oi(l))}),Ye(s,l=>{this.computeLookaheadFunc(r,l.idx,v1,"Option",l.maxLookahead,oi(l))}),Ye(o,l=>{this.computeLookaheadFunc(r,l.idx,_d,"RepetitionMandatory",l.maxLookahead,oi(l))}),Ye(a,l=>{this.computeLookaheadFunc(r,l.idx,jl,"RepetitionMandatoryWithSeparator",l.maxLookahead,oi(l))}),Ye(c,l=>{this.computeLookaheadFunc(r,l.idx,bd,"RepetitionWithSeparator",l.maxLookahead,oi(l))})})})}computeLookaheadFunc(e,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=wd(this.fullRuleNameToShort[e.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,r){const n=this.getLastExplicitRuleShortName();return wd(n,e,r)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,r){this.lookAheadFuncsCache.set(e,r)}}class f3 extends vs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const zl=new f3;function h3(t){zl.reset(),t.accept(zl);const e=zl.dslMethods;return zl.reset(),e}function E1(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function k1(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function d3(t,e,r){t.children[r]===void 0?t.children[r]=[e]:t.children[r].push(e)}function p3(t,e,r){t.children[e]===void 0?t.children[e]=[r]:t.children[e].push(r)}const m3="name";function x1(t,e){Object.defineProperty(t,m3,{enumerable:!1,configurable:!0,writable:!1,value:e})}function g3(t,e){const r=gn(t),n=r.length;for(let i=0;i<n;i++){const s=r[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function y3(t,e){const r=function(){};x1(r,t+"BaseSemantics");const n={visit:function(i,s){if(lt(i)&&(i=i[0]),!ki(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=b3(this,e);if(!Et(i)){const s=Ue(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=e,r}function _3(t,e,r){const n=function(){};x1(n,t+"BaseSemanticsWithDefaults");const i=Object.create(r.prototype);return Ye(e,s=>{i[s]=g3}),n.prototype=i,n.prototype.constructor=n,n}var vd;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(vd||(vd={}));function b3(t,e){return w3(t,e)}function w3(t,e){const r=_n(e,i=>bi(t[i])===!1),n=Ue(r,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:vd.MISSING_METHOD,methodName:i}));return Oa(n)}class v3{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Ke(e,"nodeLocationTracking")?e.nodeLocationTracking:xi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Jt,this.cstFinallyStateUpdate=Jt,this.cstPostTerminal=Jt,this.cstPostNonTerminal=Jt,this.cstPostRule=Jt;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=k1,this.setNodeLocationFromNode=k1,this.cstPostRule=Jt,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Jt,this.setNodeLocationFromNode=Jt,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=E1,this.setNodeLocationFromNode=E1,this.cstPostRule=Jt,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Jt,this.setNodeLocationFromNode=Jt,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Jt,this.setNodeLocationFromNode=Jt,this.cstPostRule=Jt,this.setInitialNodeLocation=Jt;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const r=this.LA(1);e.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const r={name:e,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(e){const r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(e,r){const n=this.CST_STACK[this.CST_STACK.length-1];d3(n,r,e),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(e,r){const n=this.CST_STACK[this.CST_STACK.length-1];p3(n,r,e),this.setNodeLocationFromNode(n.location,e.location)}getBaseCstVisitorConstructor(){if(ki(this.baseCstVisitorConstructor)){const e=y3(this.className,gn(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ki(this.baseCstVisitorWithDefaultsConstructor)){const e=_3(this.className,gn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class E3{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Gl}LA(e){const r=this.currIdx+e;return r<0||this.tokVectorLength<=r?Gl:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class k3{ACTION(e){return e.call(this)}consume(e,r,n){return this.consumeInternal(r,e,n)}subrule(e,r,n){return this.subruleInternal(r,e,n)}option(e,r){return this.optionInternal(r,e)}or(e,r){return this.orInternal(r,e)}many(e,r){return this.manyInternal(e,r)}atLeastOne(e,r){return this.atLeastOneInternal(e,r)}CONSUME(e,r){return this.consumeInternal(e,0,r)}CONSUME1(e,r){return this.consumeInternal(e,1,r)}CONSUME2(e,r){return this.consumeInternal(e,2,r)}CONSUME3(e,r){return this.consumeInternal(e,3,r)}CONSUME4(e,r){return this.consumeInternal(e,4,r)}CONSUME5(e,r){return this.consumeInternal(e,5,r)}CONSUME6(e,r){return this.consumeInternal(e,6,r)}CONSUME7(e,r){return this.consumeInternal(e,7,r)}CONSUME8(e,r){return this.consumeInternal(e,8,r)}CONSUME9(e,r){return this.consumeInternal(e,9,r)}SUBRULE(e,r){return this.subruleInternal(e,0,r)}SUBRULE1(e,r){return this.subruleInternal(e,1,r)}SUBRULE2(e,r){return this.subruleInternal(e,2,r)}SUBRULE3(e,r){return this.subruleInternal(e,3,r)}SUBRULE4(e,r){return this.subruleInternal(e,4,r)}SUBRULE5(e,r){return this.subruleInternal(e,5,r)}SUBRULE6(e,r){return this.subruleInternal(e,6,r)}SUBRULE7(e,r){return this.subruleInternal(e,7,r)}SUBRULE8(e,r){return this.subruleInternal(e,8,r)}SUBRULE9(e,r){return this.subruleInternal(e,9,r)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,r,n=Kl){if(Rr(this.definedRulesNames,e)){const o={message:xs.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Or.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,r,n);return this[e]=i,i}OVERRIDE_RULE(e,r,n=Kl){const i=G2(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,r,n);return this[e]=s,s}BACKTRACK(e,r){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return e.apply(this,r),!0}catch(i){if(Bl(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return A8(Kt(this.gastProductionsCache))}}class x3{initRecognizerEngine(e,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Ul,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ke(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(lt(e)){if(Et(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(lt(e))this.tokensMap=jr(e,(s,o)=>(s[o.name]=o,s),{});else if(Ke(e,"modes")&&Cn(rn(Kt(e.modes)),b2)){const s=rn(Kt(e.modes)),o=El(s);this.tokensMap=jr(o,(a,c)=>(a[c.name]=c,a),{})}else if(mn(e))this.tokensMap=_r(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=ks;const n=Ke(e,"modes")?rn(Kt(e.modes)):Kt(e),i=Cn(n,s=>Et(s.categoryMatches));this.tokenMatcher=i?Ul:Ua,Fa(Kt(this.tokensMap))}defineRule(e,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ke(n,"resyncEnabled")?n.resyncEnabled:Kl.resyncEnabled,s=Ke(n,"recoveryValueFunc")?n.recoveryValueFunc:Kl.recoveryValueFunc,o=this.ruleShortNameIdx<<c3+Ki;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:r})}invokeRuleCatch(e,r,n){const i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if(Bl(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(e);throw o}}else throw e}optionInternal(e,r){const n=this.getKeyForAutomaticLookahead(v1,r);return this.optionInternalLogic(e,r,n)}optionInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,r){const n=this.getKeyForAutomaticLookahead(_d,e);return this.atLeastOneInternalLogic(e,r,n)}atLeastOneInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const o=r.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Mt.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,r],i,_d,e,I2)}atLeastOneSepFirstInternal(e,r){const n=this.getKeyForAutomaticLookahead(jl,e);this.atLeastOneSepFirstInternalLogic(e,r,n)}atLeastOneSepFirstInternalLogic(e,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,i1],a,jl,e,i1)}else throw this.raiseEarlyExitException(e,Mt.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(e,r){const n=this.getKeyForAutomaticLookahead(yd,e);return this.manyInternalLogic(e,r,n)}manyInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const a=r.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,r],i,yd,e,O2,o)}manySepFirstInternal(e,r){const n=this.getKeyForAutomaticLookahead(bd,e);this.manySepFirstInternalLogic(e,r,n)}manySepFirstInternalLogic(e,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,n1],a,bd,e,n1)}}repetitionSepSecondInternal(e,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,r,n,i,s],n,jl,e,s)}doSingleRepetition(e){const r=this.getLexerPosition();return e.call(this),this.getLexerPosition()>r}orInternal(e,r){const n=this.getKeyForAutomaticLookahead(w1,r),i=lt(e)?e:e.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new n3(r,e))}}subruleInternal(e,r,n){let i;try{const s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=e.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,n,e.ruleName)}}subruleInternalError(e,r,n){throw Bl(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete e.partialCstResult),e}consumeInternal(e,r,n){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,n)}catch(s){i=this.consumeInternalRecovery(e,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:e.name,i),i}consumeInternalError(e,r,n){let i;const s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new _1(i,r,s))}consumeInternalRecovery(e,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,r);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===b1?n:s}}else throw n}saveRecogState(){const e=this.errors,r=_r(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),ks)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class A3{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Ke(e,"errorMessageProvider")?e.errorMessageProvider:xi.errorMessageProvider}SAVE_ERROR(e){if(Bl(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:_r(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return _r(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,r,n){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=dd(e,s,r,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new i3(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,r){const n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=hd(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new r3(c,this.LA(1),a))}}class T3{initContentAssist(){}computeContentAssist(e,r){const n=this.gastProductionsCache[e];if(ki(n))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return s1([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const r=Ln(e.ruleStack),i=this.getGAstProductions()[r];return new R2(i,e).startWalking()}}const Wl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Wl);const A1=!0,T1=Math.pow(2,Ki)-1,S1=nn({name:"RECORDING_PHASE_TOKEN",pattern:ar.NA});Fa([S1]);const R1=Fl(S1,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(R1);const S3={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class R3{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const r=e>0?e:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,e,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,e,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,e)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,e)},this[`MANY${r}`]=function(n){this.manyInternalRecord(e,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(e,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(e,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(e,n)}}this.consume=function(e,r,n){return this.consumeInternalRecord(r,e,n)},this.subrule=function(e,r,n){return this.subruleInternalRecord(r,e,n)},this.option=function(e,r){return this.optionInternalRecord(r,e)},this.or=function(e,r){return this.orInternalRecord(r,e)},this.many=function(e,r){this.manyInternalRecord(e,r)},this.atLeastOne=function(e,r){this.atLeastOneInternalRecord(e,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let r=0;r<10;r++){const n=r>0?r:"";delete e[`CONSUME${n}`],delete e[`SUBRULE${n}`],delete e[`OPTION${n}`],delete e[`OR${n}`],delete e[`MANY${n}`],delete e[`MANY_SEP${n}`],delete e[`AT_LEAST_ONE${n}`],delete e[`AT_LEAST_ONE_SEP${n}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,r){return()=>!0}LA_RECORD(e){return Gl}topLevelRuleRecord(e,r){try{const n=new wo({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(e,r){return Ba.call(this,Hr,e,r)}atLeastOneInternalRecord(e,r){Ba.call(this,ii,r,e)}atLeastOneSepFirstInternalRecord(e,r){Ba.call(this,si,r,e,A1)}manyInternalRecord(e,r){Ba.call(this,Qt,r,e)}manySepFirstInternalRecord(e,r){Ba.call(this,Un,r,e,A1)}orInternalRecord(e,r){return O3.call(this,e,r)}subruleInternalRecord(e,r,n){if(Hl(r),!e||Ke(e,"ruleName")===!1){const a=new Error(`<SUBRULE${O1(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=_o(this.recordingProdStack),s=e.ruleName,o=new zr({idx:r,nonTerminalName:s,label:n?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?S3:Wl}consumeInternalRecord(e,r,n){if(Hl(r),!Gb(e)){const o=new Error(`<CONSUME${O1(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=_o(this.recordingProdStack),s=new It({idx:r,terminalType:e,label:n?.LABEL});return i.definition.push(s),R1}}function Ba(t,e,r,n=!1){Hl(r);const i=_o(this.recordingProdStack),s=bi(e)?e:e.DEF,o=new t({definition:[],idx:r});return n&&(o.separator=e.SEP),Ke(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Wl}function O3(t,e){Hl(e);const r=_o(this.recordingProdStack),n=lt(t)===!1,i=n===!1?t:t.DEF,s=new Fn({definition:[],idx:e,ignoreAmbiguities:n&&t.IGNORE_AMBIGUITIES===!0});Ke(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=rd(i,a=>bi(a.GATE));return s.hasPredicates=o,r.definition.push(s),Ye(i,a=>{const c=new Wr({definition:[]});s.definition.push(c),Ke(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ke(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Wl}function O1(t){return t===0?"":`${t}`}function Hl(t){if(t<0||t>T1){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${T1+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class I3{initPerformanceTracer(e){if(Ke(e,"traceInitPerf")){const r=e.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=xi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,r){if(this.traceInitPerf===!0){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${e}>`);const{time:i,value:s}=Rb(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}}function N3(t,e){e.forEach(r=>{const n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=r.prototype[i]})})}const Gl=Fl(ks,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Gl);const xi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:r1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Kl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Or;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Or||(Or={}));let Ed=class rT{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const r=this.className;this.TRACE_INIT("toFastProps",()=>{Ob(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ye(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=e3({rules:Kt(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(Et(n)&&this.skipValidations===!1){const i=t3({rules:Kt(this.gastProductionsCache),tokenTypes:Kt(this.tokensMap),errMsgProvider:xs,grammarName:r}),s=B2({lookaheadStrategy:this.lookaheadStrategy,rules:Kt(this.gastProductionsCache),tokenTypes:Kt(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Et(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=C8(Kt(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Kt(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Kt(this.gastProductionsCache))})),!rT.DEFER_DEFINITION_ERRORS_HANDLING&&!Et(this.definitionErrors))throw e=Ue(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,r){this.definitionErrors=[],this.selfAnalysisDone=!1;const n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(e,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),Ke(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ke(r,"skipValidations")?r.skipValidations:xi.skipValidations}};Ed.DEFER_DEFINITION_ERRORS_HANDLING=!1,N3(Ed,[o3,u3,v3,E3,x3,k3,A3,T3,R3,I3]);class C3 extends Ed{constructor(e,r=xi){const n=_r(r);n.outputCst=!0,super(e,n)}}function L3(t){const e=new M3,r=Kt(t);return Ue(r,n=>e.visitRule(n))}class M3 extends vs{visitRule(e){const r=this.visitEach(e.definition),n=xb(r,s=>s.propertyName),i=Ue(n,(s,o)=>{const a=!rd(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Ue(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:ql(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:ql(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:ql(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:ql(e)}]}visitEachAndOverrideWith(e,r){return Ue(this.visitEach(e),n=>Br({},n,r))}visitEach(e){return rn(Ue(e,r=>this.visit(r)))}}function ql(t){return t instanceof zr?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function U3(t,e){let r=[];return r=r.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),r=r.concat(rn(Ue(t,n=>F3(n)))),e.includeVisitorInterface&&(r=r.concat(D3(e.visitorInterfaceName,t))),r.join(`

`)+`
`}function F3(t){const e=P3(t),r=$3(t);return[e,r]}function P3(t){const e=N1(t.name),r=kd(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${r};
}`}function $3(t){return`export type ${kd(t.name)} = {
  ${Ue(t.properties,r=>B3(r)).join(`
  `)}
};`}function B3(t){const e=z3(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function D3(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Ue(e,r=>j3(r)).join(`
  `)}
}`}function j3(t){const e=kd(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function z3(t){if(lt(t)){const e=El(Ue(t,n=>I1(n)));return"("+jr(e,(n,i)=>n+" | "+i)+")"}else return I1(t)}function I1(t){return t.kind==="token"?"IToken":N1(t.name)}function N1(t){return G_(t)+"CstNode"}function kd(t){return G_(t)+"CstChildren"}const W3={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function H3(t,e){const r=Object.assign(Object.assign({},W3),e),n=L3(t);return U3(n,r)}const Da=Ay(32,126).map(t=>String.fromCharCode(t));function Qe(t){return nn({...t,name:`token_${t.name}`})}function de(t){return Qe({name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt})}const Yl=Qe({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),G3=Qe({name:"whitespace",pattern:/ +/,group:ar.SKIPPED}),K3=Qe({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:ar.SKIPPED}),xd=Qe({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Eo=Qe({name:"command",pattern:/#/,start_chars_hint:["#"]});let C1=!1;const q3="@#/?':!",Y3=/[#\d]+/i,V3=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function X3(t,e){if(!C1)return null;let r=e;const n=t[r-1]??"";if(r>0&&n!==" "&&n!==`
`)return null;if(t[r]===" "){for(;t[r]===" ";)r++;if(q3.includes(t[r]))return null}for(;r>0&&`$"@#':!/?
`.includes(t[r])===!1;)r--;switch(t[r]){case"?":case"/":{const o=t.substring(r+1,e+1).toLowerCase();if(o.indexOf(" ")<1||V3.test(o))return null;break}case"#":{const o=t.substring(r+1,r+4).toLowerCase();if(Y3.test(o)===!1)return null;break}case'"':{for(r--;r>0&&t[r]===" ";)r--;if(!(r<1||t[r]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=e;for(t[i]==='"'&&++i;i<t.length&&t[i]!==`
`;)i++;const s=t.substring(e,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const L1=Qe({name:"text",pattern:X3,line_breaks:!1,start_chars_hint:Da}),M1=Qe({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Ad=Qe({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),U1=Qe({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),F1=Qe({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),zt=Qe({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Da}),Vl=Qe({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Td=Qe({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),P1=de("isterrain"),$1=de("isobject"),B1=de("issolid"),D1=de("iswalk"),j1=de("isswim"),z1=de("isbullet"),W1=de("isghost"),H1=de("iswalking"),G1=de("iswalkable"),K1=de("isswimming"),q1=de("isswimmable"),Y1=de("black"),V1=de("dkblue"),X1=de("dkgreen"),Z1=de("dkcyan"),J1=de("dkred"),Q1=de("dkpurple"),ew=de("dkyellow"),tw=de("ltgray"),rw=de("dkgray"),nw=de("blue"),iw=de("green"),sw=de("cyan"),ow=de("red"),aw=de("purple"),cw=de("yellow"),lw=de("white"),uw=de("brown"),fw=de("dkwhite"),hw=de("ltgrey"),dw=de("gray"),pw=de("grey"),mw=de("dkgrey"),gw=de("ltblack"),yw=de("onblack"),_w=de("ondkblue"),bw=de("ondkgreen"),ww=de("ondkcyan"),vw=de("ondkred"),Ew=de("ondkpurple"),kw=de("ondkyellow"),xw=de("onltgray"),Aw=de("ondkgray"),Tw=de("onblue"),Sw=de("ongreen"),Rw=de("oncyan"),Ow=de("onred"),Iw=de("onpurple"),Nw=de("onyellow"),Cw=de("onwhite"),Lw=de("onbrown"),Mw=de("ondkwhite"),Uw=de("onltgrey"),Fw=de("ongray"),Pw=de("ongrey"),$w=de("ondkgrey"),Bw=de("onltblack"),Dw=de("onclear"),jw=de("idle"),zw=de("up"),Ww=de("down"),Hw=de("left"),Gw=de("right"),Kw=de("by"),qw=de("at"),Yw=de("flow"),Vw=de("seek"),Xw=de("rndns"),Zw=de("rndne"),Jw=de("rnd"),Qw=de("cw"),ev=de("ccw"),tv=de("opp"),rv=de("rndp"),nv=de("away"),iv=de("toward"),sv=de("find"),ov=de("flee"),av=de("to"),cv=de("i"),lv=de("u"),uv=de("north"),fv=de("n"),hv=de("d"),dv=de("south"),pv=de("s"),mv=de("l"),gv=de("west"),yv=de("w"),_v=de("r"),bv=de("east"),wv=de("e"),vv=de("over"),Ev=de("under"),kv=de("within"),xv=de("awayby"),Av=Qe({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:zt}),Tv=de("contact"),Sv=de("blocked"),Rv=de("any"),Ov=de("countof"),Iv=de("abs"),Nv=de("intceil"),Cv=de("intfloor"),Lv=de("intround"),Mv=de("clamp"),Uv=de("min"),Fv=de("max"),Pv=de("pick"),$v=de("pickwith"),Bv=de("random"),Dv=de("randomwith"),jv=de("run"),zv=de("runwith"),Wv=Qe({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),Hv=Qe({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:zt}),Gv=Qe({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:zt}),Kv=Qe({name:"islessthan",pattern:/<|below/i,longer_alt:zt}),qv=Qe({name:"isgreaterthan",pattern:/>|above/i,longer_alt:zt}),Yv=Qe({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:zt}),Vv=Qe({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:zt}),Sd=Qe({name:"or",pattern:/or/i,longer_alt:zt}),Rd=Qe({name:"not",pattern:/not/i,longer_alt:zt}),Od=Qe({name:"and",pattern:/and/i,longer_alt:zt}),Id=Qe({name:"plus",pattern:/\+/}),Nd=Qe({name:"minus",pattern:/-/}),Xv=Qe({name:"power",pattern:/\*\*/}),Zv=Qe({name:"multiply",pattern:/\*/}),Cd=Qe({name:"divide",pattern:/\//}),Jv=Qe({name:"moddivide",pattern:/%/}),Qv=Qe({name:"floordivide",pattern:/%%/}),eE=Qe({name:"query",pattern:/\?/}),tE=Qe({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),rE=Qe({name:"rparen",pattern:/\)/,pop_mode:!0}),nE=Qe({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:Da,longer_alt:zt}),iE=Qe({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Da,longer_alt:zt}),sE=Qe({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Da,longer_alt:zt}),Ld=Qe({name:"if",pattern:/if|try|take|give|duplicate/i,longer_alt:zt}),Xl=Qe({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:zt}),Md=de("done"),Ud=de("else"),oE=de("while"),aE=de("repeat"),cE=de("waitfor"),lE=Qe({name:"foreach",pattern:/foreach|for/i,longer_alt:zt}),uE=de("break"),fE=de("continue");function hE(t,e){return[...t,Ww,...e,Td,P1,$1,B1,G1,H1,D1,q1,K1,j1,z1,W1,Y1,V1,X1,Z1,J1,Q1,ew,tw,rw,nw,iw,sw,ow,aw,cw,lw,uw,fw,hw,dw,pw,mw,gw,yw,_w,bw,ww,vw,Ew,kw,xw,Aw,Tw,Sw,Rw,Ow,Iw,Nw,Cw,Lw,Mw,Uw,Fw,Pw,$w,Bw,Dw,jw,zw,Hw,Gw,Kw,qw,Yw,Vw,rv,Xw,Zw,Jw,Qw,ev,tv,kv,xv,nv,iv,sv,ov,av,uv,dv,gv,bv,vv,Ev,Av,Tv,Sv,Rv,Ov,Iv,Nv,Cv,Lv,Mv,Uv,Fv,$v,Pv,Dv,Bv,zv,jv,Wv,Hv,Gv,Yv,Kv,Vv,qv,Sd,Rd,Od,Id,Nd,Xv,Zv,Cd,Qv,Jv,eE,tE,rE,cv,lv,fv,hv,pv,mv,yv,_v,wv,Vl,zt]}const dE=hE([L1,xd,nE,iE,sE,Eo,M1,Ad,U1,F1,Yl,G3],[uE,fE,Md,Xl,Ud,lE,Ld,aE,cE,oE]),Z3=new ar({defaultMode:"use_newlines",modes:{use_newlines:dE,ignore_newlines:hE([K3],[])}},{skipValidations:!Xn,ensureOptimizations:Xn,positionTracking:"full"});function pE(t){C1=!0;const e=Z3.tokenize(t||` 
`),[r]=(ut(e.tokens)?e.tokens:[]).slice(-1);return r&&r.tokenType.name!=="Newline"&&e.tokens.push(Fl(Yl,`
`,r.startOffset,r.endOffset??NaN,r.startLine??NaN,r.endLine??NaN,r.startColumn??NaN,r.endColumn??NaN)),e}function J3(t,e,r=!0){if(r){const[n,...i]=e;switch(Be(n??"")){default:return{type:Fe.OBJECT,values:e};case"loader":return{type:Fe.LOADER,values:i};case"board":return{type:Fe.BOARD,values:i};case"object":return{type:Fe.OBJECT,values:i};case"terrain":return{type:Fe.TERRAIN,values:i};case"charset":return{type:Fe.CHARSET,values:i};case"palette":return{type:Fe.PALETTE,values:i}}}else{const[n,i,...s]=e,o=Be(i??""),a=[n,t,...s];switch(o){default:return{type:Fe.CONST,values:e};case"rn":case"range":return{type:Fe.RANGE,values:a};case"sl":case"select":return{type:Fe.SELECT,values:a};case"nm":case"number":return{type:Fe.NUMBER,values:a};case"tx":case"text":return{type:Fe.TEXT,values:a};case"hk":case"hotkey":return{type:Fe.HOTKEY,values:a};case"copyit":return{type:Fe.COPYIT,values:a};case"openit":return{type:Fe.OPENIT,values:a};case"zssedit":return{type:Fe.ZSSEDIT,values:a};case"charedit":return{type:Fe.CHAREDIT,values:a};case"coloredit":return{type:Fe.COLOREDIT,values:a}}}}function sn(t){switch(t){case Fe.LOADER:return"loader";case Fe.BOARD:return"board";case Fe.OBJECT:return"object";case Fe.TERRAIN:return"terrain";case Fe.CHARSET:return"charset";case Fe.PALETTE:return"palette";case Fe.CONST:return"const";case Fe.RANGE:return"range";case Fe.SELECT:return"select";case Fe.NUMBER:return"number";case Fe.TEXT:return"text";case Fe.HOTKEY:return"hotkey";case Fe.COPYIT:return"copyit";case Fe.OPENIT:return"openit";case Fe.VIEWIT:return"viewit";case Fe.ZSSEDIT:return"zssedit";case Fe.CHAREDIT:return"charedit";case Fe.COLOREDIT:return"coloredit"}}var Fd=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(Fd||{});function mE(t){return po(t,Fd,{bits:e=>Array.from(e)})}function gE(t){return _a(t,Fd,{bits:e=>new Uint8Array(e)})}function ja(t,e){return{id:Ft(),code:t,...e}}var Pd=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(Pd||{});function Q3(t){return po(t,Pd,{board:mz,object:il,terrain:il,charset:mE,palette:mE,stats:Tt})}function eF(t){return _a(t,Pd,{board:gz,object:sl,terrain:sl,charset:gE,palette:gE})}function za(t){const e={...As(t)};return Object.keys(e).forEach(r=>{switch(r){case"type":case"name":delete e[r];break}}),e}function tF(t){return w(t)?(t.stats=void 0,As(t)):{}}function Zl(t){const e=pE(t),r={};let n=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===xd){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=J3(ye(c)?c:"",l,n),h=u.values.join(" ");switch(n=!1,u.type){case Fe.LOADER:r.type=Re.LOADER,r.name=h;break;case Fe.BOARD:r.type=Re.BOARD,r.name=h;break;case Fe.OBJECT:r.type=Re.OBJECT,r.name=h||"object";break;case Fe.TERRAIN:r.type=Re.TERRAIN,r.name=h;break;case Fe.CHARSET:r.type=Re.CHARSET,r.name=h;break;case Fe.PALETTE:r.type=Re.PALETTE,r.name=h;break;case Fe.CONST:{const[d,...f]=u.values;if(ye(d)){const m=Be(d),p=f.join(" ");if(ye(p)){const g=parseFloat(p);r[m]=Te(g)?g:p}else r[m]=1}break}case Fe.RANGE:case Fe.SELECT:case Fe.NUMBER:case Fe.TEXT:case Fe.HOTKEY:case Fe.ZSSEDIT:case Fe.CHAREDIT:case Fe.COLOREDIT:{const[d,...f]=u.values;if(ye(d)){const m=Be(d);r[m]=[sn(u.type),...f]}break}}}}return r}function As(t){return w(t)?(w(t.stats?.type)||(t.stats=Zl(t.code),w(t.stats.type)||(t.stats.type=Re.OBJECT)),t.stats):{}}function yE(t){switch(t){default:case Re.ERROR:return"error";case Re.LOADER:return sn(Fe.LOADER);case Re.BOARD:return sn(Fe.BOARD);case Re.OBJECT:return sn(Fe.OBJECT);case Re.TERRAIN:return sn(Fe.TERRAIN);case Re.CHARSET:return sn(Fe.CHARSET);case Re.PALETTE:return sn(Fe.PALETTE)}}function ai(t){return As(t).type??Re.ERROR}function Ai(t){return yE(ai(t))}function gt(t){return As(t).name??""}function rF(t,e){return As(t)[e]}const Jl=new uh;function nF(t){if(!ye(t))return;const e=da(t);if(w(e)&&w(it[e]))return it[e];const r=Be(t),n=Ee[r];if(w(n))return n}function Ql(t,e){const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n],s=t[i];if(ut(s)){const[o,...a]=s;switch(o){case"text":w(e[i])||(e[i]="");break;case"range":w(e[i])||(e[i]=4);break;case"number":w(e[i])||(e[i]=0);break;case"select":if(!w(e[i])){const[,c]=a;e[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":e[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":e[i]=nF(s)??s;break;case"isitem":e.item=1;break;case"notitem":e.item=0;break;case"ispushable":e.pushable=s===""?1:s;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=We.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=We.ISSWIM;break;case"issolid":e.collision=We.ISSOLID;break;case"isbullet":e.collision=We.ISBULLET;break;case"isghost":e.collision=We.ISGHOST;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function At(t){if(w(t))switch(ai(t)){default:return;case Re.ERROR:return t.code??"";case Re.LOADER:return t.code??"";case Re.BOARD:{w(t.board)||(t.board=Ru()),t.board.id=t.id;const e=za(t);return e.isdark&&(t.board.isdark=1),e.notdark&&(t.board.isdark=0),Te(e.startx)&&(t.board.startx=e.startx),Te(e.starty)&&(t.board.starty=e.starty),ye(e.over)&&(Be(e.over)==="empty"?t.board.over=void 0:t.board.over=e.over,t.board.overboard=void 0),ye(e.under)&&(Be(e.under)==="empty"?t.board.under=void 0:t.board.under=e.under,t.board.underboard=void 0),ye(e.camera)&&(Be(e.camera)==="empty"?t.board.camera=void 0:t.board.camera=e.camera),ye(e.graphics)&&(Be(e.graphics)==="empty"?t.board.graphics=void 0:t.board.graphics=e.graphics),Te(e.facing)&&(t.board.facing=e.facing),ye(e.facing)&&Be(e.facing)==="empty"&&(t.board.facing=void 0),ye(e.exitnorth)&&(t.board.exitnorth=e.exitnorth),ye(e.exitsouth)&&(t.board.exitsouth=e.exitsouth),ye(e.exitwest)&&(t.board.exitwest=e.exitwest),ye(e.exiteast)&&(t.board.exiteast=e.exiteast),Te(e.timelimit)&&(t.board.timelimit=e.timelimit),e.restartonzap&&(t.board.restartonzap=1),e.norestartonzap&&(t.board.restartonzap=0),Te(e.maxplayershots)&&(t.board.maxplayershots=e.maxplayershots),t.board}case Re.OBJECT:return w(t.object)||(t.object=a_()),t.object.id=t.id,t.object.code=t.code,t.object.name=gt(t),t.object.category=Ur.ISOBJECT,Ql(za(t),t.object),t.object;case Re.TERRAIN:return w(t.terrain)||(t.terrain=a_()),t.terrain.id=t.id,t.terrain.name=gt(t),t.terrain.category=Ur.ISTERRAIN,Ql(za(t),t.terrain),t.terrain;case Re.PALETTE:{if(w(t.palette)||(t.palette=l_(vN)),w(t.palette?.bits)){const e=za(t),r=Mr(e);for(let n=0;n<r.length;++n){const i=r[n].toLowerCase(),s=e[i];if(i.startsWith("color")&&ye(s)){const o=parseFloat(i.replace("color",""));if(o>=0&&o<=15){Jl.set(s);const a=o*Vc,c=Jl.r*63,l=Jl.g*63,u=Jl.b*63;t.palette.bits[a+0]=Bt(c,0,63),t.palette.bits[a+1]=Bt(l,0,63),t.palette.bits[a+2]=Bt(u,0,63)}}}}return t.palette}case Re.CHARSET:return w(t.charset)||(t.charset=Rh(wN)),t.charset}}function $d(t){return{id:Ft(),name:yT(),timestamp:0,activelist:[],pages:t,flags:{}}}var Bd=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))(Bd||{});function iF(t){return po(t,Bd,{pages:e=>e.map(Q3),flags:e=>{const r=Object.keys(e);for(let n=0;n<r.length;++n){const i=r[n];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function Dd(t){return _a(t,Bd,{pages:e=>e.map(eF)})}function _E(t){w(t)&&(t.token=`${_T()}${hn(1111,9999)}`)}function Ts(t,e){if(!w(t))return;const r=Be(e);return t.pages.find(i=>i.id===e||r===gt(i))}function Ir(t,e,r){if(!w(t))return;const n=Be(r);return t.pages.find(s=>ai(s)===e&&(s.id===r||n===gt(s)))}function jd(t,e,r){let n=Ir(t,e,r);if(!w(n)){const i=yE(e);return n=ja(i==="object"?`@${r||"object"}
`:`@${i} ${r}
`,{}),ko(t,n),[n,!0]}return[n,!1]}function Ss(t,e){return w(t)?t.pages.filter(r=>ai(r)===e):[]}function bE(t,e,r){if(!w(t))return[];const n=Be(r);return t.pages.filter(s=>ai(s)===e).filter(s=>{const o=As(s),a=Be(gt(s));return s.id===r||n===a||w(o[r])})}function Wa(t){return w(t)?xn(t.pages).sort((r,n)=>{const i=ai(r),s=ai(n);return i===s?gt(r).localeCompare(gt(n)):s-i}):[]}function wE(t,e){if(w(e)){const r=Ir(t,Re.TERRAIN,e.kind??"");if(w(r))return r;const n=Ir(t,Re.OBJECT,e.kind??"");if(w(n))return n}}function ko(t,e){if(!w(t)||!w(e))return!1;const r=Ts(t,e.id);return w(r)?!1:(t.pages.push(e),_E(t),!0)}function vE(t,e){const r=Ts(t,e);if(w(t)&&w(r)){const n=Be(e);return t.pages=t.pages.filter(i=>i.id!==e&&n!==gt(i)),_E(t),r}}function er(t,e=1,r=it.WHITE,n=it.BLACK){const i=t?.kinddata;return{name:Be(t?.name??i?.name),char:t?.displaychar??i?.displaychar??t?.char??i?.char??e,color:t?.displaycolor??i?.displaycolor??t?.color??i?.color??r,bg:t?.displaybg??i?.displaybg??t?.bg??i?.bg??n,light:t?.light??i?.light??0}}function sF(t,e){return!!t?.flags[e]}function Ti(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function EE(t,e){t&&delete t.flags[e]}function kE(t,e,r){return Ti(t,e)?.[r]}function oF(t,e,r,n){const i=Ti(t,e);return i&&(i[r]=n),n}function cr(t){if(!w(t)||w(t.lookup)&&w(t.named))return;const e=new Array(Me*rt).fill(void 0),r={},n=Object.values(t.objects);for(let o=0;o<n.length;++o){const a=n[o];if(w(a.x)&&w(a.y)&&w(a.id)&&!w(a.removed)&&He(a,"collision")!==We.ISGHOST){a.category=Ur.ISOBJECT,e[a.x+a.y*Me]=a.id,ye(a.code)&&!w(a.name)&&Ql(Zl(a.code),a);const c=er(a);r[c.name]||(r[c.name]=new Set),r[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];if(w(a)){a.x=i,a.y=s,a.category=Ur.ISTERRAIN;const c=er(vn(a));r[c.name]||(r[c.name]=new Set),r[c.name].add(o)}++i,i>=Me&&(i=0,++s)}t.lookup=e,t.named=r}function Ha(t){w(t)&&(delete t.named,delete t.lookup,cr(t))}function zd(t,e,r){if(!w(t)||!w(t.named)||!w(e))return;const n=Be(e.name??e.kinddata?.name??"");t.named[n]||(t.named[n]=new Set),t.named[n].add(e?.id??r??"")}function xE(t,e){if(!(!w(t)||!w(t.lookup)||!w(e?.id))&&!w(e.removed)&&He(e,"collision")!==We.ISGHOST){const r=e.x??0,n=e.y??0;t.lookup[r+n*Me]=e.id}}function aF(t,e){if(w(t)&&w(e?.x)&&w(e.y)){const r=er(e),n=Ni(t,e);w(t.named?.[r.name])&&t.named[r.name].delete(n)}}function eu(t,e){if(w(t)&&w(e?.id)){if(w(t.lookup)&&w(e.x)&&w(e.y)){const n=e.x+e.y*Me;t.lookup[n]===e.id&&(t.lookup[n]=void 0)}const r=er(e);w(t.named?.[r.name])&&w(e.id)&&t.named[r.name].delete(e.id)}}function tu(t,e,r,n=!1){if(!w(t)||!w(t.lookup)||r.x<0||r.x>=Me||r.y<0||r.y>=rt)return;const i=r.x+r.y*Me,s=hr(t,t.lookup[i]??"404");if(w(s))return n&&gr(s.id)?void 0:s;const o=t.terrain[i];if(w(o)&&ec(e,He(o,"collision")))return o}function cF(t,e,r){const n=hr(t,e?.id??""),i=n?.x??-1,s=n?.y??-1;if(i-r.x===0&&s-r.y===0)return!0;const o=He(n,"collision");return w(tu(t,o,r))}function AE(t,e,r){const n=hr(t,e?.id??"");if(!w(t)||!w(n)||!w(n.x)||!w(n.y)||!w(t.lookup)||r.x<0||r.x>=Me||r.y<0||r.y>=rt)return{name:"edge",kind:"edge",collision:We.ISSOLID,x:r.x,y:r.y};if(n.x-r.x===0&&n.y-r.y===0)return;const i=Ni(t,n),s=Ni(t,r),o=He(n,"collision");if(o===We.ISGHOST)return;const a=gr(n?.id),c=hr(t,t.lookup[s]??"");if(He(c,"collision")===We.ISGHOST)return;const l=gr(c?.id??"");if(w(c)&&(!a||!l))return{...c};const u=t.terrain[s],h=u?.collision??u?.kinddata?.collision??We.ISWALK;if(ec(o,h))return{...u,x:r.x,y:r.y};n.x=r.x,n.y=r.y,w(n.removed)||(t.lookup[i]=void 0,t.lookup[s]=n.id??"")}function lF(t,e){const r=[];if(!w(t))return r;const n=Object.values(t.objects);for(let i=0;i<n.length;++i){const s=n[i];w(s.id)&&w(s.removed)&&e-s.removed>fc*5&&(r.push(s.id),fA(t,s.id))}return r}function uF(t,e){const r=[];if(!w(t))return r;t.lookup=void 0,cr(t);const n=Object.values(t.objects);for(let s=0;s<n.length;++s){const o=n[s];if(!w(o.id))continue;o.lx=o.x,o.ly=o.y;const c=`${vn(o)?.code??""}
${o.code??""}`;if(c){if(o.removed){const l=e-o.removed,u=He(o,"cycle");if(l>u)continue}r.push({id:o.id,type:Re.OBJECT,code:c,object:o,terrain:void 0})}}const i=lF(t,e);for(let s=0;s<i.length;++s)r.push({id:i[s],type:Re.ERROR,code:"",object:void 0,terrain:void 0});return r}function TE(t,e,r){const n=[],i=[];if(!w(t))return{objectelements:n,terrainelements:i};function s(a,c){switch(r){case"all":return!0;case"self":return a?.id===e;case"others":return a?.id!==e;case"terrain":return c===!0;case"object":return c===!1}const l=He(a,r);return w(l)||er(a).name===r||He(a,"group")===r}const o=Object.values(t.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&n.push(c)}for(let a=0;a<ph;++a){const c=t.terrain[a];w(c)&&s(c,!0)&&i.push(c)}return{objectelements:n,terrainelements:i}}function SE(t,e,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=nt(e,{x:s,y:i});jt(o)&&dr(e,o,t.timestamp),St(e,{x:s,y:i})}}function fF(t,e,r){for(let n=e.y;n<=r.y;++n)for(let i=e.x;i<=r.x;++i)St(t,{x:i,y:n})}function RE(t,e,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=nt(e,{x:s,y:i});jt(o)&&dr(e,o,t.timestamp),St(e,{x:s,y:i})}}function Rs(t,e){w(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.displaychar=e.displaychar,t.displaycolor=e.displaycolor,t.displaybg=e.displaybg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.p4=e.p4,t.p5=e.p5,t.p6=e.p6,t.code=e.code,t.item=e.item,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.lightdir=e.lightdir,t.stepx=e.stepx,t.stepy=e.stepy,t.shootx=e.shootx,t.shooty=e.shooty,t.pushable=e.pushable,t.collision=e.collision,t.breakable=e.breakable,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function ru(t,e,r,n,i){switch(i){case"all":case"object":case"terrain":break;default:return hF(t,e,r,"",i)}if(!w(k.book))return;const s=k.book,o=Ir(s,Re.BOARD,t),a=At(o);if(!w(a))return;const c=Ir(s,Re.BOARD,e),l=At(c);if(!w(l))return;cr(a),cr(l);let u=!1;if(w(a)&&w(l)){switch(i){case"all":SE(s,l,r,n);break;case"object":RE(s,l,r,n);break;case"terrain":fF(l,r,n);break;default:u=!0;break}for(let h=r.y;h<=n.y;++h)for(let d=r.x;d<=n.x;++d){let f=!1,m=!1;switch(i){case"all":f=!0,m=!0;break;case"object":f=!0;break;case"terrain":m=!0;break}const p={x:d,y:h};let g,y=nt(a,p);if(jt(y)?(g=Xi(a,d,h),gr(y?.id)&&(y=void 0)):(g=y,y=void 0),w(g)&&(m||u&&He(g,"group")===i)){u&&SE(s,l,p,p);const b=an(l,[g.kind??""],p);Rs(b,g)}if(w(y)&&(f||u&&He(y,"group")===i)){u&&RE(s,l,p,p);const b=an(l,[y.kind??""],p);Rs(b,y)}}Ha(l)}}function hF(t,e,r,n,i){if(!w(k.book))return;const s=k.book,o=Ir(s,Re.BOARD,t),a=At(o);if(!w(a))return;const c=Ir(s,Re.BOARD,e),l=At(c);if(w(l)&&(cr(a),cr(l),w(a)&&w(l))){const{terrainelements:u,objectelements:h}=TE(a,n,i);if(u.length===0&&h.length===0)return;const d={x:Me,y:rt};for(let f=0;f<u.length;++f){const m=u[f];Te(m.x)&&(d.x=Math.min(d.x,m.x)),Te(m.y)&&(d.y=Math.min(d.y,m.y))}for(let f=0;f<h.length;++f){const m=h[f];Te(m.x)&&(d.x=Math.min(d.x,m.x)),Te(m.y)&&(d.y=Math.min(d.y,m.y))}for(let f=0;f<u.length;++f){const m=u[f],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},g=nt(l,p);w(g)&&(jt(g)&&dr(l,g,s.timestamp),St(l,p));const y=an(l,[m.kind??""],p);Rs(y,m)}for(let f=0;f<h.length;++f){const m=h[f],p={x:r.x+(m.x??0)-d.x,y:r.y+(m.y??0)-d.y},g=an(l,[m.kind??""],p);Rs(g,m)}Ha(l)}}function Ut(t){return`${t??""}`}function Ga(t,e){const r=parseFloat(Ut(t));return isNaN(r)?e:r}function dF(t,e){return t?.activelist.includes(e)??!1}function nu(t,e,r){if(!w(t))return;oF(t,e,"board",r);const n=fr(r);w(n)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function xo(t,e,r,n,i=!1){const s=Ht(e);if(!w(t)||!w(s))return;const o=hr(s,e);if(!jt(o)||!o?.id)return;const a=fr(r);if(!w(a))return;cr(a);const c=tu(a,We.ISWALK,n,!0);if(i===!1&&w(c))if(He(c,"item"))Gt(e,o,c,"touch");else return;eu(s,o),delete s.objects[o.id],o.x=n.x,o.y=n.y,a.objects[o.id]=o,zd(a,o),xE(a,o),nu(t,e,a.id)}function pF(t){const r=(t?.activelist??[]).map(n=>{const i=kE(t,n,"board");return ye(i)?i:""});return OI(r)}function Ao(t){const e=pF(t),r=new Set,n=[];for(let i=0;i<e.length;++i){const s=fr(e[i]);if(w(s)&&!r.has(s.id)){if(ye(s.over))if(ye(s.overboard)){const o=fr(s.overboard);w(o)?r.has(o.id)||n.push(o):delete s.overboard}else{const o=fr(s.over);w(o)&&(s.overboard=o.id)}else ye(s.overboard)&&delete s.overboard;if(n.push(s),ye(s.under))if(ye(s.underboard)){const o=fr(s.underboard);w(o)||delete s.underboard}else{const o=fr(s.under);w(o)&&(s.underboard=o.id)}else ye(s.underboard)&&delete s.underboard}}return n}const mF=Ay(32,126).map(t=>String.fromCharCode(t)),gF=nn({name:"Whitespace",pattern:/ +/}),yF=nn({name:"WhitespaceSkipped",pattern:/ +/,group:ar.SKIPPED}),Wd=nn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),OE=nn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:mF}),Hd=nn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Gd=nn({name:"EscapedDollar",pattern:"$$"}),Kd=nn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),qd=nn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),IE=nn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function _F(t,e=""){return nn({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const NE=Object.keys(ha).map(t=>_F(`\\$(${t})`,t)),bF=[gF,Wd,...NE,Hd,OE,qd,Gd,IE,Kd],wF=new ar(bF,{skipValidations:!Xn,ensureOptimizations:Xn}),vF=new ar([yF,Wd,...NE,Hd,OE,qd,Gd,IE,Kd],{skipValidations:!Xn,ensureOptimizations:Xn}),CE=/\$CENTER/i;function EF(t){if(CE.test(t))return t.replace(CE,"")}function Yd(t,e=!1){return e?vF.tokenize(t):wF.tokenize(t)}function LE(t,e,r,n,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function kF(t){t.active={...t.reset}}function ME(t,e){const r=e.y;function n(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}n()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Gd:s("$");break;case qd:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}n();break;case Hd:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Wd:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=ha[l],h=NI(it[u]),d=dh(it[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):w(h)?e.active.color=h:w(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(w(e.writefullwidth)&&(e.x>o||e.y===r)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){kF(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;SF(u,u+l.length,e.active.color,e.active.bg,e),TF(u,l,e)}}}function xF(t,e,r){const n=Yd(t);n.tokens&&(ME(n.tokens,e),e.changed())}function AF(t,e,r){const n=Yd(t);if(!n.tokens)return;const i=LE(e,r,it.WHITE,it.BLACK);return i.measureonly=!0,ME(n.tokens,i),i.x>0&&++i.y,i}function TF(t,e,r){let n=0;const i=t+e.length;for(let s=t;s<i;++s)r.char[s]=e.charCodeAt(n++);r.changed()}function SF(t,e,r,n,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=r,i.bg[a]=n;i.changed()}function iu(t,e,r){if(!w(k.element?.x)||!w(k.element.y))return 0;const[n,i]=ue(e,0,[Z.DIR,Z.MAYBE_KIND]);k.element.shootx=Bt(n.destpt.x-n.startpt.x,-1,1),k.element.shooty=Bt(n.destpt.y-n.startpt.y,-1,1);const s=i??["bullet"],o=Zj(k.board,s,{x:k.element.x,y:k.element.y});if(w(o)){w(r)&&(o.arg=r),o.cycle=1,o.party=k.elementid,o.collision=We.ISBULLET,o.breakable=1,o.stepx=n.destpt.x-k.element.x,o.stepy=n.destpt.y-k.element.y,o.bg=it.ONCLEAR;const a=vn(o),c=o.code??a?.code??"";tA(k.book,k.board,o,c)}return t.yield(),0}function Ka(t,e,r){if(!hs(k.element)||!w(k.book)||!w(k.board)||!w(k.element))return 0;const[n,i]=ue(t,0,[Z.DIR,Z.KIND]);if(n.targets.length){for(let d=0;d<n.targets.length;++d){const f=n.targets[d];Ka(["at",f.x,f.y,...i],e,r)}return 0}const{destpt:s}=n;if(s.x<0||s.x>=Me||s.y<0||s.y>=rt)return 0;const[o]=i,a={x:k.element?.x??0,y:k.element?.y??0},c=vn({kind:o}),l=He(c,"collision");if(l===We.ISGHOST)return an(k.board,i,n.destpt,e),0;let u=nt(k.board,n.destpt);if(He(u,"pushable")){const d=xn(n.destpt),f=Ct(d,In(a,d));Bn(k.book,k.board,u,f),u=nt(k.board,n.destpt)}if(o==="empty")return dr(k.board,u,k.timestamp),0;if(jt(u)&&dr(k.board,u,k.timestamp),jt(c)||an(k.board,i,n.destpt,e),jt(c)){const d=tu(k.board,l,n.destpt);if(!w(d)){const f=an(k.board,i,n.destpt,e);w(f)&&w(r)&&(f.arg=r)}}return 0}function RF(t,e,r){if(!w(k.book)||!w(k.board))return 1;const[n,i]=ue(e,0,[Z.DIR,Z.DIR]),s=nt(k.board,n.destpt);if(w(s)&&w(s.kind)){const o=He(s,"collision"),a=tu(k.board,o,i.destpt);if(w(a))return 1;const c=an(k.board,[s.kind],i.destpt);if(!w(c))return 1;Rs(c,s)}else return 1;return 0}const OF={x:0,y:0},IF={x:Me-1,y:rt-1},NF="all",CF=yi().command("build",(t,e)=>{if(!w(k.book)||!w(k.board)||!w(k.element))return 0;const[r,n]=ue(e,0,[Z.NAME,Z.MAYBE_STRING]),i=Ru();if(w(i)){if(ye(n)){const s=fr(n);w(s)&&ru(s.id,i.id,OF,IF,NF)}t.set(r,i.id)}return 0}).command("goto",(t,e)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ue(e,0,[Z.STRING]),[i,s]=ue(e,n,[Z.MAYBE_NUMBER,Z.MAYBE_NUMBER]),o=fr(r);if(!w(o))return 0;const a={x:i??o.startx??Math.round(Me*.5),y:s??o.starty??Math.round(rt*.5)},c=er(k.element);if(c.name!=="player"){const l=He(k.element,"color"),u=He(k.element,"bg"),h=uo(l,u),d=Su(o,[c.name,h]),[f]=d.sort((m,p)=>{const g=m.y??1e4,y=p.y??1e4,b=g-y;if(b!==0)return b;const A=m.x??1e4,S=p.x??1e4;return A-S});w(f)&&Te(f.x)&&Te(f.y)&&(a.x=f.x,a.y=f.y)}return xo(k.book,k.elementfocus,o.id,a,!0),0}).command("transport",(t,e)=>{if(!w(k.book)||!w(k.board)||!w(k.element))return 0;const[r]=ue(e,0,[Z.STRING]),n=hr(k.board,r);if(w(k.element?.x)&&w(k.element.y)&&w(n?.x)&&w(n.y)){let i=!0;const s={x:k.element.x,y:k.element.y},o=s.x-n.x,a=s.y-n.y;if(He(k.element,"shootx")!==o||He(k.element,"shooty")!==a)return 0;for(;i&&(s.x+=o,s.y+=a,!(s.x<0&&s.x>=Me&&s.y<0&&s.y>=rt));){const c=nt(k.board,s);c?.kind===k.element.kind&&He(c,"shootx")===-o&&He(c,"shooty")===-a&&Bn(k.book,k.board,n,{x:s.x+o,y:s.y+a})&&(i=!1)}}return 0}).command("shove",(t,e)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ue(e,0,[Z.DIR,Z.DIR]),i=nt(k.board,r.destpt);if(jt(i)&&He(i,"pushable")){const s=r.destpt.x+(n.destpt.x-n.startpt.x),o=r.destpt.y+(n.destpt.y-n.startpt.y);Bn(k.book,k.board,i,{x:s,y:o})}return 0}).command("duplicate",RF).command("write",(t,e)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n,i]=ue(e,0,[Z.DIR,Z.COLOR]),s=e.slice(i).map(Ut).join(" "),{color:o,bg:a}=Cy(n),c=AF(s,256,1)?.measuredwidth??1,l=LE(256,1,o??it.WHITE,a??it.BLACK);xF(s,l);const u=c-1;switch(In(r.startpt,r.destpt)){case Ee.EAST:for(let d=0;d<c;++d)St(k.board,{x:r.destpt.x+d,y:r.destpt.y,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case Ee.WEST:for(let d=0;d<c;++d)St(k.board,{x:r.destpt.x+d-u,y:r.destpt.y,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case Ee.NORTH:for(let d=0;d<c;++d)St(k.board,{x:r.destpt.x,y:r.destpt.y+d-u,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break;case Ee.SOUTH:for(let d=0;d<c;++d)St(k.board,{x:r.destpt.x,y:r.destpt.y+d,name:"text",char:l.char[d],color:l.color[d],bg:l.bg[d]});break}return 0}).command("change",(t,e)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ue(e,0,[Z.KIND,Z.KIND]);(Qa(r)??"")==="empty"&&hz(k.board).forEach(c=>{an(k.board,n,c)});const s=Qa(n),o=Tu(n),a=nA(n);return Su(k.board,r).forEach(c=>{if(w(o)&&(c.color=o),w(a)&&(c.bg=a),er(c).name!==s){const u=He(c,"color"),h=He(c,"bg");if(dr(k.board,c,k.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},f=an(k.board,n,d);w(f)&&(f.color=u,f.bg=h)}}}),0}).command("put",(t,e)=>Ka(e)).command("putwith",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY]);return Ka(e.slice(n),void 0,r)}).command("oneof",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY]);return w(k.board)&&hr(k.board,r)?0:Ka(e.slice(n),r)}).command("oneofwith",(t,e)=>{const[r,n,i]=ue(e,0,[Z.ANY,Z.ANY]);return w(k.board)&&hr(k.board,n)?0:Ka(e.slice(i),n,r)}).command("shoot",iu).command("shootwith",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY]);return iu(t,e.slice(n),r)}).command("throwstar",(t,e)=>iu(t,[...e,"star"])).command("throwstarwith",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY]);return iu(t,[...e.slice(n),"star"],r)});var Os=(t=>(t[t.Border=-1]="Border",t[t.Data=0]="Data",t[t.Function=1]="Function",t[t.Position=2]="Position",t[t.Timing=3]="Timing",t[t.Alignment=4]="Alignment",t))(Os||{}),LF=Object.defineProperty,MF=(t,e,r)=>e in t?LF(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,su=(t,e,r)=>(MF(t,typeof e!="symbol"?e+"":e,r),r);const UF=[0,1],UE=[1,0],FE=[2,3],PE=[3,2],FF={L:UF,M:UE,Q:FE,H:PE},PF=/^[0-9]*$/,$F=/^[A-Z0-9 $%*+.\/:-]*$/,Vd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Xd=1,Zd=40,$E=3,BF=3,ou=40,DF=10,BE=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],DE=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class jF{constructor(e,r,n,i){if(this.version=e,this.ecc=r,su(this,"size"),su(this,"mask"),su(this,"modules",[]),su(this,"types",[]),e<Xd||e>Zd)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(n);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,r){return e>=0&&e<this.size&&r>=0&&r<this.size&&this.modules[r][e]}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2===0,Os.Timing),this.setFunctionModule(n,6,n%2===0,Os.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),r=e.length;for(let n=0;n<r;n++)for(let i=0;i<r;i++)n===0&&i===0||n===0&&i===r-1||n===r-1&&i===0||this.drawAlignmentPattern(e[n],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const r=this.ecc[1]<<3|e;let n=r;for(let s=0;s<10;s++)n=n<<1^(n>>>9)*1335;const i=(r<<10|n)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Ri(i,s));this.setFunctionModule(8,7,Ri(i,6)),this.setFunctionModule(8,8,Ri(i,7)),this.setFunctionModule(7,8,Ri(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Ri(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Ri(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Ri(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let n=0;n<12;n++)e=e<<1^(e>>>11)*7973;const r=this.version<<12|e;for(let n=0;n<18;n++){const i=Ri(r,n),s=this.size-11+n%3,o=Math.floor(n/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,r){for(let n=-4;n<=4;n++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(n)),o=e+i,a=r+n;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,Os.Position)}}drawAlignmentPattern(e,r){for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,r+n,Math.max(Math.abs(i),Math.abs(n))!==1,Os.Alignment)}setFunctionModule(e,r,n,i=Os.Function){this.modules[r][e]=n,this.types[r][e]=i}addEccAndInterleave(e){const r=this.version,n=this.ecc;if(e.length!==au(r,n))throw new RangeError("Invalid argument");const i=DE[n[0]][r],s=BE[n[0]][r],o=Math.floor(Qd(r)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=XF(s);for(let d=0,f=0;d<i;d++){const m=e.slice(f,f+c-s+(d<a?0:1));f+=m.length;const p=ZF(m,u);d<a&&m.push(0),l.push(m.concat(p))}const h=[];for(let d=0;d<l[0].length;d++)l.forEach((f,m)=>{(d!==c-s||m>=a)&&h.push(f[d])});return h}drawCodewords(e){if(e.length!==Math.floor(Qd(this.version)/8))throw new RangeError("Invalid argument");let r=0;for(let n=this.size-1;n>=1;n-=2){n===6&&(n=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=n-s,c=(n+1&2)===0?this.size-1-i:i;!this.types[c][o]&&r<e.length*8&&(this.modules[c][o]=Ri(e[r>>>3],7-(r&7)),r++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let r=0;r<this.size;r++)for(let n=0;n<this.size;n++){let i;switch(e){case 0:i=(n+r)%2===0;break;case 1:i=r%2===0;break;case 2:i=n%3===0;break;case 3:i=(n+r)%3===0;break;case 4:i=(Math.floor(n/3)+Math.floor(r/2))%2===0;break;case 5:i=n*r%2+n*r%3===0;break;case 6:i=(n*r%2+n*r%3)%2===0;break;case 7:i=((n+r)%2+n*r%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[r][n]&&i&&(this.modules[r][n]=!this.modules[r][n])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=$E:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*ou),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*ou}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=$E:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*ou),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*ou}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=BF)}let r=0;for(const s of this.modules)r=s.reduce((o,a)=>o+(a?1:0),r);const n=this.size*this.size,i=Math.ceil(Math.abs(r*20-n*10)/n)-1;return e+=i*DF,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,r=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,n=[6];for(let i=this.size-7;n.length<e;i-=r)n.splice(1,0,i);return n}}finderPenaltyCountPatterns(e){const r=e[1],n=r>0&&e[2]===r&&e[3]===r*3&&e[4]===r&&e[5]===r;return(n&&e[0]>=r*4&&e[6]>=r?1:0)+(n&&e[6]>=r*4&&e[0]>=r?1:0)}finderPenaltyTerminateAndCount(e,r,n){return e&&(this.finderPenaltyAddHistory(r,n),r=0),r+=this.size,this.finderPenaltyAddHistory(r,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(e,r){r[0]===0&&(e+=this.size),r.pop(),r.unshift(e)}}function Si(t,e,r){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let n=e-1;n>=0;n--)r.push(t>>>n&1)}function Ri(t,e){return(t>>>e&1)!==0}class Jd{constructor(e,r,n){if(this.mode=e,this.numChars=r,this.bitData=n,r<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}getData(){return this.bitData.slice()}}const zF=[1,10,12,14],WF=[2,9,11,13],HF=[4,8,16,16];function jE(t,e){return t[Math.floor((e+7)/17)+1]}function zE(t){const e=[];for(const r of t)Si(r,8,e);return new Jd(HF,t.length,e)}function GF(t){if(!WE(t))throw new RangeError("String contains non-numeric characters");const e=[];for(let r=0;r<t.length;){const n=Math.min(t.length-r,3);Si(Number.parseInt(t.substring(r,r+n),10),n*3+1,e),r+=n}return new Jd(zF,t.length,e)}function KF(t){if(!HE(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let r;for(r=0;r+2<=t.length;r+=2){let n=Vd.indexOf(t.charAt(r))*45;n+=Vd.indexOf(t.charAt(r+1)),Si(n,11,e)}return r<t.length&&Si(Vd.indexOf(t.charAt(r)),6,e),new Jd(WF,t.length,e)}function qF(t){return t===""?[]:WE(t)?[GF(t)]:HE(t)?[KF(t)]:[zE(VF(t))]}function WE(t){return PF.test(t)}function HE(t){return $F.test(t)}function YF(t,e){let r=0;for(const n of t){const i=jE(n.mode,e);if(n.numChars>=1<<i)return Number.POSITIVE_INFINITY;r+=4+i+n.bitData.length}return r}function VF(t){t=encodeURI(t);const e=[];for(let r=0;r<t.length;r++)t.charAt(r)!=="%"?e.push(t.charCodeAt(r)):(e.push(Number.parseInt(t.substring(r+1,r+3),16)),r+=2);return e}function Qd(t){if(t<Xd||t>Zd)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const r=Math.floor(t/7)+2;e-=(25*r-10)*r-55,t>=7&&(e-=36)}return e}function au(t,e){return Math.floor(Qd(t)/8)-BE[e[0]][t]*DE[e[0]][t]}function XF(t){if(t<1||t>255)throw new RangeError("Degree out of range");const e=[];for(let n=0;n<t-1;n++)e.push(0);e.push(1);let r=1;for(let n=0;n<t;n++){for(let i=0;i<e.length;i++)e[i]=ep(e[i],r),i+1<e.length&&(e[i]^=e[i+1]);r=ep(r,2)}return e}function ZF(t,e){const r=e.map(n=>0);for(const n of t){const i=n^r.shift();r.push(0),e.forEach((s,o)=>r[o]^=ep(s,i))}return r}function ep(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let r=0;for(let n=7;n>=0;n--)r=r<<1^(r>>>7)*285,r^=(e>>>n&1)*t;return r}function JF(t,e,r=1,n=40,i=-1,s=!0){if(!(Xd<=r&&r<=n&&n<=Zd)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=r;;o++){const h=au(o,e)*8,d=YF(t,o);if(d<=h){a=d;break}if(o>=n)throw new RangeError("Data too long")}for(const h of[UE,FE,PE])s&&a<=au(o,h)*8&&(e=h);const c=[];for(const h of t){Si(h.mode[0],4,c),Si(h.numChars,jE(h.mode,o),c);for(const d of h.getData())c.push(d)}const l=au(o,e)*8;Si(0,Math.min(4,l-c.length),c),Si(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)Si(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,d)=>u[d>>>3]|=h<<7-(d&7)),new jF(o,e,u,i)}function QF(t,e){const{ecc:r="L",boostEcc:n=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof t=="string"?qF(t):Array.isArray(t)?[zE(t)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof t}`);const l=JF(c,FF[r],i,s,o,n),u=eP({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e?.invert&&(u.data=u.data.map(h=>h.map(d=>!d))),e?.onEncoded?.(u),u}function eP(t,e=1){if(!e)return t;const{size:r}=t,n=r+e*2;t.size=n,t.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)t.data.unshift(Array.from({length:n},o=>!1)),t.data.push(Array.from({length:n},o=>!1));const i=Os.Border;t.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)t.types.unshift(Array.from({length:n},o=>i)),t.types.push(Array.from({length:n},o=>i));return t}function tP(t,e,r,n=!1){return e<0||r<0||e>=t.length||r>=t.length?n:t[r][e]}function rP(t,e={}){const r={WHITE_ALL:"█",WHITE_BLACK:"▀",BLACK_WHITE:"▄",BLACK_ALL:" "},n=QF(t,e),i=!1,s=!0,o=(l,u)=>tP(n.data,l,u,!0),a=[];let c="";for(let l=0;l<n.size;l+=2){for(let u=0;u<n.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=r.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=r.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=r.BLACK_WHITE:c+=r.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const Is="$dkpurple",nP="$196",iP="$205",qt="$yellow$205$205$205$196";function yt(t,e,r){BT(t,e,r)}function sP(t,e,r){const n=nP.repeat(r);yt(t,e,`${Is}${n}`)}function tp(t,e,r){const n=iP.repeat(r);yt(t,e,`${Is}${n}`)}function rp(t,e,r){sP(t,e,r.length+2),yt(t,e,`${Is} $white${r} `),tp(t,e,r.length+2)}function Ns(t,e,r){yt(t,e,`${Is} ${" ".repeat(r.length)} `),yt(t,e,`${Is} $gray${r} `),tp(t,e,r.length+2)}function Cs(t,e,r,n){yt(t,e,`${Is} $white${r} $blue${n}`)}function To(t,e,r){yt(t,e,`${Is}$blue${r}`)}function oP(t,e,r,n){yt(t,e,`!${r};${n}`)}function aP(t,e,r,n,i=!0){if(i){const s=rP(r).split(`
`),o={32:32,9600:223,9604:220,9608:219};for(let a=0;a<s.length;a++){const c=[...s[a]].map(l=>`$${o[l.charCodeAt(0)]}`).join("");yt(t,e,c)}}yt(t,e,`!copyit ${r};${n}`),bS(t,e)}var cP=`desc;$DKGRAYname and type of codepage
`,lP=Object.freeze({__proto__:null,default:cP}),uP="desc;changes object into specified element",fP=Object.freeze({__proto__:null,default:uP}),hP="desc;like #play but for sound effects",dP=Object.freeze({__proto__:null,default:hP}),pP="",mP=Object.freeze({__proto__:null,default:pP}),gP="",yP=Object.freeze({__proto__:null,default:gP}),_P="",bP=Object.freeze({__proto__:null,default:_P}),wP="",vP=Object.freeze({__proto__:null,default:wP}),EP="",kP=Object.freeze({__proto__:null,default:EP}),xP="",AP=Object.freeze({__proto__:null,default:xP}),TP="",SP=Object.freeze({__proto__:null,default:TP}),RP="",OP=Object.freeze({__proto__:null,default:RP}),IP="",NP=Object.freeze({__proto__:null,default:IP}),CP="",LP=Object.freeze({__proto__:null,default:CP}),MP="",UP=Object.freeze({__proto__:null,default:MP}),FP="",PP=Object.freeze({__proto__:null,default:FP}),$P="",BP=Object.freeze({__proto__:null,default:$P}),DP="",jP=Object.freeze({__proto__:null,default:DP}),zP="",WP=Object.freeze({__proto__:null,default:zP}),HP=`desc;$DKGRAYstarts a section of an if-do-done block
`,GP=Object.freeze({__proto__:null,default:HP}),KP=`desc;$DKGRAYcompletes an if-do-done block
`,qP=Object.freeze({__proto__:null,default:KP}),YP="",VP=Object.freeze({__proto__:null,default:YP}),XP="",ZP=Object.freeze({__proto__:null,default:XP}),JP="",QP=Object.freeze({__proto__:null,default:JP}),e$=`desc;$DKGRAYelse logic in an if-do-done block
`,t$=Object.freeze({__proto__:null,default:e$}),r$=`desc;$DKGRAYconditional else logic in an if-do-done block
`,n$=Object.freeze({__proto__:null,default:r$}),i$="",s$=Object.freeze({__proto__:null,default:i$}),o$="",a$=Object.freeze({__proto__:null,default:o$}),c$="",l$=Object.freeze({__proto__:null,default:c$}),u$="",f$=Object.freeze({__proto__:null,default:u$}),h$="",d$=Object.freeze({__proto__:null,default:h$}),p$="",m$=Object.freeze({__proto__:null,default:p$}),g$="",y$=Object.freeze({__proto__:null,default:g$}),_$="",b$=Object.freeze({__proto__:null,default:_$}),w$=`desc;$DKGRAYhalt until the next cycle
`,v$=Object.freeze({__proto__:null,default:w$}),E$=`desc;$DKGRAYevals condition for true or false
`,k$=Object.freeze({__proto__:null,default:E$}),x$="",A$=Object.freeze({__proto__:null,default:x$}),T$="",S$=Object.freeze({__proto__:null,default:T$}),R$="",O$=Object.freeze({__proto__:null,default:R$}),I$="",N$=Object.freeze({__proto__:null,default:I$}),C$="",L$=Object.freeze({__proto__:null,default:C$}),M$="",U$=Object.freeze({__proto__:null,default:M$}),F$="",P$=Object.freeze({__proto__:null,default:F$}),$$="",B$=Object.freeze({__proto__:null,default:$$}),D$="",j$=Object.freeze({__proto__:null,default:D$}),z$="",W$=Object.freeze({__proto__:null,default:z$}),H$="",G$=Object.freeze({__proto__:null,default:H$}),K$="",q$=Object.freeze({__proto__:null,default:K$}),Y$="",V$=Object.freeze({__proto__:null,default:Y$}),X$="",Z$=Object.freeze({__proto__:null,default:X$}),J$="",Q$=Object.freeze({__proto__:null,default:J$}),eB="",tB=Object.freeze({__proto__:null,default:eB}),rB="",nB=Object.freeze({__proto__:null,default:rB}),iB="",sB=Object.freeze({__proto__:null,default:iB}),oB="",aB=Object.freeze({__proto__:null,default:oB}),cB="",lB=Object.freeze({__proto__:null,default:cB}),uB="",fB=Object.freeze({__proto__:null,default:uB}),hB=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,dB=Object.freeze({__proto__:null,default:hB}),pB="",mB=Object.freeze({__proto__:null,default:pB}),gB="",yB=Object.freeze({__proto__:null,default:gB}),_B="",bB=Object.freeze({__proto__:null,default:_B}),wB="",vB=Object.freeze({__proto__:null,default:wB}),EB="",kB=Object.freeze({__proto__:null,default:EB}),xB="",AB=Object.freeze({__proto__:null,default:xB}),TB="",SB=Object.freeze({__proto__:null,default:TB}),RB="",OB=Object.freeze({__proto__:null,default:RB}),IB="",NB=Object.freeze({__proto__:null,default:IB}),CB="",LB=Object.freeze({__proto__:null,default:CB}),MB="",UB=Object.freeze({__proto__:null,default:MB}),FB="",PB=Object.freeze({__proto__:null,default:FB}),$B="",BB=Object.freeze({__proto__:null,default:$B}),DB="",jB=Object.freeze({__proto__:null,default:DB}),zB="",WB=Object.freeze({__proto__:null,default:zB}),HB="",GB=Object.freeze({__proto__:null,default:HB}),KB="",qB=Object.freeze({__proto__:null,default:KB}),YB="",VB=Object.freeze({__proto__:null,default:YB}),XB="",ZB=Object.freeze({__proto__:null,default:XB}),JB=`desc;$DKGRAYdesignates an inactive label or comment
`,QB=Object.freeze({__proto__:null,default:JB}),eD=`desc;$DKGRAYadds hyperlink text

`,tD=Object.freeze({__proto__:null,default:eD}),rD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,nD=Object.freeze({__proto__:null,default:rD}),iD=`desc;$DKGRAYread number input into given stat/flag
`,sD=Object.freeze({__proto__:null,default:iD}),oD=`desc;$DKGRAYa slider input from 1 to 9 

`,aD=Object.freeze({__proto__:null,default:oD}),cD=`desc;$DKGRAYlist with label value pairs to pick from
`,lD=Object.freeze({__proto__:null,default:cD}),uD=`desc;$DKGRAYread text input into given stat/flag
`,fD=Object.freeze({__proto__:null,default:uD}),hD=`desc;$DKGRAYdesignates a starting point for running code
`,dD=Object.freeze({__proto__:null,default:hD}),pD=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,mD=Object.freeze({__proto__:null,default:pD}),gD=`desc;$DKGRAYwill move the object in the given direction
`,yD=Object.freeze({__proto__:null,default:gD}),_D=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,bD=Object.freeze({__proto__:null,default:_D}),wD=`desc;$DKGRAYcustom 8x14 charset
`,vD=Object.freeze({__proto__:null,default:wD}),ED=`desc;$DKGRAYsets stat to given value

`,kD=Object.freeze({__proto__:null,default:ED}),xD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,AD=Object.freeze({__proto__:null,default:xD}),TD=`desc;$DKGRAYread external content and/or handle events
`,SD=Object.freeze({__proto__:null,default:TD}),RD=`desc;$DKGRAYread number input into given stat/flag
`,OD=Object.freeze({__proto__:null,default:RD}),ID=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,ND=Object.freeze({__proto__:null,default:ID}),CD=`desc;$DKGRAYcustom palette colors
`,LD=Object.freeze({__proto__:null,default:CD}),MD=`desc;$DKGRAYa slider input from 1 to 9 

`,UD=Object.freeze({__proto__:null,default:MD}),FD=`desc;$DKGRAYlist with label value pairs to pick from
`,PD=Object.freeze({__proto__:null,default:FD}),$D=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,BD=Object.freeze({__proto__:null,default:$D}),DD=`desc;$DKGRAYread text input into given stat/flag
`,jD=Object.freeze({__proto__:null,default:DD}),zD=`desc;$DKGRAYadds text
`,WD=Object.freeze({__proto__:null,default:zD}),HD=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,GD=Object.freeze({__proto__:null,default:HD}),KD=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,qD=Object.freeze({__proto__:null,default:KD}),YD=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,VD=Object.freeze({__proto__:null,default:YD}),XD=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,ZD=Object.freeze({__proto__:null,default:XD}),JD=`header;player settings
#set user "name goes here"
`,QD=Object.freeze({__proto__:null,default:JD}),e4=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,t4=Object.freeze({__proto__:null,default:e4}),r4=`section;#autowah on
#autowah <number>
$white 0-100, 0 is off, 100 is full volume
#autowah basefrequency <frequency>
$white The frequency the filter is set to at the
$white low point of the wah.
#autowah octaves <number>
$white The number of octaves above the baseFrequency 
$white the filter will sweep to when fully open.
#autowah sensitivity <number>
$white The decibel threshold sensitivity for 
$white the incoming signal.
$white Normal range of -40 to 0.
#autowah gain <number>
$white Controls the loudness of the effect.
#autowah follower <seconds>
$white Sets the smoothing time for the effect.`,n4=Object.freeze({__proto__:null,default:r4}),i4=`section;#distort on
#distort <number>
$white 0-100, 0 is off, 100 is full volume
#distort distortion <number>
$white 0 or higher, controls strength of effect.
#distort oversample <2x|4x|none>
$white oversample improves quality.`,s4=Object.freeze({__proto__:null,default:i4}),o4=`section;#echo on
#echo <number>
$white 0-100, 0 is off, 100 is full volume
#echo delaytime <seconds>
$white duration between echos.
#echo feedback <number>
$white A number that is between [0, 1]
$white 1 is forever feedback and 0 is none.`,a4=Object.freeze({__proto__:null,default:o4}),c4=`!fcrushscroll hk f F next;#fcrush on
!echoscroll hk e E next;#echo on
!reverbscroll hk r R next;#reverb on
!phaserscroll hk p P next;#phaser on
!distortscroll hk d D next;#distort on
!vibratoscroll hk v V next;#vibrato on
!autowahscroll hk a A next;#autowah on`,l4=Object.freeze({__proto__:null,default:c4}),u4=`section;#fcrush on
#fcrush <number>
$white 0-100, 0 is off, 100 is full volume
#fcrush rate <number>
$white 1 or higher, more rate, more crush`,f4=Object.freeze({__proto__:null,default:u4}),h4=`helper scrolls
!charscroll hk a A next;char
!colorscroll hk c C next;color
!notesscroll hk n N next;notes
!synthscroll hk s S next;synth
!effectsscroll hk e E next;effects
!voicescroll hk v V next;tts voices`,d4=Object.freeze({__proto__:null,default:h4}),p4=`"duration             cdefgab - notes 
"y - 64th note        x - rest
"t - 32nd note        
"s - 16th note.       drums
"i - eight note.      0 - hihat
"q - quarter note     1 - open hihat
"h - half note        2 - cowbell
"w - whole note       p - clap
"                     4 - high snare
"mods                 5 - high woodblock
"3 - triplet          6 - low snare
". - time and a half  7 - low tom
"# - sharp            8 - low woodblock
"! - flat             9 - bass drum`,m4=Object.freeze({__proto__:null,default:p4}),g4=`section;sine, square, triangle, sawtooth
#synth phase <degrees>
$white The phase is the starting position within 
$white the oscillator's cycle. For example a phase 
$white of 180 would start halfway through the
$white oscillator's cycle.
section;amsine, amsquare, amtriangle, amsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
section;fmsine, fmsquare, fmtriangle, fmsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
#synth modindex <degrees>
$white The modulation index which is in essence
$white the depth or amount of the modulation.
$white In other terms it is the ratio of the 
$white frequency of the modulating signal (mf) 
$white to the amplitude of the modulating signal 
$white (ma) -- as in ma/mf
#synth modenv <a> <d> <s> <r> - in seconds
section;fatsine, fatsquare, fattriangle, fatsawtooth
#synth phase <degrees>
#synth count <number>
$white This sets the number of oscillators to 
$white spread along the given range.
#synth spread <cents>
$white This signals the number of cents between
$white oscillators.`,y4=Object.freeze({__proto__:null,default:g4}),_4=`section;#phaser on
#phaser <number>
$white 0-100, 0 is off, 100 is full volume
#phaser frequency <frequency>
$white The rate of oscilation of the effect.
#phaser octaves <number>
$white Controls the range of the effect.
#phaser basefrequency <frequency>
$white The base frequency of the filters.
`,b4=Object.freeze({__proto__:null,default:_4}),w4=`section;pulse
#synth width <range>
$white A number that is between [-1, 1] altering
$white this value changes the shape of the square
$white wave`,v4=Object.freeze({__proto__:null,default:w4}),E4=`section;pwm
#synth modfreq <frequency>
$white This sets the frequency of change for the 
$white pulse width of this oscillator.`,k4=Object.freeze({__proto__:null,default:E4}),x4=`section;#reverb on
#reverb <number>
$white 0-100, 0 is off, 100 is full volume
#reverb predelay <seconds>
$white The amount of time before the reverb
$white is fully ramped in.
#reverb decay <seconds>
$white The duration of the reverb.
`,A4=Object.freeze({__proto__:null,default:x4}),T4=`switching voices
#synth <sine, square, triangle, sawtooth> 
#synth <pwm, pulse, bells, doot>
#synth <retro, buzz, clang, metallic>

voice settings
#synth restart - resets voice to default
#synth vol <db> - control volume
#synth port <seconds>
#synth env <attack> <delay> <sustain> <release>

voice specific 
!oscscroll hk o O next;sine, square, triangle, sawtooth
!pwmscroll hk m M next;pwm
!pulsescroll hk p P next;pulse`,S4=Object.freeze({__proto__:null,default:T4}),R4=`section;#vibrato on
#vibrato <number>
$white 0-100, 0 is off, 100 is full volume
#vibrato maxdelay <seconds>
$white longer delay increases the vibrato`,O4=Object.freeze({__proto__:null,default:R4}),I4=`!copyit "ar-SA-HamedNeural";ar-SA-HamedNeural
!copyit "ar-SA-ZariyahNeural";ar-SA-ZariyahNeural
!copyit "de-DE-AmalaNeural";de-DE-AmalaNeural
!copyit "de-DE-ConradNeural";de-DE-ConradNeural
!copyit "de-DE-KatjaNeural";de-DE-KatjaNeural
!copyit "de-DE-KillianNeural";de-DE-KillianNeural
!copyit "en-US-AnaNeural";en-US-AnaNeural
!copyit "en-US-AndrewNeural";en-US-AndrewNeural
!copyit "en-US-AriaNeural";en-US-AriaNeural
!copyit "en-US-ChristopherNeural";en-US-ChristopherNeural
!copyit "en-US-EricNeural";en-US-EricNeural
!copyit "en-US-GuyNeural";en-US-GuyNeural
!copyit "en-US-JennyNeural";en-US-JennyNeural
!copyit "en-US-MichelleNeural";en-US-MichelleNeural
!copyit "en-US-RogerNeural";en-US-RogerNeural
!copyit "en-US-SteffanNeural";en-US-SteffanNeural
!copyit "es-ES-AlvaroNeural";es-ES-AlvaroNeural
!copyit "es-ES-ElviraNeural";es-ES-ElviraNeural
!copyit "fr-FR-DeniseNeural";fr-FR-DeniseNeural
!copyit "fr-FR-EloiseNeural";fr-FR-EloiseNeural
!copyit "fr-FR-HenriNeural";fr-FR-HenriNeural`,N4=Object.freeze({__proto__:null,default:I4});const GE=Object.assign({"./editor/codepagename.txt":lP,"./editor/command/become.txt":fP,"./editor/command/bgplay.txt":dP,"./editor/command/bgvol.txt":mP,"./editor/command/bind.txt":yP,"./editor/command/board.txt":bP,"./editor/command/bpm.txt":vP,"./editor/command/break.txt":kP,"./editor/command/change.txt":AP,"./editor/command/char.txt":SP,"./editor/command/charset.txt":OP,"./editor/command/clear.txt":NP,"./editor/command/color.txt":LP,"./editor/command/continue.txt":UP,"./editor/command/copy.txt":PP,"./editor/command/cycle.txt":BP,"./editor/command/die.txt":jP,"./editor/command/distort.txt":WP,"./editor/command/do.txt":GP,"./editor/command/done.txt":qP,"./editor/command/duplicate.txt":VP,"./editor/command/echo.txt":ZP,"./editor/command/edge.txt":QP,"./editor/command/else.txt":t$,"./editor/command/elseif.txt":n$,"./editor/command/end.txt":s$,"./editor/command/endgame.txt":a$,"./editor/command/endwith.txt":l$,"./editor/command/fcrush.txt":f$,"./editor/command/fetch.txt":d$,"./editor/command/fetchwith.txt":m$,"./editor/command/foreach.txt":y$,"./editor/command/go.txt":b$,"./editor/command/idle.txt":v$,"./editor/command/if.txt":k$,"./editor/command/lock.txt":A$,"./editor/command/oneof.txt":S$,"./editor/command/oneofwith.txt":O$,"./editor/command/palette.txt":N$,"./editor/command/phaser.txt":L$,"./editor/command/pivot.txt":U$,"./editor/command/play.txt":P$,"./editor/command/put.txt":B$,"./editor/command/putwith.txt":j$,"./editor/command/readbin.txt":W$,"./editor/command/readjson.txt":G$,"./editor/command/readline.txt":q$,"./editor/command/readrexpaint.txt":V$,"./editor/command/remix.txt":Z$,"./editor/command/repeat.txt":Q$,"./editor/command/restore.txt":tB,"./editor/command/reverb.txt":nB,"./editor/command/revert.txt":sB,"./editor/command/run.txt":aB,"./editor/command/runwith.txt":lB,"./editor/command/set.txt":fB,"./editor/command/shoot.txt":dB,"./editor/command/shootwith.txt":mB,"./editor/command/shove.txt":yB,"./editor/command/snapshot.txt":bB,"./editor/command/synth.txt":vB,"./editor/command/toast.txt":kB,"./editor/command/tts.txt":AB,"./editor/command/ttsvol.txt":SB,"./editor/command/twitchbroadcast.txt":OB,"./editor/command/twitchchat.txt":NB,"./editor/command/unlock.txt":LB,"./editor/command/vibrato.txt":UB,"./editor/command/vol.txt":PB,"./editor/command/waitfor.txt":BB,"./editor/command/walk.txt":jB,"./editor/command/weave.txt":WB,"./editor/command/while.txt":GB,"./editor/command/with.txt":qB,"./editor/command/write.txt":VB,"./editor/command/zap.txt":ZB,"./editor/comment.txt":QB,"./editor/hyperlink.txt":tD,"./editor/hyperlink/hotkey.txt":nD,"./editor/hyperlink/number.txt":sD,"./editor/hyperlink/range.txt":aD,"./editor/hyperlink/select.txt":lD,"./editor/hyperlink/text.txt":fD,"./editor/label.txt":dD,"./editor/shortgo.txt":mD,"./editor/shorttry.txt":yD,"./editor/stat/board.txt":bD,"./editor/stat/charset.txt":vD,"./editor/stat/const.txt":kD,"./editor/stat/hotkey.txt":AD,"./editor/stat/loader.txt":SD,"./editor/stat/number.txt":OD,"./editor/stat/object.txt":ND,"./editor/stat/palette.txt":LD,"./editor/stat/range.txt":UD,"./editor/stat/select.txt":PD,"./editor/stat/terrain.txt":BD,"./editor/stat/text.txt":jD,"./editor/text.txt":WD,"./help/controls.txt":GD,"./help/developer.txt":qD,"./help/menu.txt":VD,"./help/nopages.txt":ZD,"./help/player.txt":QD,"./help/text.txt":t4,"./refscroll/autowahscroll.txt":n4,"./refscroll/distortscroll.txt":s4,"./refscroll/echoscroll.txt":a4,"./refscroll/effectsscroll.txt":l4,"./refscroll/fcrushscroll.txt":f4,"./refscroll/menu.txt":d4,"./refscroll/notesscroll.txt":m4,"./refscroll/oscscroll.txt":y4,"./refscroll/phaserscroll.txt":b4,"./refscroll/pulsescroll.txt":v4,"./refscroll/pwmscroll.txt":k4,"./refscroll/reverbscroll.txt":A4,"./refscroll/synthscroll.txt":S4,"./refscroll/vibratoscroll.txt":O4,"./refscroll/voicescroll.txt":N4}),KE={};Mr(GE).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");KE[e]=GE[t].default});function np(t){const e=Be(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),r=KE[e];if(w(r))return r;const{target:n,path:i}=Fr(e);switch(n){case"editor":{const s=Fr(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function ip(t,e){const r=(t??"").split(`
`);for(let n=0;n<r.length;++n)e(r[n].split(";"))}function C4(t,e){const[r,...n]=e,i=n[0]??"",s=n[1]??"";switch(Be(r.trim())){case"header":rp(le,t,i);break;case"section":Ns(le,t,i);break;case"option":Cs(le,t,i,s);break;default:r.trimStart().startsWith("!")?oP(le,t,r.trimStart().slice(1),i):yt(le,t,r);break}}const Ls="$dkpurple",L4="$196",M4="$205";function U4(t,e){const r=L4.repeat(e);Pe(t,`${Ls}${r}`)}function qE(t,e){const r=M4.repeat(e);Pe(t,`${Ls}${r}`)}function F4(t,e){Pe(t,`${Ls} ${" ".repeat(e.length)} `),U4(t,e.length+2),Pe(t,`${Ls} $white${e} `),qE(t,e.length+2)}function P4(t,e){Pe(t,`${Ls} ${" ".repeat(e.length)} `),Pe(t,`${Ls} $gray${e} `),qE(t,e.length+2)}function $4(t,e,r){Pe(t,`${Ls} $white${e} $blue${r}`)}function YE(t,e){const[r,...n]=e,i=n[0]??"",s=n[1]??"";switch(Be(r.trim())){case"header":F4(t,i);break;case"section":P4(t,i);break;case"option":$4(t,i,s);break;default:if(r.trimStart().startsWith("!")){const o=r.trimStart().slice(1).split(" ");switch(Be(o[0]??"")){case"copyit":De(t,"refscroll",i,["",o[0]??"",o[1]??""]);break;default:{switch(Be(o[1]??"")){case"hk":case"hotkey":De(t,"refscroll",i,[o[0]??"",o[1]??"",o[2]??"",` ${o[3]??""} `,o[4]??""]);break;default:De(t,"refscroll",i,[o[0]??""]);break}break}}}else r.trimStart().startsWith('"')?Pe(t,r.trimStart().slice(1)):Pe(t,r);break}}function Oi(t,e=!1){const[r]=ue(t,0,[Z.ANY]);if(e&&tn(r)){const[n,i,s]=ue(t,0,[Z.DIR,Z.MAYBE_NAME]);return ye(i)&&i.startsWith(":")?{targetdir:n,label:[i.substring(1).trim(),...t.slice(s)].join(" ")}:{targetdir:n,label:t.slice(s-1).join(" ")}}else if(ye(r)){const[n,i,s]=ue(t,0,[Z.NAME,Z.MAYBE_NAME]);if(ye(i)&&i.startsWith(":")){const a=[i.substring(1).trim(),...t.slice(s)];return{targetname:n,label:a.join(" ")}}return{targetname:"self",label:[n,...t.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Ms(){Am(le,wr())}function So(t){ip(np(`help:${t}`),e=>C4(k.elementfocus,e))}function VE(t){switch(t.label){case"helpmenu":So("menu");break;case"helpcontrols":So("controls");break;case"helptext":So("text");break;case"helpdeveloper":So("developer");break;case"helpplayer":So("player");break;default:{const e=dt(Xe.MAIN),r=Ao(e);w(t.targetname)?Uo(t.targetname,t.label,void 0,r):w(t.targetdir)&&Uo(t.targetdir.destpt,t.label,void 0,r);break}}}const B4=yi().command("shortsend",(t,e)=>{const r=Oi(e);return VE(r),0}).command("send",(t,e)=>{const r=Oi(e,!0);return VE(r),0}).command("stat",(t,e)=>{const[r,...n]=e.map(Ut),i=n.join(" ");function s(o,a){if(w(o)&&(t.command("pageopen",o.id),a)){const c=gt(o),l=Ai(o);yt(le,k.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(Be(r)){case sn(Fe.LOADER):{const[o,a]=Vi(Xe.MAIN,i,Re.LOADER);s(o,a);break}default:{const[o,a]=Vi(Xe.MAIN,[r,...n].join(" "),Re.OBJECT);s(o,a);break}case sn(Fe.BOARD):{const[o,a]=Vi(Xe.MAIN,i,Re.BOARD);s(o,a);break}case sn(Fe.OBJECT):{const[o,a]=Vi(Xe.MAIN,i,Re.OBJECT);s(o,a);break}case sn(Fe.TERRAIN):{const[o,a]=Vi(Xe.MAIN,i,Re.TERRAIN);s(o,a);break}case sn(Fe.CHARSET):{const[o,a]=Vi(Xe.MAIN,i,Re.CHARSET);s(o,a);break}case sn(Fe.PALETTE):{const[o,a]=Vi(Xe.MAIN,i,Re.PALETTE);s(o,a);break}}return 0}).command("text",(t,e)=>{const r=e.map(Ut).join(" ");if(w(k.element)&&k.elementisplayer){const{user:n}=Kr(k.elementid),i=ye(n)?n:"player";k.element.tickertext=`${i}:$BLUE ${r}`,k.element.tickertime=k.timestamp;const s=er(k.element);DT(le,k.elementid,`$${it[s.color]}$ON${it[s.bg]}$${s.char}$ONCLEAR$WHITE ${i}:$BLUE ${r}`),df(le,k.elementid,void 0,"text","chat:message:game",`${i}:${r}`)}return 0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Ut(r),s=Oi(n);if(w(s.targetname)){const{user:o}=Kr(k.elementid),a=ye(o)?o:"player",c=er(k.element),l=`$${it[c.color]}$ON${it[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;Pt(le,k.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(t,e)=>{const[r,n]=ue(e,0,[Z.MAYBE_NAME,Z.MAYBE_STRING]);return ye(r)&&ye(n)?Em(le,k.elementfocus,r,n):yS(le,k.elementfocus),0}).command("bookcreate",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]),n=Xx(r);return w(n)&&t.command("bookopen",n.id),0}).command("bookopen",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=$n(r);return w(n)?(Em(le,k.elementfocus,"selected",n.id),Ms()):mt(le,k.elementfocus,"bookopen",`book ${r} not found`),0}).command("booktrash",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=dt(Xe.MAIN),i=$n(r);return w(i)&&(n===i&&Vx(Xe.MAIN,""),ez(r),Pt(le,k.elementfocus,`trashed [book] ${i.name}`),Ms(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=fr(r);return w(n)&&xo(k.book,k.elementfocus,n.id,{x:hn(0,Me-1),y:hn(0,rt-1)},!0),0}).command("pageopen",(t,e)=>{const[r,n]=ue(e,0,[Z.NAME,Z.MAYBE_NAME]);let i,s;const o=wn();for(let a=0;a<o.length&&(s=o[a],i=Ts(s,r),!w(i));++a);if(w(i)&&w(s)){const a=gt(i),c=[i.id,n];ih(uc(s.id,c),i.code);const l=Ai(i);km(le,k.elementfocus,s.id,c,l,`${a} - ${s.name}`)}else mt(le,"pageopen",`page ${r} not found`,k.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=lr(Xe.MAIN),i=vE(n,r);if(w(r)){const s=gt(i),o=Ai(i);Pt(le,k.elementfocus,`trashed [${o}] ${s}`),Ms(),t.command("pages")}return 0}).command("help",(t,e)=>{const r=e.map(Ut).join(" ")||"menu";return t.command(`help${r}`),0}).command("books",()=>{Ns(le,k.elementfocus,"books");const t=dt(Xe.MAIN);Cs(le,k.elementfocus,"main",`${t?.name??"empty"} $GREEN${t?.id??""}`);const e=dt(Xe.MAIN);Cs(le,k.elementfocus,"content",`${e?.name??"empty"} ${e?.id??""}`),tp(le,k.elementfocus,7);const r=wn();return r.length?r.forEach(n=>{yt(le,k.elementfocus,`!bookopen ${n.id};${n.name}`)}):To(le,k.elementfocus,"no books found"),yt(le,k.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=lr(Xe.MAIN);if(!w(t))return 0;Ns(le,k.elementfocus,"pages"),Cs(le,k.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?Wa(t).forEach(n=>{const i=gt(n),s=Ai(n);yt(le,k.elementfocus,`!pageopen ${n.id};$blue[${s}]$white ${i}`)}):(yt(le,k.elementfocus,""),So("nopages"));const e=wn();for(let r=0;r<e.length;++r){const n=e[r];n.id!==t.id&&(Cs(le,k.elementfocus,"content",`${n.name} $GREEN${n.id}`),Wa(n).forEach(s=>{const o=gt(s),a=Ai(s);yt(le,k.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Ns(le,k.elementfocus,"boards");const t=lr(Xe.MAIN);if(w(t)){Cs(le,k.elementfocus,"main",`${t.name} $GREEN${t.id}`);const r=Wa(t);r.filter(n=>ai(n)===Re.BOARD).forEach(n=>{const i=gt(n);yt(le,k.elementfocus,`!boardopen ${n.id};$blue[#goto]$white ${i}`)}),r.length===0&&(yt(le,k.elementfocus,""),To(le,k.elementfocus,"$white no boards found"),To(le,k.elementfocus,"$white use @ to create a board"),To(le,k.elementfocus,"$white @board name of board"))}const e=wn();for(let r=0;r<e.length;++r){const n=e[r];n.id!==t.id&&(Cs(le,k.elementfocus,"content",`${n.name} $GREEN${n.id}`),Wa(n).filter(s=>ai(s)===Re.BOARD).forEach(s=>{const o=gt(s);yt(le,k.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{Ns(le,k.elementfocus,"$REDTRASH"),To(le,k.elementfocus,"books");const t=wn();t.length&&(t.forEach(r=>{yt(le,k.elementfocus,`!booktrash ${r.id};$REDTRASH ${r.name}`)}),yt(le,k.elementfocus,""));const e=dt(Xe.MAIN);return w(e)&&(To(le,k.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(r=>{const n=gt(r);yt(le,k.elementfocus,`!pagetrash ${r.id};$REDTRASH ${n}`)}),yt(le,k.elementfocus,"")),0}).command("dev",()=>(Ms(),nS(le,k.elementfocus),0)).command("share",()=>(Ms(),iS(le,k.elementfocus),0)).command("save",()=>(Ms(),0)).command("fork",()=>(TS(le,k.elementfocus),0)).command("itchiopublish",()=>(SS(le,k.elementfocus),0)).command("nuke",()=>(sS(le,k.elementfocus),0)).command("restart",()=>(AS(le,k.elementfocus),Ms(),0)).command("export",()=>{rp(le,k.elementfocus,"E X P O R T"),Ns(le,k.elementfocus,"books");const t=wn();return t.length&&t.forEach(e=>yt(le,k.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=$n(r);return w(n)&&(rp(le,k.elementfocus,"E X P O R T"),Ns(le,k.elementfocus,"pages"),setTimeout(()=>{if(n.pages.length){const i=Wa(n);yt(le,k.elementfocus,`!bookallexport ${r};$blue[all]$white export book`),i.forEach(s=>{const o=gt(s),a=Ai(s);yt(le,k.elementfocus,`!pageexport ${r}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=$n(r);return w(n)&&wm(le,k.elementfocus,xn(n),`${n.name}.book.json`),0}).command("pageexport",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),{target:n,path:i}=Fr(r),s=$n(n),o=Ts(s,i);return w(o)&&wm(le,k.elementfocus,xn(o),`${gt(o)}.${Ai(o)}.json`),0}).command("gadget",()=>(_S(le,k.elementfocus),0)).command("zztsearch",(t,e)=>{const[r,n]=ue(e,0,[Z.NAME,Z.MAYBE_NAME]),i=w(n)?r:"title",s=w(n)?n:r;return wS(le,k.elementfocus,i,s),0}).command("zztrandom",()=>(vS(le,k.elementfocus),0)).command("joincode",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return KT(le,k.elementfocus,!!r),0}).command("jointab",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return qT(le,k.elementfocus,!!r),0}).command("startlookingglass",()=>(oS(le,k.elementfocus),0)),D4=yi().command("toast",(t,e)=>{const r=e.map(Ut).join("");return Vo(le,k.elementfocus,r),0}).command("ticker",(t,e)=>{const r=e.map(Ut).join("");return w(k.element)&&(k.element.tickertext=r,k.element.tickertime=k.timestamp),0}).command("palette",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=Jx(),i=ur(Re.PALETTE,r);return w(i)?(n.palette=i.id,Pt(le,k.elementfocus,`loaded palette ${r}`)):mt(le,k.elementfocus,"not-found",`unabled to find palette ${r}`),0}).command("charset",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=Jx(),i=ur(Re.CHARSET,r);return w(i)?(n.charset=i.id,Pt(le,k.elementfocus,`loaded charset ${r}`)):mt(le,k.elementfocus,"not-found",`unabled to find charset ${r}`),0}),sp={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};We.ISSOLID,We.ISWALK,We.ISSWIM,We.ISBULLET,We.ISGHOST,We.ISWALK,We.ISSWIM;function cu(t){return ut(t)&&op(t[0])}function op(t){return w(We[t])&&ye(t)}function j4(t){if(ye(t))return sp[Be(t)]}function z4(t){const e=k.words[t];if(cu(e))return[e,t+1];if(op(e))return[[e],t+1];const[r,n]=Nr(t);return cu(r)?[r,n]:op(r)?[[r],n]:[void 0,t]}function Ro(t,e=0){const r=[];let n=t;for(;n<k.words.length;){const[i,s]=Nr(n);if(ut(i)&&!tn(i)&&!qa(i)&&!cu(i)&&!Tr(i)&&r.push(...i),i==="|")return[r,s];if(n=s,r.push(i),e>0&&r.length>=e)return[r,n]}return[r,n]}function Nr(t){const e=k.words[t],r=t+1;if(ZE(e)){const[n,i]=W4(t);if(w(n))return[n,i]}if(j4(e)){const[n,i]=z4(t);if(w(n))return[n,i]}if(da(e)){const[n,i]=Kc(t);if(w(n))return[n,i]}if(ye(e)&&Be(e)==="rnd"){const[n,i]=Nr(r),[s,o]=Nr(i);return Te(n)&&Te(s)?[hn(n,s),o]:Te(n)?[hn(0,n),i]:[hn(0,1),r]}if(Wc(e)){const[n,i]=Oy(t);if(w(n))return[n,i]}if(!w(e))return[void 0,t];if(Te(e)||ut(e))return[e,r];if(ye(e)){const n=Be(e),i=k.get?.(e);if(w(i))return[i,r];switch(n){case"aligned":case"alligned":{const s=tc(k.board,{x:k.element?.x??-1,y:k.element?.y??-1},k.elementfocus);return!w(k.element)||!w(s)?[0,r]:[k.element.x===s.x||k.element.y===s.y?1:0,r]}case"contact":{const s=tc(k.board,{x:k.element?.x??-1,y:k.element?.y??-1},k.elementfocus);if(!w(k.element)||!w(s))return[0,r];const o=(s.x??0)-(k.element?.x??0),a=(s.y??0)-(k.element?.y??0);return[o===0&&Math.abs(a)<2||a===0&&Math.abs(o)<2?1:0,r]}case"blocked":{const[s,o]=ue(k.words,r,[Z.DIR]);return[cF(k.board,k.element,s.destpt)?1:0,o]}case"any":{const[s]=ue(k.words,r,[Z.ANY]);if(tn(s)){const[l,u,h]=ue(k.words,r,[Z.DIR,Z.COLOR_OR_KIND]);if(l.targets.length){const f=[];for(let m=0;m<l.targets.length;++m){const p=l.targets[m],g=["any","at",p.x,p.y,...u],[y]=ue(g,0,[Z.ANY]);ut(y)&&y.length&&f.push(...y)}return[f,h]}const d=l.layer===Ee.MID?nt(k.board,l.destpt):Xi(k.board,l.destpt.x,l.destpt.y);if(w(d)){const f=er(d);if(Tr(u))return[Hc(u)===f.color||Gc(u)===f.bg?[d]:[],h];const m=Be(Qa(u)),p=Tu(u);if((m.length&&m!==f.name||w(p)&&p!==f.color)===!1)return[[d],h]}return[[],h]}const[o,a]=ue(k.words,r,[Z.COLOR_OR_KIND]);return Tr(o)?[iA(k.board,o),a]:[Su(k.board,o),a]}case"countof":{const[s]=ue(k.words,r,[Z.ANY]);if(tn(s)){const[l,u,h]=ue(k.words,r,[Z.DIR,Z.COLOR_OR_KIND]);if(l.targets.length){let f=0;for(let m=0;m<l.targets.length;++m){const p=l.targets[m],g=["countof","at",p.x,p.y,...u],[y]=ue(g,0,[Z.ANY]);Te(y)&&(f+=y)}return[f,h]}const d=l.layer===Ee.MID?nt(k.board,l.destpt):Xi(k.board,l.destpt.x,l.destpt.y);if(w(d)){const f=er(d);if(Tr(u))return[Hc(u)===f.color||Gc(u)===f.bg?1:0,h];const m=Be(Qa(u)),p=Tu(u),g=m.length?m===f.name:!0,y=w(p)?p===f.color:!0;if(g&&y)return[1,h]}return[0,h]}const[o,a]=ue(k.words,r,[Z.COLOR_OR_KIND]);return Tr(o)?[iA(k.board,o).length,a]:[Su(k.board,o).length,a]}case"rnd":return[hn(0,1),r];case"abs":{const[s,o]=ue(k.words,r,[Z.NUMBER]);return[Math.abs(s),o]}case"intceil":{const[s,o]=ue(k.words,r,[Z.NUMBER]);return[Math.ceil(s),o]}case"intfloor":{const[s,o]=ue(k.words,r,[Z.NUMBER]);return[Math.floor(s),o]}case"intround":{const[s,o]=ue(k.words,r,[Z.NUMBER]);return[Math.round(s),o]}case"clamp":{const[s,o,a,c]=ue(k.words,r,[Z.NUMBER,Z.NUMBER,Z.NUMBER]);return[Bt(s,o,a),c]}case"min":{const[s,o]=Ro(r);return[Math.min(...s),o]}case"max":{const[s,o]=Ro(r);return[Math.max(...s),o]}case"pick":{const[s,o]=Ro(r);return[en(s),o]}case"pickwith":{const[s,o]=ue(k.words,r,[Z.NUMBER_OR_STRING]),[a,c]=Ro(o);return[RI(`${s}`,a),c]}case"random":{const[s,o]=Ro(r,2),[a,c]=s;return[hn(a,c??0),o]}case"randomwith":{const[s,o]=ue(k.words,r,[Z.NUMBER_OR_STRING]),[a,c]=Ro(o,2),[l,u]=a;return[xy(`${s}`,l,u??0),c]}case"run":{const[s,o]=ue(k.words,r,[Z.NAME]);return Au(s),[k.get?.("arg"),o]}case"runwith":{const[s,o,a]=ue(k.words,r,[Z.ANY,Z.NAME]);return w(k.element)&&(k.element.arg=s),Au(o),[k.get?.("arg"),a]}}}return[e,r]}const ap={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function qa(t){return ut(t)&&XE(t[0])}function XE(t){return w(Ur[t])&&ye(t)}function ZE(t){if(ye(t))return ap[Be(t)]}function JE(t){if(qa(t))return t;if(XE(t))return[t];const e=ZE(t);if(w(e))return[e]}function W4(t){const e=k.words[t],r=JE(e);if(qa(r))return[r,t+1];const[n,i]=Nr(t),s=JE(n);return qa(s)?[s,i]:[void 0,t]}const H4=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),QE=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"]),G4=["NORTH","SOUTH","WEST","EAST"];function K4(t){const e=Kr(t);if(Te(e.inputcurrent)||(e.inputcurrent=0),ut(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[r]=e.inputqueue,[n=Sr.NONE,i=0]=r??[Sr.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&YI?1:0,e.inputctrl=i&VI?1:0,e.inputshift=i&XI?1:0,n){case Sr.MOVE_UP:case Sr.MOVE_DOWN:case Sr.MOVE_LEFT:case Sr.MOVE_RIGHT:e.inputmove=[G4[n-Sr.MOVE_UP]];break;case Sr.OK_BUTTON:e.inputok=1;break;case Sr.CANCEL_BUTTON:e.inputcancel=1;break;case Sr.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=n,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Sr.NONE&&o!==n}),e}function q4(t){const e=ap[t];if(w(e))return e;const r=sp[t];if(w(r))return r;const n=ha[t];if(w(n))return n;const i=hh[t];if(w(i))return i}function ek(){if(dr(k.board,k.element,k.timestamp),!!He(k.element,"item")){const e={x:k.element?.x??-1,y:k.element?.y??-1},r=tc(k.board,e,k.elementfocus);w(r)&&(r.x=e.x,r.y=e.y)}}const Y4=yi({get(t,e){const r=q4(e);if(w(r))return[!0,r];if(k.elementisplayer&&H4.has(e)){const l=K4(k.elementid)[e];return[w(l),l]}const n=tc(k.board,{x:k.element?.x??-1,y:k.element?.y??-1},k.elementfocus),i=n?.id??k.elementfocus??wr(),s=k.element?.sender,o=lA(k.board,ye(s)?s:""),a=o?.id??"";switch(e){case"camera":case"graphics":case"facing":if(w(k.board?.[e]))return[!0,k.board?.[e]];break;case"isdark":return[!0,k.board?.isdark?1:0];case"startx":return[!0,k.board?.startx??0];case"starty":return[!0,k.board?.starty??0];case"over":return[!0,k.board?.over??""];case"under":return[!0,k.board?.under??""];case"exitnorth":return[!0,k.board?.exitnorth??""];case"exitsouth":return[!0,k.board?.exitsouth??""];case"exitwest":return[!0,k.board?.exitwest??""];case"exiteast":return[!0,k.board?.exiteast??""];case"timelimit":return[!0,k.board?.timelimit??0];case"restartonzap":return[!0,k.board?.restartonzap??0];case"maxplayershots":return[!0,k.board?.maxplayershots??0];case"currenttick":return[!0,k.timestamp];case"boardid":return[!0,k.board?.id??""];case"playerid":return[!0,i];case"playerx":return[!0,n?.x??-1];case"playery":return[!0,n?.y??-1];case"thisid":return[!0,k.element?.id??""];case"thisx":return[!0,k.element?.x??-1];case"thisy":return[!0,k.element?.y??-1];case"senderid":return[!0,a];case"senderx":return[!0,o?.x??-1];case"sendery":return[!0,o?.y??-1];default:{if(QE.has(e))return[!0,He(k.element,e)??0];break}}const c=Kr(i)[e];return[w(c),c]},set(t,e,r){const i=tc(k.board,{x:k.element?.x??-1,y:k.element?.y??-1},k.elementfocus)?.id??k.elementfocus;switch(e){case"camera":case"graphics":case"facing":break;case"isdark":if(w(k.board))return k.board.isdark=r?1:0,[!0,k.board.isdark];break;case"startx":if(w(k.board))return k.board.startx=Ga(r,0),[!0,k.board.startx];break;case"starty":if(w(k.board))return k.board.starty=Ga(r,0),[!0,k.board.starty];break;case"over":if(w(k.board))return k.board.over=Ut(r),[!0,k.board.over];break;case"under":if(w(k.board))return[!0,k.board.under=Ut(r)];break;case"exitnorth":if(w(k.board))return[!0,k.board.exitnorth=Ut(r)];break;case"exitsouth":if(w(k.board))return[!0,k.board.exitsouth=Ut(r)];break;case"exitwest":if(w(k.board))return[!0,k.board.exitwest=Ut(r)];break;case"exiteast":if(w(k.board))return[!0,k.board.exiteast=Ut(r)];break;case"timelimit":if(w(k.board))return[!0,k.board.timelimit=Ga(r,0)];break;case"restartonzap":if(w(k.board))return[!0,k.board.restartonzap=r?1:0];break;case"maxplayershots":if(w(k.board))return[!0,k.board.maxplayershots=Ga(r,0)];break;case"currenttick":return[!1,r];case"boardid":return[!1,r];case"playerid":return[!1,r];case"playerx":return[!1,r];case"playery":return[!1,r];case"thisid":return[!1,r];case"thisx":return[!1,r];case"thisy":return[!1,r];case"senderid":return[!1,r];case"senderx":return[!1,r];case"sendery":return[!1,r];default:{if(QE.has(e))return w(k.element)&&(k.element[e]=r),[!0,r];break}}const s=Kr(i);return w(s)?(s[e]=r,[!0,r]):[!1,r]},everytick(){!k.element?.removed&&w(k.element?.x)&&w(k.element.y)&&w(k.element.stepx)&&w(k.element.stepy)&&(k.element.stepx||k.element.stepy)&&Bn(k.book,k.board,k.element,{x:k.element.x+k.element.stepx,y:k.element.y+k.element.stepy})}}).command("clear",(t,e)=>{for(let r=0;r<e.length;++r)t.set(Ut(e[r]),0);return 0}).command("set",(t,e)=>{const[r,n]=ue(e,0,[Z.NAME,Z.ANY]);return t.set(r,n??1),0}).command("become",(t,e)=>{const[r]=ue(e,0,[Z.KIND]);cr(k.board);const n=er(k.element),[i,s]=r,o=[...uo(n.color,n.bg),...s??[]],a=[i,o];if(eu(k.board,k.element),dr(k.board,k.element,k.timestamp)){const c={x:k.element?.x??0,y:k.element?.y??0};an(k.board,a,c)}return t.endofprogram(),0}).command("bind",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=Fo(k.board,r);return w(k.element)&&n.length>0&&(k.element.code=en(...n).code??""),0}).command("char",(t,e)=>{const[r]=ue(e,0,[Z.ANY]);if(tn(r)){const[n,i]=ue(e,0,[Z.DIR,Z.NUMBER]),s=nt(k.board,n.destpt);w(s)&&(s.char=i)}else w(k.element)&&Te(r)&&(k.element.char=r);return 0}).command("color",(t,e)=>{const[r]=ue(e,0,[Z.ANY]);if(tn(r)){const[n,i]=ue(e,0,[Z.DIR,Z.COLOR]),s=nt(k.board,n.destpt);w(s)&&ba(k.element,i)}else{const[n]=ue(e,0,[Z.COLOR]);w(k.element)&&w(n)&&ba(k.element,n)}return 0}).command("go",(t,e)=>{if(w(k.element)){const[r]=ue(e,0,[Z.DIR]);if(Bn(k.book,k.board,k.element,r.destpt),t.yield(),k.element.x===r.destpt.x&&k.element.y===r.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!w(k.element))return 0;const[r]=ue(e,0,[Z.DIR]),n=k.element.x??0,i=k.element.y??0;return k.element.stepx=r.destpt.x-n,k.element.stepy=r.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[r]=ue(e,0,[Z.ANY]);return t.set("arg",r),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Ut(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Ut(e[0])),0)).command("cycle",(t,e)=>{if(w(k.element)){const[r]=ue(e,0,[Z.NUMBER]);k.element.cycle=Bt(Math.round(r),1,255)}return 0}).command("die",t=>(ek(),t.endofprogram(),0)).command("dieonend",()=>(ek(),0)).command("endgame",()=>(hf(le,k.elementfocus),0)).command("run",(t,e)=>{const[r]=ue(e,0,[Z.NAME]);return Au(r),0}).command("runwith",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY,Z.NAME]);return t.set("arg",r),Au(n),0}),lu={};function V4(t){return lu[t]?.arg}function tk(t){return lu[t]?.format}function Oo(t){return lu[t]?.content}function rk(t,e,r,n,i){const s=dt(Xe.MAIN);if(!w(s))return;const o=Ss(s,Re.LOADER).filter(a=>{const c=As(a),l=c.format,u=ye(l)?new RegExp(l).test(e):!1,h=c.event,d=ye(h)?new RegExp(h).test(r):!1;return ye(l)&&ye(h)?u&&d:ye(l)?u:ye(h)?d:!1});for(let a=0;a<o.length;++a){const c=`${Ft()}_loader`;lu[c]={arg:t,format:e,content:n,player:i},sz(c,o[a].code)}}function nk(t,e){if(!w(t))return;const r=Be(e),n=r.endsWith("le");switch(r){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,n);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,n);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,n);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,n);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,n);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,n);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,n);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,n);return t.cursor+=8,i}}}const X4=(t,e)=>{const r=Oo(t.id());if(!w(r))return 0;const[n,i]=ue(e,0,[Z.NAME]),s=Be(n);switch(s){case"seek":{const[o]=ue(e,i,[Z.NUMBER]);r.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=ue(e,i,[Z.NAME]);t.set(o,nk(r,s));break}case"text":{const[o,a]=ue(e,i,[Z.NAME,Z.NAME]),c=nk(r,o);if(Te(c)&&ye(a)){const l=new Uint8Array(r.bytes.buffer,r.cursor,c),h=new TextDecoder("utf-8").decode(l);t.set(a,h),r.cursor+=c}break}case"palette":{const[o]=ue(e,i,[Z.NAME]),[a]=jd(k.book,Re.PALETTE,o),c=At(a);if(w(c)){const l=jI*Vc,u=l_(new Uint8Array(r.bytes.buffer,r.cursor,l));w(u)&&(c.bits=u.bits),r.cursor+=l}break}case"charset":{const[o]=ue(e,i,[Z.NAME]),[a]=jd(k.book,Re.CHARSET,o),c=At(a);if(w(c)){const l=Xc*DI*mh,u=Rh(new Uint8Array(r.bytes.buffer,r.cursor,l));w(u)&&(c.bits=u.bits),r.cursor+=l}break}}return 0},Io=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",uu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r+=1)if(!uu(t[r],e[r]))return!1;return!0}if(Io(t)&&Io(e)){const r=Object.entries(t),n=new Set(Object.keys(e));if(r.length!==n.size)return!1;for(const[i,s]of r){if(!uu(s,e[i]))return!1;n.delete(i)}return n.size===0}return!1},fu=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(Io(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},Z4=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",ik=t=>t>="0"&&t<="9"||t==="-",J4=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var oe;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(oe||(oe={}));const sk={"(":oe.TOK_LPAREN,")":oe.TOK_RPAREN,"*":oe.TOK_STAR,",":oe.TOK_COMMA,".":oe.TOK_DOT,":":oe.TOK_COLON,"@":oe.TOK_CURRENT,$:oe.TOK_ROOT,"]":oe.TOK_RBRACKET,"{":oe.TOK_LBRACE,"}":oe.TOK_RBRACE},Q4={"!":!0,"<":!0,"=":!0,">":!0},e5={"	":!0,"\n":!0,"\r":!0," ":!0};class t5{constructor(){this._current=0}tokenize(e){const r=[];this._current=0;let n,i,s;for(;this._current<e.length;)if(Z4(e[this._current]))n=this._current,i=this.consumeUnquotedIdentifier(e),r.push({start:n,type:oe.TOK_UNQUOTEDIDENTIFIER,value:i});else if(sk[e[this._current]]!==void 0)r.push({start:this._current,type:sk[e[this._current]],value:e[this._current]}),this._current+=1;else if(ik(e[this._current]))s=this.consumeNumber(e),r.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),r.push(s);else if(e[this._current]==='"')n=this._current,i=this.consumeQuotedIdentifier(e),r.push({start:n,type:oe.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")n=this._current,i=this.consumeRawStringLiteral(e),r.push({start:n,type:oe.TOK_LITERAL,value:i});else if(e[this._current]==="`"){n=this._current;const o=this.consumeLiteral(e);r.push({start:n,type:oe.TOK_LITERAL,value:o})}else if(Q4[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&r.push(s);else if(e5[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")n=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,r.push({start:n,type:oe.TOK_AND,value:"&&"})):r.push({start:n,type:oe.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")n=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,r.push({start:n,type:oe.TOK_OR,value:"||"})):r.push({start:n,type:oe.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return r}consumeUnquotedIdentifier(e){const r=this._current;for(this._current+=1;this._current<e.length&&J4(e[this._current]);)this._current+=1;return e.slice(r,this._current)}consumeQuotedIdentifier(e){const r=this._current;this._current+=1;const n=e.length;for(;e[this._current]!=='"'&&this._current<n;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(r,this._current))}consumeRawStringLiteral(e){const r=this._current;this._current+=1;const n=e.length;for(;e[this._current]!=="'"&&this._current<n;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(r+1,this._current-1).replace("\\'","'")}consumeNumber(e){const r=this._current;this._current+=1;const n=e.length;for(;ik(e[this._current])&&this._current<n;)this._current+=1;const i=parseInt(e.slice(r,this._current),10);return{start:r,value:i,type:oe.TOK_NUMBER}}consumeLBracket(e){const r=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:r,type:oe.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:r,type:oe.TOK_FLATTEN,value:"[]"}):{start:r,type:oe.TOK_LBRACKET,value:"["}}consumeOperator(e){const r=this._current,n=e[r];if(this._current+=1,n==="!")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_NE,value:"!="}):{start:r,type:oe.TOK_NOT,value:"!"};if(n==="<")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_LTE,value:"<="}):{start:r,type:oe.TOK_LT,value:"<"};if(n===">")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_GTE,value:">="}):{start:r,type:oe.TOK_GT,value:">"};if(n==="="&&e[this._current]==="=")return this._current+=1,{start:r,type:oe.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const r=this._current,n=e.length;for(;e[this._current]!=="`"&&this._current<n;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(r,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n=["true","false","null"],i="-0123456789";if(e==="")return!1;if('[{"'.includes(e[0])||n.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const r5=new t5,xr={[oe.TOK_EOF]:0,[oe.TOK_UNQUOTEDIDENTIFIER]:0,[oe.TOK_QUOTEDIDENTIFIER]:0,[oe.TOK_RBRACKET]:0,[oe.TOK_RPAREN]:0,[oe.TOK_COMMA]:0,[oe.TOK_RBRACE]:0,[oe.TOK_NUMBER]:0,[oe.TOK_CURRENT]:0,[oe.TOK_EXPREF]:0,[oe.TOK_ROOT]:0,[oe.TOK_PIPE]:1,[oe.TOK_OR]:2,[oe.TOK_AND]:3,[oe.TOK_EQ]:5,[oe.TOK_GT]:5,[oe.TOK_LT]:5,[oe.TOK_GTE]:5,[oe.TOK_LTE]:5,[oe.TOK_NE]:5,[oe.TOK_FLATTEN]:9,[oe.TOK_STAR]:20,[oe.TOK_FILTER]:21,[oe.TOK_DOT]:40,[oe.TOK_NOT]:45,[oe.TOK_LBRACE]:50,[oe.TOK_LBRACKET]:55,[oe.TOK_LPAREN]:60};class n5{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const r=this.expression(0);if(this.lookahead(0)!==oe.TOK_EOF){const n=this.lookaheadToken(0);this.errorToken(n,`Unexpected token type: ${n.type}, value: ${n.value}`)}return r}loadTokens(e){this.tokens=[...r5.tokenize(e),{type:oe.TOK_EOF,value:"",start:e.length}]}expression(e){const r=this.lookaheadToken(0);this.advance();let n=this.nud(r),i=this.lookahead(0);for(;e<xr[i];)this.advance(),n=this.led(i,n),i=this.lookahead(0);return n}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let r,n,i;switch(e.type){case oe.TOK_LITERAL:return{type:"Literal",value:e.value};case oe.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case oe.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===oe.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case oe.TOK_NOT:return n=this.expression(xr.Not),{type:"NotExpression",children:[n]};case oe.TOK_STAR:return r={type:"Identity"},n=this.lookahead(0)===oe.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(xr.Star),{type:"ValueProjection",children:[r,n]};case oe.TOK_FILTER:return this.led(e.type,{type:"Identity"});case oe.TOK_LBRACE:return this.parseMultiselectHash();case oe.TOK_FLATTEN:return r={type:oe.TOK_FLATTEN,children:[{type:"Identity"}]},n=this.parseProjectionRHS(xr.Flatten),{type:"Projection",children:[r,n]};case oe.TOK_LBRACKET:return this.lookahead(0)===oe.TOK_NUMBER||this.lookahead(0)===oe.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},n)):this.lookahead(0)===oe.TOK_STAR&&this.lookahead(1)===oe.TOK_RBRACKET?(this.advance(),this.advance(),n=this.parseProjectionRHS(xr.Star),{children:[{type:"Identity"},n],type:"Projection"}):this.parseMultiselectList();case oe.TOK_CURRENT:return{type:oe.TOK_CURRENT};case oe.TOK_ROOT:return{type:oe.TOK_ROOT};case oe.TOK_EXPREF:return i=this.expression(xr.Expref),{type:"ExpressionReference",children:[i]};case oe.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==oe.TOK_RPAREN;)this.lookahead(0)===oe.TOK_CURRENT?(i={type:oe.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(oe.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,r){let n;switch(e){case oe.TOK_DOT:const i=xr.Dot;return this.lookahead(0)!==oe.TOK_STAR?(n=this.parseDotRHS(i),{type:"Subexpression",children:[r,n]}):(this.advance(),n=this.parseProjectionRHS(i),{type:"ValueProjection",children:[r,n]});case oe.TOK_PIPE:return n=this.expression(xr.Pipe),{type:oe.TOK_PIPE,children:[r,n]};case oe.TOK_OR:return n=this.expression(xr.Or),{type:"OrExpression",children:[r,n]};case oe.TOK_AND:return n=this.expression(xr.And),{type:"AndExpression",children:[r,n]};case oe.TOK_LPAREN:const s=r.name,o=[];let a;for(;this.lookahead(0)!==oe.TOK_RPAREN;)this.lookahead(0)===oe.TOK_CURRENT?(a={type:oe.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===oe.TOK_COMMA&&this.match(oe.TOK_COMMA),o.push(a);return this.match(oe.TOK_RPAREN),{name:s,type:"Function",children:o};case oe.TOK_FILTER:const l=this.expression(0);return this.match(oe.TOK_RBRACKET),n=this.lookahead(0)===oe.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(xr.Filter),{type:"FilterProjection",children:[r,n,l]};case oe.TOK_FLATTEN:const u={type:oe.TOK_FLATTEN,children:[r]},h=this.parseProjectionRHS(xr.Flatten);return{type:"Projection",children:[u,h]};case oe.TOK_EQ:case oe.TOK_NE:case oe.TOK_GT:case oe.TOK_GTE:case oe.TOK_LT:case oe.TOK_LTE:return this.parseComparator(r,e);case oe.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===oe.TOK_NUMBER||d.type===oe.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice(r,n)):(this.match(oe.TOK_STAR),this.match(oe.TOK_RBRACKET),n=this.parseProjectionRHS(xr.Star),{type:"Projection",children:[r,n]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const r=this.lookaheadToken(0);this.errorToken(r,`Expected ${e}, got: ${r.type}`)}}errorToken(e,r=""){const n=new Error(r||`Invalid token (${e.type}): "${e.value}"`);throw n.name="ParserError",n}parseIndexExpression(){if(this.lookahead(0)===oe.TOK_COLON||this.lookahead(1)===oe.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(oe.TOK_RBRACKET),e}projectIfSlice(e,r){const n={type:"IndexExpression",children:[e,r]};return r.type==="Slice"?{children:[n,this.parseProjectionRHS(xr.Star)],type:"Projection"}:n}parseSliceExpression(){const e=[null,null,null];let r=0,n=this.lookahead(0);for(;n!==oe.TOK_RBRACKET&&r<3;){if(n===oe.TOK_COLON)r+=1,this.advance();else if(n===oe.TOK_NUMBER)e[r]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}n=this.lookahead(0)}return this.match(oe.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,r){const n=this.expression(xr[r]);return{type:"Comparator",name:r,children:[e,n]}}parseDotRHS(e){const r=this.lookahead(0);if([oe.TOK_UNQUOTEDIDENTIFIER,oe.TOK_QUOTEDIDENTIFIER,oe.TOK_STAR].includes(r))return this.expression(e);if(r===oe.TOK_LBRACKET)return this.match(oe.TOK_LBRACKET),this.parseMultiselectList();if(r===oe.TOK_LBRACE)return this.match(oe.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(xr[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===oe.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===oe.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===oe.TOK_DOT)return this.match(oe.TOK_DOT),this.parseDotRHS(e);const r=this.lookaheadToken(0);this.errorToken(r,`Syntax error, unexpected token: ${r.value}(${r.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==oe.TOK_RBRACKET;){const r=this.expression(0);if(e.push(r),this.lookahead(0)===oe.TOK_COMMA&&(this.match(oe.TOK_COMMA),this.lookahead(0)===oe.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(oe.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],r=[oe.TOK_UNQUOTEDIDENTIFIER,oe.TOK_QUOTEDIDENTIFIER];let n,i,s;for(;;){if(n=this.lookaheadToken(0),!r.includes(n.type))throw new Error(`Expecting an identifier token, got: ${n.type}`);if(i=n.value,this.advance(),this.match(oe.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===oe.TOK_COMMA)this.match(oe.TOK_COMMA);else if(this.lookahead(0)===oe.TOK_RBRACE){this.match(oe.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const i5=new n5;var ge;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ge||(ge={}));class s5{constructor(e){this.TYPE_NAME_TABLE={[ge.TYPE_NUMBER]:"number",[ge.TYPE_ANY]:"any",[ge.TYPE_STRING]:"string",[ge.TYPE_ARRAY]:"array",[ge.TYPE_OBJECT]:"object",[ge.TYPE_BOOLEAN]:"boolean",[ge.TYPE_EXPREF]:"expression",[ge.TYPE_NULL]:"null",[ge.TYPE_ARRAY_NUMBER]:"Array<number>",[ge.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([r])=>Math.abs(r),this.functionAvg=([r])=>{let n=0;for(let i=0;i<r.length;i+=1)n+=r[i];return n/r.length},this.functionCeil=([r])=>Math.ceil(r),this.functionContains=r=>{const[n,i]=r;return n.includes(i)},this.functionEndsWith=r=>{const[n,i]=r;return n.includes(i,n.length-i.length)},this.functionFloor=([r])=>Math.floor(r),this.functionJoin=r=>{const[n,i]=r;return i.join(n)},this.functionKeys=([r])=>Object.keys(r),this.functionLength=([r])=>Io(r)?Object.keys(r).length:r.length,this.functionMap=r=>{if(!this._interpreter)return[];const n=[],i=this._interpreter,s=r[0],o=r[1];for(let a=0;a<o.length;a+=1)n.push(i.visit(s,o[a]));return n},this.functionMax=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===ge.TYPE_NUMBER)return Math.max(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[ge.TYPE_NUMBER,ge.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=r=>{let n={};for(let i=0;i<r.length;i+=1){const s=r[i];n=Object.assign(n,s)}return n},this.functionMin=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===ge.TYPE_NUMBER)return Math.min(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[ge.TYPE_NUMBER,ge.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=r=>{for(let n=0;n<r.length;n+=1)if(this.getTypeName(r[n])!==ge.TYPE_NULL)return r[n];return null},this.functionReverse=([r])=>{if(this.getTypeName(r)===ge.TYPE_STRING){const s=r;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=r.slice(0);return i.reverse(),i},this.functionSort=([r])=>[...r].sort(),this.functionSortBy=r=>{if(!this._interpreter)return[];const n=r[0].slice(0);if(n.length===0)return n;const i=this._interpreter,s=r[1],o=this.getTypeName(i.visit(s,n[0]));if(o!==void 0&&![ge.TYPE_NUMBER,ge.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<n.length;c+=1)a.push([c,n[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)n[c]=a[c][1];return n},this.functionStartsWith=([r,n])=>r.startsWith(n),this.functionSum=([r])=>r.reduce((n,i)=>n+i,0),this.functionToArray=([r])=>this.getTypeName(r)===ge.TYPE_ARRAY?r:[r],this.functionToNumber=([r])=>{const n=this.getTypeName(r);let i;return n===ge.TYPE_NUMBER?r:n===ge.TYPE_STRING&&(i=+r,!isNaN(i))?i:null},this.functionToString=([r])=>this.getTypeName(r)===ge.TYPE_STRING?r:JSON.stringify(r),this.functionType=([r])=>{switch(this.getTypeName(r)){case ge.TYPE_NUMBER:return"number";case ge.TYPE_STRING:return"string";case ge.TYPE_ARRAY:return"array";case ge.TYPE_OBJECT:return"object";case ge.TYPE_BOOLEAN:return"boolean";case ge.TYPE_EXPREF:return"expref";case ge.TYPE_NULL:return"null";default:return}},this.functionValues=([r])=>Object.values(r),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ge.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ge.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ge.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY]},{types:[ge.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ge.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ge.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY,ge.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ge.TYPE_EXPREF]},{types:[ge.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ge.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ge.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ge.TYPE_ARRAY_STRING,ge.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ge.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ge.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ge.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ge.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ge.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ge.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,r,n){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:r.bind(this),_signature:n}}callFunction(e,r){const n=this.functionTable[e];if(n===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,r,n._signature),n._func.call(this,r)}validateInputSignatures(e,r){for(let n=0;n<r.length;n+=1)if("variadic"in r[n]&&n!==r.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${n+1} must occur last`)}validateArgs(e,r,n){var i,s;let o;this.validateInputSignatures(e,n);const a=n.filter(p=>{var g;return(g=!p.optional)!==null&&g!==void 0?g:!1}).length,c=(s=(i=n[n.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=r.length<a,u=r.length>n.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=n.length>1,new Error(`ArgumentError: ${e}() takes ${h}${a} argument${o&&"s"||""} but received ${r.length}`);let d,f,m;for(let p=0;p<n.length;p+=1){m=!1,d=n[p].types,f=this.getTypeName(r[p]);let g;for(g=0;g<d.length;g+=1)if(f!==void 0&&this.typeMatches(f,d[g],r[p])){m=!0;break}if(!m&&f!==void 0){const y=d.map(b=>this.TYPE_NAME_TABLE[b]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${p+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(e,r,n){if(r===ge.TYPE_ANY)return!0;if(r===ge.TYPE_ARRAY_STRING||r===ge.TYPE_ARRAY_NUMBER||r===ge.TYPE_ARRAY){if(r===ge.TYPE_ARRAY)return e===ge.TYPE_ARRAY;if(e===ge.TYPE_ARRAY){let i;r===ge.TYPE_ARRAY_NUMBER?i=ge.TYPE_NUMBER:r===ge.TYPE_ARRAY_STRING&&(i=ge.TYPE_STRING);for(let s=0;s<n.length;s+=1){const o=this.getTypeName(n[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,n[s]))return!1}return!0}}else return e===r;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ge.TYPE_STRING;case"[object Number]":return ge.TYPE_NUMBER;case"[object Array]":return ge.TYPE_ARRAY;case"[object Boolean]":return ge.TYPE_BOOLEAN;case"[object Null]":return ge.TYPE_NULL;case"[object Object]":return e.jmespathType===oe.TOK_EXPREF?ge.TYPE_EXPREF:ge.TYPE_OBJECT;default:return}}createKeyFunction(e,r){if(!this._interpreter)return;const n=this._interpreter;return s=>{const o=n.visit(e,s);if(!r.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${r.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class o5{constructor(){this._rootValue=null,this.runtime=new s5(this)}search(e,r){return this._rootValue=r,this.visit(e,r)}visit(e,r){let n,i,s,o,a,c,l,u,h,d,f;switch(e.type){case"Field":return r===null?null:Io(r)?(c=r[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],r),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],r),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(r))return null;let m=e.value;return m<0&&(m=r.length+m),s=r[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(r))return null;const p=[...e.children],g=this.computeSliceParams(r.length,p),[y,b,A]=g;if(s=[],A>0)for(d=y;d<b;d+=A)s.push(r[d]);else for(d=y;d>b;d+=A)s.push(r[d]);return s;case"Projection":if(f=this.visit(e.children[0],r),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(e.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(e.children[0],r),!Io(f))return null;h=[];const S=Object.values(f);for(d=0;d<S.length;d+=1)i=this.visit(e.children[1],S[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(e.children[0],r),!Array.isArray(f))return null;const x=[],F=[];for(d=0;d<f.length;d+=1)n=this.visit(e.children[2],f[d]),fu(n)||x.push(f[d]);for(let O=0;O<x.length;O+=1)i=this.visit(e.children[1],x[O]),i!==null&&F.push(i);return F;case"Comparator":switch(o=this.visit(e.children[0],r),a=this.visit(e.children[1],r),e.name){case oe.TOK_EQ:s=uu(o,a);break;case oe.TOK_NE:s=!uu(o,a);break;case oe.TOK_GT:s=o>a;break;case oe.TOK_GTE:s=o>=a;break;case oe.TOK_LT:s=o<a;break;case oe.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case oe.TOK_FLATTEN:const R=this.visit(e.children[0],r);if(!Array.isArray(R))return null;let P=[];for(d=0;d<R.length;d+=1)i=R[d],Array.isArray(i)?P=[...P,...i]:P.push(i);return P;case"Identity":return r;case"MultiSelectList":if(r===null)return null;for(h=[],d=0;d<e.children.length;d+=1)h.push(this.visit(e.children[d],r));return h;case"MultiSelectHash":if(r===null)return null;h={};let W;for(d=0;d<e.children.length;d+=1)W=e.children[d],h[W.name]=this.visit(W.value,r);return h;case"OrExpression":return n=this.visit(e.children[0],r),fu(n)&&(n=this.visit(e.children[1],r)),n;case"AndExpression":return o=this.visit(e.children[0],r),fu(o)?o:this.visit(e.children[1],r);case"NotExpression":return o=this.visit(e.children[0],r),fu(o);case"Literal":return e.value;case oe.TOK_PIPE:return l=this.visit(e.children[0],r),this.visit(e.children[1],l);case oe.TOK_CURRENT:return r;case oe.TOK_ROOT:return this._rootValue;case"Function":const D=[];for(let O=0;O<e.children.length;O+=1)D.push(this.visit(e.children[O],r));return this.runtime.callFunction(e.name,D);case"ExpressionReference":const G=e.children[0];return G.jmespathType=oe.TOK_EXPREF,G;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,r){let[n,i,s]=r;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return n=n===null?o?e-1:0:this.capSliceRange(e,n,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[n,i,s]}capSliceRange(e,r,n){let i=r;return i<0?(i+=e,i<0&&(i=n<0?-1:0)):i>=e&&(i=n<0?e-1:e),i}}const a5=new o5;ge.TYPE_ANY,ge.TYPE_ARRAY,ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING,ge.TYPE_BOOLEAN,ge.TYPE_EXPREF,ge.TYPE_NULL,ge.TYPE_NUMBER,ge.TYPE_OBJECT,ge.TYPE_STRING;function c5(t,e){const r=i5.parse(e);return a5.search(r,t)}const l5=(t,e)=>{const r=Oo(t.id());if(!w(r))return 0;const[n,i]=ue(e,0,[Z.NAME,Z.NAME]),s=c5(r.json,n);return t.set(i,s),0},u5=(t,e)=>{const r=Oo(t.id());if(!w(r))return 0;const[n,i]=ue(e,0,[Z.NAME]);switch(Be(n)){case"seek":{const[o]=ue(e,i,[Z.NUMBER]);r.cursor=Bt(o,0,r.lines.length-1);break}case"line":r.cursor=Bt(r.cursor+1,0,r.lines.length-1);break;default:{const o=r.lines[r.cursor]??"",c=new RegExp(n,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[h,d]=ue(e,u,[Z.NAME]);t.set(h,c[l]??0),++l,u=d}break}}return 0};function ok(t){const e=dt(Xe.MAIN),r=Ao(e);w(t.targetdir)?Uo(t.targetdir.destpt,t.label,void 0,r):w(t.targetname)&&Uo(t.targetname,t.label,void 0,r)}const f5=yi({get(t,e){const r=tk(t.id());if(e==="format")return[!0,r];switch(r){case"text":{const s=Oo(t.id());switch(e){case"filename":return[!0,s.filename];case"cursor":return[!0,s.cursor];case"lines":return[!0,s.lines.length]}break}case"json":{const s=Oo(t.id());switch(e){case"filename":return[!0,s.filename]}break}case"binary":{const s=Oo(t.id());switch(e){case"filename":return[!0,s.filename];case"cursor":return[!0,s.cursor];case"bytes":return[!0,s.bytes.length]}break}}const n=wr(),i=Kr(n)[e];return[w(i),i]},set(t,e,r){const n=tk(t.id());if(e==="format")return[!1,void 0];switch(n){case"text":switch(e){case"filename":case"cursor":case"lines":return[!1,void 0]}break;case"json":switch(e){case"filename":return[!1,void 0]}break;case"binary":switch(e){case"filename":case"cursor":case"bytes":return[!1,void 0]}break}const i=wr(),s=Kr(i);return w(s)?(s[e]=r,[!0,r]):[!1,void 0]}}).command("shortsend",(t,e)=>{const r=Oi(e);return ok(r),0}).command("send",(t,e)=>{const r=Oi(e,!0);return ok(r),0}).command("stat",()=>0).command("text",(t,e)=>{const r=e.map(Ut).join(" ");return Pt(le,k.elementfocus,"$175",r),0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Ut(r),s=Oi(n);return w(s.targetname)&&Pt(le,k.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",u5).command("readjson",l5).command("readbin",X4).command("withboard",(t,e)=>{const[r]=ue(e,0,[Z.STRING]),n=fr(r);return w(n)&&(k.board=n,k.element={x:-1,y:-1}),0});function ak(t,e,r,n,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=ue(i,a,[Z.ANY]);ut(c)&&!tn(c)&&!qa(c)&&!cu(c)&&!Tr(c)?o.push(...c):o.push(c),a=l}switch(Be(n)){case"get":case"post:json":GT(le,k.elementfocus,t,e,r,n,o);break}return 0}const h5=yi().command("fetch",(t,e)=>{const[r,n,i="get",s]=ue(e,0,[Z.NAME,Z.NAME,Z.MAYBE_STRING]);return ak(void 0,r,n,i,e,s),0}).command("fetchwith",(t,e)=>{const[r,n,i,s="get",o]=ue(e,0,[Z.ANY,Z.NAME,Z.NAME,Z.MAYBE_STRING]);return ak(r,n,i,s,e,o),0}).command("chat",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return r?WT(le,k.elementfocus,r):HT(le,k.elementfocus),0}).command("broadcast",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return r?jT(le,k.elementfocus,r):zT(le,k.elementfocus),0});function Ya(t,e,r){if(w(k.board)){switch(r){case"shot":case"bombed":He(e,"breakable")&&dr(k.board,e,k.timestamp);break}w(e?.id)&&t.send(k.elementfocus,e.id,r)}}function ck(t,e){if(w(e.targetname)){const r=Object.keys(k.board?.objects??{});switch(e.targetname){case"all":for(let n=0;n<r.length;++n){const i=r[n],s=hr(k.board,i);w(s)&&Ya(t,s,e.label)}break;case"others":for(let n=0;n<r.length;++n){const i=r[n],s=hr(k.board,i);i!==t.id()&&w(s)&&Ya(t,s,e.label)}break;case"self":k.elementid!==t.id()?t.send(k.elementfocus,k.elementid,e.label):t.message({session:le.session(),player:k.elementfocus,id:Ft(),sender:k.elementid,target:e.label});break;default:{const n=sA(k.board,[e.targetname]);for(let i=0;i<n.length;++i){const s=n[i];w(s)&&Ya(t,s,e.label)}break}}}else if(w(e.targetdir))if(e.targetdir.targets.length)for(let r=0;r<e.targetdir.targets.length;++r){const n=nt(k.board,e.targetdir.targets[r]);w(n)&&Ya(t,n,e.label)}else{const r=nt(k.board,e.targetdir.destpt);w(r)&&Ya(t,r,e.label)}}const d5=yi({set(t,e,r){return xz(t,e,r),[!1,void 0]},aftertick(){const t=rr(k.elementid),[e]=t;if(t.length===1&&ye(e)){if(w(k.element))if(e.trim().length===0){const r=Rt(k.elementid);r.sidebar=[]}else k.element.tickertext=e,k.element.tickertime=k.timestamp}else if(t.length>1)if(k.elementisplayer){const r=Rt(k.elementid);r.sidebar=mA(t)}else{const r=Rt(k.elementfocus);r.scrollname=k.element?.name??k.element?.kinddata?.name??"",r.scroll=mA(t)}}}).command("shortsend",(t,e)=>{const r=Oi(e);return ck(t,r),0}).command("send",(t,e)=>{const r=Oi(e,!0);return ck(t,r),0}).command("stat",()=>0).command("text",(t,e)=>{const r=e.map(Ut).join("");return Pe(k.elementid,r),0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Ut(r),s=Oi(n);return w(s.targetname)&&De(k.elementid,t.id(),i,`${s.targetname}:${s.label}`.split(" "),t.get,t.set),0});function p5(t,e,r,n,i){if(!w(k.book))return;const s=k.book,o=Ir(s,Re.BOARD,t),a=At(o);if(!w(a))return;const c=Ru(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";cr(a),cr(c);const h=-Math.tan(e*.5),d=Math.sin(e),f=Math.round(12.5*h),m=Math.round(12.5*d),p=new Array(rt).fill(0);my(f,0,-f,rt-1).forEach(S=>{S.x<0?p[S.y]=Math.min(p[S.y],S.x):p[S.y]=Math.max(p[S.y],S.x)});const y=new Array(Me).fill(0);my(0,m,Me-1,-m).forEach(S=>{S.y<0?y[S.x]=Math.min(y[S.x],S.y):y[S.x]=Math.max(y[S.x],S.y)});const A=[p,y,p];for(let S=0;S<A.length;++S){const x=A[S];if(S!==1){for(let F=0;F<rt;++F){const R=x[F],P=F*Me;for(let W=0;W<Me;W++){const D=(W+R+Me)%Me;u&&(c.terrain[D+P]=a.terrain[W+P])}}if(l){const F=Object.keys(a.objects);for(let R=0;R<F.length;++R){const P=F[R],{x:W,y:D}=a.objects[P];if(w(W)&&w(D)){const G=x[D];a.objects[P].x=(W+G+Me)%Me,a.objects[P].lx=a.objects[P].x}}}}if(S===1){for(let F=0;F<Me;++F){const R=x[F];for(let P=0;P<rt;++P){const W=(P+R+rt)%rt;u&&(c.terrain[F+W*Me]=a.terrain[F+P*Me])}}if(l){const F=Object.keys(a.objects);for(let R=0;R<F.length;++R){const P=F[R],{x:W,y:D}=a.objects[P];if(w(W)&&w(D)){const G=x[W];a.objects[P].y=(D+G+rt)%rt,a.objects[P].ly=a.objects[P].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,cr(c),cr(a)}}var cp,lk;function m5(){if(lk)return cp;lk=1;function t(e,r){let n=0,i=0,s=0;for(;s<e.length;s++)n+=e[s];for(s=0,r*=n;r&&s<e.length;){if(i+=e[s],r<=i)return s;s++}return 0}return cp=t,cp}var lp,uk;function fk(){if(uk)return lp;uk=1;const t=m5(),e=function(){};return e.prototype.FMX=0,e.prototype.FMY=0,e.prototype.FMXxFMY=0,e.prototype.T=0,e.prototype.N=0,e.prototype.initiliazedField=!1,e.prototype.generationComplete=!1,e.prototype.wave=null,e.prototype.compatible=null,e.prototype.weightLogWeights=null,e.prototype.sumOfWeights=0,e.prototype.sumOfWeightLogWeights=0,e.prototype.startingEntropy=0,e.prototype.sumsOfOnes=null,e.prototype.sumsOfWeights=null,e.prototype.sumsOfWeightLogWeights=null,e.prototype.entropies=null,e.prototype.propagator=null,e.prototype.observed=null,e.prototype.distribution=null,e.prototype.stack=null,e.prototype.stackSize=0,e.prototype.DX=[-1,0,1,0],e.prototype.DY=[0,1,0,-1],e.prototype.opposite=[2,3,0,1],e.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let r=0;r<this.FMXxFMY;r++){this.wave[r]=new Array(this.T),this.compatible[r]=new Array(this.T);for(let n=0;n<this.T;n++)this.compatible[r][n]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let r=0;r<this.T;r++)this.weightLogWeights[r]=this.weights[r]*Math.log(this.weights[r]),this.sumOfWeights+=this.weights[r],this.sumOfWeightLogWeights+=this.weightLogWeights[r];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},e.prototype.observe=function(r){let n=1e3,i=-1;for(let a=0;a<this.FMXxFMY;a++){if(this.onBoundary(a%this.FMX,a/this.FMX|0))continue;const c=this.sumsOfOnes[a];if(c===0)return!1;const l=this.entropies[a];if(c>1&&l<=n){const u=1e-6*r();l+u<n&&(n=l+u,i=a)}}if(i===-1){this.observed=new Array(this.FMXxFMY);for(let a=0;a<this.FMXxFMY;a++)for(let c=0;c<this.T;c++)if(this.wave[a][c]){this.observed[a]=c;break}return!0}for(let a=0;a<this.T;a++)this.distribution[a]=this.wave[i][a]?this.weights[a]:0;const s=t(this.distribution,r()),o=this.wave[i];for(let a=0;a<this.T;a++)o[a]!==(a===s)&&this.ban(i,a);return null},e.prototype.propagate=function(){for(;this.stackSize>0;){const r=this.stack[this.stackSize-1];this.stackSize--;const n=r[0],i=n%this.FMX,s=n/this.FMX|0;for(let o=0;o<4;o++){const a=this.DX[o],c=this.DY[o];let l=i+a,u=s+c;if(this.onBoundary(l,u))continue;l<0?l+=this.FMX:l>=this.FMX&&(l-=this.FMX),u<0?u+=this.FMY:u>=this.FMY&&(u-=this.FMY);const h=l+u*this.FMX,d=this.propagator[o][r[1]],f=this.compatible[h];for(let m=0;m<d.length;m++){const p=d[m],g=f[p];g[o]--,g[o]==0&&this.ban(h,p)}}}},e.prototype.singleIteration=function(r){const n=this.observe(r);return n!==null?(this.generationComplete=n,!!n):(this.propagate(),null)},e.prototype.iterate=function(r,n){this.wave||this.initialize(),this.initiliazedField||this.clear(),r=r||0,n=n||Math.random;for(let i=0;i<r||r===0;i++){const s=this.singleIteration(n);if(s!==null)return!!s}return!0},e.prototype.generate=function(r){for(r=r||Math.random,this.wave||this.initialize(),this.clear();;){const n=this.singleIteration(r);if(n!==null)return!!n}},e.prototype.isGenerationComplete=function(){return this.generationComplete},e.prototype.ban=function(r,n){const i=this.compatible[r][n];for(let o=0;o<4;o++)i[o]=0;this.wave[r][n]=!1,this.stack[this.stackSize]=[r,n],this.stackSize++,this.sumsOfOnes[r]-=1,this.sumsOfWeights[r]-=this.weights[n],this.sumsOfWeightLogWeights[r]-=this.weightLogWeights[n];const s=this.sumsOfWeights[r];this.entropies[r]=Math.log(s)-this.sumsOfWeightLogWeights[r]/s},e.prototype.clear=function(){for(let r=0;r<this.FMXxFMY;r++){for(let n=0;n<this.T;n++){this.wave[r][n]=!0;for(let i=0;i<4;i++)this.compatible[r][n][i]=this.propagator[this.opposite[i]][n].length}this.sumsOfOnes[r]=this.weights.length,this.sumsOfWeights[r]=this.sumOfWeights,this.sumsOfWeightLogWeights[r]=this.sumOfWeightLogWeights,this.entropies[r]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1},lp=e,lp}var up,hk;function g5(){if(hk)return up;hk=1;const t=fk(),e=function(n,i,s,o,a,c,l,u,h,d){d=d||0,this.N=o,this.FMX=a,this.FMY=c,this.FMXxFMY=a*c,this.periodic=u;const f=i,m=new Array(f);for(let G=0;G<f;G++)m[G]=new Array(s);this.colors=[];const p={};for(let G=0;G<s;G++)for(let O=0;O<i;O++){const I=(G*i+O)*4,v=[n[I],n[I+1],n[I+2],n[I+3]],C=v.join("-");p.hasOwnProperty(C)||(p[C]=this.colors.length,this.colors.push(v)),m[O][G]=p[C]}const g=this.colors.length,y=Math.pow(g,o*o),b=function(O){let I=new Array(o*o);for(let v=0;v<o;v++)for(let C=0;C<o;C++)I[C+v*o]=O(C,v);return I},A=function(O,I){return b(function(v,C){return m[(O+v)%i][(I+C)%s]})},S=function(O){return b(function(I,v){return O[o-1-v+I*o]})},x=function(O){return b(function(I,v){return O[o-1-I+v*o]})},F=function(O){let I=0,v=1;for(let C=0;C<O.length;C++)I+=O[O.length-1-C]*v,v*=g;return I},R=function(O){let I=O,v=y;const C=new Array(o*o);for(let z=0;z<C.length;z++){v/=g;let $=0;for(;I>=v;)I-=v,$++;C[z]=$}return C},P={},W=[];for(let G=0;G<(l?s:s-o+1);G++)for(let O=0;O<(l?i:i-o+1);O++){const I=new Array(8);I[0]=A(O,G),I[1]=x(I[0]),I[2]=S(I[0]),I[3]=x(I[2]),I[4]=S(I[2]),I[5]=x(I[4]),I[6]=S(I[4]),I[7]=x(I[6]);for(let v=0;v<h;v++){const C=F(I[v]);P[C]?P[C]++:(W.push(C),P[C]=1)}}this.T=W.length,this.ground=(d+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let G=0;G<this.T;G++){const O=parseInt(W[G],10);this.patterns[G]=R(O),this.weights[G]=P[O]}const D=function(O,I,v,C){const z=v<0?0:v,$=v<0?v+o:o,Q=C<0?0:C,Y=C<0?C+o:o;for(let N=Q;N<Y;N++)for(let M=z;M<$;M++)if(O[M+o*N]!=I[M-v+o*(N-C)])return!1;return!0};this.propagator=new Array(4);for(let G=0;G<4;G++){this.propagator[G]=new Array(this.T);for(let O=0;O<this.T;O++){const I=[];for(let v=0;v<this.T;v++)D(this.patterns[O],this.patterns[v],this.DX[G],this.DY[G])&&I.push(v);this.propagator[G][O]=I}}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(r,n){return!this.periodic&&(r+this.N>this.FMX||n+this.N>this.FMY||r<0||n<0)},e.prototype.clear=function(){if(t.prototype.clear.call(this),this.ground!==0){for(let r=0;r<this.FMX;r++){for(let n=0;n<this.T;n++)n!==this.ground&&this.ban(r+(this.FMY-1)*this.FMX,n);for(let n=0;n<this.FMY-1;n++)this.ban(r+n*this.FMX,this.ground)}this.propagate()}},e.prototype.graphics=function(r){return r=r||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(r):this.graphicsIncomplete(r),r},e.prototype.graphicsComplete=function(r){for(let n=0;n<this.FMY;n++){const i=n<this.FMY-this.N+1?0:this.N-1;for(let s=0;s<this.FMX;s++){const o=s<this.FMX-this.N+1?0:this.N-1,a=(n*this.FMX+s)*4,c=this.colors[this.patterns[this.observed[s-o+(n-i)*this.FMX]][o+i*this.N]];r[a]=c[0],r[a+1]=c[1],r[a+2]=c[2],r[a+3]=c[3]}}},e.prototype.graphicsIncomplete=function(r){for(let n=0;n<this.FMXxFMY;n++){const i=n%this.FMX,s=n/this.FMX|0;let o=0,a=0,c=0,l=0,u=0;for(let d=0;d<this.N;d++)for(let f=0;f<this.N;f++){let m=i-f;m<0&&(m+=this.FMX);let p=s-d;if(p<0&&(p+=this.FMY),this.onBoundary(m,p))continue;const g=m+p*this.FMX;for(let y=0;y<this.T;y++)if(this.wave[g][y]){o++;const b=this.colors[this.patterns[y][f+d*this.N]];a+=b[0],c+=b[1],l+=b[2],u+=b[3]}}const h=n*4;r[h]=a/o,r[h+1]=c/o,r[h+2]=l/o,r[h+3]=u/o}},up=e,up}var fp,dk;function y5(){if(dk)return fp;dk=1;const t=fk(),e=function(n,i,s,o,a){const c=n.tilesize||16;this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=a,this.tilesize=c;const l=!!n.unique;let u=null;i&&n.subsets&&n.subsets[i]&&(u=n.subsets[i]);const h=function(F){const R=new Array(c*c);for(let P=0;P<c;P++)for(let W=0;W<c;W++)R[W+P*c]=F(W,P);return R},d=function(F){return h(function(R,P){return F[c-1-P+R*c]})},f=function(F){return h(function(R,P){return F[c-1-R+P*c]})};this.tiles=[];const m=[],p=[],g={};let y,b,A;for(let x=0;x<n.tiles.length;x++){const F=n.tiles[x];if(u!==null&&u.indexOf(F.name)===-1)continue;switch(F.symmetry){case"L":A=4,y=function(P){return(P+1)%4},b=function(P){return P%2===0?P+1:P-1};break;case"T":A=4,y=function(P){return(P+1)%4},b=function(P){return P%2===0?P:4-P};break;case"I":A=2,y=function(P){return 1-P},b=function(P){return P};break;case"\\":A=2,y=function(P){return 1-P},b=function(P){return 1-P};break;case"F":A=8,y=function(P){return P<4?(P+1)%4:4+(P-1)%4},b=function(P){return P<4?P+4:P-4};break;default:A=1,y=function(P){return P},b=function(P){return P};break}this.T=p.length,g[F.name]=this.T;for(let P=0;P<A;P++)p.push([this.T+P,this.T+y(P),this.T+y(y(P)),this.T+y(y(y(P))),this.T+b(P),this.T+b(y(P)),this.T+b(y(y(P))),this.T+b(y(y(y(P))))]);let R;if(l)for(let P=0;P<A;P++)R=F.bitmap[P],this.tiles.push(h(function(W,D){return[R[(c*D+W)*4],R[(c*D+W)*4+1],R[(c*D+W)*4+2],R[(c*D+W)*4+3]]}));else{R=F.bitmap,this.tiles.push(h(function(P,W){return[R[(c*W+P)*4],R[(c*W+P)*4+1],R[(c*W+P)*4+2],R[(c*W+P)*4+3]]}));for(let P=1;P<A;P++)this.tiles.push(P<4?d(this.tiles[this.T+P-1]):f(this.tiles[this.T+P-4]))}for(let P=0;P<A;P++)m.push(F.weight||1)}this.T=p.length,this.weights=m,this.propagator=new Array(4);const S=new Array(4);for(let x=0;x<4;x++){this.propagator[x]=new Array(this.T),S[x]=new Array(this.T);for(let F=0;F<this.T;F++){S[x][F]=new Array(this.T);for(let R=0;R<this.T;R++)S[x][F][R]=!1}}for(let x=0;x<n.neighbors.length;x++){const F=n.neighbors[x],R=F.left.split(" ").filter(function(I){return I.length}),P=F.right.split(" ").filter(function(I){return I.length});if(u!==null&&(u.indexOf(R[0])===-1||u.indexOf(P[0])===-1))continue;const W=p[g[R[0]]][R.length==1?0:parseInt(R[1],10)],D=p[W][1],G=p[g[P[0]]][P.length==1?0:parseInt(P[1],10)],O=p[G][1];S[0][G][W]=!0,S[0][p[G][6]][p[W][6]]=!0,S[0][p[W][4]][p[G][4]]=!0,S[0][p[W][2]][p[G][2]]=!0,S[1][O][D]=!0,S[1][p[D][6]][p[O][6]]=!0,S[1][p[O][4]][p[D][4]]=!0,S[1][p[D][2]][p[O][2]]=!0}for(let x=0;x<this.T;x++)for(let F=0;F<this.T;F++)S[2][x][F]=S[0][F][x],S[3][x][F]=S[1][F][x];for(let x=0;x<4;x++)for(let F=0;F<this.T;F++){const R=[],P=S[x][F];for(let W=0;W<this.T;W++)P[W]&&R.push(W);this.propagator[x][F]=R}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(r,n){return!this.periodic&&(r<0||n<0||r>=this.FMX||n>=this.FMY)},e.prototype.graphics=function(r,n){return r=r||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(r):this.graphicsIncomplete(r,n),r},e.prototype.graphicsComplete=function(r){for(let n=0;n<this.FMX;n++)for(let i=0;i<this.FMY;i++){const s=this.tiles[this.observed[n+i*this.FMX]];for(let o=0;o<this.tilesize;o++)for(let a=0;a<this.tilesize;a++){const c=(n*this.tilesize+a+(i*this.tilesize+o)*this.FMX*this.tilesize)*4,l=s[a+o*this.tilesize];r[c]=l[0],r[c+1]=l[1],r[c+2]=l[2],r[c+3]=l[3]}}},e.prototype.graphicsIncomplete=function(r,n){(!n||n.length!==4)&&(n=!1);for(let i=0;i<this.FMX;i++)for(let s=0;s<this.FMY;s++){const o=this.wave[i+s*this.FMX];let a=0,c=0;for(let u=0;u<this.T;u++)o[u]&&(a++,c+=this.weights[u]);const l=1/c;for(let u=0;u<this.tilesize;u++)for(let h=0;h<this.tilesize;h++){const d=(i*this.tilesize+h+(s*this.tilesize+u)*this.FMX*this.tilesize)*4;if(n&&a===this.T)r[d]=n[0],r[d+1]=n[1],r[d+2]=n[2],r[d+3]=n[3];else{let f=0,m=0,p=0,g=0;for(let y=0;y<this.T;y++)if(o[y]){const b=this.tiles[y][h+u*this.tilesize],A=this.weights[y]*l;f+=b[0]*A,m+=b[1]*A,p+=b[2]*A,g+=b[3]*A}r[d]=f,r[d+1]=m,r[d+2]=p,r[d+3]=g}}}},fp=e,fp}var hp,pk;function _5(){return pk||(pk=1,hp={OverlappingModel:g5(),SimpleTiledModel:y5()}),hp}var b5=_5(),w5=js(b5);const mk=5;function gk(t,e,r,n,i,s,o){if(!w(k.book))return!1;const a=k.book,c=Ir(a,Re.BOARD,t),l=Ir(a,Re.BOARD,e),u=At(c),h=At(l);if(!w(u)||!w(h))return!1;cr(u),cr(h);let d=0;const f=new Map,m=new Map;let p=0;const g=32,y=new Uint8Array(ph*4);for(let R=0;R<rt;++R)for(let P=0;P<Me;++P){const W=nt(h,{x:P,y:R}),D=W?.char??0,G=W?.color??g,O=W?.bg??g;y[p++]=D,y[p++]=G,y[p++]=O;const I=vn(W),v=Be(I?.name??"empty"),C=f.get(v);Te(C)?y[p++]=C:(f.set(v,d),m.set(d,v),y[p++]=d++)}const b=s.x-i.x+1,A=s.y-i.y+1,S=new w5.OverlappingModel(y,Me,rt,r,b,A,!1,!1,n,0);let x=0;for(;x<mk&&!S.generate();++x);if(x===mk)return!1;p=0;const F=S.graphics();for(let R=i.y;R<=s.y;++R)for(let P=i.x;P<=s.x;++P){const W={x:P,y:R},D=F[p++],G=F[p++],O=F[p++];switch(d=F[p++],o){case"all":{const z=nt(u,{x:P,y:R});jt(z)&&dr(u,z,a.timestamp),St(u,{x:P,y:R});break}case"object":{const z=nt(u,{x:P,y:R});jt(z)&&dr(u,z,a.timestamp);break}case"terrain":St(u,{x:P,y:R});break}let I=m.get(d)??"";const v=vn({kind:I});switch(o){case"all":break;case"object":jt(v)||(I="");break;case"terrain":jt(v)&&(I="");break;default:if(He(v,"group")!==o&&(I=""),I){const z=nt(u,{x:P,y:R});jt(z)&&dr(u,z,a.timestamp),St(u,{x:P,y:R})}break}const C=I?an(u,[I],W):void 0;if(!(!w(C)||!w(v))&&(Rs(C,v),D>0&&(C.char=D),G<g&&(C.color=G),O<g&&(C.bg=O),jt(C))){const z=en(Fo(h,I));w(z)&&(St(u,{...Xi(h,z.x??0,z.y??0),x:P,y:R}),Rs(C,z))}}return!0}function yk(t){return`zss_snapshot_${t}`}const _k={x:0,y:0},bk={x:Me-1,y:rt-1},wk="all";function v5(t){const e=Ir(k.book,Re.BOARD,t),r=At(e);if(!w(r))return;const n=yk(r.id);vE(k.book,n);const[i]=Vi(Xe.MAIN,n,Re.BOARD),s=At(i);if(w(s))return ru(t,s.id,_k,bk,wk),s}function E5(t){const e=Ir(k.book,Re.BOARD,t),r=At(e);if(!w(r))return;const n=yk(r.id),i=Ir(k.book,Re.BOARD,n),s=At(i);if(w(s))return ru(s.id,t,_k,bk,wk),s}function k5(t,e,r,n,i,s){switch(s){case"all":case"object":case"terrain":break;default:return x5(t,e,i,s)}if(!w(k.book))return;const o=k.book,a=Ir(o,Re.BOARD,t),c=At(a);if(!w(c))return;const l=Ru();cr(c);for(let u=r.y;u<=n.y;++u)for(let h=r.x;h<=n.x;++h){let d=!1,f=!1;switch(s){case"all":d=!0,f=!0;break;case"object":d=!0;break;case"terrain":f=!0;break}const m=(h+e.x+Me)%Me,p=(u+e.y+rt)%rt;if(d){const g=nt(c,{x:h,y:u});jt(g)&&w(g?.x)&&w(g?.y)&&(g.x=m,g.lx=m,g.y=p,g.ly=p)}f&&(l.terrain[m+p*Me]=c.terrain[h+u*Me])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),Ha(c)}function x5(t,e,r,n){if(!w(k.book))return;const i=k.book,s=Ir(i,Re.BOARD,t),o=At(s);if(!w(o))return;cr(o);const{terrainelements:a,objectelements:c}=TE(o,r,n);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>Qr({x:p.x??0,y:p.y??0},Me)),h=[],d=[];for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b=nt(o,y);w(b)&&jt(b)&&(h.push(b.id??""),h.push(b.id??""),d.push(Qr({x:b.x??0,y:b.y??0},Me)))}let f=!1;for(let p=0;p<a.length;++p){const g=a[p],y=He(g,"collision"),b={x:g.x??-1,y:g.y??-1},A=Qr(b,Me),S={x:b.x+e.x,y:b.y+e.y};if(Po(S)){const x=nt(o,S),F=x?.id??"",R=Qr({x:x?.x??0,y:x?.y??0},Me),P=He(x,"collision");if(w(x)&&jt(x)&&h.includes(F)!==!0&&l.includes(F)!==!0){let W=!1;const D=d.includes(A),G=D?nt(o,b):void 0,O=D?He(G,"pushable"):!1,I=D&&O;if(x0(g,x)&&(y!==We.ISWALK||D)){let v=D;w(G)&&O&&(f=Bn(i,o,G,{x:(G.x??0)-e.x,y:(G.y??0)-e.y})!==!0,f||(v=!1)),(v||y!==We.ISWALK)&&(f=Bn(i,o,x,{x:(x.x??0)+e.x,y:(x.y??0)+e.y})!==!0,f&&(W=I))}else(y!==We.ISWALK||I)&&(f=!0,W=I);W&&w(G)&&(f=Bn(i,o,G,{x:(G.x??0)-e.x,y:(G.y??0)-e.y})!==!0)}else P===We.ISSOLID&&u.includes(R)===!1&&(f=!0)}else f=!0}if(f)return;for(let p=0;p<c.length;++p){const g=c[p],y=He(g,"collision"),b={x:g.x??0,y:g.y??0},A={x:b.x+e.x,y:b.y+e.y};if(Po(A)){const S=nt(o,A),x=S?.id??"",F=He(S,"collision"),R=He(S,"group");w(S)&&jt(S)&&h.includes(x)&&l.includes(x)!==!0?x0(g,S)?f=Bn(i,o,S,A)!==!0:f=!0:ec(y,F)&&n!==R&&(f=!0)}else f=!0}if(f)return;(e.x>0||e.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+e.x,y:y.y+e.y},A=Xi(o,b.x,b.y);if(w(g)&&w(A)){St(o,{...g,x:b.x,y:b.y}),St(o,{...A,x:y.x,y:y.y});const S=nt(o,y);jt(S)&&w(S)&&(S.x=(S.x??0)+e.x,S.y=(S.y??0)+e.y,S.lx=(S.lx??0)+e.x,S.ly=(S.ly??0)+e.y)}}Ha(o);for(let p=0;p<c.length;++p){const g=c[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+e.x,y:y.y+e.y};if(!Bn(i,o,g,b))break}Ha(o)}function hu(t,e){let r="all";const n={x:0,y:0},i={x:Me-1,y:rt-1};for(let s=e;s<t.length;){const[o,a]=ue(t,s,[Z.MAYBE_NUMBER_OR_STRING]);if(ye(o))r=Be(o),s=a;else if(Te(o)){const[c,l,u,h]=ue(t,a,[Z.NUMBER,Z.MAYBE_NUMBER,Z.MAYBE_NUMBER]);n.x=Math.min(o,l??o),n.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=h}else break}return{targetset:r,pt1:n,pt2:i}}const A5=yi().command("snapshot",()=>(!w(k.book)||!w(k.board)||v5(k.board.id),0)).command("revert",()=>(!w(k.book)||!w(k.board)||E5(k.board.id),0)).command("copy",(t,e)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ue(e,0,[Z.STRING]),i=bookreadcodepagesbytypeandstat(k.book,Re.BOARD,r),s=en(...i);if(w(s)){const o=hu(e,n);ru(s.id,k.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n,i,s]=ue(e,0,[Z.STRING,Z.NUMBER,Z.NUMBER]),o=bookreadcodepagesbytypeandstat(k.book,Re.BOARD,r),a=en(...o);if(w(a)){const c=hu(e,s);gk(k.board.id,a.id,n,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ue(e,0,[Z.DIR]),i={x:r.destpt.x-(k.element?.x??0),y:r.destpt.y-(k.element?.y??0)},s=hu(e,n);return k5(k.board.id,i,s.pt1,s.pt2,k.elementid,s.targetset),0}).command("pivot",(t,e)=>{if(!w(k.book)||!w(k.board))return 0;const[r,n]=ue(e,0,[Z.NUMBER]),i=hu(e,n);return p5(k.board.id,Ey(r),i.pt1,i.pt2,i.targetset),0});var qi=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(qi||{});const T5={audio:Jc,board:CF,cli:B4,display:D4,element:Y4,runtime:d5,loader:f5,network:h5,transform:A5},dp=["audio","board","display","network","transform","element"],S5={0:[],1:["cli",...dp],2:["loader",...dp],3:["runtime",...dp]},R5={0:new Map,1:new Map,2:new Map,3:new Map};function No(t){return(S5[t]??[]).map(r=>T5[r]).filter(w)}function pp(t){const e=[],r=No(t);for(let n=0;n<r.length;++n)e.push(...r[n].listcommands());return e}function O5(t,e){const r=R5[t];if(!r.has(e)){let n;const i=No(t);for(let s=0;s<i.length&&(n=i[s].getcommand(e),!w(n));++s);r.set(e,n)}return r.get(e)}function I5(t,e,r){const n=No(t);for(let i=0;i<n.length;++i){const s=n[i];if(s.get!==void 0){const[o,a]=s.get(e,r);if(o)return[o,a]}}return[!1,void 0]}function N5(t,e,r,n){const i=No(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,r,n);if(a)return[a,n]}}return[!1,void 0]}function C5(t,e){const r=No(t);for(let n=0;n<r.length;++n)r[n].everytick(e)}function L5(t,e){const r=No(t);for(let n=0;n<r.length;++n)r[n].aftertick(e)}var Va={},mp={},gp={},yp={},vk;function M5(){if(vk)return yp;vk=1;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return yp.encode=function(e){if(0<=e&&e<t.length)return t[e];throw new TypeError("Must be between 0 and 63: "+e)},yp}var Ek;function kk(){if(Ek)return gp;Ek=1;const t=M5(),e=5,r=1<<e,n=r-1,i=r;function s(o){return o<0?(-o<<1)+1:(o<<1)+0}return gp.encode=function(a){let c="",l,u=s(a);do l=u&n,u>>>=e,u>0&&(l|=i),c+=t.encode(l);while(u>0);return c},gp}var Pn={},Us={},Xa={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var U5=Xa.exports,xk;function F5(){return xk||(xk=1,(function(t,e){(function(r){var n=e&&!e.nodeType&&e,i=t&&!t.nodeType&&t,s=typeof Ci=="object"&&Ci;(s.global===s||s.window===s||s.self===s)&&(r=s);var o,a=2147483647,c=36,l=1,u=26,h=38,d=700,f=72,m=128,p="-",g=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=c-l,x=Math.floor,F=String.fromCharCode,R;function P(N){throw new RangeError(A[N])}function W(N,M){for(var U=N.length,V=[];U--;)V[U]=M(N[U]);return V}function D(N,M){var U=N.split("@"),V="";U.length>1&&(V=U[0]+"@",N=U[1]),N=N.replace(b,".");var q=N.split("."),J=W(q,M).join(".");return V+J}function G(N){for(var M=[],U=0,V=N.length,q,J;U<V;)q=N.charCodeAt(U++),q>=55296&&q<=56319&&U<V?(J=N.charCodeAt(U++),(J&64512)==56320?M.push(((q&1023)<<10)+(J&1023)+65536):(M.push(q),U--)):M.push(q);return M}function O(N){return W(N,function(M){var U="";return M>65535&&(M-=65536,U+=F(M>>>10&1023|55296),M=56320|M&1023),U+=F(M),U}).join("")}function I(N){return N-48<10?N-22:N-65<26?N-65:N-97<26?N-97:c}function v(N,M){return N+22+75*(N<26)-((M!=0)<<5)}function C(N,M,U){var V=0;for(N=U?x(N/d):N>>1,N+=x(N/M);N>S*u>>1;V+=c)N=x(N/S);return x(V+(S+1)*N/(N+h))}function z(N){var M=[],U=N.length,V,q=0,J=m,he=f,xe,ve,ke,Ae,Se,Le,je,T,fe;for(xe=N.lastIndexOf(p),xe<0&&(xe=0),ve=0;ve<xe;++ve)N.charCodeAt(ve)>=128&&P("not-basic"),M.push(N.charCodeAt(ve));for(ke=xe>0?xe+1:0;ke<U;){for(Ae=q,Se=1,Le=c;ke>=U&&P("invalid-input"),je=I(N.charCodeAt(ke++)),(je>=c||je>x((a-q)/Se))&&P("overflow"),q+=je*Se,T=Le<=he?l:Le>=he+u?u:Le-he,!(je<T);Le+=c)fe=c-T,Se>x(a/fe)&&P("overflow"),Se*=fe;V=M.length+1,he=C(q-Ae,V,Ae==0),x(q/V)>a-J&&P("overflow"),J+=x(q/V),q%=V,M.splice(q++,0,J)}return O(M)}function $(N){var M,U,V,q,J,he,xe,ve,ke,Ae,Se,Le=[],je,T,fe,ie;for(N=G(N),je=N.length,M=m,U=0,J=f,he=0;he<je;++he)Se=N[he],Se<128&&Le.push(F(Se));for(V=q=Le.length,q&&Le.push(p);V<je;){for(xe=a,he=0;he<je;++he)Se=N[he],Se>=M&&Se<xe&&(xe=Se);for(T=V+1,xe-M>x((a-U)/T)&&P("overflow"),U+=(xe-M)*T,M=xe,he=0;he<je;++he)if(Se=N[he],Se<M&&++U>a&&P("overflow"),Se==M){for(ve=U,ke=c;Ae=ke<=J?l:ke>=J+u?u:ke-J,!(ve<Ae);ke+=c)ie=ve-Ae,fe=c-Ae,Le.push(F(v(Ae+ie%fe,0))),ve=x(ie/fe);Le.push(F(v(ve,0))),J=C(U,T,V==q),U=0,++V}++U,++M}return Le.join("")}function Q(N){return D(N,function(M){return g.test(M)?z(M.slice(4).toLowerCase()):M})}function Y(N){return D(N,function(M){return y.test(M)?"xn--"+$(M):M})}if(o={version:"1.4.1",ucs2:{decode:G,encode:O},decode:z,encode:$,toASCII:Y,toUnicode:Q},n&&i)if(t.exports==n)i.exports=o;else for(R in o)o.hasOwnProperty(R)&&(n[R]=o[R]);else r.punycode=o})(U5)})(Xa,Xa.exports)),Xa.exports}var _p,Ak;function Co(){return Ak||(Ak=1,_p=TypeError),_p}var P5={},$5=Object.freeze({__proto__:null,default:P5}),B5=nT($5),bp,Tk;function du(){if(Tk)return bp;Tk=1;var t=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=t&&e&&typeof e.get=="function"?e.get:null,n=t&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,h=u?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,f=d?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,p=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,b=String.prototype.slice,A=String.prototype.replace,S=String.prototype.toUpperCase,x=String.prototype.toLowerCase,F=RegExp.prototype.test,R=Array.prototype.concat,P=Array.prototype.join,W=Array.prototype.slice,D=Math.floor,G=typeof BigInt=="function"?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,v=typeof Symbol=="function"&&typeof Symbol.iterator=="object",C=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===v||!0)?Symbol.toStringTag:null,z=Object.prototype.propertyIsEnumerable,$=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(H){return H.__proto__}:null);function Q(H,re){if(H===1/0||H===-1/0||H!==H||H&&H>-1e3&&H<1e3||F.call(/e/,re))return re;var ze=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof H=="number"){var Ge=H<0?-D(-H):D(H);if(Ge!==H){var qe=String(Ge),Ce=b.call(re,qe.length+1);return A.call(qe,ze,"$&_")+"."+A.call(A.call(Ce,/([0-9]{3})/g,"$&_"),/_$/,"")}}return A.call(re,ze,"$&_")}var Y=B5,N=Y.custom,M=T(N)?N:null,U={__proto__:null,double:'"',single:"'"},V={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};bp=function H(re,ze,Ge,qe){var Ce=ze||{};if(K(Ce,"quoteStyle")&&!K(U,Ce.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(K(Ce,"maxStringLength")&&(typeof Ce.maxStringLength=="number"?Ce.maxStringLength<0&&Ce.maxStringLength!==1/0:Ce.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Yr=K(Ce,"customInspect")?Ce.customInspect:!0;if(typeof Yr!="boolean"&&Yr!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(K(Ce,"indent")&&Ce.indent!==null&&Ce.indent!=="	"&&!(parseInt(Ce.indent,10)===Ce.indent&&Ce.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(K(Ce,"numericSeparator")&&typeof Ce.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var kn=Ce.numericSeparator;if(typeof re>"u")return"undefined";if(re===null)return"null";if(typeof re=="boolean")return re?"true":"false";if(typeof re=="string")return pt(re,Ce);if(typeof re=="number"){if(re===0)return 1/0/re>0?"0":"-0";var cn=String(re);return kn?Q(re,cn):cn}if(typeof re=="bigint"){var es=String(re)+"n";return kn?Q(re,es):es}var G0=typeof Ce.depth>"u"?5:Ce.depth;if(typeof Ge>"u"&&(Ge=0),Ge>=G0&&G0>0&&typeof re=="object")return xe(re)?"[Array]":"[Object]";var Ho=B(Ce,Ge);if(typeof qe>"u")qe=[];else if(pe(qe,re)>=0)return"[Circular]";function Dn(Go,zu,aW){if(zu&&(qe=W.call(qe),qe.push(zu)),aW){var tT={depth:Ce.depth};return K(Ce,"quoteStyle")&&(tT.quoteStyle=Ce.quoteStyle),H(Go,tT,Ge+1,qe)}return H(Go,Ce,Ge+1,qe)}if(typeof re=="function"&&!ke(re)){var YA=ee(re),VA=ce(re,Dn);return"[Function"+(YA?": "+YA:" (anonymous)")+"]"+(VA.length>0?" { "+P.call(VA,", ")+" }":"")}if(T(re)){var XA=v?A.call(String(re),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(re);return typeof re=="object"&&!v?Yt(XA):XA}if($e(re)){for(var oc="<"+x.call(String(re.nodeName)),K0=re.attributes||[],ju=0;ju<K0.length;ju++)oc+=" "+K0[ju].name+"="+q(J(K0[ju].value),"double",Ce);return oc+=">",re.childNodes&&re.childNodes.length&&(oc+="..."),oc+="</"+x.call(String(re.nodeName))+">",oc}if(xe(re)){if(re.length===0)return"[]";var q0=ce(re,Dn);return Ho&&!E(q0)?"["+X(q0,Ho)+"]":"[ "+P.call(q0,", ")+" ]"}if(Ae(re)){var Y0=ce(re,Dn);return!("cause"in Error.prototype)&&"cause"in re&&!z.call(re,"cause")?"{ ["+String(re)+"] "+P.call(R.call("[cause]: "+Dn(re.cause),Y0),", ")+" }":Y0.length===0?"["+String(re)+"]":"{ ["+String(re)+"] "+P.call(Y0,", ")+" }"}if(typeof re=="object"&&Yr){if(M&&typeof re[M]=="function"&&Y)return Y(re,{depth:G0-Ge});if(Yr!=="symbol"&&typeof re.inspect=="function")return re.inspect()}if(me(re)){var ZA=[];return n&&n.call(re,function(Go,zu){ZA.push(Dn(zu,re,!0)+" => "+Dn(Go,re))}),_("Map",r.call(re),ZA,Ho)}if(Oe(re)){var JA=[];return a&&a.call(re,function(Go){JA.push(Dn(Go,re))}),_("Set",o.call(re),JA,Ho)}if(se(re))return L("WeakMap");if(be(re))return L("WeakSet");if(_e(re))return L("WeakRef");if(Le(re))return Yt(Dn(Number(re)));if(fe(re))return Yt(Dn(G.call(re)));if(je(re))return Yt(m.call(re));if(Se(re))return Yt(Dn(String(re)));if(typeof window<"u"&&re===window)return"{ [object Window] }";if(typeof globalThis<"u"&&re===globalThis||typeof Ci<"u"&&re===Ci)return"{ [object globalThis] }";if(!ve(re)&&!ke(re)){var V0=ce(re,Dn),QA=$?$(re)===Object.prototype:re instanceof Object||re.constructor===Object,X0=re instanceof Object?"":"null prototype",eT=!QA&&C&&Object(re)===re&&C in re?b.call(j(re),8,-1):X0?"Object":"",oW=QA||typeof re.constructor!="function"?"":re.constructor.name?re.constructor.name+" ":"",Z0=oW+(eT||X0?"["+P.call(R.call([],eT||[],X0||[]),": ")+"] ":"");return V0.length===0?Z0+"{}":Ho?Z0+"{"+X(V0,Ho)+"}":Z0+"{ "+P.call(V0,", ")+" }"}return String(re)};function q(H,re,ze){var Ge=ze.quoteStyle||re,qe=U[Ge];return qe+H+qe}function J(H){return A.call(String(H),/"/g,"&quot;")}function he(H){return!C||!(typeof H=="object"&&(C in H||typeof H[C]<"u"))}function xe(H){return j(H)==="[object Array]"&&he(H)}function ve(H){return j(H)==="[object Date]"&&he(H)}function ke(H){return j(H)==="[object RegExp]"&&he(H)}function Ae(H){return j(H)==="[object Error]"&&he(H)}function Se(H){return j(H)==="[object String]"&&he(H)}function Le(H){return j(H)==="[object Number]"&&he(H)}function je(H){return j(H)==="[object Boolean]"&&he(H)}function T(H){if(v)return H&&typeof H=="object"&&H instanceof Symbol;if(typeof H=="symbol")return!0;if(!H||typeof H!="object"||!I)return!1;try{return I.call(H),!0}catch{}return!1}function fe(H){if(!H||typeof H!="object"||!G)return!1;try{return G.call(H),!0}catch{}return!1}var ie=Object.prototype.hasOwnProperty||function(H){return H in this};function K(H,re){return ie.call(H,re)}function j(H){return p.call(H)}function ee(H){if(H.name)return H.name;var re=y.call(g.call(H),/^function\s*([\w$]+)/);return re?re[1]:null}function pe(H,re){if(H.indexOf)return H.indexOf(re);for(var ze=0,Ge=H.length;ze<Ge;ze++)if(H[ze]===re)return ze;return-1}function me(H){if(!r||!H||typeof H!="object")return!1;try{r.call(H);try{o.call(H)}catch{return!0}return H instanceof Map}catch{}return!1}function se(H){if(!l||!H||typeof H!="object")return!1;try{l.call(H,l);try{h.call(H,h)}catch{return!0}return H instanceof WeakMap}catch{}return!1}function _e(H){if(!f||!H||typeof H!="object")return!1;try{return f.call(H),!0}catch{}return!1}function Oe(H){if(!o||!H||typeof H!="object")return!1;try{o.call(H);try{r.call(H)}catch{return!0}return H instanceof Set}catch{}return!1}function be(H){if(!h||!H||typeof H!="object")return!1;try{h.call(H,h);try{l.call(H,l)}catch{return!0}return H instanceof WeakSet}catch{}return!1}function $e(H){return!H||typeof H!="object"?!1:typeof HTMLElement<"u"&&H instanceof HTMLElement?!0:typeof H.nodeName=="string"&&typeof H.getAttribute=="function"}function pt(H,re){if(H.length>re.maxStringLength){var ze=H.length-re.maxStringLength,Ge="... "+ze+" more character"+(ze>1?"s":"");return pt(b.call(H,0,re.maxStringLength),re)+Ge}var qe=V[re.quoteStyle||"single"];qe.lastIndex=0;var Ce=A.call(A.call(H,qe,"\\$1"),/[\x00-\x1f]/g,Ze);return q(Ce,"single",re)}function Ze(H){var re=H.charCodeAt(0),ze={8:"b",9:"t",10:"n",12:"f",13:"r"}[re];return ze?"\\"+ze:"\\x"+(re<16?"0":"")+S.call(re.toString(16))}function Yt(H){return"Object("+H+")"}function L(H){return H+" { ? }"}function _(H,re,ze,Ge){var qe=Ge?X(ze,Ge):P.call(ze,", ");return H+" ("+re+") {"+qe+"}"}function E(H){for(var re=0;re<H.length;re++)if(pe(H[re],`
`)>=0)return!1;return!0}function B(H,re){var ze;if(H.indent==="	")ze="	";else if(typeof H.indent=="number"&&H.indent>0)ze=P.call(Array(H.indent+1)," ");else return null;return{base:ze,prev:P.call(Array(re+1),ze)}}function X(H,re){if(H.length===0)return"";var ze=`
`+re.prev+re.base;return ze+P.call(H,","+ze)+`
`+re.prev}function ce(H,re){var ze=xe(H),Ge=[];if(ze){Ge.length=H.length;for(var qe=0;qe<H.length;qe++)Ge[qe]=K(H,qe)?re(H[qe],H):""}var Ce=typeof O=="function"?O(H):[],Yr;if(v){Yr={};for(var kn=0;kn<Ce.length;kn++)Yr["$"+Ce[kn]]=Ce[kn]}for(var cn in H)K(H,cn)&&(ze&&String(Number(cn))===cn&&cn<H.length||v&&Yr["$"+cn]instanceof Symbol||(F.call(/[^\w$]/,cn)?Ge.push(re(cn,H)+": "+re(H[cn],H)):Ge.push(cn+": "+re(H[cn],H))));if(typeof O=="function")for(var es=0;es<Ce.length;es++)z.call(H,Ce[es])&&Ge.push("["+re(Ce[es])+"]: "+re(H[Ce[es]],H));return Ge}return bp}var wp,Sk;function D5(){if(Sk)return wp;Sk=1;var t=du(),e=Co(),r=function(a,c,l){for(var u=a,h;(h=u.next)!=null;u=h)if(h.key===c)return u.next=h.next,l||(h.next=a.next,a.next=h),h},n=function(a,c){if(a){var l=r(a,c);return l&&l.value}},i=function(a,c,l){var u=r(a,c);u?u.value=l:a.next={key:c,next:a.next,value:l}},s=function(a,c){return a?!!r(a,c):!1},o=function(a,c){if(a)return r(a,c,!0)};return wp=function(){var c,l={assert:function(u){if(!l.has(u))throw new e("Side channel does not contain "+t(u))},delete:function(u){var h=c&&c.next,d=o(c,u);return d&&h&&h===d&&(c=void 0),!!d},get:function(u){return n(c,u)},has:function(u){return s(c,u)},set:function(u,h){c||(c={next:void 0}),i(c,u,h)}};return l},wp}var vp,Rk;function Ok(){return Rk||(Rk=1,vp=Object),vp}var Ep,Ik;function j5(){return Ik||(Ik=1,Ep=Error),Ep}var kp,Nk;function z5(){return Nk||(Nk=1,kp=EvalError),kp}var xp,Ck;function W5(){return Ck||(Ck=1,xp=RangeError),xp}var Ap,Lk;function H5(){return Lk||(Lk=1,Ap=ReferenceError),Ap}var Tp,Mk;function G5(){return Mk||(Mk=1,Tp=SyntaxError),Tp}var Sp,Uk;function K5(){return Uk||(Uk=1,Sp=URIError),Sp}var Rp,Fk;function q5(){return Fk||(Fk=1,Rp=Math.abs),Rp}var Op,Pk;function Y5(){return Pk||(Pk=1,Op=Math.floor),Op}var Ip,$k;function V5(){return $k||($k=1,Ip=Math.max),Ip}var Np,Bk;function X5(){return Bk||(Bk=1,Np=Math.min),Np}var Cp,Dk;function Z5(){return Dk||(Dk=1,Cp=Math.pow),Cp}var Lp,jk;function J5(){return jk||(jk=1,Lp=Math.round),Lp}var Mp,zk;function Q5(){return zk||(zk=1,Mp=Number.isNaN||function(e){return e!==e}),Mp}var Up,Wk;function ej(){if(Wk)return Up;Wk=1;var t=Q5();return Up=function(r){return t(r)||r===0?r:r<0?-1:1},Up}var Fp,Hk;function tj(){return Hk||(Hk=1,Fp=Object.getOwnPropertyDescriptor),Fp}var Pp,Gk;function Kk(){if(Gk)return Pp;Gk=1;var t=tj();if(t)try{t([],"length")}catch{t=null}return Pp=t,Pp}var $p,qk;function rj(){if(qk)return $p;qk=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return $p=t,$p}var Bp,Yk;function nj(){return Yk||(Yk=1,Bp=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[r]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Bp}var Dp,Vk;function ij(){if(Vk)return Dp;Vk=1;var t=typeof Symbol<"u"&&Symbol,e=nj();return Dp=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Dp}var jp,Xk;function Zk(){return Xk||(Xk=1,jp=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),jp}var zp,Jk;function Qk(){if(Jk)return zp;Jk=1;var t=Ok();return zp=t.getPrototypeOf||null,zp}var Wp,ex;function sj(){if(ex)return Wp;ex=1;var t="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,r=Math.max,n="[object Function]",i=function(c,l){for(var u=[],h=0;h<c.length;h+=1)u[h]=c[h];for(var d=0;d<l.length;d+=1)u[d+c.length]=l[d];return u},s=function(c,l){for(var u=[],h=l,d=0;h<c.length;h+=1,d+=1)u[d]=c[h];return u},o=function(a,c){for(var l="",u=0;u<a.length;u+=1)l+=a[u],u+1<a.length&&(l+=c);return l};return Wp=function(c){var l=this;if(typeof l!="function"||e.apply(l)!==n)throw new TypeError(t+l);for(var u=s(arguments,1),h,d=function(){if(this instanceof h){var y=l.apply(this,i(u,arguments));return Object(y)===y?y:this}return l.apply(c,i(u,arguments))},f=r(0,l.length-u.length),m=[],p=0;p<f;p++)m[p]="$"+p;if(h=Function("binder","return function ("+o(m,",")+"){ return binder.apply(this,arguments); }")(d),l.prototype){var g=function(){};g.prototype=l.prototype,h.prototype=new g,g.prototype=null}return h},Wp}var Hp,tx;function pu(){if(tx)return Hp;tx=1;var t=sj();return Hp=Function.prototype.bind||t,Hp}var Gp,rx;function Kp(){return rx||(rx=1,Gp=Function.prototype.call),Gp}var qp,nx;function ix(){return nx||(nx=1,qp=Function.prototype.apply),qp}var Yp,sx;function oj(){return sx||(sx=1,Yp=typeof Reflect<"u"&&Reflect&&Reflect.apply),Yp}var Vp,ox;function aj(){if(ox)return Vp;ox=1;var t=pu(),e=ix(),r=Kp(),n=oj();return Vp=n||t.call(r,e),Vp}var Xp,ax;function cx(){if(ax)return Xp;ax=1;var t=pu(),e=Co(),r=Kp(),n=aj();return Xp=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return n(t,r,s)},Xp}var Zp,lx;function cj(){if(lx)return Zp;lx=1;var t=cx(),e=Kk(),r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var n=!!r&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return Zp=n&&typeof n.get=="function"?t([n.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,Zp}var Jp,ux;function lj(){if(ux)return Jp;ux=1;var t=Zk(),e=Qk(),r=cj();return Jp=t?function(i){return t(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:r?function(i){return r(i)}:null,Jp}var Qp,fx;function uj(){if(fx)return Qp;fx=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,r=pu();return Qp=r.call(t,e),Qp}var e0,hx;function t0(){if(hx)return e0;hx=1;var t,e=Ok(),r=j5(),n=z5(),i=W5(),s=H5(),o=G5(),a=Co(),c=K5(),l=q5(),u=Y5(),h=V5(),d=X5(),f=Z5(),m=J5(),p=ej(),g=Function,y=function(ke){try{return g('"use strict"; return ('+ke+").constructor;")()}catch{}},b=Kk(),A=rj(),S=function(){throw new a},x=b?(function(){try{return arguments.callee,S}catch{try{return b(arguments,"callee").get}catch{return S}}})():S,F=ij()(),R=lj(),P=Qk(),W=Zk(),D=ix(),G=Kp(),O={},I=typeof Uint8Array>"u"||!R?t:R(Uint8Array),v={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":F&&R?R([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":O,"%AsyncGenerator%":O,"%AsyncGeneratorFunction%":O,"%AsyncIteratorPrototype%":O,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":n,"%Float16Array%":typeof Float16Array>"u"?t:Float16Array,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":O,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":F&&R?R(R([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!F||!R?t:R(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":b,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!F||!R?t:R(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":F&&R?R(""[Symbol.iterator]()):t,"%Symbol%":F?Symbol:t,"%SyntaxError%":o,"%ThrowTypeError%":x,"%TypedArray%":I,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet,"%Function.prototype.call%":G,"%Function.prototype.apply%":D,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":P,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":h,"%Math.min%":d,"%Math.pow%":f,"%Math.round%":m,"%Math.sign%":p,"%Reflect.getPrototypeOf%":W};if(R)try{null.error}catch(ke){var C=R(R(ke));v["%Error.prototype%"]=C}var z=function ke(Ae){var Se;if(Ae==="%AsyncFunction%")Se=y("async function () {}");else if(Ae==="%GeneratorFunction%")Se=y("function* () {}");else if(Ae==="%AsyncGeneratorFunction%")Se=y("async function* () {}");else if(Ae==="%AsyncGenerator%"){var Le=ke("%AsyncGeneratorFunction%");Le&&(Se=Le.prototype)}else if(Ae==="%AsyncIteratorPrototype%"){var je=ke("%AsyncGenerator%");je&&R&&(Se=R(je.prototype))}return v[Ae]=Se,Se},$={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Q=pu(),Y=uj(),N=Q.call(G,Array.prototype.concat),M=Q.call(D,Array.prototype.splice),U=Q.call(G,String.prototype.replace),V=Q.call(G,String.prototype.slice),q=Q.call(G,RegExp.prototype.exec),J=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,he=/\\(\\)?/g,xe=function(Ae){var Se=V(Ae,0,1),Le=V(Ae,-1);if(Se==="%"&&Le!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(Le==="%"&&Se!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var je=[];return U(Ae,J,function(T,fe,ie,K){je[je.length]=ie?U(K,he,"$1"):fe||T}),je},ve=function(Ae,Se){var Le=Ae,je;if(Y($,Le)&&(je=$[Le],Le="%"+je[0]+"%"),Y(v,Le)){var T=v[Le];if(T===O&&(T=z(Le)),typeof T>"u"&&!Se)throw new a("intrinsic "+Ae+" exists, but is not available. Please file an issue!");return{alias:je,name:Le,value:T}}throw new o("intrinsic "+Ae+" does not exist!")};return e0=function(Ae,Se){if(typeof Ae!="string"||Ae.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Se!="boolean")throw new a('"allowMissing" argument must be a boolean');if(q(/^%?[^%]*%?$/,Ae)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Le=xe(Ae),je=Le.length>0?Le[0]:"",T=ve("%"+je+"%",Se),fe=T.name,ie=T.value,K=!1,j=T.alias;j&&(je=j[0],M(Le,N([0,1],j)));for(var ee=1,pe=!0;ee<Le.length;ee+=1){var me=Le[ee],se=V(me,0,1),_e=V(me,-1);if((se==='"'||se==="'"||se==="`"||_e==='"'||_e==="'"||_e==="`")&&se!==_e)throw new o("property names with quotes must have matching quotes");if((me==="constructor"||!pe)&&(K=!0),je+="."+me,fe="%"+je+"%",Y(v,fe))ie=v[fe];else if(ie!=null){if(!(me in ie)){if(!Se)throw new a("base intrinsic for "+Ae+" exists, but the property is not available.");return}if(b&&ee+1>=Le.length){var Oe=b(ie,me);pe=!!Oe,pe&&"get"in Oe&&!("originalValue"in Oe.get)?ie=Oe.get:ie=ie[me]}else pe=Y(ie,me),ie=ie[me];pe&&!K&&(v[fe]=ie)}}return ie},e0}var r0,dx;function px(){if(dx)return r0;dx=1;var t=t0(),e=cx(),r=e([t("%String.prototype.indexOf%")]);return r0=function(i,s){var o=t(i,!!s);return typeof o=="function"&&r(i,".prototype.")>-1?e([o]):o},r0}var n0,mx;function gx(){if(mx)return n0;mx=1;var t=t0(),e=px(),r=du(),n=Co(),i=t("%Map%",!0),s=e("Map.prototype.get",!0),o=e("Map.prototype.set",!0),a=e("Map.prototype.has",!0),c=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return n0=!!i&&function(){var h,d={assert:function(f){if(!d.has(f))throw new n("Side channel does not contain "+r(f))},delete:function(f){if(h){var m=c(h,f);return l(h)===0&&(h=void 0),m}return!1},get:function(f){if(h)return s(h,f)},has:function(f){return h?a(h,f):!1},set:function(f,m){h||(h=new i),o(h,f,m)}};return d},n0}var i0,yx;function fj(){if(yx)return i0;yx=1;var t=t0(),e=px(),r=du(),n=gx(),i=Co(),s=t("%WeakMap%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),c=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return i0=s?function(){var h,d,f={assert:function(m){if(!f.has(m))throw new i("Side channel does not contain "+r(m))},delete:function(m){if(s&&m&&(typeof m=="object"||typeof m=="function")){if(h)return l(h,m)}else if(n&&d)return d.delete(m);return!1},get:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&h?o(h,m):d&&d.get(m)},has:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&h?c(h,m):!!d&&d.has(m)},set:function(m,p){s&&m&&(typeof m=="object"||typeof m=="function")?(h||(h=new s),a(h,m,p)):n&&(d||(d=n()),d.set(m,p))}};return f}:n,i0}var s0,_x;function hj(){if(_x)return s0;_x=1;var t=Co(),e=du(),r=D5(),n=gx(),i=fj(),s=i||n||r;return s0=function(){var a,c={assert:function(l){if(!c.has(l))throw new t("Side channel does not contain "+e(l))},delete:function(l){return!!a&&a.delete(l)},get:function(l){return a&&a.get(l)},has:function(l){return!!a&&a.has(l)},set:function(l,u){a||(a=s()),a.set(l,u)}};return c},s0}var o0,bx;function a0(){if(bx)return o0;bx=1;var t=String.prototype.replace,e=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return o0={default:r.RFC3986,formatters:{RFC1738:function(n){return t.call(n,e,"+")},RFC3986:function(n){return String(n)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986},o0}var c0,wx;function vx(){if(wx)return c0;wx=1;var t=a0(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n=(function(){for(var g=[],y=0;y<256;++y)g.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return g})(),i=function(y){for(;y.length>1;){var b=y.pop(),A=b.obj[b.prop];if(r(A)){for(var S=[],x=0;x<A.length;++x)typeof A[x]<"u"&&S.push(A[x]);b.obj[b.prop]=S}}},s=function(y,b){for(var A=b&&b.plainObjects?{__proto__:null}:{},S=0;S<y.length;++S)typeof y[S]<"u"&&(A[S]=y[S]);return A},o=function g(y,b,A){if(!b)return y;if(typeof b!="object"&&typeof b!="function"){if(r(y))y.push(b);else if(y&&typeof y=="object")(A&&(A.plainObjects||A.allowPrototypes)||!e.call(Object.prototype,b))&&(y[b]=!0);else return[y,b];return y}if(!y||typeof y!="object")return[y].concat(b);var S=y;return r(y)&&!r(b)&&(S=s(y,A)),r(y)&&r(b)?(b.forEach(function(x,F){if(e.call(y,F)){var R=y[F];R&&typeof R=="object"&&x&&typeof x=="object"?y[F]=g(R,x,A):y.push(x)}else y[F]=x}),y):Object.keys(b).reduce(function(x,F){var R=b[F];return e.call(x,F)?x[F]=g(x[F],R,A):x[F]=R,x},S)},a=function(y,b){return Object.keys(b).reduce(function(A,S){return A[S]=b[S],A},y)},c=function(g,y,b){var A=g.replace(/\+/g," ");if(b==="iso-8859-1")return A.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(A)}catch{return A}},l=1024,u=function(y,b,A,S,x){if(y.length===0)return y;var F=y;if(typeof y=="symbol"?F=Symbol.prototype.toString.call(y):typeof y!="string"&&(F=String(y)),A==="iso-8859-1")return escape(F).replace(/%u[0-9a-f]{4}/gi,function(I){return"%26%23"+parseInt(I.slice(2),16)+"%3B"});for(var R="",P=0;P<F.length;P+=l){for(var W=F.length>=l?F.slice(P,P+l):F,D=[],G=0;G<W.length;++G){var O=W.charCodeAt(G);if(O===45||O===46||O===95||O===126||O>=48&&O<=57||O>=65&&O<=90||O>=97&&O<=122||x===t.RFC1738&&(O===40||O===41)){D[D.length]=W.charAt(G);continue}if(O<128){D[D.length]=n[O];continue}if(O<2048){D[D.length]=n[192|O>>6]+n[128|O&63];continue}if(O<55296||O>=57344){D[D.length]=n[224|O>>12]+n[128|O>>6&63]+n[128|O&63];continue}G+=1,O=65536+((O&1023)<<10|W.charCodeAt(G)&1023),D[D.length]=n[240|O>>18]+n[128|O>>12&63]+n[128|O>>6&63]+n[128|O&63]}R+=D.join("")}return R},h=function(y){for(var b=[{obj:{o:y},prop:"o"}],A=[],S=0;S<b.length;++S)for(var x=b[S],F=x.obj[x.prop],R=Object.keys(F),P=0;P<R.length;++P){var W=R[P],D=F[W];typeof D=="object"&&D!==null&&A.indexOf(D)===-1&&(b.push({obj:F,prop:W}),A.push(D))}return i(b),y},d=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},f=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},m=function(y,b){return[].concat(y,b)},p=function(y,b){if(r(y)){for(var A=[],S=0;S<y.length;S+=1)A.push(b(y[S]));return A}return b(y)};return c0={arrayToObject:s,assign:a,combine:m,compact:h,decode:c,encode:u,isBuffer:f,isRegExp:d,maybeMap:p,merge:o},c0}var l0,Ex;function dj(){if(Ex)return l0;Ex=1;var t=hj(),e=vx(),r=a0(),n=Object.prototype.hasOwnProperty,i={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,y){return g+"["+y+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(p,g){o.apply(p,s(g)?g:[g])},c=Date.prototype.toISOString,l=r.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:r.formatters[l],indices:!1,serializeDate:function(g){return c.call(g)},skipNulls:!1,strictNullHandling:!1},h=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},d={},f=function p(g,y,b,A,S,x,F,R,P,W,D,G,O,I,v,C,z,$){for(var Q=g,Y=$,N=0,M=!1;(Y=Y.get(d))!==void 0&&!M;){var U=Y.get(g);if(N+=1,typeof U<"u"){if(U===N)throw new RangeError("Cyclic object value");M=!0}typeof Y.get(d)>"u"&&(N=0)}if(typeof W=="function"?Q=W(y,Q):Q instanceof Date?Q=O(Q):b==="comma"&&s(Q)&&(Q=e.maybeMap(Q,function(fe){return fe instanceof Date?O(fe):fe})),Q===null){if(x)return P&&!C?P(y,u.encoder,z,"key",I):y;Q=""}if(h(Q)||e.isBuffer(Q)){if(P){var V=C?y:P(y,u.encoder,z,"key",I);return[v(V)+"="+v(P(Q,u.encoder,z,"value",I))]}return[v(y)+"="+v(String(Q))]}var q=[];if(typeof Q>"u")return q;var J;if(b==="comma"&&s(Q))C&&P&&(Q=e.maybeMap(Q,P)),J=[{value:Q.length>0?Q.join(",")||null:void 0}];else if(s(W))J=W;else{var he=Object.keys(Q);J=D?he.sort(D):he}var xe=R?String(y).replace(/\./g,"%2E"):String(y),ve=A&&s(Q)&&Q.length===1?xe+"[]":xe;if(S&&s(Q)&&Q.length===0)return ve+"[]";for(var ke=0;ke<J.length;++ke){var Ae=J[ke],Se=typeof Ae=="object"&&Ae&&typeof Ae.value<"u"?Ae.value:Q[Ae];if(!(F&&Se===null)){var Le=G&&R?String(Ae).replace(/\./g,"%2E"):String(Ae),je=s(Q)?typeof b=="function"?b(ve,Le):ve:ve+(G?"."+Le:"["+Le+"]");$.set(g,N);var T=t();T.set(d,$),a(q,p(Se,je,b,A,S,x,F,R,b==="comma"&&C&&s(Q)?null:P,W,D,G,O,I,v,C,z,T))}}return q},m=function(g){if(!g)return u;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=g.charset||u.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=r.default;if(typeof g.format<"u"){if(!n.call(r.formatters,g.format))throw new TypeError("Unknown format option provided.");b=g.format}var A=r.formatters[b],S=u.filter;(typeof g.filter=="function"||s(g.filter))&&(S=g.filter);var x;if(g.arrayFormat in i?x=g.arrayFormat:"indices"in g?x=g.indices?"indices":"repeat":x=u.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var F=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:u.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:u.addQueryPrefix,allowDots:F,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:x,charset:y,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?u.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:u.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:u.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:u.encodeValuesOnly,filter:S,format:b,formatter:A,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:u.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:u.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:u.strictNullHandling}};return l0=function(p,g){var y=p,b=m(g),A,S;typeof b.filter=="function"?(S=b.filter,y=S("",y)):s(b.filter)&&(S=b.filter,A=S);var x=[];if(typeof y!="object"||y===null)return"";var F=i[b.arrayFormat],R=F==="comma"&&b.commaRoundTrip;A||(A=Object.keys(y)),b.sort&&A.sort(b.sort);for(var P=t(),W=0;W<A.length;++W){var D=A[W],G=y[D];b.skipNulls&&G===null||a(x,f(G,D,F,R,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,P))}var O=x.join(b.delimiter),I=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?I+="utf8=%26%2310003%3B&":I+="utf8=%E2%9C%93&"),O.length>0?I+O:""},l0}var u0,kx;function pj(){if(kx)return u0;kx=1;var t=vx(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:t.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(d){return d.replace(/&#(\d+);/g,function(f,m){return String.fromCharCode(parseInt(m,10))})},s=function(d,f,m){if(d&&typeof d=="string"&&f.comma&&d.indexOf(",")>-1)return d.split(",");if(f.throwOnLimitExceeded&&m>=f.arrayLimit)throw new RangeError("Array limit exceeded. Only "+f.arrayLimit+" element"+(f.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(f,m){var p={__proto__:null},g=m.ignoreQueryPrefix?f.replace(/^\?/,""):f;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=m.parameterLimit===1/0?void 0:m.parameterLimit,b=g.split(m.delimiter,m.throwOnLimitExceeded?y+1:y);if(m.throwOnLimitExceeded&&b.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var A=-1,S,x=m.charset;if(m.charsetSentinel)for(S=0;S<b.length;++S)b[S].indexOf("utf8=")===0&&(b[S]===a?x="utf-8":b[S]===o&&(x="iso-8859-1"),A=S,S=b.length);for(S=0;S<b.length;++S)if(S!==A){var F=b[S],R=F.indexOf("]="),P=R===-1?F.indexOf("="):R+1,W,D;P===-1?(W=m.decoder(F,n.decoder,x,"key"),D=m.strictNullHandling?null:""):(W=m.decoder(F.slice(0,P),n.decoder,x,"key"),D=t.maybeMap(s(F.slice(P+1),m,r(p[W])?p[W].length:0),function(O){return m.decoder(O,n.decoder,x,"value")})),D&&m.interpretNumericEntities&&x==="iso-8859-1"&&(D=i(String(D))),F.indexOf("[]=")>-1&&(D=r(D)?[D]:D);var G=e.call(p,W);G&&m.duplicates==="combine"?p[W]=t.combine(p[W],D):(!G||m.duplicates==="last")&&(p[W]=D)}return p},l=function(d,f,m,p){var g=0;if(d.length>0&&d[d.length-1]==="[]"){var y=d.slice(0,-1).join("");g=Array.isArray(f)&&f[y]?f[y].length:0}for(var b=p?f:s(f,m,g),A=d.length-1;A>=0;--A){var S,x=d[A];if(x==="[]"&&m.parseArrays)S=m.allowEmptyArrays&&(b===""||m.strictNullHandling&&b===null)?[]:t.combine([],b);else{S=m.plainObjects?{__proto__:null}:{};var F=x.charAt(0)==="["&&x.charAt(x.length-1)==="]"?x.slice(1,-1):x,R=m.decodeDotInKeys?F.replace(/%2E/g,"."):F,P=parseInt(R,10);!m.parseArrays&&R===""?S={0:b}:!isNaN(P)&&x!==R&&String(P)===R&&P>=0&&m.parseArrays&&P<=m.arrayLimit?(S=[],S[P]=b):R!=="__proto__"&&(S[R]=b)}b=S}return b},u=function(f,m,p,g){if(f){var y=p.allowDots?f.replace(/\.([^.[]+)/g,"[$1]"):f,b=/(\[[^[\]]*])/,A=/(\[[^[\]]*])/g,S=p.depth>0&&b.exec(y),x=S?y.slice(0,S.index):y,F=[];if(x){if(!p.plainObjects&&e.call(Object.prototype,x)&&!p.allowPrototypes)return;F.push(x)}for(var R=0;p.depth>0&&(S=A.exec(y))!==null&&R<p.depth;){if(R+=1,!p.plainObjects&&e.call(Object.prototype,S[1].slice(1,-1))&&!p.allowPrototypes)return;F.push(S[1])}if(S){if(p.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+p.depth+" and strictDepth is true");F.push("["+y.slice(S.index)+"]")}return l(F,m,p,g)}},h=function(f){if(!f)return n;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.decodeDotInKeys<"u"&&typeof f.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(f.decoder!==null&&typeof f.decoder<"u"&&typeof f.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof f.throwOnLimitExceeded<"u"&&typeof f.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var m=typeof f.charset>"u"?n.charset:f.charset,p=typeof f.duplicates>"u"?n.duplicates:f.duplicates;if(p!=="combine"&&p!=="first"&&p!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof f.allowDots>"u"?f.decodeDotInKeys===!0?!0:n.allowDots:!!f.allowDots;return{allowDots:g,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:typeof f.allowPrototypes=="boolean"?f.allowPrototypes:n.allowPrototypes,allowSparse:typeof f.allowSparse=="boolean"?f.allowSparse:n.allowSparse,arrayLimit:typeof f.arrayLimit=="number"?f.arrayLimit:n.arrayLimit,charset:m,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:n.charsetSentinel,comma:typeof f.comma=="boolean"?f.comma:n.comma,decodeDotInKeys:typeof f.decodeDotInKeys=="boolean"?f.decodeDotInKeys:n.decodeDotInKeys,decoder:typeof f.decoder=="function"?f.decoder:n.decoder,delimiter:typeof f.delimiter=="string"||t.isRegExp(f.delimiter)?f.delimiter:n.delimiter,depth:typeof f.depth=="number"||f.depth===!1?+f.depth:n.depth,duplicates:p,ignoreQueryPrefix:f.ignoreQueryPrefix===!0,interpretNumericEntities:typeof f.interpretNumericEntities=="boolean"?f.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:typeof f.parameterLimit=="number"?f.parameterLimit:n.parameterLimit,parseArrays:f.parseArrays!==!1,plainObjects:typeof f.plainObjects=="boolean"?f.plainObjects:n.plainObjects,strictDepth:typeof f.strictDepth=="boolean"?!!f.strictDepth:n.strictDepth,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:n.strictNullHandling,throwOnLimitExceeded:typeof f.throwOnLimitExceeded=="boolean"?f.throwOnLimitExceeded:!1}};return u0=function(d,f){var m=h(f);if(d===""||d===null||typeof d>"u")return m.plainObjects?{__proto__:null}:{};for(var p=typeof d=="string"?c(d,m):d,g=m.plainObjects?{__proto__:null}:{},y=Object.keys(p),b=0;b<y.length;++b){var A=y[b],S=u(A,p[A],m,typeof d=="string");g=t.merge(g,S,m)}return m.allowSparse===!0?g:t.compact(g)},u0}var f0,xx;function mj(){if(xx)return f0;xx=1;var t=dj(),e=pj(),r=a0();return f0={formats:r,parse:e,stringify:t},f0}var Ax;function gj(){if(Ax)return Us;Ax=1;var t=F5();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},p={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=mj();function y(x,F,R){if(x&&typeof x=="object"&&x instanceof e)return x;var P=new e;return P.parse(x,F,R),P}e.prototype.parse=function(x,F,R){if(typeof x!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof x);var P=x.indexOf("?"),W=P!==-1&&P<x.indexOf("#")?"?":"#",D=x.split(W),G=/\\/g;D[0]=D[0].replace(G,"/"),x=D.join(W);var O=x;if(O=O.trim(),!R&&x.split("#").length===1){var I=i.exec(O);if(I)return this.path=O,this.href=O,this.pathname=I[1],I[2]?(this.search=I[2],F?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):F&&(this.search="",this.query={}),this}var v=r.exec(O);if(v){v=v[0];var C=v.toLowerCase();this.protocol=C,O=O.substr(v.length)}if(R||v||O.match(/^\/\/[^@/]+@[^@/]+/)){var z=O.substr(0,2)==="//";z&&!(v&&m[v])&&(O=O.substr(2),this.slashes=!0)}if(!m[v]&&(z||v&&!p[v])){for(var $=-1,Q=0;Q<l.length;Q++){var Y=O.indexOf(l[Q]);Y!==-1&&($===-1||Y<$)&&($=Y)}var N,M;$===-1?M=O.lastIndexOf("@"):M=O.lastIndexOf("@",$),M!==-1&&(N=O.slice(0,M),O=O.slice(M+1),this.auth=decodeURIComponent(N)),$=-1;for(var Q=0;Q<c.length;Q++){var Y=O.indexOf(c[Q]);Y!==-1&&($===-1||Y<$)&&($=Y)}$===-1&&($=O.length),this.host=O.slice(0,$),O=O.slice($),this.parseHost(),this.hostname=this.hostname||"";var U=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!U)for(var V=this.hostname.split(/\./),Q=0,q=V.length;Q<q;Q++){var J=V[Q];if(J&&!J.match(h)){for(var he="",xe=0,ve=J.length;xe<ve;xe++)J.charCodeAt(xe)>127?he+="x":he+=J[xe];if(!he.match(h)){var ke=V.slice(0,Q),Ae=V.slice(Q+1),Se=J.match(d);Se&&(ke.push(Se[1]),Ae.unshift(Se[2])),Ae.length&&(O="/"+Ae.join(".")+O),this.hostname=ke.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),U||(this.hostname=t.toASCII(this.hostname));var Le=this.port?":"+this.port:"",je=this.hostname||"";this.host=je+Le,this.href+=this.host,U&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),O[0]!=="/"&&(O="/"+O))}if(!f[C])for(var Q=0,q=a.length;Q<q;Q++){var T=a[Q];if(O.indexOf(T)!==-1){var fe=encodeURIComponent(T);fe===T&&(fe=escape(T)),O=O.split(T).join(fe)}}var ie=O.indexOf("#");ie!==-1&&(this.hash=O.substr(ie),O=O.slice(0,ie));var K=O.indexOf("?");if(K!==-1?(this.search=O.substr(K),this.query=O.substr(K+1),F&&(this.query=g.parse(this.query)),O=O.slice(0,K)):F&&(this.search="",this.query={}),O&&(this.pathname=O),p[C]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Le=this.pathname||"",j=this.search||"";this.path=Le+j}return this.href=this.format(),this};function b(x){return typeof x=="string"&&(x=y(x)),x instanceof e?x.format():e.prototype.format.call(x)}e.prototype.format=function(){var x=this.auth||"";x&&(x=encodeURIComponent(x),x=x.replace(/%3A/i,":"),x+="@");var F=this.protocol||"",R=this.pathname||"",P=this.hash||"",W=!1,D="";this.host?W=x+this.host:this.hostname&&(W=x+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(W+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(D=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var G=this.search||D&&"?"+D||"";return F&&F.substr(-1)!==":"&&(F+=":"),this.slashes||(!F||p[F])&&W!==!1?(W="//"+(W||""),R&&R.charAt(0)!=="/"&&(R="/"+R)):W||(W=""),P&&P.charAt(0)!=="#"&&(P="#"+P),G&&G.charAt(0)!=="?"&&(G="?"+G),R=R.replace(/[?#]/g,function(O){return encodeURIComponent(O)}),G=G.replace("#","%23"),F+W+R+G+P};function A(x,F){return y(x,!1,!0).resolve(F)}e.prototype.resolve=function(x){return this.resolveObject(y(x,!1,!0)).format()};function S(x,F){return x?y(x,!1,!0).resolveObject(F):F}return e.prototype.resolveObject=function(x){if(typeof x=="string"){var F=new e;F.parse(x,!1,!0),x=F}for(var R=new e,P=Object.keys(this),W=0;W<P.length;W++){var D=P[W];R[D]=this[D]}if(R.hash=x.hash,x.href==="")return R.href=R.format(),R;if(x.slashes&&!x.protocol){for(var G=Object.keys(x),O=0;O<G.length;O++){var I=G[O];I!=="protocol"&&(R[I]=x[I])}return p[R.protocol]&&R.hostname&&!R.pathname&&(R.pathname="/",R.path=R.pathname),R.href=R.format(),R}if(x.protocol&&x.protocol!==R.protocol){if(!p[x.protocol]){for(var v=Object.keys(x),C=0;C<v.length;C++){var z=v[C];R[z]=x[z]}return R.href=R.format(),R}if(R.protocol=x.protocol,!x.host&&!m[x.protocol]){for(var q=(x.pathname||"").split("/");q.length&&!(x.host=q.shift()););x.host||(x.host=""),x.hostname||(x.hostname=""),q[0]!==""&&q.unshift(""),q.length<2&&q.unshift(""),R.pathname=q.join("/")}else R.pathname=x.pathname;if(R.search=x.search,R.query=x.query,R.host=x.host||"",R.auth=x.auth,R.hostname=x.hostname||x.host,R.port=x.port,R.pathname||R.search){var $=R.pathname||"",Q=R.search||"";R.path=$+Q}return R.slashes=R.slashes||x.slashes,R.href=R.format(),R}var Y=R.pathname&&R.pathname.charAt(0)==="/",N=x.host||x.pathname&&x.pathname.charAt(0)==="/",M=N||Y||R.host&&x.pathname,U=M,V=R.pathname&&R.pathname.split("/")||[],q=x.pathname&&x.pathname.split("/")||[],J=R.protocol&&!p[R.protocol];if(J&&(R.hostname="",R.port=null,R.host&&(V[0]===""?V[0]=R.host:V.unshift(R.host)),R.host="",x.protocol&&(x.hostname=null,x.port=null,x.host&&(q[0]===""?q[0]=x.host:q.unshift(x.host)),x.host=null),M=M&&(q[0]===""||V[0]==="")),N)R.host=x.host||x.host===""?x.host:R.host,R.hostname=x.hostname||x.hostname===""?x.hostname:R.hostname,R.search=x.search,R.query=x.query,V=q;else if(q.length)V||(V=[]),V.pop(),V=V.concat(q),R.search=x.search,R.query=x.query;else if(x.search!=null){if(J){R.host=V.shift(),R.hostname=R.host;var he=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;he&&(R.auth=he.shift(),R.hostname=he.shift(),R.host=R.hostname)}return R.search=x.search,R.query=x.query,(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.href=R.format(),R}if(!V.length)return R.pathname=null,R.search?R.path="/"+R.search:R.path=null,R.href=R.format(),R;for(var xe=V.slice(-1)[0],ve=(R.host||x.host||V.length>1)&&(xe==="."||xe==="..")||xe==="",ke=0,Ae=V.length;Ae>=0;Ae--)xe=V[Ae],xe==="."?V.splice(Ae,1):xe===".."?(V.splice(Ae,1),ke++):ke&&(V.splice(Ae,1),ke--);if(!M&&!U)for(;ke--;ke)V.unshift("..");M&&V[0]!==""&&(!V[0]||V[0].charAt(0)!=="/")&&V.unshift(""),ve&&V.join("/").substr(-1)!=="/"&&V.push("");var Se=V[0]===""||V[0]&&V[0].charAt(0)==="/";if(J){R.hostname=Se?"":V.length?V.shift():"",R.host=R.hostname;var he=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;he&&(R.auth=he.shift(),R.hostname=he.shift(),R.host=R.hostname)}return M=M||R.host&&V.length,M&&!Se&&V.unshift(""),V.length>0?R.pathname=V.join("/"):(R.pathname=null,R.path=null),(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.auth=x.auth||R.auth,R.slashes=R.slashes||x.slashes,R.href=R.format(),R},e.prototype.parseHost=function(){var x=this.host,F=n.exec(x);F&&(F=F[0],F!==":"&&(this.port=F.substr(1)),x=x.substr(0,x.length-F.length)),x&&(this.hostname=x)},Us.parse=y,Us.resolve=A,Us.resolveObject=S,Us.format=b,Us.Url=e,Us}var h0,Tx;function yj(){return Tx||(Tx=1,h0=typeof URL=="function"?URL:gj().URL),h0}var Sx;function mu(){if(Sx)return Pn;Sx=1;const t=yj();function e(D,G,O){if(G in D)return D[G];if(arguments.length===3)return O;throw new Error('"'+G+'" is a required argument.')}Pn.getArg=e;const r=(function(){return!("__proto__"in Object.create(null))})();function n(D){return D}function i(D){return o(D)?"$"+D:D}Pn.toSetString=r?n:i;function s(D){return o(D)?D.slice(1):D}Pn.fromSetString=r?n:s;function o(D){if(!D)return!1;const G=D.length;if(G<9||D.charCodeAt(G-1)!==95||D.charCodeAt(G-2)!==95||D.charCodeAt(G-3)!==111||D.charCodeAt(G-4)!==116||D.charCodeAt(G-5)!==111||D.charCodeAt(G-6)!==114||D.charCodeAt(G-7)!==112||D.charCodeAt(G-8)!==95||D.charCodeAt(G-9)!==95)return!1;for(let O=G-10;O>=0;O--)if(D.charCodeAt(O)!==36)return!1;return!0}function a(D,G){return D===G?0:D===null?1:G===null?-1:D>G?1:-1}function c(D,G){let O=D.generatedLine-G.generatedLine;return O!==0||(O=D.generatedColumn-G.generatedColumn,O!==0)||(O=a(D.source,G.source),O!==0)||(O=D.originalLine-G.originalLine,O!==0)||(O=D.originalColumn-G.originalColumn,O!==0)?O:a(D.name,G.name)}Pn.compareByGeneratedPositionsInflated=c;function l(D){return JSON.parse(D.replace(/^\)]}'[^\n]*\n/,""))}Pn.parseSourceMapInput=l;const u="http:",h=`${u}//host`;function d(D){return G=>{const O=y(G),I=p(G),v=new t(G,I);D(v);const C=v.toString();return O==="absolute"?C:O==="scheme-relative"?C.slice(u.length):O==="path-absolute"?C.slice(h.length):b(I,C)}}function f(D,G){return new t(D,G).toString()}function m(D,G){let O=0;do{const I=D+O++;if(G.indexOf(I)===-1)return I}while(!0)}function p(D){const G=D.split("..").length-1,O=m("p",D);let I=`${h}/`;for(let v=0;v<G;v++)I+=`${O}/`;return I}const g=/^[A-Za-z0-9\+\-\.]+:/;function y(D){return D[0]==="/"?D[1]==="/"?"scheme-relative":"path-absolute":g.test(D)?"absolute":"path-relative"}function b(D,G){typeof D=="string"&&(D=new t(D)),typeof G=="string"&&(G=new t(G));const O=G.pathname.split("/"),I=D.pathname.split("/");for(I.length>0&&!I[I.length-1]&&I.pop();O.length>0&&I.length>0&&O[0]===I[0];)O.shift(),I.shift();return I.map(()=>"..").concat(O).join("/")+G.search+G.hash}const A=d(D=>{D.pathname=D.pathname.replace(/\/?$/,"/")}),S=d(D=>{D.href=new t(".",D.toString()).toString()}),x=d(D=>{});Pn.normalize=x;function F(D,G){const O=y(G),I=y(D);if(D=A(D),O==="absolute")return f(G,void 0);if(I==="absolute")return f(G,D);if(O==="scheme-relative")return x(G);if(I==="scheme-relative")return f(G,f(D,h)).slice(u.length);if(O==="path-absolute")return x(G);if(I==="path-absolute")return f(G,f(D,h)).slice(h.length);const v=p(G+D),C=f(G,f(D,v));return b(v,C)}Pn.join=F;function R(D,G){const O=P(D,G);return typeof O=="string"?O:x(G)}Pn.relative=R;function P(D,G){if(y(D)!==y(G))return null;const I=p(D+G),v=new t(D,I),C=new t(G,I);try{new t("",C.toString())}catch{return null}return C.protocol!==v.protocol||C.user!==v.user||C.password!==v.password||C.hostname!==v.hostname||C.port!==v.port?null:b(v,C)}function W(D,G,O){D&&y(G)==="path-absolute"&&(G=G.replace(/^\//,""));let I=x(G||"");return D&&(I=F(D,I)),O&&(I=F(S(O),I)),I}return Pn.computeSourceURL=W,Pn}var d0={},Rx;function Ox(){if(Rx)return d0;Rx=1;class t{constructor(){this._array=[],this._set=new Map}static fromArray(r,n){const i=new t;for(let s=0,o=r.length;s<o;s++)i.add(r[s],n);return i}size(){return this._set.size}add(r,n){const i=this.has(r),s=this._array.length;(!i||n)&&this._array.push(r),i||this._set.set(r,s)}has(r){return this._set.has(r)}indexOf(r){const n=this._set.get(r);if(n>=0)return n;throw new Error('"'+r+'" is not in the set.')}at(r){if(r>=0&&r<this._array.length)return this._array[r];throw new Error("No element indexed by "+r)}toArray(){return this._array.slice()}}return d0.ArraySet=t,d0}var p0={},Ix;function _j(){if(Ix)return p0;Ix=1;const t=mu();function e(n,i){const s=n.generatedLine,o=i.generatedLine,a=n.generatedColumn,c=i.generatedColumn;return o>s||o==s&&c>=a||t.compareByGeneratedPositionsInflated(n,i)<=0}class r{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(i,s){this._array.forEach(i,s)}add(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))}toArray(){return this._sorted||(this._array.sort(t.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}return p0.MappingList=r,p0}var Nx;function Cx(){if(Nx)return mp;Nx=1;const t=kk(),e=mu(),r=Ox().ArraySet,n=_j().MappingList;class i{constructor(o){o||(o={}),this._file=e.getArg(o,"file",null),this._sourceRoot=e.getArg(o,"sourceRoot",null),this._skipValidation=e.getArg(o,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new n,this._sourcesContents=null}static fromSourceMap(o){const a=o.sourceRoot,c=new i({file:o.file,sourceRoot:a});return o.eachMapping(function(l){const u={generated:{line:l.generatedLine,column:l.generatedColumn}};l.source!=null&&(u.source=l.source,a!=null&&(u.source=e.relative(a,u.source)),u.original={line:l.originalLine,column:l.originalColumn},l.name!=null&&(u.name=l.name)),c.addMapping(u)}),o.sources.forEach(function(l){let u=l;a!=null&&(u=e.relative(a,l)),c._sources.has(u)||c._sources.add(u);const h=o.sourceContentFor(l);h!=null&&c.setSourceContent(l,h)}),c}addMapping(o){const a=e.getArg(o,"generated"),c=e.getArg(o,"original",null);let l=e.getArg(o,"source",null),u=e.getArg(o,"name",null);this._skipValidation||this._validateMapping(a,c,l,u),l!=null&&(l=String(l),this._sources.has(l)||this._sources.add(l)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:a.line,generatedColumn:a.column,originalLine:c&&c.line,originalColumn:c&&c.column,source:l,name:u})}setSourceContent(o,a){let c=o;this._sourceRoot!=null&&(c=e.relative(this._sourceRoot,c)),a!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(c)]=a):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(c)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(o,a,c){let l=a;if(a==null){if(o.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);l=o.file}const u=this._sourceRoot;u!=null&&(l=e.relative(u,l));const h=this._mappings.toArray().length>0?new r:this._sources,d=new r;this._mappings.unsortedForEach(function(f){if(f.source===l&&f.originalLine!=null){const g=o.originalPositionFor({line:f.originalLine,column:f.originalColumn});g.source!=null&&(f.source=g.source,c!=null&&(f.source=e.join(c,f.source)),u!=null&&(f.source=e.relative(u,f.source)),f.originalLine=g.line,f.originalColumn=g.column,g.name!=null&&(f.name=g.name))}const m=f.source;m!=null&&!h.has(m)&&h.add(m);const p=f.name;p!=null&&!d.has(p)&&d.add(p)},this),this._sources=h,this._names=d,o.sources.forEach(function(f){const m=o.sourceContentFor(f);m!=null&&(c!=null&&(f=e.join(c,f)),u!=null&&(f=e.relative(u,f)),this.setSourceContent(f,m))},this)}_validateMapping(o,a,c,l){if(a&&typeof a.line!="number"&&typeof a.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(o&&"line"in o&&"column"in o&&o.line>0&&o.column>=0&&!a&&!c&&!l)){if(!(o&&"line"in o&&"column"in o&&a&&"line"in a&&"column"in a&&o.line>0&&o.column>=0&&a.line>0&&a.column>=0&&c))throw new Error("Invalid mapping: "+JSON.stringify({generated:o,source:c,original:a,name:l}))}}_serializeMappings(){let o=0,a=1,c=0,l=0,u=0,h=0,d="",f,m,p,g;const y=this._mappings.toArray();for(let b=0,A=y.length;b<A;b++){if(m=y[b],f="",m.generatedLine!==a)for(o=0;m.generatedLine!==a;)f+=";",a++;else if(b>0){if(!e.compareByGeneratedPositionsInflated(m,y[b-1]))continue;f+=","}f+=t.encode(m.generatedColumn-o),o=m.generatedColumn,m.source!=null&&(g=this._sources.indexOf(m.source),f+=t.encode(g-h),h=g,f+=t.encode(m.originalLine-1-l),l=m.originalLine-1,f+=t.encode(m.originalColumn-c),c=m.originalColumn,m.name!=null&&(p=this._names.indexOf(m.name),f+=t.encode(p-u),u=p)),d+=f}return d}_generateSourcesContent(o,a){return o.map(function(c){if(!this._sourcesContents)return null;a!=null&&(c=e.relative(a,c));const l=e.toSetString(c);return Object.prototype.hasOwnProperty.call(this._sourcesContents,l)?this._sourcesContents[l]:null},this)}toJSON(){const o={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(o.file=this._file),this._sourceRoot!=null&&(o.sourceRoot=this._sourceRoot),this._sourcesContents&&(o.sourcesContent=this._generateSourcesContent(o.sources,o.sourceRoot)),o}toString(){return JSON.stringify(this.toJSON())}}return i.prototype._version=3,mp.SourceMapGenerator=i,mp}var Za={},m0={},Lx;function bj(){return Lx||(Lx=1,(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(r,n,i,s,o,a){const c=Math.floor((n-r)/2)+r,l=o(i,s[c],!0);return l===0?c:l>0?n-c>1?e(c,n,i,s,o,a):a===t.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-r>1?e(r,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:r<0?-1:r}t.search=function(n,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,n,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(m0)),m0}var gu={exports:{}},Mx;function Ux(){if(Mx)return gu.exports;Mx=1;let t=null;return gu.exports=function(){if(typeof t=="string")return fetch(t).then(r=>r.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},gu.exports.initialize=e=>{t=e},gu.exports}var g0,Fx;function wj(){if(Fx)return g0;Fx=1;const t=Ux();function e(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let r=null;return g0=function(){if(r)return r;const i=[];return r=t().then(s=>WebAssembly.instantiate(s,{env:{mapping_callback(o,a,c,l,u,h,d,f,m,p){const g=new e;g.generatedLine=o+1,g.generatedColumn=a,c&&(g.lastGeneratedColumn=l-1),u&&(g.source=h,g.originalLine=d+1,g.originalColumn=f,m&&(g.name=p)),i[i.length-1](g)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(s=>({exports:s.instance.exports,withMappingCallback:(o,a)=>{i.push(o);try{a()}finally{i.pop()}}})).then(null,s=>{throw r=null,s}),r},g0}var Px;function vj(){if(Px)return Za;Px=1;const t=mu(),e=bj(),r=Ox().ArraySet;kk();const n=Ux(),i=wj(),s=Symbol("smcInternal");class o{constructor(d,f){return d==s?Promise.resolve(this):l(d,f)}static initialize(d){n.initialize(d["lib/mappings.wasm"])}static fromSourceMap(d,f){return u(d,f)}static async with(d,f,m){const p=await new o(d,f);try{return await m(p)}finally{p.destroy()}}eachMapping(d,f,m){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(d){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}o.prototype._version=3,o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,Za.SourceMapConsumer=o;class a extends o{constructor(d,f){return super(s).then(m=>{let p=d;typeof d=="string"&&(p=t.parseSourceMapInput(d));const g=t.getArg(p,"version"),y=t.getArg(p,"sources").map(String),b=t.getArg(p,"names",[]),A=t.getArg(p,"sourceRoot",null),S=t.getArg(p,"sourcesContent",null),x=t.getArg(p,"mappings"),F=t.getArg(p,"file",null),R=t.getArg(p,"x_google_ignoreList",null);if(g!=m._version)throw new Error("Unsupported version: "+g);return m._sourceLookupCache=new Map,m._names=r.fromArray(b.map(String),!0),m._sources=r.fromArray(y,!0),m._absoluteSources=r.fromArray(m._sources.toArray().map(function(P){return t.computeSourceURL(A,P,f)}),!0),m.sourceRoot=A,m.sourcesContent=S,m._mappings=x,m._sourceMapURL=f,m.file=F,m.x_google_ignoreList=R,m._computedColumnSpans=!1,m._mappingsPtr=0,m._wasm=null,i().then(P=>(m._wasm=P,m))})}_findSourceIndex(d){const f=this._sourceLookupCache.get(d);if(typeof f=="number")return f;const m=t.computeSourceURL(null,d,this._sourceMapURL);if(this._absoluteSources.has(m)){const g=this._absoluteSources.indexOf(m);return this._sourceLookupCache.set(d,g),g}const p=t.computeSourceURL(this.sourceRoot,d,this._sourceMapURL);if(this._absoluteSources.has(p)){const g=this._absoluteSources.indexOf(p);return this._sourceLookupCache.set(d,g),g}return-1}static fromSourceMap(d,f){return new a(d.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const d=this._mappings,f=d.length,m=this._wasm.exports.allocate_mappings(f)>>>0,p=new Uint8Array(this._wasm.exports.memory.buffer,m,f);for(let y=0;y<f;y++)p[y]=d.charCodeAt(y);const g=this._wasm.exports.parse_mappings(m);if(!g){const y=this._wasm.exports.get_last_error();let b=`Error parsing mappings (code ${y}): `;switch(y){case 1:b+="the mappings contained a negative line, column, source index, or name index";break;case 2:b+="the mappings contained a number larger than 2**32";break;case 3:b+="reached EOF while in the middle of parsing a VLQ";break;case 4:b+="invalid base 64 character while parsing a VLQ";break;default:b+="unknown error code";break}throw new Error(b)}this._mappingsPtr=g}eachMapping(d,f,m){const p=f||null,g=m||o.GENERATED_ORDER;this._wasm.withMappingCallback(y=>{y.source!==null&&(y.source=this._absoluteSources.at(y.source),y.name!==null&&(y.name=this._names.at(y.name))),this._computedColumnSpans&&y.lastGeneratedColumn===null&&(y.lastGeneratedColumn=1/0),d.call(p,y)},()=>{switch(g){case o.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case o.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(d){let f=t.getArg(d,"source");const m=t.getArg(d,"line"),p=d.column||0;if(f=this._findSourceIndex(f),f<0)return[];if(m<1)throw new Error("Line numbers must be >= 1");if(p<0)throw new Error("Column numbers must be >= 0");const g=[];return this._wasm.withMappingCallback(y=>{let b=y.lastGeneratedColumn;this._computedColumnSpans&&b===null&&(b=1/0),g.push({line:y.generatedLine,column:y.generatedColumn,lastColumn:b})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),f,m-1,"column"in d,p)}),g}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(d){const f={generatedLine:t.getArg(d,"line"),generatedColumn:t.getArg(d,"column")};if(f.generatedLine<1)throw new Error("Line numbers must be >= 1");if(f.generatedColumn<0)throw new Error("Column numbers must be >= 0");let m=t.getArg(d,"bias",o.GREATEST_LOWER_BOUND);m==null&&(m=o.GREATEST_LOWER_BOUND);let p;if(this._wasm.withMappingCallback(g=>p=g,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),f.generatedLine-1,f.generatedColumn,m)}),p&&p.generatedLine===f.generatedLine){let g=t.getArg(p,"source",null);g!==null&&(g=this._absoluteSources.at(g));let y=t.getArg(p,"name",null);return y!==null&&(y=this._names.at(y)),{source:g,line:t.getArg(p,"originalLine",null),column:t.getArg(p,"originalColumn",null),name:y}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(d){return d==null}):!1}sourceContentFor(d,f){if(!this.sourcesContent)return null;const m=this._findSourceIndex(d);if(m>=0)return this.sourcesContent[m];if(f)return null;throw new Error('"'+d+'" is not in the SourceMap.')}generatedPositionFor(d){let f=t.getArg(d,"source");if(f=this._findSourceIndex(f),f<0)return{line:null,column:null,lastColumn:null};const m={source:f,originalLine:t.getArg(d,"line"),originalColumn:t.getArg(d,"column")};if(m.originalLine<1)throw new Error("Line numbers must be >= 1");if(m.originalColumn<0)throw new Error("Column numbers must be >= 0");let p=t.getArg(d,"bias",o.GREATEST_LOWER_BOUND);p==null&&(p=o.GREATEST_LOWER_BOUND);let g;if(this._wasm.withMappingCallback(y=>g=y,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),m.source,m.originalLine-1,m.originalColumn,p)}),g&&g.source===m.source){let y=g.lastGeneratedColumn;return this._computedColumnSpans&&y===null&&(y=1/0),{line:t.getArg(g,"generatedLine",null),column:t.getArg(g,"generatedColumn",null),lastColumn:y}}return{line:null,column:null,lastColumn:null}}}a.prototype.consumer=o,Za.BasicSourceMapConsumer=a;class c extends o{constructor(d,f){return super(s).then(m=>{let p=d;typeof d=="string"&&(p=t.parseSourceMapInput(d));const g=t.getArg(p,"version"),y=t.getArg(p,"sections");if(g!=m._version)throw new Error("Unsupported version: "+g);let b={line:-1,column:0};return Promise.all(y.map(A=>{if(A.url)throw new Error("Support for url field in sections not implemented.");const S=t.getArg(A,"offset"),x=t.getArg(S,"line"),F=t.getArg(S,"column");if(x<b.line||x===b.line&&F<b.column)throw new Error("Section offsets must be ordered and non-overlapping.");return b=S,new o(t.getArg(A,"map"),f).then(P=>({generatedOffset:{generatedLine:x+1,generatedColumn:F+1},consumer:P}))})).then(A=>(m._sections=A,m))})}get sources(){const d=[];for(let f=0;f<this._sections.length;f++)for(let m=0;m<this._sections[f].consumer.sources.length;m++)d.push(this._sections[f].consumer.sources[m]);return d}originalPositionFor(d){const f={generatedLine:t.getArg(d,"line"),generatedColumn:t.getArg(d,"column")},m=e.search(f,this._sections,function(g,y){const b=g.generatedLine-y.generatedOffset.generatedLine;return b||g.generatedColumn-(y.generatedOffset.generatedColumn-1)}),p=this._sections[m];return p?p.consumer.originalPositionFor({line:f.generatedLine-(p.generatedOffset.generatedLine-1),column:f.generatedColumn-(p.generatedOffset.generatedLine===f.generatedLine?p.generatedOffset.generatedColumn-1:0),bias:d.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(d){return d.consumer.hasContentsOfAllSources()})}sourceContentFor(d,f){for(let m=0;m<this._sections.length;m++){const g=this._sections[m].consumer.sourceContentFor(d,!0);if(g)return g}if(f)return null;throw new Error('"'+d+'" is not in the SourceMap.')}_findSectionIndex(d){for(let f=0;f<this._sections.length;f++){const{consumer:m}=this._sections[f];if(m._findSourceIndex(d)!==-1)return f}return-1}generatedPositionFor(d){const f=this._findSectionIndex(t.getArg(d,"source")),m=f>=0?this._sections[f]:null,p=f>=0&&f+1<this._sections.length?this._sections[f+1]:null,g=m&&m.consumer.generatedPositionFor(d);if(g&&g.line!==null){const y=m.generatedOffset.generatedLine-1,b=m.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=b,typeof g.lastColumn=="number"&&(g.lastColumn+=b)),g.lastColumn===1/0&&p&&g.line===p.generatedOffset.generatedLine&&(g.lastColumn=p.generatedOffset.generatedColumn-2),g.line+=y,g}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(d){const f=this._findSectionIndex(t.getArg(d,"source")),m=f>=0?this._sections[f]:null,p=f>=0&&f+1<this._sections.length?this._sections[f+1]:null;return m?m.consumer.allGeneratedPositionsFor(d).map(g=>{const y=m.generatedOffset.generatedLine-1,b=m.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=b,typeof g.lastColumn=="number"&&(g.lastColumn+=b)),g.lastColumn===1/0&&p&&g.line===p.generatedOffset.generatedLine&&(g.lastColumn=p.generatedOffset.generatedColumn-2),g.line+=y,g}):[]}eachMapping(d,f,m){this._sections.forEach((p,g)=>{const y=g+1<this._sections.length?this._sections[g+1]:null,{generatedOffset:b}=p,A=b.generatedLine-1,S=b.generatedColumn-1;p.consumer.eachMapping(function(x){x.generatedLine===1&&(x.generatedColumn+=S,typeof x.lastGeneratedColumn=="number"&&(x.lastGeneratedColumn+=S)),x.lastGeneratedColumn===1/0&&y&&x.generatedLine===y.generatedOffset.generatedLine&&(x.lastGeneratedColumn=y.generatedOffset.generatedColumn-2),x.generatedLine+=A,d.call(this,x)},f,m)})}computeColumnSpans(){for(let d=0;d<this._sections.length;d++)this._sections[d].consumer.computeColumnSpans()}destroy(){for(let d=0;d<this._sections.length;d++)this._sections[d].consumer.destroy()}}Za.IndexedSourceMapConsumer=c;function l(h,d){let f=h;typeof h=="string"&&(f=t.parseSourceMapInput(h));const m=f.sections!=null?new c(f,d):new a(f,d);return Promise.resolve(m)}function u(h,d){return a.fromSourceMap(h,d)}return Za}var y0={},$x;function Ej(){if($x)return y0;$x=1;const t=Cx().SourceMapGenerator,e=mu(),r=/(\r?\n)/,n=10,i="$$$isSourceNode$$$";class s{constructor(a,c,l,u,h){this.children=[],this.sourceContents={},this.line=a??null,this.column=c??null,this.source=l??null,this.name=h??null,this[i]=!0,u!=null&&this.add(u)}static fromStringWithSourceMap(a,c,l){const u=new s,h=a.split(r);let d=0;const f=function(){const A=x(),S=x()||"";return A+S;function x(){return d<h.length?h[d++]:void 0}};let m=1,p=0,g=null,y;return c.eachMapping(function(A){if(g!==null)if(m<A.generatedLine)b(g,f()),m++,p=0;else{y=h[d]||"";const S=y.substr(0,A.generatedColumn-p);h[d]=y.substr(A.generatedColumn-p),p=A.generatedColumn,b(g,S),g=A;return}for(;m<A.generatedLine;)u.add(f()),m++;p<A.generatedColumn&&(y=h[d]||"",u.add(y.substr(0,A.generatedColumn)),h[d]=y.substr(A.generatedColumn),p=A.generatedColumn),g=A},this),d<h.length&&(g&&b(g,f()),u.add(h.splice(d).join(""))),c.sources.forEach(function(A){const S=c.sourceContentFor(A);S!=null&&(l!=null&&(A=e.join(l,A)),u.setSourceContent(A,S))}),u;function b(A,S){if(A===null||A.source===void 0)u.add(S);else{const x=l?e.join(l,A.source):A.source;u.add(new s(A.originalLine,A.originalColumn,x,S,A.name))}}}add(a){if(Array.isArray(a))a.forEach(function(c){this.add(c)},this);else if(a[i]||typeof a=="string")a&&this.children.push(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}prepend(a){if(Array.isArray(a))for(let c=a.length-1;c>=0;c--)this.prepend(a[c]);else if(a[i]||typeof a=="string")this.children.unshift(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}walk(a){let c;for(let l=0,u=this.children.length;l<u;l++)c=this.children[l],c[i]?c.walk(a):c!==""&&a(c,{source:this.source,line:this.line,column:this.column,name:this.name})}join(a){let c,l;const u=this.children.length;if(u>0){for(c=[],l=0;l<u-1;l++)c.push(this.children[l]),c.push(a);c.push(this.children[l]),this.children=c}return this}replaceRight(a,c){const l=this.children[this.children.length-1];return l[i]?l.replaceRight(a,c):typeof l=="string"?this.children[this.children.length-1]=l.replace(a,c):this.children.push("".replace(a,c)),this}setSourceContent(a,c){this.sourceContents[e.toSetString(a)]=c}walkSourceContents(a){for(let l=0,u=this.children.length;l<u;l++)this.children[l][i]&&this.children[l].walkSourceContents(a);const c=Object.keys(this.sourceContents);for(let l=0,u=c.length;l<u;l++)a(e.fromSetString(c[l]),this.sourceContents[c[l]])}toString(){let a="";return this.walk(function(c){a+=c}),a}toStringWithSourceMap(a){const c={code:"",line:1,column:0},l=new t(a);let u=!1,h=null,d=null,f=null,m=null;return this.walk(function(p,g){c.code+=p,g.source!==null&&g.line!==null&&g.column!==null?((h!==g.source||d!==g.line||f!==g.column||m!==g.name)&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name}),h=g.source,d=g.line,f=g.column,m=g.name,u=!0):u&&(l.addMapping({generated:{line:c.line,column:c.column}}),h=null,u=!1);for(let y=0,b=p.length;y<b;y++)p.charCodeAt(y)===n?(c.line++,c.column=0,y+1===b?(h=null,u=!1):u&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name})):c.column++}),this.walkSourceContents(function(p,g){l.setSourceContent(p,g)}),{code:c.code,map:l}}}return y0.SourceNode=s,y0}var Bx;function kj(){return Bx||(Bx=1,Va.SourceMapGenerator=Cx().SourceMapGenerator,Va.SourceMapConsumer=vj().SourceMapConsumer,Va.SourceNode=Ej().SourceNode),Va}var xj=kj();let Dx=0;const jx=Xn,Aj=["Command","lines"];class Tj extends C3{constructor(){super(dE,{traceInitPerf:Xn,skipValidations:!Xn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"}),this.performSelfAnalysis()}PEEK(e,r,...n){console.info(e,n.map(i=>[i.image,i.tokenType]),r)}RULED(e,r,n){const i=Aj.some(s=>e.includes(s));return this.RULE(e,()=>{const o=(Dx++).toString().padStart(3),a=i?"font-weight: bold;":"";if(jx&&!this.RECORDING_PHASE){const c=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${o}%c> ${e} ${c.join(" ")}`,a)}r(),jx&&!this.RECORDING_PHASE&&console.info(`${o}%c< ${e} `,a),Dx--},n)}program=this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))});line=this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Yl)}])});stmt=this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])});inline_go=this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))});inline_try=this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))});inline_command=this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))});inline=this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])});stmt_label=this.RULED("stmt_label",()=>{this.CONSUME(Ad)});stmt_stat=this.RULED("stmt_stat",()=>{this.CONSUME(xd)});stmt_text=this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(L1)}])});stmt_comment=this.RULED("stmt_comment",()=>{this.CONSUME(M1)});stmt_hyperlink=this.RULED("stmt_hyperlink",()=>{this.CONSUME(U1),this.CONSUME(F1)});stmt_command=this.RULED("stmt_command",()=>{this.CONSUME(Eo),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])});structured_cmd=this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])});short_go=this.RULED("short_go",()=>{this.CONSUME(Cd),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});short_try=this.RULED("short_try",()=>{this.CONSUME(eE),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});command_if=this.RULED("command_if",()=>{this.CONSUME(Ld),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))});command_if_block=this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Xl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Yl)),this.CONSUME4(Eo),this.CONSUME4(Md)}}])});command_block=this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Xl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Eo),this.CONSUME(Md)}}])});command_fork=this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Xl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])});command_else_if=this.RULED("command_else_if",()=>{this.CONSUME(Eo),this.CONSUME(Ud),this.CONSUME(Ld),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))});command_else=this.RULED("command_else",()=>{this.CONSUME(Eo),this.CONSUME(Ud),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))});command_while=this.RULED("command_while",()=>{this.CONSUME(oE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_repeat=this.RULED("command_repeat",()=>{this.CONSUME(aE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_waitfor=this.RULED("command_waitfor",()=>{this.CONSUME(cE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_foreach=this.RULED("command_foreach",()=>{this.CONSUME(lE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_break=this.RULED("command_break",()=>{this.CONSUME(uE)});command_continue=this.RULED("command_continue",()=>{this.CONSUME(fE)});command_play=this.RULED("command_play",()=>{this.CONSUME(nE)});command_toast=this.RULED("command_toast",()=>{this.CONSUME(iE)});command_ticker=this.RULED("command_ticker",()=>{this.CONSUME(sE)});expr=this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Sd),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})});and_test=this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Od),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})});not_test=this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Rd),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])});comparison=this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})});comp_op=this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Hv)},{ALT:()=>this.CONSUME(Gv)},{ALT:()=>this.CONSUME(Kv)},{ALT:()=>this.CONSUME(qv)},{ALT:()=>this.CONSUME(Yv)},{ALT:()=>this.CONSUME(Vv)}])});expr_value=this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Sd),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})});and_test_value=this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Od),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})});not_test_value=this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Rd),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])});arith_expr=this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])});arith_expr_item=this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Id)},{ALT:()=>this.CONSUME(Nd)}]),this.SUBRULE(this.term)});term=this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))});term_item=this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Zv)},{ALT:()=>this.CONSUME(Cd)},{ALT:()=>this.CONSUME(Jv)},{ALT:()=>this.CONSUME(Qv)}]),this.SUBRULE(this.factor)});factor=this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Id)},{ALT:()=>this.CONSUME(Nd)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])});power=this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Xv),this.SUBRULE(this.factor)})});words=this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))});kind=this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)});category=this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(P1)},{ALT:()=>this.CONSUME($1)}])});collision=this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(B1)},{ALT:()=>this.CONSUME(D1)},{ALT:()=>this.CONSUME(j1)},{ALT:()=>this.CONSUME(z1)},{ALT:()=>this.CONSUME(W1)},{ALT:()=>this.CONSUME(H1)},{ALT:()=>this.CONSUME(G1)},{ALT:()=>this.CONSUME(K1)},{ALT:()=>this.CONSUME(q1)}])});color=this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(Y1)},{ALT:()=>this.CONSUME(V1)},{ALT:()=>this.CONSUME(X1)},{ALT:()=>this.CONSUME(Z1)},{ALT:()=>this.CONSUME(J1)},{ALT:()=>this.CONSUME(Q1)},{ALT:()=>this.CONSUME(ew)},{ALT:()=>this.CONSUME(tw)},{ALT:()=>this.CONSUME(rw)},{ALT:()=>this.CONSUME(nw)},{ALT:()=>this.CONSUME(iw)},{ALT:()=>this.CONSUME(sw)},{ALT:()=>this.CONSUME(ow)},{ALT:()=>this.CONSUME(aw)},{ALT:()=>this.CONSUME(cw)},{ALT:()=>this.CONSUME(lw)},{ALT:()=>this.CONSUME(uw)},{ALT:()=>this.CONSUME(fw)},{ALT:()=>this.CONSUME(hw)},{ALT:()=>this.CONSUME(dw)},{ALT:()=>this.CONSUME(pw)},{ALT:()=>this.CONSUME(mw)},{ALT:()=>this.CONSUME(gw)},{ALT:()=>this.CONSUME(yw)},{ALT:()=>this.CONSUME(_w)},{ALT:()=>this.CONSUME(bw)},{ALT:()=>this.CONSUME(ww)},{ALT:()=>this.CONSUME(vw)},{ALT:()=>this.CONSUME(Ew)},{ALT:()=>this.CONSUME(kw)},{ALT:()=>this.CONSUME(xw)},{ALT:()=>this.CONSUME(Aw)},{ALT:()=>this.CONSUME(Tw)},{ALT:()=>this.CONSUME(Sw)},{ALT:()=>this.CONSUME(Rw)},{ALT:()=>this.CONSUME(Ow)},{ALT:()=>this.CONSUME(Iw)},{ALT:()=>this.CONSUME(Nw)},{ALT:()=>this.CONSUME(Cw)},{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(Dw)}])});dir_mod=this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Qw)},{ALT:()=>this.CONSUME(ev)},{ALT:()=>this.CONSUME(tv)},{ALT:()=>this.CONSUME(rv)},{ALT:()=>this.CONSUME(vv)},{ALT:()=>this.CONSUME(Ev)},{ALT:()=>this.SUBRULE(this.dir_within)},{ALT:()=>this.SUBRULE(this.dir_awayby)}])});dir_by=this.RULED("dir_by",()=>{this.CONSUME(Kw),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_at=this.RULED("dir_at",()=>{this.CONSUME(qw),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_away=this.RULED("dir_away",()=>{this.CONSUME(nv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_toward=this.RULED("dir_toward",()=>{this.CONSUME(iv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_find=this.RULED("dir_find",()=>{this.CONSUME(sv),this.SUBRULE1(this.kind)});dir_flee=this.RULED("dir_flee",()=>{this.CONSUME(ov),this.SUBRULE1(this.kind)});dir_to=this.RULED("dir_to",()=>{this.CONSUME(av),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)});dir_within=this.RULED("dir_within",()=>{this.CONSUME(kv),this.SUBRULE1(this.simple_token)});dir_awayby=this.RULED("dir_awayby",()=>{this.CONSUME(xv),this.SUBRULE1(this.simple_token)});dir=this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Ww)},{ALT:()=>this.CONSUME(Hw)},{ALT:()=>this.CONSUME(Gw)},{ALT:()=>this.SUBRULE(this.dir_by)},{ALT:()=>this.SUBRULE(this.dir_at)},{ALT:()=>this.SUBRULE(this.dir_away)},{ALT:()=>this.SUBRULE(this.dir_toward)},{ALT:()=>this.CONSUME(Yw)},{ALT:()=>this.CONSUME(Vw)},{ALT:()=>this.CONSUME(Xw)},{ALT:()=>this.CONSUME(Zw)},{ALT:()=>this.CONSUME(Jw)},{ALT:()=>this.SUBRULE(this.dir_find)},{ALT:()=>this.SUBRULE(this.dir_flee)},{ALT:()=>this.SUBRULE(this.dir_to)},{ALT:()=>this.CONSUME(cv)},{ALT:()=>this.CONSUME(lv)},{ALT:()=>this.CONSUME(uv)},{ALT:()=>this.CONSUME(fv)},{ALT:()=>this.CONSUME(hv)},{ALT:()=>this.CONSUME(dv)},{ALT:()=>this.CONSUME(pv)},{ALT:()=>this.CONSUME(mv)},{ALT:()=>this.CONSUME(gv)},{ALT:()=>this.CONSUME(yv)},{ALT:()=>this.CONSUME(_v)},{ALT:()=>this.CONSUME(bv)},{ALT:()=>this.CONSUME(wv)}])});expr_any=this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])});token_expr_any=this.RULED("token_expr_any",()=>{this.CONSUME(Rv),this.SUBRULE(this.expr_any)});token_expr_count=this.RULED("token_expr_count",()=>{this.CONSUME(Ov),this.SUBRULE(this.expr_any)});token_expr_blocked=this.RULED("token_expr_blocked",()=>{this.CONSUME(Sv),this.SUBRULE(this.dir)});token_expr_abs=this.RULED("token_expr_abs",()=>{this.CONSUME(Iv),this.SUBRULE(this.simple_token)});token_expr_intceil=this.RULED("token_expr_intceil",()=>{this.CONSUME(Nv),this.SUBRULE(this.simple_token)});token_expr_intfloor=this.RULED("token_expr_intfloor",()=>{this.CONSUME(Cv),this.SUBRULE(this.simple_token)});token_expr_intround=this.RULED("token_expr_intround",()=>{this.CONSUME(Lv),this.SUBRULE(this.simple_token)});token_expr_clamp=this.RULED("token_expr_clamp",()=>{this.CONSUME(Mv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)});token_expr_min=this.RULED("token_expr_min",()=>{this.CONSUME(Uv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_max=this.RULED("token_expr_max",()=>{this.CONSUME(Fv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pick=this.RULED("token_expr_pick",()=>{this.CONSUME(Pv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pickwith=this.RULED("token_expr_pickwith",()=>{this.CONSUME($v),this.SUBRULE1(this.simple_token),this.AT_LEAST_ONE(()=>this.SUBRULE2(this.simple_token))});token_expr_random=this.RULED("token_expr_random",()=>{this.CONSUME(Bv),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))});token_expr_randomwith=this.RULED("token_expr_randomwith",()=>{this.CONSUME(Dv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))});token_expr_run=this.RULED("token_expr_run",()=>{this.CONSUME(jv),this.SUBRULE(this.string_token)});token_expr_runwith=this.RULED("token_expr_runwith",()=>{this.CONSUME(zv),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)});token_expr=this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(Av)},{ALT:()=>this.CONSUME(Tv)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])});string_token=this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(Vl)}])});simple_token=this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(Td)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(Vl)},{ALT:()=>this.SUBRULE(this.color)}])});token=this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(Ad)},{ALT:()=>this.CONSUME(Vl)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(Td)},{ALT:()=>this.CONSUME(Wv)},{ALT:()=>{this.CONSUME(tE),this.SUBRULE(this.expr),this.CONSUME(rE)}}])})}const Lo=new Tj;if(ZI){const t=Lo.getGAstProductions(),e=H3(t);console.info(e)}const Sj=Lo.getBaseCstVisitorConstructor();var Ne=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(Ne||{}),Fs=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Fs||{}),ci=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(ci||{}),yu=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(yu||{});function Wt(t,e){const[r]=t??[];return(r?.image??e).trimStart().replaceAll(/^"|"$/g,"")}class Rj extends Sj{unique=0;constructor(){super(),Xn&&this.validateVisitor()}visit(e){if(ut(e)&&(e=e[0]),!!w(e))return this[e.name](e.children,e.location)}createcodenode(e,r){return[{...r,...e,lineindex:0}]}createstringnode(e,r){return this.createcodenode(e,{type:12,literal:1,value:r})}createtemplatenode(e,r){return this.createcodenode(e,{type:12,literal:2,value:r})}createmarknode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:3,id:r,comment:n}))}creategotonode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:4,id:r,comment:n}))}createlinenode(e,r){return this.createcodenode(e,{type:2,stmts:r})}createapinode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:1,words:n,method:r}))}createlogicnode(e,r,n,i){return this.createlinenode(e,this.createcodenode(e,{type:14,skip:n,words:i,method:r}))}createcountnode(e){return this.createcodenode(e,{type:5,index:this.unique++})}createexprnodeondemand(e,r){return e.length===1?e[0]:this.createcodenode(r,{type:31,words:e})[0]}go(e){return Array.isArray(e)?e.map(r=>this.visit(r)).flat():w(e)?[this.visit(e)].flat():[]}program(e,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(e.line)].flat()})}line(e){return e.stmt?this.go(e.stmt):[]}stmt(e){return e.stmt_label?this.go(e.stmt_label):e.stmt_stat?this.go(e.stmt_stat):e.stmt_text?this.go(e.stmt_text):e.stmt_comment?this.go(e.stmt_comment):e.stmt_hyperlink?this.go(e.stmt_hyperlink):e.stmt_command?this.go(e.stmt_command):e.short_go?this.go(e.short_go):e.short_try?this.go(e.short_try):[]}inline_go(e){const r=[];return e.short_go&&r.push(...this.go(e.short_go)),e.inline&&r.push(...this.go(e.inline)),r}inline_try(e){const r=[];return e.short_try&&r.push(...this.go(e.short_try)),e.inline&&r.push(...this.go(e.inline)),r}inline_command(e){const r=[];return e.stmt_command&&r.push(...this.go(e.stmt_command)),e.inline&&r.push(...this.go(e.inline)),r}inline(e){const r=[];return e.stmt_stat&&r.push(...this.go(e.stmt_stat)),e.stmt_text&&r.push(...this.go(e.stmt_text)),e.stmt_comment&&r.push(...this.go(e.stmt_comment)),e.stmt_hyperlink&&r.push(...this.go(e.stmt_hyperlink)),e.inline_go&&r.push(...this.go(e.inline_go)),e.inline_try&&r.push(...this.go(e.inline_try)),e.inline_command&&r.push(...this.go(e.inline_command)),e.structured_cmd&&r.push(...this.go(e.structured_cmd)),r}stmt_label(e,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Wt(e.token_label,":").slice(1).trim()}))}stmt_stat(e,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Wt(e.token_stat,"@").slice(1)}))}stmt_text(e,r){const n=Wt(e.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:n}))}stmt_comment(e,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Wt(e.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(e,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:Wt(e.token_hyperlink,"!").slice(1),text:Wt(e.token_hyperlinktext,";").slice(1)}))}stmt_command(e,r){return e.structured_cmd?this.go(e.structured_cmd):this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(e.words)}))}structured_cmd(e){return e.command_if?this.go(e.command_if):e.command_while?this.go(e.command_while):e.command_repeat?this.go(e.command_repeat):e.command_waitfor?this.go(e.command_waitfor):e.command_foreach?this.go(e.command_foreach):e.command_break?this.go(e.command_break):e.command_continue?this.go(e.command_continue):[]}short_go(e,r){return e.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}short_try(e,r){return e.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}command_if(e,r){const[n]=this.createlogicnode(r,Wt(e.token_if,"if").toLowerCase(),"",this.go(e.words)),[i]=this.go(e.command_if_block)??[];return this.createcodenode(r,{type:13,check:n,block:i})}command_if_block(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:15,skip:n,done:i,lines:[this.go(e.inline),this.go(e.line),this.creategotonode(r,i,"end of if"),this.createmarknode(r,n,"alt logic")].flat(),altlines:[this.go(e.command_else_if),this.go(e.command_else),this.createmarknode(r,i,"end of if")].flat()})}command_block(e){return[this.go(e.inline),this.go(e.line)].flat()}command_fork(e){return[this.go(e.inline),this.go(e.line)].flat()}command_else_if(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:16,done:i,lines:[this.createlogicnode(r,Wt(e.token_if,"if"),n,this.go(e.words)),this.go(e.command_fork),this.creategotonode(r,i,"end of if"),this.createmarknode(r,n,"skip")].flat()})}command_else(e,r){const n=[];return e.words&&n.push(...this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(e.words)}))),e.command_fork&&n.push(...this.go(e.command_fork)),this.createcodenode(r,{type:17,lines:n})}command_while(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:18,loop:n,done:i,lines:[this.createmarknode(r,n,"start of while"),this.createlogicnode(r,"if",i,this.go(e.words)),this.go(e.command_block),this.creategotonode(r,n,"loop of while"),this.createmarknode(r,i,"end of while")].flat()})}command_repeat(e,r){const n=Ft(),i=Ft(),o=[this.createcountnode(r),this.go(e.words)].flat();return this.createcodenode(r,{type:21,loop:n,done:i,lines:[this.createapinode(r,"repeatstart",o),this.createmarknode(r,n,"start of repeat"),this.createlogicnode(r,"repeat",i,o),this.go(e.command_block),this.creategotonode(r,n,"loop of repeat"),this.createmarknode(r,i,"end of repeat")].flat()})}command_foreach(e,r){const n=Ft(),i=Ft(),o=[this.createcountnode(r),this.go(e.words)].flat();return this.createcodenode(r,{type:23,loop:n,done:i,lines:[this.createapinode(r,"foreachstart",o),this.createmarknode(r,n,"start of foreach"),this.createlogicnode(r,"foreach",i,o),this.go(e.command_block),this.creategotonode(r,n,"loop of foreach"),this.createmarknode(r,i,"end of foreach")].flat()})}command_waitfor(e,r){const n=Ft();return this.createcodenode(r,{type:22,loop:n,lines:[this.createmarknode(r,n,"start of waitfor"),this.createlogicnode(r,"waitfor",n,this.go(e.words))].flat()})}command_break(e,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(e,r){return this.createcodenode(r,{type:20,goto:0})}command_play(e,r){const n=Wt(e.token_command_play,"").trim(),[i,...s]=n.split(" ");return[this.createstringnode(r,i),this.createstringnode(r,s.join(" "))].flat()}command_toast(e,r){const i=Wt(e.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(r,"toast"),this.createtemplatenode(r,i)].flat()}command_ticker(e,r){const i=Wt(e.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(r,"ticker"),this.createtemplatenode(r,i)].flat()}expr(e,r){return e.RHS?this.createcodenode(r,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}and_test(e,r){return e.RHS?this.createcodenode(r,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}not_test(e,r){return e.comparison?this.go(e.comparison):e.LHS?this.createcodenode(r,{type:26,items:this.go(e.LHS)}):[]}comparison(e,r){if(e.RHS){const[n]=this.go(e.comp_op);return this.createcodenode(r,{type:27,compare:n,lhs:this.createexprnodeondemand(this.go(e.LHS),r),rhs:this.createexprnodeondemand(this.go(e.RHS),r)})}return this.go(e.LHS)}comp_op(e,r){return e.token_iseq?this.createcodenode(r,{type:28,method:0}):e.token_isnoteq?this.createcodenode(r,{type:28,method:1}):e.token_islessthan?this.createcodenode(r,{type:28,method:2}):e.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):e.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):e.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(e,r){return e.RHS?this.createcodenode(r,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}and_test_value(e,r){return e.RHS?this.createcodenode(r,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}not_test_value(e,r){return e.arith_expr?this.go(e.arith_expr):e.LHS?this.createcodenode(r,{type:26,items:this.go(e.LHS)}):[]}arith_expr(e,r){if(e.LHS)return this.go(e.LHS);const n=this.go(e.term);return e.RHS?this.createcodenode(r,{type:29,lhs:n[0],items:this.go(e.RHS)}):n}arith_expr_item(e,r){return this.createcodenode(r,{type:30,operator:e.token_plus?1:2,rhs:this.go(e.term)[0]})}term(e,r){return e.term_item?this.createcodenode(r,{type:29,lhs:this.go(e.factor)[0],items:this.go(e.term_item)}):this.go(e.factor)}term_item(e,r){let n=0;return e.token_multiply&&(n=4),e.token_divide&&(n=5),e.token_moddivide&&(n=6),e.token_floordivide&&(n=7),this.createcodenode(r,{type:30,operator:n,rhs:this.go(e.factor)[0]})}factor(e,r){if(e.power)return this.go(e.power);let n=0;return e.token_plus&&(n=8),e.token_minus&&(n=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:n,rhs:this.go(e.LHS)[0]})})}power(e,r){const n=this.go(e.token);return e.factor?this.createcodenode(r,{type:29,lhs:n[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(e.factor)[0]})}):n}words(e){return this.go(e.expr)}kind(e){return[this.go(e.color),this.go(e.string_token)].flat()}category(e,r){return e.token_isterrain?this.createcodenode(r,{type:12,literal:1,value:"isterrain"}):e.token_isobject?this.createcodenode(r,{type:12,literal:1,value:"isobject"}):[]}collision(e,r){return e.token_iswalkable?this.createcodenode(r,{type:12,literal:1,value:"iswalkable"}):e.token_iswalking?this.createcodenode(r,{type:12,literal:1,value:"iswalking"}):e.token_iswalk?this.createcodenode(r,{type:12,literal:1,value:"iswalk"}):e.token_isswimmable?this.createcodenode(r,{type:12,literal:1,value:"isswimmable"}):e.token_isswimming?this.createcodenode(r,{type:12,literal:1,value:"isswimming"}):e.token_isswim?this.createcodenode(r,{type:12,literal:1,value:"isswim"}):e.token_issolid?this.createcodenode(r,{type:12,literal:1,value:"issolid"}):e.token_isbullet?this.createcodenode(r,{type:12,literal:1,value:"isbullet"}):e.token_isghost?this.createcodenode(r,{type:12,literal:1,value:"isghost"}):[]}color(e,r){let n="ERROR";return e.token_black&&(n="black"),e.token_dkblue&&(n="dkblue"),e.token_dkgreen&&(n="dkgreen"),e.token_dkcyan&&(n="dkcyan"),e.token_dkred&&(n="dkred"),e.token_dkpurple&&(n="dkpurple"),e.token_dkyellow&&(n="dkyellow"),e.token_ltgray&&(n="ltgray"),e.token_dkgray&&(n="dkgray"),e.token_blue&&(n="blue"),e.token_green&&(n="green"),e.token_cyan&&(n="cyan"),e.token_red&&(n="red"),e.token_purple&&(n="purple"),e.token_yellow&&(n="yellow"),e.token_white&&(n="white"),e.token_brown&&(n="brown"),e.token_dkwhite&&(n="dkwhite"),e.token_ltgrey&&(n="ltgrey"),e.token_gray&&(n="gray"),e.token_grey&&(n="grey"),e.token_dkgrey&&(n="dkgrey"),e.token_ltblack&&(n="ltblack"),e.token_onblack&&(n="onblack"),e.token_ondkblue&&(n="ondkblue"),e.token_ondkgreen&&(n="ondkgreen"),e.token_ondkcyan&&(n="ondkcyan"),e.token_ondkred&&(n="ondkred"),e.token_ondkpurple&&(n="ondkpurple"),e.token_ondkyellow&&(n="ondkyellow"),e.token_onltgray&&(n="onltgray"),e.token_ondkgray&&(n="ondkgray"),e.token_onblue&&(n="onblue"),e.token_ongreen&&(n="ongreen"),e.token_oncyan&&(n="oncyan"),e.token_onred&&(n="onred"),e.token_onpurple&&(n="onpurple"),e.token_onyellow&&(n="onyellow"),e.token_onwhite&&(n="onwhite"),e.token_onbrown&&(n="onbrown"),e.token_ondkwhite&&(n="ondkwhite"),e.token_onltgrey&&(n="onltgrey"),e.token_ongray&&(n="ongray"),e.token_ongrey&&(n="ongrey"),e.token_ondkgrey&&(n="ondkgrey"),e.token_onltblack&&(n="onltblack"),e.token_onclear&&(n="onclear"),this.createcodenode(r,{type:12,literal:1,value:n})}dir_mod(e,r){if(e.dir_within)return this.go(e.dir_within);if(e.dir_awayby)return this.go(e.dir_awayby);let n="ERROR";return e.token_cw&&(n="cw"),e.token_ccw&&(n="ccw"),e.token_opp&&(n="opp"),e.token_rndp&&(n="rndp"),e.token_over&&(n="over"),e.token_under&&(n="under"),this.createcodenode(r,{type:12,literal:1,value:n})}dir_by(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"by"}),...this.go(e.simple_token)]}dir_at(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"at"}),...this.go(e.simple_token)]}dir_away(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"away"}),...this.go(e.simple_token)]}dir_toward(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"toward"}),...this.go(e.simple_token)]}dir_find(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"find"}),...this.go(e.kind)]}dir_flee(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"flee"}),...this.go(e.kind)]}dir_to(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"to"}),...this.go(e.dir)]}dir_within(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"within"}),...this.go(e.simple_token)]}dir_awayby(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"awayby"}),...this.go(e.simple_token)]}dir(e,r){const n=this.go(e.dir_mod)??[];return e.token_i&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"i"})),e.token_idle&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"idle"})),e.token_n&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"n"})),e.token_u&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"u"})),e.token_north&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"north"})),e.token_up&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"up"})),e.token_s&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"s"})),e.token_d&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"d"})),e.token_south&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"south"})),e.token_down&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"down"})),e.token_w&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"w"})),e.token_l&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"l"})),e.token_west&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"west"})),e.token_left&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"left"})),e.token_e&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"e"})),e.token_r&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"r"})),e.token_east&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"east"})),e.token_right&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"right"})),e.token_rnd&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rnd"})),e.token_rndne&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rndne"})),e.token_rndns&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rndns"})),e.token_flow&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"flow"})),e.token_seek&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"seek"})),e.dir_by&&n.push(...this.go(e.dir_by)),e.dir_at&&n.push(...this.go(e.dir_at)),e.dir_away&&n.push(...this.go(e.dir_away)),e.dir_toward&&n.push(...this.go(e.dir_toward)),e.dir_find&&n.push(...this.go(e.dir_find)),e.dir_flee&&n.push(...this.go(e.dir_flee)),e.dir_to&&n.push(...this.go(e.dir_to)),n.flat()}expr_any(e){return[this.go(e.dir),this.go(e.kind),this.go(e.color)].flat()}token_expr_any(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"any"}),this.go(e.expr_any)].flat()}token_expr_count(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"countof"}),this.go(e.expr_any)].flat()}token_expr_blocked(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"blocked"}),this.go(e.dir)].flat()}token_expr_abs(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"abs"}),...this.go(e.simple_token)]}token_expr_intceil(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intceil"}),...this.go(e.simple_token)]}token_expr_intfloor(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intfloor"}),...this.go(e.simple_token)]}token_expr_intround(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intround"}),...this.go(e.simple_token)]}token_expr_clamp(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"clamp"}),...this.go(e.simple_token)]}token_expr_min(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"min"}),...this.go(e.simple_token)]}token_expr_max(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"max"}),...this.go(e.simple_token)]}token_expr_pick(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pick"}),...this.go(e.simple_token)]}token_expr_pickwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pickwith"}),...this.go(e.simple_token)]}token_expr_random(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"random"}),...this.go(e.simple_token)]}token_expr_randomwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"randomwith"}),...this.go(e.simple_token)]}token_expr_run(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"run"}),...this.go(e.string_token)]}token_expr_runwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"runwith"}),...this.go(e.simple_token),...this.go(e.string_token)]}token_expr(e,r){return e.token_expr_aligned?this.createcodenode(r,{type:12,literal:1,value:"aligned"}):e.token_contact?this.createcodenode(r,{type:12,literal:1,value:"contact"}):e.token_expr_any?this.go(e.token_expr_any):e.token_expr_count?this.go(e.token_expr_count):e.token_expr_blocked?this.go(e.token_expr_blocked):e.token_expr_abs?this.go(e.token_expr_abs):e.token_expr_intceil?this.go(e.token_expr_intceil):e.token_expr_intfloor?this.go(e.token_expr_intfloor):e.token_expr_intround?this.go(e.token_expr_intround):e.token_expr_clamp?this.go(e.token_expr_clamp):e.token_expr_min?this.go(e.token_expr_min):e.token_expr_max?this.go(e.token_expr_max):e.token_expr_pick?this.go(e.token_expr_pick):e.token_expr_pickwith?this.go(e.token_expr_pickwith):e.token_expr_random?this.go(e.token_expr_random):e.token_expr_randomwith?this.go(e.token_expr_randomwith):e.token_expr_run?this.go(e.token_expr_run):e.token_expr_runwith?this.go(e.token_expr_runwith):[]}string_token(e,r){if(e.token_stringliteraldouble){const n=Wt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Wt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}return[]}simple_token(e,r){if(e.token_stringliteraldouble){const n=Wt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Wt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_numberliteral){const n=parseFloat(Wt(e.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:n})}return e.color?this.go(e.color):[]}token(e,r){if(e.category)return this.go(e.category);if(e.collision)return this.go(e.collision);if(e.color)return this.go(e.color);if(e.dir)return this.go(e.dir);if(e.command_play)return this.go(e.command_play);if(e.command_toast)return this.go(e.command_toast);if(e.command_ticker)return this.go(e.command_ticker);if(e.token_label){const n=Wt(e.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_stringliteraldouble){const n=Wt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Wt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_numberliteral){const n=parseFloat(Wt(e.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:n})}if(e.token_lparen)return[this.createexprnodeondemand(this.go(e.expr),r)];if(e.token_stop){const n=Wt(e.token_stop,"");return this.createcodenode(r,{type:12,literal:1,value:n})}return[]}}const Oj=new Rj,Gr={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},_u="zss.js";function ct(t,e){return new xj.SourceNode(t.startLine??1,t.startColumn??1,_u,e)}function _0(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function bu(t){return`'${_0(t)}'`}function b0(t){const e=Yd(t);return e.errors.length?t:`['${e.tokens.map(n=>{if(n.tokenType===Kd){const i=_0(n.image.substring(1));return Be(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return _0(n.image)}).join("")}'].join('')`}function Ja(t){return t.filter(e=>e!==void 0).map(ht)}function zx(t){return ct(t,"")}function Ij(t,e){const r=[];return t.forEach(n=>{r.push(n,e)}),r.pop(),r}function tr(t,e,r){return ct(t,[`api.${e}(`,...Ij(r,", "),")"])}function Nj(t){if(t.type===Ne.COMPARE&&t.compare.type===Ne.COMPARE_ITEM)switch(t.compare.method){case Fs.IS_EQ:return tr(t,"isEq",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_NOT_EQ:return tr(t,"isNotEq",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_LESS_THAN:return tr(t,"isLessThan",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_GREATER_THAN:return tr(t,"isGreaterThan",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_LESS_THAN_OR_EQ:return tr(t,"isLessThanOrEq",[ht(t.lhs),ht(t.rhs)]);case Fs.IS_GREATER_THAN_OR_EQ:return tr(t,"isGreaterThanOrEq",[ht(t.lhs),ht(t.rhs)])}return ct(t,"")}function Ps(t,e,r){return t.prepend(`api.${e}(`),t.add([", ",ht(r),")"])}function Wx(t,e,r){return t.prepend(`api.${e}(`),t.add([ht(r),")"])}function Cj(t,e){if(t.type===Ne.OPERATOR_ITEM)switch(t.operator){case ci.PLUS:return Ps(e,"opPlus",t.rhs);case ci.MINUS:return Ps(e,"opMinus",t.rhs);case ci.POWER:return Ps(e,"opPower",t.rhs);case ci.MULTIPLY:return Ps(e,"opMultiply",t.rhs);case ci.DIVIDE:return Ps(e,"opDivide",t.rhs);case ci.MOD_DIVIDE:return Ps(e,"opModDivide",t.rhs);case ci.FLOOR_DIVIDE:return Ps(e,"opFloorDivide",t.rhs);case ci.UNI_PLUS:return Wx(e,"opUniPlus",t.rhs);case ci.UNI_MINUS:return Wx(e,"opUniMinus",t.rhs)}return ct(t,"")}function Lj(t){if(t.type===Ne.OPERATOR){const e=t.lhs?ht(t.lhs):ct(t,"");return t.items.forEach(r=>Cj(r,e)),e}return ct(t,"")}function wu(t,e){return ct(t,[tr(t,"jump",[`${e}`]),"; continue;"])}function Ii(t){return Gr.linelookup[t??""]??-1}function w0(t,e){Gr.linelookup[t]=e}function Mo(t,e,r){for(let n=0;n<t.length;++n){const i=t[n];switch(i.type){case Ne.WHILE:case Ne.REPEAT:case Ne.FOREACH:case Ne.ELSE_IF:i.type===e&&(i.done=r);break;case Ne.IF_BLOCK:case Ne.IF_CHECK:i.type===e&&(i.skip=r);break;case Ne.LINE:Mo(i.stmts,e,r);break}}}function Hx(t,e,r){for(let n=0;n<t.length;++n){const i=t[n];switch(i.type){case Ne.WHILE:case Ne.REPEAT:case Ne.FOREACH:case Ne.ELSE_IF:i.type===e&&w0(i.done,r);break;case Ne.IF_BLOCK:case Ne.IF_CHECK:i.type===e&&w0(i.skip,r);break;case Ne.LINE:Hx(i.stmts,e,r);break}}}function ht(t){switch(t.type){case Ne.PROGRAM:return ct(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(ht).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${_u}`]);case Ne.API:return ct(t,["  ",tr(t,t.method,Ja(t.words)),`;
`]);case Ne.LINE:return ct(t,[`case ${t.lineindex}:
`,...t.stmts.map(ht).flat(),`  break;
`]);case Ne.MARK:return ct(t,`  // ${t.comment}
`);case Ne.GOTO:{const e=Ii(t.id);return ct(t,["  ",wu(t,e),`
`])}case Ne.COUNT:return ct(t,`${t.index}`);case Ne.LITERAL:switch(t.literal){case yu.NUMBER:return ct(t,`${t.value}`);case yu.STRING:return ct(t,bu(t.value));case yu.TEMPLATE:return ct(t,b0(t.value))}return zx(t);case Ne.TEXT:return ct(t,["  ",tr(t,"text",[b0(t.value)]),`;
`]);case Ne.STAT:if(Gr.isfirststat){Gr.isfirststat=!1;const e=t.value.trim().split(" ").map(bu);return ct(t,["  ",tr(t,"stat",e),`;
`])}return ct(t,`  // skipped ${t.value}
`);case Ne.LABEL:{const e=Be(t.name),r=t.active?"label":"comment";Gr.labels[e]||(Gr.labels[e]=[]);const n=(t.active?1:-1)*t.lineindex;return Gr.labels[e].push(n),ct(t,`  // ${n} '${e}' ${r}
`)}case Ne.HYPERLINK:return ct(t,["  ",tr(t,"hyperlink",[b0(t.text),...t.link.split(" ").filter(e=>e.length>0).map(bu)]),`;
`]);case Ne.MOVE:{const e=tr(t,"command",[bu("go"),Ja(t.words)].flat());return t.wait?ct(t,["  if (",e,`) { continue; };
`]):ct(t,["  ",e,`;
`])}case Ne.COMMAND:return ct(t,["  if (",tr(t,"command",Ja(t.words)),`) { continue; };
`]);case Ne.IF:{const e=t.block?.type===Ne.IF_BLOCK?t.block:void 0;if(w(e)){Mo([t.check],Ne.IF_CHECK,e.skip);const r=ct(t,ht(t.check));return e.lines.forEach(n=>r.add(ht(n))),Hx(e.altlines,Ne.ELSE_IF,Ii(e.done)),e.altlines.forEach(n=>r.add(ht(n))),r}return ct(t,ht(t.check))}case Ne.IF_CHECK:{const e=Ii(t.skip);return e===-1?ct(t,["  ",tr(t,t.method,Ja(t.words)),`;
`]):ct(t,["  if (!",tr(t,t.method,Ja(t.words)),") { ",wu(t,e),` }
`])}case Ne.ELSE_IF:case Ne.ELSE:{const e=ct(t,"");return t.lines.forEach(r=>e.add(ht(r))),e}case Ne.WHILE:{const e=Ii(t.loop),r=Ii(t.done),n=ct(t,"");return Mo(t.lines,Ne.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ne.BREAK:i.goto=r;break;case Ne.CONTINUE:i.goto=e;break}n.add(ht(i))}),n}case Ne.REPEAT:{const e=Ii(t.loop),r=Ii(t.done),n=ct(t,"");return Mo(t.lines,Ne.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ne.BREAK:i.goto=r;break;case Ne.CONTINUE:i.goto=e;break}n.add(ht(i))}),n}case Ne.WAITFOR:{const e=ct(t,"");return Mo(t.lines,Ne.IF_CHECK,t.loop),t.lines.forEach(r=>{e.add(ht(r))}),e}case Ne.FOREACH:{const e=Ii(t.loop),r=Ii(t.done),n=ct(t,"");return Mo(t.lines,Ne.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ne.BREAK:i.goto=r;break;case Ne.CONTINUE:i.goto=e;break}n.add(ht(i))}),n}case Ne.BREAK:return ct(t,["  ",wu(t,t.goto),`
`]);case Ne.CONTINUE:return ct(t,["  ",wu(t,t.goto),`
`]);case Ne.OR:return tr(t,"or",t.items.map(ht));case Ne.AND:return tr(t,"and",t.items.map(ht));case Ne.NOT:return tr(t,"not",t.items.map(ht));case Ne.COMPARE:return Nj(t);case Ne.OPERATOR:return Lj(t);case Ne.EXPR:return tr(t,"expr",t.words.map(ht));default:return console.error("<unsupported node>",t.type,t),zx(t)}}function li(t){if(w(t))switch(t.type===Ne.LINE&&++Gr.lineindex,t.lineindex=Gr.lineindex,t.type){case Ne.PROGRAM:t.lines.forEach(li);break;case Ne.LINE:t.stmts.forEach(li);break;case Ne.MARK:w0(t.id,t.lineindex);break;case Ne.IF:li(t.check),li(t.block);break;case Ne.IF_BLOCK:t.lines.forEach(li),t.altlines.forEach(li);break;case Ne.ELSE_IF:t.lines.forEach(li);break;case Ne.ELSE:case Ne.WHILE:case Ne.REPEAT:case Ne.FOREACH:case Ne.WAITFOR:t.lines.forEach(li);break;case Ne.MOVE:case Ne.COMMAND:case Ne.IF_CHECK:t.words.forEach(li);break}}function Mj(t){Gr.labels={},Gr.internal=1,Gr.lineindex=0,Gr.isfirststat=!0,li(t)}function Uj(t){return Mj(t),{...ht(t).toStringWithSourceMap({file:`${_u}.map`}),...Gr}}function Gx(t){return ut(t)?t.length>0?1:0:t??0}function Fj(t){return`${t}_chip`}function Kx(t=""){return`vm:${t??""}`}function Pj(t,e,r){const n=Fj(t),i=Kr(n);let s;const o=xn(Object.entries(r.labels??{}));(!ut(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(r.errors?.length??0)!==0?1:0);function a(l,u){k.words=u;const h=O5(e,l);return w(h)?h(c,u):l!=="send"?a("shortsend",[l,...u]):0}const c={halt(){Jj(n)},id(){return t},set(l,u){const[h,d]=N5(e,c,l,u);if(h)return d},get(l){const[u,h]=I5(e,c,l);if(u)return h},tick(l){const u=Te(i.ps)?i.ps:0,h=u%l===0;if(i.ps=u+1,h===!1)return!1;C5(e,c);const d=c.shouldtick();if(d){i.lc=0,i.ys=0,k.get=c.get;try{s?.(c)||(i.es=1)}catch(f){mt(le,k.elementfocus,"crash",f.message),i.es=1}}return L5(e,c),d},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Te(i.lc)?++i.lc>ms.HALT_AT_COUNT:!0},haslabel(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const[h,d]=i.lb[u];if(h===l)return(d.find(m=>Te(m)&&m>0)??0)>0}return!1},hm(){if(ut(i.mg)&&ut(i.lb)){const[l]=i.mg;if(w(l))for(let u=0;u<i.lb.length;++u){const[h,d]=i.lb[u];if(h===l)return d.find(f=>Te(f)&&f>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.shouldhalt()},send(l,u,h,d){le.emit(l,`${Kx(u)}:${h}`,d)},lock(l){i.lk=l},unlock(){i.lk=""},message(l){i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l){const d=h[1].findIndex(f=>f>0);if(d>=0&&w(h[1])){h[1][d]*=-1;break}}}},restore(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l)for(let d=0;d<h[1].length;d++)h[1][d]=Math.abs(h[1][d])}},getcase(){i.ec=Te(i.ec)?i.ec:1;const l=c.hm();if(l&&ut(i.mg)){const[,u,h,d]=i.mg;c.set("sender",h),w(u)&&c.set("arg",u),d&&(c.set("player",d),k.elementfocus=d),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=Te(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const u=BI.parse(l),[h]=u.filter(d=>d.fileName===_u);return{line:h?.lineNumber??0,column:h?.columnNumber??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},command(...l){if(l.length===0)return 0;const[u,...h]=l;return a(Be(Ut(u)),h)},if(...l){const[u,h]=ue(l,0,[Z.ANY]),d=Gx(u);return d&&h<l.length&&c.command(...l.slice(h)),d?1:0},try(...l){const[,u]=ue(l,0,[Z.DIR]),h=c.command("go",...l);return h&&u<l.length&&c.command(...l.slice(u)),h?1:0},take(...l){const[u,h,d]=ue(l,0,[Z.NAME,Z.ANY]),f=Te(h),m=f?d:1,p=c.get(u),g=f?h:1;if(!Te(p))return m<l.length&&c.command(...l.slice(m)),1;const y=p-g;return y<0?(m<l.length&&c.command(...l.slice(m)),1):(c.set(u,y),0)},give(...l){const[u,h,d]=ue(l,0,[Z.NAME,Z.ANY]),f=Te(h),m=f?d:1,p=c.get(u),g=f?h:1,y=p===void 0?1:0;return y&&m<l.length&&c.command(...l.slice(m)),c.set(u,Ga(p,0)+g),y},duplicate(...l){return c.command("duplicate",...l)},repeatstart(l,...u){const[h,d]=ue(u,0,[Z.NUMBER]),f=`repeatcount${l}`,m=`repeatwords${l}`;i[f]=h,i[m]=d<u.length?u.slice(d):void 0},repeat(l){const u=`repeatcount${l}`,h=`repeatwords${l}`;if(!Te(i[u]))return 0;const d=i[u];i[u]=d-1;const f=d>0,m=i[h];return f&&ut(m)&&c.command(...m),f?1:0},foreachstart(l,...u){const[h,d,f,m]=ue(u,0,[Z.NAME,Z.NUMBER,Z.NUMBER,Z.MAYBE_NUMBER]);let p=Math.min(d,f),g=Math.max(d,f);const y=(m??0)||1;if(y<0){const b=p;p=g,g=b}return c.set(h,p-y),0},foreach(l,...u){const[h,d,f,m,p]=ue(u,0,[Z.NAME,Z.NUMBER,Z.NUMBER,Z.MAYBE_NUMBER]);let g=Math.min(d,f),y=Math.max(d,f);const b=(m??0)||1;if(b<0){const x=g;g=y,y=x}let A=c.get(h);!Te(A)||A<g||A>y?A=g:A+=b;const S=A<=y?1:0;return S&&(c.set(h,A),p<u.length&&c.command(...u.slice(p))),S},waitfor(...l){const[u]=ue(l,0,[Z.ANY]),h=Gx(u);return h||c.yield(),h?1:0},or(...l){let u=0;for(let h=0;h<l.length;){const[d,f]=ue(l,h,[Z.ANY]);if(u=d,u)break;h=f}return u},and(...l){let u=0;for(let h=0;h<l.length;){const[d,f]=ue(l,h,[Z.ANY]);if(u=d,!u)break;h=f}return u},not(...l){const[u]=ue(l,0,[Z.ANY]);return u?0:1},expr(...l){const[u]=ue(l,0,[Z.ANY]);return u},isEq(l,u){const[h]=ue([l],0,[Z.ANY]),[d]=ue([u],0,[Z.ANY]);return typeof h=="object"||typeof d=="object"?UT(h,d)?1:0:h===d?1:0},isNotEq(l,u){return this.isEq(l,u)?0:1},isLessThan(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return h<d?1:0},isGreaterThan(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return h>d?1:0},isLessThanOrEq(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return h<=d?1:0},isGreaterThanOrEq(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return h>=d?1:0},opPlus(l,u){const[h]=ue([l],0,[Z.ANY]),[d]=ue([u],0,[Z.ANY]);return h+d},opMinus(l,u){const[h]=ue([l],0,[Z.ANY]),[d]=ue([u],0,[Z.ANY]);return h-d},opPower(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return Math.pow(h,d)},opMultiply(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return h*d},opDivide(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return h/d},opModDivide(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return h%d},opFloorDivide(l,u){const[h]=ue([l],0,[Z.NUMBER]),[d]=ue([u],0,[Z.NUMBER]);return Math.floor(h/d)},opUniPlus(l){const[u]=ue([l],0,[Z.NUMBER]);return+u},opUniMinus(l){const[u]=ue([l],0,[Z.NUMBER]);return-u}};return s=r.code,c}function v0(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(r=>{if(r!=="parent"){const n=t[r];ut(n)?n.forEach(i=>{e.push(v0(i))}):e.push(v0(n))}}),t.range={start:Math.min(...e.filter(r=>r).map(r=>r?.start??0)),end:Math.max(...e.filter(r=>r).map(r=>r?.end??0))},t.range}function $j(t){const e=pE(`${t}
`);if(e.errors.length>0)return e;Lo.input=e.tokens;const r=Lo.program();if(Lo.errors.length>0)return{tokens:e.tokens,errors:Lo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[n]=Oj.go(r);return n?(v0(n),{tokens:e.tokens,cst:r,ast:n}):{tokens:e.tokens,cst:r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}function Bj(t,e){const r=`compile-${t}`;console.time(r);const n=$j(e);if(console.timeEnd(r),Fy&&console.info(e,n.errors),n.errors&&n.errors.length>0)return console.info(e,n.tokens,n.errors),n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=Uj(n.ast);if(i.code){Fy&&console.info(i.code);try{return{...n,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...n,...i,source:"",code:new Function("api"," ")}}function Dj(){const t={},e={};function r(i,s){const o=t[s];if(o)return o;const a=Bj(i,s);return t[s]=a,a}const n={ids(){return Object.keys(e)},isended(i){const s=e[i];return w(s)?s.isended():!0},halt(i){const s=e[i];return w(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=n.ids();for(let s=0;s<i.length;++s)n.isended(i[s])&&n.halt(i[s])},arg(i,s){const o=e[i];w(o)&&o.set("arg",s)},tick(i,s,o,a,c){let l=e[i];if(!w(e[i])){const u=r(a,c);if(l=e[i]=Pj(i,s,u),u.errors?.length){const[h]=u.errors,d=(h?.line??2)-1,f=c.replaceAll(`\r
`,"").split(`
`).map((A,S)=>[A,S]),m=f.slice(d-2,d);for(let A=0;A<m.length;++A){const[S,x]=m[A];mt(le,wr(),"build",`$grey${x+1} $grey${S}`)}const[p,g]=f[d]??[];if(ye(p)&&w(g)){const A=(h.column??1)-1,S=A+h.length,x=A<p.length?p:`${p}*`,F=x.substring(0,A),R=x.substring(A,S),P=x.substring(S);mt(le,wr(),"build",`$red${g+1} $grey${F}$red${R}$grey${P}`)}const y=f.slice(d+1,d+3);for(let A=0;A<y.length;++A){const[S,x]=y[A];mt(le,wr(),"build",`$grey${x+1} $grey${S}`)}const b=h.message.split(`
`).slice(0,4).join(" ");return mt(le,wr(),"build",b),!1}}return!!l?.tick(o)},once(i,s,o,a){const c=n.tick(i,s,1,o,a);return n.halt(i)&&c},message(i){const{target:s,path:o}=Fr(i.target),a=e[s];if(w(a)){const c={...i,target:o};a.message(c)}}};return n}const Ar=new ua,Cr={},vu={};function jj(t,e,r,n,i,s=0){const o=`tiles:${t}:${e}`;return w(Cr[o])||(Cr[o]=zI(t,e,r,n,i,s)),Cr[o]}function qx(t,e,r,n){const i=`sprites:${t}:${e}:${r}`,s=`sprite:${t}:${e}:${n}`;return w(vu[s])||(vu[s]=WI(t,e,r)),vu[s].id=i,vu[s]}function zj(t,e){const r=`sprites:${t}:${e}`;return w(Cr[r])||(Cr[r]=HI(t,e)),Cr[r]}function Wj(t,e,r,n,i=0){const s=`dither:${t}:${e}`;return w(Cr[s])||(Cr[s]=GI(t,e,r,n,i)),Cr[s]}function Eu(t,e,r,n){const i=`media:${t}:${e}`;w(Cr[i])||(Cr[i]=KI(t,e,r,n));const s=Cr[i];return s.mime=r,s.media=n,s}function Hj(t,e){const r=`control:${t}:${e}`;return w(Cr[r])||(Cr[r]=qI(t,e)),Cr[r]}const Yi=3;function Yx(t,e){const r=[],n=(t.x+.5)*ds,i=(t.y+.5)*ps,s=e.x*ds,o=e.y*ps,a=s-n,c=o-i;Ar.x=a-Yi,Ar.y=c-Yi,r.push(Ar.angle()),Ar.x=a+ds+Yi,Ar.y=c-Yi,r.push(Ar.angle()),Ar.x=a-Yi,Ar.y=c+ps+Yi,r.push(Ar.angle()),Ar.x=a+ds+Yi,Ar.y=c+ps+Yi,r.push(Ar.angle());const l=r.map(f=>Math.round(ky(f))),u=Math.min(...l),h=Math.max(...l);if(h-u>180){const f=l.filter(y=>y<180),m=l.filter(y=>y>180),p=Math.max(...f);return[Math.min(...m),p]}return[u,h]}function ku(t,e,r,n,i,s,o,a,c){const l={x:a,y:c},u=Ni(t,l);if(u===-1)return;Ar.x=a-i.x,Ar.y=Math.round((c-i.y)*1.333);const h=Ar.length();if(h>s)return;const d=Math.round(ky(Ar.angle()));let f=0;for(let A=0;A<r.length;++A){const[S,x,F]=r[A];S>x?(d>=S||d<=x)&&(f=Math.max(f,F)):d>=S&&d<=x&&(f=Math.max(f,F))}const m=s*.5;e[u]=Math.min(e[u],f+(h<m?0:(h-m)*o)),e[u]=Bt(e[u],0,1);const p=hr(t,t.lookup?.[u]??"");if(w(p)){const A=[...Yx(i,l),.25];n.push(A)}const g=t.terrain[u],y=vn(g),b=g?.collision??y?.collision;if(ec(We.ISBULLET,b)){const A=[...Yx(i,l),1];n.push(A)}}function E0(t,e,r,n,i,s){if(!w(r)||!w(r.terrain)||!w(r.objects))return[];const o=[];let a=e;const c=Me,l=rt,u=s?it.BLACK:it.ONCLEAR,h=jj(t,a++,"terrain",c,l,u);o.push(h);const d=a++,f=zj(t,d);f.sprites=[],o.push(f);const m=r.isdark?1:0,p=Wj(t,a++,c,l,m);o.push(p),p.alphas.fill(m);const g=Hj(t,a++);if(i){o.push(g);const{graphics:F,camera:R,facing:P}=Kr(t),W=r.graphics??F??"",D=r.camera??R??"",G=r.facing??P??"";if(ye(W)){const O=Be(W);switch(O){case"fpv":case"iso":case"flat":case"mode7":g.graphics=O;break;default:g.graphics="flat";break}}if(ye(D))switch(Be(D)){default:case"mid":g.viewscale=Zc.MID;break;case"near":g.viewscale=Zc.NEAR;break;case"far":g.viewscale=Zc.FAR;break}Te(G)&&(g.facing=Ey(G%360))}for(let F=0;F<r.terrain.length;++F){const R=r.terrain[F],P=er(R,0,it.WHITE,s?it.BLACK:it.ONCLEAR),W=He(R,"collision");h.char[F]=P.char,h.color[F]=P.color,h.bg[F]=P.bg,h.wall[F]=W===We.ISSOLID?1:0}const y=Object.values(r.objects??{}),b=new Set;for(let F=0;F<y.length;++F){const R=y[F];gr(R.id)&&Te(R.x)&&Te(R.y)&&b.add(Qr(R,Me))}for(let F=0;F<y.length;++F){const R=y[F],P=He(R,"collision");if(w(R.removed)||P===We.ISGHOST)continue;const W=R.id??"";if(gr(W)===!1&&Te(R.x)&&Te(R.y)&&b.has(Qr(R,Me))===!0)continue;const D=er(R),G=qx(t,d,W,F);if(G.x=R.x??0,G.y=R.y??0,G.char=D.char,G.color=D.color,G.bg=D.bg,f.sprites.push(G),m){if(D.light>0){const O=Ni(r,G),I=Bt(Math.round(D.light),1,rt),v=1/(I*.5);if(p.alphas[O]=0,I>1){const C=[];for(let z=1;z<=I;++z){if(z===2){const Y=He(R,"lightdir");if(tn(Y)){const N=$o(r,R,"",Y,G);switch(In(G,N.destpt)){case Ee.EAST:C.push([45,315,1]);break;case Ee.WEST:C.push([225,135,1]);break;case Ee.NORTH:C.push([315,225,1]);break;case Ee.SOUTH:C.push([135,45,1]);break}}}const $=[];for(let Y=G.y-z;Y<=G.y+z;++Y)ku(r,p.alphas,C,$,G,I,v,G.x-z,Y),ku(r,p.alphas,C,$,G,I,v,G.x+z,Y);const Q=z-1;for(let Y=G.x-Q;Y<=G.x+Q;++Y)ku(r,p.alphas,C,$,G,I,v,Y,G.y-z),ku(r,p.alphas,C,$,G,I,v,Y,G.y+z);for(let Y=0;Y<$.length;++Y){const N=$[Y];let M=0;for(M=0;M<C.length;++M){const U=C[M];if(U[1]>U[0]&&N[1]>=U[0]&&N[0]<=U[1]&&N[2]>=1&&U[2]>=1){C[M]=[Math.min(N[0],U[0]),Math.max(N[1],U[1]),1];break}}M===C.length&&C.push(N)}}}}else if(gr(W)){const O=Ni(r,G);p.alphas[O]=0}}W===t&&(g.focusx=G.x,g.focusy=G.y,g.focusid=W)}for(let F=0;F<y.length;++F){const R=y[F],P=He(R,"collision");if(w(R.removed)||P!==We.ISGHOST)continue;const W=R.id??"",D=er(R),G=qx(t,d,W,F);G.x=R.x??0,G.y=R.y??0,G.char=D.char,G.color=D.color,G.bg=D.bg,f.sprites.push(G)}for(let F=0;F<y.length;++F){const R=y[F];if(ye(R.tickertext)&&Te(R.tickertime)&&R.tickertext.length){const P=er(R),W=R.kind!=="player"?`${P.name}:$BLUE`:"",D=`$${it[P.color]}$ON${it[P.bg]}$${P.char}$ONCLEAR$WHITE ${W}${R.tickertext}`;n.push(D)}}o.push(Eu(t,a++,"text/mood",m?"dark":"bright"));const A=dt(Xe.MAIN),S=Ti(A,Xe.MAIN);if(ye(S.palette)){const F=ur(Re.PALETTE,S.palette),R=At(F);w(R?.bits)&&o.push(Eu(t,a++,"image/palette",Array.from(R.bits)))}if(ye(S.charset)){const F=ur(Re.CHARSET,S.charset),R=At(F);w(R?.bits)&&o.push(Eu(t,a++,"image/charset",Array.from(R.bits)))}const x=Object.keys(r.objects).filter(gr);return o.push(Eu(t,a++,"text/players",x.join(","))),o}const on=Dj();var Xe=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Xe||{});const kt={halt:!1,session:Ft(),operator:"",software:{main:"",content:""},books:new Map,loaders:new Map};function Gj(){return kt.session}function wr(){return kt.operator}function Kj(t){kt.operator=t}function qj(t){kt.halt=t}function Yj(){return kt.halt}function wn(){return[...kt.books.values()]}function Vj(){const[t]=kt.books.values();return t}function k0(){const t=wn(),e=dt("main"),[r]=t.filter(n=>n.id!==e?.id);return r??e}function $n(t){const e=Be(t);return kt.books.get(t)??wn().find(r=>r.name===e)}function Vx(t,e){w($n(e))&&(kt.software[t]=e)}function dt(t){return $n(kt.software[t])}function Xx(t){const e=$d([]);return ye(t)&&(e.name=t),xu(e),Pt(le,kt.operator,`created [book] ${e.name}`),e}function Xj(t){let e=$n(t);return w(e)||(e=$d([]),e.name=t),xu(e),Pt(le,kt.operator,`created [book] ${e.name}`),e}function lr(t,e){let r=w(e)?Xj(e):dt(t);return w(r)||(w(r)||(r=Vj()),w(r)||(r=Xx(e)),w(r)&&Pt(le,kt.operator,`opened [book] ${r.name} for ${t}`)),Vx(t,r.id),r}function Vi(t,e,r){return jd(lr(t),r,e)}function ur(t,e){const r=dt("main"),n=en(bE(r,t,e));if(w(n))return n;const i=wn();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==r?.id){const a=en(bE(o,t,e));if(w(a))return a}}}function vn(t){if(w(t?.kinddata))return t.kinddata;if(!ye(t?.kind)||!t.kind)return;const e=ur(Re.OBJECT,t.kind);if(w(e))return t.kinddata=At(e),t.kinddata;const r=ur(Re.TERRAIN,t.kind);if(w(r))return t.kinddata=At(r),t.kinddata}function He(t,e){const r=t?.kinddata,n=r?.id??"",i=t?.[e];if(w(i))return i;const s=r?.[e];if(w(s))return s;const o=ur(Re.OBJECT,n)??ur(Re.TERRAIN,n),a=rF(o,e);if(w(a))return a;switch(e){case"group":return"";case"cycle":return Tm;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return We.ISWALK;default:return}}function x0(t,e){const r={x:t?.x??-1,y:t?.y??-1},n={x:e?.x??-1,y:e?.y??-1},i=In(r,n),s=He(e,"pushable");return Te(s)?s!==0:ye(s)?s.trim().split(" ").map(o=>Sy(Wc(o))).some(o=>o===i):!1}function an(t,e,r,n){if(!w(t)||!w(e))return;const[i,s]=e,o=ur(Re.OBJECT,i);if(w(o)){const c=O0(t,r,i,n);if(w(c))return ba(c,s),vn(c),He(c,"collision")!==We.ISGHOST&&(xE(t,c),zd(t,c)),c}const a=ur(Re.TERRAIN,i);if(w(a)){const c=yz(t,r,i);if(w(c)){ba(c,s),vn(c);const l=Qr(r,Me);return zd(t,c,l),c}}}function Zj(t,e,r){if(!w(t)||!w(e))return;const[n,i]=e,s=ur(Re.OBJECT,n);if(w(s)){const o=O0(t,r,n);return ba(o,i),o}}function fr(t){const e=ur(Re.BOARD,t);return At(e)}function Kr(t){const e=lr("main");return Ti(e,t)}function Zx(t){const e=lr("main");return sF(e,t)}function Jx(){const t=lr("main");return Ti(t,"main")}function Jj(t){const e=lr("main");return EE(e,t)}function Qj(t,e){kt.books.clear(),t.forEach(n=>{kt.books.set(n.id,n),n.name==="main"&&(kt.software.main=n.id)});const r=$n(e);if(w(r)&&(kt.software.main=r.id),!kt.software.main){const n=kt.books.values().next();n.value&&(kt.software.main=n.value.id)}}function xu(t){return kt.books.set(t.id,t),t.id}function ez(t){const e=$n(t);e&&kt.books.delete(e.id)}function Qx(t){if(!ye(t)||!t)return mt(le,t,"login",`failed for playerid ==>${t}<==`);const e=dt("main");if(!w(e))return mt(le,t,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${t}<==`);let r=Ht(t);if(w(r?.objects[t]))return!0;if(!w(r)){const l=ur(Re.BOARD,"title");r=At(l)}if(!w(r))return mt(le,t,"login:title","login failed to find board with 'title' stat");const n=ur(Re.OBJECT,"player");if(!w(n))return mt(le,t,"login:player","login failed to find object type 'player'");const i=r.startx??0,s=r.starty??0,o=Te(i)?i:Math.round(Me*.5),a=Te(s)?s:Math.round(rt*.5),c=O0(r,{x:o,y:a},"player",t);return w(c?.id)?(c.player=t,nu(e,t,r.id),!0):!1}function tz(t){const e=dt("main");if(!w(e))return;const r=[];for(let i=0;i<e.activelist.length;++i){const s=e.activelist[i];s.startsWith(t)&&r.push(s)}const n=Ht(t);for(let i=0;i<r.length;++i){const s=r[i];nu(e,s,""),eu(n,hr(n,s)),fA(n,s),on.halt(s),EE(e,s)}}function Ht(t){const e=dt("main"),r=kE(e,t,"board"),n=ur(Re.BOARD,r);return At(n)}function rz(t){const e=dt("main"),r=dF(e,t),n=Ht(t),i=hr(n,t);return r&&w(i)}function nz(t){const e=dt("main"),r=Ao(e);for(let n=0;n<r.length;++n){const i=r[n],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;gr(c)&&(nu(e,c,i.id),w(t[c])||(t[c]=0))}}}function eA(t){on.message(t)}function Gt(t,e,r,n){if(ye(r.id))if(ye(e.id))xm(le,t,e.id,r.id,n);else{const i=`${Qr({x:e.x??0,y:e.y??0},Me)}`;xm(le,t,i,r.id,n)}}function iz(t,e,r,n){const i=r.id??"";if(n.x<0){const s=fr(e?.exitwest??"");w(s)&&xo(t,i,s.id,{x:Me-1,y:n.y})}else if(n.x>=Me){const s=fr(e?.exiteast??"");w(s)&&xo(t,i,s.id,{x:0,y:n.y})}else if(n.y<0){const s=fr(e?.exitnorth??"");w(s)&&xo(t,i,s.id,{x:n.x,y:rt-1})}else if(n.y>=rt){const s=fr(e?.exitsouth??"");w(s)&&xo(t,i,s.id,{x:n.x,y:0})}}function Bn(t,e,r,n){if(!w(r?.id))return!1;let i=AE(e,r,n);const s=He(r,"collision");if(w(i)&&s!==We.ISBULLET){const o=gr(r?.id),a=!!He(i,"item");if(x0(r,i)&&(!o||!a)){const l=In({x:r.x??0,y:r.y??0},n),u=Ct({x:i.x??0,y:i.y??0},l);Bn(t,e,i,u)}i=AE(e,r,n)}if(w(i)){const o=gr(r.id),a=gr(r.party??r.id),c=He(r,"collision")===We.ISBULLET,l=r.kind??"";let u="";r.party&&a&&(u=r.party),o&&(u=r.id);const h=gr(i.id),d=gr(i.party??i.id),f=He(i,"collision")===We.ISBULLET,m=i.kind??"",p=a===d;let g="";if(i.party&&d&&(g=i.party),h&&(g=i.id??""),o&&m==="edge")iz(t,e,r,n);else if(o)h?(Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"bump")):f?(Gt(p?"":g,i,r,p?"partyshot":"shot"),Gt(u,r,i,"thud")):(Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"touch"));else if(c)if(h)Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,p?"partyshot":"shot");else if(f)Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"thud");else switch(Gt(p?"":g,i,r,"thud"),m){case"object":case"scroll":Gt(p?"":u,r,i,"shot");break;default:Gt(p?"":u,r,i,p?"partyshot":"shot");break}else if(h)Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"bump");else if(f){switch(l){case"object":case"scroll":Gt(p?"":u,r,i,"shot");break;default:Gt(p?"":u,r,i,p?"partyshot":"shot");break}Gt(p?"":u,r,i,"thud")}else Gt(p?"":g,i,r,"thud"),Gt(p?"":u,r,i,"bump");if(c&&He(i,"breakable"))if(w(i?.id)){const y=nt(e,{x:i.x??-1,y:i.y??-1});w(y)&&dr(k.board,y,k.timestamp)}else St(e,{x:n.x,y:n.y});return!1}return!0}function tA(t,e,r,n){if(!w(t)||!w(e)||!w(r))return;const i={...k};k.book=t,k.board=e,k.element=r,k.elementid=r.id??"",k.elementisplayer=gr(k.elementid);const s=k.element.player??kt.operator;k.elementfocus=k.elementisplayer?k.elementid:s;const o=He(r,"cycle"),a=r.id??"",c=Be(r.name??r.kinddata?.name??"");if(on.tick(a,qi.RUNTIME,o,c,n),Te(r?.tickertime)&&k.timestamp-r.tickertime>fc*5&&(r.tickertime=0,r.tickertext=""),k.elementisplayer){const l=Kr(k.elementid);Te(l.inputcurrent)&&(l.inputcurrent=0)}Mr(i).forEach(l=>{k[l]=i[l]})}function sz(t,e){kt.loaders.set(t,e)}function oz(t){on.halt(t)}function az(){const t=on.ids();for(let r=0;r<t.length;++r)on.halt(t[r]);const e=dt("main");w(e)&&(e.flags={})}function cz(t=!1){const e=dt("main");if(!w(e))return;const r=e.timestamp+1,n=ms.HALT_AT_COUNT;ms.HALT_AT_COUNT=n*2,kt.loaders.forEach((s,o)=>{const a={...k};k.timestamp=e.timestamp,k.book=e,k.board=void 0,k.element=void 0,k.elementid=o,k.elementisplayer=!1,k.elementfocus=wr();const c=V4(o);w(c)&&on.arg(o,c),on.tick(o,qi.LOADER,1,"loader",s),on.isended(o)&&(on.halt(o),kt.loaders.delete(o)),Mr(a).forEach(l=>{k[l]=a[l]})}),ms.HALT_AT_COUNT=n,e.timestamp=r,k.timestamp=r;const i=Ao(e);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)vn(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];vn(o.objects[u])}const c=uF(o,r);for(let l=0;l<c.length;++l){const{id:u,type:h,code:d,object:f}=c[l];h===Re.ERROR?on.halt(u):(!t||gr(f?.id??""))&&tA(e,o,f,d)}}}function Uo(t,e,r,n){const i=dt("main");if(!w(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(w(c.id)){const l=`${Kx(c.id)}:${e}`;le.emit("",l,r)}}}if(hs(t)){for(let o=0;o<n.length;++o){const a=n[o],c=nt(a,t);w(c)&&s([c])}return}for(let o=0;o<n.length;++o){const a=n[o];switch(Be(t)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(sA(a,[t]));break}}}}function lz(t){const e=Kr(t),r=e.playbuffer=ye(e.playbuffer)?e.playbuffer:"";r&&rA(t,r,!1)}function rA(t,e,r=!0){const n=lr("main");if(!w(n))return;const i=`${t}_cli`;k.timestamp=n.timestamp,k.book=n,k.board=Ht(t),k.element=hr(k.board,t),k.elementid=k.element?.id??"",k.elementisplayer=!0,k.elementfocus=k.elementid||t;const s=ms.HALT_AT_COUNT;if(ms.HALT_AT_COUNT=s*8,on.once(i,qi.CLI,"cli",e),r){const o=Kr(t);o.playbuffer=e}ms.HALT_AT_COUNT=s}function Au(t){const e=lr("main"),r=Ts(e,t);if(!w(e)||!w(r)||!w(k.element))return;const n={...k},i=`${t}_run`,s=Be(k.element.name??k.element.kinddata?.name??""),o=r?.code??"";on.once(i,qi.RUNTIME,s,o),Mr(n).forEach(a=>{k[a]=n[a]})}function uz(t){const e=dt("main"),r=Ht(t),n=[],i=[],s=[],o=[];if(!w(e)||!w(r))return{board:"",over:n,under:i,layers:s,tickers:o};const a=r.graphics??"flat",c=fr(r.overboard??""),l=fr(r.underboard??"");return i.push(...E0(t,0,l,o,!1,!0)),s.push(...E0(t,i.length,r,o,!0,a!=="flat")),n.push(...E0(t,i.length+s.length,c,o,!1,!1)),{board:r.id,over:n,under:i,layers:s,tickers:o}}function $s(t){return ut(t)&&typeof t[0]=="string"}function fz(t){const e=k.words[t];return ye(e)?[e,t+1]:[void 0,t]}function A0(t){const e=k.words[t];if($s(e))return[e,t+1];const[r,n]=Kc(t),[i,s]=fz(n);return ye(i)&&(i==="empty"||vn({kind:i}))?[[i,r],s]:[void 0,t]}function Qa(t){if(!$s(t))return;const[e]=t;return e}function Tu(t){if(!$s(t))return;const[,e]=t,r=w(e)?Hc(e):void 0;return w(r)?r:void 0}function nA(t){if(!$s(t))return;const[,e]=t,r=w(e)?Gc(e):void 0;return w(r)?dh(r):void 0}function ec(t,e){const r=t??We.ISWALK,n=e??We.ISWALK;if(r===We.ISGHOST||n===We.ISGHOST)return!1;switch(r){case We.ISWALK:return n!==We.ISWALK;case We.ISSWIM:return n!==We.ISSWIM;case We.ISSOLID:return!0;case We.ISBULLET:return n!==We.ISWALK&&n!==We.ISSWIM}}function tc(t,e,r){const n=t?.objects[r];if(w(n))return n;const i=Fo(t,"player");return w(e)?(e.x<0&&(e.x=hn(0,Me-1)),e.y<0&&(e.y=hn(0,rt-1)),oA(e,i)):en(...i)}function Fo(t,e){const r=t?.named?.[e];return w(r)?[...r.values()].map(i=>typeof i=="string"?t?.objects[i]:t?.terrain[i]).filter(w):[]}function hz(t){const e=[];for(let r=0;r<rt;++r)for(let n=0;n<Me;++n){const i={x:n,y:r},s=nt(t,i);!s?.name&&!s?.kind&&e.push(i)}return e}function T0(t,e,r,n){if(!w(t))return!1;const i=er(t);return!(w(e)&&e!==i.name||w(r)&&r!==i.color||w(n)&&n!==i.bg)}function Su(t,e){const r=Qa(e),n=Tu(e),i=nA(e);return Fo(t,r??"").filter(s=>T0(s,r,n,i))}function iA(t,e){const r=w(e)?Hc(e):void 0,n=w(e)?Gc(e):void 0,i=[];if(w(t)){for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];w(a)&&T0(a,void 0,r,n)&&i.push(a)}const s=Object.values(t.objects);for(let o=0;o<s.length;++o){const a=s[o];T0(a,void 0,r,n)&&i.push(a)}}return i}function sA(t,e){return w(t)?e.map(r=>{if(typeof r=="string"){const n=t.objects[r];if(w(n))return n;const i=Fo(t,Be(r));if(i.length)return i}else if(hs(r)&&r.x>=0&&r.x<Me&&r.y>=0&&r.y<rt){const n=r.x+r.y*Me,i=t.lookup?.[n];return w(i)?t.objects[i]:t.terrain[n]}}).flat().filter(w):[]}function oA(t,e){let r=0,n;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(n===void 0||c<r)&&(r=c,n=s)}}return n}function dz(t,e,r,n){if(!w(t))return;w(t.distmaps)||(t.distmaps={});const i=`${e}.${r.x}.${r.y}.${n.x}.${n.y}`;let s=t.distmaps[i];if(!w(s)){s=new Array(ph).fill(-2);const o=[{...n}];let a=0;for(;o.length;){const c=o.shift();if(w(c)&&Po(c)){const l=Qr(c,Me);if(s[l]===-2){const u=Xi(t,c.x,c.y);ec(e,He(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}t.distmaps[i]=s}return s}function aA(t,e){return Po(t)?e[Qr(t,Me)]:-1}function cA(t,e,r,n,i){if(!w(t))return;const s=dz(t,e,r,n);if(!w(s))return;const o=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=aA(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=aA(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function pz(){return new Array(Me*rt).map(()=>{})}function Ru(t=cf){const e={terrain:pz(),objects:{},id:""};return t(e)}var S0=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(S0||{});function mz(t){return po(t,S0,{terrain:e=>e.map(il),objects:e=>Object.values(e).filter(r=>!r.removed).map(il),id:Tt,named:Tt,lookup:Tt,codepage:Tt,distmaps:Tt,overboard:Tt,underboard:Tt})}function gz(t){return _a(t,S0,{terrain:e=>e.map(sl),objects:e=>{const r={};for(let n=0;n<e.length;++n){const i=sl(e[n]);w(i?.id)&&(r[i.id]=i)}return r}})}function Po(t){return sh(t.x,t.y,0,Me-1,rt-1,0)}function Ni(t,e){return!w(t)||!w(e?.x)||!w(e?.y)||e.x<0||e.x>=Me||e.y<0||e.y>=rt?-1:e.x+e.y*Me}function nt(t,e){const r=Ni(t,e);if(r<0||!w(t?.lookup))return;const n=hr(t,t.lookup[r]??"");return w(n)?n:t.terrain[r]}function lA(t,e){const r=hr(t,e);if(w(r))return r;const n=parseFloat(e),i=bI(isNaN(n)?-1:n,Me);return Xi(t,i.x,i.y)}function Xi(t,e,r){return(e>=0&&e<Me)??(r>=0&&r<rt)?t?.terrain[e+r*Me]:void 0}function St(t,e){if(!w(t)||!w(e)||!w(e.x)||!w(e.y)||e.x<0||e.x>=Me||e.y<0||e.y>=rt)return;const r=xn(e),n=e.x+e.y*Me;return t.terrain[n]=r,delete t.distmaps,t.terrain[n]}function R0(t,e){if(!w(t)||!w(e))return;const r=xn(e);return r.id=r.id??Ft(),t.objects[r.id]=r,t.objects[r.id]}function yz(t,e,r){return St(t,{...e,kind:r})}function O0(t,e,r,n){return R0(t,{...e,kind:r,id:n})}function hr(t,e){if(t)return t.objects[e]}function uA(t,e){const r=Ni(t,e);if(r<0||!w(t?.lookup))return;const n=hr(t,t.lookup[r]??"");if(w(n))return n}function dr(t,e,r){return!w(e)||er(e).name==="player"?!1:(e.id?(e.removed=r,eu(t,e)):(St(t,{x:e?.x??0,y:e?.y??0}),aF(t,e)),!0)}function fA(t,e){return w(t?.objects[e])?(delete t.objects[e],!0):!1}function _z(t,e,r){if(!w(t)||!w(e))return;const n=t.objects[r];if(w(n))return n;if(hs(e))return oA(e,Fo(t,"player"))}function $o(t,e,r,n,i){const s=Ee.MID;if(!w(t)||!w(e))return{dir:n,startpt:i,destpt:i,layer:s,targets:[]};const o={x:e.x??0,y:e.y??0},a={x:o.x+(e.stepx??0),y:o.y+(e.stepy??0)},c=In(o,a),l=Me-1,u=rt-1;for(let h=0;h<n.length;++h){const d=Sy(n[h]);switch(d){case Ee.IDLE:break;case Ee.NORTH:case Ee.SOUTH:case Ee.WEST:case Ee.EAST:Ct(o,d);break;case Ee.BY:{const[f,m]=n.slice(h+1);Te(f)&&Te(m)&&(o.x=Bt(o.x+f,0,l),o.y=Bt(o.y+m,0,u)),h+=2;break}case Ee.TO:{const[f,m]=n.slice(h+1);Te(f)&&Te(m)&&(o.x=Bt(f,0,l),o.y=Bt(m,0,u)),h+=2;break}case Ee.AT:{const[f,m]=n.slice(h+1);Te(f)&&Te(m)&&(o.x=Bt(f,0,l),o.y=Bt(m,0,u)),h+=2;break}case Ee.FLOW:Ct(o,c);break;case Ee.SEEK:{const f=_z(t,e,r);hs(f)&&Ct(o,In(i,f));break}case Ee.RNDNS:Ct(o,en(Ee.NORTH,Ee.SOUTH));break;case Ee.RNDNE:Ct(o,en(Ee.NORTH,Ee.EAST));break;case Ee.RND:Ct(o,en(Ee.NORTH,Ee.SOUTH,Ee.WEST,Ee.EAST));break;case Ee.CW:case Ee.CCW:case Ee.OPP:case Ee.RNDP:{const f=$o(t,e,r,n.slice(h+1),i);switch(o.x=i.x,o.y=i.y,d){case Ee.CW:switch(In(i,f.destpt)){case Ee.NORTH:Ct(o,Ee.EAST);break;case Ee.SOUTH:Ct(o,Ee.WEST);break;case Ee.EAST:Ct(o,Ee.SOUTH);break;case Ee.WEST:Ct(o,Ee.NORTH);break}break;case Ee.CCW:switch(In(i,f.destpt)){case Ee.NORTH:Ct(o,Ee.WEST);break;case Ee.SOUTH:Ct(o,Ee.EAST);break;case Ee.EAST:Ct(o,Ee.NORTH);break;case Ee.WEST:Ct(o,Ee.SOUTH);break}break;case Ee.OPP:switch(In(i,f.destpt)){case Ee.NORTH:Ct(o,Ee.SOUTH);break;case Ee.SOUTH:Ct(o,Ee.NORTH);break;case Ee.EAST:Ct(o,Ee.WEST);break;case Ee.WEST:Ct(o,Ee.EAST);break}break;case Ee.RNDP:switch(In(i,f.destpt)){case Ee.NORTH:case Ee.SOUTH:o.x+=en(-1,1);break;case Ee.WEST:case Ee.EAST:o.y+=en(-1,1);break}break}return{dir:n,startpt:i,destpt:o,layer:s,targets:[]}}case Ee.FLEE:break;case Ee.AWAY:{const[f,m]=n.slice(h+1);if(Te(f)&&Te(m)){const p={x:Bt(f,0,l),y:Bt(m,0,u)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=He(e,"collision"),A=cA(t,b,o,p,!0);w(A)&&A.x!==f&&A.y!==m&&!uA(t,A)&&(o.x=A.x,o.y=A.y)}else{const b=fh(-g,-y);Ct(o,b)}}h+=2;break}case Ee.FIND:break;case Ee.TOWARD:{const[f,m]=n.slice(h+1);if(Te(f)&&Te(m)){const p={x:Bt(f,0,l),y:Bt(m,0,u)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=He(e,"collision"),A=cA(t,b,o,p,!1);w(A)&&A.x!==f&&A.y!==m&&!uA(t,A)&&(o.x=A.x,o.y=A.y)}else{const b=fh(g,y);Ct(o,b)}}h+=2;break}case Ee.OVER:case Ee.UNDER:{const f=$o(t,e,r,n.slice(h+1),i);return f.layer=d,f}case Ee.WITHIN:{const[f]=n.slice(h+1),m=$o(t,e,r,n.slice(h+2),i);if(m.targets.length===0&&Te(f)&&f>0)for(let p=-f;p<=f;++p)for(let g=-f;g<=f;++g){const y={x:m.destpt.x+g,y:m.destpt.y+p};Po(y)&&m.targets.push(y)}return Te(f)&&f>0?{...m,targets:m.targets.filter(p=>hs(p)?dy(p,m.destpt)<=f:!1)}:m}case Ee.AWAYBY:{const[f]=n.slice(h+1),m=$o(t,e,r,n.slice(h+2),i);if(m.targets.length===0)for(let p=-Me;p<=Me;++p)for(let g=-Me;g<=Me;++g){const y={x:m.destpt.x+g,y:m.destpt.y+p};Po(y)&&m.targets.push(y)}return Te(f)&&f>0?{...m,targets:m.targets.filter(p=>hs(p)?dy(p,m.destpt)>=f:!1)}:m}}}return{dir:n,startpt:i,destpt:o,layer:s,targets:[]}}const k={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var Z=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.COLOR_OR_KIND=7]="COLOR_OR_KIND",t[t.MAYBE_KIND=8]="MAYBE_KIND",t[t.MAYBE_NAME=9]="MAYBE_NAME",t[t.MAYBE_NUMBER=10]="MAYBE_NUMBER",t[t.MAYBE_STRING=11]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",t[t.ANY=13]="ANY",t))(Z||{});function pr(t,e,r){throw console.info(r,k.element,k.elementid,k.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function hA(t){const e={x:k.element?.x??0,y:k.element?.y??0};return $o(k.board,k.element,k.elementfocus,t,e)}function ue(t,e,r){const n=k.words;k.words=t;const i=[];let s=e;for(let o=0;o<r.length;++o)switch(r[o]){case 1:{const[a,c]=A0(s);$s(a)?(s=c,i.push(a)):pr("kind",a,t);break}case 0:{if(da(t[s])===void 0){const[a,c]=Nr(s);Tr(a)?(s=c,i.push(a)):Te(a)?(s=c,i.push(uo(a,void 0))):pr("color",a,t)}else{const[a,c]=Kc(s);Tr(a)?(s=c,i.push(a)):pr("color",a,t)}break}case 2:{if(Wc(t[s])===void 0){const[a,c]=Nr(s);tn(a)?(s=c,i.push(hA(a))):pr("direction",a,t)}else{const[a,c]=Oy(s);tn(a)?(s=c,i.push(hA(a))):pr("direction",a,t)}break}case 3:{const a=k.words[s];ye(a)||pr("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Nr(s);if(ye(a)){const l=parseFloat(a);Te(l)?i.push(l):pr("number",a,t)}else Te(a)?i.push(a):pr("number",a,t);s=c;break}case 5:{const[a,c]=Nr(s);ye(a)||pr("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Nr(s);let l=a;if(ye(l)){const u=parseFloat(l);Te(u)&&(l=u)}else Te(l)||pr("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=A0(s);if($s(a))s=c,i.push(a);else if(da(t[s])===void 0){const[l,u]=Nr(s);Tr(l)?(s=u,i.push(l)):pr("color",l,t)}else{const[l,u]=Kc(s);Tr(l)?(s=u,i.push(l)):pr("color or kind",l,t)}break}case 8:{const[a,c]=A0(s);a!==void 0&&!$s(a)&&pr("optional kind",a,t),s=c,i.push(a);break}case 9:{const a=k.words[s];a!==void 0&&!ye(a)&&pr("optional string",a,t),++s,i.push(a);break}case 10:{const[a,c]=Nr(s);if(ye(a)){const l=parseFloat(a);Te(l)?i.push(l):pr("optional number",a,t)}else Te(a)||a===void 0?i.push(a):pr("optional number",a,t);s=c;break}case 11:{const[a,c]=Nr(s);a!==void 0&&!ye(a)&&pr("optional string",a,t),s=c,i.push(a);break}case 12:{const[a,c]=Nr(s);let l=a;if(ye(l)){const u=parseFloat(l);Te(u)&&(l=u)}else l!==void 0&&!Te(l)&&pr("number or string",l,t);s=c,i.push(l);break}case 13:{const[a,c]=Nr(s);s=c,i.push(a);break}}return k.words=n,[...i,s]}const Ou={},Bo={};function I0(){return{id:Ft(),board:"",layers:[],scroll:[],sidebar:[]}}const bz=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),wz=new Set(["tx","text"]),vz={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},dA={};let pA=t=>{let e=dA[t];return w(e)||(dA[t]=e=I0()),e};function Ez(t){pA=t}function Rt(t){return pA(t)}function N0(t){return w(Ou[t])||(Ou[t]=[]),Ou[t]}function kz(t){const e=Rt(t);e.scrollname="",e.scroll=[]}function xz(t,e,r){Object.values(Bo).forEach(n=>{if(n[e]!==void 0){const i=Uy(t.id(),e);Te(r)&&gI(i,r),ye(r)&&yI(i,r)}})}function rr(t){const e=N0(t);return Ou[t]=[],e}function mA(t){const e=[];let r;for(let n=0;n<t.length;++n){const i=t[n],s=ye(i)&&w(EF(i));w(r)&&r!==s&&e.push(" "),e.push(i),r=s}return e}function Pe(t,e){N0(t).push(e)}function De(t,e,r,n,i=()=>0,s=cf){const o=[e,r,...n],a=Be(`${o[3]}`),c={...k};function l(u,h){w(h)&&h!==i(u)&&(k.board=c.board,k.element=c.element,k.elementfocus=c.elementfocus,s(u,h))}if(bz.has(a)){const u=`${o[2]}`;Bo[e]=Bo[e]??{};const h=i(u)??vz[a];if(Bo[e][u]===void 0){const d=Uy(e,u);Te(h)&&mI(d,h),ye(h)&&ih(d,h),wz.has(a)?Bo[e][u]=ly(d,f=>{l(u,f)}):Bo[e][u]=_I(d,f=>{l(u,f)})}}N0(t).push(o)}Ez(t=>{if(gr(t)){const e=dt(Xe.MAIN),r=Ti(e,Xe.GADGETSTORE);let n=r[t];return w(n)||(r[t]=n=I0()),n}return I0()});const C0=Ws("gadgetserver",["tock"],t=>{if(!C0.session(t))return;const e=dt(Xe.MAIN),r=[...e?.activelist??[],wr()],n=[...new Set(r.values())],i=Ti(e,Xe.GADGETSYNC);switch(t.target){case"tock":{for(let s=0;s<n.length;++s){const o=n[s],{board:a,over:c,under:l,layers:u,tickers:h}=uz(o),d=Rt(o);d.board=a,d.over=c,d.under=l,d.layers=u,d.tickers=h;const f=i[o]??{},m=ym(f,d);m.length&&(i[o]=xn(d),VT(C0,o,m))}break}case"desync":YT(C0,t.player,Rt(t.player));break;case"clearscroll":kz(t.player);break;case"clearplayer":{const s=Ti(e,Xe.GADGETSTORE);delete s[t.player];const o=Ti(e,Xe.GADGETSYNC);delete o[t.player];break}}});function Iu(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var L0={exports:{}},gA;function Az(){return gA||(gA=1,(function(t,e){(function(r){t.exports=r()})(function(){return(function r(n,i,s){function o(l,u){if(!i[l]){if(!n[l]){var h=typeof Iu=="function"&&Iu;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};n[l][0].call(f.exports,function(m){var p=n[l][1][m];return o(p||m)},f,f.exports,r,n,i,s)}return i[l].exports}for(var a=typeof Iu=="function"&&Iu,c=0;c<s.length;c++)o(s[c]);return o})({1:[function(r,n,i){var s=r("./utils"),o=r("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,f,m,p,g=[],y=0,b=c.length,A=b,S=s.getTypeOf(c)!=="string";y<c.length;)A=b-y,h=S?(l=c[y++],u=y<b?c[y++]:0,y<b?c[y++]:0):(l=c.charCodeAt(y++),u=y<b?c.charCodeAt(y++):0,y<b?c.charCodeAt(y++):0),d=l>>2,f=(3&l)<<4|u>>4,m=1<A?(15&u)<<2|h>>6:64,p=2<A?63&h:64,g.push(a.charAt(d)+a.charAt(f)+a.charAt(m)+a.charAt(p));return g.join("")},i.decode=function(c){var l,u,h,d,f,m,p=0,g=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|A):new Array(0|A);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(f=a.indexOf(c.charAt(p++)))>>2,h=(3&f)<<6|(m=a.indexOf(c.charAt(p++))),b[g++]=l,f!==64&&(b[g++]=u),m!==64&&(b[g++]=h);return b}},{"./support":30,"./utils":32}],2:[function(r,n,i){var s=r("./external"),o=r("./stream/DataWorker"),a=r("./stream/Crc32Probe"),c=r("./stream/DataLengthProbe");function l(u,h,d,f,m){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},n.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,i){var s=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,i){var s=r("./utils"),o=(function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c})();n.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(l,u,h,d){var f=o,m=d+h;l^=-1;for(var p=d;p<m;p++)l=l>>>8^f[255&(l^u[p])];return-1^l})(0|c,a,a.length,0):(function(l,u,h,d){var f=o,m=d+h;l^=-1;for(var p=d;p<m;p++)l=l>>>8^f[255&(l^u.charCodeAt(p))];return-1^l})(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(r,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,n,i){var s=null;s=typeof Promise<"u"?Promise:r("lie"),n.exports={Promise:s}},{lie:37}],7:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),a=r("./utils"),c=r("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,i){function s(f,m){var p,g="";for(p=0;p<m;p++)g+=String.fromCharCode(255&f),f>>>=8;return g}function o(f,m,p,g,y,b){var A,S,x=f.file,F=f.compression,R=b!==l.utf8encode,P=a.transformTo("string",b(x.name)),W=a.transformTo("string",l.utf8encode(x.name)),D=x.comment,G=a.transformTo("string",b(D)),O=a.transformTo("string",l.utf8encode(D)),I=W.length!==x.name.length,v=O.length!==D.length,C="",z="",$="",Q=x.dir,Y=x.date,N={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(N.crc32=f.crc32,N.compressedSize=f.compressedSize,N.uncompressedSize=f.uncompressedSize);var M=0;m&&(M|=8),R||!I&&!v||(M|=2048);var U=0,V=0;Q&&(U|=16),y==="UNIX"?(V=798,U|=(function(J,he){var xe=J;return J||(xe=he?16893:33204),(65535&xe)<<16})(x.unixPermissions,Q)):(V=20,U|=(function(J){return 63&(J||0)})(x.dosPermissions)),A=Y.getUTCHours(),A<<=6,A|=Y.getUTCMinutes(),A<<=5,A|=Y.getUTCSeconds()/2,S=Y.getUTCFullYear()-1980,S<<=4,S|=Y.getUTCMonth()+1,S<<=5,S|=Y.getUTCDate(),I&&(z=s(1,1)+s(u(P),4)+W,C+="up"+s(z.length,2)+z),v&&($=s(1,1)+s(u(G),4)+O,C+="uc"+s($.length,2)+$);var q="";return q+=`
\0`,q+=s(M,2),q+=F.magic,q+=s(A,2),q+=s(S,2),q+=s(N.crc32,4),q+=s(N.compressedSize,4),q+=s(N.uncompressedSize,4),q+=s(P.length,2),q+=s(C.length,2),{fileRecord:h.LOCAL_FILE_HEADER+q+P+C,dirRecord:h.CENTRAL_FILE_HEADER+s(V,2)+q+s(G.length,2)+"\0\0\0\0"+s(U,4)+s(g,4)+P+C+G}}var a=r("../utils"),c=r("../stream/GenericWorker"),l=r("../utf8"),u=r("../crc32"),h=r("../signature");function d(f,m,p,g){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var m=f.meta.percent||0,p=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-g-1))/p:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var p=o(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,p=o(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:(function(g){return h.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)})(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-f,g=(function(y,b,A,S,x){var F=a.transformTo("string",x(S));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(b,4)+s(A,4)+s(F.length,2)+F})(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(p){m.processChunk(p)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var m=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var p=0;p<m.length;p++)try{m[p].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},n.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,i){var s=r("../compressions"),o=r("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var m=(function(b,A){var S=b||A,x=s[S];if(!x)throw new Error(S+" is not a valid compression method !");return x})(f.options.compression,c.compression),p=f.options.compressionOptions||c.compressionOptions||{},g=f.dir,y=f.date;f._compressWorker(m,p).withStreamInfo("file",{name:d,dir:g,date:y,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=r("./object")).loadAsync=r("./load"),s.support=r("./support"),s.defaults=r("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=r("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,i){var s=r("./utils"),o=r("./external"),a=r("./utf8"),c=r("./zipEntries"),l=r("./stream/Crc32Probe"),u=r("./nodejsUtils");function h(d){return new o.Promise(function(f,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(g){m(g)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(d,f){var m=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(p){var g=new c(f);return g.load(p),g}).then(function(p){var g=[o.Promise.resolve(p)],y=p.files;if(f.checkCRC32)for(var b=0;b<y.length;b++)g.push(h(y[b]));return o.Promise.all(g)}).then(function(p){for(var g=p.shift(),y=g.files,b=0;b<y.length;b++){var A=y[b],S=A.fileNameStr,x=s.resolve(A.fileNameStr);m.file(x,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:f.createFolders}),A.dir||(m.file(x).unsafeOriginalName=S)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,i){var s=r("../utils"),o=r("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,i){var s=r("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}r("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,i){n.exports={isNode:typeof Vt<"u",newBufferFrom:function(s,o){if(Vt.from&&Vt.from!==Uint8Array.from)return Vt.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Vt(s,o)},allocBuffer:function(s){if(Vt.alloc)return Vt.alloc(s);var o=new Vt(s);return o.fill(0),o},isBuffer:function(s){return Vt.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(r,n,i){function s(x,F,R){var P,W=a.getTypeOf(F),D=a.extend(R||{},u);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(x=y(x)),D.createFolders&&(P=g(x))&&b.call(this,P,!0);var G=W==="string"&&D.binary===!1&&D.base64===!1;R&&R.binary!==void 0||(D.binary=!G),(F instanceof h&&F.uncompressedSize===0||D.dir||!F||F.length===0)&&(D.base64=!1,D.binary=!0,F="",D.compression="STORE",W="string");var O=null;O=F instanceof h||F instanceof c?F:m.isNode&&m.isStream(F)?new p(x,F):a.prepareContent(x,F,D.binary,D.optimizedBinaryString,D.base64);var I=new d(x,O,D);this.files[x]=I}var o=r("./utf8"),a=r("./utils"),c=r("./stream/GenericWorker"),l=r("./stream/StreamHelper"),u=r("./defaults"),h=r("./compressedObject"),d=r("./zipObject"),f=r("./generate"),m=r("./nodejsUtils"),p=r("./nodejs/NodejsStreamInputAdapter"),g=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var F=x.lastIndexOf("/");return 0<F?x.substring(0,F):""},y=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},b=function(x,F){return F=F!==void 0?F:u.createFolders,x=y(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:F}),this.files[x]};function A(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var F,R,P;for(F in this.files)P=this.files[F],(R=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&x(R,P)},filter:function(x){var F=[];return this.forEach(function(R,P){x(R,P)&&F.push(P)}),F},file:function(x,F,R){if(arguments.length!==1)return x=this.root+x,s.call(this,x,F,R),this;if(A(x)){var P=x;return this.filter(function(D,G){return!G.dir&&P.test(D)})}var W=this.files[this.root+x];return W&&!W.dir?W:null},folder:function(x){if(!x)return this;if(A(x))return this.filter(function(W,D){return D.dir&&x.test(W)});var F=this.root+x,R=b.call(this,F),P=this.clone();return P.root=R.name,P},remove:function(x){x=this.root+x;var F=this.files[x];if(F||(x.slice(-1)!=="/"&&(x+="/"),F=this.files[x]),F&&!F.dir)delete this.files[x];else for(var R=this.filter(function(W,D){return D.name.slice(0,x.length)===x}),P=0;P<R.length;P++)delete this.files[R[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var F,R={};try{if((R=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var P=R.comment||this.comment||"";F=f.generateWorker(this,R,P)}catch(W){(F=new c("error")).error(W)}return new l(F,R.type||"string",R.mimeType)},generateAsync:function(x,F){return this.generateInternalStream(x).accumulate(F)},generateNodeStream:function(x,F){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(F)}};n.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,i){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,i){var s=r("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(r,n,i){var s=r("./Uint8ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,i){var s=r("./ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,i){var s=r("../utils"),o=r("../support"),a=r("./ArrayReader"),c=r("./StringReader"),l=r("./NodeBufferReader"),u=r("./Uint8ArrayReader");n.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,i){var s=r("./GenericWorker"),o=r("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,i){var s=r("./GenericWorker"),o=r("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(r,n,i){var s=r("../utils"),o=r("./ConvertWorker"),a=r("./GenericWorker"),c=r("../base64"),l=r("../support"),u=r("../external"),h=null;if(l.nodestream)try{h=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(g,y){var b=[],A=m._internalType,S=m._outputType,x=m._mimeType;m.on("data",function(F,R){b.push(F),p&&p(R)}).on("error",function(F){b=[],y(F)}).on("end",function(){try{var F=(function(R,P,W){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",P),W);case"base64":return c.encode(P);default:return s.transformTo(R,P)}})(S,(function(R,P){var W,D=0,G=null,O=0;for(W=0;W<P.length;W++)O+=P[W].length;switch(R){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(G=new Uint8Array(O),W=0;W<P.length;W++)G.set(P[W],D),D+=P[W].length;return G;case"nodebuffer":return Vt.concat(P);default:throw new Error("concat : unsupported type '"+R+"'")}})(A,b),x);g(F)}catch(R){y(R)}b=[]}).resume()})}function f(m,p,g){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=g,s.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}f.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var g=this;return m==="data"?this._worker.on(m,function(y){p.call(g,y.data,y.meta)}):this._worker.on(m,function(){s.delay(p,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Vt<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,i){for(var s=r("./utils"),o=r("./support"),a=r("./nodejsUtils"),c=r("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):(function(m){var p,g,y,b,A,S=m.length,x=0;for(b=0;b<S;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<S&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),x+=g<128?1:g<2048?2:g<65536?3:4;for(p=o.uint8array?new Uint8Array(x):new Array(x),b=A=0;A<x;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<S&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),g<128?p[A++]=g:(g<2048?p[A++]=192|g>>>6:(g<65536?p[A++]=224|g>>>12:(p[A++]=240|g>>>18,p[A++]=128|g>>>12&63),p[A++]=128|g>>>6&63),p[A++]=128|63&g);return p})(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):(function(m){var p,g,y,b,A=m.length,S=new Array(2*A);for(p=g=0;p<A;)if((y=m[p++])<128)S[g++]=y;else if(4<(b=l[y]))S[g++]=65533,p+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&p<A;)y=y<<6|63&m[p++],b--;1<b?S[g++]=65533:y<65536?S[g++]=y:(y-=65536,S[g++]=55296|y>>10&1023,S[g++]=56320|1023&y)}return S.length!==g&&(S.subarray?S=S.subarray(0,g):S.length=g),s.applyFromCharCode(S)})(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var m=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=(function(b,A){var S;for((A=A||b.length)>b.length&&(A=b.length),S=A-1;0<=S&&(192&b[S])==128;)S--;return S<0||S===0?A:S+l[b[S]]>A?S:A})(m),y=m;g!==m.length&&(o.uint8array?(y=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(y=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:i.utf8decode(y),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,i){var s=r("./support"),o=r("./base64"),a=r("./nodejsUtils"),c=r("./external");function l(p){return p}function u(p,g){for(var y=0;y<p.length;++y)g[y]=255&p.charCodeAt(y);return g}r("setimmediate"),i.newBlob=function(p,g){i.checkSupport("blob");try{return new Blob([p],{type:g})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(p,g,y){var b=[],A=0,S=p.length;if(S<=y)return String.fromCharCode.apply(null,p);for(;A<S;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(A,Math.min(A+y,S)))):b.push(String.fromCharCode.apply(null,p.subarray(A,Math.min(A+y,S)))),A+=y;return b.join("")},stringifyByChar:function(p){for(var g="",y=0;y<p.length;y++)g+=String.fromCharCode(p[y]);return g},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function d(p){var g=65536,y=i.getTypeOf(p),b=!0;if(y==="uint8array"?b=h.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return h.stringifyByChunk(p,y,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(p)}function f(p,g){for(var y=0;y<p.length;y++)g[y]=p[y];return g}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,g){if(g=g||"",!p)return g;i.checkSupport(p);var y=i.getTypeOf(g);return m[y][p](g)},i.resolve=function(p){for(var g=p.split("/"),y=[],b=0;b<g.length;b++){var A=g[b];A==="."||A===""&&b!==0&&b!==g.length-1||(A===".."?y.pop():y.push(A))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var g,y,b="";for(y=0;y<(p||"").length;y++)b+="\\x"+((g=p.charCodeAt(y))<16?"0":"")+g.toString(16).toUpperCase();return b},i.delay=function(p,g,y){setImmediate(function(){p.apply(y||null,g||[])})},i.inherits=function(p,g){function y(){}y.prototype=g.prototype,p.prototype=new y},i.extend=function(){var p,g,y={};for(p=0;p<arguments.length;p++)for(g in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],g)&&y[g]===void 0&&(y[g]=arguments[p][g]);return y},i.prepareContent=function(p,g,y,b,A){return c.Promise.resolve(g).then(function(S){return s.blob&&(S instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(S))!==-1)&&typeof FileReader<"u"?new c.Promise(function(x,F){var R=new FileReader;R.onload=function(P){x(P.target.result)},R.onerror=function(P){F(P.target.error)},R.readAsArrayBuffer(S)}):S}).then(function(S){var x=i.getTypeOf(S);return x?(x==="arraybuffer"?S=i.transformTo("uint8array",S):x==="string"&&(A?S=o.decode(S):y&&b!==!0&&(S=(function(F){return u(F,s.uint8array?new Uint8Array(F.length):new Array(F.length))})(S))),S):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./signature"),c=r("./zipEntry"),l=r("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===d;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=d-f;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./compressedObject"),c=r("./crc32"),l=r("./utf8"),u=r("./compressions"),h=r("./support");function d(f,m){this.options=f,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=(function(g){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===g)return u[y];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,p,g,y=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<y;)m=f.readInt(2),p=f.readInt(2),g=f.readData(p),this.extraFields[m]={id:m,length:p,value:g};f.setIndex(y)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var y=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(f.length-5))}return null}},n.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,i){function s(m,p,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=p,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=r("./stream/StreamHelper"),a=r("./stream/DataWorker"),c=r("./utf8"),l=r("./compressedObject"),u=r("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,g="string";try{if(!m)throw new Error("No output type specified.");var y=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(p=p.pipe(new c.Utf8EncodeWorker)),!b&&y&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(A){(p=new u("error")).error(A)}return new o(p,g,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(g,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var f=[];function m(){var p,g;a=!0;for(var y=f.length;y;){for(g=f,f=[],p=-1;++p<y;)g[p]();y=f.length}a=!1}n.exports=function(p){f.push(p)!==1||a||o()}}).call(this,typeof Ci<"u"?Ci:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,n,i){var s=r("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function d(y,b,A){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function f(y,b,A){s(function(){var S;try{S=b(A)}catch(x){return a.reject(y,x)}S===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,S)})}function m(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}function p(y,b){var A=!1;function S(R){A||(A=!0,a.reject(y,R))}function x(R){A||(A=!0,a.resolve(y,R))}var F=g(function(){b(x,S)});F.status==="error"&&S(F.value)}function g(y,b){var A={};try{A.value=y(b),A.status="success"}catch(S){A.status="error",A.value=S}return A}(n.exports=h).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(A){return b.resolve(y()).then(function(){return A})},function(A){return b.resolve(y()).then(function(){throw A})})},h.prototype.catch=function(y){return this.then(null,y)},h.prototype.then=function(y,b){if(typeof y!="function"&&this.state===l||typeof b!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?f(A,this.state===l?y:b,this.outcome):this.queue.push(new d(A,y,b)),A},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){f(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){f(this.promise,this.onRejected,y)},a.resolve=function(y,b){var A=g(m,b);if(A.status==="error")return a.reject(y,A.value);var S=A.value;if(S)p(y,S);else{y.state=l,y.outcome=b;for(var x=-1,F=y.queue.length;++x<F;)y.queue[x].callFulfilled(b)}return y},a.reject=function(y,b){y.state=c,y.outcome=b;for(var A=-1,S=y.queue.length;++A<S;)y.queue[A].callRejected(b);return y},h.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},h.reject=function(y){var b=new this(o);return a.reject(b,y)},h.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,S=!1;if(!A)return this.resolve([]);for(var x=new Array(A),F=0,R=-1,P=new this(o);++R<A;)W(y[R],R);return P;function W(D,G){b.resolve(D).then(function(O){x[G]=O,++F!==A||S||(S=!0,a.resolve(P,x))},function(O){S||(S=!0,a.reject(P,O))})}},h.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,S=!1;if(!A)return this.resolve([]);for(var x=-1,F=new this(o);++x<A;)R=y[x],b.resolve(R).then(function(P){S||(S=!0,a.resolve(F,P))},function(P){S||(S=!0,a.reject(F,P))});var R;return F}},{immediate:36}],38:[function(r,n,i){var s={};(0,r("./lib/utils/common").assign)(s,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,i){var s=r("./zlib/deflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/messages"),l=r("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(A!==h)throw new Error(c[A]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var S;if(S=typeof b.dictionary=="string"?a.string2buf(b.dictionary):u.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(A=s.deflateSetDictionary(this.strm,S))!==h)throw new Error(c[A]);this._dict_set=!0}}function g(y,b){var A=new p(b);if(A.push(y,!0),A.err)throw A.msg||c[A.err];return A.result}p.prototype.push=function(y,b){var A,S,x=this.strm,F=this.options.chunkSize;if(this.ended)return!1;S=b===~~b?b:b===!0?4:0,typeof y=="string"?x.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?x.input=new Uint8Array(y):x.input=y,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(F),x.next_out=0,x.avail_out=F),(A=s.deflate(x,S))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&A!==1);return S===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):S!==2||(this.onEnd(h),!(x.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=g,i.deflateRaw=function(y,b){return(b=b||{}).raw=!0,g(y,b)},i.gzip=function(y,b){return(b=b||{}).gzip=!0,g(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,i){var s=r("./zlib/inflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/constants"),l=r("./zlib/messages"),u=r("./zlib/zstream"),h=r("./zlib/gzheader"),d=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&(15&g.windowBits)==0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,g.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function m(p,g){var y=new f(g);if(y.push(p,!0),y.err)throw y.msg||l[y.err];return y.result}f.prototype.push=function(p,g){var y,b,A,S,x,F,R=this.strm,P=this.options.chunkSize,W=this.options.dictionary,D=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?R.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?R.input=new Uint8Array(p):R.input=p,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8(P),R.next_out=0,R.avail_out=P),(y=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&W&&(F=typeof W=="string"?a.string2buf(W):d.call(W)==="[object ArrayBuffer]"?new Uint8Array(W):W,y=s.inflateSetDictionary(this.strm,F)),y===c.Z_BUF_ERROR&&D===!0&&(y=c.Z_OK,D=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&y!==c.Z_STREAM_END&&(R.avail_in!==0||b!==c.Z_FINISH&&b!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(R.output,R.next_out),S=R.next_out-A,x=a.buf2string(R.output,A),R.next_out=S,R.avail_out=P-S,S&&o.arraySet(R.output,R.output,A,S,0),this.onData(x)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(D=!0)}while((0<R.avail_in||R.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(b=c.Z_FINISH),b===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):b!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=m,i.inflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){var l,u,h,d,f,m;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(m=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)f=c[l],m.set(f,d),d+=f.length;return m}},a={arraySet:function(c,l,u,h,d){for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(r,n,i){var s=r("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",m=0;m<d;m++)f+=String.fromCharCode(h[m]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,m,p,g,y=h.length,b=0;for(p=0;p<y;p++)(64512&(f=h.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=h.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),b+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(b),p=g=0;g<b;p++)(64512&(f=h.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=h.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),f<128?d[g++]=f:(f<2048?d[g++]=192|f>>>6:(f<65536?d[g++]=224|f>>>12:(d[g++]=240|f>>>18,d[g++]=128|f>>>12&63),d[g++]=128|f>>>6&63),d[g++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,m=d.length;f<m;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,m,p,g,y=d||h.length,b=new Array(2*y);for(f=m=0;f<y;)if((p=h[f++])<128)b[m++]=p;else if(4<(g=c[p]))b[m++]=65533,f+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&f<y;)p=p<<6|63&h[f++],g--;1<g?b[m++]=65533:p<65536?b[m++]=p:(p-=65536,b[m++]=55296|p>>10&1023,b[m++]=56320|1023&p)}return u(b,m)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(r,n,i){n.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(r,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,i){var s=(function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a})();n.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(r,n,i){var s,o=r("../utils/common"),a=r("./trees"),c=r("./adler32"),l=r("./crc32"),u=r("./messages"),h=0,d=4,f=0,m=-2,p=-1,g=4,y=2,b=8,A=9,S=286,x=30,F=19,R=2*S+1,P=15,W=3,D=258,G=D+W+1,O=42,I=113,v=1,C=2,z=3,$=4;function Q(T,fe){return T.msg=u[fe],fe}function Y(T){return(T<<1)-(4<T?9:0)}function N(T){for(var fe=T.length;0<=--fe;)T[fe]=0}function M(T){var fe=T.state,ie=fe.pending;ie>T.avail_out&&(ie=T.avail_out),ie!==0&&(o.arraySet(T.output,fe.pending_buf,fe.pending_out,ie,T.next_out),T.next_out+=ie,fe.pending_out+=ie,T.total_out+=ie,T.avail_out-=ie,fe.pending-=ie,fe.pending===0&&(fe.pending_out=0))}function U(T,fe){a._tr_flush_block(T,0<=T.block_start?T.block_start:-1,T.strstart-T.block_start,fe),T.block_start=T.strstart,M(T.strm)}function V(T,fe){T.pending_buf[T.pending++]=fe}function q(T,fe){T.pending_buf[T.pending++]=fe>>>8&255,T.pending_buf[T.pending++]=255&fe}function J(T,fe){var ie,K,j=T.max_chain_length,ee=T.strstart,pe=T.prev_length,me=T.nice_match,se=T.strstart>T.w_size-G?T.strstart-(T.w_size-G):0,_e=T.window,Oe=T.w_mask,be=T.prev,$e=T.strstart+D,pt=_e[ee+pe-1],Ze=_e[ee+pe];T.prev_length>=T.good_match&&(j>>=2),me>T.lookahead&&(me=T.lookahead);do if(_e[(ie=fe)+pe]===Ze&&_e[ie+pe-1]===pt&&_e[ie]===_e[ee]&&_e[++ie]===_e[ee+1]){ee+=2,ie++;do;while(_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&ee<$e);if(K=D-($e-ee),ee=$e-D,pe<K){if(T.match_start=fe,me<=(pe=K))break;pt=_e[ee+pe-1],Ze=_e[ee+pe]}}while((fe=be[fe&Oe])>se&&--j!=0);return pe<=T.lookahead?pe:T.lookahead}function he(T){var fe,ie,K,j,ee,pe,me,se,_e,Oe,be=T.w_size;do{if(j=T.window_size-T.lookahead-T.strstart,T.strstart>=be+(be-G)){for(o.arraySet(T.window,T.window,be,be,0),T.match_start-=be,T.strstart-=be,T.block_start-=be,fe=ie=T.hash_size;K=T.head[--fe],T.head[fe]=be<=K?K-be:0,--ie;);for(fe=ie=be;K=T.prev[--fe],T.prev[fe]=be<=K?K-be:0,--ie;);j+=be}if(T.strm.avail_in===0)break;if(pe=T.strm,me=T.window,se=T.strstart+T.lookahead,_e=j,Oe=void 0,Oe=pe.avail_in,_e<Oe&&(Oe=_e),ie=Oe===0?0:(pe.avail_in-=Oe,o.arraySet(me,pe.input,pe.next_in,Oe,se),pe.state.wrap===1?pe.adler=c(pe.adler,me,Oe,se):pe.state.wrap===2&&(pe.adler=l(pe.adler,me,Oe,se)),pe.next_in+=Oe,pe.total_in+=Oe,Oe),T.lookahead+=ie,T.lookahead+T.insert>=W)for(ee=T.strstart-T.insert,T.ins_h=T.window[ee],T.ins_h=(T.ins_h<<T.hash_shift^T.window[ee+1])&T.hash_mask;T.insert&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[ee+W-1])&T.hash_mask,T.prev[ee&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=ee,ee++,T.insert--,!(T.lookahead+T.insert<W)););}while(T.lookahead<G&&T.strm.avail_in!==0)}function xe(T,fe){for(var ie,K;;){if(T.lookahead<G){if(he(T),T.lookahead<G&&fe===h)return v;if(T.lookahead===0)break}if(ie=0,T.lookahead>=W&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),ie!==0&&T.strstart-ie<=T.w_size-G&&(T.match_length=J(T,ie)),T.match_length>=W)if(K=a._tr_tally(T,T.strstart-T.match_start,T.match_length-W),T.lookahead-=T.match_length,T.match_length<=T.max_lazy_match&&T.lookahead>=W){for(T.match_length--;T.strstart++,T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart,--T.match_length!=0;);T.strstart++}else T.strstart+=T.match_length,T.match_length=0,T.ins_h=T.window[T.strstart],T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+1])&T.hash_mask;else K=a._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++;if(K&&(U(T,!1),T.strm.avail_out===0))return v}return T.insert=T.strstart<W-1?T.strstart:W-1,fe===d?(U(T,!0),T.strm.avail_out===0?z:$):T.last_lit&&(U(T,!1),T.strm.avail_out===0)?v:C}function ve(T,fe){for(var ie,K,j;;){if(T.lookahead<G){if(he(T),T.lookahead<G&&fe===h)return v;if(T.lookahead===0)break}if(ie=0,T.lookahead>=W&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),T.prev_length=T.match_length,T.prev_match=T.match_start,T.match_length=W-1,ie!==0&&T.prev_length<T.max_lazy_match&&T.strstart-ie<=T.w_size-G&&(T.match_length=J(T,ie),T.match_length<=5&&(T.strategy===1||T.match_length===W&&4096<T.strstart-T.match_start)&&(T.match_length=W-1)),T.prev_length>=W&&T.match_length<=T.prev_length){for(j=T.strstart+T.lookahead-W,K=a._tr_tally(T,T.strstart-1-T.prev_match,T.prev_length-W),T.lookahead-=T.prev_length-1,T.prev_length-=2;++T.strstart<=j&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),--T.prev_length!=0;);if(T.match_available=0,T.match_length=W-1,T.strstart++,K&&(U(T,!1),T.strm.avail_out===0))return v}else if(T.match_available){if((K=a._tr_tally(T,0,T.window[T.strstart-1]))&&U(T,!1),T.strstart++,T.lookahead--,T.strm.avail_out===0)return v}else T.match_available=1,T.strstart++,T.lookahead--}return T.match_available&&(K=a._tr_tally(T,0,T.window[T.strstart-1]),T.match_available=0),T.insert=T.strstart<W-1?T.strstart:W-1,fe===d?(U(T,!0),T.strm.avail_out===0?z:$):T.last_lit&&(U(T,!1),T.strm.avail_out===0)?v:C}function ke(T,fe,ie,K,j){this.good_length=T,this.max_lazy=fe,this.nice_length=ie,this.max_chain=K,this.func=j}function Ae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*F+1)),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*S+1),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*S+1),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Se(T){var fe;return T&&T.state?(T.total_in=T.total_out=0,T.data_type=y,(fe=T.state).pending=0,fe.pending_out=0,fe.wrap<0&&(fe.wrap=-fe.wrap),fe.status=fe.wrap?O:I,T.adler=fe.wrap===2?0:1,fe.last_flush=h,a._tr_init(fe),f):Q(T,m)}function Le(T){var fe=Se(T);return fe===f&&(function(ie){ie.window_size=2*ie.w_size,N(ie.head),ie.max_lazy_match=s[ie.level].max_lazy,ie.good_match=s[ie.level].good_length,ie.nice_match=s[ie.level].nice_length,ie.max_chain_length=s[ie.level].max_chain,ie.strstart=0,ie.block_start=0,ie.lookahead=0,ie.insert=0,ie.match_length=ie.prev_length=W-1,ie.match_available=0,ie.ins_h=0})(T.state),fe}function je(T,fe,ie,K,j,ee){if(!T)return m;var pe=1;if(fe===p&&(fe=6),K<0?(pe=0,K=-K):15<K&&(pe=2,K-=16),j<1||A<j||ie!==b||K<8||15<K||fe<0||9<fe||ee<0||g<ee)return Q(T,m);K===8&&(K=9);var me=new Ae;return(T.state=me).strm=T,me.wrap=pe,me.gzhead=null,me.w_bits=K,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=j+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+W-1)/W),me.window=new o.Buf8(2*me.w_size),me.head=new o.Buf16(me.hash_size),me.prev=new o.Buf16(me.w_size),me.lit_bufsize=1<<j+6,me.pending_buf_size=4*me.lit_bufsize,me.pending_buf=new o.Buf8(me.pending_buf_size),me.d_buf=1*me.lit_bufsize,me.l_buf=3*me.lit_bufsize,me.level=fe,me.strategy=ee,me.method=ie,Le(T)}s=[new ke(0,0,0,0,function(T,fe){var ie=65535;for(ie>T.pending_buf_size-5&&(ie=T.pending_buf_size-5);;){if(T.lookahead<=1){if(he(T),T.lookahead===0&&fe===h)return v;if(T.lookahead===0)break}T.strstart+=T.lookahead,T.lookahead=0;var K=T.block_start+ie;if((T.strstart===0||T.strstart>=K)&&(T.lookahead=T.strstart-K,T.strstart=K,U(T,!1),T.strm.avail_out===0)||T.strstart-T.block_start>=T.w_size-G&&(U(T,!1),T.strm.avail_out===0))return v}return T.insert=0,fe===d?(U(T,!0),T.strm.avail_out===0?z:$):(T.strstart>T.block_start&&(U(T,!1),T.strm.avail_out),v)}),new ke(4,4,8,4,xe),new ke(4,5,16,8,xe),new ke(4,6,32,32,xe),new ke(4,4,16,16,ve),new ke(8,16,32,32,ve),new ke(8,16,128,128,ve),new ke(8,32,128,256,ve),new ke(32,128,258,1024,ve),new ke(32,258,258,4096,ve)],i.deflateInit=function(T,fe){return je(T,fe,b,15,8,0)},i.deflateInit2=je,i.deflateReset=Le,i.deflateResetKeep=Se,i.deflateSetHeader=function(T,fe){return T&&T.state?T.state.wrap!==2?m:(T.state.gzhead=fe,f):m},i.deflate=function(T,fe){var ie,K,j,ee;if(!T||!T.state||5<fe||fe<0)return T?Q(T,m):m;if(K=T.state,!T.output||!T.input&&T.avail_in!==0||K.status===666&&fe!==d)return Q(T,T.avail_out===0?-5:m);if(K.strm=T,ie=K.last_flush,K.last_flush=fe,K.status===O)if(K.wrap===2)T.adler=0,V(K,31),V(K,139),V(K,8),K.gzhead?(V(K,(K.gzhead.text?1:0)+(K.gzhead.hcrc?2:0)+(K.gzhead.extra?4:0)+(K.gzhead.name?8:0)+(K.gzhead.comment?16:0)),V(K,255&K.gzhead.time),V(K,K.gzhead.time>>8&255),V(K,K.gzhead.time>>16&255),V(K,K.gzhead.time>>24&255),V(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),V(K,255&K.gzhead.os),K.gzhead.extra&&K.gzhead.extra.length&&(V(K,255&K.gzhead.extra.length),V(K,K.gzhead.extra.length>>8&255)),K.gzhead.hcrc&&(T.adler=l(T.adler,K.pending_buf,K.pending,0)),K.gzindex=0,K.status=69):(V(K,0),V(K,0),V(K,0),V(K,0),V(K,0),V(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),V(K,3),K.status=I);else{var pe=b+(K.w_bits-8<<4)<<8;pe|=(2<=K.strategy||K.level<2?0:K.level<6?1:K.level===6?2:3)<<6,K.strstart!==0&&(pe|=32),pe+=31-pe%31,K.status=I,q(K,pe),K.strstart!==0&&(q(K,T.adler>>>16),q(K,65535&T.adler)),T.adler=1}if(K.status===69)if(K.gzhead.extra){for(j=K.pending;K.gzindex<(65535&K.gzhead.extra.length)&&(K.pending!==K.pending_buf_size||(K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),M(T),j=K.pending,K.pending!==K.pending_buf_size));)V(K,255&K.gzhead.extra[K.gzindex]),K.gzindex++;K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),K.gzindex===K.gzhead.extra.length&&(K.gzindex=0,K.status=73)}else K.status=73;if(K.status===73)if(K.gzhead.name){j=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),M(T),j=K.pending,K.pending===K.pending_buf_size)){ee=1;break}ee=K.gzindex<K.gzhead.name.length?255&K.gzhead.name.charCodeAt(K.gzindex++):0,V(K,ee)}while(ee!==0);K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),ee===0&&(K.gzindex=0,K.status=91)}else K.status=91;if(K.status===91)if(K.gzhead.comment){j=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),M(T),j=K.pending,K.pending===K.pending_buf_size)){ee=1;break}ee=K.gzindex<K.gzhead.comment.length?255&K.gzhead.comment.charCodeAt(K.gzindex++):0,V(K,ee)}while(ee!==0);K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),ee===0&&(K.status=103)}else K.status=103;if(K.status===103&&(K.gzhead.hcrc?(K.pending+2>K.pending_buf_size&&M(T),K.pending+2<=K.pending_buf_size&&(V(K,255&T.adler),V(K,T.adler>>8&255),T.adler=0,K.status=I)):K.status=I),K.pending!==0){if(M(T),T.avail_out===0)return K.last_flush=-1,f}else if(T.avail_in===0&&Y(fe)<=Y(ie)&&fe!==d)return Q(T,-5);if(K.status===666&&T.avail_in!==0)return Q(T,-5);if(T.avail_in!==0||K.lookahead!==0||fe!==h&&K.status!==666){var me=K.strategy===2?(function(se,_e){for(var Oe;;){if(se.lookahead===0&&(he(se),se.lookahead===0)){if(_e===h)return v;break}if(se.match_length=0,Oe=a._tr_tally(se,0,se.window[se.strstart]),se.lookahead--,se.strstart++,Oe&&(U(se,!1),se.strm.avail_out===0))return v}return se.insert=0,_e===d?(U(se,!0),se.strm.avail_out===0?z:$):se.last_lit&&(U(se,!1),se.strm.avail_out===0)?v:C})(K,fe):K.strategy===3?(function(se,_e){for(var Oe,be,$e,pt,Ze=se.window;;){if(se.lookahead<=D){if(he(se),se.lookahead<=D&&_e===h)return v;if(se.lookahead===0)break}if(se.match_length=0,se.lookahead>=W&&0<se.strstart&&(be=Ze[$e=se.strstart-1])===Ze[++$e]&&be===Ze[++$e]&&be===Ze[++$e]){pt=se.strstart+D;do;while(be===Ze[++$e]&&be===Ze[++$e]&&be===Ze[++$e]&&be===Ze[++$e]&&be===Ze[++$e]&&be===Ze[++$e]&&be===Ze[++$e]&&be===Ze[++$e]&&$e<pt);se.match_length=D-(pt-$e),se.match_length>se.lookahead&&(se.match_length=se.lookahead)}if(se.match_length>=W?(Oe=a._tr_tally(se,1,se.match_length-W),se.lookahead-=se.match_length,se.strstart+=se.match_length,se.match_length=0):(Oe=a._tr_tally(se,0,se.window[se.strstart]),se.lookahead--,se.strstart++),Oe&&(U(se,!1),se.strm.avail_out===0))return v}return se.insert=0,_e===d?(U(se,!0),se.strm.avail_out===0?z:$):se.last_lit&&(U(se,!1),se.strm.avail_out===0)?v:C})(K,fe):s[K.level].func(K,fe);if(me!==z&&me!==$||(K.status=666),me===v||me===z)return T.avail_out===0&&(K.last_flush=-1),f;if(me===C&&(fe===1?a._tr_align(K):fe!==5&&(a._tr_stored_block(K,0,0,!1),fe===3&&(N(K.head),K.lookahead===0&&(K.strstart=0,K.block_start=0,K.insert=0))),M(T),T.avail_out===0))return K.last_flush=-1,f}return fe!==d?f:K.wrap<=0?1:(K.wrap===2?(V(K,255&T.adler),V(K,T.adler>>8&255),V(K,T.adler>>16&255),V(K,T.adler>>24&255),V(K,255&T.total_in),V(K,T.total_in>>8&255),V(K,T.total_in>>16&255),V(K,T.total_in>>24&255)):(q(K,T.adler>>>16),q(K,65535&T.adler)),M(T),0<K.wrap&&(K.wrap=-K.wrap),K.pending!==0?f:1)},i.deflateEnd=function(T){var fe;return T&&T.state?(fe=T.state.status)!==O&&fe!==69&&fe!==73&&fe!==91&&fe!==103&&fe!==I&&fe!==666?Q(T,m):(T.state=null,fe===I?Q(T,-3):f):m},i.deflateSetDictionary=function(T,fe){var ie,K,j,ee,pe,me,se,_e,Oe=fe.length;if(!T||!T.state||(ee=(ie=T.state).wrap)===2||ee===1&&ie.status!==O||ie.lookahead)return m;for(ee===1&&(T.adler=c(T.adler,fe,Oe,0)),ie.wrap=0,Oe>=ie.w_size&&(ee===0&&(N(ie.head),ie.strstart=0,ie.block_start=0,ie.insert=0),_e=new o.Buf8(ie.w_size),o.arraySet(_e,fe,Oe-ie.w_size,ie.w_size,0),fe=_e,Oe=ie.w_size),pe=T.avail_in,me=T.next_in,se=T.input,T.avail_in=Oe,T.next_in=0,T.input=fe,he(ie);ie.lookahead>=W;){for(K=ie.strstart,j=ie.lookahead-(W-1);ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[K+W-1])&ie.hash_mask,ie.prev[K&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=K,K++,--j;);ie.strstart=K,ie.lookahead=W-1,he(ie)}return ie.strstart+=ie.lookahead,ie.block_start=ie.strstart,ie.insert=ie.lookahead,ie.lookahead=0,ie.match_length=ie.prev_length=W-1,ie.match_available=0,T.next_in=me,T.input=se,T.avail_in=pe,ie.wrap=ee,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,n,i){n.exports=function(s,o){var a,c,l,u,h,d,f,m,p,g,y,b,A,S,x,F,R,P,W,D,G,O,I,v,C;a=s.state,c=s.next_in,v=s.input,l=c+(s.avail_in-5),u=s.next_out,C=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),f=a.dmax,m=a.wsize,p=a.whave,g=a.wnext,y=a.window,b=a.hold,A=a.bits,S=a.lencode,x=a.distcode,F=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;e:do{A<15&&(b+=v[c++]<<A,A+=8,b+=v[c++]<<A,A+=8),P=S[b&F];t:for(;;){if(b>>>=W=P>>>24,A-=W,(W=P>>>16&255)===0)C[u++]=65535&P;else{if(!(16&W)){if((64&W)==0){P=S[(65535&P)+(b&(1<<W)-1)];continue t}if(32&W){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}D=65535&P,(W&=15)&&(A<W&&(b+=v[c++]<<A,A+=8),D+=b&(1<<W)-1,b>>>=W,A-=W),A<15&&(b+=v[c++]<<A,A+=8,b+=v[c++]<<A,A+=8),P=x[b&R];r:for(;;){if(b>>>=W=P>>>24,A-=W,!(16&(W=P>>>16&255))){if((64&W)==0){P=x[(65535&P)+(b&(1<<W)-1)];continue r}s.msg="invalid distance code",a.mode=30;break e}if(G=65535&P,A<(W&=15)&&(b+=v[c++]<<A,(A+=8)<W&&(b+=v[c++]<<A,A+=8)),f<(G+=b&(1<<W)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(b>>>=W,A-=W,(W=u-h)<G){if(p<(W=G-W)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(I=y,(O=0)===g){if(O+=m-W,W<D){for(D-=W;C[u++]=y[O++],--W;);O=u-G,I=C}}else if(g<W){if(O+=m+g-W,(W-=g)<D){for(D-=W;C[u++]=y[O++],--W;);if(O=0,g<D){for(D-=W=g;C[u++]=y[O++],--W;);O=u-G,I=C}}}else if(O+=g-W,W<D){for(D-=W;C[u++]=y[O++],--W;);O=u-G,I=C}for(;2<D;)C[u++]=I[O++],C[u++]=I[O++],C[u++]=I[O++],D-=3;D&&(C[u++]=I[O++],1<D&&(C[u++]=I[O++]))}else{for(O=u-G;C[u++]=C[O++],C[u++]=C[O++],C[u++]=C[O++],2<(D-=3););D&&(C[u++]=C[O++],1<D&&(C[u++]=C[O++]))}break}}break}}while(c<l&&u<d);c-=D=A>>3,b&=(1<<(A-=D<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=b,a.bits=A}},{}],49:[function(r,n,i){var s=r("../utils/common"),o=r("./adler32"),a=r("./crc32"),c=r("./inffast"),l=r("./inftrees"),u=1,h=2,d=0,f=-2,m=1,p=852,g=592;function y(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(O){var I;return O&&O.state?(I=O.state,O.total_in=O.total_out=I.total=0,O.msg="",I.wrap&&(O.adler=1&I.wrap),I.mode=m,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new s.Buf32(p),I.distcode=I.distdyn=new s.Buf32(g),I.sane=1,I.back=-1,d):f}function S(O){var I;return O&&O.state?((I=O.state).wsize=0,I.whave=0,I.wnext=0,A(O)):f}function x(O,I){var v,C;return O&&O.state?(C=O.state,I<0?(v=0,I=-I):(v=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?f:(C.window!==null&&C.wbits!==I&&(C.window=null),C.wrap=v,C.wbits=I,S(O))):f}function F(O,I){var v,C;return O?(C=new b,(O.state=C).window=null,(v=x(O,I))!==d&&(O.state=null),v):f}var R,P,W=!0;function D(O){if(W){var I;for(R=new s.Buf32(512),P=new s.Buf32(32),I=0;I<144;)O.lens[I++]=8;for(;I<256;)O.lens[I++]=9;for(;I<280;)O.lens[I++]=7;for(;I<288;)O.lens[I++]=8;for(l(u,O.lens,0,288,R,0,O.work,{bits:9}),I=0;I<32;)O.lens[I++]=5;l(h,O.lens,0,32,P,0,O.work,{bits:5}),W=!1}O.lencode=R,O.lenbits=9,O.distcode=P,O.distbits=5}function G(O,I,v,C){var z,$=O.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),C>=$.wsize?(s.arraySet($.window,I,v-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(C<(z=$.wsize-$.wnext)&&(z=C),s.arraySet($.window,I,v-C,z,$.wnext),(C-=z)?(s.arraySet($.window,I,v-C,C,0),$.wnext=C,$.whave=$.wsize):($.wnext+=z,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=z))),0}i.inflateReset=S,i.inflateReset2=x,i.inflateResetKeep=A,i.inflateInit=function(O){return F(O,15)},i.inflateInit2=F,i.inflate=function(O,I){var v,C,z,$,Q,Y,N,M,U,V,q,J,he,xe,ve,ke,Ae,Se,Le,je,T,fe,ie,K,j=0,ee=new s.Buf8(4),pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return f;(v=O.state).mode===12&&(v.mode=13),Q=O.next_out,z=O.output,N=O.avail_out,$=O.next_in,C=O.input,Y=O.avail_in,M=v.hold,U=v.bits,V=Y,q=N,fe=d;e:for(;;)switch(v.mode){case m:if(v.wrap===0){v.mode=13;break}for(;U<16;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if(2&v.wrap&&M===35615){ee[v.check=0]=255&M,ee[1]=M>>>8&255,v.check=a(v.check,ee,2,0),U=M=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&M)<<8)+(M>>8))%31){O.msg="incorrect header check",v.mode=30;break}if((15&M)!=8){O.msg="unknown compression method",v.mode=30;break}if(U-=4,T=8+(15&(M>>>=4)),v.wbits===0)v.wbits=T;else if(T>v.wbits){O.msg="invalid window size",v.mode=30;break}v.dmax=1<<T,O.adler=v.check=1,v.mode=512&M?10:12,U=M=0;break;case 2:for(;U<16;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if(v.flags=M,(255&v.flags)!=8){O.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){O.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=M>>8&1),512&v.flags&&(ee[0]=255&M,ee[1]=M>>>8&255,v.check=a(v.check,ee,2,0)),U=M=0,v.mode=3;case 3:for(;U<32;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}v.head&&(v.head.time=M),512&v.flags&&(ee[0]=255&M,ee[1]=M>>>8&255,ee[2]=M>>>16&255,ee[3]=M>>>24&255,v.check=a(v.check,ee,4,0)),U=M=0,v.mode=4;case 4:for(;U<16;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}v.head&&(v.head.xflags=255&M,v.head.os=M>>8),512&v.flags&&(ee[0]=255&M,ee[1]=M>>>8&255,v.check=a(v.check,ee,2,0)),U=M=0,v.mode=5;case 5:if(1024&v.flags){for(;U<16;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}v.length=M,v.head&&(v.head.extra_len=M),512&v.flags&&(ee[0]=255&M,ee[1]=M>>>8&255,v.check=a(v.check,ee,2,0)),U=M=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(Y<(J=v.length)&&(J=Y),J&&(v.head&&(T=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),s.arraySet(v.head.extra,C,$,J,T)),512&v.flags&&(v.check=a(v.check,C,J,$)),Y-=J,$+=J,v.length-=J),v.length))break e;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(Y===0)break e;for(J=0;T=C[$+J++],v.head&&T&&v.length<65536&&(v.head.name+=String.fromCharCode(T)),T&&J<Y;);if(512&v.flags&&(v.check=a(v.check,C,J,$)),Y-=J,$+=J,T)break e}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(Y===0)break e;for(J=0;T=C[$+J++],v.head&&T&&v.length<65536&&(v.head.comment+=String.fromCharCode(T)),T&&J<Y;);if(512&v.flags&&(v.check=a(v.check,C,J,$)),Y-=J,$+=J,T)break e}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;U<16;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if(M!==(65535&v.check)){O.msg="header crc mismatch",v.mode=30;break}U=M=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),O.adler=v.check=0,v.mode=12;break;case 10:for(;U<32;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}O.adler=v.check=y(M),U=M=0,v.mode=11;case 11:if(v.havedict===0)return O.next_out=Q,O.avail_out=N,O.next_in=$,O.avail_in=Y,v.hold=M,v.bits=U,2;O.adler=v.check=1,v.mode=12;case 12:if(I===5||I===6)break e;case 13:if(v.last){M>>>=7&U,U-=7&U,v.mode=27;break}for(;U<3;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}switch(v.last=1&M,U-=1,3&(M>>>=1)){case 0:v.mode=14;break;case 1:if(D(v),v.mode=20,I!==6)break;M>>>=2,U-=2;break e;case 2:v.mode=17;break;case 3:O.msg="invalid block type",v.mode=30}M>>>=2,U-=2;break;case 14:for(M>>>=7&U,U-=7&U;U<32;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if((65535&M)!=(M>>>16^65535)){O.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&M,U=M=0,v.mode=15,I===6)break e;case 15:v.mode=16;case 16:if(J=v.length){if(Y<J&&(J=Y),N<J&&(J=N),J===0)break e;s.arraySet(z,C,$,J,Q),Y-=J,$+=J,N-=J,Q+=J,v.length-=J;break}v.mode=12;break;case 17:for(;U<14;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if(v.nlen=257+(31&M),M>>>=5,U-=5,v.ndist=1+(31&M),M>>>=5,U-=5,v.ncode=4+(15&M),M>>>=4,U-=4,286<v.nlen||30<v.ndist){O.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;U<3;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}v.lens[pe[v.have++]]=7&M,M>>>=3,U-=3}for(;v.have<19;)v.lens[pe[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,ie={bits:v.lenbits},fe=l(0,v.lens,0,19,v.lencode,0,v.work,ie),v.lenbits=ie.bits,fe){O.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;ke=(j=v.lencode[M&(1<<v.lenbits)-1])>>>16&255,Ae=65535&j,!((ve=j>>>24)<=U);){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if(Ae<16)M>>>=ve,U-=ve,v.lens[v.have++]=Ae;else{if(Ae===16){for(K=ve+2;U<K;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if(M>>>=ve,U-=ve,v.have===0){O.msg="invalid bit length repeat",v.mode=30;break}T=v.lens[v.have-1],J=3+(3&M),M>>>=2,U-=2}else if(Ae===17){for(K=ve+3;U<K;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}U-=ve,T=0,J=3+(7&(M>>>=ve)),M>>>=3,U-=3}else{for(K=ve+7;U<K;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}U-=ve,T=0,J=11+(127&(M>>>=ve)),M>>>=7,U-=7}if(v.have+J>v.nlen+v.ndist){O.msg="invalid bit length repeat",v.mode=30;break}for(;J--;)v.lens[v.have++]=T}}if(v.mode===30)break;if(v.lens[256]===0){O.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,ie={bits:v.lenbits},fe=l(u,v.lens,0,v.nlen,v.lencode,0,v.work,ie),v.lenbits=ie.bits,fe){O.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,ie={bits:v.distbits},fe=l(h,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,ie),v.distbits=ie.bits,fe){O.msg="invalid distances set",v.mode=30;break}if(v.mode=20,I===6)break e;case 20:v.mode=21;case 21:if(6<=Y&&258<=N){O.next_out=Q,O.avail_out=N,O.next_in=$,O.avail_in=Y,v.hold=M,v.bits=U,c(O,q),Q=O.next_out,z=O.output,N=O.avail_out,$=O.next_in,C=O.input,Y=O.avail_in,M=v.hold,U=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;ke=(j=v.lencode[M&(1<<v.lenbits)-1])>>>16&255,Ae=65535&j,!((ve=j>>>24)<=U);){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if(ke&&(240&ke)==0){for(Se=ve,Le=ke,je=Ae;ke=(j=v.lencode[je+((M&(1<<Se+Le)-1)>>Se)])>>>16&255,Ae=65535&j,!(Se+(ve=j>>>24)<=U);){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}M>>>=Se,U-=Se,v.back+=Se}if(M>>>=ve,U-=ve,v.back+=ve,v.length=Ae,ke===0){v.mode=26;break}if(32&ke){v.back=-1,v.mode=12;break}if(64&ke){O.msg="invalid literal/length code",v.mode=30;break}v.extra=15&ke,v.mode=22;case 22:if(v.extra){for(K=v.extra;U<K;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}v.length+=M&(1<<v.extra)-1,M>>>=v.extra,U-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;ke=(j=v.distcode[M&(1<<v.distbits)-1])>>>16&255,Ae=65535&j,!((ve=j>>>24)<=U);){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if((240&ke)==0){for(Se=ve,Le=ke,je=Ae;ke=(j=v.distcode[je+((M&(1<<Se+Le)-1)>>Se)])>>>16&255,Ae=65535&j,!(Se+(ve=j>>>24)<=U);){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}M>>>=Se,U-=Se,v.back+=Se}if(M>>>=ve,U-=ve,v.back+=ve,64&ke){O.msg="invalid distance code",v.mode=30;break}v.offset=Ae,v.extra=15&ke,v.mode=24;case 24:if(v.extra){for(K=v.extra;U<K;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}v.offset+=M&(1<<v.extra)-1,M>>>=v.extra,U-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){O.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(N===0)break e;if(J=q-N,v.offset>J){if((J=v.offset-J)>v.whave&&v.sane){O.msg="invalid distance too far back",v.mode=30;break}he=J>v.wnext?(J-=v.wnext,v.wsize-J):v.wnext-J,J>v.length&&(J=v.length),xe=v.window}else xe=z,he=Q-v.offset,J=v.length;for(N<J&&(J=N),N-=J,v.length-=J;z[Q++]=xe[he++],--J;);v.length===0&&(v.mode=21);break;case 26:if(N===0)break e;z[Q++]=v.length,N--,v.mode=21;break;case 27:if(v.wrap){for(;U<32;){if(Y===0)break e;Y--,M|=C[$++]<<U,U+=8}if(q-=N,O.total_out+=q,v.total+=q,q&&(O.adler=v.check=v.flags?a(v.check,z,q,Q-q):o(v.check,z,q,Q-q)),q=N,(v.flags?M:y(M))!==v.check){O.msg="incorrect data check",v.mode=30;break}U=M=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;U<32;){if(Y===0)break e;Y--,M+=C[$++]<<U,U+=8}if(M!==(4294967295&v.total)){O.msg="incorrect length check",v.mode=30;break}U=M=0}v.mode=29;case 29:fe=1;break e;case 30:fe=-3;break e;case 31:return-4;case 32:default:return f}return O.next_out=Q,O.avail_out=N,O.next_in=$,O.avail_in=Y,v.hold=M,v.bits=U,(v.wsize||q!==O.avail_out&&v.mode<30&&(v.mode<27||I!==4))&&G(O,O.output,O.next_out,q-O.avail_out)?(v.mode=31,-4):(V-=O.avail_in,q-=O.avail_out,O.total_in+=V,O.total_out+=q,v.total+=q,v.wrap&&q&&(O.adler=v.check=v.flags?a(v.check,z,q,O.next_out-q):o(v.check,z,q,O.next_out-q)),O.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(V==0&&q===0||I===4)&&fe===d&&(fe=-5),fe)},i.inflateEnd=function(O){if(!O||!O.state)return f;var I=O.state;return I.window&&(I.window=null),O.state=null,d},i.inflateGetHeader=function(O,I){var v;return O&&O.state?(2&(v=O.state).wrap)==0?f:((v.head=I).done=!1,d):f},i.inflateSetDictionary=function(O,I){var v,C=I.length;return O&&O.state?(v=O.state).wrap!==0&&v.mode!==11?f:v.mode===11&&o(1,I,C,0)!==v.check?-3:G(O,I,C,C)?(v.mode=31,-4):(v.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,i){var s=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,h,d,f,m,p,g,y){var b,A,S,x,F,R,P,W,D,G=y.bits,O=0,I=0,v=0,C=0,z=0,$=0,Q=0,Y=0,N=0,M=0,U=null,V=0,q=new s.Buf16(16),J=new s.Buf16(16),he=null,xe=0;for(O=0;O<=15;O++)q[O]=0;for(I=0;I<f;I++)q[h[d+I]]++;for(z=G,C=15;1<=C&&q[C]===0;C--);if(C<z&&(z=C),C===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(v=1;v<C&&q[v]===0;v++);for(z<v&&(z=v),O=Y=1;O<=15;O++)if(Y<<=1,(Y-=q[O])<0)return-1;if(0<Y&&(u===0||C!==1))return-1;for(J[1]=0,O=1;O<15;O++)J[O+1]=J[O]+q[O];for(I=0;I<f;I++)h[d+I]!==0&&(g[J[h[d+I]]++]=I);if(R=u===0?(U=he=g,19):u===1?(U=o,V-=257,he=a,xe-=257,256):(U=c,he=l,-1),O=v,F=p,Q=I=M=0,S=-1,x=(N=1<<($=z))-1,u===1&&852<N||u===2&&592<N)return 1;for(;;){for(P=O-Q,D=g[I]<R?(W=0,g[I]):g[I]>R?(W=he[xe+g[I]],U[V+g[I]]):(W=96,0),b=1<<O-Q,v=A=1<<$;m[F+(M>>Q)+(A-=b)]=P<<24|W<<16|D|0,A!==0;);for(b=1<<O-1;M&b;)b>>=1;if(b!==0?(M&=b-1,M+=b):M=0,I++,--q[O]==0){if(O===C)break;O=h[d+g[I]]}if(z<O&&(M&x)!==S){for(Q===0&&(Q=z),F+=v,Y=1<<($=O-Q);$+Q<C&&!((Y-=q[$+Q])<=0);)$++,Y<<=1;if(N+=1<<$,u===1&&852<N||u===2&&592<N)return 1;m[S=M&x]=z<<24|$<<16|F-p|0}}return M!==0&&(m[F+M]=O-Q<<24|64<<16|0),y.bits=z,0}},{"../utils/common":41}],51:[function(r,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,i){var s=r("../utils/common"),o=0,a=1;function c(j){for(var ee=j.length;0<=--ee;)j[ee]=0}var l=0,u=29,h=256,d=h+1+u,f=30,m=19,p=2*d+1,g=15,y=16,b=7,A=256,S=16,x=17,F=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(d+2));c(G);var O=new Array(2*f);c(O);var I=new Array(512);c(I);var v=new Array(256);c(v);var C=new Array(u);c(C);var z,$,Q,Y=new Array(f);function N(j,ee,pe,me,se){this.static_tree=j,this.extra_bits=ee,this.extra_base=pe,this.elems=me,this.max_length=se,this.has_stree=j&&j.length}function M(j,ee){this.dyn_tree=j,this.max_code=0,this.stat_desc=ee}function U(j){return j<256?I[j]:I[256+(j>>>7)]}function V(j,ee){j.pending_buf[j.pending++]=255&ee,j.pending_buf[j.pending++]=ee>>>8&255}function q(j,ee,pe){j.bi_valid>y-pe?(j.bi_buf|=ee<<j.bi_valid&65535,V(j,j.bi_buf),j.bi_buf=ee>>y-j.bi_valid,j.bi_valid+=pe-y):(j.bi_buf|=ee<<j.bi_valid&65535,j.bi_valid+=pe)}function J(j,ee,pe){q(j,pe[2*ee],pe[2*ee+1])}function he(j,ee){for(var pe=0;pe|=1&j,j>>>=1,pe<<=1,0<--ee;);return pe>>>1}function xe(j,ee,pe){var me,se,_e=new Array(g+1),Oe=0;for(me=1;me<=g;me++)_e[me]=Oe=Oe+pe[me-1]<<1;for(se=0;se<=ee;se++){var be=j[2*se+1];be!==0&&(j[2*se]=he(_e[be]++,be))}}function ve(j){var ee;for(ee=0;ee<d;ee++)j.dyn_ltree[2*ee]=0;for(ee=0;ee<f;ee++)j.dyn_dtree[2*ee]=0;for(ee=0;ee<m;ee++)j.bl_tree[2*ee]=0;j.dyn_ltree[2*A]=1,j.opt_len=j.static_len=0,j.last_lit=j.matches=0}function ke(j){8<j.bi_valid?V(j,j.bi_buf):0<j.bi_valid&&(j.pending_buf[j.pending++]=j.bi_buf),j.bi_buf=0,j.bi_valid=0}function Ae(j,ee,pe,me){var se=2*ee,_e=2*pe;return j[se]<j[_e]||j[se]===j[_e]&&me[ee]<=me[pe]}function Se(j,ee,pe){for(var me=j.heap[pe],se=pe<<1;se<=j.heap_len&&(se<j.heap_len&&Ae(ee,j.heap[se+1],j.heap[se],j.depth)&&se++,!Ae(ee,me,j.heap[se],j.depth));)j.heap[pe]=j.heap[se],pe=se,se<<=1;j.heap[pe]=me}function Le(j,ee,pe){var me,se,_e,Oe,be=0;if(j.last_lit!==0)for(;me=j.pending_buf[j.d_buf+2*be]<<8|j.pending_buf[j.d_buf+2*be+1],se=j.pending_buf[j.l_buf+be],be++,me===0?J(j,se,ee):(J(j,(_e=v[se])+h+1,ee),(Oe=R[_e])!==0&&q(j,se-=C[_e],Oe),J(j,_e=U(--me),pe),(Oe=P[_e])!==0&&q(j,me-=Y[_e],Oe)),be<j.last_lit;);J(j,A,ee)}function je(j,ee){var pe,me,se,_e=ee.dyn_tree,Oe=ee.stat_desc.static_tree,be=ee.stat_desc.has_stree,$e=ee.stat_desc.elems,pt=-1;for(j.heap_len=0,j.heap_max=p,pe=0;pe<$e;pe++)_e[2*pe]!==0?(j.heap[++j.heap_len]=pt=pe,j.depth[pe]=0):_e[2*pe+1]=0;for(;j.heap_len<2;)_e[2*(se=j.heap[++j.heap_len]=pt<2?++pt:0)]=1,j.depth[se]=0,j.opt_len--,be&&(j.static_len-=Oe[2*se+1]);for(ee.max_code=pt,pe=j.heap_len>>1;1<=pe;pe--)Se(j,_e,pe);for(se=$e;pe=j.heap[1],j.heap[1]=j.heap[j.heap_len--],Se(j,_e,1),me=j.heap[1],j.heap[--j.heap_max]=pe,j.heap[--j.heap_max]=me,_e[2*se]=_e[2*pe]+_e[2*me],j.depth[se]=(j.depth[pe]>=j.depth[me]?j.depth[pe]:j.depth[me])+1,_e[2*pe+1]=_e[2*me+1]=se,j.heap[1]=se++,Se(j,_e,1),2<=j.heap_len;);j.heap[--j.heap_max]=j.heap[1],(function(Ze,Yt){var L,_,E,B,X,ce,H=Yt.dyn_tree,re=Yt.max_code,ze=Yt.stat_desc.static_tree,Ge=Yt.stat_desc.has_stree,qe=Yt.stat_desc.extra_bits,Ce=Yt.stat_desc.extra_base,Yr=Yt.stat_desc.max_length,kn=0;for(B=0;B<=g;B++)Ze.bl_count[B]=0;for(H[2*Ze.heap[Ze.heap_max]+1]=0,L=Ze.heap_max+1;L<p;L++)Yr<(B=H[2*H[2*(_=Ze.heap[L])+1]+1]+1)&&(B=Yr,kn++),H[2*_+1]=B,re<_||(Ze.bl_count[B]++,X=0,Ce<=_&&(X=qe[_-Ce]),ce=H[2*_],Ze.opt_len+=ce*(B+X),Ge&&(Ze.static_len+=ce*(ze[2*_+1]+X)));if(kn!==0){do{for(B=Yr-1;Ze.bl_count[B]===0;)B--;Ze.bl_count[B]--,Ze.bl_count[B+1]+=2,Ze.bl_count[Yr]--,kn-=2}while(0<kn);for(B=Yr;B!==0;B--)for(_=Ze.bl_count[B];_!==0;)re<(E=Ze.heap[--L])||(H[2*E+1]!==B&&(Ze.opt_len+=(B-H[2*E+1])*H[2*E],H[2*E+1]=B),_--)}})(j,ee),xe(_e,pt,j.bl_count)}function T(j,ee,pe){var me,se,_e=-1,Oe=ee[1],be=0,$e=7,pt=4;for(Oe===0&&($e=138,pt=3),ee[2*(pe+1)+1]=65535,me=0;me<=pe;me++)se=Oe,Oe=ee[2*(me+1)+1],++be<$e&&se===Oe||(be<pt?j.bl_tree[2*se]+=be:se!==0?(se!==_e&&j.bl_tree[2*se]++,j.bl_tree[2*S]++):be<=10?j.bl_tree[2*x]++:j.bl_tree[2*F]++,_e=se,pt=(be=0)===Oe?($e=138,3):se===Oe?($e=6,3):($e=7,4))}function fe(j,ee,pe){var me,se,_e=-1,Oe=ee[1],be=0,$e=7,pt=4;for(Oe===0&&($e=138,pt=3),me=0;me<=pe;me++)if(se=Oe,Oe=ee[2*(me+1)+1],!(++be<$e&&se===Oe)){if(be<pt)for(;J(j,se,j.bl_tree),--be!=0;);else se!==0?(se!==_e&&(J(j,se,j.bl_tree),be--),J(j,S,j.bl_tree),q(j,be-3,2)):be<=10?(J(j,x,j.bl_tree),q(j,be-3,3)):(J(j,F,j.bl_tree),q(j,be-11,7));_e=se,pt=(be=0)===Oe?($e=138,3):se===Oe?($e=6,3):($e=7,4)}}c(Y);var ie=!1;function K(j,ee,pe,me){q(j,(l<<1)+(me?1:0),3),(function(se,_e,Oe,be){ke(se),V(se,Oe),V(se,~Oe),s.arraySet(se.pending_buf,se.window,_e,Oe,se.pending),se.pending+=Oe})(j,ee,pe)}i._tr_init=function(j){ie||((function(){var ee,pe,me,se,_e,Oe=new Array(g+1);for(se=me=0;se<u-1;se++)for(C[se]=me,ee=0;ee<1<<R[se];ee++)v[me++]=se;for(v[me-1]=se,se=_e=0;se<16;se++)for(Y[se]=_e,ee=0;ee<1<<P[se];ee++)I[_e++]=se;for(_e>>=7;se<f;se++)for(Y[se]=_e<<7,ee=0;ee<1<<P[se]-7;ee++)I[256+_e++]=se;for(pe=0;pe<=g;pe++)Oe[pe]=0;for(ee=0;ee<=143;)G[2*ee+1]=8,ee++,Oe[8]++;for(;ee<=255;)G[2*ee+1]=9,ee++,Oe[9]++;for(;ee<=279;)G[2*ee+1]=7,ee++,Oe[7]++;for(;ee<=287;)G[2*ee+1]=8,ee++,Oe[8]++;for(xe(G,d+1,Oe),ee=0;ee<f;ee++)O[2*ee+1]=5,O[2*ee]=he(ee,5);z=new N(G,R,h+1,d,g),$=new N(O,P,0,f,g),Q=new N(new Array(0),W,0,m,b)})(),ie=!0),j.l_desc=new M(j.dyn_ltree,z),j.d_desc=new M(j.dyn_dtree,$),j.bl_desc=new M(j.bl_tree,Q),j.bi_buf=0,j.bi_valid=0,ve(j)},i._tr_stored_block=K,i._tr_flush_block=function(j,ee,pe,me){var se,_e,Oe=0;0<j.level?(j.strm.data_type===2&&(j.strm.data_type=(function(be){var $e,pt=4093624447;for($e=0;$e<=31;$e++,pt>>>=1)if(1&pt&&be.dyn_ltree[2*$e]!==0)return o;if(be.dyn_ltree[18]!==0||be.dyn_ltree[20]!==0||be.dyn_ltree[26]!==0)return a;for($e=32;$e<h;$e++)if(be.dyn_ltree[2*$e]!==0)return a;return o})(j)),je(j,j.l_desc),je(j,j.d_desc),Oe=(function(be){var $e;for(T(be,be.dyn_ltree,be.l_desc.max_code),T(be,be.dyn_dtree,be.d_desc.max_code),je(be,be.bl_desc),$e=m-1;3<=$e&&be.bl_tree[2*D[$e]+1]===0;$e--);return be.opt_len+=3*($e+1)+5+5+4,$e})(j),se=j.opt_len+3+7>>>3,(_e=j.static_len+3+7>>>3)<=se&&(se=_e)):se=_e=pe+5,pe+4<=se&&ee!==-1?K(j,ee,pe,me):j.strategy===4||_e===se?(q(j,2+(me?1:0),3),Le(j,G,O)):(q(j,4+(me?1:0),3),(function(be,$e,pt,Ze){var Yt;for(q(be,$e-257,5),q(be,pt-1,5),q(be,Ze-4,4),Yt=0;Yt<Ze;Yt++)q(be,be.bl_tree[2*D[Yt]+1],3);fe(be,be.dyn_ltree,$e-1),fe(be,be.dyn_dtree,pt-1)})(j,j.l_desc.max_code+1,j.d_desc.max_code+1,Oe+1),Le(j,j.dyn_ltree,j.dyn_dtree)),ve(j),me&&ke(j)},i._tr_tally=function(j,ee,pe){return j.pending_buf[j.d_buf+2*j.last_lit]=ee>>>8&255,j.pending_buf[j.d_buf+2*j.last_lit+1]=255&ee,j.pending_buf[j.l_buf+j.last_lit]=255&pe,j.last_lit++,ee===0?j.dyn_ltree[2*pe]++:(j.matches++,ee--,j.dyn_ltree[2*(v[pe]+h+1)]++,j.dyn_dtree[2*U(ee)]++),j.last_lit===j.lit_bufsize-1},i._tr_align=function(j){q(j,2,3),J(j,A,G),(function(ee){ee.bi_valid===16?(V(ee,ee.bi_buf),ee.bi_buf=0,ee.bi_valid=0):8<=ee.bi_valid&&(ee.pending_buf[ee.pending++]=255&ee.bi_buf,ee.bi_buf>>=8,ee.bi_valid-=8)})(j)}},{"../utils/common":41}],53:[function(r,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,n,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,f={},m=!1,p=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,c={}.toString.call(o.process)==="[object process]"?function(S){An.nextTick(function(){b(S)})}:(function(){if(o.postMessage&&!o.importScripts){var S=!0,x=o.onmessage;return o.onmessage=function(){S=!1},o.postMessage("","*"),o.onmessage=x,S}})()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(S){o.postMessage(h+S,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(S){b(S.data)},function(S){u.port2.postMessage(S)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(S){var x=p.createElement("script");x.onreadystatechange=function(){b(S),x.onreadystatechange=null,l.removeChild(x),x=null},l.appendChild(x)}):function(S){setTimeout(b,0,S)},g.setImmediate=function(S){typeof S!="function"&&(S=new Function(""+S));for(var x=new Array(arguments.length-1),F=0;F<x.length;F++)x[F]=arguments[F+1];var R={callback:S,args:x};return f[d]=R,c(d),d++},g.clearImmediate=y}function y(S){delete f[S]}function b(S){if(m)setTimeout(b,0,S);else{var x=f[S];if(x){m=!0;try{(function(F){var R=F.callback,P=F.args;switch(P.length){case 0:R();break;case 1:R(P[0]);break;case 2:R(P[0],P[1]);break;case 3:R(P[0],P[1],P[2]);break;default:R.apply(a,P)}})(x)}finally{y(S),m=!1}}}}function A(S){S.source===o&&typeof S.data=="string"&&S.data.indexOf(h)===0&&b(+S.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Ci<"u"?Ci:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(L0)),L0.exports}var Tz=Az(),M0=js(Tz);const yA={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(yA);var En=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Do,rc,Bs;class Sz{constructor(...e){Do.set(this,new Map),rc.set(this,new Map),Bs.set(this,new Map);for(const r of e)this.define(r)}define(e,r=!1){for(let[n,i]of Object.entries(e)){n=n.toLowerCase(),i=i.map(a=>a.toLowerCase()),En(this,Bs,"f").has(n)||En(this,Bs,"f").set(n,new Set);const s=En(this,Bs,"f").get(n);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s?.add(a),o&&En(this,rc,"f").set(n,a),o=!1,c)continue;const l=En(this,Do,"f").get(a);if(l&&l!=n&&!r)throw new Error(`"${n} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);En(this,Do,"f").set(a,n)}}return this}getType(e){if(typeof e!="string")return null;const r=e.replace(/^.*[/\\]/s,"").toLowerCase(),n=r.replace(/^.*\./s,"").toLowerCase(),i=r.length<e.length;return!(n.length<r.length-1)&&i?null:En(this,Do,"f").get(n)??null}getExtension(e){return typeof e!="string"?null:(e=e?.split?.(";")[0],(e&&En(this,rc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:En(this,Bs,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of En(this,Bs,"f").values())Object.freeze(e);return this}_getTestState(){return{types:En(this,Do,"f"),extensions:En(this,rc,"f")}}}Do=new WeakMap,rc=new WeakMap,Bs=new WeakMap;var Rz=new Sz(yA)._freeze();function Oz(t,e,r){const n=k0();if(!w(n))return;const i=`@charset ${e.toLowerCase().replace(".chr","")}`,s=ja(i,{}),o=gt(s),a=Rh(r),c=At(s);w(a)&&w(c)&&(Object.assign(c,a),ko(n,s),Vo(le,t,`imported chr file ${o} into ${n.name} book`))}function Iz(t,e){console.info(e)}const Nz=/; \$(\w+) ?(.*)/,Cz=/title (.+?) (.*)/i;function U0(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Lz(t,e){const r=k0();if(!w(r))return;const n=e.split(/\r?\n/),i={title:"",gendate:"",gentime:"",songs:[]};function s(m){return i.songs.find(p=>p.order===m)}function o(m,p){return{order:m,title:p,lines:[]}}for(let m=0;m<n.length;++m){const p=n[m],g=Nz.exec(p);if(w(g)){const y=g[1].toLowerCase(),b=g[2];switch(y){case"title":i.title=b;break;case"gendate":i.gendate=b;break;case"gentime":i.gentime=b;break;case"song":{const A=Cz.exec(b);if(w(A)){const S=parseFloat(A[1]),x=A[2],F=s(S);w(F)?F.title=x:i.songs.push(o(S,x))}else{const S=parseFloat(b);if(Te(S)){const x=s(S);w(x)||i.songs.push(o(S,""))}}break}}}else{const y=i.songs[i.songs.length-1];w(y)&&p.trim().length&&y.lines.push(p)}}i.songs.sort((m,p)=>m.order-p.order);const a=i.songs.map(m=>m.title),c=`@play_${Be(i.title).replace(/\W/g,"")}
@cycle 1
@char 14
#end

:touch
"ALBUM: ${U0(i.title)}"
"$purple  ${U0(i.gendate)}"
"$purple  ${U0(i.gentime)}"
${a.map((m,p)=>`!song_${p};${p+1} ${m||"untitled"}`).join(`
`)}
#end

${i.songs.map((m,p)=>`:song_${p}
${m.lines.map(g=>`#play ${g}`).join(`
`)}
#end
`).join(`
`)}
`,l=ja(c,{}),u=gt(l);ko(r,l),Vo(le,t,`imported zzt zzm file ${u} into ${r.name} book`);const h=gt(l),d=Ai(l);yt(le,t,`!pageopen ${l.id};$blue[${d}]$white ${h}`);const f=`#put n ${u}`;aP(le,t,f,f,!1)}const Nu=60,Mz=Nu*25;function Uz(t,e){let r=0;const n=new DataView(e.buffer);function i(){const C=n.getUint8(r);return r++,C}function s(){const C=n.getInt16(r,!0);return r+=2,C}function o(){const C=n.getInt32(r,!0);return r+=4,C}function a(C){let z="";const $=e.subarray(r,r+C);for(let Q=0;Q<$.length;++Q)z+=String.fromCharCode($[Q]);return r+=C,z.replace("\r",`
`)}function c(C,z,$,Q){const Y=an(C,z,$);if(w(Y)&&w(Q)){const N=Mr(Q);for(let M=0;M<N.length;++M){const U=N[M];Y[U]=Q[U]}}}function l(C){let z="";for(let $=0;$<C.length;++$){const Q=C.charCodeAt($);Q<32||Q>127?z+=`$${Q}`:z+=C[$]}return z}function u(C){return C.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(z=>z.replace("$","$CENTER ")).map(l).join(`
`)}function h(C,z,$,Q,Y){const N=Q.color%16,M=Math.floor(Q.color/16)%8,U=uo(N,M),V=uo((M+8)%16,N),q={},J=Y.find(he=>he.x===z&&he.y===$);if(w(J)&&(Te(J.cycle)&&J.cycle>0&&(q.cycle=J.cycle),w(J.p1)&&(q.p1=J.p1),w(J.p2)&&(q.p2=J.p2),w(J.p3)&&(q.p3=J.p3),w(J.code)&&J.code&&(q.code=u(J.code)),w(J.stepx)&&(q.stepx=J.stepx),w(J.stepy)&&(q.stepy=J.stepy),w(J.bind)&&J.bind>0)){const he=Y[J.bind];w(he?.code)&&ye(he.code)&&(q.code=u(he.code))}switch(Q.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(C,["ammo",U],{x:z,y:$},q);break;case 6:c(C,["torch",U],{x:z,y:$},q);break;case 7:c(C,["gem",U],{x:z,y:$},q);break;case 8:c(C,["key",U],{x:z,y:$},q);break;case 9:c(C,["door",V],{x:z,y:$},q);break;case 10:c(C,["scroll",U],{x:z,y:$},q);break;case 11:{q.p3=d(J?.p3)??"",c(C,["passage",U],{x:z,y:$},q);break}case 12:c(C,["duplicator",U],{x:z,y:$},{...q,stepx:0,stepy:0,shootx:q.stepx??0,shooty:q.stepy??0});break;case 13:c(C,["bomb",U],{x:z,y:$},q);break;case 14:c(C,["energize",U],{x:z,y:$},q);break;case 15:c(C,["star",U],{x:z,y:$},q);break;case 16:c(C,["clockwise",U],{x:z,y:$},q);break;case 17:c(C,["counter",U],{x:z,y:$},q);break;case 18:c(C,["bullet",U],{x:z,y:$},q);break;case 19:c(C,["water",U],{x:z,y:$},q);break;case 20:c(C,["forest",U],{x:z,y:$},q);break;case 21:c(C,["solid",U],{x:z,y:$},q);break;case 22:c(C,["normal",U],{x:z,y:$},q);break;case 23:c(C,["breakable",U],{x:z,y:$},q);break;case 24:c(C,["boulder",U],{x:z,y:$},q);break;case 25:c(C,["sliderns",U],{x:z,y:$},q);break;case 26:c(C,["sliderew",U],{x:z,y:$},q);break;case 27:c(C,["fake",U],{x:z,y:$},q);break;case 28:c(C,["invisible",U],{x:z,y:$},q);break;case 29:c(C,["blinkwall",U],{x:z,y:$},{...q,stepx:0,stepy:0,shootx:q.stepx??0,shooty:q.stepy??0});break;case 30:c(C,["transporter",U],{x:z,y:$},{...q,stepx:0,stepy:0,shootx:q.stepx??0,shooty:q.stepy??0});break;case 31:c(C,["line",U],{x:z,y:$},q);break;case 32:c(C,["ricochet",U],{x:z,y:$},q);break;case 33:c(C,["blinkns",U],{x:z,y:$},q);break;case 34:c(C,["bear",U],{x:z,y:$},q);break;case 35:c(C,["ruffian",U],{x:z,y:$},q);break;case 36:c(C,["object",U],{x:z,y:$},{...q,char:J?.p1??1});break;case 37:c(C,["slime",U],{x:z,y:$},q);break;case 38:c(C,["shark",U],{x:z,y:$},q);break;case 39:c(C,["spinninggun",U],{x:z,y:$},q);break;case 40:c(C,["pusher",U],{x:z,y:$},q);break;case 41:c(C,["lion",U],{x:z,y:$},q);break;case 42:c(C,["tiger",U],{x:z,y:$},q);break;case 43:c(C,["blinkns",U],{x:z,y:$},q);break;case 44:c(C,["head",U],{x:z,y:$},q);break;case 45:c(C,["segment",U],{x:z,y:$},q);break;case 46:break;case 47:c(C,["text",["WHITE","ONDKBLUE"]],{x:z,y:$},{...q,char:Q.color});break;case 48:c(C,["text",["WHITE","ONDKGREEN"]],{x:z,y:$},{...q,char:Q.color});break;case 49:c(C,["text",["WHITE","ONDKCYAN"]],{x:z,y:$},{...q,char:Q.color});break;case 50:c(C,["text",["WHITE","ONDKRED"]],{x:z,y:$},{...q,char:Q.color});break;case 51:c(C,["text",["WHITE","ONDKPURPLE"]],{x:z,y:$},{...q,char:Q.color});break;case 52:c(C,["text",["WHITE","ONDKYELLOW"]],{x:z,y:$},{...q,char:Q.color});break;case 53:c(C,["text",["WHITE","ONBLACK"]],{x:z,y:$},{...q,char:Q.color});break}}function d(C){if(Te(C)&&C>0)return`zztboard${C}`}if(s()!=-1)return;const m=s(),p=s(),g=s(),y=a(7),b=s(),A=s(),S=s(),x=s(),F=s();s();const R=s(),P=i(),W=a(20).slice(0,P);for(let C=0;C<9;C++){const z=i();a(20).slice(0,z)}const D=s(),G=s(),O=i();console.info(p,g,y,b,A,S,x,F,R,D,G,O),r=512;const I=[];for(let C=0;C<=m;++C){const z=s(),$=r,Q=i(),N={boardname:a(50).slice(0,Q),elements:[],stats:[]};for(;N.elements.length<Mz;){let U=i();U===0&&(U=255);const V=i(),q=i();for(let J=0;J<U;++J)N.elements.push({element:V,color:q})}N.maxplayershots=i(),N.isdark=i(),N.exitnorth=i(),N.exitsouth=i(),N.exitwest=i(),N.exiteast=i(),N.restartonzap=i(),N.messagelength=i(),N.message=a(58).slice(0,N.messagelength),N.playerenterx=i(),N.playerentery=i(),N.timelimit=s(),r+=16;const M=s()+1;for(;N.stats.length<M;){const U={};U.x=i()-1,U.y=i()-1,U.stepx=s(),U.stepy=s(),U.cycle=s(),U.p1=i(),U.p2=i(),U.p3=i(),U.follower=s(),U.leader=s(),U.underelement=i(),U.undercolor=i(),U.pointer=o(),U.currentinstruction=s();const V=s();r+=8,V<0?U.bind=Math.abs(V):U.code=a(V),N.stats.push(U)}I.push(N),r=$+z}const v=$d([]);v.name=W;for(let C=0;C<I.length;++C){const z=I[C],$=[`@zztboard${C}`,""];C===0?$.push("@title"):C===A&&$.push("@zztstartboard");for(let xe=0;xe<z.elements.length;++xe)z.elements[xe].element===4&&($.push(`@startx ${fy(xe,Nu)}`),$.push(`@starty ${hy(xe,Nu)}`));Te(z.maxplayershots)&&$.push(`@maxplayershots ${z.maxplayershots}`),Te(z.isdark)&&$.push(`@isdark ${z.isdark}`),Te(z.restartonzap)&&$.push(`@restartonzap ${z.restartonzap}`),Te(z.timelimit)&&$.push(`@timelimit ${z.timelimit}`);const Q=d(z.exitnorth);ye(Q)&&$.push(`@exitnorth ${Q}`);const Y=d(z.exitsouth);ye(Y)&&$.push(`@exitsouth ${Y}`);const N=d(z.exitwest);ye(N)&&$.push(`@exitwest ${N}`);const M=d(z.exiteast);ye(M)&&$.push(`@exiteast ${M}`);const U=`@board ${String(C).padStart(3,"0")}. ${z.boardname}
${$.join(`
`)}`,V=ja(U,{});ko(v,V);const q=At(V);if(!w(q))continue;let J=0,he=0;for(let xe=0;xe<z.elements.length;++xe){const ve=z.elements[xe];h(q,J,he,ve,z.stats),++J,J===Nu&&(J=0,++he)}cr(q)}xu(v),Vo(le,t,`imported zzt file into ${v.name} book`)}function Fz(t,e,r){const n=k0();if(!w(n))return;const s=Zl(r).name?r:`@${e.toLowerCase().replace(".obj","")}
${r}`,o=ja(s,{}),a=gt(o);ko(n,o),Vo(le,t,`imported zzt obj file ${a} into ${n.name} book`)}function _A(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return Rz.getType(t)??"application/octet-stream"}function bA(t,e){if(!w(e))return"";switch(t){case"model/obj":return"obj";case"text/plain":return"txt";case"application/json":return"json";case"application/zip":return"zip";case"application/octet-stream":if(/.zzt$/i.test(e.name))return"zzt";if(/.brd$/i.test(e.name))return"brd";if(/.chr$/i.test(e.name))return"chr";if(/.zzl$/i.test(e.name))return"zzl";if(/.zzm$/i.test(e.name))return"zzm";break}return""}let jo=[],Cu={};async function Pz(t,e){try{Pt(le,t,"parsezipfile",e.name);const r=await e.arrayBuffer(),i=await new M0().loadAsync(r);jo=[],Cu={};const s=[];i.forEach((o,a)=>s.push([o,a]));for(let o=0;o<s.length;++o){const[a,c]=s[o],l=await c.async("uint8array"),u=_A(a,l),h=new File([l],c.name,{type:u});jo.push(h)}kS(le,t)}catch(r){mt(le,t,"crash",r.message)}}function $z(){const t=[];for(let e=0;e<jo.length;++e){const r=jo[e];t.push([bA(r.type,r),r.name])}return t}function Bz(t,e){Cu[t.toLowerCase()]=e}function Dz(t){return Cu[t.toLowerCase()]}async function jz(t){for(let e=0;e<jo.length;++e){const r=jo[e];Cu[r.name.toLowerCase()]&&(F0(t,r),await hc(2e3))}await hc(2e3),hf(le,t)}function wA(t,e,r){if(!w(r))return;switch(bA(e,r)){case"obj":r.text().then(i=>Fz(t,r.name,i)).catch(i=>mt(le,t,"crash",i.message));break;case"txt":r.text().then(i=>df(le,t,void 0,"text",`file:${r.name}`,i)).catch(i=>mt(le,t,"crash",i.message));break;case"json":r.text().then(i=>df(le,t,void 0,"json",`file:${r.name}`,i)).catch(i=>mt(le,t,"crash",i.message));break;case"zip":Pz(t,r).catch(i=>mt(le,t,"crash",i.message));break;case"zzt":r.arrayBuffer().then(i=>{Uz(t,new Uint8Array(i))}).catch(i=>mt(le,t,"crash",i.message));break;case"brd":r.arrayBuffer().then(i=>{}).catch(i=>mt(le,t,"crash",i.message));break;case"chr":r.arrayBuffer().then(i=>{Oz(t,r.name,new Uint8Array(i))}).catch(i=>mt(le,t,"crash",i.message));break;case"zzl":r.text().then(i=>{Iz(t,i)}).catch(i=>mt(le,t,"crash",i.message));break;case"zzm":r.text().then(i=>{Lz(t,i)}).catch(i=>mt(le,t,"crash",i.message));break;default:e||r.arrayBuffer().then(i=>{const s=_A(r.name,new Uint8Array(i));if(s)wA(t,s,r);else return mt(le,t,"parsewebfile",`unsupported file ${r.name}`)}).catch(i=>mt(le,t,"crash",i.message));return}}function F0(t,e){wA(t,e?.type??"",e)}const Lu="https://bridge.zed.cafe";async function zz(t,e,r){const n=`offset=${r}&${t}=${e}`,i=new Request(`${Lu}/api/v1/search/files/?${n}`);return(await(await fetch(i)).json()).data.results}async function Wz(){const t=new Request(`${Lu}/api/v1/get/random-file/`);return[(await(await fetch(t)).json()).data]}function Hz(t){return`${Lu}/static/${t}`}async function Gz(t,e){const n=await(await fetch(`${Lu}/zgames/${e}`)).arrayBuffer(),i=new File([n],e);F0(t,i)}function qr(t,e,r){r().catch(n=>{console.error(n),mt(t,e,"crash",n?.message)})}function Kz(t){const[e,r]=t.split(":"),n=w(r);return[n?e:"self",n?r:t]}var we=typeof we<"u"?we:{},nc={},Zi;for(Zi in we)we.hasOwnProperty(Zi)&&(nc[Zi]=we[Zi]);var zo=we.printErr||console.warn.bind(console);for(Zi in nc)nc.hasOwnProperty(Zi)&&(we[Zi]=nc[Zi]);var P0=(t,e)=>{throw e};nc=null,we.arguments&&we.arguments,we.thisProgram&&(thisProgram=we.thisProgram),we.quit&&(P0=we.quit),typeof WebAssembly!="object"&&$0("no native wasm support detected");var Mu,Uu=!1,Fu,vA;function EA(){var t=Mu.buffer;we.HEAP8=new Int8Array(t),we.HEAPU8=vA=new Uint8Array(t)}var kA=[],xA=[],AA=[];function qz(){if(we.preRun)for(typeof we.preRun=="function"&&(we.preRun=[we.preRun]);we.preRun.length;)Xz(we.preRun.shift());B0(kA)}function Yz(){B0(xA)}function Vz(){if(we.postRun)for(typeof we.postRun=="function"&&(we.postRun=[we.postRun]);we.postRun.length;)Jz(we.postRun.shift());B0(AA)}function Xz(t){kA.unshift(t)}function Zz(t){xA.unshift(t)}function Jz(t){AA.unshift(t)}var Ds=0,ic=null;function Qz(t){var e;Ds++,(e=we.monitorRunDependencies)===null||e===void 0||e.call(we,Ds)}function e7(t){var e;if(Ds--,(e=we.monitorRunDependencies)===null||e===void 0||e.call(we,Ds),Ds==0&&ic){var r=ic;ic=null,r()}}function $0(t){var e;(e=we.onAbort)===null||e===void 0||e.call(we,t),t="Aborted("+t+")",zo(t),Uu=!0,t+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(t);throw r}function t7(){return{a:g7}}function r7(t){return fetch(t,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})}function n7(t){var e=t7();function r(a,c){return mr=a.exports,Mu=mr.f,EA(),Zz(mr.g),e7(),mr}Qz();function n(a){r(a.instance)}function i(a){return r7(t).then(function(c){var l=WebAssembly.instantiate(c,e);return l}).then(a,function(c){zo("failed to asynchronously prepare wasm: "+c),$0(c)})}function s(){return t&&t.byteLength>0?WebAssembly.instantiate(t,e).then(n,function(a){zo("wasm compile failed: "+a)}):typeof WebAssembly.instantiateStreaming=="function"&&typeof t=="string"&&typeof fetch=="function"?fetch(t,{credentials:"same-origin"}).then(function(a){var c=WebAssembly.instantiateStreaming(a,e);return c.then(n,function(l){return zo("wasm streaming compile failed: "+l),zo("falling back to ArrayBuffer instantiation"),i(n)})}):i(n)}if(we.instantiateWasm)try{var o=we.instantiateWasm(e,r);return o}catch(a){return zo("Module.instantiateWasm callback failed with error: "+a),!1}return s(),{}}class TA{constructor(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}}var B0=t=>{for(;t.length>0;)t.shift()(we)},SA=we.noExitRuntime||!0,i7=()=>$0(""),RA=0,s7=()=>{SA=!1,RA=0},sc={},OA=t=>{if(t instanceof TA||t=="unwind")return Fu;P0(1,t)},IA=()=>SA||RA>0,NA=t=>{var e;Fu=t,IA()||((e=we.onExit)===null||e===void 0||e.call(we,t),Uu=!0),P0(t,new TA(t))},o7=(t,e)=>{Fu=t,NA(t)},a7=o7,c7=()=>{if(!IA())try{a7(Fu)}catch(t){OA(t)}},l7=t=>{if(!Uu)try{t(),c7()}catch(e){OA(e)}},u7=()=>performance.now(),f7=(t,e)=>{if(sc[t]&&(clearTimeout(sc[t].id),delete sc[t]),!e)return 0;var r=setTimeout(()=>{delete sc[t],l7(()=>CA(t,u7()))},e);return sc[t]={id:r,timeout_ms:e},0},h7=()=>2147483648,d7=(t,e)=>Math.ceil(t/e)*e,p7=t=>{var e=Mu.buffer,r=(t-e.byteLength+65535)/65536|0;try{return Mu.grow(r),EA(),1}catch{}},m7=t=>{var e=vA.length;t>>>=0;var r=h7();if(t>r)return!1;for(var n=1;n<=4;n*=2){var i=e*(1+.2/n);i=Math.min(i,t+100663296);var s=Math.min(r,d7(Math.max(t,i),65536)),o=p7(s);if(o)return!0}return!1},g7={c:i7,b:s7,d:f7,e:m7,a:NA},mr;we._ZSTD_isError=t=>(we._ZSTD_isError=mr.h)(t),we._ZSTD_compressBound=t=>(we._ZSTD_compressBound=mr.i)(t),we._ZSTD_createCCtx=()=>(we._ZSTD_createCCtx=mr.j)(),we._ZSTD_freeCCtx=t=>(we._ZSTD_freeCCtx=mr.k)(t),we._ZSTD_compress_usingDict=(t,e,r,n,i,s,o,a)=>(we._ZSTD_compress_usingDict=mr.l)(t,e,r,n,i,s,o,a),we._ZSTD_compress=(t,e,r,n,i)=>(we._ZSTD_compress=mr.m)(t,e,r,n,i),we._ZSTD_createDCtx=()=>(we._ZSTD_createDCtx=mr.n)(),we._ZSTD_freeDCtx=t=>(we._ZSTD_freeDCtx=mr.o)(t),we._ZSTD_getFrameContentSize=(t,e)=>(we._ZSTD_getFrameContentSize=mr.p)(t,e),we._ZSTD_decompress_usingDict=(t,e,r,n,i,s,o)=>(we._ZSTD_decompress_usingDict=mr.q)(t,e,r,n,i,s,o),we._ZSTD_decompress=(t,e,r,n)=>(we._ZSTD_decompress=mr.r)(t,e,r,n),we._malloc=t=>(we._malloc=mr.s)(t),we._free=t=>(we._free=mr.t)(t);var CA=(t,e)=>(CA=mr.v)(t,e),Pu;ic=function t(){Pu||LA(),Pu||(ic=t)};function LA(){if(Ds>0||(qz(),Ds>0))return;function t(){var e;Pu||(Pu=!0,we.calledRun=!0,!Uu&&(Yz(),(e=we.onRuntimeInitialized)===null||e===void 0||e.call(we),Vz()))}we.setStatus?(we.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>we.setStatus(""),1),t()},1)):t()}if(we.run=LA,we.preInit)for(typeof we.preInit=="function"&&(we.preInit=[we.preInit]);we.preInit.length>0;)we.preInit.pop()();we.init=n7;var y7=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const _7=new Promise(t=>{we.onRuntimeInitialized=t}),b7=()=>y7(void 0,void 0,void 0,function*(){yield _7}),MA=t=>{const e=we._ZSTD_isError;return e(t)},w7=(t,e)=>{const r=we._ZSTD_getFrameContentSize;return r(t,e)},v7=(t,e={defaultHeapSize:1024*1024})=>{const r=we._malloc,n=r(t.byteLength);we.HEAP8.set(t,n);const i=w7(n,t.byteLength),s=i===-1?e.defaultHeapSize:i,o=we._free,a=r(s);try{const c=we._ZSTD_decompress,l=c(a,s,n,t.byteLength);if(MA(l))throw new Error(`Failed to compress with code ${l}`);const u=new Uint8Array(we.HEAPU8.buffer,a,l).slice();return o(a,s),o(n,t.byteLength),u}catch(c){throw o(a,s),o(n,t.byteLength),c}},E7=t=>{const e=we._ZSTD_compressBound;return e(t)},k7=(t,e)=>{const r=E7(t.byteLength),n=we._malloc,i=n(r),s=n(t.byteLength);we.HEAP8.set(t,s);const o=we._free;try{const a=we._ZSTD_compress,c=a(i,r,s,t.byteLength,e??3);if(MA(c))throw new Error(`Failed to compress with code ${c}`);const l=new Uint8Array(we.HEAPU8.buffer,i,c).slice();return o(i,r),o(s,t.byteLength),l}catch(a){throw o(i,r),o(s,t.byteLength),a}};var x7=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const A7=t=>x7(void 0,void 0,void 0,function*(){const e=new URL("/assets/zstd-CV7N7xSg.wasm",self.location.href).href;we.init(e),yield b7()});let UA=!1;async function FA(){UA||(await A7(),UA=!0)}function T7(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-e.length%4)%4);return e+r}function S7(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const R7=new Date("1980/09/02");async function D0(t){await FA(),console.info("saved",t);const e=new M0;for(let n=0;n<t.length;++n){const i=t[n],s=iF(i);if(s){const o=_N(s);if(w(o)){const a=k7(o,15);e.file(i.id,a,{date:R7})}}}const r=await e.generateAsync({type:"base64",compression:"STORE"});return S7(r)}async function O7(t){await FA();const e=T7(t),r=await M0.loadAsync(e,{base64:!0}),n=[],i=[];r.forEach((s,o)=>i.push(o));for(let s=0;s<i.length;++s){const o=i[s],a=await o.async("uint8array");if(w(a))try{const c=v7(a),l=Sh(c);if(w(l)){const u=Dd(l);w(u)&&n.push(u)}}catch{const l=Sh(a);if(w(l)){const u=Dd(l);w(u)&&n.push(u)}}else{const c=await o.async("string"),l=Sh(c);if(w(l)){const u=Dd(l);w(u)&&n.push(u)}}}return n}function I7(t,e,r,n){const i=Ht(t);if(!w(i))return;let s=0;function o(){return s}function a(l,u){Te(u)&&(s=u,py(e.x,e.y,r.x,r.y).forEach(h=>{const d=nt(i,h);w(d)&&(d[l]=u)}))}Pe(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,`batch:${ao(e,r)}`,"char",[n,"charedit"],o,a);const c=Rt(t);c.scrollname="bulk set char",c.scroll=rr(t)}function N7(t,e,r,n){const i=Ht(t);if(!w(i))return;let s=0;function o(){return s}function a(l,u){if(Te(u)){s=u;for(let h=e.y;h<=r.y;++h)for(let d=e.x;d<=r.x;++d){const f=nt(i,{x:d,y:h});w(f)&&(f[l]=u)}}}Pe(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,`batch:${ao(e,r)}`,"color",[n,"coloredit"],o,a);const c=Rt(t);c.scrollname="bulk set color",c.scroll=rr(t)}function C7(t,e,r,n){const i=Ht(t);if(!w(i))return;let s=0;function o(){return s}function a(l,u){Te(u)&&(s=u,py(e.x,e.y,r.x,r.y).forEach(h=>{const d=nt(i,h);w(d)&&(d[l]=u)}))}Pe(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,`batch:${ao(e,r)}`,"color",[n,"coloredit"],o,a);const c=Rt(t);c.scrollname="bulk set bg",c.scroll=rr(t)}function L7(t,e,r,n){const i=lr(Xe.MAIN);if(!w(i))return;const s=Ht(t);if(!w(s))return;const o=ao(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),De(t,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),n&&De(t,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),De(t,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),De(t,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Pe(t,qt),De(t,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),De(t,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),De(t,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Pe(t,qt),De(t,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Pe(t,qt),Pe(t,"codepages:");const a=Math.min(e.x,r.x),c=Math.min(e.y,r.y),l=Math.max(e.x,r.x),u=Math.max(e.y,r.y),h=new Set;for(let f=c;f<=u;++f)for(let m=a;m<=l;++m){const p=nt(s,{x:m,y:f}),g=wE(i,p);w(g)&&!h.has(g.id)&&(h.add(g.id),De(t,"batch",`edit @${gt(g)}`,[`pageopen:${g.id}`]))}const d=ur(Re.BOARD,s.id);Pe(t,gt(d)),De(t,"batch",`id ${s.id}`,["","copyit",s.id]),De(t,"batch","edit @board codepage",[`pageopen:${s.id}`])}function j0(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function M7(t,e){let r;const n=()=>{if(r)return r;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),r=j0(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(e,i).objectStore(e)))}let z0;function PA(){return z0||(z0=M7("keyval-store","keyval")),z0}function $A(t,e=PA()){return e("readonly",r=>j0(r.get(t)))}function BA(t,e,r=PA()){return r("readwrite",n=>new Promise((i,s)=>{n.get(t).onsuccess=function(){try{n.put(e(this.result),t),i(j0(n.transaction))}catch(o){s(o)}}}))}function W0(t,e){return`${t.x},${t.y},${e.x},${e.y}`}async function DA(){return $A("secretheap")}async function jA(t){return BA("secretheap",t)}async function U7(){return!!await DA()}function zA(t,e,r){const n=Math.min(e.x,r.x),i=Math.min(e.y,r.y),s=Math.max(e.x,r.x),o=Math.max(e.y,r.y),a=s-n+1,c=o-i+1,l=[],u=[];for(let h=i;h<=o;++h)for(let d=n;d<=s;++d){const f={x:d-n,y:h-i},m=nt(t,{x:d,y:h});m?.category===Ur.ISOBJECT?(l.push(xn(Xi(t,d,h))),er(m).name!=="player"&&u.push({...xn(m),...f,id:"blank"})):l.push({...xn(m),...f})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}async function F7(t,e,r,n){const i=Ht(t);if(!w(i))return;const s=zA(i,e,r);switch(n){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await jA(()=>s)}function P7(t,e,r){const n=W0(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","copy terrain & objects",[`copyall:${n}`,"hk","1"]),De(t,"batch","copy objects",[`copyobjects:${n}`,"hk","2"]),De(t,"batch","copy terrain",[`copyterrain:${n}`,"hk","3"]);const i=Rt(t);i.scrollname="copy",i.scroll=rr(t)}async function $7(t,e,r,n){const i=lr(Xe.MAIN);if(!w(i))return;const s=Ht(t);if(!w(s))return;const o=zA(s,e,r);switch(n){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(n){case"cutall":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c){const l=nt(s,{x:c,y:a});l?.category===Ur.ISOBJECT&&dr(s,l,i.timestamp),St(s,{x:c,y:a})}break}case"cutobjects":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c){const l=nt(s,{x:c,y:a});l?.category===Ur.ISOBJECT&&dr(s,l,i.timestamp)}break}case"cutterrain":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c)St(s,{x:c,y:a});break}}await jA(()=>o)}function B7(t,e,r){const n=W0(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","cut terrain & objects",[`cutall:${n}`,"hk","1"]),De(t,"batch","cut objects",[`cutobjects:${n}`,"hk","2"]),De(t,"batch","cut terrain",[`cutterrain:${n}`,"hk","3"]);const i=Rt(t);i.scrollname="cut",i.scroll=rr(t)}async function D7(t,e,r,n){const i=Ht(t),s=await DA();if(!w(i)||!w(s))return;const o=Math.min(e.x,r.x),a=Math.min(e.y,r.y),c=Math.max(e.x,r.x),l=Math.max(e.y,r.y),u=c-o+1,h=l-a+1,d=Math.min(s.width,u),f=Math.min(s.height,h);switch(n){case"pasteall":{for(let m=0;m<f;++m)for(let p=0;p<d;++p){const g=Qr({x:p,y:m},s.width);St(i,{...s.terrain[g],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&sh(p.x,p.y,0,u-1,h-1,0)&&R0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&sh(p.x,p.y,0,u-1,h-1,0)&&R0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<f;++m)for(let p=0;p<d;++p){const g=Qr({x:p,y:m},s.width);St(i,{...s.terrain[g],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const g=(p-o)%s.width,y=(m-a)%s.height,b=Qr({x:g,y},s.width);St(i,{...s.terrain[b],x:p,y:m})}break}}function j7(t,e,r){const n=W0(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","paste terrain & objects",[`pasteall:${n}`,"hk","1"]),De(t,"batch","paste objects",[`pasteobjects:${n}`,"hk","2"]),De(t,"batch","paste terrain",[`pasteterrain:${n}`,"hk","3"]),De(t,"batch","paste terrain tiled",[`pasteterraintiled:${n}`,"hk","4"]);const i=Rt(t);i.scrollname="paste",i.scroll=rr(t)}function H0(t,e){return`inspect:${e?.id?e.id:Ni(t,e)}`}function z7(t,e,r){const n=lr(Xe.MAIN);if(!w(n))return;const i=Ht(t);if(!w(i))return;function s(d){return e?.[d]??e?.kinddata?.[d]??0}function o(d,f){w(e)&&(e[d]=f)}const a=e.category===Ur.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=H0(i,e);Pe(t,`${a}: ${c} ${l}`),Pe(t,qt),De(t,u,"color",[r,"coloredit"],s,o);const h=Rt(t);h.scrollname="color",h.scroll=rr(t)}function W7(t,e,r){const n=lr(Xe.MAIN);if(!w(n))return;const i=Ht(t);if(!w(i))return;function s(d){return e?.[d]??e?.kinddata?.[d]??0}function o(d,f){w(e)&&(e[d]=f)}const a=e.category===Ur.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=H0(i,e);Pe(t,`${a}: ${c} ${l}`),Pe(t,qt),De(t,u,"char",[r,"charedit"],s,o);const h=Rt(t);h.scrollname="char",h.scroll=rr(t)}function H7(t,e,r,n,i,s){const o=lr(Xe.MAIN);if(!w(o))return;function a(m){const p=n?.[m]??n?.kinddata?.[m];if(!w(p))switch(m){case"color":return 15;case"bg":return 0;case"cycle":return Tm;case"collision":return We.ISWALK;case"pushable":return 0;case"breakable":return 0}return p}function c(m,p){w(n)&&(n[m]=p)}s?Pe(t,`object: ${n.name??n.kind??"ERR"} ${i.x}, ${i.y}`):Pe(t,`terrain: ${n.kind??"ERR"} ${i.x}, ${i.y}`);const l=H0(e,n);switch(s&&Pe(t,`cycle: ${He(n,"cycle")}`),He(n,"collision")){case We.ISWALK:Pe(t,"collision: iswalk");break;case We.ISSWIM:Pe(t,"collision: isswim");break;case We.ISSOLID:Pe(t,"collision: issolid");break;case We.ISBULLET:Pe(t,"collision: isbullet");break;case We.ISGHOST:Pe(t,"collision: isghost");break}s&&Pe(t,`ispushable: ${He(n,"pushable")?"yes":"no"}`),Pe(t,`isbreakable: ${He(n,"breakable")?"yes":"no"}`),Pe(t,qt);const h=za(r),d=Mr(h);for(let m=0;m<d.length;++m){const p=d[m];switch(p){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ut(h[p])){const[g,y,...b]=h[p];ye(y)&&De(t,l,y||p,[p,g,...b],a,c)}break}}De(t,l,"copy coords",["copycoords","hk","5"," 5 "]),Pe(t,qt),De(t,l,`char: ${n.char??n.kinddata?.char??1}`,["char","hk","a"," A ","next"],a,c),De(t,l,`color: ${n.color??n.kinddata?.color??15}`,["color","hk","c"," C ","next"],a,c),De(t,l,`bg: ${n.bg??n.kinddata?.bg??0}`,["bg","hk","b"," B ","next"],a,c),Pe(t,qt),De(t,l,"make empty",["empty","hk","0"],a,c),Pe(t,qt),De(t,"batch",`edit @${gt(r)}`,[`pageopen:${r.id}`]);const f=ur(Re.BOARD,e.id);Pe(t,gt(f)),De(t,"batch",`id ${e.id}`,["","copyit",e.id]),De(t,"batch","edit @board codepage",[`pageopen:${e.id}`])}function G7(t,e,r,n){const i=lr(Xe.MAIN);if(!w(i))return;const s=Ht(t);if(w(s))switch(n){case"emptyall":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a){const c=nt(s,{x:a,y:o});c?.category===Ur.ISOBJECT&&dr(s,c,i.timestamp),St(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a){const c=nt(s,{x:a,y:o});c?.category===Ur.ISOBJECT&&dr(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a)St(s,{x:a,y:o});break}}}function K7(t,e,r){const n=lr(Xe.MAIN);if(!w(n))return;const i=Ht(t);if(!w(i))return;const s=ao(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt),De(t,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),De(t,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),De(t,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Rt(t);o.scrollname="empty",o.scroll=rr(t)}async function q7(t,e,r){const n=lr(Xe.MAIN),i=await U7();if(!w(n))return;const s=Ht(t);if(!w(s))return;if(cr(s),e.x===r.x&&e.y===r.y){const a=nt(s,e),c=wE(n,a);if(w(a)&&w(c)&&H7(t,s,c,a,e,jt(a)),!a?.kind){Pe(t,`empty: ${e.x}, ${e.y}`),Pe(t,qt),De(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]);const l=ur(Re.BOARD,s.id);Pe(t,gt(l)),De(t,"batch",`id ${s.id}`,["","copyit",s.id]),De(t,"batch","edit @board codepage",[`pageopen:${s.id}`])}}else L7(t,e,r,i);const o=Rt(t);o.scrollname="inspect",o.scroll=rr(t)}function Y7(t,e){const r=dt(Xe.MAIN);if(!w(r))return;const n=Ht(e);if(!w(n))return;const i=Fr(t),s=lA(n,i.target);if(w(s))switch(i.path){case"copycoords":uf(le,wr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":z7(e,s,i.path);break;case"char":W7(e,s,i.path);break;case"empty":dr(n,s,r.timestamp);break;case"code":qr(le,e,async()=>{const o="object",a=[n.id,s.id];ih(uc(r.id,a),s.code??""),XT(le,e),await hc(800),km(le,e,r.id,a,o,`${name} - ${r.name}`)});break;default:console.info("unknown inspect",i);break}}async function V7(t,e){const r=Ht(e);if(!w(r))return;const n=Fr(t),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"copy":P7(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await F7(e,c,l,n.target);break;case"cut":B7(e,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await $7(e,c,l,n.target);break;case"paste":j7(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await D7(e,c,l,n.target);break;case"empty":K7(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":G7(e,c,l,n.target);break;case"chars":I7(e,c,l,"char");break;case"colors":N7(e,c,l,"color");break;case"bgs":C7(e,c,l,"bg");break;case"copycoords":uf(le,e,[i,s,o,a].join(" "));break;case"pageopen":qr(le,e,async()=>{await hc(800),xS(le,e,`#pageopen ${n.path}`)});break;default:console.info("unknown batch",n);break}}async function X7(){return $A("remixconfig")}async function Z7(t){return BA("remixconfig",t)}let Ji={stat:"",patternsize:2,mirror:1};async function J7(t,e){const r=Ht(e);if(!w(r))return;const n=Fr(t),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"remix":{await Q7(e,c,l);break}case"remixrun":{const u=fr(Ji.stat);w(u)&&gk(r.id,u.id,Ji.patternsize,Ji.mirror,c,l,"all"),await Z7(()=>Ji);break}default:console.info("unknown remix",n);break}}async function Q7(t,e,r){const n=await X7();Ji={...Ji,...n};const i=ao(e,r);Pe(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Pe(t,qt);function s(c){const{target:l}=Fr(c);return Ji[l]}function o(c,l){if(Te(l)||ye(l)){const{target:u}=Fr(c);Ji[u]=l}}De(t,"remix","source board",[`stat:${i}`,"text"],s,o),De(t,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),De(t,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Pe(t,qt),De(t,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Rt(t);a.scrollname="remix",a.scroll=rr(t)}const eW=16,Qi={},$u={},tW=60;let WA=0;const Wo={},Bu={};async function HA(t){const e=wn(),r=dt(Xe.MAIN);if(e.length&&w(r)){const n=await D0(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${r.name} ${n.length} chars`;QT(et,wr(),i,n)}}async function rW(){const t=wn(),e=dt(Xe.MAIN);if(t.length&&w(e)){const r=await D0(t);eS(et,wr(),r)}}async function nW(){const t=wn(),e=dt(Xe.MAIN);return t.length&&w(e)?D0(t):""}const GA="$176$176$177$177$178 ZZT BRIDGE $178$177$177$176$176";function KA(t){Pe(t,`Searching ${"$6".repeat(hn(1,6))}`);const e=Rt(t);e.scrollname=GA,e.scroll=rr(t)}function qA(t,e){for(let n=0;n<t.length;++n){const i=t[n],s=`pub: ${new Date(i.publish_date).toLocaleDateString()}`;Pe(e,`$white${i.title}`),Pe(e,`$yellow  ${i.author.join(", ")}`),Pe(e,`$dkgreen  ${i.genres.join(", ")}`),Pe(e,`$purple  ${s}`),i.screenshot&&De(e,"zztbridge",i.screenshot,["screenshot","viewit",Hz(i.screenshot)]),De(e,"zztbridge",i.filename,["zztimport","hyperlink",`${i.letter}/${i.filename}`]),Pe(e," ")}const r=Rt(e);r.scrollname=GA,r.scroll=rr(e)}const Du={},et=Ws("vm",["tick","second"],t=>{if(!et.session(t))return;const e=wr();switch(t.target){case"operator":Kj(t.player),Pt(et,t.player,`operator set to ${t.player}`),et.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=dt(Xe.MAIN);et.replynext(t,"ackzsswords",{cli:pp(qi.CLI),loader:pp(qi.LOADER),runtime:pp(qi.RUNTIME),flags:[...Mr(Kr(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","playerid","playerx","playery","thisid","thisx","thisy","senderid","senderx","sendery","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isghost","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"],kinds:[...Ss(r,Re.OBJECT).map(n=>gt(n)),...Mr(ap)],altkinds:[...Ss(r,Re.TERRAIN),...Ss(r,Re.BOARD),...Ss(r,Re.PALETTE),...Ss(r,Re.CHARSET),...Ss(r,Re.LOADER)].map(n=>gt(n)),colors:[...Mr(ha)],dirs:[...Mr(hh).filter(n=>["cw","ccw","oop","rndp"].includes(n)===!1)],dirmods:["cw","ccw","oop","rndp",...Mr(sp)],exprs:["aligned","alligned","contact","blocked","any","countof","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":t.player===e&&qr(et,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data,i=await O7(r),s=i.map(o=>o.name);Qj(i,n),Pt(et,t.player,`loading ${s.join(", ")}`),lf(et,t.player)}});break;case"search":rz(t.player)||lf(et,t.player);break;case"logout":tz(t.player),delete Qi[t.player],Pt(et,e,`player ${t.player} logout`),lf(et,t.player);break;case"login":Qx(t.player)?(ZT(et,t.player),Qi[t.player]=0,Pt(et,wr(),`login from ${t.player}`),et.replynext(t,"acklogin",!0)):bm(et,t.player);break;case"local":Qx(t.player)?(Qi[t.player]=0,Pt(et,wr(),`login from ${t.player}`)):bm(et,t.player);break;case"doot":Qi[t.player]=0,$u[t.player]=$u[t.player]??0,$u[t.player]%32===0&&Pt(et,t.player,`$whiteactive $blue${t.player}`),++$u[t.player];break;case"input":{if(t.player.includes("local")&&!Zx(t.player)&&ES(et,t.player),!t.player.includes("local")||Zx(t.player)){const r=Kr(t.player),[n=Sr.NONE,i=0]=t.data??[Sr.NONE,0];ut(r.inputqueue)||(r.inputqueue=[]),n!==Sr.NONE&&r.inputqueue.push([n,i])}break}case"codewatch":if(ut(t.data)){const[r,n]=t.data,i=uc(r,n);w(Bu[i])||(Bu[i]=ly(i,s=>{const[o,a]=n,c=$n(r),l=Ts(c,o);if(w(l))if(ai(l)===Re.BOARD&&w(a)){const u=At(l),h=hr(u,a);w(h)&&(h.code=s,Ql(Zl(s),h))}else l.code=s,tF(l)})),Wo[i]=Wo[i]??new Set,Wo[i].add(t.player)}break;case"coderelease":if(ut(t.data)){const[r,n]=t.data,[,i]=n,s=uc(r,n);w(Wo[s])&&(Wo[s].delete(t.player),Wo[s].size===0&&(Bu[s]?.(),Bu[s]=void 0,ye(i)&&oz(i)))}break;case"halt":t.player===e&&FT(t.data)&&qj(t.data);break;case"tick":{cz(Yj());const r=Mr(Du);for(let n=0;n<r.length;++n){const i=r[n];--Du[i]}break}case"synthsend":if(ye(t.data)){const r=t.data,[n,i]=Kz(r),s=Du[r];if(!w(s)||s<=0){Du[r]=2;const o=dt(Xe.MAIN);Uo(n,i,void 0,Ao(o))}}break;case"second":{nz(Qi);const r=Object.keys(Qi);for(let n=0;n<r.length;++n)++Qi[r[n]];for(let n=0;n<r.length;++n){const i=r[n];Qi[i]>=eW&&hf(et,i)}++WA>=tW&&(WA=0,qr(et,t.player,async()=>{await HA(!0)}));break}case"copyjsonfile":if(t.player===e){const r=dt(Xe.MAIN);if(w(r)&&ut(t.data)){const[n]=t.data,i=Ts(r,n);w(i)&&rS(et,e,i,`${gt(i)}.${Ai(i)}.json`)}}break;case"refscroll":{ip(np("refscroll:menu"),n=>YE(t.player,n));const r=Rt(t.player);r.scrollname="refscroll",r.scroll=rr(t.player);break}case"readzipfilelist":{const r=$z();Pe(t.player,"$CENTER Select Files"),De(t.player,"zipfilelist","import selected",["importfiles"]);for(let i=0;i<r.length;++i){const[s,o]=r[i];s&&(Pe(t.player,o),De(t.player,"zipfilelist",`[${s}]`,[Be(o),"select","NO","0","YES","1"],a=>Dz(a)?1:0,(a,c)=>{Bz(a,!!c)}))}const n=Rt(t.player);n.scrollname="zipfilelist",n.scroll=rr(t.player);break}case"fork":t.player===e&&qr(et,t.player,async()=>{await rW()});break;case"zztsearch":qr(et,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data;let i=0;const s=[];for(;s.length<256;){KA(t.player);const o=await zz(r,n,i);if(i+=o.length,s.push(...o),o.length<25)break}qA(s,t.player)}});break;case"zztrandom":qr(et,t.player,async()=>{KA(t.player);const r=await Wz();qA(r,t.player)});break;case"itchiopublish":qr(et,t.player,async()=>{if(t.player===e){const r=dt(Xe.MAIN);if(w(r)){const n=await nW();tS(et,t.player,r.name,n)}}});break;case"flush":t.player===e&&qr(et,t.player,async()=>{await HA()});break;case"cli":rA(t.player,t.data);break;case"clirepeatlast":lz(t.player);break;case"restart":t.player===e&&(az(),Am(et,t.player));break;case"inspect":qr(et,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data;await q7(t.player,r,n)}});break;case"loader":if(ut(t.data)){const[r,n,i,s]=t.data;switch(n){case"file":F0(t.player,s);break;case"json":if(/file:.*\.book.json/.test(i)){Pt(et,t.player,`loading ${i}`);const o=JSON.parse(s.json);w(o.data)&&ye(o.exported)&&(xu(o.data),Pt(et,t.player,`loaded ${o.exported}`))}else if(/file:.*\..*\.codepage.json/.test(i)){Pt(et,t.player,`loading ${i}`);const o=JSON.parse(s.json),a=dt(Xe.MAIN);w(a)&&w(o.data)&&ye(o.exported)&&(ko(a,o.data),Pt(et,t.player,`loaded ${o.exported}`))}else rk(r,n,i,s,t.player);break;default:rk(r,n,i,s,t.player);break}}break;default:{const{target:r,path:n}=Fr(t.target);switch(Be(r)){case"refscroll":switch(n){case"charscroll":{De(t.player,"refscroll","char",["char","charedit"]);const i=Rt(t.player);i.scrollname="chars",i.scroll=rr(t.player);break}case"colorscroll":{De(t.player,"refscroll","color",["color","coloredit"]);const i=Rt(t.player);i.scrollname="colors",i.scroll=rr(t.player);break}default:{ip(np(`refscroll:${n}`),s=>YE(t.player,s));const i=Rt(t.player);i.scrollname=n,i.scroll=rr(t.player);break}}break;case"batch":qr(et,t.player,async()=>{await V7(n,t.player)});break;case"remix":qr(et,t.player,async()=>{await J7(n,t.player)});break;case"empty":{const i=Fr(n);switch(i.target){case"copycoords":uf(et,wr(),i.path.split(",").join(" "));break}break}case"inspect":Y7(n,t.player);break;case"touched":if(ut(t.data)){const[i,s,o]=t.data;eA({...t,target:`${s}:${o}`,data:void 0,sender:i})}break;case"zztbridge":qr(et,t.player,async()=>{ye(t.data)&&await Gz(t.player,t.data)});break;case"zipfilelist":qr(et,t.player,async()=>{await jz(t.player)});break;default:{const i=Fr(n);if(Be(i.target)==="self"||!i.path)t.target=t.target.replace("self:",""),eA(t);else{const s=dt(Xe.MAIN);Uo(i.target,i.path,void 0,Ao(s))}break}}break}}},Gj());function iW(){JT(et)}const{forward:sW}=NS(t=>{CS(t)&&postMessage(t)});onmessage=function(e){sW(e.data)},setTimeout(iW,100)})();
